var Xp=Object.defineProperty;var Yp=(n,t,e)=>t in n?Xp(n,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):n[t]=e;var M=(n,t,e)=>(Yp(n,typeof t!="symbol"?t+"":t,e),e),Su=(n,t,e)=>{if(!t.has(n))throw TypeError("Cannot "+e)};var jr=(n,t,e)=>(Su(n,t,"read from private field"),e?e.call(n):t.get(n)),bu=(n,t,e)=>{if(t.has(n))throw TypeError("Cannot add the same private member more than once");t instanceof WeakSet?t.add(n):t.set(n,e)},Uo=(n,t,e,r)=>(Su(n,t,"write to private field"),r?r.call(n,e):t.set(n,e),e);var Mu=(n,t,e)=>(Su(n,t,"access private method"),e);import{_ as rc}from"./index-default-C_maRo4o.js";import{p as Zp,b as Hp,f as Xu,r as Kp,l as Jp,a as Qp,e as $p}from"./index-DnNB6xa5.js";function ch(n,t,e){if(n!==null)for(var r,i,s,o,a,u,l,c=0,h=0,f,p=n.type,d=p==="FeatureCollection",_=p==="Feature",w=d?n.features.length:1,y=0;y<w;y++){l=d?n.features[y].geometry:_?n.geometry:n,f=l?l.type==="GeometryCollection":!1,a=f?l.geometries.length:1;for(var x=0;x<a;x++){var g=0,m=0;if(o=f?l.geometries[x]:l,o!==null){u=o.coordinates;var E=o.type;switch(c=e&&(E==="Polygon"||E==="MultiPolygon")?1:0,E){case null:break;case"Point":if(t(u,h,y,g,m)===!1)return!1;h++,g++;break;case"LineString":case"MultiPoint":for(r=0;r<u.length;r++){if(t(u[r],h,y,g,m)===!1)return!1;h++,E==="MultiPoint"&&g++}E==="LineString"&&g++;break;case"Polygon":case"MultiLineString":for(r=0;r<u.length;r++){for(i=0;i<u[r].length-c;i++){if(t(u[r][i],h,y,g,m)===!1)return!1;h++}E==="MultiLineString"&&g++,E==="Polygon"&&m++}E==="Polygon"&&g++;break;case"MultiPolygon":for(r=0;r<u.length;r++){for(m=0,i=0;i<u[r].length;i++){for(s=0;s<u[r][i].length-c;s++){if(t(u[r][i][s],h,y,g,m)===!1)return!1;h++}m++}g++}break;case"GeometryCollection":for(r=0;r<o.geometries.length;r++)if(ch(o.geometries[r],t,e)===!1)return!1;break;default:throw new Error("Unknown Geometry Type")}}}}}function nc(n,t){if(n.type==="Feature")t(n,0);else if(n.type==="FeatureCollection")for(var e=0;e<n.features.length&&t(n.features[e],e)!==!1;e++);}function hh(n,t){var e,r,i,s,o,a,u,l,c,h,f=0,p=n.type==="FeatureCollection",d=n.type==="Feature",_=p?n.features.length:1;for(e=0;e<_;e++){for(a=p?n.features[e].geometry:d?n.geometry:n,l=p?n.features[e].properties:d?n.properties:{},c=p?n.features[e].bbox:d?n.bbox:void 0,h=p?n.features[e].id:d?n.id:void 0,u=a?a.type==="GeometryCollection":!1,o=u?a.geometries.length:1,i=0;i<o;i++){if(s=u?a.geometries[i]:a,s===null){if(t(null,f,l,c,h)===!1)return!1;continue}switch(s.type){case"Point":case"LineString":case"MultiPoint":case"Polygon":case"MultiLineString":case"MultiPolygon":{if(t(s,f,l,c,h)===!1)return!1;break}case"GeometryCollection":{for(r=0;r<s.geometries.length;r++)if(t(s.geometries[r],f,l,c,h)===!1)return!1;break}default:throw new Error("Unknown Geometry Type")}}f++}}function Ks(n){var t=[1/0,1/0,-1/0,-1/0];return ch(n,function(e){t[0]>e[0]&&(t[0]=e[0]),t[1]>e[1]&&(t[1]=e[1]),t[2]<e[0]&&(t[2]=e[0]),t[3]<e[1]&&(t[3]=e[1])}),t}Ks.default=Ks;function tg(n,t){t===void 0&&(t={});var e=Number(n[0]),r=Number(n[1]),i=Number(n[2]),s=Number(n[3]);if(n.length===6)throw new Error("@turf/bbox-polygon does not support BBox with 6 positions");var o=[e,r],a=[e,s],u=[i,s],l=[i,r];return Zp([[o,l,u,a,o]],t.properties,{bbox:n,id:t.id})}function eg(n,t){t===void 0&&(t={});var e=Ks(n),r=(e[0]+e[2])/2,i=(e[1]+e[3])/2;return Hp([r,i],t.properties,t)}"fill"in Array.prototype||Object.defineProperty(Array.prototype,"fill",{configurable:!0,value:function(t){if(this===void 0||this===null)throw new TypeError(this+" is not an object");var e=Object(this),r=Math.max(Math.min(e.length,9007199254740991),0)||0,i=1 in arguments&&parseInt(Number(arguments[1]),10)||0;i=i<0?Math.max(r+i,0):Math.min(i,r);var s=2 in arguments&&arguments[2]!==void 0?parseInt(Number(arguments[2]),10)||0:r;for(s=s<0?Math.max(r+arguments[2],0):Math.min(s,r);i<s;)e[i]=t,++i;return e},writable:!0});Number.isFinite=Number.isFinite||function(n){return typeof n=="number"&&isFinite(n)};Number.isInteger=Number.isInteger||function(n){return typeof n=="number"&&isFinite(n)&&Math.floor(n)===n};Number.parseFloat=Number.parseFloat||parseFloat;Number.isNaN=Number.isNaN||function(n){return n!==n};Math.trunc=Math.trunc||function(n){return n<0?Math.ceil(n):Math.floor(n)};var xi=function(){};xi.prototype.interfaces_=function(){return[]};xi.prototype.getClass=function(){return xi};xi.prototype.equalsWithTolerance=function(t,e,r){return Math.abs(t-e)<=r};var Rt=function(n){function t(e){n.call(this,e),this.name="IllegalArgumentException",this.message=e,this.stack=new n().stack}return n&&(t.__proto__=n),t.prototype=Object.create(n&&n.prototype),t.prototype.constructor=t,t}(Error),J=function(){},fh={MAX_VALUE:{configurable:!0}};J.isNaN=function(t){return Number.isNaN(t)};J.doubleToLongBits=function(t){return t};J.longBitsToDouble=function(t){return t};J.isInfinite=function(t){return!Number.isFinite(t)};fh.MAX_VALUE.get=function(){return Number.MAX_VALUE};Object.defineProperties(J,fh);var sr=function(){},Ja=function(){},es=function(){};function or(){}var P=function n(){if(this.x=null,this.y=null,this.z=null,arguments.length===0)this.x=0,this.y=0,this.z=n.NULL_ORDINATE;else if(arguments.length===1){var t=arguments[0];this.x=t.x,this.y=t.y,this.z=t.z}else arguments.length===2?(this.x=arguments[0],this.y=arguments[1],this.z=n.NULL_ORDINATE):arguments.length===3&&(this.x=arguments[0],this.y=arguments[1],this.z=arguments[2])},Bi={DimensionalComparator:{configurable:!0},serialVersionUID:{configurable:!0},NULL_ORDINATE:{configurable:!0},X:{configurable:!0},Y:{configurable:!0},Z:{configurable:!0}};P.prototype.setOrdinate=function(t,e){switch(t){case P.X:this.x=e;break;case P.Y:this.y=e;break;case P.Z:this.z=e;break;default:throw new Rt("Invalid ordinate index: "+t)}};P.prototype.equals2D=function(){if(arguments.length===1){var t=arguments[0];return!(this.x!==t.x||this.y!==t.y)}else if(arguments.length===2){var e=arguments[0],r=arguments[1];return!(!xi.equalsWithTolerance(this.x,e.x,r)||!xi.equalsWithTolerance(this.y,e.y,r))}};P.prototype.getOrdinate=function(t){switch(t){case P.X:return this.x;case P.Y:return this.y;case P.Z:return this.z}throw new Rt("Invalid ordinate index: "+t)};P.prototype.equals3D=function(t){return this.x===t.x&&this.y===t.y&&(this.z===t.z||J.isNaN(this.z))&&J.isNaN(t.z)};P.prototype.equals=function(t){return t instanceof P?this.equals2D(t):!1};P.prototype.equalInZ=function(t,e){return xi.equalsWithTolerance(this.z,t.z,e)};P.prototype.compareTo=function(t){var e=t;return this.x<e.x?-1:this.x>e.x?1:this.y<e.y?-1:this.y>e.y?1:0};P.prototype.clone=function(){};P.prototype.copy=function(){return new P(this)};P.prototype.toString=function(){return"("+this.x+", "+this.y+", "+this.z+")"};P.prototype.distance3D=function(t){var e=this.x-t.x,r=this.y-t.y,i=this.z-t.z;return Math.sqrt(e*e+r*r+i*i)};P.prototype.distance=function(t){var e=this.x-t.x,r=this.y-t.y;return Math.sqrt(e*e+r*r)};P.prototype.hashCode=function(){var t=17;return t=37*t+P.hashCode(this.x),t=37*t+P.hashCode(this.y),t};P.prototype.setCoordinate=function(t){this.x=t.x,this.y=t.y,this.z=t.z};P.prototype.interfaces_=function(){return[sr,Ja,or]};P.prototype.getClass=function(){return P};P.hashCode=function(){if(arguments.length===1){var t=arguments[0],e=J.doubleToLongBits(t);return Math.trunc((e^e)>>>32)}};Bi.DimensionalComparator.get=function(){return kn};Bi.serialVersionUID.get=function(){return 6683108902428367e3};Bi.NULL_ORDINATE.get=function(){return J.NaN};Bi.X.get=function(){return 0};Bi.Y.get=function(){return 1};Bi.Z.get=function(){return 2};Object.defineProperties(P,Bi);var kn=function(t){if(this._dimensionsToTest=2,arguments.length!==0){if(arguments.length===1){var e=arguments[0];if(e!==2&&e!==3)throw new Rt("only 2 or 3 dimensions may be specified");this._dimensionsToTest=e}}};kn.prototype.compare=function(t,e){var r=t,i=e,s=kn.compare(r.x,i.x);if(s!==0)return s;var o=kn.compare(r.y,i.y);if(o!==0)return o;if(this._dimensionsToTest<=2)return 0;var a=kn.compare(r.z,i.z);return a};kn.prototype.interfaces_=function(){return[es]};kn.prototype.getClass=function(){return kn};kn.compare=function(t,e){return t<e?-1:t>e?1:J.isNaN(t)?J.isNaN(e)?0:-1:J.isNaN(e)?1:0};var rs=function(){};rs.prototype.create=function(){};rs.prototype.interfaces_=function(){return[]};rs.prototype.getClass=function(){return rs};var R=function(){},To={INTERIOR:{configurable:!0},BOUNDARY:{configurable:!0},EXTERIOR:{configurable:!0},NONE:{configurable:!0}};R.prototype.interfaces_=function(){return[]};R.prototype.getClass=function(){return R};R.toLocationSymbol=function(t){switch(t){case R.EXTERIOR:return"e";case R.BOUNDARY:return"b";case R.INTERIOR:return"i";case R.NONE:return"-"}throw new Rt("Unknown location value: "+t)};To.INTERIOR.get=function(){return 0};To.BOUNDARY.get=function(){return 1};To.EXTERIOR.get=function(){return 2};To.NONE.get=function(){return-1};Object.defineProperties(R,To);var H=function(n,t){return n.interfaces_&&n.interfaces_().indexOf(t)>-1},We=function(){},ph={LOG_10:{configurable:!0}};We.prototype.interfaces_=function(){return[]};We.prototype.getClass=function(){return We};We.log10=function(t){var e=Math.log(t);return J.isInfinite(e)||J.isNaN(e)?e:e/We.LOG_10};We.min=function(t,e,r,i){var s=t;return e<s&&(s=e),r<s&&(s=r),i<s&&(s=i),s};We.clamp=function(){if(typeof arguments[2]=="number"&&typeof arguments[0]=="number"&&typeof arguments[1]=="number"){var t=arguments[0],e=arguments[1],r=arguments[2];return t<e?e:t>r?r:t}else if(Number.isInteger(arguments[2])&&Number.isInteger(arguments[0])&&Number.isInteger(arguments[1])){var i=arguments[0],s=arguments[1],o=arguments[2];return i<s?s:i>o?o:i}};We.wrap=function(t,e){return t<0?e- -t%e:t%e};We.max=function(){if(arguments.length===3){var t=arguments[0],e=arguments[1],r=arguments[2],i=t;return e>i&&(i=e),r>i&&(i=r),i}else if(arguments.length===4){var s=arguments[0],o=arguments[1],a=arguments[2],u=arguments[3],l=s;return o>l&&(l=o),a>l&&(l=a),u>l&&(l=u),l}};We.average=function(t,e){return(t+e)/2};ph.LOG_10.get=function(){return Math.log(10)};Object.defineProperties(We,ph);var zr=function(t){this.str=t};zr.prototype.append=function(t){this.str+=t};zr.prototype.setCharAt=function(t,e){this.str=this.str.substr(0,t)+e+this.str.substr(t+1)};zr.prototype.toString=function(t){return this.str};var Pr=function(t){this.value=t};Pr.prototype.intValue=function(){return this.value};Pr.prototype.compareTo=function(t){return this.value<t?-1:this.value>t?1:0};Pr.isNaN=function(t){return Number.isNaN(t)};var Js=function(){};Js.isWhitespace=function(t){return t<=32&&t>=0||t===127};Js.toUpperCase=function(t){return t.toUpperCase()};var L=function n(){if(this._hi=0,this._lo=0,arguments.length===0)this.init(0);else if(arguments.length===1){if(typeof arguments[0]=="number"){var t=arguments[0];this.init(t)}else if(arguments[0]instanceof n){var e=arguments[0];this.init(e)}else if(typeof arguments[0]=="string"){var r=arguments[0];n.call(this,n.parse(r))}}else if(arguments.length===2){var i=arguments[0],s=arguments[1];this.init(i,s)}},_r={PI:{configurable:!0},TWO_PI:{configurable:!0},PI_2:{configurable:!0},E:{configurable:!0},NaN:{configurable:!0},EPS:{configurable:!0},SPLIT:{configurable:!0},MAX_PRINT_DIGITS:{configurable:!0},TEN:{configurable:!0},ONE:{configurable:!0},SCI_NOT_EXPONENT_CHAR:{configurable:!0},SCI_NOT_ZERO:{configurable:!0}};L.prototype.le=function(t){return(this._hi<t._hi||this._hi===t._hi)&&this._lo<=t._lo};L.prototype.extractSignificantDigits=function(t,e){var r=this.abs(),i=L.magnitude(r._hi),s=L.TEN.pow(i);r=r.divide(s),r.gt(L.TEN)?(r=r.divide(L.TEN),i+=1):r.lt(L.ONE)&&(r=r.multiply(L.TEN),i-=1);for(var o=i+1,a=new zr,u=L.MAX_PRINT_DIGITS-1,l=0;l<=u;l++){t&&l===o&&a.append(".");var c=Math.trunc(r._hi);if(c<0)break;var h=!1,f=0;c>9?(h=!0,f="9"):f="0"+c,a.append(f),r=r.subtract(L.valueOf(c)).multiply(L.TEN),h&&r.selfAdd(L.TEN);var p=!0,d=L.magnitude(r._hi);if(d<0&&Math.abs(d)>=u-l&&(p=!1),!p)break}return e[0]=i,a.toString()};L.prototype.sqr=function(){return this.multiply(this)};L.prototype.doubleValue=function(){return this._hi+this._lo};L.prototype.subtract=function(){if(arguments[0]instanceof L){var t=arguments[0];return this.add(t.negate())}else if(typeof arguments[0]=="number"){var e=arguments[0];return this.add(-e)}};L.prototype.equals=function(){if(arguments.length===1){var t=arguments[0];return this._hi===t._hi&&this._lo===t._lo}};L.prototype.isZero=function(){return this._hi===0&&this._lo===0};L.prototype.selfSubtract=function(){if(arguments[0]instanceof L){var t=arguments[0];return this.isNaN()?this:this.selfAdd(-t._hi,-t._lo)}else if(typeof arguments[0]=="number"){var e=arguments[0];return this.isNaN()?this:this.selfAdd(-e,0)}};L.prototype.getSpecialNumberString=function(){return this.isZero()?"0.0":this.isNaN()?"NaN ":null};L.prototype.min=function(t){return this.le(t)?this:t};L.prototype.selfDivide=function(){if(arguments.length===1){if(arguments[0]instanceof L){var t=arguments[0];return this.selfDivide(t._hi,t._lo)}else if(typeof arguments[0]=="number"){var e=arguments[0];return this.selfDivide(e,0)}}else if(arguments.length===2){var r=arguments[0],i=arguments[1],s=null,o=null,a=null,u=null,l=null,c=null,h=null,f=null;return l=this._hi/r,c=L.SPLIT*l,s=c-l,f=L.SPLIT*r,s=c-s,o=l-s,a=f-r,h=l*r,a=f-a,u=r-a,f=s*a-h+s*u+o*a+o*u,c=(this._hi-h-f+this._lo-l*i)/r,f=l+c,this._hi=f,this._lo=l-f+c,this}};L.prototype.dump=function(){return"DD<"+this._hi+", "+this._lo+">"};L.prototype.divide=function(){if(arguments[0]instanceof L){var t=arguments[0],e=null,r=null,i=null,s=null,o=null,a=null,u=null,l=null;o=this._hi/t._hi,a=L.SPLIT*o,e=a-o,l=L.SPLIT*t._hi,e=a-e,r=o-e,i=l-t._hi,u=o*t._hi,i=l-i,s=t._hi-i,l=e*i-u+e*s+r*i+r*s,a=(this._hi-u-l+this._lo-o*t._lo)/t._hi,l=o+a;var c=l,h=o-l+a;return new L(c,h)}else if(typeof arguments[0]=="number"){var f=arguments[0];return J.isNaN(f)?L.createNaN():L.copy(this).selfDivide(f,0)}};L.prototype.ge=function(t){return(this._hi>t._hi||this._hi===t._hi)&&this._lo>=t._lo};L.prototype.pow=function(t){if(t===0)return L.valueOf(1);var e=new L(this),r=L.valueOf(1),i=Math.abs(t);if(i>1)for(;i>0;)i%2===1&&r.selfMultiply(e),i/=2,i>0&&(e=e.sqr());else r=e;return t<0?r.reciprocal():r};L.prototype.ceil=function(){if(this.isNaN())return L.NaN;var t=Math.ceil(this._hi),e=0;return t===this._hi&&(e=Math.ceil(this._lo)),new L(t,e)};L.prototype.compareTo=function(t){var e=t;return this._hi<e._hi?-1:this._hi>e._hi?1:this._lo<e._lo?-1:this._lo>e._lo?1:0};L.prototype.rint=function(){if(this.isNaN())return this;var t=this.add(.5);return t.floor()};L.prototype.setValue=function(){if(arguments[0]instanceof L){var t=arguments[0];return this.init(t),this}else if(typeof arguments[0]=="number"){var e=arguments[0];return this.init(e),this}};L.prototype.max=function(t){return this.ge(t)?this:t};L.prototype.sqrt=function(){if(this.isZero())return L.valueOf(0);if(this.isNegative())return L.NaN;var t=1/Math.sqrt(this._hi),e=this._hi*t,r=L.valueOf(e),i=this.subtract(r.sqr()),s=i._hi*(t*.5);return r.add(s)};L.prototype.selfAdd=function(){if(arguments.length===1){if(arguments[0]instanceof L){var t=arguments[0];return this.selfAdd(t._hi,t._lo)}else if(typeof arguments[0]=="number"){var e=arguments[0],r=null,i=null,s=null,o=null,a=null,u=null;return s=this._hi+e,a=s-this._hi,o=s-a,o=e-a+(this._hi-o),u=o+this._lo,r=s+u,i=u+(s-r),this._hi=r+i,this._lo=i+(r-this._hi),this}}else if(arguments.length===2){var l=arguments[0],c=arguments[1],h=null,f=null,p=null,d=null,_=null,w=null,y=null,x=null;_=this._hi+l,p=this._lo+c,y=_-this._hi,x=p-this._lo,w=_-y,d=p-x,w=l-y+(this._hi-w),d=c-x+(this._lo-d),y=w+p,h=_+y,f=y+(_-h),y=d+f;var g=h+y,m=y+(h-g);return this._hi=g,this._lo=m,this}};L.prototype.selfMultiply=function(){if(arguments.length===1){if(arguments[0]instanceof L){var t=arguments[0];return this.selfMultiply(t._hi,t._lo)}else if(typeof arguments[0]=="number"){var e=arguments[0];return this.selfMultiply(e,0)}}else if(arguments.length===2){var r=arguments[0],i=arguments[1],s=null,o=null,a=null,u=null,l=null,c=null;l=L.SPLIT*this._hi,s=l-this._hi,c=L.SPLIT*r,s=l-s,o=this._hi-s,a=c-r,l=this._hi*r,a=c-a,u=r-a,c=s*a-l+s*u+o*a+o*u+(this._hi*i+this._lo*r);var h=l+c;s=l-h;var f=c+s;return this._hi=h,this._lo=f,this}};L.prototype.selfSqr=function(){return this.selfMultiply(this)};L.prototype.floor=function(){if(this.isNaN())return L.NaN;var t=Math.floor(this._hi),e=0;return t===this._hi&&(e=Math.floor(this._lo)),new L(t,e)};L.prototype.negate=function(){return this.isNaN()?this:new L(-this._hi,-this._lo)};L.prototype.clone=function(){};L.prototype.multiply=function(){if(arguments[0]instanceof L){var t=arguments[0];return t.isNaN()?L.createNaN():L.copy(this).selfMultiply(t)}else if(typeof arguments[0]=="number"){var e=arguments[0];return J.isNaN(e)?L.createNaN():L.copy(this).selfMultiply(e,0)}};L.prototype.isNaN=function(){return J.isNaN(this._hi)};L.prototype.intValue=function(){return Math.trunc(this._hi)};L.prototype.toString=function(){var t=L.magnitude(this._hi);return t>=-3&&t<=20?this.toStandardNotation():this.toSciNotation()};L.prototype.toStandardNotation=function(){var t=this.getSpecialNumberString();if(t!==null)return t;var e=new Array(1).fill(null),r=this.extractSignificantDigits(!0,e),i=e[0]+1,s=r;if(r.charAt(0)===".")s="0"+r;else if(i<0)s="0."+L.stringOfChar("0",-i)+r;else if(r.indexOf(".")===-1){var o=i-r.length,a=L.stringOfChar("0",o);s=r+a+".0"}return this.isNegative()?"-"+s:s};L.prototype.reciprocal=function(){var t=null,e=null,r=null,i=null,s=null,o=null,a=null,u=null;s=1/this._hi,o=L.SPLIT*s,t=o-s,u=L.SPLIT*this._hi,t=o-t,e=s-t,r=u-this._hi,a=s*this._hi,r=u-r,i=this._hi-r,u=t*r-a+t*i+e*r+e*i,o=(1-a-u-s*this._lo)/this._hi;var l=s+o,c=s-l+o;return new L(l,c)};L.prototype.toSciNotation=function(){if(this.isZero())return L.SCI_NOT_ZERO;var t=this.getSpecialNumberString();if(t!==null)return t;var e=new Array(1).fill(null),r=this.extractSignificantDigits(!1,e),i=L.SCI_NOT_EXPONENT_CHAR+e[0];if(r.charAt(0)==="0")throw new Error("Found leading zero: "+r);var s="";r.length>1&&(s=r.substring(1));var o=r.charAt(0)+"."+s;return this.isNegative()?"-"+o+i:o+i};L.prototype.abs=function(){return this.isNaN()?L.NaN:this.isNegative()?this.negate():new L(this)};L.prototype.isPositive=function(){return(this._hi>0||this._hi===0)&&this._lo>0};L.prototype.lt=function(t){return(this._hi<t._hi||this._hi===t._hi)&&this._lo<t._lo};L.prototype.add=function(){if(arguments[0]instanceof L){var t=arguments[0];return L.copy(this).selfAdd(t)}else if(typeof arguments[0]=="number"){var e=arguments[0];return L.copy(this).selfAdd(e)}};L.prototype.init=function(){if(arguments.length===1){if(typeof arguments[0]=="number"){var t=arguments[0];this._hi=t,this._lo=0}else if(arguments[0]instanceof L){var e=arguments[0];this._hi=e._hi,this._lo=e._lo}}else if(arguments.length===2){var r=arguments[0],i=arguments[1];this._hi=r,this._lo=i}};L.prototype.gt=function(t){return(this._hi>t._hi||this._hi===t._hi)&&this._lo>t._lo};L.prototype.isNegative=function(){return(this._hi<0||this._hi===0)&&this._lo<0};L.prototype.trunc=function(){return this.isNaN()?L.NaN:this.isPositive()?this.floor():this.ceil()};L.prototype.signum=function(){return this._hi>0?1:this._hi<0?-1:this._lo>0?1:this._lo<0?-1:0};L.prototype.interfaces_=function(){return[or,sr,Ja]};L.prototype.getClass=function(){return L};L.sqr=function(t){return L.valueOf(t).selfMultiply(t)};L.valueOf=function(){if(typeof arguments[0]=="string"){var t=arguments[0];return L.parse(t)}else if(typeof arguments[0]=="number"){var e=arguments[0];return new L(e)}};L.sqrt=function(t){return L.valueOf(t).sqrt()};L.parse=function(t){for(var e=0,r=t.length;Js.isWhitespace(t.charAt(e));)e++;var i=!1;if(e<r){var s=t.charAt(e);(s==="-"||s==="+")&&(e++,s==="-"&&(i=!0))}for(var o=new L,a=0,u=0,l=0;!(e>=r);){var c=t.charAt(e);if(e++,Js.isDigit(c)){var h=c-"0";o.selfMultiply(L.TEN),o.selfAdd(h),a++;continue}if(c==="."){u=a;continue}if(c==="e"||c==="E"){var f=t.substring(e);try{l=Pr.parseInt(f)}catch(y){throw y instanceof Error?new Error("Invalid exponent "+f+" in string "+t):y}finally{}break}throw new Error("Unexpected character '"+c+"' at position "+e+" in string "+t)}var p=o,d=a-u-l;if(d===0)p=o;else if(d>0){var _=L.TEN.pow(d);p=o.divide(_)}else if(d<0){var w=L.TEN.pow(-d);p=o.multiply(w)}return i?p.negate():p};L.createNaN=function(){return new L(J.NaN,J.NaN)};L.copy=function(t){return new L(t)};L.magnitude=function(t){var e=Math.abs(t),r=Math.log(e)/Math.log(10),i=Math.trunc(Math.floor(r)),s=Math.pow(10,i);return s*10<=e&&(i+=1),i};L.stringOfChar=function(t,e){for(var r=new zr,i=0;i<e;i++)r.append(t);return r.toString()};_r.PI.get=function(){return new L(3.141592653589793,12246467991473532e-32)};_r.TWO_PI.get=function(){return new L(6.283185307179586,24492935982947064e-32)};_r.PI_2.get=function(){return new L(1.5707963267948966,6123233995736766e-32)};_r.E.get=function(){return new L(2.718281828459045,14456468917292502e-32)};_r.NaN.get=function(){return new L(J.NaN,J.NaN)};_r.EPS.get=function(){return 123259516440783e-46};_r.SPLIT.get=function(){return 134217729};_r.MAX_PRINT_DIGITS.get=function(){return 32};_r.TEN.get=function(){return L.valueOf(10)};_r.ONE.get=function(){return L.valueOf(1)};_r.SCI_NOT_EXPONENT_CHAR.get=function(){return"E"};_r.SCI_NOT_ZERO.get=function(){return"0.0E0"};Object.defineProperties(L,_r);var Pe=function(){},gh={DP_SAFE_EPSILON:{configurable:!0}};Pe.prototype.interfaces_=function(){return[]};Pe.prototype.getClass=function(){return Pe};Pe.orientationIndex=function(t,e,r){var i=Pe.orientationIndexFilter(t,e,r);if(i<=1)return i;var s=L.valueOf(e.x).selfAdd(-t.x),o=L.valueOf(e.y).selfAdd(-t.y),a=L.valueOf(r.x).selfAdd(-e.x),u=L.valueOf(r.y).selfAdd(-e.y);return s.selfMultiply(u).selfSubtract(o.selfMultiply(a)).signum()};Pe.signOfDet2x2=function(t,e,r,i){var s=t.multiply(i).selfSubtract(e.multiply(r));return s.signum()};Pe.intersection=function(t,e,r,i){var s=L.valueOf(i.y).selfSubtract(r.y).selfMultiply(L.valueOf(e.x).selfSubtract(t.x)),o=L.valueOf(i.x).selfSubtract(r.x).selfMultiply(L.valueOf(e.y).selfSubtract(t.y)),a=s.subtract(o),u=L.valueOf(i.x).selfSubtract(r.x).selfMultiply(L.valueOf(t.y).selfSubtract(r.y)),l=L.valueOf(i.y).selfSubtract(r.y).selfMultiply(L.valueOf(t.x).selfSubtract(r.x)),c=u.subtract(l),h=c.selfDivide(a).doubleValue(),f=L.valueOf(t.x).selfAdd(L.valueOf(e.x).selfSubtract(t.x).selfMultiply(h)).doubleValue(),p=L.valueOf(e.x).selfSubtract(t.x).selfMultiply(L.valueOf(t.y).selfSubtract(r.y)),d=L.valueOf(e.y).selfSubtract(t.y).selfMultiply(L.valueOf(t.x).selfSubtract(r.x)),_=p.subtract(d),w=_.selfDivide(a).doubleValue(),y=L.valueOf(r.y).selfAdd(L.valueOf(i.y).selfSubtract(r.y).selfMultiply(w)).doubleValue();return new P(f,y)};Pe.orientationIndexFilter=function(t,e,r){var i=null,s=(t.x-r.x)*(e.y-r.y),o=(t.y-r.y)*(e.x-r.x),a=s-o;if(s>0){if(o<=0)return Pe.signum(a);i=s+o}else if(s<0){if(o>=0)return Pe.signum(a);i=-s-o}else return Pe.signum(a);var u=Pe.DP_SAFE_EPSILON*i;return a>=u||-a>=u?Pe.signum(a):2};Pe.signum=function(t){return t>0?1:t<0?-1:0};gh.DP_SAFE_EPSILON.get=function(){return 1e-15};Object.defineProperties(Pe,gh);var ut=function(){},Po={X:{configurable:!0},Y:{configurable:!0},Z:{configurable:!0},M:{configurable:!0}};Po.X.get=function(){return 0};Po.Y.get=function(){return 1};Po.Z.get=function(){return 2};Po.M.get=function(){return 3};ut.prototype.setOrdinate=function(t,e,r){};ut.prototype.size=function(){};ut.prototype.getOrdinate=function(t,e){};ut.prototype.getCoordinate=function(){};ut.prototype.getCoordinateCopy=function(t){};ut.prototype.getDimension=function(){};ut.prototype.getX=function(t){};ut.prototype.clone=function(){};ut.prototype.expandEnvelope=function(t){};ut.prototype.copy=function(){};ut.prototype.getY=function(t){};ut.prototype.toCoordinateArray=function(){};ut.prototype.interfaces_=function(){return[Ja]};ut.prototype.getClass=function(){return ut};Object.defineProperties(ut,Po);var dh=function(){},Ts=function(n){function t(){n.call(this,"Projective point not representable on the Cartesian plane.")}return n&&(t.__proto__=n),t.prototype=Object.create(n&&n.prototype),t.prototype.constructor=t,t.prototype.interfaces_=function(){return[]},t.prototype.getClass=function(){return t},t}(dh),le=function(){};le.arraycopy=function(t,e,r,i,s){for(var o=0,a=e;a<e+s;a++)r[i+o]=t[a],o++};le.getProperty=function(t){return{"line.separator":`
`}[t]};var ur=function n(){if(this.x=null,this.y=null,this.w=null,arguments.length===0)this.x=0,this.y=0,this.w=1;else if(arguments.length===1){var t=arguments[0];this.x=t.x,this.y=t.y,this.w=1}else if(arguments.length===2){if(typeof arguments[0]=="number"&&typeof arguments[1]=="number"){var e=arguments[0],r=arguments[1];this.x=e,this.y=r,this.w=1}else if(arguments[0]instanceof n&&arguments[1]instanceof n){var i=arguments[0],s=arguments[1];this.x=i.y*s.w-s.y*i.w,this.y=s.x*i.w-i.x*s.w,this.w=i.x*s.y-s.x*i.y}else if(arguments[0]instanceof P&&arguments[1]instanceof P){var o=arguments[0],a=arguments[1];this.x=o.y-a.y,this.y=a.x-o.x,this.w=o.x*a.y-a.x*o.y}}else if(arguments.length===3){var u=arguments[0],l=arguments[1],c=arguments[2];this.x=u,this.y=l,this.w=c}else if(arguments.length===4){var h=arguments[0],f=arguments[1],p=arguments[2],d=arguments[3],_=h.y-f.y,w=f.x-h.x,y=h.x*f.y-f.x*h.y,x=p.y-d.y,g=d.x-p.x,m=p.x*d.y-d.x*p.y;this.x=w*m-g*y,this.y=x*y-_*m,this.w=_*g-x*w}};ur.prototype.getY=function(){var t=this.y/this.w;if(J.isNaN(t)||J.isInfinite(t))throw new Ts;return t};ur.prototype.getX=function(){var t=this.x/this.w;if(J.isNaN(t)||J.isInfinite(t))throw new Ts;return t};ur.prototype.getCoordinate=function(){var t=new P;return t.x=this.getX(),t.y=this.getY(),t};ur.prototype.interfaces_=function(){return[]};ur.prototype.getClass=function(){return ur};ur.intersection=function(t,e,r,i){var s=t.y-e.y,o=e.x-t.x,a=t.x*e.y-e.x*t.y,u=r.y-i.y,l=i.x-r.x,c=r.x*i.y-i.x*r.y,h=o*c-l*a,f=u*a-s*c,p=s*l-u*o,d=h/p,_=f/p;if(J.isNaN(d)||J.isInfinite(d)||J.isNaN(_)||J.isInfinite(_))throw new Ts;return new P(d,_)};var W=function n(){if(this._minx=null,this._maxx=null,this._miny=null,this._maxy=null,arguments.length===0)this.init();else if(arguments.length===1){if(arguments[0]instanceof P){var t=arguments[0];this.init(t.x,t.x,t.y,t.y)}else if(arguments[0]instanceof n){var e=arguments[0];this.init(e)}}else if(arguments.length===2){var r=arguments[0],i=arguments[1];this.init(r.x,i.x,r.y,i.y)}else if(arguments.length===4){var s=arguments[0],o=arguments[1],a=arguments[2],u=arguments[3];this.init(s,o,a,u)}},mh={serialVersionUID:{configurable:!0}};W.prototype.getArea=function(){return this.getWidth()*this.getHeight()};W.prototype.equals=function(t){if(!(t instanceof W))return!1;var e=t;return this.isNull()?e.isNull():this._maxx===e.getMaxX()&&this._maxy===e.getMaxY()&&this._minx===e.getMinX()&&this._miny===e.getMinY()};W.prototype.intersection=function(t){if(this.isNull()||t.isNull()||!this.intersects(t))return new W;var e=this._minx>t._minx?this._minx:t._minx,r=this._miny>t._miny?this._miny:t._miny,i=this._maxx<t._maxx?this._maxx:t._maxx,s=this._maxy<t._maxy?this._maxy:t._maxy;return new W(e,i,r,s)};W.prototype.isNull=function(){return this._maxx<this._minx};W.prototype.getMaxX=function(){return this._maxx};W.prototype.covers=function(){if(arguments.length===1){if(arguments[0]instanceof P){var t=arguments[0];return this.covers(t.x,t.y)}else if(arguments[0]instanceof W){var e=arguments[0];return this.isNull()||e.isNull()?!1:e.getMinX()>=this._minx&&e.getMaxX()<=this._maxx&&e.getMinY()>=this._miny&&e.getMaxY()<=this._maxy}}else if(arguments.length===2){var r=arguments[0],i=arguments[1];return this.isNull()?!1:r>=this._minx&&r<=this._maxx&&i>=this._miny&&i<=this._maxy}};W.prototype.intersects=function(){if(arguments.length===1){if(arguments[0]instanceof W){var t=arguments[0];return this.isNull()||t.isNull()?!1:!(t._minx>this._maxx||t._maxx<this._minx||t._miny>this._maxy||t._maxy<this._miny)}else if(arguments[0]instanceof P){var e=arguments[0];return this.intersects(e.x,e.y)}}else if(arguments.length===2){var r=arguments[0],i=arguments[1];return this.isNull()?!1:!(r>this._maxx||r<this._minx||i>this._maxy||i<this._miny)}};W.prototype.getMinY=function(){return this._miny};W.prototype.getMinX=function(){return this._minx};W.prototype.expandToInclude=function(){if(arguments.length===1){if(arguments[0]instanceof P){var t=arguments[0];this.expandToInclude(t.x,t.y)}else if(arguments[0]instanceof W){var e=arguments[0];if(e.isNull())return null;this.isNull()?(this._minx=e.getMinX(),this._maxx=e.getMaxX(),this._miny=e.getMinY(),this._maxy=e.getMaxY()):(e._minx<this._minx&&(this._minx=e._minx),e._maxx>this._maxx&&(this._maxx=e._maxx),e._miny<this._miny&&(this._miny=e._miny),e._maxy>this._maxy&&(this._maxy=e._maxy))}}else if(arguments.length===2){var r=arguments[0],i=arguments[1];this.isNull()?(this._minx=r,this._maxx=r,this._miny=i,this._maxy=i):(r<this._minx&&(this._minx=r),r>this._maxx&&(this._maxx=r),i<this._miny&&(this._miny=i),i>this._maxy&&(this._maxy=i))}};W.prototype.minExtent=function(){if(this.isNull())return 0;var t=this.getWidth(),e=this.getHeight();return t<e?t:e};W.prototype.getWidth=function(){return this.isNull()?0:this._maxx-this._minx};W.prototype.compareTo=function(t){var e=t;return this.isNull()?e.isNull()?0:-1:e.isNull()?1:this._minx<e._minx?-1:this._minx>e._minx?1:this._miny<e._miny?-1:this._miny>e._miny?1:this._maxx<e._maxx?-1:this._maxx>e._maxx?1:this._maxy<e._maxy?-1:this._maxy>e._maxy?1:0};W.prototype.translate=function(t,e){if(this.isNull())return null;this.init(this.getMinX()+t,this.getMaxX()+t,this.getMinY()+e,this.getMaxY()+e)};W.prototype.toString=function(){return"Env["+this._minx+" : "+this._maxx+", "+this._miny+" : "+this._maxy+"]"};W.prototype.setToNull=function(){this._minx=0,this._maxx=-1,this._miny=0,this._maxy=-1};W.prototype.getHeight=function(){return this.isNull()?0:this._maxy-this._miny};W.prototype.maxExtent=function(){if(this.isNull())return 0;var t=this.getWidth(),e=this.getHeight();return t>e?t:e};W.prototype.expandBy=function(){if(arguments.length===1){var t=arguments[0];this.expandBy(t,t)}else if(arguments.length===2){var e=arguments[0],r=arguments[1];if(this.isNull())return null;this._minx-=e,this._maxx+=e,this._miny-=r,this._maxy+=r,(this._minx>this._maxx||this._miny>this._maxy)&&this.setToNull()}};W.prototype.contains=function(){if(arguments.length===1){if(arguments[0]instanceof W){var t=arguments[0];return this.covers(t)}else if(arguments[0]instanceof P){var e=arguments[0];return this.covers(e)}}else if(arguments.length===2){var r=arguments[0],i=arguments[1];return this.covers(r,i)}};W.prototype.centre=function(){return this.isNull()?null:new P((this.getMinX()+this.getMaxX())/2,(this.getMinY()+this.getMaxY())/2)};W.prototype.init=function(){if(arguments.length===0)this.setToNull();else if(arguments.length===1){if(arguments[0]instanceof P){var t=arguments[0];this.init(t.x,t.x,t.y,t.y)}else if(arguments[0]instanceof W){var e=arguments[0];this._minx=e._minx,this._maxx=e._maxx,this._miny=e._miny,this._maxy=e._maxy}}else if(arguments.length===2){var r=arguments[0],i=arguments[1];this.init(r.x,i.x,r.y,i.y)}else if(arguments.length===4){var s=arguments[0],o=arguments[1],a=arguments[2],u=arguments[3];s<o?(this._minx=s,this._maxx=o):(this._minx=o,this._maxx=s),a<u?(this._miny=a,this._maxy=u):(this._miny=u,this._maxy=a)}};W.prototype.getMaxY=function(){return this._maxy};W.prototype.distance=function(t){if(this.intersects(t))return 0;var e=0;this._maxx<t._minx?e=t._minx-this._maxx:this._minx>t._maxx&&(e=this._minx-t._maxx);var r=0;return this._maxy<t._miny?r=t._miny-this._maxy:this._miny>t._maxy&&(r=this._miny-t._maxy),e===0?r:r===0?e:Math.sqrt(e*e+r*r)};W.prototype.hashCode=function(){var t=17;return t=37*t+P.hashCode(this._minx),t=37*t+P.hashCode(this._maxx),t=37*t+P.hashCode(this._miny),t=37*t+P.hashCode(this._maxy),t};W.prototype.interfaces_=function(){return[sr,or]};W.prototype.getClass=function(){return W};W.intersects=function(){if(arguments.length===3){var t=arguments[0],e=arguments[1],r=arguments[2];return r.x>=(t.x<e.x?t.x:e.x)&&r.x<=(t.x>e.x?t.x:e.x)&&r.y>=(t.y<e.y?t.y:e.y)&&r.y<=(t.y>e.y?t.y:e.y)}else if(arguments.length===4){var i=arguments[0],s=arguments[1],o=arguments[2],a=arguments[3],u=Math.min(o.x,a.x),l=Math.max(o.x,a.x),c=Math.min(i.x,s.x),h=Math.max(i.x,s.x);return!(c>l||h<u||(u=Math.min(o.y,a.y),l=Math.max(o.y,a.y),c=Math.min(i.y,s.y),h=Math.max(i.y,s.y),c>l)||h<u)}};mh.serialVersionUID.get=function(){return 5873921885273102e3};Object.defineProperties(W,mh);var Er={typeStr:/^\s*(\w+)\s*\(\s*(.*)\s*\)\s*$/,emptyTypeStr:/^\s*(\w+)\s*EMPTY\s*$/,spaces:/\s+/,parenComma:/\)\s*,\s*\(/,doubleParenComma:/\)\s*\)\s*,\s*\(\s*\(/,trimParens:/^\s*\(?(.*?)\)?\s*$/},Qa=function(t){this.geometryFactory=t||new nt};Qa.prototype.read=function(t){var e,r,i;t=t.replace(/[\n\r]/g," ");var s=Er.typeStr.exec(t);if(t.search("EMPTY")!==-1&&(s=Er.emptyTypeStr.exec(t),s[2]=void 0),s&&(r=s[1].toLowerCase(),i=s[2],Qi[r]&&(e=Qi[r].apply(this,[i]))),e===void 0)throw new Error("Could not parse WKT "+t);return e};Qa.prototype.write=function(t){return this.extractGeometry(t)};Qa.prototype.extractGeometry=function(t){var e=t.getGeometryType().toLowerCase();if(!cn[e])return null;var r=e.toUpperCase(),i;return t.isEmpty()?i=r+" EMPTY":i=r+"("+cn[e].apply(this,[t])+")",i};var cn={coordinate:function(t){return t.x+" "+t.y},point:function(t){return cn.coordinate.call(this,t._coordinates._coordinates[0])},multipoint:function(t){for(var e=this,r=[],i=0,s=t._geometries.length;i<s;++i)r.push("("+cn.point.apply(e,[t._geometries[i]])+")");return r.join(",")},linestring:function(t){for(var e=this,r=[],i=0,s=t._points._coordinates.length;i<s;++i)r.push(cn.coordinate.apply(e,[t._points._coordinates[i]]));return r.join(",")},linearring:function(t){for(var e=this,r=[],i=0,s=t._points._coordinates.length;i<s;++i)r.push(cn.coordinate.apply(e,[t._points._coordinates[i]]));return r.join(",")},multilinestring:function(t){for(var e=this,r=[],i=0,s=t._geometries.length;i<s;++i)r.push("("+cn.linestring.apply(e,[t._geometries[i]])+")");return r.join(",")},polygon:function(t){var e=this,r=[];r.push("("+cn.linestring.apply(this,[t._shell])+")");for(var i=0,s=t._holes.length;i<s;++i)r.push("("+cn.linestring.apply(e,[t._holes[i]])+")");return r.join(",")},multipolygon:function(t){for(var e=this,r=[],i=0,s=t._geometries.length;i<s;++i)r.push("("+cn.polygon.apply(e,[t._geometries[i]])+")");return r.join(",")},geometrycollection:function(t){for(var e=this,r=[],i=0,s=t._geometries.length;i<s;++i)r.push(e.extractGeometry(t._geometries[i]));return r.join(",")}},Qi={point:function(t){if(t===void 0)return this.geometryFactory.createPoint();var e=t.trim().split(Er.spaces);return this.geometryFactory.createPoint(new P(Number.parseFloat(e[0]),Number.parseFloat(e[1])))},multipoint:function(t){var e=this;if(t===void 0)return this.geometryFactory.createMultiPoint();for(var r,i=t.trim().split(","),s=[],o=0,a=i.length;o<a;++o)r=i[o].replace(Er.trimParens,"$1"),s.push(Qi.point.apply(e,[r]));return this.geometryFactory.createMultiPoint(s)},linestring:function(t){if(t===void 0)return this.geometryFactory.createLineString();for(var e=t.trim().split(","),r=[],i,s=0,o=e.length;s<o;++s)i=e[s].trim().split(Er.spaces),r.push(new P(Number.parseFloat(i[0]),Number.parseFloat(i[1])));return this.geometryFactory.createLineString(r)},linearring:function(t){if(t===void 0)return this.geometryFactory.createLinearRing();for(var e=t.trim().split(","),r=[],i,s=0,o=e.length;s<o;++s)i=e[s].trim().split(Er.spaces),r.push(new P(Number.parseFloat(i[0]),Number.parseFloat(i[1])));return this.geometryFactory.createLinearRing(r)},multilinestring:function(t){var e=this;if(t===void 0)return this.geometryFactory.createMultiLineString();for(var r,i=t.trim().split(Er.parenComma),s=[],o=0,a=i.length;o<a;++o)r=i[o].replace(Er.trimParens,"$1"),s.push(Qi.linestring.apply(e,[r]));return this.geometryFactory.createMultiLineString(s)},polygon:function(t){var e=this;if(t===void 0)return this.geometryFactory.createPolygon();for(var r,i,s,o=t.trim().split(Er.parenComma),a,u=[],l=0,c=o.length;l<c;++l)r=o[l].replace(Er.trimParens,"$1"),i=Qi.linestring.apply(e,[r]),s=e.geometryFactory.createLinearRing(i._points),l===0?a=s:u.push(s);return this.geometryFactory.createPolygon(a,u)},multipolygon:function(t){var e=this;if(t===void 0)return this.geometryFactory.createMultiPolygon();for(var r,i=t.trim().split(Er.doubleParenComma),s=[],o=0,a=i.length;o<a;++o)r=i[o].replace(Er.trimParens,"$1"),s.push(Qi.polygon.apply(e,[r]));return this.geometryFactory.createMultiPolygon(s)},geometrycollection:function(t){var e=this;if(t===void 0)return this.geometryFactory.createGeometryCollection();t=t.replace(/,\s*([A-Za-z])/g,"|$1");for(var r=t.trim().split("|"),i=[],s=0,o=r.length;s<o;++s)i.push(e.read(r[s]));return this.geometryFactory.createGeometryCollection(i)}},hr=function(t){this.parser=new Qa(t)};hr.prototype.write=function(t){return this.parser.write(t)};hr.toLineString=function(t,e){if(arguments.length!==2)throw new Error("Not implemented");return"LINESTRING ( "+t.x+" "+t.y+", "+e.x+" "+e.y+" )"};var mn=function(n){function t(e){n.call(this,e),this.name="RuntimeException",this.message=e,this.stack=new n().stack}return n&&(t.__proto__=n),t.prototype=Object.create(n&&n.prototype),t.prototype.constructor=t,t}(Error),_a=function(n){function t(){if(n.call(this),arguments.length===0)n.call(this);else if(arguments.length===1){var e=arguments[0];n.call(this,e)}}return n&&(t.__proto__=n),t.prototype=Object.create(n&&n.prototype),t.prototype.constructor=t,t.prototype.interfaces_=function(){return[]},t.prototype.getClass=function(){return t},t}(mn),et=function(){};et.prototype.interfaces_=function(){return[]};et.prototype.getClass=function(){return et};et.shouldNeverReachHere=function(){if(arguments.length===0)et.shouldNeverReachHere(null);else if(arguments.length===1){var t=arguments[0];throw new _a("Should never reach here"+(t!==null?": "+t:""))}};et.isTrue=function(){var t,e;if(arguments.length===1)t=arguments[0],et.isTrue(t,null);else if(arguments.length===2&&(t=arguments[0],e=arguments[1],!t))throw e===null?new _a:new _a(e)};et.equals=function(){var t,e,r;if(arguments.length===2)t=arguments[0],e=arguments[1],et.equals(t,e,null);else if(arguments.length===3&&(t=arguments[0],e=arguments[1],r=arguments[2],!e.equals(t)))throw new _a("Expected "+t+" but encountered "+e+(r!==null?": "+r:""))};var Lt=function(){this._result=null,this._inputLines=Array(2).fill().map(function(){return Array(2)}),this._intPt=new Array(2).fill(null),this._intLineIndex=null,this._isProper=null,this._pa=null,this._pb=null,this._precisionModel=null,this._intPt[0]=new P,this._intPt[1]=new P,this._pa=this._intPt[0],this._pb=this._intPt[1],this._result=0},zi={DONT_INTERSECT:{configurable:!0},DO_INTERSECT:{configurable:!0},COLLINEAR:{configurable:!0},NO_INTERSECTION:{configurable:!0},POINT_INTERSECTION:{configurable:!0},COLLINEAR_INTERSECTION:{configurable:!0}};Lt.prototype.getIndexAlongSegment=function(t,e){return this.computeIntLineIndex(),this._intLineIndex[t][e]};Lt.prototype.getTopologySummary=function(){var t=new zr;return this.isEndPoint()&&t.append(" endpoint"),this._isProper&&t.append(" proper"),this.isCollinear()&&t.append(" collinear"),t.toString()};Lt.prototype.computeIntersection=function(t,e,r,i){this._inputLines[0][0]=t,this._inputLines[0][1]=e,this._inputLines[1][0]=r,this._inputLines[1][1]=i,this._result=this.computeIntersect(t,e,r,i)};Lt.prototype.getIntersectionNum=function(){return this._result};Lt.prototype.computeIntLineIndex=function(){if(arguments.length===0)this._intLineIndex===null&&(this._intLineIndex=Array(2).fill().map(function(){return Array(2)}),this.computeIntLineIndex(0),this.computeIntLineIndex(1));else if(arguments.length===1){var t=arguments[0],e=this.getEdgeDistance(t,0),r=this.getEdgeDistance(t,1);e>r?(this._intLineIndex[t][0]=0,this._intLineIndex[t][1]=1):(this._intLineIndex[t][0]=1,this._intLineIndex[t][1]=0)}};Lt.prototype.isProper=function(){return this.hasIntersection()&&this._isProper};Lt.prototype.setPrecisionModel=function(t){this._precisionModel=t};Lt.prototype.isInteriorIntersection=function(){var t=this;if(arguments.length===0)return!!(this.isInteriorIntersection(0)||this.isInteriorIntersection(1));if(arguments.length===1){for(var e=arguments[0],r=0;r<this._result;r++)if(!(t._intPt[r].equals2D(t._inputLines[e][0])||t._intPt[r].equals2D(t._inputLines[e][1])))return!0;return!1}};Lt.prototype.getIntersection=function(t){return this._intPt[t]};Lt.prototype.isEndPoint=function(){return this.hasIntersection()&&!this._isProper};Lt.prototype.hasIntersection=function(){return this._result!==Lt.NO_INTERSECTION};Lt.prototype.getEdgeDistance=function(t,e){var r=Lt.computeEdgeDistance(this._intPt[e],this._inputLines[t][0],this._inputLines[t][1]);return r};Lt.prototype.isCollinear=function(){return this._result===Lt.COLLINEAR_INTERSECTION};Lt.prototype.toString=function(){return hr.toLineString(this._inputLines[0][0],this._inputLines[0][1])+" - "+hr.toLineString(this._inputLines[1][0],this._inputLines[1][1])+this.getTopologySummary()};Lt.prototype.getEndpoint=function(t,e){return this._inputLines[t][e]};Lt.prototype.isIntersection=function(t){for(var e=this,r=0;r<this._result;r++)if(e._intPt[r].equals2D(t))return!0;return!1};Lt.prototype.getIntersectionAlongSegment=function(t,e){return this.computeIntLineIndex(),this._intPt[this._intLineIndex[t][e]]};Lt.prototype.interfaces_=function(){return[]};Lt.prototype.getClass=function(){return Lt};Lt.computeEdgeDistance=function(t,e,r){var i=Math.abs(r.x-e.x),s=Math.abs(r.y-e.y),o=-1;if(t.equals(e))o=0;else if(t.equals(r))i>s?o=i:o=s;else{var a=Math.abs(t.x-e.x),u=Math.abs(t.y-e.y);i>s?o=a:o=u,o===0&&!t.equals(e)&&(o=Math.max(a,u))}return et.isTrue(!(o===0&&!t.equals(e)),"Bad distance calculation"),o};Lt.nonRobustComputeEdgeDistance=function(t,e,r){var i=t.x-e.x,s=t.y-e.y,o=Math.sqrt(i*i+s*s);return et.isTrue(!(o===0&&!t.equals(e)),"Invalid distance calculation"),o};zi.DONT_INTERSECT.get=function(){return 0};zi.DO_INTERSECT.get=function(){return 1};zi.COLLINEAR.get=function(){return 2};zi.NO_INTERSECTION.get=function(){return 0};zi.POINT_INTERSECTION.get=function(){return 1};zi.COLLINEAR_INTERSECTION.get=function(){return 2};Object.defineProperties(Lt,zi);var yi=function(n){function t(){n.apply(this,arguments)}return n&&(t.__proto__=n),t.prototype=Object.create(n&&n.prototype),t.prototype.constructor=t,t.prototype.isInSegmentEnvelopes=function(r){var i=new W(this._inputLines[0][0],this._inputLines[0][1]),s=new W(this._inputLines[1][0],this._inputLines[1][1]);return i.contains(r)&&s.contains(r)},t.prototype.computeIntersection=function(){if(arguments.length===3){var r=arguments[0],i=arguments[1],s=arguments[2];if(this._isProper=!1,W.intersects(i,s,r)&&G.orientationIndex(i,s,r)===0&&G.orientationIndex(s,i,r)===0)return this._isProper=!0,(r.equals(i)||r.equals(s))&&(this._isProper=!1),this._result=n.POINT_INTERSECTION,null;this._result=n.NO_INTERSECTION}else return n.prototype.computeIntersection.apply(this,arguments)},t.prototype.normalizeToMinimum=function(r,i,s,o,a){a.x=this.smallestInAbsValue(r.x,i.x,s.x,o.x),a.y=this.smallestInAbsValue(r.y,i.y,s.y,o.y),r.x-=a.x,r.y-=a.y,i.x-=a.x,i.y-=a.y,s.x-=a.x,s.y-=a.y,o.x-=a.x,o.y-=a.y},t.prototype.safeHCoordinateIntersection=function(r,i,s,o){var a=null;try{a=ur.intersection(r,i,s,o)}catch(u){if(u instanceof Ts)a=t.nearestEndpoint(r,i,s,o);else throw u}finally{}return a},t.prototype.intersection=function(r,i,s,o){var a=this.intersectionWithNormalization(r,i,s,o);return this.isInSegmentEnvelopes(a)||(a=new P(t.nearestEndpoint(r,i,s,o))),this._precisionModel!==null&&this._precisionModel.makePrecise(a),a},t.prototype.smallestInAbsValue=function(r,i,s,o){var a=r,u=Math.abs(a);return Math.abs(i)<u&&(a=i,u=Math.abs(i)),Math.abs(s)<u&&(a=s,u=Math.abs(s)),Math.abs(o)<u&&(a=o),a},t.prototype.checkDD=function(r,i,s,o,a){var u=Pe.intersection(r,i,s,o),l=this.isInSegmentEnvelopes(u);le.out.println("DD in env = "+l+"  --------------------- "+u),a.distance(u)>1e-4&&le.out.println("Distance = "+a.distance(u))},t.prototype.intersectionWithNormalization=function(r,i,s,o){var a=new P(r),u=new P(i),l=new P(s),c=new P(o),h=new P;this.normalizeToEnvCentre(a,u,l,c,h);var f=this.safeHCoordinateIntersection(a,u,l,c);return f.x+=h.x,f.y+=h.y,f},t.prototype.computeCollinearIntersection=function(r,i,s,o){var a=W.intersects(r,i,s),u=W.intersects(r,i,o),l=W.intersects(s,o,r),c=W.intersects(s,o,i);return a&&u?(this._intPt[0]=s,this._intPt[1]=o,n.COLLINEAR_INTERSECTION):l&&c?(this._intPt[0]=r,this._intPt[1]=i,n.COLLINEAR_INTERSECTION):a&&l?(this._intPt[0]=s,this._intPt[1]=r,s.equals(r)&&!u&&!c?n.POINT_INTERSECTION:n.COLLINEAR_INTERSECTION):a&&c?(this._intPt[0]=s,this._intPt[1]=i,s.equals(i)&&!u&&!l?n.POINT_INTERSECTION:n.COLLINEAR_INTERSECTION):u&&l?(this._intPt[0]=o,this._intPt[1]=r,o.equals(r)&&!a&&!c?n.POINT_INTERSECTION:n.COLLINEAR_INTERSECTION):u&&c?(this._intPt[0]=o,this._intPt[1]=i,o.equals(i)&&!a&&!l?n.POINT_INTERSECTION:n.COLLINEAR_INTERSECTION):n.NO_INTERSECTION},t.prototype.normalizeToEnvCentre=function(r,i,s,o,a){var u=r.x<i.x?r.x:i.x,l=r.y<i.y?r.y:i.y,c=r.x>i.x?r.x:i.x,h=r.y>i.y?r.y:i.y,f=s.x<o.x?s.x:o.x,p=s.y<o.y?s.y:o.y,d=s.x>o.x?s.x:o.x,_=s.y>o.y?s.y:o.y,w=u>f?u:f,y=c<d?c:d,x=l>p?l:p,g=h<_?h:_,m=(w+y)/2,E=(x+g)/2;a.x=m,a.y=E,r.x-=a.x,r.y-=a.y,i.x-=a.x,i.y-=a.y,s.x-=a.x,s.y-=a.y,o.x-=a.x,o.y-=a.y},t.prototype.computeIntersect=function(r,i,s,o){if(this._isProper=!1,!W.intersects(r,i,s,o))return n.NO_INTERSECTION;var a=G.orientationIndex(r,i,s),u=G.orientationIndex(r,i,o);if(a>0&&u>0||a<0&&u<0)return n.NO_INTERSECTION;var l=G.orientationIndex(s,o,r),c=G.orientationIndex(s,o,i);if(l>0&&c>0||l<0&&c<0)return n.NO_INTERSECTION;var h=a===0&&u===0&&l===0&&c===0;return h?this.computeCollinearIntersection(r,i,s,o):(a===0||u===0||l===0||c===0?(this._isProper=!1,r.equals2D(s)||r.equals2D(o)?this._intPt[0]=r:i.equals2D(s)||i.equals2D(o)?this._intPt[0]=i:a===0?this._intPt[0]=new P(s):u===0?this._intPt[0]=new P(o):l===0?this._intPt[0]=new P(r):c===0&&(this._intPt[0]=new P(i))):(this._isProper=!0,this._intPt[0]=this.intersection(r,i,s,o)),n.POINT_INTERSECTION)},t.prototype.interfaces_=function(){return[]},t.prototype.getClass=function(){return t},t.nearestEndpoint=function(r,i,s,o){var a=r,u=G.distancePointLine(r,s,o),l=G.distancePointLine(i,s,o);return l<u&&(u=l,a=i),l=G.distancePointLine(s,r,i),l<u&&(u=l,a=s),l=G.distancePointLine(o,r,i),l<u&&(u=l,a=o),a},t}(Lt),Ii=function(){};Ii.prototype.interfaces_=function(){return[]};Ii.prototype.getClass=function(){return Ii};Ii.orientationIndex=function(t,e,r){var i=e.x-t.x,s=e.y-t.y,o=r.x-e.x,a=r.y-e.y;return Ii.signOfDet2x2(i,s,o,a)};Ii.signOfDet2x2=function(t,e,r,i){var s=null,o=null,a=null;if(s=1,t===0||i===0)return e===0||r===0?0:e>0?r>0?-s:s:r>0?s:-s;if(e===0||r===0)return i>0?t>0?s:-s:t>0?-s:s;if(e>0?i>0?e<=i||(s=-s,o=t,t=r,r=o,o=e,e=i,i=o):e<=-i?(s=-s,r=-r,i=-i):(o=t,t=-r,r=o,o=e,e=-i,i=o):i>0?-e<=i?(s=-s,t=-t,e=-e):(o=-t,t=r,r=o,o=-e,e=i,i=o):e>=i?(t=-t,e=-e,r=-r,i=-i):(s=-s,o=-t,t=-r,r=o,o=-e,e=-i,i=o),t>0)if(r>0){if(!(t<=r))return s}else return s;else{if(r>0)return-s;if(t>=r)s=-s,t=-t,r=-r;else return-s}for(;;){if(a=Math.floor(r/t),r=r-a*t,i=i-a*e,i<0)return-s;if(i>e)return s;if(t>r+r){if(e<i+i)return s}else{if(e>i+i)return-s;r=t-r,i=e-i,s=-s}if(i===0)return r===0?0:-s;if(r===0||(a=Math.floor(t/r),t=t-a*r,e=e-a*i,e<0))return s;if(e>i)return-s;if(r>t+t){if(i<e+e)return-s}else{if(i>e+e)return s;t=r-t,e=i-e,s=-s}if(e===0)return t===0?0:s;if(t===0)return-s}};var Nr=function(){this._p=null,this._crossingCount=0,this._isPointOnSegment=!1;var t=arguments[0];this._p=t};Nr.prototype.countSegment=function(t,e){if(t.x<this._p.x&&e.x<this._p.x)return null;if(this._p.x===e.x&&this._p.y===e.y)return this._isPointOnSegment=!0,null;if(t.y===this._p.y&&e.y===this._p.y){var r=t.x,i=e.x;return r>i&&(r=e.x,i=t.x),this._p.x>=r&&this._p.x<=i&&(this._isPointOnSegment=!0),null}if(t.y>this._p.y&&e.y<=this._p.y||e.y>this._p.y&&t.y<=this._p.y){var s=t.x-this._p.x,o=t.y-this._p.y,a=e.x-this._p.x,u=e.y-this._p.y,l=Ii.signOfDet2x2(s,o,a,u);if(l===0)return this._isPointOnSegment=!0,null;u<o&&(l=-l),l>0&&this._crossingCount++}};Nr.prototype.isPointInPolygon=function(){return this.getLocation()!==R.EXTERIOR};Nr.prototype.getLocation=function(){return this._isPointOnSegment?R.BOUNDARY:this._crossingCount%2===1?R.INTERIOR:R.EXTERIOR};Nr.prototype.isOnSegment=function(){return this._isPointOnSegment};Nr.prototype.interfaces_=function(){return[]};Nr.prototype.getClass=function(){return Nr};Nr.locatePointInRing=function(){if(arguments[0]instanceof P&&H(arguments[1],ut)){for(var t=arguments[0],e=arguments[1],r=new Nr(t),i=new P,s=new P,o=1;o<e.size();o++)if(e.getCoordinate(o,i),e.getCoordinate(o-1,s),r.countSegment(i,s),r.isOnSegment())return r.getLocation();return r.getLocation()}else if(arguments[0]instanceof P&&arguments[1]instanceof Array){for(var a=arguments[0],u=arguments[1],l=new Nr(a),c=1;c<u.length;c++){var h=u[c],f=u[c-1];if(l.countSegment(h,f),l.isOnSegment())return l.getLocation()}return l.getLocation()}};var G=function(){},Ui={CLOCKWISE:{configurable:!0},RIGHT:{configurable:!0},COUNTERCLOCKWISE:{configurable:!0},LEFT:{configurable:!0},COLLINEAR:{configurable:!0},STRAIGHT:{configurable:!0}};G.prototype.interfaces_=function(){return[]};G.prototype.getClass=function(){return G};G.orientationIndex=function(t,e,r){return Pe.orientationIndex(t,e,r)};G.signedArea=function(){if(arguments[0]instanceof Array){var t=arguments[0];if(t.length<3)return 0;for(var e=0,r=t[0].x,i=1;i<t.length-1;i++){var s=t[i].x-r,o=t[i+1].y,a=t[i-1].y;e+=s*(a-o)}return e/2}else if(H(arguments[0],ut)){var u=arguments[0],l=u.size();if(l<3)return 0;var c=new P,h=new P,f=new P;u.getCoordinate(0,h),u.getCoordinate(1,f);var p=h.x;f.x-=p;for(var d=0,_=1;_<l-1;_++)c.y=h.y,h.x=f.x,h.y=f.y,u.getCoordinate(_+1,f),f.x-=p,d+=h.x*(c.y-f.y);return d/2}};G.distanceLineLine=function(t,e,r,i){if(t.equals(e))return G.distancePointLine(t,r,i);if(r.equals(i))return G.distancePointLine(i,t,e);var s=!1;if(!W.intersects(t,e,r,i))s=!0;else{var o=(e.x-t.x)*(i.y-r.y)-(e.y-t.y)*(i.x-r.x);if(o===0)s=!0;else{var a=(t.y-r.y)*(i.x-r.x)-(t.x-r.x)*(i.y-r.y),u=(t.y-r.y)*(e.x-t.x)-(t.x-r.x)*(e.y-t.y),l=u/o,c=a/o;(c<0||c>1||l<0||l>1)&&(s=!0)}}return s?We.min(G.distancePointLine(t,r,i),G.distancePointLine(e,r,i),G.distancePointLine(r,t,e),G.distancePointLine(i,t,e)):0};G.isPointInRing=function(t,e){return G.locatePointInRing(t,e)!==R.EXTERIOR};G.computeLength=function(t){var e=t.size();if(e<=1)return 0;var r=0,i=new P;t.getCoordinate(0,i);for(var s=i.x,o=i.y,a=1;a<e;a++){t.getCoordinate(a,i);var u=i.x,l=i.y,c=u-s,h=l-o;r+=Math.sqrt(c*c+h*h),s=u,o=l}return r};G.isCCW=function(t){var e=t.length-1;if(e<3)throw new Rt("Ring has fewer than 4 points, so orientation cannot be determined");for(var r=t[0],i=0,s=1;s<=e;s++){var o=t[s];o.y>r.y&&(r=o,i=s)}var a=i;do a=a-1,a<0&&(a=e);while(t[a].equals2D(r)&&a!==i);var u=i;do u=(u+1)%e;while(t[u].equals2D(r)&&u!==i);var l=t[a],c=t[u];if(l.equals2D(r)||c.equals2D(r)||l.equals2D(c))return!1;var h=G.computeOrientation(l,r,c),f=!1;return h===0?f=l.x>c.x:f=h>0,f};G.locatePointInRing=function(t,e){return Nr.locatePointInRing(t,e)};G.distancePointLinePerpendicular=function(t,e,r){var i=(r.x-e.x)*(r.x-e.x)+(r.y-e.y)*(r.y-e.y),s=((e.y-t.y)*(r.x-e.x)-(e.x-t.x)*(r.y-e.y))/i;return Math.abs(s)*Math.sqrt(i)};G.computeOrientation=function(t,e,r){return G.orientationIndex(t,e,r)};G.distancePointLine=function(){if(arguments.length===2){var t=arguments[0],e=arguments[1];if(e.length===0)throw new Rt("Line array must contain at least one vertex");for(var r=t.distance(e[0]),i=0;i<e.length-1;i++){var s=G.distancePointLine(t,e[i],e[i+1]);s<r&&(r=s)}return r}else if(arguments.length===3){var o=arguments[0],a=arguments[1],u=arguments[2];if(a.x===u.x&&a.y===u.y)return o.distance(a);var l=(u.x-a.x)*(u.x-a.x)+(u.y-a.y)*(u.y-a.y),c=((o.x-a.x)*(u.x-a.x)+(o.y-a.y)*(u.y-a.y))/l;if(c<=0)return o.distance(a);if(c>=1)return o.distance(u);var h=((a.y-o.y)*(u.x-a.x)-(a.x-o.x)*(u.y-a.y))/l;return Math.abs(h)*Math.sqrt(l)}};G.isOnLine=function(t,e){for(var r=new yi,i=1;i<e.length;i++){var s=e[i-1],o=e[i];if(r.computeIntersection(t,s,o),r.hasIntersection())return!0}return!1};Ui.CLOCKWISE.get=function(){return-1};Ui.RIGHT.get=function(){return G.CLOCKWISE};Ui.COUNTERCLOCKWISE.get=function(){return 1};Ui.LEFT.get=function(){return G.COUNTERCLOCKWISE};Ui.COLLINEAR.get=function(){return 0};Ui.STRAIGHT.get=function(){return G.COLLINEAR};Object.defineProperties(G,Ui);var vn=function(){};vn.prototype.filter=function(t){};vn.prototype.interfaces_=function(){return[]};vn.prototype.getClass=function(){return vn};var Y=function(){var t=arguments[0];this._envelope=null,this._factory=null,this._SRID=null,this._userData=null,this._factory=t,this._SRID=t.getSRID()},un={serialVersionUID:{configurable:!0},SORTINDEX_POINT:{configurable:!0},SORTINDEX_MULTIPOINT:{configurable:!0},SORTINDEX_LINESTRING:{configurable:!0},SORTINDEX_LINEARRING:{configurable:!0},SORTINDEX_MULTILINESTRING:{configurable:!0},SORTINDEX_POLYGON:{configurable:!0},SORTINDEX_MULTIPOLYGON:{configurable:!0},SORTINDEX_GEOMETRYCOLLECTION:{configurable:!0},geometryChangedFilter:{configurable:!0}};Y.prototype.isGeometryCollection=function(){return this.getSortIndex()===Y.SORTINDEX_GEOMETRYCOLLECTION};Y.prototype.getFactory=function(){return this._factory};Y.prototype.getGeometryN=function(t){return this};Y.prototype.getArea=function(){return 0};Y.prototype.isRectangle=function(){return!1};Y.prototype.equals=function(){if(arguments[0]instanceof Y){var t=arguments[0];return t===null?!1:this.equalsTopo(t)}else if(arguments[0]instanceof Object){var e=arguments[0];if(!(e instanceof Y))return!1;var r=e;return this.equalsExact(r)}};Y.prototype.equalsExact=function(t){return this===t||this.equalsExact(t,0)};Y.prototype.geometryChanged=function(){this.apply(Y.geometryChangedFilter)};Y.prototype.geometryChangedAction=function(){this._envelope=null};Y.prototype.equalsNorm=function(t){return t===null?!1:this.norm().equalsExact(t.norm())};Y.prototype.getLength=function(){return 0};Y.prototype.getNumGeometries=function(){return 1};Y.prototype.compareTo=function(){if(arguments.length===1){var t=arguments[0],e=t;return this.getSortIndex()!==e.getSortIndex()?this.getSortIndex()-e.getSortIndex():this.isEmpty()&&e.isEmpty()?0:this.isEmpty()?-1:e.isEmpty()?1:this.compareToSameClass(t)}else if(arguments.length===2){var r=arguments[0],i=arguments[1];return this.getSortIndex()!==r.getSortIndex()?this.getSortIndex()-r.getSortIndex():this.isEmpty()&&r.isEmpty()?0:this.isEmpty()?-1:r.isEmpty()?1:this.compareToSameClass(r,i)}};Y.prototype.getUserData=function(){return this._userData};Y.prototype.getSRID=function(){return this._SRID};Y.prototype.getEnvelope=function(){return this.getFactory().toGeometry(this.getEnvelopeInternal())};Y.prototype.checkNotGeometryCollection=function(t){if(t.getSortIndex()===Y.SORTINDEX_GEOMETRYCOLLECTION)throw new Rt("This method does not support GeometryCollection arguments")};Y.prototype.equal=function(t,e,r){return r===0?t.equals(e):t.distance(e)<=r};Y.prototype.norm=function(){var t=this.copy();return t.normalize(),t};Y.prototype.getPrecisionModel=function(){return this._factory.getPrecisionModel()};Y.prototype.getEnvelopeInternal=function(){return this._envelope===null&&(this._envelope=this.computeEnvelopeInternal()),new W(this._envelope)};Y.prototype.setSRID=function(t){this._SRID=t};Y.prototype.setUserData=function(t){this._userData=t};Y.prototype.compare=function(t,e){for(var r=t.iterator(),i=e.iterator();r.hasNext()&&i.hasNext();){var s=r.next(),o=i.next(),a=s.compareTo(o);if(a!==0)return a}return r.hasNext()?1:i.hasNext()?-1:0};Y.prototype.hashCode=function(){return this.getEnvelopeInternal().hashCode()};Y.prototype.isGeometryCollectionOrDerived=function(){return this.getSortIndex()===Y.SORTINDEX_GEOMETRYCOLLECTION||this.getSortIndex()===Y.SORTINDEX_MULTIPOINT||this.getSortIndex()===Y.SORTINDEX_MULTILINESTRING||this.getSortIndex()===Y.SORTINDEX_MULTIPOLYGON};Y.prototype.interfaces_=function(){return[Ja,sr,or]};Y.prototype.getClass=function(){return Y};Y.hasNonEmptyElements=function(t){for(var e=0;e<t.length;e++)if(!t[e].isEmpty())return!0;return!1};Y.hasNullElements=function(t){for(var e=0;e<t.length;e++)if(t[e]===null)return!0;return!1};un.serialVersionUID.get=function(){return 8763622679187377e3};un.SORTINDEX_POINT.get=function(){return 0};un.SORTINDEX_MULTIPOINT.get=function(){return 1};un.SORTINDEX_LINESTRING.get=function(){return 2};un.SORTINDEX_LINEARRING.get=function(){return 3};un.SORTINDEX_MULTILINESTRING.get=function(){return 4};un.SORTINDEX_POLYGON.get=function(){return 5};un.SORTINDEX_MULTIPOLYGON.get=function(){return 6};un.SORTINDEX_GEOMETRYCOLLECTION.get=function(){return 7};un.geometryChangedFilter.get=function(){return gl};Object.defineProperties(Y,un);var gl=function(){};gl.interfaces_=function(){return[vn]};gl.filter=function(t){t.geometryChangedAction()};var Jr=function(){};Jr.prototype.filter=function(t){};Jr.prototype.interfaces_=function(){return[]};Jr.prototype.getClass=function(){return Jr};var rr=function(){},Cn={Mod2BoundaryNodeRule:{configurable:!0},EndPointBoundaryNodeRule:{configurable:!0},MultiValentEndPointBoundaryNodeRule:{configurable:!0},MonoValentEndPointBoundaryNodeRule:{configurable:!0},MOD2_BOUNDARY_RULE:{configurable:!0},ENDPOINT_BOUNDARY_RULE:{configurable:!0},MULTIVALENT_ENDPOINT_BOUNDARY_RULE:{configurable:!0},MONOVALENT_ENDPOINT_BOUNDARY_RULE:{configurable:!0},OGC_SFS_BOUNDARY_RULE:{configurable:!0}};rr.prototype.isInBoundary=function(t){};rr.prototype.interfaces_=function(){return[]};rr.prototype.getClass=function(){return rr};Cn.Mod2BoundaryNodeRule.get=function(){return ns};Cn.EndPointBoundaryNodeRule.get=function(){return is};Cn.MultiValentEndPointBoundaryNodeRule.get=function(){return ss};Cn.MonoValentEndPointBoundaryNodeRule.get=function(){return os};Cn.MOD2_BOUNDARY_RULE.get=function(){return new ns};Cn.ENDPOINT_BOUNDARY_RULE.get=function(){return new is};Cn.MULTIVALENT_ENDPOINT_BOUNDARY_RULE.get=function(){return new ss};Cn.MONOVALENT_ENDPOINT_BOUNDARY_RULE.get=function(){return new os};Cn.OGC_SFS_BOUNDARY_RULE.get=function(){return rr.MOD2_BOUNDARY_RULE};Object.defineProperties(rr,Cn);var ns=function(){};ns.prototype.isInBoundary=function(t){return t%2===1};ns.prototype.interfaces_=function(){return[rr]};ns.prototype.getClass=function(){return ns};var is=function(){};is.prototype.isInBoundary=function(t){return t>0};is.prototype.interfaces_=function(){return[rr]};is.prototype.getClass=function(){return is};var ss=function(){};ss.prototype.isInBoundary=function(t){return t>1};ss.prototype.interfaces_=function(){return[rr]};ss.prototype.getClass=function(){return ss};var os=function(){};os.prototype.isInBoundary=function(t){return t===1};os.prototype.interfaces_=function(){return[rr]};os.prototype.getClass=function(){return os};var Xt=function(){};Xt.prototype.add=function(){};Xt.prototype.addAll=function(){};Xt.prototype.isEmpty=function(){};Xt.prototype.iterator=function(){};Xt.prototype.size=function(){};Xt.prototype.toArray=function(){};Xt.prototype.remove=function(){};function dl(n){this.message=n||""}dl.prototype=new Error;dl.prototype.name="IndexOutOfBoundsException";var Ps=function(){};Ps.prototype.hasNext=function(){};Ps.prototype.next=function(){};Ps.prototype.remove=function(){};var lr=function(n){function t(){n.apply(this,arguments)}return n&&(t.__proto__=n),t.prototype=Object.create(n&&n.prototype),t.prototype.constructor=t,t.prototype.get=function(){},t.prototype.set=function(){},t.prototype.isEmpty=function(){},t}(Xt);function Rs(n){this.message=n||""}Rs.prototype=new Error;Rs.prototype.name="NoSuchElementException";var k=function(n){function t(){n.call(this),this.array_=[],arguments[0]instanceof Xt&&this.addAll(arguments[0])}return n&&(t.__proto__=n),t.prototype=Object.create(n&&n.prototype),t.prototype.constructor=t,t.prototype.ensureCapacity=function(){},t.prototype.interfaces_=function(){return[n,Xt]},t.prototype.add=function(r){return arguments.length===1?this.array_.push(r):this.array_.splice(arguments[0],arguments[1]),!0},t.prototype.clear=function(){this.array_=[]},t.prototype.addAll=function(r){for(var i=this,s=r.iterator();s.hasNext();)i.add(s.next());return!0},t.prototype.set=function(r,i){var s=this.array_[r];return this.array_[r]=i,s},t.prototype.iterator=function(){return new rg(this)},t.prototype.get=function(r){if(r<0||r>=this.size())throw new dl;return this.array_[r]},t.prototype.isEmpty=function(){return this.array_.length===0},t.prototype.size=function(){return this.array_.length},t.prototype.toArray=function(){for(var r=this,i=[],s=0,o=this.array_.length;s<o;s++)i.push(r.array_[s]);return i},t.prototype.remove=function(r){for(var i=this,s=!1,o=0,a=this.array_.length;o<a;o++)if(i.array_[o]===r){i.array_.splice(o,1),s=!0;break}return s},t}(lr),rg=function(n){function t(e){n.call(this),this.arrayList_=e,this.position_=0}return n&&(t.__proto__=n),t.prototype=Object.create(n&&n.prototype),t.prototype.constructor=t,t.prototype.next=function(){if(this.position_===this.arrayList_.size())throw new Rs;return this.arrayList_.get(this.position_++)},t.prototype.hasNext=function(){return this.position_<this.arrayList_.size()},t.prototype.set=function(r){return this.arrayList_.set(this.position_-1,r)},t.prototype.remove=function(){this.arrayList_.remove(this.arrayList_.get(this.position_))},t}(Ps),Ro=function(n){function t(){if(n.call(this),arguments.length!==0){if(arguments.length===1){var r=arguments[0];this.ensureCapacity(r.length),this.add(r,!0)}else if(arguments.length===2){var i=arguments[0],s=arguments[1];this.ensureCapacity(i.length),this.add(i,s)}}}n&&(t.__proto__=n),t.prototype=Object.create(n&&n.prototype),t.prototype.constructor=t;var e={coordArrayType:{configurable:!0}};return e.coordArrayType.get=function(){return new Array(0).fill(null)},t.prototype.getCoordinate=function(i){return this.get(i)},t.prototype.addAll=function(){var i=this;if(arguments.length===2){for(var s=arguments[0],o=arguments[1],a=!1,u=s.iterator();u.hasNext();)i.add(u.next(),o),a=!0;return a}else return n.prototype.addAll.apply(this,arguments)},t.prototype.clone=function(){for(var i=this,s=n.prototype.clone.call(this),o=0;o<this.size();o++)s.add(o,i.get(o).copy());return s},t.prototype.toCoordinateArray=function(){return this.toArray(t.coordArrayType)},t.prototype.add=function(){var i=this;if(arguments.length===1){var s=arguments[0];n.prototype.add.call(this,s)}else if(arguments.length===2){if(arguments[0]instanceof Array&&typeof arguments[1]=="boolean"){var o=arguments[0],a=arguments[1];return this.add(o,a,!0),!0}else if(arguments[0]instanceof P&&typeof arguments[1]=="boolean"){var u=arguments[0],l=arguments[1];if(!l&&this.size()>=1){var c=this.get(this.size()-1);if(c.equals2D(u))return null}n.prototype.add.call(this,u)}else if(arguments[0]instanceof Object&&typeof arguments[1]=="boolean"){var h=arguments[0],f=arguments[1];return this.add(h,f),!0}}else if(arguments.length===3){if(typeof arguments[2]=="boolean"&&arguments[0]instanceof Array&&typeof arguments[1]=="boolean"){var p=arguments[0],d=arguments[1],_=arguments[2];if(_)for(var w=0;w<p.length;w++)i.add(p[w],d);else for(var y=p.length-1;y>=0;y--)i.add(p[y],d);return!0}else if(typeof arguments[2]=="boolean"&&Number.isInteger(arguments[0])&&arguments[1]instanceof P){var x=arguments[0],g=arguments[1],m=arguments[2];if(!m){var E=this.size();if(E>0){if(x>0){var N=this.get(x-1);if(N.equals2D(g))return null}if(x<E){var b=this.get(x);if(b.equals2D(g))return null}}}n.prototype.add.call(this,x,g)}}else if(arguments.length===4){var S=arguments[0],v=arguments[1],I=arguments[2],T=arguments[3],A=1;I>T&&(A=-1);for(var K=I;K!==T;K+=A)i.add(S[K],v);return!0}},t.prototype.closeRing=function(){this.size()>0&&this.add(new P(this.get(0)),!1)},t.prototype.interfaces_=function(){return[]},t.prototype.getClass=function(){return t},Object.defineProperties(t,e),t}(k),it=function(){},$a={ForwardComparator:{configurable:!0},BidirectionalComparator:{configurable:!0},coordArrayType:{configurable:!0}};$a.ForwardComparator.get=function(){return Qs};$a.BidirectionalComparator.get=function(){return as};$a.coordArrayType.get=function(){return new Array(0).fill(null)};it.prototype.interfaces_=function(){return[]};it.prototype.getClass=function(){return it};it.isRing=function(t){return!(t.length<4||!t[0].equals2D(t[t.length-1]))};it.ptNotInList=function(t,e){for(var r=0;r<t.length;r++){var i=t[r];if(it.indexOf(i,e)<0)return i}return null};it.scroll=function(t,e){var r=it.indexOf(e,t);if(r<0)return null;var i=new Array(t.length).fill(null);le.arraycopy(t,r,i,0,t.length-r),le.arraycopy(t,0,i,t.length-r,r),le.arraycopy(i,0,t,0,t.length)};it.equals=function(){if(arguments.length===2){var t=arguments[0],e=arguments[1];if(t===e)return!0;if(t===null||e===null||t.length!==e.length)return!1;for(var r=0;r<t.length;r++)if(!t[r].equals(e[r]))return!1;return!0}else if(arguments.length===3){var i=arguments[0],s=arguments[1],o=arguments[2];if(i===s)return!0;if(i===null||s===null||i.length!==s.length)return!1;for(var a=0;a<i.length;a++)if(o.compare(i[a],s[a])!==0)return!1;return!0}};it.intersection=function(t,e){for(var r=new Ro,i=0;i<t.length;i++)e.intersects(t[i])&&r.add(t[i],!0);return r.toCoordinateArray()};it.hasRepeatedPoints=function(t){for(var e=1;e<t.length;e++)if(t[e-1].equals(t[e]))return!0;return!1};it.removeRepeatedPoints=function(t){if(!it.hasRepeatedPoints(t))return t;var e=new Ro(t,!1);return e.toCoordinateArray()};it.reverse=function(t){for(var e=t.length-1,r=Math.trunc(e/2),i=0;i<=r;i++){var s=t[i];t[i]=t[e-i],t[e-i]=s}};it.removeNull=function(t){for(var e=0,r=0;r<t.length;r++)t[r]!==null&&e++;var i=new Array(e).fill(null);if(e===0)return i;for(var s=0,o=0;o<t.length;o++)t[o]!==null&&(i[s++]=t[o]);return i};it.copyDeep=function(){if(arguments.length===1){for(var t=arguments[0],e=new Array(t.length).fill(null),r=0;r<t.length;r++)e[r]=new P(t[r]);return e}else if(arguments.length===5)for(var i=arguments[0],s=arguments[1],o=arguments[2],a=arguments[3],u=arguments[4],l=0;l<u;l++)o[a+l]=new P(i[s+l])};it.isEqualReversed=function(t,e){for(var r=0;r<t.length;r++){var i=t[r],s=e[t.length-r-1];if(i.compareTo(s)!==0)return!1}return!0};it.envelope=function(t){for(var e=new W,r=0;r<t.length;r++)e.expandToInclude(t[r]);return e};it.toCoordinateArray=function(t){return t.toArray(it.coordArrayType)};it.atLeastNCoordinatesOrNothing=function(t,e){return e.length>=t?e:[]};it.indexOf=function(t,e){for(var r=0;r<e.length;r++)if(t.equals(e[r]))return r;return-1};it.increasingDirection=function(t){for(var e=0;e<Math.trunc(t.length/2);e++){var r=t.length-1-e,i=t[e].compareTo(t[r]);if(i!==0)return i}return 1};it.compare=function(t,e){for(var r=0;r<t.length&&r<e.length;){var i=t[r].compareTo(e[r]);if(i!==0)return i;r++}return r<e.length?-1:r<t.length?1:0};it.minCoordinate=function(t){for(var e=null,r=0;r<t.length;r++)(e===null||e.compareTo(t[r])>0)&&(e=t[r]);return e};it.extract=function(t,e,r){e=We.clamp(e,0,t.length),r=We.clamp(r,-1,t.length);var i=r-e+1;r<0&&(i=0),e>=t.length&&(i=0),r<e&&(i=0);var s=new Array(i).fill(null);if(i===0)return s;for(var o=0,a=e;a<=r;a++)s[o++]=t[a];return s};Object.defineProperties(it,$a);var Qs=function(){};Qs.prototype.compare=function(t,e){var r=t,i=e;return it.compare(r,i)};Qs.prototype.interfaces_=function(){return[es]};Qs.prototype.getClass=function(){return Qs};var as=function(){};as.prototype.compare=function(t,e){var r=t,i=e;if(r.length<i.length)return-1;if(r.length>i.length)return 1;if(r.length===0)return 0;var s=it.compare(r,i),o=it.isEqualReversed(r,i);return o?0:s};as.prototype.OLDcompare=function(t,e){var r=t,i=e;if(r.length<i.length)return-1;if(r.length>i.length)return 1;if(r.length===0)return 0;for(var s=it.increasingDirection(r),o=it.increasingDirection(i),a=s>0?0:r.length-1,u=o>0?0:r.length-1,l=0;l<r.length;l++){var c=r[a].compareTo(i[u]);if(c!==0)return c;a+=s,u+=o}return 0};as.prototype.interfaces_=function(){return[es]};as.prototype.getClass=function(){return as};var ji=function(){};ji.prototype.get=function(){};ji.prototype.put=function(){};ji.prototype.size=function(){};ji.prototype.values=function(){};ji.prototype.entrySet=function(){};var ng=function(n){function t(){n.apply(this,arguments)}return n&&(t.__proto__=n),t.prototype=Object.create(n&&n.prototype),t.prototype.constructor=t,t}(ji);function Lo(n){this.message=n||""}Lo.prototype=new Error;Lo.prototype.name="OperationNotSupported";function tu(){}tu.prototype=new Xt;tu.prototype.contains=function(){};var ml=function(n){function t(){n.call(this),this.array_=[],arguments[0]instanceof Xt&&this.addAll(arguments[0])}return n&&(t.__proto__=n),t.prototype=Object.create(n&&n.prototype),t.prototype.constructor=t,t.prototype.contains=function(r){for(var i=this,s=0,o=this.array_.length;s<o;s++){var a=i.array_[s];if(a===r)return!0}return!1},t.prototype.add=function(r){return this.contains(r)?!1:(this.array_.push(r),!0)},t.prototype.addAll=function(r){for(var i=this,s=r.iterator();s.hasNext();)i.add(s.next());return!0},t.prototype.remove=function(r){throw new Error},t.prototype.size=function(){return this.array_.length},t.prototype.isEmpty=function(){return this.array_.length===0},t.prototype.toArray=function(){for(var r=this,i=[],s=0,o=this.array_.length;s<o;s++)i.push(r.array_[s]);return i},t.prototype.iterator=function(){return new ig(this)},t}(tu),ig=function(n){function t(e){n.call(this),this.hashSet_=e,this.position_=0}return n&&(t.__proto__=n),t.prototype=Object.create(n&&n.prototype),t.prototype.constructor=t,t.prototype.next=function(){if(this.position_===this.hashSet_.size())throw new Rs;return this.hashSet_.array_[this.position_++]},t.prototype.hasNext=function(){return this.position_<this.hashSet_.size()},t.prototype.remove=function(){throw new Lo},t}(Ps),fn=0,Jn=1;function ic(n){return n===null?fn:n.color}function It(n){return n===null?null:n.parent}function ln(n,t){n!==null&&(n.color=t)}function Nu(n){return n===null?null:n.left}function sc(n){return n===null?null:n.right}function me(){this.root_=null,this.size_=0}me.prototype=new ng;me.prototype.get=function(n){for(var t=this.root_;t!==null;){var e=n.compareTo(t.key);if(e<0)t=t.left;else if(e>0)t=t.right;else return t.value}return null};me.prototype.put=function(n,t){if(this.root_===null)return this.root_={key:n,value:t,left:null,right:null,parent:null,color:fn,getValue:function(){return this.value},getKey:function(){return this.key}},this.size_=1,null;var e=this.root_,r,i;do if(r=e,i=n.compareTo(e.key),i<0)e=e.left;else if(i>0)e=e.right;else{var s=e.value;return e.value=t,s}while(e!==null);var o={key:n,left:null,right:null,value:t,parent:r,color:fn,getValue:function(){return this.value},getKey:function(){return this.key}};return i<0?r.left=o:r.right=o,this.fixAfterInsertion(o),this.size_++,null};me.prototype.fixAfterInsertion=function(n){var t=this;for(n.color=Jn;n!=null&&n!==this.root_&&n.parent.color===Jn;)if(It(n)===Nu(It(It(n)))){var e=sc(It(It(n)));ic(e)===Jn?(ln(It(n),fn),ln(e,fn),ln(It(It(n)),Jn),n=It(It(n))):(n===sc(It(n))&&(n=It(n),t.rotateLeft(n)),ln(It(n),fn),ln(It(It(n)),Jn),t.rotateRight(It(It(n))))}else{var r=Nu(It(It(n)));ic(r)===Jn?(ln(It(n),fn),ln(r,fn),ln(It(It(n)),Jn),n=It(It(n))):(n===Nu(It(n))&&(n=It(n),t.rotateRight(n)),ln(It(n),fn),ln(It(It(n)),Jn),t.rotateLeft(It(It(n))))}this.root_.color=fn};me.prototype.values=function(){var n=new k,t=this.getFirstEntry();if(t!==null)for(n.add(t.value);(t=me.successor(t))!==null;)n.add(t.value);return n};me.prototype.entrySet=function(){var n=new ml,t=this.getFirstEntry();if(t!==null)for(n.add(t);(t=me.successor(t))!==null;)n.add(t);return n};me.prototype.rotateLeft=function(n){if(n!=null){var t=n.right;n.right=t.left,t.left!=null&&(t.left.parent=n),t.parent=n.parent,n.parent===null?this.root_=t:n.parent.left===n?n.parent.left=t:n.parent.right=t,t.left=n,n.parent=t}};me.prototype.rotateRight=function(n){if(n!=null){var t=n.left;n.left=t.right,t.right!=null&&(t.right.parent=n),t.parent=n.parent,n.parent===null?this.root_=t:n.parent.right===n?n.parent.right=t:n.parent.left=t,t.right=n,n.parent=t}};me.prototype.getFirstEntry=function(){var n=this.root_;if(n!=null)for(;n.left!=null;)n=n.left;return n};me.successor=function(n){if(n===null)return null;if(n.right!==null){for(var t=n.right;t.left!==null;)t=t.left;return t}else{for(var e=n.parent,r=n;e!==null&&r===e.right;)r=e,e=e.parent;return e}};me.prototype.size=function(){return this.size_};var $s=function(){};$s.prototype.interfaces_=function(){return[]};$s.prototype.getClass=function(){return $s};function vh(){}vh.prototype=new tu;function Rr(){this.array_=[],arguments[0]instanceof Xt&&this.addAll(arguments[0])}Rr.prototype=new vh;Rr.prototype.contains=function(n){for(var t=this,e=0,r=this.array_.length;e<r;e++){var i=t.array_[e];if(i.compareTo(n)===0)return!0}return!1};Rr.prototype.add=function(n){var t=this;if(this.contains(n))return!1;for(var e=0,r=this.array_.length;e<r;e++){var i=t.array_[e];if(i.compareTo(n)===1)return t.array_.splice(e,0,n),!0}return this.array_.push(n),!0};Rr.prototype.addAll=function(n){for(var t=this,e=n.iterator();e.hasNext();)t.add(e.next());return!0};Rr.prototype.remove=function(n){throw new Lo};Rr.prototype.size=function(){return this.array_.length};Rr.prototype.isEmpty=function(){return this.array_.length===0};Rr.prototype.toArray=function(){for(var n=this,t=[],e=0,r=this.array_.length;e<r;e++)t.push(n.array_[e]);return t};Rr.prototype.iterator=function(){return new eu(this)};var eu=function(n){this.treeSet_=n,this.position_=0};eu.prototype.next=function(){if(this.position_===this.treeSet_.size())throw new Rs;return this.treeSet_.array_[this.position_++]};eu.prototype.hasNext=function(){return this.position_<this.treeSet_.size()};eu.prototype.remove=function(){throw new Lo};var ei=function(){};ei.sort=function(){var t=arguments[0],e,r,i,s;if(arguments.length===1)s=function(a,u){return a.compareTo(u)},t.sort(s);else if(arguments.length===2)i=arguments[1],s=function(a,u){return i.compare(a,u)},t.sort(s);else if(arguments.length===3){r=t.slice(arguments[1],arguments[2]),r.sort();var o=t.slice(0,arguments[1]).concat(r,t.slice(arguments[2],t.length));for(t.splice(0,t.length),e=0;e<o.length;e++)t.push(o[e])}else if(arguments.length===4)for(r=t.slice(arguments[1],arguments[2]),i=arguments[3],s=function(a,u){return i.compare(a,u)},r.sort(s),o=t.slice(0,arguments[1]).concat(r,t.slice(arguments[2],t.length)),t.splice(0,t.length),e=0;e<o.length;e++)t.push(o[e])};ei.asList=function(t){for(var e=new k,r=0,i=t.length;r<i;r++)e.add(t[r]);return e};var ht=function(){},wr={P:{configurable:!0},L:{configurable:!0},A:{configurable:!0},FALSE:{configurable:!0},TRUE:{configurable:!0},DONTCARE:{configurable:!0},SYM_FALSE:{configurable:!0},SYM_TRUE:{configurable:!0},SYM_DONTCARE:{configurable:!0},SYM_P:{configurable:!0},SYM_L:{configurable:!0},SYM_A:{configurable:!0}};wr.P.get=function(){return 0};wr.L.get=function(){return 1};wr.A.get=function(){return 2};wr.FALSE.get=function(){return-1};wr.TRUE.get=function(){return-2};wr.DONTCARE.get=function(){return-3};wr.SYM_FALSE.get=function(){return"F"};wr.SYM_TRUE.get=function(){return"T"};wr.SYM_DONTCARE.get=function(){return"*"};wr.SYM_P.get=function(){return"0"};wr.SYM_L.get=function(){return"1"};wr.SYM_A.get=function(){return"2"};ht.prototype.interfaces_=function(){return[]};ht.prototype.getClass=function(){return ht};ht.toDimensionSymbol=function(t){switch(t){case ht.FALSE:return ht.SYM_FALSE;case ht.TRUE:return ht.SYM_TRUE;case ht.DONTCARE:return ht.SYM_DONTCARE;case ht.P:return ht.SYM_P;case ht.L:return ht.SYM_L;case ht.A:return ht.SYM_A}throw new Rt("Unknown dimension value: "+t)};ht.toDimensionValue=function(t){switch(Js.toUpperCase(t)){case ht.SYM_FALSE:return ht.FALSE;case ht.SYM_TRUE:return ht.TRUE;case ht.SYM_DONTCARE:return ht.DONTCARE;case ht.SYM_P:return ht.P;case ht.SYM_L:return ht.L;case ht.SYM_A:return ht.A}throw new Rt("Unknown dimension symbol: "+t)};Object.defineProperties(ht,wr);var Lr=function(){};Lr.prototype.filter=function(t){};Lr.prototype.interfaces_=function(){return[]};Lr.prototype.getClass=function(){return Lr};var fr=function(){};fr.prototype.filter=function(t,e){};fr.prototype.isDone=function(){};fr.prototype.isGeometryChanged=function(){};fr.prototype.interfaces_=function(){return[]};fr.prototype.getClass=function(){return fr};var Se=function(n){function t(r,i){if(n.call(this,i),this._geometries=r||[],n.hasNullElements(this._geometries))throw new Rt("geometries must not contain null elements")}n&&(t.__proto__=n),t.prototype=Object.create(n&&n.prototype),t.prototype.constructor=t;var e={serialVersionUID:{configurable:!0}};return t.prototype.computeEnvelopeInternal=function(){for(var i=this,s=new W,o=0;o<this._geometries.length;o++)s.expandToInclude(i._geometries[o].getEnvelopeInternal());return s},t.prototype.getGeometryN=function(i){return this._geometries[i]},t.prototype.getSortIndex=function(){return n.SORTINDEX_GEOMETRYCOLLECTION},t.prototype.getCoordinates=function(){for(var i=this,s=new Array(this.getNumPoints()).fill(null),o=-1,a=0;a<this._geometries.length;a++)for(var u=i._geometries[a].getCoordinates(),l=0;l<u.length;l++)o++,s[o]=u[l];return s},t.prototype.getArea=function(){for(var i=this,s=0,o=0;o<this._geometries.length;o++)s+=i._geometries[o].getArea();return s},t.prototype.equalsExact=function(){var i=this;if(arguments.length===2){var s=arguments[0],o=arguments[1];if(!this.isEquivalentClass(s))return!1;var a=s;if(this._geometries.length!==a._geometries.length)return!1;for(var u=0;u<this._geometries.length;u++)if(!i._geometries[u].equalsExact(a._geometries[u],o))return!1;return!0}else return n.prototype.equalsExact.apply(this,arguments)},t.prototype.normalize=function(){for(var i=this,s=0;s<this._geometries.length;s++)i._geometries[s].normalize();ei.sort(this._geometries)},t.prototype.getCoordinate=function(){return this.isEmpty()?null:this._geometries[0].getCoordinate()},t.prototype.getBoundaryDimension=function(){for(var i=this,s=ht.FALSE,o=0;o<this._geometries.length;o++)s=Math.max(s,i._geometries[o].getBoundaryDimension());return s},t.prototype.getDimension=function(){for(var i=this,s=ht.FALSE,o=0;o<this._geometries.length;o++)s=Math.max(s,i._geometries[o].getDimension());return s},t.prototype.getLength=function(){for(var i=this,s=0,o=0;o<this._geometries.length;o++)s+=i._geometries[o].getLength();return s},t.prototype.getNumPoints=function(){for(var i=this,s=0,o=0;o<this._geometries.length;o++)s+=i._geometries[o].getNumPoints();return s},t.prototype.getNumGeometries=function(){return this._geometries.length},t.prototype.reverse=function(){for(var i=this,s=this._geometries.length,o=new Array(s).fill(null),a=0;a<this._geometries.length;a++)o[a]=i._geometries[a].reverse();return this.getFactory().createGeometryCollection(o)},t.prototype.compareToSameClass=function(){var i=this;if(arguments.length===1){var s=arguments[0],o=new Rr(ei.asList(this._geometries)),a=new Rr(ei.asList(s._geometries));return this.compare(o,a)}else if(arguments.length===2){for(var u=arguments[0],l=arguments[1],c=u,h=this.getNumGeometries(),f=c.getNumGeometries(),p=0;p<h&&p<f;){var d=i.getGeometryN(p),_=c.getGeometryN(p),w=d.compareToSameClass(_,l);if(w!==0)return w;p++}return p<h?1:p<f?-1:0}},t.prototype.apply=function(){var i=this;if(H(arguments[0],Jr))for(var s=arguments[0],o=0;o<this._geometries.length;o++)i._geometries[o].apply(s);else if(H(arguments[0],fr)){var a=arguments[0];if(this._geometries.length===0)return null;for(var u=0;u<this._geometries.length&&(i._geometries[u].apply(a),!a.isDone());u++);a.isGeometryChanged()&&this.geometryChanged()}else if(H(arguments[0],Lr)){var l=arguments[0];l.filter(this);for(var c=0;c<this._geometries.length;c++)i._geometries[c].apply(l)}else if(H(arguments[0],vn)){var h=arguments[0];h.filter(this);for(var f=0;f<this._geometries.length;f++)i._geometries[f].apply(h)}},t.prototype.getBoundary=function(){return this.checkNotGeometryCollection(this),et.shouldNeverReachHere(),null},t.prototype.clone=function(){var i=this,s=n.prototype.clone.call(this);s._geometries=new Array(this._geometries.length).fill(null);for(var o=0;o<this._geometries.length;o++)s._geometries[o]=i._geometries[o].clone();return s},t.prototype.getGeometryType=function(){return"GeometryCollection"},t.prototype.copy=function(){for(var i=this,s=new Array(this._geometries.length).fill(null),o=0;o<s.length;o++)s[o]=i._geometries[o].copy();return new t(s,this._factory)},t.prototype.isEmpty=function(){for(var i=this,s=0;s<this._geometries.length;s++)if(!i._geometries[s].isEmpty())return!1;return!0},t.prototype.interfaces_=function(){return[]},t.prototype.getClass=function(){return t},e.serialVersionUID.get=function(){return-5694727726395021e3},Object.defineProperties(t,e),t}(Y),ni=function(n){function t(){n.apply(this,arguments)}n&&(t.__proto__=n),t.prototype=Object.create(n&&n.prototype),t.prototype.constructor=t;var e={serialVersionUID:{configurable:!0}};return t.prototype.getSortIndex=function(){return Y.SORTINDEX_MULTILINESTRING},t.prototype.equalsExact=function(){if(arguments.length===2){var i=arguments[0],s=arguments[1];return this.isEquivalentClass(i)?n.prototype.equalsExact.call(this,i,s):!1}else return n.prototype.equalsExact.apply(this,arguments)},t.prototype.getBoundaryDimension=function(){return this.isClosed()?ht.FALSE:0},t.prototype.isClosed=function(){var i=this;if(this.isEmpty())return!1;for(var s=0;s<this._geometries.length;s++)if(!i._geometries[s].isClosed())return!1;return!0},t.prototype.getDimension=function(){return 1},t.prototype.reverse=function(){for(var i=this,s=this._geometries.length,o=new Array(s).fill(null),a=0;a<this._geometries.length;a++)o[s-1-a]=i._geometries[a].reverse();return this.getFactory().createMultiLineString(o)},t.prototype.getBoundary=function(){return new $e(this).getBoundary()},t.prototype.getGeometryType=function(){return"MultiLineString"},t.prototype.copy=function(){for(var i=this,s=new Array(this._geometries.length).fill(null),o=0;o<s.length;o++)s[o]=i._geometries[o].copy();return new t(s,this._factory)},t.prototype.interfaces_=function(){return[$s]},t.prototype.getClass=function(){return t},e.serialVersionUID.get=function(){return 8166665132445434e3},Object.defineProperties(t,e),t}(Se),$e=function(){if(this._geom=null,this._geomFact=null,this._bnRule=null,this._endpointMap=null,arguments.length===1){var t=arguments[0],e=rr.MOD2_BOUNDARY_RULE;this._geom=t,this._geomFact=t.getFactory(),this._bnRule=e}else if(arguments.length===2){var r=arguments[0],i=arguments[1];this._geom=r,this._geomFact=r.getFactory(),this._bnRule=i}};$e.prototype.boundaryMultiLineString=function(t){if(this._geom.isEmpty())return this.getEmptyMultiPoint();var e=this.computeBoundaryCoordinates(t);return e.length===1?this._geomFact.createPoint(e[0]):this._geomFact.createMultiPointFromCoords(e)};$e.prototype.getBoundary=function(){return this._geom instanceof Dt?this.boundaryLineString(this._geom):this._geom instanceof ni?this.boundaryMultiLineString(this._geom):this._geom.getBoundary()};$e.prototype.boundaryLineString=function(t){if(this._geom.isEmpty())return this.getEmptyMultiPoint();if(t.isClosed()){var e=this._bnRule.isInBoundary(2);return e?t.getStartPoint():this._geomFact.createMultiPoint()}return this._geomFact.createMultiPoint([t.getStartPoint(),t.getEndPoint()])};$e.prototype.getEmptyMultiPoint=function(){return this._geomFact.createMultiPoint()};$e.prototype.computeBoundaryCoordinates=function(t){var e=this,r=new k;this._endpointMap=new me;for(var i=0;i<t.getNumGeometries();i++){var s=t.getGeometryN(i);s.getNumPoints()!==0&&(e.addEndpoint(s.getCoordinateN(0)),e.addEndpoint(s.getCoordinateN(s.getNumPoints()-1)))}for(var o=this._endpointMap.entrySet().iterator();o.hasNext();){var a=o.next(),u=a.getValue(),l=u.count;e._bnRule.isInBoundary(l)&&r.add(a.getKey())}return it.toCoordinateArray(r)};$e.prototype.addEndpoint=function(t){var e=this._endpointMap.get(t);e===null&&(e=new wa,this._endpointMap.put(t,e)),e.count++};$e.prototype.interfaces_=function(){return[]};$e.prototype.getClass=function(){return $e};$e.getBoundary=function(){if(arguments.length===1){var t=arguments[0],e=new $e(t);return e.getBoundary()}else if(arguments.length===2){var r=arguments[0],i=arguments[1],s=new $e(r,i);return s.getBoundary()}};var wa=function(){this.count=null};wa.prototype.interfaces_=function(){return[]};wa.prototype.getClass=function(){return wa};function sg(){}function og(){}var ag=function(){};function ug(){}function lg(){}function cg(){}var tr=function(){},vl={NEWLINE:{configurable:!0},SIMPLE_ORDINATE_FORMAT:{configurable:!0}};tr.prototype.interfaces_=function(){return[]};tr.prototype.getClass=function(){return tr};tr.chars=function(t,e){for(var r=new Array(e).fill(null),i=0;i<e;i++)r[i]=t;return String(r)};tr.getStackTrace=function(){if(arguments.length===1){var t=arguments[0],e=new ug,r=new sg;return t.printStackTrace(r),e.toString()}else if(arguments.length===2){var i=arguments[0],s=arguments[1],o="";new og(tr.getStackTrace(i));for(var a=new cg,u=0;u<s;u++)try{o+=a.readLine()+tr.NEWLINE}catch(l){if(l instanceof lg)et.shouldNeverReachHere();else throw l}finally{}return o}};tr.split=function(t,e){for(var r=e.length,i=new k,s=""+t,o=s.indexOf(e);o>=0;){var a=s.substring(0,o);i.add(a),s=s.substring(o+r),o=s.indexOf(e)}s.length>0&&i.add(s);for(var u=new Array(i.size()).fill(null),l=0;l<u.length;l++)u[l]=i.get(l);return u};tr.toString=function(){if(arguments.length===1){var t=arguments[0];return tr.SIMPLE_ORDINATE_FORMAT.format(t)}};tr.spaces=function(t){return tr.chars(" ",t)};vl.NEWLINE.get=function(){return le.getProperty("line.separator")};vl.SIMPLE_ORDINATE_FORMAT.get=function(){return new ag};Object.defineProperties(tr,vl);var zt=function(){};zt.prototype.interfaces_=function(){return[]};zt.prototype.getClass=function(){return zt};zt.copyCoord=function(t,e,r,i){for(var s=Math.min(t.getDimension(),r.getDimension()),o=0;o<s;o++)r.setOrdinate(i,o,t.getOrdinate(e,o))};zt.isRing=function(t){var e=t.size();return e===0?!0:e<=3?!1:t.getOrdinate(0,ut.X)===t.getOrdinate(e-1,ut.X)&&t.getOrdinate(0,ut.Y)===t.getOrdinate(e-1,ut.Y)};zt.isEqual=function(t,e){var r=t.size(),i=e.size();if(r!==i)return!1;for(var s=Math.min(t.getDimension(),e.getDimension()),o=0;o<r;o++)for(var a=0;a<s;a++){var u=t.getOrdinate(o,a),l=e.getOrdinate(o,a);if(t.getOrdinate(o,a)!==e.getOrdinate(o,a)&&!(J.isNaN(u)&&J.isNaN(l)))return!1}return!0};zt.extend=function(t,e,r){var i=t.create(r,e.getDimension()),s=e.size();if(zt.copy(e,0,i,0,s),s>0)for(var o=s;o<r;o++)zt.copy(e,s-1,i,o,1);return i};zt.reverse=function(t){for(var e=t.size()-1,r=Math.trunc(e/2),i=0;i<=r;i++)zt.swap(t,i,e-i)};zt.swap=function(t,e,r){if(e===r)return null;for(var i=0;i<t.getDimension();i++){var s=t.getOrdinate(e,i);t.setOrdinate(e,i,t.getOrdinate(r,i)),t.setOrdinate(r,i,s)}};zt.copy=function(t,e,r,i,s){for(var o=0;o<s;o++)zt.copyCoord(t,e+o,r,i+o)};zt.toString=function(){if(arguments.length===1){var t=arguments[0],e=t.size();if(e===0)return"()";var r=t.getDimension(),i=new zr;i.append("(");for(var s=0;s<e;s++){s>0&&i.append(" ");for(var o=0;o<r;o++)o>0&&i.append(","),i.append(tr.toString(t.getOrdinate(s,o)))}return i.append(")"),i.toString()}};zt.ensureValidRing=function(t,e){var r=e.size();if(r===0)return e;if(r<=3)return zt.createClosedRing(t,e,4);var i=e.getOrdinate(0,ut.X)===e.getOrdinate(r-1,ut.X)&&e.getOrdinate(0,ut.Y)===e.getOrdinate(r-1,ut.Y);return i?e:zt.createClosedRing(t,e,r+1)};zt.createClosedRing=function(t,e,r){var i=t.create(r,e.getDimension()),s=e.size();zt.copy(e,0,i,0,s);for(var o=s;o<r;o++)zt.copy(e,0,i,o,1);return i};var Dt=function(n){function t(r,i){n.call(this,i),this._points=null,this.init(r)}n&&(t.__proto__=n),t.prototype=Object.create(n&&n.prototype),t.prototype.constructor=t;var e={serialVersionUID:{configurable:!0}};return t.prototype.computeEnvelopeInternal=function(){return this.isEmpty()?new W:this._points.expandEnvelope(new W)},t.prototype.isRing=function(){return this.isClosed()&&this.isSimple()},t.prototype.getSortIndex=function(){return n.SORTINDEX_LINESTRING},t.prototype.getCoordinates=function(){return this._points.toCoordinateArray()},t.prototype.equalsExact=function(){var i=this;if(arguments.length===2){var s=arguments[0],o=arguments[1];if(!this.isEquivalentClass(s))return!1;var a=s;if(this._points.size()!==a._points.size())return!1;for(var u=0;u<this._points.size();u++)if(!i.equal(i._points.getCoordinate(u),a._points.getCoordinate(u),o))return!1;return!0}else return n.prototype.equalsExact.apply(this,arguments)},t.prototype.normalize=function(){for(var i=this,s=0;s<Math.trunc(this._points.size()/2);s++){var o=i._points.size()-1-s;if(!i._points.getCoordinate(s).equals(i._points.getCoordinate(o)))return i._points.getCoordinate(s).compareTo(i._points.getCoordinate(o))>0&&zt.reverse(i._points),null}},t.prototype.getCoordinate=function(){return this.isEmpty()?null:this._points.getCoordinate(0)},t.prototype.getBoundaryDimension=function(){return this.isClosed()?ht.FALSE:0},t.prototype.isClosed=function(){return this.isEmpty()?!1:this.getCoordinateN(0).equals2D(this.getCoordinateN(this.getNumPoints()-1))},t.prototype.getEndPoint=function(){return this.isEmpty()?null:this.getPointN(this.getNumPoints()-1)},t.prototype.getDimension=function(){return 1},t.prototype.getLength=function(){return G.computeLength(this._points)},t.prototype.getNumPoints=function(){return this._points.size()},t.prototype.reverse=function(){var i=this._points.copy();zt.reverse(i);var s=this.getFactory().createLineString(i);return s},t.prototype.compareToSameClass=function(){var i=this;if(arguments.length===1){for(var s=arguments[0],o=s,a=0,u=0;a<this._points.size()&&u<o._points.size();){var l=i._points.getCoordinate(a).compareTo(o._points.getCoordinate(u));if(l!==0)return l;a++,u++}return a<this._points.size()?1:u<o._points.size()?-1:0}else if(arguments.length===2){var c=arguments[0],h=arguments[1],f=c;return h.compare(this._points,f._points)}},t.prototype.apply=function(){var i=this;if(H(arguments[0],Jr))for(var s=arguments[0],o=0;o<this._points.size();o++)s.filter(i._points.getCoordinate(o));else if(H(arguments[0],fr)){var a=arguments[0];if(this._points.size()===0)return null;for(var u=0;u<this._points.size()&&(a.filter(i._points,u),!a.isDone());u++);a.isGeometryChanged()&&this.geometryChanged()}else if(H(arguments[0],Lr)){var l=arguments[0];l.filter(this)}else if(H(arguments[0],vn)){var c=arguments[0];c.filter(this)}},t.prototype.getBoundary=function(){return new $e(this).getBoundary()},t.prototype.isEquivalentClass=function(i){return i instanceof t},t.prototype.clone=function(){var i=n.prototype.clone.call(this);return i._points=this._points.clone(),i},t.prototype.getCoordinateN=function(i){return this._points.getCoordinate(i)},t.prototype.getGeometryType=function(){return"LineString"},t.prototype.copy=function(){return new t(this._points.copy(),this._factory)},t.prototype.getCoordinateSequence=function(){return this._points},t.prototype.isEmpty=function(){return this._points.size()===0},t.prototype.init=function(i){if(i===null&&(i=this.getFactory().getCoordinateSequenceFactory().create([])),i.size()===1)throw new Rt("Invalid number of points in LineString (found "+i.size()+" - must be 0 or >= 2)");this._points=i},t.prototype.isCoordinate=function(i){for(var s=this,o=0;o<this._points.size();o++)if(s._points.getCoordinate(o).equals(i))return!0;return!1},t.prototype.getStartPoint=function(){return this.isEmpty()?null:this.getPointN(0)},t.prototype.getPointN=function(i){return this.getFactory().createPoint(this._points.getCoordinate(i))},t.prototype.interfaces_=function(){return[$s]},t.prototype.getClass=function(){return t},e.serialVersionUID.get=function(){return 0x2b2b51ba435c8e00},Object.defineProperties(t,e),t}(Y),to=function(){};to.prototype.interfaces_=function(){return[]};to.prototype.getClass=function(){return to};var ke=function(n){function t(r,i){n.call(this,i),this._coordinates=r||null,this.init(this._coordinates)}n&&(t.__proto__=n),t.prototype=Object.create(n&&n.prototype),t.prototype.constructor=t;var e={serialVersionUID:{configurable:!0}};return t.prototype.computeEnvelopeInternal=function(){if(this.isEmpty())return new W;var i=new W;return i.expandToInclude(this._coordinates.getX(0),this._coordinates.getY(0)),i},t.prototype.getSortIndex=function(){return n.SORTINDEX_POINT},t.prototype.getCoordinates=function(){return this.isEmpty()?[]:[this.getCoordinate()]},t.prototype.equalsExact=function(){if(arguments.length===2){var i=arguments[0],s=arguments[1];return this.isEquivalentClass(i)?this.isEmpty()&&i.isEmpty()?!0:this.isEmpty()!==i.isEmpty()?!1:this.equal(i.getCoordinate(),this.getCoordinate(),s):!1}else return n.prototype.equalsExact.apply(this,arguments)},t.prototype.normalize=function(){},t.prototype.getCoordinate=function(){return this._coordinates.size()!==0?this._coordinates.getCoordinate(0):null},t.prototype.getBoundaryDimension=function(){return ht.FALSE},t.prototype.getDimension=function(){return 0},t.prototype.getNumPoints=function(){return this.isEmpty()?0:1},t.prototype.reverse=function(){return this.copy()},t.prototype.getX=function(){if(this.getCoordinate()===null)throw new Error("getX called on empty Point");return this.getCoordinate().x},t.prototype.compareToSameClass=function(){if(arguments.length===1){var i=arguments[0],s=i;return this.getCoordinate().compareTo(s.getCoordinate())}else if(arguments.length===2){var o=arguments[0],a=arguments[1],u=o;return a.compare(this._coordinates,u._coordinates)}},t.prototype.apply=function(){if(H(arguments[0],Jr)){var i=arguments[0];if(this.isEmpty())return null;i.filter(this.getCoordinate())}else if(H(arguments[0],fr)){var s=arguments[0];if(this.isEmpty())return null;s.filter(this._coordinates,0),s.isGeometryChanged()&&this.geometryChanged()}else if(H(arguments[0],Lr)){var o=arguments[0];o.filter(this)}else if(H(arguments[0],vn)){var a=arguments[0];a.filter(this)}},t.prototype.getBoundary=function(){return this.getFactory().createGeometryCollection(null)},t.prototype.clone=function(){var i=n.prototype.clone.call(this);return i._coordinates=this._coordinates.clone(),i},t.prototype.getGeometryType=function(){return"Point"},t.prototype.copy=function(){return new t(this._coordinates.copy(),this._factory)},t.prototype.getCoordinateSequence=function(){return this._coordinates},t.prototype.getY=function(){if(this.getCoordinate()===null)throw new Error("getY called on empty Point");return this.getCoordinate().y},t.prototype.isEmpty=function(){return this._coordinates.size()===0},t.prototype.init=function(i){i===null&&(i=this.getFactory().getCoordinateSequenceFactory().create([])),et.isTrue(i.size()<=1),this._coordinates=i},t.prototype.isSimple=function(){return!0},t.prototype.interfaces_=function(){return[to]},t.prototype.getClass=function(){return t},e.serialVersionUID.get=function(){return 4902022702746615e3},Object.defineProperties(t,e),t}(Y),zn=function(){};zn.prototype.interfaces_=function(){return[]};zn.prototype.getClass=function(){return zn};var Kt=function(n){function t(r,i,s){if(n.call(this,s),this._shell=null,this._holes=null,r===null&&(r=this.getFactory().createLinearRing()),i===null&&(i=[]),n.hasNullElements(i))throw new Rt("holes must not contain null elements");if(r.isEmpty()&&n.hasNonEmptyElements(i))throw new Rt("shell is empty but holes are not");this._shell=r,this._holes=i}n&&(t.__proto__=n),t.prototype=Object.create(n&&n.prototype),t.prototype.constructor=t;var e={serialVersionUID:{configurable:!0}};return t.prototype.computeEnvelopeInternal=function(){return this._shell.getEnvelopeInternal()},t.prototype.getSortIndex=function(){return n.SORTINDEX_POLYGON},t.prototype.getCoordinates=function(){var i=this;if(this.isEmpty())return[];for(var s=new Array(this.getNumPoints()).fill(null),o=-1,a=this._shell.getCoordinates(),u=0;u<a.length;u++)o++,s[o]=a[u];for(var l=0;l<this._holes.length;l++)for(var c=i._holes[l].getCoordinates(),h=0;h<c.length;h++)o++,s[o]=c[h];return s},t.prototype.getArea=function(){var i=this,s=0;s+=Math.abs(G.signedArea(this._shell.getCoordinateSequence()));for(var o=0;o<this._holes.length;o++)s-=Math.abs(G.signedArea(i._holes[o].getCoordinateSequence()));return s},t.prototype.isRectangle=function(){if(this.getNumInteriorRing()!==0||this._shell===null||this._shell.getNumPoints()!==5)return!1;for(var i=this._shell.getCoordinateSequence(),s=this.getEnvelopeInternal(),o=0;o<5;o++){var a=i.getX(o);if(!(a===s.getMinX()||a===s.getMaxX()))return!1;var u=i.getY(o);if(!(u===s.getMinY()||u===s.getMaxY()))return!1}for(var l=i.getX(0),c=i.getY(0),h=1;h<=4;h++){var f=i.getX(h),p=i.getY(h),d=f!==l,_=p!==c;if(d===_)return!1;l=f,c=p}return!0},t.prototype.equalsExact=function(){var i=this;if(arguments.length===2){var s=arguments[0],o=arguments[1];if(!this.isEquivalentClass(s))return!1;var a=s,u=this._shell,l=a._shell;if(!u.equalsExact(l,o)||this._holes.length!==a._holes.length)return!1;for(var c=0;c<this._holes.length;c++)if(!i._holes[c].equalsExact(a._holes[c],o))return!1;return!0}else return n.prototype.equalsExact.apply(this,arguments)},t.prototype.normalize=function(){var i=this;if(arguments.length===0){this.normalize(this._shell,!0);for(var s=0;s<this._holes.length;s++)i.normalize(i._holes[s],!1);ei.sort(this._holes)}else if(arguments.length===2){var o=arguments[0],a=arguments[1];if(o.isEmpty())return null;var u=new Array(o.getCoordinates().length-1).fill(null);le.arraycopy(o.getCoordinates(),0,u,0,u.length);var l=it.minCoordinate(o.getCoordinates());it.scroll(u,l),le.arraycopy(u,0,o.getCoordinates(),0,u.length),o.getCoordinates()[u.length]=u[0],G.isCCW(o.getCoordinates())===a&&it.reverse(o.getCoordinates())}},t.prototype.getCoordinate=function(){return this._shell.getCoordinate()},t.prototype.getNumInteriorRing=function(){return this._holes.length},t.prototype.getBoundaryDimension=function(){return 1},t.prototype.getDimension=function(){return 2},t.prototype.getLength=function(){var i=this,s=0;s+=this._shell.getLength();for(var o=0;o<this._holes.length;o++)s+=i._holes[o].getLength();return s},t.prototype.getNumPoints=function(){for(var i=this,s=this._shell.getNumPoints(),o=0;o<this._holes.length;o++)s+=i._holes[o].getNumPoints();return s},t.prototype.reverse=function(){var i=this,s=this.copy();s._shell=this._shell.copy().reverse(),s._holes=new Array(this._holes.length).fill(null);for(var o=0;o<this._holes.length;o++)s._holes[o]=i._holes[o].copy().reverse();return s},t.prototype.convexHull=function(){return this.getExteriorRing().convexHull()},t.prototype.compareToSameClass=function(){var i=this;if(arguments.length===1){var s=arguments[0],o=this._shell,a=s._shell;return o.compareToSameClass(a)}else if(arguments.length===2){var u=arguments[0],l=arguments[1],c=u,h=this._shell,f=c._shell,p=h.compareToSameClass(f,l);if(p!==0)return p;for(var d=this.getNumInteriorRing(),_=c.getNumInteriorRing(),w=0;w<d&&w<_;){var y=i.getInteriorRingN(w),x=c.getInteriorRingN(w),g=y.compareToSameClass(x,l);if(g!==0)return g;w++}return w<d?1:w<_?-1:0}},t.prototype.apply=function(i){var s=this;if(H(i,Jr)){this._shell.apply(i);for(var o=0;o<this._holes.length;o++)s._holes[o].apply(i)}else if(H(i,fr)){if(this._shell.apply(i),!i.isDone())for(var a=0;a<this._holes.length&&(s._holes[a].apply(i),!i.isDone());a++);i.isGeometryChanged()&&this.geometryChanged()}else if(H(i,Lr))i.filter(this);else if(H(i,vn)){i.filter(this),this._shell.apply(i);for(var u=0;u<this._holes.length;u++)s._holes[u].apply(i)}},t.prototype.getBoundary=function(){var i=this;if(this.isEmpty())return this.getFactory().createMultiLineString();var s=new Array(this._holes.length+1).fill(null);s[0]=this._shell;for(var o=0;o<this._holes.length;o++)s[o+1]=i._holes[o];return s.length<=1?this.getFactory().createLinearRing(s[0].getCoordinateSequence()):this.getFactory().createMultiLineString(s)},t.prototype.clone=function(){var i=this,s=n.prototype.clone.call(this);s._shell=this._shell.clone(),s._holes=new Array(this._holes.length).fill(null);for(var o=0;o<this._holes.length;o++)s._holes[o]=i._holes[o].clone();return s},t.prototype.getGeometryType=function(){return"Polygon"},t.prototype.copy=function(){for(var i=this,s=this._shell.copy(),o=new Array(this._holes.length).fill(null),a=0;a<o.length;a++)o[a]=i._holes[a].copy();return new t(s,o,this._factory)},t.prototype.getExteriorRing=function(){return this._shell},t.prototype.isEmpty=function(){return this._shell.isEmpty()},t.prototype.getInteriorRingN=function(i){return this._holes[i]},t.prototype.interfaces_=function(){return[zn]},t.prototype.getClass=function(){return t},e.serialVersionUID.get=function(){return-0x307ffefd8dc97200},Object.defineProperties(t,e),t}(Y),us=function(n){function t(){n.apply(this,arguments)}n&&(t.__proto__=n),t.prototype=Object.create(n&&n.prototype),t.prototype.constructor=t;var e={serialVersionUID:{configurable:!0}};return t.prototype.getSortIndex=function(){return Y.SORTINDEX_MULTIPOINT},t.prototype.isValid=function(){return!0},t.prototype.equalsExact=function(){if(arguments.length===2){var i=arguments[0],s=arguments[1];return this.isEquivalentClass(i)?n.prototype.equalsExact.call(this,i,s):!1}else return n.prototype.equalsExact.apply(this,arguments)},t.prototype.getCoordinate=function(){if(arguments.length===1){var i=arguments[0];return this._geometries[i].getCoordinate()}else return n.prototype.getCoordinate.apply(this,arguments)},t.prototype.getBoundaryDimension=function(){return ht.FALSE},t.prototype.getDimension=function(){return 0},t.prototype.getBoundary=function(){return this.getFactory().createGeometryCollection(null)},t.prototype.getGeometryType=function(){return"MultiPoint"},t.prototype.copy=function(){for(var i=this,s=new Array(this._geometries.length).fill(null),o=0;o<s.length;o++)s[o]=i._geometries[o].copy();return new t(s,this._factory)},t.prototype.interfaces_=function(){return[to]},t.prototype.getClass=function(){return t},e.serialVersionUID.get=function(){return-8048474874175356e3},Object.defineProperties(t,e),t}(Se),Qr=function(n){function t(r,i){r instanceof P&&i instanceof nt&&(r=i.getCoordinateSequenceFactory().create(r)),n.call(this,r,i),this.validateConstruction()}n&&(t.__proto__=n),t.prototype=Object.create(n&&n.prototype),t.prototype.constructor=t;var e={MINIMUM_VALID_SIZE:{configurable:!0},serialVersionUID:{configurable:!0}};return t.prototype.getSortIndex=function(){return Y.SORTINDEX_LINEARRING},t.prototype.getBoundaryDimension=function(){return ht.FALSE},t.prototype.isClosed=function(){return this.isEmpty()?!0:n.prototype.isClosed.call(this)},t.prototype.reverse=function(){var i=this._points.copy();zt.reverse(i);var s=this.getFactory().createLinearRing(i);return s},t.prototype.validateConstruction=function(){if(!this.isEmpty()&&!n.prototype.isClosed.call(this))throw new Rt("Points of LinearRing do not form a closed linestring");if(this.getCoordinateSequence().size()>=1&&this.getCoordinateSequence().size()<t.MINIMUM_VALID_SIZE)throw new Rt("Invalid number of points in LinearRing (found "+this.getCoordinateSequence().size()+" - must be 0 or >= 4)")},t.prototype.getGeometryType=function(){return"LinearRing"},t.prototype.copy=function(){return new t(this._points.copy(),this._factory)},t.prototype.interfaces_=function(){return[]},t.prototype.getClass=function(){return t},e.MINIMUM_VALID_SIZE.get=function(){return 4},e.serialVersionUID.get=function(){return-0x3b229e262367a600},Object.defineProperties(t,e),t}(Dt),Zr=function(n){function t(){n.apply(this,arguments)}n&&(t.__proto__=n),t.prototype=Object.create(n&&n.prototype),t.prototype.constructor=t;var e={serialVersionUID:{configurable:!0}};return t.prototype.getSortIndex=function(){return Y.SORTINDEX_MULTIPOLYGON},t.prototype.equalsExact=function(){if(arguments.length===2){var i=arguments[0],s=arguments[1];return this.isEquivalentClass(i)?n.prototype.equalsExact.call(this,i,s):!1}else return n.prototype.equalsExact.apply(this,arguments)},t.prototype.getBoundaryDimension=function(){return 1},t.prototype.getDimension=function(){return 2},t.prototype.reverse=function(){for(var i=this,s=this._geometries.length,o=new Array(s).fill(null),a=0;a<this._geometries.length;a++)o[a]=i._geometries[a].reverse();return this.getFactory().createMultiPolygon(o)},t.prototype.getBoundary=function(){var i=this;if(this.isEmpty())return this.getFactory().createMultiLineString();for(var s=new k,o=0;o<this._geometries.length;o++)for(var a=i._geometries[o],u=a.getBoundary(),l=0;l<u.getNumGeometries();l++)s.add(u.getGeometryN(l));var c=new Array(s.size()).fill(null);return this.getFactory().createMultiLineString(s.toArray(c))},t.prototype.getGeometryType=function(){return"MultiPolygon"},t.prototype.copy=function(){for(var i=this,s=new Array(this._geometries.length).fill(null),o=0;o<s.length;o++)s[o]=i._geometries[o].copy();return new t(s,this._factory)},t.prototype.interfaces_=function(){return[zn]},t.prototype.getClass=function(){return t},e.serialVersionUID.get=function(){return-0x7a5aa1369171980},Object.defineProperties(t,e),t}(Se),nr=function(t){this._factory=t||null,this._isUserDataCopied=!1},ru={NoOpGeometryOperation:{configurable:!0},CoordinateOperation:{configurable:!0},CoordinateSequenceOperation:{configurable:!0}};nr.prototype.setCopyUserData=function(t){this._isUserDataCopied=t};nr.prototype.edit=function(t,e){if(t===null)return null;var r=this.editInternal(t,e);return this._isUserDataCopied&&r.setUserData(t.getUserData()),r};nr.prototype.editInternal=function(t,e){return this._factory===null&&(this._factory=t.getFactory()),t instanceof Se?this.editGeometryCollection(t,e):t instanceof Kt?this.editPolygon(t,e):t instanceof ke?e.edit(t,this._factory):t instanceof Dt?e.edit(t,this._factory):(et.shouldNeverReachHere("Unsupported Geometry class: "+t.getClass().getName()),null)};nr.prototype.editGeometryCollection=function(t,e){for(var r=this,i=e.edit(t,this._factory),s=new k,o=0;o<i.getNumGeometries();o++){var a=r.edit(i.getGeometryN(o),e);a===null||a.isEmpty()||s.add(a)}return i.getClass()===us?this._factory.createMultiPoint(s.toArray([])):i.getClass()===ni?this._factory.createMultiLineString(s.toArray([])):i.getClass()===Zr?this._factory.createMultiPolygon(s.toArray([])):this._factory.createGeometryCollection(s.toArray([]))};nr.prototype.editPolygon=function(t,e){var r=this,i=e.edit(t,this._factory);if(i===null&&(i=this._factory.createPolygon(null)),i.isEmpty())return i;var s=this.edit(i.getExteriorRing(),e);if(s===null||s.isEmpty())return this._factory.createPolygon();for(var o=new k,a=0;a<i.getNumInteriorRing();a++){var u=r.edit(i.getInteriorRingN(a),e);u===null||u.isEmpty()||o.add(u)}return this._factory.createPolygon(s,o.toArray([]))};nr.prototype.interfaces_=function(){return[]};nr.prototype.getClass=function(){return nr};nr.GeometryEditorOperation=function(){};ru.NoOpGeometryOperation.get=function(){return eo};ru.CoordinateOperation.get=function(){return ro};ru.CoordinateSequenceOperation.get=function(){return no};Object.defineProperties(nr,ru);var eo=function(){};eo.prototype.edit=function(t,e){return t};eo.prototype.interfaces_=function(){return[nr.GeometryEditorOperation]};eo.prototype.getClass=function(){return eo};var ro=function(){};ro.prototype.edit=function(t,e){var r=this.editCoordinates(t.getCoordinates(),t);return r===null?t:t instanceof Qr?e.createLinearRing(r):t instanceof Dt?e.createLineString(r):t instanceof ke?r.length>0?e.createPoint(r[0]):e.createPoint():t};ro.prototype.interfaces_=function(){return[nr.GeometryEditorOperation]};ro.prototype.getClass=function(){return ro};var no=function(){};no.prototype.edit=function(t,e){return t instanceof Qr?e.createLinearRing(this.edit(t.getCoordinateSequence(),t)):t instanceof Dt?e.createLineString(this.edit(t.getCoordinateSequence(),t)):t instanceof ke?e.createPoint(this.edit(t.getCoordinateSequence(),t)):t};no.prototype.interfaces_=function(){return[nr.GeometryEditorOperation]};no.prototype.getClass=function(){return no};var Gt=function(){var t=this;if(this._dimension=3,this._coordinates=null,arguments.length===1){if(arguments[0]instanceof Array)this._coordinates=arguments[0],this._dimension=3;else if(Number.isInteger(arguments[0])){var e=arguments[0];this._coordinates=new Array(e).fill(null);for(var r=0;r<e;r++)t._coordinates[r]=new P}else if(H(arguments[0],ut)){var i=arguments[0];if(i===null)return this._coordinates=new Array(0).fill(null),null;this._dimension=i.getDimension(),this._coordinates=new Array(i.size()).fill(null);for(var s=0;s<this._coordinates.length;s++)t._coordinates[s]=i.getCoordinateCopy(s)}}else if(arguments.length===2){if(arguments[0]instanceof Array&&Number.isInteger(arguments[1])){var o=arguments[0],a=arguments[1];this._coordinates=o,this._dimension=a,o===null&&(this._coordinates=new Array(0).fill(null))}else if(Number.isInteger(arguments[0])&&Number.isInteger(arguments[1])){var u=arguments[0],l=arguments[1];this._coordinates=new Array(u).fill(null),this._dimension=l;for(var c=0;c<u;c++)t._coordinates[c]=new P}}},yh={serialVersionUID:{configurable:!0}};Gt.prototype.setOrdinate=function(t,e,r){switch(e){case ut.X:this._coordinates[t].x=r;break;case ut.Y:this._coordinates[t].y=r;break;case ut.Z:this._coordinates[t].z=r;break;default:throw new Rt("invalid ordinateIndex")}};Gt.prototype.size=function(){return this._coordinates.length};Gt.prototype.getOrdinate=function(t,e){switch(e){case ut.X:return this._coordinates[t].x;case ut.Y:return this._coordinates[t].y;case ut.Z:return this._coordinates[t].z}return J.NaN};Gt.prototype.getCoordinate=function(){if(arguments.length===1){var t=arguments[0];return this._coordinates[t]}else if(arguments.length===2){var e=arguments[0],r=arguments[1];r.x=this._coordinates[e].x,r.y=this._coordinates[e].y,r.z=this._coordinates[e].z}};Gt.prototype.getCoordinateCopy=function(t){return new P(this._coordinates[t])};Gt.prototype.getDimension=function(){return this._dimension};Gt.prototype.getX=function(t){return this._coordinates[t].x};Gt.prototype.clone=function(){for(var t=this,e=new Array(this.size()).fill(null),r=0;r<this._coordinates.length;r++)e[r]=t._coordinates[r].clone();return new Gt(e,this._dimension)};Gt.prototype.expandEnvelope=function(t){for(var e=this,r=0;r<this._coordinates.length;r++)t.expandToInclude(e._coordinates[r]);return t};Gt.prototype.copy=function(){for(var t=this,e=new Array(this.size()).fill(null),r=0;r<this._coordinates.length;r++)e[r]=t._coordinates[r].copy();return new Gt(e,this._dimension)};Gt.prototype.toString=function(){var t=this;if(this._coordinates.length>0){var e=new zr(17*this._coordinates.length);e.append("("),e.append(this._coordinates[0]);for(var r=1;r<this._coordinates.length;r++)e.append(", "),e.append(t._coordinates[r]);return e.append(")"),e.toString()}else return"()"};Gt.prototype.getY=function(t){return this._coordinates[t].y};Gt.prototype.toCoordinateArray=function(){return this._coordinates};Gt.prototype.interfaces_=function(){return[ut,or]};Gt.prototype.getClass=function(){return Gt};yh.serialVersionUID.get=function(){return-0xcb44a778db18e00};Object.defineProperties(Gt,yh);var $r=function(){},yl={serialVersionUID:{configurable:!0},instanceObject:{configurable:!0}};$r.prototype.readResolve=function(){return $r.instance()};$r.prototype.create=function(){if(arguments.length===1){if(arguments[0]instanceof Array){var t=arguments[0];return new Gt(t)}else if(H(arguments[0],ut)){var e=arguments[0];return new Gt(e)}}else if(arguments.length===2){var r=arguments[0],i=arguments[1];return i>3&&(i=3),i<2?new Gt(r):new Gt(r,i)}};$r.prototype.interfaces_=function(){return[rs,or]};$r.prototype.getClass=function(){return $r};$r.instance=function(){return $r.instanceObject};yl.serialVersionUID.get=function(){return-0x38e49fa6cf6f2e00};yl.instanceObject.get=function(){return new $r};Object.defineProperties($r,yl);var _h=function(n){function t(){n.call(this),this.map_=new Map}return n&&(t.__proto__=n),t.prototype=Object.create(n&&n.prototype),t.prototype.constructor=t,t.prototype.get=function(r){return this.map_.get(r)||null},t.prototype.put=function(r,i){return this.map_.set(r,i),i},t.prototype.values=function(){for(var r=new k,i=this.map_.values(),s=i.next();!s.done;)r.add(s.value),s=i.next();return r},t.prototype.entrySet=function(){var r=new ml;return this.map_.entries().forEach(function(i){return r.add(i)}),r},t.prototype.size=function(){return this.map_.size()},t}(ji),pt=function n(){if(this._modelType=null,this._scale=null,arguments.length===0)this._modelType=n.FLOATING;else if(arguments.length===1){if(arguments[0]instanceof Ar){var t=arguments[0];this._modelType=t,t===n.FIXED&&this.setScale(1)}else if(typeof arguments[0]=="number"){var e=arguments[0];this._modelType=n.FIXED,this.setScale(e)}else if(arguments[0]instanceof n){var r=arguments[0];this._modelType=r._modelType,this._scale=r._scale}}},_l={serialVersionUID:{configurable:!0},maximumPreciseValue:{configurable:!0}};pt.prototype.equals=function(t){if(!(t instanceof pt))return!1;var e=t;return this._modelType===e._modelType&&this._scale===e._scale};pt.prototype.compareTo=function(t){var e=t,r=this.getMaximumSignificantDigits(),i=e.getMaximumSignificantDigits();return new Pr(r).compareTo(new Pr(i))};pt.prototype.getScale=function(){return this._scale};pt.prototype.isFloating=function(){return this._modelType===pt.FLOATING||this._modelType===pt.FLOATING_SINGLE};pt.prototype.getType=function(){return this._modelType};pt.prototype.toString=function(){var t="UNKNOWN";return this._modelType===pt.FLOATING?t="Floating":this._modelType===pt.FLOATING_SINGLE?t="Floating-Single":this._modelType===pt.FIXED&&(t="Fixed (Scale="+this.getScale()+")"),t};pt.prototype.makePrecise=function(){if(typeof arguments[0]=="number"){var t=arguments[0];if(J.isNaN(t))return t;if(this._modelType===pt.FLOATING_SINGLE){var e=t;return e}return this._modelType===pt.FIXED?Math.round(t*this._scale)/this._scale:t}else if(arguments[0]instanceof P){var r=arguments[0];if(this._modelType===pt.FLOATING)return null;r.x=this.makePrecise(r.x),r.y=this.makePrecise(r.y)}};pt.prototype.getMaximumSignificantDigits=function(){var t=16;return this._modelType===pt.FLOATING?t=16:this._modelType===pt.FLOATING_SINGLE?t=6:this._modelType===pt.FIXED&&(t=1+Math.trunc(Math.ceil(Math.log(this.getScale())/Math.log(10)))),t};pt.prototype.setScale=function(t){this._scale=Math.abs(t)};pt.prototype.interfaces_=function(){return[or,sr]};pt.prototype.getClass=function(){return pt};pt.mostPrecise=function(t,e){return t.compareTo(e)>=0?t:e};_l.serialVersionUID.get=function(){return 7777263578777804e3};_l.maximumPreciseValue.get=function(){return 9007199254740992};Object.defineProperties(pt,_l);var Ar=function n(t){this._name=t||null,n.nameToTypeMap.put(t,this)},wl={serialVersionUID:{configurable:!0},nameToTypeMap:{configurable:!0}};Ar.prototype.readResolve=function(){return Ar.nameToTypeMap.get(this._name)};Ar.prototype.toString=function(){return this._name};Ar.prototype.interfaces_=function(){return[or]};Ar.prototype.getClass=function(){return Ar};wl.serialVersionUID.get=function(){return-552860263173159e4};wl.nameToTypeMap.get=function(){return new _h};Object.defineProperties(Ar,wl);pt.Type=Ar;pt.FIXED=new Ar("FIXED");pt.FLOATING=new Ar("FLOATING");pt.FLOATING_SINGLE=new Ar("FLOATING SINGLE");var nt=function n(){this._precisionModel=new pt,this._SRID=0,this._coordinateSequenceFactory=n.getDefaultCoordinateSequenceFactory(),arguments.length===0||(arguments.length===1?H(arguments[0],rs)?this._coordinateSequenceFactory=arguments[0]:arguments[0]instanceof pt&&(this._precisionModel=arguments[0]):arguments.length===2?(this._precisionModel=arguments[0],this._SRID=arguments[1]):arguments.length===3&&(this._precisionModel=arguments[0],this._SRID=arguments[1],this._coordinateSequenceFactory=arguments[2]))},wh={serialVersionUID:{configurable:!0}};nt.prototype.toGeometry=function(t){return t.isNull()?this.createPoint(null):t.getMinX()===t.getMaxX()&&t.getMinY()===t.getMaxY()?this.createPoint(new P(t.getMinX(),t.getMinY())):t.getMinX()===t.getMaxX()||t.getMinY()===t.getMaxY()?this.createLineString([new P(t.getMinX(),t.getMinY()),new P(t.getMaxX(),t.getMaxY())]):this.createPolygon(this.createLinearRing([new P(t.getMinX(),t.getMinY()),new P(t.getMinX(),t.getMaxY()),new P(t.getMaxX(),t.getMaxY()),new P(t.getMaxX(),t.getMinY()),new P(t.getMinX(),t.getMinY())]),null)};nt.prototype.createLineString=function(t){if(t){if(t instanceof Array)return new Dt(this.getCoordinateSequenceFactory().create(t),this);if(H(t,ut))return new Dt(t,this)}else return new Dt(this.getCoordinateSequenceFactory().create([]),this)};nt.prototype.createMultiLineString=function(){if(arguments.length===0)return new ni(null,this);if(arguments.length===1){var t=arguments[0];return new ni(t,this)}};nt.prototype.buildGeometry=function(t){for(var e=null,r=!1,i=!1,s=t.iterator();s.hasNext();){var o=s.next(),a=o.getClass();e===null&&(e=a),a!==e&&(r=!0),o.isGeometryCollectionOrDerived()&&(i=!0)}if(e===null)return this.createGeometryCollection();if(r||i)return this.createGeometryCollection(nt.toGeometryArray(t));var u=t.iterator().next(),l=t.size()>1;if(l){if(u instanceof Kt)return this.createMultiPolygon(nt.toPolygonArray(t));if(u instanceof Dt)return this.createMultiLineString(nt.toLineStringArray(t));if(u instanceof ke)return this.createMultiPoint(nt.toPointArray(t));et.shouldNeverReachHere("Unhandled class: "+u.getClass().getName())}return u};nt.prototype.createMultiPointFromCoords=function(t){return this.createMultiPoint(t!==null?this.getCoordinateSequenceFactory().create(t):null)};nt.prototype.createPoint=function(){if(arguments.length===0)return this.createPoint(this.getCoordinateSequenceFactory().create([]));if(arguments.length===1){if(arguments[0]instanceof P){var t=arguments[0];return this.createPoint(t!==null?this.getCoordinateSequenceFactory().create([t]):null)}else if(H(arguments[0],ut)){var e=arguments[0];return new ke(e,this)}}};nt.prototype.getCoordinateSequenceFactory=function(){return this._coordinateSequenceFactory};nt.prototype.createPolygon=function(){if(arguments.length===0)return new Kt(null,null,this);if(arguments.length===1){if(H(arguments[0],ut)){var t=arguments[0];return this.createPolygon(this.createLinearRing(t))}else if(arguments[0]instanceof Array){var e=arguments[0];return this.createPolygon(this.createLinearRing(e))}else if(arguments[0]instanceof Qr){var r=arguments[0];return this.createPolygon(r,null)}}else if(arguments.length===2){var i=arguments[0],s=arguments[1];return new Kt(i,s,this)}};nt.prototype.getSRID=function(){return this._SRID};nt.prototype.createGeometryCollection=function(){if(arguments.length===0)return new Se(null,this);if(arguments.length===1){var t=arguments[0];return new Se(t,this)}};nt.prototype.createGeometry=function(t){var e=new nr(this);return e.edit(t,{edit:function(){if(arguments.length===2){var r=arguments[0];return this._coordinateSequenceFactory.create(r)}}})};nt.prototype.getPrecisionModel=function(){return this._precisionModel};nt.prototype.createLinearRing=function(){if(arguments.length===0)return this.createLinearRing(this.getCoordinateSequenceFactory().create([]));if(arguments.length===1){if(arguments[0]instanceof Array){var t=arguments[0];return this.createLinearRing(t!==null?this.getCoordinateSequenceFactory().create(t):null)}else if(H(arguments[0],ut)){var e=arguments[0];return new Qr(e,this)}}};nt.prototype.createMultiPolygon=function(){if(arguments.length===0)return new Zr(null,this);if(arguments.length===1){var t=arguments[0];return new Zr(t,this)}};nt.prototype.createMultiPoint=function(){var t=this;if(arguments.length===0)return new us(null,this);if(arguments.length===1){if(arguments[0]instanceof Array){var e=arguments[0];return new us(e,this)}else if(arguments[0]instanceof Array){var r=arguments[0];return this.createMultiPoint(r!==null?this.getCoordinateSequenceFactory().create(r):null)}else if(H(arguments[0],ut)){var i=arguments[0];if(i===null)return this.createMultiPoint(new Array(0).fill(null));for(var s=new Array(i.size()).fill(null),o=0;o<i.size();o++){var a=t.getCoordinateSequenceFactory().create(1,i.getDimension());zt.copy(i,o,a,0,1),s[o]=t.createPoint(a)}return this.createMultiPoint(s)}}};nt.prototype.interfaces_=function(){return[or]};nt.prototype.getClass=function(){return nt};nt.toMultiPolygonArray=function(t){var e=new Array(t.size()).fill(null);return t.toArray(e)};nt.toGeometryArray=function(t){if(t===null)return null;var e=new Array(t.size()).fill(null);return t.toArray(e)};nt.getDefaultCoordinateSequenceFactory=function(){return $r.instance()};nt.toMultiLineStringArray=function(t){var e=new Array(t.size()).fill(null);return t.toArray(e)};nt.toLineStringArray=function(t){var e=new Array(t.size()).fill(null);return t.toArray(e)};nt.toMultiPointArray=function(t){var e=new Array(t.size()).fill(null);return t.toArray(e)};nt.toLinearRingArray=function(t){var e=new Array(t.size()).fill(null);return t.toArray(e)};nt.toPointArray=function(t){var e=new Array(t.size()).fill(null);return t.toArray(e)};nt.toPolygonArray=function(t){var e=new Array(t.size()).fill(null);return t.toArray(e)};nt.createPointFromInternalCoord=function(t,e){return e.getPrecisionModel().makePrecise(t),e.getFactory().createPoint(t)};wh.serialVersionUID.get=function(){return-6820524753094096e3};Object.defineProperties(nt,wh);var hg=["Point","MultiPoint","LineString","MultiLineString","Polygon","MultiPolygon"],nu=function(t){this.geometryFactory=t||new nt};nu.prototype.read=function(t){var e;typeof t=="string"?e=JSON.parse(t):e=t;var r=e.type;if(!Sr[r])throw new Error("Unknown GeoJSON type: "+e.type);return hg.indexOf(r)!==-1?Sr[r].apply(this,[e.coordinates]):r==="GeometryCollection"?Sr[r].apply(this,[e.geometries]):Sr[r].apply(this,[e])};nu.prototype.write=function(t){var e=t.getGeometryType();if(!hn[e])throw new Error("Geometry is not supported");return hn[e].apply(this,[t])};var Sr={Feature:function(n){var t={};for(var e in n)t[e]=n[e];if(n.geometry){var r=n.geometry.type;if(!Sr[r])throw new Error("Unknown GeoJSON type: "+n.type);t.geometry=this.read(n.geometry)}return n.bbox&&(t.bbox=Sr.bbox.apply(this,[n.bbox])),t},FeatureCollection:function(n){var t=this,e={};if(n.features){e.features=[];for(var r=0;r<n.features.length;++r)e.features.push(t.read(n.features[r]))}return n.bbox&&(e.bbox=this.parse.bbox.apply(this,[n.bbox])),e},coordinates:function(n){for(var t=[],e=0;e<n.length;++e){var r=n[e];t.push(new P(r[0],r[1]))}return t},bbox:function(n){return this.geometryFactory.createLinearRing([new P(n[0],n[1]),new P(n[2],n[1]),new P(n[2],n[3]),new P(n[0],n[3]),new P(n[0],n[1])])},Point:function(n){var t=new P(n[0],n[1]);return this.geometryFactory.createPoint(t)},MultiPoint:function(n){for(var t=this,e=[],r=0;r<n.length;++r)e.push(Sr.Point.apply(t,[n[r]]));return this.geometryFactory.createMultiPoint(e)},LineString:function(n){var t=Sr.coordinates.apply(this,[n]);return this.geometryFactory.createLineString(t)},MultiLineString:function(n){for(var t=this,e=[],r=0;r<n.length;++r)e.push(Sr.LineString.apply(t,[n[r]]));return this.geometryFactory.createMultiLineString(e)},Polygon:function(n){for(var t=this,e=Sr.coordinates.apply(this,[n[0]]),r=this.geometryFactory.createLinearRing(e),i=[],s=1;s<n.length;++s){var o=n[s],a=Sr.coordinates.apply(t,[o]),u=t.geometryFactory.createLinearRing(a);i.push(u)}return this.geometryFactory.createPolygon(r,i)},MultiPolygon:function(n){for(var t=this,e=[],r=0;r<n.length;++r){var i=n[r];e.push(Sr.Polygon.apply(t,[i]))}return this.geometryFactory.createMultiPolygon(e)},GeometryCollection:function(n){for(var t=this,e=[],r=0;r<n.length;++r){var i=n[r];e.push(t.read(i))}return this.geometryFactory.createGeometryCollection(e)}},hn={coordinate:function(n){return[n.x,n.y]},Point:function(n){var t=hn.coordinate.apply(this,[n.getCoordinate()]);return{type:"Point",coordinates:t}},MultiPoint:function(n){for(var t=this,e=[],r=0;r<n._geometries.length;++r){var i=n._geometries[r],s=hn.Point.apply(t,[i]);e.push(s.coordinates)}return{type:"MultiPoint",coordinates:e}},LineString:function(n){for(var t=this,e=[],r=n.getCoordinates(),i=0;i<r.length;++i){var s=r[i];e.push(hn.coordinate.apply(t,[s]))}return{type:"LineString",coordinates:e}},MultiLineString:function(n){for(var t=this,e=[],r=0;r<n._geometries.length;++r){var i=n._geometries[r],s=hn.LineString.apply(t,[i]);e.push(s.coordinates)}return{type:"MultiLineString",coordinates:e}},Polygon:function(n){var t=this,e=[],r=hn.LineString.apply(this,[n._shell]);e.push(r.coordinates);for(var i=0;i<n._holes.length;++i){var s=n._holes[i],o=hn.LineString.apply(t,[s]);e.push(o.coordinates)}return{type:"Polygon",coordinates:e}},MultiPolygon:function(n){for(var t=this,e=[],r=0;r<n._geometries.length;++r){var i=n._geometries[r],s=hn.Polygon.apply(t,[i]);e.push(s.coordinates)}return{type:"MultiPolygon",coordinates:e}},GeometryCollection:function(n){for(var t=this,e=[],r=0;r<n._geometries.length;++r){var i=n._geometries[r],s=i.getGeometryType();e.push(hn[s].apply(t,[i]))}return{type:"GeometryCollection",geometries:e}}},El=function(t){this.geometryFactory=t||new nt,this.precisionModel=this.geometryFactory.getPrecisionModel(),this.parser=new nu(this.geometryFactory)};El.prototype.read=function(t){var e=this.parser.read(t);return this.precisionModel.getType()===pt.FIXED&&this.reducePrecision(e),e};El.prototype.reducePrecision=function(t){var e=this,r,i;if(t.coordinate)this.precisionModel.makePrecise(t.coordinate);else if(t.points)for(r=0,i=t.points.length;r<i;r++)e.precisionModel.makePrecise(t.points[r]);else if(t.geometries)for(r=0,i=t.geometries.length;r<i;r++)e.reducePrecision(t.geometries[r])};var Eh=function(){this.parser=new nu(this.geometryFactory)};Eh.prototype.write=function(t){return this.parser.write(t)};var D=function(){},iu={ON:{configurable:!0},LEFT:{configurable:!0},RIGHT:{configurable:!0}};D.prototype.interfaces_=function(){return[]};D.prototype.getClass=function(){return D};D.opposite=function(t){return t===D.LEFT?D.RIGHT:t===D.RIGHT?D.LEFT:t};iu.ON.get=function(){return 0};iu.LEFT.get=function(){return 1};iu.RIGHT.get=function(){return 2};Object.defineProperties(D,iu);function su(n){this.message=n||""}su.prototype=new Error;su.prototype.name="EmptyStackException";function Ur(){this.array_=[]}Ur.prototype=new lr;Ur.prototype.add=function(n){return this.array_.push(n),!0};Ur.prototype.get=function(n){if(n<0||n>=this.size())throw new Error;return this.array_[n]};Ur.prototype.push=function(n){return this.array_.push(n),n};Ur.prototype.pop=function(n){if(this.array_.length===0)throw new su;return this.array_.pop()};Ur.prototype.peek=function(){if(this.array_.length===0)throw new su;return this.array_[this.array_.length-1]};Ur.prototype.empty=function(){return this.array_.length===0};Ur.prototype.isEmpty=function(){return this.empty()};Ur.prototype.search=function(n){return this.array_.indexOf(n)};Ur.prototype.size=function(){return this.array_.length};Ur.prototype.toArray=function(){for(var n=this,t=[],e=0,r=this.array_.length;e<r;e++)t.push(n.array_[e]);return t};var Or=function(){this._minIndex=-1,this._minCoord=null,this._minDe=null,this._orientedDe=null};Or.prototype.getCoordinate=function(){return this._minCoord};Or.prototype.getRightmostSide=function(t,e){var r=this.getRightmostSideOfSegment(t,e);return r<0&&(r=this.getRightmostSideOfSegment(t,e-1)),r<0&&(this._minCoord=null,this.checkForRightmostCoordinate(t)),r};Or.prototype.findRightmostEdgeAtVertex=function(){var t=this._minDe.getEdge().getCoordinates();et.isTrue(this._minIndex>0&&this._minIndex<t.length,"rightmost point expected to be interior vertex of edge");var e=t[this._minIndex-1],r=t[this._minIndex+1],i=G.computeOrientation(this._minCoord,r,e),s=!1;(e.y<this._minCoord.y&&r.y<this._minCoord.y&&i===G.COUNTERCLOCKWISE||e.y>this._minCoord.y&&r.y>this._minCoord.y&&i===G.CLOCKWISE)&&(s=!0),s&&(this._minIndex=this._minIndex-1)};Or.prototype.getRightmostSideOfSegment=function(t,e){var r=t.getEdge(),i=r.getCoordinates();if(e<0||e+1>=i.length||i[e].y===i[e+1].y)return-1;var s=D.LEFT;return i[e].y<i[e+1].y&&(s=D.RIGHT),s};Or.prototype.getEdge=function(){return this._orientedDe};Or.prototype.checkForRightmostCoordinate=function(t){for(var e=this,r=t.getEdge().getCoordinates(),i=0;i<r.length-1;i++)(e._minCoord===null||r[i].x>e._minCoord.x)&&(e._minDe=t,e._minIndex=i,e._minCoord=r[i])};Or.prototype.findRightmostEdgeAtNode=function(){var t=this._minDe.getNode(),e=t.getEdges();this._minDe=e.getRightmostEdge(),this._minDe.isForward()||(this._minDe=this._minDe.getSym(),this._minIndex=this._minDe.getEdge().getCoordinates().length-1)};Or.prototype.findEdge=function(t){for(var e=this,r=t.iterator();r.hasNext();){var i=r.next();i.isForward()&&e.checkForRightmostCoordinate(i)}et.isTrue(this._minIndex!==0||this._minCoord.equals(this._minDe.getCoordinate()),"inconsistency in rightmost processing"),this._minIndex===0?this.findRightmostEdgeAtNode():this.findRightmostEdgeAtVertex(),this._orientedDe=this._minDe;var s=this.getRightmostSide(this._minDe,this._minIndex);s===D.LEFT&&(this._orientedDe=this._minDe.getSym())};Or.prototype.interfaces_=function(){return[]};Or.prototype.getClass=function(){return Or};var yn=function(n){function t(e,r){n.call(this,t.msgWithCoord(e,r)),this.pt=r?new P(r):null,this.name="TopologyException"}return n&&(t.__proto__=n),t.prototype=Object.create(n&&n.prototype),t.prototype.constructor=t,t.prototype.getCoordinate=function(){return this.pt},t.prototype.interfaces_=function(){return[]},t.prototype.getClass=function(){return t},t.msgWithCoord=function(r,i){return i?r:r+" [ "+i+" ]"},t}(mn),ou=function(){this.array_=[]};ou.prototype.addLast=function(t){this.array_.push(t)};ou.prototype.removeFirst=function(){return this.array_.shift()};ou.prototype.isEmpty=function(){return this.array_.length===0};var be=function(){this._finder=null,this._dirEdgeList=new k,this._nodes=new k,this._rightMostCoord=null,this._env=null,this._finder=new Or};be.prototype.clearVisitedEdges=function(){for(var t=this._dirEdgeList.iterator();t.hasNext();){var e=t.next();e.setVisited(!1)}};be.prototype.getRightmostCoordinate=function(){return this._rightMostCoord};be.prototype.computeNodeDepth=function(t){for(var e=this,r=null,i=t.getEdges().iterator();i.hasNext();){var s=i.next();if(s.isVisited()||s.getSym().isVisited()){r=s;break}}if(r===null)throw new yn("unable to find edge to compute depths at "+t.getCoordinate());t.getEdges().computeDepths(r);for(var o=t.getEdges().iterator();o.hasNext();){var a=o.next();a.setVisited(!0),e.copySymDepths(a)}};be.prototype.computeDepth=function(t){this.clearVisitedEdges();var e=this._finder.getEdge();e.setEdgeDepths(D.RIGHT,t),this.copySymDepths(e),this.computeDepths(e)};be.prototype.create=function(t){this.addReachable(t),this._finder.findEdge(this._dirEdgeList),this._rightMostCoord=this._finder.getCoordinate()};be.prototype.findResultEdges=function(){for(var t=this._dirEdgeList.iterator();t.hasNext();){var e=t.next();e.getDepth(D.RIGHT)>=1&&e.getDepth(D.LEFT)<=0&&!e.isInteriorAreaEdge()&&e.setInResult(!0)}};be.prototype.computeDepths=function(t){var e=this,r=new ml,i=new ou,s=t.getNode();for(i.addLast(s),r.add(s),t.setVisited(!0);!i.isEmpty();){var o=i.removeFirst();r.add(o),e.computeNodeDepth(o);for(var a=o.getEdges().iterator();a.hasNext();){var u=a.next(),l=u.getSym();if(!l.isVisited()){var c=l.getNode();r.contains(c)||(i.addLast(c),r.add(c))}}}};be.prototype.compareTo=function(t){var e=t;return this._rightMostCoord.x<e._rightMostCoord.x?-1:this._rightMostCoord.x>e._rightMostCoord.x?1:0};be.prototype.getEnvelope=function(){if(this._env===null){for(var t=new W,e=this._dirEdgeList.iterator();e.hasNext();)for(var r=e.next(),i=r.getEdge().getCoordinates(),s=0;s<i.length-1;s++)t.expandToInclude(i[s]);this._env=t}return this._env};be.prototype.addReachable=function(t){var e=this,r=new Ur;for(r.add(t);!r.empty();){var i=r.pop();e.add(i,r)}};be.prototype.copySymDepths=function(t){var e=t.getSym();e.setDepth(D.LEFT,t.getDepth(D.RIGHT)),e.setDepth(D.RIGHT,t.getDepth(D.LEFT))};be.prototype.add=function(t,e){var r=this;t.setVisited(!0),this._nodes.add(t);for(var i=t.getEdges().iterator();i.hasNext();){var s=i.next();r._dirEdgeList.add(s);var o=s.getSym(),a=o.getNode();a.isVisited()||e.push(a)}};be.prototype.getNodes=function(){return this._nodes};be.prototype.getDirectedEdges=function(){return this._dirEdgeList};be.prototype.interfaces_=function(){return[sr]};be.prototype.getClass=function(){return be};var Ct=function n(){var t=this;if(this.location=null,arguments.length===1){if(arguments[0]instanceof Array){var e=arguments[0];this.init(e.length)}else if(Number.isInteger(arguments[0])){var r=arguments[0];this.init(1),this.location[D.ON]=r}else if(arguments[0]instanceof n){var i=arguments[0];if(this.init(i.location.length),i!==null)for(var s=0;s<this.location.length;s++)t.location[s]=i.location[s]}}else if(arguments.length===3){var o=arguments[0],a=arguments[1],u=arguments[2];this.init(3),this.location[D.ON]=o,this.location[D.LEFT]=a,this.location[D.RIGHT]=u}};Ct.prototype.setAllLocations=function(t){for(var e=this,r=0;r<this.location.length;r++)e.location[r]=t};Ct.prototype.isNull=function(){for(var t=this,e=0;e<this.location.length;e++)if(t.location[e]!==R.NONE)return!1;return!0};Ct.prototype.setAllLocationsIfNull=function(t){for(var e=this,r=0;r<this.location.length;r++)e.location[r]===R.NONE&&(e.location[r]=t)};Ct.prototype.isLine=function(){return this.location.length===1};Ct.prototype.merge=function(t){var e=this;if(t.location.length>this.location.length){var r=new Array(3).fill(null);r[D.ON]=this.location[D.ON],r[D.LEFT]=R.NONE,r[D.RIGHT]=R.NONE,this.location=r}for(var i=0;i<this.location.length;i++)e.location[i]===R.NONE&&i<t.location.length&&(e.location[i]=t.location[i])};Ct.prototype.getLocations=function(){return this.location};Ct.prototype.flip=function(){if(this.location.length<=1)return null;var t=this.location[D.LEFT];this.location[D.LEFT]=this.location[D.RIGHT],this.location[D.RIGHT]=t};Ct.prototype.toString=function(){var t=new zr;return this.location.length>1&&t.append(R.toLocationSymbol(this.location[D.LEFT])),t.append(R.toLocationSymbol(this.location[D.ON])),this.location.length>1&&t.append(R.toLocationSymbol(this.location[D.RIGHT])),t.toString()};Ct.prototype.setLocations=function(t,e,r){this.location[D.ON]=t,this.location[D.LEFT]=e,this.location[D.RIGHT]=r};Ct.prototype.get=function(t){return t<this.location.length?this.location[t]:R.NONE};Ct.prototype.isArea=function(){return this.location.length>1};Ct.prototype.isAnyNull=function(){for(var t=this,e=0;e<this.location.length;e++)if(t.location[e]===R.NONE)return!0;return!1};Ct.prototype.setLocation=function(){if(arguments.length===1){var t=arguments[0];this.setLocation(D.ON,t)}else if(arguments.length===2){var e=arguments[0],r=arguments[1];this.location[e]=r}};Ct.prototype.init=function(t){this.location=new Array(t).fill(null),this.setAllLocations(R.NONE)};Ct.prototype.isEqualOnSide=function(t,e){return this.location[e]===t.location[e]};Ct.prototype.allPositionsEqual=function(t){for(var e=this,r=0;r<this.location.length;r++)if(e.location[r]!==t)return!1;return!0};Ct.prototype.interfaces_=function(){return[]};Ct.prototype.getClass=function(){return Ct};var vt=function n(){if(this.elt=new Array(2).fill(null),arguments.length===1){if(Number.isInteger(arguments[0])){var t=arguments[0];this.elt[0]=new Ct(t),this.elt[1]=new Ct(t)}else if(arguments[0]instanceof n){var e=arguments[0];this.elt[0]=new Ct(e.elt[0]),this.elt[1]=new Ct(e.elt[1])}}else if(arguments.length===2){var r=arguments[0],i=arguments[1];this.elt[0]=new Ct(R.NONE),this.elt[1]=new Ct(R.NONE),this.elt[r].setLocation(i)}else if(arguments.length===3){var s=arguments[0],o=arguments[1],a=arguments[2];this.elt[0]=new Ct(s,o,a),this.elt[1]=new Ct(s,o,a)}else if(arguments.length===4){var u=arguments[0],l=arguments[1],c=arguments[2],h=arguments[3];this.elt[0]=new Ct(R.NONE,R.NONE,R.NONE),this.elt[1]=new Ct(R.NONE,R.NONE,R.NONE),this.elt[u].setLocations(l,c,h)}};vt.prototype.getGeometryCount=function(){var t=0;return this.elt[0].isNull()||t++,this.elt[1].isNull()||t++,t};vt.prototype.setAllLocations=function(t,e){this.elt[t].setAllLocations(e)};vt.prototype.isNull=function(t){return this.elt[t].isNull()};vt.prototype.setAllLocationsIfNull=function(){if(arguments.length===1){var t=arguments[0];this.setAllLocationsIfNull(0,t),this.setAllLocationsIfNull(1,t)}else if(arguments.length===2){var e=arguments[0],r=arguments[1];this.elt[e].setAllLocationsIfNull(r)}};vt.prototype.isLine=function(t){return this.elt[t].isLine()};vt.prototype.merge=function(t){for(var e=this,r=0;r<2;r++)e.elt[r]===null&&t.elt[r]!==null?e.elt[r]=new Ct(t.elt[r]):e.elt[r].merge(t.elt[r])};vt.prototype.flip=function(){this.elt[0].flip(),this.elt[1].flip()};vt.prototype.getLocation=function(){if(arguments.length===1){var t=arguments[0];return this.elt[t].get(D.ON)}else if(arguments.length===2){var e=arguments[0],r=arguments[1];return this.elt[e].get(r)}};vt.prototype.toString=function(){var t=new zr;return this.elt[0]!==null&&(t.append("A:"),t.append(this.elt[0].toString())),this.elt[1]!==null&&(t.append(" B:"),t.append(this.elt[1].toString())),t.toString()};vt.prototype.isArea=function(){if(arguments.length===0)return this.elt[0].isArea()||this.elt[1].isArea();if(arguments.length===1){var t=arguments[0];return this.elt[t].isArea()}};vt.prototype.isAnyNull=function(t){return this.elt[t].isAnyNull()};vt.prototype.setLocation=function(){if(arguments.length===2){var t=arguments[0],e=arguments[1];this.elt[t].setLocation(D.ON,e)}else if(arguments.length===3){var r=arguments[0],i=arguments[1],s=arguments[2];this.elt[r].setLocation(i,s)}};vt.prototype.isEqualOnSide=function(t,e){return this.elt[0].isEqualOnSide(t.elt[0],e)&&this.elt[1].isEqualOnSide(t.elt[1],e)};vt.prototype.allPositionsEqual=function(t,e){return this.elt[t].allPositionsEqual(e)};vt.prototype.toLine=function(t){this.elt[t].isArea()&&(this.elt[t]=new Ct(this.elt[t].location[0]))};vt.prototype.interfaces_=function(){return[]};vt.prototype.getClass=function(){return vt};vt.toLineLabel=function(t){for(var e=new vt(R.NONE),r=0;r<2;r++)e.setLocation(r,t.getLocation(r));return e};var qt=function(){this._startDe=null,this._maxNodeDegree=-1,this._edges=new k,this._pts=new k,this._label=new vt(R.NONE),this._ring=null,this._isHole=null,this._shell=null,this._holes=new k,this._geometryFactory=null;var t=arguments[0],e=arguments[1];this._geometryFactory=e,this.computePoints(t),this.computeRing()};qt.prototype.computeRing=function(){var t=this;if(this._ring!==null)return null;for(var e=new Array(this._pts.size()).fill(null),r=0;r<this._pts.size();r++)e[r]=t._pts.get(r);this._ring=this._geometryFactory.createLinearRing(e),this._isHole=G.isCCW(this._ring.getCoordinates())};qt.prototype.isIsolated=function(){return this._label.getGeometryCount()===1};qt.prototype.computePoints=function(t){var e=this;this._startDe=t;var r=t,i=!0;do{if(r===null)throw new yn("Found null DirectedEdge");if(r.getEdgeRing()===e)throw new yn("Directed Edge visited twice during ring-building at "+r.getCoordinate());e._edges.add(r);var s=r.getLabel();et.isTrue(s.isArea()),e.mergeLabel(s),e.addPoints(r.getEdge(),r.isForward(),i),i=!1,e.setEdgeRing(r,e),r=e.getNext(r)}while(r!==this._startDe)};qt.prototype.getLinearRing=function(){return this._ring};qt.prototype.getCoordinate=function(t){return this._pts.get(t)};qt.prototype.computeMaxNodeDegree=function(){var t=this;this._maxNodeDegree=0;var e=this._startDe;do{var r=e.getNode(),i=r.getEdges().getOutgoingDegree(t);i>t._maxNodeDegree&&(t._maxNodeDegree=i),e=t.getNext(e)}while(e!==this._startDe);this._maxNodeDegree*=2};qt.prototype.addPoints=function(t,e,r){var i=this,s=t.getCoordinates();if(e){var o=1;r&&(o=0);for(var a=o;a<s.length;a++)i._pts.add(s[a])}else{var u=s.length-2;r&&(u=s.length-1);for(var l=u;l>=0;l--)i._pts.add(s[l])}};qt.prototype.isHole=function(){return this._isHole};qt.prototype.setInResult=function(){var t=this._startDe;do t.getEdge().setInResult(!0),t=t.getNext();while(t!==this._startDe)};qt.prototype.containsPoint=function(t){var e=this.getLinearRing(),r=e.getEnvelopeInternal();if(!r.contains(t)||!G.isPointInRing(t,e.getCoordinates()))return!1;for(var i=this._holes.iterator();i.hasNext();){var s=i.next();if(s.containsPoint(t))return!1}return!0};qt.prototype.addHole=function(t){this._holes.add(t)};qt.prototype.isShell=function(){return this._shell===null};qt.prototype.getLabel=function(){return this._label};qt.prototype.getEdges=function(){return this._edges};qt.prototype.getMaxNodeDegree=function(){return this._maxNodeDegree<0&&this.computeMaxNodeDegree(),this._maxNodeDegree};qt.prototype.getShell=function(){return this._shell};qt.prototype.mergeLabel=function(){if(arguments.length===1){var t=arguments[0];this.mergeLabel(t,0),this.mergeLabel(t,1)}else if(arguments.length===2){var e=arguments[0],r=arguments[1],i=e.getLocation(r,D.RIGHT);if(i===R.NONE)return null;if(this._label.getLocation(r)===R.NONE)return this._label.setLocation(r,i),null}};qt.prototype.setShell=function(t){this._shell=t,t!==null&&t.addHole(this)};qt.prototype.toPolygon=function(t){for(var e=this,r=new Array(this._holes.size()).fill(null),i=0;i<this._holes.size();i++)r[i]=e._holes.get(i).getLinearRing();var s=t.createPolygon(this.getLinearRing(),r);return s};qt.prototype.interfaces_=function(){return[]};qt.prototype.getClass=function(){return qt};var fg=function(n){function t(){var e=arguments[0],r=arguments[1];n.call(this,e,r)}return n&&(t.__proto__=n),t.prototype=Object.create(n&&n.prototype),t.prototype.constructor=t,t.prototype.setEdgeRing=function(r,i){r.setMinEdgeRing(i)},t.prototype.getNext=function(r){return r.getNextMin()},t.prototype.interfaces_=function(){return[]},t.prototype.getClass=function(){return t},t}(qt),pg=function(n){function t(){var e=arguments[0],r=arguments[1];n.call(this,e,r)}return n&&(t.__proto__=n),t.prototype=Object.create(n&&n.prototype),t.prototype.constructor=t,t.prototype.buildMinimalRings=function(){var r=this,i=new k,s=this._startDe;do{if(s.getMinEdgeRing()===null){var o=new fg(s,r._geometryFactory);i.add(o)}s=s.getNext()}while(s!==this._startDe);return i},t.prototype.setEdgeRing=function(r,i){r.setEdgeRing(i)},t.prototype.linkDirectedEdgesForMinimalEdgeRings=function(){var r=this,i=this._startDe;do{var s=i.getNode();s.getEdges().linkMinimalDirectedEdges(r),i=i.getNext()}while(i!==this._startDe)},t.prototype.getNext=function(r){return r.getNext()},t.prototype.interfaces_=function(){return[]},t.prototype.getClass=function(){return t},t}(qt),Xe=function(){if(this._label=null,this._isInResult=!1,this._isCovered=!1,this._isCoveredSet=!1,this._isVisited=!1,arguments.length!==0){if(arguments.length===1){var t=arguments[0];this._label=t}}};Xe.prototype.setVisited=function(t){this._isVisited=t};Xe.prototype.setInResult=function(t){this._isInResult=t};Xe.prototype.isCovered=function(){return this._isCovered};Xe.prototype.isCoveredSet=function(){return this._isCoveredSet};Xe.prototype.setLabel=function(t){this._label=t};Xe.prototype.getLabel=function(){return this._label};Xe.prototype.setCovered=function(t){this._isCovered=t,this._isCoveredSet=!0};Xe.prototype.updateIM=function(t){et.isTrue(this._label.getGeometryCount()>=2,"found partial label"),this.computeIM(t)};Xe.prototype.isInResult=function(){return this._isInResult};Xe.prototype.isVisited=function(){return this._isVisited};Xe.prototype.interfaces_=function(){return[]};Xe.prototype.getClass=function(){return Xe};var au=function(n){function t(){n.call(this),this._coord=null,this._edges=null;var e=arguments[0],r=arguments[1];this._coord=e,this._edges=r,this._label=new vt(0,R.NONE)}return n&&(t.__proto__=n),t.prototype=Object.create(n&&n.prototype),t.prototype.constructor=t,t.prototype.isIncidentEdgeInResult=function(){for(var r=this.getEdges().getEdges().iterator();r.hasNext();){var i=r.next();if(i.getEdge().isInResult())return!0}return!1},t.prototype.isIsolated=function(){return this._label.getGeometryCount()===1},t.prototype.getCoordinate=function(){return this._coord},t.prototype.print=function(r){r.println("node "+this._coord+" lbl: "+this._label)},t.prototype.computeIM=function(r){},t.prototype.computeMergedLocation=function(r,i){var s=R.NONE;if(s=this._label.getLocation(i),!r.isNull(i)){var o=r.getLocation(i);s!==R.BOUNDARY&&(s=o)}return s},t.prototype.setLabel=function(){if(arguments.length===2){var r=arguments[0],i=arguments[1];this._label===null?this._label=new vt(r,i):this._label.setLocation(r,i)}else return n.prototype.setLabel.apply(this,arguments)},t.prototype.getEdges=function(){return this._edges},t.prototype.mergeLabel=function(){var r=this;if(arguments[0]instanceof t){var i=arguments[0];this.mergeLabel(i._label)}else if(arguments[0]instanceof vt)for(var s=arguments[0],o=0;o<2;o++){var a=r.computeMergedLocation(s,o),u=r._label.getLocation(o);u===R.NONE&&r._label.setLocation(o,a)}},t.prototype.add=function(r){this._edges.insert(r),r.setNode(this)},t.prototype.setLabelBoundary=function(r){if(this._label===null)return null;var i=R.NONE;this._label!==null&&(i=this._label.getLocation(r));var s=null;switch(i){case R.BOUNDARY:s=R.INTERIOR;break;case R.INTERIOR:s=R.BOUNDARY;break;default:s=R.BOUNDARY;break}this._label.setLocation(r,s)},t.prototype.interfaces_=function(){return[]},t.prototype.getClass=function(){return t},t}(Xe),Dr=function(){this.nodeMap=new me,this.nodeFact=null;var t=arguments[0];this.nodeFact=t};Dr.prototype.find=function(t){return this.nodeMap.get(t)};Dr.prototype.addNode=function(){if(arguments[0]instanceof P){var t=arguments[0],e=this.nodeMap.get(t);return e===null&&(e=this.nodeFact.createNode(t),this.nodeMap.put(t,e)),e}else if(arguments[0]instanceof au){var r=arguments[0],i=this.nodeMap.get(r.getCoordinate());return i===null?(this.nodeMap.put(r.getCoordinate(),r),r):(i.mergeLabel(r),i)}};Dr.prototype.print=function(t){for(var e=this.iterator();e.hasNext();){var r=e.next();r.print(t)}};Dr.prototype.iterator=function(){return this.nodeMap.values().iterator()};Dr.prototype.values=function(){return this.nodeMap.values()};Dr.prototype.getBoundaryNodes=function(t){for(var e=new k,r=this.iterator();r.hasNext();){var i=r.next();i.getLabel().getLocation(t)===R.BOUNDARY&&e.add(i)}return e};Dr.prototype.add=function(t){var e=t.getCoordinate(),r=this.addNode(e);r.add(t)};Dr.prototype.interfaces_=function(){return[]};Dr.prototype.getClass=function(){return Dr};var wt=function(){},Ao={NE:{configurable:!0},NW:{configurable:!0},SW:{configurable:!0},SE:{configurable:!0}};wt.prototype.interfaces_=function(){return[]};wt.prototype.getClass=function(){return wt};wt.isNorthern=function(t){return t===wt.NE||t===wt.NW};wt.isOpposite=function(t,e){if(t===e)return!1;var r=(t-e+4)%4;return r===2};wt.commonHalfPlane=function(t,e){if(t===e)return t;var r=(t-e+4)%4;if(r===2)return-1;var i=t<e?t:e,s=t>e?t:e;return i===0&&s===3?3:i};wt.isInHalfPlane=function(t,e){return e===wt.SE?t===wt.SE||t===wt.SW:t===e||t===e+1};wt.quadrant=function(){if(typeof arguments[0]=="number"&&typeof arguments[1]=="number"){var t=arguments[0],e=arguments[1];if(t===0&&e===0)throw new Rt("Cannot compute the quadrant for point ( "+t+", "+e+" )");return t>=0?e>=0?wt.NE:wt.SE:e>=0?wt.NW:wt.SW}else if(arguments[0]instanceof P&&arguments[1]instanceof P){var r=arguments[0],i=arguments[1];if(i.x===r.x&&i.y===r.y)throw new Rt("Cannot compute the quadrant for two identical points "+r);return i.x>=r.x?i.y>=r.y?wt.NE:wt.SE:i.y>=r.y?wt.NW:wt.SW}};Ao.NE.get=function(){return 0};Ao.NW.get=function(){return 1};Ao.SW.get=function(){return 2};Ao.SE.get=function(){return 3};Object.defineProperties(wt,Ao);var ve=function(){if(this._edge=null,this._label=null,this._node=null,this._p0=null,this._p1=null,this._dx=null,this._dy=null,this._quadrant=null,arguments.length===1){var t=arguments[0];this._edge=t}else if(arguments.length===3){var e=arguments[0],r=arguments[1],i=arguments[2],s=null;this._edge=e,this.init(r,i),this._label=s}else if(arguments.length===4){var o=arguments[0],a=arguments[1],u=arguments[2],l=arguments[3];this._edge=o,this.init(a,u),this._label=l}};ve.prototype.compareDirection=function(t){return this._dx===t._dx&&this._dy===t._dy?0:this._quadrant>t._quadrant?1:this._quadrant<t._quadrant?-1:G.computeOrientation(t._p0,t._p1,this._p1)};ve.prototype.getDy=function(){return this._dy};ve.prototype.getCoordinate=function(){return this._p0};ve.prototype.setNode=function(t){this._node=t};ve.prototype.print=function(t){var e=Math.atan2(this._dy,this._dx),r=this.getClass().getName(),i=r.lastIndexOf("."),s=r.substring(i+1);t.print("  "+s+": "+this._p0+" - "+this._p1+" "+this._quadrant+":"+e+"   "+this._label)};ve.prototype.compareTo=function(t){var e=t;return this.compareDirection(e)};ve.prototype.getDirectedCoordinate=function(){return this._p1};ve.prototype.getDx=function(){return this._dx};ve.prototype.getLabel=function(){return this._label};ve.prototype.getEdge=function(){return this._edge};ve.prototype.getQuadrant=function(){return this._quadrant};ve.prototype.getNode=function(){return this._node};ve.prototype.toString=function(){var t=Math.atan2(this._dy,this._dx),e=this.getClass().getName(),r=e.lastIndexOf("."),i=e.substring(r+1);return"  "+i+": "+this._p0+" - "+this._p1+" "+this._quadrant+":"+t+"   "+this._label};ve.prototype.computeLabel=function(t){};ve.prototype.init=function(t,e){this._p0=t,this._p1=e,this._dx=e.x-t.x,this._dy=e.y-t.y,this._quadrant=wt.quadrant(this._dx,this._dy),et.isTrue(!(this._dx===0&&this._dy===0),"EdgeEnd with identical endpoints found")};ve.prototype.interfaces_=function(){return[sr]};ve.prototype.getClass=function(){return ve};var Yu=function(n){function t(){var e=arguments[0],r=arguments[1];if(n.call(this,e),this._isForward=null,this._isInResult=!1,this._isVisited=!1,this._sym=null,this._next=null,this._nextMin=null,this._edgeRing=null,this._minEdgeRing=null,this._depth=[0,-999,-999],this._isForward=r,r)this.init(e.getCoordinate(0),e.getCoordinate(1));else{var i=e.getNumPoints()-1;this.init(e.getCoordinate(i),e.getCoordinate(i-1))}this.computeDirectedLabel()}return n&&(t.__proto__=n),t.prototype=Object.create(n&&n.prototype),t.prototype.constructor=t,t.prototype.getNextMin=function(){return this._nextMin},t.prototype.getDepth=function(r){return this._depth[r]},t.prototype.setVisited=function(r){this._isVisited=r},t.prototype.computeDirectedLabel=function(){this._label=new vt(this._edge.getLabel()),this._isForward||this._label.flip()},t.prototype.getNext=function(){return this._next},t.prototype.setDepth=function(r,i){if(this._depth[r]!==-999&&this._depth[r]!==i)throw new yn("assigned depths do not match",this.getCoordinate());this._depth[r]=i},t.prototype.isInteriorAreaEdge=function(){for(var r=this,i=!0,s=0;s<2;s++)r._label.isArea(s)&&r._label.getLocation(s,D.LEFT)===R.INTERIOR&&r._label.getLocation(s,D.RIGHT)===R.INTERIOR||(i=!1);return i},t.prototype.setNextMin=function(r){this._nextMin=r},t.prototype.print=function(r){n.prototype.print.call(this,r),r.print(" "+this._depth[D.LEFT]+"/"+this._depth[D.RIGHT]),r.print(" ("+this.getDepthDelta()+")"),this._isInResult&&r.print(" inResult")},t.prototype.setMinEdgeRing=function(r){this._minEdgeRing=r},t.prototype.isLineEdge=function(){var r=this._label.isLine(0)||this._label.isLine(1),i=!this._label.isArea(0)||this._label.allPositionsEqual(0,R.EXTERIOR),s=!this._label.isArea(1)||this._label.allPositionsEqual(1,R.EXTERIOR);return r&&i&&s},t.prototype.setEdgeRing=function(r){this._edgeRing=r},t.prototype.getMinEdgeRing=function(){return this._minEdgeRing},t.prototype.getDepthDelta=function(){var r=this._edge.getDepthDelta();return this._isForward||(r=-r),r},t.prototype.setInResult=function(r){this._isInResult=r},t.prototype.getSym=function(){return this._sym},t.prototype.isForward=function(){return this._isForward},t.prototype.getEdge=function(){return this._edge},t.prototype.printEdge=function(r){this.print(r),r.print(" "),this._isForward?this._edge.print(r):this._edge.printReverse(r)},t.prototype.setSym=function(r){this._sym=r},t.prototype.setVisitedEdge=function(r){this.setVisited(r),this._sym.setVisited(r)},t.prototype.setEdgeDepths=function(r,i){var s=this.getEdge().getDepthDelta();this._isForward||(s=-s);var o=1;r===D.LEFT&&(o=-1);var a=D.opposite(r),u=s*o,l=i+u;this.setDepth(r,i),this.setDepth(a,l)},t.prototype.getEdgeRing=function(){return this._edgeRing},t.prototype.isInResult=function(){return this._isInResult},t.prototype.setNext=function(r){this._next=r},t.prototype.isVisited=function(){return this._isVisited},t.prototype.interfaces_=function(){return[]},t.prototype.getClass=function(){return t},t.depthFactor=function(r,i){return r===R.EXTERIOR&&i===R.INTERIOR?1:r===R.INTERIOR&&i===R.EXTERIOR?-1:0},t}(ve),ls=function(){};ls.prototype.createNode=function(t){return new au(t,null)};ls.prototype.interfaces_=function(){return[]};ls.prototype.getClass=function(){return ls};var At=function(){if(this._edges=new k,this._nodes=null,this._edgeEndList=new k,arguments.length===0)this._nodes=new Dr(new ls);else if(arguments.length===1){var t=arguments[0];this._nodes=new Dr(t)}};At.prototype.printEdges=function(t){var e=this;t.println("Edges:");for(var r=0;r<this._edges.size();r++){t.println("edge "+r+":");var i=e._edges.get(r);i.print(t),i.eiList.print(t)}};At.prototype.find=function(t){return this._nodes.find(t)};At.prototype.addNode=function(){if(arguments[0]instanceof au){var t=arguments[0];return this._nodes.addNode(t)}else if(arguments[0]instanceof P){var e=arguments[0];return this._nodes.addNode(e)}};At.prototype.getNodeIterator=function(){return this._nodes.iterator()};At.prototype.linkResultDirectedEdges=function(){for(var t=this._nodes.iterator();t.hasNext();){var e=t.next();e.getEdges().linkResultDirectedEdges()}};At.prototype.debugPrintln=function(t){le.out.println(t)};At.prototype.isBoundaryNode=function(t,e){var r=this._nodes.find(e);if(r===null)return!1;var i=r.getLabel();return i!==null&&i.getLocation(t)===R.BOUNDARY};At.prototype.linkAllDirectedEdges=function(){for(var t=this._nodes.iterator();t.hasNext();){var e=t.next();e.getEdges().linkAllDirectedEdges()}};At.prototype.matchInSameDirection=function(t,e,r,i){return t.equals(r)?G.computeOrientation(t,e,i)===G.COLLINEAR&&wt.quadrant(t,e)===wt.quadrant(r,i):!1};At.prototype.getEdgeEnds=function(){return this._edgeEndList};At.prototype.debugPrint=function(t){le.out.print(t)};At.prototype.getEdgeIterator=function(){return this._edges.iterator()};At.prototype.findEdgeInSameDirection=function(t,e){for(var r=this,i=0;i<this._edges.size();i++){var s=r._edges.get(i),o=s.getCoordinates();if(r.matchInSameDirection(t,e,o[0],o[1])||r.matchInSameDirection(t,e,o[o.length-1],o[o.length-2]))return s}return null};At.prototype.insertEdge=function(t){this._edges.add(t)};At.prototype.findEdgeEnd=function(t){for(var e=this.getEdgeEnds().iterator();e.hasNext();){var r=e.next();if(r.getEdge()===t)return r}return null};At.prototype.addEdges=function(t){for(var e=this,r=t.iterator();r.hasNext();){var i=r.next();e._edges.add(i);var s=new Yu(i,!0),o=new Yu(i,!1);s.setSym(o),o.setSym(s),e.add(s),e.add(o)}};At.prototype.add=function(t){this._nodes.add(t),this._edgeEndList.add(t)};At.prototype.getNodes=function(){return this._nodes.values()};At.prototype.findEdge=function(t,e){for(var r=this,i=0;i<this._edges.size();i++){var s=r._edges.get(i),o=s.getCoordinates();if(t.equals(o[0])&&e.equals(o[1]))return s}return null};At.prototype.interfaces_=function(){return[]};At.prototype.getClass=function(){return At};At.linkResultDirectedEdges=function(t){for(var e=t.iterator();e.hasNext();){var r=e.next();r.getEdges().linkResultDirectedEdges()}};var Ge=function(){this._geometryFactory=null,this._shellList=new k;var t=arguments[0];this._geometryFactory=t};Ge.prototype.sortShellsAndHoles=function(t,e,r){for(var i=t.iterator();i.hasNext();){var s=i.next();s.isHole()?r.add(s):e.add(s)}};Ge.prototype.computePolygons=function(t){for(var e=this,r=new k,i=t.iterator();i.hasNext();){var s=i.next(),o=s.toPolygon(e._geometryFactory);r.add(o)}return r};Ge.prototype.placeFreeHoles=function(t,e){for(var r=this,i=e.iterator();i.hasNext();){var s=i.next();if(s.getShell()===null){var o=r.findEdgeRingContaining(s,t);if(o===null)throw new yn("unable to assign hole to a shell",s.getCoordinate(0));s.setShell(o)}}};Ge.prototype.buildMinimalEdgeRings=function(t,e,r){for(var i=this,s=new k,o=t.iterator();o.hasNext();){var a=o.next();if(a.getMaxNodeDegree()>2){a.linkDirectedEdgesForMinimalEdgeRings();var u=a.buildMinimalRings(),l=i.findShell(u);l!==null?(i.placePolygonHoles(l,u),e.add(l)):r.addAll(u)}else s.add(a)}return s};Ge.prototype.containsPoint=function(t){for(var e=this._shellList.iterator();e.hasNext();){var r=e.next();if(r.containsPoint(t))return!0}return!1};Ge.prototype.buildMaximalEdgeRings=function(t){for(var e=this,r=new k,i=t.iterator();i.hasNext();){var s=i.next();if(s.isInResult()&&s.getLabel().isArea()&&s.getEdgeRing()===null){var o=new pg(s,e._geometryFactory);r.add(o),o.setInResult()}}return r};Ge.prototype.placePolygonHoles=function(t,e){for(var r=e.iterator();r.hasNext();){var i=r.next();i.isHole()&&i.setShell(t)}};Ge.prototype.getPolygons=function(){var t=this.computePolygons(this._shellList);return t};Ge.prototype.findEdgeRingContaining=function(t,e){for(var r=t.getLinearRing(),i=r.getEnvelopeInternal(),s=r.getCoordinateN(0),o=null,a=null,u=e.iterator();u.hasNext();){var l=u.next(),c=l.getLinearRing(),h=c.getEnvelopeInternal();o!==null&&(a=o.getLinearRing().getEnvelopeInternal());var f=!1;h.contains(i)&&G.isPointInRing(s,c.getCoordinates())&&(f=!0),f&&(o===null||a.contains(h))&&(o=l)}return o};Ge.prototype.findShell=function(t){for(var e=0,r=null,i=t.iterator();i.hasNext();){var s=i.next();s.isHole()||(r=s,e++)}return et.isTrue(e<=1,"found two shells in MinimalEdgeRing list"),r};Ge.prototype.add=function(){if(arguments.length===1){var t=arguments[0];this.add(t.getEdgeEnds(),t.getNodes())}else if(arguments.length===2){var e=arguments[0],r=arguments[1];At.linkResultDirectedEdges(r);var i=this.buildMaximalEdgeRings(e),s=new k,o=this.buildMinimalEdgeRings(i,this._shellList,s);this.sortShellsAndHoles(o,this._shellList,s),this.placeFreeHoles(this._shellList,s)}};Ge.prototype.interfaces_=function(){return[]};Ge.prototype.getClass=function(){return Ge};var cs=function(){};cs.prototype.getBounds=function(){};cs.prototype.interfaces_=function(){return[]};cs.prototype.getClass=function(){return cs};var pr=function(){this._bounds=null,this._item=null;var t=arguments[0],e=arguments[1];this._bounds=t,this._item=e};pr.prototype.getItem=function(){return this._item};pr.prototype.getBounds=function(){return this._bounds};pr.prototype.interfaces_=function(){return[cs,or]};pr.prototype.getClass=function(){return pr};var _n=function(){this._size=null,this._items=null,this._size=0,this._items=new k,this._items.add(null)};_n.prototype.poll=function(){if(this.isEmpty())return null;var t=this._items.get(1);return this._items.set(1,this._items.get(this._size)),this._size-=1,this.reorder(1),t};_n.prototype.size=function(){return this._size};_n.prototype.reorder=function(t){for(var e=this,r=null,i=this._items.get(t);t*2<=this._size&&(r=t*2,r!==e._size&&e._items.get(r+1).compareTo(e._items.get(r))<0&&r++,e._items.get(r).compareTo(i)<0);t=r)e._items.set(t,e._items.get(r));this._items.set(t,i)};_n.prototype.clear=function(){this._size=0,this._items.clear()};_n.prototype.isEmpty=function(){return this._size===0};_n.prototype.add=function(t){var e=this;this._items.add(null),this._size+=1;var r=this._size;for(this._items.set(0,t);t.compareTo(this._items.get(Math.trunc(r/2)))<0;r/=2)e._items.set(r,e._items.get(Math.trunc(r/2)));this._items.set(r,t)};_n.prototype.interfaces_=function(){return[]};_n.prototype.getClass=function(){return _n};var Un=function(){};Un.prototype.visitItem=function(t){};Un.prototype.interfaces_=function(){return[]};Un.prototype.getClass=function(){return Un};var Ci=function(){};Ci.prototype.insert=function(t,e){};Ci.prototype.remove=function(t,e){};Ci.prototype.query=function(){};Ci.prototype.interfaces_=function(){return[]};Ci.prototype.getClass=function(){return Ci};var Ht=function(){if(this._childBoundables=new k,this._bounds=null,this._level=null,arguments.length!==0){if(arguments.length===1){var t=arguments[0];this._level=t}}},xh={serialVersionUID:{configurable:!0}};Ht.prototype.getLevel=function(){return this._level};Ht.prototype.size=function(){return this._childBoundables.size()};Ht.prototype.getChildBoundables=function(){return this._childBoundables};Ht.prototype.addChildBoundable=function(t){et.isTrue(this._bounds===null),this._childBoundables.add(t)};Ht.prototype.isEmpty=function(){return this._childBoundables.isEmpty()};Ht.prototype.getBounds=function(){return this._bounds===null&&(this._bounds=this.computeBounds()),this._bounds};Ht.prototype.interfaces_=function(){return[cs,or]};Ht.prototype.getClass=function(){return Ht};xh.serialVersionUID.get=function(){return 6493722185909574e3};Object.defineProperties(Ht,xh);var gr=function(){};gr.reverseOrder=function(){return{compare:function(e,r){return r.compareTo(e)}}};gr.min=function(t){return gr.sort(t),t.get(0)};gr.sort=function(t,e){var r=t.toArray();e?ei.sort(r,e):ei.sort(r);for(var i=t.iterator(),s=0,o=r.length;s<o;s++)i.next(),i.set(r[s])};gr.singletonList=function(t){var e=new k;return e.add(t),e};var jt=function(){this._boundable1=null,this._boundable2=null,this._distance=null,this._itemDistance=null;var t=arguments[0],e=arguments[1],r=arguments[2];this._boundable1=t,this._boundable2=e,this._itemDistance=r,this._distance=this.distance()};jt.prototype.expandToQueue=function(t,e){var r=jt.isComposite(this._boundable1),i=jt.isComposite(this._boundable2);if(r&&i)return jt.area(this._boundable1)>jt.area(this._boundable2)?(this.expand(this._boundable1,this._boundable2,t,e),null):(this.expand(this._boundable2,this._boundable1,t,e),null);if(r)return this.expand(this._boundable1,this._boundable2,t,e),null;if(i)return this.expand(this._boundable2,this._boundable1,t,e),null;throw new Rt("neither boundable is composite")};jt.prototype.isLeaves=function(){return!(jt.isComposite(this._boundable1)||jt.isComposite(this._boundable2))};jt.prototype.compareTo=function(t){var e=t;return this._distance<e._distance?-1:this._distance>e._distance?1:0};jt.prototype.expand=function(t,e,r,i){for(var s=this,o=t.getChildBoundables(),a=o.iterator();a.hasNext();){var u=a.next(),l=new jt(u,e,s._itemDistance);l.getDistance()<i&&r.add(l)}};jt.prototype.getBoundable=function(t){return t===0?this._boundable1:this._boundable2};jt.prototype.getDistance=function(){return this._distance};jt.prototype.distance=function(){return this.isLeaves()?this._itemDistance.distance(this._boundable1,this._boundable2):this._boundable1.getBounds().distance(this._boundable2.getBounds())};jt.prototype.interfaces_=function(){return[sr]};jt.prototype.getClass=function(){return jt};jt.area=function(t){return t.getBounds().getArea()};jt.isComposite=function(t){return t instanceof Ht};var ee=function n(){if(this._root=null,this._built=!1,this._itemBoundables=new k,this._nodeCapacity=null,arguments.length===0){var t=n.DEFAULT_NODE_CAPACITY;this._nodeCapacity=t}else if(arguments.length===1){var e=arguments[0];et.isTrue(e>1,"Node capacity must be greater than 1"),this._nodeCapacity=e}},uu={IntersectsOp:{configurable:!0},serialVersionUID:{configurable:!0},DEFAULT_NODE_CAPACITY:{configurable:!0}};ee.prototype.getNodeCapacity=function(){return this._nodeCapacity};ee.prototype.lastNode=function(t){return t.get(t.size()-1)};ee.prototype.size=function(){var t=this;if(arguments.length===0)return this.isEmpty()?0:(this.build(),this.size(this._root));if(arguments.length===1){for(var e=arguments[0],r=0,i=e.getChildBoundables().iterator();i.hasNext();){var s=i.next();s instanceof Ht?r+=t.size(s):s instanceof pr&&(r+=1)}return r}};ee.prototype.removeItem=function(t,e){for(var r=null,i=t.getChildBoundables().iterator();i.hasNext();){var s=i.next();s instanceof pr&&s.getItem()===e&&(r=s)}return r!==null?(t.getChildBoundables().remove(r),!0):!1};ee.prototype.itemsTree=function(){var t=this;if(arguments.length===0){this.build();var e=this.itemsTree(this._root);return e===null?new k:e}else if(arguments.length===1){for(var r=arguments[0],i=new k,s=r.getChildBoundables().iterator();s.hasNext();){var o=s.next();if(o instanceof Ht){var a=t.itemsTree(o);a!==null&&i.add(a)}else o instanceof pr?i.add(o.getItem()):et.shouldNeverReachHere()}return i.size()<=0?null:i}};ee.prototype.insert=function(t,e){et.isTrue(!this._built,"Cannot insert items into an STR packed R-tree after it has been built."),this._itemBoundables.add(new pr(t,e))};ee.prototype.boundablesAtLevel=function(){var t=this;if(arguments.length===1){var e=arguments[0],r=new k;return this.boundablesAtLevel(e,this._root,r),r}else if(arguments.length===3){var i=arguments[0],s=arguments[1],o=arguments[2];if(et.isTrue(i>-2),s.getLevel()===i)return o.add(s),null;for(var a=s.getChildBoundables().iterator();a.hasNext();){var u=a.next();u instanceof Ht?t.boundablesAtLevel(i,u,o):(et.isTrue(u instanceof pr),i===-1&&o.add(u))}return null}};ee.prototype.query=function(){var t=this;if(arguments.length===1){var e=arguments[0];this.build();var r=new k;return this.isEmpty()||this.getIntersectsOp().intersects(this._root.getBounds(),e)&&this.query(e,this._root,r),r}else if(arguments.length===2){var i=arguments[0],s=arguments[1];if(this.build(),this.isEmpty())return null;this.getIntersectsOp().intersects(this._root.getBounds(),i)&&this.query(i,this._root,s)}else if(arguments.length===3){if(H(arguments[2],Un)&&arguments[0]instanceof Object&&arguments[1]instanceof Ht)for(var o=arguments[0],a=arguments[1],u=arguments[2],l=a.getChildBoundables(),c=0;c<l.size();c++){var h=l.get(c);t.getIntersectsOp().intersects(h.getBounds(),o)&&(h instanceof Ht?t.query(o,h,u):h instanceof pr?u.visitItem(h.getItem()):et.shouldNeverReachHere())}else if(H(arguments[2],lr)&&arguments[0]instanceof Object&&arguments[1]instanceof Ht)for(var f=arguments[0],p=arguments[1],d=arguments[2],_=p.getChildBoundables(),w=0;w<_.size();w++){var y=_.get(w);t.getIntersectsOp().intersects(y.getBounds(),f)&&(y instanceof Ht?t.query(f,y,d):y instanceof pr?d.add(y.getItem()):et.shouldNeverReachHere())}}};ee.prototype.build=function(){if(this._built)return null;this._root=this._itemBoundables.isEmpty()?this.createNode(0):this.createHigherLevels(this._itemBoundables,-1),this._itemBoundables=null,this._built=!0};ee.prototype.getRoot=function(){return this.build(),this._root};ee.prototype.remove=function(){var t=this;if(arguments.length===2){var e=arguments[0],r=arguments[1];return this.build(),this.getIntersectsOp().intersects(this._root.getBounds(),e)?this.remove(e,this._root,r):!1}else if(arguments.length===3){var i=arguments[0],s=arguments[1],o=arguments[2],a=this.removeItem(s,o);if(a)return!0;for(var u=null,l=s.getChildBoundables().iterator();l.hasNext();){var c=l.next();if(t.getIntersectsOp().intersects(c.getBounds(),i)&&c instanceof Ht&&(a=t.remove(i,c,o),a)){u=c;break}}return u!==null&&u.getChildBoundables().isEmpty()&&s.getChildBoundables().remove(u),a}};ee.prototype.createHigherLevels=function(t,e){et.isTrue(!t.isEmpty());var r=this.createParentBoundables(t,e+1);return r.size()===1?r.get(0):this.createHigherLevels(r,e+1)};ee.prototype.depth=function(){var t=this;if(arguments.length===0)return this.isEmpty()?0:(this.build(),this.depth(this._root));if(arguments.length===1){for(var e=arguments[0],r=0,i=e.getChildBoundables().iterator();i.hasNext();){var s=i.next();if(s instanceof Ht){var o=t.depth(s);o>r&&(r=o)}}return r+1}};ee.prototype.createParentBoundables=function(t,e){var r=this;et.isTrue(!t.isEmpty());var i=new k;i.add(this.createNode(e));var s=new k(t);gr.sort(s,this.getComparator());for(var o=s.iterator();o.hasNext();){var a=o.next();r.lastNode(i).getChildBoundables().size()===r.getNodeCapacity()&&i.add(r.createNode(e)),r.lastNode(i).addChildBoundable(a)}return i};ee.prototype.isEmpty=function(){return this._built?this._root.isEmpty():this._itemBoundables.isEmpty()};ee.prototype.interfaces_=function(){return[or]};ee.prototype.getClass=function(){return ee};ee.compareDoubles=function(t,e){return t>e?1:t<e?-1:0};uu.IntersectsOp.get=function(){return gg};uu.serialVersionUID.get=function(){return-3886435814360241e3};uu.DEFAULT_NODE_CAPACITY.get=function(){return 10};Object.defineProperties(ee,uu);var gg=function(){},hs=function(){};hs.prototype.distance=function(t,e){};hs.prototype.interfaces_=function(){return[]};hs.prototype.getClass=function(){return hs};var Ih=function(n){function t(r){r=r||t.DEFAULT_NODE_CAPACITY,n.call(this,r)}n&&(t.__proto__=n),t.prototype=Object.create(n&&n.prototype),t.prototype.constructor=t;var e={STRtreeNode:{configurable:!0},serialVersionUID:{configurable:!0},xComparator:{configurable:!0},yComparator:{configurable:!0},intersectsOp:{configurable:!0},DEFAULT_NODE_CAPACITY:{configurable:!0}};return t.prototype.createParentBoundablesFromVerticalSlices=function(i,s){var o=this;et.isTrue(i.length>0);for(var a=new k,u=0;u<i.length;u++)a.addAll(o.createParentBoundablesFromVerticalSlice(i[u],s));return a},t.prototype.createNode=function(i){return new oc(i)},t.prototype.size=function(){return arguments.length===0?n.prototype.size.call(this):n.prototype.size.apply(this,arguments)},t.prototype.insert=function(){if(arguments.length===2){var i=arguments[0],s=arguments[1];if(i.isNull())return null;n.prototype.insert.call(this,i,s)}else return n.prototype.insert.apply(this,arguments)},t.prototype.getIntersectsOp=function(){return t.intersectsOp},t.prototype.verticalSlices=function(i,s){for(var o=Math.trunc(Math.ceil(i.size()/s)),a=new Array(s).fill(null),u=i.iterator(),l=0;l<s;l++){a[l]=new k;for(var c=0;u.hasNext()&&c<o;){var h=u.next();a[l].add(h),c++}}return a},t.prototype.query=function(){if(arguments.length===1){var i=arguments[0];return n.prototype.query.call(this,i)}else if(arguments.length===2){var s=arguments[0],o=arguments[1];n.prototype.query.call(this,s,o)}else if(arguments.length===3){if(H(arguments[2],Un)&&arguments[0]instanceof Object&&arguments[1]instanceof Ht){var a=arguments[0],u=arguments[1],l=arguments[2];n.prototype.query.call(this,a,u,l)}else if(H(arguments[2],lr)&&arguments[0]instanceof Object&&arguments[1]instanceof Ht){var c=arguments[0],h=arguments[1],f=arguments[2];n.prototype.query.call(this,c,h,f)}}},t.prototype.getComparator=function(){return t.yComparator},t.prototype.createParentBoundablesFromVerticalSlice=function(i,s){return n.prototype.createParentBoundables.call(this,i,s)},t.prototype.remove=function(){if(arguments.length===2){var i=arguments[0],s=arguments[1];return n.prototype.remove.call(this,i,s)}else return n.prototype.remove.apply(this,arguments)},t.prototype.depth=function(){return arguments.length===0?n.prototype.depth.call(this):n.prototype.depth.apply(this,arguments)},t.prototype.createParentBoundables=function(i,s){et.isTrue(!i.isEmpty());var o=Math.trunc(Math.ceil(i.size()/this.getNodeCapacity())),a=new k(i);gr.sort(a,t.xComparator);var u=this.verticalSlices(a,Math.trunc(Math.ceil(Math.sqrt(o))));return this.createParentBoundablesFromVerticalSlices(u,s)},t.prototype.nearestNeighbour=function(){if(arguments.length===1){if(H(arguments[0],hs)){var i=arguments[0],s=new jt(this.getRoot(),this.getRoot(),i);return this.nearestNeighbour(s)}else if(arguments[0]instanceof jt){var o=arguments[0];return this.nearestNeighbour(o,J.POSITIVE_INFINITY)}}else if(arguments.length===2){if(arguments[0]instanceof t&&H(arguments[1],hs)){var a=arguments[0],u=arguments[1],l=new jt(this.getRoot(),a.getRoot(),u);return this.nearestNeighbour(l)}else if(arguments[0]instanceof jt&&typeof arguments[1]=="number"){var c=arguments[0],h=arguments[1],f=h,p=null,d=new _n;for(d.add(c);!d.isEmpty()&&f>0;){var _=d.poll(),w=_.getDistance();if(w>=f)break;_.isLeaves()?(f=w,p=_):_.expandToQueue(d,f)}return[p.getBoundable(0).getItem(),p.getBoundable(1).getItem()]}}else if(arguments.length===3){var y=arguments[0],x=arguments[1],g=arguments[2],m=new pr(y,x),E=new jt(this.getRoot(),m,g);return this.nearestNeighbour(E)[0]}},t.prototype.interfaces_=function(){return[Ci,or]},t.prototype.getClass=function(){return t},t.centreX=function(i){return t.avg(i.getMinX(),i.getMaxX())},t.avg=function(i,s){return(i+s)/2},t.centreY=function(i){return t.avg(i.getMinY(),i.getMaxY())},e.STRtreeNode.get=function(){return oc},e.serialVersionUID.get=function(){return 0x39920f7d5f261e0},e.xComparator.get=function(){return{interfaces_:function(){return[es]},compare:function(r,i){return n.compareDoubles(t.centreX(r.getBounds()),t.centreX(i.getBounds()))}}},e.yComparator.get=function(){return{interfaces_:function(){return[es]},compare:function(r,i){return n.compareDoubles(t.centreY(r.getBounds()),t.centreY(i.getBounds()))}}},e.intersectsOp.get=function(){return{interfaces_:function(){return[n.IntersectsOp]},intersects:function(r,i){return r.intersects(i)}}},e.DEFAULT_NODE_CAPACITY.get=function(){return 10},Object.defineProperties(t,e),t}(ee),oc=function(n){function t(){var e=arguments[0];n.call(this,e)}return n&&(t.__proto__=n),t.prototype=Object.create(n&&n.prototype),t.prototype.constructor=t,t.prototype.computeBounds=function(){for(var r=null,i=this.getChildBoundables().iterator();i.hasNext();){var s=i.next();r===null?r=new W(s.getBounds()):r.expandToInclude(s.getBounds())}return r},t.prototype.interfaces_=function(){return[]},t.prototype.getClass=function(){return t},t}(Ht),Te=function(){};Te.prototype.interfaces_=function(){return[]};Te.prototype.getClass=function(){return Te};Te.relativeSign=function(t,e){return t<e?-1:t>e?1:0};Te.compare=function(t,e,r){if(e.equals2D(r))return 0;var i=Te.relativeSign(e.x,r.x),s=Te.relativeSign(e.y,r.y);switch(t){case 0:return Te.compareValue(i,s);case 1:return Te.compareValue(s,i);case 2:return Te.compareValue(s,-i);case 3:return Te.compareValue(-i,s);case 4:return Te.compareValue(-i,-s);case 5:return Te.compareValue(-s,-i);case 6:return Te.compareValue(-s,i);case 7:return Te.compareValue(i,-s)}return et.shouldNeverReachHere("invalid octant value"),0};Te.compareValue=function(t,e){return t<0?-1:t>0?1:e<0?-1:e>0?1:0};var jn=function(){this._segString=null,this.coord=null,this.segmentIndex=null,this._segmentOctant=null,this._isInterior=null;var t=arguments[0],e=arguments[1],r=arguments[2],i=arguments[3];this._segString=t,this.coord=new P(e),this.segmentIndex=r,this._segmentOctant=i,this._isInterior=!e.equals2D(t.getCoordinate(r))};jn.prototype.getCoordinate=function(){return this.coord};jn.prototype.print=function(t){t.print(this.coord),t.print(" seg # = "+this.segmentIndex)};jn.prototype.compareTo=function(t){var e=t;return this.segmentIndex<e.segmentIndex?-1:this.segmentIndex>e.segmentIndex?1:this.coord.equals2D(e.coord)?0:Te.compare(this._segmentOctant,this.coord,e.coord)};jn.prototype.isEndPoint=function(t){return this.segmentIndex===0&&!this._isInterior||this.segmentIndex===t};jn.prototype.isInterior=function(){return this._isInterior};jn.prototype.interfaces_=function(){return[sr]};jn.prototype.getClass=function(){return jn};var Me=function(){this._nodeMap=new me,this._edge=null;var t=arguments[0];this._edge=t};Me.prototype.getSplitCoordinates=function(){var t=this,e=new Ro;this.addEndpoints();for(var r=this.iterator(),i=r.next();r.hasNext();){var s=r.next();t.addEdgeCoordinates(i,s,e),i=s}return e.toCoordinateArray()};Me.prototype.addCollapsedNodes=function(){var t=this,e=new k;this.findCollapsesFromInsertedNodes(e),this.findCollapsesFromExistingVertices(e);for(var r=e.iterator();r.hasNext();){var i=r.next().intValue();t.add(t._edge.getCoordinate(i),i)}};Me.prototype.print=function(t){t.println("Intersections:");for(var e=this.iterator();e.hasNext();){var r=e.next();r.print(t)}};Me.prototype.findCollapsesFromExistingVertices=function(t){for(var e=this,r=0;r<this._edge.size()-2;r++){var i=e._edge.getCoordinate(r),s=e._edge.getCoordinate(r+2);i.equals2D(s)&&t.add(new Pr(r+1))}};Me.prototype.addEdgeCoordinates=function(t,e,r){var i=this,s=this._edge.getCoordinate(e.segmentIndex),o=e.isInterior()||!e.coord.equals2D(s);r.add(new P(t.coord),!1);for(var a=t.segmentIndex+1;a<=e.segmentIndex;a++)r.add(i._edge.getCoordinate(a));o&&r.add(new P(e.coord))};Me.prototype.iterator=function(){return this._nodeMap.values().iterator()};Me.prototype.addSplitEdges=function(t){var e=this;this.addEndpoints(),this.addCollapsedNodes();for(var r=this.iterator(),i=r.next();r.hasNext();){var s=r.next(),o=e.createSplitEdge(i,s);t.add(o),i=s}};Me.prototype.findCollapseIndex=function(t,e,r){if(!t.coord.equals2D(e.coord))return!1;var i=e.segmentIndex-t.segmentIndex;return e.isInterior()||i--,i===1?(r[0]=t.segmentIndex+1,!0):!1};Me.prototype.findCollapsesFromInsertedNodes=function(t){for(var e=this,r=new Array(1).fill(null),i=this.iterator(),s=i.next();i.hasNext();){var o=i.next(),a=e.findCollapseIndex(s,o,r);a&&t.add(new Pr(r[0])),s=o}};Me.prototype.getEdge=function(){return this._edge};Me.prototype.addEndpoints=function(){var t=this._edge.size()-1;this.add(this._edge.getCoordinate(0),0),this.add(this._edge.getCoordinate(t),t)};Me.prototype.createSplitEdge=function(t,e){var r=this,i=e.segmentIndex-t.segmentIndex+2,s=this._edge.getCoordinate(e.segmentIndex),o=e.isInterior()||!e.coord.equals2D(s);o||i--;var a=new Array(i).fill(null),u=0;a[u++]=new P(t.coord);for(var l=t.segmentIndex+1;l<=e.segmentIndex;l++)a[u++]=r._edge.getCoordinate(l);return o&&(a[u]=new P(e.coord)),new Ut(a,this._edge.getData())};Me.prototype.add=function(t,e){var r=new jn(this._edge,t,e,this._edge.getSegmentOctant(e)),i=this._nodeMap.get(r);return i!==null?(et.isTrue(i.coord.equals2D(t),"Found equal nodes with different coordinates"),i):(this._nodeMap.put(r,r),r)};Me.prototype.checkSplitEdgesCorrectness=function(t){var e=this._edge.getCoordinates(),r=t.get(0),i=r.getCoordinate(0);if(!i.equals2D(e[0]))throw new mn("bad split edge start point at "+i);var s=t.get(t.size()-1),o=s.getCoordinates(),a=o[o.length-1];if(!a.equals2D(e[e.length-1]))throw new mn("bad split edge end point at "+a)};Me.prototype.interfaces_=function(){return[]};Me.prototype.getClass=function(){return Me};var Si=function(){};Si.prototype.interfaces_=function(){return[]};Si.prototype.getClass=function(){return Si};Si.octant=function(){if(typeof arguments[0]=="number"&&typeof arguments[1]=="number"){var t=arguments[0],e=arguments[1];if(t===0&&e===0)throw new Rt("Cannot compute the octant for point ( "+t+", "+e+" )");var r=Math.abs(t),i=Math.abs(e);return t>=0?e>=0?r>=i?0:1:r>=i?7:6:e>=0?r>=i?3:2:r>=i?4:5}else if(arguments[0]instanceof P&&arguments[1]instanceof P){var s=arguments[0],o=arguments[1],a=o.x-s.x,u=o.y-s.y;if(a===0&&u===0)throw new Rt("Cannot compute the octant for two identical points "+s);return Si.octant(a,u)}};var tn=function(){};tn.prototype.getCoordinates=function(){};tn.prototype.size=function(){};tn.prototype.getCoordinate=function(t){};tn.prototype.isClosed=function(){};tn.prototype.setData=function(t){};tn.prototype.getData=function(){};tn.prototype.interfaces_=function(){return[]};tn.prototype.getClass=function(){return tn};var io=function(){};io.prototype.addIntersection=function(t,e){};io.prototype.interfaces_=function(){return[tn]};io.prototype.getClass=function(){return io};var Ut=function(){this._nodeList=new Me(this),this._pts=null,this._data=null;var t=arguments[0],e=arguments[1];this._pts=t,this._data=e};Ut.prototype.getCoordinates=function(){return this._pts};Ut.prototype.size=function(){return this._pts.length};Ut.prototype.getCoordinate=function(t){return this._pts[t]};Ut.prototype.isClosed=function(){return this._pts[0].equals(this._pts[this._pts.length-1])};Ut.prototype.getSegmentOctant=function(t){return t===this._pts.length-1?-1:this.safeOctant(this.getCoordinate(t),this.getCoordinate(t+1))};Ut.prototype.setData=function(t){this._data=t};Ut.prototype.safeOctant=function(t,e){return t.equals2D(e)?0:Si.octant(t,e)};Ut.prototype.getData=function(){return this._data};Ut.prototype.addIntersection=function(){if(arguments.length===2){var t=arguments[0],e=arguments[1];this.addIntersectionNode(t,e)}else if(arguments.length===4){var r=arguments[0],i=arguments[1],s=arguments[3],o=new P(r.getIntersection(s));this.addIntersection(o,i)}};Ut.prototype.toString=function(){return hr.toLineString(new Gt(this._pts))};Ut.prototype.getNodeList=function(){return this._nodeList};Ut.prototype.addIntersectionNode=function(t,e){var r=e,i=r+1;if(i<this._pts.length){var s=this._pts[i];t.equals2D(s)&&(r=i)}var o=this._nodeList.add(t,r);return o};Ut.prototype.addIntersections=function(t,e,r){for(var i=this,s=0;s<t.getIntersectionNum();s++)i.addIntersection(t,e,r,s)};Ut.prototype.interfaces_=function(){return[io]};Ut.prototype.getClass=function(){return Ut};Ut.getNodedSubstrings=function(){if(arguments.length===1){var t=arguments[0],e=new k;return Ut.getNodedSubstrings(t,e),e}else if(arguments.length===2)for(var r=arguments[0],i=arguments[1],s=r.iterator();s.hasNext();){var o=s.next();o.getNodeList().addSplitEdges(i)}};var X=function(){if(this.p0=null,this.p1=null,arguments.length===0)this.p0=new P,this.p1=new P;else if(arguments.length===1){var t=arguments[0];this.p0=new P(t.p0),this.p1=new P(t.p1)}else if(arguments.length===2)this.p0=arguments[0],this.p1=arguments[1];else if(arguments.length===4){var e=arguments[0],r=arguments[1],i=arguments[2],s=arguments[3];this.p0=new P(e,r),this.p1=new P(i,s)}},Ch={serialVersionUID:{configurable:!0}};X.prototype.minX=function(){return Math.min(this.p0.x,this.p1.x)};X.prototype.orientationIndex=function(){if(arguments[0]instanceof X){var t=arguments[0],e=G.orientationIndex(this.p0,this.p1,t.p0),r=G.orientationIndex(this.p0,this.p1,t.p1);return e>=0&&r>=0||e<=0&&r<=0?Math.max(e,r):0}else if(arguments[0]instanceof P){var i=arguments[0];return G.orientationIndex(this.p0,this.p1,i)}};X.prototype.toGeometry=function(t){return t.createLineString([this.p0,this.p1])};X.prototype.isVertical=function(){return this.p0.x===this.p1.x};X.prototype.equals=function(t){if(!(t instanceof X))return!1;var e=t;return this.p0.equals(e.p0)&&this.p1.equals(e.p1)};X.prototype.intersection=function(t){var e=new yi;return e.computeIntersection(this.p0,this.p1,t.p0,t.p1),e.hasIntersection()?e.getIntersection(0):null};X.prototype.project=function(){if(arguments[0]instanceof P){var t=arguments[0];if(t.equals(this.p0)||t.equals(this.p1))return new P(t);var e=this.projectionFactor(t),r=new P;return r.x=this.p0.x+e*(this.p1.x-this.p0.x),r.y=this.p0.y+e*(this.p1.y-this.p0.y),r}else if(arguments[0]instanceof X){var i=arguments[0],s=this.projectionFactor(i.p0),o=this.projectionFactor(i.p1);if(s>=1&&o>=1||s<=0&&o<=0)return null;var a=this.project(i.p0);s<0&&(a=this.p0),s>1&&(a=this.p1);var u=this.project(i.p1);return o<0&&(u=this.p0),o>1&&(u=this.p1),new X(a,u)}};X.prototype.normalize=function(){this.p1.compareTo(this.p0)<0&&this.reverse()};X.prototype.angle=function(){return Math.atan2(this.p1.y-this.p0.y,this.p1.x-this.p0.x)};X.prototype.getCoordinate=function(t){return t===0?this.p0:this.p1};X.prototype.distancePerpendicular=function(t){return G.distancePointLinePerpendicular(t,this.p0,this.p1)};X.prototype.minY=function(){return Math.min(this.p0.y,this.p1.y)};X.prototype.midPoint=function(){return X.midPoint(this.p0,this.p1)};X.prototype.projectionFactor=function(t){if(t.equals(this.p0))return 0;if(t.equals(this.p1))return 1;var e=this.p1.x-this.p0.x,r=this.p1.y-this.p0.y,i=e*e+r*r;if(i<=0)return J.NaN;var s=((t.x-this.p0.x)*e+(t.y-this.p0.y)*r)/i;return s};X.prototype.closestPoints=function(t){var e=this.intersection(t);if(e!==null)return[e,e];var r=new Array(2).fill(null),i=J.MAX_VALUE,s=null,o=this.closestPoint(t.p0);i=o.distance(t.p0),r[0]=o,r[1]=t.p0;var a=this.closestPoint(t.p1);s=a.distance(t.p1),s<i&&(i=s,r[0]=a,r[1]=t.p1);var u=t.closestPoint(this.p0);s=u.distance(this.p0),s<i&&(i=s,r[0]=this.p0,r[1]=u);var l=t.closestPoint(this.p1);return s=l.distance(this.p1),s<i&&(i=s,r[0]=this.p1,r[1]=l),r};X.prototype.closestPoint=function(t){var e=this.projectionFactor(t);if(e>0&&e<1)return this.project(t);var r=this.p0.distance(t),i=this.p1.distance(t);return r<i?this.p0:this.p1};X.prototype.maxX=function(){return Math.max(this.p0.x,this.p1.x)};X.prototype.getLength=function(){return this.p0.distance(this.p1)};X.prototype.compareTo=function(t){var e=t,r=this.p0.compareTo(e.p0);return r!==0?r:this.p1.compareTo(e.p1)};X.prototype.reverse=function(){var t=this.p0;this.p0=this.p1,this.p1=t};X.prototype.equalsTopo=function(t){return this.p0.equals(t.p0)&&(this.p1.equals(t.p1)||this.p0.equals(t.p1))&&this.p1.equals(t.p0)};X.prototype.lineIntersection=function(t){try{var e=ur.intersection(this.p0,this.p1,t.p0,t.p1);return e}catch(r){if(!(r instanceof Ts))throw r}finally{}return null};X.prototype.maxY=function(){return Math.max(this.p0.y,this.p1.y)};X.prototype.pointAlongOffset=function(t,e){var r=this.p0.x+t*(this.p1.x-this.p0.x),i=this.p0.y+t*(this.p1.y-this.p0.y),s=this.p1.x-this.p0.x,o=this.p1.y-this.p0.y,a=Math.sqrt(s*s+o*o),u=0,l=0;if(e!==0){if(a<=0)throw new Error("Cannot compute offset from zero-length line segment");u=e*s/a,l=e*o/a}var c=r-l,h=i+u,f=new P(c,h);return f};X.prototype.setCoordinates=function(){if(arguments.length===1){var t=arguments[0];this.setCoordinates(t.p0,t.p1)}else if(arguments.length===2){var e=arguments[0],r=arguments[1];this.p0.x=e.x,this.p0.y=e.y,this.p1.x=r.x,this.p1.y=r.y}};X.prototype.segmentFraction=function(t){var e=this.projectionFactor(t);return e<0?e=0:(e>1||J.isNaN(e))&&(e=1),e};X.prototype.toString=function(){return"LINESTRING( "+this.p0.x+" "+this.p0.y+", "+this.p1.x+" "+this.p1.y+")"};X.prototype.isHorizontal=function(){return this.p0.y===this.p1.y};X.prototype.distance=function(){if(arguments[0]instanceof X){var t=arguments[0];return G.distanceLineLine(this.p0,this.p1,t.p0,t.p1)}else if(arguments[0]instanceof P){var e=arguments[0];return G.distancePointLine(e,this.p0,this.p1)}};X.prototype.pointAlong=function(t){var e=new P;return e.x=this.p0.x+t*(this.p1.x-this.p0.x),e.y=this.p0.y+t*(this.p1.y-this.p0.y),e};X.prototype.hashCode=function(){var t=J.doubleToLongBits(this.p0.x);t^=J.doubleToLongBits(this.p0.y)*31;var e=Math.trunc(t)^Math.trunc(t>>32),r=J.doubleToLongBits(this.p1.x);r^=J.doubleToLongBits(this.p1.y)*31;var i=Math.trunc(r)^Math.trunc(r>>32);return e^i};X.prototype.interfaces_=function(){return[sr,or]};X.prototype.getClass=function(){return X};X.midPoint=function(t,e){return new P((t.x+e.x)/2,(t.y+e.y)/2)};Ch.serialVersionUID.get=function(){return 0x2d2172135f411c00};Object.defineProperties(X,Ch);var so=function(){this.tempEnv1=new W,this.tempEnv2=new W,this._overlapSeg1=new X,this._overlapSeg2=new X};so.prototype.overlap=function(){if(arguments.length!==2){if(arguments.length===4){var t=arguments[0],e=arguments[1],r=arguments[2],i=arguments[3];t.getLineSegment(e,this._overlapSeg1),r.getLineSegment(i,this._overlapSeg2),this.overlap(this._overlapSeg1,this._overlapSeg2)}}};so.prototype.interfaces_=function(){return[]};so.prototype.getClass=function(){return so};var Be=function(){this._pts=null,this._start=null,this._end=null,this._env=null,this._context=null,this._id=null;var t=arguments[0],e=arguments[1],r=arguments[2],i=arguments[3];this._pts=t,this._start=e,this._end=r,this._context=i};Be.prototype.getLineSegment=function(t,e){e.p0=this._pts[t],e.p1=this._pts[t+1]};Be.prototype.computeSelect=function(t,e,r,i){var s=this._pts[e],o=this._pts[r];if(i.tempEnv1.init(s,o),r-e===1)return i.select(this,e),null;if(!t.intersects(i.tempEnv1))return null;var a=Math.trunc((e+r)/2);e<a&&this.computeSelect(t,e,a,i),a<r&&this.computeSelect(t,a,r,i)};Be.prototype.getCoordinates=function(){for(var t=this,e=new Array(this._end-this._start+1).fill(null),r=0,i=this._start;i<=this._end;i++)e[r++]=t._pts[i];return e};Be.prototype.computeOverlaps=function(t,e){this.computeOverlapsInternal(this._start,this._end,t,t._start,t._end,e)};Be.prototype.setId=function(t){this._id=t};Be.prototype.select=function(t,e){this.computeSelect(t,this._start,this._end,e)};Be.prototype.getEnvelope=function(){if(this._env===null){var t=this._pts[this._start],e=this._pts[this._end];this._env=new W(t,e)}return this._env};Be.prototype.getEndIndex=function(){return this._end};Be.prototype.getStartIndex=function(){return this._start};Be.prototype.getContext=function(){return this._context};Be.prototype.getId=function(){return this._id};Be.prototype.computeOverlapsInternal=function(t,e,r,i,s,o){var a=this._pts[t],u=this._pts[e],l=r._pts[i],c=r._pts[s];if(e-t===1&&s-i===1)return o.overlap(this,t,r,i),null;if(o.tempEnv1.init(a,u),o.tempEnv2.init(l,c),!o.tempEnv1.intersects(o.tempEnv2))return null;var h=Math.trunc((t+e)/2),f=Math.trunc((i+s)/2);t<h&&(i<f&&this.computeOverlapsInternal(t,h,r,i,f,o),f<s&&this.computeOverlapsInternal(t,h,r,f,s,o)),h<e&&(i<f&&this.computeOverlapsInternal(h,e,r,i,f,o),f<s&&this.computeOverlapsInternal(h,e,r,f,s,o))};Be.prototype.interfaces_=function(){return[]};Be.prototype.getClass=function(){return Be};var Tr=function(){};Tr.prototype.interfaces_=function(){return[]};Tr.prototype.getClass=function(){return Tr};Tr.getChainStartIndices=function(t){var e=0,r=new k;r.add(new Pr(e));do{var i=Tr.findChainEnd(t,e);r.add(new Pr(i)),e=i}while(e<t.length-1);var s=Tr.toIntArray(r);return s};Tr.findChainEnd=function(t,e){for(var r=e;r<t.length-1&&t[r].equals2D(t[r+1]);)r++;if(r>=t.length-1)return t.length-1;for(var i=wt.quadrant(t[r],t[r+1]),s=e+1;s<t.length;){if(!t[s-1].equals2D(t[s])){var o=wt.quadrant(t[s-1],t[s]);if(o!==i)break}s++}return s-1};Tr.getChains=function(){if(arguments.length===1){var t=arguments[0];return Tr.getChains(t,null)}else if(arguments.length===2){for(var e=arguments[0],r=arguments[1],i=new k,s=Tr.getChainStartIndices(e),o=0;o<s.length-1;o++){var a=new Be(e,s[o],s[o+1],r);i.add(a)}return i}};Tr.toIntArray=function(t){for(var e=new Array(t.size()).fill(null),r=0;r<e.length;r++)e[r]=t.get(r).intValue();return e};var ii=function(){};ii.prototype.computeNodes=function(t){};ii.prototype.getNodedSubstrings=function(){};ii.prototype.interfaces_=function(){return[]};ii.prototype.getClass=function(){return ii};var oo=function(){if(this._segInt=null,arguments.length!==0){if(arguments.length===1){var t=arguments[0];this.setSegmentIntersector(t)}}};oo.prototype.setSegmentIntersector=function(t){this._segInt=t};oo.prototype.interfaces_=function(){return[ii]};oo.prototype.getClass=function(){return oo};var xl=function(n){function t(r){r?n.call(this,r):n.call(this),this._monoChains=new k,this._index=new Ih,this._idCounter=0,this._nodedSegStrings=null,this._nOverlaps=0}n&&(t.__proto__=n),t.prototype=Object.create(n&&n.prototype),t.prototype.constructor=t;var e={SegmentOverlapAction:{configurable:!0}};return t.prototype.getMonotoneChains=function(){return this._monoChains},t.prototype.getNodedSubstrings=function(){return Ut.getNodedSubstrings(this._nodedSegStrings)},t.prototype.getIndex=function(){return this._index},t.prototype.add=function(i){for(var s=this,o=Tr.getChains(i.getCoordinates(),i),a=o.iterator();a.hasNext();){var u=a.next();u.setId(s._idCounter++),s._index.insert(u.getEnvelope(),u),s._monoChains.add(u)}},t.prototype.computeNodes=function(i){var s=this;this._nodedSegStrings=i;for(var o=i.iterator();o.hasNext();)s.add(o.next());this.intersectChains()},t.prototype.intersectChains=function(){for(var i=this,s=new ac(this._segInt),o=this._monoChains.iterator();o.hasNext();)for(var a=o.next(),u=i._index.query(a.getEnvelope()),l=u.iterator();l.hasNext();){var c=l.next();if(c.getId()>a.getId()&&(a.computeOverlaps(c,s),i._nOverlaps++),i._segInt.isDone())return null}},t.prototype.interfaces_=function(){return[]},t.prototype.getClass=function(){return t},e.SegmentOverlapAction.get=function(){return ac},Object.defineProperties(t,e),t}(oo),ac=function(n){function t(){n.call(this),this._si=null;var e=arguments[0];this._si=e}return n&&(t.__proto__=n),t.prototype=Object.create(n&&n.prototype),t.prototype.constructor=t,t.prototype.overlap=function(){if(arguments.length===4){var r=arguments[0],i=arguments[1],s=arguments[2],o=arguments[3],a=r.getContext(),u=s.getContext();this._si.processIntersections(a,i,u,o)}else return n.prototype.overlap.apply(this,arguments)},t.prototype.interfaces_=function(){return[]},t.prototype.getClass=function(){return t},t}(so),ft=function n(){if(this._quadrantSegments=n.DEFAULT_QUADRANT_SEGMENTS,this._endCapStyle=n.CAP_ROUND,this._joinStyle=n.JOIN_ROUND,this._mitreLimit=n.DEFAULT_MITRE_LIMIT,this._isSingleSided=!1,this._simplifyFactor=n.DEFAULT_SIMPLIFY_FACTOR,arguments.length!==0){if(arguments.length===1){var t=arguments[0];this.setQuadrantSegments(t)}else if(arguments.length===2){var e=arguments[0],r=arguments[1];this.setQuadrantSegments(e),this.setEndCapStyle(r)}else if(arguments.length===4){var i=arguments[0],s=arguments[1],o=arguments[2],a=arguments[3];this.setQuadrantSegments(i),this.setEndCapStyle(s),this.setJoinStyle(o),this.setMitreLimit(a)}}},Sn={CAP_ROUND:{configurable:!0},CAP_FLAT:{configurable:!0},CAP_SQUARE:{configurable:!0},JOIN_ROUND:{configurable:!0},JOIN_MITRE:{configurable:!0},JOIN_BEVEL:{configurable:!0},DEFAULT_QUADRANT_SEGMENTS:{configurable:!0},DEFAULT_MITRE_LIMIT:{configurable:!0},DEFAULT_SIMPLIFY_FACTOR:{configurable:!0}};ft.prototype.getEndCapStyle=function(){return this._endCapStyle};ft.prototype.isSingleSided=function(){return this._isSingleSided};ft.prototype.setQuadrantSegments=function(t){this._quadrantSegments=t,this._quadrantSegments===0&&(this._joinStyle=ft.JOIN_BEVEL),this._quadrantSegments<0&&(this._joinStyle=ft.JOIN_MITRE,this._mitreLimit=Math.abs(this._quadrantSegments)),t<=0&&(this._quadrantSegments=1),this._joinStyle!==ft.JOIN_ROUND&&(this._quadrantSegments=ft.DEFAULT_QUADRANT_SEGMENTS)};ft.prototype.getJoinStyle=function(){return this._joinStyle};ft.prototype.setJoinStyle=function(t){this._joinStyle=t};ft.prototype.setSimplifyFactor=function(t){this._simplifyFactor=t<0?0:t};ft.prototype.getSimplifyFactor=function(){return this._simplifyFactor};ft.prototype.getQuadrantSegments=function(){return this._quadrantSegments};ft.prototype.setEndCapStyle=function(t){this._endCapStyle=t};ft.prototype.getMitreLimit=function(){return this._mitreLimit};ft.prototype.setMitreLimit=function(t){this._mitreLimit=t};ft.prototype.setSingleSided=function(t){this._isSingleSided=t};ft.prototype.interfaces_=function(){return[]};ft.prototype.getClass=function(){return ft};ft.bufferDistanceError=function(t){var e=Math.PI/2/t;return 1-Math.cos(e/2)};Sn.CAP_ROUND.get=function(){return 1};Sn.CAP_FLAT.get=function(){return 2};Sn.CAP_SQUARE.get=function(){return 3};Sn.JOIN_ROUND.get=function(){return 1};Sn.JOIN_MITRE.get=function(){return 2};Sn.JOIN_BEVEL.get=function(){return 3};Sn.DEFAULT_QUADRANT_SEGMENTS.get=function(){return 8};Sn.DEFAULT_MITRE_LIMIT.get=function(){return 5};Sn.DEFAULT_SIMPLIFY_FACTOR.get=function(){return .01};Object.defineProperties(ft,Sn);var Ft=function(t){this._distanceTol=null,this._isDeleted=null,this._angleOrientation=G.COUNTERCLOCKWISE,this._inputLine=t||null},Oo={INIT:{configurable:!0},DELETE:{configurable:!0},KEEP:{configurable:!0},NUM_PTS_TO_CHECK:{configurable:!0}};Ft.prototype.isDeletable=function(t,e,r,i){var s=this._inputLine[t],o=this._inputLine[e],a=this._inputLine[r];return!this.isConcave(s,o,a)||!this.isShallow(s,o,a,i)?!1:this.isShallowSampled(s,o,t,r,i)};Ft.prototype.deleteShallowConcavities=function(){for(var t=this,e=1,r=this.findNextNonDeletedIndex(e),i=this.findNextNonDeletedIndex(r),s=!1;i<this._inputLine.length;){var o=!1;t.isDeletable(e,r,i,t._distanceTol)&&(t._isDeleted[r]=Ft.DELETE,o=!0,s=!0),o?e=i:e=r,r=t.findNextNonDeletedIndex(e),i=t.findNextNonDeletedIndex(r)}return s};Ft.prototype.isShallowConcavity=function(t,e,r,i){var s=G.computeOrientation(t,e,r),o=s===this._angleOrientation;if(!o)return!1;var a=G.distancePointLine(e,t,r);return a<i};Ft.prototype.isShallowSampled=function(t,e,r,i,s){var o=this,a=Math.trunc((i-r)/Ft.NUM_PTS_TO_CHECK);a<=0&&(a=1);for(var u=r;u<i;u+=a)if(!o.isShallow(t,e,o._inputLine[u],s))return!1;return!0};Ft.prototype.isConcave=function(t,e,r){var i=G.computeOrientation(t,e,r),s=i===this._angleOrientation;return s};Ft.prototype.simplify=function(t){var e=this;this._distanceTol=Math.abs(t),t<0&&(this._angleOrientation=G.CLOCKWISE),this._isDeleted=new Array(this._inputLine.length).fill(null);var r=!1;do r=e.deleteShallowConcavities();while(r);return this.collapseLine()};Ft.prototype.findNextNonDeletedIndex=function(t){for(var e=t+1;e<this._inputLine.length&&this._isDeleted[e]===Ft.DELETE;)e++;return e};Ft.prototype.isShallow=function(t,e,r,i){var s=G.distancePointLine(e,t,r);return s<i};Ft.prototype.collapseLine=function(){for(var t=this,e=new Ro,r=0;r<this._inputLine.length;r++)t._isDeleted[r]!==Ft.DELETE&&e.add(t._inputLine[r]);return e.toCoordinateArray()};Ft.prototype.interfaces_=function(){return[]};Ft.prototype.getClass=function(){return Ft};Ft.simplify=function(t,e){var r=new Ft(t);return r.simplify(e)};Oo.INIT.get=function(){return 0};Oo.DELETE.get=function(){return 1};Oo.KEEP.get=function(){return 1};Oo.NUM_PTS_TO_CHECK.get=function(){return 10};Object.defineProperties(Ft,Oo);var Ye=function(){this._ptList=null,this._precisionModel=null,this._minimimVertexDistance=0,this._ptList=new k},Sh={COORDINATE_ARRAY_TYPE:{configurable:!0}};Ye.prototype.getCoordinates=function(){var t=this._ptList.toArray(Ye.COORDINATE_ARRAY_TYPE);return t};Ye.prototype.setPrecisionModel=function(t){this._precisionModel=t};Ye.prototype.addPt=function(t){var e=new P(t);if(this._precisionModel.makePrecise(e),this.isRedundant(e))return null;this._ptList.add(e)};Ye.prototype.revere=function(){};Ye.prototype.addPts=function(t,e){var r=this;if(e)for(var i=0;i<t.length;i++)r.addPt(t[i]);else for(var s=t.length-1;s>=0;s--)r.addPt(t[s])};Ye.prototype.isRedundant=function(t){if(this._ptList.size()<1)return!1;var e=this._ptList.get(this._ptList.size()-1),r=t.distance(e);return r<this._minimimVertexDistance};Ye.prototype.toString=function(){var t=new nt,e=t.createLineString(this.getCoordinates());return e.toString()};Ye.prototype.closeRing=function(){if(this._ptList.size()<1)return null;var t=new P(this._ptList.get(0)),e=this._ptList.get(this._ptList.size()-1);if(t.equals(e))return null;this._ptList.add(t)};Ye.prototype.setMinimumVertexDistance=function(t){this._minimimVertexDistance=t};Ye.prototype.interfaces_=function(){return[]};Ye.prototype.getClass=function(){return Ye};Sh.COORDINATE_ARRAY_TYPE.get=function(){return new Array(0).fill(null)};Object.defineProperties(Ye,Sh);var ot=function(){},Vi={PI_TIMES_2:{configurable:!0},PI_OVER_2:{configurable:!0},PI_OVER_4:{configurable:!0},COUNTERCLOCKWISE:{configurable:!0},CLOCKWISE:{configurable:!0},NONE:{configurable:!0}};ot.prototype.interfaces_=function(){return[]};ot.prototype.getClass=function(){return ot};ot.toDegrees=function(t){return t*180/Math.PI};ot.normalize=function(t){for(;t>Math.PI;)t-=ot.PI_TIMES_2;for(;t<=-Math.PI;)t+=ot.PI_TIMES_2;return t};ot.angle=function(){if(arguments.length===1){var t=arguments[0];return Math.atan2(t.y,t.x)}else if(arguments.length===2){var e=arguments[0],r=arguments[1],i=r.x-e.x,s=r.y-e.y;return Math.atan2(s,i)}};ot.isAcute=function(t,e,r){var i=t.x-e.x,s=t.y-e.y,o=r.x-e.x,a=r.y-e.y,u=i*o+s*a;return u>0};ot.isObtuse=function(t,e,r){var i=t.x-e.x,s=t.y-e.y,o=r.x-e.x,a=r.y-e.y,u=i*o+s*a;return u<0};ot.interiorAngle=function(t,e,r){var i=ot.angle(e,t),s=ot.angle(e,r);return Math.abs(s-i)};ot.normalizePositive=function(t){if(t<0){for(;t<0;)t+=ot.PI_TIMES_2;t>=ot.PI_TIMES_2&&(t=0)}else{for(;t>=ot.PI_TIMES_2;)t-=ot.PI_TIMES_2;t<0&&(t=0)}return t};ot.angleBetween=function(t,e,r){var i=ot.angle(e,t),s=ot.angle(e,r);return ot.diff(i,s)};ot.diff=function(t,e){var r=null;return t<e?r=e-t:r=t-e,r>Math.PI&&(r=2*Math.PI-r),r};ot.toRadians=function(t){return t*Math.PI/180};ot.getTurn=function(t,e){var r=Math.sin(e-t);return r>0?ot.COUNTERCLOCKWISE:r<0?ot.CLOCKWISE:ot.NONE};ot.angleBetweenOriented=function(t,e,r){var i=ot.angle(e,t),s=ot.angle(e,r),o=s-i;return o<=-Math.PI?o+ot.PI_TIMES_2:o>Math.PI?o-ot.PI_TIMES_2:o};Vi.PI_TIMES_2.get=function(){return 2*Math.PI};Vi.PI_OVER_2.get=function(){return Math.PI/2};Vi.PI_OVER_4.get=function(){return Math.PI/4};Vi.COUNTERCLOCKWISE.get=function(){return G.COUNTERCLOCKWISE};Vi.CLOCKWISE.get=function(){return G.CLOCKWISE};Vi.NONE.get=function(){return G.COLLINEAR};Object.defineProperties(ot,Vi);var Tt=function n(){this._maxCurveSegmentError=0,this._filletAngleQuantum=null,this._closingSegLengthFactor=1,this._segList=null,this._distance=0,this._precisionModel=null,this._bufParams=null,this._li=null,this._s0=null,this._s1=null,this._s2=null,this._seg0=new X,this._seg1=new X,this._offset0=new X,this._offset1=new X,this._side=0,this._hasNarrowConcaveAngle=!1;var t=arguments[0],e=arguments[1],r=arguments[2];this._precisionModel=t,this._bufParams=e,this._li=new yi,this._filletAngleQuantum=Math.PI/2/e.getQuadrantSegments(),e.getQuadrantSegments()>=8&&e.getJoinStyle()===ft.JOIN_ROUND&&(this._closingSegLengthFactor=n.MAX_CLOSING_SEG_LEN_FACTOR),this.init(r)},Do={OFFSET_SEGMENT_SEPARATION_FACTOR:{configurable:!0},INSIDE_TURN_VERTEX_SNAP_DISTANCE_FACTOR:{configurable:!0},CURVE_VERTEX_SNAP_DISTANCE_FACTOR:{configurable:!0},MAX_CLOSING_SEG_LEN_FACTOR:{configurable:!0}};Tt.prototype.addNextSegment=function(t,e){if(this._s0=this._s1,this._s1=this._s2,this._s2=t,this._seg0.setCoordinates(this._s0,this._s1),this.computeOffsetSegment(this._seg0,this._side,this._distance,this._offset0),this._seg1.setCoordinates(this._s1,this._s2),this.computeOffsetSegment(this._seg1,this._side,this._distance,this._offset1),this._s1.equals(this._s2))return null;var r=G.computeOrientation(this._s0,this._s1,this._s2),i=r===G.CLOCKWISE&&this._side===D.LEFT||r===G.COUNTERCLOCKWISE&&this._side===D.RIGHT;r===0?this.addCollinear(e):i?this.addOutsideTurn(r,e):this.addInsideTurn(r,e)};Tt.prototype.addLineEndCap=function(t,e){var r=new X(t,e),i=new X;this.computeOffsetSegment(r,D.LEFT,this._distance,i);var s=new X;this.computeOffsetSegment(r,D.RIGHT,this._distance,s);var o=e.x-t.x,a=e.y-t.y,u=Math.atan2(a,o);switch(this._bufParams.getEndCapStyle()){case ft.CAP_ROUND:this._segList.addPt(i.p1),this.addFilletArc(e,u+Math.PI/2,u-Math.PI/2,G.CLOCKWISE,this._distance),this._segList.addPt(s.p1);break;case ft.CAP_FLAT:this._segList.addPt(i.p1),this._segList.addPt(s.p1);break;case ft.CAP_SQUARE:var l=new P;l.x=Math.abs(this._distance)*Math.cos(u),l.y=Math.abs(this._distance)*Math.sin(u);var c=new P(i.p1.x+l.x,i.p1.y+l.y),h=new P(s.p1.x+l.x,s.p1.y+l.y);this._segList.addPt(c),this._segList.addPt(h);break}};Tt.prototype.getCoordinates=function(){var t=this._segList.getCoordinates();return t};Tt.prototype.addMitreJoin=function(t,e,r,i){var s=!0,o=null;try{o=ur.intersection(e.p0,e.p1,r.p0,r.p1);var a=i<=0?1:o.distance(t)/Math.abs(i);a>this._bufParams.getMitreLimit()&&(s=!1)}catch(u){if(u instanceof Ts)o=new P(0,0),s=!1;else throw u}finally{}s?this._segList.addPt(o):this.addLimitedMitreJoin(e,r,i,this._bufParams.getMitreLimit())};Tt.prototype.addFilletCorner=function(t,e,r,i,s){var o=e.x-t.x,a=e.y-t.y,u=Math.atan2(a,o),l=r.x-t.x,c=r.y-t.y,h=Math.atan2(c,l);i===G.CLOCKWISE?u<=h&&(u+=2*Math.PI):u>=h&&(u-=2*Math.PI),this._segList.addPt(e),this.addFilletArc(t,u,h,i,s),this._segList.addPt(r)};Tt.prototype.addOutsideTurn=function(t,e){if(this._offset0.p1.distance(this._offset1.p0)<this._distance*Tt.OFFSET_SEGMENT_SEPARATION_FACTOR)return this._segList.addPt(this._offset0.p1),null;this._bufParams.getJoinStyle()===ft.JOIN_MITRE?this.addMitreJoin(this._s1,this._offset0,this._offset1,this._distance):this._bufParams.getJoinStyle()===ft.JOIN_BEVEL?this.addBevelJoin(this._offset0,this._offset1):(e&&this._segList.addPt(this._offset0.p1),this.addFilletCorner(this._s1,this._offset0.p1,this._offset1.p0,t,this._distance),this._segList.addPt(this._offset1.p0))};Tt.prototype.createSquare=function(t){this._segList.addPt(new P(t.x+this._distance,t.y+this._distance)),this._segList.addPt(new P(t.x+this._distance,t.y-this._distance)),this._segList.addPt(new P(t.x-this._distance,t.y-this._distance)),this._segList.addPt(new P(t.x-this._distance,t.y+this._distance)),this._segList.closeRing()};Tt.prototype.addSegments=function(t,e){this._segList.addPts(t,e)};Tt.prototype.addFirstSegment=function(){this._segList.addPt(this._offset1.p0)};Tt.prototype.addLastSegment=function(){this._segList.addPt(this._offset1.p1)};Tt.prototype.initSideSegments=function(t,e,r){this._s1=t,this._s2=e,this._side=r,this._seg1.setCoordinates(t,e),this.computeOffsetSegment(this._seg1,r,this._distance,this._offset1)};Tt.prototype.addLimitedMitreJoin=function(t,e,r,i){var s=this._seg0.p1,o=ot.angle(s,this._seg0.p0),a=ot.angleBetweenOriented(this._seg0.p0,s,this._seg1.p1),u=a/2,l=ot.normalize(o+u),c=ot.normalize(l+Math.PI),h=i*r,f=h*Math.abs(Math.sin(u)),p=r-f,d=s.x+h*Math.cos(c),_=s.y+h*Math.sin(c),w=new P(d,_),y=new X(s,w),x=y.pointAlongOffset(1,p),g=y.pointAlongOffset(1,-p);this._side===D.LEFT?(this._segList.addPt(x),this._segList.addPt(g)):(this._segList.addPt(g),this._segList.addPt(x))};Tt.prototype.computeOffsetSegment=function(t,e,r,i){var s=e===D.LEFT?1:-1,o=t.p1.x-t.p0.x,a=t.p1.y-t.p0.y,u=Math.sqrt(o*o+a*a),l=s*r*o/u,c=s*r*a/u;i.p0.x=t.p0.x-c,i.p0.y=t.p0.y+l,i.p1.x=t.p1.x-c,i.p1.y=t.p1.y+l};Tt.prototype.addFilletArc=function(t,e,r,i,s){var o=this,a=i===G.CLOCKWISE?-1:1,u=Math.abs(e-r),l=Math.trunc(u/this._filletAngleQuantum+.5);if(l<1)return null;for(var c=0,h=u/l,f=c,p=new P;f<u;){var d=e+a*f;p.x=t.x+s*Math.cos(d),p.y=t.y+s*Math.sin(d),o._segList.addPt(p),f+=h}};Tt.prototype.addInsideTurn=function(t,e){if(this._li.computeIntersection(this._offset0.p0,this._offset0.p1,this._offset1.p0,this._offset1.p1),this._li.hasIntersection())this._segList.addPt(this._li.getIntersection(0));else if(this._hasNarrowConcaveAngle=!0,this._offset0.p1.distance(this._offset1.p0)<this._distance*Tt.INSIDE_TURN_VERTEX_SNAP_DISTANCE_FACTOR)this._segList.addPt(this._offset0.p1);else{if(this._segList.addPt(this._offset0.p1),this._closingSegLengthFactor>0){var r=new P((this._closingSegLengthFactor*this._offset0.p1.x+this._s1.x)/(this._closingSegLengthFactor+1),(this._closingSegLengthFactor*this._offset0.p1.y+this._s1.y)/(this._closingSegLengthFactor+1));this._segList.addPt(r);var i=new P((this._closingSegLengthFactor*this._offset1.p0.x+this._s1.x)/(this._closingSegLengthFactor+1),(this._closingSegLengthFactor*this._offset1.p0.y+this._s1.y)/(this._closingSegLengthFactor+1));this._segList.addPt(i)}else this._segList.addPt(this._s1);this._segList.addPt(this._offset1.p0)}};Tt.prototype.createCircle=function(t){var e=new P(t.x+this._distance,t.y);this._segList.addPt(e),this.addFilletArc(t,0,2*Math.PI,-1,this._distance),this._segList.closeRing()};Tt.prototype.addBevelJoin=function(t,e){this._segList.addPt(t.p1),this._segList.addPt(e.p0)};Tt.prototype.init=function(t){this._distance=t,this._maxCurveSegmentError=t*(1-Math.cos(this._filletAngleQuantum/2)),this._segList=new Ye,this._segList.setPrecisionModel(this._precisionModel),this._segList.setMinimumVertexDistance(t*Tt.CURVE_VERTEX_SNAP_DISTANCE_FACTOR)};Tt.prototype.addCollinear=function(t){this._li.computeIntersection(this._s0,this._s1,this._s1,this._s2);var e=this._li.getIntersectionNum();e>=2&&(this._bufParams.getJoinStyle()===ft.JOIN_BEVEL||this._bufParams.getJoinStyle()===ft.JOIN_MITRE?(t&&this._segList.addPt(this._offset0.p1),this._segList.addPt(this._offset1.p0)):this.addFilletCorner(this._s1,this._offset0.p1,this._offset1.p0,G.CLOCKWISE,this._distance))};Tt.prototype.closeRing=function(){this._segList.closeRing()};Tt.prototype.hasNarrowConcaveAngle=function(){return this._hasNarrowConcaveAngle};Tt.prototype.interfaces_=function(){return[]};Tt.prototype.getClass=function(){return Tt};Do.OFFSET_SEGMENT_SEPARATION_FACTOR.get=function(){return .001};Do.INSIDE_TURN_VERTEX_SNAP_DISTANCE_FACTOR.get=function(){return .001};Do.CURVE_VERTEX_SNAP_DISTANCE_FACTOR.get=function(){return 1e-6};Do.MAX_CLOSING_SEG_LEN_FACTOR.get=function(){return 80};Object.defineProperties(Tt,Do);var Re=function(){this._distance=0,this._precisionModel=null,this._bufParams=null;var t=arguments[0],e=arguments[1];this._precisionModel=t,this._bufParams=e};Re.prototype.getOffsetCurve=function(t,e){if(this._distance=e,e===0)return null;var r=e<0,i=Math.abs(e),s=this.getSegGen(i);t.length<=1?this.computePointCurve(t[0],s):this.computeOffsetCurve(t,r,s);var o=s.getCoordinates();return r&&it.reverse(o),o};Re.prototype.computeSingleSidedBufferCurve=function(t,e,r){var i=this.simplifyTolerance(this._distance);if(e){r.addSegments(t,!0);var s=Ft.simplify(t,-i),o=s.length-1;r.initSideSegments(s[o],s[o-1],D.LEFT),r.addFirstSegment();for(var a=o-2;a>=0;a--)r.addNextSegment(s[a],!0)}else{r.addSegments(t,!1);var u=Ft.simplify(t,i),l=u.length-1;r.initSideSegments(u[0],u[1],D.LEFT),r.addFirstSegment();for(var c=2;c<=l;c++)r.addNextSegment(u[c],!0)}r.addLastSegment(),r.closeRing()};Re.prototype.computeRingBufferCurve=function(t,e,r){var i=this.simplifyTolerance(this._distance);e===D.RIGHT&&(i=-i);var s=Ft.simplify(t,i),o=s.length-1;r.initSideSegments(s[o-1],s[0],e);for(var a=1;a<=o;a++){var u=a!==1;r.addNextSegment(s[a],u)}r.closeRing()};Re.prototype.computeLineBufferCurve=function(t,e){var r=this.simplifyTolerance(this._distance),i=Ft.simplify(t,r),s=i.length-1;e.initSideSegments(i[0],i[1],D.LEFT);for(var o=2;o<=s;o++)e.addNextSegment(i[o],!0);e.addLastSegment(),e.addLineEndCap(i[s-1],i[s]);var a=Ft.simplify(t,-r),u=a.length-1;e.initSideSegments(a[u],a[u-1],D.LEFT);for(var l=u-2;l>=0;l--)e.addNextSegment(a[l],!0);e.addLastSegment(),e.addLineEndCap(a[1],a[0]),e.closeRing()};Re.prototype.computePointCurve=function(t,e){switch(this._bufParams.getEndCapStyle()){case ft.CAP_ROUND:e.createCircle(t);break;case ft.CAP_SQUARE:e.createSquare(t);break}};Re.prototype.getLineCurve=function(t,e){if(this._distance=e,e<0&&!this._bufParams.isSingleSided()||e===0)return null;var r=Math.abs(e),i=this.getSegGen(r);if(t.length<=1)this.computePointCurve(t[0],i);else if(this._bufParams.isSingleSided()){var s=e<0;this.computeSingleSidedBufferCurve(t,s,i)}else this.computeLineBufferCurve(t,i);var o=i.getCoordinates();return o};Re.prototype.getBufferParameters=function(){return this._bufParams};Re.prototype.simplifyTolerance=function(t){return t*this._bufParams.getSimplifyFactor()};Re.prototype.getRingCurve=function(t,e,r){if(this._distance=r,t.length<=2)return this.getLineCurve(t,r);if(r===0)return Re.copyCoordinates(t);var i=this.getSegGen(r);return this.computeRingBufferCurve(t,e,i),i.getCoordinates()};Re.prototype.computeOffsetCurve=function(t,e,r){var i=this.simplifyTolerance(this._distance);if(e){var s=Ft.simplify(t,-i),o=s.length-1;r.initSideSegments(s[o],s[o-1],D.LEFT),r.addFirstSegment();for(var a=o-2;a>=0;a--)r.addNextSegment(s[a],!0)}else{var u=Ft.simplify(t,i),l=u.length-1;r.initSideSegments(u[0],u[1],D.LEFT),r.addFirstSegment();for(var c=2;c<=l;c++)r.addNextSegment(u[c],!0)}r.addLastSegment()};Re.prototype.getSegGen=function(t){return new Tt(this._precisionModel,this._bufParams,t)};Re.prototype.interfaces_=function(){return[]};Re.prototype.getClass=function(){return Re};Re.copyCoordinates=function(t){for(var e=new Array(t.length).fill(null),r=0;r<e.length;r++)e[r]=new P(t[r]);return e};var bi=function(){this._subgraphs=null,this._seg=new X,this._cga=new G;var t=arguments[0];this._subgraphs=t},bh={DepthSegment:{configurable:!0}};bi.prototype.findStabbedSegments=function(){var t=this;if(arguments.length===1){for(var e=arguments[0],r=new k,i=this._subgraphs.iterator();i.hasNext();){var s=i.next(),o=s.getEnvelope();e.y<o.getMinY()||e.y>o.getMaxY()||t.findStabbedSegments(e,s.getDirectedEdges(),r)}return r}else if(arguments.length===3){if(H(arguments[2],lr)&&arguments[0]instanceof P&&arguments[1]instanceof Yu)for(var a=arguments[0],u=arguments[1],l=arguments[2],c=u.getEdge().getCoordinates(),h=0;h<c.length-1;h++){t._seg.p0=c[h],t._seg.p1=c[h+1],t._seg.p0.y>t._seg.p1.y&&t._seg.reverse();var f=Math.max(t._seg.p0.x,t._seg.p1.x);if(!(f<a.x)&&!t._seg.isHorizontal()&&!(a.y<t._seg.p0.y||a.y>t._seg.p1.y)&&G.computeOrientation(t._seg.p0,t._seg.p1,a)!==G.RIGHT){var p=u.getDepth(D.LEFT);t._seg.p0.equals(c[h])||(p=u.getDepth(D.RIGHT));var d=new si(t._seg,p);l.add(d)}}else if(H(arguments[2],lr)&&arguments[0]instanceof P&&H(arguments[1],lr))for(var _=arguments[0],w=arguments[1],y=arguments[2],x=w.iterator();x.hasNext();){var g=x.next();g.isForward()&&t.findStabbedSegments(_,g,y)}}};bi.prototype.getDepth=function(t){var e=this.findStabbedSegments(t);if(e.size()===0)return 0;var r=gr.min(e);return r._leftDepth};bi.prototype.interfaces_=function(){return[]};bi.prototype.getClass=function(){return bi};bh.DepthSegment.get=function(){return si};Object.defineProperties(bi,bh);var si=function(){this._upwardSeg=null,this._leftDepth=null;var t=arguments[0],e=arguments[1];this._upwardSeg=new X(t),this._leftDepth=e};si.prototype.compareTo=function(t){var e=t;if(this._upwardSeg.minX()>=e._upwardSeg.maxX())return 1;if(this._upwardSeg.maxX()<=e._upwardSeg.minX())return-1;var r=this._upwardSeg.orientationIndex(e._upwardSeg);return r!==0||(r=-1*e._upwardSeg.orientationIndex(this._upwardSeg),r!==0)?r:this._upwardSeg.compareTo(e._upwardSeg)};si.prototype.compareX=function(t,e){var r=t.p0.compareTo(e.p0);return r!==0?r:t.p1.compareTo(e.p1)};si.prototype.toString=function(){return this._upwardSeg.toString()};si.prototype.interfaces_=function(){return[sr]};si.prototype.getClass=function(){return si};var gt=function(t,e,r){this.p0=t||null,this.p1=e||null,this.p2=r||null};gt.prototype.area=function(){return gt.area(this.p0,this.p1,this.p2)};gt.prototype.signedArea=function(){return gt.signedArea(this.p0,this.p1,this.p2)};gt.prototype.interpolateZ=function(t){if(t===null)throw new Rt("Supplied point is null.");return gt.interpolateZ(t,this.p0,this.p1,this.p2)};gt.prototype.longestSideLength=function(){return gt.longestSideLength(this.p0,this.p1,this.p2)};gt.prototype.isAcute=function(){return gt.isAcute(this.p0,this.p1,this.p2)};gt.prototype.circumcentre=function(){return gt.circumcentre(this.p0,this.p1,this.p2)};gt.prototype.area3D=function(){return gt.area3D(this.p0,this.p1,this.p2)};gt.prototype.centroid=function(){return gt.centroid(this.p0,this.p1,this.p2)};gt.prototype.inCentre=function(){return gt.inCentre(this.p0,this.p1,this.p2)};gt.prototype.interfaces_=function(){return[]};gt.prototype.getClass=function(){return gt};gt.area=function(t,e,r){return Math.abs(((r.x-t.x)*(e.y-t.y)-(e.x-t.x)*(r.y-t.y))/2)};gt.signedArea=function(t,e,r){return((r.x-t.x)*(e.y-t.y)-(e.x-t.x)*(r.y-t.y))/2};gt.det=function(t,e,r,i){return t*i-e*r};gt.interpolateZ=function(t,e,r,i){var s=e.x,o=e.y,a=r.x-s,u=i.x-s,l=r.y-o,c=i.y-o,h=a*c-u*l,f=t.x-s,p=t.y-o,d=(c*f-u*p)/h,_=(-l*f+a*p)/h,w=e.z+d*(r.z-e.z)+_*(i.z-e.z);return w};gt.longestSideLength=function(t,e,r){var i=t.distance(e),s=e.distance(r),o=r.distance(t),a=i;return s>a&&(a=s),o>a&&(a=o),a};gt.isAcute=function(t,e,r){return!(!ot.isAcute(t,e,r)||!ot.isAcute(e,r,t)||!ot.isAcute(r,t,e))};gt.circumcentre=function(t,e,r){var i=r.x,s=r.y,o=t.x-i,a=t.y-s,u=e.x-i,l=e.y-s,c=2*gt.det(o,a,u,l),h=gt.det(a,o*o+a*a,l,u*u+l*l),f=gt.det(o,o*o+a*a,u,u*u+l*l),p=i-h/c,d=s+f/c;return new P(p,d)};gt.perpendicularBisector=function(t,e){var r=e.x-t.x,i=e.y-t.y,s=new ur(t.x+r/2,t.y+i/2,1),o=new ur(t.x-i+r/2,t.y+r+i/2,1);return new ur(s,o)};gt.angleBisector=function(t,e,r){var i=e.distance(t),s=e.distance(r),o=i/(i+s),a=r.x-t.x,u=r.y-t.y,l=new P(t.x+o*a,t.y+o*u);return l};gt.area3D=function(t,e,r){var i=e.x-t.x,s=e.y-t.y,o=e.z-t.z,a=r.x-t.x,u=r.y-t.y,l=r.z-t.z,c=s*l-o*u,h=o*a-i*l,f=i*u-s*a,p=c*c+h*h+f*f,d=Math.sqrt(p)/2;return d};gt.centroid=function(t,e,r){var i=(t.x+e.x+r.x)/3,s=(t.y+e.y+r.y)/3;return new P(i,s)};gt.inCentre=function(t,e,r){var i=e.distance(r),s=t.distance(r),o=t.distance(e),a=i+s+o,u=(i*t.x+s*e.x+o*r.x)/a,l=(i*t.y+s*e.y+o*r.y)/a;return new P(u,l)};var ir=function(){this._inputGeom=null,this._distance=null,this._curveBuilder=null,this._curveList=new k;var t=arguments[0],e=arguments[1],r=arguments[2];this._inputGeom=t,this._distance=e,this._curveBuilder=r};ir.prototype.addPoint=function(t){if(this._distance<=0)return null;var e=t.getCoordinates(),r=this._curveBuilder.getLineCurve(e,this._distance);this.addCurve(r,R.EXTERIOR,R.INTERIOR)};ir.prototype.addPolygon=function(t){var e=this,r=this._distance,i=D.LEFT;this._distance<0&&(r=-this._distance,i=D.RIGHT);var s=t.getExteriorRing(),o=it.removeRepeatedPoints(s.getCoordinates());if(this._distance<0&&this.isErodedCompletely(s,this._distance)||this._distance<=0&&o.length<3)return null;this.addPolygonRing(o,r,i,R.EXTERIOR,R.INTERIOR);for(var a=0;a<t.getNumInteriorRing();a++){var u=t.getInteriorRingN(a),l=it.removeRepeatedPoints(u.getCoordinates());e._distance>0&&e.isErodedCompletely(u,-e._distance)||e.addPolygonRing(l,r,D.opposite(i),R.INTERIOR,R.EXTERIOR)}};ir.prototype.isTriangleErodedCompletely=function(t,e){var r=new gt(t[0],t[1],t[2]),i=r.inCentre(),s=G.distancePointLine(i,r.p0,r.p1);return s<Math.abs(e)};ir.prototype.addLineString=function(t){if(this._distance<=0&&!this._curveBuilder.getBufferParameters().isSingleSided())return null;var e=it.removeRepeatedPoints(t.getCoordinates()),r=this._curveBuilder.getLineCurve(e,this._distance);this.addCurve(r,R.EXTERIOR,R.INTERIOR)};ir.prototype.addCurve=function(t,e,r){if(t===null||t.length<2)return null;var i=new Ut(t,new vt(0,R.BOUNDARY,e,r));this._curveList.add(i)};ir.prototype.getCurves=function(){return this.add(this._inputGeom),this._curveList};ir.prototype.addPolygonRing=function(t,e,r,i,s){if(e===0&&t.length<Qr.MINIMUM_VALID_SIZE)return null;var o=i,a=s;t.length>=Qr.MINIMUM_VALID_SIZE&&G.isCCW(t)&&(o=s,a=i,r=D.opposite(r));var u=this._curveBuilder.getRingCurve(t,r,e);this.addCurve(u,o,a)};ir.prototype.add=function(t){if(t.isEmpty())return null;t instanceof Kt?this.addPolygon(t):t instanceof Dt?this.addLineString(t):t instanceof ke?this.addPoint(t):t instanceof us?this.addCollection(t):t instanceof ni?this.addCollection(t):t instanceof Zr?this.addCollection(t):t instanceof Se&&this.addCollection(t)};ir.prototype.isErodedCompletely=function(t,e){var r=t.getCoordinates();if(r.length<4)return e<0;if(r.length===4)return this.isTriangleErodedCompletely(r,e);var i=t.getEnvelopeInternal(),s=Math.min(i.getHeight(),i.getWidth());return e<0&&2*Math.abs(e)>s};ir.prototype.addCollection=function(t){for(var e=this,r=0;r<t.getNumGeometries();r++){var i=t.getGeometryN(r);e.add(i)}};ir.prototype.interfaces_=function(){return[]};ir.prototype.getClass=function(){return ir};var fs=function(){};fs.prototype.locate=function(t){};fs.prototype.interfaces_=function(){return[]};fs.prototype.getClass=function(){return fs};var Hr=function(){this._parent=null,this._atStart=null,this._max=null,this._index=null,this._subcollectionIterator=null;var t=arguments[0];this._parent=t,this._atStart=!0,this._index=0,this._max=t.getNumGeometries()};Hr.prototype.next=function(){if(this._atStart)return this._atStart=!1,Hr.isAtomic(this._parent)&&this._index++,this._parent;if(this._subcollectionIterator!==null){if(this._subcollectionIterator.hasNext())return this._subcollectionIterator.next();this._subcollectionIterator=null}if(this._index>=this._max)throw new Rs;var t=this._parent.getGeometryN(this._index++);return t instanceof Se?(this._subcollectionIterator=new Hr(t),this._subcollectionIterator.next()):t};Hr.prototype.remove=function(){throw new Error(this.getClass().getName())};Hr.prototype.hasNext=function(){if(this._atStart)return!0;if(this._subcollectionIterator!==null){if(this._subcollectionIterator.hasNext())return!0;this._subcollectionIterator=null}return!(this._index>=this._max)};Hr.prototype.interfaces_=function(){return[Ps]};Hr.prototype.getClass=function(){return Hr};Hr.isAtomic=function(t){return!(t instanceof Se)};var qe=function(){this._geom=null;var t=arguments[0];this._geom=t};qe.prototype.locate=function(t){return qe.locate(t,this._geom)};qe.prototype.interfaces_=function(){return[fs]};qe.prototype.getClass=function(){return qe};qe.isPointInRing=function(t,e){return e.getEnvelopeInternal().intersects(t)?G.isPointInRing(t,e.getCoordinates()):!1};qe.containsPointInPolygon=function(t,e){if(e.isEmpty())return!1;var r=e.getExteriorRing();if(!qe.isPointInRing(t,r))return!1;for(var i=0;i<e.getNumInteriorRing();i++){var s=e.getInteriorRingN(i);if(qe.isPointInRing(t,s))return!1}return!0};qe.containsPoint=function(t,e){if(e instanceof Kt)return qe.containsPointInPolygon(t,e);if(e instanceof Se)for(var r=new Hr(e);r.hasNext();){var i=r.next();if(i!==e&&qe.containsPoint(t,i))return!0}return!1};qe.locate=function(t,e){return e.isEmpty()?R.EXTERIOR:qe.containsPoint(t,e)?R.INTERIOR:R.EXTERIOR};var ye=function(){this._edgeMap=new me,this._edgeList=null,this._ptInAreaLocation=[R.NONE,R.NONE]};ye.prototype.getNextCW=function(t){this.getEdges();var e=this._edgeList.indexOf(t),r=e-1;return e===0&&(r=this._edgeList.size()-1),this._edgeList.get(r)};ye.prototype.propagateSideLabels=function(t){for(var e=R.NONE,r=this.iterator();r.hasNext();){var i=r.next(),s=i.getLabel();s.isArea(t)&&s.getLocation(t,D.LEFT)!==R.NONE&&(e=s.getLocation(t,D.LEFT))}if(e===R.NONE)return null;for(var o=e,a=this.iterator();a.hasNext();){var u=a.next(),l=u.getLabel();if(l.getLocation(t,D.ON)===R.NONE&&l.setLocation(t,D.ON,o),l.isArea(t)){var c=l.getLocation(t,D.LEFT),h=l.getLocation(t,D.RIGHT);if(h!==R.NONE){if(h!==o)throw new yn("side location conflict",u.getCoordinate());c===R.NONE&&et.shouldNeverReachHere("found single null side (at "+u.getCoordinate()+")"),o=c}else et.isTrue(l.getLocation(t,D.LEFT)===R.NONE,"found single null side"),l.setLocation(t,D.RIGHT,o),l.setLocation(t,D.LEFT,o)}}};ye.prototype.getCoordinate=function(){var t=this.iterator();if(!t.hasNext())return null;var e=t.next();return e.getCoordinate()};ye.prototype.print=function(t){le.out.println("EdgeEndStar:   "+this.getCoordinate());for(var e=this.iterator();e.hasNext();){var r=e.next();r.print(t)}};ye.prototype.isAreaLabelsConsistent=function(t){return this.computeEdgeEndLabels(t.getBoundaryNodeRule()),this.checkAreaLabelsConsistent(0)};ye.prototype.checkAreaLabelsConsistent=function(t){var e=this.getEdges();if(e.size()<=0)return!0;var r=e.size()-1,i=e.get(r).getLabel(),s=i.getLocation(t,D.LEFT);et.isTrue(s!==R.NONE,"Found unlabelled area edge");for(var o=s,a=this.iterator();a.hasNext();){var u=a.next(),l=u.getLabel();et.isTrue(l.isArea(t),"Found non-area edge");var c=l.getLocation(t,D.LEFT),h=l.getLocation(t,D.RIGHT);if(c===h||h!==o)return!1;o=c}return!0};ye.prototype.findIndex=function(t){var e=this;this.iterator();for(var r=0;r<this._edgeList.size();r++){var i=e._edgeList.get(r);if(i===t)return r}return-1};ye.prototype.iterator=function(){return this.getEdges().iterator()};ye.prototype.getEdges=function(){return this._edgeList===null&&(this._edgeList=new k(this._edgeMap.values())),this._edgeList};ye.prototype.getLocation=function(t,e,r){return this._ptInAreaLocation[t]===R.NONE&&(this._ptInAreaLocation[t]=qe.locate(e,r[t].getGeometry())),this._ptInAreaLocation[t]};ye.prototype.toString=function(){var t=new zr;t.append("EdgeEndStar:   "+this.getCoordinate()),t.append(`
`);for(var e=this.iterator();e.hasNext();){var r=e.next();t.append(r),t.append(`
`)}return t.toString()};ye.prototype.computeEdgeEndLabels=function(t){for(var e=this.iterator();e.hasNext();){var r=e.next();r.computeLabel(t)}};ye.prototype.computeLabelling=function(t){var e=this;this.computeEdgeEndLabels(t[0].getBoundaryNodeRule()),this.propagateSideLabels(0),this.propagateSideLabels(1);for(var r=[!1,!1],i=this.iterator();i.hasNext();)for(var s=i.next(),o=s.getLabel(),a=0;a<2;a++)o.isLine(a)&&o.getLocation(a)===R.BOUNDARY&&(r[a]=!0);for(var u=this.iterator();u.hasNext();)for(var l=u.next(),c=l.getLabel(),h=0;h<2;h++)if(c.isAnyNull(h)){var f=R.NONE;if(r[h])f=R.EXTERIOR;else{var p=l.getCoordinate();f=e.getLocation(h,p,t)}c.setAllLocationsIfNull(h,f)}};ye.prototype.getDegree=function(){return this._edgeMap.size()};ye.prototype.insertEdgeEnd=function(t,e){this._edgeMap.put(t,e),this._edgeList=null};ye.prototype.interfaces_=function(){return[]};ye.prototype.getClass=function(){return ye};var dg=function(n){function t(){n.call(this),this._resultAreaEdgeList=null,this._label=null,this._SCANNING_FOR_INCOMING=1,this._LINKING_TO_OUTGOING=2}return n&&(t.__proto__=n),t.prototype=Object.create(n&&n.prototype),t.prototype.constructor=t,t.prototype.linkResultDirectedEdges=function(){var r=this;this.getResultAreaEdges();for(var i=null,s=null,o=this._SCANNING_FOR_INCOMING,a=0;a<this._resultAreaEdgeList.size();a++){var u=r._resultAreaEdgeList.get(a),l=u.getSym();if(u.getLabel().isArea())switch(i===null&&u.isInResult()&&(i=u),o){case r._SCANNING_FOR_INCOMING:if(!l.isInResult())continue;s=l,o=r._LINKING_TO_OUTGOING;break;case r._LINKING_TO_OUTGOING:if(!u.isInResult())continue;s.setNext(u),o=r._SCANNING_FOR_INCOMING;break}}if(o===this._LINKING_TO_OUTGOING){if(i===null)throw new yn("no outgoing dirEdge found",this.getCoordinate());et.isTrue(i.isInResult(),"unable to link last incoming dirEdge"),s.setNext(i)}},t.prototype.insert=function(r){var i=r;this.insertEdgeEnd(i,i)},t.prototype.getRightmostEdge=function(){var r=this.getEdges(),i=r.size();if(i<1)return null;var s=r.get(0);if(i===1)return s;var o=r.get(i-1),a=s.getQuadrant(),u=o.getQuadrant();return wt.isNorthern(a)&&wt.isNorthern(u)?s:!wt.isNorthern(a)&&!wt.isNorthern(u)?o:s.getDy()!==0?s:o.getDy()!==0?o:(et.shouldNeverReachHere("found two horizontal edges incident on node"),null)},t.prototype.print=function(r){le.out.println("DirectedEdgeStar: "+this.getCoordinate());for(var i=this.iterator();i.hasNext();){var s=i.next();r.print("out "),s.print(r),r.println(),r.print("in "),s.getSym().print(r),r.println()}},t.prototype.getResultAreaEdges=function(){var r=this;if(this._resultAreaEdgeList!==null)return this._resultAreaEdgeList;this._resultAreaEdgeList=new k;for(var i=this.iterator();i.hasNext();){var s=i.next();(s.isInResult()||s.getSym().isInResult())&&r._resultAreaEdgeList.add(s)}return this._resultAreaEdgeList},t.prototype.updateLabelling=function(r){for(var i=this.iterator();i.hasNext();){var s=i.next(),o=s.getLabel();o.setAllLocationsIfNull(0,r.getLocation(0)),o.setAllLocationsIfNull(1,r.getLocation(1))}},t.prototype.linkAllDirectedEdges=function(){var r=this;this.getEdges();for(var i=null,s=null,o=this._edgeList.size()-1;o>=0;o--){var a=r._edgeList.get(o),u=a.getSym();s===null&&(s=u),i!==null&&u.setNext(i),i=a}s.setNext(i)},t.prototype.computeDepths=function(){var r=this;if(arguments.length===1){var i=arguments[0],s=this.findIndex(i),o=i.getDepth(D.LEFT),a=i.getDepth(D.RIGHT),u=this.computeDepths(s+1,this._edgeList.size(),o),l=this.computeDepths(0,s,u);if(l!==a)throw new yn("depth mismatch at "+i.getCoordinate())}else if(arguments.length===3){for(var c=arguments[0],h=arguments[1],f=arguments[2],p=f,d=c;d<h;d++){var _=r._edgeList.get(d);_.setEdgeDepths(D.RIGHT,p),p=_.getDepth(D.LEFT)}return p}},t.prototype.mergeSymLabels=function(){for(var r=this.iterator();r.hasNext();){var i=r.next(),s=i.getLabel();s.merge(i.getSym().getLabel())}},t.prototype.linkMinimalDirectedEdges=function(r){for(var i=this,s=null,o=null,a=this._SCANNING_FOR_INCOMING,u=this._resultAreaEdgeList.size()-1;u>=0;u--){var l=i._resultAreaEdgeList.get(u),c=l.getSym();switch(s===null&&l.getEdgeRing()===r&&(s=l),a){case i._SCANNING_FOR_INCOMING:if(c.getEdgeRing()!==r)continue;o=c,a=i._LINKING_TO_OUTGOING;break;case i._LINKING_TO_OUTGOING:if(l.getEdgeRing()!==r)continue;o.setNextMin(l),a=i._SCANNING_FOR_INCOMING;break}}a===this._LINKING_TO_OUTGOING&&(et.isTrue(s!==null,"found null for first outgoing dirEdge"),et.isTrue(s.getEdgeRing()===r,"unable to link last incoming dirEdge"),o.setNextMin(s))},t.prototype.getOutgoingDegree=function(){if(arguments.length===0){for(var r=0,i=this.iterator();i.hasNext();){var s=i.next();s.isInResult()&&r++}return r}else if(arguments.length===1){for(var o=arguments[0],a=0,u=this.iterator();u.hasNext();){var l=u.next();l.getEdgeRing()===o&&a++}return a}},t.prototype.getLabel=function(){return this._label},t.prototype.findCoveredLineEdges=function(){for(var r=R.NONE,i=this.iterator();i.hasNext();){var s=i.next(),o=s.getSym();if(!s.isLineEdge()){if(s.isInResult()){r=R.INTERIOR;break}if(o.isInResult()){r=R.EXTERIOR;break}}}if(r===R.NONE)return null;for(var a=r,u=this.iterator();u.hasNext();){var l=u.next(),c=l.getSym();l.isLineEdge()?l.getEdge().setCovered(a===R.INTERIOR):(l.isInResult()&&(a=R.EXTERIOR),c.isInResult()&&(a=R.INTERIOR))}},t.prototype.computeLabelling=function(r){var i=this;n.prototype.computeLabelling.call(this,r),this._label=new vt(R.NONE);for(var s=this.iterator();s.hasNext();)for(var o=s.next(),a=o.getEdge(),u=a.getLabel(),l=0;l<2;l++){var c=u.getLocation(l);(c===R.INTERIOR||c===R.BOUNDARY)&&i._label.setLocation(l,R.INTERIOR)}},t.prototype.interfaces_=function(){return[]},t.prototype.getClass=function(){return t},t}(ye),Mh=function(n){function t(){n.apply(this,arguments)}return n&&(t.__proto__=n),t.prototype=Object.create(n&&n.prototype),t.prototype.constructor=t,t.prototype.createNode=function(r){return new au(r,new dg)},t.prototype.interfaces_=function(){return[]},t.prototype.getClass=function(){return t},t}(ls),Vn=function n(){this._pts=null,this._orientation=null;var t=arguments[0];this._pts=t,this._orientation=n.orientation(t)};Vn.prototype.compareTo=function(t){var e=t,r=Vn.compareOriented(this._pts,this._orientation,e._pts,e._orientation);return r};Vn.prototype.interfaces_=function(){return[sr]};Vn.prototype.getClass=function(){return Vn};Vn.orientation=function(t){return it.increasingDirection(t)===1};Vn.compareOriented=function(t,e,r,i){for(var s=e?1:-1,o=i?1:-1,a=e?t.length:-1,u=i?r.length:-1,l=e?0:t.length-1,c=i?0:r.length-1;;){var h=t[l].compareTo(r[c]);if(h!==0)return h;l+=s,c+=o;var f=l===a,p=c===u;if(f&&!p)return-1;if(!f&&p)return 1;if(f&&p)return 0}};var dr=function(){this._edges=new k,this._ocaMap=new me};dr.prototype.print=function(t){var e=this;t.print("MULTILINESTRING ( ");for(var r=0;r<this._edges.size();r++){var i=e._edges.get(r);r>0&&t.print(","),t.print("(");for(var s=i.getCoordinates(),o=0;o<s.length;o++)o>0&&t.print(","),t.print(s[o].x+" "+s[o].y);t.println(")")}t.print(")  ")};dr.prototype.addAll=function(t){for(var e=this,r=t.iterator();r.hasNext();)e.add(r.next())};dr.prototype.findEdgeIndex=function(t){for(var e=this,r=0;r<this._edges.size();r++)if(e._edges.get(r).equals(t))return r;return-1};dr.prototype.iterator=function(){return this._edges.iterator()};dr.prototype.getEdges=function(){return this._edges};dr.prototype.get=function(t){return this._edges.get(t)};dr.prototype.findEqualEdge=function(t){var e=new Vn(t.getCoordinates()),r=this._ocaMap.get(e);return r};dr.prototype.add=function(t){this._edges.add(t);var e=new Vn(t.getCoordinates());this._ocaMap.put(e,t)};dr.prototype.interfaces_=function(){return[]};dr.prototype.getClass=function(){return dr};var oi=function(){};oi.prototype.processIntersections=function(t,e,r,i){};oi.prototype.isDone=function(){};oi.prototype.interfaces_=function(){return[]};oi.prototype.getClass=function(){return oi};var Ze=function(){this._hasIntersection=!1,this._hasProper=!1,this._hasProperInterior=!1,this._hasInterior=!1,this._properIntersectionPoint=null,this._li=null,this._isSelfIntersection=null,this.numIntersections=0,this.numInteriorIntersections=0,this.numProperIntersections=0,this.numTests=0;var t=arguments[0];this._li=t};Ze.prototype.isTrivialIntersection=function(t,e,r,i){if(t===r&&this._li.getIntersectionNum()===1){if(Ze.isAdjacentSegments(e,i))return!0;if(t.isClosed()){var s=t.size()-1;if(e===0&&i===s||i===0&&e===s)return!0}}return!1};Ze.prototype.getProperIntersectionPoint=function(){return this._properIntersectionPoint};Ze.prototype.hasProperInteriorIntersection=function(){return this._hasProperInterior};Ze.prototype.getLineIntersector=function(){return this._li};Ze.prototype.hasProperIntersection=function(){return this._hasProper};Ze.prototype.processIntersections=function(t,e,r,i){if(t===r&&e===i)return null;this.numTests++;var s=t.getCoordinates()[e],o=t.getCoordinates()[e+1],a=r.getCoordinates()[i],u=r.getCoordinates()[i+1];this._li.computeIntersection(s,o,a,u),this._li.hasIntersection()&&(this.numIntersections++,this._li.isInteriorIntersection()&&(this.numInteriorIntersections++,this._hasInterior=!0),this.isTrivialIntersection(t,e,r,i)||(this._hasIntersection=!0,t.addIntersections(this._li,e,0),r.addIntersections(this._li,i,1),this._li.isProper()&&(this.numProperIntersections++,this._hasProper=!0,this._hasProperInterior=!0)))};Ze.prototype.hasIntersection=function(){return this._hasIntersection};Ze.prototype.isDone=function(){return!1};Ze.prototype.hasInteriorIntersection=function(){return this._hasInterior};Ze.prototype.interfaces_=function(){return[oi]};Ze.prototype.getClass=function(){return Ze};Ze.isAdjacentSegments=function(t,e){return Math.abs(t-e)===1};var Fr=function(){this.coord=null,this.segmentIndex=null,this.dist=null;var t=arguments[0],e=arguments[1],r=arguments[2];this.coord=new P(t),this.segmentIndex=e,this.dist=r};Fr.prototype.getSegmentIndex=function(){return this.segmentIndex};Fr.prototype.getCoordinate=function(){return this.coord};Fr.prototype.print=function(t){t.print(this.coord),t.print(" seg # = "+this.segmentIndex),t.println(" dist = "+this.dist)};Fr.prototype.compareTo=function(t){var e=t;return this.compare(e.segmentIndex,e.dist)};Fr.prototype.isEndPoint=function(t){return this.segmentIndex===0&&this.dist===0||this.segmentIndex===t};Fr.prototype.toString=function(){return this.coord+" seg # = "+this.segmentIndex+" dist = "+this.dist};Fr.prototype.getDistance=function(){return this.dist};Fr.prototype.compare=function(t,e){return this.segmentIndex<t?-1:this.segmentIndex>t?1:this.dist<e?-1:this.dist>e?1:0};Fr.prototype.interfaces_=function(){return[sr]};Fr.prototype.getClass=function(){return Fr};var en=function(){this._nodeMap=new me,this.edge=null;var t=arguments[0];this.edge=t};en.prototype.print=function(t){t.println("Intersections:");for(var e=this.iterator();e.hasNext();){var r=e.next();r.print(t)}};en.prototype.iterator=function(){return this._nodeMap.values().iterator()};en.prototype.addSplitEdges=function(t){var e=this;this.addEndpoints();for(var r=this.iterator(),i=r.next();r.hasNext();){var s=r.next(),o=e.createSplitEdge(i,s);t.add(o),i=s}};en.prototype.addEndpoints=function(){var t=this.edge.pts.length-1;this.add(this.edge.pts[0],0,0),this.add(this.edge.pts[t],t,0)};en.prototype.createSplitEdge=function(t,e){var r=this,i=e.segmentIndex-t.segmentIndex+2,s=this.edge.pts[e.segmentIndex],o=e.dist>0||!e.coord.equals2D(s);o||i--;var a=new Array(i).fill(null),u=0;a[u++]=new P(t.coord);for(var l=t.segmentIndex+1;l<=e.segmentIndex;l++)a[u++]=r.edge.pts[l];return o&&(a[u]=e.coord),new Ea(a,new vt(this.edge._label))};en.prototype.add=function(t,e,r){var i=new Fr(t,e,r),s=this._nodeMap.get(i);return s!==null?s:(this._nodeMap.put(i,i),i)};en.prototype.isIntersection=function(t){for(var e=this.iterator();e.hasNext();){var r=e.next();if(r.coord.equals(t))return!0}return!1};en.prototype.interfaces_=function(){return[]};en.prototype.getClass=function(){return en};var ai=function(){};ai.prototype.getChainStartIndices=function(t){var e=this,r=0,i=new k;i.add(new Pr(r));do{var s=e.findChainEnd(t,r);i.add(new Pr(s)),r=s}while(r<t.length-1);var o=ai.toIntArray(i);return o};ai.prototype.findChainEnd=function(t,e){for(var r=wt.quadrant(t[e],t[e+1]),i=e+1;i<t.length;){var s=wt.quadrant(t[i-1],t[i]);if(s!==r)break;i++}return i-1};ai.prototype.interfaces_=function(){return[]};ai.prototype.getClass=function(){return ai};ai.toIntArray=function(t){for(var e=new Array(t.size()).fill(null),r=0;r<e.length;r++)e[r]=t.get(r).intValue();return e};var wn=function(){this.e=null,this.pts=null,this.startIndex=null,this.env1=new W,this.env2=new W;var t=arguments[0];this.e=t,this.pts=t.getCoordinates();var e=new ai;this.startIndex=e.getChainStartIndices(this.pts)};wn.prototype.getCoordinates=function(){return this.pts};wn.prototype.getMaxX=function(t){var e=this.pts[this.startIndex[t]].x,r=this.pts[this.startIndex[t+1]].x;return e>r?e:r};wn.prototype.getMinX=function(t){var e=this.pts[this.startIndex[t]].x,r=this.pts[this.startIndex[t+1]].x;return e<r?e:r};wn.prototype.computeIntersectsForChain=function(){if(arguments.length===4){var t=arguments[0],e=arguments[1],r=arguments[2],i=arguments[3];this.computeIntersectsForChain(this.startIndex[t],this.startIndex[t+1],e,e.startIndex[r],e.startIndex[r+1],i)}else if(arguments.length===6){var s=arguments[0],o=arguments[1],a=arguments[2],u=arguments[3],l=arguments[4],c=arguments[5],h=this.pts[s],f=this.pts[o],p=a.pts[u],d=a.pts[l];if(o-s===1&&l-u===1)return c.addIntersections(this.e,s,a.e,u),null;if(this.env1.init(h,f),this.env2.init(p,d),!this.env1.intersects(this.env2))return null;var _=Math.trunc((s+o)/2),w=Math.trunc((u+l)/2);s<_&&(u<w&&this.computeIntersectsForChain(s,_,a,u,w,c),w<l&&this.computeIntersectsForChain(s,_,a,w,l,c)),_<o&&(u<w&&this.computeIntersectsForChain(_,o,a,u,w,c),w<l&&this.computeIntersectsForChain(_,o,a,w,l,c))}};wn.prototype.getStartIndexes=function(){return this.startIndex};wn.prototype.computeIntersects=function(t,e){for(var r=this,i=0;i<this.startIndex.length-1;i++)for(var s=0;s<t.startIndex.length-1;s++)r.computeIntersectsForChain(i,t,s,e)};wn.prototype.interfaces_=function(){return[]};wn.prototype.getClass=function(){return wn};var ue=function n(){var t=this;this._depth=Array(2).fill().map(function(){return Array(3)});for(var e=0;e<2;e++)for(var r=0;r<3;r++)t._depth[e][r]=n.NULL_VALUE},Nh={NULL_VALUE:{configurable:!0}};ue.prototype.getDepth=function(t,e){return this._depth[t][e]};ue.prototype.setDepth=function(t,e,r){this._depth[t][e]=r};ue.prototype.isNull=function(){var t=this;if(arguments.length===0){for(var e=0;e<2;e++)for(var r=0;r<3;r++)if(t._depth[e][r]!==ue.NULL_VALUE)return!1;return!0}else if(arguments.length===1){var i=arguments[0];return this._depth[i][1]===ue.NULL_VALUE}else if(arguments.length===2){var s=arguments[0],o=arguments[1];return this._depth[s][o]===ue.NULL_VALUE}};ue.prototype.normalize=function(){for(var t=this,e=0;e<2;e++)if(!t.isNull(e)){var r=t._depth[e][1];t._depth[e][2]<r&&(r=t._depth[e][2]),r<0&&(r=0);for(var i=1;i<3;i++){var s=0;t._depth[e][i]>r&&(s=1),t._depth[e][i]=s}}};ue.prototype.getDelta=function(t){return this._depth[t][D.RIGHT]-this._depth[t][D.LEFT]};ue.prototype.getLocation=function(t,e){return this._depth[t][e]<=0?R.EXTERIOR:R.INTERIOR};ue.prototype.toString=function(){return"A: "+this._depth[0][1]+","+this._depth[0][2]+" B: "+this._depth[1][1]+","+this._depth[1][2]};ue.prototype.add=function(){var t=this;if(arguments.length===1)for(var e=arguments[0],r=0;r<2;r++)for(var i=1;i<3;i++){var s=e.getLocation(r,i);(s===R.EXTERIOR||s===R.INTERIOR)&&(t.isNull(r,i)?t._depth[r][i]=ue.depthAtLocation(s):t._depth[r][i]+=ue.depthAtLocation(s))}else if(arguments.length===3){var o=arguments[0],a=arguments[1],u=arguments[2];u===R.INTERIOR&&this._depth[o][a]++}};ue.prototype.interfaces_=function(){return[]};ue.prototype.getClass=function(){return ue};ue.depthAtLocation=function(t){return t===R.EXTERIOR?0:t===R.INTERIOR?1:ue.NULL_VALUE};Nh.NULL_VALUE.get=function(){return-1};Object.defineProperties(ue,Nh);var Ea=function(n){function t(){if(n.call(this),this.pts=null,this._env=null,this.eiList=new en(this),this._name=null,this._mce=null,this._isIsolated=!0,this._depth=new ue,this._depthDelta=0,arguments.length===1){var e=arguments[0];t.call(this,e,null)}else if(arguments.length===2){var r=arguments[0],i=arguments[1];this.pts=r,this._label=i}}return n&&(t.__proto__=n),t.prototype=Object.create(n&&n.prototype),t.prototype.constructor=t,t.prototype.getDepth=function(){return this._depth},t.prototype.getCollapsedEdge=function(){var r=new Array(2).fill(null);r[0]=this.pts[0],r[1]=this.pts[1];var i=new t(r,vt.toLineLabel(this._label));return i},t.prototype.isIsolated=function(){return this._isIsolated},t.prototype.getCoordinates=function(){return this.pts},t.prototype.setIsolated=function(r){this._isIsolated=r},t.prototype.setName=function(r){this._name=r},t.prototype.equals=function(r){var i=this;if(!(r instanceof t))return!1;var s=r;if(this.pts.length!==s.pts.length)return!1;for(var o=!0,a=!0,u=this.pts.length,l=0;l<this.pts.length;l++)if(i.pts[l].equals2D(s.pts[l])||(o=!1),i.pts[l].equals2D(s.pts[--u])||(a=!1),!o&&!a)return!1;return!0},t.prototype.getCoordinate=function(){if(arguments.length===0)return this.pts.length>0?this.pts[0]:null;if(arguments.length===1){var r=arguments[0];return this.pts[r]}},t.prototype.print=function(r){var i=this;r.print("edge "+this._name+": "),r.print("LINESTRING (");for(var s=0;s<this.pts.length;s++)s>0&&r.print(","),r.print(i.pts[s].x+" "+i.pts[s].y);r.print(")  "+this._label+" "+this._depthDelta)},t.prototype.computeIM=function(r){t.updateIM(this._label,r)},t.prototype.isCollapsed=function(){return!this._label.isArea()||this.pts.length!==3?!1:!!this.pts[0].equals(this.pts[2])},t.prototype.isClosed=function(){return this.pts[0].equals(this.pts[this.pts.length-1])},t.prototype.getMaximumSegmentIndex=function(){return this.pts.length-1},t.prototype.getDepthDelta=function(){return this._depthDelta},t.prototype.getNumPoints=function(){return this.pts.length},t.prototype.printReverse=function(r){var i=this;r.print("edge "+this._name+": ");for(var s=this.pts.length-1;s>=0;s--)r.print(i.pts[s]+" ");r.println("")},t.prototype.getMonotoneChainEdge=function(){return this._mce===null&&(this._mce=new wn(this)),this._mce},t.prototype.getEnvelope=function(){var r=this;if(this._env===null){this._env=new W;for(var i=0;i<this.pts.length;i++)r._env.expandToInclude(r.pts[i])}return this._env},t.prototype.addIntersection=function(r,i,s,o){var a=new P(r.getIntersection(o)),u=i,l=r.getEdgeDistance(s,o),c=u+1;if(c<this.pts.length){var h=this.pts[c];a.equals2D(h)&&(u=c,l=0)}this.eiList.add(a,u,l)},t.prototype.toString=function(){var r=this,i=new zr;i.append("edge "+this._name+": "),i.append("LINESTRING (");for(var s=0;s<this.pts.length;s++)s>0&&i.append(","),i.append(r.pts[s].x+" "+r.pts[s].y);return i.append(")  "+this._label+" "+this._depthDelta),i.toString()},t.prototype.isPointwiseEqual=function(r){var i=this;if(this.pts.length!==r.pts.length)return!1;for(var s=0;s<this.pts.length;s++)if(!i.pts[s].equals2D(r.pts[s]))return!1;return!0},t.prototype.setDepthDelta=function(r){this._depthDelta=r},t.prototype.getEdgeIntersectionList=function(){return this.eiList},t.prototype.addIntersections=function(r,i,s){for(var o=this,a=0;a<r.getIntersectionNum();a++)o.addIntersection(r,i,s,a)},t.prototype.interfaces_=function(){return[]},t.prototype.getClass=function(){return t},t.updateIM=function(){if(arguments.length===2){var r=arguments[0],i=arguments[1];i.setAtLeastIfValid(r.getLocation(0,D.ON),r.getLocation(1,D.ON),1),r.isArea()&&(i.setAtLeastIfValid(r.getLocation(0,D.LEFT),r.getLocation(1,D.LEFT),2),i.setAtLeastIfValid(r.getLocation(0,D.RIGHT),r.getLocation(1,D.RIGHT),2))}else return n.prototype.updateIM.apply(this,arguments)},t}(Xe),Ce=function(t){this._workingPrecisionModel=null,this._workingNoder=null,this._geomFact=null,this._graph=null,this._edgeList=new dr,this._bufParams=t||null};Ce.prototype.setWorkingPrecisionModel=function(t){this._workingPrecisionModel=t};Ce.prototype.insertUniqueEdge=function(t){var e=this._edgeList.findEqualEdge(t);if(e!==null){var r=e.getLabel(),i=t.getLabel();e.isPointwiseEqual(t)||(i=new vt(t.getLabel()),i.flip()),r.merge(i);var s=Ce.depthDelta(i),o=e.getDepthDelta(),a=o+s;e.setDepthDelta(a)}else this._edgeList.add(t),t.setDepthDelta(Ce.depthDelta(t.getLabel()))};Ce.prototype.buildSubgraphs=function(t,e){for(var r=new k,i=t.iterator();i.hasNext();){var s=i.next(),o=s.getRightmostCoordinate(),a=new bi(r),u=a.getDepth(o);s.computeDepth(u),s.findResultEdges(),r.add(s),e.add(s.getDirectedEdges(),s.getNodes())}};Ce.prototype.createSubgraphs=function(t){for(var e=new k,r=t.getNodes().iterator();r.hasNext();){var i=r.next();if(!i.isVisited()){var s=new be;s.create(i),e.add(s)}}return gr.sort(e,gr.reverseOrder()),e};Ce.prototype.createEmptyResultGeometry=function(){var t=this._geomFact.createPolygon();return t};Ce.prototype.getNoder=function(t){if(this._workingNoder!==null)return this._workingNoder;var e=new xl,r=new yi;return r.setPrecisionModel(t),e.setSegmentIntersector(new Ze(r)),e};Ce.prototype.buffer=function(t,e){var r=this._workingPrecisionModel;r===null&&(r=t.getPrecisionModel()),this._geomFact=t.getFactory();var i=new Re(r,this._bufParams),s=new ir(t,e,i),o=s.getCurves();if(o.size()<=0)return this.createEmptyResultGeometry();this.computeNodedEdges(o,r),this._graph=new At(new Mh),this._graph.addEdges(this._edgeList.getEdges());var a=this.createSubgraphs(this._graph),u=new Ge(this._geomFact);this.buildSubgraphs(a,u);var l=u.getPolygons();if(l.size()<=0)return this.createEmptyResultGeometry();var c=this._geomFact.buildGeometry(l);return c};Ce.prototype.computeNodedEdges=function(t,e){var r=this,i=this.getNoder(e);i.computeNodes(t);for(var s=i.getNodedSubstrings(),o=s.iterator();o.hasNext();){var a=o.next(),u=a.getCoordinates();if(!(u.length===2&&u[0].equals2D(u[1]))){var l=a.getData(),c=new Ea(a.getCoordinates(),new vt(l));r.insertUniqueEdge(c)}}};Ce.prototype.setNoder=function(t){this._workingNoder=t};Ce.prototype.interfaces_=function(){return[]};Ce.prototype.getClass=function(){return Ce};Ce.depthDelta=function(t){var e=t.getLocation(0,D.LEFT),r=t.getLocation(0,D.RIGHT);return e===R.INTERIOR&&r===R.EXTERIOR?1:e===R.EXTERIOR&&r===R.INTERIOR?-1:0};Ce.convertSegStrings=function(t){for(var e=new nt,r=new k;t.hasNext();){var i=t.next(),s=e.createLineString(i.getCoordinates());r.add(s)}return e.buildGeometry(r)};var qn=function(){if(this._noder=null,this._scaleFactor=null,this._offsetX=null,this._offsetY=null,this._isScaled=!1,arguments.length===2){var t=arguments[0],e=arguments[1];this._noder=t,this._scaleFactor=e,this._offsetX=0,this._offsetY=0,this._isScaled=!this.isIntegerPrecision()}else if(arguments.length===4){var r=arguments[0],i=arguments[1],s=arguments[2],o=arguments[3];this._noder=r,this._scaleFactor=i,this._offsetX=s,this._offsetY=o,this._isScaled=!this.isIntegerPrecision()}};qn.prototype.rescale=function(){var t=this;if(H(arguments[0],Xt))for(var e=arguments[0],r=e.iterator();r.hasNext();){var i=r.next();t.rescale(i.getCoordinates())}else if(arguments[0]instanceof Array){for(var s=arguments[0],o=0;o<s.length;o++)s[o].x=s[o].x/t._scaleFactor+t._offsetX,s[o].y=s[o].y/t._scaleFactor+t._offsetY;s.length===2&&s[0].equals2D(s[1])&&le.out.println(s)}};qn.prototype.scale=function(){var t=this;if(H(arguments[0],Xt)){for(var e=arguments[0],r=new k,i=e.iterator();i.hasNext();){var s=i.next();r.add(new Ut(t.scale(s.getCoordinates()),s.getData()))}return r}else if(arguments[0]instanceof Array){for(var o=arguments[0],a=new Array(o.length).fill(null),u=0;u<o.length;u++)a[u]=new P(Math.round((o[u].x-t._offsetX)*t._scaleFactor),Math.round((o[u].y-t._offsetY)*t._scaleFactor),o[u].z);var l=it.removeRepeatedPoints(a);return l}};qn.prototype.isIntegerPrecision=function(){return this._scaleFactor===1};qn.prototype.getNodedSubstrings=function(){var t=this._noder.getNodedSubstrings();return this._isScaled&&this.rescale(t),t};qn.prototype.computeNodes=function(t){var e=t;this._isScaled&&(e=this.scale(t)),this._noder.computeNodes(e)};qn.prototype.interfaces_=function(){return[ii]};qn.prototype.getClass=function(){return qn};var kr=function(){this._li=new yi,this._segStrings=null;var t=arguments[0];this._segStrings=t},Th={fact:{configurable:!0}};kr.prototype.checkEndPtVertexIntersections=function(){var t=this;if(arguments.length===0)for(var e=this._segStrings.iterator();e.hasNext();){var r=e.next(),i=r.getCoordinates();t.checkEndPtVertexIntersections(i[0],t._segStrings),t.checkEndPtVertexIntersections(i[i.length-1],t._segStrings)}else if(arguments.length===2){for(var s=arguments[0],o=arguments[1],a=o.iterator();a.hasNext();)for(var u=a.next(),l=u.getCoordinates(),c=1;c<l.length-1;c++)if(l[c].equals(s))throw new mn("found endpt/interior pt intersection at index "+c+" :pt "+s)}};kr.prototype.checkInteriorIntersections=function(){var t=this;if(arguments.length===0)for(var e=this._segStrings.iterator();e.hasNext();)for(var r=e.next(),i=this._segStrings.iterator();i.hasNext();){var s=i.next();t.checkInteriorIntersections(r,s)}else if(arguments.length===2)for(var o=arguments[0],a=arguments[1],u=o.getCoordinates(),l=a.getCoordinates(),c=0;c<u.length-1;c++)for(var h=0;h<l.length-1;h++)t.checkInteriorIntersections(o,c,a,h);else if(arguments.length===4){var f=arguments[0],p=arguments[1],d=arguments[2],_=arguments[3];if(f===d&&p===_)return null;var w=f.getCoordinates()[p],y=f.getCoordinates()[p+1],x=d.getCoordinates()[_],g=d.getCoordinates()[_+1];if(this._li.computeIntersection(w,y,x,g),this._li.hasIntersection()&&(this._li.isProper()||this.hasInteriorIntersection(this._li,w,y)||this.hasInteriorIntersection(this._li,x,g)))throw new mn("found non-noded intersection at "+w+"-"+y+" and "+x+"-"+g)}};kr.prototype.checkValid=function(){this.checkEndPtVertexIntersections(),this.checkInteriorIntersections(),this.checkCollapses()};kr.prototype.checkCollapses=function(){var t=this;if(arguments.length===0)for(var e=this._segStrings.iterator();e.hasNext();){var r=e.next();t.checkCollapses(r)}else if(arguments.length===1)for(var i=arguments[0],s=i.getCoordinates(),o=0;o<s.length-2;o++)t.checkCollapse(s[o],s[o+1],s[o+2])};kr.prototype.hasInteriorIntersection=function(t,e,r){for(var i=0;i<t.getIntersectionNum();i++){var s=t.getIntersection(i);if(!(s.equals(e)||s.equals(r)))return!0}return!1};kr.prototype.checkCollapse=function(t,e,r){if(t.equals(r))throw new mn("found non-noded collapse at "+kr.fact.createLineString([t,e,r]))};kr.prototype.interfaces_=function(){return[]};kr.prototype.getClass=function(){return kr};Th.fact.get=function(){return new nt};Object.defineProperties(kr,Th);var Le=function(){this._li=null,this._pt=null,this._originalPt=null,this._ptScaled=null,this._p0Scaled=null,this._p1Scaled=null,this._scaleFactor=null,this._minx=null,this._maxx=null,this._miny=null,this._maxy=null,this._corner=new Array(4).fill(null),this._safeEnv=null;var t=arguments[0],e=arguments[1],r=arguments[2];if(this._originalPt=t,this._pt=t,this._scaleFactor=e,this._li=r,e<=0)throw new Rt("Scale factor must be non-zero");e!==1&&(this._pt=new P(this.scale(t.x),this.scale(t.y)),this._p0Scaled=new P,this._p1Scaled=new P),this.initCorners(this._pt)},Ph={SAFE_ENV_EXPANSION_FACTOR:{configurable:!0}};Le.prototype.intersectsScaled=function(t,e){var r=Math.min(t.x,e.x),i=Math.max(t.x,e.x),s=Math.min(t.y,e.y),o=Math.max(t.y,e.y),a=this._maxx<r||this._minx>i||this._maxy<s||this._miny>o;if(a)return!1;var u=this.intersectsToleranceSquare(t,e);return et.isTrue(!(a&&u),"Found bad envelope test"),u};Le.prototype.initCorners=function(t){var e=.5;this._minx=t.x-e,this._maxx=t.x+e,this._miny=t.y-e,this._maxy=t.y+e,this._corner[0]=new P(this._maxx,this._maxy),this._corner[1]=new P(this._minx,this._maxy),this._corner[2]=new P(this._minx,this._miny),this._corner[3]=new P(this._maxx,this._miny)};Le.prototype.intersects=function(t,e){return this._scaleFactor===1?this.intersectsScaled(t,e):(this.copyScaled(t,this._p0Scaled),this.copyScaled(e,this._p1Scaled),this.intersectsScaled(this._p0Scaled,this._p1Scaled))};Le.prototype.scale=function(t){return Math.round(t*this._scaleFactor)};Le.prototype.getCoordinate=function(){return this._originalPt};Le.prototype.copyScaled=function(t,e){e.x=this.scale(t.x),e.y=this.scale(t.y)};Le.prototype.getSafeEnvelope=function(){if(this._safeEnv===null){var t=Le.SAFE_ENV_EXPANSION_FACTOR/this._scaleFactor;this._safeEnv=new W(this._originalPt.x-t,this._originalPt.x+t,this._originalPt.y-t,this._originalPt.y+t)}return this._safeEnv};Le.prototype.intersectsPixelClosure=function(t,e){return this._li.computeIntersection(t,e,this._corner[0],this._corner[1]),!!(this._li.hasIntersection()||(this._li.computeIntersection(t,e,this._corner[1],this._corner[2]),this._li.hasIntersection())||(this._li.computeIntersection(t,e,this._corner[2],this._corner[3]),this._li.hasIntersection())||(this._li.computeIntersection(t,e,this._corner[3],this._corner[0]),this._li.hasIntersection()))};Le.prototype.intersectsToleranceSquare=function(t,e){var r=!1,i=!1;return this._li.computeIntersection(t,e,this._corner[0],this._corner[1]),!!(this._li.isProper()||(this._li.computeIntersection(t,e,this._corner[1],this._corner[2]),this._li.isProper())||(this._li.hasIntersection()&&(r=!0),this._li.computeIntersection(t,e,this._corner[2],this._corner[3]),this._li.isProper())||(this._li.hasIntersection()&&(i=!0),this._li.computeIntersection(t,e,this._corner[3],this._corner[0]),this._li.isProper())||r&&i||t.equals(this._pt)||e.equals(this._pt))};Le.prototype.addSnappedNode=function(t,e){var r=t.getCoordinate(e),i=t.getCoordinate(e+1);return this.intersects(r,i)?(t.addIntersection(this.getCoordinate(),e),!0):!1};Le.prototype.interfaces_=function(){return[]};Le.prototype.getClass=function(){return Le};Ph.SAFE_ENV_EXPANSION_FACTOR.get=function(){return .75};Object.defineProperties(Le,Ph);var ao=function(){this.tempEnv1=new W,this.selectedSegment=new X};ao.prototype.select=function(){if(arguments.length!==1){if(arguments.length===2){var t=arguments[0],e=arguments[1];t.getLineSegment(e,this.selectedSegment),this.select(this.selectedSegment)}}};ao.prototype.interfaces_=function(){return[]};ao.prototype.getClass=function(){return ao};var ps=function(){this._index=null;var t=arguments[0];this._index=t},Rh={HotPixelSnapAction:{configurable:!0}};ps.prototype.snap=function(){if(arguments.length===1){var t=arguments[0];return this.snap(t,null,-1)}else if(arguments.length===3){var e=arguments[0],r=arguments[1],i=arguments[2],s=e.getSafeEnvelope(),o=new Lh(e,r,i);return this._index.query(s,{interfaces_:function(){return[Un]},visitItem:function(a){var u=a;u.select(s,o)}}),o.isNodeAdded()}};ps.prototype.interfaces_=function(){return[]};ps.prototype.getClass=function(){return ps};Rh.HotPixelSnapAction.get=function(){return Lh};Object.defineProperties(ps,Rh);var Lh=function(n){function t(){n.call(this),this._hotPixel=null,this._parentEdge=null,this._hotPixelVertexIndex=null,this._isNodeAdded=!1;var e=arguments[0],r=arguments[1],i=arguments[2];this._hotPixel=e,this._parentEdge=r,this._hotPixelVertexIndex=i}return n&&(t.__proto__=n),t.prototype=Object.create(n&&n.prototype),t.prototype.constructor=t,t.prototype.isNodeAdded=function(){return this._isNodeAdded},t.prototype.select=function(){if(arguments.length===2){var r=arguments[0],i=arguments[1],s=r.getContext();if(this._parentEdge!==null&&s===this._parentEdge&&i===this._hotPixelVertexIndex)return null;this._isNodeAdded=this._hotPixel.addSnappedNode(s,i)}else return n.prototype.select.apply(this,arguments)},t.prototype.interfaces_=function(){return[]},t.prototype.getClass=function(){return t},t}(ao),Mi=function(){this._li=null,this._interiorIntersections=null;var t=arguments[0];this._li=t,this._interiorIntersections=new k};Mi.prototype.processIntersections=function(t,e,r,i){var s=this;if(t===r&&e===i)return null;var o=t.getCoordinates()[e],a=t.getCoordinates()[e+1],u=r.getCoordinates()[i],l=r.getCoordinates()[i+1];if(this._li.computeIntersection(o,a,u,l),this._li.hasIntersection()&&this._li.isInteriorIntersection()){for(var c=0;c<this._li.getIntersectionNum();c++)s._interiorIntersections.add(s._li.getIntersection(c));t.addIntersections(this._li,e,0),r.addIntersections(this._li,i,1)}};Mi.prototype.isDone=function(){return!1};Mi.prototype.getInteriorIntersections=function(){return this._interiorIntersections};Mi.prototype.interfaces_=function(){return[oi]};Mi.prototype.getClass=function(){return Mi};var rn=function(){this._pm=null,this._li=null,this._scaleFactor=null,this._noder=null,this._pointSnapper=null,this._nodedSegStrings=null;var t=arguments[0];this._pm=t,this._li=new yi,this._li.setPrecisionModel(t),this._scaleFactor=t.getScale()};rn.prototype.checkCorrectness=function(t){var e=Ut.getNodedSubstrings(t),r=new kr(e);try{r.checkValid()}catch(i){if(i instanceof dh)i.printStackTrace();else throw i}finally{}};rn.prototype.getNodedSubstrings=function(){return Ut.getNodedSubstrings(this._nodedSegStrings)};rn.prototype.snapRound=function(t,e){var r=this.findInteriorIntersections(t,e);this.computeIntersectionSnaps(r),this.computeVertexSnaps(t)};rn.prototype.findInteriorIntersections=function(t,e){var r=new Mi(e);return this._noder.setSegmentIntersector(r),this._noder.computeNodes(t),r.getInteriorIntersections()};rn.prototype.computeVertexSnaps=function(){var t=this;if(H(arguments[0],Xt))for(var e=arguments[0],r=e.iterator();r.hasNext();){var i=r.next();t.computeVertexSnaps(i)}else if(arguments[0]instanceof Ut)for(var s=arguments[0],o=s.getCoordinates(),a=0;a<o.length;a++){var u=new Le(o[a],t._scaleFactor,t._li),l=t._pointSnapper.snap(u,s,a);l&&s.addIntersection(o[a],a)}};rn.prototype.computeNodes=function(t){this._nodedSegStrings=t,this._noder=new xl,this._pointSnapper=new ps(this._noder.getIndex()),this.snapRound(t,this._li)};rn.prototype.computeIntersectionSnaps=function(t){for(var e=this,r=t.iterator();r.hasNext();){var i=r.next(),s=new Le(i,e._scaleFactor,e._li);e._pointSnapper.snap(s)}};rn.prototype.interfaces_=function(){return[ii]};rn.prototype.getClass=function(){return rn};var ae=function(){if(this._argGeom=null,this._distance=null,this._bufParams=new ft,this._resultGeometry=null,this._saveException=null,arguments.length===1){var t=arguments[0];this._argGeom=t}else if(arguments.length===2){var e=arguments[0],r=arguments[1];this._argGeom=e,this._bufParams=r}},Ls={CAP_ROUND:{configurable:!0},CAP_BUTT:{configurable:!0},CAP_FLAT:{configurable:!0},CAP_SQUARE:{configurable:!0},MAX_PRECISION_DIGITS:{configurable:!0}};ae.prototype.bufferFixedPrecision=function(t){var e=new qn(new rn(new pt(1)),t.getScale()),r=new Ce(this._bufParams);r.setWorkingPrecisionModel(t),r.setNoder(e),this._resultGeometry=r.buffer(this._argGeom,this._distance)};ae.prototype.bufferReducedPrecision=function(){var t=this;if(arguments.length===0){for(var e=ae.MAX_PRECISION_DIGITS;e>=0;e--){try{t.bufferReducedPrecision(e)}catch(o){if(o instanceof yn)t._saveException=o;else throw o}finally{}if(t._resultGeometry!==null)return null}throw this._saveException}else if(arguments.length===1){var r=arguments[0],i=ae.precisionScaleFactor(this._argGeom,this._distance,r),s=new pt(i);this.bufferFixedPrecision(s)}};ae.prototype.computeGeometry=function(){if(this.bufferOriginalPrecision(),this._resultGeometry!==null)return null;var t=this._argGeom.getFactory().getPrecisionModel();t.getType()===pt.FIXED?this.bufferFixedPrecision(t):this.bufferReducedPrecision()};ae.prototype.setQuadrantSegments=function(t){this._bufParams.setQuadrantSegments(t)};ae.prototype.bufferOriginalPrecision=function(){try{var t=new Ce(this._bufParams);this._resultGeometry=t.buffer(this._argGeom,this._distance)}catch(e){if(e instanceof mn)this._saveException=e;else throw e}finally{}};ae.prototype.getResultGeometry=function(t){return this._distance=t,this.computeGeometry(),this._resultGeometry};ae.prototype.setEndCapStyle=function(t){this._bufParams.setEndCapStyle(t)};ae.prototype.interfaces_=function(){return[]};ae.prototype.getClass=function(){return ae};ae.bufferOp=function(){if(arguments.length===2){var t=arguments[0],e=arguments[1],r=new ae(t),i=r.getResultGeometry(e);return i}else if(arguments.length===3){if(Number.isInteger(arguments[2])&&arguments[0]instanceof Y&&typeof arguments[1]=="number"){var s=arguments[0],o=arguments[1],a=arguments[2],u=new ae(s);u.setQuadrantSegments(a);var l=u.getResultGeometry(o);return l}else if(arguments[2]instanceof ft&&arguments[0]instanceof Y&&typeof arguments[1]=="number"){var c=arguments[0],h=arguments[1],f=arguments[2],p=new ae(c,f),d=p.getResultGeometry(h);return d}}else if(arguments.length===4){var _=arguments[0],w=arguments[1],y=arguments[2],x=arguments[3],g=new ae(_);g.setQuadrantSegments(y),g.setEndCapStyle(x);var m=g.getResultGeometry(w);return m}};ae.precisionScaleFactor=function(t,e,r){var i=t.getEnvelopeInternal(),s=We.max(Math.abs(i.getMaxX()),Math.abs(i.getMaxY()),Math.abs(i.getMinX()),Math.abs(i.getMinY())),o=e>0?e:0,a=s+2*o,u=Math.trunc(Math.log(a)/Math.log(10)+1),l=r-u,c=Math.pow(10,l);return c};Ls.CAP_ROUND.get=function(){return ft.CAP_ROUND};Ls.CAP_BUTT.get=function(){return ft.CAP_FLAT};Ls.CAP_FLAT.get=function(){return ft.CAP_FLAT};Ls.CAP_SQUARE.get=function(){return ft.CAP_SQUARE};Ls.MAX_PRECISION_DIGITS.get=function(){return 12};Object.defineProperties(ae,Ls);var Ee=function(){this._pt=[new P,new P],this._distance=J.NaN,this._isNull=!0};Ee.prototype.getCoordinates=function(){return this._pt};Ee.prototype.getCoordinate=function(t){return this._pt[t]};Ee.prototype.setMinimum=function(){if(arguments.length===1){var t=arguments[0];this.setMinimum(t._pt[0],t._pt[1])}else if(arguments.length===2){var e=arguments[0],r=arguments[1];if(this._isNull)return this.initialize(e,r),null;var i=e.distance(r);i<this._distance&&this.initialize(e,r,i)}};Ee.prototype.initialize=function(){if(arguments.length===0)this._isNull=!0;else if(arguments.length===2){var t=arguments[0],e=arguments[1];this._pt[0].setCoordinate(t),this._pt[1].setCoordinate(e),this._distance=t.distance(e),this._isNull=!1}else if(arguments.length===3){var r=arguments[0],i=arguments[1],s=arguments[2];this._pt[0].setCoordinate(r),this._pt[1].setCoordinate(i),this._distance=s,this._isNull=!1}};Ee.prototype.getDistance=function(){return this._distance};Ee.prototype.setMaximum=function(){if(arguments.length===1){var t=arguments[0];this.setMaximum(t._pt[0],t._pt[1])}else if(arguments.length===2){var e=arguments[0],r=arguments[1];if(this._isNull)return this.initialize(e,r),null;var i=e.distance(r);i>this._distance&&this.initialize(e,r,i)}};Ee.prototype.interfaces_=function(){return[]};Ee.prototype.getClass=function(){return Ee};var Wr=function(){};Wr.prototype.interfaces_=function(){return[]};Wr.prototype.getClass=function(){return Wr};Wr.computeDistance=function(){if(arguments[2]instanceof Ee&&arguments[0]instanceof Dt&&arguments[1]instanceof P)for(var t=arguments[0],e=arguments[1],r=arguments[2],i=t.getCoordinates(),s=new X,o=0;o<i.length-1;o++){s.setCoordinates(i[o],i[o+1]);var a=s.closestPoint(e);r.setMinimum(a,e)}else if(arguments[2]instanceof Ee&&arguments[0]instanceof Kt&&arguments[1]instanceof P){var u=arguments[0],l=arguments[1],c=arguments[2];Wr.computeDistance(u.getExteriorRing(),l,c);for(var h=0;h<u.getNumInteriorRing();h++)Wr.computeDistance(u.getInteriorRingN(h),l,c)}else if(arguments[2]instanceof Ee&&arguments[0]instanceof Y&&arguments[1]instanceof P){var f=arguments[0],p=arguments[1],d=arguments[2];if(f instanceof Dt)Wr.computeDistance(f,p,d);else if(f instanceof Kt)Wr.computeDistance(f,p,d);else if(f instanceof Se)for(var _=f,w=0;w<_.getNumGeometries();w++){var y=_.getGeometryN(w);Wr.computeDistance(y,p,d)}else d.setMinimum(f.getCoordinate(),p)}else if(arguments[2]instanceof Ee&&arguments[0]instanceof X&&arguments[1]instanceof P){var x=arguments[0],g=arguments[1],m=arguments[2],E=x.closestPoint(g);m.setMinimum(E,g)}};var ui=function(t){this._maxPtDist=new Ee,this._inputGeom=t||null},Il={MaxPointDistanceFilter:{configurable:!0},MaxMidpointDistanceFilter:{configurable:!0}};ui.prototype.computeMaxMidpointDistance=function(t){var e=new Wn(this._inputGeom);t.apply(e),this._maxPtDist.setMaximum(e.getMaxPointDistance())};ui.prototype.computeMaxVertexDistance=function(t){var e=new Ni(this._inputGeom);t.apply(e),this._maxPtDist.setMaximum(e.getMaxPointDistance())};ui.prototype.findDistance=function(t){return this.computeMaxVertexDistance(t),this.computeMaxMidpointDistance(t),this._maxPtDist.getDistance()};ui.prototype.getDistancePoints=function(){return this._maxPtDist};ui.prototype.interfaces_=function(){return[]};ui.prototype.getClass=function(){return ui};Il.MaxPointDistanceFilter.get=function(){return Ni};Il.MaxMidpointDistanceFilter.get=function(){return Wn};Object.defineProperties(ui,Il);var Ni=function(t){this._maxPtDist=new Ee,this._minPtDist=new Ee,this._geom=t||null};Ni.prototype.filter=function(t){this._minPtDist.initialize(),Wr.computeDistance(this._geom,t,this._minPtDist),this._maxPtDist.setMaximum(this._minPtDist)};Ni.prototype.getMaxPointDistance=function(){return this._maxPtDist};Ni.prototype.interfaces_=function(){return[Jr]};Ni.prototype.getClass=function(){return Ni};var Wn=function(t){this._maxPtDist=new Ee,this._minPtDist=new Ee,this._geom=t||null};Wn.prototype.filter=function(t,e){if(e===0)return null;var r=t.getCoordinate(e-1),i=t.getCoordinate(e),s=new P((r.x+i.x)/2,(r.y+i.y)/2);this._minPtDist.initialize(),Wr.computeDistance(this._geom,s,this._minPtDist),this._maxPtDist.setMaximum(this._minPtDist)};Wn.prototype.isDone=function(){return!1};Wn.prototype.isGeometryChanged=function(){return!1};Wn.prototype.getMaxPointDistance=function(){return this._maxPtDist};Wn.prototype.interfaces_=function(){return[fr]};Wn.prototype.getClass=function(){return Wn};var gn=function(t){this._comps=t||null};gn.prototype.filter=function(t){t instanceof Kt&&this._comps.add(t)};gn.prototype.interfaces_=function(){return[Lr]};gn.prototype.getClass=function(){return gn};gn.getPolygons=function(){if(arguments.length===1){var t=arguments[0];return gn.getPolygons(t,new k)}else if(arguments.length===2){var e=arguments[0],r=arguments[1];return e instanceof Kt?r.add(e):e instanceof Se&&e.apply(new gn(r)),r}};var oe=function(){if(this._lines=null,this._isForcedToLineString=!1,arguments.length===1){var t=arguments[0];this._lines=t}else if(arguments.length===2){var e=arguments[0],r=arguments[1];this._lines=e,this._isForcedToLineString=r}};oe.prototype.filter=function(t){if(this._isForcedToLineString&&t instanceof Qr){var e=t.getFactory().createLineString(t.getCoordinateSequence());return this._lines.add(e),null}t instanceof Dt&&this._lines.add(t)};oe.prototype.setForceToLineString=function(t){this._isForcedToLineString=t};oe.prototype.interfaces_=function(){return[vn]};oe.prototype.getClass=function(){return oe};oe.getGeometry=function(){if(arguments.length===1){var t=arguments[0];return t.getFactory().buildGeometry(oe.getLines(t))}else if(arguments.length===2){var e=arguments[0],r=arguments[1];return e.getFactory().buildGeometry(oe.getLines(e,r))}};oe.getLines=function(){if(arguments.length===1){var t=arguments[0];return oe.getLines(t,!1)}else if(arguments.length===2){if(H(arguments[0],Xt)&&H(arguments[1],Xt)){for(var e=arguments[0],r=arguments[1],i=e.iterator();i.hasNext();){var s=i.next();oe.getLines(s,r)}return r}else if(arguments[0]instanceof Y&&typeof arguments[1]=="boolean"){var o=arguments[0],a=arguments[1],u=new k;return o.apply(new oe(u,a)),u}else if(arguments[0]instanceof Y&&H(arguments[1],Xt)){var l=arguments[0],c=arguments[1];return l instanceof Dt?c.add(l):l.apply(new oe(c)),c}}else if(arguments.length===3){if(typeof arguments[2]=="boolean"&&H(arguments[0],Xt)&&H(arguments[1],Xt)){for(var h=arguments[0],f=arguments[1],p=arguments[2],d=h.iterator();d.hasNext();){var _=d.next();oe.getLines(_,f,p)}return f}else if(typeof arguments[2]=="boolean"&&arguments[0]instanceof Y&&H(arguments[1],Xt)){var w=arguments[0],y=arguments[1],x=arguments[2];return w.apply(new oe(y,x)),y}}};var mr=function(){if(this._boundaryRule=rr.OGC_SFS_BOUNDARY_RULE,this._isIn=null,this._numBoundaries=null,arguments.length!==0){if(arguments.length===1){var t=arguments[0];if(t===null)throw new Rt("Rule must be non-null");this._boundaryRule=t}}};mr.prototype.locateInternal=function(){var t=this;if(arguments[0]instanceof P&&arguments[1]instanceof Kt){var e=arguments[0],r=arguments[1];if(r.isEmpty())return R.EXTERIOR;var i=r.getExteriorRing(),s=this.locateInPolygonRing(e,i);if(s===R.EXTERIOR)return R.EXTERIOR;if(s===R.BOUNDARY)return R.BOUNDARY;for(var o=0;o<r.getNumInteriorRing();o++){var a=r.getInteriorRingN(o),u=t.locateInPolygonRing(e,a);if(u===R.INTERIOR)return R.EXTERIOR;if(u===R.BOUNDARY)return R.BOUNDARY}return R.INTERIOR}else if(arguments[0]instanceof P&&arguments[1]instanceof Dt){var l=arguments[0],c=arguments[1];if(!c.getEnvelopeInternal().intersects(l))return R.EXTERIOR;var h=c.getCoordinates();return!c.isClosed()&&(l.equals(h[0])||l.equals(h[h.length-1]))?R.BOUNDARY:G.isOnLine(l,h)?R.INTERIOR:R.EXTERIOR}else if(arguments[0]instanceof P&&arguments[1]instanceof ke){var f=arguments[0],p=arguments[1],d=p.getCoordinate();return d.equals2D(f)?R.INTERIOR:R.EXTERIOR}};mr.prototype.locateInPolygonRing=function(t,e){return e.getEnvelopeInternal().intersects(t)?G.locatePointInRing(t,e.getCoordinates()):R.EXTERIOR};mr.prototype.intersects=function(t,e){return this.locate(t,e)!==R.EXTERIOR};mr.prototype.updateLocationInfo=function(t){t===R.INTERIOR&&(this._isIn=!0),t===R.BOUNDARY&&this._numBoundaries++};mr.prototype.computeLocation=function(t,e){var r=this;if(e instanceof ke&&this.updateLocationInfo(this.locateInternal(t,e)),e instanceof Dt)this.updateLocationInfo(this.locateInternal(t,e));else if(e instanceof Kt)this.updateLocationInfo(this.locateInternal(t,e));else if(e instanceof ni)for(var i=e,s=0;s<i.getNumGeometries();s++){var o=i.getGeometryN(s);r.updateLocationInfo(r.locateInternal(t,o))}else if(e instanceof Zr)for(var a=e,u=0;u<a.getNumGeometries();u++){var l=a.getGeometryN(u);r.updateLocationInfo(r.locateInternal(t,l))}else if(e instanceof Se)for(var c=new Hr(e);c.hasNext();){var h=c.next();h!==e&&r.computeLocation(t,h)}};mr.prototype.locate=function(t,e){return e.isEmpty()?R.EXTERIOR:e instanceof Dt?this.locateInternal(t,e):e instanceof Kt?this.locateInternal(t,e):(this._isIn=!1,this._numBoundaries=0,this.computeLocation(t,e),this._boundaryRule.isInBoundary(this._numBoundaries)?R.BOUNDARY:this._numBoundaries>0||this._isIn?R.INTERIOR:R.EXTERIOR)};mr.prototype.interfaces_=function(){return[]};mr.prototype.getClass=function(){return mr};var xe=function n(){if(this._component=null,this._segIndex=null,this._pt=null,arguments.length===2){var t=arguments[0],e=arguments[1];n.call(this,t,n.INSIDE_AREA,e)}else if(arguments.length===3){var r=arguments[0],i=arguments[1],s=arguments[2];this._component=r,this._segIndex=i,this._pt=s}},Ah={INSIDE_AREA:{configurable:!0}};xe.prototype.isInsideArea=function(){return this._segIndex===xe.INSIDE_AREA};xe.prototype.getCoordinate=function(){return this._pt};xe.prototype.getGeometryComponent=function(){return this._component};xe.prototype.getSegmentIndex=function(){return this._segIndex};xe.prototype.interfaces_=function(){return[]};xe.prototype.getClass=function(){return xe};Ah.INSIDE_AREA.get=function(){return-1};Object.defineProperties(xe,Ah);var Gn=function(t){this._pts=t||null};Gn.prototype.filter=function(t){t instanceof ke&&this._pts.add(t)};Gn.prototype.interfaces_=function(){return[Lr]};Gn.prototype.getClass=function(){return Gn};Gn.getPoints=function(){if(arguments.length===1){var t=arguments[0];return t instanceof ke?gr.singletonList(t):Gn.getPoints(t,new k)}else if(arguments.length===2){var e=arguments[0],r=arguments[1];return e instanceof ke?r.add(e):e instanceof Se&&e.apply(new Gn(r)),r}};var Ti=function(){this._locations=null;var t=arguments[0];this._locations=t};Ti.prototype.filter=function(t){(t instanceof ke||t instanceof Dt||t instanceof Kt)&&this._locations.add(new xe(t,0,t.getCoordinate()))};Ti.prototype.interfaces_=function(){return[Lr]};Ti.prototype.getClass=function(){return Ti};Ti.getLocations=function(t){var e=new k;return t.apply(new Ti(e)),e};var ce=function(){if(this._geom=null,this._terminateDistance=0,this._ptLocator=new mr,this._minDistanceLocation=null,this._minDistance=J.MAX_VALUE,arguments.length===2){var t=arguments[0],e=arguments[1];this._geom=[t,e],this._terminateDistance=0}else if(arguments.length===3){var r=arguments[0],i=arguments[1],s=arguments[2];this._geom=new Array(2).fill(null),this._geom[0]=r,this._geom[1]=i,this._terminateDistance=s}};ce.prototype.computeContainmentDistance=function(){var t=this;if(arguments.length===0){var e=new Array(2).fill(null);if(this.computeContainmentDistance(0,e),this._minDistance<=this._terminateDistance)return null;this.computeContainmentDistance(1,e)}else if(arguments.length===2){var r=arguments[0],i=arguments[1],s=1-r,o=gn.getPolygons(this._geom[r]);if(o.size()>0){var a=Ti.getLocations(this._geom[s]);if(this.computeContainmentDistance(a,o,i),this._minDistance<=this._terminateDistance)return this._minDistanceLocation[s]=i[0],this._minDistanceLocation[r]=i[1],null}}else if(arguments.length===3){if(arguments[2]instanceof Array&&H(arguments[0],lr)&&H(arguments[1],lr)){for(var u=arguments[0],l=arguments[1],c=arguments[2],h=0;h<u.size();h++)for(var f=u.get(h),p=0;p<l.size();p++)if(t.computeContainmentDistance(f,l.get(p),c),t._minDistance<=t._terminateDistance)return null}else if(arguments[2]instanceof Array&&arguments[0]instanceof xe&&arguments[1]instanceof Kt){var d=arguments[0],_=arguments[1],w=arguments[2],y=d.getCoordinate();if(R.EXTERIOR!==this._ptLocator.locate(y,_))return this._minDistance=0,w[0]=d,w[1]=new xe(_,y),null}}};ce.prototype.computeMinDistanceLinesPoints=function(t,e,r){for(var i=this,s=0;s<t.size();s++)for(var o=t.get(s),a=0;a<e.size();a++){var u=e.get(a);if(i.computeMinDistance(o,u,r),i._minDistance<=i._terminateDistance)return null}};ce.prototype.computeFacetDistance=function(){var t=new Array(2).fill(null),e=oe.getLines(this._geom[0]),r=oe.getLines(this._geom[1]),i=Gn.getPoints(this._geom[0]),s=Gn.getPoints(this._geom[1]);if(this.computeMinDistanceLines(e,r,t),this.updateMinDistance(t,!1),this._minDistance<=this._terminateDistance||(t[0]=null,t[1]=null,this.computeMinDistanceLinesPoints(e,s,t),this.updateMinDistance(t,!1),this._minDistance<=this._terminateDistance)||(t[0]=null,t[1]=null,this.computeMinDistanceLinesPoints(r,i,t),this.updateMinDistance(t,!0),this._minDistance<=this._terminateDistance))return null;t[0]=null,t[1]=null,this.computeMinDistancePoints(i,s,t),this.updateMinDistance(t,!1)};ce.prototype.nearestLocations=function(){return this.computeMinDistance(),this._minDistanceLocation};ce.prototype.updateMinDistance=function(t,e){if(t[0]===null)return null;e?(this._minDistanceLocation[0]=t[1],this._minDistanceLocation[1]=t[0]):(this._minDistanceLocation[0]=t[0],this._minDistanceLocation[1]=t[1])};ce.prototype.nearestPoints=function(){this.computeMinDistance();var t=[this._minDistanceLocation[0].getCoordinate(),this._minDistanceLocation[1].getCoordinate()];return t};ce.prototype.computeMinDistance=function(){var t=this;if(arguments.length===0){if(this._minDistanceLocation!==null||(this._minDistanceLocation=new Array(2).fill(null),this.computeContainmentDistance(),this._minDistance<=this._terminateDistance))return null;this.computeFacetDistance()}else if(arguments.length===3){if(arguments[2]instanceof Array&&arguments[0]instanceof Dt&&arguments[1]instanceof ke){var e=arguments[0],r=arguments[1],i=arguments[2];if(e.getEnvelopeInternal().distance(r.getEnvelopeInternal())>this._minDistance)return null;for(var s=e.getCoordinates(),o=r.getCoordinate(),a=0;a<s.length-1;a++){var u=G.distancePointLine(o,s[a],s[a+1]);if(u<t._minDistance){t._minDistance=u;var l=new X(s[a],s[a+1]),c=l.closestPoint(o);i[0]=new xe(e,a,c),i[1]=new xe(r,0,o)}if(t._minDistance<=t._terminateDistance)return null}}else if(arguments[2]instanceof Array&&arguments[0]instanceof Dt&&arguments[1]instanceof Dt){var h=arguments[0],f=arguments[1],p=arguments[2];if(h.getEnvelopeInternal().distance(f.getEnvelopeInternal())>this._minDistance)return null;for(var d=h.getCoordinates(),_=f.getCoordinates(),w=0;w<d.length-1;w++)for(var y=0;y<_.length-1;y++){var x=G.distanceLineLine(d[w],d[w+1],_[y],_[y+1]);if(x<t._minDistance){t._minDistance=x;var g=new X(d[w],d[w+1]),m=new X(_[y],_[y+1]),E=g.closestPoints(m);p[0]=new xe(h,w,E[0]),p[1]=new xe(f,y,E[1])}if(t._minDistance<=t._terminateDistance)return null}}}};ce.prototype.computeMinDistancePoints=function(t,e,r){for(var i=this,s=0;s<t.size();s++)for(var o=t.get(s),a=0;a<e.size();a++){var u=e.get(a),l=o.getCoordinate().distance(u.getCoordinate());if(l<i._minDistance&&(i._minDistance=l,r[0]=new xe(o,0,o.getCoordinate()),r[1]=new xe(u,0,u.getCoordinate())),i._minDistance<=i._terminateDistance)return null}};ce.prototype.distance=function(){if(this._geom[0]===null||this._geom[1]===null)throw new Rt("null geometries are not supported");return this._geom[0].isEmpty()||this._geom[1].isEmpty()?0:(this.computeMinDistance(),this._minDistance)};ce.prototype.computeMinDistanceLines=function(t,e,r){for(var i=this,s=0;s<t.size();s++)for(var o=t.get(s),a=0;a<e.size();a++){var u=e.get(a);if(i.computeMinDistance(o,u,r),i._minDistance<=i._terminateDistance)return null}};ce.prototype.interfaces_=function(){return[]};ce.prototype.getClass=function(){return ce};ce.distance=function(t,e){var r=new ce(t,e);return r.distance()};ce.isWithinDistance=function(t,e,r){var i=new ce(t,e,r);return i.distance()<=r};ce.nearestPoints=function(t,e){var r=new ce(t,e);return r.nearestPoints()};var de=function(){this._pt=[new P,new P],this._distance=J.NaN,this._isNull=!0};de.prototype.getCoordinates=function(){return this._pt};de.prototype.getCoordinate=function(t){return this._pt[t]};de.prototype.setMinimum=function(){if(arguments.length===1){var t=arguments[0];this.setMinimum(t._pt[0],t._pt[1])}else if(arguments.length===2){var e=arguments[0],r=arguments[1];if(this._isNull)return this.initialize(e,r),null;var i=e.distance(r);i<this._distance&&this.initialize(e,r,i)}};de.prototype.initialize=function(){if(arguments.length===0)this._isNull=!0;else if(arguments.length===2){var t=arguments[0],e=arguments[1];this._pt[0].setCoordinate(t),this._pt[1].setCoordinate(e),this._distance=t.distance(e),this._isNull=!1}else if(arguments.length===3){var r=arguments[0],i=arguments[1],s=arguments[2];this._pt[0].setCoordinate(r),this._pt[1].setCoordinate(i),this._distance=s,this._isNull=!1}};de.prototype.toString=function(){return hr.toLineString(this._pt[0],this._pt[1])};de.prototype.getDistance=function(){return this._distance};de.prototype.setMaximum=function(){if(arguments.length===1){var t=arguments[0];this.setMaximum(t._pt[0],t._pt[1])}else if(arguments.length===2){var e=arguments[0],r=arguments[1];if(this._isNull)return this.initialize(e,r),null;var i=e.distance(r);i>this._distance&&this.initialize(e,r,i)}};de.prototype.interfaces_=function(){return[]};de.prototype.getClass=function(){return de};var br=function(){};br.prototype.interfaces_=function(){return[]};br.prototype.getClass=function(){return br};br.computeDistance=function(){if(arguments[2]instanceof de&&arguments[0]instanceof Dt&&arguments[1]instanceof P)for(var t=arguments[0],e=arguments[1],r=arguments[2],i=new X,s=t.getCoordinates(),o=0;o<s.length-1;o++){i.setCoordinates(s[o],s[o+1]);var a=i.closestPoint(e);r.setMinimum(a,e)}else if(arguments[2]instanceof de&&arguments[0]instanceof Kt&&arguments[1]instanceof P){var u=arguments[0],l=arguments[1],c=arguments[2];br.computeDistance(u.getExteriorRing(),l,c);for(var h=0;h<u.getNumInteriorRing();h++)br.computeDistance(u.getInteriorRingN(h),l,c)}else if(arguments[2]instanceof de&&arguments[0]instanceof Y&&arguments[1]instanceof P){var f=arguments[0],p=arguments[1],d=arguments[2];if(f instanceof Dt)br.computeDistance(f,p,d);else if(f instanceof Kt)br.computeDistance(f,p,d);else if(f instanceof Se)for(var _=f,w=0;w<_.getNumGeometries();w++){var y=_.getGeometryN(w);br.computeDistance(y,p,d)}else d.setMinimum(f.getCoordinate(),p)}else if(arguments[2]instanceof de&&arguments[0]instanceof X&&arguments[1]instanceof P){var x=arguments[0],g=arguments[1],m=arguments[2],E=x.closestPoint(g);m.setMinimum(E,g)}};var er=function(){this._g0=null,this._g1=null,this._ptDist=new de,this._densifyFrac=0;var t=arguments[0],e=arguments[1];this._g0=t,this._g1=e},Cl={MaxPointDistanceFilter:{configurable:!0},MaxDensifiedByFractionDistanceFilter:{configurable:!0}};er.prototype.getCoordinates=function(){return this._ptDist.getCoordinates()};er.prototype.setDensifyFraction=function(t){if(t>1||t<=0)throw new Rt("Fraction is not in range (0.0 - 1.0]");this._densifyFrac=t};er.prototype.compute=function(t,e){this.computeOrientedDistance(t,e,this._ptDist),this.computeOrientedDistance(e,t,this._ptDist)};er.prototype.distance=function(){return this.compute(this._g0,this._g1),this._ptDist.getDistance()};er.prototype.computeOrientedDistance=function(t,e,r){var i=new Pi(e);if(t.apply(i),r.setMaximum(i.getMaxPointDistance()),this._densifyFrac>0){var s=new Xn(e,this._densifyFrac);t.apply(s),r.setMaximum(s.getMaxPointDistance())}};er.prototype.orientedDistance=function(){return this.computeOrientedDistance(this._g0,this._g1,this._ptDist),this._ptDist.getDistance()};er.prototype.interfaces_=function(){return[]};er.prototype.getClass=function(){return er};er.distance=function(){if(arguments.length===2){var t=arguments[0],e=arguments[1],r=new er(t,e);return r.distance()}else if(arguments.length===3){var i=arguments[0],s=arguments[1],o=arguments[2],a=new er(i,s);return a.setDensifyFraction(o),a.distance()}};Cl.MaxPointDistanceFilter.get=function(){return Pi};Cl.MaxDensifiedByFractionDistanceFilter.get=function(){return Xn};Object.defineProperties(er,Cl);var Pi=function(){this._maxPtDist=new de,this._minPtDist=new de,this._euclideanDist=new br,this._geom=null;var t=arguments[0];this._geom=t};Pi.prototype.filter=function(t){this._minPtDist.initialize(),br.computeDistance(this._geom,t,this._minPtDist),this._maxPtDist.setMaximum(this._minPtDist)};Pi.prototype.getMaxPointDistance=function(){return this._maxPtDist};Pi.prototype.interfaces_=function(){return[Jr]};Pi.prototype.getClass=function(){return Pi};var Xn=function(){this._maxPtDist=new de,this._minPtDist=new de,this._geom=null,this._numSubSegs=0;var t=arguments[0],e=arguments[1];this._geom=t,this._numSubSegs=Math.trunc(Math.round(1/e))};Xn.prototype.filter=function(t,e){var r=this;if(e===0)return null;for(var i=t.getCoordinate(e-1),s=t.getCoordinate(e),o=(s.x-i.x)/this._numSubSegs,a=(s.y-i.y)/this._numSubSegs,u=0;u<this._numSubSegs;u++){var l=i.x+u*o,c=i.y+u*a,h=new P(l,c);r._minPtDist.initialize(),br.computeDistance(r._geom,h,r._minPtDist),r._maxPtDist.setMaximum(r._minPtDist)}};Xn.prototype.isDone=function(){return!1};Xn.prototype.isGeometryChanged=function(){return!1};Xn.prototype.getMaxPointDistance=function(){return this._maxPtDist};Xn.prototype.interfaces_=function(){return[fr]};Xn.prototype.getClass=function(){return Xn};var Fe=function(t,e,r){this._minValidDistance=null,this._maxValidDistance=null,this._minDistanceFound=null,this._maxDistanceFound=null,this._isValid=!0,this._errMsg=null,this._errorLocation=null,this._errorIndicator=null,this._input=t||null,this._bufDistance=e||null,this._result=r||null},Sl={VERBOSE:{configurable:!0},MAX_DISTANCE_DIFF_FRAC:{configurable:!0}};Fe.prototype.checkMaximumDistance=function(t,e,r){var i=new er(e,t);if(i.setDensifyFraction(.25),this._maxDistanceFound=i.orientedDistance(),this._maxDistanceFound>r){this._isValid=!1;var s=i.getCoordinates();this._errorLocation=s[1],this._errorIndicator=t.getFactory().createLineString(s),this._errMsg="Distance between buffer curve and input is too large ("+this._maxDistanceFound+" at "+hr.toLineString(s[0],s[1])+")"}};Fe.prototype.isValid=function(){var t=Math.abs(this._bufDistance),e=Fe.MAX_DISTANCE_DIFF_FRAC*t;return this._minValidDistance=t-e,this._maxValidDistance=t+e,this._input.isEmpty()||this._result.isEmpty()?!0:(this._bufDistance>0?this.checkPositiveValid():this.checkNegativeValid(),Fe.VERBOSE&&le.out.println("Min Dist= "+this._minDistanceFound+"  err= "+(1-this._minDistanceFound/this._bufDistance)+"  Max Dist= "+this._maxDistanceFound+"  err= "+(this._maxDistanceFound/this._bufDistance-1)),this._isValid)};Fe.prototype.checkNegativeValid=function(){if(!(this._input instanceof Kt||this._input instanceof Zr||this._input instanceof Se))return null;var t=this.getPolygonLines(this._input);if(this.checkMinimumDistance(t,this._result,this._minValidDistance),!this._isValid)return null;this.checkMaximumDistance(t,this._result,this._maxValidDistance)};Fe.prototype.getErrorIndicator=function(){return this._errorIndicator};Fe.prototype.checkMinimumDistance=function(t,e,r){var i=new ce(t,e,r);if(this._minDistanceFound=i.distance(),this._minDistanceFound<r){this._isValid=!1;var s=i.nearestPoints();this._errorLocation=i.nearestPoints()[1],this._errorIndicator=t.getFactory().createLineString(s),this._errMsg="Distance between buffer curve and input is too small ("+this._minDistanceFound+" at "+hr.toLineString(s[0],s[1])+" )"}};Fe.prototype.checkPositiveValid=function(){var t=this._result.getBoundary();if(this.checkMinimumDistance(this._input,t,this._minValidDistance),!this._isValid)return null;this.checkMaximumDistance(this._input,t,this._maxValidDistance)};Fe.prototype.getErrorLocation=function(){return this._errorLocation};Fe.prototype.getPolygonLines=function(t){for(var e=new k,r=new oe(e),i=gn.getPolygons(t),s=i.iterator();s.hasNext();){var o=s.next();o.apply(r)}return t.getFactory().buildGeometry(e)};Fe.prototype.getErrorMessage=function(){return this._errMsg};Fe.prototype.interfaces_=function(){return[]};Fe.prototype.getClass=function(){return Fe};Sl.VERBOSE.get=function(){return!1};Sl.MAX_DISTANCE_DIFF_FRAC.get=function(){return .012};Object.defineProperties(Fe,Sl);var he=function(t,e,r){this._isValid=!0,this._errorMsg=null,this._errorLocation=null,this._errorIndicator=null,this._input=t||null,this._distance=e||null,this._result=r||null},bl={VERBOSE:{configurable:!0},MAX_ENV_DIFF_FRAC:{configurable:!0}};he.prototype.isValid=function(){return this.checkPolygonal(),this._isValid?(this.checkExpectedEmpty(),this._isValid?(this.checkEnvelope(),this._isValid?(this.checkArea(),this._isValid?(this.checkDistance(),this._isValid):this._isValid):this._isValid):this._isValid):this._isValid};he.prototype.checkEnvelope=function(){if(this._distance<0)return null;var t=this._distance*he.MAX_ENV_DIFF_FRAC;t===0&&(t=.001);var e=new W(this._input.getEnvelopeInternal());e.expandBy(this._distance);var r=new W(this._result.getEnvelopeInternal());r.expandBy(t),r.contains(e)||(this._isValid=!1,this._errorMsg="Buffer envelope is incorrect",this._errorIndicator=this._input.getFactory().toGeometry(r)),this.report("Envelope")};he.prototype.checkDistance=function(){var t=new Fe(this._input,this._distance,this._result);t.isValid()||(this._isValid=!1,this._errorMsg=t.getErrorMessage(),this._errorLocation=t.getErrorLocation(),this._errorIndicator=t.getErrorIndicator()),this.report("Distance")};he.prototype.checkArea=function(){var t=this._input.getArea(),e=this._result.getArea();this._distance>0&&t>e&&(this._isValid=!1,this._errorMsg="Area of positive buffer is smaller than input",this._errorIndicator=this._result),this._distance<0&&t<e&&(this._isValid=!1,this._errorMsg="Area of negative buffer is larger than input",this._errorIndicator=this._result),this.report("Area")};he.prototype.checkPolygonal=function(){this._result instanceof Kt||this._result instanceof Zr||(this._isValid=!1),this._errorMsg="Result is not polygonal",this._errorIndicator=this._result,this.report("Polygonal")};he.prototype.getErrorIndicator=function(){return this._errorIndicator};he.prototype.getErrorLocation=function(){return this._errorLocation};he.prototype.checkExpectedEmpty=function(){if(this._input.getDimension()>=2||this._distance>0)return null;this._result.isEmpty()||(this._isValid=!1,this._errorMsg="Result is non-empty",this._errorIndicator=this._result),this.report("ExpectedEmpty")};he.prototype.report=function(t){if(!he.VERBOSE)return null;le.out.println("Check "+t+": "+(this._isValid?"passed":"FAILED"))};he.prototype.getErrorMessage=function(){return this._errorMsg};he.prototype.interfaces_=function(){return[]};he.prototype.getClass=function(){return he};he.isValidMsg=function(t,e,r){var i=new he(t,e,r);return i.isValid()?null:i.getErrorMessage()};he.isValid=function(t,e,r){var i=new he(t,e,r);return!!i.isValid()};bl.VERBOSE.get=function(){return!1};bl.MAX_ENV_DIFF_FRAC.get=function(){return .012};Object.defineProperties(he,bl);var Gr=function(){this._pts=null,this._data=null;var t=arguments[0],e=arguments[1];this._pts=t,this._data=e};Gr.prototype.getCoordinates=function(){return this._pts};Gr.prototype.size=function(){return this._pts.length};Gr.prototype.getCoordinate=function(t){return this._pts[t]};Gr.prototype.isClosed=function(){return this._pts[0].equals(this._pts[this._pts.length-1])};Gr.prototype.getSegmentOctant=function(t){return t===this._pts.length-1?-1:Si.octant(this.getCoordinate(t),this.getCoordinate(t+1))};Gr.prototype.setData=function(t){this._data=t};Gr.prototype.getData=function(){return this._data};Gr.prototype.toString=function(){return hr.toLineString(new Gt(this._pts))};Gr.prototype.interfaces_=function(){return[tn]};Gr.prototype.getClass=function(){return Gr};var re=function(){this._findAllIntersections=!1,this._isCheckEndSegmentsOnly=!1,this._li=null,this._interiorIntersection=null,this._intSegments=null,this._intersections=new k,this._intersectionCount=0,this._keepIntersections=!0;var t=arguments[0];this._li=t,this._interiorIntersection=null};re.prototype.getInteriorIntersection=function(){return this._interiorIntersection};re.prototype.setCheckEndSegmentsOnly=function(t){this._isCheckEndSegmentsOnly=t};re.prototype.getIntersectionSegments=function(){return this._intSegments};re.prototype.count=function(){return this._intersectionCount};re.prototype.getIntersections=function(){return this._intersections};re.prototype.setFindAllIntersections=function(t){this._findAllIntersections=t};re.prototype.setKeepIntersections=function(t){this._keepIntersections=t};re.prototype.processIntersections=function(t,e,r,i){if(!this._findAllIntersections&&this.hasIntersection()||t===r&&e===i)return null;if(this._isCheckEndSegmentsOnly){var s=this.isEndSegment(t,e)||this.isEndSegment(r,i);if(!s)return null}var o=t.getCoordinates()[e],a=t.getCoordinates()[e+1],u=r.getCoordinates()[i],l=r.getCoordinates()[i+1];this._li.computeIntersection(o,a,u,l),this._li.hasIntersection()&&this._li.isInteriorIntersection()&&(this._intSegments=new Array(4).fill(null),this._intSegments[0]=o,this._intSegments[1]=a,this._intSegments[2]=u,this._intSegments[3]=l,this._interiorIntersection=this._li.getIntersection(0),this._keepIntersections&&this._intersections.add(this._interiorIntersection),this._intersectionCount++)};re.prototype.isEndSegment=function(t,e){return e===0||e>=t.size()-2};re.prototype.hasIntersection=function(){return this._interiorIntersection!==null};re.prototype.isDone=function(){return this._findAllIntersections?!1:this._interiorIntersection!==null};re.prototype.interfaces_=function(){return[oi]};re.prototype.getClass=function(){return re};re.createAllIntersectionsFinder=function(t){var e=new re(t);return e.setFindAllIntersections(!0),e};re.createAnyIntersectionFinder=function(t){return new re(t)};re.createIntersectionCounter=function(t){var e=new re(t);return e.setFindAllIntersections(!0),e.setKeepIntersections(!1),e};var vr=function(){this._li=new yi,this._segStrings=null,this._findAllIntersections=!1,this._segInt=null,this._isValid=!0;var t=arguments[0];this._segStrings=t};vr.prototype.execute=function(){if(this._segInt!==null)return null;this.checkInteriorIntersections()};vr.prototype.getIntersections=function(){return this._segInt.getIntersections()};vr.prototype.isValid=function(){return this.execute(),this._isValid};vr.prototype.setFindAllIntersections=function(t){this._findAllIntersections=t};vr.prototype.checkInteriorIntersections=function(){this._isValid=!0,this._segInt=new re(this._li),this._segInt.setFindAllIntersections(this._findAllIntersections);var t=new xl;if(t.setSegmentIntersector(this._segInt),t.computeNodes(this._segStrings),this._segInt.hasIntersection())return this._isValid=!1,null};vr.prototype.checkValid=function(){if(this.execute(),!this._isValid)throw new yn(this.getErrorMessage(),this._segInt.getInteriorIntersection())};vr.prototype.getErrorMessage=function(){if(this._isValid)return"no intersections found";var t=this._segInt.getIntersectionSegments();return"found non-noded intersection between "+hr.toLineString(t[0],t[1])+" and "+hr.toLineString(t[2],t[3])};vr.prototype.interfaces_=function(){return[]};vr.prototype.getClass=function(){return vr};vr.computeIntersections=function(t){var e=new vr(t);return e.setFindAllIntersections(!0),e.isValid(),e.getIntersections()};var li=function n(){this._nv=null;var t=arguments[0];this._nv=new vr(n.toSegmentStrings(t))};li.prototype.checkValid=function(){this._nv.checkValid()};li.prototype.interfaces_=function(){return[]};li.prototype.getClass=function(){return li};li.toSegmentStrings=function(t){for(var e=new k,r=t.iterator();r.hasNext();){var i=r.next();e.add(new Gr(i.getCoordinates(),i))}return e};li.checkValid=function(t){var e=new li(t);e.checkValid()};var Ri=function(t){this._mapOp=t};Ri.prototype.map=function(t){for(var e=this,r=new k,i=0;i<t.getNumGeometries();i++){var s=e._mapOp.map(t.getGeometryN(i));s.isEmpty()||r.add(s)}return t.getFactory().createGeometryCollection(nt.toGeometryArray(r))};Ri.prototype.interfaces_=function(){return[]};Ri.prototype.getClass=function(){return Ri};Ri.map=function(t,e){var r=new Ri(e);return r.map(t)};var Br=function(){this._op=null,this._geometryFactory=null,this._ptLocator=null,this._lineEdgesList=new k,this._resultLineList=new k;var t=arguments[0],e=arguments[1],r=arguments[2];this._op=t,this._geometryFactory=e,this._ptLocator=r};Br.prototype.collectLines=function(t){for(var e=this,r=this._op.getGraph().getEdgeEnds().iterator();r.hasNext();){var i=r.next();e.collectLineEdge(i,t,e._lineEdgesList),e.collectBoundaryTouchEdge(i,t,e._lineEdgesList)}};Br.prototype.labelIsolatedLine=function(t,e){var r=this._ptLocator.locate(t.getCoordinate(),this._op.getArgGeometry(e));t.getLabel().setLocation(e,r)};Br.prototype.build=function(t){return this.findCoveredLineEdges(),this.collectLines(t),this.buildLines(t),this._resultLineList};Br.prototype.collectLineEdge=function(t,e,r){var i=t.getLabel(),s=t.getEdge();t.isLineEdge()&&!t.isVisited()&&Q.isResultOfOp(i,e)&&!s.isCovered()&&(r.add(s),t.setVisitedEdge(!0))};Br.prototype.findCoveredLineEdges=function(){for(var t=this,e=this._op.getGraph().getNodes().iterator();e.hasNext();){var r=e.next();r.getEdges().findCoveredLineEdges()}for(var i=this._op.getGraph().getEdgeEnds().iterator();i.hasNext();){var s=i.next(),o=s.getEdge();if(s.isLineEdge()&&!o.isCoveredSet()){var a=t._op.isCoveredByA(s.getCoordinate());o.setCovered(a)}}};Br.prototype.labelIsolatedLines=function(t){for(var e=this,r=t.iterator();r.hasNext();){var i=r.next(),s=i.getLabel();i.isIsolated()&&(s.isNull(0)?e.labelIsolatedLine(i,0):e.labelIsolatedLine(i,1))}};Br.prototype.buildLines=function(t){for(var e=this,r=this._lineEdgesList.iterator();r.hasNext();){var i=r.next(),s=e._geometryFactory.createLineString(i.getCoordinates());e._resultLineList.add(s),i.setInResult(!0)}};Br.prototype.collectBoundaryTouchEdge=function(t,e,r){var i=t.getLabel();if(t.isLineEdge()||t.isVisited()||t.isInteriorAreaEdge()||t.getEdge().isInResult())return null;et.isTrue(!(t.isInResult()||t.getSym().isInResult())||!t.getEdge().isInResult()),Q.isResultOfOp(i,e)&&e===Q.INTERSECTION&&(r.add(t.getEdge()),t.setVisitedEdge(!0))};Br.prototype.interfaces_=function(){return[]};Br.prototype.getClass=function(){return Br};var Li=function(){this._op=null,this._geometryFactory=null,this._resultPointList=new k;var t=arguments[0],e=arguments[1];this._op=t,this._geometryFactory=e};Li.prototype.filterCoveredNodeToPoint=function(t){var e=t.getCoordinate();if(!this._op.isCoveredByLA(e)){var r=this._geometryFactory.createPoint(e);this._resultPointList.add(r)}};Li.prototype.extractNonCoveredResultNodes=function(t){for(var e=this,r=this._op.getGraph().getNodes().iterator();r.hasNext();){var i=r.next();if(!i.isInResult()&&!i.isIncidentEdgeInResult()&&(i.getEdges().getDegree()===0||t===Q.INTERSECTION)){var s=i.getLabel();Q.isResultOfOp(s,t)&&e.filterCoveredNodeToPoint(i)}}};Li.prototype.build=function(t){return this.extractNonCoveredResultNodes(t),this._resultPointList};Li.prototype.interfaces_=function(){return[]};Li.prototype.getClass=function(){return Li};var Ae=function(){this._inputGeom=null,this._factory=null,this._pruneEmptyGeometry=!0,this._preserveGeometryCollectionType=!0,this._preserveCollections=!1,this._preserveType=!1};Ae.prototype.transformPoint=function(t,e){return this._factory.createPoint(this.transformCoordinates(t.getCoordinateSequence(),t))};Ae.prototype.transformPolygon=function(t,e){var r=this,i=!0,s=this.transformLinearRing(t.getExteriorRing(),t);(s===null||!(s instanceof Qr)||s.isEmpty())&&(i=!1);for(var o=new k,a=0;a<t.getNumInteriorRing();a++){var u=r.transformLinearRing(t.getInteriorRingN(a),t);u===null||u.isEmpty()||(u instanceof Qr||(i=!1),o.add(u))}if(i)return this._factory.createPolygon(s,o.toArray([]));var l=new k;return s!==null&&l.add(s),l.addAll(o),this._factory.buildGeometry(l)};Ae.prototype.createCoordinateSequence=function(t){return this._factory.getCoordinateSequenceFactory().create(t)};Ae.prototype.getInputGeometry=function(){return this._inputGeom};Ae.prototype.transformMultiLineString=function(t,e){for(var r=this,i=new k,s=0;s<t.getNumGeometries();s++){var o=r.transformLineString(t.getGeometryN(s),t);o!==null&&(o.isEmpty()||i.add(o))}return this._factory.buildGeometry(i)};Ae.prototype.transformCoordinates=function(t,e){return this.copy(t)};Ae.prototype.transformLineString=function(t,e){return this._factory.createLineString(this.transformCoordinates(t.getCoordinateSequence(),t))};Ae.prototype.transformMultiPoint=function(t,e){for(var r=this,i=new k,s=0;s<t.getNumGeometries();s++){var o=r.transformPoint(t.getGeometryN(s),t);o!==null&&(o.isEmpty()||i.add(o))}return this._factory.buildGeometry(i)};Ae.prototype.transformMultiPolygon=function(t,e){for(var r=this,i=new k,s=0;s<t.getNumGeometries();s++){var o=r.transformPolygon(t.getGeometryN(s),t);o!==null&&(o.isEmpty()||i.add(o))}return this._factory.buildGeometry(i)};Ae.prototype.copy=function(t){return t.copy()};Ae.prototype.transformGeometryCollection=function(t,e){for(var r=this,i=new k,s=0;s<t.getNumGeometries();s++){var o=r.transform(t.getGeometryN(s));o!==null&&(r._pruneEmptyGeometry&&o.isEmpty()||i.add(o))}return this._preserveGeometryCollectionType?this._factory.createGeometryCollection(nt.toGeometryArray(i)):this._factory.buildGeometry(i)};Ae.prototype.transform=function(t){if(this._inputGeom=t,this._factory=t.getFactory(),t instanceof ke)return this.transformPoint(t,null);if(t instanceof us)return this.transformMultiPoint(t,null);if(t instanceof Qr)return this.transformLinearRing(t,null);if(t instanceof Dt)return this.transformLineString(t,null);if(t instanceof ni)return this.transformMultiLineString(t,null);if(t instanceof Kt)return this.transformPolygon(t,null);if(t instanceof Zr)return this.transformMultiPolygon(t,null);if(t instanceof Se)return this.transformGeometryCollection(t,null);throw new Rt("Unknown Geometry subtype: "+t.getClass().getName())};Ae.prototype.transformLinearRing=function(t,e){var r=this.transformCoordinates(t.getCoordinateSequence(),t);if(r===null)return this._factory.createLinearRing(null);var i=r.size();return i>0&&i<4&&!this._preserveType?this._factory.createLineString(r):this._factory.createLinearRing(r)};Ae.prototype.interfaces_=function(){return[]};Ae.prototype.getClass=function(){return Ae};var nn=function n(){if(this._snapTolerance=0,this._srcPts=null,this._seg=new X,this._allowSnappingToSourceVertices=!1,this._isClosed=!1,arguments[0]instanceof Dt&&typeof arguments[1]=="number"){var t=arguments[0],e=arguments[1];n.call(this,t.getCoordinates(),e)}else if(arguments[0]instanceof Array&&typeof arguments[1]=="number"){var r=arguments[0],i=arguments[1];this._srcPts=r,this._isClosed=n.isClosed(r),this._snapTolerance=i}};nn.prototype.snapVertices=function(t,e){for(var r=this,i=this._isClosed?t.size()-1:t.size(),s=0;s<i;s++){var o=t.get(s),a=r.findSnapForVertex(o,e);a!==null&&(t.set(s,new P(a)),s===0&&r._isClosed&&t.set(t.size()-1,new P(a)))}};nn.prototype.findSnapForVertex=function(t,e){for(var r=this,i=0;i<e.length;i++){if(t.equals2D(e[i]))return null;if(t.distance(e[i])<r._snapTolerance)return e[i]}return null};nn.prototype.snapTo=function(t){var e=new Ro(this._srcPts);this.snapVertices(e,t),this.snapSegments(e,t);var r=e.toCoordinateArray();return r};nn.prototype.snapSegments=function(t,e){var r=this;if(e.length===0)return null;var i=e.length;e[0].equals2D(e[e.length-1])&&(i=e.length-1);for(var s=0;s<i;s++){var o=e[s],a=r.findSegmentIndexToSnap(o,t);a>=0&&t.add(a+1,new P(o),!1)}};nn.prototype.findSegmentIndexToSnap=function(t,e){for(var r=this,i=J.MAX_VALUE,s=-1,o=0;o<e.size()-1;o++){if(r._seg.p0=e.get(o),r._seg.p1=e.get(o+1),r._seg.p0.equals2D(t)||r._seg.p1.equals2D(t)){if(r._allowSnappingToSourceVertices)continue;return-1}var a=r._seg.distance(t);a<r._snapTolerance&&a<i&&(i=a,s=o)}return s};nn.prototype.setAllowSnappingToSourceVertices=function(t){this._allowSnappingToSourceVertices=t};nn.prototype.interfaces_=function(){return[]};nn.prototype.getClass=function(){return nn};nn.isClosed=function(t){return t.length<=1?!1:t[0].equals2D(t[t.length-1])};var Bt=function(t){this._srcGeom=t||null},Oh={SNAP_PRECISION_FACTOR:{configurable:!0}};Bt.prototype.snapTo=function(t,e){var r=this.extractTargetCoordinates(t),i=new Dh(e,r);return i.transform(this._srcGeom)};Bt.prototype.snapToSelf=function(t,e){var r=this.extractTargetCoordinates(this._srcGeom),i=new Dh(t,r,!0),s=i.transform(this._srcGeom),o=s;return e&&H(o,zn)&&(o=s.buffer(0)),o};Bt.prototype.computeSnapTolerance=function(t){var e=this.computeMinimumSegmentLength(t),r=e/10;return r};Bt.prototype.extractTargetCoordinates=function(t){for(var e=new Rr,r=t.getCoordinates(),i=0;i<r.length;i++)e.add(r[i]);return e.toArray(new Array(0).fill(null))};Bt.prototype.computeMinimumSegmentLength=function(t){for(var e=J.MAX_VALUE,r=0;r<t.length-1;r++){var i=t[r].distance(t[r+1]);i<e&&(e=i)}return e};Bt.prototype.interfaces_=function(){return[]};Bt.prototype.getClass=function(){return Bt};Bt.snap=function(t,e,r){var i=new Array(2).fill(null),s=new Bt(t);i[0]=s.snapTo(e,r);var o=new Bt(e);return i[1]=o.snapTo(i[0],r),i};Bt.computeOverlaySnapTolerance=function(){if(arguments.length===1){var t=arguments[0],e=Bt.computeSizeBasedSnapTolerance(t),r=t.getPrecisionModel();if(r.getType()===pt.FIXED){var i=1/r.getScale()*2/1.415;i>e&&(e=i)}return e}else if(arguments.length===2){var s=arguments[0],o=arguments[1];return Math.min(Bt.computeOverlaySnapTolerance(s),Bt.computeOverlaySnapTolerance(o))}};Bt.computeSizeBasedSnapTolerance=function(t){var e=t.getEnvelopeInternal(),r=Math.min(e.getHeight(),e.getWidth()),i=r*Bt.SNAP_PRECISION_FACTOR;return i};Bt.snapToSelf=function(t,e,r){var i=new Bt(t);return i.snapToSelf(e,r)};Oh.SNAP_PRECISION_FACTOR.get=function(){return 1e-9};Object.defineProperties(Bt,Oh);var Dh=function(n){function t(e,r,i){n.call(this),this._snapTolerance=e||null,this._snapPts=r||null,this._isSelfSnap=i!==void 0?i:!1}return n&&(t.__proto__=n),t.prototype=Object.create(n&&n.prototype),t.prototype.constructor=t,t.prototype.snapLine=function(r,i){var s=new nn(r,this._snapTolerance);return s.setAllowSnappingToSourceVertices(this._isSelfSnap),s.snapTo(i)},t.prototype.transformCoordinates=function(r,i){var s=r.toCoordinateArray(),o=this.snapLine(s,this._snapPts);return this._factory.getCoordinateSequenceFactory().create(o)},t.prototype.interfaces_=function(){return[]},t.prototype.getClass=function(){return t},t}(Ae),we=function(){this._isFirst=!0,this._commonMantissaBitsCount=53,this._commonBits=0,this._commonSignExp=null};we.prototype.getCommon=function(){return J.longBitsToDouble(this._commonBits)};we.prototype.add=function(t){var e=J.doubleToLongBits(t);if(this._isFirst)return this._commonBits=e,this._commonSignExp=we.signExpBits(this._commonBits),this._isFirst=!1,null;var r=we.signExpBits(e);if(r!==this._commonSignExp)return this._commonBits=0,null;this._commonMantissaBitsCount=we.numCommonMostSigMantissaBits(this._commonBits,e),this._commonBits=we.zeroLowerBits(this._commonBits,64-(12+this._commonMantissaBitsCount))};we.prototype.toString=function(){if(arguments.length===1){var t=arguments[0],e=J.longBitsToDouble(t),r=J.toBinaryString(t),i="0000000000000000000000000000000000000000000000000000000000000000"+r,s=i.substring(i.length-64),o=s.substring(0,1)+"  "+s.substring(1,12)+"(exp) "+s.substring(12)+" [ "+e+" ]";return o}};we.prototype.interfaces_=function(){return[]};we.prototype.getClass=function(){return we};we.getBit=function(t,e){var r=1<<e;return t&r?1:0};we.signExpBits=function(t){return t>>52};we.zeroLowerBits=function(t,e){var r=(1<<e)-1,i=~r,s=t&i;return s};we.numCommonMostSigMantissaBits=function(t,e){for(var r=0,i=52;i>=0;i--){if(we.getBit(t,i)!==we.getBit(e,i))return r;r++}return 52};var Yn=function(){this._commonCoord=null,this._ccFilter=new Ai},Ml={CommonCoordinateFilter:{configurable:!0},Translater:{configurable:!0}};Yn.prototype.addCommonBits=function(t){var e=new Zn(this._commonCoord);t.apply(e),t.geometryChanged()};Yn.prototype.removeCommonBits=function(t){if(this._commonCoord.x===0&&this._commonCoord.y===0)return t;var e=new P(this._commonCoord);e.x=-e.x,e.y=-e.y;var r=new Zn(e);return t.apply(r),t.geometryChanged(),t};Yn.prototype.getCommonCoordinate=function(){return this._commonCoord};Yn.prototype.add=function(t){t.apply(this._ccFilter),this._commonCoord=this._ccFilter.getCommonCoordinate()};Yn.prototype.interfaces_=function(){return[]};Yn.prototype.getClass=function(){return Yn};Ml.CommonCoordinateFilter.get=function(){return Ai};Ml.Translater.get=function(){return Zn};Object.defineProperties(Yn,Ml);var Ai=function(){this._commonBitsX=new we,this._commonBitsY=new we};Ai.prototype.filter=function(t){this._commonBitsX.add(t.x),this._commonBitsY.add(t.y)};Ai.prototype.getCommonCoordinate=function(){return new P(this._commonBitsX.getCommon(),this._commonBitsY.getCommon())};Ai.prototype.interfaces_=function(){return[Jr]};Ai.prototype.getClass=function(){return Ai};var Zn=function(){this.trans=null;var t=arguments[0];this.trans=t};Zn.prototype.filter=function(t,e){var r=t.getOrdinate(e,0)+this.trans.x,i=t.getOrdinate(e,1)+this.trans.y;t.setOrdinate(e,0,r),t.setOrdinate(e,1,i)};Zn.prototype.isDone=function(){return!1};Zn.prototype.isGeometryChanged=function(){return!0};Zn.prototype.interfaces_=function(){return[fr]};Zn.prototype.getClass=function(){return Zn};var ne=function(t,e){this._geom=new Array(2).fill(null),this._snapTolerance=null,this._cbr=null,this._geom[0]=t,this._geom[1]=e,this.computeSnapTolerance()};ne.prototype.selfSnap=function(t){var e=new Bt(t),r=e.snapTo(t,this._snapTolerance);return r};ne.prototype.removeCommonBits=function(t){this._cbr=new Yn,this._cbr.add(t[0]),this._cbr.add(t[1]);var e=new Array(2).fill(null);return e[0]=this._cbr.removeCommonBits(t[0].copy()),e[1]=this._cbr.removeCommonBits(t[1].copy()),e};ne.prototype.prepareResult=function(t){return this._cbr.addCommonBits(t),t};ne.prototype.getResultGeometry=function(t){var e=this.snap(this._geom),r=Q.overlayOp(e[0],e[1],t);return this.prepareResult(r)};ne.prototype.checkValid=function(t){t.isValid()||le.out.println("Snapped geometry is invalid")};ne.prototype.computeSnapTolerance=function(){this._snapTolerance=Bt.computeOverlaySnapTolerance(this._geom[0],this._geom[1])};ne.prototype.snap=function(t){var e=this.removeCommonBits(t),r=Bt.snap(e[0],e[1],this._snapTolerance);return r};ne.prototype.interfaces_=function(){return[]};ne.prototype.getClass=function(){return ne};ne.overlayOp=function(t,e,r){var i=new ne(t,e);return i.getResultGeometry(r)};ne.union=function(t,e){return ne.overlayOp(t,e,Q.UNION)};ne.intersection=function(t,e){return ne.overlayOp(t,e,Q.INTERSECTION)};ne.symDifference=function(t,e){return ne.overlayOp(t,e,Q.SYMDIFFERENCE)};ne.difference=function(t,e){return ne.overlayOp(t,e,Q.DIFFERENCE)};var Ne=function(t,e){this._geom=new Array(2).fill(null),this._geom[0]=t,this._geom[1]=e};Ne.prototype.getResultGeometry=function(t){var e=null,r=!1,i=null;try{e=Q.overlayOp(this._geom[0],this._geom[1],t);var s=!0;s&&(r=!0)}catch(o){if(o instanceof mn)i=o;else throw o}finally{}if(!r)try{e=ne.overlayOp(this._geom[0],this._geom[1],t)}catch(o){throw o instanceof mn?i:o}finally{}return e};Ne.prototype.interfaces_=function(){return[]};Ne.prototype.getClass=function(){return Ne};Ne.overlayOp=function(t,e,r){var i=new Ne(t,e);return i.getResultGeometry(r)};Ne.union=function(t,e){return Ne.overlayOp(t,e,Q.UNION)};Ne.intersection=function(t,e){return Ne.overlayOp(t,e,Q.INTERSECTION)};Ne.symDifference=function(t,e){return Ne.overlayOp(t,e,Q.SYMDIFFERENCE)};Ne.difference=function(t,e){return Ne.overlayOp(t,e,Q.DIFFERENCE)};var uo=function(){this.mce=null,this.chainIndex=null;var t=arguments[0],e=arguments[1];this.mce=t,this.chainIndex=e};uo.prototype.computeIntersections=function(t,e){this.mce.computeIntersectsForChain(this.chainIndex,t.mce,t.chainIndex,e)};uo.prototype.interfaces_=function(){return[]};uo.prototype.getClass=function(){return uo};var ze=function n(){if(this._label=null,this._xValue=null,this._eventType=null,this._insertEvent=null,this._deleteEventIndex=null,this._obj=null,arguments.length===2){var t=arguments[0],e=arguments[1];this._eventType=n.DELETE,this._xValue=t,this._insertEvent=e}else if(arguments.length===3){var r=arguments[0],i=arguments[1],s=arguments[2];this._eventType=n.INSERT,this._label=r,this._xValue=i,this._obj=s}},Nl={INSERT:{configurable:!0},DELETE:{configurable:!0}};ze.prototype.isDelete=function(){return this._eventType===ze.DELETE};ze.prototype.setDeleteEventIndex=function(t){this._deleteEventIndex=t};ze.prototype.getObject=function(){return this._obj};ze.prototype.compareTo=function(t){var e=t;return this._xValue<e._xValue?-1:this._xValue>e._xValue?1:this._eventType<e._eventType?-1:this._eventType>e._eventType?1:0};ze.prototype.getInsertEvent=function(){return this._insertEvent};ze.prototype.isInsert=function(){return this._eventType===ze.INSERT};ze.prototype.isSameLabel=function(t){return this._label===null?!1:this._label===t._label};ze.prototype.getDeleteEventIndex=function(){return this._deleteEventIndex};ze.prototype.interfaces_=function(){return[sr]};ze.prototype.getClass=function(){return ze};Nl.INSERT.get=function(){return 1};Nl.DELETE.get=function(){return 2};Object.defineProperties(ze,Nl);var xa=function(){};xa.prototype.interfaces_=function(){return[]};xa.prototype.getClass=function(){return xa};var fe=function(){this._hasIntersection=!1,this._hasProper=!1,this._hasProperInterior=!1,this._properIntersectionPoint=null,this._li=null,this._includeProper=null,this._recordIsolated=null,this._isSelfIntersection=null,this._numIntersections=0,this.numTests=0,this._bdyNodes=null,this._isDone=!1,this._isDoneWhenProperInt=!1;var t=arguments[0],e=arguments[1],r=arguments[2];this._li=t,this._includeProper=e,this._recordIsolated=r};fe.prototype.isTrivialIntersection=function(t,e,r,i){if(t===r&&this._li.getIntersectionNum()===1){if(fe.isAdjacentSegments(e,i))return!0;if(t.isClosed()){var s=t.getNumPoints()-1;if(e===0&&i===s||i===0&&e===s)return!0}}return!1};fe.prototype.getProperIntersectionPoint=function(){return this._properIntersectionPoint};fe.prototype.setIsDoneIfProperInt=function(t){this._isDoneWhenProperInt=t};fe.prototype.hasProperInteriorIntersection=function(){return this._hasProperInterior};fe.prototype.isBoundaryPointInternal=function(t,e){for(var r=e.iterator();r.hasNext();){var i=r.next(),s=i.getCoordinate();if(t.isIntersection(s))return!0}return!1};fe.prototype.hasProperIntersection=function(){return this._hasProper};fe.prototype.hasIntersection=function(){return this._hasIntersection};fe.prototype.isDone=function(){return this._isDone};fe.prototype.isBoundaryPoint=function(t,e){return e===null?!1:!!(this.isBoundaryPointInternal(t,e[0])||this.isBoundaryPointInternal(t,e[1]))};fe.prototype.setBoundaryNodes=function(t,e){this._bdyNodes=new Array(2).fill(null),this._bdyNodes[0]=t,this._bdyNodes[1]=e};fe.prototype.addIntersections=function(t,e,r,i){if(t===r&&e===i)return null;this.numTests++;var s=t.getCoordinates()[e],o=t.getCoordinates()[e+1],a=r.getCoordinates()[i],u=r.getCoordinates()[i+1];this._li.computeIntersection(s,o,a,u),this._li.hasIntersection()&&(this._recordIsolated&&(t.setIsolated(!1),r.setIsolated(!1)),this._numIntersections++,this.isTrivialIntersection(t,e,r,i)||(this._hasIntersection=!0,(this._includeProper||!this._li.isProper())&&(t.addIntersections(this._li,e,0),r.addIntersections(this._li,i,1)),this._li.isProper()&&(this._properIntersectionPoint=this._li.getIntersection(0).copy(),this._hasProper=!0,this._isDoneWhenProperInt&&(this._isDone=!0),this.isBoundaryPoint(this._li,this._bdyNodes)||(this._hasProperInterior=!0))))};fe.prototype.interfaces_=function(){return[]};fe.prototype.getClass=function(){return fe};fe.isAdjacentSegments=function(t,e){return Math.abs(t-e)===1};var mg=function(n){function t(){n.call(this),this.events=new k,this.nOverlaps=null}return n&&(t.__proto__=n),t.prototype=Object.create(n&&n.prototype),t.prototype.constructor=t,t.prototype.prepareEvents=function(){var r=this;gr.sort(this.events);for(var i=0;i<this.events.size();i++){var s=r.events.get(i);s.isDelete()&&s.getInsertEvent().setDeleteEventIndex(i)}},t.prototype.computeIntersections=function(){var r=this;if(arguments.length===1){var i=arguments[0];this.nOverlaps=0,this.prepareEvents();for(var s=0;s<this.events.size();s++){var o=r.events.get(s);if(o.isInsert()&&r.processOverlaps(s,o.getDeleteEventIndex(),o,i),i.isDone())break}}else if(arguments.length===3){if(arguments[2]instanceof fe&&H(arguments[0],lr)&&H(arguments[1],lr)){var a=arguments[0],u=arguments[1],l=arguments[2];this.addEdges(a,a),this.addEdges(u,u),this.computeIntersections(l)}else if(typeof arguments[2]=="boolean"&&H(arguments[0],lr)&&arguments[1]instanceof fe){var c=arguments[0],h=arguments[1],f=arguments[2];f?this.addEdges(c,null):this.addEdges(c),this.computeIntersections(h)}}},t.prototype.addEdge=function(r,i){for(var s=this,o=r.getMonotoneChainEdge(),a=o.getStartIndexes(),u=0;u<a.length-1;u++){var l=new uo(o,u),c=new ze(i,o.getMinX(u),l);s.events.add(c),s.events.add(new ze(o.getMaxX(u),c))}},t.prototype.processOverlaps=function(r,i,s,o){for(var a=this,u=s.getObject(),l=r;l<i;l++){var c=a.events.get(l);if(c.isInsert()){var h=c.getObject();s.isSameLabel(c)||(u.computeIntersections(h,o),a.nOverlaps++)}}},t.prototype.addEdges=function(){var r=this;if(arguments.length===1)for(var i=arguments[0],s=i.iterator();s.hasNext();){var o=s.next();r.addEdge(o,o)}else if(arguments.length===2)for(var a=arguments[0],u=arguments[1],l=a.iterator();l.hasNext();){var c=l.next();r.addEdge(c,u)}},t.prototype.interfaces_=function(){return[]},t.prototype.getClass=function(){return t},t}(xa),sn=function(){this._min=J.POSITIVE_INFINITY,this._max=J.NEGATIVE_INFINITY},Fh={NodeComparator:{configurable:!0}};sn.prototype.getMin=function(){return this._min};sn.prototype.intersects=function(t,e){return!(this._min>e||this._max<t)};sn.prototype.getMax=function(){return this._max};sn.prototype.toString=function(){return hr.toLineString(new P(this._min,0),new P(this._max,0))};sn.prototype.interfaces_=function(){return[]};sn.prototype.getClass=function(){return sn};Fh.NodeComparator.get=function(){return lo};Object.defineProperties(sn,Fh);var lo=function(){};lo.prototype.compare=function(t,e){var r=t,i=e,s=(r._min+r._max)/2,o=(i._min+i._max)/2;return s<o?-1:s>o?1:0};lo.prototype.interfaces_=function(){return[es]};lo.prototype.getClass=function(){return lo};var vg=function(n){function t(){n.call(this),this._item=null;var e=arguments[0],r=arguments[1],i=arguments[2];this._min=e,this._max=r,this._item=i}return n&&(t.__proto__=n),t.prototype=Object.create(n&&n.prototype),t.prototype.constructor=t,t.prototype.query=function(r,i,s){if(!this.intersects(r,i))return null;s.visitItem(this._item)},t.prototype.interfaces_=function(){return[]},t.prototype.getClass=function(){return t},t}(sn),yg=function(n){function t(){n.call(this),this._node1=null,this._node2=null;var e=arguments[0],r=arguments[1];this._node1=e,this._node2=r,this.buildExtent(this._node1,this._node2)}return n&&(t.__proto__=n),t.prototype=Object.create(n&&n.prototype),t.prototype.constructor=t,t.prototype.buildExtent=function(r,i){this._min=Math.min(r._min,i._min),this._max=Math.max(r._max,i._max)},t.prototype.query=function(r,i,s){if(!this.intersects(r,i))return null;this._node1!==null&&this._node1.query(r,i,s),this._node2!==null&&this._node2.query(r,i,s)},t.prototype.interfaces_=function(){return[]},t.prototype.getClass=function(){return t},t}(sn),on=function(){this._leaves=new k,this._root=null,this._level=0};on.prototype.buildTree=function(){var t=this;gr.sort(this._leaves,new sn.NodeComparator);for(var e=this._leaves,r=null,i=new k;;){if(t.buildLevel(e,i),i.size()===1)return i.get(0);r=e,e=i,i=r}};on.prototype.insert=function(t,e,r){if(this._root!==null)throw new Error("Index cannot be added to once it has been queried");this._leaves.add(new vg(t,e,r))};on.prototype.query=function(t,e,r){this.init(),this._root.query(t,e,r)};on.prototype.buildRoot=function(){if(this._root!==null)return null;this._root=this.buildTree()};on.prototype.printNode=function(t){le.out.println(hr.toLineString(new P(t._min,this._level),new P(t._max,this._level)))};on.prototype.init=function(){if(this._root!==null)return null;this.buildRoot()};on.prototype.buildLevel=function(t,e){this._level++,e.clear();for(var r=0;r<t.size();r+=2){var i=t.get(r),s=r+1<t.size()?t.get(r):null;if(s===null)e.add(i);else{var o=new yg(t.get(r),t.get(r+1));e.add(o)}}};on.prototype.interfaces_=function(){return[]};on.prototype.getClass=function(){return on};var gs=function(){this._items=new k};gs.prototype.visitItem=function(t){this._items.add(t)};gs.prototype.getItems=function(){return this._items};gs.prototype.interfaces_=function(){return[Un]};gs.prototype.getClass=function(){return gs};var ds=function(){this._index=null;var t=arguments[0];if(!H(t,zn))throw new Rt("Argument must be Polygonal");this._index=new ci(t)},Tl={SegmentVisitor:{configurable:!0},IntervalIndexedGeometry:{configurable:!0}};ds.prototype.locate=function(t){var e=new Nr(t),r=new ms(e);return this._index.query(t.y,t.y,r),e.getLocation()};ds.prototype.interfaces_=function(){return[fs]};ds.prototype.getClass=function(){return ds};Tl.SegmentVisitor.get=function(){return ms};Tl.IntervalIndexedGeometry.get=function(){return ci};Object.defineProperties(ds,Tl);var ms=function(){this._counter=null;var t=arguments[0];this._counter=t};ms.prototype.visitItem=function(t){var e=t;this._counter.countSegment(e.getCoordinate(0),e.getCoordinate(1))};ms.prototype.interfaces_=function(){return[Un]};ms.prototype.getClass=function(){return ms};var ci=function(){this._index=new on;var t=arguments[0];this.init(t)};ci.prototype.init=function(t){for(var e=this,r=oe.getLines(t),i=r.iterator();i.hasNext();){var s=i.next(),o=s.getCoordinates();e.addLine(o)}};ci.prototype.addLine=function(t){for(var e=this,r=1;r<t.length;r++){var i=new X(t[r-1],t[r]),s=Math.min(i.p0.y,i.p1.y),o=Math.max(i.p0.y,i.p1.y);e._index.insert(s,o,i)}};ci.prototype.query=function(){if(arguments.length===2){var t=arguments[0],e=arguments[1],r=new gs;return this._index.query(t,e,r),r.getItems()}else if(arguments.length===3){var i=arguments[0],s=arguments[1],o=arguments[2];this._index.query(i,s,o)}};ci.prototype.interfaces_=function(){return[]};ci.prototype.getClass=function(){return ci};var Fs=function(n){function t(){if(n.call(this),this._parentGeom=null,this._lineEdgeMap=new _h,this._boundaryNodeRule=null,this._useBoundaryDeterminationRule=!0,this._argIndex=null,this._boundaryNodes=null,this._hasTooFewPoints=!1,this._invalidPoint=null,this._areaPtLocator=null,this._ptLocator=new mr,arguments.length===2){var e=arguments[0],r=arguments[1],i=rr.OGC_SFS_BOUNDARY_RULE;this._argIndex=e,this._parentGeom=r,this._boundaryNodeRule=i,r!==null&&this.add(r)}else if(arguments.length===3){var s=arguments[0],o=arguments[1],a=arguments[2];this._argIndex=s,this._parentGeom=o,this._boundaryNodeRule=a,o!==null&&this.add(o)}}return n&&(t.__proto__=n),t.prototype=Object.create(n&&n.prototype),t.prototype.constructor=t,t.prototype.insertBoundaryPoint=function(r,i){var s=this._nodes.addNode(i),o=s.getLabel(),a=1,u=R.NONE;u=o.getLocation(r,D.ON),u===R.BOUNDARY&&a++;var l=t.determineBoundary(this._boundaryNodeRule,a);o.setLocation(r,l)},t.prototype.computeSelfNodes=function(){if(arguments.length===2){var r=arguments[0],i=arguments[1];return this.computeSelfNodes(r,i,!1)}else if(arguments.length===3){var s=arguments[0],o=arguments[1],a=arguments[2],u=new fe(s,!0,!1);u.setIsDoneIfProperInt(a);var l=this.createEdgeSetIntersector(),c=this._parentGeom instanceof Qr||this._parentGeom instanceof Kt||this._parentGeom instanceof Zr,h=o||!c;return l.computeIntersections(this._edges,u,h),this.addSelfIntersectionNodes(this._argIndex),u}},t.prototype.computeSplitEdges=function(r){for(var i=this._edges.iterator();i.hasNext();){var s=i.next();s.eiList.addSplitEdges(r)}},t.prototype.computeEdgeIntersections=function(r,i,s){var o=new fe(i,s,!0);o.setBoundaryNodes(this.getBoundaryNodes(),r.getBoundaryNodes());var a=this.createEdgeSetIntersector();return a.computeIntersections(this._edges,r._edges,o),o},t.prototype.getGeometry=function(){return this._parentGeom},t.prototype.getBoundaryNodeRule=function(){return this._boundaryNodeRule},t.prototype.hasTooFewPoints=function(){return this._hasTooFewPoints},t.prototype.addPoint=function(){if(arguments[0]instanceof ke){var r=arguments[0],i=r.getCoordinate();this.insertPoint(this._argIndex,i,R.INTERIOR)}else if(arguments[0]instanceof P){var s=arguments[0];this.insertPoint(this._argIndex,s,R.INTERIOR)}},t.prototype.addPolygon=function(r){var i=this;this.addPolygonRing(r.getExteriorRing(),R.EXTERIOR,R.INTERIOR);for(var s=0;s<r.getNumInteriorRing();s++){var o=r.getInteriorRingN(s);i.addPolygonRing(o,R.INTERIOR,R.EXTERIOR)}},t.prototype.addEdge=function(r){this.insertEdge(r);var i=r.getCoordinates();this.insertPoint(this._argIndex,i[0],R.BOUNDARY),this.insertPoint(this._argIndex,i[i.length-1],R.BOUNDARY)},t.prototype.addLineString=function(r){var i=it.removeRepeatedPoints(r.getCoordinates());if(i.length<2)return this._hasTooFewPoints=!0,this._invalidPoint=i[0],null;var s=new Ea(i,new vt(this._argIndex,R.INTERIOR));this._lineEdgeMap.put(r,s),this.insertEdge(s),et.isTrue(i.length>=2,"found LineString with single point"),this.insertBoundaryPoint(this._argIndex,i[0]),this.insertBoundaryPoint(this._argIndex,i[i.length-1])},t.prototype.getInvalidPoint=function(){return this._invalidPoint},t.prototype.getBoundaryPoints=function(){for(var r=this.getBoundaryNodes(),i=new Array(r.size()).fill(null),s=0,o=r.iterator();o.hasNext();){var a=o.next();i[s++]=a.getCoordinate().copy()}return i},t.prototype.getBoundaryNodes=function(){return this._boundaryNodes===null&&(this._boundaryNodes=this._nodes.getBoundaryNodes(this._argIndex)),this._boundaryNodes},t.prototype.addSelfIntersectionNode=function(r,i,s){if(this.isBoundaryNode(r,i))return null;s===R.BOUNDARY&&this._useBoundaryDeterminationRule?this.insertBoundaryPoint(r,i):this.insertPoint(r,i,s)},t.prototype.addPolygonRing=function(r,i,s){if(r.isEmpty())return null;var o=it.removeRepeatedPoints(r.getCoordinates());if(o.length<4)return this._hasTooFewPoints=!0,this._invalidPoint=o[0],null;var a=i,u=s;G.isCCW(o)&&(a=s,u=i);var l=new Ea(o,new vt(this._argIndex,R.BOUNDARY,a,u));this._lineEdgeMap.put(r,l),this.insertEdge(l),this.insertPoint(this._argIndex,o[0],R.BOUNDARY)},t.prototype.insertPoint=function(r,i,s){var o=this._nodes.addNode(i),a=o.getLabel();a===null?o._label=new vt(r,s):a.setLocation(r,s)},t.prototype.createEdgeSetIntersector=function(){return new mg},t.prototype.addSelfIntersectionNodes=function(r){for(var i=this,s=this._edges.iterator();s.hasNext();)for(var o=s.next(),a=o.getLabel().getLocation(r),u=o.eiList.iterator();u.hasNext();){var l=u.next();i.addSelfIntersectionNode(r,l.coord,a)}},t.prototype.add=function(){if(arguments.length===1){var r=arguments[0];if(r.isEmpty())return null;if(r instanceof Zr&&(this._useBoundaryDeterminationRule=!1),r instanceof Kt)this.addPolygon(r);else if(r instanceof Dt)this.addLineString(r);else if(r instanceof ke)this.addPoint(r);else if(r instanceof us)this.addCollection(r);else if(r instanceof ni)this.addCollection(r);else if(r instanceof Zr)this.addCollection(r);else if(r instanceof Se)this.addCollection(r);else throw new Error(r.getClass().getName())}else return n.prototype.add.apply(this,arguments)},t.prototype.addCollection=function(r){for(var i=this,s=0;s<r.getNumGeometries();s++){var o=r.getGeometryN(s);i.add(o)}},t.prototype.locate=function(r){return H(this._parentGeom,zn)&&this._parentGeom.getNumGeometries()>50?(this._areaPtLocator===null&&(this._areaPtLocator=new ds(this._parentGeom)),this._areaPtLocator.locate(r)):this._ptLocator.locate(r,this._parentGeom)},t.prototype.findEdge=function(){if(arguments.length===1){var r=arguments[0];return this._lineEdgeMap.get(r)}else return n.prototype.findEdge.apply(this,arguments)},t.prototype.interfaces_=function(){return[]},t.prototype.getClass=function(){return t},t.determineBoundary=function(r,i){return r.isInBoundary(i)?R.BOUNDARY:R.INTERIOR},t}(At),vs=function(){if(this._li=new yi,this._resultPrecisionModel=null,this._arg=null,arguments.length===1){var t=arguments[0];this.setComputationPrecision(t.getPrecisionModel()),this._arg=new Array(1).fill(null),this._arg[0]=new Fs(0,t)}else if(arguments.length===2){var e=arguments[0],r=arguments[1],i=rr.OGC_SFS_BOUNDARY_RULE;e.getPrecisionModel().compareTo(r.getPrecisionModel())>=0?this.setComputationPrecision(e.getPrecisionModel()):this.setComputationPrecision(r.getPrecisionModel()),this._arg=new Array(2).fill(null),this._arg[0]=new Fs(0,e,i),this._arg[1]=new Fs(1,r,i)}else if(arguments.length===3){var s=arguments[0],o=arguments[1],a=arguments[2];s.getPrecisionModel().compareTo(o.getPrecisionModel())>=0?this.setComputationPrecision(s.getPrecisionModel()):this.setComputationPrecision(o.getPrecisionModel()),this._arg=new Array(2).fill(null),this._arg[0]=new Fs(0,s,a),this._arg[1]=new Fs(1,o,a)}};vs.prototype.getArgGeometry=function(t){return this._arg[t].getGeometry()};vs.prototype.setComputationPrecision=function(t){this._resultPrecisionModel=t,this._li.setPrecisionModel(this._resultPrecisionModel)};vs.prototype.interfaces_=function(){return[]};vs.prototype.getClass=function(){return vs};var ri=function(){};ri.prototype.interfaces_=function(){return[]};ri.prototype.getClass=function(){return ri};ri.map=function(){if(arguments[0]instanceof Y&&H(arguments[1],ri.MapOp)){for(var t=arguments[0],e=arguments[1],r=new k,i=0;i<t.getNumGeometries();i++){var s=e.map(t.getGeometryN(i));s!==null&&r.add(s)}return t.getFactory().buildGeometry(r)}else if(H(arguments[0],Xt)&&H(arguments[1],ri.MapOp)){for(var o=arguments[0],a=arguments[1],u=new k,l=o.iterator();l.hasNext();){var c=l.next(),h=a.map(c);h!==null&&u.add(h)}return u}};ri.MapOp=function(){};var Q=function(n){function t(){var e=arguments[0],r=arguments[1];n.call(this,e,r),this._ptLocator=new mr,this._geomFact=null,this._resultGeom=null,this._graph=null,this._edgeList=new dr,this._resultPolyList=new k,this._resultLineList=new k,this._resultPointList=new k,this._graph=new At(new Mh),this._geomFact=e.getFactory()}return n&&(t.__proto__=n),t.prototype=Object.create(n&&n.prototype),t.prototype.constructor=t,t.prototype.insertUniqueEdge=function(r){var i=this._edgeList.findEqualEdge(r);if(i!==null){var s=i.getLabel(),o=r.getLabel();i.isPointwiseEqual(r)||(o=new vt(r.getLabel()),o.flip());var a=i.getDepth();a.isNull()&&a.add(s),a.add(o),s.merge(o)}else this._edgeList.add(r)},t.prototype.getGraph=function(){return this._graph},t.prototype.cancelDuplicateResultEdges=function(){for(var r=this._graph.getEdgeEnds().iterator();r.hasNext();){var i=r.next(),s=i.getSym();i.isInResult()&&s.isInResult()&&(i.setInResult(!1),s.setInResult(!1))}},t.prototype.isCoveredByLA=function(r){return!!(this.isCovered(r,this._resultLineList)||this.isCovered(r,this._resultPolyList))},t.prototype.computeGeometry=function(r,i,s,o){var a=new k;return a.addAll(r),a.addAll(i),a.addAll(s),a.isEmpty()?t.createEmptyResult(o,this._arg[0].getGeometry(),this._arg[1].getGeometry(),this._geomFact):this._geomFact.buildGeometry(a)},t.prototype.mergeSymLabels=function(){for(var r=this._graph.getNodes().iterator();r.hasNext();){var i=r.next();i.getEdges().mergeSymLabels()}},t.prototype.isCovered=function(r,i){for(var s=this,o=i.iterator();o.hasNext();){var a=o.next(),u=s._ptLocator.locate(r,a);if(u!==R.EXTERIOR)return!0}return!1},t.prototype.replaceCollapsedEdges=function(){for(var r=new k,i=this._edgeList.iterator();i.hasNext();){var s=i.next();s.isCollapsed()&&(i.remove(),r.add(s.getCollapsedEdge()))}this._edgeList.addAll(r)},t.prototype.updateNodeLabelling=function(){for(var r=this._graph.getNodes().iterator();r.hasNext();){var i=r.next(),s=i.getEdges().getLabel();i.getLabel().merge(s)}},t.prototype.getResultGeometry=function(r){return this.computeOverlay(r),this._resultGeom},t.prototype.insertUniqueEdges=function(r){for(var i=this,s=r.iterator();s.hasNext();){var o=s.next();i.insertUniqueEdge(o)}},t.prototype.computeOverlay=function(r){this.copyPoints(0),this.copyPoints(1),this._arg[0].computeSelfNodes(this._li,!1),this._arg[1].computeSelfNodes(this._li,!1),this._arg[0].computeEdgeIntersections(this._arg[1],this._li,!0);var i=new k;this._arg[0].computeSplitEdges(i),this._arg[1].computeSplitEdges(i),this.insertUniqueEdges(i),this.computeLabelsFromDepths(),this.replaceCollapsedEdges(),li.checkValid(this._edgeList.getEdges()),this._graph.addEdges(this._edgeList.getEdges()),this.computeLabelling(),this.labelIncompleteNodes(),this.findResultAreaEdges(r),this.cancelDuplicateResultEdges();var s=new Ge(this._geomFact);s.add(this._graph),this._resultPolyList=s.getPolygons();var o=new Br(this,this._geomFact,this._ptLocator);this._resultLineList=o.build(r);var a=new Li(this,this._geomFact,this._ptLocator);this._resultPointList=a.build(r),this._resultGeom=this.computeGeometry(this._resultPointList,this._resultLineList,this._resultPolyList,r)},t.prototype.labelIncompleteNode=function(r,i){var s=this._ptLocator.locate(r.getCoordinate(),this._arg[i].getGeometry());r.getLabel().setLocation(i,s)},t.prototype.copyPoints=function(r){for(var i=this,s=this._arg[r].getNodeIterator();s.hasNext();){var o=s.next(),a=i._graph.addNode(o.getCoordinate());a.setLabel(r,o.getLabel().getLocation(r))}},t.prototype.findResultAreaEdges=function(r){for(var i=this._graph.getEdgeEnds().iterator();i.hasNext();){var s=i.next(),o=s.getLabel();o.isArea()&&!s.isInteriorAreaEdge()&&t.isResultOfOp(o.getLocation(0,D.RIGHT),o.getLocation(1,D.RIGHT),r)&&s.setInResult(!0)}},t.prototype.computeLabelsFromDepths=function(){for(var r=this._edgeList.iterator();r.hasNext();){var i=r.next(),s=i.getLabel(),o=i.getDepth();if(!o.isNull()){o.normalize();for(var a=0;a<2;a++)!s.isNull(a)&&s.isArea()&&!o.isNull(a)&&(o.getDelta(a)===0?s.toLine(a):(et.isTrue(!o.isNull(a,D.LEFT),"depth of LEFT side has not been initialized"),s.setLocation(a,D.LEFT,o.getLocation(a,D.LEFT)),et.isTrue(!o.isNull(a,D.RIGHT),"depth of RIGHT side has not been initialized"),s.setLocation(a,D.RIGHT,o.getLocation(a,D.RIGHT))))}}},t.prototype.computeLabelling=function(){for(var r=this,i=this._graph.getNodes().iterator();i.hasNext();){var s=i.next();s.getEdges().computeLabelling(r._arg)}this.mergeSymLabels(),this.updateNodeLabelling()},t.prototype.labelIncompleteNodes=function(){for(var r=this,i=this._graph.getNodes().iterator();i.hasNext();){var s=i.next(),o=s.getLabel();s.isIsolated()&&(o.isNull(0)?r.labelIncompleteNode(s,0):r.labelIncompleteNode(s,1)),s.getEdges().updateLabelling(o)}},t.prototype.isCoveredByA=function(r){return!!this.isCovered(r,this._resultPolyList)},t.prototype.interfaces_=function(){return[]},t.prototype.getClass=function(){return t},t}(vs);Q.overlayOp=function(n,t,e){var r=new Q(n,t),i=r.getResultGeometry(e);return i};Q.intersection=function(n,t){if(n.isEmpty()||t.isEmpty())return Q.createEmptyResult(Q.INTERSECTION,n,t,n.getFactory());if(n.isGeometryCollection()){var e=t;return Ri.map(n,{interfaces_:function(){return[ri.MapOp]},map:function(r){return r.intersection(e)}})}return n.checkNotGeometryCollection(n),n.checkNotGeometryCollection(t),Ne.overlayOp(n,t,Q.INTERSECTION)};Q.symDifference=function(n,t){if(n.isEmpty()||t.isEmpty()){if(n.isEmpty()&&t.isEmpty())return Q.createEmptyResult(Q.SYMDIFFERENCE,n,t,n.getFactory());if(n.isEmpty())return t.copy();if(t.isEmpty())return n.copy()}return n.checkNotGeometryCollection(n),n.checkNotGeometryCollection(t),Ne.overlayOp(n,t,Q.SYMDIFFERENCE)};Q.resultDimension=function(n,t,e){var r=t.getDimension(),i=e.getDimension(),s=-1;switch(n){case Q.INTERSECTION:s=Math.min(r,i);break;case Q.UNION:s=Math.max(r,i);break;case Q.DIFFERENCE:s=r;break;case Q.SYMDIFFERENCE:s=Math.max(r,i);break}return s};Q.createEmptyResult=function(n,t,e,r){var i=null;switch(Q.resultDimension(n,t,e)){case-1:i=r.createGeometryCollection(new Array(0).fill(null));break;case 0:i=r.createPoint();break;case 1:i=r.createLineString();break;case 2:i=r.createPolygon();break}return i};Q.difference=function(n,t){return n.isEmpty()?Q.createEmptyResult(Q.DIFFERENCE,n,t,n.getFactory()):t.isEmpty()?n.copy():(n.checkNotGeometryCollection(n),n.checkNotGeometryCollection(t),Ne.overlayOp(n,t,Q.DIFFERENCE))};Q.isResultOfOp=function(){if(arguments.length===2){var n=arguments[0],t=arguments[1],e=n.getLocation(0),r=n.getLocation(1);return Q.isResultOfOp(e,r,t)}else if(arguments.length===3){var i=arguments[0],s=arguments[1],o=arguments[2];switch(i===R.BOUNDARY&&(i=R.INTERIOR),s===R.BOUNDARY&&(s=R.INTERIOR),o){case Q.INTERSECTION:return i===R.INTERIOR&&s===R.INTERIOR;case Q.UNION:return i===R.INTERIOR||s===R.INTERIOR;case Q.DIFFERENCE:return i===R.INTERIOR&&s!==R.INTERIOR;case Q.SYMDIFFERENCE:return i===R.INTERIOR&&s!==R.INTERIOR||i!==R.INTERIOR&&s===R.INTERIOR}return!1}};Q.INTERSECTION=1;Q.UNION=2;Q.DIFFERENCE=3;Q.SYMDIFFERENCE=4;var Bn=function(){this._g=null,this._boundaryDistanceTolerance=null,this._linework=null,this._ptLocator=new mr,this._seg=new X;var t=arguments[0],e=arguments[1];this._g=t,this._boundaryDistanceTolerance=e,this._linework=this.extractLinework(t)};Bn.prototype.isWithinToleranceOfBoundary=function(t){for(var e=this,r=0;r<this._linework.getNumGeometries();r++)for(var i=e._linework.getGeometryN(r),s=i.getCoordinateSequence(),o=0;o<s.size()-1;o++){s.getCoordinate(o,e._seg.p0),s.getCoordinate(o+1,e._seg.p1);var a=e._seg.distance(t);if(a<=e._boundaryDistanceTolerance)return!0}return!1};Bn.prototype.getLocation=function(t){return this.isWithinToleranceOfBoundary(t)?R.BOUNDARY:this._ptLocator.locate(t,this._g)};Bn.prototype.extractLinework=function(t){var e=new ys;t.apply(e);var r=e.getLinework(),i=nt.toLineStringArray(r);return t.getFactory().createMultiLineString(i)};Bn.prototype.interfaces_=function(){return[]};Bn.prototype.getClass=function(){return Bn};var ys=function(){this._linework=null,this._linework=new k};ys.prototype.getLinework=function(){return this._linework};ys.prototype.filter=function(t){var e=this;if(t instanceof Kt){var r=t;this._linework.add(r.getExteriorRing());for(var i=0;i<r.getNumInteriorRing();i++)e._linework.add(r.getInteriorRingN(i))}};ys.prototype.interfaces_=function(){return[Lr]};ys.prototype.getClass=function(){return ys};var hi=function(){this._g=null,this._doLeft=!0,this._doRight=!0;var t=arguments[0];this._g=t};hi.prototype.extractPoints=function(t,e,r){for(var i=this,s=t.getCoordinates(),o=0;o<s.length-1;o++)i.computeOffsetPoints(s[o],s[o+1],e,r)};hi.prototype.setSidesToGenerate=function(t,e){this._doLeft=t,this._doRight=e};hi.prototype.getPoints=function(t){for(var e=this,r=new k,i=oe.getLines(this._g),s=i.iterator();s.hasNext();){var o=s.next();e.extractPoints(o,t,r)}return r};hi.prototype.computeOffsetPoints=function(t,e,r,i){var s=e.x-t.x,o=e.y-t.y,a=Math.sqrt(s*s+o*o),u=r*s/a,l=r*o/a,c=(e.x+t.x)/2,h=(e.y+t.y)/2;if(this._doLeft){var f=new P(c-l,h+u);i.add(f)}if(this._doRight){var p=new P(c+l,h-u);i.add(p)}};hi.prototype.interfaces_=function(){return[]};hi.prototype.getClass=function(){return hi};var He=function n(){this._geom=null,this._locFinder=null,this._location=new Array(3).fill(null),this._invalidLocation=null,this._boundaryDistanceTolerance=n.TOLERANCE,this._testCoords=new k;var t=arguments[0],e=arguments[1],r=arguments[2];this._boundaryDistanceTolerance=n.computeBoundaryDistanceTolerance(t,e),this._geom=[t,e,r],this._locFinder=[new Bn(this._geom[0],this._boundaryDistanceTolerance),new Bn(this._geom[1],this._boundaryDistanceTolerance),new Bn(this._geom[2],this._boundaryDistanceTolerance)]},kh={TOLERANCE:{configurable:!0}};He.prototype.reportResult=function(t,e,r){le.out.println("Overlay result invalid - A:"+R.toLocationSymbol(e[0])+" B:"+R.toLocationSymbol(e[1])+" expected:"+(r?"i":"e")+" actual:"+R.toLocationSymbol(e[2]))};He.prototype.isValid=function(t){this.addTestPts(this._geom[0]),this.addTestPts(this._geom[1]);var e=this.checkValid(t);return e};He.prototype.checkValid=function(){var t=this;if(arguments.length===1){for(var e=arguments[0],r=0;r<this._testCoords.size();r++){var i=t._testCoords.get(r);if(!t.checkValid(e,i))return t._invalidLocation=i,!1}return!0}else if(arguments.length===2){var s=arguments[0],o=arguments[1];return this._location[0]=this._locFinder[0].getLocation(o),this._location[1]=this._locFinder[1].getLocation(o),this._location[2]=this._locFinder[2].getLocation(o),He.hasLocation(this._location,R.BOUNDARY)?!0:this.isValidResult(s,this._location)}};He.prototype.addTestPts=function(t){var e=new hi(t);this._testCoords.addAll(e.getPoints(5*this._boundaryDistanceTolerance))};He.prototype.isValidResult=function(t,e){var r=Q.isResultOfOp(e[0],e[1],t),i=e[2]===R.INTERIOR,s=!(r^i);return s||this.reportResult(t,e,r),s};He.prototype.getInvalidLocation=function(){return this._invalidLocation};He.prototype.interfaces_=function(){return[]};He.prototype.getClass=function(){return He};He.hasLocation=function(t,e){for(var r=0;r<3;r++)if(t[r]===e)return!0;return!1};He.computeBoundaryDistanceTolerance=function(t,e){return Math.min(Bt.computeSizeBasedSnapTolerance(t),Bt.computeSizeBasedSnapTolerance(e))};He.isValid=function(t,e,r,i){var s=new He(t,e,i);return s.isValid(r)};kh.TOLERANCE.get=function(){return 1e-6};Object.defineProperties(He,kh);var Ve=function n(t){this._geomFactory=null,this._skipEmpty=!1,this._inputGeoms=null,this._geomFactory=n.extractFactory(t),this._inputGeoms=t};Ve.prototype.extractElements=function(t,e){var r=this;if(t===null)return null;for(var i=0;i<t.getNumGeometries();i++){var s=t.getGeometryN(i);r._skipEmpty&&s.isEmpty()||e.add(s)}};Ve.prototype.combine=function(){for(var t=this,e=new k,r=this._inputGeoms.iterator();r.hasNext();){var i=r.next();t.extractElements(i,e)}return e.size()===0?this._geomFactory!==null?this._geomFactory.createGeometryCollection(null):null:this._geomFactory.buildGeometry(e)};Ve.prototype.interfaces_=function(){return[]};Ve.prototype.getClass=function(){return Ve};Ve.combine=function(){if(arguments.length===1){var t=arguments[0],e=new Ve(t);return e.combine()}else if(arguments.length===2){var r=arguments[0],i=arguments[1],s=new Ve(Ve.createList(r,i));return s.combine()}else if(arguments.length===3){var o=arguments[0],a=arguments[1],u=arguments[2],l=new Ve(Ve.createList(o,a,u));return l.combine()}};Ve.extractFactory=function(t){return t.isEmpty()?null:t.iterator().next().getFactory()};Ve.createList=function(){if(arguments.length===2){var t=arguments[0],e=arguments[1],r=new k;return r.add(t),r.add(e),r}else if(arguments.length===3){var i=arguments[0],s=arguments[1],o=arguments[2],a=new k;return a.add(i),a.add(s),a.add(o),a}};var Vt=function(){this._inputPolys=null,this._geomFactory=null;var t=arguments[0];this._inputPolys=t,this._inputPolys===null&&(this._inputPolys=new k)},Gh={STRTREE_NODE_CAPACITY:{configurable:!0}};Vt.prototype.reduceToGeometries=function(t){for(var e=this,r=new k,i=t.iterator();i.hasNext();){var s=i.next(),o=null;H(s,lr)?o=e.unionTree(s):s instanceof Y&&(o=s),r.add(o)}return r};Vt.prototype.extractByEnvelope=function(t,e,r){for(var i=new k,s=0;s<e.getNumGeometries();s++){var o=e.getGeometryN(s);o.getEnvelopeInternal().intersects(t)?i.add(o):r.add(o)}return this._geomFactory.buildGeometry(i)};Vt.prototype.unionOptimized=function(t,e){var r=t.getEnvelopeInternal(),i=e.getEnvelopeInternal();if(!r.intersects(i)){var s=Ve.combine(t,e);return s}if(t.getNumGeometries()<=1&&e.getNumGeometries()<=1)return this.unionActual(t,e);var o=r.intersection(i);return this.unionUsingEnvelopeIntersection(t,e,o)};Vt.prototype.union=function(){if(this._inputPolys===null)throw new Error("union() method cannot be called twice");if(this._inputPolys.isEmpty())return null;this._geomFactory=this._inputPolys.iterator().next().getFactory();for(var t=new Ih(Vt.STRTREE_NODE_CAPACITY),e=this._inputPolys.iterator();e.hasNext();){var r=e.next();t.insert(r.getEnvelopeInternal(),r)}this._inputPolys=null;var i=t.itemsTree(),s=this.unionTree(i);return s};Vt.prototype.binaryUnion=function(){if(arguments.length===1){var t=arguments[0];return this.binaryUnion(t,0,t.size())}else if(arguments.length===3){var e=arguments[0],r=arguments[1],i=arguments[2];if(i-r<=1){var s=Vt.getGeometry(e,r);return this.unionSafe(s,null)}else{if(i-r===2)return this.unionSafe(Vt.getGeometry(e,r),Vt.getGeometry(e,r+1));var o=Math.trunc((i+r)/2),a=this.binaryUnion(e,r,o),u=this.binaryUnion(e,o,i);return this.unionSafe(a,u)}}};Vt.prototype.repeatedUnion=function(t){for(var e=null,r=t.iterator();r.hasNext();){var i=r.next();e===null?e=i.copy():e=e.union(i)}return e};Vt.prototype.unionSafe=function(t,e){return t===null&&e===null?null:t===null?e.copy():e===null?t.copy():this.unionOptimized(t,e)};Vt.prototype.unionActual=function(t,e){return Vt.restrictToPolygons(t.union(e))};Vt.prototype.unionTree=function(t){var e=this.reduceToGeometries(t),r=this.binaryUnion(e);return r};Vt.prototype.unionUsingEnvelopeIntersection=function(t,e,r){var i=new k,s=this.extractByEnvelope(r,t,i),o=this.extractByEnvelope(r,e,i),a=this.unionActual(s,o);i.add(a);var u=Ve.combine(i);return u};Vt.prototype.bufferUnion=function(){if(arguments.length===1){var t=arguments[0],e=t.get(0).getFactory(),r=e.buildGeometry(t),i=r.buffer(0);return i}else if(arguments.length===2){var s=arguments[0],o=arguments[1],a=s.getFactory(),u=a.createGeometryCollection([s,o]),l=u.buffer(0);return l}};Vt.prototype.interfaces_=function(){return[]};Vt.prototype.getClass=function(){return Vt};Vt.restrictToPolygons=function(t){if(H(t,zn))return t;var e=gn.getPolygons(t);return e.size()===1?e.get(0):t.getFactory().createMultiPolygon(nt.toPolygonArray(e))};Vt.getGeometry=function(t,e){return e>=t.size()?null:t.get(e)};Vt.union=function(t){var e=new Vt(t);return e.union()};Gh.STRTREE_NODE_CAPACITY.get=function(){return 4};Object.defineProperties(Vt,Gh);var Ia=function(){};Ia.prototype.interfaces_=function(){return[]};Ia.prototype.getClass=function(){return Ia};Ia.union=function(t,e){if(t.isEmpty()||e.isEmpty()){if(t.isEmpty()&&e.isEmpty())return Q.createEmptyResult(Q.UNION,t,e,t.getFactory());if(t.isEmpty())return e.copy();if(e.isEmpty())return t.copy()}return t.checkNotGeometryCollection(t),t.checkNotGeometryCollection(e),Ne.overlayOp(t,e,Q.UNION)};function _i(){return new Ca}function Ca(){this.reset()}Ca.prototype={constructor:Ca,reset:function(){this.s=this.t=0},add:function(n){uc(jo,n,this.t),uc(this,jo.s,this.s),this.s?this.t+=jo.t:this.s=jo.t},valueOf:function(){return this.s}};var jo=new Ca;function uc(n,t,e){var r=n.s=t+e,i=r-t,s=r-i;n.t=t-s+(e-i)}var Ot=1e-6,xt=Math.PI,pn=xt/2,lc=xt/4,En=xt*2,Qn=180/xt,xr=xt/180,Ie=Math.abs,_g=Math.atan,_s=Math.atan2,Yt=Math.cos,Zt=Math.sin,As=Math.sqrt;function Bh(n){return n>1?0:n<-1?xt:Math.acos(n)}function Oi(n){return n>1?pn:n<-1?-pn:Math.asin(n)}function Us(){}function Sa(n,t){n&&hc.hasOwnProperty(n.type)&&hc[n.type](n,t)}var cc={Feature:function(n,t){Sa(n.geometry,t)},FeatureCollection:function(n,t){for(var e=n.features,r=-1,i=e.length;++r<i;)Sa(e[r].geometry,t)}},hc={Sphere:function(n,t){t.sphere()},Point:function(n,t){n=n.coordinates,t.point(n[0],n[1],n[2])},MultiPoint:function(n,t){for(var e=n.coordinates,r=-1,i=e.length;++r<i;)n=e[r],t.point(n[0],n[1],n[2])},LineString:function(n,t){Zu(n.coordinates,t,0)},MultiLineString:function(n,t){for(var e=n.coordinates,r=-1,i=e.length;++r<i;)Zu(e[r],t,0)},Polygon:function(n,t){fc(n.coordinates,t)},MultiPolygon:function(n,t){for(var e=n.coordinates,r=-1,i=e.length;++r<i;)fc(e[r],t)},GeometryCollection:function(n,t){for(var e=n.geometries,r=-1,i=e.length;++r<i;)Sa(e[r],t)}};function Zu(n,t,e){var r=-1,i=n.length-e,s;for(t.lineStart();++r<i;)s=n[r],t.point(s[0],s[1],s[2]);t.lineEnd()}function fc(n,t){var e=-1,r=n.length;for(t.polygonStart();++e<r;)Zu(n[e],t,1);t.polygonEnd()}function wg(n,t){n&&cc.hasOwnProperty(n.type)?cc[n.type](n,t):Sa(n,t)}_i();_i();function Hu(n){return[_s(n[1],n[0]),Oi(n[2])]}function ws(n){var t=n[0],e=n[1],r=Yt(e);return[r*Yt(t),r*Zt(t),Zt(e)]}function Vo(n,t){return n[0]*t[0]+n[1]*t[1]+n[2]*t[2]}function ba(n,t){return[n[1]*t[2]-n[2]*t[1],n[2]*t[0]-n[0]*t[2],n[0]*t[1]-n[1]*t[0]]}function Tu(n,t){n[0]+=t[0],n[1]+=t[1],n[2]+=t[2]}function qo(n,t){return[n[0]*t,n[1]*t,n[2]*t]}function Ku(n){var t=As(n[0]*n[0]+n[1]*n[1]+n[2]*n[2]);n[0]/=t,n[1]/=t,n[2]/=t}_i();function zh(n,t){function e(r,i){return r=n(r,i),t(r[0],r[1])}return n.invert&&t.invert&&(e.invert=function(r,i){return r=t.invert(r,i),r&&n.invert(r[0],r[1])}),e}function Ju(n,t){return[n>xt?n-En:n<-xt?n+En:n,t]}Ju.invert=Ju;function Eg(n,t,e){return(n%=En)?t||e?zh(gc(n),dc(t,e)):gc(n):t||e?dc(t,e):Ju}function pc(n){return function(t,e){return t+=n,[t>xt?t-En:t<-xt?t+En:t,e]}}function gc(n){var t=pc(n);return t.invert=pc(-n),t}function dc(n,t){var e=Yt(n),r=Zt(n),i=Yt(t),s=Zt(t);function o(a,u){var l=Yt(u),c=Yt(a)*l,h=Zt(a)*l,f=Zt(u),p=f*e+c*r;return[_s(h*i-p*s,c*e-f*r),Oi(p*i+h*s)]}return o.invert=function(a,u){var l=Yt(u),c=Yt(a)*l,h=Zt(a)*l,f=Zt(u),p=f*i-h*s;return[_s(h*i+f*s,c*e+p*r),Oi(p*e-c*r)]},o}function xg(n,t,e,r,i,s){if(e){var o=Yt(t),a=Zt(t),u=r*e;i==null?(i=t+r*En,s=t-u/2):(i=mc(o,i),s=mc(o,s),(r>0?i<s:i>s)&&(i+=r*En));for(var l,c=i;r>0?c>s:c<s;c-=u)l=Hu([o,-a*Yt(c),-a*Zt(c)]),n.point(l[0],l[1])}}function mc(n,t){t=ws(t),t[0]-=n,Ku(t);var e=Bh(-t[1]);return((-t[2]<0?-e:e)+En-Ot)%En}function Uh(){var n=[],t;return{point:function(e,r){t.push([e,r])},lineStart:function(){n.push(t=[])},lineEnd:Us,rejoin:function(){n.length>1&&n.push(n.pop().concat(n.shift()))},result:function(){var e=n;return n=[],t=null,e}}}function Ig(n,t,e,r,i,s){var o=n[0],a=n[1],u=t[0],l=t[1],c=0,h=1,f=u-o,p=l-a,d;if(d=e-o,!(!f&&d>0)){if(d/=f,f<0){if(d<c)return;d<h&&(h=d)}else if(f>0){if(d>h)return;d>c&&(c=d)}if(d=i-o,!(!f&&d<0)){if(d/=f,f<0){if(d>h)return;d>c&&(c=d)}else if(f>0){if(d<c)return;d<h&&(h=d)}if(d=r-a,!(!p&&d>0)){if(d/=p,p<0){if(d<c)return;d<h&&(h=d)}else if(p>0){if(d>h)return;d>c&&(c=d)}if(d=s-a,!(!p&&d<0)){if(d/=p,p<0){if(d>h)return;d>c&&(c=d)}else if(p>0){if(d<c)return;d<h&&(h=d)}return c>0&&(n[0]=o+c*f,n[1]=a+c*p),h<1&&(t[0]=o+h*f,t[1]=a+h*p),!0}}}}}function pa(n,t){return Ie(n[0]-t[0])<Ot&&Ie(n[1]-t[1])<Ot}function Wo(n,t,e,r){this.x=n,this.z=t,this.o=e,this.e=r,this.v=!1,this.n=this.p=null}function jh(n,t,e,r,i){var s=[],o=[],a,u;if(n.forEach(function(d){if(!((_=d.length-1)<=0)){var _,w=d[0],y=d[_],x;if(pa(w,y)){for(i.lineStart(),a=0;a<_;++a)i.point((w=d[a])[0],w[1]);i.lineEnd();return}s.push(x=new Wo(w,d,null,!0)),o.push(x.o=new Wo(w,null,x,!1)),s.push(x=new Wo(y,d,null,!1)),o.push(x.o=new Wo(y,null,x,!0))}}),!!s.length){for(o.sort(t),vc(s),vc(o),a=0,u=o.length;a<u;++a)o[a].e=e=!e;for(var l=s[0],c,h;;){for(var f=l,p=!0;f.v;)if((f=f.n)===l)return;c=f.z,i.lineStart();do{if(f.v=f.o.v=!0,f.e){if(p)for(a=0,u=c.length;a<u;++a)i.point((h=c[a])[0],h[1]);else r(f.x,f.n.x,1,i);f=f.n}else{if(p)for(c=f.p.z,a=c.length-1;a>=0;--a)i.point((h=c[a])[0],h[1]);else r(f.x,f.p.x,-1,i);f=f.p}f=f.o,c=f.z,p=!p}while(!f.v);i.lineEnd()}}}function vc(n){if(t=n.length){for(var t,e=0,r=n[0],i;++e<t;)r.n=i=n[e],i.p=r,r=i;r.n=i=n[0],i.p=r}}function Vh(n,t){return n<t?-1:n>t?1:n>=t?0:NaN}function Cg(n){return n.length===1&&(n=Sg(n)),{left:function(t,e,r,i){for(r==null&&(r=0),i==null&&(i=t.length);r<i;){var s=r+i>>>1;n(t[s],e)<0?r=s+1:i=s}return r},right:function(t,e,r,i){for(r==null&&(r=0),i==null&&(i=t.length);r<i;){var s=r+i>>>1;n(t[s],e)>0?i=s:r=s+1}return r}}}function Sg(n){return function(t,e){return Vh(n(t),e)}}Cg(Vh);function qh(n){for(var t=n.length,e,r=-1,i=0,s,o;++r<t;)i+=n[r].length;for(s=new Array(i);--t>=0;)for(o=n[t],e=o.length;--e>=0;)s[--i]=o[e];return s}var js=1e9,Xo=-js;function bg(n,t,e,r){function i(l,c){return n<=l&&l<=e&&t<=c&&c<=r}function s(l,c,h,f){var p=0,d=0;if(l==null||(p=o(l,h))!==(d=o(c,h))||u(l,c)<0^h>0)do f.point(p===0||p===3?n:e,p>1?r:t);while((p=(p+h+4)%4)!==d);else f.point(c[0],c[1])}function o(l,c){return Ie(l[0]-n)<Ot?c>0?0:3:Ie(l[0]-e)<Ot?c>0?2:1:Ie(l[1]-t)<Ot?c>0?1:0:c>0?3:2}function a(l,c){return u(l.x,c.x)}function u(l,c){var h=o(l,1),f=o(c,1);return h!==f?h-f:h===0?c[1]-l[1]:h===1?l[0]-c[0]:h===2?l[1]-c[1]:c[0]-l[0]}return function(l){var c=l,h=Uh(),f,p,d,_,w,y,x,g,m,E,N,b={point:S,lineStart:A,lineEnd:K,polygonStart:I,polygonEnd:T};function S(j,q){i(j,q)&&c.point(j,q)}function v(){for(var j=0,q=0,yt=p.length;q<yt;++q)for(var Et=p[q],Pt=1,bt=Et.length,Qt=Et[0],$,Nt,$t=Qt[0],ie=Qt[1];Pt<bt;++Pt)$=$t,Nt=ie,Qt=Et[Pt],$t=Qt[0],ie=Qt[1],Nt<=r?ie>r&&($t-$)*(r-Nt)>(ie-Nt)*(n-$)&&++j:ie<=r&&($t-$)*(r-Nt)<(ie-Nt)*(n-$)&&--j;return j}function I(){c=h,f=[],p=[],N=!0}function T(){var j=v(),q=N&&j,yt=(f=qh(f)).length;(q||yt)&&(l.polygonStart(),q&&(l.lineStart(),s(null,null,1,l),l.lineEnd()),yt&&jh(f,a,j,s,l),l.polygonEnd()),c=l,f=p=d=null}function A(){b.point=O,p&&p.push(d=[]),E=!0,m=!1,x=g=NaN}function K(){f&&(O(_,w),y&&m&&h.rejoin(),f.push(h.result())),b.point=S,m&&c.lineEnd()}function O(j,q){var yt=i(j,q);if(p&&d.push([j,q]),E)_=j,w=q,y=yt,E=!1,yt&&(c.lineStart(),c.point(j,q));else if(yt&&m)c.point(j,q);else{var Et=[x=Math.max(Xo,Math.min(js,x)),g=Math.max(Xo,Math.min(js,g))],Pt=[j=Math.max(Xo,Math.min(js,j)),q=Math.max(Xo,Math.min(js,q))];Ig(Et,Pt,n,t,e,r)?(m||(c.lineStart(),c.point(Et[0],Et[1])),c.point(Pt[0],Pt[1]),yt||c.lineEnd(),N=!1):yt&&(c.lineStart(),c.point(j,q),N=!1)}x=j,g=q,m=yt}return b}}var Pu=_i();function Mg(n,t){var e=t[0],r=t[1],i=[Zt(e),-Yt(e),0],s=0,o=0;Pu.reset();for(var a=0,u=n.length;a<u;++a)if(c=(l=n[a]).length)for(var l,c,h=l[c-1],f=h[0],p=h[1]/2+lc,d=Zt(p),_=Yt(p),w=0;w<c;++w,f=x,d=m,_=E,h=y){var y=l[w],x=y[0],g=y[1]/2+lc,m=Zt(g),E=Yt(g),N=x-f,b=N>=0?1:-1,S=b*N,v=S>xt,I=d*m;if(Pu.add(_s(I*b*Zt(S),_*E+I*Yt(S))),s+=v?N+b*En:N,v^f>=e^x>=e){var T=ba(ws(h),ws(y));Ku(T);var A=ba(i,T);Ku(A);var K=(v^N>=0?-1:1)*Oi(A[2]);(r>K||r===K&&(T[0]||T[1]))&&(o+=v^N>=0?1:-1)}}return(s<-Ot||s<Ot&&Pu<-Ot)^o&1}_i();function yc(n){return n}_i();_i();var Es=1/0,Ma=Es,co=-Es,Na=co,_c={point:Ng,lineStart:Us,lineEnd:Us,polygonStart:Us,polygonEnd:Us,result:function(){var n=[[Es,Ma],[co,Na]];return co=Na=-(Ma=Es=1/0),n}};function Ng(n,t){n<Es&&(Es=n),n>co&&(co=n),t<Ma&&(Ma=t),t>Na&&(Na=t)}_i();function Wh(n,t,e,r){return function(i,s){var o=t(s),a=i.invert(r[0],r[1]),u=Uh(),l=t(u),c=!1,h,f,p,d={point:_,lineStart:y,lineEnd:x,polygonStart:function(){d.point=g,d.lineStart=m,d.lineEnd=E,f=[],h=[]},polygonEnd:function(){d.point=_,d.lineStart=y,d.lineEnd=x,f=qh(f);var N=Mg(h,a);f.length?(c||(s.polygonStart(),c=!0),jh(f,Pg,N,e,s)):N&&(c||(s.polygonStart(),c=!0),s.lineStart(),e(null,null,1,s),s.lineEnd()),c&&(s.polygonEnd(),c=!1),f=h=null},sphere:function(){s.polygonStart(),s.lineStart(),e(null,null,1,s),s.lineEnd(),s.polygonEnd()}};function _(N,b){var S=i(N,b);n(N=S[0],b=S[1])&&s.point(N,b)}function w(N,b){var S=i(N,b);o.point(S[0],S[1])}function y(){d.point=w,o.lineStart()}function x(){d.point=_,o.lineEnd()}function g(N,b){p.push([N,b]);var S=i(N,b);l.point(S[0],S[1])}function m(){l.lineStart(),p=[]}function E(){g(p[0][0],p[0][1]),l.lineEnd();var N=l.clean(),b=u.result(),S,v=b.length,I,T,A;if(p.pop(),h.push(p),p=null,!!v){if(N&1){if(T=b[0],(I=T.length-1)>0){for(c||(s.polygonStart(),c=!0),s.lineStart(),S=0;S<I;++S)s.point((A=T[S])[0],A[1]);s.lineEnd()}return}v>1&&N&2&&b.push(b.pop().concat(b.shift())),f.push(b.filter(Tg))}}return d}}function Tg(n){return n.length>1}function Pg(n,t){return((n=n.x)[0]<0?n[1]-pn-Ot:pn-n[1])-((t=t.x)[0]<0?t[1]-pn-Ot:pn-t[1])}const wc=Wh(function(){return!0},Rg,Ag,[-xt,-pn]);function Rg(n){var t=NaN,e=NaN,r=NaN,i;return{lineStart:function(){n.lineStart(),i=1},point:function(s,o){var a=s>0?xt:-xt,u=Ie(s-t);Ie(u-xt)<Ot?(n.point(t,e=(e+o)/2>0?pn:-pn),n.point(r,e),n.lineEnd(),n.lineStart(),n.point(a,e),n.point(s,e),i=0):r!==a&&u>=xt&&(Ie(t-r)<Ot&&(t-=r*Ot),Ie(s-a)<Ot&&(s-=a*Ot),e=Lg(t,e,s,o),n.point(r,e),n.lineEnd(),n.lineStart(),n.point(a,e),i=0),n.point(t=s,e=o),r=a},lineEnd:function(){n.lineEnd(),t=e=NaN},clean:function(){return 2-i}}}function Lg(n,t,e,r){var i,s,o=Zt(n-e);return Ie(o)>Ot?_g((Zt(t)*(s=Yt(r))*Zt(e)-Zt(r)*(i=Yt(t))*Zt(n))/(i*s*o)):(t+r)/2}function Ag(n,t,e,r){var i;if(n==null)i=e*pn,r.point(-xt,i),r.point(0,i),r.point(xt,i),r.point(xt,0),r.point(xt,-i),r.point(0,-i),r.point(-xt,-i),r.point(-xt,0),r.point(-xt,i);else if(Ie(n[0]-t[0])>Ot){var s=n[0]<t[0]?xt:-xt;i=e*s/2,r.point(-s,i),r.point(0,i),r.point(s,i)}else r.point(t[0],t[1])}function Og(n,t){var e=Yt(n),r=e>0,i=Ie(e)>Ot;function s(c,h,f,p){xg(p,n,t,f,c,h)}function o(c,h){return Yt(c)*Yt(h)>e}function a(c){var h,f,p,d,_;return{lineStart:function(){d=p=!1,_=1},point:function(w,y){var x=[w,y],g,m=o(w,y),E=r?m?0:l(w,y):m?l(w+(w<0?xt:-xt),y):0;if(!h&&(d=p=m)&&c.lineStart(),m!==p&&(g=u(h,x),(!g||pa(h,g)||pa(x,g))&&(x[0]+=Ot,x[1]+=Ot,m=o(x[0],x[1]))),m!==p)_=0,m?(c.lineStart(),g=u(x,h),c.point(g[0],g[1])):(g=u(h,x),c.point(g[0],g[1]),c.lineEnd()),h=g;else if(i&&h&&r^m){var N;!(E&f)&&(N=u(x,h,!0))&&(_=0,r?(c.lineStart(),c.point(N[0][0],N[0][1]),c.point(N[1][0],N[1][1]),c.lineEnd()):(c.point(N[1][0],N[1][1]),c.lineEnd(),c.lineStart(),c.point(N[0][0],N[0][1])))}m&&(!h||!pa(h,x))&&c.point(x[0],x[1]),h=x,p=m,f=E},lineEnd:function(){p&&c.lineEnd(),h=null},clean:function(){return _|(d&&p)<<1}}}function u(c,h,f){var p=ws(c),d=ws(h),_=[1,0,0],w=ba(p,d),y=Vo(w,w),x=w[0],g=y-x*x;if(!g)return!f&&c;var m=e*y/g,E=-e*x/g,N=ba(_,w),b=qo(_,m),S=qo(w,E);Tu(b,S);var v=N,I=Vo(b,v),T=Vo(v,v),A=I*I-T*(Vo(b,b)-1);if(!(A<0)){var K=As(A),O=qo(v,(-I-K)/T);if(Tu(O,b),O=Hu(O),!f)return O;var j=c[0],q=h[0],yt=c[1],Et=h[1],Pt;q<j&&(Pt=j,j=q,q=Pt);var bt=q-j,Qt=Ie(bt-xt)<Ot,$=Qt||bt<Ot;if(!Qt&&Et<yt&&(Pt=yt,yt=Et,Et=Pt),$?Qt?yt+Et>0^O[1]<(Ie(O[0]-j)<Ot?yt:Et):yt<=O[1]&&O[1]<=Et:bt>xt^(j<=O[0]&&O[0]<=q)){var Nt=qo(v,(-I+K)/T);return Tu(Nt,b),[O,Hu(Nt)]}}}function l(c,h){var f=r?n:xt-n,p=0;return c<-f?p|=1:c>f&&(p|=2),h<-f?p|=4:h>f&&(p|=8),p}return Wh(o,a,s,r?[0,-n]:[-xt,n-xt])}function Xh(n){return function(t){var e=new Qu;for(var r in n)e[r]=n[r];return e.stream=t,e}}function Qu(){}Qu.prototype={constructor:Qu,point:function(n,t){this.stream.point(n,t)},sphere:function(){this.stream.sphere()},lineStart:function(){this.stream.lineStart()},lineEnd:function(){this.stream.lineEnd()},polygonStart:function(){this.stream.polygonStart()},polygonEnd:function(){this.stream.polygonEnd()}};function Yh(n,t,e){var r=t[1][0]-t[0][0],i=t[1][1]-t[0][1],s=n.clipExtent&&n.clipExtent();n.scale(150).translate([0,0]),s!=null&&n.clipExtent(null),wg(e,n.stream(_c));var o=_c.result(),a=Math.min(r/(o[1][0]-o[0][0]),i/(o[1][1]-o[0][1])),u=+t[0][0]+(r-a*(o[1][0]+o[0][0]))/2,l=+t[0][1]+(i-a*(o[1][1]+o[0][1]))/2;return s!=null&&n.clipExtent(s),n.scale(a*150).translate([u,l])}function Dg(n,t,e){return Yh(n,[[0,0],t],e)}var Ec=16,Fg=Yt(30*xr);function xc(n,t){return+t?Gg(n,t):kg(n)}function kg(n){return Xh({point:function(t,e){t=n(t,e),this.stream.point(t[0],t[1])}})}function Gg(n,t){function e(r,i,s,o,a,u,l,c,h,f,p,d,_,w){var y=l-r,x=c-i,g=y*y+x*x;if(g>4*t&&_--){var m=o+f,E=a+p,N=u+d,b=As(m*m+E*E+N*N),S=Oi(N/=b),v=Ie(Ie(N)-1)<Ot||Ie(s-h)<Ot?(s+h)/2:_s(E,m),I=n(v,S),T=I[0],A=I[1],K=T-r,O=A-i,j=x*K-y*O;(j*j/g>t||Ie((y*K+x*O)/g-.5)>.3||o*f+a*p+u*d<Fg)&&(e(r,i,s,o,a,u,T,A,v,m/=b,E/=b,N,_,w),w.point(T,A),e(T,A,v,m,E,N,l,c,h,f,p,d,_,w))}}return function(r){var i,s,o,a,u,l,c,h,f,p,d,_,w={point:y,lineStart:x,lineEnd:m,polygonStart:function(){r.polygonStart(),w.lineStart=E},polygonEnd:function(){r.polygonEnd(),w.lineStart=x}};function y(S,v){S=n(S,v),r.point(S[0],S[1])}function x(){h=NaN,w.point=g,r.lineStart()}function g(S,v){var I=ws([S,v]),T=n(S,v);e(h,f,c,p,d,_,h=T[0],f=T[1],c=S,p=I[0],d=I[1],_=I[2],Ec,r),r.point(h,f)}function m(){w.point=y,r.lineEnd()}function E(){x(),w.point=N,w.lineEnd=b}function N(S,v){g(i=S,v),s=h,o=f,a=p,u=d,l=_,w.point=g}function b(){e(h,f,c,p,d,_,s,o,i,a,u,l,Ec,r),w.lineEnd=m,m()}return w}}var Bg=Xh({point:function(n,t){this.stream.point(n*xr,t*xr)}});function zg(n){return Ug(function(){return n})()}function Ug(n){var t,e=150,r=480,i=250,s,o,a=0,u=0,l=0,c=0,h=0,f,p,d=null,_=wc,w=null,y,x,g,m=yc,E=.5,N=xc(T,E),b,S;function v(O){return O=p(O[0]*xr,O[1]*xr),[O[0]*e+s,o-O[1]*e]}function I(O){return O=p.invert((O[0]-s)/e,(o-O[1])/e),O&&[O[0]*Qn,O[1]*Qn]}function T(O,j){return O=t(O,j),[O[0]*e+s,o-O[1]*e]}v.stream=function(O){return b&&S===O?b:b=Bg(_(f,N(m(S=O))))},v.clipAngle=function(O){return arguments.length?(_=+O?Og(d=O*xr,6*xr):(d=null,wc),K()):d*Qn},v.clipExtent=function(O){return arguments.length?(m=O==null?(w=y=x=g=null,yc):bg(w=+O[0][0],y=+O[0][1],x=+O[1][0],g=+O[1][1]),K()):w==null?null:[[w,y],[x,g]]},v.scale=function(O){return arguments.length?(e=+O,A()):e},v.translate=function(O){return arguments.length?(r=+O[0],i=+O[1],A()):[r,i]},v.center=function(O){return arguments.length?(a=O[0]%360*xr,u=O[1]%360*xr,A()):[a*Qn,u*Qn]},v.rotate=function(O){return arguments.length?(l=O[0]%360*xr,c=O[1]%360*xr,h=O.length>2?O[2]%360*xr:0,A()):[l*Qn,c*Qn,h*Qn]},v.precision=function(O){return arguments.length?(N=xc(T,E=O*O),K()):As(E)},v.fitExtent=function(O,j){return Yh(v,O,j)},v.fitSize=function(O,j){return Dg(v,O,j)};function A(){p=zh(f=Eg(l,c,h),t);var O=t(a,u);return s=r-O[0]*e,o=i+O[1]*e,K()}function K(){return b=S=null,v}return function(){return t=n.apply(this,arguments),v.invert=t.invert&&I,A()}}function Zh(n){return function(t,e){var r=Yt(t),i=Yt(e),s=n(r*i);return[s*i*Zt(t),s*Zt(e)]}}function Hh(n){return function(t,e){var r=As(t*t+e*e),i=n(r),s=Zt(i),o=Yt(i);return[_s(t*s,r*o),Oi(r&&e*s/r)]}}var jg=Zh(function(n){return As(2/(1+n))});jg.invert=Hh(function(n){return 2*Oi(n/2)});var Kh=Zh(function(n){return(n=Bh(n))&&n/Zt(n)});Kh.invert=Hh(function(n){return n});function Vg(){return zg(Kh).scale(79.4188).clipAngle(180-.001)}function Ic(n,t){return[n,t]}Ic.invert=Ic;function qg(n,t,e){e=e||{};var r=e.units||"kilometers",i=e.steps||8;if(!n)throw new Error("geojson is required");if(typeof e!="object")throw new Error("options must be an object");if(typeof i!="number")throw new Error("steps must be an number");if(t===void 0)throw new Error("radius is required");if(i<=0)throw new Error("steps must be greater than 0");var s=[];switch(n.type){case"GeometryCollection":return hh(n,function(o){var a=ga(o,t,r,i);a&&s.push(a)}),Xu(s);case"FeatureCollection":return nc(n,function(o){var a=ga(o,t,r,i);a&&nc(a,function(u){u&&s.push(u)})}),Xu(s)}return ga(n,t,r,i)}function ga(n,t,e,r){var i=n.properties||{},s=n.type==="Feature"?n.geometry:n;if(s.type==="GeometryCollection"){var o=[];return hh(n,function(_){var w=ga(_,t,e,r);w&&o.push(w)}),Xu(o)}var a=Wg(s),u={type:s.type,coordinates:Qh(s.coordinates,a)},l=new El,c=l.read(u),h=Kp(Jp(t,e),"meters"),f=ae.bufferOp(c,h,r),p=new Eh;if(f=p.write(f),!Jh(f.coordinates)){var d={type:f.type,coordinates:$h(f.coordinates,a)};return Qp(d,i)}}function Jh(n){return Array.isArray(n[0])?Jh(n[0]):isNaN(n[0])}function Qh(n,t){return typeof n[0]!="object"?t(n):n.map(function(e){return Qh(e,t)})}function $h(n,t){return typeof n[0]!="object"?t.invert(n):n.map(function(e){return $h(e,t)})}function Wg(n){var t=eg(n).geometry.coordinates,e=[-t[0],-t[1]];return Vg().rotate(e).scale($p)}function $i(n,t){const e=t[0],r=t[1];return[n[0]*e+n[2]*r+n[4],n[1]*e+n[3]*r+n[5]]}function Xg(){return[1,0,0,1,0,0]}function Yg(n,t){const e=n[0],r=n[1],i=n[2],s=n[3],o=n[4],a=n[5],u=t[0],l=t[1],c=t[2],h=t[3],f=t[4],p=t[5];return[e*u+i*l,r*u+s*l,e*c+i*h,r*c+s*h,e*f+i*p+o,r*f+s*p+a]}function Cc(n,t,e,r,i,s,o){const a=Math.sin(i),u=Math.cos(i);return[e*u,r*a,-e*a,r*u,s*e*u-o*e*a+n,s*r*a+o*r*u+t]}function Zg(n){const t=Hg(n),e=n[0],r=n[1],i=n[2],s=n[3],o=n[4],a=n[5];return[s/t,-r/t,-i/t,e/t,(i*a-s*o)/t,-(e*a-r*o)/t]}function Hg(n){return n[0]*n[3]-n[1]*n[2]}function Kg(n){const t=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1];return t[0]=n[0],t[1]=n[1],t[4]=n[2],t[5]=n[3],t[12]=n[4],t[13]=n[5],t}async function tf(n,t,e){let r;if(typeof e=="function"?r=await e(n,t):r=await fetch(n,t),!r.ok)throw new Error(r.statusText);return r}async function Jg(n,t,e){return await(await tf(n,t,e)).json()}async function Qg(n,t,e){return await Jg(`${n}/info.json`,t,e)}function ef(n,t=!1){switch(n.type){case"Polygon":return n.coordinates?{...n,coordinates:Sc(n.coordinates,t)}:n;case"MultiPolygon":return n.coordinates?{...n,coordinates:n.coordinates.map(e=>Sc(e,t))}:n;case"GeometryCollection":return{...n,geometries:n.geometries.map(e=>ef(e,t))};default:return n}}function Sc(n,t){if(n.length===0)return n;const e=[];for(let r=0;r<n.length;r++)e.push($g(n[r],r===0?t:!t));return e}function $g(n,t){let e=0,r=0;for(let i=0,s=n.length,o=s-1;i<s;o=i++){const a=(n[i][0]-n[o][0])*(n[o][1]+n[i][1]),u=e+a;r+=Math.abs(e)>=Math.abs(a)?e-u+a:a-u+e,e=u}return e+r>=0!=!!t?n.slice().reverse():n}function je(n){return Array.isArray(n)&&n.length===2&&typeof n[0]=="number"&&typeof n[1]=="number"}function Vr(n){return Array.isArray(n)&&n.every(je)}function td(n){return Array.isArray(n)&&n.every(je)}function qr(n){return Array.isArray(n)&&n.every(td)}function Mn(n){return Array.isArray(n)&&n.every(je)}function Nn(n){return Array.isArray(n)&&n.every(Vr)}function Tn(n){return Array.isArray(n)&&n.every(qr)}function lu(n){if(n=n.filter(function(t,e,r){return e===0||!Rl(t,r[e-1])}),n.length<2)throw new Error("LineString should contain at least 2 points");return n}function Pl(n){if(n=n.filter(function(t,e,r){return e===0||!Rl(t,r[e-1])}),nd(n)&&n.splice(-1),n.length<3)throw new Error("Ring should contain at least 3 points");return n}function rf(n){return n.map(t=>Pl(t))}function ed(n){return n.map(t=>lu(t))}function rd(n){return n.map(t=>rf(t))}function Yo(n){return{type:"Point",coordinates:n}}function Zo(n){return{type:"LineString",coordinates:n}}function Ho(n,t=!0){const e={type:"Polygon",coordinates:t?n.map(r=>[...r,r[0]]):n};return ef(e)}function nd(n){return Array.isArray(n)&&n.length>=2&&Rl(n[0],n[n.length-1])}function Rl(n,t){return n===t?!0:n===null||t===null?!1:n[0]===t[0]&&n[1]===t[1]}function id(n){return[n[0],-n[1]]}function Ta(n,t){return[(t[0]-n[0])/2+n[0],(t[1]-n[1])/2+n[1]]}function sd(n,t,e){return n*e+t*(1-e)}function od(n,t,e){return[n[0]*e+t[0]*(1-e),n[1]*e+t[1]*(1-e)]}function ar(n,t){if(Vr(n)&&n.length===2)return ar(n[0],n[1]);if(je(n)&&je(t))return Math.sqrt((t[0]-n[0])**2+(t[1]-n[1])**2);throw new Error("Input type not supported")}function ad(n){return n*(Math.PI/180)}function Pn(n){return typeof n=="object"&&n!==null&&n.type==="Point"&&je(n.coordinates)}function Rn(n){return typeof n=="object"&&n!==null&&n.type==="LineString"&&Vr(n.coordinates)}function Ln(n){return typeof n=="object"&&n!==null&&n.type==="Polygon"&&Array.isArray(n.coordinates)&&qr(n.coordinates)}function An(n){return typeof n=="object"&&n!==null&&n.type==="MultiPoint"&&Mn(n.coordinates)}function On(n){return typeof n=="object"&&n!==null&&n.type==="MultiLineString"&&Nn(n.coordinates)}function Dn(n){return typeof n=="object"&&n!==null&&n.type==="MultiPolygon"&&Array.isArray(n.coordinates)&&Tn(n.coordinates)}function ud(n){const t=typeof n=="object"&&n!==null,e=t&&"type"in n&&typeof n.type=="string"&&(n.type==="Point"||n.type==="LineString"||n.type==="Polygon"||n.type==="MultiPoint"||n.type==="MultiLineString"||n.type==="MultiPolygon"),r=t&&"coordinates"in n&&Array.isArray(n.coordinates);return e&&r}function Vs(n){return n.coordinates}function qs(n){return lu(n.coordinates)}function Ws(n,t=!1){let e=n.coordinates;return e=rf(e),t?e.map(r=>[...r,r[0]]):e}function ld(n){return n.coordinates}function cd(n){return ed(n.coordinates)}function hd(n,t=!1){let e=n.coordinates;return e=rd(e),t?e.map(r=>r.map(i=>[...i,i[0]])):e}function fd(n){if(Pn(n))return Vs(n);if(Rn(n))return qs(n);if(Ln(n))return Ws(n);if(An(n))return ld(n);if(On(n))return cd(n);if(Dn(n))return hd(n);throw new Error("Geometry type not supported")}function Ko(n){return n.coordinates.map(t=>({type:"Point",coordinates:t}))}function Jo(n){return n.coordinates.map(t=>({type:"LineString",coordinates:t}))}function Qo(n){return n.coordinates.map(t=>({type:"Polygon",coordinates:t}))}function $o(n){return{type:"MultiPoint",coordinates:n.map(t=>t.coordinates)}}function ta(n){return{type:"MultiLineString",coordinates:n.map(t=>t.coordinates)}}function ea(n){return{type:"MultiPolygon",coordinates:n.map(t=>t.coordinates)}}function pd(n,t){return{type:"Feature",properties:t||{},geometry:n}}function gd(n,t){return{type:"FeatureCollection",features:n.map((e,r)=>pd(e))}}function dd(n){return n.geometry}function md(n){return n.features.map(dd)}function bc(n){let t=Number.POSITIVE_INFINITY,e=Number.NEGATIVE_INFINITY;for(const r of n)t===void 0?r>=r&&(t=e=r):(t>r&&(t=r),e<r&&(e=r));return[t,e]}function De(n){if(je(n)&&(n=[n]),qr(n)&&(n=n.flat()),ud(n))return De(fd(n));const t=[],e=[];for(const a of n)t.push(a[0]),e.push(a[1]);const[r,i]=bc(t),[s,o]=bc(e);return[r,s,i,o]}function Mc(n,t){return[Math.min(n[0],t[0]),Math.min(n[1],t[1]),Math.max(n[2],t[2]),Math.max(n[3],t[3])]}function vd(n,t){const e=n[2]>=t[0]&&t[2]>=n[0],r=n[3]>=t[1]&&t[3]>=n[1];return e&&r}function Pa(n){return[[n[0],n[1]],[n[2],n[1]],[n[2],n[3]],[n[0],n[3]]]}function nf(n){return[[n[0],n[1]],[n[2],n[3]]]}function yd(n){return ar(nf(n))}function _d(n){return ar(nf(De(n)))}function xs(n){return[(n[0]+n[2])/2,(n[1]+n[3])/2]}function Ru(n){return[n[2]-n[0],n[3]-n[1]]}function $u(n){return[.5*(ar(n[0],n[1])+ar(n[2],n[3])),.5*(ar(n[1],n[2])+ar(n[3],n[0]))]}function Ra(n,t,e){return e?e==="contain"?t[0]>=t[1]?n[0]/t[0]:n[1]/t[1]:t[0]>=t[1]?n[1]/t[1]:n[0]/t[0]:Math.sqrt(n[0]*n[1]/(t[0]*t[1]))}function Nc(n,t){return Ra($u(n),$u(t))}function da(n,t,e,r=!0){if(n.has(t)&&r)return n.get(t);{const i=e();return n.set(t,i),i}}function Lu(n,t,e,r,i=!0){var s,o,a;if((s=n.get(t))!=null&&s.has(e)&&i)return(o=n.get(t))==null?void 0:o.get(e);{const u=r();return n.get(t)||n.set(t,new Map),(a=n.get(t))==null||a.set(e,u),u}}function wd(n){const t=parseInt(n.replace(/^#/,""),16),e=t>>16&255,r=t>>8&255,i=t&255;return[e,r,i]}function ra(n){return wd(n).map(t=>t/255)}function Ed(n,t){return!n||!t||n.size!==t.size?!1:[...n].every(e=>t.has(e))}function Tc(n,t){if(n!==void 0&&t!==void 0)return Math.max(n,t);if(n!==void 0)return n;if(t!==void 0)return t}function xd(n,t){t===void 0&&(t={});var e=t.offsetLine||0,r=t.offsetColumn||0,i=n.split(`
`),s=0,o=i.map(function(h,f){var p=s+h.length+1,d={start:s,end:p,line:f};return s=p,d}),a=0;function u(h,f){return h.start<=f&&f<h.end}function l(h,f){return{line:e+h.line,column:r+f-h.start,character:f}}function c(h,f){typeof h=="string"&&(h=n.indexOf(h,f||0));for(var p=o[a],d=h>=p.end?1:-1;p;){if(u(p,h))return l(p,h);a+=d,p=o[a]}}return c}function Id(n,t,e){return xd(n,e)(t,e)}var Pc=/[a-zA-Z0-9:_-]/,Rc=/[\s\t\r\n]/,Cd=/['"]/;function Sd(n,t){for(var e="";t--;)e+=n;return e}function bd(n){var t="",e=[],r=a,i=null,s=null;function o(m){var E=Id(n,g),N=E.line,b=E.column,S=n.slice(0,g),v=/(^|\n).*$/.exec(S)[0].replace(/\t/g,"  "),I=n.slice(g),T=/.*(\n|$)/.exec(I)[0],A=""+v+T+`
`+Sd(" ",v.length)+"^";throw new Error(m+" ("+N+":"+b+`). If this is valid SVG, it's probably a bug in svg-parser. Please raise an issue at https://github.com/Rich-Harris/svg-parser/issues – thanks!

`+A)}function a(){for(;g<n.length&&n[g]!=="<"||!Pc.test(n[g+1]);)t+=n[g++];return u()}function u(){for(var m="";g<n.length&&n[g]!=="<";)m+=n[g++];return/\S/.test(m)&&i.children.push({type:"text",value:m}),n[g]==="<"?l:u}function l(){var m=n[g];if(m==="?")return u;if(m==="!"){if(n.slice(g+1,g+3)==="--")return c;if(n.slice(g+1,g+8)==="[CDATA[")return h;if(/doctype/i.test(n.slice(g+1,g+8)))return u}if(m==="/")return f;var E=p(),N={type:"element",tagName:E,properties:{},children:[]};i?i.children.push(N):s=N;for(var b;g<n.length&&(b=d());)N.properties[b.name]=b.value;var S=!1;return n[g]==="/"&&(g+=1,S=!0),n[g]!==">"&&o("Expected >"),S||(i=N,e.push(N)),u}function c(){var m=n.indexOf("-->",g);return~m||o("expected -->"),g=m+2,u}function h(){var m=n.indexOf("]]>",g);return~m||o("expected ]]>"),i.children.push(n.slice(g+7,m)),g=m+2,u}function f(){var m=p();return m||o("Expected tag name"),m!==i.tagName&&o("Expected closing tag </"+m+"> to match opening tag <"+i.tagName+">"),x(),n[g]!==">"&&o("Expected >"),e.pop(),i=e[e.length-1],u}function p(){for(var m="";g<n.length&&Pc.test(n[g]);)m+=n[g++];return m}function d(){if(!Rc.test(n[g]))return null;x();var m=p();if(!m)return null;var E=!0;return x(),n[g]==="="&&(g+=1,x(),E=_(),!isNaN(E)&&E.trim()!==""&&(E=+E)),{name:m,value:E}}function _(){return Cd.test(n[g])?y():w()}function w(){var m="";do{var E=n[g];if(E===" "||E===">"||E==="/")return m;m+=E,g+=1}while(g<n.length);return m}function y(){for(var m=n[g++],E="",N=!1;g<n.length;){var b=n[g++];if(b===m&&!N)return E;b==="\\"&&!N&&(N=!0),E+=N?"\\"+b:b,N=!1}}function x(){for(;g<n.length&&Rc.test(n[g]);)g+=1}for(var g=a.length;g<n.length;)r||o("Unexpected character"),r=r(),g+=1;return r!==u&&o("Unexpected end of input"),s.tagName==="svg"&&(s.metadata=t),{type:"root",children:[s]}}function*Md(n){function*t(r){if("children"in r)for(const i of r.children)typeof i!="string"&&(yield*t(i));yield r}const e=bd(n);for(const r of t(e))if("tagName"in r&&r.tagName!=="svg"&&r.tagName!=="g"){const i=Nd(r);i&&(yield i)}}function Nd(n){var e;const t=(e=n==null?void 0:n.tagName)==null?void 0:e.toLowerCase();if(t==="circle")return{type:"circle",coordinates:[se(n,"cx"),se(n,"cy")]};if(t==="line")return{type:"line",coordinates:[[se(n,"x1"),se(n,"y1")],[se(n,"x2"),se(n,"y2")]]};if(t==="polyline")return{type:"polyline",coordinates:Lc(n)};if(t==="polygon")return{type:"polygon",coordinates:Lc(n)};if(t==="rect")return{type:"rect",coordinates:[[se(n,"x"),se(n,"y")],[se(n,"x")+se(n,"width"),se(n,"y")],[se(n,"x")+se(n,"width"),se(n,"y")+se(n,"height")],[se(n,"x"),se(n,"y")+se(n,"height")],[se(n,"x"),se(n,"y")]]};throw new Error(`Unsupported SVG element: ${t}`)}function se(n,t){var r;const e=(r=n==null?void 0:n.properties)==null?void 0:r[t];return Number(e)||0}function Lc(n){var e;const t=(e=n==null?void 0:n.properties)==null?void 0:e.points;return t?String(t).trim().split(/\s+/).map(r=>{const i=r.split(",").map(s=>Number(s));return[i[0],i[1]]}):[]}function Ac(n){return n.map(t=>t.join(",")).join(" ")}function Td(n){return`<svg xmlns="http://www.w3.org/2000/svg">
  ${n.map(Pd).join(`
`)}
</svg>`}function Pd(n){if(n.type==="circle")return ks("circle",{...n.attributes,cx:n.coordinates[0],cy:n.coordinates[1]});if(n.type==="line")return ks("line",{...n.attributes,x1:n.coordinates[0][0],y1:n.coordinates[0][1],x2:n.coordinates[1][0],y2:n.coordinates[1][1]});if(n.type==="polyline")return ks("polyline",{...n.attributes,points:Ac(n.coordinates)});if(n.type==="polygon")return ks("polygon",{...n.attributes,points:Ac(n.coordinates)});if(n.type==="rect")return ks("rect",{...n.attributes,x:n.coordinates[0][0],y:n.coordinates[0][1],width:n.coordinates[1][0]-n.coordinates[0][0],height:n.coordinates[2][1]-n.coordinates[0][1]});throw new Error("Unknown SVG element")}function ks(n,t){const e=Object.entries(t).map(([r,i])=>`${r}="${i}"`);return`<${n} ${e.join(" ")} />`}function Yi([n,t]){const e=6378137*ad(n),r=e/n,i=180/Math.PI*Math.log(Math.tan(Math.PI/4+t*(Math.PI/180)/2))*r;return[e,i]}function Oc([n,t]){const e=Math.PI*6378137,r=n/e*180;let i=t/e*180;return i=180/Math.PI*(2*Math.atan(Math.exp(i*Math.PI/180))-Math.PI/2),[r,i]}class La{constructor(t,e,r,i,s=1){M(this,"geoCenter");M(this,"geoRectangle");M(this,"geoSize");M(this,"geoRectangleBbox");M(this,"projectedGeoCenter");M(this,"projectedGeoRectangle");M(this,"projectedGeoSize");M(this,"projectedGeoRectangleBbox");M(this,"rotation");M(this,"projectedGeoPerViewportScale");M(this,"viewportCenter");M(this,"viewportRectangle");M(this,"viewportSize");M(this,"viewportBbox");M(this,"devicePixelRatio");M(this,"canvasCenter");M(this,"canvasRectangle");M(this,"canvasSize");M(this,"canvasBbox");M(this,"projectedGeoPerCanvasScale");M(this,"projectedGeoToViewportTransform",[1,0,0,1,0,0]);M(this,"projectedGeoToClipTransform",[1,0,0,1,0,0]);this.projectedGeoCenter=e,this.projectedGeoPerViewportScale=r,this.rotation=i,this.viewportSize=t,this.devicePixelRatio=s,this.projectedGeoRectangle=this.computeProjectedGeoRectangle(this.projectedGeoCenter,this.projectedGeoPerViewportScale,this.rotation,this.viewportSize),this.projectedGeoRectangleBbox=De(this.projectedGeoRectangle),this.projectedGeoSize=[this.viewportSize[0]*r,this.viewportSize[1]*r],this.geoCenter=Oc(this.projectedGeoCenter),this.geoRectangle=this.projectedGeoRectangle.map(o=>Oc(o)),this.geoRectangleBbox=De(this.geoRectangle),this.geoSize=Ru(this.geoRectangleBbox),this.viewportCenter=[this.viewportSize[0]/2,this.viewportSize[1]/2],this.viewportBbox=[0,0,...this.viewportSize],this.viewportRectangle=Pa(this.viewportBbox),this.canvasCenter=[this.viewportCenter[0]*this.devicePixelRatio,this.viewportSize[1]*this.devicePixelRatio],this.canvasSize=[this.viewportSize[0]*this.devicePixelRatio,this.viewportSize[1]*this.devicePixelRatio],this.canvasBbox=[0,0,...this.canvasSize],this.canvasRectangle=Pa(this.canvasBbox),this.projectedGeoPerCanvasScale=this.projectedGeoPerViewportScale/this.devicePixelRatio,this.projectedGeoToViewportTransform=this.composeProjectedGeoToViewportTransform(),this.projectedGeoToClipTransform=this.composeProjectedGeoToClipTransform()}static fromWarpedMapList(t,e,r,i="contain",s=1){const o=e.getProjectedCenter(),a=e.getProjectedBbox();if(!o||!a)throw new Error("WarpedMapList has no projected center or bbox");const u=Ru(a),l=Ra(u,t,i)*(1/s);return new La(t,o,l,0,r)}static fromProjectedGeoBbox(t,e,r,i="contain"){const s=xs(e),o=Ru(e),a=Ra(o,t,i);return new La(t,s,a,0,r)}composeProjectedGeoToViewportTransform(){return Cc(this.viewportSize[0]/2,this.viewportSize[1]/2,1/this.projectedGeoPerViewportScale,-1/this.projectedGeoPerViewportScale,-this.rotation,-this.projectedGeoCenter[0],-this.projectedGeoCenter[1])}composeProjectedGeoToClipTransform(){return Cc(0,0,2/(this.projectedGeoPerViewportScale*this.viewportSize[0]),2/(this.projectedGeoPerViewportScale*this.viewportSize[1]),-this.rotation,-this.projectedGeoCenter[0],-this.projectedGeoCenter[1])}computeProjectedGeoRectangle(t,e,r,i){const s=e*i[0]/2,o=e*i[1]/2,a=Math.cos(r),u=Math.sin(r),l=s*a,c=s*u,h=o*a,f=o*u,p=t[0],d=t[1];return[[p-l+f,d-c-h],[p-l-f,d-c+h],[p+l-f,d+c+h],[p+l+f,d+c-h]]}}function tl(n){return Array.isArray(n)?`[${n.map(t=>tl(t)).join(",")}]`:typeof n=="number"?`${n}`:typeof n=="string"?`"${n}"`:typeof n=="object"&&n!==null?Object.keys(n).sort().map(t=>`${t}:${tl(n[t])}`).join("|"):String(n)}async function Rd(n){const t=await crypto.subtle.digest("SHA-1",new TextEncoder().encode(n));return Array.from(new Uint8Array(t)).map(e=>e.toString(16).padStart(2,"0")).join("")}async function sf(n,t=16){return(await Rd(String(n))).slice(0,t)}async function Ld(n,t){return await sf(tl(n),t)}var _t;(function(n){n.assertEqual=i=>i;function t(i){}n.assertIs=t;function e(i){throw new Error}n.assertNever=e,n.arrayToEnum=i=>{const s={};for(const o of i)s[o]=o;return s},n.getValidEnumValues=i=>{const s=n.objectKeys(i).filter(a=>typeof i[i[a]]!="number"),o={};for(const a of s)o[a]=i[a];return n.objectValues(o)},n.objectValues=i=>n.objectKeys(i).map(function(s){return i[s]}),n.objectKeys=typeof Object.keys=="function"?i=>Object.keys(i):i=>{const s=[];for(const o in i)Object.prototype.hasOwnProperty.call(i,o)&&s.push(o);return s},n.find=(i,s)=>{for(const o of i)if(s(o))return o},n.isInteger=typeof Number.isInteger=="function"?i=>Number.isInteger(i):i=>typeof i=="number"&&isFinite(i)&&Math.floor(i)===i;function r(i,s=" | "){return i.map(o=>typeof o=="string"?`'${o}'`:o).join(s)}n.joinValues=r,n.jsonStringifyReplacer=(i,s)=>typeof s=="bigint"?s.toString():s})(_t||(_t={}));var el;(function(n){n.mergeShapes=(t,e)=>({...t,...e})})(el||(el={}));const V=_t.arrayToEnum(["string","nan","number","integer","float","boolean","date","bigint","symbol","function","undefined","null","array","object","unknown","promise","void","never","map","set"]),ti=n=>{switch(typeof n){case"undefined":return V.undefined;case"string":return V.string;case"number":return isNaN(n)?V.nan:V.number;case"boolean":return V.boolean;case"function":return V.function;case"bigint":return V.bigint;case"symbol":return V.symbol;case"object":return Array.isArray(n)?V.array:n===null?V.null:n.then&&typeof n.then=="function"&&n.catch&&typeof n.catch=="function"?V.promise:typeof Map<"u"&&n instanceof Map?V.map:typeof Set<"u"&&n instanceof Set?V.set:typeof Date<"u"&&n instanceof Date?V.date:V.object;default:return V.unknown}},F=_t.arrayToEnum(["invalid_type","invalid_literal","custom","invalid_union","invalid_union_discriminator","invalid_enum_value","unrecognized_keys","invalid_arguments","invalid_return_type","invalid_date","invalid_string","too_small","too_big","invalid_intersection_types","not_multiple_of","not_finite"]),Ad=n=>JSON.stringify(n,null,2).replace(/"([^"]+)":/g,"$1:");class cr extends Error{constructor(t){super(),this.issues=[],this.addIssue=r=>{this.issues=[...this.issues,r]},this.addIssues=(r=[])=>{this.issues=[...this.issues,...r]};const e=new.target.prototype;Object.setPrototypeOf?Object.setPrototypeOf(this,e):this.__proto__=e,this.name="ZodError",this.issues=t}get errors(){return this.issues}format(t){const e=t||function(s){return s.message},r={_errors:[]},i=s=>{for(const o of s.issues)if(o.code==="invalid_union")o.unionErrors.map(i);else if(o.code==="invalid_return_type")i(o.returnTypeError);else if(o.code==="invalid_arguments")i(o.argumentsError);else if(o.path.length===0)r._errors.push(e(o));else{let a=r,u=0;for(;u<o.path.length;){const l=o.path[u];u===o.path.length-1?(a[l]=a[l]||{_errors:[]},a[l]._errors.push(e(o))):a[l]=a[l]||{_errors:[]},a=a[l],u++}}};return i(this),r}static assert(t){if(!(t instanceof cr))throw new Error(`Not a ZodError: ${t}`)}toString(){return this.message}get message(){return JSON.stringify(this.issues,_t.jsonStringifyReplacer,2)}get isEmpty(){return this.issues.length===0}flatten(t=e=>e.message){const e={},r=[];for(const i of this.issues)i.path.length>0?(e[i.path[0]]=e[i.path[0]]||[],e[i.path[0]].push(t(i))):r.push(t(i));return{formErrors:r,fieldErrors:e}}get formErrors(){return this.flatten()}}cr.create=n=>new cr(n);const Is=(n,t)=>{let e;switch(n.code){case F.invalid_type:n.received===V.undefined?e="Required":e=`Expected ${n.expected}, received ${n.received}`;break;case F.invalid_literal:e=`Invalid literal value, expected ${JSON.stringify(n.expected,_t.jsonStringifyReplacer)}`;break;case F.unrecognized_keys:e=`Unrecognized key(s) in object: ${_t.joinValues(n.keys,", ")}`;break;case F.invalid_union:e="Invalid input";break;case F.invalid_union_discriminator:e=`Invalid discriminator value. Expected ${_t.joinValues(n.options)}`;break;case F.invalid_enum_value:e=`Invalid enum value. Expected ${_t.joinValues(n.options)}, received '${n.received}'`;break;case F.invalid_arguments:e="Invalid function arguments";break;case F.invalid_return_type:e="Invalid function return type";break;case F.invalid_date:e="Invalid date";break;case F.invalid_string:typeof n.validation=="object"?"includes"in n.validation?(e=`Invalid input: must include "${n.validation.includes}"`,typeof n.validation.position=="number"&&(e=`${e} at one or more positions greater than or equal to ${n.validation.position}`)):"startsWith"in n.validation?e=`Invalid input: must start with "${n.validation.startsWith}"`:"endsWith"in n.validation?e=`Invalid input: must end with "${n.validation.endsWith}"`:_t.assertNever(n.validation):n.validation!=="regex"?e=`Invalid ${n.validation}`:e="Invalid";break;case F.too_small:n.type==="array"?e=`Array must contain ${n.exact?"exactly":n.inclusive?"at least":"more than"} ${n.minimum} element(s)`:n.type==="string"?e=`String must contain ${n.exact?"exactly":n.inclusive?"at least":"over"} ${n.minimum} character(s)`:n.type==="number"?e=`Number must be ${n.exact?"exactly equal to ":n.inclusive?"greater than or equal to ":"greater than "}${n.minimum}`:n.type==="date"?e=`Date must be ${n.exact?"exactly equal to ":n.inclusive?"greater than or equal to ":"greater than "}${new Date(Number(n.minimum))}`:e="Invalid input";break;case F.too_big:n.type==="array"?e=`Array must contain ${n.exact?"exactly":n.inclusive?"at most":"less than"} ${n.maximum} element(s)`:n.type==="string"?e=`String must contain ${n.exact?"exactly":n.inclusive?"at most":"under"} ${n.maximum} character(s)`:n.type==="number"?e=`Number must be ${n.exact?"exactly":n.inclusive?"less than or equal to":"less than"} ${n.maximum}`:n.type==="bigint"?e=`BigInt must be ${n.exact?"exactly":n.inclusive?"less than or equal to":"less than"} ${n.maximum}`:n.type==="date"?e=`Date must be ${n.exact?"exactly":n.inclusive?"smaller than or equal to":"smaller than"} ${new Date(Number(n.maximum))}`:e="Invalid input";break;case F.custom:e="Invalid input";break;case F.invalid_intersection_types:e="Intersection results could not be merged";break;case F.not_multiple_of:e=`Number must be a multiple of ${n.multipleOf}`;break;case F.not_finite:e="Number must be finite";break;default:e=t.defaultError,_t.assertNever(n)}return{message:e}};let of=Is;function Od(n){of=n}function Aa(){return of}const Oa=n=>{const{data:t,path:e,errorMaps:r,issueData:i}=n,s=[...e,...i.path||[]],o={...i,path:s};if(i.message!==void 0)return{...i,path:s,message:i.message};let a="";const u=r.filter(l=>!!l).slice().reverse();for(const l of u)a=l(o,{data:t,defaultError:a}).message;return{...i,path:s,message:a}},Dd=[];function U(n,t){const e=Aa(),r=Oa({issueData:t,data:n.data,path:n.path,errorMaps:[n.common.contextualErrorMap,n.schemaErrorMap,e,e===Is?void 0:Is].filter(i=>!!i)});n.common.issues.push(r)}class Ue{constructor(){this.value="valid"}dirty(){this.value==="valid"&&(this.value="dirty")}abort(){this.value!=="aborted"&&(this.value="aborted")}static mergeArray(t,e){const r=[];for(const i of e){if(i.status==="aborted")return rt;i.status==="dirty"&&t.dirty(),r.push(i.value)}return{status:t.value,value:r}}static async mergeObjectAsync(t,e){const r=[];for(const i of e){const s=await i.key,o=await i.value;r.push({key:s,value:o})}return Ue.mergeObjectSync(t,r)}static mergeObjectSync(t,e){const r={};for(const i of e){const{key:s,value:o}=i;if(s.status==="aborted"||o.status==="aborted")return rt;s.status==="dirty"&&t.dirty(),o.status==="dirty"&&t.dirty(),s.value!=="__proto__"&&(typeof o.value<"u"||i.alwaysSet)&&(r[s.value]=o.value)}return{status:t.value,value:r}}}const rt=Object.freeze({status:"aborted"}),Da=n=>({status:"dirty",value:n}),Ke=n=>({status:"valid",value:n}),rl=n=>n.status==="aborted",nl=n=>n.status==="dirty",ho=n=>n.status==="valid",fo=n=>typeof Promise<"u"&&n instanceof Promise;function Fa(n,t,e,r){if(typeof t=="function"?n!==t||!r:!t.has(n))throw new TypeError("Cannot read private member from an object whose class did not declare it");return t.get(n)}function af(n,t,e,r,i){if(typeof t=="function"?n!==t||!i:!t.has(n))throw new TypeError("Cannot write private member to an object whose class did not declare it");return t.set(n,e),e}var Z;(function(n){n.errToObj=t=>typeof t=="string"?{message:t}:t||{},n.toString=t=>typeof t=="string"?t:t==null?void 0:t.message})(Z||(Z={}));var Xs,Ys;class xn{constructor(t,e,r,i){this._cachedPath=[],this.parent=t,this.data=e,this._path=r,this._key=i}get path(){return this._cachedPath.length||(this._key instanceof Array?this._cachedPath.push(...this._path,...this._key):this._cachedPath.push(...this._path,this._key)),this._cachedPath}}const Dc=(n,t)=>{if(ho(t))return{success:!0,data:t.value};if(!n.common.issues.length)throw new Error("Validation failed but no issues detected.");return{success:!1,get error(){if(this._error)return this._error;const e=new cr(n.common.issues);return this._error=e,this._error}}};function st(n){if(!n)return{};const{errorMap:t,invalid_type_error:e,required_error:r,description:i}=n;if(t&&(e||r))throw new Error(`Can't use "invalid_type_error" or "required_error" in conjunction with custom error map.`);return t?{errorMap:t,description:i}:{errorMap:(s,o)=>{var a,u;const{message:l}=n;return s.code==="invalid_enum_value"?{message:l??o.defaultError}:typeof o.data>"u"?{message:(a=l??r)!==null&&a!==void 0?a:o.defaultError}:s.code!=="invalid_type"?{message:o.defaultError}:{message:(u=l??e)!==null&&u!==void 0?u:o.defaultError}},description:i}}class lt{constructor(t){this.spa=this.safeParseAsync,this._def=t,this.parse=this.parse.bind(this),this.safeParse=this.safeParse.bind(this),this.parseAsync=this.parseAsync.bind(this),this.safeParseAsync=this.safeParseAsync.bind(this),this.spa=this.spa.bind(this),this.refine=this.refine.bind(this),this.refinement=this.refinement.bind(this),this.superRefine=this.superRefine.bind(this),this.optional=this.optional.bind(this),this.nullable=this.nullable.bind(this),this.nullish=this.nullish.bind(this),this.array=this.array.bind(this),this.promise=this.promise.bind(this),this.or=this.or.bind(this),this.and=this.and.bind(this),this.transform=this.transform.bind(this),this.brand=this.brand.bind(this),this.default=this.default.bind(this),this.catch=this.catch.bind(this),this.describe=this.describe.bind(this),this.pipe=this.pipe.bind(this),this.readonly=this.readonly.bind(this),this.isNullable=this.isNullable.bind(this),this.isOptional=this.isOptional.bind(this)}get description(){return this._def.description}_getType(t){return ti(t.data)}_getOrReturnCtx(t,e){return e||{common:t.parent.common,data:t.data,parsedType:ti(t.data),schemaErrorMap:this._def.errorMap,path:t.path,parent:t.parent}}_processInputParams(t){return{status:new Ue,ctx:{common:t.parent.common,data:t.data,parsedType:ti(t.data),schemaErrorMap:this._def.errorMap,path:t.path,parent:t.parent}}}_parseSync(t){const e=this._parse(t);if(fo(e))throw new Error("Synchronous parse encountered promise.");return e}_parseAsync(t){const e=this._parse(t);return Promise.resolve(e)}parse(t,e){const r=this.safeParse(t,e);if(r.success)return r.data;throw r.error}safeParse(t,e){var r;const i={common:{issues:[],async:(r=e==null?void 0:e.async)!==null&&r!==void 0?r:!1,contextualErrorMap:e==null?void 0:e.errorMap},path:(e==null?void 0:e.path)||[],schemaErrorMap:this._def.errorMap,parent:null,data:t,parsedType:ti(t)},s=this._parseSync({data:t,path:i.path,parent:i});return Dc(i,s)}async parseAsync(t,e){const r=await this.safeParseAsync(t,e);if(r.success)return r.data;throw r.error}async safeParseAsync(t,e){const r={common:{issues:[],contextualErrorMap:e==null?void 0:e.errorMap,async:!0},path:(e==null?void 0:e.path)||[],schemaErrorMap:this._def.errorMap,parent:null,data:t,parsedType:ti(t)},i=this._parse({data:t,path:r.path,parent:r}),s=await(fo(i)?i:Promise.resolve(i));return Dc(r,s)}refine(t,e){const r=i=>typeof e=="string"||typeof e>"u"?{message:e}:typeof e=="function"?e(i):e;return this._refinement((i,s)=>{const o=t(i),a=()=>s.addIssue({code:F.custom,...r(i)});return typeof Promise<"u"&&o instanceof Promise?o.then(u=>u?!0:(a(),!1)):o?!0:(a(),!1)})}refinement(t,e){return this._refinement((r,i)=>t(r)?!0:(i.addIssue(typeof e=="function"?e(r,i):e),!1))}_refinement(t){return new an({schema:this,typeName:tt.ZodEffects,effect:{type:"refinement",refinement:t}})}superRefine(t){return this._refinement(t)}optional(){return dn.create(this,this._def)}nullable(){return di.create(this,this._def)}nullish(){return this.nullable().optional()}array(){return Kr.create(this,this._def)}promise(){return Ss.create(this,this._def)}or(t){return vo.create([this,t],this._def)}and(t){return yo.create(this,t,this._def)}transform(t){return new an({...st(this._def),schema:this,typeName:tt.ZodEffects,effect:{type:"transform",transform:t}})}default(t){const e=typeof t=="function"?t:()=>t;return new Io({...st(this._def),innerType:this,defaultValue:e,typeName:tt.ZodDefault})}brand(){return new Ll({typeName:tt.ZodBranded,type:this,...st(this._def)})}catch(t){const e=typeof t=="function"?t:()=>t;return new Co({...st(this._def),innerType:this,catchValue:e,typeName:tt.ZodCatch})}describe(t){const e=this.constructor;return new e({...this._def,description:t})}pipe(t){return Fo.create(this,t)}readonly(){return So.create(this)}isOptional(){return this.safeParse(void 0).success}isNullable(){return this.safeParse(null).success}}const Fd=/^c[^\s-]{8,}$/i,kd=/^[0-9a-z]+$/,Gd=/^[0-9A-HJKMNP-TV-Z]{26}$/,Bd=/^[0-9a-fA-F]{8}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{12}$/i,zd=/^[a-z0-9_-]{21}$/i,Ud=/^[-+]?P(?!$)(?:(?:[-+]?\d+Y)|(?:[-+]?\d+[.,]\d+Y$))?(?:(?:[-+]?\d+M)|(?:[-+]?\d+[.,]\d+M$))?(?:(?:[-+]?\d+W)|(?:[-+]?\d+[.,]\d+W$))?(?:(?:[-+]?\d+D)|(?:[-+]?\d+[.,]\d+D$))?(?:T(?=[\d+-])(?:(?:[-+]?\d+H)|(?:[-+]?\d+[.,]\d+H$))?(?:(?:[-+]?\d+M)|(?:[-+]?\d+[.,]\d+M$))?(?:[-+]?\d+(?:[.,]\d+)?S)?)??$/,jd=/^(?!\.)(?!.*\.\.)([A-Z0-9_'+\-\.]*)[A-Z0-9_+-]@([A-Z0-9][A-Z0-9\-]*\.)+[A-Z]{2,}$/i,Vd="^(\\p{Extended_Pictographic}|\\p{Emoji_Component})+$";let Au;const qd=/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])$/,Wd=/^(([a-f0-9]{1,4}:){7}|::([a-f0-9]{1,4}:){0,6}|([a-f0-9]{1,4}:){1}:([a-f0-9]{1,4}:){0,5}|([a-f0-9]{1,4}:){2}:([a-f0-9]{1,4}:){0,4}|([a-f0-9]{1,4}:){3}:([a-f0-9]{1,4}:){0,3}|([a-f0-9]{1,4}:){4}:([a-f0-9]{1,4}:){0,2}|([a-f0-9]{1,4}:){5}:([a-f0-9]{1,4}:){0,1})([a-f0-9]{1,4}|(((25[0-5])|(2[0-4][0-9])|(1[0-9]{2})|([0-9]{1,2}))\.){3}((25[0-5])|(2[0-4][0-9])|(1[0-9]{2})|([0-9]{1,2})))$/,Xd=/^([0-9a-zA-Z+/]{4})*(([0-9a-zA-Z+/]{2}==)|([0-9a-zA-Z+/]{3}=))?$/,uf="((\\d\\d[2468][048]|\\d\\d[13579][26]|\\d\\d0[48]|[02468][048]00|[13579][26]00)-02-29|\\d{4}-((0[13578]|1[02])-(0[1-9]|[12]\\d|3[01])|(0[469]|11)-(0[1-9]|[12]\\d|30)|(02)-(0[1-9]|1\\d|2[0-8])))",Yd=new RegExp(`^${uf}$`);function lf(n){let t="([01]\\d|2[0-3]):[0-5]\\d:[0-5]\\d";return n.precision?t=`${t}\\.\\d{${n.precision}}`:n.precision==null&&(t=`${t}(\\.\\d+)?`),t}function Zd(n){return new RegExp(`^${lf(n)}$`)}function cf(n){let t=`${uf}T${lf(n)}`;const e=[];return e.push(n.local?"Z?":"Z"),n.offset&&e.push("([+-]\\d{2}:?\\d{2})"),t=`${t}(${e.join("|")})`,new RegExp(`^${t}$`)}function Hd(n,t){return!!((t==="v4"||!t)&&qd.test(n)||(t==="v6"||!t)&&Wd.test(n))}class Xr extends lt{_parse(t){if(this._def.coerce&&(t.data=String(t.data)),this._getType(t)!==V.string){const i=this._getOrReturnCtx(t);return U(i,{code:F.invalid_type,expected:V.string,received:i.parsedType}),rt}const e=new Ue;let r;for(const i of this._def.checks)if(i.kind==="min")t.data.length<i.value&&(r=this._getOrReturnCtx(t,r),U(r,{code:F.too_small,minimum:i.value,type:"string",inclusive:!0,exact:!1,message:i.message}),e.dirty());else if(i.kind==="max")t.data.length>i.value&&(r=this._getOrReturnCtx(t,r),U(r,{code:F.too_big,maximum:i.value,type:"string",inclusive:!0,exact:!1,message:i.message}),e.dirty());else if(i.kind==="length"){const s=t.data.length>i.value,o=t.data.length<i.value;(s||o)&&(r=this._getOrReturnCtx(t,r),s?U(r,{code:F.too_big,maximum:i.value,type:"string",inclusive:!0,exact:!0,message:i.message}):o&&U(r,{code:F.too_small,minimum:i.value,type:"string",inclusive:!0,exact:!0,message:i.message}),e.dirty())}else if(i.kind==="email")jd.test(t.data)||(r=this._getOrReturnCtx(t,r),U(r,{validation:"email",code:F.invalid_string,message:i.message}),e.dirty());else if(i.kind==="emoji")Au||(Au=new RegExp(Vd,"u")),Au.test(t.data)||(r=this._getOrReturnCtx(t,r),U(r,{validation:"emoji",code:F.invalid_string,message:i.message}),e.dirty());else if(i.kind==="uuid")Bd.test(t.data)||(r=this._getOrReturnCtx(t,r),U(r,{validation:"uuid",code:F.invalid_string,message:i.message}),e.dirty());else if(i.kind==="nanoid")zd.test(t.data)||(r=this._getOrReturnCtx(t,r),U(r,{validation:"nanoid",code:F.invalid_string,message:i.message}),e.dirty());else if(i.kind==="cuid")Fd.test(t.data)||(r=this._getOrReturnCtx(t,r),U(r,{validation:"cuid",code:F.invalid_string,message:i.message}),e.dirty());else if(i.kind==="cuid2")kd.test(t.data)||(r=this._getOrReturnCtx(t,r),U(r,{validation:"cuid2",code:F.invalid_string,message:i.message}),e.dirty());else if(i.kind==="ulid")Gd.test(t.data)||(r=this._getOrReturnCtx(t,r),U(r,{validation:"ulid",code:F.invalid_string,message:i.message}),e.dirty());else if(i.kind==="url")try{new URL(t.data)}catch{r=this._getOrReturnCtx(t,r),U(r,{validation:"url",code:F.invalid_string,message:i.message}),e.dirty()}else i.kind==="regex"?(i.regex.lastIndex=0,i.regex.test(t.data)||(r=this._getOrReturnCtx(t,r),U(r,{validation:"regex",code:F.invalid_string,message:i.message}),e.dirty())):i.kind==="trim"?t.data=t.data.trim():i.kind==="includes"?t.data.includes(i.value,i.position)||(r=this._getOrReturnCtx(t,r),U(r,{code:F.invalid_string,validation:{includes:i.value,position:i.position},message:i.message}),e.dirty()):i.kind==="toLowerCase"?t.data=t.data.toLowerCase():i.kind==="toUpperCase"?t.data=t.data.toUpperCase():i.kind==="startsWith"?t.data.startsWith(i.value)||(r=this._getOrReturnCtx(t,r),U(r,{code:F.invalid_string,validation:{startsWith:i.value},message:i.message}),e.dirty()):i.kind==="endsWith"?t.data.endsWith(i.value)||(r=this._getOrReturnCtx(t,r),U(r,{code:F.invalid_string,validation:{endsWith:i.value},message:i.message}),e.dirty()):i.kind==="datetime"?cf(i).test(t.data)||(r=this._getOrReturnCtx(t,r),U(r,{code:F.invalid_string,validation:"datetime",message:i.message}),e.dirty()):i.kind==="date"?Yd.test(t.data)||(r=this._getOrReturnCtx(t,r),U(r,{code:F.invalid_string,validation:"date",message:i.message}),e.dirty()):i.kind==="time"?Zd(i).test(t.data)||(r=this._getOrReturnCtx(t,r),U(r,{code:F.invalid_string,validation:"time",message:i.message}),e.dirty()):i.kind==="duration"?Ud.test(t.data)||(r=this._getOrReturnCtx(t,r),U(r,{validation:"duration",code:F.invalid_string,message:i.message}),e.dirty()):i.kind==="ip"?Hd(t.data,i.version)||(r=this._getOrReturnCtx(t,r),U(r,{validation:"ip",code:F.invalid_string,message:i.message}),e.dirty()):i.kind==="base64"?Xd.test(t.data)||(r=this._getOrReturnCtx(t,r),U(r,{validation:"base64",code:F.invalid_string,message:i.message}),e.dirty()):_t.assertNever(i);return{status:e.value,value:t.data}}_regex(t,e,r){return this.refinement(i=>t.test(i),{validation:e,code:F.invalid_string,...Z.errToObj(r)})}_addCheck(t){return new Xr({...this._def,checks:[...this._def.checks,t]})}email(t){return this._addCheck({kind:"email",...Z.errToObj(t)})}url(t){return this._addCheck({kind:"url",...Z.errToObj(t)})}emoji(t){return this._addCheck({kind:"emoji",...Z.errToObj(t)})}uuid(t){return this._addCheck({kind:"uuid",...Z.errToObj(t)})}nanoid(t){return this._addCheck({kind:"nanoid",...Z.errToObj(t)})}cuid(t){return this._addCheck({kind:"cuid",...Z.errToObj(t)})}cuid2(t){return this._addCheck({kind:"cuid2",...Z.errToObj(t)})}ulid(t){return this._addCheck({kind:"ulid",...Z.errToObj(t)})}base64(t){return this._addCheck({kind:"base64",...Z.errToObj(t)})}ip(t){return this._addCheck({kind:"ip",...Z.errToObj(t)})}datetime(t){var e,r;return typeof t=="string"?this._addCheck({kind:"datetime",precision:null,offset:!1,local:!1,message:t}):this._addCheck({kind:"datetime",precision:typeof(t==null?void 0:t.precision)>"u"?null:t==null?void 0:t.precision,offset:(e=t==null?void 0:t.offset)!==null&&e!==void 0?e:!1,local:(r=t==null?void 0:t.local)!==null&&r!==void 0?r:!1,...Z.errToObj(t==null?void 0:t.message)})}date(t){return this._addCheck({kind:"date",message:t})}time(t){return typeof t=="string"?this._addCheck({kind:"time",precision:null,message:t}):this._addCheck({kind:"time",precision:typeof(t==null?void 0:t.precision)>"u"?null:t==null?void 0:t.precision,...Z.errToObj(t==null?void 0:t.message)})}duration(t){return this._addCheck({kind:"duration",...Z.errToObj(t)})}regex(t,e){return this._addCheck({kind:"regex",regex:t,...Z.errToObj(e)})}includes(t,e){return this._addCheck({kind:"includes",value:t,position:e==null?void 0:e.position,...Z.errToObj(e==null?void 0:e.message)})}startsWith(t,e){return this._addCheck({kind:"startsWith",value:t,...Z.errToObj(e)})}endsWith(t,e){return this._addCheck({kind:"endsWith",value:t,...Z.errToObj(e)})}min(t,e){return this._addCheck({kind:"min",value:t,...Z.errToObj(e)})}max(t,e){return this._addCheck({kind:"max",value:t,...Z.errToObj(e)})}length(t,e){return this._addCheck({kind:"length",value:t,...Z.errToObj(e)})}nonempty(t){return this.min(1,Z.errToObj(t))}trim(){return new Xr({...this._def,checks:[...this._def.checks,{kind:"trim"}]})}toLowerCase(){return new Xr({...this._def,checks:[...this._def.checks,{kind:"toLowerCase"}]})}toUpperCase(){return new Xr({...this._def,checks:[...this._def.checks,{kind:"toUpperCase"}]})}get isDatetime(){return!!this._def.checks.find(t=>t.kind==="datetime")}get isDate(){return!!this._def.checks.find(t=>t.kind==="date")}get isTime(){return!!this._def.checks.find(t=>t.kind==="time")}get isDuration(){return!!this._def.checks.find(t=>t.kind==="duration")}get isEmail(){return!!this._def.checks.find(t=>t.kind==="email")}get isURL(){return!!this._def.checks.find(t=>t.kind==="url")}get isEmoji(){return!!this._def.checks.find(t=>t.kind==="emoji")}get isUUID(){return!!this._def.checks.find(t=>t.kind==="uuid")}get isNANOID(){return!!this._def.checks.find(t=>t.kind==="nanoid")}get isCUID(){return!!this._def.checks.find(t=>t.kind==="cuid")}get isCUID2(){return!!this._def.checks.find(t=>t.kind==="cuid2")}get isULID(){return!!this._def.checks.find(t=>t.kind==="ulid")}get isIP(){return!!this._def.checks.find(t=>t.kind==="ip")}get isBase64(){return!!this._def.checks.find(t=>t.kind==="base64")}get minLength(){let t=null;for(const e of this._def.checks)e.kind==="min"&&(t===null||e.value>t)&&(t=e.value);return t}get maxLength(){let t=null;for(const e of this._def.checks)e.kind==="max"&&(t===null||e.value<t)&&(t=e.value);return t}}Xr.create=n=>{var t;return new Xr({checks:[],typeName:tt.ZodString,coerce:(t=n==null?void 0:n.coerce)!==null&&t!==void 0?t:!1,...st(n)})};function Kd(n,t){const e=(n.toString().split(".")[1]||"").length,r=(t.toString().split(".")[1]||"").length,i=e>r?e:r,s=parseInt(n.toFixed(i).replace(".","")),o=parseInt(t.toFixed(i).replace(".",""));return s%o/Math.pow(10,i)}class fi extends lt{constructor(){super(...arguments),this.min=this.gte,this.max=this.lte,this.step=this.multipleOf}_parse(t){if(this._def.coerce&&(t.data=Number(t.data)),this._getType(t)!==V.number){const i=this._getOrReturnCtx(t);return U(i,{code:F.invalid_type,expected:V.number,received:i.parsedType}),rt}let e;const r=new Ue;for(const i of this._def.checks)i.kind==="int"?_t.isInteger(t.data)||(e=this._getOrReturnCtx(t,e),U(e,{code:F.invalid_type,expected:"integer",received:"float",message:i.message}),r.dirty()):i.kind==="min"?(i.inclusive?t.data<i.value:t.data<=i.value)&&(e=this._getOrReturnCtx(t,e),U(e,{code:F.too_small,minimum:i.value,type:"number",inclusive:i.inclusive,exact:!1,message:i.message}),r.dirty()):i.kind==="max"?(i.inclusive?t.data>i.value:t.data>=i.value)&&(e=this._getOrReturnCtx(t,e),U(e,{code:F.too_big,maximum:i.value,type:"number",inclusive:i.inclusive,exact:!1,message:i.message}),r.dirty()):i.kind==="multipleOf"?Kd(t.data,i.value)!==0&&(e=this._getOrReturnCtx(t,e),U(e,{code:F.not_multiple_of,multipleOf:i.value,message:i.message}),r.dirty()):i.kind==="finite"?Number.isFinite(t.data)||(e=this._getOrReturnCtx(t,e),U(e,{code:F.not_finite,message:i.message}),r.dirty()):_t.assertNever(i);return{status:r.value,value:t.data}}gte(t,e){return this.setLimit("min",t,!0,Z.toString(e))}gt(t,e){return this.setLimit("min",t,!1,Z.toString(e))}lte(t,e){return this.setLimit("max",t,!0,Z.toString(e))}lt(t,e){return this.setLimit("max",t,!1,Z.toString(e))}setLimit(t,e,r,i){return new fi({...this._def,checks:[...this._def.checks,{kind:t,value:e,inclusive:r,message:Z.toString(i)}]})}_addCheck(t){return new fi({...this._def,checks:[...this._def.checks,t]})}int(t){return this._addCheck({kind:"int",message:Z.toString(t)})}positive(t){return this._addCheck({kind:"min",value:0,inclusive:!1,message:Z.toString(t)})}negative(t){return this._addCheck({kind:"max",value:0,inclusive:!1,message:Z.toString(t)})}nonpositive(t){return this._addCheck({kind:"max",value:0,inclusive:!0,message:Z.toString(t)})}nonnegative(t){return this._addCheck({kind:"min",value:0,inclusive:!0,message:Z.toString(t)})}multipleOf(t,e){return this._addCheck({kind:"multipleOf",value:t,message:Z.toString(e)})}finite(t){return this._addCheck({kind:"finite",message:Z.toString(t)})}safe(t){return this._addCheck({kind:"min",inclusive:!0,value:Number.MIN_SAFE_INTEGER,message:Z.toString(t)})._addCheck({kind:"max",inclusive:!0,value:Number.MAX_SAFE_INTEGER,message:Z.toString(t)})}get minValue(){let t=null;for(const e of this._def.checks)e.kind==="min"&&(t===null||e.value>t)&&(t=e.value);return t}get maxValue(){let t=null;for(const e of this._def.checks)e.kind==="max"&&(t===null||e.value<t)&&(t=e.value);return t}get isInt(){return!!this._def.checks.find(t=>t.kind==="int"||t.kind==="multipleOf"&&_t.isInteger(t.value))}get isFinite(){let t=null,e=null;for(const r of this._def.checks){if(r.kind==="finite"||r.kind==="int"||r.kind==="multipleOf")return!0;r.kind==="min"?(e===null||r.value>e)&&(e=r.value):r.kind==="max"&&(t===null||r.value<t)&&(t=r.value)}return Number.isFinite(e)&&Number.isFinite(t)}}fi.create=n=>new fi({checks:[],typeName:tt.ZodNumber,coerce:(n==null?void 0:n.coerce)||!1,...st(n)});class pi extends lt{constructor(){super(...arguments),this.min=this.gte,this.max=this.lte}_parse(t){if(this._def.coerce&&(t.data=BigInt(t.data)),this._getType(t)!==V.bigint){const i=this._getOrReturnCtx(t);return U(i,{code:F.invalid_type,expected:V.bigint,received:i.parsedType}),rt}let e;const r=new Ue;for(const i of this._def.checks)i.kind==="min"?(i.inclusive?t.data<i.value:t.data<=i.value)&&(e=this._getOrReturnCtx(t,e),U(e,{code:F.too_small,type:"bigint",minimum:i.value,inclusive:i.inclusive,message:i.message}),r.dirty()):i.kind==="max"?(i.inclusive?t.data>i.value:t.data>=i.value)&&(e=this._getOrReturnCtx(t,e),U(e,{code:F.too_big,type:"bigint",maximum:i.value,inclusive:i.inclusive,message:i.message}),r.dirty()):i.kind==="multipleOf"?t.data%i.value!==BigInt(0)&&(e=this._getOrReturnCtx(t,e),U(e,{code:F.not_multiple_of,multipleOf:i.value,message:i.message}),r.dirty()):_t.assertNever(i);return{status:r.value,value:t.data}}gte(t,e){return this.setLimit("min",t,!0,Z.toString(e))}gt(t,e){return this.setLimit("min",t,!1,Z.toString(e))}lte(t,e){return this.setLimit("max",t,!0,Z.toString(e))}lt(t,e){return this.setLimit("max",t,!1,Z.toString(e))}setLimit(t,e,r,i){return new pi({...this._def,checks:[...this._def.checks,{kind:t,value:e,inclusive:r,message:Z.toString(i)}]})}_addCheck(t){return new pi({...this._def,checks:[...this._def.checks,t]})}positive(t){return this._addCheck({kind:"min",value:BigInt(0),inclusive:!1,message:Z.toString(t)})}negative(t){return this._addCheck({kind:"max",value:BigInt(0),inclusive:!1,message:Z.toString(t)})}nonpositive(t){return this._addCheck({kind:"max",value:BigInt(0),inclusive:!0,message:Z.toString(t)})}nonnegative(t){return this._addCheck({kind:"min",value:BigInt(0),inclusive:!0,message:Z.toString(t)})}multipleOf(t,e){return this._addCheck({kind:"multipleOf",value:t,message:Z.toString(e)})}get minValue(){let t=null;for(const e of this._def.checks)e.kind==="min"&&(t===null||e.value>t)&&(t=e.value);return t}get maxValue(){let t=null;for(const e of this._def.checks)e.kind==="max"&&(t===null||e.value<t)&&(t=e.value);return t}}pi.create=n=>{var t;return new pi({checks:[],typeName:tt.ZodBigInt,coerce:(t=n==null?void 0:n.coerce)!==null&&t!==void 0?t:!1,...st(n)})};class po extends lt{_parse(t){if(this._def.coerce&&(t.data=!!t.data),this._getType(t)!==V.boolean){const e=this._getOrReturnCtx(t);return U(e,{code:F.invalid_type,expected:V.boolean,received:e.parsedType}),rt}return Ke(t.data)}}po.create=n=>new po({typeName:tt.ZodBoolean,coerce:(n==null?void 0:n.coerce)||!1,...st(n)});class Di extends lt{_parse(t){if(this._def.coerce&&(t.data=new Date(t.data)),this._getType(t)!==V.date){const i=this._getOrReturnCtx(t);return U(i,{code:F.invalid_type,expected:V.date,received:i.parsedType}),rt}if(isNaN(t.data.getTime())){const i=this._getOrReturnCtx(t);return U(i,{code:F.invalid_date}),rt}const e=new Ue;let r;for(const i of this._def.checks)i.kind==="min"?t.data.getTime()<i.value&&(r=this._getOrReturnCtx(t,r),U(r,{code:F.too_small,message:i.message,inclusive:!0,exact:!1,minimum:i.value,type:"date"}),e.dirty()):i.kind==="max"?t.data.getTime()>i.value&&(r=this._getOrReturnCtx(t,r),U(r,{code:F.too_big,message:i.message,inclusive:!0,exact:!1,maximum:i.value,type:"date"}),e.dirty()):_t.assertNever(i);return{status:e.value,value:new Date(t.data.getTime())}}_addCheck(t){return new Di({...this._def,checks:[...this._def.checks,t]})}min(t,e){return this._addCheck({kind:"min",value:t.getTime(),message:Z.toString(e)})}max(t,e){return this._addCheck({kind:"max",value:t.getTime(),message:Z.toString(e)})}get minDate(){let t=null;for(const e of this._def.checks)e.kind==="min"&&(t===null||e.value>t)&&(t=e.value);return t!=null?new Date(t):null}get maxDate(){let t=null;for(const e of this._def.checks)e.kind==="max"&&(t===null||e.value<t)&&(t=e.value);return t!=null?new Date(t):null}}Di.create=n=>new Di({checks:[],coerce:(n==null?void 0:n.coerce)||!1,typeName:tt.ZodDate,...st(n)});class ka extends lt{_parse(t){if(this._getType(t)!==V.symbol){const e=this._getOrReturnCtx(t);return U(e,{code:F.invalid_type,expected:V.symbol,received:e.parsedType}),rt}return Ke(t.data)}}ka.create=n=>new ka({typeName:tt.ZodSymbol,...st(n)});class go extends lt{_parse(t){if(this._getType(t)!==V.undefined){const e=this._getOrReturnCtx(t);return U(e,{code:F.invalid_type,expected:V.undefined,received:e.parsedType}),rt}return Ke(t.data)}}go.create=n=>new go({typeName:tt.ZodUndefined,...st(n)});class mo extends lt{_parse(t){if(this._getType(t)!==V.null){const e=this._getOrReturnCtx(t);return U(e,{code:F.invalid_type,expected:V.null,received:e.parsedType}),rt}return Ke(t.data)}}mo.create=n=>new mo({typeName:tt.ZodNull,...st(n)});class Cs extends lt{constructor(){super(...arguments),this._any=!0}_parse(t){return Ke(t.data)}}Cs.create=n=>new Cs({typeName:tt.ZodAny,...st(n)});class wi extends lt{constructor(){super(...arguments),this._unknown=!0}_parse(t){return Ke(t.data)}}wi.create=n=>new wi({typeName:tt.ZodUnknown,...st(n)});class Hn extends lt{_parse(t){const e=this._getOrReturnCtx(t);return U(e,{code:F.invalid_type,expected:V.never,received:e.parsedType}),rt}}Hn.create=n=>new Hn({typeName:tt.ZodNever,...st(n)});class Ga extends lt{_parse(t){if(this._getType(t)!==V.undefined){const e=this._getOrReturnCtx(t);return U(e,{code:F.invalid_type,expected:V.void,received:e.parsedType}),rt}return Ke(t.data)}}Ga.create=n=>new Ga({typeName:tt.ZodVoid,...st(n)});class Kr extends lt{_parse(t){const{ctx:e,status:r}=this._processInputParams(t),i=this._def;if(e.parsedType!==V.array)return U(e,{code:F.invalid_type,expected:V.array,received:e.parsedType}),rt;if(i.exactLength!==null){const o=e.data.length>i.exactLength.value,a=e.data.length<i.exactLength.value;(o||a)&&(U(e,{code:o?F.too_big:F.too_small,minimum:a?i.exactLength.value:void 0,maximum:o?i.exactLength.value:void 0,type:"array",inclusive:!0,exact:!0,message:i.exactLength.message}),r.dirty())}if(i.minLength!==null&&e.data.length<i.minLength.value&&(U(e,{code:F.too_small,minimum:i.minLength.value,type:"array",inclusive:!0,exact:!1,message:i.minLength.message}),r.dirty()),i.maxLength!==null&&e.data.length>i.maxLength.value&&(U(e,{code:F.too_big,maximum:i.maxLength.value,type:"array",inclusive:!0,exact:!1,message:i.maxLength.message}),r.dirty()),e.common.async)return Promise.all([...e.data].map((o,a)=>i.type._parseAsync(new xn(e,o,e.path,a)))).then(o=>Ue.mergeArray(r,o));const s=[...e.data].map((o,a)=>i.type._parseSync(new xn(e,o,e.path,a)));return Ue.mergeArray(r,s)}get element(){return this._def.type}min(t,e){return new Kr({...this._def,minLength:{value:t,message:Z.toString(e)}})}max(t,e){return new Kr({...this._def,maxLength:{value:t,message:Z.toString(e)}})}length(t,e){return new Kr({...this._def,exactLength:{value:t,message:Z.toString(e)}})}nonempty(t){return this.min(1,t)}}Kr.create=(n,t)=>new Kr({type:n,minLength:null,maxLength:null,exactLength:null,typeName:tt.ZodArray,...st(t)});function Zi(n){if(n instanceof Wt){const t={};for(const e in n.shape){const r=n.shape[e];t[e]=dn.create(Zi(r))}return new Wt({...n._def,shape:()=>t})}else return n instanceof Kr?new Kr({...n._def,type:Zi(n.element)}):n instanceof dn?dn.create(Zi(n.unwrap())):n instanceof di?di.create(Zi(n.unwrap())):n instanceof In?In.create(n.items.map(t=>Zi(t))):n}class Wt extends lt{constructor(){super(...arguments),this._cached=null,this.nonstrict=this.passthrough,this.augment=this.extend}_getCached(){if(this._cached!==null)return this._cached;const t=this._def.shape(),e=_t.objectKeys(t);return this._cached={shape:t,keys:e}}_parse(t){if(this._getType(t)!==V.object){const u=this._getOrReturnCtx(t);return U(u,{code:F.invalid_type,expected:V.object,received:u.parsedType}),rt}const{status:e,ctx:r}=this._processInputParams(t),{shape:i,keys:s}=this._getCached(),o=[];if(!(this._def.catchall instanceof Hn&&this._def.unknownKeys==="strip"))for(const u in r.data)s.includes(u)||o.push(u);const a=[];for(const u of s){const l=i[u],c=r.data[u];a.push({key:{status:"valid",value:u},value:l._parse(new xn(r,c,r.path,u)),alwaysSet:u in r.data})}if(this._def.catchall instanceof Hn){const u=this._def.unknownKeys;if(u==="passthrough")for(const l of o)a.push({key:{status:"valid",value:l},value:{status:"valid",value:r.data[l]}});else if(u==="strict")o.length>0&&(U(r,{code:F.unrecognized_keys,keys:o}),e.dirty());else if(u!=="strip")throw new Error("Internal ZodObject error: invalid unknownKeys value.")}else{const u=this._def.catchall;for(const l of o){const c=r.data[l];a.push({key:{status:"valid",value:l},value:u._parse(new xn(r,c,r.path,l)),alwaysSet:l in r.data})}}return r.common.async?Promise.resolve().then(async()=>{const u=[];for(const l of a){const c=await l.key,h=await l.value;u.push({key:c,value:h,alwaysSet:l.alwaysSet})}return u}).then(u=>Ue.mergeObjectSync(e,u)):Ue.mergeObjectSync(e,a)}get shape(){return this._def.shape()}strict(t){return Z.errToObj,new Wt({...this._def,unknownKeys:"strict",...t!==void 0?{errorMap:(e,r)=>{var i,s,o,a;const u=(o=(s=(i=this._def).errorMap)===null||s===void 0?void 0:s.call(i,e,r).message)!==null&&o!==void 0?o:r.defaultError;return e.code==="unrecognized_keys"?{message:(a=Z.errToObj(t).message)!==null&&a!==void 0?a:u}:{message:u}}}:{}})}strip(){return new Wt({...this._def,unknownKeys:"strip"})}passthrough(){return new Wt({...this._def,unknownKeys:"passthrough"})}extend(t){return new Wt({...this._def,shape:()=>({...this._def.shape(),...t})})}merge(t){return new Wt({unknownKeys:t._def.unknownKeys,catchall:t._def.catchall,shape:()=>({...this._def.shape(),...t._def.shape()}),typeName:tt.ZodObject})}setKey(t,e){return this.augment({[t]:e})}catchall(t){return new Wt({...this._def,catchall:t})}pick(t){const e={};return _t.objectKeys(t).forEach(r=>{t[r]&&this.shape[r]&&(e[r]=this.shape[r])}),new Wt({...this._def,shape:()=>e})}omit(t){const e={};return _t.objectKeys(this.shape).forEach(r=>{t[r]||(e[r]=this.shape[r])}),new Wt({...this._def,shape:()=>e})}deepPartial(){return Zi(this)}partial(t){const e={};return _t.objectKeys(this.shape).forEach(r=>{const i=this.shape[r];t&&!t[r]?e[r]=i:e[r]=i.optional()}),new Wt({...this._def,shape:()=>e})}required(t){const e={};return _t.objectKeys(this.shape).forEach(r=>{if(t&&!t[r])e[r]=this.shape[r];else{let i=this.shape[r];for(;i instanceof dn;)i=i._def.innerType;e[r]=i}}),new Wt({...this._def,shape:()=>e})}keyof(){return hf(_t.objectKeys(this.shape))}}Wt.create=(n,t)=>new Wt({shape:()=>n,unknownKeys:"strip",catchall:Hn.create(),typeName:tt.ZodObject,...st(t)});Wt.strictCreate=(n,t)=>new Wt({shape:()=>n,unknownKeys:"strict",catchall:Hn.create(),typeName:tt.ZodObject,...st(t)});Wt.lazycreate=(n,t)=>new Wt({shape:n,unknownKeys:"strip",catchall:Hn.create(),typeName:tt.ZodObject,...st(t)});class vo extends lt{_parse(t){const{ctx:e}=this._processInputParams(t),r=this._def.options;function i(s){for(const a of s)if(a.result.status==="valid")return a.result;for(const a of s)if(a.result.status==="dirty")return e.common.issues.push(...a.ctx.common.issues),a.result;const o=s.map(a=>new cr(a.ctx.common.issues));return U(e,{code:F.invalid_union,unionErrors:o}),rt}if(e.common.async)return Promise.all(r.map(async s=>{const o={...e,common:{...e.common,issues:[]},parent:null};return{result:await s._parseAsync({data:e.data,path:e.path,parent:o}),ctx:o}})).then(i);{let s;const o=[];for(const u of r){const l={...e,common:{...e.common,issues:[]},parent:null},c=u._parseSync({data:e.data,path:e.path,parent:l});if(c.status==="valid")return c;c.status==="dirty"&&!s&&(s={result:c,ctx:l}),l.common.issues.length&&o.push(l.common.issues)}if(s)return e.common.issues.push(...s.ctx.common.issues),s.result;const a=o.map(u=>new cr(u));return U(e,{code:F.invalid_union,unionErrors:a}),rt}}get options(){return this._def.options}}vo.create=(n,t)=>new vo({options:n,typeName:tt.ZodUnion,...st(t)});const $n=n=>n instanceof wo?$n(n.schema):n instanceof an?$n(n.innerType()):n instanceof Eo?[n.value]:n instanceof gi?n.options:n instanceof xo?_t.objectValues(n.enum):n instanceof Io?$n(n._def.innerType):n instanceof go?[void 0]:n instanceof mo?[null]:n instanceof dn?[void 0,...$n(n.unwrap())]:n instanceof di?[null,...$n(n.unwrap())]:n instanceof Ll||n instanceof So?$n(n.unwrap()):n instanceof Co?$n(n._def.innerType):[];class cu extends lt{_parse(t){const{ctx:e}=this._processInputParams(t);if(e.parsedType!==V.object)return U(e,{code:F.invalid_type,expected:V.object,received:e.parsedType}),rt;const r=this.discriminator,i=e.data[r],s=this.optionsMap.get(i);return s?e.common.async?s._parseAsync({data:e.data,path:e.path,parent:e}):s._parseSync({data:e.data,path:e.path,parent:e}):(U(e,{code:F.invalid_union_discriminator,options:Array.from(this.optionsMap.keys()),path:[r]}),rt)}get discriminator(){return this._def.discriminator}get options(){return this._def.options}get optionsMap(){return this._def.optionsMap}static create(t,e,r){const i=new Map;for(const s of e){const o=$n(s.shape[t]);if(!o.length)throw new Error(`A discriminator value for key \`${t}\` could not be extracted from all schema options`);for(const a of o){if(i.has(a))throw new Error(`Discriminator property ${String(t)} has duplicate value ${String(a)}`);i.set(a,s)}}return new cu({typeName:tt.ZodDiscriminatedUnion,discriminator:t,options:e,optionsMap:i,...st(r)})}}function il(n,t){const e=ti(n),r=ti(t);if(n===t)return{valid:!0,data:n};if(e===V.object&&r===V.object){const i=_t.objectKeys(t),s=_t.objectKeys(n).filter(a=>i.indexOf(a)!==-1),o={...n,...t};for(const a of s){const u=il(n[a],t[a]);if(!u.valid)return{valid:!1};o[a]=u.data}return{valid:!0,data:o}}else if(e===V.array&&r===V.array){if(n.length!==t.length)return{valid:!1};const i=[];for(let s=0;s<n.length;s++){const o=n[s],a=t[s],u=il(o,a);if(!u.valid)return{valid:!1};i.push(u.data)}return{valid:!0,data:i}}else return e===V.date&&r===V.date&&+n==+t?{valid:!0,data:n}:{valid:!1}}class yo extends lt{_parse(t){const{status:e,ctx:r}=this._processInputParams(t),i=(s,o)=>{if(rl(s)||rl(o))return rt;const a=il(s.value,o.value);return a.valid?((nl(s)||nl(o))&&e.dirty(),{status:e.value,value:a.data}):(U(r,{code:F.invalid_intersection_types}),rt)};return r.common.async?Promise.all([this._def.left._parseAsync({data:r.data,path:r.path,parent:r}),this._def.right._parseAsync({data:r.data,path:r.path,parent:r})]).then(([s,o])=>i(s,o)):i(this._def.left._parseSync({data:r.data,path:r.path,parent:r}),this._def.right._parseSync({data:r.data,path:r.path,parent:r}))}}yo.create=(n,t,e)=>new yo({left:n,right:t,typeName:tt.ZodIntersection,...st(e)});class In extends lt{_parse(t){const{status:e,ctx:r}=this._processInputParams(t);if(r.parsedType!==V.array)return U(r,{code:F.invalid_type,expected:V.array,received:r.parsedType}),rt;if(r.data.length<this._def.items.length)return U(r,{code:F.too_small,minimum:this._def.items.length,inclusive:!0,exact:!1,type:"array"}),rt;!this._def.rest&&r.data.length>this._def.items.length&&(U(r,{code:F.too_big,maximum:this._def.items.length,inclusive:!0,exact:!1,type:"array"}),e.dirty());const i=[...r.data].map((s,o)=>{const a=this._def.items[o]||this._def.rest;return a?a._parse(new xn(r,s,r.path,o)):null}).filter(s=>!!s);return r.common.async?Promise.all(i).then(s=>Ue.mergeArray(e,s)):Ue.mergeArray(e,i)}get items(){return this._def.items}rest(t){return new In({...this._def,rest:t})}}In.create=(n,t)=>{if(!Array.isArray(n))throw new Error("You must pass an array of schemas to z.tuple([ ... ])");return new In({items:n,typeName:tt.ZodTuple,rest:null,...st(t)})};class _o extends lt{get keySchema(){return this._def.keyType}get valueSchema(){return this._def.valueType}_parse(t){const{status:e,ctx:r}=this._processInputParams(t);if(r.parsedType!==V.object)return U(r,{code:F.invalid_type,expected:V.object,received:r.parsedType}),rt;const i=[],s=this._def.keyType,o=this._def.valueType;for(const a in r.data)i.push({key:s._parse(new xn(r,a,r.path,a)),value:o._parse(new xn(r,r.data[a],r.path,a)),alwaysSet:a in r.data});return r.common.async?Ue.mergeObjectAsync(e,i):Ue.mergeObjectSync(e,i)}get element(){return this._def.valueType}static create(t,e,r){return e instanceof lt?new _o({keyType:t,valueType:e,typeName:tt.ZodRecord,...st(r)}):new _o({keyType:Xr.create(),valueType:t,typeName:tt.ZodRecord,...st(e)})}}class Ba extends lt{get keySchema(){return this._def.keyType}get valueSchema(){return this._def.valueType}_parse(t){const{status:e,ctx:r}=this._processInputParams(t);if(r.parsedType!==V.map)return U(r,{code:F.invalid_type,expected:V.map,received:r.parsedType}),rt;const i=this._def.keyType,s=this._def.valueType,o=[...r.data.entries()].map(([a,u],l)=>({key:i._parse(new xn(r,a,r.path,[l,"key"])),value:s._parse(new xn(r,u,r.path,[l,"value"]))}));if(r.common.async){const a=new Map;return Promise.resolve().then(async()=>{for(const u of o){const l=await u.key,c=await u.value;if(l.status==="aborted"||c.status==="aborted")return rt;(l.status==="dirty"||c.status==="dirty")&&e.dirty(),a.set(l.value,c.value)}return{status:e.value,value:a}})}else{const a=new Map;for(const u of o){const l=u.key,c=u.value;if(l.status==="aborted"||c.status==="aborted")return rt;(l.status==="dirty"||c.status==="dirty")&&e.dirty(),a.set(l.value,c.value)}return{status:e.value,value:a}}}}Ba.create=(n,t,e)=>new Ba({valueType:t,keyType:n,typeName:tt.ZodMap,...st(e)});class Fi extends lt{_parse(t){const{status:e,ctx:r}=this._processInputParams(t);if(r.parsedType!==V.set)return U(r,{code:F.invalid_type,expected:V.set,received:r.parsedType}),rt;const i=this._def;i.minSize!==null&&r.data.size<i.minSize.value&&(U(r,{code:F.too_small,minimum:i.minSize.value,type:"set",inclusive:!0,exact:!1,message:i.minSize.message}),e.dirty()),i.maxSize!==null&&r.data.size>i.maxSize.value&&(U(r,{code:F.too_big,maximum:i.maxSize.value,type:"set",inclusive:!0,exact:!1,message:i.maxSize.message}),e.dirty());const s=this._def.valueType;function o(u){const l=new Set;for(const c of u){if(c.status==="aborted")return rt;c.status==="dirty"&&e.dirty(),l.add(c.value)}return{status:e.value,value:l}}const a=[...r.data.values()].map((u,l)=>s._parse(new xn(r,u,r.path,l)));return r.common.async?Promise.all(a).then(u=>o(u)):o(a)}min(t,e){return new Fi({...this._def,minSize:{value:t,message:Z.toString(e)}})}max(t,e){return new Fi({...this._def,maxSize:{value:t,message:Z.toString(e)}})}size(t,e){return this.min(t,e).max(t,e)}nonempty(t){return this.min(1,t)}}Fi.create=(n,t)=>new Fi({valueType:n,minSize:null,maxSize:null,typeName:tt.ZodSet,...st(t)});class ts extends lt{constructor(){super(...arguments),this.validate=this.implement}_parse(t){const{ctx:e}=this._processInputParams(t);if(e.parsedType!==V.function)return U(e,{code:F.invalid_type,expected:V.function,received:e.parsedType}),rt;function r(a,u){return Oa({data:a,path:e.path,errorMaps:[e.common.contextualErrorMap,e.schemaErrorMap,Aa(),Is].filter(l=>!!l),issueData:{code:F.invalid_arguments,argumentsError:u}})}function i(a,u){return Oa({data:a,path:e.path,errorMaps:[e.common.contextualErrorMap,e.schemaErrorMap,Aa(),Is].filter(l=>!!l),issueData:{code:F.invalid_return_type,returnTypeError:u}})}const s={errorMap:e.common.contextualErrorMap},o=e.data;if(this._def.returns instanceof Ss){const a=this;return Ke(async function(...u){const l=new cr([]),c=await a._def.args.parseAsync(u,s).catch(f=>{throw l.addIssue(r(u,f)),l}),h=await Reflect.apply(o,this,c);return await a._def.returns._def.type.parseAsync(h,s).catch(f=>{throw l.addIssue(i(h,f)),l})})}else{const a=this;return Ke(function(...u){const l=a._def.args.safeParse(u,s);if(!l.success)throw new cr([r(u,l.error)]);const c=Reflect.apply(o,this,l.data),h=a._def.returns.safeParse(c,s);if(!h.success)throw new cr([i(c,h.error)]);return h.data})}}parameters(){return this._def.args}returnType(){return this._def.returns}args(...t){return new ts({...this._def,args:In.create(t).rest(wi.create())})}returns(t){return new ts({...this._def,returns:t})}implement(t){return this.parse(t)}strictImplement(t){return this.parse(t)}static create(t,e,r){return new ts({args:t||In.create([]).rest(wi.create()),returns:e||wi.create(),typeName:tt.ZodFunction,...st(r)})}}class wo extends lt{get schema(){return this._def.getter()}_parse(t){const{ctx:e}=this._processInputParams(t);return this._def.getter()._parse({data:e.data,path:e.path,parent:e})}}wo.create=(n,t)=>new wo({getter:n,typeName:tt.ZodLazy,...st(t)});class Eo extends lt{_parse(t){if(t.data!==this._def.value){const e=this._getOrReturnCtx(t);return U(e,{received:e.data,code:F.invalid_literal,expected:this._def.value}),rt}return{status:"valid",value:t.data}}get value(){return this._def.value}}Eo.create=(n,t)=>new Eo({value:n,typeName:tt.ZodLiteral,...st(t)});function hf(n,t){return new gi({values:n,typeName:tt.ZodEnum,...st(t)})}class gi extends lt{constructor(){super(...arguments),Xs.set(this,void 0)}_parse(t){if(typeof t.data!="string"){const e=this._getOrReturnCtx(t),r=this._def.values;return U(e,{expected:_t.joinValues(r),received:e.parsedType,code:F.invalid_type}),rt}if(Fa(this,Xs)||af(this,Xs,new Set(this._def.values)),!Fa(this,Xs).has(t.data)){const e=this._getOrReturnCtx(t),r=this._def.values;return U(e,{received:e.data,code:F.invalid_enum_value,options:r}),rt}return Ke(t.data)}get options(){return this._def.values}get enum(){const t={};for(const e of this._def.values)t[e]=e;return t}get Values(){const t={};for(const e of this._def.values)t[e]=e;return t}get Enum(){const t={};for(const e of this._def.values)t[e]=e;return t}extract(t,e=this._def){return gi.create(t,{...this._def,...e})}exclude(t,e=this._def){return gi.create(this.options.filter(r=>!t.includes(r)),{...this._def,...e})}}Xs=new WeakMap;gi.create=hf;class xo extends lt{constructor(){super(...arguments),Ys.set(this,void 0)}_parse(t){const e=_t.getValidEnumValues(this._def.values),r=this._getOrReturnCtx(t);if(r.parsedType!==V.string&&r.parsedType!==V.number){const i=_t.objectValues(e);return U(r,{expected:_t.joinValues(i),received:r.parsedType,code:F.invalid_type}),rt}if(Fa(this,Ys)||af(this,Ys,new Set(_t.getValidEnumValues(this._def.values))),!Fa(this,Ys).has(t.data)){const i=_t.objectValues(e);return U(r,{received:r.data,code:F.invalid_enum_value,options:i}),rt}return Ke(t.data)}get enum(){return this._def.values}}Ys=new WeakMap;xo.create=(n,t)=>new xo({values:n,typeName:tt.ZodNativeEnum,...st(t)});class Ss extends lt{unwrap(){return this._def.type}_parse(t){const{ctx:e}=this._processInputParams(t);if(e.parsedType!==V.promise&&e.common.async===!1)return U(e,{code:F.invalid_type,expected:V.promise,received:e.parsedType}),rt;const r=e.parsedType===V.promise?e.data:Promise.resolve(e.data);return Ke(r.then(i=>this._def.type.parseAsync(i,{path:e.path,errorMap:e.common.contextualErrorMap})))}}Ss.create=(n,t)=>new Ss({type:n,typeName:tt.ZodPromise,...st(t)});class an extends lt{innerType(){return this._def.schema}sourceType(){return this._def.schema._def.typeName===tt.ZodEffects?this._def.schema.sourceType():this._def.schema}_parse(t){const{status:e,ctx:r}=this._processInputParams(t),i=this._def.effect||null,s={addIssue:o=>{U(r,o),o.fatal?e.abort():e.dirty()},get path(){return r.path}};if(s.addIssue=s.addIssue.bind(s),i.type==="preprocess"){const o=i.transform(r.data,s);if(r.common.async)return Promise.resolve(o).then(async a=>{if(e.value==="aborted")return rt;const u=await this._def.schema._parseAsync({data:a,path:r.path,parent:r});return u.status==="aborted"?rt:u.status==="dirty"||e.value==="dirty"?Da(u.value):u});{if(e.value==="aborted")return rt;const a=this._def.schema._parseSync({data:o,path:r.path,parent:r});return a.status==="aborted"?rt:a.status==="dirty"||e.value==="dirty"?Da(a.value):a}}if(i.type==="refinement"){const o=a=>{const u=i.refinement(a,s);if(r.common.async)return Promise.resolve(u);if(u instanceof Promise)throw new Error("Async refinement encountered during synchronous parse operation. Use .parseAsync instead.");return a};if(r.common.async===!1){const a=this._def.schema._parseSync({data:r.data,path:r.path,parent:r});return a.status==="aborted"?rt:(a.status==="dirty"&&e.dirty(),o(a.value),{status:e.value,value:a.value})}else return this._def.schema._parseAsync({data:r.data,path:r.path,parent:r}).then(a=>a.status==="aborted"?rt:(a.status==="dirty"&&e.dirty(),o(a.value).then(()=>({status:e.value,value:a.value}))))}if(i.type==="transform")if(r.common.async===!1){const o=this._def.schema._parseSync({data:r.data,path:r.path,parent:r});if(!ho(o))return o;const a=i.transform(o.value,s);if(a instanceof Promise)throw new Error("Asynchronous transform encountered during synchronous parse operation. Use .parseAsync instead.");return{status:e.value,value:a}}else return this._def.schema._parseAsync({data:r.data,path:r.path,parent:r}).then(o=>ho(o)?Promise.resolve(i.transform(o.value,s)).then(a=>({status:e.value,value:a})):o);_t.assertNever(i)}}an.create=(n,t,e)=>new an({schema:n,typeName:tt.ZodEffects,effect:t,...st(e)});an.createWithPreprocess=(n,t,e)=>new an({schema:t,effect:{type:"preprocess",transform:n},typeName:tt.ZodEffects,...st(e)});class dn extends lt{_parse(t){return this._getType(t)===V.undefined?Ke(void 0):this._def.innerType._parse(t)}unwrap(){return this._def.innerType}}dn.create=(n,t)=>new dn({innerType:n,typeName:tt.ZodOptional,...st(t)});class di extends lt{_parse(t){return this._getType(t)===V.null?Ke(null):this._def.innerType._parse(t)}unwrap(){return this._def.innerType}}di.create=(n,t)=>new di({innerType:n,typeName:tt.ZodNullable,...st(t)});class Io extends lt{_parse(t){const{ctx:e}=this._processInputParams(t);let r=e.data;return e.parsedType===V.undefined&&(r=this._def.defaultValue()),this._def.innerType._parse({data:r,path:e.path,parent:e})}removeDefault(){return this._def.innerType}}Io.create=(n,t)=>new Io({innerType:n,typeName:tt.ZodDefault,defaultValue:typeof t.default=="function"?t.default:()=>t.default,...st(t)});class Co extends lt{_parse(t){const{ctx:e}=this._processInputParams(t),r={...e,common:{...e.common,issues:[]}},i=this._def.innerType._parse({data:r.data,path:r.path,parent:{...r}});return fo(i)?i.then(s=>({status:"valid",value:s.status==="valid"?s.value:this._def.catchValue({get error(){return new cr(r.common.issues)},input:r.data})})):{status:"valid",value:i.status==="valid"?i.value:this._def.catchValue({get error(){return new cr(r.common.issues)},input:r.data})}}removeCatch(){return this._def.innerType}}Co.create=(n,t)=>new Co({innerType:n,typeName:tt.ZodCatch,catchValue:typeof t.catch=="function"?t.catch:()=>t.catch,...st(t)});class za extends lt{_parse(t){if(this._getType(t)!==V.nan){const e=this._getOrReturnCtx(t);return U(e,{code:F.invalid_type,expected:V.nan,received:e.parsedType}),rt}return{status:"valid",value:t.data}}}za.create=n=>new za({typeName:tt.ZodNaN,...st(n)});const Jd=Symbol("zod_brand");class Ll extends lt{_parse(t){const{ctx:e}=this._processInputParams(t),r=e.data;return this._def.type._parse({data:r,path:e.path,parent:e})}unwrap(){return this._def.type}}class Fo extends lt{_parse(t){const{status:e,ctx:r}=this._processInputParams(t);if(r.common.async)return(async()=>{const i=await this._def.in._parseAsync({data:r.data,path:r.path,parent:r});return i.status==="aborted"?rt:i.status==="dirty"?(e.dirty(),Da(i.value)):this._def.out._parseAsync({data:i.value,path:r.path,parent:r})})();{const i=this._def.in._parseSync({data:r.data,path:r.path,parent:r});return i.status==="aborted"?rt:i.status==="dirty"?(e.dirty(),{status:"dirty",value:i.value}):this._def.out._parseSync({data:i.value,path:r.path,parent:r})}}static create(t,e){return new Fo({in:t,out:e,typeName:tt.ZodPipeline})}}class So extends lt{_parse(t){const e=this._def.innerType._parse(t),r=i=>(ho(i)&&(i.value=Object.freeze(i.value)),i);return fo(e)?e.then(i=>r(i)):r(e)}unwrap(){return this._def.innerType}}So.create=(n,t)=>new So({innerType:n,typeName:tt.ZodReadonly,...st(t)});function ff(n,t={},e){return n?Cs.create().superRefine((r,i)=>{var s,o;if(!n(r)){const a=typeof t=="function"?t(r):typeof t=="string"?{message:t}:t,u=(o=(s=a.fatal)!==null&&s!==void 0?s:e)!==null&&o!==void 0?o:!0,l=typeof a=="string"?{message:a}:a;i.addIssue({code:"custom",...l,fatal:u})}}):Cs.create()}const Qd={object:Wt.lazycreate};var tt;(function(n){n.ZodString="ZodString",n.ZodNumber="ZodNumber",n.ZodNaN="ZodNaN",n.ZodBigInt="ZodBigInt",n.ZodBoolean="ZodBoolean",n.ZodDate="ZodDate",n.ZodSymbol="ZodSymbol",n.ZodUndefined="ZodUndefined",n.ZodNull="ZodNull",n.ZodAny="ZodAny",n.ZodUnknown="ZodUnknown",n.ZodNever="ZodNever",n.ZodVoid="ZodVoid",n.ZodArray="ZodArray",n.ZodObject="ZodObject",n.ZodUnion="ZodUnion",n.ZodDiscriminatedUnion="ZodDiscriminatedUnion",n.ZodIntersection="ZodIntersection",n.ZodTuple="ZodTuple",n.ZodRecord="ZodRecord",n.ZodMap="ZodMap",n.ZodSet="ZodSet",n.ZodFunction="ZodFunction",n.ZodLazy="ZodLazy",n.ZodLiteral="ZodLiteral",n.ZodEnum="ZodEnum",n.ZodEffects="ZodEffects",n.ZodNativeEnum="ZodNativeEnum",n.ZodOptional="ZodOptional",n.ZodNullable="ZodNullable",n.ZodDefault="ZodDefault",n.ZodCatch="ZodCatch",n.ZodPromise="ZodPromise",n.ZodBranded="ZodBranded",n.ZodPipeline="ZodPipeline",n.ZodReadonly="ZodReadonly"})(tt||(tt={}));const $d=(n,t={message:`Input not instance of ${n.name}`})=>ff(e=>e instanceof n,t),pf=Xr.create,gf=fi.create,tm=za.create,em=pi.create,df=po.create,rm=Di.create,nm=ka.create,im=go.create,sm=mo.create,om=Cs.create,am=wi.create,um=Hn.create,lm=Ga.create,cm=Kr.create,hm=Wt.create,fm=Wt.strictCreate,pm=vo.create,gm=cu.create,dm=yo.create,mm=In.create,vm=_o.create,ym=Ba.create,_m=Fi.create,wm=ts.create,Em=wo.create,xm=Eo.create,Im=gi.create,Cm=xo.create,Sm=Ss.create,Fc=an.create,bm=dn.create,Mm=di.create,Nm=an.createWithPreprocess,Tm=Fo.create,Pm=()=>pf().optional(),Rm=()=>gf().optional(),Lm=()=>df().optional(),Am={string:n=>Xr.create({...n,coerce:!0}),number:n=>fi.create({...n,coerce:!0}),boolean:n=>po.create({...n,coerce:!0}),bigint:n=>pi.create({...n,coerce:!0}),date:n=>Di.create({...n,coerce:!0})},Om=rt;var C=Object.freeze({__proto__:null,defaultErrorMap:Is,setErrorMap:Od,getErrorMap:Aa,makeIssue:Oa,EMPTY_PATH:Dd,addIssueToContext:U,ParseStatus:Ue,INVALID:rt,DIRTY:Da,OK:Ke,isAborted:rl,isDirty:nl,isValid:ho,isAsync:fo,get util(){return _t},get objectUtil(){return el},ZodParsedType:V,getParsedType:ti,ZodType:lt,datetimeRegex:cf,ZodString:Xr,ZodNumber:fi,ZodBigInt:pi,ZodBoolean:po,ZodDate:Di,ZodSymbol:ka,ZodUndefined:go,ZodNull:mo,ZodAny:Cs,ZodUnknown:wi,ZodNever:Hn,ZodVoid:Ga,ZodArray:Kr,ZodObject:Wt,ZodUnion:vo,ZodDiscriminatedUnion:cu,ZodIntersection:yo,ZodTuple:In,ZodRecord:_o,ZodMap:Ba,ZodSet:Fi,ZodFunction:ts,ZodLazy:wo,ZodLiteral:Eo,ZodEnum:gi,ZodNativeEnum:xo,ZodPromise:Ss,ZodEffects:an,ZodTransformer:an,ZodOptional:dn,ZodNullable:di,ZodDefault:Io,ZodCatch:Co,ZodNaN:za,BRAND:Jd,ZodBranded:Ll,ZodPipeline:Fo,ZodReadonly:So,custom:ff,Schema:lt,ZodSchema:lt,late:Qd,get ZodFirstPartyTypeKind(){return tt},coerce:Am,any:om,array:cm,bigint:em,boolean:df,date:rm,discriminatedUnion:gm,effect:Fc,enum:Im,function:wm,instanceof:$d,intersection:dm,lazy:Em,literal:xm,map:ym,nan:tm,nativeEnum:Cm,never:um,null:sm,nullable:Mm,number:gf,object:hm,oboolean:Lm,onumber:Rm,optional:bm,ostring:Pm,pipeline:Tm,preprocess:Nm,promise:Sm,record:vm,set:_m,strictObject:fm,string:pf,symbol:nm,transformer:Fc,tuple:mm,undefined:im,union:pm,unknown:am,void:lm,NEVER:Om,ZodIssueCode:F,quotelessJson:Ad,ZodError:cr});const hu=/^https?:\/\/library.stanford.edu\/iiif\/image-api\/1.1\/compliance.html#level(?<level>[012])$/,mf=C.string().regex(hu),Dm=mf,Ua="http://library.stanford.edu/iiif/image-api/1.1/context.json",vf="http://iiif.io/api/image/1/context.json",yf=C.literal(Ua),_f=C.object({"@context":yf,"@id":C.string().url(),profile:mf.optional(),width:C.number().int(),height:C.number().int(),scale_factors:C.number().array().optional(),tile_width:C.number().optional(),tile_height:C.number().optional()}),wf=C.object({width:C.number().int(),height:C.number().int()}),Ef=C.object({width:C.number().int(),height:C.number().int().optional(),scaleFactors:C.array(C.number().int())}),Fm=["ImageService1","ImageService2","ImageService3"],xf=C.enum(Fm),fu=/^https?:\/\/iiif.io\/api\/image\/2.*level(?<level>[012])(.json)?$/,kc=C.string().regex(fu),km=C.object({formats:C.string().array().optional(),maxArea:C.number().int().optional(),maxHeight:C.number().int().optional(),maxWidth:C.number().int().optional(),qualities:C.string().array().optional(),supports:C.string().array().optional()}),ja=kc.or(C.array(C.union([kc,km,C.any()]))),Va="http://iiif.io/api/image/2/context.json",If=C.literal(Va).or(C.literal("https://iiif.io/api/image/2/context.json")),Al=C.object({"@id":C.string().url(),"@type":C.literal("iiif:Image").optional(),"@context":If,protocol:C.literal("http://iiif.io/api/image"),width:C.number().int(),height:C.number().int(),profile:ja,sizes:wf.array().optional(),tiles:Ef.array().optional()}),Gm=["level0","level1","level2"],Cf=C.enum(Gm),Ol=C.object({id:C.string().url(),type:C.literal("ImageService3"),protocol:C.literal("http://iiif.io/api/image"),profile:Cf,width:C.number().int(),height:C.number().int(),maxWidth:C.number().int().optional(),maxHeight:C.number().int().optional(),maxArea:C.number().int().optional(),sizes:wf.array().optional(),tiles:Ef.array().optional(),extraFeatures:C.string().array().optional()}),Bm=C.object({"@id":C.string().url(),"@type":xf.optional(),profile:Dm.or(ja).or(Cf),width:C.number().int().optional(),height:C.number().int().optional(),"@context":yf.or(C.literal("http://iiif.io/api/image/1/context.json")).or(If).optional()}),zm=["level0","level1","level2"],Um=C.object({id:C.string().url(),type:C.literal("ImageService2"),profile:ja}).or(C.object({"@id":C.string().url(),"@type":C.literal("ImageService2"),profile:ja})),jm=C.object({id:C.string().url(),type:xf,profile:C.enum(zm)}),Vm=C.union([Um,jm]),Sf=Bm.or(Vm),Gc=C.string().or(C.number()).or(C.boolean()),bf=Gc.or(Gc.array()),Bc=C.object({"@language":C.string().optional(),"@value":bf}),ki=bf.or(Bc).or(Bc.array()),qm=C.union([C.any(),C.object({label:ki.optional(),value:ki.optional()})]).transform(n=>{if(n&&typeof n=="object"&&"label"in n&&"value"in n)return n}),Mf=qm.array(),Wm=C.object({width:C.number().int().optional(),height:C.number().int().optional(),service:Sf}),Xm=C.object({resource:Wm}),Nf=C.object({"@id":C.string().url(),"@type":C.literal("sc:Canvas"),width:C.number().int(),height:C.number().int(),images:Xm.array().length(1),label:ki.optional(),metadata:Mf.optional()}),Ym=C.object({canvases:Nf.array().nonempty()}),Tf=C.object({"@id":C.string().url(),"@type":C.literal("sc:Manifest"),sequences:Ym.array().length(1),label:ki.optional(),description:ki.optional(),metadata:Mf.optional()}),zc=C.lazy(()=>C.object({"@id":C.string().url(),"@type":C.literal("sc:Manifest"),label:ki.optional()})),sl=C.lazy(()=>C.object({"@id":C.string().url(),"@type":C.literal("sc:Collection"),label:ki.optional(),manifests:zc.array().optional(),collections:sl.array().optional(),members:zc.or(sl).array().optional()})),Zm=C.string().or(C.number()).or(C.boolean()),Gi=C.record(C.string(),Zm.array()),Hm=C.union([C.any(),C.object({label:Gi.optional(),value:Gi.optional()})]).transform(n=>{if(n&&typeof n=="object"&&"label"in n&&"value"in n)return n}),Pf=Hm.array(),Uc=C.object({type:C.literal("Image"),width:C.number().int().optional(),height:C.number().int().optional(),service:Sf.array()}),Km=C.object({type:C.literal("Annotation"),body:Uc.or(Uc.array().length(1))}),Jm=C.object({type:C.literal("AnnotationPage"),items:Km.array().length(1)}),Rf=C.object({id:C.string().url(),type:C.literal("Canvas"),width:C.number().int(),height:C.number().int(),items:Jm.array().length(1),label:Gi.optional(),metadata:Pf.optional()}),Lf=C.object({id:C.string().url(),type:C.literal("Manifest"),items:Rf.array().nonempty(),label:Gi.optional(),description:Gi.optional(),metadata:Pf.optional()}),Qm=C.lazy(()=>C.object({id:C.string().url(),type:C.literal("Manifest"),label:Gi.optional()})),Af=C.lazy(()=>C.object({id:C.string().url(),type:C.literal("Collection"),label:Gi.optional(),items:Qm.or(Af).array()})),Of=_f.or(Al).or(Ol);Nf.or(Rf);const $m=Tf.or(Lf);sl.or(Af);Tf.or(Al);Lf.or(Ol);$m.or(Of);function Df({width:n,height:t},e,r,i){const s=r*e.originalWidth,o=i*e.originalHeight,a=r*e.originalWidth+e.width*e.scaleFactor>n?n-r*e.originalWidth:e.width*e.scaleFactor,u=i*e.originalHeight+e.height*e.scaleFactor>t?t-i*e.originalHeight:e.height*e.scaleFactor;let l=e.width,c=e.height;return s+e.width*e.scaleFactor>n&&(l=Math.floor((n-s+e.scaleFactor-1)/e.scaleFactor)),o+e.height*e.scaleFactor>t&&(c=Math.floor((t-o+e.scaleFactor-1)/e.scaleFactor)),{region:{x:s,y:o,width:a,height:u},size:{width:l,height:c}}}function tv({width:n,height:t},e=768){const r=Math.max(n,t)/e,i=Math.ceil(Math.log(r)/Math.log(2));return{scaleFactors:Array.from({length:i},(s,o)=>2**o),width:e}}function ev({width:n,height:t},e,r){const i=e.height||e.width,s=e.width*r,o=i*r;return{scaleFactor:r,width:e.width,height:i,originalWidth:s,originalHeight:o,columns:Math.ceil(n/s),rows:Math.ceil(t/o)}}function rv(n,t){return t.map(e=>e.scaleFactors.map(r=>ev(n,e,r))).flat()}function nv(n){return!!n.some(t=>t.width&&t.scaleFactors&&t.scaleFactors.length)}function iv(n,t,e){if(!t||!nv(t))if(e)t=[tv(n)];else throw new Error("Image does not support tiles or custom regions and sizes.");return rv(n,t)}function sv(n,t,e="cover"){if(e==="cover"||e==="contain"){const r=t.width/n.width,i=t.height/n.height,s=e==="cover"?Math.max(r,i):Math.min(r,i),o=n.width*s,a=n.height*s;return{width:o,height:a}}else throw new Error('Mode must be either "cover" or "contain"')}const ov=.8,av=1.5;function Ff(n,t,e="cover",{sizes:r,tileZoomLevels:i,supportsAnyRegionAndSize:s,maxWidth:o,maxHeight:a,maxArea:u}){let{width:l,height:c}=sv(n,t,e);if(o&&l>o&&(c=c/l*o,l=o),a&&c>a&&(l=l/c*a,c=a),u&&l*c>u){const f=c/l,p=Math.floor(Math.sqrt(u/f))*f;l=Math.floor(p)/f,c=l*f}const h=n.width/n.height;if(l=Math.floor(l),c=Math.round(l/h),r){let f;for(const p of r){const d=p.width/l;if(d>=ov&&d<=av){f=p;break}}if(f)return{size:f}}if(s)return{size:{width:Math.round(l),height:Math.round(c)}};if(i){const f=n.width/l,p=i.map(({scaleFactor:x},g)=>({index:g,scaleFactor:x,diff:Math.abs(x-f)})).sort((x,g)=>x.diff-g.diff),d=i[p[0].index],_=Math.ceil(n.width/(d.scaleFactor*i[0].width)),w=Math.ceil(n.height/(d.scaleFactor*i[0].height)),y=[];for(let x=0;x<w;x++){const g=[];for(let m=0;m<_;m++){const E=Df(n,d,m,x);g.push(E)}y.push(g)}return y}throw new Error("Unable to create thumbnail")}const kf=["regionByPx","sizeByWh"];function uv(n){const t=n.match(hu);if(t&&t.groups)return parseInt(t.groups.level)}function jc(n){const t=n.match(fu);if(t&&t.groups)return parseInt(t.groups.level)}function lv(n){return{maxWidth:n==null?void 0:n.maxWidth,maxHeight:n==null?void 0:n.maxHeight,maxArea:n==null?void 0:n.maxArea,supportsAnyRegionAndSize:kf.every(t=>{var e;return(n==null?void 0:n.supports)&&((e=n==null?void 0:n.supports)==null?void 0:e.includes(t))})}}function cv(n){if("type"in n&&n.type==="ImageService3")return 3;if("type"in n&&n.type==="ImageService2"||"@type"in n&&n["@type"]==="ImageService2"||"@context"in n&&n["@context"]===Va)return 2;if("@context"in n&&(n["@context"]===Ua||n["@context"]===vf))return 1;if("profile"in n){let t;return Array.isArray(n.profile)?t=n.profile[0]:t=n.profile,t.match(hu)?1:t.match(fu)?2:3}else throw new Error("Unsupported IIIF Image Service")}function ol(n){if("type"in n||"@type"in n){const t=n.profile;let e=!1;return t==="level0"||typeof t=="string"&&t.endsWith("level0.json")?"extraFeatures"in n&&(e=kf.every(r=>n.extraFeatures&&n.extraFeatures.includes(r))):e=!0,{maxWidth:"maxWidth"in n?n.maxWidth:void 0,maxHeight:"maxHeight"in n?n.maxHeight:void 0,maxArea:"maxArea"in n?n.maxArea:void 0,supportsAnyRegionAndSize:e}}else if(Array.isArray(n.profile)){let t=!1,e=Number.NEGATIVE_INFINITY,r=Number.NEGATIVE_INFINITY,i=Number.NEGATIVE_INFINITY;return n.profile.forEach(s=>{if(typeof s=="string"){const o=jc(s);o&&(t=t||o>=1)}else{const{maxWidth:o,maxHeight:a,maxArea:u,supportsAnyRegionAndSize:l}=lv(s);o!==void 0&&(r=Math.max(o,r)),a!==void 0&&(e=Math.max(a,e)),u!==void 0&&(i=Math.max(u,i)),t=t||l}}),{maxWidth:r>=0?r:void 0,maxHeight:e>=0?e:void 0,maxArea:i>=0?i:void 0,supportsAnyRegionAndSize:t}}else if("profile"in n&&n.profile){const t=uv(n.profile),e=jc(n.profile);return t?{supportsAnyRegionAndSize:t>=1}:e?{supportsAnyRegionAndSize:e>=1}:{supportsAnyRegionAndSize:!1}}else throw new Error("Invalid Image")}const hv="image";class fv{constructor(t,e){M(this,"embedded",!0);M(this,"uri");M(this,"type",hv);M(this,"maxWidth");M(this,"maxHeight");M(this,"maxArea");M(this,"supportsAnyRegionAndSize");M(this,"width");M(this,"height");M(this,"majorVersion");if(e){const r=t;let i,s;if(Array.isArray(r.service)?r.service.forEach(o=>{try{const a=cv(o);(!s||a>s)&&(s=a,i=o)}catch{}}):i=r.service,!i)throw new Error("Unsupported IIIF Image Service");if("@id"in i)this.uri=i["@id"];else if("id"in i)this.uri=i.id;else throw new Error("Unsupported IIIF Image Service");if("type"in i&&i.type==="ImageService3")this.majorVersion=3;else if("type"in i&&i.type==="ImageService2"||"@type"in i&&i["@type"]==="ImageService2"||"@context"in i&&i["@context"]===Va)this.majorVersion=2;else if("@context"in i&&(i["@context"]===Ua||i["@context"]===vf))this.majorVersion=1;else if("profile"in i){let o;Array.isArray(i.profile)?o=i.profile[0]:o=i.profile,o.match(hu)?this.majorVersion=1:o.match(fu)?this.majorVersion=2:this.majorVersion=3}else throw new Error("Unsupported IIIF Image Service");if("profile"in i){const o=ol(i);this.supportsAnyRegionAndSize=o.supportsAnyRegionAndSize,this.maxWidth=o.maxWidth,this.maxHeight=o.maxHeight,this.maxArea=o.maxArea}else this.supportsAnyRegionAndSize=!1}else{if("@id"in t)this.uri=t["@id"];else if("id"in t)this.uri=t.id;else throw new Error("Unsupported IIIF Image");if("type"in t&&t.type==="ImageService3")this.majorVersion=3;else if("@type"in t&&t["@type"]==="iiif:Image"||"@context"in t&&t["@context"]===Va)this.majorVersion=2;else if("@context"in t&&t["@context"]===Ua)this.majorVersion=1;else throw new Error("Unsupported IIIF Image");if("profile"in t){const r=ol(t);this.supportsAnyRegionAndSize=r.supportsAnyRegionAndSize,this.maxWidth=r.maxWidth,this.maxHeight=r.maxHeight,this.maxArea=r.maxArea}else this.supportsAnyRegionAndSize=!1}if(t.width!==void 0)this.width=t.width;else if(e)this.width=e.width;else throw new Error("Width not present on either Canvas or Image Resource");if(t.height!==void 0)this.height=t.height;else if(e)this.height=e.height;else throw new Error("Height not present on either Canvas or Image Resource")}getImageUrl(t){const{region:e,size:r}=t;let i,s,o,a,u;e?(u=`${e.x},${e.y},${e.width},${e.height}`,o=e.height,a=e.width):(u="full",o=this.height,a=this.width);let l;if(r){i=Math.round(r.width),s=Math.round(r.height);const f=String(i);let p=String(s);const d=a/o,_=s*d/d;s===Math.round(_)&&(p=""),l=`${f},${p}`}else i=this.width,s=this.height,l=this.majorVersion===2?"full":"max";const c=i*s;if(this.maxWidth!==void 0&&i>this.maxWidth)throw new Error(`Width of requested image is too large: ${i} > ${this.maxWidth}`);if(this.maxHeight!==void 0&&s>this.maxHeight)throw new Error(`Height of requested image is too large: ${s} > ${this.maxHeight}`);if(this.maxArea!==void 0&&c>this.maxArea)throw new Error(`Area of requested image is too large: ${c} > ${this.maxArea}`);const h=this.majorVersion===1?"native":"default";return`${this.uri}/${u}/${l}/0/${h}.jpg`}getThumbnail(t,e="cover"){return Ff({width:this.width,height:this.height},t,e,{supportsAnyRegionAndSize:this.supportsAnyRegionAndSize,maxWidth:this.maxWidth,maxHeight:this.maxHeight,maxArea:this.maxArea})}}class Dl extends fv{constructor(e){super(e);M(this,"tileZoomLevels");M(this,"sizes");M(this,"embedded",!1);const r=ol(e);let i;"tiles"in e&&(i=e.tiles),this.tileZoomLevels=iv({width:this.width,height:this.height},i,r.supportsAnyRegionAndSize),"sizes"in e&&(this.sizes=e.sizes)}static parse(e,r=null){let i;return r===1?i=_f.parse(e):r===2?i=Al.parse(e):r===3?i=Ol.parse(e):i=Of.parse(e),new Dl(i)}getIiifTile(e,r,i){return Df({width:this.width,height:this.height},e,r,i)}getThumbnail(e,r="cover"){return Ff({width:this.width,height:this.height},e,r,{supportsAnyRegionAndSize:this.supportsAnyRegionAndSize,sizes:this.sizes,tileZoomLevels:this.tileZoomLevels,maxWidth:this.maxWidth,maxHeight:this.maxHeight,maxArea:this.maxArea})}}const Vc=C.record(C.string(),C.string().array());C.object({label:Vc.optional(),value:Vc.optional()});var Je=63710088e-1,Gf={centimeters:Je*100,centimetres:Je*100,degrees:Je/111325,feet:Je*3.28084,inches:Je*39.37,kilometers:Je/1e3,kilometres:Je/1e3,meters:Je,metres:Je,miles:Je/1609.344,millimeters:Je*1e3,millimetres:Je*1e3,nauticalmiles:Je/1852,radians:1,yards:Je*1.0936};function pv(n,t,e){e===void 0&&(e={});var r={type:"Feature"};return(e.id===0||e.id)&&(r.id=e.id),e.bbox&&(r.bbox=e.bbox),r.properties=t||{},r.geometry=n,r}function gv(n,t,e){if(e===void 0&&(e={}),!n)throw new Error("coordinates is required");if(!Array.isArray(n))throw new Error("coordinates must be an Array");if(n.length<2)throw new Error("coordinates must be at least 2 numbers long");if(!qc(n[0])||!qc(n[1]))throw new Error("coordinates must contain numbers");var r={type:"Point",coordinates:n};return pv(r,t,e)}function dv(n,t){t===void 0&&(t="kilometers");var e=Gf[t];if(!e)throw new Error(t+" units is invalid");return n*e}function mv(n,t){t===void 0&&(t="kilometers");var e=Gf[t];if(!e)throw new Error(t+" units is invalid");return n/e}function al(n){var t=n%(2*Math.PI);return t*180/Math.PI}function Yr(n){var t=n%360;return t*Math.PI/180}function qc(n){return!isNaN(n)&&n!==null&&!Array.isArray(n)}function bs(n){if(!n)throw new Error("coord is required");if(!Array.isArray(n)){if(n.type==="Feature"&&n.geometry!==null&&n.geometry.type==="Point")return n.geometry.coordinates;if(n.type==="Point")return n.coordinates}if(Array.isArray(n)&&n.length>=2&&!Array.isArray(n[0])&&!Array.isArray(n[1]))return n;throw new Error("coord must be GeoJSON Point or an Array of numbers")}function vv(n){return n.type==="Feature"?n.geometry:n}function Bf(n,t,e){if(e===void 0&&(e={}),e.final===!0)return yv(n,t);var r=bs(n),i=bs(t),s=Yr(r[0]),o=Yr(i[0]),a=Yr(r[1]),u=Yr(i[1]),l=Math.sin(o-s)*Math.cos(u),c=Math.cos(a)*Math.sin(u)-Math.sin(a)*Math.cos(u)*Math.cos(o-s);return al(Math.atan2(l,c))}function yv(n,t){var e=Bf(t,n);return e=(e+180)%360,e}function _v(n,t,e,r){r===void 0&&(r={});var i=bs(n),s=Yr(i[0]),o=Yr(i[1]),a=Yr(e),u=mv(t,r.units),l=Math.asin(Math.sin(o)*Math.cos(u)+Math.cos(o)*Math.sin(u)*Math.cos(a)),c=s+Math.atan2(Math.sin(a)*Math.sin(u)*Math.cos(o),Math.cos(u)-Math.sin(o)*Math.sin(l)),h=al(c),f=al(l);return gv([h,f],r.properties)}function Fl(n,t,e){e===void 0&&(e={});var r=bs(n),i=bs(t),s=Yr(i[1]-r[1]),o=Yr(i[0]-r[0]),a=Yr(r[1]),u=Yr(i[1]),l=Math.pow(Math.sin(s/2),2)+Math.pow(Math.sin(o/2),2)*Math.cos(a)*Math.cos(u);return dv(2*Math.atan2(Math.sqrt(l),Math.sqrt(1-l)),e.units)}function qa(n,t){var e=Fl(n,t),r=Bf(n,t),i=_v(n,e/2,r);return i}function zf(n){if(n.__esModule)return n;var t=n.default;if(typeof t=="function"){var e=function r(){return this instanceof r?Reflect.construct(t,arguments,this.constructor):t.apply(this,arguments)};e.prototype=t.prototype}else e={};return Object.defineProperty(e,"__esModule",{value:!0}),Object.keys(n).forEach(function(r){var i=Object.getOwnPropertyDescriptor(n,r);Object.defineProperty(e,r,i.get?i:{enumerable:!0,get:function(){return n[r]}})}),e}var mt={};const wv=Object.prototype.toString;function bo(n){const t=wv.call(n);return t.endsWith("Array]")&&!t.includes("Big")}const Ev=Object.freeze(Object.defineProperty({__proto__:null,isAnyArray:bo},Symbol.toStringTag,{value:"Module"})),xv=zf(Ev);function Iv(n){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(!bo(n))throw new TypeError("input must be an array");if(n.length===0)throw new TypeError("input must not be empty");var e=t.fromIndex,r=e===void 0?0:e,i=t.toIndex,s=i===void 0?n.length:i;if(r<0||r>=n.length||!Number.isInteger(r))throw new Error("fromIndex must be a positive integer smaller than length");if(s<=r||s>n.length||!Number.isInteger(s))throw new Error("toIndex must be an integer greater than fromIndex and at most equal to length");for(var o=n[r],a=r+1;a<s;a++)n[a]>o&&(o=n[a]);return o}function Cv(n){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(!bo(n))throw new TypeError("input must be an array");if(n.length===0)throw new TypeError("input must not be empty");var e=t.fromIndex,r=e===void 0?0:e,i=t.toIndex,s=i===void 0?n.length:i;if(r<0||r>=n.length||!Number.isInteger(r))throw new Error("fromIndex must be a positive integer smaller than length");if(s<=r||s>n.length||!Number.isInteger(s))throw new Error("toIndex must be an integer greater than fromIndex and at most equal to length");for(var o=n[r],a=r+1;a<s;a++)n[a]<o&&(o=n[a]);return o}function Sv(n){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(bo(n)){if(n.length===0)throw new TypeError("input must not be empty")}else throw new TypeError("input must be an array");var e;if(t.output!==void 0){if(!bo(t.output))throw new TypeError("output option must be an array if specified");e=t.output}else e=new Array(n.length);var r=Cv(n),i=Iv(n);if(r===i)throw new RangeError("minimum and maximum input values are equal. Cannot rescale a constant array");var s=t.min,o=s===void 0?t.autoMinMax?r:0:s,a=t.max,u=a===void 0?t.autoMinMax?i:1:a;if(o>=u)throw new RangeError("min option must be smaller than max option");for(var l=(u-o)/(i-r),c=0;c<n.length;c++)e[c]=(n[c]-r)*l+o;return e}const bv=Object.freeze(Object.defineProperty({__proto__:null,default:Sv},Symbol.toStringTag,{value:"Module"})),Mv=zf(bv);Object.defineProperty(mt,"__esModule",{value:!0});var Qe=xv,Wc=Mv;const na=" ".repeat(2),Uf=" ".repeat(4);function Nv(){return jf(this)}function jf(n,t={}){const{maxRows:e=15,maxColumns:r=10,maxNumSize:i=8,padMinus:s="auto"}=t;return`${n.constructor.name} {
${na}[
${Uf}${Tv(n,e,r,i,s)}
${na}]
${na}rows: ${n.rows}
${na}columns: ${n.columns}
}`}function Tv(n,t,e,r,i){const{rows:s,columns:o}=n,a=Math.min(s,t),u=Math.min(o,e),l=[];if(i==="auto"){i=!1;t:for(let c=0;c<a;c++)for(let h=0;h<u;h++)if(n.get(c,h)<0){i=!0;break t}}for(let c=0;c<a;c++){let h=[];for(let f=0;f<u;f++)h.push(Pv(n.get(c,f),r,i));l.push(`${h.join(" ")}`)}return u!==o&&(l[l.length-1]+=` ... ${o-e} more columns`),a!==s&&l.push(`... ${s-t} more rows`),l.join(`
${Uf}`)}function Pv(n,t,e){return(n>=0&&e?` ${Xc(n,t-1)}`:Xc(n,t)).padEnd(t)}function Xc(n,t){let e=n.toString();if(e.length<=t)return e;let r=n.toFixed(t);if(r.length>t&&(r=n.toFixed(Math.max(0,t-(r.length-t)))),r.length<=t&&!r.startsWith("0.000")&&!r.startsWith("-0.000"))return r;let i=n.toExponential(t);return i.length>t&&(i=n.toExponential(Math.max(0,t-(i.length-t)))),i.slice(0)}function Rv(n,t){n.prototype.add=function(e){return typeof e=="number"?this.addS(e):this.addM(e)},n.prototype.addS=function(e){for(let r=0;r<this.rows;r++)for(let i=0;i<this.columns;i++)this.set(r,i,this.get(r,i)+e);return this},n.prototype.addM=function(e){if(e=t.checkMatrix(e),this.rows!==e.rows||this.columns!==e.columns)throw new RangeError("Matrices dimensions must be equal");for(let r=0;r<this.rows;r++)for(let i=0;i<this.columns;i++)this.set(r,i,this.get(r,i)+e.get(r,i));return this},n.add=function(e,r){return new t(e).add(r)},n.prototype.sub=function(e){return typeof e=="number"?this.subS(e):this.subM(e)},n.prototype.subS=function(e){for(let r=0;r<this.rows;r++)for(let i=0;i<this.columns;i++)this.set(r,i,this.get(r,i)-e);return this},n.prototype.subM=function(e){if(e=t.checkMatrix(e),this.rows!==e.rows||this.columns!==e.columns)throw new RangeError("Matrices dimensions must be equal");for(let r=0;r<this.rows;r++)for(let i=0;i<this.columns;i++)this.set(r,i,this.get(r,i)-e.get(r,i));return this},n.sub=function(e,r){return new t(e).sub(r)},n.prototype.subtract=n.prototype.sub,n.prototype.subtractS=n.prototype.subS,n.prototype.subtractM=n.prototype.subM,n.subtract=n.sub,n.prototype.mul=function(e){return typeof e=="number"?this.mulS(e):this.mulM(e)},n.prototype.mulS=function(e){for(let r=0;r<this.rows;r++)for(let i=0;i<this.columns;i++)this.set(r,i,this.get(r,i)*e);return this},n.prototype.mulM=function(e){if(e=t.checkMatrix(e),this.rows!==e.rows||this.columns!==e.columns)throw new RangeError("Matrices dimensions must be equal");for(let r=0;r<this.rows;r++)for(let i=0;i<this.columns;i++)this.set(r,i,this.get(r,i)*e.get(r,i));return this},n.mul=function(e,r){return new t(e).mul(r)},n.prototype.multiply=n.prototype.mul,n.prototype.multiplyS=n.prototype.mulS,n.prototype.multiplyM=n.prototype.mulM,n.multiply=n.mul,n.prototype.div=function(e){return typeof e=="number"?this.divS(e):this.divM(e)},n.prototype.divS=function(e){for(let r=0;r<this.rows;r++)for(let i=0;i<this.columns;i++)this.set(r,i,this.get(r,i)/e);return this},n.prototype.divM=function(e){if(e=t.checkMatrix(e),this.rows!==e.rows||this.columns!==e.columns)throw new RangeError("Matrices dimensions must be equal");for(let r=0;r<this.rows;r++)for(let i=0;i<this.columns;i++)this.set(r,i,this.get(r,i)/e.get(r,i));return this},n.div=function(e,r){return new t(e).div(r)},n.prototype.divide=n.prototype.div,n.prototype.divideS=n.prototype.divS,n.prototype.divideM=n.prototype.divM,n.divide=n.div,n.prototype.mod=function(e){return typeof e=="number"?this.modS(e):this.modM(e)},n.prototype.modS=function(e){for(let r=0;r<this.rows;r++)for(let i=0;i<this.columns;i++)this.set(r,i,this.get(r,i)%e);return this},n.prototype.modM=function(e){if(e=t.checkMatrix(e),this.rows!==e.rows||this.columns!==e.columns)throw new RangeError("Matrices dimensions must be equal");for(let r=0;r<this.rows;r++)for(let i=0;i<this.columns;i++)this.set(r,i,this.get(r,i)%e.get(r,i));return this},n.mod=function(e,r){return new t(e).mod(r)},n.prototype.modulus=n.prototype.mod,n.prototype.modulusS=n.prototype.modS,n.prototype.modulusM=n.prototype.modM,n.modulus=n.mod,n.prototype.and=function(e){return typeof e=="number"?this.andS(e):this.andM(e)},n.prototype.andS=function(e){for(let r=0;r<this.rows;r++)for(let i=0;i<this.columns;i++)this.set(r,i,this.get(r,i)&e);return this},n.prototype.andM=function(e){if(e=t.checkMatrix(e),this.rows!==e.rows||this.columns!==e.columns)throw new RangeError("Matrices dimensions must be equal");for(let r=0;r<this.rows;r++)for(let i=0;i<this.columns;i++)this.set(r,i,this.get(r,i)&e.get(r,i));return this},n.and=function(e,r){return new t(e).and(r)},n.prototype.or=function(e){return typeof e=="number"?this.orS(e):this.orM(e)},n.prototype.orS=function(e){for(let r=0;r<this.rows;r++)for(let i=0;i<this.columns;i++)this.set(r,i,this.get(r,i)|e);return this},n.prototype.orM=function(e){if(e=t.checkMatrix(e),this.rows!==e.rows||this.columns!==e.columns)throw new RangeError("Matrices dimensions must be equal");for(let r=0;r<this.rows;r++)for(let i=0;i<this.columns;i++)this.set(r,i,this.get(r,i)|e.get(r,i));return this},n.or=function(e,r){return new t(e).or(r)},n.prototype.xor=function(e){return typeof e=="number"?this.xorS(e):this.xorM(e)},n.prototype.xorS=function(e){for(let r=0;r<this.rows;r++)for(let i=0;i<this.columns;i++)this.set(r,i,this.get(r,i)^e);return this},n.prototype.xorM=function(e){if(e=t.checkMatrix(e),this.rows!==e.rows||this.columns!==e.columns)throw new RangeError("Matrices dimensions must be equal");for(let r=0;r<this.rows;r++)for(let i=0;i<this.columns;i++)this.set(r,i,this.get(r,i)^e.get(r,i));return this},n.xor=function(e,r){return new t(e).xor(r)},n.prototype.leftShift=function(e){return typeof e=="number"?this.leftShiftS(e):this.leftShiftM(e)},n.prototype.leftShiftS=function(e){for(let r=0;r<this.rows;r++)for(let i=0;i<this.columns;i++)this.set(r,i,this.get(r,i)<<e);return this},n.prototype.leftShiftM=function(e){if(e=t.checkMatrix(e),this.rows!==e.rows||this.columns!==e.columns)throw new RangeError("Matrices dimensions must be equal");for(let r=0;r<this.rows;r++)for(let i=0;i<this.columns;i++)this.set(r,i,this.get(r,i)<<e.get(r,i));return this},n.leftShift=function(e,r){return new t(e).leftShift(r)},n.prototype.signPropagatingRightShift=function(e){return typeof e=="number"?this.signPropagatingRightShiftS(e):this.signPropagatingRightShiftM(e)},n.prototype.signPropagatingRightShiftS=function(e){for(let r=0;r<this.rows;r++)for(let i=0;i<this.columns;i++)this.set(r,i,this.get(r,i)>>e);return this},n.prototype.signPropagatingRightShiftM=function(e){if(e=t.checkMatrix(e),this.rows!==e.rows||this.columns!==e.columns)throw new RangeError("Matrices dimensions must be equal");for(let r=0;r<this.rows;r++)for(let i=0;i<this.columns;i++)this.set(r,i,this.get(r,i)>>e.get(r,i));return this},n.signPropagatingRightShift=function(e,r){return new t(e).signPropagatingRightShift(r)},n.prototype.rightShift=function(e){return typeof e=="number"?this.rightShiftS(e):this.rightShiftM(e)},n.prototype.rightShiftS=function(e){for(let r=0;r<this.rows;r++)for(let i=0;i<this.columns;i++)this.set(r,i,this.get(r,i)>>>e);return this},n.prototype.rightShiftM=function(e){if(e=t.checkMatrix(e),this.rows!==e.rows||this.columns!==e.columns)throw new RangeError("Matrices dimensions must be equal");for(let r=0;r<this.rows;r++)for(let i=0;i<this.columns;i++)this.set(r,i,this.get(r,i)>>>e.get(r,i));return this},n.rightShift=function(e,r){return new t(e).rightShift(r)},n.prototype.zeroFillRightShift=n.prototype.rightShift,n.prototype.zeroFillRightShiftS=n.prototype.rightShiftS,n.prototype.zeroFillRightShiftM=n.prototype.rightShiftM,n.zeroFillRightShift=n.rightShift,n.prototype.not=function(){for(let e=0;e<this.rows;e++)for(let r=0;r<this.columns;r++)this.set(e,r,~this.get(e,r));return this},n.not=function(e){return new t(e).not()},n.prototype.abs=function(){for(let e=0;e<this.rows;e++)for(let r=0;r<this.columns;r++)this.set(e,r,Math.abs(this.get(e,r)));return this},n.abs=function(e){return new t(e).abs()},n.prototype.acos=function(){for(let e=0;e<this.rows;e++)for(let r=0;r<this.columns;r++)this.set(e,r,Math.acos(this.get(e,r)));return this},n.acos=function(e){return new t(e).acos()},n.prototype.acosh=function(){for(let e=0;e<this.rows;e++)for(let r=0;r<this.columns;r++)this.set(e,r,Math.acosh(this.get(e,r)));return this},n.acosh=function(e){return new t(e).acosh()},n.prototype.asin=function(){for(let e=0;e<this.rows;e++)for(let r=0;r<this.columns;r++)this.set(e,r,Math.asin(this.get(e,r)));return this},n.asin=function(e){return new t(e).asin()},n.prototype.asinh=function(){for(let e=0;e<this.rows;e++)for(let r=0;r<this.columns;r++)this.set(e,r,Math.asinh(this.get(e,r)));return this},n.asinh=function(e){return new t(e).asinh()},n.prototype.atan=function(){for(let e=0;e<this.rows;e++)for(let r=0;r<this.columns;r++)this.set(e,r,Math.atan(this.get(e,r)));return this},n.atan=function(e){return new t(e).atan()},n.prototype.atanh=function(){for(let e=0;e<this.rows;e++)for(let r=0;r<this.columns;r++)this.set(e,r,Math.atanh(this.get(e,r)));return this},n.atanh=function(e){return new t(e).atanh()},n.prototype.cbrt=function(){for(let e=0;e<this.rows;e++)for(let r=0;r<this.columns;r++)this.set(e,r,Math.cbrt(this.get(e,r)));return this},n.cbrt=function(e){return new t(e).cbrt()},n.prototype.ceil=function(){for(let e=0;e<this.rows;e++)for(let r=0;r<this.columns;r++)this.set(e,r,Math.ceil(this.get(e,r)));return this},n.ceil=function(e){return new t(e).ceil()},n.prototype.clz32=function(){for(let e=0;e<this.rows;e++)for(let r=0;r<this.columns;r++)this.set(e,r,Math.clz32(this.get(e,r)));return this},n.clz32=function(e){return new t(e).clz32()},n.prototype.cos=function(){for(let e=0;e<this.rows;e++)for(let r=0;r<this.columns;r++)this.set(e,r,Math.cos(this.get(e,r)));return this},n.cos=function(e){return new t(e).cos()},n.prototype.cosh=function(){for(let e=0;e<this.rows;e++)for(let r=0;r<this.columns;r++)this.set(e,r,Math.cosh(this.get(e,r)));return this},n.cosh=function(e){return new t(e).cosh()},n.prototype.exp=function(){for(let e=0;e<this.rows;e++)for(let r=0;r<this.columns;r++)this.set(e,r,Math.exp(this.get(e,r)));return this},n.exp=function(e){return new t(e).exp()},n.prototype.expm1=function(){for(let e=0;e<this.rows;e++)for(let r=0;r<this.columns;r++)this.set(e,r,Math.expm1(this.get(e,r)));return this},n.expm1=function(e){return new t(e).expm1()},n.prototype.floor=function(){for(let e=0;e<this.rows;e++)for(let r=0;r<this.columns;r++)this.set(e,r,Math.floor(this.get(e,r)));return this},n.floor=function(e){return new t(e).floor()},n.prototype.fround=function(){for(let e=0;e<this.rows;e++)for(let r=0;r<this.columns;r++)this.set(e,r,Math.fround(this.get(e,r)));return this},n.fround=function(e){return new t(e).fround()},n.prototype.log=function(){for(let e=0;e<this.rows;e++)for(let r=0;r<this.columns;r++)this.set(e,r,Math.log(this.get(e,r)));return this},n.log=function(e){return new t(e).log()},n.prototype.log1p=function(){for(let e=0;e<this.rows;e++)for(let r=0;r<this.columns;r++)this.set(e,r,Math.log1p(this.get(e,r)));return this},n.log1p=function(e){return new t(e).log1p()},n.prototype.log10=function(){for(let e=0;e<this.rows;e++)for(let r=0;r<this.columns;r++)this.set(e,r,Math.log10(this.get(e,r)));return this},n.log10=function(e){return new t(e).log10()},n.prototype.log2=function(){for(let e=0;e<this.rows;e++)for(let r=0;r<this.columns;r++)this.set(e,r,Math.log2(this.get(e,r)));return this},n.log2=function(e){return new t(e).log2()},n.prototype.round=function(){for(let e=0;e<this.rows;e++)for(let r=0;r<this.columns;r++)this.set(e,r,Math.round(this.get(e,r)));return this},n.round=function(e){return new t(e).round()},n.prototype.sign=function(){for(let e=0;e<this.rows;e++)for(let r=0;r<this.columns;r++)this.set(e,r,Math.sign(this.get(e,r)));return this},n.sign=function(e){return new t(e).sign()},n.prototype.sin=function(){for(let e=0;e<this.rows;e++)for(let r=0;r<this.columns;r++)this.set(e,r,Math.sin(this.get(e,r)));return this},n.sin=function(e){return new t(e).sin()},n.prototype.sinh=function(){for(let e=0;e<this.rows;e++)for(let r=0;r<this.columns;r++)this.set(e,r,Math.sinh(this.get(e,r)));return this},n.sinh=function(e){return new t(e).sinh()},n.prototype.sqrt=function(){for(let e=0;e<this.rows;e++)for(let r=0;r<this.columns;r++)this.set(e,r,Math.sqrt(this.get(e,r)));return this},n.sqrt=function(e){return new t(e).sqrt()},n.prototype.tan=function(){for(let e=0;e<this.rows;e++)for(let r=0;r<this.columns;r++)this.set(e,r,Math.tan(this.get(e,r)));return this},n.tan=function(e){return new t(e).tan()},n.prototype.tanh=function(){for(let e=0;e<this.rows;e++)for(let r=0;r<this.columns;r++)this.set(e,r,Math.tanh(this.get(e,r)));return this},n.tanh=function(e){return new t(e).tanh()},n.prototype.trunc=function(){for(let e=0;e<this.rows;e++)for(let r=0;r<this.columns;r++)this.set(e,r,Math.trunc(this.get(e,r)));return this},n.trunc=function(e){return new t(e).trunc()},n.pow=function(e,r){return new t(e).pow(r)},n.prototype.pow=function(e){return typeof e=="number"?this.powS(e):this.powM(e)},n.prototype.powS=function(e){for(let r=0;r<this.rows;r++)for(let i=0;i<this.columns;i++)this.set(r,i,Math.pow(this.get(r,i),e));return this},n.prototype.powM=function(e){if(e=t.checkMatrix(e),this.rows!==e.rows||this.columns!==e.columns)throw new RangeError("Matrices dimensions must be equal");for(let r=0;r<this.rows;r++)for(let i=0;i<this.columns;i++)this.set(r,i,Math.pow(this.get(r,i),e.get(r,i)));return this}}function Ir(n,t,e){let r=e?n.rows:n.rows-1;if(t<0||t>r)throw new RangeError("Row index out of range")}function Cr(n,t,e){let r=e?n.columns:n.columns-1;if(t<0||t>r)throw new RangeError("Column index out of range")}function Hi(n,t){if(t.to1DArray&&(t=t.to1DArray()),t.length!==n.columns)throw new RangeError("vector size must be the same as the number of columns");return t}function Ki(n,t){if(t.to1DArray&&(t=t.to1DArray()),t.length!==n.rows)throw new RangeError("vector size must be the same as the number of rows");return t}function kl(n,t){if(!Qe.isAnyArray(t))throw new TypeError("row indices must be an array");for(let e=0;e<t.length;e++)if(t[e]<0||t[e]>=n.rows)throw new RangeError("row indices are out of range")}function Gl(n,t){if(!Qe.isAnyArray(t))throw new TypeError("column indices must be an array");for(let e=0;e<t.length;e++)if(t[e]<0||t[e]>=n.columns)throw new RangeError("column indices are out of range")}function ul(n,t,e,r,i){if(arguments.length!==5)throw new RangeError("expected 4 arguments");if(ia("startRow",t),ia("endRow",e),ia("startColumn",r),ia("endColumn",i),t>e||r>i||t<0||t>=n.rows||e<0||e>=n.rows||r<0||r>=n.columns||i<0||i>=n.columns)throw new RangeError("Submatrix indices are out of range")}function pu(n,t=0){let e=[];for(let r=0;r<n;r++)e.push(t);return e}function ia(n,t){if(typeof t!="number")throw new TypeError(`${n} must be a number`)}function qi(n){if(n.isEmpty())throw new Error("Empty matrix has no elements to index")}function Lv(n){let t=pu(n.rows);for(let e=0;e<n.rows;++e)for(let r=0;r<n.columns;++r)t[e]+=n.get(e,r);return t}function Av(n){let t=pu(n.columns);for(let e=0;e<n.rows;++e)for(let r=0;r<n.columns;++r)t[r]+=n.get(e,r);return t}function Ov(n){let t=0;for(let e=0;e<n.rows;e++)for(let r=0;r<n.columns;r++)t+=n.get(e,r);return t}function Dv(n){let t=pu(n.rows,1);for(let e=0;e<n.rows;++e)for(let r=0;r<n.columns;++r)t[e]*=n.get(e,r);return t}function Fv(n){let t=pu(n.columns,1);for(let e=0;e<n.rows;++e)for(let r=0;r<n.columns;++r)t[r]*=n.get(e,r);return t}function kv(n){let t=1;for(let e=0;e<n.rows;e++)for(let r=0;r<n.columns;r++)t*=n.get(e,r);return t}function Gv(n,t,e){const r=n.rows,i=n.columns,s=[];for(let o=0;o<r;o++){let a=0,u=0,l=0;for(let c=0;c<i;c++)l=n.get(o,c)-e[o],a+=l,u+=l*l;t?s.push((u-a*a/i)/(i-1)):s.push((u-a*a/i)/i)}return s}function Bv(n,t,e){const r=n.rows,i=n.columns,s=[];for(let o=0;o<i;o++){let a=0,u=0,l=0;for(let c=0;c<r;c++)l=n.get(c,o)-e[o],a+=l,u+=l*l;t?s.push((u-a*a/r)/(r-1)):s.push((u-a*a/r)/r)}return s}function zv(n,t,e){const r=n.rows,i=n.columns,s=r*i;let o=0,a=0,u=0;for(let l=0;l<r;l++)for(let c=0;c<i;c++)u=n.get(l,c)-e,o+=u,a+=u*u;return t?(a-o*o/s)/(s-1):(a-o*o/s)/s}function Uv(n,t){for(let e=0;e<n.rows;e++)for(let r=0;r<n.columns;r++)n.set(e,r,n.get(e,r)-t[e])}function jv(n,t){for(let e=0;e<n.rows;e++)for(let r=0;r<n.columns;r++)n.set(e,r,n.get(e,r)-t[r])}function Vv(n,t){for(let e=0;e<n.rows;e++)for(let r=0;r<n.columns;r++)n.set(e,r,n.get(e,r)-t)}function qv(n){const t=[];for(let e=0;e<n.rows;e++){let r=0;for(let i=0;i<n.columns;i++)r+=Math.pow(n.get(e,i),2)/(n.columns-1);t.push(Math.sqrt(r))}return t}function Wv(n,t){for(let e=0;e<n.rows;e++)for(let r=0;r<n.columns;r++)n.set(e,r,n.get(e,r)/t[e])}function Xv(n){const t=[];for(let e=0;e<n.columns;e++){let r=0;for(let i=0;i<n.rows;i++)r+=Math.pow(n.get(i,e),2)/(n.rows-1);t.push(Math.sqrt(r))}return t}function Yv(n,t){for(let e=0;e<n.rows;e++)for(let r=0;r<n.columns;r++)n.set(e,r,n.get(e,r)/t[r])}function Zv(n){const t=n.size-1;let e=0;for(let r=0;r<n.columns;r++)for(let i=0;i<n.rows;i++)e+=Math.pow(n.get(i,r),2)/t;return Math.sqrt(e)}function Hv(n,t){for(let e=0;e<n.rows;e++)for(let r=0;r<n.columns;r++)n.set(e,r,n.get(e,r)/t)}let Jt=class ge{static from1DArray(t,e,r){if(t*e!==r.length)throw new RangeError("data length does not match given dimensions");let i=new z(t,e);for(let s=0;s<t;s++)for(let o=0;o<e;o++)i.set(s,o,r[s*e+o]);return i}static rowVector(t){let e=new z(1,t.length);for(let r=0;r<t.length;r++)e.set(0,r,t[r]);return e}static columnVector(t){let e=new z(t.length,1);for(let r=0;r<t.length;r++)e.set(r,0,t[r]);return e}static zeros(t,e){return new z(t,e)}static ones(t,e){return new z(t,e).fill(1)}static rand(t,e,r={}){if(typeof r!="object")throw new TypeError("options must be an object");const{random:i=Math.random}=r;let s=new z(t,e);for(let o=0;o<t;o++)for(let a=0;a<e;a++)s.set(o,a,i());return s}static randInt(t,e,r={}){if(typeof r!="object")throw new TypeError("options must be an object");const{min:i=0,max:s=1e3,random:o=Math.random}=r;if(!Number.isInteger(i))throw new TypeError("min must be an integer");if(!Number.isInteger(s))throw new TypeError("max must be an integer");if(i>=s)throw new RangeError("min must be smaller than max");let a=s-i,u=new z(t,e);for(let l=0;l<t;l++)for(let c=0;c<e;c++){let h=i+Math.round(o()*a);u.set(l,c,h)}return u}static eye(t,e,r){e===void 0&&(e=t),r===void 0&&(r=1);let i=Math.min(t,e),s=this.zeros(t,e);for(let o=0;o<i;o++)s.set(o,o,r);return s}static diag(t,e,r){let i=t.length;e===void 0&&(e=i),r===void 0&&(r=e);let s=Math.min(i,e,r),o=this.zeros(e,r);for(let a=0;a<s;a++)o.set(a,a,t[a]);return o}static min(t,e){t=this.checkMatrix(t),e=this.checkMatrix(e);let r=t.rows,i=t.columns,s=new z(r,i);for(let o=0;o<r;o++)for(let a=0;a<i;a++)s.set(o,a,Math.min(t.get(o,a),e.get(o,a)));return s}static max(t,e){t=this.checkMatrix(t),e=this.checkMatrix(e);let r=t.rows,i=t.columns,s=new this(r,i);for(let o=0;o<r;o++)for(let a=0;a<i;a++)s.set(o,a,Math.max(t.get(o,a),e.get(o,a)));return s}static checkMatrix(t){return ge.isMatrix(t)?t:new z(t)}static isMatrix(t){return t!=null&&t.klass==="Matrix"}get size(){return this.rows*this.columns}apply(t){if(typeof t!="function")throw new TypeError("callback must be a function");for(let e=0;e<this.rows;e++)for(let r=0;r<this.columns;r++)t.call(this,e,r);return this}to1DArray(){let t=[];for(let e=0;e<this.rows;e++)for(let r=0;r<this.columns;r++)t.push(this.get(e,r));return t}to2DArray(){let t=[];for(let e=0;e<this.rows;e++){t.push([]);for(let r=0;r<this.columns;r++)t[e].push(this.get(e,r))}return t}toJSON(){return this.to2DArray()}isRowVector(){return this.rows===1}isColumnVector(){return this.columns===1}isVector(){return this.rows===1||this.columns===1}isSquare(){return this.rows===this.columns}isEmpty(){return this.rows===0||this.columns===0}isSymmetric(){if(this.isSquare()){for(let t=0;t<this.rows;t++)for(let e=0;e<=t;e++)if(this.get(t,e)!==this.get(e,t))return!1;return!0}return!1}isDistance(){if(!this.isSymmetric())return!1;for(let t=0;t<this.rows;t++)if(this.get(t,t)!==0)return!1;return!0}isEchelonForm(){let t=0,e=0,r=-1,i=!0,s=!1;for(;t<this.rows&&i;){for(e=0,s=!1;e<this.columns&&s===!1;)this.get(t,e)===0?e++:this.get(t,e)===1&&e>r?(s=!0,r=e):(i=!1,s=!0);t++}return i}isReducedEchelonForm(){let t=0,e=0,r=-1,i=!0,s=!1;for(;t<this.rows&&i;){for(e=0,s=!1;e<this.columns&&s===!1;)this.get(t,e)===0?e++:this.get(t,e)===1&&e>r?(s=!0,r=e):(i=!1,s=!0);for(let o=e+1;o<this.rows;o++)this.get(t,o)!==0&&(i=!1);t++}return i}echelonForm(){let t=this.clone(),e=0,r=0;for(;e<t.rows&&r<t.columns;){let i=e;for(let s=e;s<t.rows;s++)t.get(s,r)>t.get(i,r)&&(i=s);if(t.get(i,r)===0)r++;else{t.swapRows(e,i);let s=t.get(e,r);for(let o=r;o<t.columns;o++)t.set(e,o,t.get(e,o)/s);for(let o=e+1;o<t.rows;o++){let a=t.get(o,r)/t.get(e,r);t.set(o,r,0);for(let u=r+1;u<t.columns;u++)t.set(o,u,t.get(o,u)-t.get(e,u)*a)}e++,r++}}return t}reducedEchelonForm(){let t=this.echelonForm(),e=t.columns,r=t.rows,i=r-1;for(;i>=0;)if(t.maxRow(i)===0)i--;else{let s=0,o=!1;for(;s<r&&o===!1;)t.get(i,s)===1?o=!0:s++;for(let a=0;a<i;a++){let u=t.get(a,s);for(let l=s;l<e;l++){let c=t.get(a,l)-u*t.get(i,l);t.set(a,l,c)}}i--}return t}set(){throw new Error("set method is unimplemented")}get(){throw new Error("get method is unimplemented")}repeat(t={}){if(typeof t!="object")throw new TypeError("options must be an object");const{rows:e=1,columns:r=1}=t;if(!Number.isInteger(e)||e<=0)throw new TypeError("rows must be a positive integer");if(!Number.isInteger(r)||r<=0)throw new TypeError("columns must be a positive integer");let i=new z(this.rows*e,this.columns*r);for(let s=0;s<e;s++)for(let o=0;o<r;o++)i.setSubMatrix(this,this.rows*s,this.columns*o);return i}fill(t){for(let e=0;e<this.rows;e++)for(let r=0;r<this.columns;r++)this.set(e,r,t);return this}neg(){return this.mulS(-1)}getRow(t){Ir(this,t);let e=[];for(let r=0;r<this.columns;r++)e.push(this.get(t,r));return e}getRowVector(t){return z.rowVector(this.getRow(t))}setRow(t,e){Ir(this,t),e=Hi(this,e);for(let r=0;r<this.columns;r++)this.set(t,r,e[r]);return this}swapRows(t,e){Ir(this,t),Ir(this,e);for(let r=0;r<this.columns;r++){let i=this.get(t,r);this.set(t,r,this.get(e,r)),this.set(e,r,i)}return this}getColumn(t){Cr(this,t);let e=[];for(let r=0;r<this.rows;r++)e.push(this.get(r,t));return e}getColumnVector(t){return z.columnVector(this.getColumn(t))}setColumn(t,e){Cr(this,t),e=Ki(this,e);for(let r=0;r<this.rows;r++)this.set(r,t,e[r]);return this}swapColumns(t,e){Cr(this,t),Cr(this,e);for(let r=0;r<this.rows;r++){let i=this.get(r,t);this.set(r,t,this.get(r,e)),this.set(r,e,i)}return this}addRowVector(t){t=Hi(this,t);for(let e=0;e<this.rows;e++)for(let r=0;r<this.columns;r++)this.set(e,r,this.get(e,r)+t[r]);return this}subRowVector(t){t=Hi(this,t);for(let e=0;e<this.rows;e++)for(let r=0;r<this.columns;r++)this.set(e,r,this.get(e,r)-t[r]);return this}mulRowVector(t){t=Hi(this,t);for(let e=0;e<this.rows;e++)for(let r=0;r<this.columns;r++)this.set(e,r,this.get(e,r)*t[r]);return this}divRowVector(t){t=Hi(this,t);for(let e=0;e<this.rows;e++)for(let r=0;r<this.columns;r++)this.set(e,r,this.get(e,r)/t[r]);return this}addColumnVector(t){t=Ki(this,t);for(let e=0;e<this.rows;e++)for(let r=0;r<this.columns;r++)this.set(e,r,this.get(e,r)+t[e]);return this}subColumnVector(t){t=Ki(this,t);for(let e=0;e<this.rows;e++)for(let r=0;r<this.columns;r++)this.set(e,r,this.get(e,r)-t[e]);return this}mulColumnVector(t){t=Ki(this,t);for(let e=0;e<this.rows;e++)for(let r=0;r<this.columns;r++)this.set(e,r,this.get(e,r)*t[e]);return this}divColumnVector(t){t=Ki(this,t);for(let e=0;e<this.rows;e++)for(let r=0;r<this.columns;r++)this.set(e,r,this.get(e,r)/t[e]);return this}mulRow(t,e){Ir(this,t);for(let r=0;r<this.columns;r++)this.set(t,r,this.get(t,r)*e);return this}mulColumn(t,e){Cr(this,t);for(let r=0;r<this.rows;r++)this.set(r,t,this.get(r,t)*e);return this}max(t){if(this.isEmpty())return NaN;switch(t){case"row":{const e=new Array(this.rows).fill(Number.NEGATIVE_INFINITY);for(let r=0;r<this.rows;r++)for(let i=0;i<this.columns;i++)this.get(r,i)>e[r]&&(e[r]=this.get(r,i));return e}case"column":{const e=new Array(this.columns).fill(Number.NEGATIVE_INFINITY);for(let r=0;r<this.rows;r++)for(let i=0;i<this.columns;i++)this.get(r,i)>e[i]&&(e[i]=this.get(r,i));return e}case void 0:{let e=this.get(0,0);for(let r=0;r<this.rows;r++)for(let i=0;i<this.columns;i++)this.get(r,i)>e&&(e=this.get(r,i));return e}default:throw new Error(`invalid option: ${t}`)}}maxIndex(){qi(this);let t=this.get(0,0),e=[0,0];for(let r=0;r<this.rows;r++)for(let i=0;i<this.columns;i++)this.get(r,i)>t&&(t=this.get(r,i),e[0]=r,e[1]=i);return e}min(t){if(this.isEmpty())return NaN;switch(t){case"row":{const e=new Array(this.rows).fill(Number.POSITIVE_INFINITY);for(let r=0;r<this.rows;r++)for(let i=0;i<this.columns;i++)this.get(r,i)<e[r]&&(e[r]=this.get(r,i));return e}case"column":{const e=new Array(this.columns).fill(Number.POSITIVE_INFINITY);for(let r=0;r<this.rows;r++)for(let i=0;i<this.columns;i++)this.get(r,i)<e[i]&&(e[i]=this.get(r,i));return e}case void 0:{let e=this.get(0,0);for(let r=0;r<this.rows;r++)for(let i=0;i<this.columns;i++)this.get(r,i)<e&&(e=this.get(r,i));return e}default:throw new Error(`invalid option: ${t}`)}}minIndex(){qi(this);let t=this.get(0,0),e=[0,0];for(let r=0;r<this.rows;r++)for(let i=0;i<this.columns;i++)this.get(r,i)<t&&(t=this.get(r,i),e[0]=r,e[1]=i);return e}maxRow(t){if(Ir(this,t),this.isEmpty())return NaN;let e=this.get(t,0);for(let r=1;r<this.columns;r++)this.get(t,r)>e&&(e=this.get(t,r));return e}maxRowIndex(t){Ir(this,t),qi(this);let e=this.get(t,0),r=[t,0];for(let i=1;i<this.columns;i++)this.get(t,i)>e&&(e=this.get(t,i),r[1]=i);return r}minRow(t){if(Ir(this,t),this.isEmpty())return NaN;let e=this.get(t,0);for(let r=1;r<this.columns;r++)this.get(t,r)<e&&(e=this.get(t,r));return e}minRowIndex(t){Ir(this,t),qi(this);let e=this.get(t,0),r=[t,0];for(let i=1;i<this.columns;i++)this.get(t,i)<e&&(e=this.get(t,i),r[1]=i);return r}maxColumn(t){if(Cr(this,t),this.isEmpty())return NaN;let e=this.get(0,t);for(let r=1;r<this.rows;r++)this.get(r,t)>e&&(e=this.get(r,t));return e}maxColumnIndex(t){Cr(this,t),qi(this);let e=this.get(0,t),r=[0,t];for(let i=1;i<this.rows;i++)this.get(i,t)>e&&(e=this.get(i,t),r[0]=i);return r}minColumn(t){if(Cr(this,t),this.isEmpty())return NaN;let e=this.get(0,t);for(let r=1;r<this.rows;r++)this.get(r,t)<e&&(e=this.get(r,t));return e}minColumnIndex(t){Cr(this,t),qi(this);let e=this.get(0,t),r=[0,t];for(let i=1;i<this.rows;i++)this.get(i,t)<e&&(e=this.get(i,t),r[0]=i);return r}diag(){let t=Math.min(this.rows,this.columns),e=[];for(let r=0;r<t;r++)e.push(this.get(r,r));return e}norm(t="frobenius"){switch(t){case"max":return this.max();case"frobenius":return Math.sqrt(this.dot(this));default:throw new RangeError(`unknown norm type: ${t}`)}}cumulativeSum(){let t=0;for(let e=0;e<this.rows;e++)for(let r=0;r<this.columns;r++)t+=this.get(e,r),this.set(e,r,t);return this}dot(t){ge.isMatrix(t)&&(t=t.to1DArray());let e=this.to1DArray();if(e.length!==t.length)throw new RangeError("vectors do not have the same size");let r=0;for(let i=0;i<e.length;i++)r+=e[i]*t[i];return r}mmul(t){t=z.checkMatrix(t);let e=this.rows,r=this.columns,i=t.columns,s=new z(e,i),o=new Float64Array(r);for(let a=0;a<i;a++){for(let u=0;u<r;u++)o[u]=t.get(u,a);for(let u=0;u<e;u++){let l=0;for(let c=0;c<r;c++)l+=this.get(u,c)*o[c];s.set(u,a,l)}}return s}strassen2x2(t){t=z.checkMatrix(t);let e=new z(2,2);const r=this.get(0,0),i=t.get(0,0),s=this.get(0,1),o=t.get(0,1),a=this.get(1,0),u=t.get(1,0),l=this.get(1,1),c=t.get(1,1),h=(r+l)*(i+c),f=(a+l)*i,p=r*(o-c),d=l*(u-i),_=(r+s)*c,w=(a-r)*(i+o),y=(s-l)*(u+c),x=h+d-_+y,g=p+_,m=f+d,E=h-f+p+w;return e.set(0,0,x),e.set(0,1,g),e.set(1,0,m),e.set(1,1,E),e}strassen3x3(t){t=z.checkMatrix(t);let e=new z(3,3);const r=this.get(0,0),i=this.get(0,1),s=this.get(0,2),o=this.get(1,0),a=this.get(1,1),u=this.get(1,2),l=this.get(2,0),c=this.get(2,1),h=this.get(2,2),f=t.get(0,0),p=t.get(0,1),d=t.get(0,2),_=t.get(1,0),w=t.get(1,1),y=t.get(1,2),x=t.get(2,0),g=t.get(2,1),m=t.get(2,2),E=(r+i+s-o-a-c-h)*w,N=(r-o)*(-p+w),b=a*(-f+p+_-w-y-x+m),S=(-r+o+a)*(f-p+w),v=(o+a)*(-f+p),I=r*f,T=(-r+l+c)*(f-d+y),A=(-r+l)*(d-y),K=(l+c)*(-f+d),O=(r+i+s-a-u-l-c)*y,j=c*(-f+d+_-w-y-x+g),q=(-s+c+h)*(w+x-g),yt=(s-h)*(w-g),Et=s*x,Pt=(c+h)*(-x+g),bt=(-s+a+u)*(y+x-m),Qt=(s-u)*(y-m),$=(a+u)*(-x+m),Nt=i*_,$t=u*g,ie=o*d,pe=l*p,Fp=h*m,kp=I+Et+Nt,Gp=E+S+v+I+q+Et+Pt,Bp=I+T+K+O+Et+bt+$,zp=N+b+S+I+Et+bt+Qt,Up=N+S+v+I+$t,jp=Et+bt+Qt+$+ie,Vp=I+T+A+j+q+yt+Et,qp=q+yt+Et+Pt+pe,Wp=I+T+A+K+Fp;return e.set(0,0,kp),e.set(0,1,Gp),e.set(0,2,Bp),e.set(1,0,zp),e.set(1,1,Up),e.set(1,2,jp),e.set(2,0,Vp),e.set(2,1,qp),e.set(2,2,Wp),e}mmulStrassen(t){t=z.checkMatrix(t);let e=this.clone(),r=e.rows,i=e.columns,s=t.rows,o=t.columns;i!==s&&console.warn(`Multiplying ${r} x ${i} and ${s} x ${o} matrix: dimensions do not match.`);function a(h,f,p){let d=h.rows,_=h.columns;if(d===f&&_===p)return h;{let w=ge.zeros(f,p);return w=w.setSubMatrix(h,0,0),w}}let u=Math.max(r,s),l=Math.max(i,o);e=a(e,u,l),t=a(t,u,l);function c(h,f,p,d){if(p<=512||d<=512)return h.mmul(f);p%2===1&&d%2===1?(h=a(h,p+1,d+1),f=a(f,p+1,d+1)):p%2===1?(h=a(h,p+1,d),f=a(f,p+1,d)):d%2===1&&(h=a(h,p,d+1),f=a(f,p,d+1));let _=parseInt(h.rows/2,10),w=parseInt(h.columns/2,10),y=h.subMatrix(0,_-1,0,w-1),x=f.subMatrix(0,_-1,0,w-1),g=h.subMatrix(0,_-1,w,h.columns-1),m=f.subMatrix(0,_-1,w,f.columns-1),E=h.subMatrix(_,h.rows-1,0,w-1),N=f.subMatrix(_,f.rows-1,0,w-1),b=h.subMatrix(_,h.rows-1,w,h.columns-1),S=f.subMatrix(_,f.rows-1,w,f.columns-1),v=c(ge.add(y,b),ge.add(x,S),_,w),I=c(ge.add(E,b),x,_,w),T=c(y,ge.sub(m,S),_,w),A=c(b,ge.sub(N,x),_,w),K=c(ge.add(y,g),S,_,w),O=c(ge.sub(E,y),ge.add(x,m),_,w),j=c(ge.sub(g,b),ge.add(N,S),_,w),q=ge.add(v,A);q.sub(K),q.add(j);let yt=ge.add(T,K),Et=ge.add(I,A),Pt=ge.sub(v,I);Pt.add(T),Pt.add(O);let bt=ge.zeros(2*q.rows,2*q.columns);return bt=bt.setSubMatrix(q,0,0),bt=bt.setSubMatrix(yt,q.rows,0),bt=bt.setSubMatrix(Et,0,q.columns),bt=bt.setSubMatrix(Pt,q.rows,q.columns),bt.subMatrix(0,p-1,0,d-1)}return c(e,t,u,l)}scaleRows(t={}){if(typeof t!="object")throw new TypeError("options must be an object");const{min:e=0,max:r=1}=t;if(!Number.isFinite(e))throw new TypeError("min must be a number");if(!Number.isFinite(r))throw new TypeError("max must be a number");if(e>=r)throw new RangeError("min must be smaller than max");let i=new z(this.rows,this.columns);for(let s=0;s<this.rows;s++){const o=this.getRow(s);o.length>0&&Wc(o,{min:e,max:r,output:o}),i.setRow(s,o)}return i}scaleColumns(t={}){if(typeof t!="object")throw new TypeError("options must be an object");const{min:e=0,max:r=1}=t;if(!Number.isFinite(e))throw new TypeError("min must be a number");if(!Number.isFinite(r))throw new TypeError("max must be a number");if(e>=r)throw new RangeError("min must be smaller than max");let i=new z(this.rows,this.columns);for(let s=0;s<this.columns;s++){const o=this.getColumn(s);o.length&&Wc(o,{min:e,max:r,output:o}),i.setColumn(s,o)}return i}flipRows(){const t=Math.ceil(this.columns/2);for(let e=0;e<this.rows;e++)for(let r=0;r<t;r++){let i=this.get(e,r),s=this.get(e,this.columns-1-r);this.set(e,r,s),this.set(e,this.columns-1-r,i)}return this}flipColumns(){const t=Math.ceil(this.rows/2);for(let e=0;e<this.columns;e++)for(let r=0;r<t;r++){let i=this.get(r,e),s=this.get(this.rows-1-r,e);this.set(r,e,s),this.set(this.rows-1-r,e,i)}return this}kroneckerProduct(t){t=z.checkMatrix(t);let e=this.rows,r=this.columns,i=t.rows,s=t.columns,o=new z(e*i,r*s);for(let a=0;a<e;a++)for(let u=0;u<r;u++)for(let l=0;l<i;l++)for(let c=0;c<s;c++)o.set(i*a+l,s*u+c,this.get(a,u)*t.get(l,c));return o}kroneckerSum(t){if(t=z.checkMatrix(t),!this.isSquare()||!t.isSquare())throw new Error("Kronecker Sum needs two Square Matrices");let e=this.rows,r=t.rows,i=this.kroneckerProduct(z.eye(r,r)),s=z.eye(e,e).kroneckerProduct(t);return i.add(s)}transpose(){let t=new z(this.columns,this.rows);for(let e=0;e<this.rows;e++)for(let r=0;r<this.columns;r++)t.set(r,e,this.get(e,r));return t}sortRows(t=Yc){for(let e=0;e<this.rows;e++)this.setRow(e,this.getRow(e).sort(t));return this}sortColumns(t=Yc){for(let e=0;e<this.columns;e++)this.setColumn(e,this.getColumn(e).sort(t));return this}subMatrix(t,e,r,i){ul(this,t,e,r,i);let s=new z(e-t+1,i-r+1);for(let o=t;o<=e;o++)for(let a=r;a<=i;a++)s.set(o-t,a-r,this.get(o,a));return s}subMatrixRow(t,e,r){if(e===void 0&&(e=0),r===void 0&&(r=this.columns-1),e>r||e<0||e>=this.columns||r<0||r>=this.columns)throw new RangeError("Argument out of range");let i=new z(t.length,r-e+1);for(let s=0;s<t.length;s++)for(let o=e;o<=r;o++){if(t[s]<0||t[s]>=this.rows)throw new RangeError(`Row index out of range: ${t[s]}`);i.set(s,o-e,this.get(t[s],o))}return i}subMatrixColumn(t,e,r){if(e===void 0&&(e=0),r===void 0&&(r=this.rows-1),e>r||e<0||e>=this.rows||r<0||r>=this.rows)throw new RangeError("Argument out of range");let i=new z(r-e+1,t.length);for(let s=0;s<t.length;s++)for(let o=e;o<=r;o++){if(t[s]<0||t[s]>=this.columns)throw new RangeError(`Column index out of range: ${t[s]}`);i.set(o-e,s,this.get(o,t[s]))}return i}setSubMatrix(t,e,r){if(t=z.checkMatrix(t),t.isEmpty())return this;let i=e+t.rows-1,s=r+t.columns-1;ul(this,e,i,r,s);for(let o=0;o<t.rows;o++)for(let a=0;a<t.columns;a++)this.set(e+o,r+a,t.get(o,a));return this}selection(t,e){kl(this,t),Gl(this,e);let r=new z(t.length,e.length);for(let i=0;i<t.length;i++){let s=t[i];for(let o=0;o<e.length;o++){let a=e[o];r.set(i,o,this.get(s,a))}}return r}trace(){let t=Math.min(this.rows,this.columns),e=0;for(let r=0;r<t;r++)e+=this.get(r,r);return e}clone(){return this.constructor.copy(this,new z(this.rows,this.columns))}static copy(t,e){for(const[r,i,s]of t.entries())e.set(r,i,s);return e}sum(t){switch(t){case"row":return Lv(this);case"column":return Av(this);case void 0:return Ov(this);default:throw new Error(`invalid option: ${t}`)}}product(t){switch(t){case"row":return Dv(this);case"column":return Fv(this);case void 0:return kv(this);default:throw new Error(`invalid option: ${t}`)}}mean(t){const e=this.sum(t);switch(t){case"row":{for(let r=0;r<this.rows;r++)e[r]/=this.columns;return e}case"column":{for(let r=0;r<this.columns;r++)e[r]/=this.rows;return e}case void 0:return e/this.size;default:throw new Error(`invalid option: ${t}`)}}variance(t,e={}){if(typeof t=="object"&&(e=t,t=void 0),typeof e!="object")throw new TypeError("options must be an object");const{unbiased:r=!0,mean:i=this.mean(t)}=e;if(typeof r!="boolean")throw new TypeError("unbiased must be a boolean");switch(t){case"row":{if(!Qe.isAnyArray(i))throw new TypeError("mean must be an array");return Gv(this,r,i)}case"column":{if(!Qe.isAnyArray(i))throw new TypeError("mean must be an array");return Bv(this,r,i)}case void 0:{if(typeof i!="number")throw new TypeError("mean must be a number");return zv(this,r,i)}default:throw new Error(`invalid option: ${t}`)}}standardDeviation(t,e){typeof t=="object"&&(e=t,t=void 0);const r=this.variance(t,e);if(t===void 0)return Math.sqrt(r);for(let i=0;i<r.length;i++)r[i]=Math.sqrt(r[i]);return r}center(t,e={}){if(typeof t=="object"&&(e=t,t=void 0),typeof e!="object")throw new TypeError("options must be an object");const{center:r=this.mean(t)}=e;switch(t){case"row":{if(!Qe.isAnyArray(r))throw new TypeError("center must be an array");return Uv(this,r),this}case"column":{if(!Qe.isAnyArray(r))throw new TypeError("center must be an array");return jv(this,r),this}case void 0:{if(typeof r!="number")throw new TypeError("center must be a number");return Vv(this,r),this}default:throw new Error(`invalid option: ${t}`)}}scale(t,e={}){if(typeof t=="object"&&(e=t,t=void 0),typeof e!="object")throw new TypeError("options must be an object");let r=e.scale;switch(t){case"row":{if(r===void 0)r=qv(this);else if(!Qe.isAnyArray(r))throw new TypeError("scale must be an array");return Wv(this,r),this}case"column":{if(r===void 0)r=Xv(this);else if(!Qe.isAnyArray(r))throw new TypeError("scale must be an array");return Yv(this,r),this}case void 0:{if(r===void 0)r=Zv(this);else if(typeof r!="number")throw new TypeError("scale must be a number");return Hv(this,r),this}default:throw new Error(`invalid option: ${t}`)}}toString(t){return jf(this,t)}[Symbol.iterator](){return this.entries()}*entries(){for(let t=0;t<this.rows;t++)for(let e=0;e<this.columns;e++)yield[t,e,this.get(t,e)]}*values(){for(let t=0;t<this.rows;t++)for(let e=0;e<this.columns;e++)yield this.get(t,e)}};Jt.prototype.klass="Matrix";typeof Symbol<"u"&&(Jt.prototype[Symbol.for("nodejs.util.inspect.custom")]=Nv);function Yc(n,t){return n-t}function Kv(n){return n.every(t=>typeof t=="number")}Jt.random=Jt.rand;Jt.randomInt=Jt.randInt;Jt.diagonal=Jt.diag;Jt.prototype.diagonal=Jt.prototype.diag;Jt.identity=Jt.eye;Jt.prototype.negate=Jt.prototype.neg;Jt.prototype.tensorProduct=Jt.prototype.kroneckerProduct;var No,ll,Ns;let z=(Ns=class extends Jt{constructor(e,r){super();bu(this,No);M(this,"data");if(Ns.isMatrix(e))Mu(this,No,ll).call(this,e.rows,e.columns),Ns.copy(e,this);else if(Number.isInteger(e)&&e>=0)Mu(this,No,ll).call(this,e,r);else if(Qe.isAnyArray(e)){const i=e;if(e=i.length,r=e?i[0].length:0,typeof r!="number")throw new TypeError("Data must be a 2D array with at least one element");this.data=[];for(let s=0;s<e;s++){if(i[s].length!==r)throw new RangeError("Inconsistent array dimensions");if(!Kv(i[s]))throw new TypeError("Input data contains non-numeric values");this.data.push(Float64Array.from(i[s]))}this.rows=e,this.columns=r}else throw new TypeError("First argument must be a positive number or an array")}set(e,r,i){return this.data[e][r]=i,this}get(e,r){return this.data[e][r]}removeRow(e){return Ir(this,e),this.data.splice(e,1),this.rows-=1,this}addRow(e,r){return r===void 0&&(r=e,e=this.rows),Ir(this,e,!0),r=Float64Array.from(Hi(this,r)),this.data.splice(e,0,r),this.rows+=1,this}removeColumn(e){Cr(this,e);for(let r=0;r<this.rows;r++){const i=new Float64Array(this.columns-1);for(let s=0;s<e;s++)i[s]=this.data[r][s];for(let s=e+1;s<this.columns;s++)i[s-1]=this.data[r][s];this.data[r]=i}return this.columns-=1,this}addColumn(e,r){typeof r>"u"&&(r=e,e=this.columns),Cr(this,e,!0),r=Ki(this,r);for(let i=0;i<this.rows;i++){const s=new Float64Array(this.columns+1);let o=0;for(;o<e;o++)s[o]=this.data[i][o];for(s[o++]=r[i];o<this.columns+1;o++)s[o]=this.data[i][o-1];this.data[i]=s}return this.columns+=1,this}},No=new WeakSet,ll=function(e,r){if(this.data=[],Number.isInteger(r)&&r>=0)for(let i=0;i<e;i++)this.data.push(new Float64Array(r));else throw new TypeError("nColumns must be a positive integer");this.rows=e,this.columns=r},Ns);Rv(Jt,z);var Oe;const Ka=class Ka extends Jt{constructor(e){super();bu(this,Oe,void 0);if(z.isMatrix(e)){if(!e.isSymmetric())throw new TypeError("not symmetric data");Uo(this,Oe,z.copy(e,new z(e.rows,e.rows)))}else if(Number.isInteger(e)&&e>=0)Uo(this,Oe,new z(e,e));else if(Uo(this,Oe,new z(e)),!this.isSymmetric())throw new TypeError("not symmetric data")}get size(){return jr(this,Oe).size}get rows(){return jr(this,Oe).rows}get columns(){return jr(this,Oe).columns}get diagonalSize(){return this.rows}static isSymmetricMatrix(e){return z.isMatrix(e)&&e.klassType==="SymmetricMatrix"}static zeros(e){return new this(e)}static ones(e){return new this(e).fill(1)}clone(){const e=new Ka(this.diagonalSize);for(const[r,i,s]of this.upperRightEntries())e.set(r,i,s);return e}toMatrix(){return new z(this)}get(e,r){return jr(this,Oe).get(e,r)}set(e,r,i){return jr(this,Oe).set(e,r,i),jr(this,Oe).set(r,e,i),this}removeCross(e){return jr(this,Oe).removeRow(e),jr(this,Oe).removeColumn(e),this}addCross(e,r){r===void 0&&(r=e,e=this.diagonalSize);const i=r.slice();return i.splice(e,1),jr(this,Oe).addRow(e,i),jr(this,Oe).addColumn(e,r),this}applyMask(e){if(e.length!==this.diagonalSize)throw new RangeError("Mask size do not match with matrix size");const r=[];for(const[i,s]of e.entries())s||r.push(i);r.reverse();for(const i of r)this.removeCross(i);return this}toCompact(){const{diagonalSize:e}=this,r=new Array(e*(e+1)/2);for(let i=0,s=0,o=0;o<r.length;o++)r[o]=this.get(s,i),++i>=e&&(i=++s);return r}static fromCompact(e){const r=e.length,i=(Math.sqrt(8*r+1)-1)/2;if(!Number.isInteger(i))throw new TypeError(`This array is not a compact representation of a Symmetric Matrix, ${JSON.stringify(e)}`);const s=new Ka(i);for(let o=0,a=0,u=0;u<r;u++)s.set(o,a,e[u]),++o>=i&&(o=++a);return s}*upperRightEntries(){for(let e=0,r=0;e<this.diagonalSize;void 0){const i=this.get(e,r);yield[e,r,i],++r>=this.diagonalSize&&(r=++e)}}*upperRightValues(){for(let e=0,r=0;e<this.diagonalSize;void 0)yield this.get(e,r),++r>=this.diagonalSize&&(r=++e)}};Oe=new WeakMap;let Ei=Ka;Ei.prototype.klassType="SymmetricMatrix";class gu extends Ei{static isDistanceMatrix(t){return Ei.isSymmetricMatrix(t)&&t.klassSubType==="DistanceMatrix"}constructor(t){if(super(t),!this.isDistance())throw new TypeError("Provided arguments do no produce a distance matrix")}set(t,e,r){return t===e&&(r=0),super.set(t,e,r)}addCross(t,e){return e===void 0&&(e=t,t=this.diagonalSize),e=e.slice(),e[t]=0,super.addCross(t,e)}toSymmetricMatrix(){return new Ei(this)}clone(){const t=new gu(this.diagonalSize);for(const[e,r,i]of this.upperRightEntries())e!==r&&t.set(e,r,i);return t}toCompact(){const{diagonalSize:t}=this,e=(t-1)*t/2,r=new Array(e);for(let i=1,s=0,o=0;o<r.length;o++)r[o]=this.get(s,i),++i>=t&&(i=++s+1);return r}static fromCompact(t){const e=t.length,r=(Math.sqrt(8*e+1)+1)/2;if(!Number.isInteger(r))throw new TypeError(`This array is not a compact representation of a DistanceMatrix, ${JSON.stringify(t)}`);const i=new this(r);for(let s=1,o=0,a=0;a<e;a++)i.set(s,o,t[a]),++s>=r&&(s=++o+1);return i}}gu.prototype.klassSubType="DistanceMatrix";class Kn extends Jt{constructor(t,e,r){super(),this.matrix=t,this.rows=e,this.columns=r}}class Jv extends Kn{constructor(t,e){Cr(t,e),super(t,t.rows,1),this.column=e}set(t,e,r){return this.matrix.set(t,this.column,r),this}get(t){return this.matrix.get(t,this.column)}}class Qv extends Kn{constructor(t,e){Gl(t,e),super(t,t.rows,e.length),this.columnIndices=e}set(t,e,r){return this.matrix.set(t,this.columnIndices[e],r),this}get(t,e){return this.matrix.get(t,this.columnIndices[e])}}class $v extends Kn{constructor(t){super(t,t.rows,t.columns)}set(t,e,r){return this.matrix.set(t,this.columns-e-1,r),this}get(t,e){return this.matrix.get(t,this.columns-e-1)}}class ty extends Kn{constructor(t){super(t,t.rows,t.columns)}set(t,e,r){return this.matrix.set(this.rows-t-1,e,r),this}get(t,e){return this.matrix.get(this.rows-t-1,e)}}class ey extends Kn{constructor(t,e){Ir(t,e),super(t,1,t.columns),this.row=e}set(t,e,r){return this.matrix.set(this.row,e,r),this}get(t,e){return this.matrix.get(this.row,e)}}class ry extends Kn{constructor(t,e){kl(t,e),super(t,e.length,t.columns),this.rowIndices=e}set(t,e,r){return this.matrix.set(this.rowIndices[t],e,r),this}get(t,e){return this.matrix.get(this.rowIndices[t],e)}}class ma extends Kn{constructor(t,e,r){kl(t,e),Gl(t,r),super(t,e.length,r.length),this.rowIndices=e,this.columnIndices=r}set(t,e,r){return this.matrix.set(this.rowIndices[t],this.columnIndices[e],r),this}get(t,e){return this.matrix.get(this.rowIndices[t],this.columnIndices[e])}}class ny extends Kn{constructor(t,e,r,i,s){ul(t,e,r,i,s),super(t,r-e+1,s-i+1),this.startRow=e,this.startColumn=i}set(t,e,r){return this.matrix.set(this.startRow+t,this.startColumn+e,r),this}get(t,e){return this.matrix.get(this.startRow+t,this.startColumn+e)}}class iy extends Kn{constructor(t){super(t,t.columns,t.rows)}set(t,e,r){return this.matrix.set(e,t,r),this}get(t,e){return this.matrix.get(e,t)}}class Vf extends Jt{constructor(t,e={}){const{rows:r=1}=e;if(t.length%r!==0)throw new Error("the data length is not divisible by the number of rows");super(),this.rows=r,this.columns=t.length/r,this.data=t}set(t,e,r){let i=this._calculateIndex(t,e);return this.data[i]=r,this}get(t,e){let r=this._calculateIndex(t,e);return this.data[r]}_calculateIndex(t,e){return t*this.columns+e}}let yr=class extends Jt{constructor(n){super(),this.data=n,this.rows=n.length,this.columns=n[0].length}set(n,t,e){return this.data[n][t]=e,this}get(n,t){return this.data[n][t]}};function sy(n,t){if(Qe.isAnyArray(n))return n[0]&&Qe.isAnyArray(n[0])?new yr(n):new Vf(n,t);throw new Error("the argument is not an array")}class du{constructor(t){t=yr.checkMatrix(t);let e=t.clone(),r=e.rows,i=e.columns,s=new Float64Array(r),o=1,a,u,l,c,h,f,p,d,_;for(a=0;a<r;a++)s[a]=a;for(d=new Float64Array(r),u=0;u<i;u++){for(a=0;a<r;a++)d[a]=e.get(a,u);for(a=0;a<r;a++){for(_=Math.min(a,u),h=0,l=0;l<_;l++)h+=e.get(a,l)*d[l];d[a]-=h,e.set(a,u,d[a])}for(c=u,a=u+1;a<r;a++)Math.abs(d[a])>Math.abs(d[c])&&(c=a);if(c!==u){for(l=0;l<i;l++)f=e.get(c,l),e.set(c,l,e.get(u,l)),e.set(u,l,f);p=s[c],s[c]=s[u],s[u]=p,o=-o}if(u<r&&e.get(u,u)!==0)for(a=u+1;a<r;a++)e.set(a,u,e.get(a,u)/e.get(u,u))}this.LU=e,this.pivotVector=s,this.pivotSign=o}isSingular(){let t=this.LU,e=t.columns;for(let r=0;r<e;r++)if(t.get(r,r)===0)return!0;return!1}solve(t){t=z.checkMatrix(t);let e=this.LU;if(e.rows!==t.rows)throw new Error("Invalid matrix dimensions");if(this.isSingular())throw new Error("LU matrix is singular");let r=t.columns,i=t.subMatrixRow(this.pivotVector,0,r-1),s=e.columns,o,a,u;for(u=0;u<s;u++)for(o=u+1;o<s;o++)for(a=0;a<r;a++)i.set(o,a,i.get(o,a)-i.get(u,a)*e.get(o,u));for(u=s-1;u>=0;u--){for(a=0;a<r;a++)i.set(u,a,i.get(u,a)/e.get(u,u));for(o=0;o<u;o++)for(a=0;a<r;a++)i.set(o,a,i.get(o,a)-i.get(u,a)*e.get(o,u))}return i}get determinant(){let t=this.LU;if(!t.isSquare())throw new Error("Matrix must be square");let e=this.pivotSign,r=t.columns;for(let i=0;i<r;i++)e*=t.get(i,i);return e}get lowerTriangularMatrix(){let t=this.LU,e=t.rows,r=t.columns,i=new z(e,r);for(let s=0;s<e;s++)for(let o=0;o<r;o++)s>o?i.set(s,o,t.get(s,o)):s===o?i.set(s,o,1):i.set(s,o,0);return i}get upperTriangularMatrix(){let t=this.LU,e=t.rows,r=t.columns,i=new z(e,r);for(let s=0;s<e;s++)for(let o=0;o<r;o++)s<=o?i.set(s,o,t.get(s,o)):i.set(s,o,0);return i}get pivotPermutationVector(){return Array.from(this.pivotVector)}}function Fn(n,t){let e=0;return Math.abs(n)>Math.abs(t)?(e=t/n,Math.abs(n)*Math.sqrt(1+e*e)):t!==0?(e=n/t,Math.abs(t)*Math.sqrt(1+e*e)):0}class Bl{constructor(t){t=yr.checkMatrix(t);let e=t.clone(),r=t.rows,i=t.columns,s=new Float64Array(i),o,a,u,l;for(u=0;u<i;u++){let c=0;for(o=u;o<r;o++)c=Fn(c,e.get(o,u));if(c!==0){for(e.get(u,u)<0&&(c=-c),o=u;o<r;o++)e.set(o,u,e.get(o,u)/c);for(e.set(u,u,e.get(u,u)+1),a=u+1;a<i;a++){for(l=0,o=u;o<r;o++)l+=e.get(o,u)*e.get(o,a);for(l=-l/e.get(u,u),o=u;o<r;o++)e.set(o,a,e.get(o,a)+l*e.get(o,u))}}s[u]=-c}this.QR=e,this.Rdiag=s}solve(t){t=z.checkMatrix(t);let e=this.QR,r=e.rows;if(t.rows!==r)throw new Error("Matrix row dimensions must agree");if(!this.isFullRank())throw new Error("Matrix is rank deficient");let i=t.columns,s=t.clone(),o=e.columns,a,u,l,c;for(l=0;l<o;l++)for(u=0;u<i;u++){for(c=0,a=l;a<r;a++)c+=e.get(a,l)*s.get(a,u);for(c=-c/e.get(l,l),a=l;a<r;a++)s.set(a,u,s.get(a,u)+c*e.get(a,l))}for(l=o-1;l>=0;l--){for(u=0;u<i;u++)s.set(l,u,s.get(l,u)/this.Rdiag[l]);for(a=0;a<l;a++)for(u=0;u<i;u++)s.set(a,u,s.get(a,u)-s.get(l,u)*e.get(a,l))}return s.subMatrix(0,o-1,0,i-1)}isFullRank(){let t=this.QR.columns;for(let e=0;e<t;e++)if(this.Rdiag[e]===0)return!1;return!0}get upperTriangularMatrix(){let t=this.QR,e=t.columns,r=new z(e,e),i,s;for(i=0;i<e;i++)for(s=0;s<e;s++)i<s?r.set(i,s,t.get(i,s)):i===s?r.set(i,s,this.Rdiag[i]):r.set(i,s,0);return r}get orthogonalMatrix(){let t=this.QR,e=t.rows,r=t.columns,i=new z(e,r),s,o,a,u;for(a=r-1;a>=0;a--){for(s=0;s<e;s++)i.set(s,a,0);for(i.set(a,a,1),o=a;o<r;o++)if(t.get(a,a)!==0){for(u=0,s=a;s<e;s++)u+=t.get(s,a)*i.get(s,o);for(u=-u/t.get(a,a),s=a;s<e;s++)i.set(s,o,i.get(s,o)+u*t.get(s,a))}}return i}}let Os=class{constructor(n,t={}){if(n=yr.checkMatrix(n),n.isEmpty())throw new Error("Matrix must be non-empty");let e=n.rows,r=n.columns;const{computeLeftSingularVectors:i=!0,computeRightSingularVectors:s=!0,autoTranspose:o=!1}=t;let a=!!i,u=!!s,l=!1,c;if(e<r)if(!o)c=n.clone(),console.warn("Computing SVD on a matrix with more columns than rows. Consider enabling autoTranspose");else{c=n.transpose(),e=c.rows,r=c.columns,l=!0;let v=a;a=u,u=v}else c=n.clone();let h=Math.min(e,r),f=Math.min(e+1,r),p=new Float64Array(f),d=new z(e,h),_=new z(r,r),w=new Float64Array(r),y=new Float64Array(e),x=new Float64Array(f);for(let v=0;v<f;v++)x[v]=v;let g=Math.min(e-1,r),m=Math.max(0,Math.min(r-2,e)),E=Math.max(g,m);for(let v=0;v<E;v++){if(v<g){p[v]=0;for(let I=v;I<e;I++)p[v]=Fn(p[v],c.get(I,v));if(p[v]!==0){c.get(v,v)<0&&(p[v]=-p[v]);for(let I=v;I<e;I++)c.set(I,v,c.get(I,v)/p[v]);c.set(v,v,c.get(v,v)+1)}p[v]=-p[v]}for(let I=v+1;I<r;I++){if(v<g&&p[v]!==0){let T=0;for(let A=v;A<e;A++)T+=c.get(A,v)*c.get(A,I);T=-T/c.get(v,v);for(let A=v;A<e;A++)c.set(A,I,c.get(A,I)+T*c.get(A,v))}w[I]=c.get(v,I)}if(a&&v<g)for(let I=v;I<e;I++)d.set(I,v,c.get(I,v));if(v<m){w[v]=0;for(let I=v+1;I<r;I++)w[v]=Fn(w[v],w[I]);if(w[v]!==0){w[v+1]<0&&(w[v]=0-w[v]);for(let I=v+1;I<r;I++)w[I]/=w[v];w[v+1]+=1}if(w[v]=-w[v],v+1<e&&w[v]!==0){for(let I=v+1;I<e;I++)y[I]=0;for(let I=v+1;I<e;I++)for(let T=v+1;T<r;T++)y[I]+=w[T]*c.get(I,T);for(let I=v+1;I<r;I++){let T=-w[I]/w[v+1];for(let A=v+1;A<e;A++)c.set(A,I,c.get(A,I)+T*y[A])}}if(u)for(let I=v+1;I<r;I++)_.set(I,v,w[I])}}let N=Math.min(r,e+1);if(g<r&&(p[g]=c.get(g,g)),e<N&&(p[N-1]=0),m+1<N&&(w[m]=c.get(m,N-1)),w[N-1]=0,a){for(let v=g;v<h;v++){for(let I=0;I<e;I++)d.set(I,v,0);d.set(v,v,1)}for(let v=g-1;v>=0;v--)if(p[v]!==0){for(let I=v+1;I<h;I++){let T=0;for(let A=v;A<e;A++)T+=d.get(A,v)*d.get(A,I);T=-T/d.get(v,v);for(let A=v;A<e;A++)d.set(A,I,d.get(A,I)+T*d.get(A,v))}for(let I=v;I<e;I++)d.set(I,v,-d.get(I,v));d.set(v,v,1+d.get(v,v));for(let I=0;I<v-1;I++)d.set(I,v,0)}else{for(let I=0;I<e;I++)d.set(I,v,0);d.set(v,v,1)}}if(u)for(let v=r-1;v>=0;v--){if(v<m&&w[v]!==0)for(let I=v+1;I<r;I++){let T=0;for(let A=v+1;A<r;A++)T+=_.get(A,v)*_.get(A,I);T=-T/_.get(v+1,v);for(let A=v+1;A<r;A++)_.set(A,I,_.get(A,I)+T*_.get(A,v))}for(let I=0;I<r;I++)_.set(I,v,0);_.set(v,v,1)}let b=N-1,S=Number.EPSILON;for(;N>0;){let v,I;for(v=N-2;v>=-1&&v!==-1;v--){const T=Number.MIN_VALUE+S*Math.abs(p[v]+Math.abs(p[v+1]));if(Math.abs(w[v])<=T||Number.isNaN(w[v])){w[v]=0;break}}if(v===N-2)I=4;else{let T;for(T=N-1;T>=v&&T!==v;T--){let A=(T!==N?Math.abs(w[T]):0)+(T!==v+1?Math.abs(w[T-1]):0);if(Math.abs(p[T])<=S*A){p[T]=0;break}}T===v?I=3:T===N-1?I=1:(I=2,v=T)}switch(v++,I){case 1:{let T=w[N-2];w[N-2]=0;for(let A=N-2;A>=v;A--){let K=Fn(p[A],T),O=p[A]/K,j=T/K;if(p[A]=K,A!==v&&(T=-j*w[A-1],w[A-1]=O*w[A-1]),u)for(let q=0;q<r;q++)K=O*_.get(q,A)+j*_.get(q,N-1),_.set(q,N-1,-j*_.get(q,A)+O*_.get(q,N-1)),_.set(q,A,K)}break}case 2:{let T=w[v-1];w[v-1]=0;for(let A=v;A<N;A++){let K=Fn(p[A],T),O=p[A]/K,j=T/K;if(p[A]=K,T=-j*w[A],w[A]=O*w[A],a)for(let q=0;q<e;q++)K=O*d.get(q,A)+j*d.get(q,v-1),d.set(q,v-1,-j*d.get(q,A)+O*d.get(q,v-1)),d.set(q,A,K)}break}case 3:{const T=Math.max(Math.abs(p[N-1]),Math.abs(p[N-2]),Math.abs(w[N-2]),Math.abs(p[v]),Math.abs(w[v])),A=p[N-1]/T,K=p[N-2]/T,O=w[N-2]/T,j=p[v]/T,q=w[v]/T,yt=((K+A)*(K-A)+O*O)/2,Et=A*O*(A*O);let Pt=0;(yt!==0||Et!==0)&&(yt<0?Pt=0-Math.sqrt(yt*yt+Et):Pt=Math.sqrt(yt*yt+Et),Pt=Et/(yt+Pt));let bt=(j+A)*(j-A)+Pt,Qt=j*q;for(let $=v;$<N-1;$++){let Nt=Fn(bt,Qt);Nt===0&&(Nt=Number.MIN_VALUE);let $t=bt/Nt,ie=Qt/Nt;if($!==v&&(w[$-1]=Nt),bt=$t*p[$]+ie*w[$],w[$]=$t*w[$]-ie*p[$],Qt=ie*p[$+1],p[$+1]=$t*p[$+1],u)for(let pe=0;pe<r;pe++)Nt=$t*_.get(pe,$)+ie*_.get(pe,$+1),_.set(pe,$+1,-ie*_.get(pe,$)+$t*_.get(pe,$+1)),_.set(pe,$,Nt);if(Nt=Fn(bt,Qt),Nt===0&&(Nt=Number.MIN_VALUE),$t=bt/Nt,ie=Qt/Nt,p[$]=Nt,bt=$t*w[$]+ie*p[$+1],p[$+1]=-ie*w[$]+$t*p[$+1],Qt=ie*w[$+1],w[$+1]=$t*w[$+1],a&&$<e-1)for(let pe=0;pe<e;pe++)Nt=$t*d.get(pe,$)+ie*d.get(pe,$+1),d.set(pe,$+1,-ie*d.get(pe,$)+$t*d.get(pe,$+1)),d.set(pe,$,Nt)}w[N-2]=bt;break}case 4:{if(p[v]<=0&&(p[v]=p[v]<0?-p[v]:0,u))for(let T=0;T<=b;T++)_.set(T,v,-_.get(T,v));for(;v<b&&!(p[v]>=p[v+1]);){let T=p[v];if(p[v]=p[v+1],p[v+1]=T,u&&v<r-1)for(let A=0;A<r;A++)T=_.get(A,v+1),_.set(A,v+1,_.get(A,v)),_.set(A,v,T);if(a&&v<e-1)for(let A=0;A<e;A++)T=d.get(A,v+1),d.set(A,v+1,d.get(A,v)),d.set(A,v,T);v++}N--;break}}}if(l){let v=_;_=d,d=v}this.m=e,this.n=r,this.s=p,this.U=d,this.V=_}solve(n){let t=n,e=this.threshold,r=this.s.length,i=z.zeros(r,r);for(let h=0;h<r;h++)Math.abs(this.s[h])<=e?i.set(h,h,0):i.set(h,h,1/this.s[h]);let s=this.U,o=this.rightSingularVectors,a=o.mmul(i),u=o.rows,l=s.rows,c=z.zeros(u,l);for(let h=0;h<u;h++)for(let f=0;f<l;f++){let p=0;for(let d=0;d<r;d++)p+=a.get(h,d)*s.get(f,d);c.set(h,f,p)}return c.mmul(t)}solveForDiagonal(n){return this.solve(z.diag(n))}inverse(){let n=this.V,t=this.threshold,e=n.rows,r=n.columns,i=new z(e,this.s.length);for(let l=0;l<e;l++)for(let c=0;c<r;c++)Math.abs(this.s[c])>t&&i.set(l,c,n.get(l,c)/this.s[c]);let s=this.U,o=s.rows,a=s.columns,u=new z(e,o);for(let l=0;l<e;l++)for(let c=0;c<o;c++){let h=0;for(let f=0;f<a;f++)h+=i.get(l,f)*s.get(c,f);u.set(l,c,h)}return u}get condition(){return this.s[0]/this.s[Math.min(this.m,this.n)-1]}get norm2(){return this.s[0]}get rank(){let n=Math.max(this.m,this.n)*this.s[0]*Number.EPSILON,t=0,e=this.s;for(let r=0,i=e.length;r<i;r++)e[r]>n&&t++;return t}get diagonal(){return Array.from(this.s)}get threshold(){return Number.EPSILON/2*Math.max(this.m,this.n)*this.s[0]}get leftSingularVectors(){return this.U}get rightSingularVectors(){return this.V}get diagonalMatrix(){return z.diag(this.s)}};function oy(n,t=!1){return n=yr.checkMatrix(n),t?new Os(n).inverse():qf(n,z.eye(n.rows))}function qf(n,t,e=!1){return n=yr.checkMatrix(n),t=yr.checkMatrix(t),e?new Os(n).solve(t):n.isSquare()?new du(n).solve(t):new Bl(n).solve(t)}function va(n){if(n=z.checkMatrix(n),n.isSquare()){if(n.columns===0)return 1;let t,e,r,i;if(n.columns===2)return t=n.get(0,0),e=n.get(0,1),r=n.get(1,0),i=n.get(1,1),t*i-e*r;if(n.columns===3){let s,o,a;return s=new ma(n,[1,2],[1,2]),o=new ma(n,[1,2],[0,2]),a=new ma(n,[1,2],[0,1]),t=n.get(0,0),e=n.get(0,1),r=n.get(0,2),t*va(s)-e*va(o)+r*va(a)}else return new du(n).determinant}else throw Error("determinant can only be calculated for a square matrix")}function ay(n,t){let e=[];for(let r=0;r<n;r++)r!==t&&e.push(r);return e}function uy(n,t,e,r=1e-9,i=1e-9){if(n>i)return new Array(t.rows+1).fill(0);{let s=t.addRow(e,[0]);for(let o=0;o<s.rows;o++)Math.abs(s.get(o,0))<r&&s.set(o,0,0);return s.to1DArray()}}function ly(n,t={}){const{thresholdValue:e=1e-9,thresholdError:r=1e-9}=t;n=z.checkMatrix(n);let i=n.rows,s=new z(i,i);for(let o=0;o<i;o++){let a=z.columnVector(n.getRow(o)),u=n.subMatrixRow(ay(i,o)).transpose(),l=new Os(u).solve(a),c=z.sub(a,u.mmul(l)).abs().max();s.setRow(o,uy(c,l,o,e,r))}return s}function cy(n,t=Number.EPSILON){if(n=z.checkMatrix(n),n.isEmpty())return n.transpose();let e=new Os(n,{autoTranspose:!0}),r=e.leftSingularVectors,i=e.rightSingularVectors,s=e.diagonal;for(let o=0;o<s.length;o++)Math.abs(s[o])>t?s[o]=1/s[o]:s[o]=0;return i.mmul(z.diag(s).mmul(r.transpose()))}function hy(n,t=n,e={}){n=new z(n);let r=!1;if(typeof t=="object"&&!z.isMatrix(t)&&!Qe.isAnyArray(t)?(e=t,t=n,r=!0):t=new z(t),n.rows!==t.rows)throw new TypeError("Both matrices must have the same number of rows");const{center:i=!0}=e;i&&(n=n.center("column"),r||(t=t.center("column")));const s=n.transpose().mmul(t);for(let o=0;o<s.rows;o++)for(let a=0;a<s.columns;a++)s.set(o,a,s.get(o,a)*(1/(n.rows-1)));return s}function fy(n,t=n,e={}){n=new z(n);let r=!1;if(typeof t=="object"&&!z.isMatrix(t)&&!Qe.isAnyArray(t)?(e=t,t=n,r=!0):t=new z(t),n.rows!==t.rows)throw new TypeError("Both matrices must have the same number of rows");const{center:i=!0,scale:s=!0}=e;i&&(n.center("column"),r||t.center("column")),s&&(n.scale("column"),r||t.scale("column"));const o=n.standardDeviation("column",{unbiased:!0}),a=r?o:t.standardDeviation("column",{unbiased:!0}),u=n.transpose().mmul(t);for(let l=0;l<u.rows;l++)for(let c=0;c<u.columns;c++)u.set(l,c,u.get(l,c)*(1/(o[l]*a[c]))*(1/(n.rows-1)));return u}class Wf{constructor(t,e={}){const{assumeSymmetric:r=!1}=e;if(t=yr.checkMatrix(t),!t.isSquare())throw new Error("Matrix is not a square matrix");if(t.isEmpty())throw new Error("Matrix must be non-empty");let i=t.columns,s=new z(i,i),o=new Float64Array(i),a=new Float64Array(i),u=t,l,c,h=!1;if(r?h=!0:h=t.isSymmetric(),h){for(l=0;l<i;l++)for(c=0;c<i;c++)s.set(l,c,u.get(l,c));py(i,a,o,s),gy(i,a,o,s)}else{let f=new z(i,i),p=new Float64Array(i);for(c=0;c<i;c++)for(l=0;l<i;l++)f.set(l,c,u.get(l,c));dy(i,f,p,s),my(i,a,o,s,f)}this.n=i,this.e=a,this.d=o,this.V=s}get realEigenvalues(){return Array.from(this.d)}get imaginaryEigenvalues(){return Array.from(this.e)}get eigenvectorMatrix(){return this.V}get diagonalMatrix(){let t=this.n,e=this.e,r=this.d,i=new z(t,t),s,o;for(s=0;s<t;s++){for(o=0;o<t;o++)i.set(s,o,0);i.set(s,s,r[s]),e[s]>0?i.set(s,s+1,e[s]):e[s]<0&&i.set(s,s-1,e[s])}return i}}function py(n,t,e,r){let i,s,o,a,u,l,c,h;for(u=0;u<n;u++)e[u]=r.get(n-1,u);for(a=n-1;a>0;a--){for(h=0,o=0,l=0;l<a;l++)h=h+Math.abs(e[l]);if(h===0)for(t[a]=e[a-1],u=0;u<a;u++)e[u]=r.get(a-1,u),r.set(a,u,0),r.set(u,a,0);else{for(l=0;l<a;l++)e[l]/=h,o+=e[l]*e[l];for(i=e[a-1],s=Math.sqrt(o),i>0&&(s=-s),t[a]=h*s,o=o-i*s,e[a-1]=i-s,u=0;u<a;u++)t[u]=0;for(u=0;u<a;u++){for(i=e[u],r.set(u,a,i),s=t[u]+r.get(u,u)*i,l=u+1;l<=a-1;l++)s+=r.get(l,u)*e[l],t[l]+=r.get(l,u)*i;t[u]=s}for(i=0,u=0;u<a;u++)t[u]/=o,i+=t[u]*e[u];for(c=i/(o+o),u=0;u<a;u++)t[u]-=c*e[u];for(u=0;u<a;u++){for(i=e[u],s=t[u],l=u;l<=a-1;l++)r.set(l,u,r.get(l,u)-(i*t[l]+s*e[l]));e[u]=r.get(a-1,u),r.set(a,u,0)}}e[a]=o}for(a=0;a<n-1;a++){if(r.set(n-1,a,r.get(a,a)),r.set(a,a,1),o=e[a+1],o!==0){for(l=0;l<=a;l++)e[l]=r.get(l,a+1)/o;for(u=0;u<=a;u++){for(s=0,l=0;l<=a;l++)s+=r.get(l,a+1)*r.get(l,u);for(l=0;l<=a;l++)r.set(l,u,r.get(l,u)-s*e[l])}}for(l=0;l<=a;l++)r.set(l,a+1,0)}for(u=0;u<n;u++)e[u]=r.get(n-1,u),r.set(n-1,u,0);r.set(n-1,n-1,1),t[0]=0}function gy(n,t,e,r){let i,s,o,a,u,l,c,h,f,p,d,_,w,y,x,g;for(o=1;o<n;o++)t[o-1]=t[o];t[n-1]=0;let m=0,E=0,N=Number.EPSILON;for(l=0;l<n;l++){for(E=Math.max(E,Math.abs(e[l])+Math.abs(t[l])),c=l;c<n&&!(Math.abs(t[c])<=N*E);)c++;if(c>l)do{for(i=e[l],h=(e[l+1]-i)/(2*t[l]),f=Fn(h,1),h<0&&(f=-f),e[l]=t[l]/(h+f),e[l+1]=t[l]*(h+f),p=e[l+1],s=i-e[l],o=l+2;o<n;o++)e[o]-=s;for(m=m+s,h=e[c],d=1,_=d,w=d,y=t[l+1],x=0,g=0,o=c-1;o>=l;o--)for(w=_,_=d,g=x,i=d*t[o],s=d*h,f=Fn(h,t[o]),t[o+1]=x*f,x=t[o]/f,d=h/f,h=d*e[o]-x*i,e[o+1]=s+x*(d*i+x*e[o]),u=0;u<n;u++)s=r.get(u,o+1),r.set(u,o+1,x*r.get(u,o)+d*s),r.set(u,o,d*r.get(u,o)-x*s);h=-x*g*w*y*t[l]/p,t[l]=x*h,e[l]=d*h}while(Math.abs(t[l])>N*E);e[l]=e[l]+m,t[l]=0}for(o=0;o<n-1;o++){for(u=o,h=e[o],a=o+1;a<n;a++)e[a]<h&&(u=a,h=e[a]);if(u!==o)for(e[u]=e[o],e[o]=h,a=0;a<n;a++)h=r.get(a,o),r.set(a,o,r.get(a,u)),r.set(a,u,h)}}function dy(n,t,e,r){let i=0,s=n-1,o,a,u,l,c,h,f;for(h=i+1;h<=s-1;h++){for(f=0,l=h;l<=s;l++)f=f+Math.abs(t.get(l,h-1));if(f!==0){for(u=0,l=s;l>=h;l--)e[l]=t.get(l,h-1)/f,u+=e[l]*e[l];for(a=Math.sqrt(u),e[h]>0&&(a=-a),u=u-e[h]*a,e[h]=e[h]-a,c=h;c<n;c++){for(o=0,l=s;l>=h;l--)o+=e[l]*t.get(l,c);for(o=o/u,l=h;l<=s;l++)t.set(l,c,t.get(l,c)-o*e[l])}for(l=0;l<=s;l++){for(o=0,c=s;c>=h;c--)o+=e[c]*t.get(l,c);for(o=o/u,c=h;c<=s;c++)t.set(l,c,t.get(l,c)-o*e[c])}e[h]=f*e[h],t.set(h,h-1,f*a)}}for(l=0;l<n;l++)for(c=0;c<n;c++)r.set(l,c,l===c?1:0);for(h=s-1;h>=i+1;h--)if(t.get(h,h-1)!==0){for(l=h+1;l<=s;l++)e[l]=t.get(l,h-1);for(c=h;c<=s;c++){for(a=0,l=h;l<=s;l++)a+=e[l]*r.get(l,c);for(a=a/e[h]/t.get(h,h-1),l=h;l<=s;l++)r.set(l,c,r.get(l,c)+a*e[l])}}}function my(n,t,e,r,i){let s=n-1,o=0,a=n-1,u=Number.EPSILON,l=0,c=0,h=0,f=0,p=0,d=0,_=0,w=0,y,x,g,m,E,N,b,S,v,I,T,A,K,O,j;for(y=0;y<n;y++)for((y<o||y>a)&&(e[y]=i.get(y,y),t[y]=0),x=Math.max(y-1,0);x<n;x++)c=c+Math.abs(i.get(y,x));for(;s>=o;){for(m=s;m>o&&(d=Math.abs(i.get(m-1,m-1))+Math.abs(i.get(m,m)),d===0&&(d=c),!(Math.abs(i.get(m,m-1))<u*d));)m--;if(m===s)i.set(s,s,i.get(s,s)+l),e[s]=i.get(s,s),t[s]=0,s--,w=0;else if(m===s-1){if(b=i.get(s,s-1)*i.get(s-1,s),h=(i.get(s-1,s-1)-i.get(s,s))/2,f=h*h+b,_=Math.sqrt(Math.abs(f)),i.set(s,s,i.get(s,s)+l),i.set(s-1,s-1,i.get(s-1,s-1)+l),S=i.get(s,s),f>=0){for(_=h>=0?h+_:h-_,e[s-1]=S+_,e[s]=e[s-1],_!==0&&(e[s]=S-b/_),t[s-1]=0,t[s]=0,S=i.get(s,s-1),d=Math.abs(S)+Math.abs(_),h=S/d,f=_/d,p=Math.sqrt(h*h+f*f),h=h/p,f=f/p,x=s-1;x<n;x++)_=i.get(s-1,x),i.set(s-1,x,f*_+h*i.get(s,x)),i.set(s,x,f*i.get(s,x)-h*_);for(y=0;y<=s;y++)_=i.get(y,s-1),i.set(y,s-1,f*_+h*i.get(y,s)),i.set(y,s,f*i.get(y,s)-h*_);for(y=o;y<=a;y++)_=r.get(y,s-1),r.set(y,s-1,f*_+h*r.get(y,s)),r.set(y,s,f*r.get(y,s)-h*_)}else e[s-1]=S+h,e[s]=S+h,t[s-1]=_,t[s]=-_;s=s-2,w=0}else{if(S=i.get(s,s),v=0,b=0,m<s&&(v=i.get(s-1,s-1),b=i.get(s,s-1)*i.get(s-1,s)),w===10){for(l+=S,y=o;y<=s;y++)i.set(y,y,i.get(y,y)-S);d=Math.abs(i.get(s,s-1))+Math.abs(i.get(s-1,s-2)),S=v=.75*d,b=-.4375*d*d}if(w===30&&(d=(v-S)/2,d=d*d+b,d>0)){for(d=Math.sqrt(d),v<S&&(d=-d),d=S-b/((v-S)/2+d),y=o;y<=s;y++)i.set(y,y,i.get(y,y)-d);l+=d,S=v=b=.964}for(w=w+1,E=s-2;E>=m&&(_=i.get(E,E),p=S-_,d=v-_,h=(p*d-b)/i.get(E+1,E)+i.get(E,E+1),f=i.get(E+1,E+1)-_-p-d,p=i.get(E+2,E+1),d=Math.abs(h)+Math.abs(f)+Math.abs(p),h=h/d,f=f/d,p=p/d,!(E===m||Math.abs(i.get(E,E-1))*(Math.abs(f)+Math.abs(p))<u*(Math.abs(h)*(Math.abs(i.get(E-1,E-1))+Math.abs(_)+Math.abs(i.get(E+1,E+1))))));)E--;for(y=E+2;y<=s;y++)i.set(y,y-2,0),y>E+2&&i.set(y,y-3,0);for(g=E;g<=s-1&&(O=g!==s-1,g!==E&&(h=i.get(g,g-1),f=i.get(g+1,g-1),p=O?i.get(g+2,g-1):0,S=Math.abs(h)+Math.abs(f)+Math.abs(p),S!==0&&(h=h/S,f=f/S,p=p/S)),S!==0);g++)if(d=Math.sqrt(h*h+f*f+p*p),h<0&&(d=-d),d!==0){for(g!==E?i.set(g,g-1,-d*S):m!==E&&i.set(g,g-1,-i.get(g,g-1)),h=h+d,S=h/d,v=f/d,_=p/d,f=f/h,p=p/h,x=g;x<n;x++)h=i.get(g,x)+f*i.get(g+1,x),O&&(h=h+p*i.get(g+2,x),i.set(g+2,x,i.get(g+2,x)-h*_)),i.set(g,x,i.get(g,x)-h*S),i.set(g+1,x,i.get(g+1,x)-h*v);for(y=0;y<=Math.min(s,g+3);y++)h=S*i.get(y,g)+v*i.get(y,g+1),O&&(h=h+_*i.get(y,g+2),i.set(y,g+2,i.get(y,g+2)-h*p)),i.set(y,g,i.get(y,g)-h),i.set(y,g+1,i.get(y,g+1)-h*f);for(y=o;y<=a;y++)h=S*r.get(y,g)+v*r.get(y,g+1),O&&(h=h+_*r.get(y,g+2),r.set(y,g+2,r.get(y,g+2)-h*p)),r.set(y,g,r.get(y,g)-h),r.set(y,g+1,r.get(y,g+1)-h*f)}}}if(c!==0){for(s=n-1;s>=0;s--)if(h=e[s],f=t[s],f===0)for(m=s,i.set(s,s,1),y=s-1;y>=0;y--){for(b=i.get(y,y)-h,p=0,x=m;x<=s;x++)p=p+i.get(y,x)*i.get(x,s);if(t[y]<0)_=b,d=p;else if(m=y,t[y]===0?i.set(y,s,b!==0?-p/b:-p/(u*c)):(S=i.get(y,y+1),v=i.get(y+1,y),f=(e[y]-h)*(e[y]-h)+t[y]*t[y],N=(S*d-_*p)/f,i.set(y,s,N),i.set(y+1,s,Math.abs(S)>Math.abs(_)?(-p-b*N)/S:(-d-v*N)/_)),N=Math.abs(i.get(y,s)),u*N*N>1)for(x=y;x<=s;x++)i.set(x,s,i.get(x,s)/N)}else if(f<0)for(m=s-1,Math.abs(i.get(s,s-1))>Math.abs(i.get(s-1,s))?(i.set(s-1,s-1,f/i.get(s,s-1)),i.set(s-1,s,-(i.get(s,s)-h)/i.get(s,s-1))):(j=sa(0,-i.get(s-1,s),i.get(s-1,s-1)-h,f),i.set(s-1,s-1,j[0]),i.set(s-1,s,j[1])),i.set(s,s-1,0),i.set(s,s,1),y=s-2;y>=0;y--){for(I=0,T=0,x=m;x<=s;x++)I=I+i.get(y,x)*i.get(x,s-1),T=T+i.get(y,x)*i.get(x,s);if(b=i.get(y,y)-h,t[y]<0)_=b,p=I,d=T;else if(m=y,t[y]===0?(j=sa(-I,-T,b,f),i.set(y,s-1,j[0]),i.set(y,s,j[1])):(S=i.get(y,y+1),v=i.get(y+1,y),A=(e[y]-h)*(e[y]-h)+t[y]*t[y]-f*f,K=(e[y]-h)*2*f,A===0&&K===0&&(A=u*c*(Math.abs(b)+Math.abs(f)+Math.abs(S)+Math.abs(v)+Math.abs(_))),j=sa(S*p-_*I+f*T,S*d-_*T-f*I,A,K),i.set(y,s-1,j[0]),i.set(y,s,j[1]),Math.abs(S)>Math.abs(_)+Math.abs(f)?(i.set(y+1,s-1,(-I-b*i.get(y,s-1)+f*i.get(y,s))/S),i.set(y+1,s,(-T-b*i.get(y,s)-f*i.get(y,s-1))/S)):(j=sa(-p-v*i.get(y,s-1),-d-v*i.get(y,s),_,f),i.set(y+1,s-1,j[0]),i.set(y+1,s,j[1]))),N=Math.max(Math.abs(i.get(y,s-1)),Math.abs(i.get(y,s))),u*N*N>1)for(x=y;x<=s;x++)i.set(x,s-1,i.get(x,s-1)/N),i.set(x,s,i.get(x,s)/N)}for(y=0;y<n;y++)if(y<o||y>a)for(x=y;x<n;x++)r.set(y,x,i.get(y,x));for(x=n-1;x>=o;x--)for(y=o;y<=a;y++){for(_=0,g=o;g<=Math.min(x,a);g++)_=_+r.get(y,g)*i.get(g,x);r.set(y,x,_)}}}function sa(n,t,e,r){let i,s;return Math.abs(e)>Math.abs(r)?(i=r/e,s=e+i*r,[(n+i*t)/s,(t-i*n)/s]):(i=e/r,s=r+i*e,[(i*n+t)/s,(i*t-n)/s])}class Xf{constructor(t){if(t=yr.checkMatrix(t),!t.isSymmetric())throw new Error("Matrix is not symmetric");let e=t,r=e.rows,i=new z(r,r),s=!0,o,a,u;for(a=0;a<r;a++){let l=0;for(u=0;u<a;u++){let c=0;for(o=0;o<u;o++)c+=i.get(u,o)*i.get(a,o);c=(e.get(a,u)-c)/i.get(u,u),i.set(a,u,c),l=l+c*c}for(l=e.get(a,a)-l,s&=l>0,i.set(a,a,Math.sqrt(Math.max(l,0))),u=a+1;u<r;u++)i.set(a,u,0)}this.L=i,this.positiveDefinite=!!s}isPositiveDefinite(){return this.positiveDefinite}solve(t){t=yr.checkMatrix(t);let e=this.L,r=e.rows;if(t.rows!==r)throw new Error("Matrix dimensions do not match");if(this.isPositiveDefinite()===!1)throw new Error("Matrix is not positive definite");let i=t.columns,s=t.clone(),o,a,u;for(u=0;u<r;u++)for(a=0;a<i;a++){for(o=0;o<u;o++)s.set(u,a,s.get(u,a)-s.get(o,a)*e.get(u,o));s.set(u,a,s.get(u,a)/e.get(u,u))}for(u=r-1;u>=0;u--)for(a=0;a<i;a++){for(o=u+1;o<r;o++)s.set(u,a,s.get(u,a)-s.get(o,a)*e.get(o,u));s.set(u,a,s.get(u,a)/e.get(u,u))}return s}get lowerTriangularMatrix(){return this.L}}class Yf{constructor(t,e={}){t=yr.checkMatrix(t);let{Y:r}=e;const{scaleScores:i=!1,maxIterations:s=1e3,terminationCriteria:o=1e-10}=e;let a;if(r){if(Qe.isAnyArray(r)&&typeof r[0]=="number"?r=z.columnVector(r):r=yr.checkMatrix(r),r.rows!==t.rows)throw new Error("Y should have the same number of rows as X");a=r.getColumnVector(0)}else a=t.getColumnVector(0);let u=1,l,c,h,f;for(let p=0;p<s&&u>o;p++)h=t.transpose().mmul(a).div(a.transpose().mmul(a).get(0,0)),h=h.div(h.norm()),l=t.mmul(h).div(h.transpose().mmul(h).get(0,0)),p>0&&(u=l.clone().sub(f).pow(2).sum()),f=l.clone(),r?(c=r.transpose().mmul(l).div(l.transpose().mmul(l).get(0,0)),c=c.div(c.norm()),a=r.mmul(c).div(c.transpose().mmul(c).get(0,0))):a=l;if(r){let p=t.transpose().mmul(l).div(l.transpose().mmul(l).get(0,0));p=p.div(p.norm());let d=t.clone().sub(l.clone().mmul(p.transpose())),_=a.transpose().mmul(l).div(l.transpose().mmul(l).get(0,0)),w=r.clone().sub(l.clone().mulS(_.get(0,0)).mmul(c.transpose()));this.t=l,this.p=p.transpose(),this.w=h.transpose(),this.q=c,this.u=a,this.s=l.transpose().mmul(l),this.xResidual=d,this.yResidual=w,this.betas=_}else this.w=h.transpose(),this.s=l.transpose().mmul(l).sqrt(),i?this.t=l.clone().div(this.s.get(0,0)):this.t=l,this.xResidual=t.sub(l.mmul(h.transpose()))}}mt.AbstractMatrix=Jt;mt.CHO=Xf;mt.CholeskyDecomposition=Xf;mt.DistanceMatrix=gu;mt.EVD=Wf;mt.EigenvalueDecomposition=Wf;mt.LU=du;mt.LuDecomposition=du;var vy=mt.Matrix=z;mt.MatrixColumnSelectionView=Qv;mt.MatrixColumnView=Jv;mt.MatrixFlipColumnView=$v;mt.MatrixFlipRowView=ty;mt.MatrixRowSelectionView=ry;mt.MatrixRowView=ey;mt.MatrixSelectionView=ma;mt.MatrixSubView=ny;mt.MatrixTransposeView=iy;mt.NIPALS=Yf;mt.Nipals=Yf;mt.QR=Bl;mt.QrDecomposition=Bl;mt.SVD=Os;var yy=mt.SingularValueDecomposition=Os;mt.SymmetricMatrix=Ei;mt.WrapperMatrix1D=Vf;mt.WrapperMatrix2D=yr;mt.correlation=fy;mt.covariance=hy;var Zc=mt.default=z;mt.determinant=va;var _y=mt.inverse=oy;mt.linearDependencies=ly;var wy=mt.pseudoInverse=cy;mt.solve=qf;mt.wrap=sy;const Mr=vy,Ey=yy;Zc.Matrix&&Zc.Matrix;const xy=_y,Zf=wy;class ko{constructor(t,e,r,i){M(this,"sourcePoints");M(this,"destinationPoints");M(this,"pointCount");M(this,"pointCountMinimum");M(this,"type");if(this.sourcePoints=t,this.destinationPoints=e,this.pointCount=this.sourcePoints.length,this.type=r,this.pointCountMinimum=i,this.pointCount<this.pointCountMinimum)throw new Error("Not enough control points. A "+this.type+" transformation requires a minimum of "+this.pointCountMinimum+" points, but "+this.pointCount+" are given.")}evaluate(t,e="function"){if(e=="function")return this.evaluateFunction(t);if(e=="partialDerivativeX")return this.evaluatePartialDerivativeX(t);if(e=="partialDerivativeY")return this.evaluatePartialDerivativeY(t);throw new Error("Evaluation of type "+e+" not supported")}}class Hf extends ko{constructor(e,r){super(e,r,"helmert",2);M(this,"helmertParametersMatrix");M(this,"helmertParameters");M(this,"scale");M(this,"rotation");M(this,"translation");const i=Mr.columnVector(r.flat()),s=Mr.zeros(2*this.pointCount,4);for(let a=0;a<this.pointCount;a++)s.set(2*a,0,1),s.set(2*a,1,0),s.set(2*a,2,this.sourcePoints[a][0]),s.set(2*a,3,-this.sourcePoints[a][1]),s.set(2*a+1,0,0),s.set(2*a+1,1,1),s.set(2*a+1,2,this.sourcePoints[a][1]),s.set(2*a+1,3,this.sourcePoints[a][0]);const o=Zf(s);this.helmertParametersMatrix=o.mmul(i),this.helmertParameters=this.helmertParametersMatrix.to1DArray(),this.scale=Math.sqrt(this.helmertParameters[2]**2+this.helmertParameters[3]**2),this.rotation=Math.atan2(this.helmertParameters[3],this.helmertParameters[2]),this.translation=[this.helmertParameters[0],this.helmertParameters[1]]}evaluateFunction(e){if(!this.helmertParameters)throw new Error("Helmert parameters not computed");return[this.helmertParameters[0]+this.helmertParameters[2]*e[0]-this.helmertParameters[3]*e[1],this.helmertParameters[1]+this.helmertParameters[2]*e[1]+this.helmertParameters[3]*e[0]]}evaluatePartialDerivativeX(e){if(!this.helmertParameters)throw new Error("Helmert parameters not computed");return[this.helmertParameters[2],this.helmertParameters[3]]}evaluatePartialDerivativeY(e){if(!this.helmertParameters)throw new Error("Helmert parameters not computed");return[-this.helmertParameters[3],this.helmertParameters[2]]}}class Iy extends ko{constructor(e,r){super(e,r,"straight",2);M(this,"scale");M(this,"sourcePointsCenter");M(this,"destinationPointsCenter");M(this,"translation");const i=new Hf(this.sourcePoints,this.destinationPoints);if(this.scale=i.scale,!this.scale)throw new Error("Scale could not be computed");this.sourcePointsCenter=this.sourcePoints.reduce((o,a)=>[o[0]+a[0],o[1]+a[1]]).map(o=>o/this.pointCount),this.destinationPointsCenter=this.destinationPoints.reduce((o,a)=>[o[0]+a[0],o[1]+a[1]]).map(o=>o/this.pointCount);const s=this.scale;this.translation=this.destinationPointsCenter.map((o,a)=>o-this.sourcePointsCenter[a]*s)}evaluateFunction(e){if(!this.scale||!this.translation)throw new Error("Straight parameters not computed");return[this.translation[0]+this.scale*e[0],this.translation[1]+this.scale*e[1]]}evaluatePartialDerivativeX(e){if(!this.scale||!this.translation)throw new Error("Straight parameters not computed");return[this.scale,0]}evaluatePartialDerivativeY(e){if(!this.scale||!this.translation)throw new Error("Straight parameters not computed");return[0,this.scale]}}class Ou extends ko{constructor(e,r,i){i=i||1;const s=(i+1)*(i+2)/2;super(e,r,"polynomial"+i,s);M(this,"polynomialParametersMatrices");M(this,"polynomialParameters");M(this,"order");M(this,"pointCountMinimum");if(this.order=i,this.pointCountMinimum=s,this.order<1||this.order>3)throw new Error("Only polynomial transformations of order 1, 2 or 3 are supported");const o=[Mr.columnVector(this.destinationPoints.map(l=>l[0])),Mr.columnVector(this.destinationPoints.map(l=>l[1]))],a=Mr.zeros(this.pointCount,this.pointCountMinimum);for(let l=0;l<this.pointCount;l++)switch(this.order){case 1:a.set(l,0,1),a.set(l,1,this.sourcePoints[l][0]),a.set(l,2,this.sourcePoints[l][1]);break;case 2:a.set(l,0,1),a.set(l,1,this.sourcePoints[l][0]),a.set(l,2,this.sourcePoints[l][1]),a.set(l,3,this.sourcePoints[l][0]**2),a.set(l,4,this.sourcePoints[l][1]**2),a.set(l,5,this.sourcePoints[l][0]*this.sourcePoints[l][1]);break;case 3:a.set(l,0,1),a.set(l,1,this.sourcePoints[l][0]),a.set(l,2,this.sourcePoints[l][1]),a.set(l,3,this.sourcePoints[l][0]**2),a.set(l,4,this.sourcePoints[l][1]**2),a.set(l,5,this.sourcePoints[l][0]*this.sourcePoints[l][1]),a.set(l,6,this.sourcePoints[l][0]**3),a.set(l,7,this.sourcePoints[l][1]**3),a.set(l,8,this.sourcePoints[l][0]**2*this.sourcePoints[l][1]),a.set(l,9,this.sourcePoints[l][0]*this.sourcePoints[l][1]**2);break}const u=Zf(a);this.polynomialParametersMatrices=[u.mmul(o[0]),u.mmul(o[1])],this.polynomialParameters=this.polynomialParametersMatrices.map(l=>l.to1DArray())}evaluateFunction(e){if(!this.polynomialParameters)throw new Error("Polynomial parameters not computed");const r=[0,0];for(let i=0;i<2;i++)switch(this.order){case 1:r[i]+=this.polynomialParameters[i][0]+this.polynomialParameters[i][1]*e[0]+this.polynomialParameters[i][2]*e[1];break;case 2:r[i]+=this.polynomialParameters[i][0]+this.polynomialParameters[i][1]*e[0]+this.polynomialParameters[i][2]*e[1]+this.polynomialParameters[i][3]*e[0]**2+this.polynomialParameters[i][4]*e[1]**2+this.polynomialParameters[i][5]*e[0]*e[1];break;case 3:r[i]+=this.polynomialParameters[i][0]+this.polynomialParameters[i][1]*e[0]+this.polynomialParameters[i][2]*e[1]+this.polynomialParameters[i][3]*e[0]**2+this.polynomialParameters[i][4]*e[1]**2+this.polynomialParameters[i][5]*e[0]*e[1]+this.polynomialParameters[i][6]*e[0]**3+this.polynomialParameters[i][7]*e[1]**3+this.polynomialParameters[i][8]*e[0]**2*e[1]+this.polynomialParameters[i][9]*e[0]*e[1]**2;break}return r}evaluatePartialDerivativeX(e){if(!this.polynomialParameters)throw new Error("Polynomial parameters not computed");const r=[0,0];for(let i=0;i<2;i++)switch(this.order){case 1:r[i]+=this.polynomialParameters[i][1];break;case 2:r[i]+=this.polynomialParameters[i][1]+2*this.polynomialParameters[i][3]*e[0]+this.polynomialParameters[i][5]*e[1];break;case 3:r[i]+=this.polynomialParameters[i][1]+2*this.polynomialParameters[i][3]*e[0]+this.polynomialParameters[i][5]*e[1]+3*this.polynomialParameters[i][6]*e[0]**2+2*this.polynomialParameters[i][8]*e[0]*e[1]+this.polynomialParameters[i][9]*e[1]**2;break}return r}evaluatePartialDerivativeY(e){if(!this.polynomialParameters)throw new Error("Polynomial parameters not computed");const r=[0,0];for(let i=0;i<2;i++)switch(this.order){case 1:r[i]+=this.polynomialParameters[i][2];break;case 2:r[i]+=this.polynomialParameters[i][2]+2*this.polynomialParameters[i][4]*e[1]+this.polynomialParameters[i][5]*e[0];break;case 3:r[i]+=this.polynomialParameters[i][2]+2*this.polynomialParameters[i][4]*e[1]+this.polynomialParameters[i][5]*e[0]+3*this.polynomialParameters[i][7]*e[1]**2+this.polynomialParameters[i][8]*e[0]**2+2*this.polynomialParameters[i][9]*e[0]*e[1];break}return r}}class Cy extends ko{constructor(e,r){super(e,r,"projective",4);M(this,"projectiveParametersMatrix");M(this,"projectiveParameters");const i=Mr.zeros(2*this.pointCount,9);for(let o=0;o<this.pointCount;o++)i.set(2*o,0,-e[o][0]),i.set(2*o,1,-e[o][1]),i.set(2*o,2,-1),i.set(2*o,3,0),i.set(2*o,4,0),i.set(2*o,5,0),i.set(2*o,6,r[o][0]*e[o][0]),i.set(2*o,7,r[o][0]*e[o][1]),i.set(2*o,8,r[o][0]),i.set(2*o+1,0,0),i.set(2*o+1,1,0),i.set(2*o+1,2,0),i.set(2*o+1,3,-e[o][0]),i.set(2*o+1,4,-e[o][1]),i.set(2*o+1,5,-1),i.set(2*o+1,6,r[o][1]*e[o][0]),i.set(2*o+1,7,r[o][1]*e[o][1]),i.set(2*o+1,8,r[o][1]);const s=new Ey(i);this.projectiveParametersMatrix=Mr.from1DArray(3,3,s.rightSingularVectors.getColumn(8)).transpose(),this.projectiveParameters=this.projectiveParametersMatrix.to2DArray()}evaluateFunction(e){if(!this.projectiveParameters)throw new Error("projective parameters not computed");const r=this.projectiveParameters[0][2]*e[0]+this.projectiveParameters[1][2]*e[1]+this.projectiveParameters[2][2],i=this.projectiveParameters[0][0]*e[0]+this.projectiveParameters[1][0]*e[1]+this.projectiveParameters[2][0],s=this.projectiveParameters[0][1]*e[0]+this.projectiveParameters[1][1]*e[1]+this.projectiveParameters[2][1];return[i/r,s/r]}evaluatePartialDerivativeX(e){if(!this.projectiveParameters)throw new Error("projective parameters not computed");const r=this.projectiveParameters[0][2]*e[0]+this.projectiveParameters[1][2]*e[1]+this.projectiveParameters[2][2],i=this.projectiveParameters[0][0]*e[0]+this.projectiveParameters[1][0]*e[1]+this.projectiveParameters[2][0],s=this.projectiveParameters[0][1]*e[0]+this.projectiveParameters[1][1]*e[1]+this.projectiveParameters[2][1];return[(r*this.projectiveParameters[0][0]-this.projectiveParameters[0][2]*i)/r**2,(r*this.projectiveParameters[0][1]-this.projectiveParameters[0][2]*s)/r**2]}evaluatePartialDerivativeY(e){if(!this.projectiveParameters)throw new Error("projective parameters not computed");const r=this.projectiveParameters[0][2]*e[0]+this.projectiveParameters[1][2]*e[1]+this.projectiveParameters[2][2],i=this.projectiveParameters[0][0]*e[0]+this.projectiveParameters[1][0]*e[1]+this.projectiveParameters[2][0],s=this.projectiveParameters[0][1]*e[0]+this.projectiveParameters[1][1]*e[1]+this.projectiveParameters[2][1];return[(r*this.projectiveParameters[1][0]-this.projectiveParameters[1][2]*i)/r**2,(r*this.projectiveParameters[1][1]-this.projectiveParameters[1][2]*s)/r**2]}}class Sy extends ko{constructor(e,r,i,s,o){super(e,r,"thinPlateSpline",3);M(this,"kernelFunction");M(this,"normFunction");M(this,"weightsMatrices");M(this,"rbfWeights");M(this,"affineWeights");M(this,"epsilon");this.kernelFunction=i,this.normFunction=s;const a=[Mr.columnVector([...this.destinationPoints,[0,0],[0,0],[0,0]].map(f=>f[0])),Mr.columnVector([...this.destinationPoints,[0,0],[0,0],[0,0]].map(f=>f[1]))],u=Mr.zeros(this.pointCount,this.pointCount);for(let f=0;f<this.pointCount;f++)for(let p=0;p<this.pointCount;p++)u.set(f,p,s(this.sourcePoints[f],this.sourcePoints[p]));o===void 0&&(o=u.sum()/(Math.pow(this.pointCount,2)-this.pointCount)),this.epsilon=o;for(let f=0;f<this.pointCount;f++)for(let p=0;p<this.pointCount;p++)u.set(f,p,i(u.get(f,p),{epsilon:o}));const l=Mr.zeros(this.pointCount,3),c=Mr.zeros(this.pointCount+3,this.pointCount+3);for(let f=0;f<this.pointCount;f++)l.set(f,0,1),l.set(f,1,this.sourcePoints[f][0]),l.set(f,2,this.sourcePoints[f][1]);for(let f=0;f<this.pointCount+3;f++)for(let p=0;p<this.pointCount+3;p++)f<this.pointCount&&p<this.pointCount?c.set(f,p,u.get(f,p)):f>=this.pointCount&&p<this.pointCount?c.set(f,p,l.transpose().get(f-this.pointCount,p)):f<this.pointCount&&p>=this.pointCount&&c.set(f,p,l.get(f,p-this.pointCount));const h=xy(c);this.weightsMatrices=[h.mmul(a[0]),h.mmul(a[1])],this.rbfWeights=this.weightsMatrices.map(f=>f.selection([...Array(this.pointCount).keys()],[0]).to1DArray()),this.affineWeights=this.weightsMatrices.map(f=>f.selection([0,1,2].map(p=>p+this.pointCount),[0]).to1DArray())}evaluateFunction(e){if(!this.rbfWeights||!this.affineWeights)throw new Error("Weights not computed");const r=this.sourcePoints.map(s=>this.normFunction(e,s)),i=[0,0];for(let s=0;s<2;s++)i[s]=r.reduce((o,a,u)=>o+this.kernelFunction(a,{epsilon:this.epsilon})*this.rbfWeights[s][u],0),i[s]+=this.affineWeights[s][0]+this.affineWeights[s][1]*e[0]+this.affineWeights[s][2]*e[1];return i}evaluatePartialDerivativeX(e){if(!this.rbfWeights||!this.affineWeights)throw new Error("Weights not computed");const r=this.sourcePoints.map(s=>this.normFunction(e,s)),i=[0,0];for(let s=0;s<2;s++)i[s]=r.reduce((o,a,u)=>o+(a==0?0:this.kernelFunction(a,{derivative:1,epsilon:this.epsilon})*((e[0]-this.sourcePoints[u][0])/a)*this.rbfWeights[s][u]),0),i[s]+=this.affineWeights[s][1];return i}evaluatePartialDerivativeY(e){if(!this.rbfWeights||!this.affineWeights)throw new Error("Weights not computed");const r=this.sourcePoints.map(s=>this.normFunction(e,s)),i=[0,0];for(let s=0;s<2;s++)i[s]=r.reduce((o,a,u)=>o+(a==0?0:this.kernelFunction(a,{derivative:1,epsilon:this.epsilon})*((e[1]-this.sourcePoints[u][1])/a)*this.rbfWeights[s][u]),0),i[s]+=this.affineWeights[s][2];return i}}function by(n,t){if(t.derivative){if(t.derivative==1)return n===0?0:n+2*n*Math.log(n);throw new Error("Derivate of order "+t.derivative+" not implemented")}else return n===0?0:Math.pow(n,2)*Math.log(n)}function My(n,t){const e=[t[0]-n[0],t[1]-n[1]];return Math.sqrt(e[0]**2+e[1]**2)}function kt(n,t,e){return{maxOffsetRatio:0,maxDepth:0,destinationIsGeographic:!1,sourceIsGeographic:!1,inputIsMultiGeometry:!1,differentHandedness:!1,evaluationType:"function",...e,...t,...n}}function oa(n,t,e){t=lu(t);const r=t.map(o=>({source:o,destination:n.transformForward(o)})),i=mu(r,!1),s=Kf(n,i,e);return vu(s,!0).map(o=>o.destination)}function aa(n,t,e){t=lu(t);const r=t.map(o=>({source:n.transformBackward(o),destination:o})),i=mu(r,!1),s=Jf(n,i,e);return vu(s,!0).map(o=>o.source)}function Ny(n,t,e){t=Pl(t);const r=t.map(o=>({source:o,destination:n.transformForward(o)})),i=mu(r,!0),s=Kf(n,i,e);return vu(s,!1).map(o=>o.destination)}function Ty(n,t,e){t=Pl(t);const r=t.map(o=>({source:n.transformBackward(o),destination:o})),i=mu(r,!0),s=Jf(n,i,e);return vu(s,!1).map(o=>o.source)}function ua(n,t,e){return t.map(r=>Ny(n,r,e))}function la(n,t,e){return t.map(r=>Ty(n,r,e))}function mu(n,t=!1){const e=n.length-(t?0:1),r=[];for(let i=0;i<e;i++)r.push({from:n[i],to:n[(i+1)%n.length]});return r}function vu(n,t=!1){const e=n.map(r=>r.from);return t&&e.push(n[n.length-1].to),e}function Kf(n,t,e){return e.maxDepth<=0?t:t.map(r=>cl(n,r,e,0)).flat(1)}function Jf(n,t,e){return e.maxDepth<=0?t:t.map(r=>hl(n,r,e,0)).flat(1)}function cl(n,t,e,r){if(r>=e.maxDepth)return t;const i=(e.sourceIsGeographic?(l,c)=>qa(l,c).geometry.coordinates:Ta)(t.from.source,t.to.source),s=(e.destinationIsGeographic?(l,c)=>qa(l,c).geometry.coordinates:Ta)(t.from.destination,t.to.destination),o=n.transformForward(i),a=e.destinationIsGeographic?Fl:ar,u=a(t.from.destination,t.to.destination);if(a(s,o)/u>e.maxOffsetRatio&&u>0){const l={source:i,destination:o};return[cl(n,{from:t.from,to:l},e,r+1),cl(n,{from:l,to:t.to},e,r+1)].flat(1)}else return t}function hl(n,t,e,r){if(r>=e.maxDepth)return t;const i=(e.destinationIsGeographic?(l,c)=>qa(l,c).geometry.coordinates:Ta)(t.from.destination,t.to.destination),s=(e.sourceIsGeographic?(l,c)=>qa(l,c).geometry.coordinates:Ta)(t.from.source,t.to.source),o=n.transformBackward(i),a=e.sourceIsGeographic?Fl:ar,u=a(t.from.source,t.to.source);if(a(s,o)/u>e.maxOffsetRatio&&u>0){const l={source:o,destination:i};return[hl(n,{from:t.from,to:l},e,r+1),hl(n,{from:l,to:t.to},e,r+1)].flat(1)}else return t}class Du{constructor(t,e="polynomial",r){M(this,"gcps");M(this,"sourcePoints");M(this,"destinationPoints");M(this,"type");M(this,"options");M(this,"forwardTransformation");M(this,"backwardTransformation");if(r&&(this.options=r),t.length===0)throw new Error("No control points");this.gcps=t.map(i=>{if("resource"in i&&"geo"in i)return{source:i.resource,destination:i.geo};if("source"in i&&"destination"in i)return i;throw new Error("Unsupported GCP type")}),this.sourcePoints=this.gcps.map(i=>i.source),this.destinationPoints=this.gcps.map(i=>i.destination),this.type=e}createForwardTransformation(){this.forwardTransformation=this.computeTransformation(this.sourcePoints.map(t=>this.assureEqualHandedness(t)),this.destinationPoints)}createBackwardTransformation(){this.backwardTransformation=this.computeTransformation(this.destinationPoints,this.sourcePoints.map(t=>this.assureEqualHandedness(t)))}transformForward(t,e){if(!kt(e,this.options).inputIsMultiGeometry){if(je(t))return this.forwardTransformation||this.createForwardTransformation(),this.forwardTransformation.evaluate(this.assureEqualHandedness(t),kt(e,this.options).evaluationType);if(Pn(t))return this.transformForward(Vs(t),e);if(Vr(t))return oa(this,t,kt(e,this.options));if(Rn(t))return oa(this,qs(t),kt(e,this.options,{sourceIsGeographic:!0}));if(qr(t))return ua(this,t,kt(e,this.options));if(Ln(t))return ua(this,Ws(t),kt(e,this.options,{sourceIsGeographic:!0}))}if(e&&(e.inputIsMultiGeometry=!1),Mn(t))return t.map(r=>this.transformForward(r,e));if(An(t))return Ko(t).map(r=>this.transformForward(r,e));if(Nn(t))return t.map(r=>this.transformForward(r,e));if(On(t))return Jo(t).map(r=>this.transformForward(r,e));if(Tn(t))return t.map(r=>this.transformForward(r,e));if(Dn(t))return Qo(t).map(r=>this.transformForward(r,e));throw new Error("Input type not supported")}transformForwardAsGeojson(t,e){if(!kt(e,this.options).inputIsMultiGeometry){if(je(t))return Yo(this.transformForward(t));if(Pn(t))return Yo(this.transformForward(Vs(t)));if(Vr(t))return Zo(oa(this,t,kt(e,this.options,{destinationIsGeographic:!0})));if(Rn(t))return Zo(oa(this,qs(t),kt(e,this.options,{sourceIsGeographic:!0,destinationIsGeographic:!0})));if(qr(t))return Ho(ua(this,t,kt(e,this.options,{destinationIsGeographic:!0})));if(Ln(t))return Ho(ua(this,Ws(t),kt(e,this.options,{sourceIsGeographic:!0,destinationIsGeographic:!0})))}if(e&&(e.inputIsMultiGeometry=!1),Mn(t))return $o(t.map(r=>this.transformForwardAsGeojson(r,e)));if(An(t))return $o(Ko(t).map(r=>this.transformForwardAsGeojson(r,e)));if(Nn(t))return ta(t.map(r=>this.transformForwardAsGeojson(r,e)));if(On(t))return ta(Jo(t).map(r=>this.transformForwardAsGeojson(r,e)));if(Tn(t))return ea(t.map(r=>this.transformForwardAsGeojson(r,e)));if(Dn(t))return ea(Qo(t).map(r=>this.transformForwardAsGeojson(r,e)));throw new Error("Input type not supported")}transformBackward(t,e){if(!kt(e,this.options).inputIsMultiGeometry){if(je(t))return this.backwardTransformation||this.createBackwardTransformation(),this.assureEqualHandedness(this.backwardTransformation.evaluate(t));if(Pn(t))return this.transformBackward(Vs(t));if(Vr(t))return aa(this,t,kt(e,this.options));if(Rn(t))return aa(this,qs(t),kt(e,this.options,{destinationIsGeographic:!0}));if(qr(t))return la(this,t,kt(e,this.options));if(Ln(t))return la(this,Ws(t),kt(e,this.options,{destinationIsGeographic:!0}))}if(e&&(e.inputIsMultiGeometry=!1),Mn(t))return t.map(r=>this.transformBackward(r,e));if(An(t))return Ko(t).map(r=>this.transformBackward(r,e));if(Nn(t))return t.map(r=>this.transformBackward(r,e));if(On(t))return Jo(t).map(r=>this.transformBackward(r,e));if(Tn(t))return t.map(r=>this.transformBackward(r,e));if(Dn(t))return Qo(t).map(r=>this.transformBackward(r,e));throw new Error("Input type not supported")}transformBackwardAsGeojson(t,e){if(!kt(e,this.options).inputIsMultiGeometry){if(je(t))return Yo(this.transformBackward(t));if(Pn(t))return Yo(this.transformBackward(Vs(t)));if(Vr(t))return Zo(aa(this,t,kt(e,this.options,{sourceIsGeographic:!0})));if(Rn(t))return Zo(aa(this,qs(t),kt(e,this.options,{sourceIsGeographic:!0,destinationIsGeographic:!0})));if(qr(t))return Ho(la(this,t,kt(e,this.options,{sourceIsGeographic:!0})));if(Ln(t))return Ho(la(this,Ws(t),kt(e,this.options,{sourceIsGeographic:!0,destinationIsGeographic:!0})))}if(e&&(e.inputIsMultiGeometry=!1),Mn(t))return $o(t.map(r=>this.transformBackwardAsGeojson(r,e)));if(An(t))return $o(Ko(t).map(r=>this.transformBackwardAsGeojson(r,e)));if(Nn(t))return ta(t.map(r=>this.transformBackwardAsGeojson(r,e)));if(On(t))return ta(Jo(t).map(r=>this.transformBackwardAsGeojson(r,e)));if(Tn(t))return ea(t.map(r=>this.transformBackwardAsGeojson(r,e)));if(Dn(t))return ea(Qo(t).map(r=>this.transformBackwardAsGeojson(r,e)));throw new Error("Input type not supported")}transformToGeo(t,e){if(!kt(e,this.options).inputIsMultiGeometry){if(je(t))return this.transformForward(t,e);if(Pn(t))return this.transformForward(t,e);if(Vr(t))return this.transformForward(t,e);if(Rn(t))return this.transformForward(t,e);if(qr(t))return this.transformForward(t,e);if(Ln(t))return this.transformForward(t,e)}if(e&&(e.inputIsMultiGeometry=!1),Mn(t))return this.transformForward(t,e);if(An(t))return this.transformForward(t,e);if(Nn(t))return this.transformForward(t,e);if(On(t))return this.transformForward(t,e);if(Tn(t))return this.transformForward(t,e);if(Dn(t))return this.transformForward(t,e);throw new Error("Input type not supported")}transformToGeoAsGeojson(t,e){if(!kt(e,this.options).inputIsMultiGeometry){if(je(t))return this.transformForwardAsGeojson(t,e);if(Pn(t))return this.transformForwardAsGeojson(t,e);if(Vr(t))return this.transformForwardAsGeojson(t,e);if(Rn(t))return this.transformForwardAsGeojson(t,e);if(qr(t))return this.transformForwardAsGeojson(t,e);if(Ln(t))return this.transformForwardAsGeojson(t,e)}if(e&&(e.inputIsMultiGeometry=!1),Mn(t))return this.transformForwardAsGeojson(t,e);if(An(t))return this.transformForwardAsGeojson(t,e);if(Nn(t))return this.transformForwardAsGeojson(t,e);if(On(t))return this.transformForwardAsGeojson(t,e);if(Tn(t))return this.transformForwardAsGeojson(t,e);if(Dn(t))return this.transformForwardAsGeojson(t,e);throw new Error("Input type not supported")}transformToResource(t,e){if(!kt(e,this.options).inputIsMultiGeometry){if(je(t))return this.transformBackward(t,e);if(Pn(t))return this.transformBackward(t,e);if(Vr(t))return this.transformBackward(t,e);if(Rn(t))return this.transformBackward(t,e);if(qr(t))return this.transformBackward(t,e);if(Ln(t))return this.transformBackward(t,e)}if(e&&(e.inputIsMultiGeometry=!1),Mn(t))return this.transformBackward(t,e);if(An(t))return this.transformBackward(t,e);if(Nn(t))return this.transformBackward(t,e);if(On(t))return this.transformBackward(t,e);if(Tn(t))return this.transformBackward(t,e);if(Dn(t))return this.transformBackward(t,e);throw new Error("Input type not supported")}transformToResourceAsGeojson(t,e){if(!kt(e,this.options).inputIsMultiGeometry){if(je(t))return this.transformBackwardAsGeojson(t,e);if(Pn(t))return this.transformBackwardAsGeojson(t,e);if(Vr(t))return this.transformBackwardAsGeojson(t,e);if(Rn(t))return this.transformBackwardAsGeojson(t,e);if(qr(t))return this.transformBackwardAsGeojson(t,e);if(Ln(t))return this.transformBackwardAsGeojson(t,e)}if(e&&(e.inputIsMultiGeometry=!1),Mn(t))return this.transformBackwardAsGeojson(t,e);if(An(t))return this.transformBackwardAsGeojson(t,e);if(Nn(t))return this.transformBackwardAsGeojson(t,e);if(On(t))return this.transformBackwardAsGeojson(t,e);if(Tn(t))return this.transformBackwardAsGeojson(t,e);if(Dn(t))return this.transformBackwardAsGeojson(t,e);throw new Error("Input type not supported")}transformSvgToGeojson(t,e){if(t.type==="circle")return this.transformForwardAsGeojson(t.coordinates);if(t.type==="line")return this.transformForwardAsGeojson(t.coordinates,e);if(t.type==="polyline")return this.transformForwardAsGeojson(t.coordinates,e);if(t.type==="rect")return this.transformForwardAsGeojson([t.coordinates],e);if(t.type==="polygon")return this.transformForwardAsGeojson([t.coordinates],e);throw new Error("Unsupported SVG geometry")}transformSvgStringToGeojsonFeatureCollection(t,e){const r=[];for(const i of Md(t)){const s=this.transformSvgToGeojson(i,e);r.push(s)}return gd(r)}transformGeojsonToSvg(t,e){if(t.type==="Point")return{type:"circle",coordinates:this.transformBackward(t)};if(t.type==="LineString")return{type:"polyline",coordinates:this.transformBackward(t,e)};if(t.type==="Polygon")return{type:"polygon",coordinates:this.transformBackward(t,e)[0]};throw new Error("Unsupported GeoJSON geometry")}transformGeojsonFeatureCollectionToSvgString(t,e){const r=[];for(const i of md(t)){const s=this.transformGeojsonToSvg(i,e);r.push(s)}return Td(r)}assureEqualHandedness(t){var e;return(e=this.options)!=null&&e.differentHandedness?id(t):t}computeTransformation(t,e){if(this.type==="straight")return new Iy(t,e);if(this.type==="helmert")return new Hf(t,e);if(this.type==="polynomial1"||this.type==="polynomial")return new Ou(t,e);if(this.type==="polynomial2")return new Ou(t,e,2);if(this.type==="polynomial3")return new Ou(t,e,3);if(this.type==="projective")return new Cy(t,e);if(this.type==="thinPlateSpline")return new Sy(t,e,by,My);throw new Error(`Unsupported transformation type: ${this.type}`)}}const Qf=["log2sigma","twoOmega","airyKavr","signDetJ","thetaa"];function Py(n,t,e,r=1){if(!e)return 0;const i=n[0]**2+n[1]**2,s=t[0]**2+t[1]**2,o=n[0]*t[0]+n[1]*t[1],a=Math.sqrt(.5*(i+s+Math.sqrt((i-s)**2+4*o**2))),u=Math.sqrt(.5*(i+s-Math.sqrt((i-s)**2+4*o**2))),l=Math.atan(n[1]/n[0]),c=Math.sign(-o)*Math.asin(Math.sqrt((1-a**2/i)/(1-(a/u)**2)));switch(Qf.indexOf(e)){case 0:return(Math.log(a*u)-2*Math.log(r))/Math.log(2);case 1:return 2*Math.asin((a-u)/(a+u));case 2:return .5*(Math.log(a/r)**2+Math.log(u/r)**2);case 3:return Math.sign(n[0]*t[1]-n[1]*t[0]);case 4:return l-c;default:throw new Error("Distortion "+e+" not supported")}}var B=(n=>(n.GEOREFERENCEANNOTATIONADDED="georeferenceannotationadded",n.GEOREFERENCEANNOTATIONREMOVED="georeferenceannotationremoved",n.WARPEDMAPADDED="warpedmapadded",n.WARPEDMAPREMOVED="warpedmapremoved",n.WARPEDMAPENTER="warpedmapenter",n.WARPEDMAPLEAVE="warpedmapleave",n.IMAGEINFOLOADED="imageinfoloaded",n.TILEFETCHED="tilefetched",n.TILEFETCHERROR="tilefetcherror",n.MAPTILELOADED="maptileloaded",n.MAPTILEREMOVED="maptileremoved",n.FIRSTMAPTILELOADED="firstmaptileloaded",n.ALLREQUESTEDTILESLOADED="allrequestedtilesloaded",n.TEXTURESUPDATED="texturesupdated",n.ZINDICESCHANGES="zindiceschanged",n.RESOURCEMASKUPDATED="resourcemaskupdated",n.VISIBILITYCHANGED="visibilitychanged",n.TRANSFORMATIONCHANGED="transformationchanged",n.DISTORTIONCHANGED="distortionchanged",n.CHANGED="changed",n.CLEARED="cleared",n))(B||{});let ct=class extends Event{constructor(t,e){super(t);M(this,"data");this.data=e}};const Fu={maxOffsetRatio:.05,maxDepth:2,differentHandedness:!0},$f=!0;function Ry(){return{visible:$f}}class Ly extends EventTarget{constructor(e,r,i){var s,o;super();M(this,"mapId");M(this,"georeferencedMap");M(this,"gcps");M(this,"projectedGcps");M(this,"resourceMask");M(this,"resourceMaskBbox");M(this,"resourceMaskRectangle");M(this,"resourceFullMask");M(this,"resourceFullMaskBbox");M(this,"resourceFullMaskRectangle");M(this,"imageInformations");M(this,"imageId");M(this,"parsedImage");M(this,"loadingImageInfo");M(this,"fetchFn");M(this,"visible");M(this,"transformationType");M(this,"transformer");M(this,"projectedTransformer");M(this,"transformerByTransformationType",new Map);M(this,"projectedTransformerByTransformationType",new Map);M(this,"geoMask");M(this,"geoMaskBbox");M(this,"geoMaskRectangle");M(this,"geoFullMask");M(this,"geoFullMaskBbox");M(this,"geoFullMaskRectangle");M(this,"projectedGeoMask");M(this,"projectedGeoMaskBbox");M(this,"projectedGeoMaskRectangle");M(this,"projectedGeoFullMask");M(this,"projectedGeoFullMaskBbox");M(this,"projectedGeoFullMaskRectangle");M(this,"resourceToProjectedGeoScale");M(this,"distortionMeasure");M(this,"bestScaleFactor");M(this,"resourceViewportRing",[]);M(this,"resourceViewportRingBbox");i={...Ry(),...i},this.mapId=e,this.georeferencedMap=r,this.gcps=this.georeferencedMap.gcps,this.projectedGcps=this.gcps.map(({resource:a,geo:u})=>({resource:a,geo:Yi(u)})),this.resourceMask=this.georeferencedMap.resourceMask,this.updateResourceMaskProperties(),this.resourceFullMask=[[0,0],[this.georeferencedMap.resource.width,0],[this.georeferencedMap.resource.width,this.georeferencedMap.resource.height],[0,this.georeferencedMap.resource.height]],this.resourceFullMaskBbox=De(this.resourceFullMask),this.resourceFullMaskRectangle=Pa(this.resourceFullMaskBbox),this.imageInformations=i.imageInformations,this.loadingImageInfo=!1,this.visible=i.visible||$f,this.fetchFn=i.fetchFn,this.transformationType=((s=i.transformation)==null?void 0:s.type)||((o=this.georeferencedMap.transformation)==null?void 0:o.type)||"polynomial",this.updateTransformerProperties()}getViewportMask(e){return this.projectedGeoMask.map(r=>$i(e.projectedGeoToViewportTransform,r))}getViewportMaskBbox(e){return De(this.getViewportMask(e))}getViewportMaskRectangle(e){return this.projectedGeoMaskRectangle.map(r=>$i(e.projectedGeoToViewportTransform,r))}getViewportFullMask(e){return this.projectedGeoFullMask.map(r=>$i(e.projectedGeoToViewportTransform,r))}getViewportFullMaskBbox(e){return De(this.getViewportFullMask(e))}getViewportFullMaskRectangle(e){return this.projectedGeoFullMaskRectangle.map(r=>$i(e.projectedGeoToViewportTransform,r))}getResourceToViewportScale(e){return Nc(this.resourceMaskRectangle,this.getViewportMaskRectangle(e))}getResourceToCanvasScale(e){return this.getResourceToViewportScale(e)/e.devicePixelRatio}getReferenceScale(){const e=da(this.projectedTransformerByTransformationType,"helmert",()=>new Du(this.projectedGcps,"helmert",Fu));return e.forwardTransformation||e.createForwardTransformation(),e.forwardTransformation.scale}setResourceViewportRing(e){this.resourceViewportRing=e,this.resourceViewportRingBbox=De(e)}setResourceMask(e){this.resourceMask=e,this.updateResourceMaskProperties(),this.updateGeoMask(),this.updateProjectedGeoMask(),this.updateResourceToProjectedGeoScale()}setTransformationType(e){this.transformationType=e,this.updateTransformerProperties()}setDistortionMeasure(e){this.distortionMeasure=e}setGcps(e){this.gcps=e,this.updateTransformerProperties(!1)}setBestScaleFactor(e){const r=this.bestScaleFactor!=e;return r&&(this.bestScaleFactor=e),r}hasImageInfo(){return this.imageId!==void 0&&this.parsedImage!==void 0}async loadImageInfo(){var e,r;try{this.loadingImageInfo=!0;const i=this.georeferencedMap.resource.id;let s;(e=this.imageInformations)!=null&&e.get(i)?s=this.imageInformations.get(i):(s=await Qg(i,void 0,this.fetchFn),(r=this.imageInformations)==null||r.set(i,s)),this.parsedImage=Dl.parse(s),this.imageId=await sf(i),this.dispatchEvent(new ct(B.IMAGEINFOLOADED))}catch(i){throw this.loadingImageInfo=!1,i}finally{this.loadingImageInfo=!1}}dispose(){}updateResourceMaskProperties(){this.resourceMaskBbox=De(this.resourceMask),this.resourceMaskRectangle=Pa(this.resourceMaskBbox)}updateTransformerProperties(e=!0){this.updateTransformer(e),this.updateProjectedTransformer(e),this.updateGeoMask(),this.updateFullGeoMask(),this.updateProjectedGeoMask(),this.updateProjectedFullGeoMask(),this.updateResourceToProjectedGeoScale()}updateTransformer(e=!0){this.transformer=da(this.transformerByTransformationType,this.transformationType,()=>new Du(this.gcps,this.transformationType,Fu),e)}updateProjectedTransformer(e=!0){this.projectedTransformer=da(this.projectedTransformerByTransformationType,this.transformationType,()=>new Du(this.projectedGcps,this.transformationType,Fu),e)}updateGeoMask(){this.geoMask=this.transformer.transformForwardAsGeojson([this.resourceMask]),this.geoMaskBbox=De(this.geoMask),this.geoMaskRectangle=this.transformer.transformForward([this.resourceMaskRectangle],{maxDepth:0})[0]}updateFullGeoMask(){this.geoFullMask=this.transformer.transformForwardAsGeojson([this.resourceFullMask]),this.geoFullMaskBbox=De(this.geoFullMask),this.geoFullMaskRectangle=this.transformer.transformForward([this.resourceFullMaskRectangle],{maxDepth:0})[0]}updateProjectedGeoMask(){this.projectedGeoMask=this.projectedTransformer.transformForward([this.resourceMask])[0],this.projectedGeoMaskBbox=De(this.projectedGeoMask),this.projectedGeoMaskRectangle=this.projectedTransformer.transformForward([this.resourceMaskRectangle],{maxDepth:0})[0]}updateProjectedFullGeoMask(){this.projectedGeoFullMask=this.projectedTransformer.transformForward([this.resourceFullMask])[0],this.projectedGeoFullMaskBbox=De(this.projectedGeoFullMask),this.projectedGeoFullMaskRectangle=this.projectedTransformer.transformForward([this.resourceFullMaskRectangle],{maxDepth:0})[0]}updateResourceToProjectedGeoScale(){this.resourceToProjectedGeoScale=Nc(this.resourceMaskRectangle,this.projectedGeoMaskRectangle)}}function Ay(n){return Math.sqrt(Math.pow(n[1][0]-n[0][0],2)+Math.pow(n[1][1]-n[0][1],2))}function Oy(n){return Math.atan2(n[1][1]-n[0][1],n[1][0]-n[0][0])}function Dy(n,t,e){return[n[0]+Math.cos(e)*t,n[1]+Math.sin(e)*t]}function Fy(n,t){let e=n[0];const r=[e];for(;Ay([e,n[1]])>t;){const i=Dy(e,t,Oy(n));r.push(i),e=i}return r}function ky(n,t){n=[...n,n[0]];let e=[];for(let r=0;r<n.length-1;r++)e=e.concat(Fy([n[r],n[r+1]],t));return e}function Gy(n,t){const e=[],r=De(n);for(let i=r[0]+t,s=0;i<=r[2];s++,i+=t)for(let o=r[1]+t,a=0;o<=r[3];a++,o+=t)e.push([i,o]);return e}function By(n){return n&&n.__esModule&&Object.prototype.hasOwnProperty.call(n,"default")?n.default:n}var tp={exports:{}},ep=zy,Hc=+(Math.pow(2,27)+1);function zy(n,t,e){var r=n*t,i=Hc*n,s=i-n,o=i-s,a=n-o,u=Hc*t,l=u-t,c=u-l,h=t-c,f=r-o*c,p=f-a*c,d=p-o*h,_=a*h-d;return e?(e[0]=_,e[1]=r,e):[_,r]}var Uy=Vy;function jy(n,t){var e=n+t,r=e-n,i=e-r,s=t-r,o=n-i,a=o+s;return a?[a,e]:[e]}function Vy(n,t){var e=n.length|0,r=t.length|0;if(e===1&&r===1)return jy(n[0],t[0]);var i=e+r,s=new Array(i),o=0,a=0,u=0,l=Math.abs,c=n[a],h=l(c),f=t[u],p=l(f),d,_;h<p?(_=c,a+=1,a<e&&(c=n[a],h=l(c))):(_=f,u+=1,u<r&&(f=t[u],p=l(f))),a<e&&h<p||u>=r?(d=c,a+=1,a<e&&(c=n[a],h=l(c))):(d=f,u+=1,u<r&&(f=t[u],p=l(f)));for(var w=d+_,y=w-d,x=_-y,g=x,m=w,E,N,b,S,v;a<e&&u<r;)h<p?(d=c,a+=1,a<e&&(c=n[a],h=l(c))):(d=f,u+=1,u<r&&(f=t[u],p=l(f))),_=g,w=d+_,y=w-d,x=_-y,x&&(s[o++]=x),E=m+w,N=E-m,b=E-N,S=w-N,v=m-b,g=v+S,m=E;for(;a<e;)d=c,_=g,w=d+_,y=w-d,x=_-y,x&&(s[o++]=x),E=m+w,N=E-m,b=E-N,S=w-N,v=m-b,g=v+S,m=E,a+=1,a<e&&(c=n[a]);for(;u<r;)d=f,_=g,w=d+_,y=w-d,x=_-y,x&&(s[o++]=x),E=m+w,N=E-m,b=E-N,S=w-N,v=m-b,g=v+S,m=E,u+=1,u<r&&(f=t[u]);return g&&(s[o++]=g),m&&(s[o++]=m),o||(s[o++]=0),s.length=o,s}var qy=Wy;function Wy(n,t,e){var r=n+t,i=r-n,s=r-i,o=t-i,a=n-s;return e?(e[0]=a+o,e[1]=r,e):[a+o,r]}var ku=ep,Xy=qy,Yy=Zy;function Zy(n,t){var e=n.length;if(e===1){var r=ku(n[0],t);return r[0]?r:[r[1]]}var i=new Array(2*e),s=[.1,.1],o=[.1,.1],a=0;ku(n[0],t,s),s[0]&&(i[a++]=s[0]);for(var u=1;u<e;++u){ku(n[u],t,o);var l=s[1];Xy(l,o[0],s),s[0]&&(i[a++]=s[0]);var c=o[1],h=s[1],f=c+h,p=f-c,d=h-p;s[1]=f,d&&(i[a++]=d)}return s[1]&&(i[a++]=s[1]),a===0&&(i[a++]=0),i.length=a,i}var Hy=Jy;function Ky(n,t){var e=n+t,r=e-n,i=e-r,s=t-r,o=n-i,a=o+s;return a?[a,e]:[e]}function Jy(n,t){var e=n.length|0,r=t.length|0;if(e===1&&r===1)return Ky(n[0],-t[0]);var i=e+r,s=new Array(i),o=0,a=0,u=0,l=Math.abs,c=n[a],h=l(c),f=-t[u],p=l(f),d,_;h<p?(_=c,a+=1,a<e&&(c=n[a],h=l(c))):(_=f,u+=1,u<r&&(f=-t[u],p=l(f))),a<e&&h<p||u>=r?(d=c,a+=1,a<e&&(c=n[a],h=l(c))):(d=f,u+=1,u<r&&(f=-t[u],p=l(f)));for(var w=d+_,y=w-d,x=_-y,g=x,m=w,E,N,b,S,v;a<e&&u<r;)h<p?(d=c,a+=1,a<e&&(c=n[a],h=l(c))):(d=f,u+=1,u<r&&(f=-t[u],p=l(f))),_=g,w=d+_,y=w-d,x=_-y,x&&(s[o++]=x),E=m+w,N=E-m,b=E-N,S=w-N,v=m-b,g=v+S,m=E;for(;a<e;)d=c,_=g,w=d+_,y=w-d,x=_-y,x&&(s[o++]=x),E=m+w,N=E-m,b=E-N,S=w-N,v=m-b,g=v+S,m=E,a+=1,a<e&&(c=n[a]);for(;u<r;)d=f,_=g,w=d+_,y=w-d,x=_-y,x&&(s[o++]=x),E=m+w,N=E-m,b=E-N,S=w-N,v=m-b,g=v+S,m=E,u+=1,u<r&&(f=-t[u]);return g&&(s[o++]=g),m&&(s[o++]=m),o||(s[o++]=0),s.length=o,s}(function(n){var t=ep,e=Uy,r=Yy,i=Hy,s=5,o=11102230246251565e-32,a=(3+16*o)*o,u=(7+56*o)*o;function l(g,m,E,N){return function(b,S,v){var I=g(g(m(S[1],v[0]),m(-v[1],S[0])),g(m(b[1],S[0]),m(-S[1],b[0]))),T=g(m(b[1],v[0]),m(-v[1],b[0])),A=N(I,T);return A[A.length-1]}}function c(g,m,E,N){return function(b,S,v,I){var T=g(g(E(g(m(v[1],I[0]),m(-I[1],v[0])),S[2]),g(E(g(m(S[1],I[0]),m(-I[1],S[0])),-v[2]),E(g(m(S[1],v[0]),m(-v[1],S[0])),I[2]))),g(E(g(m(S[1],I[0]),m(-I[1],S[0])),b[2]),g(E(g(m(b[1],I[0]),m(-I[1],b[0])),-S[2]),E(g(m(b[1],S[0]),m(-S[1],b[0])),I[2])))),A=g(g(E(g(m(v[1],I[0]),m(-I[1],v[0])),b[2]),g(E(g(m(b[1],I[0]),m(-I[1],b[0])),-v[2]),E(g(m(b[1],v[0]),m(-v[1],b[0])),I[2]))),g(E(g(m(S[1],v[0]),m(-v[1],S[0])),b[2]),g(E(g(m(b[1],v[0]),m(-v[1],b[0])),-S[2]),E(g(m(b[1],S[0]),m(-S[1],b[0])),v[2])))),K=N(T,A);return K[K.length-1]}}function h(g,m,E,N){return function(b,S,v,I,T){var A=g(g(g(E(g(E(g(m(I[1],T[0]),m(-T[1],I[0])),v[2]),g(E(g(m(v[1],T[0]),m(-T[1],v[0])),-I[2]),E(g(m(v[1],I[0]),m(-I[1],v[0])),T[2]))),S[3]),g(E(g(E(g(m(I[1],T[0]),m(-T[1],I[0])),S[2]),g(E(g(m(S[1],T[0]),m(-T[1],S[0])),-I[2]),E(g(m(S[1],I[0]),m(-I[1],S[0])),T[2]))),-v[3]),E(g(E(g(m(v[1],T[0]),m(-T[1],v[0])),S[2]),g(E(g(m(S[1],T[0]),m(-T[1],S[0])),-v[2]),E(g(m(S[1],v[0]),m(-v[1],S[0])),T[2]))),I[3]))),g(E(g(E(g(m(v[1],I[0]),m(-I[1],v[0])),S[2]),g(E(g(m(S[1],I[0]),m(-I[1],S[0])),-v[2]),E(g(m(S[1],v[0]),m(-v[1],S[0])),I[2]))),-T[3]),g(E(g(E(g(m(I[1],T[0]),m(-T[1],I[0])),S[2]),g(E(g(m(S[1],T[0]),m(-T[1],S[0])),-I[2]),E(g(m(S[1],I[0]),m(-I[1],S[0])),T[2]))),b[3]),E(g(E(g(m(I[1],T[0]),m(-T[1],I[0])),b[2]),g(E(g(m(b[1],T[0]),m(-T[1],b[0])),-I[2]),E(g(m(b[1],I[0]),m(-I[1],b[0])),T[2]))),-S[3])))),g(g(E(g(E(g(m(S[1],T[0]),m(-T[1],S[0])),b[2]),g(E(g(m(b[1],T[0]),m(-T[1],b[0])),-S[2]),E(g(m(b[1],S[0]),m(-S[1],b[0])),T[2]))),I[3]),g(E(g(E(g(m(S[1],I[0]),m(-I[1],S[0])),b[2]),g(E(g(m(b[1],I[0]),m(-I[1],b[0])),-S[2]),E(g(m(b[1],S[0]),m(-S[1],b[0])),I[2]))),-T[3]),E(g(E(g(m(v[1],I[0]),m(-I[1],v[0])),S[2]),g(E(g(m(S[1],I[0]),m(-I[1],S[0])),-v[2]),E(g(m(S[1],v[0]),m(-v[1],S[0])),I[2]))),b[3]))),g(E(g(E(g(m(v[1],I[0]),m(-I[1],v[0])),b[2]),g(E(g(m(b[1],I[0]),m(-I[1],b[0])),-v[2]),E(g(m(b[1],v[0]),m(-v[1],b[0])),I[2]))),-S[3]),g(E(g(E(g(m(S[1],I[0]),m(-I[1],S[0])),b[2]),g(E(g(m(b[1],I[0]),m(-I[1],b[0])),-S[2]),E(g(m(b[1],S[0]),m(-S[1],b[0])),I[2]))),v[3]),E(g(E(g(m(S[1],v[0]),m(-v[1],S[0])),b[2]),g(E(g(m(b[1],v[0]),m(-v[1],b[0])),-S[2]),E(g(m(b[1],S[0]),m(-S[1],b[0])),v[2]))),-I[3]))))),K=g(g(g(E(g(E(g(m(I[1],T[0]),m(-T[1],I[0])),v[2]),g(E(g(m(v[1],T[0]),m(-T[1],v[0])),-I[2]),E(g(m(v[1],I[0]),m(-I[1],v[0])),T[2]))),b[3]),E(g(E(g(m(I[1],T[0]),m(-T[1],I[0])),b[2]),g(E(g(m(b[1],T[0]),m(-T[1],b[0])),-I[2]),E(g(m(b[1],I[0]),m(-I[1],b[0])),T[2]))),-v[3])),g(E(g(E(g(m(v[1],T[0]),m(-T[1],v[0])),b[2]),g(E(g(m(b[1],T[0]),m(-T[1],b[0])),-v[2]),E(g(m(b[1],v[0]),m(-v[1],b[0])),T[2]))),I[3]),E(g(E(g(m(v[1],I[0]),m(-I[1],v[0])),b[2]),g(E(g(m(b[1],I[0]),m(-I[1],b[0])),-v[2]),E(g(m(b[1],v[0]),m(-v[1],b[0])),I[2]))),-T[3]))),g(g(E(g(E(g(m(v[1],T[0]),m(-T[1],v[0])),S[2]),g(E(g(m(S[1],T[0]),m(-T[1],S[0])),-v[2]),E(g(m(S[1],v[0]),m(-v[1],S[0])),T[2]))),b[3]),E(g(E(g(m(v[1],T[0]),m(-T[1],v[0])),b[2]),g(E(g(m(b[1],T[0]),m(-T[1],b[0])),-v[2]),E(g(m(b[1],v[0]),m(-v[1],b[0])),T[2]))),-S[3])),g(E(g(E(g(m(S[1],T[0]),m(-T[1],S[0])),b[2]),g(E(g(m(b[1],T[0]),m(-T[1],b[0])),-S[2]),E(g(m(b[1],S[0]),m(-S[1],b[0])),T[2]))),v[3]),E(g(E(g(m(S[1],v[0]),m(-v[1],S[0])),b[2]),g(E(g(m(b[1],v[0]),m(-v[1],b[0])),-S[2]),E(g(m(b[1],S[0]),m(-S[1],b[0])),v[2]))),-T[3])))),O=N(A,K);return O[O.length-1]}}function f(g){var m=g===3?l:g===4?c:h;return m(e,t,r,i)}var p=f(3),d=f(4),_=[function(){return 0},function(){return 0},function(g,m){return m[0]-g[0]},function(g,m,E){var N=(g[1]-E[1])*(m[0]-E[0]),b=(g[0]-E[0])*(m[1]-E[1]),S=N-b,v;if(N>0){if(b<=0)return S;v=N+b}else if(N<0){if(b>=0)return S;v=-(N+b)}else return S;var I=a*v;return S>=I||S<=-I?S:p(g,m,E)},function(g,m,E,N){var b=g[0]-N[0],S=m[0]-N[0],v=E[0]-N[0],I=g[1]-N[1],T=m[1]-N[1],A=E[1]-N[1],K=g[2]-N[2],O=m[2]-N[2],j=E[2]-N[2],q=S*A,yt=v*T,Et=v*I,Pt=b*A,bt=b*T,Qt=S*I,$=K*(q-yt)+O*(Et-Pt)+j*(bt-Qt),Nt=(Math.abs(q)+Math.abs(yt))*Math.abs(K)+(Math.abs(Et)+Math.abs(Pt))*Math.abs(O)+(Math.abs(bt)+Math.abs(Qt))*Math.abs(j),$t=u*Nt;return $>$t||-$>$t?$:d(g,m,E,N)}];function w(g){var m=_[g.length];return m||(m=_[g.length]=f(g.length)),m.apply(void 0,g)}function y(g,m,E,N,b,S,v){return function(I,T,A,K,O){switch(arguments.length){case 0:case 1:return 0;case 2:return N(I,T);case 3:return b(I,T,A);case 4:return S(I,T,A,K);case 5:return v(I,T,A,K,O)}for(var j=new Array(arguments.length),q=0;q<arguments.length;++q)j[q]=arguments[q];return g(j)}}function x(){for(;_.length<=s;)_.push(f(_.length));n.exports=y.apply(void 0,[w].concat(_));for(var g=0;g<=s;++g)n.exports[g]=_[g]}x()})(tp);var Qy=tp.exports,$y=t0,ca=Qy;function t0(n,t){for(var e=t[0],r=t[1],i=n.length,s=1,o=i,a=0,u=i-1;a<o;u=a++){var l=n[a],c=n[u],h=l[1],f=c[1];if(f<h){if(f<r&&r<h){var p=ca(l,c,t);if(p===0)return 0;s^=0<p|0}else if(r===h){var d=n[(a+1)%i],_=d[1];if(h<_){var p=ca(l,c,t);if(p===0)return 0;s^=0<p|0}}}else if(h<f){if(h<r&&r<f){var p=ca(l,c,t);if(p===0)return 0;s^=p<0|0}else if(r===h){var d=n[(a+1)%i],_=d[1];if(_<h){var p=ca(l,c,t);if(p===0)return 0;s^=p<0|0}}}else if(r===h){var w=Math.min(l[0],c[0]),y=Math.max(l[0],c[0]);if(a===0){for(;u>0;){var x=(u+i-1)%i,g=n[x];if(g[1]!==r)break;var m=g[0];w=Math.min(w,m),y=Math.max(y,m),u=x}if(u===0)return w<=e&&e<=y?0:1;o=u+1}for(var E=n[(u+i-1)%i][1];a+1<o;){var g=n[a+1];if(g[1]!==r)break;var m=g[0];w=Math.min(w,m),y=Math.max(y,m),a+=1}if(w<=e&&e<=y)return 0;var N=n[(a+1)%i][1];e<w&&E<r!=N<r&&(s^=1)}}return 2*s-1}const e0=By($y);var rp={};const r0="1.5.0",n0={version:r0};function np(n){return"("+n.x+";"+n.y+")"}function i0(n){var t=n.toString();return t==="[object Object]"?np(n):t}function s0(n,t){return n.y===t.y?n.x-t.x:n.y-t.y}function o0(n,t){return n.x===t.x&&n.y===t.y}var zl={toString:i0,toStringBase:np,compare:s0,equals:o0},a0=zl,Wa=function(n,t){this.name="PointError",this.points=t=t||[],this.message=n||"Invalid Points!";for(var e=0;e<t.length;e++)this.message+=" "+a0.toString(t[e])};Wa.prototype=new Error;Wa.prototype.constructor=Wa;var Ul=Wa,Go=zl,Mt=function(n,t){this.x=+n||0,this.y=+t||0,this._p2t_edge_list=null};Mt.prototype.toString=function(){return Go.toStringBase(this)};Mt.prototype.toJSON=function(){return{x:this.x,y:this.y}};Mt.prototype.clone=function(){return new Mt(this.x,this.y)};Mt.prototype.set_zero=function(){return this.x=0,this.y=0,this};Mt.prototype.set=function(n,t){return this.x=+n||0,this.y=+t||0,this};Mt.prototype.negate=function(){return this.x=-this.x,this.y=-this.y,this};Mt.prototype.add=function(n){return this.x+=n.x,this.y+=n.y,this};Mt.prototype.sub=function(n){return this.x-=n.x,this.y-=n.y,this};Mt.prototype.mul=function(n){return this.x*=n,this.y*=n,this};Mt.prototype.length=function(){return Math.sqrt(this.x*this.x+this.y*this.y)};Mt.prototype.normalize=function(){var n=this.length();return this.x/=n,this.y/=n,n};Mt.prototype.equals=function(n){return this.x===n.x&&this.y===n.y};Mt.negate=function(n){return new Mt(-n.x,-n.y)};Mt.add=function(n,t){return new Mt(n.x+t.x,n.y+t.y)};Mt.sub=function(n,t){return new Mt(n.x-t.x,n.y-t.y)};Mt.mul=function(n,t){return new Mt(n*t.x,n*t.y)};Mt.cross=function(n,t){return typeof n=="number"?typeof t=="number"?n*t:new Mt(-n*t.y,n*t.x):typeof t=="number"?new Mt(t*n.y,-t*n.x):n.x*t.y-n.y*t.x};Mt.toString=Go.toString;Mt.compare=Go.compare;Mt.cmp=Go.compare;Mt.equals=Go.equals;Mt.dot=function(n,t){return n.x*t.x+n.y*t.y};var ip=Mt,u0=zl,dt=function(n,t,e){this.points_=[n,t,e],this.neighbors_=[null,null,null],this.interior_=!1,this.constrained_edge=[!1,!1,!1],this.delaunay_edge=[!1,!1,!1]},Gu=u0.toString;dt.prototype.toString=function(){return"["+Gu(this.points_[0])+Gu(this.points_[1])+Gu(this.points_[2])+"]"};dt.prototype.getPoint=function(n){return this.points_[n]};dt.prototype.GetPoint=dt.prototype.getPoint;dt.prototype.getPoints=function(){return this.points_};dt.prototype.getNeighbor=function(n){return this.neighbors_[n]};dt.prototype.containsPoint=function(n){var t=this.points_;return n===t[0]||n===t[1]||n===t[2]};dt.prototype.containsEdge=function(n){return this.containsPoint(n.p)&&this.containsPoint(n.q)};dt.prototype.containsPoints=function(n,t){return this.containsPoint(n)&&this.containsPoint(t)};dt.prototype.isInterior=function(){return this.interior_};dt.prototype.setInterior=function(n){return this.interior_=n,this};dt.prototype.markNeighborPointers=function(n,t,e){var r=this.points_;if(n===r[2]&&t===r[1]||n===r[1]&&t===r[2])this.neighbors_[0]=e;else if(n===r[0]&&t===r[2]||n===r[2]&&t===r[0])this.neighbors_[1]=e;else if(n===r[0]&&t===r[1]||n===r[1]&&t===r[0])this.neighbors_[2]=e;else throw new Error("poly2tri Invalid Triangle.markNeighborPointers() call")};dt.prototype.markNeighbor=function(n){var t=this.points_;n.containsPoints(t[1],t[2])?(this.neighbors_[0]=n,n.markNeighborPointers(t[1],t[2],this)):n.containsPoints(t[0],t[2])?(this.neighbors_[1]=n,n.markNeighborPointers(t[0],t[2],this)):n.containsPoints(t[0],t[1])&&(this.neighbors_[2]=n,n.markNeighborPointers(t[0],t[1],this))};dt.prototype.clearNeighbors=function(){this.neighbors_[0]=null,this.neighbors_[1]=null,this.neighbors_[2]=null};dt.prototype.clearDelaunayEdges=function(){this.delaunay_edge[0]=!1,this.delaunay_edge[1]=!1,this.delaunay_edge[2]=!1};dt.prototype.pointCW=function(n){var t=this.points_;return n===t[0]?t[2]:n===t[1]?t[0]:n===t[2]?t[1]:null};dt.prototype.pointCCW=function(n){var t=this.points_;return n===t[0]?t[1]:n===t[1]?t[2]:n===t[2]?t[0]:null};dt.prototype.neighborCW=function(n){return n===this.points_[0]?this.neighbors_[1]:n===this.points_[1]?this.neighbors_[2]:this.neighbors_[0]};dt.prototype.neighborCCW=function(n){return n===this.points_[0]?this.neighbors_[2]:n===this.points_[1]?this.neighbors_[0]:this.neighbors_[1]};dt.prototype.getConstrainedEdgeCW=function(n){return n===this.points_[0]?this.constrained_edge[1]:n===this.points_[1]?this.constrained_edge[2]:this.constrained_edge[0]};dt.prototype.getConstrainedEdgeCCW=function(n){return n===this.points_[0]?this.constrained_edge[2]:n===this.points_[1]?this.constrained_edge[0]:this.constrained_edge[1]};dt.prototype.getConstrainedEdgeAcross=function(n){return n===this.points_[0]?this.constrained_edge[0]:n===this.points_[1]?this.constrained_edge[1]:this.constrained_edge[2]};dt.prototype.setConstrainedEdgeCW=function(n,t){n===this.points_[0]?this.constrained_edge[1]=t:n===this.points_[1]?this.constrained_edge[2]=t:this.constrained_edge[0]=t};dt.prototype.setConstrainedEdgeCCW=function(n,t){n===this.points_[0]?this.constrained_edge[2]=t:n===this.points_[1]?this.constrained_edge[0]=t:this.constrained_edge[1]=t};dt.prototype.getDelaunayEdgeCW=function(n){return n===this.points_[0]?this.delaunay_edge[1]:n===this.points_[1]?this.delaunay_edge[2]:this.delaunay_edge[0]};dt.prototype.getDelaunayEdgeCCW=function(n){return n===this.points_[0]?this.delaunay_edge[2]:n===this.points_[1]?this.delaunay_edge[0]:this.delaunay_edge[1]};dt.prototype.setDelaunayEdgeCW=function(n,t){n===this.points_[0]?this.delaunay_edge[1]=t:n===this.points_[1]?this.delaunay_edge[2]=t:this.delaunay_edge[0]=t};dt.prototype.setDelaunayEdgeCCW=function(n,t){n===this.points_[0]?this.delaunay_edge[2]=t:n===this.points_[1]?this.delaunay_edge[0]=t:this.delaunay_edge[1]=t};dt.prototype.neighborAcross=function(n){return n===this.points_[0]?this.neighbors_[0]:n===this.points_[1]?this.neighbors_[1]:this.neighbors_[2]};dt.prototype.oppositePoint=function(n,t){var e=n.pointCW(t);return this.pointCW(e)};dt.prototype.legalize=function(n,t){var e=this.points_;if(n===e[0])e[1]=e[0],e[0]=e[2],e[2]=t;else if(n===e[1])e[2]=e[1],e[1]=e[0],e[0]=t;else if(n===e[2])e[0]=e[2],e[2]=e[1],e[1]=t;else throw new Error("poly2tri Invalid Triangle.legalize() call")};dt.prototype.index=function(n){var t=this.points_;if(n===t[0])return 0;if(n===t[1])return 1;if(n===t[2])return 2;throw new Error("poly2tri Invalid Triangle.index() call")};dt.prototype.edgeIndex=function(n,t){var e=this.points_;if(n===e[0]){if(t===e[1])return 2;if(t===e[2])return 1}else if(n===e[1]){if(t===e[2])return 0;if(t===e[0])return 2}else if(n===e[2]){if(t===e[0])return 1;if(t===e[1])return 0}return-1};dt.prototype.markConstrainedEdgeByIndex=function(n){this.constrained_edge[n]=!0};dt.prototype.markConstrainedEdgeByEdge=function(n){this.markConstrainedEdgeByPoints(n.p,n.q)};dt.prototype.markConstrainedEdgeByPoints=function(n,t){var e=this.points_;t===e[0]&&n===e[1]||t===e[1]&&n===e[0]?this.constrained_edge[2]=!0:t===e[0]&&n===e[2]||t===e[2]&&n===e[0]?this.constrained_edge[1]=!0:(t===e[1]&&n===e[2]||t===e[2]&&n===e[1])&&(this.constrained_edge[0]=!0)};var jl=dt,Vl={};function l0(n,t){if(!n)throw new Error(t||"Assert Failed")}var c0=l0,ql={exports:{}},h0=function(n,t){this.point=n,this.triangle=t||null,this.next=null,this.prev=null,this.value=n.x},bn=function(n,t){this.head_=n,this.tail_=t,this.search_node_=n};bn.prototype.head=function(){return this.head_};bn.prototype.setHead=function(n){this.head_=n};bn.prototype.tail=function(){return this.tail_};bn.prototype.setTail=function(n){this.tail_=n};bn.prototype.search=function(){return this.search_node_};bn.prototype.setSearch=function(n){this.search_node_=n};bn.prototype.findSearchNode=function(){return this.search_node_};bn.prototype.locateNode=function(n){var t=this.search_node_;if(n<t.value){for(;t=t.prev;)if(n>=t.value)return this.search_node_=t,t}else for(;t=t.next;)if(n<t.value)return this.search_node_=t.prev,t.prev;return null};bn.prototype.locatePoint=function(n){var t=n.x,e=this.findSearchNode(t),r=e.point.x;if(t===r){if(n!==e.point)if(n===e.prev.point)e=e.prev;else if(n===e.next.point)e=e.next;else throw new Error("poly2tri Invalid AdvancingFront.locatePoint() call")}else if(t<r)for(;(e=e.prev)&&n!==e.point;);else for(;(e=e.next)&&n!==e.point;);return e&&(this.search_node_=e),e};ql.exports=bn;ql.exports.Node=h0;var sp=ql.exports,Ds={},Mo=1e-12;Ds.EPSILON=Mo;var ya={CW:1,CCW:-1,COLLINEAR:0};Ds.Orientation=ya;function f0(n,t,e){var r=(n.x-e.x)*(t.y-e.y),i=(n.y-e.y)*(t.x-e.x),s=r-i;return s>-Mo&&s<Mo?ya.COLLINEAR:s>0?ya.CCW:ya.CW}Ds.orient2d=f0;function p0(n,t,e,r){var i=(n.x-t.x)*(r.y-t.y)-(r.x-t.x)*(n.y-t.y);if(i>=-Mo)return!1;var s=(n.x-e.x)*(r.y-e.y)-(r.x-e.x)*(n.y-e.y);return!(s<=Mo)}Ds.inScanArea=p0;function g0(n,t,e){var r=t.x-n.x,i=t.y-n.y,s=e.x-n.x,o=e.y-n.y;return r*s+i*o<0}Ds.isAngleObtuse=g0;var Wl=c0,Xa=Ul,op=jl,d0=sp.Node,Bo=Ds,m0=Bo.EPSILON,te=Bo.Orientation,_e=Bo.orient2d,ap=Bo.inScanArea,Kc=Bo.isAngleObtuse;function v0(n){n.initTriangulation(),n.createAdvancingFront(),y0(n),_0(n)}function y0(n){var t,e=n.pointCount();for(t=1;t<e;++t)for(var r=n.getPoint(t),i=w0(n,r),s=r._p2t_edge_list,o=0;s&&o<s.length;++o)E0(n,s[o],i)}function _0(n){for(var t=n.front().head().next.triangle,e=n.front().head().next.point;!t.getConstrainedEdgeCW(e);)t=t.neighborCCW(e);n.meshClean(t)}function w0(n,t){var e=n.locateNode(t),r=x0(n,t,e);return t.x<=e.point.x+m0&&Ms(n,e),I0(n,r),r}function E0(n,t,e){n.edge_event.constrained_edge=t,n.edge_event.right=t.p.x>t.q.x,!up(e.triangle,t.p,t.q)&&(N0(n,t,e),Xl(n,t.p,t.q,e.triangle,t.q))}function Xl(n,t,e,r,i){if(!up(r,t,e)){var s=r.pointCCW(i),o=_e(e,s,t);if(o===te.COLLINEAR)throw new Xa("poly2tri EdgeEvent: Collinear not supported!",[e,s,t]);var a=r.pointCW(i),u=_e(e,a,t);if(u===te.COLLINEAR)throw new Xa("poly2tri EdgeEvent: Collinear not supported!",[e,a,t]);o===u?(o===te.CW?r=r.neighborCCW(i):r=r.neighborCW(i),Xl(n,t,e,r,i)):Hl(n,t,e,r,i)}}function up(n,t,e){var r=n.edgeIndex(t,e);if(r!==-1){n.markConstrainedEdgeByIndex(r);var i=n.getNeighbor(r);return i&&i.markConstrainedEdgeByPoints(t,e),!0}return!1}function x0(n,t,e){var r=new op(t,e.point,e.next.point);r.markNeighbor(e.triangle),n.addToMap(r);var i=new d0(t);return i.next=e.next,i.prev=e,e.next.prev=i,e.next=i,mi(n,r)||n.mapTriangleToNodes(r),i}function Ms(n,t){var e=new op(t.prev.point,t.point,t.next.point);e.markNeighbor(t.prev.triangle),e.markNeighbor(t.triangle),n.addToMap(e),t.prev.next=t.next,t.next.prev=t.prev,mi(n,e)||n.mapTriangleToNodes(e)}function I0(n,t){for(var e=t.next;e.next&&!Kc(e.point,e.next.point,e.prev.point);)Ms(n,e),e=e.next;for(e=t.prev;e.prev&&!Kc(e.point,e.next.point,e.prev.point);)Ms(n,e),e=e.prev;t.next&&t.next.next&&C0(t)&&b0(n,t)}function C0(n){var t=n.point.x-n.next.next.point.x,e=n.point.y-n.next.next.point.y;return Wl(e>=0,"unordered y"),t>=0||Math.abs(t)<e}function mi(n,t){for(var e=0;e<3;++e)if(!t.delaunay_edge[e]){var r=t.getNeighbor(e);if(r){var i=t.getPoint(e),s=r.oppositePoint(t,i),o=r.index(s);if(r.constrained_edge[o]||r.delaunay_edge[o]){t.constrained_edge[e]=r.constrained_edge[o];continue}var a=S0(i,t.pointCCW(i),t.pointCW(i),s);if(a){t.delaunay_edge[e]=!0,r.delaunay_edge[o]=!0,lp(t,i,r,s);var u=!mi(n,t);return u&&n.mapTriangleToNodes(t),u=!mi(n,r),u&&n.mapTriangleToNodes(r),t.delaunay_edge[e]=!1,r.delaunay_edge[o]=!1,!0}}}return!1}function S0(n,t,e,r){var i=n.x-r.x,s=n.y-r.y,o=t.x-r.x,a=t.y-r.y,u=i*a,l=o*s,c=u-l;if(c<=0)return!1;var h=e.x-r.x,f=e.y-r.y,p=h*s,d=i*f,_=p-d;if(_<=0)return!1;var w=o*f,y=h*a,x=i*i+s*s,g=o*o+a*a,m=h*h+f*f,E=x*(w-y)+g*_+m*c;return E>0}function lp(n,t,e,r){var i,s,o,a;i=n.neighborCCW(t),s=n.neighborCW(t),o=e.neighborCCW(r),a=e.neighborCW(r);var u,l,c,h;u=n.getConstrainedEdgeCCW(t),l=n.getConstrainedEdgeCW(t),c=e.getConstrainedEdgeCCW(r),h=e.getConstrainedEdgeCW(r);var f,p,d,_;f=n.getDelaunayEdgeCCW(t),p=n.getDelaunayEdgeCW(t),d=e.getDelaunayEdgeCCW(r),_=e.getDelaunayEdgeCW(r),n.legalize(t,r),e.legalize(r,t),e.setDelaunayEdgeCCW(t,f),n.setDelaunayEdgeCW(t,p),n.setDelaunayEdgeCCW(r,d),e.setDelaunayEdgeCW(r,_),e.setConstrainedEdgeCCW(t,u),n.setConstrainedEdgeCW(t,l),n.setConstrainedEdgeCCW(r,c),e.setConstrainedEdgeCW(r,h),n.clearNeighbors(),e.clearNeighbors(),i&&e.markNeighbor(i),s&&n.markNeighbor(s),o&&n.markNeighbor(o),a&&e.markNeighbor(a),n.markNeighbor(e)}function b0(n,t){for(_e(t.point,t.next.point,t.next.next.point)===te.CCW?n.basin.left_node=t.next.next:n.basin.left_node=t.next,n.basin.bottom_node=n.basin.left_node;n.basin.bottom_node.next&&n.basin.bottom_node.point.y>=n.basin.bottom_node.next.point.y;)n.basin.bottom_node=n.basin.bottom_node.next;if(n.basin.bottom_node!==n.basin.left_node){for(n.basin.right_node=n.basin.bottom_node;n.basin.right_node.next&&n.basin.right_node.point.y<n.basin.right_node.next.point.y;)n.basin.right_node=n.basin.right_node.next;n.basin.right_node!==n.basin.bottom_node&&(n.basin.width=n.basin.right_node.point.x-n.basin.left_node.point.x,n.basin.left_highest=n.basin.left_node.point.y>n.basin.right_node.point.y,cp(n,n.basin.bottom_node))}}function cp(n,t){if(!M0(n,t)){Ms(n,t);var e;if(!(t.prev===n.basin.left_node&&t.next===n.basin.right_node)){if(t.prev===n.basin.left_node){if(e=_e(t.point,t.next.point,t.next.next.point),e===te.CW)return;t=t.next}else if(t.next===n.basin.right_node){if(e=_e(t.point,t.prev.point,t.prev.prev.point),e===te.CCW)return;t=t.prev}else t.prev.point.y<t.next.point.y?t=t.prev:t=t.next;cp(n,t)}}}function M0(n,t){var e;return n.basin.left_highest?e=n.basin.left_node.point.y-t.point.y:e=n.basin.right_node.point.y-t.point.y,n.basin.width>e}function N0(n,t,e){n.edge_event.right?T0(n,t,e):P0(n,t,e)}function T0(n,t,e){for(;e.next.point.x<t.p.x;)_e(t.q,e.next.point,t.p)===te.CCW?hp(n,t,e):e=e.next}function hp(n,t,e){e.point.x<t.p.x&&(_e(e.point,e.next.point,e.next.next.point)===te.CCW?Yl(n,t,e):(fp(n,t,e),hp(n,t,e)))}function Yl(n,t,e){Ms(n,e.next),e.next.point!==t.p&&_e(t.q,e.next.point,t.p)===te.CCW&&_e(e.point,e.next.point,e.next.next.point)===te.CCW&&Yl(n,t,e)}function fp(n,t,e){_e(e.next.point,e.next.next.point,e.next.next.next.point)===te.CCW?Yl(n,t,e.next):_e(t.q,e.next.next.point,t.p)===te.CCW&&fp(n,t,e.next)}function P0(n,t,e){for(;e.prev.point.x>t.p.x;)_e(t.q,e.prev.point,t.p)===te.CW?pp(n,t,e):e=e.prev}function pp(n,t,e){e.point.x>t.p.x&&(_e(e.point,e.prev.point,e.prev.prev.point)===te.CW?Zl(n,t,e):(gp(n,t,e),pp(n,t,e)))}function gp(n,t,e){_e(e.prev.point,e.prev.prev.point,e.prev.prev.prev.point)===te.CW?Zl(n,t,e.prev):_e(t.q,e.prev.prev.point,t.p)===te.CW&&gp(n,t,e.prev)}function Zl(n,t,e){Ms(n,e.prev),e.prev.point!==t.p&&_e(t.q,e.prev.point,t.p)===te.CW&&_e(e.point,e.prev.point,e.prev.prev.point)===te.CW&&Zl(n,t,e)}function Hl(n,t,e,r,i){var s=r.neighborAcross(i);Wl(s,"FLIP failed due to missing triangle!");var o=s.oppositePoint(r,i);if(r.getConstrainedEdgeAcross(i)){var a=r.index(i);throw new Xa("poly2tri Intersecting Constraints",[i,o,r.getPoint((a+1)%3),r.getPoint((a+2)%3)])}if(ap(i,r.pointCCW(i),r.pointCW(i),o))if(lp(r,i,s,o),n.mapTriangleToNodes(r),n.mapTriangleToNodes(s),i===e&&o===t)e===n.edge_event.constrained_edge.q&&t===n.edge_event.constrained_edge.p&&(r.markConstrainedEdgeByPoints(t,e),s.markConstrainedEdgeByPoints(t,e),mi(n,r),mi(n,s));else{var u=_e(e,o,t);r=R0(n,u,r,s,i,o),Hl(n,t,e,r,i)}else{var l=dp(t,e,s,o);mp(n,t,e,r,s,l),Xl(n,t,e,r,i)}}function R0(n,t,e,r,i,s){var o;return t===te.CCW?(o=r.edgeIndex(i,s),r.delaunay_edge[o]=!0,mi(n,r),r.clearDelaunayEdges(),e):(o=e.edgeIndex(i,s),e.delaunay_edge[o]=!0,mi(n,e),e.clearDelaunayEdges(),r)}function dp(n,t,e,r){var i=_e(t,r,n);if(i===te.CW)return e.pointCCW(r);if(i===te.CCW)return e.pointCW(r);throw new Xa("poly2tri [Unsupported] nextFlipPoint: opposing point on constrained edge!",[t,r,n])}function mp(n,t,e,r,i,s){var o=i.neighborAcross(s);Wl(o,"FLIP failed due to missing triangle");var a=o.oppositePoint(i,s);if(ap(e,r.pointCCW(e),r.pointCW(e),a))Hl(n,e,a,o,a);else{var u=dp(t,e,o,a);mp(n,t,e,r,o,u)}}Vl.triangulate=v0;var L0=Ul,Gs=ip,A0=jl,O0=Vl,vp=sp,Bu=vp.Node,Jc=.3,D0=function(n,t){if(this.p=n,this.q=t,n.y>t.y)this.q=n,this.p=t;else if(n.y===t.y){if(n.x>t.x)this.q=n,this.p=t;else if(n.x===t.x)throw new L0("poly2tri Invalid Edge constructor: repeated points!",[n])}this.q._p2t_edge_list||(this.q._p2t_edge_list=[]),this.q._p2t_edge_list.push(this)},yp=function(){this.left_node=null,this.bottom_node=null,this.right_node=null,this.width=0,this.left_highest=!1};yp.prototype.clear=function(){this.left_node=null,this.bottom_node=null,this.right_node=null,this.width=0,this.left_highest=!1};var F0=function(){this.constrained_edge=null,this.right=!1},St=function(n,t){t=t||{},this.triangles_=[],this.map_=[],this.points_=t.cloneArrays?n.slice(0):n,this.edge_list=[],this.pmin_=this.pmax_=null,this.front_=null,this.head_=null,this.tail_=null,this.af_head_=null,this.af_middle_=null,this.af_tail_=null,this.basin=new yp,this.edge_event=new F0,this.initEdges(this.points_)};St.prototype.addHole=function(n){this.initEdges(n);var t,e=n.length;for(t=0;t<e;t++)this.points_.push(n[t]);return this};St.prototype.AddHole=St.prototype.addHole;St.prototype.addHoles=function(n){var t,e=n.length;for(t=0;t<e;t++)this.initEdges(n[t]);return this.points_=this.points_.concat.apply(this.points_,n),this};St.prototype.addPoint=function(n){return this.points_.push(n),this};St.prototype.AddPoint=St.prototype.addPoint;St.prototype.addPoints=function(n){return this.points_=this.points_.concat(n),this};St.prototype.triangulate=function(){return O0.triangulate(this),this};St.prototype.getBoundingBox=function(){return{min:this.pmin_,max:this.pmax_}};St.prototype.getTriangles=function(){return this.triangles_};St.prototype.GetTriangles=St.prototype.getTriangles;St.prototype.front=function(){return this.front_};St.prototype.pointCount=function(){return this.points_.length};St.prototype.head=function(){return this.head_};St.prototype.setHead=function(n){this.head_=n};St.prototype.tail=function(){return this.tail_};St.prototype.setTail=function(n){this.tail_=n};St.prototype.getMap=function(){return this.map_};St.prototype.initTriangulation=function(){var n=this.points_[0].x,t=this.points_[0].x,e=this.points_[0].y,r=this.points_[0].y,i,s=this.points_.length;for(i=1;i<s;i++){var o=this.points_[i];o.x>n&&(n=o.x),o.x<t&&(t=o.x),o.y>e&&(e=o.y),o.y<r&&(r=o.y)}this.pmin_=new Gs(t,r),this.pmax_=new Gs(n,e);var a=Jc*(n-t),u=Jc*(e-r);this.head_=new Gs(n+a,r-u),this.tail_=new Gs(t-a,r-u),this.points_.sort(Gs.compare)};St.prototype.initEdges=function(n){var t,e=n.length;for(t=0;t<e;++t)this.edge_list.push(new D0(n[t],n[(t+1)%e]))};St.prototype.getPoint=function(n){return this.points_[n]};St.prototype.addToMap=function(n){this.map_.push(n)};St.prototype.locateNode=function(n){return this.front_.locateNode(n.x)};St.prototype.createAdvancingFront=function(){var n,t,e,r=new A0(this.points_[0],this.tail_,this.head_);this.map_.push(r),n=new Bu(r.getPoint(1),r),t=new Bu(r.getPoint(0),r),e=new Bu(r.getPoint(2)),this.front_=new vp(n,e),n.next=t,t.next=e,t.prev=n,e.prev=t};St.prototype.removeNode=function(n){};St.prototype.mapTriangleToNodes=function(n){for(var t=0;t<3;++t)if(!n.getNeighbor(t)){var e=this.front_.locatePoint(n.pointCW(n.getPoint(t)));e&&(e.triangle=n)}};St.prototype.removeFromMap=function(n){var t,e=this.map_,r=e.length;for(t=0;t<r;t++)if(e[t]===n){e.splice(t,1);break}};St.prototype.meshClean=function(n){for(var t=[n],e,r;e=t.pop();)if(!e.isInterior())for(e.setInterior(!0),this.triangles_.push(e),r=0;r<3;r++)e.constrained_edge[r]||t.push(e.getNeighbor(r))};var k0=St;(function(n){var t=globalThis.poly2tri;n.noConflict=function(){return globalThis.poly2tri=t,n},n.VERSION=n0.version,n.PointError=Ul,n.Point=ip,n.Triangle=jl,n.SweepContext=k0;var e=Vl;n.triangulate=e.triangulate,n.sweep={Triangulate:e.triangulate}})(rp);function G0(n,t){let e=0;const r=new rp.SweepContext(ky(n,t).map(i=>({x:i[0],y:i[1],type:"p",item:e++})));r.addPoints(Gy(n,t).filter(i=>e0(n,i)===-1).map(i=>({x:i[0],y:i[1],type:"g",item:e++})));try{r.triangulate()}catch{throw new Error("A Point Error occured during resource mask triangulation. This is typically because the resource mask contains duplicate or collinear points, or is self-intersecting.")}return r.getTriangles()}function B0(n,t){const e=G0(n,t).map(i=>i.getPoints().map(s=>s)),r=[...new Map(e.flat().map(i=>[i.item,i])).values()].sort((i,s)=>i.item-s.item).map(i=>[i.x,i.y]);return{uniquePointsIndexTriangles:e.map(i=>i.map(s=>s.item)),uniquePoints:r}}const z0=80,U0=10;function j0(){return{}}class V0 extends Ly{constructor(e,r,i){i={...j0(),...i};super(e,r,i);M(this,"resourceTrianglePoints",[]);M(this,"resourceUniquePoints",[]);M(this,"trianglePointsUniquePointsIndex",[]);M(this,"triangulationByBestScaleFactor",new Map);M(this,"triangulateErrorCount",0);M(this,"projectedGeoPreviousTrianglePoints",[]);M(this,"projectedGeoTrianglePoints",[]);M(this,"projectedGeoUniquePoints",[]);M(this,"projectedGeoUniquePointsByBestScaleFactorAndTransformationType",new Map);M(this,"projectedGeoUniquePointsPartialDerivativeX",[]);M(this,"projectedGeoUniquePointsPartialDerivativeY",[]);M(this,"projectedGeoUniquePointsPartialDerivativeXByBestScaleFactorAndTransformationType",new Map);M(this,"projectedGeoUniquePointsPartialDerivativeYByBestScaleFactorAndTransformationType",new Map);M(this,"previousTrianglePointsDistortion",[]);M(this,"trianglePointsDistortion",[]);M(this,"uniquePointsDistortion",[])}setResourceMask(e){super.setResourceMask(e),this.triangulationByBestScaleFactor=new Map,this.projectedGeoUniquePointsByBestScaleFactorAndTransformationType=new Map,this.projectedGeoUniquePointsPartialDerivativeXByBestScaleFactorAndTransformationType=new Map,this.projectedGeoUniquePointsPartialDerivativeYByBestScaleFactorAndTransformationType=new Map,this.updateTriangulation()}setBestScaleFactor(e){const r=super.setBestScaleFactor(e);return r&&this.updateTriangulation(!0),r}updateTriangulation(e=!1){const{trianglePointsUniquePointsIndex:r,resourceUniquePoints:i}=da(this.triangulationByBestScaleFactor,this.bestScaleFactor,()=>{var o;const s=_d(this.resourceMask)*this.bestScaleFactor/z0;try{const{uniquePointsIndexTriangles:a,uniquePoints:u}=B0(this.resourceMask,s);return{trianglePointsUniquePointsIndex:a.flat(),resourceUniquePoints:u}}catch(a){return this.triangulateErrorCount++,this.triangulateErrorCount<=U0&&(console.error(`Error computing triangulation for map ${this.mapId}.`,`Fix this map with Allmaps Editor: https://editor.allmaps.org/#/collection?url=${(o=this.parsedImage)==null?void 0:o.uri}/info.json`),this.triangulateErrorCount===1&&console.error(a)),{trianglePointsUniquePointsIndex:this.trianglePointsUniquePointsIndex,resourceUniquePoints:this.resourceUniquePoints}}});this.resourceTrianglePoints=r.map(s=>i[s]),this.resourceUniquePoints=i,this.trianglePointsUniquePointsIndex=r,this.updateProjectedGeoTrianglePoints(e)}updateProjectedGeoTrianglePoints(e=!1){this.projectedGeoUniquePoints=Lu(this.projectedGeoUniquePointsByBestScaleFactorAndTransformationType,this.bestScaleFactor,this.transformationType,()=>this.resourceUniquePoints.map(r=>this.projectedTransformer.transformToGeo(r))),this.projectedGeoTrianglePoints=this.trianglePointsUniquePointsIndex.map(r=>this.projectedGeoUniquePoints[r]),(e||!this.projectedGeoPreviousTrianglePoints.length)&&(this.projectedGeoPreviousTrianglePoints=this.projectedGeoTrianglePoints),this.updateTrianglePointsDistortion(e)}updateTrianglePointsDistortion(e=!1){this.distortionMeasure&&(this.projectedGeoUniquePointsPartialDerivativeX=Lu(this.projectedGeoUniquePointsPartialDerivativeXByBestScaleFactorAndTransformationType,this.bestScaleFactor,this.transformationType,()=>this.resourceUniquePoints.map(r=>this.projectedTransformer.transformToGeo(r,{evaluationType:"partialDerivativeX"}))),this.projectedGeoUniquePointsPartialDerivativeY=Lu(this.projectedGeoUniquePointsPartialDerivativeYByBestScaleFactorAndTransformationType,this.bestScaleFactor,this.transformationType,()=>this.resourceUniquePoints.map(r=>this.projectedTransformer.transformToGeo(r,{evaluationType:"partialDerivativeY"})))),this.uniquePointsDistortion=this.projectedGeoUniquePoints.map((r,i)=>Py(this.projectedGeoUniquePointsPartialDerivativeX[i],this.projectedGeoUniquePointsPartialDerivativeY[i],this.distortionMeasure,this.getReferenceScale())),this.trianglePointsDistortion=this.trianglePointsUniquePointsIndex.map(r=>this.uniquePointsDistortion[r]),(e||!this.previousTrianglePointsDistortion.length)&&(this.previousTrianglePointsDistortion=this.trianglePointsDistortion)}resetTrianglePoints(){this.projectedGeoPreviousTrianglePoints=this.projectedGeoTrianglePoints,this.previousTrianglePointsDistortion=this.trianglePointsDistortion}mixTrianglePoints(e){this.projectedGeoPreviousTrianglePoints=this.projectedGeoTrianglePoints.map((r,i)=>od(r,this.projectedGeoPreviousTrianglePoints[i],e)),this.previousTrianglePointsDistortion=this.trianglePointsDistortion.map((r,i)=>sd(r,this.previousTrianglePointsDistortion[i],e))}}function q0(n){let t=0,e=0;for(const o of n)t+=o.w*o.h,e=Math.max(e,o.w);n.sort((o,a)=>a.h-o.h);const r=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(t/.95)),e),h:1/0}];let i=0,s=0;for(const o of n)for(let a=r.length-1;a>=0;a--){const u=r[a];if(!(o.w>u.w||o.h>u.h)){if(o.x=u.x,o.y=u.y,s=Math.max(s,o.y+o.h),i=Math.max(i,o.x+o.w),o.w===u.w&&o.h===u.h){const l=r.pop();a<r.length&&(r[a]=l)}else o.h===u.h?(u.x+=o.w,u.w-=o.w):o.w===u.w?(u.y+=o.h,u.h-=o.h):(r.push({x:u.x+o.w,y:u.y,w:u.w-o.w,h:o.h}),u.y+=o.h,u.h-=o.h);break}}return{w:i,h:s,fill:t/(i*s)||0}}var W0=typeof globalThis=="object"&&globalThis&&globalThis.Object===Object&&globalThis,X0=typeof self=="object"&&self&&self.Object===Object&&self,_p=W0||X0||Function("return this")(),Ya=_p.Symbol,wp=Object.prototype,Y0=wp.hasOwnProperty,Z0=wp.toString,Bs=Ya?Ya.toStringTag:void 0;function H0(n){var t=Y0.call(n,Bs),e=n[Bs];try{n[Bs]=void 0;var r=!0}catch{}var i=Z0.call(n);return r&&(t?n[Bs]=e:delete n[Bs]),i}var K0=Object.prototype,J0=K0.toString;function Q0(n){return J0.call(n)}var $0="[object Null]",t_="[object Undefined]",Qc=Ya?Ya.toStringTag:void 0;function e_(n){return n==null?n===void 0?t_:$0:Qc&&Qc in Object(n)?H0(n):Q0(n)}function r_(n){return n!=null&&typeof n=="object"}var n_="[object Symbol]";function i_(n){return typeof n=="symbol"||r_(n)&&e_(n)==n_}var s_=/\s/;function o_(n){for(var t=n.length;t--&&s_.test(n.charAt(t)););return t}var a_=/^\s+/;function u_(n){return n&&n.slice(0,o_(n)+1).replace(a_,"")}function Za(n){var t=typeof n;return n!=null&&(t=="object"||t=="function")}var $c=NaN,l_=/^[-+]0x[0-9a-f]+$/i,c_=/^0b[01]+$/i,h_=/^0o[0-7]+$/i,f_=parseInt;function th(n){if(typeof n=="number")return n;if(i_(n))return $c;if(Za(n)){var t=typeof n.valueOf=="function"?n.valueOf():n;n=Za(t)?t+"":t}if(typeof n!="string")return n===0?n:+n;n=u_(n);var e=c_.test(n);return e||h_.test(n)?f_(n.slice(2),e?2:8):l_.test(n)?$c:+n}var zu=function(){return _p.Date.now()},p_="Expected a function",g_=Math.max,d_=Math.min;function m_(n,t,e){var r,i,s,o,a,u,l=0,c=!1,h=!1,f=!0;if(typeof n!="function")throw new TypeError(p_);t=th(t)||0,Za(e)&&(c=!!e.leading,h="maxWait"in e,s=h?g_(th(e.maxWait)||0,t):s,f="trailing"in e?!!e.trailing:f);function p(N){var b=r,S=i;return r=i=void 0,l=N,o=n.apply(S,b),o}function d(N){return l=N,a=setTimeout(y,t),c?p(N):o}function _(N){var b=N-u,S=N-l,v=t-b;return h?d_(v,s-S):v}function w(N){var b=N-u,S=N-l;return u===void 0||b>=t||b<0||h&&S>=s}function y(){var N=zu();if(w(N))return x(N);a=setTimeout(y,_(N))}function x(N){return a=void 0,f&&r?p(N):(r=i=void 0,o)}function g(){a!==void 0&&clearTimeout(a),l=0,r=u=i=a=void 0}function m(){return a===void 0?o:x(zu())}function E(){var N=zu(),b=w(N);if(r=arguments,i=this,u=N,b){if(a===void 0)return d(u);if(h)return clearTimeout(a),a=setTimeout(y,t),p(u)}return a===void 0&&(a=setTimeout(y,t)),o}return E.cancel=g,E.flush=m,E}var v_="Expected a function";function fl(n,t,e){var r=!0,i=!0;if(typeof n!="function")throw new TypeError(v_);return Za(e)&&(r="leading"in e?!!e.leading:r,i="trailing"in e?!!e.trailing:i),m_(n,t,{leading:r,maxWait:t,trailing:i})}const y_=.5;function Ep(n,t){return`${n}:${t}`}function xp(n){return Ep(n.mapId,n.tileUrl)}function Uu(n){return new Set(n.map(t=>xp(t)))}function __(n,t,e=y_){let r=Number.POSITIVE_INFINITY,i=n.tileZoomLevels.at(-1);for(const s of n.tileZoomLevels){const o=Math.abs(Math.log(s.scaleFactor)-Math.log(t+e));o<r&&(r=o,i=s)}return i}function w_(n,t,e){const r=E_(n,t),i=x_(r),s=C_(i,e,t),o=xs(De(n));return s.sort((a,u)=>eh(a,o)-eh(u,o)),s}function E_(n,t){return n.map(e=>[e[0]/t.originalWidth,e[1]/t.originalHeight])}function x_(n){const t={};for(let e=0;e<n.length;e++){const r=[n[e],n[(e+1)%n.length]];I_(r).forEach(([i,s])=>{t[i]||(t[i]=[Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY]),s<t[i][0]&&(t[i][0]=s),s>t[i][1]&&(t[i][1]=s)})}return t}function I_([n,t]){let e=Math.floor(n[0]),r=Math.floor(n[1]);const i=Math.floor(t[0]),s=Math.floor(t[1]),o=[[e,r]];if(e===i&&r===s)return o;const a=Math.sign(t[0]-n[0]),u=Math.sign(t[1]-n[1]),l=Math.abs(n[0]-e-Math.max(0,a)),c=Math.abs(n[1]-r-Math.max(0,u)),h=Math.abs(n[0]-t[0]),f=Math.abs(n[1]-t[1]);let p=l/h,d=c/f;const _=1/h,w=1/f;for(;!(e===i&&r===s);)p<d?(p=p+_,e=e+a):(d=d+w,r=r+u),o.push([e,r]);return o}function C_(n,t,e){const r=[];for(const i in n){const s=parseInt(i);if(s<0||s>=e.columns)break;const o=Math.max(n[s][0],0),a=Math.min(n[s][1],e.rows-1);for(let u=o;u<=a;u++)r.push({column:s,row:u,tileZoomLevel:e,imageSize:[t.width,t.height]})}return r}function S_(n){var t,e;return(((t=n.imageRequest.size)==null?void 0:t.height)||0)*(((e=n.imageRequest.size)==null?void 0:e.width)||0)*3}function eh(n,t){return ar(b_(n),t)}function b_(n){const t=Ip(n);return[(t[2]-t[0])/2+t[0],(t[3]-t[1])/2+t[1]]}function M_(n){const t=n.column*n.tileZoomLevel.originalWidth,e=n.row*n.tileZoomLevel.originalHeight;return[t,e]}function Ip(n){const t=M_(n),e=Math.min(t[0]+n.tileZoomLevel.originalWidth,n.imageSize[0]),r=Math.min(t[1]+n.tileZoomLevel.originalHeight,n.imageSize[1]);return[t[0],t[1],e,r]}function rh(n,t,e){const r=n.createShader(t);if(r){if(n.shaderSource(r,e),n.compileShader(r),n.getShaderParameter(r,n.COMPILE_STATUS))return r;{const i=n.getShaderInfoLog(r);throw n.deleteShader(r),new Error("Failed to compile shader: "+i)}}else throw new Error("Failed to create shader")}function N_(n,t,e){const r=n.createProgram();if(r){if(n.attachShader(r,t),n.attachShader(r,e),n.linkProgram(r),n.getProgramParameter(r,n.LINK_STATUS))return r;{const i=n.getProgramInfoLog(r);throw n.deleteProgram(r),new Error("Failed to link program: "+i)}}else throw new Error("Failed to create program")}function Wi(n,t,e,r,i){const s=n.createBuffer();n.bindBuffer(n.ARRAY_BUFFER,s),n.bufferData(n.ARRAY_BUFFER,e,n.STATIC_DRAW);const o=n.FLOAT,a=!1,u=0,l=0,c=n.getAttribLocation(t,i);n.vertexAttribPointer(c,r,o,a,u,l),n.enableVertexAttribArray(c)}const T_=100,P_={leading:!0,trailing:!0},R_=1,L_=1;function A_(n,t){return(e,r,i)=>new O_(e,r,n,t,i)}let O_=class extends V0{constructor(t,e,r,i,s){super(t,e,s);M(this,"gl");M(this,"program");M(this,"vao");M(this,"CachedTilesByTileUrl",new Map);M(this,"opacity",R_);M(this,"saturation",L_);M(this,"renderOptions",{});M(this,"packedTilesTexture");M(this,"packedTilesPositionsTexture");M(this,"packedTilesResourcePositionsAndDimensionsTexture");M(this,"packedTilesScaleFactorsTexture");M(this,"projectedGeoToClipTransform");M(this,"throttledUpdateTextures");this.gl=r,this.program=i,this.vao=r.createVertexArray(),this.packedTilesTexture=r.createTexture(),this.packedTilesScaleFactorsTexture=r.createTexture(),this.packedTilesPositionsTexture=r.createTexture(),this.packedTilesResourcePositionsAndDimensionsTexture=r.createTexture(),this.throttledUpdateTextures=fl(this.updateTextures.bind(this),T_,P_)}updateVertexBuffers(t){this.projectedGeoToClipTransform=t,this.updateVertexBuffersInternal()}addCachedTileAndUpdateTextures(t){this.CachedTilesByTileUrl.set(t.tileUrl,t),this.throttledUpdateTextures()}removeCachedTileAndUpdateTextures(t){this.CachedTilesByTileUrl.delete(t),this.throttledUpdateTextures()}dispose(){this.gl.deleteVertexArray(this.vao),this.gl.deleteTexture(this.packedTilesTexture),this.gl.deleteTexture(this.packedTilesScaleFactorsTexture),this.gl.deleteTexture(this.packedTilesPositionsTexture),this.gl.deleteTexture(this.packedTilesResourcePositionsAndDimensionsTexture)}updateVertexBuffersInternal(){if(!this.vao||!this.projectedGeoToClipTransform)return;this.gl.bindVertexArray(this.vao);const t=this.resourceTrianglePoints;Wi(this.gl,this.program,new Float32Array(t.flat()),2,"a_resourceTrianglePoint");const e=this.projectedGeoPreviousTrianglePoints.map(a=>$i(this.projectedGeoToClipTransform,a));Wi(this.gl,this.program,new Float32Array(e.flat()),2,"a_clipPreviousTrianglePoint");const r=this.projectedGeoTrianglePoints.map(a=>$i(this.projectedGeoToClipTransform,a));Wi(this.gl,this.program,new Float32Array(r.flat()),2,"a_clipTrianglePoint");const i=this.previousTrianglePointsDistortion;Wi(this.gl,this.program,new Float32Array(i),1,"a_previousTrianglePointDistortion");const s=this.trianglePointsDistortion;Wi(this.gl,this.program,new Float32Array(s),1,"a_trianglePointDistortion");const o=new Float32Array(this.resourceTrianglePoints.length).map((a,u)=>Math.round((u-1)/3));Wi(this.gl,this.program,o,1,"a_triangleIndex")}async updateTextures(){const t=this.gl;if(this.CachedTilesByTileUrl.size===0)return;let e=[...this.CachedTilesByTileUrl.values()];e=e.filter(c=>this.resourceViewportRingBbox?vd(Ip(c.tile),this.resourceViewportRingBbox):!0);const r=e.length,i=e.map((c,h)=>({w:c.data.width,h:c.data.height,x:0,y:0,index:h})),{w:s,h:o}=q0(i);t.pixelStorei(t.UNPACK_ALIGNMENT,4),t.bindTexture(t.TEXTURE_2D,this.packedTilesTexture),t.texImage2D(t.TEXTURE_2D,0,t.RGBA,s,o,0,t.RGBA,t.UNSIGNED_BYTE,null);for(const c of i){const h=e[c.index].data;t.texSubImage2D(t.TEXTURE_2D,0,c.x,c.y,h.width,h.height,t.RGBA,t.UNSIGNED_BYTE,h)}t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.LINEAR),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,t.LINEAR),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE);const a=i.map(c=>[c.x,c.y]);t.bindTexture(t.TEXTURE_2D,this.packedTilesPositionsTexture),t.texImage2D(t.TEXTURE_2D,0,t.RG32I,1,r,0,t.RG_INTEGER,t.INT,new Int32Array(a.flat())),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.NEAREST),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,t.NEAREST),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE);const u=i.map(c=>{const h=e[c.index];if(h&&h.imageRequest&&h.imageRequest.region)return[h.imageRequest.region.x,h.imageRequest.region.y,h.imageRequest.region.width,h.imageRequest.region.height]});t.bindTexture(t.TEXTURE_2D,this.packedTilesResourcePositionsAndDimensionsTexture),t.texImage2D(t.TEXTURE_2D,0,t.RGBA32I,1,r,0,t.RGBA_INTEGER,t.INT,new Int32Array(u.flat())),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.NEAREST),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,t.NEAREST),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE);const l=i.map(({index:c})=>e[c].tile.tileZoomLevel.scaleFactor);t.bindTexture(t.TEXTURE_2D,this.packedTilesScaleFactorsTexture),t.texImage2D(t.TEXTURE_2D,0,t.R32I,1,r,0,t.RED_INTEGER,t.INT,new Int32Array(l)),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.NEAREST),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,t.NEAREST),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE),this.dispatchEvent(new ct(B.TEXTURESUPDATED))}};const D_=C.string().or(C.number()).or(C.boolean()),F_=C.record(C.string(),D_.array()),vi=C.tuple([C.number(),C.number()]),Cp=C.object({type:C.literal("Point"),coordinates:vi}),Sp=vi.array().min(3),zo=C.enum(["ImageService1","ImageService2","ImageService3"]),k_=C.object({id:C.string().url(),type:C.string(),label:F_.optional()}),yu=k_.extend({partOf:C.lazy(()=>yu.array()).optional()}),_u=C.union([C.any(),C.object({type:C.string(),options:C.object({}).optional()})]).transform(n=>{if(n&&typeof n=="object"&&"type"in n)return n}),wu=C.union([C.string().url().array(),C.string().url()]),G_=/^<svg\s+width="\d+"\s+height="\d+"\s*>\s*<polygon\s+points="\s*(-?\d+(\.\d+)?,-?\d+(\.\d+)?\s+){2,}-?\d+(\.\d+)?,-?\d+(\.\d+)?\s*"\s*\/>\s*<\/svg>$/,B_=C.object({type:C.literal("SvgSelector"),value:C.string().regex(G_)}),z_=C.object({source:C.string().url(),service:C.array(C.object({"@id":C.string().url(),type:zo})).length(1),selector:B_}),bp=C.object({pixelCoords:vi}),U_=C.object({type:C.literal("FeatureCollection"),transformation:_u.optional(),features:C.array(C.object({type:C.literal("Feature"),properties:bp,geometry:Cp}))}),Kl=C.object({id:C.string().optional(),type:C.literal("Annotation"),"@context":wu.optional(),motivation:C.string().default("georeferencing").optional(),target:z_,body:U_}),Mp=C.object({id:C.string().optional(),type:C.literal("AnnotationPage"),"@context":wu.optional(),items:C.array(Kl)}),Jl=/<polygon\s+points="\s*(-?\d+(\.\d+)?,-?\d+(\.\d+)?\s+){2,}-?\d+(\.\d+)?,-?\d+(\.\d+)?\s*"\s*\/>/,j_=new RegExp(`^<svg\\s+width="\\d+"\\s+height="\\d+"\\s*>\\s*${Jl.source}\\s*</svg>$`),V_=new RegExp(`^<svg\\s+height="\\d+"\\s+width="\\d+"\\s*>\\s*${Jl.source}\\s*</svg>$`),q_=new RegExp(`^<svg\\s*>\\s*${Jl.source}\\s*</svg>$`),W_=C.string().regex(q_),X_=C.string().regex(j_),Y_=C.string().regex(V_),Z_=C.object({type:C.literal("SvgSelector"),value:W_.or(X_).or(Y_)}),H_=C.object({"@id":C.string().url(),type:zo,height:C.number().positive(),width:C.number().positive(),partOf:yu.array().optional()}),K_=C.object({id:C.string().url(),type:zo,height:C.number().positive(),width:C.number().positive(),partOf:yu.array().optional()}),J_=C.object({type:C.literal("SpecificResource"),source:H_.or(K_),selector:Z_}),Np=C.object({resourceCoords:vi}),Q_=C.object({type:C.literal("FeatureCollection"),transformation:_u.optional(),features:C.array(C.object({type:C.literal("Feature"),properties:Np,geometry:Cp}))}),Ql=C.object({id:C.string().optional(),type:C.literal("Annotation"),"@context":wu.optional(),motivation:C.string().default("georeferencing").optional(),created:C.string().datetime().optional(),modified:C.string().datetime().optional(),target:J_,body:Q_}),Tp=C.object({id:C.string().optional(),type:C.literal("AnnotationPage"),"@context":wu.optional(),items:C.array(Ql)});Kl.or(Ql);Mp.or(Tp);bp.or(Np);function Pp(n){return Array.isArray(n)}function $_(n){return!!(n&&typeof n=="object"&&"type"in n&&n.type==="AnnotationPage")}function Ha(n){return!!(n&&typeof n=="object"&&"type"in n&&n.type==="GeoreferencedMap")}function nh(n){return!!(n&&typeof n=="object"&&"target"in n&&n.target&&typeof n.target=="object"&&"source"in n.target&&typeof n.target.source=="string")}function Eu(n){return"type"in n&&n.type==="GeoreferencedMap"}function xu(n){return"source"in n.target&&typeof n.target.source=="object"}function tw(n){return{id:ew(n),...aw(n),type:rw(n),partOf:nw(n)}}function ew(n){if(xu(n)){const t=n.target.source;return"id"in t?t.id:t["@id"]}else return n.target.service[0]["@id"]}function rw(n){return"service"in n.target?n.target.service[0].type:n.target.source.type}function nw(n){if(xu(n))return n.target.source.partOf}function iw(n){return"pixelCoords"in n?n.pixelCoords:n.resourceCoords}function sw(n){return n.body.features.map(t=>({resource:iw(t.properties),geo:t.geometry.coordinates}))}function ow(n){if(xu(n))return{created:n.created,modified:n.modified}}function aw(n){var o,a;if(xu(n))return{width:n.target.source.width,height:n.target.source.height};const t=n.target.selector.value,e=/width="(?<width>\d+)"/.exec(t),r=/height="(?<height>\d+)"/.exec(t),i=(o=e==null?void 0:e.groups)==null?void 0:o.width,s=(a=r==null?void 0:r.groups)==null?void 0:a.height;if(!i||!s)throw new Error("Could not parse image dimensions");return{width:parseInt(i),height:parseInt(s)}}function uw(n){var r;const t=n.target.selector.value,e=(r=/points="(?<points>.+)"/.exec(t))==null?void 0:r.groups;if(e&&e.points){const i=e.points.trim().split(/\s+/);if(i[0]===i[i.length-1]&&i.splice(-1),i.length>=3)return i.map(s=>{const o=s.split(",");if(o.length===2)return[parseFloat(o[0]),parseFloat(o[1])];throw new Error("Could not parse resource mask")});throw new Error("Could not parse resource mask")}else throw new Error("Could not parse resource mask")}function ih(n){return{"@context":"https://schemas.allmaps.org/map/2/context.json",type:"GeoreferencedMap",id:n.id,...ow(n),resource:tw(n),gcps:sw(n),resourceMask:uw(n),transformation:n.body.transformation}}function pl(n){if($_(n)){let t;return"items"in n&&Array.isArray(n.items)&&nh(n.items[0])?t=Mp.parse(n):t=Tp.parse(n),t.items.map(e=>ih(e))}else{let t;return nh(n)?t=Kl.parse(n):t=Ql.parse(n),[ih(t)]}}const Rp=C.object({image:vi,world:vi}),lw=C.object({uri:C.string().url(),width:C.number(),height:C.number(),type:zo}),Iu=C.object({id:C.string().optional(),version:C.number().min(1).max(1).default(1),image:lw,gcps:Rp.array(),pixelMask:Sp,transformation:_u.optional()}),$l=C.array(Iu),Lp=C.object({resource:vi,geo:vi}),cw=C.object({id:C.string().url(),width:C.number(),height:C.number(),type:zo,partOf:yu.array().optional()}),Cu=C.object({"@context":C.literal("https://schemas.allmaps.org/map/2/context.json").optional(),type:C.literal("GeoreferencedMap"),id:C.string().optional(),created:C.string().datetime().optional(),modified:C.string().datetime().optional(),resource:cw,gcps:Lp.array(),resourceMask:Sp,transformation:_u.optional()}),tc=C.array(Cu);Iu.or(Cu);$l.or(tc);Rp.or(Lp);function hw(n){let t,e,r;return Eu(n)?(t=n.resource.width,e=n.resource.height,r=n.resourceMask):(t=n.image.width,e=n.image.height,r=n.pixelMask),{type:"SvgSelector",value:`<svg width="${t}" height="${e}"><polygon points="${r.map(i=>i.join(",")).join(" ")}" /></svg>`}}function fw(n){let t,e,r,i,s;return Eu(n)?(t=n.resource.id,e=n.resource.type,r=n.resource.width,i=n.resource.height,s=n.resource.partOf):(t=n.image.uri,e=n.image.type,r=n.image.width,i=n.image.height),{id:t,type:e,height:i,width:r,partOf:s}}function pw(n){if(Eu(n))return{created:n.created,modified:n.modified}}function gw(){return["http://iiif.io/api/extension/georef/1/context.json","http://iiif.io/api/presentation/3/context.json"]}function dw(n){let t,e;return"resource"in n?(t=n.resource,e=n.geo):(t=n.image,e=n.world),{type:"Feature",properties:{resourceCoords:t},geometry:{type:"Point",coordinates:e}}}function sh(n){const t={type:"SpecificResource",source:fw(n),selector:hw(n)},e={type:"FeatureCollection",transformation:n.transformation,features:n.gcps.map(r=>dw(r))};return{id:n.id,type:"Annotation","@context":gw(),...pw(n),motivation:"georeferencing",target:t,body:e}}function mw(n){if(Pp(n)){let t;return Ha(n[0])?t=tc.parse(n):t=$l.parse(n),{type:"AnnotationPage","@context":"http://www.w3.org/ns/anno.jsonld",items:t.map(e=>sh(e))}}else{let t;return Ha(n)?t=Cu.parse(n):t=Iu.parse(n),sh(t)}}function Ap(n){return Eu(n)?n:pl(mw(n))[0]}function vw(n){return n.map(Ap)}function oh(n){if(Pp(n)){let t;return Ha(n[0])?t=tc.parse(n):t=$l.parse(n),vw(t)}else{let t;return Ha(n)?t=Cu.parse(n):t=Iu.parse(n),Ap(t)}}function yw(n,t,e,r,i){Op(n,t,e||0,r||n.length-1,i||_w)}function Op(n,t,e,r,i){for(;r>e;){if(r-e>600){var s=r-e+1,o=t-e+1,a=Math.log(s),u=.5*Math.exp(2*a/3),l=.5*Math.sqrt(a*u*(s-u)/s)*(o-s/2<0?-1:1),c=Math.max(e,Math.floor(t-o*u/s+l)),h=Math.min(r,Math.floor(t+(s-o)*u/s+l));Op(n,t,c,h,i)}var f=n[t],p=e,d=r;for(zs(n,e,t),i(n[r],f)>0&&zs(n,e,r);p<d;){for(zs(n,p,d),p++,d--;i(n[p],f)<0;)p++;for(;i(n[d],f)>0;)d--}i(n[e],f)===0?zs(n,e,d):(d++,zs(n,d,r)),d<=t&&(e=d+1),t<=d&&(r=d-1)}}function zs(n,t,e){var r=n[t];n[t]=n[e],n[e]=r}function _w(n,t){return n<t?-1:n>t?1:0}class ww{constructor(t=9){this._maxEntries=Math.max(4,t),this._minEntries=Math.max(2,Math.ceil(this._maxEntries*.4)),this.clear()}all(){return this._all(this.data,[])}search(t){let e=this.data;const r=[];if(!fa(t,e))return r;const i=this.toBBox,s=[];for(;e;){for(let o=0;o<e.children.length;o++){const a=e.children[o],u=e.leaf?i(a):a;fa(t,u)&&(e.leaf?r.push(a):Vu(t,u)?this._all(a,r):s.push(a))}e=s.pop()}return r}collides(t){let e=this.data;if(!fa(t,e))return!1;const r=[];for(;e;){for(let i=0;i<e.children.length;i++){const s=e.children[i],o=e.leaf?this.toBBox(s):s;if(fa(t,o)){if(e.leaf||Vu(t,o))return!0;r.push(s)}}e=r.pop()}return!1}load(t){if(!(t&&t.length))return this;if(t.length<this._minEntries){for(let r=0;r<t.length;r++)this.insert(t[r]);return this}let e=this._build(t.slice(),0,t.length-1,0);if(!this.data.children.length)this.data=e;else if(this.data.height===e.height)this._splitRoot(this.data,e);else{if(this.data.height<e.height){const r=this.data;this.data=e,e=r}this._insert(e,this.data.height-e.height-1,!0)}return this}insert(t){return t&&this._insert(t,this.data.height-1),this}clear(){return this.data=Ji([]),this}remove(t,e){if(!t)return this;let r=this.data;const i=this.toBBox(t),s=[],o=[];let a,u,l;for(;r||s.length;){if(r||(r=s.pop(),u=s[s.length-1],a=o.pop(),l=!0),r.leaf){const c=Ew(t,r.children,e);if(c!==-1)return r.children.splice(c,1),s.push(r),this._condense(s),this}!l&&!r.leaf&&Vu(r,i)?(s.push(r),o.push(a),a=0,u=r,r=r.children[0]):u?(a++,r=u.children[a],l=!1):r=null}return this}toBBox(t){return t}compareMinX(t,e){return t.minX-e.minX}compareMinY(t,e){return t.minY-e.minY}toJSON(){return this.data}fromJSON(t){return this.data=t,this}_all(t,e){const r=[];for(;t;)t.leaf?e.push(...t.children):r.push(...t.children),t=r.pop();return e}_build(t,e,r,i){const s=r-e+1;let o=this._maxEntries,a;if(s<=o)return a=Ji(t.slice(e,r+1)),Xi(a,this.toBBox),a;i||(i=Math.ceil(Math.log(s)/Math.log(o)),o=Math.ceil(s/Math.pow(o,i-1))),a=Ji([]),a.leaf=!1,a.height=i;const u=Math.ceil(s/o),l=u*Math.ceil(Math.sqrt(o));ah(t,e,r,l,this.compareMinX);for(let c=e;c<=r;c+=l){const h=Math.min(c+l-1,r);ah(t,c,h,u,this.compareMinY);for(let f=c;f<=h;f+=u){const p=Math.min(f+u-1,h);a.children.push(this._build(t,f,p,i-1))}}return Xi(a,this.toBBox),a}_chooseSubtree(t,e,r,i){for(;i.push(e),!(e.leaf||i.length-1===r);){let s=1/0,o=1/0,a;for(let u=0;u<e.children.length;u++){const l=e.children[u],c=ju(l),h=Cw(t,l)-c;h<o?(o=h,s=c<s?c:s,a=l):h===o&&c<s&&(s=c,a=l)}e=a||e.children[0]}return e}_insert(t,e,r){const i=r?t:this.toBBox(t),s=[],o=this._chooseSubtree(i,this.data,e,s);for(o.children.push(t),Hs(o,i);e>=0&&s[e].children.length>this._maxEntries;)this._split(s,e),e--;this._adjustParentBBoxes(i,s,e)}_split(t,e){const r=t[e],i=r.children.length,s=this._minEntries;this._chooseSplitAxis(r,s,i);const o=this._chooseSplitIndex(r,s,i),a=Ji(r.children.splice(o,r.children.length-o));a.height=r.height,a.leaf=r.leaf,Xi(r,this.toBBox),Xi(a,this.toBBox),e?t[e-1].children.push(a):this._splitRoot(r,a)}_splitRoot(t,e){this.data=Ji([t,e]),this.data.height=t.height+1,this.data.leaf=!1,Xi(this.data,this.toBBox)}_chooseSplitIndex(t,e,r){let i,s=1/0,o=1/0;for(let a=e;a<=r-e;a++){const u=Zs(t,0,a,this.toBBox),l=Zs(t,a,r,this.toBBox),c=Sw(u,l),h=ju(u)+ju(l);c<s?(s=c,i=a,o=h<o?h:o):c===s&&h<o&&(o=h,i=a)}return i||r-e}_chooseSplitAxis(t,e,r){const i=t.leaf?this.compareMinX:xw,s=t.leaf?this.compareMinY:Iw,o=this._allDistMargin(t,e,r,i),a=this._allDistMargin(t,e,r,s);o<a&&t.children.sort(i)}_allDistMargin(t,e,r,i){t.children.sort(i);const s=this.toBBox,o=Zs(t,0,e,s),a=Zs(t,r-e,r,s);let u=ha(o)+ha(a);for(let l=e;l<r-e;l++){const c=t.children[l];Hs(o,t.leaf?s(c):c),u+=ha(o)}for(let l=r-e-1;l>=e;l--){const c=t.children[l];Hs(a,t.leaf?s(c):c),u+=ha(a)}return u}_adjustParentBBoxes(t,e,r){for(let i=r;i>=0;i--)Hs(e[i],t)}_condense(t){for(let e=t.length-1,r;e>=0;e--)t[e].children.length===0?e>0?(r=t[e-1].children,r.splice(r.indexOf(t[e]),1)):this.clear():Xi(t[e],this.toBBox)}}function Ew(n,t,e){if(!e)return t.indexOf(n);for(let r=0;r<t.length;r++)if(e(n,t[r]))return r;return-1}function Xi(n,t){Zs(n,0,n.children.length,t,n)}function Zs(n,t,e,r,i){i||(i=Ji(null)),i.minX=1/0,i.minY=1/0,i.maxX=-1/0,i.maxY=-1/0;for(let s=t;s<e;s++){const o=n.children[s];Hs(i,n.leaf?r(o):o)}return i}function Hs(n,t){return n.minX=Math.min(n.minX,t.minX),n.minY=Math.min(n.minY,t.minY),n.maxX=Math.max(n.maxX,t.maxX),n.maxY=Math.max(n.maxY,t.maxY),n}function xw(n,t){return n.minX-t.minX}function Iw(n,t){return n.minY-t.minY}function ju(n){return(n.maxX-n.minX)*(n.maxY-n.minY)}function ha(n){return n.maxX-n.minX+(n.maxY-n.minY)}function Cw(n,t){return(Math.max(t.maxX,n.maxX)-Math.min(t.minX,n.minX))*(Math.max(t.maxY,n.maxY)-Math.min(t.minY,n.minY))}function Sw(n,t){const e=Math.max(n.minX,t.minX),r=Math.max(n.minY,t.minY),i=Math.min(n.maxX,t.maxX),s=Math.min(n.maxY,t.maxY);return Math.max(0,i-e)*Math.max(0,s-r)}function Vu(n,t){return n.minX<=t.minX&&n.minY<=t.minY&&t.maxX<=n.maxX&&t.maxY<=n.maxY}function fa(n,t){return t.minX<=n.maxX&&t.minY<=n.maxY&&t.maxX>=n.minX&&t.maxY>=n.minY}function Ji(n){return{children:n,height:1,leaf:!0,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0}}function ah(n,t,e,r,i){const s=[t,e];for(;s.length;){if(e=s.pop(),t=s.pop(),e-t<=r)continue;const o=t+Math.ceil((e-t)/r/2)*r;yw(n,o,t,e,i),s.push(t,o,o,e)}}function bw(n,t,e){if(e===void 0&&(e={}),!n)throw new Error("point is required");if(!t)throw new Error("polygon is required");var r=bs(n),i=vv(t),s=i.type,o=t.bbox,a=i.coordinates;if(o&&Mw(r,o)===!1)return!1;s==="Polygon"&&(a=[a]);for(var u=!1,l=0;l<a.length&&!u;l++)if(uh(r,a[l][0],e.ignoreBoundary)){for(var c=!1,h=1;h<a[l].length&&!c;)uh(r,a[l][h],!e.ignoreBoundary)&&(c=!0),h++;c||(u=!0)}return u}function uh(n,t,e){var r=!1;t[0][0]===t[t.length-1][0]&&t[0][1]===t[t.length-1][1]&&(t=t.slice(0,t.length-1));for(var i=0,s=t.length-1;i<t.length;s=i++){var o=t[i][0],a=t[i][1],u=t[s][0],l=t[s][1],c=n[1]*(o-u)+a*(u-n[0])+l*(n[0]-o)===0&&(o-n[0])*(u-n[0])<=0&&(a-n[1])*(l-n[1])<=0;if(c)return!e;var h=a>n[1]!=l>n[1]&&n[0]<(u-o)*(n[1]-a)/(l-a)+o;h&&(r=!r)}return r}function Mw(n,t){return t[0]<=n[0]&&t[1]<=n[1]&&t[2]>=n[0]&&t[3]>=n[1]}const Nw=!0;let Tw=class{constructor(){M(this,"rbush",new ww);M(this,"polygonsById",new Map);M(this,"bboxesById",new Map);M(this,"itemsById",new Map)}addItem(n,t){this.removeItem(n);const e=De(t),r={minX:e[0],minY:e[1],maxX:e[2],maxY:e[3],id:n};this.polygonsById.set(n,t),this.bboxesById.set(n,e),this.itemsById.set(n,r),this.rbush.insert(r)}removeItem(n){const t=this.itemsById.get(n);t&&(this.rbush.remove(t),this.polygonsById.delete(n),this.bboxesById.delete(n),this.itemsById.delete(n))}clear(){this.polygonsById.clear(),this.bboxesById.clear(),this.itemsById.clear(),this.rbush.clear()}search(n,t,e,r){return this.rbush.search({minX:n,minY:t,maxX:e,maxY:r})}getBbox(n){return this.bboxesById.get(n)}getPolygon(n){return this.polygonsById.get(n)}searchFromBbox(n){const[t,e,r,i]=n;return this.search(t,e,r,i).map(s=>s.id)}searchFromPoint(n,t=Nw){const[e,r,i,s]=[n[0],n[1],n[0],n[1]],o=this.search(e,r,i,s);return t?o.filter(a=>{const u=this.polygonsById.get(a.id);return u?bw(n,u):!1}).map(a=>a.id):o.map(a=>a.id)}};function Pw(){return{createRTree:!0,imageInformations:new Map}}let Rw=class extends EventTarget{constructor(t,e){super();M(this,"warpedMapFactory");M(this,"warpedMapsById",new Map);M(this,"zIndices",new Map);M(this,"rtree");M(this,"imageInformations");M(this,"transformation");M(this,"fetchFn");this.warpedMapFactory=t,e={...Pw(),...e},this.fetchFn=e==null?void 0:e.fetchFn,this.imageInformations=e.imageInformations,this.transformation=e.transformation,e.createRTree&&(this.rtree=new Tw)}getMapIds(){return this.warpedMapsById.keys()}getWarpedMaps(t){if(t===void 0)return this.warpedMapsById.values();{const e=[];for(const r of t){const i=this.warpedMapsById.get(r);i&&e.push(i)}return e}}getWarpedMap(t){return this.warpedMapsById.get(t)}getMapZIndex(t){return this.zIndices.get(t)}getCenter(){const t=this.getBbox();if(t)return xs(t)}getProjectedCenter(){const t=this.getProjectedBbox();if(t)return xs(t)}getBbox(){let t;for(const e of this.getWarpedMaps())e.visible&&(t?t=Mc(t,e.geoMaskBbox):t=e.geoMaskBbox);return t}getProjectedBbox(){let t;for(const e of this.getWarpedMaps())e.visible&&(t?t=Mc(t,e.projectedGeoMaskBbox):t=e.projectedGeoMaskBbox);return t}getMapsByGeoBbox(t){return this.rtree?this.rtree.searchFromBbox(t):Array.from(this.warpedMapsById.keys())}setImageInformations(t){this.imageInformations=t}setMapResourceMask(t,e){const r=this.warpedMapsById.get(t);r&&(r.setResourceMask(e),this.addToOrUpdateRtree(r),this.dispatchEvent(new ct(B.RESOURCEMASKUPDATED,t)))}setMapsTransformationType(t,e){const r=[];for(const i of t){const s=this.warpedMapsById.get(i);s&&s.transformationType!=e&&(s.setTransformationType(e),this.addToOrUpdateRtree(s),r.push(i))}r.length>0&&this.dispatchEvent(new ct(B.TRANSFORMATIONCHANGED,r))}setMapsDistortionMeasure(t,e){const r=[];for(const i of t){const s=this.warpedMapsById.get(i);s&&s.distortionMeasure!=e&&(s.setDistortionMeasure(e),r.push(i))}r.length>0&&this.dispatchEvent(new ct(B.DISTORTIONCHANGED,r))}bringMapsToFront(t){let e=this.warpedMapsById.size;for(const r of t)this.zIndices.has(r)&&(this.zIndices.set(r,e),e++);this.removeZIndexHoles(),this.dispatchEvent(new ct(B.ZINDICESCHANGES))}sendMapsToBack(t){let e=-Array.from(t).length;for(const r of t)this.zIndices.has(r)&&(this.zIndices.set(r,e),e++);this.removeZIndexHoles(),this.dispatchEvent(new ct(B.ZINDICESCHANGES))}bringMapsForward(t){for(const[e,r]of this.zIndices.entries())this.zIndices.set(e,r*2);for(const e of t){const r=this.zIndices.get(e);r!==void 0&&this.zIndices.set(e,r+3)}this.removeZIndexHoles(),this.dispatchEvent(new ct(B.ZINDICESCHANGES))}sendMapsBackward(t){for(const[e,r]of this.zIndices.entries())this.zIndices.set(e,r*2);for(const e of t){const r=this.zIndices.get(e);r!==void 0&&this.zIndices.set(e,r-3)}this.removeZIndexHoles(),this.dispatchEvent(new ct(B.ZINDICESCHANGES))}showMaps(t){for(const e of t){const r=this.warpedMapsById.get(e);r&&(r.visible=!0)}this.dispatchEvent(new ct(B.VISIBILITYCHANGED,t))}hideMaps(t){for(const e of t){const r=this.warpedMapsById.get(e);r&&(r.visible=!1)}this.dispatchEvent(new ct(B.VISIBILITYCHANGED,t))}async addGeoreferencedMap(t){const e=oh(t),r=Array.isArray(e)?e[0]:e;return this.addGeoreferencedMapInternal(r)}async removeGeoreferencedMap(t){const e=oh(t),r=Array.isArray(e)?e[0]:e;return this.removeGeoreferencedMapInternal(r)}async addGeoreferenceAnnotation(t){const e=[],r=pl(t),i=await Promise.allSettled(r.map(s=>this.addGeoreferencedMapInternal(s)));for(const s of i)s.status==="fulfilled"?e.push(s.value):e.push(s.reason);return this.dispatchEvent(new ct(B.GEOREFERENCEANNOTATIONADDED)),this.dispatchEvent(new ct(B.ZINDICESCHANGES)),e}async removeGeoreferenceAnnotation(t){const e=[],r=pl(t);for(const i of r){const s=await this.removeGeoreferencedMapInternal(i);e.push(s)}return this.dispatchEvent(new ct(B.GEOREFERENCEANNOTATIONREMOVED)),e}clear(){var t;this.warpedMapsById=new Map,this.zIndices=new Map,(t=this.rtree)==null||t.clear(),this.dispatchEvent(new ct(B.CLEARED))}dispose(){for(const t of this.getWarpedMaps())this.removeEventListenersFromWarpedMap(t),t.dispose()}async addGeoreferencedMapInternal(t){const e=await this.getOrComputeMapId(t),r=this.warpedMapFactory(e,t,{imageInformations:this.imageInformations,fetchFn:this.fetchFn,transformation:this.transformation});return this.warpedMapsById.set(e,r),this.zIndices.set(e,this.warpedMapsById.size-1),this.addToOrUpdateRtree(r),this.addEventListenersToWarpedMap(r),this.dispatchEvent(new ct(B.WARPEDMAPADDED,e)),e}async removeGeoreferencedMapInternal(t){const e=await this.getOrComputeMapId(t),r=this.warpedMapsById.get(e);if(r)this.warpedMapsById.delete(e),this.zIndices.delete(e),this.removeFromRtree(r),this.dispatchEvent(new ct(B.WARPEDMAPREMOVED,e)),this.removeZIndexHoles(),this.dispatchEvent(new ct(B.ZINDICESCHANGES));else throw new Error(`No map found with ID ${e}`);return e}async getOrComputeMapId(t){return t.id||await Ld(t)}addToOrUpdateRtree(t){this.rtree&&(this.rtree.removeItem(t.mapId),this.rtree.addItem(t.mapId,t.geoMask))}removeFromRtree(t){this.rtree&&this.rtree.removeItem(t.mapId)}removeZIndexHoles(){const t=[...this.zIndices.entries()].sort((r,i)=>r[1]-i[1]);let e=0;for(const r of t){const i=r[0];this.zIndices.set(i,e),e++}}imageInfoLoaded(){this.dispatchEvent(new ct(B.IMAGEINFOLOADED))}addEventListenersToWarpedMap(t){t.addEventListener(B.IMAGEINFOLOADED,this.imageInfoLoaded.bind(this))}removeEventListenersFromWarpedMap(t){t.removeEventListener(B.IMAGEINFOLOADED,this.imageInfoLoaded.bind(this))}};class Lw extends EventTarget{constructor(e,r){super();M(this,"tile");M(this,"imageRequest");M(this,"tileUrl");M(this,"fetchFn");M(this,"abortController");M(this,"data");this.tile=e.tile,this.imageRequest=e.imageRequest,this.tileUrl=e.tileUrl,this.fetchFn=r,this.abortController=new AbortController}isCachedTile(){return this.data!==void 0}abort(){this.abortController.signal.aborted||this.abortController.abort()}}class Aw{constructor(t,e){M(this,"mapId");M(this,"tile");M(this,"imageRequest");M(this,"tileUrl");this.mapId=e.mapId,this.tile=t;const r=e.parsedImage.getIiifTile(t.tileZoomLevel,t.column,t.row);this.imageRequest=r,this.tileUrl=e.parsedImage.getImageUrl(r)}}class ec extends Lw{async fetch(){try{const t=await(await tf(this.tileUrl,{signal:this.abortController.signal},this.fetchFn)).blob();this.data=await createImageBitmap(t),this.dispatchEvent(new ct(B.TILEFETCHED,this.tileUrl))}catch(t){t instanceof Error&&t.name==="AbortError"||this.dispatchEvent(new ct(B.TILEFETCHERROR,this.tileUrl))}return this.data}static createFactory(){return(t,e)=>new ec(t,e)}}const Ow=0,Dw=32*1e3*1e3;class Fw extends EventTarget{constructor(e,r){super();M(this,"cachableTileFactory");M(this,"fetchFn");M(this,"tilesByTileUrl",new Map);M(this,"mapIdsByTileUrl",new Map);M(this,"tileUrlsByMapId",new Map);M(this,"tilesFetchingCount",0);M(this,"previousRequestedTiles",[]);M(this,"outgoingTilesHistory",[]);this.cachableTileFactory=e,this.fetchFn=r==null?void 0:r.fetchFn}getCacheableTile(e){return this.tilesByTileUrl.get(e)}getCachedTile(e){const r=this.tilesByTileUrl.get(e);if(r&&r.isCachedTile())return r}getCacheableTiles(){return this.tilesByTileUrl.values()}getCachedTiles(){const e=[];for(const r of this.tilesByTileUrl.values())r.isCachedTile()&&e.push(r);return e}getCachedTilesForMapId(e){var i;const r=[];for(const s of this.tilesByTileUrl.values())s.isCachedTile()&&((i=this.tileUrlsByMapId.get(e))!=null&&i.has(s.tileUrl))&&r.push(s);return r}getTileUrls(){return this.tilesByTileUrl.keys()}requestFetchableTiles(e){const r=Uu(this.previousRequestedTiles),i=Uu(e);if(Ed(r,i))return;const s=[];for(const u of this.previousRequestedTiles)i.has(xp(u))||s.push(u);this.updateOutgoingTilesHistory(s,e.length);const o=Uu(this.outgoingTilesHistory),a=new Set([...i,...o]);for(const[u,l]of this.mapIdsByTileUrl)for(const c of l)a.has(Ep(c,u))||this.removeMapTile(c,u);for(const u of e)this.addMapTile(u);this.previousRequestedTiles=e}async allRequestedTilesLoaded(){return new Promise(e=>{if(this.finished)e();else{const r=()=>{this.removeEventListener(B.ALLREQUESTEDTILESLOADED,r),e()};this.addEventListener(B.ALLREQUESTEDTILESLOADED,r)}})}getTileUrlsForMapId(e){return this.tileUrlsByMapId.get(e)||new Set}clear(){this.tilesByTileUrl=new Map,this.mapIdsByTileUrl=new Map,this.tileUrlsByMapId=new Map,this.tilesFetchingCount=0,this.outgoingTilesHistory=[]}dispose(){for(const e of this.getCacheableTiles())this.removeEventListenersFromTile(e)}addMapTile(e){const r=e.mapId,i=e.tileUrl;if(this.tilesByTileUrl.has(i))this.dispatchEvent(new ct(B.MAPTILELOADED,{mapId:r,tileUrl:i}));else{const s=this.cachableTileFactory(e,this.fetchFn);this.addEventListenersToTile(s),this.tilesByTileUrl.set(i,s),this.updateTilesFetchingCount(1),s.fetch()}this.addTileUrlForMapId(r,i),this.addMapIdForTileUrl(r,i)}removeMapTile(e,r){const i=this.tilesByTileUrl.get(r);if(!i)return;const s=this.removeMapIdForTileUrl(e,r);this.removeTileUrlForMapId(e,r),s.size||(i.isCachedTile()||(i.abort(),this.updateTilesFetchingCount(-1)),this.tilesByTileUrl.delete(r)),this.dispatchEvent(new ct(B.MAPTILEREMOVED,{mapId:e,tileUrl:r}))}updateOutgoingTilesHistory(e,r){for(let a=e.length-1;a>=0;a--){const u=e[a];this.outgoingTilesHistory.unshift(u)}this.outgoingTilesHistory=Array.from(new Set(this.outgoingTilesHistory));let i=0,s=0,o=0;for(const a of this.outgoingTilesHistory){if(i+=1,o=S_(a),s+=o,i+r>Ow){i-=1,s-=o;break}if(s>Dw){i-=1,s-=o;break}}this.outgoingTilesHistory=this.outgoingTilesHistory.slice(0,i)}tileFetched(e){var r;if(e instanceof ct){const i=e.data;this.updateTilesFetchingCount(-1);for(const s of this.mapIdsByTileUrl.get(i)||[])this.dispatchEvent(new ct(B.MAPTILELOADED,{mapId:s,tileUrl:i})),((r=this.tileUrlsByMapId.get(s))==null?void 0:r.values().next().value)===i&&this.dispatchEvent(new ct(B.FIRSTMAPTILELOADED,{mapId:s,tileUrl:i}))}}tileFetchError(e){if(e instanceof ct){const r=e.data;this.tilesByTileUrl.has(r)||this.updateTilesFetchingCount(-1)}}addMapIdForTileUrl(e,r){let i=this.mapIdsByTileUrl.get(r);return i?i.add(e):i=new Set([e]),this.mapIdsByTileUrl.set(r,i),i}removeMapIdForTileUrl(e,r){const i=this.mapIdsByTileUrl.get(r);if(i)i.delete(e);else return new Set;return i.size?this.mapIdsByTileUrl.set(r,i):this.mapIdsByTileUrl.delete(r),i}addTileUrlForMapId(e,r){let i=this.tileUrlsByMapId.get(e);return i?i.add(r):i=new Set([r]),this.tileUrlsByMapId.set(e,i),i}removeTileUrlForMapId(e,r){const i=this.tileUrlsByMapId.get(e);return i?(i.delete(r),i.size?this.tileUrlsByMapId.set(e,i):this.tileUrlsByMapId.delete(e),i):new Set}get finished(){return this.tilesFetchingCount===0}updateTilesFetchingCount(e){this.tilesFetchingCount+=e,this.tilesFetchingCount===0&&this.dispatchEvent(new ct(B.ALLREQUESTEDTILESLOADED))}addEventListenersToTile(e){e.addEventListener(B.TILEFETCHED,this.tileFetched.bind(this)),e.addEventListener(B.TILEFETCHERROR,this.tileFetchError.bind(this))}removeEventListenersFromTile(e){e.removeEventListener(B.TILEFETCHED,this.tileFetched.bind(this)),e.removeEventListener(B.TILEFETCHERROR,this.tileFetchError.bind(this))}}const kw=5;class Gw extends EventTarget{constructor(e,r,i){super();M(this,"warpedMapList");M(this,"tileCache");M(this,"mapsInViewport",new Set);M(this,"viewport");this.tileCache=new Fw(e,i),this.warpedMapList=new Rw(r,i)}async addGeoreferenceAnnotation(e){return this.warpedMapList.addGeoreferenceAnnotation(e)}async addGeoreferencedMap(e){return this.warpedMapList.addGeoreferencedMap(e)}loadMissingImageInfosInViewport(){return this.viewport?Array.from(this.warpedMapList.getMapsByGeoBbox(this.viewport.geoRectangleBbox)).map(e=>this.warpedMapList.getWarpedMap(e)).filter(e=>!e.hasImageInfo()&&!e.loadingImageInfo).map(e=>e.loadImageInfo()):[]}someImageInfosInViewport(){return this.viewport?Array.from(this.warpedMapList.getMapsByGeoBbox(this.viewport.geoRectangleBbox)).map(e=>this.warpedMapList.getWarpedMap(e)).map(e=>e.hasImageInfo()).some(e=>e===!0):!1}shouldUpdateRequestedTiles(){return!0}updateRequestedTiles(){if(!this.viewport)return;const e=this.viewport;if(!this.shouldUpdateRequestedTiles())return;const r=Array.from(this.warpedMapList.getMapsByGeoBbox(this.viewport.geoRectangleBbox)).sort((s,o)=>{const a=this.warpedMapList.getWarpedMap(s),u=this.warpedMapList.getWarpedMap(o);return a&&u?ar(xs(a.geoMaskBbox),e.geoCenter)-ar(xs(u.geoMaskBbox),e.geoCenter):0}),i=[];for(const s of r){const o=this.warpedMapList.getWarpedMap(s);if(!o||!o.visible||!o.hasImageInfo()||yd(o.getViewportMaskBbox(e))<kw)continue;const a=__(o.parsedImage,o.getResourceToCanvasScale(e));o.setBestScaleFactor(a.scaleFactor);const u={maxDepth:0,sourceIsGeographic:!1,destinationIsGeographic:!0},l=o.transformer.transformBackward([e.geoRectangle],u)[0];o.setResourceViewportRing(l);const c=w_(l,a,o.parsedImage);for(const h of c)i.push(new Aw(h,o))}this.tileCache.requestFetchableTiles(i),this.updateMapsInViewport(i)}updateMapsInViewport(e){const r=Array.from(this.mapsInViewport),i=e.map(a=>a.mapId).filter((a,u,l)=>l.indexOf(a)===u);this.mapsInViewport=new Set(i.sort((a,u)=>{const l=this.warpedMapList.getMapZIndex(a),c=this.warpedMapList.getMapZIndex(u);return l!==void 0&&c!==void 0?l-c:0}));const s=i.filter(a=>!r.includes(a)),o=r.filter(a=>!i.includes(a));for(const a in s)this.dispatchEvent(new ct(B.WARPEDMAPENTER,a));for(const a in o)this.dispatchEvent(new ct(B.WARPEDMAPLEAVE,a))}mapTileLoaded(e){}mapTileRemoved(e){}imageInfoLoaded(e){}warpedMapAdded(e){}warpedMapRemoved(e){}transformationChanged(e){}distortionChanged(e){}addEventListeners(){this.tileCache.addEventListener(B.MAPTILELOADED,this.mapTileLoaded.bind(this)),this.tileCache.addEventListener(B.MAPTILEREMOVED,this.mapTileRemoved.bind(this)),this.warpedMapList.addEventListener(B.IMAGEINFOLOADED,this.imageInfoLoaded.bind(this)),this.warpedMapList.addEventListener(B.WARPEDMAPADDED,this.warpedMapAdded.bind(this)),this.warpedMapList.addEventListener(B.WARPEDMAPREMOVED,this.warpedMapRemoved.bind(this)),this.warpedMapList.addEventListener(B.TRANSFORMATIONCHANGED,this.transformationChanged.bind(this)),this.warpedMapList.addEventListener(B.DISTORTIONCHANGED,this.distortionChanged.bind(this))}removeEventListeners(){this.tileCache.removeEventListener(B.MAPTILELOADED,this.mapTileLoaded.bind(this)),this.tileCache.removeEventListener(B.MAPTILEREMOVED,this.mapTileRemoved.bind(this)),this.warpedMapList.removeEventListener(B.IMAGEINFOLOADED,this.imageInfoLoaded.bind(this)),this.warpedMapList.removeEventListener(B.WARPEDMAPADDED,this.warpedMapAdded.bind(this)),this.warpedMapList.removeEventListener(B.WARPEDMAPREMOVED,this.warpedMapRemoved.bind(this)),this.warpedMapList.removeEventListener(B.TRANSFORMATIONCHANGED,this.transformationChanged.bind(this)),this.warpedMapList.removeEventListener(B.DISTORTIONCHANGED,this.distortionChanged.bind(this))}}var Bw=`#version 300 es

precision highp float;

uniform mat4 u_renderTransform;

uniform float u_animationProgress;

in vec2 a_resourceTrianglePoint;
in vec2 a_clipPreviousTrianglePoint;
in vec2 a_clipTrianglePoint;
in float a_previousTrianglePointDistortion;
in float a_trianglePointDistortion;
in float a_triangleIndex;

out vec2 v_resourceTrianglePoint;
out float v_trianglePointDistortion;
out float v_triangleIndex;

float cubicInOut(float t) {
  return t < 0.5f ? 4.0f * t * t * t : 0.5f * pow(2.0f * t - 2.0f, 3.0f) + 1.0f;
}

void main() {
  
  vec2 clipTrianglePoint = mix(a_clipPreviousTrianglePoint, a_clipTrianglePoint, cubicInOut(u_animationProgress));
  float trianglePointDistortion = mix(a_previousTrianglePointDistortion, a_trianglePointDistortion, cubicInOut(u_animationProgress));

  
  
  

  gl_Position = u_renderTransform * vec4(clipTrianglePoint, 0.0f, 1.0f);

  
  v_resourceTrianglePoint = a_resourceTrianglePoint;
  v_trianglePointDistortion = trianglePointDistortion;
  v_triangleIndex = a_triangleIndex;
}`,zw=`#version 300 es

precision highp float;
precision highp isampler2D;

#ifndef SPECTRAL
#define SPECTRAL

const int SPECTRAL_SIZE = 38;
const float SPECTRAL_GAMMA = 2.4;
const float SPECTRAL_EPSILON = 0.0001;

float spectral_uncompand(float x) {
  return (x < 0.04045) ? x / 12.92 : pow((x + 0.055) / 1.055, SPECTRAL_GAMMA);
}

float spectral_compand(float x) {
  return (x < 0.0031308) ? x * 12.92 : 1.055 * pow(x, 1.0 / SPECTRAL_GAMMA) - 0.055;
}

vec3 spectral_srgb_to_linear(vec3 srgb) {
    return vec3(spectral_uncompand(srgb[0]), spectral_uncompand(srgb[1]), spectral_uncompand(srgb[2]));
}

vec3 spectral_linear_to_srgb(vec3 lrgb) {
    return clamp(vec3(spectral_compand(lrgb[0]), spectral_compand(lrgb[1]), spectral_compand(lrgb[2])), 0.0, 1.0);
}

void spectral_upsampling(vec3 lrgb, out float w, out float c, out float m, out float y, out float r, out float g, out float b) {
    w = min(lrgb.r, min(lrgb.g, lrgb.b));

    lrgb -= w;

    c = min(lrgb.g, lrgb.b);
    m = min(lrgb.r, lrgb.b);
    y = min(lrgb.r, lrgb.g);
    r = min(max(0., lrgb.r - lrgb.b), max(0., lrgb.r - lrgb.g));
    g = min(max(0., lrgb.g - lrgb.b), max(0., lrgb.g - lrgb.r));
    b = min(max(0., lrgb.b - lrgb.g), max(0., lrgb.b - lrgb.r));
}

void spectral_linear_to_reflectance(vec3 lrgb, inout float R[SPECTRAL_SIZE]) {
    float w, c, m, y, r, g, b;

    spectral_upsampling(lrgb, w, c, m, y, r, g, b);

     R[0] = max(SPECTRAL_EPSILON, w + c * 0.96853629 + m * 0.51567122 + y * 0.02055257 + r * 0.03147571 + g * 0.49108579 + b * 0.97901834);
     R[1] = max(SPECTRAL_EPSILON, w + c * 0.96855103 + m * 0.54015520 + y * 0.02059936 + r * 0.03146636 + g * 0.46944057 + b * 0.97901649);
     R[2] = max(SPECTRAL_EPSILON, w + c * 0.96859338 + m * 0.62645502 + y * 0.02062723 + r * 0.03140624 + g * 0.40165780 + b * 0.97901118);
     R[3] = max(SPECTRAL_EPSILON, w + c * 0.96877345 + m * 0.75595012 + y * 0.02073387 + r * 0.03119611 + g * 0.24490420 + b * 0.97892146);
     R[4] = max(SPECTRAL_EPSILON, w + c * 0.96942204 + m * 0.92826996 + y * 0.02114202 + r * 0.03053888 + g * 0.06826880 + b * 0.97858555);
     R[5] = max(SPECTRAL_EPSILON, w + c * 0.97143709 + m * 0.97223624 + y * 0.02233154 + r * 0.02856855 + g * 0.02732883 + b * 0.97743705);
     R[6] = max(SPECTRAL_EPSILON, w + c * 0.97541862 + m * 0.98616174 + y * 0.02556857 + r * 0.02459485 + g * 0.01360600 + b * 0.97428075);
     R[7] = max(SPECTRAL_EPSILON, w + c * 0.98074186 + m * 0.98955255 + y * 0.03330189 + r * 0.01929520 + g * 0.01000187 + b * 0.96663223);
     R[8] = max(SPECTRAL_EPSILON, w + c * 0.98580992 + m * 0.98676237 + y * 0.05185294 + r * 0.01423112 + g * 0.01284127 + b * 0.94822893);
     R[9] = max(SPECTRAL_EPSILON, w + c * 0.98971194 + m * 0.97312575 + y * 0.10087639 + r * 0.01033111 + g * 0.02636635 + b * 0.89937713);
    R[10] = max(SPECTRAL_EPSILON, w + c * 0.99238027 + m * 0.91944277 + y * 0.24000413 + r * 0.00765876 + g * 0.07058713 + b * 0.76070164);
    R[11] = max(SPECTRAL_EPSILON, w + c * 0.99409844 + m * 0.32564851 + y * 0.53589066 + r * 0.00593693 + g * 0.70421692 + b * 0.46420440);
    R[12] = max(SPECTRAL_EPSILON, w + c * 0.99517200 + m * 0.13820628 + y * 0.79874659 + r * 0.00485616 + g * 0.85473994 + b * 0.20123039);
    R[13] = max(SPECTRAL_EPSILON, w + c * 0.99576545 + m * 0.05015143 + y * 0.91186529 + r * 0.00426186 + g * 0.95081565 + b * 0.08808402);
    R[14] = max(SPECTRAL_EPSILON, w + c * 0.99593552 + m * 0.02912336 + y * 0.95399623 + r * 0.00409039 + g * 0.97170370 + b * 0.04592894);
    R[15] = max(SPECTRAL_EPSILON, w + c * 0.99564041 + m * 0.02421691 + y * 0.97137099 + r * 0.00438375 + g * 0.97651888 + b * 0.02860373);
    R[16] = max(SPECTRAL_EPSILON, w + c * 0.99464769 + m * 0.02660696 + y * 0.97939505 + r * 0.00537525 + g * 0.97429245 + b * 0.02060067);
    R[17] = max(SPECTRAL_EPSILON, w + c * 0.99229579 + m * 0.03407586 + y * 0.98345207 + r * 0.00772962 + g * 0.97012917 + b * 0.01656701);
    R[18] = max(SPECTRAL_EPSILON, w + c * 0.98638762 + m * 0.04835936 + y * 0.98553736 + r * 0.01366120 + g * 0.94258630 + b * 0.01451549);
    R[19] = max(SPECTRAL_EPSILON, w + c * 0.96829712 + m * 0.00011720 + y * 0.98648905 + r * 0.03181352 + g * 0.99989207 + b * 0.01357964);
    R[20] = max(SPECTRAL_EPSILON, w + c * 0.89228016 + m * 0.00008554 + y * 0.98674535 + r * 0.10791525 + g * 0.99989891 + b * 0.01331243);
    R[21] = max(SPECTRAL_EPSILON, w + c * 0.53740239 + m * 0.85267882 + y * 0.98657555 + r * 0.46249516 + g * 0.13823139 + b * 0.01347661);
    R[22] = max(SPECTRAL_EPSILON, w + c * 0.15360445 + m * 0.93188793 + y * 0.98611877 + r * 0.84604333 + g * 0.06968113 + b * 0.01387181);
    R[23] = max(SPECTRAL_EPSILON, w + c * 0.05705719 + m * 0.94810268 + y * 0.98559942 + r * 0.94275572 + g * 0.05628787 + b * 0.01435472);
    R[24] = max(SPECTRAL_EPSILON, w + c * 0.03126539 + m * 0.94200977 + y * 0.98507063 + r * 0.96860996 + g * 0.06111561 + b * 0.01479836);
    R[25] = max(SPECTRAL_EPSILON, w + c * 0.02205445 + m * 0.91478045 + y * 0.98460039 + r * 0.97783966 + g * 0.08987709 + b * 0.01515250);
    R[26] = max(SPECTRAL_EPSILON, w + c * 0.01802271 + m * 0.87065445 + y * 0.98425301 + r * 0.98187757 + g * 0.13656016 + b * 0.01540513);
    R[27] = max(SPECTRAL_EPSILON, w + c * 0.01613460 + m * 0.78827548 + y * 0.98403909 + r * 0.98377315 + g * 0.22169624 + b * 0.01557233);
    R[28] = max(SPECTRAL_EPSILON, w + c * 0.01520947 + m * 0.65738359 + y * 0.98388535 + r * 0.98470202 + g * 0.32176956 + b * 0.01565710);
    R[29] = max(SPECTRAL_EPSILON, w + c * 0.01475977 + m * 0.59909403 + y * 0.98376116 + r * 0.98515481 + g * 0.36157329 + b * 0.01571025);
    R[30] = max(SPECTRAL_EPSILON, w + c * 0.01454263 + m * 0.56817268 + y * 0.98368246 + r * 0.98537114 + g * 0.48361920 + b * 0.01571916);
    R[31] = max(SPECTRAL_EPSILON, w + c * 0.01444459 + m * 0.54031997 + y * 0.98365023 + r * 0.98546685 + g * 0.46488579 + b * 0.01572133);
    R[32] = max(SPECTRAL_EPSILON, w + c * 0.01439897 + m * 0.52110241 + y * 0.98361309 + r * 0.98550011 + g * 0.47440306 + b * 0.01572502);
    R[33] = max(SPECTRAL_EPSILON, w + c * 0.01437620 + m * 0.51041094 + y * 0.98357259 + r * 0.98551031 + g * 0.48576990 + b * 0.01571717);
    R[34] = max(SPECTRAL_EPSILON, w + c * 0.01436343 + m * 0.50526577 + y * 0.98353856 + r * 0.98550741 + g * 0.49267971 + b * 0.01571905);
    R[35] = max(SPECTRAL_EPSILON, w + c * 0.01435687 + m * 0.50255080 + y * 0.98351247 + r * 0.98551323 + g * 0.49625685 + b * 0.01571059);
    R[36] = max(SPECTRAL_EPSILON, w + c * 0.01435370 + m * 0.50126452 + y * 0.98350101 + r * 0.98551563 + g * 0.49807754 + b * 0.01569728);
    R[37] = max(SPECTRAL_EPSILON, w + c * 0.01435408 + m * 0.50083021 + y * 0.98350852 + r * 0.98551547 + g * 0.49889859 + b * 0.01570020);
}

vec3 spectral_xyz_to_srgb(vec3 xyz) {
    mat3 XYZ_RGB;

    XYZ_RGB[0] = vec3( 3.24306333, -1.53837619, -0.49893282);
    XYZ_RGB[1] = vec3(-0.96896309,  1.87542451,  0.04154303);
    XYZ_RGB[2] = vec3( 0.05568392, -0.20417438,  1.05799454);

    float r = dot(XYZ_RGB[0], xyz);
    float g = dot(XYZ_RGB[1], xyz);
    float b = dot(XYZ_RGB[2], xyz);

    return spectral_linear_to_srgb(vec3(r, g, b));
}

vec3 spectral_reflectance_to_xyz(float R[SPECTRAL_SIZE]) {
    vec3 xyz = vec3(0.0);

    xyz +=  R[0] * vec3(0.00006469, 0.00000184, 0.00030502);
    xyz +=  R[1] * vec3(0.00021941, 0.00000621, 0.00103681);
    xyz +=  R[2] * vec3(0.00112057, 0.00003101, 0.00531314);
    xyz +=  R[3] * vec3(0.00376661, 0.00010475, 0.01795439);
    xyz +=  R[4] * vec3(0.01188055, 0.00035364, 0.05707758);
    xyz +=  R[5] * vec3(0.02328644, 0.00095147, 0.11365162);
    xyz +=  R[6] * vec3(0.03455942, 0.00228226, 0.17335873);
    xyz +=  R[7] * vec3(0.03722379, 0.00420733, 0.19620658);
    xyz +=  R[8] * vec3(0.03241838, 0.00668880, 0.18608237);
    xyz +=  R[9] * vec3(0.02123321, 0.00988840, 0.13995048);
    xyz += R[10] * vec3(0.01049099, 0.01524945, 0.08917453);
    xyz += R[11] * vec3(0.00329584, 0.02141831, 0.04789621);
    xyz += R[12] * vec3(0.00050704, 0.03342293, 0.02814563);
    xyz += R[13] * vec3(0.00094867, 0.05131001, 0.01613766);
    xyz += R[14] * vec3(0.00627372, 0.07040208, 0.00775910);
    xyz += R[15] * vec3(0.01686462, 0.08783871, 0.00429615);
    xyz += R[16] * vec3(0.02868965, 0.09424905, 0.00200551);
    xyz += R[17] * vec3(0.04267481, 0.09795667, 0.00086147);
    xyz += R[18] * vec3(0.05625475, 0.09415219, 0.00036904);
    xyz += R[19] * vec3(0.06947040, 0.08678102, 0.00019143);
    xyz += R[20] * vec3(0.08305315, 0.07885653, 0.00014956);
    xyz += R[21] * vec3(0.08612610, 0.06352670, 0.00009231);
    xyz += R[22] * vec3(0.09046614, 0.05374142, 0.00006813);
    xyz += R[23] * vec3(0.08500387, 0.04264606, 0.00002883);
    xyz += R[24] * vec3(0.07090667, 0.03161735, 0.00001577);
    xyz += R[25] * vec3(0.05062889, 0.02088521, 0.00000394);
    xyz += R[26] * vec3(0.03547396, 0.01386011, 0.00000158);
    xyz += R[27] * vec3(0.02146821, 0.00810264, 0.00000000);
    xyz += R[28] * vec3(0.01251646, 0.00463010, 0.00000000);
    xyz += R[29] * vec3(0.00680458, 0.00249138, 0.00000000);
    xyz += R[30] * vec3(0.00346457, 0.00125930, 0.00000000);
    xyz += R[31] * vec3(0.00149761, 0.00054165, 0.00000000);
    xyz += R[32] * vec3(0.00076970, 0.00027795, 0.00000000);
    xyz += R[33] * vec3(0.00040737, 0.00014711, 0.00000000);
    xyz += R[34] * vec3(0.00016901, 0.00006103, 0.00000000);
    xyz += R[35] * vec3(0.00009522, 0.00003439, 0.00000000);
    xyz += R[36] * vec3(0.00004903, 0.00001771, 0.00000000);
    xyz += R[37] * vec3(0.00002000, 0.00000722, 0.00000000);

    return xyz;
}

float spectral_linear_to_concentration(float l1, float l2, float t) {
    float t1 = l1 * pow(1.0 - t, 2.0);
    float t2 = l2 * pow(t, 2.0);

    return t2 / (t1 + t2);
}

vec3 spectral_mix(vec3 color1, vec3 color2, float t) {
    vec3 lrgb1 = spectral_srgb_to_linear(color1);
    vec3 lrgb2 = spectral_srgb_to_linear(color2);

    float R1[SPECTRAL_SIZE];
    float R2[SPECTRAL_SIZE];

    spectral_linear_to_reflectance(lrgb1, R1);
    spectral_linear_to_reflectance(lrgb2, R2);

    float l1 = spectral_reflectance_to_xyz(R1)[1];
    float l2 = spectral_reflectance_to_xyz(R2)[1];

    t = spectral_linear_to_concentration(l1, l2, t);

    float R[SPECTRAL_SIZE];

    for (int i = 0; i < SPECTRAL_SIZE; i++) {
      float KS = (1.0 - t) * (pow(1.0 - R1[i], 2.0) / (2.0 * R1[i])) + t * (pow(1.0 - R2[i], 2.0) / (2.0 * R2[i]));
      float KM = 1.0 + KS - sqrt(pow(KS, 2.0) + 2.0 * KS);

      
      

      R[i] = KM;
    }

    return spectral_xyz_to_srgb(spectral_reflectance_to_xyz(R));
}

vec4 spectral_mix(vec4 color1, vec4 color2, float t) {
    return vec4(spectral_mix(color1.rgb, color2.rgb, t), mix(color1.a, color2.a, t));
}

#endif

uniform bool u_removeColor;
uniform vec3 u_removeColorOptionsColor;
uniform float u_removeColorOptionsThreshold;
uniform float u_removeColorOptionsHardness;

uniform bool u_colorize;
uniform vec3 u_colorizeOptionsColor;

uniform bool u_grid;

uniform float u_opacity;
uniform float u_saturation;

uniform bool u_distortion;
uniform int u_distortionOptionsdistortionMeasure;

uniform int u_bestScaleFactor;

uniform sampler2D u_packedTilesTexture;
uniform isampler2D u_packedTilesPositionsTexture;
uniform isampler2D u_packedTilesResourcePositionsAndDimensionsTexture;
uniform isampler2D u_packedTilesScaleFactorsTexture;

in vec2 v_resourceTrianglePoint;
in float v_triangleIndex;
in float v_trianglePointDistortion;

out vec4 color;

vec4 rgbToVec4(int r, int g, int b) {
  return vec4(float(r) / 255.0f, float(g) / 255.0f, float(b) / 255.0f, 1.0f);
}

void main() {
  
  
  
  vec4 colorTransparent = vec4(0.0f, 0.0f, 0.0f, 0.0f);
  vec4 colorWhite = vec4(1.0f, 1.0f, 1.0f, 1.0f);
  vec4 colorBlack = vec4(0.0f, 0.0f, 0.0f, 1.0f);

  vec4 colorGreen300 = vec4(0.5254f, 0.9372f, 0.6745f, 1.0f);
  vec4 colorPurple300 = vec4(0.8470f, 0.7058f, 0.9960f, 1.0f);
  vec4 colorRed300 = vec4(0.9882f, 0.6470f, 0.6470f, 1.0f);
  vec4 colorYellow300 = vec4(0.9921f, 0.8784f, 0.2784f, 1.0f);
  vec4 colorOrange300 = vec4(0.9921f, 0.7294f, 0.4549f, 1.0f);
  vec4 colorPink300 = vec4(0.9764f, 0.6588f, 0.8313f, 1.0f);
  vec4 colorBlue300 = vec4(0.5764f, 0.7725f, 0.9921f, 1.0f);
  vec4 colorGrey300 = vec4(0.8196f, 0.8352f, 0.8588f, 1.0f);

  vec4 colorGreen500 = vec4(0.1333f, 0.7725f, 0.3686f, 1.0f);
  vec4 colorPurple500 = vec4(0.6588f, 0.3333f, 0.9686f, 1.0f);
  vec4 colorRed500 = vec4(0.9372f, 0.2666f, 0.2666f, 1.0f);
  vec4 colorYellow500 = vec4(0.9176f, 0.7019f, 0.0313f, 1.0f);
  vec4 colorOrange500 = vec4(0.9764f, 0.4509f, 0.0862f, 1.0f);
  vec4 colorPink500 = vec4(0.9254f, 0.2823f, 0.6f, 1.0f);
  vec4 colorBlue500 = vec4(0.2313f, 0.5098f, 0.9647f, 1.0f);
  vec4 colorGrey500 = vec4(0.4196f, 0.4470f, 0.5019f, 1.0f);

  float resourceTrianglePointX = v_resourceTrianglePoint.x;
  float resourceTrianglePointY = v_resourceTrianglePoint.y;

  
  int packedTilesCount = textureSize(u_packedTilesPositionsTexture, 0).y;
  ivec2 packedTilesTextureSize = textureSize(u_packedTilesTexture, 0);

  
  int smallestScaleFactorDiff = 256 * 256; 
  int bestScaleFactor = 0;

  
  vec2 packedTilesTexturePoint = vec2(0.0f, 0.0f);

  
  color = colorTransparent;
  bool found = false;

  
  for(int index = 0; index < packedTilesCount; index += 1) {

    
    ivec2 packedTilePosition = texelFetch(u_packedTilesPositionsTexture, ivec2(0, index), 0).rg;
    ivec4 packedTileResourcePositionAndDimension = texelFetch(u_packedTilesResourcePositionsAndDimensionsTexture, ivec2(0, index), 0);
    int packedTileScaleFactor = texelFetch(u_packedTilesScaleFactorsTexture, ivec2(0, index), 0).r;

    float packedTilePositionX = float(packedTilePosition.r);
    float packedTilePositionY = float(packedTilePosition.g);

    float packedTileResourcePositionX = float(packedTileResourcePositionAndDimension.r);
    float packedTileResourcePositionY = float(packedTileResourcePositionAndDimension.g);

    float packedTileDimensionWidth = float(packedTileResourcePositionAndDimension.b);
    float packedTileDimensionHeight = float(packedTileResourcePositionAndDimension.a);

    
    
    
    
    if(resourceTrianglePointX >= packedTileResourcePositionX &&
      resourceTrianglePointX < packedTileResourcePositionX + packedTileDimensionWidth &&
      resourceTrianglePointY >= packedTileResourcePositionY &&
      resourceTrianglePointY < packedTileResourcePositionY + packedTileDimensionHeight) {
      found = true;

      int scaleFactorDiff = abs(u_bestScaleFactor - packedTileScaleFactor);

      if(scaleFactorDiff < smallestScaleFactorDiff || bestScaleFactor == 0) {

        smallestScaleFactorDiff = scaleFactorDiff;
        bestScaleFactor = packedTileScaleFactor;

        float packedTilePointX = (resourceTrianglePointX - packedTileResourcePositionX) / float(bestScaleFactor);
        float packedTilePointY = (resourceTrianglePointY - packedTileResourcePositionY) / float(bestScaleFactor);

        float packedTilesPointX = packedTilePositionX + packedTilePointX;
        float packedTilesPointY = packedTilePositionY + packedTilePointY;

        float packedTilesTexturePointX = packedTilesPointX / float(packedTilesTextureSize.x);
        float packedTilesTexturePointY = packedTilesPointY / float(packedTilesTextureSize.y);

        packedTilesTexturePoint = vec2(packedTilesTexturePointX, packedTilesTexturePointY);
      }
    }
  }

  if(found == true) {
    
    color = texture(u_packedTilesTexture, packedTilesTexturePoint);

    
    if(u_removeColorOptionsThreshold > 0.0f) {
      vec3 backgroundColorDiff = color.rgb - u_removeColorOptionsColor.rgb;
      float backgroundColorDistance = length(backgroundColorDiff);
      if(u_removeColor && backgroundColorDistance < u_removeColorOptionsThreshold) {
        float amount = smoothstep(u_removeColorOptionsThreshold - u_removeColorOptionsThreshold * (1.0f - u_removeColorOptionsHardness), u_removeColorOptionsThreshold, backgroundColorDistance);
        color = vec4(color.rgb * amount, amount);
      }
    }

    
    float gray = 0.21f * color.r + 0.71f * color.g + 0.07f * color.b;
    color = vec4(color.rgb * (u_saturation) + (gray * (1.0f - u_saturation)), color.a);

    
    if(u_colorize) {
      color = vec4((u_colorizeOptionsColor + color.rgb) * color.a, color.a);
    }

    
    color = vec4(color.rgb * u_opacity, color.a * u_opacity);

    
    
    if(u_distortion) {
      
      

      float trianglePointDistortion = v_trianglePointDistortion;

      
      trianglePointDistortion = floor(trianglePointDistortion * 10.0f) / 10.0f;

      switch(u_distortionOptionsdistortionMeasure) {
        case 0:
          if(trianglePointDistortion > 0.0f) {
            color = spectral_mix(color, colorRed500, trianglePointDistortion);
          } else {
            color = spectral_mix(color, colorBlue500, abs(trianglePointDistortion));
          }
          break;
        case 1:
          color = spectral_mix(color, colorGreen500, trianglePointDistortion);
          break;
        case 2:
          color = spectral_mix(color, colorYellow500, trianglePointDistortion);
          break;
        case 3:
          color = trianglePointDistortion == -1.0f ? colorRed300 : color;
          break;
        default:
          color = color;
      }
    }

    
    
    if(false) {
      color = vec4(abs(sin(v_triangleIndex)), abs(sin(v_triangleIndex + 1.0f)), abs(sin(v_triangleIndex + 2.0f)), 1);
    }

    
    if(u_grid) {
      float gridSize = 20.0f * float(u_bestScaleFactor);
      float gridWidth = 2.0f * float(u_bestScaleFactor);
      if(mod(float(resourceTrianglePointX) + gridWidth / 2.0f, gridSize) < gridWidth || mod(float(resourceTrianglePointY) + gridWidth / 2.0f, gridSize) < gridWidth) {
        color = colorBlack;
      }
    }
  }
}`;const Uw=500,jw={leading:!0,trailing:!0},Vw=50,qw={leading:!0,trailing:!0},qu=1,Wu=1,Ww=0,Xw=.7,Yw=5,lh=750;class Zw extends Gw{constructor(e,r){const i=rh(e,e.VERTEX_SHADER,Bw),s=rh(e,e.FRAGMENT_SHADER,zw),o=N_(e,i,s);super(ec.createFactory(),A_(e,o),r);M(this,"gl");M(this,"program");M(this,"previousSignificantViewport");M(this,"opacity",qu);M(this,"saturation",Wu);M(this,"renderOptions",{});M(this,"invertedRenderTransform");M(this,"lastAnimationFrameRequestId");M(this,"animating",!1);M(this,"transformationTransitionStart");M(this,"animationProgress",1);M(this,"throttledPrepareRenderInternal");M(this,"throttledChanged");this.gl=e,this.program=o,e.deleteShader(i),e.deleteShader(s),e.disable(e.DEPTH_TEST),this.invertedRenderTransform=Xg(),this.addEventListeners(),this.throttledPrepareRenderInternal=fl(this.prepareRenderInternal.bind(this),Uw,jw),this.throttledChanged=fl(this.changed.bind(this),Vw,qw)}getOpacity(){return this.opacity}setOpacity(e){this.opacity=e}resetOpacity(){this.opacity=qu}getMapOpacity(e){const r=this.warpedMapList.getWarpedMap(e);if(r)return r.opacity}setMapOpacity(e,r){const i=this.warpedMapList.getWarpedMap(e);i&&(i.opacity=Math.min(Math.max(r,0),1))}resetMapOpacity(e){const r=this.warpedMapList.getWarpedMap(e);r&&(r.opacity=qu)}getRemoveColorOptions(){return this.renderOptions.removeColorOptions}setRemoveColorOptions(e){this.renderOptions.removeColorOptions=e}resetRemoveColorOptions(){this.renderOptions.removeColorOptions=void 0}getMapRemoveColorOptions(e){const r=this.warpedMapList.getWarpedMap(e);if(r)return r.renderOptions.removeColorOptions}setMapRemoveColorOptions(e,r){const i=this.warpedMapList.getWarpedMap(e);i&&(i.renderOptions.removeColorOptions=r)}resetMapRemoveColorOptions(e){const r=this.warpedMapList.getWarpedMap(e);r&&(r.renderOptions.removeColorOptions=void 0)}getColorizeOptions(){return this.renderOptions.colorizeOptions}setColorizeOptions(e){this.renderOptions.colorizeOptions=e}resetColorizeOptions(){this.renderOptions.colorizeOptions=void 0}getMapColorizeOptions(e){const r=this.warpedMapList.getWarpedMap(e);if(r)return r.renderOptions.colorizeOptions}setMapColorizeOptions(e,r){const i=this.warpedMapList.getWarpedMap(e);i&&(i.renderOptions.colorizeOptions=r)}resetMapColorizeOptions(e){const r=this.warpedMapList.getWarpedMap(e);r&&(r.renderOptions.colorizeOptions=void 0)}getGridOptions(){return this.renderOptions.gridOptions}setGridOptions(e){this.renderOptions.gridOptions=e}resetGridOptions(){this.renderOptions.gridOptions=void 0}getMapGridOptions(e){const r=this.warpedMapList.getWarpedMap(e);if(r)return r.renderOptions.gridOptions}setMapGridOptions(e,r){const i=this.warpedMapList.getWarpedMap(e);i&&(i.renderOptions.gridOptions=r)}resetMapGridOptions(e){const r=this.warpedMapList.getWarpedMap(e);r&&(r.renderOptions.gridOptions=void 0)}getSaturation(){return this.saturation}setSaturation(e){this.saturation=e}resetSaturation(){this.saturation=Wu}getMapSaturation(e){const r=this.warpedMapList.getWarpedMap(e);if(r)return r.saturation}setMapSaturation(e,r){const i=this.warpedMapList.getWarpedMap(e);i&&(i.saturation=r)}resetMapSaturation(e){const r=this.warpedMapList.getWarpedMap(e);r&&(r.saturation=Wu)}render(e){this.viewport=e,this.loadMissingImageInfosInViewport(),this.someImageInfosInViewport()&&this.throttledPrepareRenderInternal(),this.renderInternal()}clear(){this.warpedMapList.clear(),this.mapsInViewport=new Set,this.gl.clear(this.gl.DEPTH_BUFFER_BIT|this.gl.COLOR_BUFFER_BIT),this.tileCache.clear()}dispose(){for(const e of this.warpedMapList.getWarpedMaps())this.removeEventListenersFromWebGL2WarpedMap(e),e.dispose();this.tileCache.clear(),this.tileCache.dispose(),this.removeEventListeners(),this.gl.deleteProgram(this.program)}prepareRenderInternal(){this.updateRequestedTiles(),this.updateVertexBuffers()}shouldUpdateRequestedTiles(){if(!this.viewport||this.animating)return!1;if(this.previousSignificantViewport){const e=[];for(let i=0;i<4;i++)e.push(ar(this.previousSignificantViewport.projectedGeoRectangle[i],this.viewport.projectedGeoRectangle[i])/this.viewport.projectedGeoPerViewportScale);const r=Math.max(...e);return r===0?!0:r>Yw?(this.previousSignificantViewport=this.viewport,!0):!1}else return this.previousSignificantViewport=this.viewport,!0}updateVertexBuffers(){if(this.viewport){this.invertedRenderTransform=Zg(this.viewport.projectedGeoToClipTransform);for(const e of this.mapsInViewport){const r=this.warpedMapList.getWarpedMap(e);if(!r)break;r.updateVertexBuffers(this.viewport.projectedGeoToClipTransform)}}}renderInternal(){if(!this.viewport)return;const e=Yg(this.viewport.projectedGeoToClipTransform,this.invertedRenderTransform),r=this.gl;r.viewport(0,0,r.canvas.width,r.canvas.height),r.enable(r.BLEND),r.blendFunc(r.ONE,r.ONE_MINUS_SRC_ALPHA),r.useProgram(this.program);const i=r.getUniformLocation(this.program,"u_renderTransform");r.uniformMatrix4fv(i,!1,Kg(e));const s=r.getUniformLocation(this.program,"u_animationProgress");r.uniform1f(s,this.animationProgress);for(const o of this.mapsInViewport){const a=this.warpedMapList.getWarpedMap(o);if(!a)continue;this.setRenderOptionsUniforms(this.renderOptions,a.renderOptions);const u=r.getUniformLocation(this.program,"u_opacity");r.uniform1f(u,this.opacity*a.opacity);const l=r.getUniformLocation(this.program,"u_saturation");r.uniform1f(l,this.saturation*a.saturation);const c=r.getUniformLocation(this.program,"u_distortion");if(r.uniform1f(c,a.distortionMeasure?1:0),a.distortionMeasure){const m=r.getUniformLocation(this.program,"u_distortionOptionsdistortionMeasure");r.uniform1i(m,Qf.indexOf(a.distortionMeasure))}const h=r.getUniformLocation(this.program,"u_bestScaleFactor"),f=a.bestScaleFactor;r.uniform1i(h,f);const p=r.getUniformLocation(this.program,"u_packedTilesTexture");r.uniform1i(p,0),r.activeTexture(r.TEXTURE0),r.bindTexture(r.TEXTURE_2D,a.packedTilesTexture);const d=r.getUniformLocation(this.program,"u_packedTilesPositionsTexture");r.uniform1i(d,1),r.activeTexture(r.TEXTURE1),r.bindTexture(r.TEXTURE_2D,a.packedTilesPositionsTexture);const _=r.getUniformLocation(this.program,"u_packedTilesResourcePositionsAndDimensionsTexture");r.uniform1i(_,2),r.activeTexture(r.TEXTURE2),r.bindTexture(r.TEXTURE_2D,a.packedTilesResourcePositionsAndDimensionsTexture);const w=r.getUniformLocation(this.program,"u_packedTilesScaleFactorsTexture");r.uniform1i(w,3),r.activeTexture(r.TEXTURE3),r.bindTexture(r.TEXTURE_2D,a.packedTilesScaleFactorsTexture);const y=a.vao,x=a.resourceTrianglePoints.length,g=this.gl.TRIANGLES;r.bindVertexArray(y),r.drawArrays(g,0,x)}}setRenderOptionsUniforms(e,r){var f,p,d,_,w,y,x,g,m,E,N;const i=this.gl,s={removeColorOptions:{color:((f=r.removeColorOptions)==null?void 0:f.color)||((p=e.removeColorOptions)==null?void 0:p.color),hardness:Tc((d=r.removeColorOptions)==null?void 0:d.hardness,(_=e.removeColorOptions)==null?void 0:_.hardness),threshold:Tc((w=r.removeColorOptions)==null?void 0:w.threshold,(y=e.removeColorOptions)==null?void 0:y.threshold)},colorizeOptions:{...e.colorizeOptions,...r.colorizeOptions},gridOptions:{...e.gridOptions,...r.gridOptions}},o=(x=s.removeColorOptions)==null?void 0:x.color,a=i.getUniformLocation(this.program,"u_removeColor");if(i.uniform1f(a,o?1:0),o){const b=i.getUniformLocation(this.program,"u_removeColorOptionsColor");i.uniform3fv(b,o);const S=i.getUniformLocation(this.program,"u_removeColorOptionsThreshold");i.uniform1f(S,((g=s.removeColorOptions)==null?void 0:g.threshold)||Ww);const v=i.getUniformLocation(this.program,"u_removeColorOptionsHardness");i.uniform1f(v,((m=s.removeColorOptions)==null?void 0:m.hardness)||Xw)}const u=(E=s.colorizeOptions)==null?void 0:E.color,l=i.getUniformLocation(this.program,"u_colorize");if(i.uniform1f(l,u?1:0),u){const b=i.getUniformLocation(this.program,"u_colorizeOptionsColor");i.uniform3fv(b,u)}const c=(N=s.gridOptions)==null?void 0:N.enabled,h=i.getUniformLocation(this.program,"u_grid");i.uniform1f(h,c?1:0)}startTransformationTransition(){this.lastAnimationFrameRequestId!==void 0&&cancelAnimationFrame(this.lastAnimationFrameRequestId),this.animating=!0,this.transformationTransitionStart=void 0,this.lastAnimationFrameRequestId=requestAnimationFrame(this.transformationTransitionFrame.bind(this))}transformationTransitionFrame(e){if(this.transformationTransitionStart||(this.transformationTransitionStart=e),e-this.transformationTransitionStart<lh)this.animationProgress=(e-this.transformationTransitionStart)/lh,this.renderInternal(),this.lastAnimationFrameRequestId=requestAnimationFrame(this.transformationTransitionFrame.bind(this));else{for(const r of this.warpedMapList.getWarpedMaps())r.resetTrianglePoints();this.updateVertexBuffers(),this.animating=!1,this.animationProgress=0,this.transformationTransitionStart=void 0}}changed(){this.dispatchEvent(new ct(B.CHANGED))}imageInfoLoaded(e){e instanceof ct&&this.dispatchEvent(new ct(B.IMAGEINFOLOADED))}mapTileLoaded(e){if(e instanceof ct){const{mapId:r,tileUrl:i}=e.data,s=this.tileCache.getCacheableTile(i);if(!s||!s.isCachedTile())return;const o=this.warpedMapList.getWarpedMap(r);if(!o)return;o.addCachedTileAndUpdateTextures(s)}}mapTileRemoved(e){if(e instanceof ct){const{mapId:r,tileUrl:i}=e.data,s=this.warpedMapList.getWarpedMap(r);if(!s)return;s.removeCachedTileAndUpdateTextures(i)}}warpedMapAdded(e){if(e instanceof ct){const r=e.data,i=this.warpedMapList.getWarpedMap(r);i&&this.addEventListenersToWebGL2WarpedMap(i)}}transformationChanged(e){if(e instanceof ct){const r=e.data;for(const i of this.warpedMapList.getWarpedMaps(r))this.animating&&i.mixTrianglePoints(this.animationProgress),i.updateProjectedGeoTrianglePoints(!1);this.updateVertexBuffers(),this.startTransformationTransition()}}distortionChanged(e){if(e instanceof ct){const r=e.data;for(const i of this.warpedMapList.getWarpedMaps(r))this.animating&&i.mixTrianglePoints(this.animationProgress),i.updateTrianglePointsDistortion(!1);this.updateVertexBuffers(),this.startTransformationTransition()}}addEventListenersToWebGL2WarpedMap(e){e.addEventListener(B.TEXTURESUPDATED,this.throttledChanged.bind(this))}removeEventListenersFromWebGL2WarpedMap(e){e.removeEventListener(B.TEXTURESUPDATED,this.throttledChanged.bind(this))}}const Hw="Renderer not defined. Add the layer to a map before calling this function.";function at(n){if(!n)throw new Error(Hw)}class Kw{constructor(t,e){M(this,"id","warped-map-layer");M(this,"type","custom");M(this,"renderingMode","2d");M(this,"map");M(this,"renderer");M(this,"options");t&&(this.id=t),this.options=e}onAdd(t,e){this.map=t,this.renderer=new Zw(e,this.options),this.addEventListeners()}onRemove(){this.renderer&&(this.renderer.dispose(),this.removeEventListeners())}async addGeoreferenceAnnotation(t){var r;at(this.renderer);const e=await this.renderer.warpedMapList.addGeoreferenceAnnotation(t);return(r=this.map)==null||r.triggerRepaint(),e}async removeGeoreferenceAnnotation(t){var r;at(this.renderer);const e=await this.renderer.warpedMapList.removeGeoreferenceAnnotation(t);return(r=this.map)==null||r.triggerRepaint(),e}async addGeoreferenceAnnotationByUrl(t){const e=await fetch(t).then(r=>r.json());return this.addGeoreferenceAnnotation(e)}async removeGeoreferenceAnnotationByUrl(t){const e=await fetch(t).then(r=>r.json());return this.removeGeoreferenceAnnotation(e)}async addGeoreferencedMap(t){var r;at(this.renderer);const e=this.renderer.warpedMapList.addGeoreferencedMap(t);return(r=this.map)==null||r.triggerRepaint(),e}async removeGeoreferencedMap(t){var r;at(this.renderer);const e=this.renderer.warpedMapList.removeGeoreferencedMap(t);return(r=this.map)==null||r.triggerRepaint(),e}getWarpedMapList(){return at(this.renderer),this.renderer.warpedMapList}getWarpedMap(t){return at(this.renderer),this.renderer.warpedMapList.getWarpedMap(t)}showMap(t){var e;at(this.renderer),this.renderer.warpedMapList.showMaps([t]),(e=this.map)==null||e.triggerRepaint()}showMaps(t){var e;at(this.renderer),this.renderer.warpedMapList.showMaps(t),(e=this.map)==null||e.triggerRepaint()}hideMap(t){var e;at(this.renderer),this.renderer.warpedMapList.hideMaps([t]),(e=this.map)==null||e.triggerRepaint()}hideMaps(t){var e;at(this.renderer),this.renderer.warpedMapList.hideMaps(t),(e=this.map)==null||e.triggerRepaint()}isMapVisible(t){var e;return at(this.renderer),(e=this.renderer.warpedMapList.getWarpedMap(t))==null?void 0:e.visible}setMapResourceMask(t,e){var r;at(this.renderer),this.renderer.warpedMapList.setMapResourceMask(t,e),(r=this.map)==null||r.triggerRepaint()}setMapsTransformationType(t,e){var r;at(this.renderer),this.renderer.warpedMapList.setMapsTransformationType(t,e),(r=this.map)==null||r.triggerRepaint()}setMapsDistortionMeasure(t,e){var r;at(this.renderer),this.renderer.warpedMapList.setMapsDistortionMeasure(t,e),(r=this.map)==null||r.triggerRepaint()}getBounds(){at(this.renderer);const t=this.renderer.warpedMapList.getBbox();if(t)return[[t[0],t[1]],[t[2],t[3]]]}bringMapsToFront(t){var e;at(this.renderer),this.renderer.warpedMapList.bringMapsToFront(t),(e=this.map)==null||e.triggerRepaint()}sendMapsToBack(t){var e;at(this.renderer),this.renderer.warpedMapList.sendMapsToBack(t),(e=this.map)==null||e.triggerRepaint()}bringMapsForward(t){var e;at(this.renderer),this.renderer.warpedMapList.bringMapsForward(t),(e=this.map)==null||e.triggerRepaint()}sendMapsBackward(t){var e;at(this.renderer),this.renderer.warpedMapList.sendMapsBackward(t),(e=this.map)==null||e.triggerRepaint()}getMapZIndex(t){return at(this.renderer),this.renderer.warpedMapList.getMapZIndex(t)}setImageInformations(t){at(this.renderer),this.renderer.warpedMapList.setImageInformations(t)}getOpacity(){return at(this.renderer),this.renderer.getOpacity()}setOpacity(t){var e;at(this.renderer),this.renderer.setOpacity(t),(e=this.map)==null||e.triggerRepaint()}resetOpacity(){var t;at(this.renderer),this.renderer.resetOpacity(),(t=this.map)==null||t.triggerRepaint()}getMapOpacity(t){return at(this.renderer),this.renderer.getMapOpacity(t)}setMapOpacity(t,e){var r;at(this.renderer),this.renderer.setMapOpacity(t,e),(r=this.map)==null||r.triggerRepaint()}resetMapOpacity(t){var e;at(this.renderer),this.renderer.resetMapOpacity(t),(e=this.map)==null||e.triggerRepaint()}setSaturation(t){var e;at(this.renderer),this.renderer.setSaturation(t),(e=this.map)==null||e.triggerRepaint()}resetSaturation(){var t;at(this.renderer),this.renderer.resetSaturation(),(t=this.map)==null||t.triggerRepaint()}setMapSaturation(t,e){var r;at(this.renderer),this.renderer.setMapSaturation(t,e),(r=this.map)==null||r.triggerRepaint()}resetMapSaturation(t){var e;at(this.renderer),this.renderer.resetMapSaturation(t),(e=this.map)==null||e.triggerRepaint()}setRemoveColor(t){var r;at(this.renderer);const e=t.hexColor?ra(t.hexColor):void 0;this.renderer.setRemoveColorOptions({color:e,threshold:t.threshold,hardness:t.hardness}),(r=this.map)==null||r.triggerRepaint()}resetRemoveColor(){var t;at(this.renderer),this.renderer.resetRemoveColorOptions(),(t=this.map)==null||t.triggerRepaint()}setMapRemoveColor(t,e){var i;at(this.renderer);const r=e.hexColor?ra(e.hexColor):void 0;this.renderer.setMapRemoveColorOptions(t,{color:r,threshold:e.threshold,hardness:e.hardness}),(i=this.map)==null||i.triggerRepaint()}resetMapRemoveColor(t){at(this.renderer),this.renderer.resetMapRemoveColorOptions(t)}setColorize(t){var r;at(this.renderer);const e=ra(t);e&&(this.renderer.setColorizeOptions({color:e}),(r=this.map)==null||r.triggerRepaint())}resetColorize(){var t;at(this.renderer),this.renderer.resetColorizeOptions(),(t=this.map)==null||t.triggerRepaint()}setMapColorize(t,e){var i;at(this.renderer);const r=ra(e);r&&(this.renderer.setMapColorizeOptions(t,{color:r}),(i=this.map)==null||i.triggerRepaint())}resetMapColorize(t){var e;at(this.renderer),this.renderer.resetMapColorizeOptions(t),(e=this.map)==null||e.triggerRepaint()}clear(){var t;at(this.renderer),this.renderer.clear(),(t=this.map)==null||t.triggerRepaint()}preparerender(){}render(){if(!this.map||!this.renderer)return;const t=this.map.getCanvas(),e=[t.width/window.devicePixelRatio,t.height/window.devicePixelRatio],r=this.map.getCenter(),i=Yi([r.lng,r.lat]),s=this.map.unproject([0,e[1]]),o=this.map.unproject([e[0],e[1]]),a=this.map.unproject([e[0],0]),u=this.map.unproject([0,0]),l=Yi([s.lng,s.lat]),c=Yi([o.lng,o.lat]),h=Yi([a.lng,a.lat]),f=Yi([u.lng,u.lat]),p=$u([l,c,h,f]),d=Ra(p,e),_=-(this.map.getBearing()/180)*Math.PI,w=new La(e,i,d,_,window.devicePixelRatio);this.renderer.render(w)}addEventListeners(){this.renderer&&(this.renderer.addEventListener(B.CHANGED,this.render.bind(this)),this.renderer.addEventListener(B.IMAGEINFOLOADED,this.render.bind(this)),this.renderer.addEventListener(B.WARPEDMAPENTER,this.passWarpedMapEvent.bind(this)),this.renderer.addEventListener(B.WARPEDMAPLEAVE,this.passWarpedMapEvent.bind(this)),this.renderer.tileCache.addEventListener(B.FIRSTMAPTILELOADED,this.passWarpedMapEvent.bind(this)),this.renderer.tileCache.addEventListener(B.ALLREQUESTEDTILESLOADED,this.passWarpedMapEvent.bind(this)),this.renderer.warpedMapList.addEventListener(B.GEOREFERENCEANNOTATIONADDED,this.passWarpedMapEvent.bind(this)),this.renderer.warpedMapList.addEventListener(B.WARPEDMAPADDED,this.passWarpedMapEvent.bind(this)),this.renderer.warpedMapList.addEventListener(B.WARPEDMAPREMOVED,this.passWarpedMapEvent.bind(this)),this.renderer.warpedMapList.addEventListener(B.VISIBILITYCHANGED,this.render.bind(this)),this.renderer.warpedMapList.addEventListener(B.CLEARED,this.render.bind(this)))}removeEventListeners(){this.renderer&&(this.renderer.removeEventListener(B.CHANGED,this.render.bind(this)),this.renderer.removeEventListener(B.IMAGEINFOLOADED,this.render.bind(this)),this.renderer.removeEventListener(B.WARPEDMAPENTER,this.passWarpedMapEvent.bind(this)),this.renderer.removeEventListener(B.WARPEDMAPLEAVE,this.passWarpedMapEvent.bind(this)),this.renderer.tileCache.removeEventListener(B.FIRSTMAPTILELOADED,this.passWarpedMapEvent.bind(this)),this.renderer.tileCache.removeEventListener(B.ALLREQUESTEDTILESLOADED,this.passWarpedMapEvent.bind(this)),this.renderer.warpedMapList.removeEventListener(B.GEOREFERENCEANNOTATIONADDED,this.passWarpedMapEvent.bind(this)),this.renderer.warpedMapList.removeEventListener(B.WARPEDMAPADDED,this.passWarpedMapEvent.bind(this)),this.renderer.warpedMapList.removeEventListener(B.WARPEDMAPREMOVED,this.passWarpedMapEvent.bind(this)),this.renderer.warpedMapList.removeEventListener(B.VISIBILITYCHANGED,this.render.bind(this)),this.renderer.warpedMapList.removeEventListener(B.CLEARED,this.render.bind(this)))}passWarpedMapEvent(t){t instanceof ct&&this.map&&this.map.fire(t.type,t.data)}}const Jw=-90,Qw=90,$w=-180,tE=180,eE=(n,t,e={})=>{const r=new Kw(t);n.addLayer(r),e.url?r.addGeoreferenceAnnotationByUrl(e.url):e.manifest&&r.addGeoreferenceAnnotation(e.manifest),e.opacity&&r.setOpacity(e.opacity)},rE=(n,t=null)=>{const e=Ks(n);if(!Dp(e))return null;const r=tg(e);let i;return t?i=qg(r,t,{units:"miles"}):i=r,Ks(i)},nE=(n,t)=>n&&n.removeLayer(t),Dp=n=>rc.every(n,rc.isFinite),iE=n=>{let t=!1;if(n){const[e,r]=n;t=e>=Jw&&e<=Qw&&r>=$w&&r<=tE}return t},uE={addGeoreferenceLayer:eE,getBoundingBox:rE,removeLayer:nE,validateBoundingBox:Dp,validateCoordinates:iE};export{uE as M};
