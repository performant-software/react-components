import{o as z,h as E,r as O,b as k,z as B,j as N,u as T,k as U,s as A,p as S,F,l as Z}from"./peripleo-maplibre.es40-DsRCT4cu.js";import{r as i,e as j}from"./iframe-Bo-cahqR.js";var D=typeof document<"u",J=function(){},w=D?i.useLayoutEffect:J;const V={...j},_=V.useInsertionEffect,q=_||(e=>e());function H(e){const t=i.useRef(()=>{});return q(()=>{t.current=e}),i.useCallback(function(){for(var l=arguments.length,n=new Array(l),o=0;o<l;o++)n[o]=arguments[o];return t.current==null?void 0:t.current(...n)},[])}const K={...j};let P=!1,X=0;const C=()=>"floating-ui-"+Math.random().toString(36).slice(2,6)+X++;function Y(){const[e,t]=i.useState(()=>P?C():void 0);return w(()=>{e==null&&t(C())},[]),i.useEffect(()=>{P=!0},[]),e}const $=K.useId,G=$||Y;function Q(){const e=new Map;return{emit(t,l){var n;(n=e.get(t))==null||n.forEach(o=>o(l))},on(t,l){e.has(t)||e.set(t,new Set),e.get(t).add(l)},off(t,l){var n;(n=e.get(t))==null||n.delete(l)}}}const W=i.createContext(null),ee=i.createContext(null),te=()=>{var e;return((e=i.useContext(W))==null?void 0:e.id)||null},ne=()=>i.useContext(ee);function re(e){const{open:t=!1,onOpenChange:l,elements:n}=e,o=G(),f=i.useRef({}),[d]=i.useState(()=>Q()),r=te()!=null,[p,c]=i.useState(n.reference),a=H((g,v,m)=>{f.current.openEvent=g?v:void 0,d.emit("openchange",{open:g,event:v,reason:m,nested:r}),l?.(g,v,m)}),y=i.useMemo(()=>({setPositionReference:c}),[]),s=i.useMemo(()=>({reference:p||n.reference||null,floating:n.floating||null,domReference:n.reference}),[p,n.reference,n.floating]);return i.useMemo(()=>({dataRef:f,open:t,onOpenChange:a,elements:s,events:d,floatingId:o,refs:y}),[t,a,s,d,o,y])}function ie(e){e===void 0&&(e={});const{nodeId:t}=e,l=re({...e,elements:{reference:null,floating:null,...e.elements}}),n=e.rootContext||l,o=n.elements,[f,d]=i.useState(null),[r,p]=i.useState(null),c=o?.domReference||f,a=i.useRef(null),y=ne();w(()=>{c&&(a.current=c)},[c]);const s=z({...e,elements:{...o,...r&&{reference:r}}}),g=i.useCallback(u=>{const R=E(u)?{getBoundingClientRect:()=>u.getBoundingClientRect(),getClientRects:()=>u.getClientRects(),contextElement:u}:u;p(R),s.refs.setReference(R)},[s.refs]),v=i.useCallback(u=>{(E(u)||u===null)&&(a.current=u,d(u)),(E(s.refs.reference.current)||s.refs.reference.current===null||u!==null&&!E(u))&&s.refs.setReference(u)},[s.refs]),m=i.useMemo(()=>({...s.refs,setReference:v,setPositionReference:g,domReference:a}),[s.refs,v,g]),h=i.useMemo(()=>({...s.elements,domReference:c}),[s.elements,c]),b=i.useMemo(()=>({...s,...n,refs:m,elements:h,nodeId:t}),[s,m,h,t,n]);return w(()=>{n.dataRef.current.floatingContext=b;const u=y?.nodesRef.current.find(R=>R.id===t);u&&(u.context=b)}),i.useMemo(()=>({...s,context:b,refs:m,elements:h}),[s,m,h,b])}const le=e=>{var t,l;const n=O(),o=i.useMemo(()=>(!(n!=null&&n.mapFeature)||!e.layerId||(Array.isArray(e.layerId)?e.layerId:[e.layerId]).includes(n.mapFeature.layer.id))&&n,[n,e.layerId]),f=!!((t=o?.mapEvent)!=null&&t.originalEvent),d=e.placement||"bottom-start",{refs:r,floatingStyles:p}=ie({open:f,placement:d,middleware:[N(10),T({crossAxis:!0}),U({crossAxis:!0,padding:{right:5,left:5,top:10,bottom:10}})],whileElementsMounted:B}),c=i.useCallback(a=>{const y=a.clientX,s=a.clientY;r.setPositionReference({getBoundingClientRect(){return{width:0,height:0,x:y,y:s,top:s,left:y,right:y,bottom:s}}})},[r]);return i.useEffect(()=>(window.addEventListener("pointermove",c),()=>{window.removeEventListener("pointermove",c)}),[c]),((l=o?.mapEvent)==null?void 0:l.originalEvent)&&k.jsx("div",{ref:r.setFloating,style:p,className:"p6o-hover-tooltip",children:e.tooltip(n)})},M={type:"circle",paint:{"circle-radius":["interpolate",["linear"],["number",["get","point_count"],1],0,4,10,14],"circle-stroke-width":1,"circle-color":["case",["boolean",["feature-state","hover"],!1],"#3b62ff","#ff623b"],"circle-stroke-color":"#8d260c"}},I={type:"fill",paint:{"fill-color":"#ff623b","fill-opacity":.2}},L={type:"line",paint:{"line-color":"#ff623b","line-opacity":.6}},x=(e,t,l)=>{e&&Object.entries(l.paint).forEach(([n,o])=>e.setPaintProperty(t,n,o))},de=e=>{const{id:t,data:l}=e,n=e.visible===void 0?!0:e.visible,o=e.fillStyle||I,f=e.strokeStyle||L,d=e.pointStyle||M,r=A(),[p,c]=i.useState();return i.useEffect(()=>{if(r){const a=new Set(r.getStyle().layers.map(y=>y.id));a.has(`layer-${e.id}-fill`)&&r.setLayoutProperty(`layer-${e.id}-fill`,"visibility",n?"visible":"none"),a.has(`layer-${e.id}-line`)&&r.setLayoutProperty(`layer-${e.id}-line`,"visibility",n?"visible":"none"),a.has(`layer-${e.id}-point`)&&r.setLayoutProperty(`layer-${e.id}-point`,"visibility",n?"visible":"none")}},[n,r]),i.useEffect(()=>{if(!r)return;const a=`source-${t}`;return r.addSource(a,{type:"geojson",data:l,...e.cluster&&{cluster:!0},...e.clusterRadius!==void 0&&{clusterRadius:e.clusterRadius},...e.clusterMaxZoom!==void 0&&{clusterMaxZoom:e.clusterMaxZoom},...e.clusterMinPoints!==void 0&&{clusterMinPoints:e.clusterMinPoints},...e.clusterProperties!==void 0&&{clusterProperties:e.clusterProperties}}),e.onLoad&&r.once("idle",()=>e.onLoad()),e.cluster||(r.addLayer({id:`layer-${t}-fill`,...o,source:`source-${t}`,filter:["!=","$type","Point"],layout:{visibility:n?"visible":"none"},metadata:{interactive:e.interactive}}),r.addLayer({id:`layer-${t}-line`,...f,source:`source-${t}`,filter:["!=","$type","Point"],layout:{visibility:n?"visible":"none"}})),r.addLayer({id:`layer-${t}-point`,...d,filter:["==","$type","Point"],source:`source-${t}`,layout:{visibility:n?"visible":"none"},metadata:{interactive:e.interactive}}),c(a),setTimeout(()=>r.moveLayer(`layer-${t}-point`),10),()=>{S(r,`layer-${t}-point`),S(r,`layer-${t}-line`),S(r,`layer-${t}-fill`),F(r,a)}},[r]),i.useEffect(()=>{p&&r.getSource(p).setData(l)},[p,l]),i.useEffect(()=>{e.cluster||x(r,`layer-${t}-fill`,e.fillStyle||I)},[e.fillStyle,e.cluster]),i.useEffect(()=>{e.cluster||x(r,`layer-${t}-line`,e.strokeStyle||L)},[e.strokeStyle,e.cluster]),i.useEffect(()=>{x(r,`layer-${t}-point`,e.pointStyle||M)},[e.pointStyle]),e.tooltip?k.jsx(le,{layerId:[`layer-${t}-point`,`layer-${t}-fill`],tooltip:e.tooltip}):null},oe=(e,t,l,n)=>({width:e,height:e,data:new Uint8Array(e*e*4),startTime:performance.now(),onAdd:function(){const o=document.createElement("canvas");o.width=this.width,o.height=this.height,this.context=o.getContext("2d",{willReadFrequently:!0})},render:function(){const o=(performance.now()-this.startTime)%l/l,f=e/2*.2,d=e/2*.7*o+f,r=this.context;return r.clearRect(0,0,this.width,this.height),r.beginPath(),r.arc(this.width/2,this.height/2,d,0,Math.PI*2),r.fillStyle=`rgba(${t[0]}, ${t[1]}, ${t[2]}, ${1.5*(1-o)})`,r.fill(),this.data=r.getImageData(0,0,this.width,this.height).data,n.triggerRepaint(),!0}}),se="useandom-26T198340PX75pxJACKVERYMINDBUSHWOLF_GQZbfghjklqvwyzrict";let ae=(e=21)=>{let t="",l=crypto.getRandomValues(new Uint8Array(e|=0));for(;e--;)t+=se[l[e]&63];return t};const ue=e=>{const t=Z(),l=i.useMemo(()=>`pulse-${ae()}`,[t,JSON.stringify(e)]);return i.useEffect(()=>{if(!t)return;const n=typeof e=="number"?e:e.size,o=typeof e=="number"?[246,112,86]:e.rgb||[246,112,86],f=typeof e=="number"?1e3:e.duration||1e3;return t.addImage(l,oe(n*2,o,f,t),{pixelRatio:2}),()=>{t.removeImage(l)}},[t,JSON.stringify(e),l]),{type:"symbol",layout:{"icon-image":l}}},ye=e=>{const{id:t,data:l}=e,n=A(),o=ue(e.size||100);return i.useEffect(()=>{if(n)return n.addSource(`source-${t}-pulse`,{type:"geojson",data:l}),n.addLayer({id:`layer-${t}-pulse`,...o,filter:["==","$type","Point"],source:`source-${t}-pulse`}),()=>{S(n,`layer-${t}-pulse`),F(n,`source-${t}-pulse`)}},[n,l]),null};export{de as F,ye as g};
