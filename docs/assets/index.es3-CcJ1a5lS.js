import{r as e,a as r,m}from"./index.es34-DzssmlbK.js";import{r as p}from"./index-C0dDX-lL.js";import{J as h}from"./index.es32--1Rr09Z_.js";const c="can't be blank",u="has already been taken",S=d=>class extends p.Component{constructor(t){super(t);const i=e.defaults(t.item||{},t.defaults||{});this.state={item:i,loading:!1,originalItem:i,saving:!1,validationErrors:[]}}componentDidMount(){this.props.onInitialize&&this.props.item&&this.props.item.id&&this.setState({loading:!0},()=>{this.props.onInitialize&&this.props.item&&this.props.onInitialize(this.props.item.id).then(t=>this.setState({item:t,originalItem:t,loading:!1}))})}componentDidUpdate(t){t.item!==this.props.item&&this.setState({item:this.props.item,originalItem:this.props.item})}componentWillUnmount(){this.onSetState({saving:!1})}isChild(t,i){return t.uid&&i.uid&&t.uid===i.uid||t.id&&i.id&&t.id===i.id}isRequired(t){return this.props.required&&e.contains(this.props.required,t)}isError(t){return e.has(this.state.validationErrors,t)}onClearValidationError(...t){this.setState(i=>({validationErrors:e.omit(i.validationErrors,t)}))}onClose(){this.props.onClose()}onCreateChildAssociation(t,i){this.setState(s=>({item:{...s.item,[t]:[...s.item[t]||[],i]}}))}onDeleteChildAssociation(t,i){return i.id?this.onMarkChildAssociationForDelete(t,i):this.onRemoveChildAssociation(t,i)}onError({response:{data:{errors:t={}},status:i}}){const s={};e.each(Object.keys(t),o=>{const n=t[o],l=this.state.item[o];e.each(n,a=>{a===u?e.extend(s,{[o]:r.t("EditContainer.errors.unique",{key:o,value:l})}):a===c?e.extend(s,{[o]:r.t("EditContainer.errors.required",{key:o})}):this.props.resolveValidationError&&e.extend(s,this.props.resolveValidationError({key:o,error:a,status:i,item:this.state.item}))})}),i===400&&e.isEmpty(s)?e.extend(s,{error:r.t("EditContainer.errors.general")}):i===500&&e.isEmpty(s)&&e.extend(s,{error:r.t("EditContainer.errors.system")}),this.setState({saving:!1,validationErrors:s})}onMarkChildAssociationForDelete(t,i){this.setState(s=>({item:{...s.item,[t]:e.map(s.item[t]||[],o=>o.id===i.id?{...o,_destroy:!0}:o)}}))}onMultiAddChildAssociations(t,i){const s=this.state.item[t];e.each(i,this.onSaveChildAssociation.bind(this,t));const o=e.filter(s,n=>!e.find(i,this.isChild.bind(this,n)));e.each(o,this.onDeleteChildAssociation.bind(this,t))}onRemoveChildAssociation(t,i){this.setState(s=>({item:{...s.item,[t]:e.filter(s.item[t]||[],o=>!(this.isChild(o,i)||h.isEqual(o,i)))}}))}onReset(){const t=this.props.defaults||{};this.setState({item:t,originalItem:t})}onSave(){this.validateForm()&&this.setState({saving:!0},()=>{this.props.onSave(this.state.item).catch(this.onError.bind(this)).finally(()=>this.setState({saving:!1}))})}onSaveChildAssociation(t,i){const s=this.state.item[t]||[];return e.find(s,this.isChild.bind(this,i))?this.onUpdateChildAssociation(t,i):this.onCreateChildAssociation(t,i)}onUpdateChildAssociation(t,i){this.setState(s=>({item:{...s.item,[t]:e.map(s.item[t]||[],o=>this.isChild(i,o)?i:o)}}))}onAssociationInputChange(t,i,s={}){this.setState(o=>({item:{...o.item,[t]:s.id||"",[i]:s||{}},validationErrors:e.omit(o.validationErrors,t)}))}onCheckboxInputChange(t){this.setState(i=>({item:{...i.item,[t]:!i.item[t]}}))}onSetState(t){this.setState(i=>({item:{...i.item,...t},validationErrors:e.omit(i.validationErrors,e.keys(t))}))}onTextInputChange(t,i,{value:s}){this.setState(o=>({item:{...o.item,[t]:s},validationErrors:e.omit(o.validationErrors,t)}))}render(){return m.jsx(d,{...this.props,dirty:!!(this.state.item.id&&!h.isEqual(this.state.item,this.state.originalItem)),errors:e.values(this.state.validationErrors),isError:this.isError.bind(this),isRequired:this.isRequired.bind(this),item:this.state.item,loading:this.state.loading,onAssociationInputChange:this.onAssociationInputChange.bind(this),onCheckboxInputChange:this.onCheckboxInputChange.bind(this),onClearValidationError:this.onClearValidationError.bind(this),onDeleteChildAssociation:this.onDeleteChildAssociation.bind(this),onMultiAddChildAssociations:this.onMultiAddChildAssociations.bind(this),onReset:this.onReset.bind(this),onSave:this.onSave.bind(this),onSaveChildAssociation:this.onSaveChildAssociation.bind(this),onTextInputChange:this.onTextInputChange.bind(this),onSetState:this.onSetState.bind(this),saving:this.state.saving})}validateForm(){const t=[];this.props.validate&&e.extend(t,this.props.validate(this.state.item));const i=this.props.required||[];return e.each(i,s=>{const o=this.state.item[s];let n;e.isNumber(o)?n=e.isEmpty(o.toString()):n=e.isEmpty(o),n&&e.extend(t,{[s]:r.t("EditContainer.errors.required",{key:s})})}),this.setState({validationErrors:t}),e.keys(t).length===0}};export{S as H};
