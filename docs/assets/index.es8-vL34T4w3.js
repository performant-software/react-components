import{r as rn,R as Bx}from"./index-C0dDX-lL.js";import{m as ON,f as RN,g as FN}from"./peripleo-maplibre.es26-D4QoMT78.js";import{r as $I}from"./index-DOYXiIEK.js";import{_ as kN}from"./iframe-CDM-47y-.js";var zg=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function VI(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}var UI={exports:{}};(function(t,e){(function(n,r){t.exports=r()})(zg,function(){var n=function(E,A){var X={drag:[],click:[],mousemove:[],mousedown:[],mouseup:[],mouseout:[],keydown:[],keyup:[],touchstart:[],touchmove:[],touchend:[],tap:[]},at={on:function(_t,Ct,te){if(X[_t]===void 0)throw new Error("Invalid event type: "+_t);X[_t].push({selector:Ct,fn:te})},render:function(_t){A.store.featureChanged(_t)}},yt=function(_t,Ct){for(var te=X[_t],ae=te.length;ae--;){var xe=te[ae];if(xe.selector(Ct)){xe.fn.call(at,Ct)||A.store.render(),A.ui.updateMapClasses();break}}};return E.start.call(at),{render:E.render,stop:function(){E.stop&&E.stop()},trash:function(){E.trash&&(E.trash(),A.store.render())},combineFeatures:function(){E.combineFeatures&&E.combineFeatures()},uncombineFeatures:function(){E.uncombineFeatures&&E.uncombineFeatures()},drag:function(_t){yt("drag",_t)},click:function(_t){yt("click",_t)},mousemove:function(_t){yt("mousemove",_t)},mousedown:function(_t){yt("mousedown",_t)},mouseup:function(_t){yt("mouseup",_t)},mouseout:function(_t){yt("mouseout",_t)},keydown:function(_t){yt("keydown",_t)},keyup:function(_t){yt("keyup",_t)},touchstart:function(_t){yt("touchstart",_t)},touchmove:function(_t){yt("touchmove",_t)},touchend:function(_t){yt("touchend",_t)},tap:function(_t){yt("tap",_t)}}};function r(E){return E&&E.__esModule&&Object.prototype.hasOwnProperty.call(E,"default")?E.default:E}function i(E){if(E.__esModule)return E;var A=E.default;if(typeof A=="function"){var X=function at(){if(this instanceof at){var yt=[null];yt.push.apply(yt,arguments);var _t=Function.bind.apply(A,yt);return new _t}return A.apply(this,arguments)};X.prototype=A.prototype}else X={};return Object.defineProperty(X,"__esModule",{value:!0}),Object.keys(E).forEach(function(at){var yt=Object.getOwnPropertyDescriptor(E,at);Object.defineProperty(X,at,yt.get?yt:{enumerable:!0,get:function(){return E[at]}})}),X}var a={},h={RADIUS:6378137,FLATTENING:1/298.257223563,POLAR_RADIUS:63567523142e-4},u=h;function _(E){var A=0;if(E&&E.length>0){A+=Math.abs(w(E[0]));for(var X=1;X<E.length;X++)A-=Math.abs(w(E[X]))}return A}function w(E){var A,X,at,yt,_t,Ct,te=0,ae=E.length;if(ae>2){for(Ct=0;Ct<ae;Ct++)Ct===ae-2?(at=ae-2,yt=ae-1,_t=0):Ct===ae-1?(at=ae-1,yt=0,_t=1):(at=Ct,yt=Ct+1,_t=Ct+2),A=E[at],X=E[yt],te+=(C(E[_t][0])-C(A[0]))*Math.sin(C(X[1]));te=te*u.RADIUS*u.RADIUS/2}return te}function C(E){return E*Math.PI/180}a.geometry=function E(A){var X,at=0;switch(A.type){case"Polygon":return _(A.coordinates);case"MultiPolygon":for(X=0;X<A.coordinates.length;X++)at+=_(A.coordinates[X]);return at;case"Point":case"MultiPoint":case"LineString":case"MultiLineString":return 0;case"GeometryCollection":for(X=0;X<A.geometries.length;X++)at+=E(A.geometries[X]);return at}},a.ring=w;var P={CONTROL_BASE:"mapboxgl-ctrl",CONTROL_PREFIX:"mapboxgl-ctrl-",CONTROL_BUTTON:"mapbox-gl-draw_ctrl-draw-btn",CONTROL_BUTTON_LINE:"mapbox-gl-draw_line",CONTROL_BUTTON_POLYGON:"mapbox-gl-draw_polygon",CONTROL_BUTTON_POINT:"mapbox-gl-draw_point",CONTROL_BUTTON_TRASH:"mapbox-gl-draw_trash",CONTROL_BUTTON_COMBINE_FEATURES:"mapbox-gl-draw_combine",CONTROL_BUTTON_UNCOMBINE_FEATURES:"mapbox-gl-draw_uncombine",CONTROL_GROUP:"mapboxgl-ctrl-group",ATTRIBUTION:"mapboxgl-ctrl-attrib",ACTIVE_BUTTON:"active",BOX_SELECT:"mapbox-gl-draw_boxselect"},D={HOT:"mapbox-gl-draw-hot",COLD:"mapbox-gl-draw-cold"},B={ADD:"add",MOVE:"move",DRAG:"drag",POINTER:"pointer",NONE:"none"},$={POLYGON:"polygon",LINE:"line_string",POINT:"point"},Z={FEATURE:"Feature",POLYGON:"Polygon",LINE_STRING:"LineString",POINT:"Point",FEATURE_COLLECTION:"FeatureCollection",MULTI_PREFIX:"Multi",MULTI_POINT:"MultiPoint",MULTI_LINE_STRING:"MultiLineString",MULTI_POLYGON:"MultiPolygon"},W={DRAW_LINE_STRING:"draw_line_string",DRAW_POLYGON:"draw_polygon",DRAW_POINT:"draw_point",SIMPLE_SELECT:"simple_select",DIRECT_SELECT:"direct_select",STATIC:"static"},rt={CREATE:"draw.create",DELETE:"draw.delete",UPDATE:"draw.update",SELECTION_CHANGE:"draw.selectionchange",MODE_CHANGE:"draw.modechange",ACTIONABLE:"draw.actionable",RENDER:"draw.render",COMBINE_FEATURES:"draw.combine",UNCOMBINE_FEATURES:"draw.uncombine"},ct={MOVE:"move",CHANGE_COORDINATES:"change_coordinates"},pt={FEATURE:"feature",MIDPOINT:"midpoint",VERTEX:"vertex"},gt={ACTIVE:"true",INACTIVE:"false"},Ut=["scrollZoom","boxZoom","dragRotate","dragPan","keyboard","doubleClickZoom","touchZoomRotate"],zt=-85,Ot=Object.freeze({__proto__:null,classes:P,sources:D,cursors:B,types:$,geojsonTypes:Z,modes:W,events:rt,updateActions:ct,meta:pt,activeStates:gt,interactions:Ut,LAT_MIN:-90,LAT_RENDERED_MIN:zt,LAT_MAX:90,LAT_RENDERED_MAX:85,LNG_MIN:-270,LNG_MAX:270}),At={Point:0,LineString:1,MultiLineString:1,Polygon:2};function Rt(E,A){var X=At[E.geometry.type]-At[A.geometry.type];return X===0&&E.geometry.type===Z.POLYGON?E.area-A.area:X}function Yt(E){return E.map(function(A){return A.geometry.type===Z.POLYGON&&(A.area=a.geometry({type:Z.FEATURE,property:{},geometry:A.geometry})),A}).sort(Rt).map(function(A){return delete A.area,A})}function be(E,A){return A===void 0&&(A=0),[[E.point.x-A,E.point.y-A],[E.point.x+A,E.point.y+A]]}function Kt(E){if(this._items={},this._nums={},this._length=E?E.length:0,E)for(var A=0,X=E.length;A<X;A++)this.add(E[A]),E[A]!==void 0&&(typeof E[A]=="string"?this._items[E[A]]=A:this._nums[E[A]]=A)}Kt.prototype.add=function(E){return this.has(E)||(this._length++,typeof E=="string"?this._items[E]=this._length:this._nums[E]=this._length),this},Kt.prototype.delete=function(E){return this.has(E)===!1||(this._length--,delete this._items[E],delete this._nums[E]),this},Kt.prototype.has=function(E){return(typeof E=="string"||typeof E=="number")&&(this._items[E]!==void 0||this._nums[E]!==void 0)},Kt.prototype.values=function(){var E=this,A=[];return Object.keys(this._items).forEach(function(X){A.push({k:X,v:E._items[X]})}),Object.keys(this._nums).forEach(function(X){A.push({k:JSON.parse(X),v:E._nums[X]})}),A.sort(function(X,at){return X.v-at.v}).map(function(X){return X.k})},Kt.prototype.clear=function(){return this._length=0,this._items={},this._nums={},this};var Ke=[pt.FEATURE,pt.MIDPOINT,pt.VERTEX],vt={click:function(E,A,X){return Qt(E,A,X,X.options.clickBuffer)},touch:function(E,A,X){return Qt(E,A,X,X.options.touchBuffer)}};function Qt(E,A,X,at){if(X.map===null)return[];var yt=E?be(E,at):A,_t={};X.options.styles&&(_t.layers=X.options.styles.map(function(xe){return xe.id}).filter(function(xe){return X.map.getLayer(xe)!=null}));var Ct=X.map.queryRenderedFeatures(yt,_t).filter(function(xe){return Ke.indexOf(xe.properties.meta)!==-1}),te=new Kt,ae=[];return Ct.forEach(function(xe){var we=xe.properties.id;te.has(we)||(te.add(we),ae.push(xe))}),Yt(ae)}function Te(E,A){var X=vt.click(E,null,A),at={mouse:B.NONE};return X[0]&&(at.mouse=X[0].properties.active===gt.ACTIVE?B.MOVE:B.POINTER,at.feature=X[0].properties.meta),A.events.currentModeName().indexOf("draw")!==-1&&(at.mouse=B.ADD),A.ui.queueMapClasses(at),A.ui.updateMapClasses(),X[0]}function Ge(E,A){var X=E.x-A.x,at=E.y-A.y;return Math.sqrt(X*X+at*at)}function gn(E,A,X){X===void 0&&(X={});var at=X.fineTolerance!=null?X.fineTolerance:4,yt=X.grossTolerance!=null?X.grossTolerance:12,_t=X.interval!=null?X.interval:500;E.point=E.point||A.point,E.time=E.time||A.time;var Ct=Ge(E.point,A.point);return Ct<at||Ct<yt&&A.time-E.time<_t}function xn(E,A,X){X===void 0&&(X={});var at=X.tolerance!=null?X.tolerance:25,yt=X.interval!=null?X.interval:250;return E.point=E.point||A.point,E.time=E.time||A.time,Ge(E.point,A.point)<at&&A.time-E.time<yt}var ei={exports:{}},jn=ei.exports=function(E,A){if(A||(A=16),E===void 0&&(E=128),E<=0)return"0";for(var X=Math.log(Math.pow(2,E))/Math.log(A),at=2;X===1/0;at*=2)X=Math.log(Math.pow(2,E/at))/Math.log(A)*at;var yt=X-Math.floor(X),_t="";for(at=0;at<Math.floor(X);at++)_t=Math.floor(Math.random()*A).toString(A)+_t;if(yt){var Ct=Math.pow(A,yt);_t=Math.floor(Math.random()*Ct).toString(A)+_t}var te=parseInt(_t,A);return te!==1/0&&te>=Math.pow(2,E)?jn(E,A):_t};jn.rack=function(E,A,X){var at=function(_t){var Ct=0;do{if(Ct++>10){if(!X)throw new Error("too many ID collisions, use more bits");E+=X}var te=jn(E,A)}while(Object.hasOwnProperty.call(yt,te));return yt[te]=_t,te},yt=at.hats={};return at.get=function(_t){return at.hats[_t]},at.set=function(_t,Ct){return at.hats[_t]=Ct,at},at.bits=E||128,at.base=A||16,at};var $n=r(ei.exports),Fe=function(E,A){this.ctx=E,this.properties=A.properties||{},this.coordinates=A.geometry.coordinates,this.id=A.id||$n(),this.type=A.geometry.type};Fe.prototype.changed=function(){this.ctx.store.featureChanged(this.id)},Fe.prototype.incomingCoords=function(E){this.setCoordinates(E)},Fe.prototype.setCoordinates=function(E){this.coordinates=E,this.changed()},Fe.prototype.getCoordinates=function(){return JSON.parse(JSON.stringify(this.coordinates))},Fe.prototype.setProperty=function(E,A){this.properties[E]=A},Fe.prototype.toGeoJSON=function(){return JSON.parse(JSON.stringify({id:this.id,type:Z.FEATURE,properties:this.properties,geometry:{coordinates:this.getCoordinates(),type:this.type}}))},Fe.prototype.internal=function(E){var A={id:this.id,meta:pt.FEATURE,"meta:type":this.type,active:gt.INACTIVE,mode:E};if(this.ctx.options.userProperties)for(var X in this.properties)A["user_"+X]=this.properties[X];return{type:Z.FEATURE,properties:A,geometry:{coordinates:this.getCoordinates(),type:this.type}}};var Vn=function(E,A){Fe.call(this,E,A)};(Vn.prototype=Object.create(Fe.prototype)).isValid=function(){return typeof this.coordinates[0]=="number"&&typeof this.coordinates[1]=="number"},Vn.prototype.updateCoordinate=function(E,A,X){this.coordinates=arguments.length===3?[A,X]:[E,A],this.changed()},Vn.prototype.getCoordinate=function(){return this.getCoordinates()};var rr=function(E,A){Fe.call(this,E,A)};(rr.prototype=Object.create(Fe.prototype)).isValid=function(){return this.coordinates.length>1},rr.prototype.addCoordinate=function(E,A,X){this.changed();var at=parseInt(E,10);this.coordinates.splice(at,0,[A,X])},rr.prototype.getCoordinate=function(E){var A=parseInt(E,10);return JSON.parse(JSON.stringify(this.coordinates[A]))},rr.prototype.removeCoordinate=function(E){this.changed(),this.coordinates.splice(parseInt(E,10),1)},rr.prototype.updateCoordinate=function(E,A,X){var at=parseInt(E,10);this.coordinates[at]=[A,X],this.changed()};var ci=function(E,A){Fe.call(this,E,A),this.coordinates=this.coordinates.map(function(X){return X.slice(0,-1)})};(ci.prototype=Object.create(Fe.prototype)).isValid=function(){return this.coordinates.length!==0&&this.coordinates.every(function(E){return E.length>2})},ci.prototype.incomingCoords=function(E){this.coordinates=E.map(function(A){return A.slice(0,-1)}),this.changed()},ci.prototype.setCoordinates=function(E){this.coordinates=E,this.changed()},ci.prototype.addCoordinate=function(E,A,X){this.changed();var at=E.split(".").map(function(yt){return parseInt(yt,10)});this.coordinates[at[0]].splice(at[1],0,[A,X])},ci.prototype.removeCoordinate=function(E){this.changed();var A=E.split(".").map(function(at){return parseInt(at,10)}),X=this.coordinates[A[0]];X&&(X.splice(A[1],1),X.length<3&&this.coordinates.splice(A[0],1))},ci.prototype.getCoordinate=function(E){var A=E.split(".").map(function(at){return parseInt(at,10)}),X=this.coordinates[A[0]];return JSON.parse(JSON.stringify(X[A[1]]))},ci.prototype.getCoordinates=function(){return this.coordinates.map(function(E){return E.concat([E[0]])})},ci.prototype.updateCoordinate=function(E,A,X){this.changed();var at=E.split("."),yt=parseInt(at[0],10),_t=parseInt(at[1],10);this.coordinates[yt]===void 0&&(this.coordinates[yt]=[]),this.coordinates[yt][_t]=[A,X]};var fl={MultiPoint:Vn,MultiLineString:rr,MultiPolygon:ci},ks=function(E,A,X,at,yt){var _t=X.split("."),Ct=parseInt(_t[0],10),te=_t[1]?_t.slice(1).join("."):null;return E[Ct][A](te,at,yt)},br=function(E,A){if(Fe.call(this,E,A),delete this.coordinates,this.model=fl[A.geometry.type],this.model===void 0)throw new TypeError(A.geometry.type+" is not a valid type");this.features=this._coordinatesToFeatures(A.geometry.coordinates)};function nn(E){this.map=E.map,this.drawConfig=JSON.parse(JSON.stringify(E.options||{})),this._ctx=E}(br.prototype=Object.create(Fe.prototype))._coordinatesToFeatures=function(E){var A=this,X=this.model.bind(this);return E.map(function(at){return new X(A.ctx,{id:$n(),type:Z.FEATURE,properties:{},geometry:{coordinates:at,type:A.type.replace("Multi","")}})})},br.prototype.isValid=function(){return this.features.every(function(E){return E.isValid()})},br.prototype.setCoordinates=function(E){this.features=this._coordinatesToFeatures(E),this.changed()},br.prototype.getCoordinate=function(E){return ks(this.features,"getCoordinate",E)},br.prototype.getCoordinates=function(){return JSON.parse(JSON.stringify(this.features.map(function(E){return E.type===Z.POLYGON?E.getCoordinates():E.coordinates})))},br.prototype.updateCoordinate=function(E,A,X){ks(this.features,"updateCoordinate",E,A,X),this.changed()},br.prototype.addCoordinate=function(E,A,X){ks(this.features,"addCoordinate",E,A,X),this.changed()},br.prototype.removeCoordinate=function(E){ks(this.features,"removeCoordinate",E),this.changed()},br.prototype.getFeatures=function(){return this.features},nn.prototype.setSelected=function(E){return this._ctx.store.setSelected(E)},nn.prototype.setSelectedCoordinates=function(E){var A=this;this._ctx.store.setSelectedCoordinates(E),E.reduce(function(X,at){return X[at.feature_id]===void 0&&(X[at.feature_id]=!0,A._ctx.store.get(at.feature_id).changed()),X},{})},nn.prototype.getSelected=function(){return this._ctx.store.getSelected()},nn.prototype.getSelectedIds=function(){return this._ctx.store.getSelectedIds()},nn.prototype.isSelected=function(E){return this._ctx.store.isSelected(E)},nn.prototype.getFeature=function(E){return this._ctx.store.get(E)},nn.prototype.select=function(E){return this._ctx.store.select(E)},nn.prototype.deselect=function(E){return this._ctx.store.deselect(E)},nn.prototype.deleteFeature=function(E,A){return A===void 0&&(A={}),this._ctx.store.delete(E,A)},nn.prototype.addFeature=function(E){return this._ctx.store.add(E)},nn.prototype.clearSelectedFeatures=function(){return this._ctx.store.clearSelected()},nn.prototype.clearSelectedCoordinates=function(){return this._ctx.store.clearSelectedCoordinates()},nn.prototype.setActionableState=function(E){E===void 0&&(E={});var A={trash:E.trash||!1,combineFeatures:E.combineFeatures||!1,uncombineFeatures:E.uncombineFeatures||!1};return this._ctx.events.actionable(A)},nn.prototype.changeMode=function(E,A,X){return A===void 0&&(A={}),X===void 0&&(X={}),this._ctx.events.changeMode(E,A,X)},nn.prototype.updateUIClasses=function(E){return this._ctx.ui.queueMapClasses(E)},nn.prototype.activateUIButton=function(E){return this._ctx.ui.setActiveButton(E)},nn.prototype.featuresAt=function(E,A,X){if(X===void 0&&(X="click"),X!=="click"&&X!=="touch")throw new Error("invalid buffer type");return vt[X](E,A,this._ctx)},nn.prototype.newFeature=function(E){var A=E.geometry.type;return A===Z.POINT?new Vn(this._ctx,E):A===Z.LINE_STRING?new rr(this._ctx,E):A===Z.POLYGON?new ci(this._ctx,E):new br(this._ctx,E)},nn.prototype.isInstanceOf=function(E,A){if(E===Z.POINT)return A instanceof Vn;if(E===Z.LINE_STRING)return A instanceof rr;if(E===Z.POLYGON)return A instanceof ci;if(E==="MultiFeature")return A instanceof br;throw new Error("Unknown feature class: "+E)},nn.prototype.doRender=function(E){return this._ctx.store.featureChanged(E)},nn.prototype.onSetup=function(){},nn.prototype.onDrag=function(){},nn.prototype.onClick=function(){},nn.prototype.onMouseMove=function(){},nn.prototype.onMouseDown=function(){},nn.prototype.onMouseUp=function(){},nn.prototype.onMouseOut=function(){},nn.prototype.onKeyUp=function(){},nn.prototype.onKeyDown=function(){},nn.prototype.onTouchStart=function(){},nn.prototype.onTouchMove=function(){},nn.prototype.onTouchEnd=function(){},nn.prototype.onTap=function(){},nn.prototype.onStop=function(){},nn.prototype.onTrash=function(){},nn.prototype.onCombineFeature=function(){},nn.prototype.onUncombineFeature=function(){},nn.prototype.toDisplayFeatures=function(){throw new Error("You must overwrite toDisplayFeatures")};var dl={drag:"onDrag",click:"onClick",mousemove:"onMouseMove",mousedown:"onMouseDown",mouseup:"onMouseUp",mouseout:"onMouseOut",keyup:"onKeyUp",keydown:"onKeyDown",touchstart:"onTouchStart",touchmove:"onTouchMove",touchend:"onTouchEnd",tap:"onTap"},qo=Object.keys(dl);function Fn(E){var A=Object.keys(E);return function(X,at){at===void 0&&(at={});var yt={},_t=A.reduce(function(Ct,te){return Ct[te]=E[te],Ct},new nn(X));return{start:function(){var Ct=this;yt=_t.onSetup(at),qo.forEach(function(te){var ae,xe=dl[te],we=function(){return!1};E[xe]&&(we=function(){return!0}),Ct.on(te,we,(ae=xe,function(me){return _t[ae](yt,me)}))})},stop:function(){_t.onStop(yt)},trash:function(){_t.onTrash(yt)},combineFeatures:function(){_t.onCombineFeatures(yt)},uncombineFeatures:function(){_t.onUncombineFeatures(yt)},render:function(Ct,te){_t.toDisplayFeatures(yt,Ct,te)}}}}function Xn(E){return[].concat(E).filter(function(A){return A!==void 0})}function mn(){var E=this;if(!(E.ctx.map&&E.ctx.map.getSource(D.HOT)!==void 0))return ae();var A=E.ctx.events.currentModeName();E.ctx.ui.queueMapClasses({mode:A});var X=[],at=[];E.isDirty?at=E.getAllIds():(X=E.getChangedIds().filter(function(xe){return E.get(xe)!==void 0}),at=E.sources.hot.filter(function(xe){return xe.properties.id&&X.indexOf(xe.properties.id)===-1&&E.get(xe.properties.id)!==void 0}).map(function(xe){return xe.properties.id})),E.sources.hot=[];var yt=E.sources.cold.length;E.sources.cold=E.isDirty?[]:E.sources.cold.filter(function(xe){var we=xe.properties.id||xe.properties.parent;return X.indexOf(we)===-1});var _t=yt!==E.sources.cold.length||at.length>0;function Ct(xe,we){var me=E.get(xe).internal(A);E.ctx.events.currentModeRender(me,function(sn){E.sources[we].push(sn)})}if(X.forEach(function(xe){return Ct(xe,"hot")}),at.forEach(function(xe){return Ct(xe,"cold")}),_t&&E.ctx.map.getSource(D.COLD).setData({type:Z.FEATURE_COLLECTION,features:E.sources.cold}),E.ctx.map.getSource(D.HOT).setData({type:Z.FEATURE_COLLECTION,features:E.sources.hot}),E._emitSelectionChange&&(E.ctx.map.fire(rt.SELECTION_CHANGE,{features:E.getSelected().map(function(xe){return xe.toGeoJSON()}),points:E.getSelectedCoordinates().map(function(xe){return{type:Z.FEATURE,properties:{},geometry:{type:Z.POINT,coordinates:xe.coordinates}}})}),E._emitSelectionChange=!1),E._deletedFeaturesToEmit.length){var te=E._deletedFeaturesToEmit.map(function(xe){return xe.toGeoJSON()});E._deletedFeaturesToEmit=[],E.ctx.map.fire(rt.DELETE,{features:te})}function ae(){E.isDirty=!1,E.clearChangedIds()}ae(),E.ctx.map.fire(rt.RENDER,{})}function Un(E){var A,X=this;this._features={},this._featureIds=new Kt,this._selectedFeatureIds=new Kt,this._selectedCoordinates=[],this._changedFeatureIds=new Kt,this._deletedFeaturesToEmit=[],this._emitSelectionChange=!1,this._mapInitialConfig={},this.ctx=E,this.sources={hot:[],cold:[]},this.render=function(){A||(A=requestAnimationFrame(function(){A=null,mn.call(X)}))},this.isDirty=!1}function Ci(E,A){var X=E._selectedCoordinates.filter(function(at){return E._selectedFeatureIds.has(at.feature_id)});E._selectedCoordinates.length===X.length||A.silent||(E._emitSelectionChange=!0),E._selectedCoordinates=X}Un.prototype.createRenderBatch=function(){var E=this,A=this.render,X=0;return this.render=function(){X++},function(){E.render=A,X>0&&E.render()}},Un.prototype.setDirty=function(){return this.isDirty=!0,this},Un.prototype.featureChanged=function(E){return this._changedFeatureIds.add(E),this},Un.prototype.getChangedIds=function(){return this._changedFeatureIds.values()},Un.prototype.clearChangedIds=function(){return this._changedFeatureIds.clear(),this},Un.prototype.getAllIds=function(){return this._featureIds.values()},Un.prototype.add=function(E){return this.featureChanged(E.id),this._features[E.id]=E,this._featureIds.add(E.id),this},Un.prototype.delete=function(E,A){var X=this;return A===void 0&&(A={}),Xn(E).forEach(function(at){X._featureIds.has(at)&&(X._featureIds.delete(at),X._selectedFeatureIds.delete(at),A.silent||X._deletedFeaturesToEmit.indexOf(X._features[at])===-1&&X._deletedFeaturesToEmit.push(X._features[at]),delete X._features[at],X.isDirty=!0)}),Ci(this,A),this},Un.prototype.get=function(E){return this._features[E]},Un.prototype.getAll=function(){var E=this;return Object.keys(this._features).map(function(A){return E._features[A]})},Un.prototype.select=function(E,A){var X=this;return A===void 0&&(A={}),Xn(E).forEach(function(at){X._selectedFeatureIds.has(at)||(X._selectedFeatureIds.add(at),X._changedFeatureIds.add(at),A.silent||(X._emitSelectionChange=!0))}),this},Un.prototype.deselect=function(E,A){var X=this;return A===void 0&&(A={}),Xn(E).forEach(function(at){X._selectedFeatureIds.has(at)&&(X._selectedFeatureIds.delete(at),X._changedFeatureIds.add(at),A.silent||(X._emitSelectionChange=!0))}),Ci(this,A),this},Un.prototype.clearSelected=function(E){return E===void 0&&(E={}),this.deselect(this._selectedFeatureIds.values(),{silent:E.silent}),this},Un.prototype.setSelected=function(E,A){var X=this;return A===void 0&&(A={}),E=Xn(E),this.deselect(this._selectedFeatureIds.values().filter(function(at){return E.indexOf(at)===-1}),{silent:A.silent}),this.select(E.filter(function(at){return!X._selectedFeatureIds.has(at)}),{silent:A.silent}),this},Un.prototype.setSelectedCoordinates=function(E){return this._selectedCoordinates=E,this._emitSelectionChange=!0,this},Un.prototype.clearSelectedCoordinates=function(){return this._selectedCoordinates=[],this._emitSelectionChange=!0,this},Un.prototype.getSelectedIds=function(){return this._selectedFeatureIds.values()},Un.prototype.getSelected=function(){var E=this;return this._selectedFeatureIds.values().map(function(A){return E.get(A)})},Un.prototype.getSelectedCoordinates=function(){var E=this;return this._selectedCoordinates.map(function(A){return{coordinates:E.get(A.feature_id).getCoordinate(A.coord_path)}})},Un.prototype.isSelected=function(E){return this._selectedFeatureIds.has(E)},Un.prototype.setFeatureProperty=function(E,A,X){this.get(E).setProperty(A,X),this.featureChanged(E)},Un.prototype.storeMapConfig=function(){var E=this;Ut.forEach(function(A){E.ctx.map[A]&&(E._mapInitialConfig[A]=E.ctx.map[A].isEnabled())})},Un.prototype.restoreMapConfig=function(){var E=this;Object.keys(this._mapInitialConfig).forEach(function(A){E._mapInitialConfig[A]?E.ctx.map[A].enable():E.ctx.map[A].disable()})},Un.prototype.getInitialConfigValue=function(E){return this._mapInitialConfig[E]===void 0||this._mapInitialConfig[E]};var Yn=function(){for(var E=arguments,A={},X=0;X<arguments.length;X++){var at=E[X];for(var yt in at)no.call(at,yt)&&(A[yt]=at[yt])}return A},no=Object.prototype.hasOwnProperty,Vt=r(Yn),hi=["mode","feature","mouse"];function $i(E){var A=null,X=null,at={onRemove:function(){return E.map.off("load",at.connect),clearInterval(X),at.removeLayers(),E.store.restoreMapConfig(),E.ui.removeButtons(),E.events.removeEventListeners(),E.ui.clearMapClasses(),E.boxZoomInitial&&E.map.boxZoom.enable(),E.map=null,E.container=null,E.store=null,A&&A.parentNode&&A.parentNode.removeChild(A),A=null,this},connect:function(){E.map.off("load",at.connect),clearInterval(X),at.addLayers(),E.store.storeMapConfig(),E.events.addEventListeners()},onAdd:function(yt){var _t=yt.fire;return yt.fire=function(Ct,te){var ae=arguments;return _t.length===1&&arguments.length!==1&&(ae=[Vt({},{type:Ct},te)]),_t.apply(yt,ae)},E.map=yt,E.events=function(Ct){var te=Object.keys(Ct.options.modes).reduce(function(Wt,Oe){return Wt[Oe]=Fn(Ct.options.modes[Oe]),Wt},{}),ae={},xe={},we={},me=null,sn=null;we.drag=function(Wt,Oe){Oe({point:Wt.point,time:new Date().getTime()})?(Ct.ui.queueMapClasses({mouse:B.DRAG}),sn.drag(Wt)):Wt.originalEvent.stopPropagation()},we.mousedrag=function(Wt){we.drag(Wt,function(Oe){return!gn(ae,Oe)})},we.touchdrag=function(Wt){we.drag(Wt,function(Oe){return!xn(xe,Oe)})},we.mousemove=function(Wt){if((Wt.originalEvent.buttons!==void 0?Wt.originalEvent.buttons:Wt.originalEvent.which)===1)return we.mousedrag(Wt);var Oe=Te(Wt,Ct);Wt.featureTarget=Oe,sn.mousemove(Wt)},we.mousedown=function(Wt){ae={time:new Date().getTime(),point:Wt.point};var Oe=Te(Wt,Ct);Wt.featureTarget=Oe,sn.mousedown(Wt)},we.mouseup=function(Wt){var Oe=Te(Wt,Ct);Wt.featureTarget=Oe,gn(ae,{point:Wt.point,time:new Date().getTime()})?sn.click(Wt):sn.mouseup(Wt)},we.mouseout=function(Wt){sn.mouseout(Wt)},we.touchstart=function(Wt){if(Ct.options.touchEnabled){xe={time:new Date().getTime(),point:Wt.point};var Oe=vt.touch(Wt,null,Ct)[0];Wt.featureTarget=Oe,sn.touchstart(Wt)}},we.touchmove=function(Wt){if(Ct.options.touchEnabled)return sn.touchmove(Wt),we.touchdrag(Wt)},we.touchend=function(Wt){if(Wt.originalEvent.preventDefault(),Ct.options.touchEnabled){var Oe=vt.touch(Wt,null,Ct)[0];Wt.featureTarget=Oe,xn(xe,{time:new Date().getTime(),point:Wt.point})?sn.tap(Wt):sn.touchend(Wt)}};var zr=function(Wt){return!(Wt===8||Wt===46||Wt>=48&&Wt<=57)};function cn(Wt,Oe,sr){sr===void 0&&(sr={}),sn.stop();var Br=te[Wt];if(Br===void 0)throw new Error(Wt+" is not valid");me=Wt;var Zr=Br(Ct,Oe);sn=n(Zr,Ct),sr.silent||Ct.map.fire(rt.MODE_CHANGE,{mode:Wt}),Ct.store.setDirty(),Ct.store.render()}we.keydown=function(Wt){(Wt.srcElement||Wt.target).classList.contains("mapboxgl-canvas")&&(Wt.keyCode!==8&&Wt.keyCode!==46||!Ct.options.controls.trash?zr(Wt.keyCode)?sn.keydown(Wt):Wt.keyCode===49&&Ct.options.controls.point?cn(W.DRAW_POINT):Wt.keyCode===50&&Ct.options.controls.line_string?cn(W.DRAW_LINE_STRING):Wt.keyCode===51&&Ct.options.controls.polygon&&cn(W.DRAW_POLYGON):(Wt.preventDefault(),sn.trash()))},we.keyup=function(Wt){zr(Wt.keyCode)&&sn.keyup(Wt)},we.zoomend=function(){Ct.store.changeZoom()},we.data=function(Wt){if(Wt.dataType==="style"){var Oe=Ct.setup,sr=Ct.map,Br=Ct.options,Zr=Ct.store;Br.styles.some(function(us){return sr.getLayer(us.id)})||(Oe.addLayers(),Zr.setDirty(),Zr.render())}};var fi={trash:!1,combineFeatures:!1,uncombineFeatures:!1};return{start:function(){me=Ct.options.defaultMode,sn=n(te[me](Ct),Ct)},changeMode:cn,actionable:function(Wt){var Oe=!1;Object.keys(Wt).forEach(function(sr){if(fi[sr]===void 0)throw new Error("Invalid action type");fi[sr]!==Wt[sr]&&(Oe=!0),fi[sr]=Wt[sr]}),Oe&&Ct.map.fire(rt.ACTIONABLE,{actions:fi})},currentModeName:function(){return me},currentModeRender:function(Wt,Oe){return sn.render(Wt,Oe)},fire:function(Wt,Oe){we[Wt]&&we[Wt](Oe)},addEventListeners:function(){Ct.map.on("mousemove",we.mousemove),Ct.map.on("mousedown",we.mousedown),Ct.map.on("mouseup",we.mouseup),Ct.map.on("data",we.data),Ct.map.on("touchmove",we.touchmove),Ct.map.on("touchstart",we.touchstart),Ct.map.on("touchend",we.touchend),Ct.container.addEventListener("mouseout",we.mouseout),Ct.options.keybindings&&(Ct.container.addEventListener("keydown",we.keydown),Ct.container.addEventListener("keyup",we.keyup))},removeEventListeners:function(){Ct.map.off("mousemove",we.mousemove),Ct.map.off("mousedown",we.mousedown),Ct.map.off("mouseup",we.mouseup),Ct.map.off("data",we.data),Ct.map.off("touchmove",we.touchmove),Ct.map.off("touchstart",we.touchstart),Ct.map.off("touchend",we.touchend),Ct.container.removeEventListener("mouseout",we.mouseout),Ct.options.keybindings&&(Ct.container.removeEventListener("keydown",we.keydown),Ct.container.removeEventListener("keyup",we.keyup))},trash:function(Wt){sn.trash(Wt)},combineFeatures:function(){sn.combineFeatures()},uncombineFeatures:function(){sn.uncombineFeatures()},getMode:function(){return me}}}(E),E.ui=function(Ct){var te={},ae=null,xe={mode:null,feature:null,mouse:null},we={mode:null,feature:null,mouse:null};function me(Wt){we=Vt(we,Wt)}function sn(){var Wt,Oe;if(Ct.container){var sr=[],Br=[];hi.forEach(function(Zr){we[Zr]!==xe[Zr]&&(sr.push(Zr+"-"+xe[Zr]),we[Zr]!==null&&Br.push(Zr+"-"+we[Zr]))}),sr.length>0&&(Wt=Ct.container.classList).remove.apply(Wt,sr),Br.length>0&&(Oe=Ct.container.classList).add.apply(Oe,Br),xe=Vt(xe,we)}}function zr(Wt,Oe){Oe===void 0&&(Oe={});var sr=document.createElement("button");return sr.className=P.CONTROL_BUTTON+" "+Oe.className,sr.setAttribute("title",Oe.title),Oe.container.appendChild(sr),sr.addEventListener("click",function(Br){if(Br.preventDefault(),Br.stopPropagation(),Br.target===ae)return cn(),void Oe.onDeactivate();fi(Wt),Oe.onActivate()},!0),sr}function cn(){ae&&(ae.classList.remove(P.ACTIVE_BUTTON),ae=null)}function fi(Wt){cn();var Oe=te[Wt];Oe&&Oe&&Wt!=="trash"&&(Oe.classList.add(P.ACTIVE_BUTTON),ae=Oe)}return{setActiveButton:fi,queueMapClasses:me,updateMapClasses:sn,clearMapClasses:function(){me({mode:null,feature:null,mouse:null}),sn()},addButtons:function(){var Wt=Ct.options.controls,Oe=document.createElement("div");return Oe.className=P.CONTROL_GROUP+" "+P.CONTROL_BASE,Wt&&(Wt[$.LINE]&&(te[$.LINE]=zr($.LINE,{container:Oe,className:P.CONTROL_BUTTON_LINE,title:"LineString tool "+(Ct.options.keybindings?"(l)":""),onActivate:function(){return Ct.events.changeMode(W.DRAW_LINE_STRING)},onDeactivate:function(){return Ct.events.trash()}})),Wt[$.POLYGON]&&(te[$.POLYGON]=zr($.POLYGON,{container:Oe,className:P.CONTROL_BUTTON_POLYGON,title:"Polygon tool "+(Ct.options.keybindings?"(p)":""),onActivate:function(){return Ct.events.changeMode(W.DRAW_POLYGON)},onDeactivate:function(){return Ct.events.trash()}})),Wt[$.POINT]&&(te[$.POINT]=zr($.POINT,{container:Oe,className:P.CONTROL_BUTTON_POINT,title:"Marker tool "+(Ct.options.keybindings?"(m)":""),onActivate:function(){return Ct.events.changeMode(W.DRAW_POINT)},onDeactivate:function(){return Ct.events.trash()}})),Wt.trash&&(te.trash=zr("trash",{container:Oe,className:P.CONTROL_BUTTON_TRASH,title:"Delete",onActivate:function(){Ct.events.trash()}})),Wt.combine_features&&(te.combine_features=zr("combineFeatures",{container:Oe,className:P.CONTROL_BUTTON_COMBINE_FEATURES,title:"Combine",onActivate:function(){Ct.events.combineFeatures()}})),Wt.uncombine_features&&(te.uncombine_features=zr("uncombineFeatures",{container:Oe,className:P.CONTROL_BUTTON_UNCOMBINE_FEATURES,title:"Uncombine",onActivate:function(){Ct.events.uncombineFeatures()}}))),Oe},removeButtons:function(){Object.keys(te).forEach(function(Wt){var Oe=te[Wt];Oe.parentNode&&Oe.parentNode.removeChild(Oe),delete te[Wt]})}}}(E),E.container=yt.getContainer(),E.store=new Un(E),A=E.ui.addButtons(),E.options.boxSelect&&(E.boxZoomInitial=yt.boxZoom.isEnabled(),yt.boxZoom.disable(),yt.dragPan.disable(),yt.dragPan.enable()),yt.loaded()?at.connect():(yt.on("load",at.connect),X=setInterval(function(){yt.loaded()&&at.connect()},16)),E.events.start(),A},addLayers:function(){E.map.addSource(D.COLD,{data:{type:Z.FEATURE_COLLECTION,features:[]},type:"geojson"}),E.map.addSource(D.HOT,{data:{type:Z.FEATURE_COLLECTION,features:[]},type:"geojson"}),E.options.styles.forEach(function(yt){E.map.addLayer(yt)}),E.store.setDirty(!0),E.store.render()},removeLayers:function(){E.options.styles.forEach(function(yt){E.map.getLayer(yt.id)&&E.map.removeLayer(yt.id)}),E.map.getSource(D.COLD)&&E.map.removeSource(D.COLD),E.map.getSource(D.HOT)&&E.map.removeSource(D.HOT)}};return E.setup=at,at}var Gn=[{id:"gl-draw-polygon-fill-inactive",type:"fill",filter:["all",["==","active","false"],["==","$type","Polygon"],["!=","mode","static"]],paint:{"fill-color":"#3bb2d0","fill-outline-color":"#3bb2d0","fill-opacity":.1}},{id:"gl-draw-polygon-fill-active",type:"fill",filter:["all",["==","active","true"],["==","$type","Polygon"]],paint:{"fill-color":"#fbb03b","fill-outline-color":"#fbb03b","fill-opacity":.1}},{id:"gl-draw-polygon-midpoint",type:"circle",filter:["all",["==","$type","Point"],["==","meta","midpoint"]],paint:{"circle-radius":3,"circle-color":"#fbb03b"}},{id:"gl-draw-polygon-stroke-inactive",type:"line",filter:["all",["==","active","false"],["==","$type","Polygon"],["!=","mode","static"]],layout:{"line-cap":"round","line-join":"round"},paint:{"line-color":"#3bb2d0","line-width":2}},{id:"gl-draw-polygon-stroke-active",type:"line",filter:["all",["==","active","true"],["==","$type","Polygon"]],layout:{"line-cap":"round","line-join":"round"},paint:{"line-color":"#fbb03b","line-dasharray":[.2,2],"line-width":2}},{id:"gl-draw-line-inactive",type:"line",filter:["all",["==","active","false"],["==","$type","LineString"],["!=","mode","static"]],layout:{"line-cap":"round","line-join":"round"},paint:{"line-color":"#3bb2d0","line-width":2}},{id:"gl-draw-line-active",type:"line",filter:["all",["==","$type","LineString"],["==","active","true"]],layout:{"line-cap":"round","line-join":"round"},paint:{"line-color":"#fbb03b","line-dasharray":[.2,2],"line-width":2}},{id:"gl-draw-polygon-and-line-vertex-stroke-inactive",type:"circle",filter:["all",["==","meta","vertex"],["==","$type","Point"],["!=","mode","static"]],paint:{"circle-radius":5,"circle-color":"#fff"}},{id:"gl-draw-polygon-and-line-vertex-inactive",type:"circle",filter:["all",["==","meta","vertex"],["==","$type","Point"],["!=","mode","static"]],paint:{"circle-radius":3,"circle-color":"#fbb03b"}},{id:"gl-draw-point-point-stroke-inactive",type:"circle",filter:["all",["==","active","false"],["==","$type","Point"],["==","meta","feature"],["!=","mode","static"]],paint:{"circle-radius":5,"circle-opacity":1,"circle-color":"#fff"}},{id:"gl-draw-point-inactive",type:"circle",filter:["all",["==","active","false"],["==","$type","Point"],["==","meta","feature"],["!=","mode","static"]],paint:{"circle-radius":3,"circle-color":"#3bb2d0"}},{id:"gl-draw-point-stroke-active",type:"circle",filter:["all",["==","$type","Point"],["==","active","true"],["!=","meta","midpoint"]],paint:{"circle-radius":7,"circle-color":"#fff"}},{id:"gl-draw-point-active",type:"circle",filter:["all",["==","$type","Point"],["!=","meta","midpoint"],["==","active","true"]],paint:{"circle-radius":5,"circle-color":"#fbb03b"}},{id:"gl-draw-polygon-fill-static",type:"fill",filter:["all",["==","mode","static"],["==","$type","Polygon"]],paint:{"fill-color":"#404040","fill-outline-color":"#404040","fill-opacity":.1}},{id:"gl-draw-polygon-stroke-static",type:"line",filter:["all",["==","mode","static"],["==","$type","Polygon"]],layout:{"line-cap":"round","line-join":"round"},paint:{"line-color":"#404040","line-width":2}},{id:"gl-draw-line-static",type:"line",filter:["all",["==","mode","static"],["==","$type","LineString"]],layout:{"line-cap":"round","line-join":"round"},paint:{"line-color":"#404040","line-width":2}},{id:"gl-draw-point-static",type:"circle",filter:["all",["==","mode","static"],["==","$type","Point"]],paint:{"circle-radius":5,"circle-color":"#404040"}}];function vn(E){return function(A){var X=A.featureTarget;return!!X&&!!X.properties&&X.properties.meta===E}}function zs(E){return!!E.originalEvent&&!!E.originalEvent.shiftKey&&E.originalEvent.button===0}function pi(E){return!!E.featureTarget&&!!E.featureTarget.properties&&E.featureTarget.properties.active===gt.ACTIVE&&E.featureTarget.properties.meta===pt.FEATURE}function os(E){return!!E.featureTarget&&!!E.featureTarget.properties&&E.featureTarget.properties.active===gt.INACTIVE&&E.featureTarget.properties.meta===pt.FEATURE}function Ta(E){return E.featureTarget===void 0}function ra(E){return!!E.featureTarget&&!!E.featureTarget.properties&&E.featureTarget.properties.meta===pt.FEATURE}function ss(E){var A=E.featureTarget;return!!A&&!!A.properties&&A.properties.meta===pt.VERTEX}function ia(E){return!!E.originalEvent&&E.originalEvent.shiftKey===!0}function se(E){return E.keyCode===27}function uo(E){return E.keyCode===13}var wr=Object.freeze({__proto__:null,isOfMetaType:vn,isShiftMousedown:zs,isActiveFeature:pi,isInactiveFeature:os,noTarget:Ta,isFeature:ra,isVertex:ss,isShiftDown:ia,isEscapeKey:se,isEnterKey:uo,isTrue:function(){return!0}}),Au=Co;function Co(E,A){this.x=E,this.y=A}Co.prototype={clone:function(){return new Co(this.x,this.y)},add:function(E){return this.clone()._add(E)},sub:function(E){return this.clone()._sub(E)},multByPoint:function(E){return this.clone()._multByPoint(E)},divByPoint:function(E){return this.clone()._divByPoint(E)},mult:function(E){return this.clone()._mult(E)},div:function(E){return this.clone()._div(E)},rotate:function(E){return this.clone()._rotate(E)},rotateAround:function(E,A){return this.clone()._rotateAround(E,A)},matMult:function(E){return this.clone()._matMult(E)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(E){return this.x===E.x&&this.y===E.y},dist:function(E){return Math.sqrt(this.distSqr(E))},distSqr:function(E){var A=E.x-this.x,X=E.y-this.y;return A*A+X*X},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(E){return Math.atan2(this.y-E.y,this.x-E.x)},angleWith:function(E){return this.angleWithSep(E.x,E.y)},angleWithSep:function(E,A){return Math.atan2(this.x*A-this.y*E,this.x*E+this.y*A)},_matMult:function(E){var A=E[0]*this.x+E[1]*this.y,X=E[2]*this.x+E[3]*this.y;return this.x=A,this.y=X,this},_add:function(E){return this.x+=E.x,this.y+=E.y,this},_sub:function(E){return this.x-=E.x,this.y-=E.y,this},_mult:function(E){return this.x*=E,this.y*=E,this},_div:function(E){return this.x/=E,this.y/=E,this},_multByPoint:function(E){return this.x*=E.x,this.y*=E.y,this},_divByPoint:function(E){return this.x/=E.x,this.y/=E.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var E=this.y;return this.y=this.x,this.x=-E,this},_rotate:function(E){var A=Math.cos(E),X=Math.sin(E),at=A*this.x-X*this.y,yt=X*this.x+A*this.y;return this.x=at,this.y=yt,this},_rotateAround:function(E,A){var X=Math.cos(E),at=Math.sin(E),yt=A.x+X*(this.x-A.x)-at*(this.y-A.y),_t=A.y+at*(this.x-A.x)+X*(this.y-A.y);return this.x=yt,this.y=_t,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},Co.convert=function(E){return E instanceof Co?E:Array.isArray(E)?new Co(E[0],E[1]):E};var le=r(Au);function an(E,A){var X=A.getBoundingClientRect();return new le(E.clientX-X.left-(A.clientLeft||0),E.clientY-X.top-(A.clientTop||0))}function Ye(E,A,X,at){return{type:Z.FEATURE,properties:{meta:pt.VERTEX,parent:E,coord_path:X,active:at?gt.ACTIVE:gt.INACTIVE},geometry:{type:Z.POINT,coordinates:A}}}function ro(E,A,X){var at=A.geometry.coordinates,yt=X.geometry.coordinates;if(at[1]>85||at[1]<zt||yt[1]>85||yt[1]<zt)return null;var _t={lng:(at[0]+yt[0])/2,lat:(at[1]+yt[1])/2};return{type:Z.FEATURE,properties:{meta:pt.MIDPOINT,parent:E,lng:_t.lng,lat:_t.lat,coord_path:X.properties.coord_path},geometry:{type:Z.POINT,coordinates:[_t.lng,_t.lat]}}}function jo(E,A,X){A===void 0&&(A={}),X===void 0&&(X=null);var at,yt=E.geometry,_t=yt.type,Ct=yt.coordinates,te=E.properties&&E.properties.id,ae=[];function xe(me,sn){var zr="",cn=null;me.forEach(function(fi,Wt){var Oe=sn!=null?sn+"."+Wt:String(Wt),sr=Ye(te,fi,Oe,we(Oe));if(A.midpoints&&cn){var Br=ro(te,cn,sr);Br&&ae.push(Br)}cn=sr;var Zr=JSON.stringify(fi);zr!==Zr&&ae.push(sr),Wt===0&&(zr=Zr)})}function we(me){return!!A.selectedPaths&&A.selectedPaths.indexOf(me)!==-1}return _t===Z.POINT?ae.push(Ye(te,Ct,X,we(X))):_t===Z.POLYGON?Ct.forEach(function(me,sn){xe(me,X!==null?X+"."+sn:String(sn))}):_t===Z.LINE_STRING?xe(Ct,X):_t.indexOf(Z.MULTI_PREFIX)===0&&(at=_t.replace(Z.MULTI_PREFIX,""),Ct.forEach(function(me,sn){var zr={type:Z.FEATURE,properties:E.properties,geometry:{type:at,coordinates:me}};ae=ae.concat(jo(zr,A,sn))})),ae}var je={enable:function(E){setTimeout(function(){E.map&&E.map.doubleClickZoom&&E._ctx&&E._ctx.store&&E._ctx.store.getInitialConfigValue&&E._ctx.store.getInitialConfigValue("doubleClickZoom")&&E.map.doubleClickZoom.enable()},0)},disable:function(E){setTimeout(function(){E.map&&E.map.doubleClickZoom&&E.map.doubleClickZoom.disable()},0)}},as={exports:{}},ot=function(E){if(!E||!E.type)return null;var A=V[E.type];if(!A)return null;if(A==="geometry")return{type:"FeatureCollection",features:[{type:"Feature",properties:{},geometry:E}]};if(A==="feature")return{type:"FeatureCollection",features:[E]};if(A==="featurecollection")return E},V={Point:"geometry",MultiPoint:"geometry",LineString:"geometry",MultiLineString:"geometry",Polygon:"geometry",MultiPolygon:"geometry",GeometryCollection:"geometry",Feature:"feature",FeatureCollection:"featurecollection"},G=r(ot),J=Object.freeze({__proto__:null,default:function E(A){switch(A&&A.type||null){case"FeatureCollection":return A.features=A.features.reduce(function(X,at){return X.concat(E(at))},[]),A;case"Feature":return A.geometry?E(A.geometry).map(function(X){var at={type:"Feature",properties:JSON.parse(JSON.stringify(A.properties)),geometry:X};return A.id!==void 0&&(at.id=A.id),at}):[A];case"MultiPoint":return A.coordinates.map(function(X){return{type:"Point",coordinates:X}});case"MultiPolygon":return A.coordinates.map(function(X){return{type:"Polygon",coordinates:X}});case"MultiLineString":return A.coordinates.map(function(X){return{type:"LineString",coordinates:X}});case"GeometryCollection":return A.geometries.map(E).reduce(function(X,at){return X.concat(at)},[]);case"Point":case"Polygon":case"LineString":return[A]}}}),q=ot,nt=i(J),bt=function(E){return function A(X){return Array.isArray(X)&&X.length&&typeof X[0]=="number"?[X]:X.reduce(function(at,yt){return Array.isArray(yt)&&Array.isArray(yt[0])?at.concat(A(yt)):(at.push(yt),at)},[])}(E)};nt instanceof Function||(nt=nt.default);var ft={exports:{}},it=ft.exports=function(E){return new dt(E)};function dt(E){this.value=E}function qt(E,A,X){var at=[],yt=[],_t=!0;return function Ct(te){var ae=X?jt(te):te,xe={},we=!0,me={node:ae,node_:te,path:[].concat(at),parent:yt[yt.length-1],parents:yt,key:at.slice(-1)[0],isRoot:at.length===0,level:at.length,circular:null,update:function(cn,fi){me.isRoot||(me.parent.node[me.key]=cn),me.node=cn,fi&&(we=!1)},delete:function(cn){delete me.parent.node[me.key],cn&&(we=!1)},remove:function(cn){Qe(me.parent.node)?me.parent.node.splice(me.key,1):delete me.parent.node[me.key],cn&&(we=!1)},keys:null,before:function(cn){xe.before=cn},after:function(cn){xe.after=cn},pre:function(cn){xe.pre=cn},post:function(cn){xe.post=cn},stop:function(){_t=!1},block:function(){we=!1}};if(!_t)return me;function sn(){if(typeof me.node=="object"&&me.node!==null){me.keys&&me.node_===me.node||(me.keys=Xt(me.node)),me.isLeaf=me.keys.length==0;for(var cn=0;cn<yt.length;cn++)if(yt[cn].node_===te){me.circular=yt[cn];break}}else me.isLeaf=!0,me.keys=null;me.notLeaf=!me.isLeaf,me.notRoot=!me.isRoot}sn();var zr=A.call(me,me.node);return zr!==void 0&&me.update&&me.update(zr),xe.before&&xe.before.call(me,me.node),we&&(typeof me.node!="object"||me.node===null||me.circular||(yt.push(me),sn(),Le(me.keys,function(cn,fi){at.push(cn),xe.pre&&xe.pre.call(me,me.node[cn],cn);var Wt=Ct(me.node[cn]);X&&ke.call(me.node,cn)&&(me.node[cn]=Wt.node),Wt.isLast=fi==me.keys.length-1,Wt.isFirst=fi==0,xe.post&&xe.post.call(me,Wt),at.pop()}),yt.pop()),xe.after&&xe.after.call(me,me.node)),me}(E).node}function jt(E){if(typeof E=="object"&&E!==null){var A;if(Qe(E))A=[];else if(Pe(E)==="[object Date]")A=new Date(E.getTime?E.getTime():E);else if(function(yt){return Pe(yt)==="[object RegExp]"}(E))A=new RegExp(E);else if(function(yt){return Pe(yt)==="[object Error]"}(E))A={message:E.message};else if(function(yt){return Pe(yt)==="[object Boolean]"}(E))A=new Boolean(E);else if(function(yt){return Pe(yt)==="[object Number]"}(E))A=new Number(E);else if(function(yt){return Pe(yt)==="[object String]"}(E))A=new String(E);else if(Object.create&&Object.getPrototypeOf)A=Object.create(Object.getPrototypeOf(E));else if(E.constructor===Object)A={};else{var X=E.constructor&&E.constructor.prototype||E.__proto__||{},at=function(){};at.prototype=X,A=new at}return Le(Xt(E),function(yt){A[yt]=E[yt]}),A}return E}dt.prototype.get=function(E){for(var A=this.value,X=0;X<E.length;X++){var at=E[X];if(!A||!ke.call(A,at)){A=void 0;break}A=A[at]}return A},dt.prototype.has=function(E){for(var A=this.value,X=0;X<E.length;X++){var at=E[X];if(!A||!ke.call(A,at))return!1;A=A[at]}return!0},dt.prototype.set=function(E,A){for(var X=this.value,at=0;at<E.length-1;at++){var yt=E[at];ke.call(X,yt)||(X[yt]={}),X=X[yt]}return X[E[at]]=A,A},dt.prototype.map=function(E){return qt(this.value,E,!0)},dt.prototype.forEach=function(E){return this.value=qt(this.value,E,!1),this.value},dt.prototype.reduce=function(E,A){var X=arguments.length===1,at=X?this.value:A;return this.forEach(function(yt){this.isRoot&&X||(at=E.call(this,at,yt))}),at},dt.prototype.paths=function(){var E=[];return this.forEach(function(A){E.push(this.path)}),E},dt.prototype.nodes=function(){var E=[];return this.forEach(function(A){E.push(this.node)}),E},dt.prototype.clone=function(){var E=[],A=[];return function X(at){for(var yt=0;yt<E.length;yt++)if(E[yt]===at)return A[yt];if(typeof at=="object"&&at!==null){var _t=jt(at);return E.push(at),A.push(_t),Le(Xt(at),function(Ct){_t[Ct]=X(at[Ct])}),E.pop(),A.pop(),_t}return at}(this.value)};var Xt=Object.keys||function(E){var A=[];for(var X in E)A.push(X);return A};function Pe(E){return Object.prototype.toString.call(E)}var Qe=Array.isArray||function(E){return Object.prototype.toString.call(E)==="[object Array]"},Le=function(E,A){if(E.forEach)return E.forEach(A);for(var X=0;X<E.length;X++)A(E[X],X,E)};Le(Xt(dt.prototype),function(E){it[E]=function(A){var X=[].slice.call(arguments,1),at=new dt(A);return at[E].apply(at,X)}});var ke=Object.hasOwnProperty||function(E,A){return A in E},on=ft.exports,ir=yn;function yn(E){if(!(this instanceof yn))return new yn(E);this._bbox=E||[1/0,1/0,-1/0,-1/0],this._valid=!!E}yn.prototype.include=function(E){return this._valid=!0,this._bbox[0]=Math.min(this._bbox[0],E[0]),this._bbox[1]=Math.min(this._bbox[1],E[1]),this._bbox[2]=Math.max(this._bbox[2],E[0]),this._bbox[3]=Math.max(this._bbox[3],E[1]),this},yn.prototype.equals=function(E){var A;return A=E instanceof yn?E.bbox():E,this._bbox[0]==A[0]&&this._bbox[1]==A[1]&&this._bbox[2]==A[2]&&this._bbox[3]==A[3]},yn.prototype.center=function(E){return this._valid?[(this._bbox[0]+this._bbox[2])/2,(this._bbox[1]+this._bbox[3])/2]:null},yn.prototype.union=function(E){var A;return this._valid=!0,A=E instanceof yn?E.bbox():E,this._bbox[0]=Math.min(this._bbox[0],A[0]),this._bbox[1]=Math.min(this._bbox[1],A[1]),this._bbox[2]=Math.max(this._bbox[2],A[2]),this._bbox[3]=Math.max(this._bbox[3],A[3]),this},yn.prototype.bbox=function(){return this._valid?this._bbox:null},yn.prototype.contains=function(E){if(!E)return this._fastContains();if(!this._valid)return null;var A=E[0],X=E[1];return this._bbox[0]<=A&&this._bbox[1]<=X&&this._bbox[2]>=A&&this._bbox[3]>=X},yn.prototype.intersect=function(E){return this._valid?(A=E instanceof yn?E.bbox():E,!(this._bbox[0]>A[2]||this._bbox[2]<A[0]||this._bbox[3]<A[1]||this._bbox[1]>A[3])):null;var A},yn.prototype._fastContains=function(){if(!this._valid)return new Function("return null;");var E="return "+this._bbox[0]+"<= ll[0] &&"+this._bbox[1]+"<= ll[1] &&"+this._bbox[2]+">= ll[0] &&"+this._bbox[3]+">= ll[1]";return new Function("ll",E)},yn.prototype.polygon=function(){return this._valid?{type:"Polygon",coordinates:[[[this._bbox[0],this._bbox[1]],[this._bbox[2],this._bbox[1]],[this._bbox[2],this._bbox[3]],[this._bbox[0],this._bbox[3]],[this._bbox[0],this._bbox[1]]]]}:null};var kn=function(E){if(!E)return[];var A=nt(q(E)),X=[];return A.features.forEach(function(at){at.geometry&&(X=X.concat(bt(at.geometry.coordinates)))}),X},Mn=on,To=ir,mr={features:["FeatureCollection"],coordinates:["Point","MultiPoint","LineString","MultiLineString","Polygon","MultiPolygon"],geometry:["Feature"],geometries:["GeometryCollection"]},Ti=Object.keys(mr);function Vi(E){for(var A=To(),X=kn(E),at=0;at<X.length;at++)A.include(X[at]);return A}as.exports=function(E){return Vi(E).bbox()},as.exports.polygon=function(E){return Vi(E).polygon()},as.exports.bboxify=function(E){return Mn(E).map(function(A){A&&Ti.some(function(X){return!!A[X]&&mr[X].indexOf(A.type)!==-1})&&(A.bbox=Vi(A).bbox(),this.update(A))})};var oa=r(as.exports),Xh=-90;function gl(E,A){var X=Xh,at=90,yt=Xh,_t=90,Ct=270,te=-270;E.forEach(function(xe){var we=oa(xe),me=we[1],sn=we[3],zr=we[0],cn=we[2];me>X&&(X=me),sn<at&&(at=sn),sn>yt&&(yt=sn),me<_t&&(_t=me),zr<Ct&&(Ct=zr),cn>te&&(te=cn)});var ae=A;return X+ae.lat>85&&(ae.lat=85-X),yt+ae.lat>90&&(ae.lat=90-yt),at+ae.lat<-85&&(ae.lat=-85-at),_t+ae.lat<Xh&&(ae.lat=Xh-_t),Ct+ae.lng<=-270&&(ae.lng+=360*Math.ceil(Math.abs(ae.lng)/360)),te+ae.lng>=270&&(ae.lng-=360*Math.ceil(Math.abs(ae.lng)/360)),ae}function ml(E,A){var X=gl(E.map(function(at){return at.toGeoJSON()}),A);E.forEach(function(at){var yt,_t=at.getCoordinates(),Ct=function(ae){var xe={lng:ae[0]+X.lng,lat:ae[1]+X.lat};return[xe.lng,xe.lat]},te=function(ae){return ae.map(function(xe){return Ct(xe)})};at.type===Z.POINT?yt=Ct(_t):at.type===Z.LINE_STRING||at.type===Z.MULTI_POINT?yt=_t.map(Ct):at.type===Z.POLYGON||at.type===Z.MULTI_LINE_STRING?yt=_t.map(te):at.type===Z.MULTI_POLYGON&&(yt=_t.map(function(ae){return ae.map(function(xe){return te(xe)})})),at.incomingCoords(yt)})}var Ui={onSetup:function(E){var A=this,X={dragMoveLocation:null,boxSelectStartLocation:null,boxSelectElement:void 0,boxSelecting:!1,canBoxSelect:!1,dragMoving:!1,canDragMove:!1,initiallySelectedFeatureIds:E.featureIds||[]};return this.setSelected(X.initiallySelectedFeatureIds.filter(function(at){return A.getFeature(at)!==void 0})),this.fireActionable(),this.setActionableState({combineFeatures:!0,uncombineFeatures:!0,trash:!0}),X},fireUpdate:function(){this.map.fire(rt.UPDATE,{action:ct.MOVE,features:this.getSelected().map(function(E){return E.toGeoJSON()})})},fireActionable:function(){var E=this,A=this.getSelected(),X=A.filter(function(te){return E.isInstanceOf("MultiFeature",te)}),at=!1;if(A.length>1){at=!0;var yt=A[0].type.replace("Multi","");A.forEach(function(te){te.type.replace("Multi","")!==yt&&(at=!1)})}var _t=X.length>0,Ct=A.length>0;this.setActionableState({combineFeatures:at,uncombineFeatures:_t,trash:Ct})},getUniqueIds:function(E){return E.length?E.map(function(A){return A.properties.id}).filter(function(A){return A!==void 0}).reduce(function(A,X){return A.add(X),A},new Kt).values():[]},stopExtendedInteractions:function(E){E.boxSelectElement&&(E.boxSelectElement.parentNode&&E.boxSelectElement.parentNode.removeChild(E.boxSelectElement),E.boxSelectElement=null),this.map.dragPan.enable(),E.boxSelecting=!1,E.canBoxSelect=!1,E.dragMoving=!1,E.canDragMove=!1},onStop:function(){je.enable(this)},onMouseMove:function(E,A){return ra(A)&&E.dragMoving&&this.fireUpdate(),this.stopExtendedInteractions(E),!0},onMouseOut:function(E){return!E.dragMoving||this.fireUpdate()}};Ui.onTap=Ui.onClick=function(E,A){return Ta(A)?this.clickAnywhere(E,A):vn(pt.VERTEX)(A)?this.clickOnVertex(E,A):ra(A)?this.clickOnFeature(E,A):void 0},Ui.clickAnywhere=function(E){var A=this,X=this.getSelectedIds();X.length&&(this.clearSelectedFeatures(),X.forEach(function(at){return A.doRender(at)})),je.enable(this),this.stopExtendedInteractions(E)},Ui.clickOnVertex=function(E,A){this.changeMode(W.DIRECT_SELECT,{featureId:A.featureTarget.properties.parent,coordPath:A.featureTarget.properties.coord_path,startPos:A.lngLat}),this.updateUIClasses({mouse:B.MOVE})},Ui.startOnActiveFeature=function(E,A){this.stopExtendedInteractions(E),this.map.dragPan.disable(),this.doRender(A.featureTarget.properties.id),E.canDragMove=!0,E.dragMoveLocation=A.lngLat},Ui.clickOnFeature=function(E,A){var X=this;je.disable(this),this.stopExtendedInteractions(E);var at=ia(A),yt=this.getSelectedIds(),_t=A.featureTarget.properties.id,Ct=this.isSelected(_t);if(!at&&Ct&&this.getFeature(_t).type!==Z.POINT)return this.changeMode(W.DIRECT_SELECT,{featureId:_t});Ct&&at?(this.deselect(_t),this.updateUIClasses({mouse:B.POINTER}),yt.length===1&&je.enable(this)):!Ct&&at?(this.select(_t),this.updateUIClasses({mouse:B.MOVE})):Ct||at||(yt.forEach(function(te){return X.doRender(te)}),this.setSelected(_t),this.updateUIClasses({mouse:B.MOVE})),this.doRender(_t)},Ui.onMouseDown=function(E,A){return pi(A)?this.startOnActiveFeature(E,A):this.drawConfig.boxSelect&&zs(A)?this.startBoxSelect(E,A):void 0},Ui.startBoxSelect=function(E,A){this.stopExtendedInteractions(E),this.map.dragPan.disable(),E.boxSelectStartLocation=an(A.originalEvent,this.map.getContainer()),E.canBoxSelect=!0},Ui.onTouchStart=function(E,A){if(pi(A))return this.startOnActiveFeature(E,A)},Ui.onDrag=function(E,A){return E.canDragMove?this.dragMove(E,A):this.drawConfig.boxSelect&&E.canBoxSelect?this.whileBoxSelect(E,A):void 0},Ui.whileBoxSelect=function(E,A){E.boxSelecting=!0,this.updateUIClasses({mouse:B.ADD}),E.boxSelectElement||(E.boxSelectElement=document.createElement("div"),E.boxSelectElement.classList.add(P.BOX_SELECT),this.map.getContainer().appendChild(E.boxSelectElement));var X=an(A.originalEvent,this.map.getContainer()),at=Math.min(E.boxSelectStartLocation.x,X.x),yt=Math.max(E.boxSelectStartLocation.x,X.x),_t=Math.min(E.boxSelectStartLocation.y,X.y),Ct=Math.max(E.boxSelectStartLocation.y,X.y),te="translate("+at+"px, "+_t+"px)";E.boxSelectElement.style.transform=te,E.boxSelectElement.style.WebkitTransform=te,E.boxSelectElement.style.width=yt-at+"px",E.boxSelectElement.style.height=Ct-_t+"px"},Ui.dragMove=function(E,A){E.dragMoving=!0,A.originalEvent.stopPropagation();var X={lng:A.lngLat.lng-E.dragMoveLocation.lng,lat:A.lngLat.lat-E.dragMoveLocation.lat};ml(this.getSelected(),X),E.dragMoveLocation=A.lngLat},Ui.onTouchEnd=Ui.onMouseUp=function(E,A){var X=this;if(E.dragMoving)this.fireUpdate();else if(E.boxSelecting){var at=[E.boxSelectStartLocation,an(A.originalEvent,this.map.getContainer())],yt=this.featuresAt(null,at,"click"),_t=this.getUniqueIds(yt).filter(function(Ct){return!X.isSelected(Ct)});_t.length&&(this.select(_t),_t.forEach(function(Ct){return X.doRender(Ct)}),this.updateUIClasses({mouse:B.MOVE}))}this.stopExtendedInteractions(E)},Ui.toDisplayFeatures=function(E,A,X){A.properties.active=this.isSelected(A.properties.id)?gt.ACTIVE:gt.INACTIVE,X(A),this.fireActionable(),A.properties.active===gt.ACTIVE&&A.geometry.type!==Z.POINT&&jo(A).forEach(X)},Ui.onTrash=function(){this.deleteFeature(this.getSelectedIds()),this.fireActionable()},Ui.onCombineFeatures=function(){var E=this.getSelected();if(!(E.length===0||E.length<2)){for(var A=[],X=[],at=E[0].type.replace("Multi",""),yt=0;yt<E.length;yt++){var _t=E[yt];if(_t.type.replace("Multi","")!==at)return;_t.type.includes("Multi")?_t.getCoordinates().forEach(function(te){A.push(te)}):A.push(_t.getCoordinates()),X.push(_t.toGeoJSON())}if(X.length>1){var Ct=this.newFeature({type:Z.FEATURE,properties:X[0].properties,geometry:{type:"Multi"+at,coordinates:A}});this.addFeature(Ct),this.deleteFeature(this.getSelectedIds(),{silent:!0}),this.setSelected([Ct.id]),this.map.fire(rt.COMBINE_FEATURES,{createdFeatures:[Ct.toGeoJSON()],deletedFeatures:X})}this.fireActionable()}},Ui.onUncombineFeatures=function(){var E=this,A=this.getSelected();if(A.length!==0){for(var X=[],at=[],yt=function(Ct){var te=A[Ct];E.isInstanceOf("MultiFeature",te)&&(te.getFeatures().forEach(function(ae){E.addFeature(ae),ae.properties=te.properties,X.push(ae.toGeoJSON()),E.select([ae.id])}),E.deleteFeature(te.id,{silent:!0}),at.push(te.toGeoJSON()))},_t=0;_t<A.length;_t++)yt(_t);X.length>1&&this.map.fire(rt.UNCOMBINE_FEATURES,{createdFeatures:X,deletedFeatures:at}),this.fireActionable()}};var or=vn(pt.VERTEX),Yp=vn(pt.MIDPOINT),La={fireUpdate:function(){this.map.fire(rt.UPDATE,{action:ct.CHANGE_COORDINATES,features:this.getSelected().map(function(E){return E.toGeoJSON()})})},fireActionable:function(E){this.setActionableState({combineFeatures:!1,uncombineFeatures:!1,trash:E.selectedCoordPaths.length>0})},startDragging:function(E,A){this.map.dragPan.disable(),E.canDragMove=!0,E.dragMoveLocation=A.lngLat},stopDragging:function(E){this.map.dragPan.enable(),E.dragMoving=!1,E.canDragMove=!1,E.dragMoveLocation=null},onVertex:function(E,A){this.startDragging(E,A);var X=A.featureTarget.properties,at=E.selectedCoordPaths.indexOf(X.coord_path);ia(A)||at!==-1?ia(A)&&at===-1&&E.selectedCoordPaths.push(X.coord_path):E.selectedCoordPaths=[X.coord_path];var yt=this.pathsToCoordinates(E.featureId,E.selectedCoordPaths);this.setSelectedCoordinates(yt)},onMidpoint:function(E,A){this.startDragging(E,A);var X=A.featureTarget.properties;E.feature.addCoordinate(X.coord_path,X.lng,X.lat),this.fireUpdate(),E.selectedCoordPaths=[X.coord_path]},pathsToCoordinates:function(E,A){return A.map(function(X){return{feature_id:E,coord_path:X}})},onFeature:function(E,A){E.selectedCoordPaths.length===0?this.startDragging(E,A):this.stopDragging(E)},dragFeature:function(E,A,X){ml(this.getSelected(),X),E.dragMoveLocation=A.lngLat},dragVertex:function(E,A,X){for(var at=E.selectedCoordPaths.map(function(te){return E.feature.getCoordinate(te)}),yt=gl(at.map(function(te){return{type:Z.FEATURE,properties:{},geometry:{type:Z.POINT,coordinates:te}}}),X),_t=0;_t<at.length;_t++){var Ct=at[_t];E.feature.updateCoordinate(E.selectedCoordPaths[_t],Ct[0]+yt.lng,Ct[1]+yt.lat)}},clickNoTarget:function(){this.changeMode(W.SIMPLE_SELECT)},clickInactive:function(){this.changeMode(W.SIMPLE_SELECT)},clickActiveFeature:function(E){E.selectedCoordPaths=[],this.clearSelectedCoordinates(),E.feature.changed()},onSetup:function(E){var A=E.featureId,X=this.getFeature(A);if(!X)throw new Error("You must provide a featureId to enter direct_select mode");if(X.type===Z.POINT)throw new TypeError("direct_select mode doesn't handle point features");var at={featureId:A,feature:X,dragMoveLocation:E.startPos||null,dragMoving:!1,canDragMove:!1,selectedCoordPaths:E.coordPath?[E.coordPath]:[]};return this.setSelectedCoordinates(this.pathsToCoordinates(A,at.selectedCoordPaths)),this.setSelected(A),je.disable(this),this.setActionableState({trash:!0}),at},onStop:function(){je.enable(this),this.clearSelectedCoordinates()},toDisplayFeatures:function(E,A,X){E.featureId===A.properties.id?(A.properties.active=gt.ACTIVE,X(A),jo(A,{map:this.map,midpoints:!0,selectedPaths:E.selectedCoordPaths}).forEach(X)):(A.properties.active=gt.INACTIVE,X(A)),this.fireActionable(E)},onTrash:function(E){E.selectedCoordPaths.sort(function(A,X){return X.localeCompare(A,"en",{numeric:!0})}).forEach(function(A){return E.feature.removeCoordinate(A)}),this.fireUpdate(),E.selectedCoordPaths=[],this.clearSelectedCoordinates(),this.fireActionable(E),E.feature.isValid()===!1&&(this.deleteFeature([E.featureId]),this.changeMode(W.SIMPLE_SELECT,{}))},onMouseMove:function(E,A){var X=pi(A),at=or(A),yt=Yp(A),_t=E.selectedCoordPaths.length===0;return X&&_t||at&&!_t?this.updateUIClasses({mouse:B.MOVE}):this.updateUIClasses({mouse:B.NONE}),(at||X||yt)&&E.dragMoving&&this.fireUpdate(),this.stopDragging(E),!0},onMouseOut:function(E){return E.dragMoving&&this.fireUpdate(),!0}};La.onTouchStart=La.onMouseDown=function(E,A){return or(A)?this.onVertex(E,A):pi(A)?this.onFeature(E,A):Yp(A)?this.onMidpoint(E,A):void 0},La.onDrag=function(E,A){if(E.canDragMove===!0){E.dragMoving=!0,A.originalEvent.stopPropagation();var X={lng:A.lngLat.lng-E.dragMoveLocation.lng,lat:A.lngLat.lat-E.dragMoveLocation.lat};E.selectedCoordPaths.length>0?this.dragVertex(E,A,X):this.dragFeature(E,A,X),E.dragMoveLocation=A.lngLat}},La.onClick=function(E,A){return Ta(A)?this.clickNoTarget(E,A):pi(A)?this.clickActiveFeature(E,A):os(A)?this.clickInactive(E,A):void this.stopDragging(E)},La.onTap=function(E,A){return Ta(A)?this.clickNoTarget(E,A):pi(A)?this.clickActiveFeature(E,A):os(A)?this.clickInactive(E,A):void 0},La.onTouchEnd=La.onMouseUp=function(E){E.dragMoving&&this.fireUpdate(),this.stopDragging(E)};var Ar={};function Lo(E,A){return!!E.lngLat&&E.lngLat.lng===A[0]&&E.lngLat.lat===A[1]}Ar.onSetup=function(){var E=this.newFeature({type:Z.FEATURE,properties:{},geometry:{type:Z.POINT,coordinates:[]}});return this.addFeature(E),this.clearSelectedFeatures(),this.updateUIClasses({mouse:B.ADD}),this.activateUIButton($.POINT),this.setActionableState({trash:!0}),{point:E}},Ar.stopDrawingAndRemove=function(E){this.deleteFeature([E.point.id],{silent:!0}),this.changeMode(W.SIMPLE_SELECT)},Ar.onTap=Ar.onClick=function(E,A){this.updateUIClasses({mouse:B.MOVE}),E.point.updateCoordinate("",A.lngLat.lng,A.lngLat.lat),this.map.fire(rt.CREATE,{features:[E.point.toGeoJSON()]}),this.changeMode(W.SIMPLE_SELECT,{featureIds:[E.point.id]})},Ar.onStop=function(E){this.activateUIButton(),E.point.getCoordinate().length||this.deleteFeature([E.point.id],{silent:!0})},Ar.toDisplayFeatures=function(E,A,X){var at=A.properties.id===E.point.id;if(A.properties.active=at?gt.ACTIVE:gt.INACTIVE,!at)return X(A)},Ar.onTrash=Ar.stopDrawingAndRemove,Ar.onKeyUp=function(E,A){if(se(A)||uo(A))return this.stopDrawingAndRemove(E,A)};var yc={onSetup:function(){var E=this.newFeature({type:Z.FEATURE,properties:{},geometry:{type:Z.POLYGON,coordinates:[[]]}});return this.addFeature(E),this.clearSelectedFeatures(),je.disable(this),this.updateUIClasses({mouse:B.ADD}),this.activateUIButton($.POLYGON),this.setActionableState({trash:!0}),{polygon:E,currentVertexPosition:0}},clickAnywhere:function(E,A){if(E.currentVertexPosition>0&&Lo(A,E.polygon.coordinates[0][E.currentVertexPosition-1]))return this.changeMode(W.SIMPLE_SELECT,{featureIds:[E.polygon.id]});this.updateUIClasses({mouse:B.ADD}),E.polygon.updateCoordinate("0."+E.currentVertexPosition,A.lngLat.lng,A.lngLat.lat),E.currentVertexPosition++,E.polygon.updateCoordinate("0."+E.currentVertexPosition,A.lngLat.lng,A.lngLat.lat)},clickOnVertex:function(E){return this.changeMode(W.SIMPLE_SELECT,{featureIds:[E.polygon.id]})},onMouseMove:function(E,A){E.polygon.updateCoordinate("0."+E.currentVertexPosition,A.lngLat.lng,A.lngLat.lat),ss(A)&&this.updateUIClasses({mouse:B.POINTER})}};yc.onTap=yc.onClick=function(E,A){return ss(A)?this.clickOnVertex(E,A):this.clickAnywhere(E,A)},yc.onKeyUp=function(E,A){se(A)?(this.deleteFeature([E.polygon.id],{silent:!0}),this.changeMode(W.SIMPLE_SELECT)):uo(A)&&this.changeMode(W.SIMPLE_SELECT,{featureIds:[E.polygon.id]})},yc.onStop=function(E){this.updateUIClasses({mouse:B.NONE}),je.enable(this),this.activateUIButton(),this.getFeature(E.polygon.id)!==void 0&&(E.polygon.removeCoordinate("0."+E.currentVertexPosition),E.polygon.isValid()?this.map.fire(rt.CREATE,{features:[E.polygon.toGeoJSON()]}):(this.deleteFeature([E.polygon.id],{silent:!0}),this.changeMode(W.SIMPLE_SELECT,{},{silent:!0})))},yc.toDisplayFeatures=function(E,A,X){var at=A.properties.id===E.polygon.id;if(A.properties.active=at?gt.ACTIVE:gt.INACTIVE,!at)return X(A);if(A.geometry.coordinates.length!==0){var yt=A.geometry.coordinates[0].length;if(!(yt<3)){if(A.properties.meta=pt.FEATURE,X(Ye(E.polygon.id,A.geometry.coordinates[0][0],"0.0",!1)),yt>3){var _t=A.geometry.coordinates[0].length-3;X(Ye(E.polygon.id,A.geometry.coordinates[0][_t],"0."+_t,!1))}if(yt<=4){var Ct=[[A.geometry.coordinates[0][0][0],A.geometry.coordinates[0][0][1]],[A.geometry.coordinates[0][1][0],A.geometry.coordinates[0][1][1]]];if(X({type:Z.FEATURE,properties:A.properties,geometry:{coordinates:Ct,type:Z.LINE_STRING}}),yt===3)return}return X(A)}}},yc.onTrash=function(E){this.deleteFeature([E.polygon.id],{silent:!0}),this.changeMode(W.SIMPLE_SELECT)};var io={onSetup:function(E){var A,X,at=(E=E||{}).featureId,yt="forward";if(at){if(!(A=this.getFeature(at)))throw new Error("Could not find a feature with the provided featureId");var _t=E.from;if(_t&&_t.type==="Feature"&&_t.geometry&&_t.geometry.type==="Point"&&(_t=_t.geometry),_t&&_t.type==="Point"&&_t.coordinates&&_t.coordinates.length===2&&(_t=_t.coordinates),!_t||!Array.isArray(_t))throw new Error("Please use the `from` property to indicate which point to continue the line from");var Ct=A.coordinates.length-1;if(A.coordinates[Ct][0]===_t[0]&&A.coordinates[Ct][1]===_t[1])X=Ct+1,A.addCoordinate.apply(A,[X].concat(A.coordinates[Ct]));else{if(A.coordinates[0][0]!==_t[0]||A.coordinates[0][1]!==_t[1])throw new Error("`from` should match the point at either the start or the end of the provided LineString");yt="backwards",X=0,A.addCoordinate.apply(A,[X].concat(A.coordinates[0]))}}else A=this.newFeature({type:Z.FEATURE,properties:{},geometry:{type:Z.LINE_STRING,coordinates:[]}}),X=0,this.addFeature(A);return this.clearSelectedFeatures(),je.disable(this),this.updateUIClasses({mouse:B.ADD}),this.activateUIButton($.LINE),this.setActionableState({trash:!0}),{line:A,currentVertexPosition:X,direction:yt}},clickAnywhere:function(E,A){if(E.currentVertexPosition>0&&Lo(A,E.line.coordinates[E.currentVertexPosition-1])||E.direction==="backwards"&&Lo(A,E.line.coordinates[E.currentVertexPosition+1]))return this.changeMode(W.SIMPLE_SELECT,{featureIds:[E.line.id]});this.updateUIClasses({mouse:B.ADD}),E.line.updateCoordinate(E.currentVertexPosition,A.lngLat.lng,A.lngLat.lat),E.direction==="forward"?(E.currentVertexPosition++,E.line.updateCoordinate(E.currentVertexPosition,A.lngLat.lng,A.lngLat.lat)):E.line.addCoordinate(0,A.lngLat.lng,A.lngLat.lat)},clickOnVertex:function(E){return this.changeMode(W.SIMPLE_SELECT,{featureIds:[E.line.id]})},onMouseMove:function(E,A){E.line.updateCoordinate(E.currentVertexPosition,A.lngLat.lng,A.lngLat.lat),ss(A)&&this.updateUIClasses({mouse:B.POINTER})}};io.onTap=io.onClick=function(E,A){if(ss(A))return this.clickOnVertex(E,A);this.clickAnywhere(E,A)},io.onKeyUp=function(E,A){uo(A)?this.changeMode(W.SIMPLE_SELECT,{featureIds:[E.line.id]}):se(A)&&(this.deleteFeature([E.line.id],{silent:!0}),this.changeMode(W.SIMPLE_SELECT))},io.onStop=function(E){je.enable(this),this.activateUIButton(),this.getFeature(E.line.id)!==void 0&&(E.line.removeCoordinate(""+E.currentVertexPosition),E.line.isValid()?this.map.fire(rt.CREATE,{features:[E.line.toGeoJSON()]}):(this.deleteFeature([E.line.id],{silent:!0}),this.changeMode(W.SIMPLE_SELECT,{},{silent:!0})))},io.onTrash=function(E){this.deleteFeature([E.line.id],{silent:!0}),this.changeMode(W.SIMPLE_SELECT)},io.toDisplayFeatures=function(E,A,X){var at=A.properties.id===E.line.id;if(A.properties.active=at?gt.ACTIVE:gt.INACTIVE,!at)return X(A);A.geometry.coordinates.length<2||(A.properties.meta=pt.FEATURE,X(Ye(E.line.id,A.geometry.coordinates[E.direction==="forward"?A.geometry.coordinates.length-2:1],""+(E.direction==="forward"?A.geometry.coordinates.length-2:1),!1)),X(A))};var oo={simple_select:Ui,direct_select:La,draw_point:Ar,draw_polygon:yc,draw_line_string:io},Zp={defaultMode:W.SIMPLE_SELECT,keybindings:!0,touchEnabled:!0,clickBuffer:2,touchBuffer:25,boxSelect:!0,displayControlsDefault:!0,styles:Gn,modes:oo,controls:{},userProperties:!1},rh={point:!0,line_string:!0,polygon:!0,trash:!0,combine_features:!0,uncombine_features:!0},Fr={point:!1,line_string:!1,polygon:!1,trash:!1,combine_features:!1,uncombine_features:!1};function qn(E,A){return E.map(function(X){return X.source?X:Vt(X,{id:X.id+"."+A,source:A==="hot"?D.HOT:D.COLD})})}var Du={exports:{}};(function(E,A){var X="__lodash_hash_undefined__",at=9007199254740991,yt="[object Arguments]",_t="[object Array]",Ct="[object Boolean]",te="[object Date]",ae="[object Error]",xe="[object Function]",we="[object Map]",me="[object Number]",sn="[object Object]",zr="[object Promise]",cn="[object RegExp]",fi="[object Set]",Wt="[object String]",Oe="[object Symbol]",sr="[object WeakMap]",Br="[object ArrayBuffer]",Zr="[object DataView]",us=/^\[object .+?Constructor\]$/,Hp=/^(?:0|[1-9]\d*)$/,yr={};yr["[object Float32Array]"]=yr["[object Float64Array]"]=yr["[object Int8Array]"]=yr["[object Int16Array]"]=yr["[object Int32Array]"]=yr["[object Uint8Array]"]=yr["[object Uint8ClampedArray]"]=yr["[object Uint16Array]"]=yr["[object Uint32Array]"]=!0,yr[yt]=yr[_t]=yr[Br]=yr[Ct]=yr[Zr]=yr[te]=yr[ae]=yr[xe]=yr[we]=yr[me]=yr[sn]=yr[cn]=yr[fi]=yr[Wt]=yr[sr]=!1;var ih=typeof zg=="object"&&zg&&zg.Object===Object&&zg,Wp=typeof self=="object"&&self&&self.Object===Object&&self,ls=ih||Wp||Function("return this")(),Ou=A&&!A.nodeType&&A,Cn=Ou&&E&&!E.nodeType&&E,Hh=Cn&&Cn.exports===Ou,Xo=Hh&&ih.process,cs=function(){try{return Xo&&Xo.binding&&Xo.binding("util")}catch{}}(),Jp=cs&&cs.isTypedArray;function Kp(It,Gt){for(var ge=-1,Xe=It==null?0:It.length;++ge<Xe;)if(Gt(It[ge],ge,It))return!0;return!1}function Qp(It){var Gt=-1,ge=Array(It.size);return It.forEach(function(Xe,Pr){ge[++Gt]=[Pr,Xe]}),ge}function fd(It){var Gt=-1,ge=Array(It.size);return It.forEach(function(Xe){ge[++Gt]=Xe}),ge}var tf,Wh,ef,dd=Array.prototype,nf=Function.prototype,Jh=Object.prototype,rf=ls["__core-js_shared__"],_c=nf.toString,iu=Jh.hasOwnProperty,_g=(tf=/[^.]+$/.exec(rf&&rf.keys&&rf.keys.IE_PROTO||""))?"Symbol(src)_1."+tf:"",vg=Jh.toString,jm=RegExp("^"+_c.call(iu).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),xg=Hh?ls.Buffer:void 0,of=ls.Symbol,sf=ls.Uint8Array,Kh=Jh.propertyIsEnumerable,gd=dd.splice,Ru=of?of.toStringTag:void 0,vc=Object.getOwnPropertySymbols,bg=xg?xg.isBuffer:void 0,wg=(Wh=Object.keys,ef=Object,function(It){return Wh(ef(It))}),Qh=xc(ls,"DataView"),Na=xc(ls,"Map"),af=xc(ls,"Promise"),ou=xc(ls,"Set"),_l=xc(ls,"WeakMap"),oh=xc(Object,"create"),md=wl(Qh),Zn=wl(Na),$r=wl(af),Xm=wl(ou),Ln=wl(_l),vl=of?of.prototype:void 0,Nr=vl?vl.valueOf:void 0;function ar(It){var Gt=-1,ge=It==null?0:It.length;for(this.clear();++Gt<ge;){var Xe=It[Gt];this.set(Xe[0],Xe[1])}}function Bs(It){var Gt=-1,ge=It==null?0:It.length;for(this.clear();++Gt<ge;){var Xe=It[Gt];this.set(Xe[0],Xe[1])}}function xl(It){var Gt=-1,ge=It==null?0:It.length;for(this.clear();++Gt<ge;){var Xe=It[Gt];this.set(Xe[0],Xe[1])}}function sh(It){var Gt=-1,ge=It==null?0:It.length;for(this.__data__=new xl;++Gt<ge;)this.add(It[Gt])}function Pa(It){var Gt=this.__data__=new Bs(It);this.size=Gt.size}function uf(It,Gt){var ge=bc(It),Xe=!ge&&ff(It),Pr=!ge&&!Xe&&df(It),An=!ge&&!Xe&&!Pr&&ch(It),ni=ge||Xe||Pr||An,di=ni?function(ur,hs){for(var uu=-1,No=Array(ur);++uu<ur;)No[uu]=hs(uu);return No}(It.length,String):[],Li=di.length;for(var Hr in It)!Gt&&!iu.call(It,Hr)||ni&&(Hr=="length"||Pr&&(Hr=="offset"||Hr=="parent")||An&&(Hr=="buffer"||Hr=="byteLength"||Hr=="byteOffset")||Ig(Hr,Li))||di.push(Hr);return di}function ah(It,Gt){for(var ge=It.length;ge--;)if(lh(It[ge][0],Gt))return ge;return-1}function bl(It){return It==null?It===void 0?"[object Undefined]":"[object Null]":Ru&&Ru in Object(It)?function(Gt){var ge=iu.call(Gt,Ru),Xe=Gt[Ru];try{Gt[Ru]=void 0;var Pr=!0}catch{}var An=vg.call(Gt);return Pr&&(ge?Gt[Ru]=Xe:delete Gt[Ru]),An}(It):function(Gt){return vg.call(Gt)}(It)}function lf(It){return au(It)&&bl(It)==yt}function uh(It,Gt,ge,Xe,Pr){return It===Gt||(It==null||Gt==null||!au(It)&&!au(Gt)?It!=It&&Gt!=Gt:function(An,ni,di,Li,Hr,ur){var hs=bc(An),uu=bc(ni),No=hs?_t:su(An),lu=uu?_t:su(ni),ps=(No=No==yt?sn:No)==sn,np=(lu=lu==yt?sn:lu)==sn,lo=No==lu;if(lo&&df(An)){if(!df(ni))return!1;hs=!0,ps=!1}if(lo&&!ps)return ur||(ur=new Pa),hs||ch(An)?Eg(An,ni,di,Li,Hr,ur):function(Er,lr,ip,Ma,Il,Ni,ve){switch(ip){case Zr:if(Er.byteLength!=lr.byteLength||Er.byteOffset!=lr.byteOffset)return!1;Er=Er.buffer,lr=lr.buffer;case Br:return!(Er.byteLength!=lr.byteLength||!Ni(new sf(Er),new sf(lr)));case Ct:case te:case me:return lh(+Er,+lr);case ae:return Er.name==lr.name&&Er.message==lr.message;case cn:case Wt:return Er==lr+"";case we:var Aa=Qp;case fi:var aa=1&Ma;if(Aa||(Aa=fd),Er.size!=lr.size&&!aa)return!1;var zu=ve.get(Er);if(zu)return zu==lr;Ma|=2,ve.set(Er,lr);var wc=Eg(Aa(Er),Aa(lr),Ma,Il,Ni,ve);return ve.delete(Er),wc;case Oe:if(Nr)return Nr.call(Er)==Nr.call(lr)}return!1}(An,ni,No,di,Li,Hr,ur);if(!(1&di)){var $s=ps&&iu.call(An,"__wrapped__"),rp=np&&iu.call(ni,"__wrapped__");if($s||rp){var Fu=$s?An.value():An,ku=rp?ni.value():ni;return ur||(ur=new Pa),Hr(Fu,ku,di,Li,ur)}}return lo?(ur||(ur=new Pa),function(Er,lr,ip,Ma,Il,Ni){var ve=1&ip,Aa=cf(Er),aa=Aa.length,zu=cf(lr).length;if(aa!=zu&&!ve)return!1;for(var wc=aa;wc--;){var he=Aa[wc];if(!(ve?he in lr:iu.call(lr,he)))return!1}var mf=Ni.get(Er);if(mf&&Ni.get(lr))return mf==lr;var hh=!0;Ni.set(Er,lr),Ni.set(lr,Er);for(var yd=ve;++wc<aa;){var ph=Er[he=Aa[wc]],op=lr[he];if(Ma)var _d=ve?Ma(op,ph,he,lr,Er,Ni):Ma(ph,op,he,Er,lr,Ni);if(!(_d===void 0?ph===op||Il(ph,op,ip,Ma,Ni):_d)){hh=!1;break}yd||(yd=he=="constructor")}if(hh&&!yd){var sp=Er.constructor,yf=lr.constructor;sp==yf||!("constructor"in Er)||!("constructor"in lr)||typeof sp=="function"&&sp instanceof sp&&typeof yf=="function"&&yf instanceof yf||(hh=!1)}return Ni.delete(Er),Ni.delete(lr),hh}(An,ni,di,Li,Hr,ur)):!1}(It,Gt,ge,Xe,uh,Pr))}function tp(It){return!(!Yo(It)||function(Gt){return!!_g&&_g in Gt}(It))&&(Vr(It)?jm:us).test(wl(It))}function ep(It){if(ge=(Gt=It)&&Gt.constructor,Xe=typeof ge=="function"&&ge.prototype||Jh,Gt!==Xe)return wg(It);var Gt,ge,Xe,Pr=[];for(var An in Object(It))iu.call(It,An)&&An!="constructor"&&Pr.push(An);return Pr}function Eg(It,Gt,ge,Xe,Pr,An){var ni=1&ge,di=It.length,Li=Gt.length;if(di!=Li&&!(ni&&Li>di))return!1;var Hr=An.get(It);if(Hr&&An.get(Gt))return Hr==Gt;var ur=-1,hs=!0,uu=2&ge?new sh:void 0;for(An.set(It,Gt),An.set(Gt,It);++ur<di;){var No=It[ur],lu=Gt[ur];if(Xe)var ps=ni?Xe(lu,No,ur,Gt,It,An):Xe(No,lu,ur,It,Gt,An);if(ps!==void 0){if(ps)continue;hs=!1;break}if(uu){if(!Kp(Gt,function(np,lo){if($s=lo,!uu.has($s)&&(No===np||Pr(No,np,ge,Xe,An)))return uu.push(lo);var $s})){hs=!1;break}}else if(No!==lu&&!Pr(No,lu,ge,Xe,An)){hs=!1;break}}return An.delete(It),An.delete(Gt),hs}function cf(It){return function(Gt,ge,Xe){var Pr=ge(Gt);return bc(Gt)?Pr:function(An,ni){for(var di=-1,Li=ni.length,Hr=An.length;++di<Li;)An[Hr+di]=ni[di];return An}(Pr,Xe(Gt))}(It,gf,pf)}function hf(It,Gt){var ge,Xe,Pr=It.__data__;return((Xe=typeof(ge=Gt))=="string"||Xe=="number"||Xe=="symbol"||Xe=="boolean"?ge!=="__proto__":ge===null)?Pr[typeof Gt=="string"?"string":"hash"]:Pr.map}function xc(It,Gt){var ge=function(Xe,Pr){return Xe==null?void 0:Xe[Pr]}(It,Gt);return tp(ge)?ge:void 0}ar.prototype.clear=function(){this.__data__=oh?oh(null):{},this.size=0},ar.prototype.delete=function(It){var Gt=this.has(It)&&delete this.__data__[It];return this.size-=Gt?1:0,Gt},ar.prototype.get=function(It){var Gt=this.__data__;if(oh){var ge=Gt[It];return ge===X?void 0:ge}return iu.call(Gt,It)?Gt[It]:void 0},ar.prototype.has=function(It){var Gt=this.__data__;return oh?Gt[It]!==void 0:iu.call(Gt,It)},ar.prototype.set=function(It,Gt){var ge=this.__data__;return this.size+=this.has(It)?0:1,ge[It]=oh&&Gt===void 0?X:Gt,this},Bs.prototype.clear=function(){this.__data__=[],this.size=0},Bs.prototype.delete=function(It){var Gt=this.__data__,ge=ah(Gt,It);return!(ge<0)&&(ge==Gt.length-1?Gt.pop():gd.call(Gt,ge,1),--this.size,!0)},Bs.prototype.get=function(It){var Gt=this.__data__,ge=ah(Gt,It);return ge<0?void 0:Gt[ge][1]},Bs.prototype.has=function(It){return ah(this.__data__,It)>-1},Bs.prototype.set=function(It,Gt){var ge=this.__data__,Xe=ah(ge,It);return Xe<0?(++this.size,ge.push([It,Gt])):ge[Xe][1]=Gt,this},xl.prototype.clear=function(){this.size=0,this.__data__={hash:new ar,map:new(Na||Bs),string:new ar}},xl.prototype.delete=function(It){var Gt=hf(this,It).delete(It);return this.size-=Gt?1:0,Gt},xl.prototype.get=function(It){return hf(this,It).get(It)},xl.prototype.has=function(It){return hf(this,It).has(It)},xl.prototype.set=function(It,Gt){var ge=hf(this,It),Xe=ge.size;return ge.set(It,Gt),this.size+=ge.size==Xe?0:1,this},sh.prototype.add=sh.prototype.push=function(It){return this.__data__.set(It,X),this},sh.prototype.has=function(It){return this.__data__.has(It)},Pa.prototype.clear=function(){this.__data__=new Bs,this.size=0},Pa.prototype.delete=function(It){var Gt=this.__data__,ge=Gt.delete(It);return this.size=Gt.size,ge},Pa.prototype.get=function(It){return this.__data__.get(It)},Pa.prototype.has=function(It){return this.__data__.has(It)},Pa.prototype.set=function(It,Gt){var ge=this.__data__;if(ge instanceof Bs){var Xe=ge.__data__;if(!Na||Xe.length<199)return Xe.push([It,Gt]),this.size=++ge.size,this;ge=this.__data__=new xl(Xe)}return ge.set(It,Gt),this.size=ge.size,this};var pf=vc?function(It){return It==null?[]:(It=Object(It),function(Gt,ge){for(var Xe=-1,Pr=Gt==null?0:Gt.length,An=0,ni=[];++Xe<Pr;){var di=Gt[Xe];ge(di,Xe,Gt)&&(ni[An++]=di)}return ni}(vc(It),function(Gt){return Kh.call(It,Gt)}))}:function(){return[]},su=bl;function Ig(It,Gt){return!!(Gt=Gt??at)&&(typeof It=="number"||Hp.test(It))&&It>-1&&It%1==0&&It<Gt}function wl(It){if(It!=null){try{return _c.call(It)}catch{}try{return It+""}catch{}}return""}function lh(It,Gt){return It===Gt||It!=It&&Gt!=Gt}(Qh&&su(new Qh(new ArrayBuffer(1)))!=Zr||Na&&su(new Na)!=we||af&&su(af.resolve())!=zr||ou&&su(new ou)!=fi||_l&&su(new _l)!=sr)&&(su=function(It){var Gt=bl(It),ge=Gt==sn?It.constructor:void 0,Xe=ge?wl(ge):"";if(Xe)switch(Xe){case md:return Zr;case Zn:return we;case $r:return zr;case Xm:return fi;case Ln:return sr}return Gt});var ff=lf(function(){return arguments}())?lf:function(It){return au(It)&&iu.call(It,"callee")&&!Kh.call(It,"callee")},bc=Array.isArray,df=bg||function(){return!1};function Vr(It){if(!Yo(It))return!1;var Gt=bl(It);return Gt==xe||Gt=="[object GeneratorFunction]"||Gt=="[object AsyncFunction]"||Gt=="[object Proxy]"}function El(It){return typeof It=="number"&&It>-1&&It%1==0&&It<=at}function Yo(It){var Gt=typeof It;return It!=null&&(Gt=="object"||Gt=="function")}function au(It){return It!=null&&typeof It=="object"}var ch=Jp?function(It){return function(Gt){return It(Gt)}}(Jp):function(It){return au(It)&&El(It.length)&&!!yr[bl(It)]};function gf(It){return(Gt=It)!=null&&El(Gt.length)&&!Vr(Gt)?uf(It):ep(It);var Gt}E.exports=function(It,Gt){return uh(It,Gt)}})(Du,Du.exports);var kr=r(Du.exports);function Yh(E,A){return E.length===A.length&&JSON.stringify(E.map(function(X){return X}).sort())===JSON.stringify(A.map(function(X){return X}).sort())}var sa={Polygon:ci,LineString:rr,Point:Vn,MultiPolygon:br,MultiLineString:br,MultiPoint:br},pd=Object.freeze({__proto__:null,CommonSelectors:wr,constrainFeatureMovement:gl,createMidPoint:ro,createSupplementaryPoints:jo,createVertex:Ye,doubleClickZoom:je,euclideanDistance:Ge,featuresAt:vt,getFeatureAtAndSetCursors:Te,isClick:gn,isEventAtCoordinates:Lo,isTap:xn,mapEventToBoundingBox:be,ModeHandler:n,moveFeatures:ml,sortFeatures:Yt,stringSetsAreEqual:Yh,StringSet:Kt,theme:Gn,toDenseArray:Xn}),yl=function(E,A){var X={options:E=function(yt){yt===void 0&&(yt={});var _t=Vt(yt);return yt.controls||(_t.controls={}),yt.displayControlsDefault===!1?_t.controls=Vt(Fr,yt.controls):_t.controls=Vt(rh,yt.controls),(_t=Vt(Zp,_t)).styles=qn(_t.styles,"cold").concat(qn(_t.styles,"hot")),_t}(E)};A=function(yt,_t){return _t.modes=W,_t.getFeatureIdsAt=function(Ct){return vt.click({point:Ct},null,yt).map(function(te){return te.properties.id})},_t.getSelectedIds=function(){return yt.store.getSelectedIds()},_t.getSelected=function(){return{type:Z.FEATURE_COLLECTION,features:yt.store.getSelectedIds().map(function(Ct){return yt.store.get(Ct)}).map(function(Ct){return Ct.toGeoJSON()})}},_t.getSelectedPoints=function(){return{type:Z.FEATURE_COLLECTION,features:yt.store.getSelectedCoordinates().map(function(Ct){return{type:Z.FEATURE,properties:{},geometry:{type:Z.POINT,coordinates:Ct.coordinates}}})}},_t.set=function(Ct){if(Ct.type===void 0||Ct.type!==Z.FEATURE_COLLECTION||!Array.isArray(Ct.features))throw new Error("Invalid FeatureCollection");var te=yt.store.createRenderBatch(),ae=yt.store.getAllIds().slice(),xe=_t.add(Ct),we=new Kt(xe);return(ae=ae.filter(function(me){return!we.has(me)})).length&&_t.delete(ae),te(),xe},_t.add=function(Ct){var te=JSON.parse(JSON.stringify(G(Ct))).features.map(function(ae){if(ae.id=ae.id||$n(),ae.geometry===null)throw new Error("Invalid geometry: null");if(yt.store.get(ae.id)===void 0||yt.store.get(ae.id).type!==ae.geometry.type){var xe=sa[ae.geometry.type];if(xe===void 0)throw new Error("Invalid geometry type: "+ae.geometry.type+".");var we=new xe(yt,ae);yt.store.add(we)}else{var me=yt.store.get(ae.id);me.properties=ae.properties,kr(me.properties,ae.properties)||yt.store.featureChanged(me.id),kr(me.getCoordinates(),ae.geometry.coordinates)||me.incomingCoords(ae.geometry.coordinates)}return ae.id});return yt.store.render(),te},_t.get=function(Ct){var te=yt.store.get(Ct);if(te)return te.toGeoJSON()},_t.getAll=function(){return{type:Z.FEATURE_COLLECTION,features:yt.store.getAll().map(function(Ct){return Ct.toGeoJSON()})}},_t.delete=function(Ct){return yt.store.delete(Ct,{silent:!0}),_t.getMode()!==W.DIRECT_SELECT||yt.store.getSelectedIds().length?yt.store.render():yt.events.changeMode(W.SIMPLE_SELECT,void 0,{silent:!0}),_t},_t.deleteAll=function(){return yt.store.delete(yt.store.getAllIds(),{silent:!0}),_t.getMode()===W.DIRECT_SELECT?yt.events.changeMode(W.SIMPLE_SELECT,void 0,{silent:!0}):yt.store.render(),_t},_t.changeMode=function(Ct,te){return te===void 0&&(te={}),Ct===W.SIMPLE_SELECT&&_t.getMode()===W.SIMPLE_SELECT?(Yh(te.featureIds||[],yt.store.getSelectedIds())||(yt.store.setSelected(te.featureIds,{silent:!0}),yt.store.render()),_t):(Ct===W.DIRECT_SELECT&&_t.getMode()===W.DIRECT_SELECT&&te.featureId===yt.store.getSelectedIds()[0]||yt.events.changeMode(Ct,te,{silent:!0}),_t)},_t.getMode=function(){return yt.events.getMode()},_t.trash=function(){return yt.events.trash({silent:!0}),_t},_t.combineFeatures=function(){return yt.events.combineFeatures({silent:!0}),_t},_t.uncombineFeatures=function(){return yt.events.uncombineFeatures({silent:!0}),_t},_t.setFeatureProperty=function(Ct,te,ae){return yt.store.setFeatureProperty(Ct,te,ae),_t},_t}(X,A),X.api=A;var at=$i(X);return A.onAdd=at.onAdd,A.onRemove=at.onRemove,A.types=$,A.options=E,A};function Zh(E){yl(E,this)}return Zh.modes=oo,Zh.constants=Ot,Zh.lib=pd,Zh})})(UI);var zN=UI.exports;const o0=VI(zN),BN=rn.createContext(null);function $N(t,e){const n=Array.isArray(t)?t[0]:t?t.x:0,r=Array.isArray(t)?t[1]:t?t.y:0,i=Array.isArray(e)?e[0]:e?e.x:0,a=Array.isArray(e)?e[1]:e?e.y:0;return n===i&&r===a}function yp(t,e){if(t===e)return!0;if(!t||!e)return!1;if(Array.isArray(t)){if(!Array.isArray(e)||t.length!==e.length)return!1;for(let n=0;n<t.length;n++)if(!yp(t[n],e[n]))return!1;return!0}else if(Array.isArray(e))return!1;if(typeof t=="object"&&typeof e=="object"){const n=Object.keys(t),r=Object.keys(e);if(n.length!==r.length)return!1;for(const i of n)if(!e.hasOwnProperty(i)||!yp(t[i],e[i]))return!1;return!0}return!1}function VN(t){const e=t.clone();return e.pixelsToGLUnits=t.pixelsToGLUnits,e}function W1(t,e){if(!t.getProjection)return;const n=t.getProjection(),r=e.getProjection();yp(n,r)||e.setProjection(n)}function J1(t){return{longitude:t.center.lng,latitude:t.center.lat,zoom:t.zoom,pitch:t.pitch,bearing:t.bearing,padding:t.padding}}function K1(t,e){const n=e.viewState||e;let r=!1;if("longitude"in n&&"latitude"in n){const i=t.center;t.center=new i.constructor(n.longitude,n.latitude),r=r||i!==t.center}if("zoom"in n){const i=t.zoom;t.zoom=n.zoom,r=r||i!==t.zoom}if("bearing"in n){const i=t.bearing;t.bearing=n.bearing,r=r||i!==t.bearing}if("pitch"in n){const i=t.pitch;t.pitch=n.pitch,r=r||i!==t.pitch}return n.padding&&!t.isPaddingEqual(n.padding)&&(r=!0,t.padding=n.padding),r}const UN=["type","source","source-layer","minzoom","maxzoom","filter","layout"];function Q1(t){if(!t)return null;if(typeof t=="string"||("toJS"in t&&(t=t.toJS()),!t.layers))return t;const e={};for(const r of t.layers)e[r.id]=r;const n=t.layers.map(r=>{let i=null;"interactive"in r&&(i=Object.assign({},r),delete i.interactive);const a=e[r.ref];if(a){i=i||Object.assign({},r),delete i.ref;for(const h of UN)h in a&&(i[h]=a[h])}return i||r});return{...t,layers:n}}var tE={};const eE={version:8,sources:{},layers:[]},nE={mousedown:"onMouseDown",mouseup:"onMouseUp",mouseover:"onMouseOver",mousemove:"onMouseMove",click:"onClick",dblclick:"onDblClick",mouseenter:"onMouseEnter",mouseleave:"onMouseLeave",mouseout:"onMouseOut",contextmenu:"onContextMenu",touchstart:"onTouchStart",touchend:"onTouchEnd",touchmove:"onTouchMove",touchcancel:"onTouchCancel"},Sx={movestart:"onMoveStart",move:"onMove",moveend:"onMoveEnd",dragstart:"onDragStart",drag:"onDrag",dragend:"onDragEnd",zoomstart:"onZoomStart",zoom:"onZoom",zoomend:"onZoomEnd",rotatestart:"onRotateStart",rotate:"onRotate",rotateend:"onRotateEnd",pitchstart:"onPitchStart",pitch:"onPitch",pitchend:"onPitchEnd"},rE={wheel:"onWheel",boxzoomstart:"onBoxZoomStart",boxzoomend:"onBoxZoomEnd",boxzoomcancel:"onBoxZoomCancel",resize:"onResize",load:"onLoad",render:"onRender",idle:"onIdle",remove:"onRemove",data:"onData",styledata:"onStyleData",sourcedata:"onSourceData",error:"onError"},GN=["minZoom","maxZoom","minPitch","maxPitch","maxBounds","projection","renderWorldCopies"],qN=["scrollZoom","boxZoom","dragRotate","dragPan","keyboard","doubleClickZoom","touchZoomRotate","touchPitch"];let $x=class Vx{constructor(e,n,r){this._map=null,this._internalUpdate=!1,this._inRender=!1,this._hoveredFeatures=null,this._deferredEvents={move:!1,zoom:!1,pitch:!1,rotate:!1},this._onEvent=i=>{const a=this.props[rE[i.type]];a?a(i):i.type==="error"&&console.error(i.error)},this._onPointerEvent=i=>{(i.type==="mousemove"||i.type==="mouseout")&&this._updateHover(i);const a=this.props[nE[i.type]];a&&(this.props.interactiveLayerIds&&i.type!=="mouseover"&&i.type!=="mouseout"&&(i.features=this._hoveredFeatures||this._queryRenderedFeatures(i.point)),a(i),delete i.features)},this._onCameraEvent=i=>{if(!this._internalUpdate){const a=this.props[Sx[i.type]];a&&a(i)}i.type in this._deferredEvents&&(this._deferredEvents[i.type]=!1)},this._MapClass=e,this.props=n,this._initialize(r)}get map(){return this._map}get transform(){return this._renderTransform}setProps(e){const n=this.props;this.props=e;const r=this._updateSettings(e,n);r&&this._createShadowTransform(this._map);const i=this._updateSize(e),a=this._updateViewState(e,!0);this._updateStyle(e,n),this._updateStyleComponents(e,n),this._updateHandlers(e,n),(r||i||a&&!this._map.isMoving())&&this.redraw()}static reuse(e,n){const r=Vx.savedMaps.pop();if(!r)return null;const i=r.map,a=i.getContainer();for(n.className=a.className;a.childNodes.length>0;)n.appendChild(a.childNodes[0]);i._container=n;const h=i._resizeObserver;h&&(h.disconnect(),h.observe(n)),r.setProps({...e,styleDiffing:!1}),i.resize();const{initialViewState:u}=e;return u&&(u.bounds?i.fitBounds(u.bounds,{...u.fitBoundsOptions,duration:0}):r._updateViewState(u,!1)),i.isStyleLoaded()?i.fire("load"):i.once("styledata",()=>i.fire("load")),i._update(),r}_initialize(e){const{props:n}=this,{mapStyle:r=eE}=n,i={...n,...n.initialViewState,accessToken:n.mapboxAccessToken||jN()||null,container:e,style:Q1(r)},a=i.initialViewState||i.viewState||i;if(Object.assign(i,{center:[a.longitude||0,a.latitude||0],zoom:a.zoom||0,pitch:a.pitch||0,bearing:a.bearing||0}),n.gl){const C=HTMLCanvasElement.prototype.getContext;HTMLCanvasElement.prototype.getContext=()=>(HTMLCanvasElement.prototype.getContext=C,n.gl)}const h=new this._MapClass(i);a.padding&&h.setPadding(a.padding),n.cursor&&(h.getCanvas().style.cursor=n.cursor),this._createShadowTransform(h);const u=h._render;h._render=C=>{this._inRender=!0,u.call(h,C),this._inRender=!1};const _=h._renderTaskQueue.run;h._renderTaskQueue.run=C=>{_.call(h._renderTaskQueue,C),this._onBeforeRepaint()},h.on("render",()=>this._onAfterRepaint());const w=h.fire;h.fire=this._fireEvent.bind(this,w),h.on("resize",()=>{this._renderTransform.resize(h.transform.width,h.transform.height)}),h.on("styledata",()=>{this._updateStyleComponents(this.props,{}),W1(h.transform,this._renderTransform)}),h.on("sourcedata",()=>this._updateStyleComponents(this.props,{}));for(const C in nE)h.on(C,this._onPointerEvent);for(const C in Sx)h.on(C,this._onCameraEvent);for(const C in rE)h.on(C,this._onEvent);this._map=h}recycle(){const e=this.map.getContainer().querySelector("[mapboxgl-children]");e==null||e.remove(),Vx.savedMaps.push(this)}destroy(){this._map.remove()}redraw(){const e=this._map;!this._inRender&&e.style&&(e._frame&&(e._frame.cancel(),e._frame=null),e._render())}_createShadowTransform(e){const n=VN(e.transform);e.painter.transform=n,this._renderTransform=n}_updateSize(e){const{viewState:n}=e;if(n){const r=this._map;if(n.width!==r.transform.width||n.height!==r.transform.height)return r.resize(),!0}return!1}_updateViewState(e,n){if(this._internalUpdate)return!1;const r=this._map,i=this._renderTransform,{zoom:a,pitch:h,bearing:u}=i,_=r.isMoving();_&&(i.cameraElevationReference="sea");const w=K1(i,{...J1(r.transform),...e});if(_&&(i.cameraElevationReference="ground"),w&&n){const C=this._deferredEvents;C.move=!0,C.zoom||(C.zoom=a!==i.zoom),C.rotate||(C.rotate=u!==i.bearing),C.pitch||(C.pitch=h!==i.pitch)}return _||K1(r.transform,e),w}_updateSettings(e,n){const r=this._map;let i=!1;for(const a of GN)if(a in e&&!yp(e[a],n[a])){i=!0;const h=r[`set${a[0].toUpperCase()}${a.slice(1)}`];h==null||h.call(r,e[a])}return i}_updateStyle(e,n){if(e.cursor!==n.cursor&&(this._map.getCanvas().style.cursor=e.cursor||""),e.mapStyle!==n.mapStyle){const{mapStyle:r=eE,styleDiffing:i=!0}=e,a={diff:i};return"localIdeographFontFamily"in e&&(a.localIdeographFontFamily=e.localIdeographFontFamily),this._map.setStyle(Q1(r),a),!0}return!1}_updateStyleComponents(e,n){const r=this._map;let i=!1;return r.isStyleLoaded()&&("light"in e&&r.setLight&&!yp(e.light,n.light)&&(i=!0,r.setLight(e.light)),"fog"in e&&r.setFog&&!yp(e.fog,n.fog)&&(i=!0,r.setFog(e.fog)),"terrain"in e&&r.setTerrain&&!yp(e.terrain,n.terrain)&&(!e.terrain||r.getSource(e.terrain.source))&&(i=!0,r.setTerrain(e.terrain))),i}_updateHandlers(e,n){var r,i;const a=this._map;let h=!1;for(const u of qN){const _=(r=e[u])!==null&&r!==void 0?r:!0,w=(i=n[u])!==null&&i!==void 0?i:!0;yp(_,w)||(h=!0,_?a[u].enable(_):a[u].disable())}return h}_queryRenderedFeatures(e){const n=this._map,r=n.transform,{interactiveLayerIds:i=[]}=this.props;try{return n.transform=this._renderTransform,n.queryRenderedFeatures(e,{layers:i.filter(n.getLayer.bind(n))})}catch{return[]}finally{n.transform=r}}_updateHover(e){var n;const{props:r}=this;if(r.interactiveLayerIds&&(r.onMouseMove||r.onMouseEnter||r.onMouseLeave)){const i=e.type,a=((n=this._hoveredFeatures)===null||n===void 0?void 0:n.length)>0,h=this._queryRenderedFeatures(e.point),u=h.length>0;!u&&a&&(e.type="mouseleave",this._onPointerEvent(e)),this._hoveredFeatures=h,u&&!a&&(e.type="mouseenter",this._onPointerEvent(e)),e.type=i}else this._hoveredFeatures=null}_fireEvent(e,n,r){const i=this._map,a=i.transform,h=typeof n=="string"?n:n.type;return h==="move"&&this._updateViewState(this.props,!1),h in Sx&&(typeof n=="object"&&(n.viewState=J1(a)),this._map.isMoving())?(i.transform=this._renderTransform,e.call(i,n,r),i.transform=a,i):(e.call(i,n,r),i)}_onBeforeRepaint(){const e=this._map;this._internalUpdate=!0;for(const r in this._deferredEvents)this._deferredEvents[r]&&e.fire(r);this._internalUpdate=!1;const n=this._map.transform;e.transform=this._renderTransform,this._onAfterRepaint=()=>{W1(this._renderTransform,n),e.transform=n}}};$x.savedMaps=[];function jN(){let t=null;if(typeof location<"u"){const e=/access_token=([^&\/]*)/.exec(location.search);t=e&&e[1]}try{t=t||tE.MapboxAccessToken}catch{}try{t=t||tE.REACT_APP_MAPBOX_ACCESS_TOKEN}catch{}return t}const XN=["setMaxBounds","setMinZoom","setMaxZoom","setMinPitch","setMaxPitch","setRenderWorldCopies","setProjection","setStyle","addSource","removeSource","addLayer","removeLayer","setLayerZoomRange","setFilter","setPaintProperty","setLayoutProperty","setLight","setTerrain","setFog","remove"];function YN(t){if(!t)return null;const e=t.map,n={getMap:()=>e,getCenter:()=>t.transform.center,getZoom:()=>t.transform.zoom,getBearing:()=>t.transform.bearing,getPitch:()=>t.transform.pitch,getPadding:()=>t.transform.padding,getBounds:()=>t.transform.getBounds(),project:r=>{const i=e.transform;e.transform=t.transform;const a=e.project(r);return e.transform=i,a},unproject:r=>{const i=e.transform;e.transform=t.transform;const a=e.unproject(r);return e.transform=i,a},queryTerrainElevation:(r,i)=>{const a=e.transform;e.transform=t.transform;const h=e.queryTerrainElevation(r,i);return e.transform=a,h},queryRenderedFeatures:(r,i)=>{const a=e.transform;e.transform=t.transform;const h=e.queryRenderedFeatures(r,i);return e.transform=a,h}};for(const r of ZN(e))!(r in n)&&!XN.includes(r)&&(n[r]=e[r].bind(e));return n}function ZN(t){const e=new Set;let n=t;for(;n;){for(const r of Object.getOwnPropertyNames(n))r[0]!=="_"&&typeof t[r]=="function"&&r!=="fire"&&r!=="setEventedParent"&&e.add(r);n=Object.getPrototypeOf(n)}return Array.from(e)}const HN=typeof document<"u"?rn.useLayoutEffect:rn.useEffect,WN=["baseApiUrl","maxParallelImageRequests","workerClass","workerCount","workerUrl"];function JN(t,e){for(const r of WN)r in e&&(t[r]=e[r]);const{RTLTextPlugin:n="https://api.mapbox.com/mapbox-gl-js/plugins/mapbox-gl-rtl-text/v0.2.3/mapbox-gl-rtl-text.js"}=e;n&&t.getRTLTextPluginStatus&&t.getRTLTextPluginStatus()==="unavailable"&&t.setRTLTextPlugin(n,r=>{r&&console.error(r)},!0)}const s0=rn.createContext(null);function KN(t,e,n){const r=rn.useContext(BN),[i,a]=rn.useState(null),h=rn.useRef(),{current:u}=rn.useRef({mapLib:null,map:null});rn.useEffect(()=>{const C=t.mapLib;let P=!0,D;return Promise.resolve(C||n).then(B=>{if(!P)return;if(!B)throw new Error("Invalid mapLib");const $="Map"in B?B:B.default;if(!$.Map)throw new Error("Invalid mapLib");if(JN($,t),!$.supported||$.supported(t))t.reuseMaps&&(D=$x.reuse(t,h.current)),D||(D=new $x($.Map,t,h.current)),u.map=YN(D),u.mapLib=$,a(D),r==null||r.onMapMount(u.map,t.id);else throw new Error("Map is not supported by this browser")}).catch(B=>{const{onError:$}=t;$?$({type:"error",target:null,originalEvent:null,error:B}):console.error(B)}),()=>{P=!1,D&&(r==null||r.onMapUnmount(t.id),t.reuseMaps?D.recycle():D.destroy())}},[]),HN(()=>{i&&i.setProps(t)}),rn.useImperativeHandle(e,()=>u.map,[i]);const _=rn.useMemo(()=>({position:"relative",width:"100%",height:"100%",...t.style}),[t.style]),w={height:"100%"};return rn.createElement("div",{id:t.id,ref:h,style:_},i&&rn.createElement(s0.Provider,{value:u},rn.createElement("div",{"mapboxgl-children":"",style:w},t.children)))}const QN=/box|flex|grid|column|lineHeight|fontWeight|opacity|order|tabSize|zIndex/;function rg(t,e){if(!t||!e)return;const n=t.style;for(const r in e){const i=e[r];Number.isFinite(i)&&!QN.test(r)?n[r]=`${i}px`:n[r]=i}}function tP(t,e){const{map:n,mapLib:r}=rn.useContext(s0),i=rn.useRef({props:t});i.current.props=t;const a=rn.useMemo(()=>{let Z=!1;rn.Children.forEach(t.children,ct=>{ct&&(Z=!0)});const W={...t,element:Z?document.createElement("div"):null},rt=new r.Marker(W);return rt.setLngLat([t.longitude,t.latitude]),rt.getElement().addEventListener("click",ct=>{var pt,gt;(gt=(pt=i.current.props).onClick)===null||gt===void 0||gt.call(pt,{type:"click",target:rt,originalEvent:ct})}),rt.on("dragstart",ct=>{var pt,gt;const Ut=ct;Ut.lngLat=a.getLngLat(),(gt=(pt=i.current.props).onDragStart)===null||gt===void 0||gt.call(pt,Ut)}),rt.on("drag",ct=>{var pt,gt;const Ut=ct;Ut.lngLat=a.getLngLat(),(gt=(pt=i.current.props).onDrag)===null||gt===void 0||gt.call(pt,Ut)}),rt.on("dragend",ct=>{var pt,gt;const Ut=ct;Ut.lngLat=a.getLngLat(),(gt=(pt=i.current.props).onDragEnd)===null||gt===void 0||gt.call(pt,Ut)}),rt},[]);rn.useEffect(()=>(a.addTo(n.getMap()),()=>{a.remove()}),[]);const{longitude:h,latitude:u,offset:_,style:w,draggable:C=!1,popup:P=null,rotation:D=0,rotationAlignment:B="auto",pitchAlignment:$="auto"}=t;return rn.useEffect(()=>{rg(a.getElement(),w)},[w]),rn.useImperativeHandle(e,()=>a,[]),(a.getLngLat().lng!==h||a.getLngLat().lat!==u)&&a.setLngLat([h,u]),_&&!$N(a.getOffset(),_)&&a.setOffset(_),a.isDraggable()!==C&&a.setDraggable(C),a.getRotation()!==D&&a.setRotation(D),a.getRotationAlignment()!==B&&a.setRotationAlignment(B),a.getPitchAlignment()!==$&&a.setPitchAlignment($),a.getPopup()!==P&&a.setPopup(P),$I.createPortal(t.children,a.getElement())}rn.memo(rn.forwardRef(tP));function iE(t){return new Set(t?t.trim().split(/\s+/):[])}function eP(t,e){const{map:n,mapLib:r}=rn.useContext(s0),i=rn.useMemo(()=>document.createElement("div"),[]),a=rn.useRef({props:t});a.current.props=t;const h=rn.useMemo(()=>{const u={...t},_=new r.Popup(u);return _.setLngLat([t.longitude,t.latitude]),_.once("open",w=>{var C,P;(P=(C=a.current.props).onOpen)===null||P===void 0||P.call(C,w)}),_},[]);if(rn.useEffect(()=>{const u=_=>{var w,C;(C=(w=a.current.props).onClose)===null||C===void 0||C.call(w,_)};return h.on("close",u),h.setDOMContent(i).addTo(n.getMap()),()=>{h.off("close",u),h.isOpen()&&h.remove()}},[]),rn.useEffect(()=>{rg(h.getElement(),t.style)},[t.style]),rn.useImperativeHandle(e,()=>h,[]),h.isOpen()&&((h.getLngLat().lng!==t.longitude||h.getLngLat().lat!==t.latitude)&&h.setLngLat([t.longitude,t.latitude]),t.offset&&!yp(h.options.offset,t.offset)&&h.setOffset(t.offset),(h.options.anchor!==t.anchor||h.options.maxWidth!==t.maxWidth)&&(h.options.anchor=t.anchor,h.setMaxWidth(t.maxWidth)),h.options.className!==t.className)){const u=iE(h.options.className),_=iE(t.className);for(const w of u)_.has(w)||h.removeClassName(w);for(const w of _)u.has(w)||h.addClassName(w);h.options.className=t.className}return $I.createPortal(t.children,i)}rn.memo(rn.forwardRef(eP));function ig(t,e,n,r){const i=rn.useContext(s0),a=rn.useMemo(()=>t(i),[]);return rn.useEffect(()=>{const h=r||n||e,u=typeof e=="function"&&typeof n=="function"?e:null,_=typeof n=="function"?n:typeof e=="function"?e:null,{map:w}=i;return w.hasControl(a)||(w.addControl(a,h==null?void 0:h.position),u&&u(i)),()=>{_&&_(i),w.hasControl(a)&&w.removeControl(a)}},[]),a}function nP(t){const e=ig(({mapLib:n})=>new n.AttributionControl(t),{position:t.position});return rn.useEffect(()=>{rg(e._container,t.style)},[t.style]),null}rn.memo(nP);function rP(t){const e=ig(({mapLib:n})=>new n.FullscreenControl({container:t.containerId&&document.getElementById(t.containerId)}),{position:t.position});return rn.useEffect(()=>{rg(e._controlContainer,t.style)},[t.style]),null}rn.memo(rP);function iP(t,e){const n=rn.useRef({props:t}),r=ig(({mapLib:i})=>{const a=new i.GeolocateControl(t),h=a._setupUI;return a._setupUI=u=>{a._container.hasChildNodes()||h(u)},a.on("geolocate",u=>{var _,w;(w=(_=n.current.props).onGeolocate)===null||w===void 0||w.call(_,u)}),a.on("error",u=>{var _,w;(w=(_=n.current.props).onError)===null||w===void 0||w.call(_,u)}),a.on("outofmaxbounds",u=>{var _,w;(w=(_=n.current.props).onOutOfMaxBounds)===null||w===void 0||w.call(_,u)}),a.on("trackuserlocationstart",u=>{var _,w;(w=(_=n.current.props).onTrackUserLocationStart)===null||w===void 0||w.call(_,u)}),a.on("trackuserlocationend",u=>{var _,w;(w=(_=n.current.props).onTrackUserLocationEnd)===null||w===void 0||w.call(_,u)}),a},{position:t.position});return n.current.props=t,rn.useImperativeHandle(e,()=>r,[]),rn.useEffect(()=>{rg(r._container,t.style)},[t.style]),null}rn.memo(rn.forwardRef(iP));function oP(t){const e=ig(({mapLib:n})=>new n.NavigationControl(t),{position:t.position});return rn.useEffect(()=>{rg(e._container,t.style)},[t.style]),null}rn.memo(oP);function sP(t){const e=ig(({mapLib:a})=>new a.ScaleControl(t),{position:t.position}),n=rn.useRef(t),r=n.current;n.current=t;const{style:i}=t;return t.maxWidth!==void 0&&t.maxWidth!==r.maxWidth&&(e.options.maxWidth=t.maxWidth),t.unit!==void 0&&t.unit!==r.unit&&e.setUnit(t.unit),rn.useEffect(()=>{rg(e._container,i)},[i]),null}rn.memo(sP);const aP=kN(()=>import("./index.es64-KR_AuFpw.js"),__vite__mapDeps([]),import.meta.url).then(t=>t.i);rn.forwardRef(function(t,e){return KN(t,e,aP)});rn.forwardRef((t,e)=>{const n=ig(()=>new o0(t),({map:r})=>{r.on("draw.create",t.onCreate),r.on("draw.update",t.onUpdate),r.on("draw.delete",t.onDelete)},({map:r})=>{r.off("draw.create",t.onCreate),r.off("draw.update",t.onUpdate),r.off("draw.delete",t.onDelete)},{position:t.position});return rn.useImperativeHandle(e,()=>n,[n]),null});var GI={exports:{}},Cy={},oE;function uP(){if(oE)return Cy;oE=1;/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var t=Bx,e=Symbol.for("react.element"),n=Symbol.for("react.fragment"),r=Object.prototype.hasOwnProperty,i=t.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,a={key:!0,ref:!0,__self:!0,__source:!0};function h(u,_,w){var C,P={},D=null,B=null;w!==void 0&&(D=""+w),_.key!==void 0&&(D=""+_.key),_.ref!==void 0&&(B=_.ref);for(C in _)r.call(_,C)&&!a.hasOwnProperty(C)&&(P[C]=_[C]);if(u&&u.defaultProps)for(C in _=u.defaultProps,_)P[C]===void 0&&(P[C]=_[C]);return{$$typeof:e,type:u,key:D,ref:B,props:P,_owner:i.current}}return Cy.Fragment=n,Cy.jsx=h,Cy.jsxs=h,Cy}GI.exports=uP();var hv=GI.exports;const lP={type:"circle",paint:{"circle-radius":["interpolate",["linear"],["number",["get","point_count"],1],0,4,10,14],"circle-stroke-width":1,"circle-color":["case",["boolean",["feature-state","hover"],!1],"#3b62ff","#ff623b"],"circle-stroke-color":"#8d260c"}},cP={type:"fill",paint:{"fill-color":"#ff623b","fill-opacity":.2}},hP={type:"line",paint:{"line-color":"#ff623b","line-opacity":.6}},Cx={point:lP,fill:cP,stroke:hP};var qI={exports:{}};(function(t,e){(function(n,r){t.exports=r()})(zg,function(){var n,r,i;function a(u,_){if(!n)n=_;else if(!r)r=_;else{var w="var sharedChunk = {}; ("+n+")(sharedChunk); ("+r+")(sharedChunk);",C={};n(C),i=_(C),typeof window<"u"&&(i.workerUrl=window.URL.createObjectURL(new Blob([w],{type:"text/javascript"})))}}a(["exports"],function(u){function _(l,o,c,f){return new(c||(c=Promise))(function(g,x){function b(M){try{L(f.next(M))}catch(R){x(R)}}function I(M){try{L(f.throw(M))}catch(R){x(R)}}function L(M){var R;M.done?g(M.value):(R=M.value,R instanceof c?R:new c(function(z){z(R)})).then(b,I)}L((f=f.apply(l,o||[])).next())})}function w(l){return l&&l.__esModule&&Object.prototype.hasOwnProperty.call(l,"default")?l.default:l}typeof SuppressedError=="function"&&SuppressedError;var C=P;function P(l,o){this.x=l,this.y=o}P.prototype={clone:function(){return new P(this.x,this.y)},add:function(l){return this.clone()._add(l)},sub:function(l){return this.clone()._sub(l)},multByPoint:function(l){return this.clone()._multByPoint(l)},divByPoint:function(l){return this.clone()._divByPoint(l)},mult:function(l){return this.clone()._mult(l)},div:function(l){return this.clone()._div(l)},rotate:function(l){return this.clone()._rotate(l)},rotateAround:function(l,o){return this.clone()._rotateAround(l,o)},matMult:function(l){return this.clone()._matMult(l)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(l){return this.x===l.x&&this.y===l.y},dist:function(l){return Math.sqrt(this.distSqr(l))},distSqr:function(l){var o=l.x-this.x,c=l.y-this.y;return o*o+c*c},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(l){return Math.atan2(this.y-l.y,this.x-l.x)},angleWith:function(l){return this.angleWithSep(l.x,l.y)},angleWithSep:function(l,o){return Math.atan2(this.x*o-this.y*l,this.x*l+this.y*o)},_matMult:function(l){var o=l[2]*this.x+l[3]*this.y;return this.x=l[0]*this.x+l[1]*this.y,this.y=o,this},_add:function(l){return this.x+=l.x,this.y+=l.y,this},_sub:function(l){return this.x-=l.x,this.y-=l.y,this},_mult:function(l){return this.x*=l,this.y*=l,this},_div:function(l){return this.x/=l,this.y/=l,this},_multByPoint:function(l){return this.x*=l.x,this.y*=l.y,this},_divByPoint:function(l){return this.x/=l.x,this.y/=l.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var l=this.y;return this.y=this.x,this.x=-l,this},_rotate:function(l){var o=Math.cos(l),c=Math.sin(l),f=c*this.x+o*this.y;return this.x=o*this.x-c*this.y,this.y=f,this},_rotateAround:function(l,o){var c=Math.cos(l),f=Math.sin(l),g=o.y+f*(this.x-o.x)+c*(this.y-o.y);return this.x=o.x+c*(this.x-o.x)-f*(this.y-o.y),this.y=g,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},P.convert=function(l){return l instanceof P?l:Array.isArray(l)?new P(l[0],l[1]):l};var D=w(C),B=$;function $(l,o,c,f){this.cx=3*l,this.bx=3*(c-l)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*o,this.by=3*(f-o)-this.cy,this.ay=1-this.cy-this.by,this.p1x=l,this.p1y=o,this.p2x=c,this.p2y=f}$.prototype={sampleCurveX:function(l){return((this.ax*l+this.bx)*l+this.cx)*l},sampleCurveY:function(l){return((this.ay*l+this.by)*l+this.cy)*l},sampleCurveDerivativeX:function(l){return(3*this.ax*l+2*this.bx)*l+this.cx},solveCurveX:function(l,o){if(o===void 0&&(o=1e-6),l<0)return 0;if(l>1)return 1;for(var c=l,f=0;f<8;f++){var g=this.sampleCurveX(c)-l;if(Math.abs(g)<o)return c;var x=this.sampleCurveDerivativeX(c);if(Math.abs(x)<1e-6)break;c-=g/x}var b=0,I=1;for(c=l,f=0;f<20&&(g=this.sampleCurveX(c),!(Math.abs(g-l)<o));f++)l>g?b=c:I=c,c=.5*(I-b)+b;return c},solve:function(l,o){return this.sampleCurveY(this.solveCurveX(l,o))}};var Z=w(B);let W,rt;function ct(){return W==null&&(W=typeof OffscreenCanvas<"u"&&new OffscreenCanvas(1,1).getContext("2d")&&typeof createImageBitmap=="function"),W}function pt(){if(rt==null&&(rt=!1,ct())){const l=new OffscreenCanvas(5,5).getContext("2d",{willReadFrequently:!0});if(l){for(let c=0;c<5*5;c++){const f=4*c;l.fillStyle=`rgb(${f},${f+1},${f+2})`,l.fillRect(c%5,Math.floor(c/5),1,1)}const o=l.getImageData(0,0,5,5).data;for(let c=0;c<5*5*4;c++)if(c%4!=3&&o[c]!==c){rt=!0;break}}}return rt||!1}function gt(l,o,c,f){const g=new Z(l,o,c,f);return function(x){return g.solve(x)}}const Ut=gt(.25,.1,.25,1);function zt(l,o,c){return Math.min(c,Math.max(o,l))}function Ot(l,o,c){const f=c-o,g=((l-o)%f+f)%f+o;return g===o?c:g}function At(l,...o){for(const c of o)for(const f in c)l[f]=c[f];return l}let Rt=1;function Yt(l,o,c){const f={};for(const g in l)f[g]=o.call(c||this,l[g],g,l);return f}function be(l,o,c){const f={};for(const g in l)o.call(c||this,l[g],g,l)&&(f[g]=l[g]);return f}function Kt(l){return Array.isArray(l)?l.map(Kt):typeof l=="object"&&l?Yt(l,Kt):l}const Ke={};function vt(l){Ke[l]||(typeof console<"u"&&console.warn(l),Ke[l]=!0)}function Qt(l,o,c){return(c.y-l.y)*(o.x-l.x)>(o.y-l.y)*(c.x-l.x)}function Te(l){let o=0;for(let c,f,g=0,x=l.length,b=x-1;g<x;b=g++)c=l[g],f=l[b],o+=(f.x-c.x)*(c.y+f.y);return o}function Ge(){return typeof WorkerGlobalScope<"u"&&typeof self<"u"&&self instanceof WorkerGlobalScope}let gn=null;function xn(l){return typeof ImageBitmap<"u"&&l instanceof ImageBitmap}const ei="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";function jn(l,o,c,f,g){return _(this,void 0,void 0,function*(){if(typeof VideoFrame>"u")throw new Error("VideoFrame not supported");const x=new VideoFrame(l,{timestamp:0});try{const b=x==null?void 0:x.format;if(!b||!b.startsWith("BGR")&&!b.startsWith("RGB"))throw new Error(`Unrecognized format ${b}`);const I=b.startsWith("BGR"),L=new Uint8ClampedArray(f*g*4);if(yield x.copyTo(L,function(M,R,z,U,Y){const H=4*Math.max(-R,0),Q=(Math.max(0,z)-z)*U*4+H,ut=4*U,ht=Math.max(0,R),Et=Math.max(0,z);return{rect:{x:ht,y:Et,width:Math.min(M.width,R+U)-ht,height:Math.min(M.height,z+Y)-Et},layout:[{offset:Q,stride:ut}]}}(l,o,c,f,g)),I)for(let M=0;M<L.length;M+=4){const R=L[M];L[M]=L[M+2],L[M+2]=R}return L}finally{x.close()}})}let $n,Fe,Vn,rr;const ci={now:typeof performance<"u"&&performance&&performance.now?performance.now.bind(performance):Date.now.bind(Date),frame(l){const o=requestAnimationFrame(l);return{cancel:()=>cancelAnimationFrame(o)}},getImageData(l,o=0){return this.getImageCanvasContext(l).getImageData(-o,-o,l.width+2*o,l.height+2*o)},getImageCanvasContext(l){const o=window.document.createElement("canvas"),c=o.getContext("2d",{willReadFrequently:!0});if(!c)throw new Error("failed to create canvas 2d context");return o.width=l.width,o.height=l.height,c.drawImage(l,0,0,l.width,l.height),c},resolveURL:l=>(Vn||(Vn=document.createElement("a")),Vn.href=l,Vn.href),hardwareConcurrency:typeof navigator<"u"&&navigator.hardwareConcurrency||4,get prefersReducedMotion(){return!!matchMedia&&(rr==null&&(rr=matchMedia("(prefers-reduced-motion: reduce)")),rr.matches)}},fl={MAX_PARALLEL_IMAGE_REQUESTS:16,MAX_PARALLEL_IMAGE_REQUESTS_PER_FRAME:8,MAX_TILE_CACHE_ZOOM_LEVELS:5,REGISTERED_PROTOCOLS:{},WORKER_URL:""};class ks extends Error{constructor(o,c,f,g){super(`AJAXError: ${c} (${o}): ${f}`),this.status=o,this.statusText=c,this.url=f,this.body=g}}const br=Ge()?()=>self.worker&&self.worker.referrer:()=>(window.location.protocol==="blob:"?window.parent:window).location.href,nn=l=>fl.REGISTERED_PROTOCOLS[l.substring(0,l.indexOf("://"))];function dl(l,o){const c=new AbortController,f=new Request(l.url,{method:l.method||"GET",body:l.body,credentials:l.credentials,headers:l.headers,cache:l.cache,referrer:br(),signal:c.signal});let g=!1,x=!1;return l.type==="json"&&f.headers.set("Accept","application/json"),x||fetch(f).then(b=>b.ok?(I=>{(l.type==="arrayBuffer"||l.type==="image"?I.arrayBuffer():l.type==="json"?I.json():I.text()).then(L=>{x||(g=!0,o(null,L,I.headers.get("Cache-Control"),I.headers.get("Expires")))}).catch(L=>{x||o(new Error(L.message))})})(b):b.blob().then(I=>o(new ks(b.status,b.statusText,l.url,I)))).catch(b=>{b.code!==20&&o(new Error(b.message))}),{cancel:()=>{x=!0,g||c.abort()}}}const qo=function(l,o){if(/:\/\//.test(l.url)&&!/^https?:|^file:/.test(l.url)){if(Ge()&&self.worker&&self.worker.actor)return self.worker.actor.send("getResource",l,o);if(!Ge())return(nn(l.url)||dl)(l,o)}if(!(/^file:/.test(c=l.url)||/^file:/.test(br())&&!/^\w+:/.test(c))){if(fetch&&Request&&AbortController&&Object.prototype.hasOwnProperty.call(Request.prototype,"signal"))return dl(l,o);if(Ge()&&self.worker&&self.worker.actor)return self.worker.actor.send("getResource",l,o,void 0,!0)}var c;return function(f,g){const x=new XMLHttpRequest;x.open(f.method||"GET",f.url,!0),f.type!=="arrayBuffer"&&f.type!=="image"||(x.responseType="arraybuffer");for(const b in f.headers)x.setRequestHeader(b,f.headers[b]);return f.type==="json"&&(x.responseType="text",x.setRequestHeader("Accept","application/json")),x.withCredentials=f.credentials==="include",x.onerror=()=>{g(new Error(x.statusText))},x.onload=()=>{if((x.status>=200&&x.status<300||x.status===0)&&x.response!==null){let b=x.response;if(f.type==="json")try{b=JSON.parse(x.response)}catch(I){return g(I)}g(null,b,x.getResponseHeader("Cache-Control"),x.getResponseHeader("Expires"))}else{const b=new Blob([x.response],{type:x.getResponseHeader("Content-Type")});g(new ks(x.status,x.statusText,f.url,b))}},x.send(f.body),{cancel:()=>x.abort()}}(l,o)},Fn=function(l,o){return qo(At(l,{type:"arrayBuffer"}),o)};function Xn(l){if(!l||l.indexOf("://")<=0||l.indexOf("data:image/")===0||l.indexOf("blob:")===0)return!0;const o=new URL(l),c=window.location;return o.protocol===c.protocol&&o.host===c.host}function mn(l,o,c){c[l]&&c[l].indexOf(o)!==-1||(c[l]=c[l]||[],c[l].push(o))}function Un(l,o,c){if(c&&c[l]){const f=c[l].indexOf(o);f!==-1&&c[l].splice(f,1)}}class Ci{constructor(o,c={}){At(this,c),this.type=o}}class Yn extends Ci{constructor(o,c={}){super("error",At({error:o},c))}}class no{on(o,c){return this._listeners=this._listeners||{},mn(o,c,this._listeners),this}off(o,c){return Un(o,c,this._listeners),Un(o,c,this._oneTimeListeners),this}once(o,c){return c?(this._oneTimeListeners=this._oneTimeListeners||{},mn(o,c,this._oneTimeListeners),this):new Promise(f=>this.once(o,f))}fire(o,c){typeof o=="string"&&(o=new Ci(o,c||{}));const f=o.type;if(this.listens(f)){o.target=this;const g=this._listeners&&this._listeners[f]?this._listeners[f].slice():[];for(const I of g)I.call(this,o);const x=this._oneTimeListeners&&this._oneTimeListeners[f]?this._oneTimeListeners[f].slice():[];for(const I of x)Un(f,I,this._oneTimeListeners),I.call(this,o);const b=this._eventedParent;b&&(At(o,typeof this._eventedParentData=="function"?this._eventedParentData():this._eventedParentData),b.fire(o))}else o instanceof Yn&&console.error(o.error);return this}listens(o){return this._listeners&&this._listeners[o]&&this._listeners[o].length>0||this._oneTimeListeners&&this._oneTimeListeners[o]&&this._oneTimeListeners[o].length>0||this._eventedParent&&this._eventedParent.listens(o)}setEventedParent(o,c){return this._eventedParent=o,this._eventedParentData=c,this}}var Vt={$version:8,$root:{version:{required:!0,type:"enum",values:[8]},name:{type:"string"},metadata:{type:"*"},center:{type:"array",value:"number"},zoom:{type:"number"},bearing:{type:"number",default:0,period:360,units:"degrees"},pitch:{type:"number",default:0,units:"degrees"},light:{type:"light"},terrain:{type:"terrain"},sources:{required:!0,type:"sources"},sprite:{type:"sprite"},glyphs:{type:"string"},transition:{type:"transition"},layers:{required:!0,type:"array",value:"layer"}},sources:{"*":{type:"source"}},source:["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],source_vector:{type:{required:!0,type:"enum",values:{vector:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},attribution:{type:"string"},promoteId:{type:"promoteId"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster:{type:{required:!0,type:"enum",values:{raster:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},attribution:{type:"string"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster_dem:{type:{required:!0,type:"enum",values:{"raster-dem":{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},attribution:{type:"string"},encoding:{type:"enum",values:{terrarium:{},mapbox:{},custom:{}},default:"mapbox"},redFactor:{type:"number",default:1},blueFactor:{type:"number",default:1},greenFactor:{type:"number",default:1},baseShift:{type:"number",default:0},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_geojson:{type:{required:!0,type:"enum",values:{geojson:{}}},data:{required:!0,type:"*"},maxzoom:{type:"number",default:18},attribution:{type:"string"},buffer:{type:"number",default:128,maximum:512,minimum:0},filter:{type:"*"},tolerance:{type:"number",default:.375},cluster:{type:"boolean",default:!1},clusterRadius:{type:"number",default:50,minimum:0},clusterMaxZoom:{type:"number"},clusterMinPoints:{type:"number"},clusterProperties:{type:"*"},lineMetrics:{type:"boolean",default:!1},generateId:{type:"boolean",default:!1},promoteId:{type:"promoteId"}},source_video:{type:{required:!0,type:"enum",values:{video:{}}},urls:{required:!0,type:"array",value:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},source_image:{type:{required:!0,type:"enum",values:{image:{}}},url:{required:!0,type:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},layer:{id:{type:"string",required:!0},type:{type:"enum",values:{fill:{},line:{},symbol:{},circle:{},heatmap:{},"fill-extrusion":{},raster:{},hillshade:{},background:{}},required:!0},metadata:{type:"*"},source:{type:"string"},"source-layer":{type:"string"},minzoom:{type:"number",minimum:0,maximum:24},maxzoom:{type:"number",minimum:0,maximum:24},filter:{type:"filter"},layout:{type:"layout"},paint:{type:"paint"}},layout:["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_background"],layout_background:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_fill:{"fill-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_circle:{"circle-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_heatmap:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},"layout_fill-extrusion":{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_line:{"line-cap":{type:"enum",values:{butt:{},round:{},square:{}},default:"butt",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-join":{type:"enum",values:{bevel:{},round:{},miter:{}},default:"miter",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{type:"number",default:2,requires:[{"line-join":"miter"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-round-limit":{type:"number",default:1.05,requires:[{"line-join":"round"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_symbol:{"symbol-placement":{type:"enum",values:{point:{},line:{},"line-center":{}},default:"point",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-spacing":{type:"number",default:250,minimum:1,units:"pixels",requires:[{"symbol-placement":"line"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{type:"boolean",default:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{type:"enum",values:{auto:{},"viewport-y":{},source:{}},default:"auto",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{type:"boolean",default:!1,requires:["icon-image",{"!":"icon-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{type:"boolean",default:!1,requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-optional":{type:"boolean",default:!1,requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-size":{type:"number",default:1,minimum:0,units:"factor of the original icon size",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{type:"enum",values:{none:{},width:{},height:{},both:{}},default:"none",requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{type:"array",value:"number",length:4,default:[0,0,0,0],units:"pixels",requires:["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-image":{type:"resolvedImage",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{type:"padding",default:[2],units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-keep-upright":{type:"boolean",default:!1,requires:["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-offset":{type:"array",value:"number",length:2,default:[0,0],requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{type:"enum",values:{map:{},viewport:{},"viewport-glyph":{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-field":{type:"formatted",default:"",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-font":{type:"array",value:"string",default:["Open Sans Regular","Arial Unicode MS Regular"],requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-size":{type:"number",default:16,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{type:"number",default:10,minimum:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{type:"number",default:1.2,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-letter-spacing":{type:"number",default:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-justify":{type:"enum",values:{auto:{},left:{},center:{},right:{}},default:"center",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{type:"number",units:"ems",default:0,requires:["text-field"],"property-type":"data-driven",expression:{interpolated:!0,parameters:["zoom","feature"]}},"text-variable-anchor":{type:"array",value:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-variable-anchor-offset":{type:"variableAnchorOffsetCollection",requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["text-field",{"!":"text-variable-anchor"}],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{type:"number",default:45,units:"degrees",requires:["text-field",{"symbol-placement":["line","line-center"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-writing-mode":{type:"array",value:"enum",values:{horizontal:{},vertical:{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-padding":{type:"number",default:2,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-keep-upright":{type:"boolean",default:!0,requires:["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-transform":{type:"enum",values:{none:{},uppercase:{},lowercase:{}},default:"none",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-offset":{type:"array",value:"number",units:"ems",length:2,default:[0,0],requires:["text-field",{"!":"text-radial-offset"}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{type:"boolean",default:!1,requires:["text-field",{"!":"text-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{type:"boolean",default:!1,requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-optional":{type:"boolean",default:!1,requires:["text-field","icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_raster:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_hillshade:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},filter:{type:"array",value:"*"},filter_operator:{type:"enum",values:{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},in:{},"!in":{},all:{},any:{},none:{},has:{},"!has":{},within:{}}},geometry_type:{type:"enum",values:{Point:{},LineString:{},Polygon:{}}},function:{expression:{type:"expression"},stops:{type:"array",value:"function_stop"},base:{type:"number",default:1,minimum:0},property:{type:"string",default:"$zoom"},type:{type:"enum",values:{identity:{},exponential:{},interval:{},categorical:{}},default:"exponential"},colorSpace:{type:"enum",values:{rgb:{},lab:{},hcl:{}},default:"rgb"},default:{type:"*",required:!1}},function_stop:{type:"array",minimum:0,maximum:24,value:["number","color"],length:2},expression:{type:"array",value:"*",minimum:1},light:{anchor:{type:"enum",default:"viewport",values:{map:{},viewport:{}},"property-type":"data-constant",transition:!1,expression:{interpolated:!1,parameters:["zoom"]}},position:{type:"array",default:[1.15,210,30],length:3,value:"number","property-type":"data-constant",transition:!0,expression:{interpolated:!0,parameters:["zoom"]}},color:{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},intensity:{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},terrain:{source:{type:"string",required:!0},exaggeration:{type:"number",minimum:0,default:1}},paint:["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_background"],paint_fill:{"fill-antialias":{type:"boolean",default:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{type:"color",transition:!0,requires:[{"!":"fill-pattern"},{"fill-antialias":!0}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-extrusion-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-extrusion-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"fill-extrusion-height":{type:"number",default:0,minimum:0,units:"meters",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{type:"number",default:0,minimum:0,units:"meters",transition:!0,requires:["fill-extrusion-height"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{type:"boolean",default:!0,transition:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_line:{"line-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"line-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["line-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-width":{type:"number",default:1,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{type:"number",default:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{type:"array",value:"number",minimum:0,transition:!0,units:"line widths",requires:[{"!":"line-pattern"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"line-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-gradient":{type:"color",transition:!1,requires:[{"!":"line-dasharray"},{"!":"line-pattern"},{source:"geojson",has:{lineMetrics:!0}}],expression:{interpolated:!0,parameters:["line-progress"]},"property-type":"color-ramp"}},paint_circle:{"circle-radius":{type:"number",default:5,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{type:"number",default:0,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["circle-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{type:"enum",values:{map:{},viewport:{}},default:"map",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"}},paint_heatmap:{"heatmap-radius":{type:"number",default:30,minimum:1,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{type:"number",default:1,minimum:0,transition:!1,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{type:"number",default:1,minimum:0,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"heatmap-color":{type:"color",default:["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",.1,"royalblue",.3,"cyan",.5,"lime",.7,"yellow",1,"red"],transition:!1,expression:{interpolated:!0,parameters:["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_symbol:{"icon-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{type:"color",default:"#000000",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["icon-image","icon-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{type:"color",default:"#000000",transition:!0,overridable:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["text-field","text-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_raster:{"raster-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{type:"number",default:0,period:360,transition:!0,units:"degrees",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{type:"number",default:0,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-saturation":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-contrast":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-resampling":{type:"enum",values:{linear:{},nearest:{}},default:"linear",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{type:"number",default:300,minimum:0,transition:!1,units:"milliseconds",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_hillshade:{"hillshade-illumination-direction":{type:"number",default:335,minimum:0,maximum:359,transition:!1,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{type:"number",default:.5,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{type:"color",default:"#FFFFFF",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_background:{"background-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"background-pattern"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"background-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"background-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},transition:{duration:{type:"number",default:300,minimum:0,units:"milliseconds"},delay:{type:"number",default:0,minimum:0,units:"milliseconds"}},"property-type":{"data-driven":{type:"property-type"},"cross-faded":{type:"property-type"},"cross-faded-data-driven":{type:"property-type"},"color-ramp":{type:"property-type"},"data-constant":{type:"property-type"},constant:{type:"property-type"}},promoteId:{"*":{type:"string"}}};const hi=["type","source","source-layer","minzoom","maxzoom","filter","layout"];function $i(l,o){const c={};for(const f in l)f!=="ref"&&(c[f]=l[f]);return hi.forEach(f=>{f in o&&(c[f]=o[f])}),c}function Gn(l,o){if(Array.isArray(l)){if(!Array.isArray(o)||l.length!==o.length)return!1;for(let c=0;c<l.length;c++)if(!Gn(l[c],o[c]))return!1;return!0}if(typeof l=="object"&&l!==null&&o!==null){if(typeof o!="object"||Object.keys(l).length!==Object.keys(o).length)return!1;for(const c in l)if(!Gn(l[c],o[c]))return!1;return!0}return l===o}const vn={setStyle:"setStyle",addLayer:"addLayer",removeLayer:"removeLayer",setPaintProperty:"setPaintProperty",setLayoutProperty:"setLayoutProperty",setFilter:"setFilter",addSource:"addSource",removeSource:"removeSource",setGeoJSONSourceData:"setGeoJSONSourceData",setLayerZoomRange:"setLayerZoomRange",setLayerProperty:"setLayerProperty",setCenter:"setCenter",setZoom:"setZoom",setBearing:"setBearing",setPitch:"setPitch",setSprite:"setSprite",setGlyphs:"setGlyphs",setTransition:"setTransition",setLight:"setLight"};function zs(l,o,c){c.push({command:vn.addSource,args:[l,o[l]]})}function pi(l,o,c){o.push({command:vn.removeSource,args:[l]}),c[l]=!0}function os(l,o,c,f){pi(l,c,f),zs(l,o,c)}function Ta(l,o,c){let f;for(f in l[c])if(Object.prototype.hasOwnProperty.call(l[c],f)&&f!=="data"&&!Gn(l[c][f],o[c][f]))return!1;for(f in o[c])if(Object.prototype.hasOwnProperty.call(o[c],f)&&f!=="data"&&!Gn(l[c][f],o[c][f]))return!1;return!0}function ra(l,o,c,f,g,x){let b;for(b in o=o||{},l=l||{})Object.prototype.hasOwnProperty.call(l,b)&&(Gn(l[b],o[b])||c.push({command:x,args:[f,b,o[b],g]}));for(b in o)Object.prototype.hasOwnProperty.call(o,b)&&!Object.prototype.hasOwnProperty.call(l,b)&&(Gn(l[b],o[b])||c.push({command:x,args:[f,b,o[b],g]}))}function ss(l){return l.id}function ia(l,o){return l[o.id]=o,l}class se{constructor(o,c,f,g){this.message=(o?`${o}: `:"")+f,g&&(this.identifier=g),c!=null&&c.__line__&&(this.line=c.__line__)}}function uo(l,...o){for(const c of o)for(const f in c)l[f]=c[f];return l}class wr extends Error{constructor(o,c){super(c),this.message=c,this.key=o}}class Au{constructor(o,c=[]){this.parent=o,this.bindings={};for(const[f,g]of c)this.bindings[f]=g}concat(o){return new Au(this,o)}get(o){if(this.bindings[o])return this.bindings[o];if(this.parent)return this.parent.get(o);throw new Error(`${o} not found in scope.`)}has(o){return!!this.bindings[o]||!!this.parent&&this.parent.has(o)}}const Co={kind:"null"},le={kind:"number"},an={kind:"string"},Ye={kind:"boolean"},ro={kind:"color"},jo={kind:"object"},je={kind:"value"},as={kind:"collator"},ot={kind:"formatted"},V={kind:"padding"},G={kind:"resolvedImage"},J={kind:"variableAnchorOffsetCollection"};function q(l,o){return{kind:"array",itemType:l,N:o}}function nt(l){if(l.kind==="array"){const o=nt(l.itemType);return typeof l.N=="number"?`array<${o}, ${l.N}>`:l.itemType.kind==="value"?"array":`array<${o}>`}return l.kind}const bt=[Co,le,an,Ye,ro,ot,jo,q(je),V,G,J];function ft(l,o){if(o.kind==="error")return null;if(l.kind==="array"){if(o.kind==="array"&&(o.N===0&&o.itemType.kind==="value"||!ft(l.itemType,o.itemType))&&(typeof l.N!="number"||l.N===o.N))return null}else{if(l.kind===o.kind)return null;if(l.kind==="value"){for(const c of bt)if(!ft(c,o))return null}}return`Expected ${nt(l)} but found ${nt(o)} instead.`}function it(l,o){return o.some(c=>c.kind===l.kind)}function dt(l,o){return o.some(c=>c==="null"?l===null:c==="array"?Array.isArray(l):c==="object"?l&&!Array.isArray(l)&&typeof l=="object":c===typeof l)}function qt(l,o){return l.kind==="array"&&o.kind==="array"?l.itemType.kind===o.itemType.kind&&typeof l.N=="number":l.kind===o.kind}const jt=.96422,Xt=.82521,Pe=4/29,Qe=6/29,Le=3*Qe*Qe,ke=Qe*Qe*Qe,on=Math.PI/180,ir=180/Math.PI;function yn(l){return(l%=360)<0&&(l+=360),l}function kn([l,o,c,f]){let g,x;const b=To((.2225045*(l=Mn(l))+.7168786*(o=Mn(o))+.0606169*(c=Mn(c)))/1);l===o&&o===c?g=x=b:(g=To((.4360747*l+.3850649*o+.1430804*c)/jt),x=To((.0139322*l+.0971045*o+.7141733*c)/Xt));const I=116*b-16;return[I<0?0:I,500*(g-b),200*(b-x),f]}function Mn(l){return l<=.04045?l/12.92:Math.pow((l+.055)/1.055,2.4)}function To(l){return l>ke?Math.pow(l,1/3):l/Le+Pe}function mr([l,o,c,f]){let g=(l+16)/116,x=isNaN(o)?g:g+o/500,b=isNaN(c)?g:g-c/200;return g=1*Vi(g),x=jt*Vi(x),b=Xt*Vi(b),[Ti(3.1338561*x-1.6168667*g-.4906146*b),Ti(-.9787684*x+1.9161415*g+.033454*b),Ti(.0719453*x-.2289914*g+1.4052427*b),f]}function Ti(l){return(l=l<=.00304?12.92*l:1.055*Math.pow(l,1/2.4)-.055)<0?0:l>1?1:l}function Vi(l){return l>Qe?l*l*l:Le*(l-Pe)}function oa(l){return parseInt(l.padEnd(2,l),16)/255}function Xh(l,o){return gl(o?l/100:l,0,1)}function gl(l,o,c){return Math.min(Math.max(o,l),c)}function ml(l){return!l.some(Number.isNaN)}const Ui={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]};class or{constructor(o,c,f,g=1,x=!0){this.r=o,this.g=c,this.b=f,this.a=g,x||(this.r*=g,this.g*=g,this.b*=g,g||this.overwriteGetter("rgb",[o,c,f,g]))}static parse(o){if(o instanceof or)return o;if(typeof o!="string")return;const c=function(f){if((f=f.toLowerCase().trim())==="transparent")return[0,0,0,0];const g=Ui[f];if(g){const[b,I,L]=g;return[b/255,I/255,L/255,1]}if(f.startsWith("#")&&/^#(?:[0-9a-f]{3,4}|[0-9a-f]{6}|[0-9a-f]{8})$/.test(f)){const b=f.length<6?1:2;let I=1;return[oa(f.slice(I,I+=b)),oa(f.slice(I,I+=b)),oa(f.slice(I,I+=b)),oa(f.slice(I,I+b)||"ff")]}if(f.startsWith("rgb")){const b=f.match(/^rgba?\(\s*([\de.+-]+)(%)?(?:\s+|\s*(,)\s*)([\de.+-]+)(%)?(?:\s+|\s*(,)\s*)([\de.+-]+)(%)?(?:\s*([,\/])\s*([\de.+-]+)(%)?)?\s*\)$/);if(b){const[I,L,M,R,z,U,Y,H,Q,ut,ht,Et]=b,mt=[R||" ",Y||" ",ut].join("");if(mt==="  "||mt==="  /"||mt===",,"||mt===",,,"){const St=[M,U,Q].join(""),Dt=St==="%%%"?100:St===""?255:0;if(Dt){const Ht=[gl(+L/Dt,0,1),gl(+z/Dt,0,1),gl(+H/Dt,0,1),ht?Xh(+ht,Et):1];if(ml(Ht))return Ht}}return}}const x=f.match(/^hsla?\(\s*([\de.+-]+)(?:deg)?(?:\s+|\s*(,)\s*)([\de.+-]+)%(?:\s+|\s*(,)\s*)([\de.+-]+)%(?:\s*([,\/])\s*([\de.+-]+)(%)?)?\s*\)$/);if(x){const[b,I,L,M,R,z,U,Y,H]=x,Q=[L||" ",R||" ",U].join("");if(Q==="  "||Q==="  /"||Q===",,"||Q===",,,"){const ut=[+I,gl(+M,0,100),gl(+z,0,100),Y?Xh(+Y,H):1];if(ml(ut))return function([ht,Et,mt,St]){function Dt(Ht){const Ie=(Ht+ht/30)%12,Ae=Et*Math.min(mt,1-mt);return mt-Ae*Math.max(-1,Math.min(Ie-3,9-Ie,1))}return ht=yn(ht),Et/=100,mt/=100,[Dt(0),Dt(8),Dt(4),St]}(ut)}}}(o);return c?new or(...c,!1):void 0}get rgb(){const{r:o,g:c,b:f,a:g}=this,x=g||1/0;return this.overwriteGetter("rgb",[o/x,c/x,f/x,g])}get hcl(){return this.overwriteGetter("hcl",function(o){const[c,f,g,x]=kn(o),b=Math.sqrt(f*f+g*g);return[Math.round(1e4*b)?yn(Math.atan2(g,f)*ir):NaN,b,c,x]}(this.rgb))}get lab(){return this.overwriteGetter("lab",kn(this.rgb))}overwriteGetter(o,c){return Object.defineProperty(this,o,{value:c}),c}toString(){const[o,c,f,g]=this.rgb;return`rgba(${[o,c,f].map(x=>Math.round(255*x)).join(",")},${g})`}}or.black=new or(0,0,0,1),or.white=new or(1,1,1,1),or.transparent=new or(0,0,0,0),or.red=new or(1,0,0,1);class Yp{constructor(o,c,f){this.sensitivity=o?c?"variant":"case":c?"accent":"base",this.locale=f,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(o,c){return this.collator.compare(o,c)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}class La{constructor(o,c,f,g,x){this.text=o,this.image=c,this.scale=f,this.fontStack=g,this.textColor=x}}class Ar{constructor(o){this.sections=o}static fromString(o){return new Ar([new La(o,null,null,null,null)])}isEmpty(){return this.sections.length===0||!this.sections.some(o=>o.text.length!==0||o.image&&o.image.name.length!==0)}static factory(o){return o instanceof Ar?o:Ar.fromString(o)}toString(){return this.sections.length===0?"":this.sections.map(o=>o.text).join("")}}class Lo{constructor(o){this.values=o.slice()}static parse(o){if(o instanceof Lo)return o;if(typeof o=="number")return new Lo([o,o,o,o]);if(Array.isArray(o)&&!(o.length<1||o.length>4)){for(const c of o)if(typeof c!="number")return;switch(o.length){case 1:o=[o[0],o[0],o[0],o[0]];break;case 2:o=[o[0],o[1],o[0],o[1]];break;case 3:o=[o[0],o[1],o[2],o[1]]}return new Lo(o)}}toString(){return JSON.stringify(this.values)}}const yc=new Set(["center","left","right","top","bottom","top-left","top-right","bottom-left","bottom-right"]);class io{constructor(o){this.values=o.slice()}static parse(o){if(o instanceof io)return o;if(Array.isArray(o)&&!(o.length<1)&&o.length%2==0){for(let c=0;c<o.length;c+=2){const f=o[c],g=o[c+1];if(typeof f!="string"||!yc.has(f)||!Array.isArray(g)||g.length!==2||typeof g[0]!="number"||typeof g[1]!="number")return}return new io(o)}}toString(){return JSON.stringify(this.values)}}class oo{constructor(o){this.name=o.name,this.available=o.available}toString(){return this.name}static fromString(o){return o?new oo({name:o,available:!1}):null}}function Zp(l,o,c,f){return typeof l=="number"&&l>=0&&l<=255&&typeof o=="number"&&o>=0&&o<=255&&typeof c=="number"&&c>=0&&c<=255?f===void 0||typeof f=="number"&&f>=0&&f<=1?null:`Invalid rgba value [${[l,o,c,f].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${(typeof f=="number"?[l,o,c,f]:[l,o,c]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function rh(l){if(l===null||typeof l=="string"||typeof l=="boolean"||typeof l=="number"||l instanceof or||l instanceof Yp||l instanceof Ar||l instanceof Lo||l instanceof io||l instanceof oo)return!0;if(Array.isArray(l)){for(const o of l)if(!rh(o))return!1;return!0}if(typeof l=="object"){for(const o in l)if(!rh(l[o]))return!1;return!0}return!1}function Fr(l){if(l===null)return Co;if(typeof l=="string")return an;if(typeof l=="boolean")return Ye;if(typeof l=="number")return le;if(l instanceof or)return ro;if(l instanceof Yp)return as;if(l instanceof Ar)return ot;if(l instanceof Lo)return V;if(l instanceof io)return J;if(l instanceof oo)return G;if(Array.isArray(l)){const o=l.length;let c;for(const f of l){const g=Fr(f);if(c){if(c===g)continue;c=je;break}c=g}return q(c||je,o)}return jo}function qn(l){const o=typeof l;return l===null?"":o==="string"||o==="number"||o==="boolean"?String(l):l instanceof or||l instanceof Ar||l instanceof Lo||l instanceof io||l instanceof oo?l.toString():JSON.stringify(l)}class Du{constructor(o,c){this.type=o,this.value=c}static parse(o,c){if(o.length!==2)return c.error(`'literal' expression requires exactly one argument, but found ${o.length-1} instead.`);if(!rh(o[1]))return c.error("invalid value");const f=o[1];let g=Fr(f);const x=c.expectedType;return g.kind!=="array"||g.N!==0||!x||x.kind!=="array"||typeof x.N=="number"&&x.N!==0||(g=x),new Du(g,f)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}}class kr{constructor(o){this.name="ExpressionEvaluationError",this.message=o}toJSON(){return this.message}}const Yh={string:an,number:le,boolean:Ye,object:jo};class sa{constructor(o,c){this.type=o,this.args=c}static parse(o,c){if(o.length<2)return c.error("Expected at least one argument.");let f,g=1;const x=o[0];if(x==="array"){let I,L;if(o.length>2){const M=o[1];if(typeof M!="string"||!(M in Yh)||M==="object")return c.error('The item type argument of "array" must be one of string, number, boolean',1);I=Yh[M],g++}else I=je;if(o.length>3){if(o[2]!==null&&(typeof o[2]!="number"||o[2]<0||o[2]!==Math.floor(o[2])))return c.error('The length argument to "array" must be a positive integer literal',2);L=o[2],g++}f=q(I,L)}else{if(!Yh[x])throw new Error(`Types doesn't contain name = ${x}`);f=Yh[x]}const b=[];for(;g<o.length;g++){const I=c.parse(o[g],g,je);if(!I)return null;b.push(I)}return new sa(f,b)}evaluate(o){for(let c=0;c<this.args.length;c++){const f=this.args[c].evaluate(o);if(!ft(this.type,Fr(f)))return f;if(c===this.args.length-1)throw new kr(`Expected value to be of type ${nt(this.type)}, but found ${nt(Fr(f))} instead.`)}throw new Error}eachChild(o){this.args.forEach(o)}outputDefined(){return this.args.every(o=>o.outputDefined())}}const pd={"to-boolean":Ye,"to-color":ro,"to-number":le,"to-string":an};class yl{constructor(o,c){this.type=o,this.args=c}static parse(o,c){if(o.length<2)return c.error("Expected at least one argument.");const f=o[0];if(!pd[f])throw new Error(`Can't parse ${f} as it is not part of the known types`);if((f==="to-boolean"||f==="to-string")&&o.length!==2)return c.error("Expected one argument.");const g=pd[f],x=[];for(let b=1;b<o.length;b++){const I=c.parse(o[b],b,je);if(!I)return null;x.push(I)}return new yl(g,x)}evaluate(o){switch(this.type.kind){case"boolean":return!!this.args[0].evaluate(o);case"color":{let c,f;for(const g of this.args){if(c=g.evaluate(o),f=null,c instanceof or)return c;if(typeof c=="string"){const x=o.parseColor(c);if(x)return x}else if(Array.isArray(c)&&(f=c.length<3||c.length>4?`Invalid rbga value ${JSON.stringify(c)}: expected an array containing either three or four numeric values.`:Zp(c[0],c[1],c[2],c[3]),!f))return new or(c[0]/255,c[1]/255,c[2]/255,c[3])}throw new kr(f||`Could not parse color from value '${typeof c=="string"?c:JSON.stringify(c)}'`)}case"padding":{let c;for(const f of this.args){c=f.evaluate(o);const g=Lo.parse(c);if(g)return g}throw new kr(`Could not parse padding from value '${typeof c=="string"?c:JSON.stringify(c)}'`)}case"variableAnchorOffsetCollection":{let c;for(const f of this.args){c=f.evaluate(o);const g=io.parse(c);if(g)return g}throw new kr(`Could not parse variableAnchorOffsetCollection from value '${typeof c=="string"?c:JSON.stringify(c)}'`)}case"number":{let c=null;for(const f of this.args){if(c=f.evaluate(o),c===null)return 0;const g=Number(c);if(!isNaN(g))return g}throw new kr(`Could not convert ${JSON.stringify(c)} to number.`)}case"formatted":return Ar.fromString(qn(this.args[0].evaluate(o)));case"resolvedImage":return oo.fromString(qn(this.args[0].evaluate(o)));default:return qn(this.args[0].evaluate(o))}}eachChild(o){this.args.forEach(o)}outputDefined(){return this.args.every(o=>o.outputDefined())}}const Zh=["Unknown","Point","LineString","Polygon"];class E{constructor(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null}id(){return this.feature&&"id"in this.feature?this.feature.id:null}geometryType(){return this.feature?typeof this.feature.type=="number"?Zh[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}parseColor(o){let c=this._parseColorCache[o];return c||(c=this._parseColorCache[o]=or.parse(o)),c}}class A{constructor(o,c,f=[],g,x=new Au,b=[]){this.registry=o,this.path=f,this.key=f.map(I=>`[${I}]`).join(""),this.scope=x,this.errors=b,this.expectedType=g,this._isConstant=c}parse(o,c,f,g,x={}){return c?this.concat(c,f,g)._parse(o,x):this._parse(o,x)}_parse(o,c){function f(g,x,b){return b==="assert"?new sa(x,[g]):b==="coerce"?new yl(x,[g]):g}if(o!==null&&typeof o!="string"&&typeof o!="boolean"&&typeof o!="number"||(o=["literal",o]),Array.isArray(o)){if(o.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const g=o[0];if(typeof g!="string")return this.error(`Expression name must be a string, but found ${typeof g} instead. If you wanted a literal array, use ["literal", [...]].`,0),null;const x=this.registry[g];if(x){let b=x.parse(o,this);if(!b)return null;if(this.expectedType){const I=this.expectedType,L=b.type;if(I.kind!=="string"&&I.kind!=="number"&&I.kind!=="boolean"&&I.kind!=="object"&&I.kind!=="array"||L.kind!=="value")if(I.kind!=="color"&&I.kind!=="formatted"&&I.kind!=="resolvedImage"||L.kind!=="value"&&L.kind!=="string")if(I.kind!=="padding"||L.kind!=="value"&&L.kind!=="number"&&L.kind!=="array")if(I.kind!=="variableAnchorOffsetCollection"||L.kind!=="value"&&L.kind!=="array"){if(this.checkSubtype(I,L))return null}else b=f(b,I,c.typeAnnotation||"coerce");else b=f(b,I,c.typeAnnotation||"coerce");else b=f(b,I,c.typeAnnotation||"coerce");else b=f(b,I,c.typeAnnotation||"assert")}if(!(b instanceof Du)&&b.type.kind!=="resolvedImage"&&this._isConstant(b)){const I=new E;try{b=new Du(b.type,b.evaluate(I))}catch(L){return this.error(L.message),null}}return b}return this.error(`Unknown expression "${g}". If you wanted a literal array, use ["literal", [...]].`,0)}return this.error(o===void 0?"'undefined' value invalid. Use null instead.":typeof o=="object"?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof o} instead.`)}concat(o,c,f){const g=typeof o=="number"?this.path.concat(o):this.path,x=f?this.scope.concat(f):this.scope;return new A(this.registry,this._isConstant,g,c||null,x,this.errors)}error(o,...c){const f=`${this.key}${c.map(g=>`[${g}]`).join("")}`;this.errors.push(new wr(f,o))}checkSubtype(o,c){const f=ft(o,c);return f&&this.error(f),f}}class X{constructor(o,c,f){this.type=as,this.locale=f,this.caseSensitive=o,this.diacriticSensitive=c}static parse(o,c){if(o.length!==2)return c.error("Expected one argument.");const f=o[1];if(typeof f!="object"||Array.isArray(f))return c.error("Collator options argument must be an object.");const g=c.parse(f["case-sensitive"]!==void 0&&f["case-sensitive"],1,Ye);if(!g)return null;const x=c.parse(f["diacritic-sensitive"]!==void 0&&f["diacritic-sensitive"],1,Ye);if(!x)return null;let b=null;return f.locale&&(b=c.parse(f.locale,1,an),!b)?null:new X(g,x,b)}evaluate(o){return new Yp(this.caseSensitive.evaluate(o),this.diacriticSensitive.evaluate(o),this.locale?this.locale.evaluate(o):null)}eachChild(o){o(this.caseSensitive),o(this.diacriticSensitive),this.locale&&o(this.locale)}outputDefined(){return!1}}const at=8192;function yt(l,o){l[0]=Math.min(l[0],o[0]),l[1]=Math.min(l[1],o[1]),l[2]=Math.max(l[2],o[0]),l[3]=Math.max(l[3],o[1])}function _t(l,o){return!(l[0]<=o[0]||l[2]>=o[2]||l[1]<=o[1]||l[3]>=o[3])}function Ct(l,o){const c=(180+l[0])/360,f=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+l[1]*Math.PI/360)))/360,g=Math.pow(2,o.z);return[Math.round(c*g*at),Math.round(f*g*at)]}function te(l,o,c){const f=l[0]-o[0],g=l[1]-o[1],x=l[0]-c[0],b=l[1]-c[1];return f*b-x*g==0&&f*x<=0&&g*b<=0}function ae(l,o){let c=!1;for(let b=0,I=o.length;b<I;b++){const L=o[b];for(let M=0,R=L.length;M<R-1;M++){if(te(l,L[M],L[M+1]))return!1;(g=L[M])[1]>(f=l)[1]!=(x=L[M+1])[1]>f[1]&&f[0]<(x[0]-g[0])*(f[1]-g[1])/(x[1]-g[1])+g[0]&&(c=!c)}}var f,g,x;return c}function xe(l,o){for(let c=0;c<o.length;c++)if(ae(l,o[c]))return!0;return!1}function we(l,o,c,f){const g=f[0]-c[0],x=f[1]-c[1],b=(l[0]-c[0])*x-g*(l[1]-c[1]),I=(o[0]-c[0])*x-g*(o[1]-c[1]);return b>0&&I<0||b<0&&I>0}function me(l,o,c){for(const M of c)for(let R=0;R<M.length-1;++R)if((I=[(b=M[R+1])[0]-(x=M[R])[0],b[1]-x[1]])[0]*(L=[(g=o)[0]-(f=l)[0],g[1]-f[1]])[1]-I[1]*L[0]!=0&&we(f,g,x,b)&&we(x,b,f,g))return!0;var f,g,x,b,I,L;return!1}function sn(l,o){for(let c=0;c<l.length;++c)if(!ae(l[c],o))return!1;for(let c=0;c<l.length-1;++c)if(me(l[c],l[c+1],o))return!1;return!0}function zr(l,o){for(let c=0;c<o.length;c++)if(sn(l,o[c]))return!0;return!1}function cn(l,o,c){const f=[];for(let g=0;g<l.length;g++){const x=[];for(let b=0;b<l[g].length;b++){const I=Ct(l[g][b],c);yt(o,I),x.push(I)}f.push(x)}return f}function fi(l,o,c){const f=[];for(let g=0;g<l.length;g++){const x=cn(l[g],o,c);f.push(x)}return f}function Wt(l,o,c,f){if(l[0]<c[0]||l[0]>c[2]){const g=.5*f;let x=l[0]-c[0]>g?-f:c[0]-l[0]>g?f:0;x===0&&(x=l[0]-c[2]>g?-f:c[2]-l[0]>g?f:0),l[0]+=x}yt(o,l)}function Oe(l,o,c,f){const g=Math.pow(2,f.z)*at,x=[f.x*at,f.y*at],b=[];for(const I of l)for(const L of I){const M=[L.x+x[0],L.y+x[1]];Wt(M,o,c,g),b.push(M)}return b}function sr(l,o,c,f){const g=Math.pow(2,f.z)*at,x=[f.x*at,f.y*at],b=[];for(const L of l){const M=[];for(const R of L){const z=[R.x+x[0],R.y+x[1]];yt(o,z),M.push(z)}b.push(M)}if(o[2]-o[0]<=g/2){(I=o)[0]=I[1]=1/0,I[2]=I[3]=-1/0;for(const L of b)for(const M of L)Wt(M,o,c,g)}var I;return b}class Br{constructor(o,c){this.type=Ye,this.geojson=o,this.geometries=c}static parse(o,c){if(o.length!==2)return c.error(`'within' expression requires exactly one argument, but found ${o.length-1} instead.`);if(rh(o[1])){const f=o[1];if(f.type==="FeatureCollection")for(let g=0;g<f.features.length;++g){const x=f.features[g].geometry.type;if(x==="Polygon"||x==="MultiPolygon")return new Br(f,f.features[g].geometry)}else if(f.type==="Feature"){const g=f.geometry.type;if(g==="Polygon"||g==="MultiPolygon")return new Br(f,f.geometry)}else if(f.type==="Polygon"||f.type==="MultiPolygon")return new Br(f,f)}return c.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(o){if(o.geometry()!=null&&o.canonicalID()!=null){if(o.geometryType()==="Point")return function(c,f){const g=[1/0,1/0,-1/0,-1/0],x=[1/0,1/0,-1/0,-1/0],b=c.canonicalID();if(f.type==="Polygon"){const I=cn(f.coordinates,x,b),L=Oe(c.geometry(),g,x,b);if(!_t(g,x))return!1;for(const M of L)if(!ae(M,I))return!1}if(f.type==="MultiPolygon"){const I=fi(f.coordinates,x,b),L=Oe(c.geometry(),g,x,b);if(!_t(g,x))return!1;for(const M of L)if(!xe(M,I))return!1}return!0}(o,this.geometries);if(o.geometryType()==="LineString")return function(c,f){const g=[1/0,1/0,-1/0,-1/0],x=[1/0,1/0,-1/0,-1/0],b=c.canonicalID();if(f.type==="Polygon"){const I=cn(f.coordinates,x,b),L=sr(c.geometry(),g,x,b);if(!_t(g,x))return!1;for(const M of L)if(!sn(M,I))return!1}if(f.type==="MultiPolygon"){const I=fi(f.coordinates,x,b),L=sr(c.geometry(),g,x,b);if(!_t(g,x))return!1;for(const M of L)if(!zr(M,I))return!1}return!0}(o,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}}class Zr{constructor(o,c){this.type=c.type,this.name=o,this.boundExpression=c}static parse(o,c){if(o.length!==2||typeof o[1]!="string")return c.error("'var' expression requires exactly one string literal argument.");const f=o[1];return c.scope.has(f)?new Zr(f,c.scope.get(f)):c.error(`Unknown variable "${f}". Make sure "${f}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(o){return this.boundExpression.evaluate(o)}eachChild(){}outputDefined(){return!1}}class us{constructor(o,c,f,g){this.name=o,this.type=c,this._evaluate=f,this.args=g}evaluate(o){return this._evaluate(o,this.args)}eachChild(o){this.args.forEach(o)}outputDefined(){return!1}static parse(o,c){const f=o[0],g=us.definitions[f];if(!g)return c.error(`Unknown expression "${f}". If you wanted a literal array, use ["literal", [...]].`,0);const x=Array.isArray(g)?g[0]:g.type,b=Array.isArray(g)?[[g[1],g[2]]]:g.overloads,I=b.filter(([M])=>!Array.isArray(M)||M.length===o.length-1);let L=null;for(const[M,R]of I){L=new A(c.registry,Hp,c.path,null,c.scope);const z=[];let U=!1;for(let Y=1;Y<o.length;Y++){const H=o[Y],Q=Array.isArray(M)?M[Y-1]:M.type,ut=L.parse(H,1+z.length,Q);if(!ut){U=!0;break}z.push(ut)}if(!U)if(Array.isArray(M)&&M.length!==z.length)L.error(`Expected ${M.length} arguments, but found ${z.length} instead.`);else{for(let Y=0;Y<z.length;Y++){const H=Array.isArray(M)?M[Y]:M.type,Q=z[Y];L.concat(Y+1).checkSubtype(H,Q.type)}if(L.errors.length===0)return new us(f,x,R,z)}}if(I.length===1)c.errors.push(...L.errors);else{const M=(I.length?I:b).map(([z])=>{return U=z,Array.isArray(U)?`(${U.map(nt).join(", ")})`:`(${nt(U.type)}...)`;var U}).join(" | "),R=[];for(let z=1;z<o.length;z++){const U=c.parse(o[z],1+R.length);if(!U)return null;R.push(nt(U.type))}c.error(`Expected arguments of type ${M}, but found (${R.join(", ")}) instead.`)}return null}static register(o,c){us.definitions=c;for(const f in c)o[f]=us}}function Hp(l){if(l instanceof Zr)return Hp(l.boundExpression);if(l instanceof us&&l.name==="error"||l instanceof X||l instanceof Br)return!1;const o=l instanceof yl||l instanceof sa;let c=!0;return l.eachChild(f=>{c=o?c&&Hp(f):c&&f instanceof Du}),!!c&&yr(l)&&Wp(l,["zoom","heatmap-density","line-progress","accumulated","is-supported-script"])}function yr(l){if(l instanceof us&&(l.name==="get"&&l.args.length===1||l.name==="feature-state"||l.name==="has"&&l.args.length===1||l.name==="properties"||l.name==="geometry-type"||l.name==="id"||/^filter-/.test(l.name))||l instanceof Br)return!1;let o=!0;return l.eachChild(c=>{o&&!yr(c)&&(o=!1)}),o}function ih(l){if(l instanceof us&&l.name==="feature-state")return!1;let o=!0;return l.eachChild(c=>{o&&!ih(c)&&(o=!1)}),o}function Wp(l,o){if(l instanceof us&&o.indexOf(l.name)>=0)return!1;let c=!0;return l.eachChild(f=>{c&&!Wp(f,o)&&(c=!1)}),c}function ls(l,o){const c=l.length-1;let f,g,x=0,b=c,I=0;for(;x<=b;)if(I=Math.floor((x+b)/2),f=l[I],g=l[I+1],f<=o){if(I===c||o<g)return I;x=I+1}else{if(!(f>o))throw new kr("Input is not a number.");b=I-1}return 0}class Ou{constructor(o,c,f){this.type=o,this.input=c,this.labels=[],this.outputs=[];for(const[g,x]of f)this.labels.push(g),this.outputs.push(x)}static parse(o,c){if(o.length-1<4)return c.error(`Expected at least 4 arguments, but found only ${o.length-1}.`);if((o.length-1)%2!=0)return c.error("Expected an even number of arguments.");const f=c.parse(o[1],1,le);if(!f)return null;const g=[];let x=null;c.expectedType&&c.expectedType.kind!=="value"&&(x=c.expectedType);for(let b=1;b<o.length;b+=2){const I=b===1?-1/0:o[b],L=o[b+1],M=b,R=b+1;if(typeof I!="number")return c.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',M);if(g.length&&g[g.length-1][0]>=I)return c.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',M);const z=c.parse(L,R,x);if(!z)return null;x=x||z.type,g.push([I,z])}return new Ou(x,f,g)}evaluate(o){const c=this.labels,f=this.outputs;if(c.length===1)return f[0].evaluate(o);const g=this.input.evaluate(o);if(g<=c[0])return f[0].evaluate(o);const x=c.length;return g>=c[x-1]?f[x-1].evaluate(o):f[ls(c,g)].evaluate(o)}eachChild(o){o(this.input);for(const c of this.outputs)o(c)}outputDefined(){return this.outputs.every(o=>o.outputDefined())}}function Cn(l,o,c){return l+c*(o-l)}function Hh(l,o,c){return l.map((f,g)=>Cn(f,o[g],c))}const Xo={number:Cn,color:function(l,o,c,f="rgb"){switch(f){case"rgb":{const[g,x,b,I]=Hh(l.rgb,o.rgb,c);return new or(g,x,b,I,!1)}case"hcl":{const[g,x,b,I]=l.hcl,[L,M,R,z]=o.hcl;let U,Y;if(isNaN(g)||isNaN(L))isNaN(g)?isNaN(L)?U=NaN:(U=L,b!==1&&b!==0||(Y=M)):(U=g,R!==1&&R!==0||(Y=x));else{let Et=L-g;L>g&&Et>180?Et-=360:L<g&&g-L>180&&(Et+=360),U=g+c*Et}const[H,Q,ut,ht]=function([Et,mt,St,Dt]){return Et=isNaN(Et)?0:Et*on,mr([St,Math.cos(Et)*mt,Math.sin(Et)*mt,Dt])}([U,Y??Cn(x,M,c),Cn(b,R,c),Cn(I,z,c)]);return new or(H,Q,ut,ht,!1)}case"lab":{const[g,x,b,I]=mr(Hh(l.lab,o.lab,c));return new or(g,x,b,I,!1)}}},array:Hh,padding:function(l,o,c){return new Lo(Hh(l.values,o.values,c))},variableAnchorOffsetCollection:function(l,o,c){const f=l.values,g=o.values;if(f.length!==g.length)throw new kr(`Cannot interpolate values of different length. from: ${l.toString()}, to: ${o.toString()}`);const x=[];for(let b=0;b<f.length;b+=2){if(f[b]!==g[b])throw new kr(`Cannot interpolate values containing mismatched anchors. from[${b}]: ${f[b]}, to[${b}]: ${g[b]}`);x.push(f[b]);const[I,L]=f[b+1],[M,R]=g[b+1];x.push([Cn(I,M,c),Cn(L,R,c)])}return new io(x)}};class cs{constructor(o,c,f,g,x){this.type=o,this.operator=c,this.interpolation=f,this.input=g,this.labels=[],this.outputs=[];for(const[b,I]of x)this.labels.push(b),this.outputs.push(I)}static interpolationFactor(o,c,f,g){let x=0;if(o.name==="exponential")x=Jp(c,o.base,f,g);else if(o.name==="linear")x=Jp(c,1,f,g);else if(o.name==="cubic-bezier"){const b=o.controlPoints;x=new Z(b[0],b[1],b[2],b[3]).solve(Jp(c,1,f,g))}return x}static parse(o,c){let[f,g,x,...b]=o;if(!Array.isArray(g)||g.length===0)return c.error("Expected an interpolation type expression.",1);if(g[0]==="linear")g={name:"linear"};else if(g[0]==="exponential"){const M=g[1];if(typeof M!="number")return c.error("Exponential interpolation requires a numeric base.",1,1);g={name:"exponential",base:M}}else{if(g[0]!=="cubic-bezier")return c.error(`Unknown interpolation type ${String(g[0])}`,1,0);{const M=g.slice(1);if(M.length!==4||M.some(R=>typeof R!="number"||R<0||R>1))return c.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);g={name:"cubic-bezier",controlPoints:M}}}if(o.length-1<4)return c.error(`Expected at least 4 arguments, but found only ${o.length-1}.`);if((o.length-1)%2!=0)return c.error("Expected an even number of arguments.");if(x=c.parse(x,2,le),!x)return null;const I=[];let L=null;f==="interpolate-hcl"||f==="interpolate-lab"?L=ro:c.expectedType&&c.expectedType.kind!=="value"&&(L=c.expectedType);for(let M=0;M<b.length;M+=2){const R=b[M],z=b[M+1],U=M+3,Y=M+4;if(typeof R!="number")return c.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',U);if(I.length&&I[I.length-1][0]>=R)return c.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',U);const H=c.parse(z,Y,L);if(!H)return null;L=L||H.type,I.push([R,H])}return qt(L,le)||qt(L,ro)||qt(L,V)||qt(L,J)||qt(L,q(le))?new cs(L,f,g,x,I):c.error(`Type ${nt(L)} is not interpolatable.`)}evaluate(o){const c=this.labels,f=this.outputs;if(c.length===1)return f[0].evaluate(o);const g=this.input.evaluate(o);if(g<=c[0])return f[0].evaluate(o);const x=c.length;if(g>=c[x-1])return f[x-1].evaluate(o);const b=ls(c,g),I=cs.interpolationFactor(this.interpolation,g,c[b],c[b+1]),L=f[b].evaluate(o),M=f[b+1].evaluate(o);switch(this.operator){case"interpolate":return Xo[this.type.kind](L,M,I);case"interpolate-hcl":return Xo.color(L,M,I,"hcl");case"interpolate-lab":return Xo.color(L,M,I,"lab")}}eachChild(o){o(this.input);for(const c of this.outputs)o(c)}outputDefined(){return this.outputs.every(o=>o.outputDefined())}}function Jp(l,o,c,f){const g=f-c,x=l-c;return g===0?0:o===1?x/g:(Math.pow(o,x)-1)/(Math.pow(o,g)-1)}class Kp{constructor(o,c){this.type=o,this.args=c}static parse(o,c){if(o.length<2)return c.error("Expectected at least one argument.");let f=null;const g=c.expectedType;g&&g.kind!=="value"&&(f=g);const x=[];for(const I of o.slice(1)){const L=c.parse(I,1+x.length,f,void 0,{typeAnnotation:"omit"});if(!L)return null;f=f||L.type,x.push(L)}if(!f)throw new Error("No output type");const b=g&&x.some(I=>ft(g,I.type));return new Kp(b?je:f,x)}evaluate(o){let c,f=null,g=0;for(const x of this.args)if(g++,f=x.evaluate(o),f&&f instanceof oo&&!f.available&&(c||(c=f.name),f=null,g===this.args.length&&(f=c)),f!==null)break;return f}eachChild(o){this.args.forEach(o)}outputDefined(){return this.args.every(o=>o.outputDefined())}}class Qp{constructor(o,c){this.type=c.type,this.bindings=[].concat(o),this.result=c}evaluate(o){return this.result.evaluate(o)}eachChild(o){for(const c of this.bindings)o(c[1]);o(this.result)}static parse(o,c){if(o.length<4)return c.error(`Expected at least 3 arguments, but found ${o.length-1} instead.`);const f=[];for(let x=1;x<o.length-1;x+=2){const b=o[x];if(typeof b!="string")return c.error(`Expected string, but found ${typeof b} instead.`,x);if(/[^a-zA-Z0-9_]/.test(b))return c.error("Variable names must contain only alphanumeric characters or '_'.",x);const I=c.parse(o[x+1],x+1);if(!I)return null;f.push([b,I])}const g=c.parse(o[o.length-1],o.length-1,c.expectedType,f);return g?new Qp(f,g):null}outputDefined(){return this.result.outputDefined()}}class fd{constructor(o,c,f){this.type=o,this.index=c,this.input=f}static parse(o,c){if(o.length!==3)return c.error(`Expected 2 arguments, but found ${o.length-1} instead.`);const f=c.parse(o[1],1,le),g=c.parse(o[2],2,q(c.expectedType||je));return f&&g?new fd(g.type.itemType,f,g):null}evaluate(o){const c=this.index.evaluate(o),f=this.input.evaluate(o);if(c<0)throw new kr(`Array index out of bounds: ${c} < 0.`);if(c>=f.length)throw new kr(`Array index out of bounds: ${c} > ${f.length-1}.`);if(c!==Math.floor(c))throw new kr(`Array index must be an integer, but found ${c} instead.`);return f[c]}eachChild(o){o(this.index),o(this.input)}outputDefined(){return!1}}class tf{constructor(o,c){this.type=Ye,this.needle=o,this.haystack=c}static parse(o,c){if(o.length!==3)return c.error(`Expected 2 arguments, but found ${o.length-1} instead.`);const f=c.parse(o[1],1,je),g=c.parse(o[2],2,je);return f&&g?it(f.type,[Ye,an,le,Co,je])?new tf(f,g):c.error(`Expected first argument to be of type boolean, string, number or null, but found ${nt(f.type)} instead`):null}evaluate(o){const c=this.needle.evaluate(o),f=this.haystack.evaluate(o);if(!f)return!1;if(!dt(c,["boolean","string","number","null"]))throw new kr(`Expected first argument to be of type boolean, string, number or null, but found ${nt(Fr(c))} instead.`);if(!dt(f,["string","array"]))throw new kr(`Expected second argument to be of type array or string, but found ${nt(Fr(f))} instead.`);return f.indexOf(c)>=0}eachChild(o){o(this.needle),o(this.haystack)}outputDefined(){return!0}}class Wh{constructor(o,c,f){this.type=le,this.needle=o,this.haystack=c,this.fromIndex=f}static parse(o,c){if(o.length<=2||o.length>=5)return c.error(`Expected 3 or 4 arguments, but found ${o.length-1} instead.`);const f=c.parse(o[1],1,je),g=c.parse(o[2],2,je);if(!f||!g)return null;if(!it(f.type,[Ye,an,le,Co,je]))return c.error(`Expected first argument to be of type boolean, string, number or null, but found ${nt(f.type)} instead`);if(o.length===4){const x=c.parse(o[3],3,le);return x?new Wh(f,g,x):null}return new Wh(f,g)}evaluate(o){const c=this.needle.evaluate(o),f=this.haystack.evaluate(o);if(!dt(c,["boolean","string","number","null"]))throw new kr(`Expected first argument to be of type boolean, string, number or null, but found ${nt(Fr(c))} instead.`);if(!dt(f,["string","array"]))throw new kr(`Expected second argument to be of type array or string, but found ${nt(Fr(f))} instead.`);if(this.fromIndex){const g=this.fromIndex.evaluate(o);return f.indexOf(c,g)}return f.indexOf(c)}eachChild(o){o(this.needle),o(this.haystack),this.fromIndex&&o(this.fromIndex)}outputDefined(){return!1}}class ef{constructor(o,c,f,g,x,b){this.inputType=o,this.type=c,this.input=f,this.cases=g,this.outputs=x,this.otherwise=b}static parse(o,c){if(o.length<5)return c.error(`Expected at least 4 arguments, but found only ${o.length-1}.`);if(o.length%2!=1)return c.error("Expected an even number of arguments.");let f,g;c.expectedType&&c.expectedType.kind!=="value"&&(g=c.expectedType);const x={},b=[];for(let M=2;M<o.length-1;M+=2){let R=o[M];const z=o[M+1];Array.isArray(R)||(R=[R]);const U=c.concat(M);if(R.length===0)return U.error("Expected at least one branch label.");for(const H of R){if(typeof H!="number"&&typeof H!="string")return U.error("Branch labels must be numbers or strings.");if(typeof H=="number"&&Math.abs(H)>Number.MAX_SAFE_INTEGER)return U.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if(typeof H=="number"&&Math.floor(H)!==H)return U.error("Numeric branch labels must be integer values.");if(f){if(U.checkSubtype(f,Fr(H)))return null}else f=Fr(H);if(x[String(H)]!==void 0)return U.error("Branch labels must be unique.");x[String(H)]=b.length}const Y=c.parse(z,M,g);if(!Y)return null;g=g||Y.type,b.push(Y)}const I=c.parse(o[1],1,je);if(!I)return null;const L=c.parse(o[o.length-1],o.length-1,g);return L?I.type.kind!=="value"&&c.concat(1).checkSubtype(f,I.type)?null:new ef(f,g,I,x,b,L):null}evaluate(o){const c=this.input.evaluate(o);return(Fr(c)===this.inputType&&this.outputs[this.cases[c]]||this.otherwise).evaluate(o)}eachChild(o){o(this.input),this.outputs.forEach(o),o(this.otherwise)}outputDefined(){return this.outputs.every(o=>o.outputDefined())&&this.otherwise.outputDefined()}}class dd{constructor(o,c,f){this.type=o,this.branches=c,this.otherwise=f}static parse(o,c){if(o.length<4)return c.error(`Expected at least 3 arguments, but found only ${o.length-1}.`);if(o.length%2!=0)return c.error("Expected an odd number of arguments.");let f;c.expectedType&&c.expectedType.kind!=="value"&&(f=c.expectedType);const g=[];for(let b=1;b<o.length-1;b+=2){const I=c.parse(o[b],b,Ye);if(!I)return null;const L=c.parse(o[b+1],b+1,f);if(!L)return null;g.push([I,L]),f=f||L.type}const x=c.parse(o[o.length-1],o.length-1,f);if(!x)return null;if(!f)throw new Error("Can't infer output type");return new dd(f,g,x)}evaluate(o){for(const[c,f]of this.branches)if(c.evaluate(o))return f.evaluate(o);return this.otherwise.evaluate(o)}eachChild(o){for(const[c,f]of this.branches)o(c),o(f);o(this.otherwise)}outputDefined(){return this.branches.every(([o,c])=>c.outputDefined())&&this.otherwise.outputDefined()}}class nf{constructor(o,c,f,g){this.type=o,this.input=c,this.beginIndex=f,this.endIndex=g}static parse(o,c){if(o.length<=2||o.length>=5)return c.error(`Expected 3 or 4 arguments, but found ${o.length-1} instead.`);const f=c.parse(o[1],1,je),g=c.parse(o[2],2,le);if(!f||!g)return null;if(!it(f.type,[q(je),an,je]))return c.error(`Expected first argument to be of type array or string, but found ${nt(f.type)} instead`);if(o.length===4){const x=c.parse(o[3],3,le);return x?new nf(f.type,f,g,x):null}return new nf(f.type,f,g)}evaluate(o){const c=this.input.evaluate(o),f=this.beginIndex.evaluate(o);if(!dt(c,["string","array"]))throw new kr(`Expected first argument to be of type array or string, but found ${nt(Fr(c))} instead.`);if(this.endIndex){const g=this.endIndex.evaluate(o);return c.slice(f,g)}return c.slice(f)}eachChild(o){o(this.input),o(this.beginIndex),this.endIndex&&o(this.endIndex)}outputDefined(){return!1}}function Jh(l,o){return l==="=="||l==="!="?o.kind==="boolean"||o.kind==="string"||o.kind==="number"||o.kind==="null"||o.kind==="value":o.kind==="string"||o.kind==="number"||o.kind==="value"}function rf(l,o,c,f){return f.compare(o,c)===0}function _c(l,o,c){const f=l!=="=="&&l!=="!=";return class jI{constructor(x,b,I){this.type=Ye,this.lhs=x,this.rhs=b,this.collator=I,this.hasUntypedArgument=x.type.kind==="value"||b.type.kind==="value"}static parse(x,b){if(x.length!==3&&x.length!==4)return b.error("Expected two or three arguments.");const I=x[0];let L=b.parse(x[1],1,je);if(!L)return null;if(!Jh(I,L.type))return b.concat(1).error(`"${I}" comparisons are not supported for type '${nt(L.type)}'.`);let M=b.parse(x[2],2,je);if(!M)return null;if(!Jh(I,M.type))return b.concat(2).error(`"${I}" comparisons are not supported for type '${nt(M.type)}'.`);if(L.type.kind!==M.type.kind&&L.type.kind!=="value"&&M.type.kind!=="value")return b.error(`Cannot compare types '${nt(L.type)}' and '${nt(M.type)}'.`);f&&(L.type.kind==="value"&&M.type.kind!=="value"?L=new sa(M.type,[L]):L.type.kind!=="value"&&M.type.kind==="value"&&(M=new sa(L.type,[M])));let R=null;if(x.length===4){if(L.type.kind!=="string"&&M.type.kind!=="string"&&L.type.kind!=="value"&&M.type.kind!=="value")return b.error("Cannot use collator to compare non-string types.");if(R=b.parse(x[3],3,as),!R)return null}return new jI(L,M,R)}evaluate(x){const b=this.lhs.evaluate(x),I=this.rhs.evaluate(x);if(f&&this.hasUntypedArgument){const L=Fr(b),M=Fr(I);if(L.kind!==M.kind||L.kind!=="string"&&L.kind!=="number")throw new kr(`Expected arguments for "${l}" to be (string, string) or (number, number), but found (${L.kind}, ${M.kind}) instead.`)}if(this.collator&&!f&&this.hasUntypedArgument){const L=Fr(b),M=Fr(I);if(L.kind!=="string"||M.kind!=="string")return o(x,b,I)}return this.collator?c(x,b,I,this.collator.evaluate(x)):o(x,b,I)}eachChild(x){x(this.lhs),x(this.rhs),this.collator&&x(this.collator)}outputDefined(){return!0}}}const iu=_c("==",function(l,o,c){return o===c},rf),_g=_c("!=",function(l,o,c){return o!==c},function(l,o,c,f){return!rf(0,o,c,f)}),vg=_c("<",function(l,o,c){return o<c},function(l,o,c,f){return f.compare(o,c)<0}),jm=_c(">",function(l,o,c){return o>c},function(l,o,c,f){return f.compare(o,c)>0}),xg=_c("<=",function(l,o,c){return o<=c},function(l,o,c,f){return f.compare(o,c)<=0}),of=_c(">=",function(l,o,c){return o>=c},function(l,o,c,f){return f.compare(o,c)>=0});class sf{constructor(o,c,f,g,x){this.type=an,this.number=o,this.locale=c,this.currency=f,this.minFractionDigits=g,this.maxFractionDigits=x}static parse(o,c){if(o.length!==3)return c.error("Expected two arguments.");const f=c.parse(o[1],1,le);if(!f)return null;const g=o[2];if(typeof g!="object"||Array.isArray(g))return c.error("NumberFormat options argument must be an object.");let x=null;if(g.locale&&(x=c.parse(g.locale,1,an),!x))return null;let b=null;if(g.currency&&(b=c.parse(g.currency,1,an),!b))return null;let I=null;if(g["min-fraction-digits"]&&(I=c.parse(g["min-fraction-digits"],1,le),!I))return null;let L=null;return g["max-fraction-digits"]&&(L=c.parse(g["max-fraction-digits"],1,le),!L)?null:new sf(f,x,b,I,L)}evaluate(o){return new Intl.NumberFormat(this.locale?this.locale.evaluate(o):[],{style:this.currency?"currency":"decimal",currency:this.currency?this.currency.evaluate(o):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(o):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(o):void 0}).format(this.number.evaluate(o))}eachChild(o){o(this.number),this.locale&&o(this.locale),this.currency&&o(this.currency),this.minFractionDigits&&o(this.minFractionDigits),this.maxFractionDigits&&o(this.maxFractionDigits)}outputDefined(){return!1}}class Kh{constructor(o){this.type=ot,this.sections=o}static parse(o,c){if(o.length<2)return c.error("Expected at least one argument.");const f=o[1];if(!Array.isArray(f)&&typeof f=="object")return c.error("First argument must be an image or text section.");const g=[];let x=!1;for(let b=1;b<=o.length-1;++b){const I=o[b];if(x&&typeof I=="object"&&!Array.isArray(I)){x=!1;let L=null;if(I["font-scale"]&&(L=c.parse(I["font-scale"],1,le),!L))return null;let M=null;if(I["text-font"]&&(M=c.parse(I["text-font"],1,q(an)),!M))return null;let R=null;if(I["text-color"]&&(R=c.parse(I["text-color"],1,ro),!R))return null;const z=g[g.length-1];z.scale=L,z.font=M,z.textColor=R}else{const L=c.parse(o[b],1,je);if(!L)return null;const M=L.type.kind;if(M!=="string"&&M!=="value"&&M!=="null"&&M!=="resolvedImage")return c.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");x=!0,g.push({content:L,scale:null,font:null,textColor:null})}}return new Kh(g)}evaluate(o){return new Ar(this.sections.map(c=>{const f=c.content.evaluate(o);return Fr(f)===G?new La("",f,null,null,null):new La(qn(f),null,c.scale?c.scale.evaluate(o):null,c.font?c.font.evaluate(o).join(","):null,c.textColor?c.textColor.evaluate(o):null)}))}eachChild(o){for(const c of this.sections)o(c.content),c.scale&&o(c.scale),c.font&&o(c.font),c.textColor&&o(c.textColor)}outputDefined(){return!1}}class gd{constructor(o){this.type=G,this.input=o}static parse(o,c){if(o.length!==2)return c.error("Expected two arguments.");const f=c.parse(o[1],1,an);return f?new gd(f):c.error("No image name provided.")}evaluate(o){const c=this.input.evaluate(o),f=oo.fromString(c);return f&&o.availableImages&&(f.available=o.availableImages.indexOf(c)>-1),f}eachChild(o){o(this.input)}outputDefined(){return!1}}class Ru{constructor(o){this.type=le,this.input=o}static parse(o,c){if(o.length!==2)return c.error(`Expected 1 argument, but found ${o.length-1} instead.`);const f=c.parse(o[1],1);return f?f.type.kind!=="array"&&f.type.kind!=="string"&&f.type.kind!=="value"?c.error(`Expected argument of type string or array, but found ${nt(f.type)} instead.`):new Ru(f):null}evaluate(o){const c=this.input.evaluate(o);if(typeof c=="string"||Array.isArray(c))return c.length;throw new kr(`Expected value to be of type string or array, but found ${nt(Fr(c))} instead.`)}eachChild(o){o(this.input)}outputDefined(){return!1}}const vc={"==":iu,"!=":_g,">":jm,"<":vg,">=":of,"<=":xg,array:sa,at:fd,boolean:sa,case:dd,coalesce:Kp,collator:X,format:Kh,image:gd,in:tf,"index-of":Wh,interpolate:cs,"interpolate-hcl":cs,"interpolate-lab":cs,length:Ru,let:Qp,literal:Du,match:ef,number:sa,"number-format":sf,object:sa,slice:nf,step:Ou,string:sa,"to-boolean":yl,"to-color":yl,"to-number":yl,"to-string":yl,var:Zr,within:Br};function bg(l,[o,c,f,g]){o=o.evaluate(l),c=c.evaluate(l),f=f.evaluate(l);const x=g?g.evaluate(l):1,b=Zp(o,c,f,x);if(b)throw new kr(b);return new or(o/255,c/255,f/255,x,!1)}function wg(l,o){return l in o}function Qh(l,o){const c=o[l];return c===void 0?null:c}function Na(l){return{type:l}}function af(l){return{result:"success",value:l}}function ou(l){return{result:"error",value:l}}function _l(l){return l["property-type"]==="data-driven"||l["property-type"]==="cross-faded-data-driven"}function oh(l){return!!l.expression&&l.expression.parameters.indexOf("zoom")>-1}function md(l){return!!l.expression&&l.expression.interpolated}function Zn(l){return l instanceof Number?"number":l instanceof String?"string":l instanceof Boolean?"boolean":Array.isArray(l)?"array":l===null?"null":typeof l}function $r(l){return typeof l=="object"&&l!==null&&!Array.isArray(l)}function Xm(l){return l}function Ln(l,o){const c=o.type==="color",f=l.stops&&typeof l.stops[0][0]=="object",g=f||!(f||l.property!==void 0),x=l.type||(md(o)?"exponential":"interval");if(c||o.type==="padding"){const R=c?or.parse:Lo.parse;(l=uo({},l)).stops&&(l.stops=l.stops.map(z=>[z[0],R(z[1])])),l.default=R(l.default?l.default:o.default)}if(l.colorSpace&&(b=l.colorSpace)!=="rgb"&&b!=="hcl"&&b!=="lab")throw new Error(`Unknown color space: "${l.colorSpace}"`);var b;let I,L,M;if(x==="exponential")I=Bs;else if(x==="interval")I=ar;else if(x==="categorical"){I=Nr,L=Object.create(null);for(const R of l.stops)L[R[0]]=R[1];M=typeof l.stops[0][0]}else{if(x!=="identity")throw new Error(`Unknown function type "${x}"`);I=xl}if(f){const R={},z=[];for(let H=0;H<l.stops.length;H++){const Q=l.stops[H],ut=Q[0].zoom;R[ut]===void 0&&(R[ut]={zoom:ut,type:l.type,property:l.property,default:l.default,stops:[]},z.push(ut)),R[ut].stops.push([Q[0].value,Q[1]])}const U=[];for(const H of z)U.push([R[H].zoom,Ln(R[H],o)]);const Y={name:"linear"};return{kind:"composite",interpolationType:Y,interpolationFactor:cs.interpolationFactor.bind(void 0,Y),zoomStops:U.map(H=>H[0]),evaluate:({zoom:H},Q)=>Bs({stops:U,base:l.base},o,H).evaluate(H,Q)}}if(g){const R=x==="exponential"?{name:"exponential",base:l.base!==void 0?l.base:1}:null;return{kind:"camera",interpolationType:R,interpolationFactor:cs.interpolationFactor.bind(void 0,R),zoomStops:l.stops.map(z=>z[0]),evaluate:({zoom:z})=>I(l,o,z,L,M)}}return{kind:"source",evaluate(R,z){const U=z&&z.properties?z.properties[l.property]:void 0;return U===void 0?vl(l.default,o.default):I(l,o,U,L,M)}}}function vl(l,o,c){return l!==void 0?l:o!==void 0?o:c!==void 0?c:void 0}function Nr(l,o,c,f,g){return vl(typeof c===g?f[c]:void 0,l.default,o.default)}function ar(l,o,c){if(Zn(c)!=="number")return vl(l.default,o.default);const f=l.stops.length;if(f===1||c<=l.stops[0][0])return l.stops[0][1];if(c>=l.stops[f-1][0])return l.stops[f-1][1];const g=ls(l.stops.map(x=>x[0]),c);return l.stops[g][1]}function Bs(l,o,c){const f=l.base!==void 0?l.base:1;if(Zn(c)!=="number")return vl(l.default,o.default);const g=l.stops.length;if(g===1||c<=l.stops[0][0])return l.stops[0][1];if(c>=l.stops[g-1][0])return l.stops[g-1][1];const x=ls(l.stops.map(R=>R[0]),c),b=function(R,z,U,Y){const H=Y-U,Q=R-U;return H===0?0:z===1?Q/H:(Math.pow(z,Q)-1)/(Math.pow(z,H)-1)}(c,f,l.stops[x][0],l.stops[x+1][0]),I=l.stops[x][1],L=l.stops[x+1][1],M=Xo[o.type]||Xm;return typeof I.evaluate=="function"?{evaluate(...R){const z=I.evaluate.apply(void 0,R),U=L.evaluate.apply(void 0,R);if(z!==void 0&&U!==void 0)return M(z,U,b,l.colorSpace)}}:M(I,L,b,l.colorSpace)}function xl(l,o,c){switch(o.type){case"color":c=or.parse(c);break;case"formatted":c=Ar.fromString(c.toString());break;case"resolvedImage":c=oo.fromString(c.toString());break;case"padding":c=Lo.parse(c);break;default:Zn(c)===o.type||o.type==="enum"&&o.values[c]||(c=void 0)}return vl(c,l.default,o.default)}us.register(vc,{error:[{kind:"error"},[an],(l,[o])=>{throw new kr(o.evaluate(l))}],typeof:[an,[je],(l,[o])=>nt(Fr(o.evaluate(l)))],"to-rgba":[q(le,4),[ro],(l,[o])=>{const[c,f,g,x]=o.evaluate(l).rgb;return[255*c,255*f,255*g,x]}],rgb:[ro,[le,le,le],bg],rgba:[ro,[le,le,le,le],bg],has:{type:Ye,overloads:[[[an],(l,[o])=>wg(o.evaluate(l),l.properties())],[[an,jo],(l,[o,c])=>wg(o.evaluate(l),c.evaluate(l))]]},get:{type:je,overloads:[[[an],(l,[o])=>Qh(o.evaluate(l),l.properties())],[[an,jo],(l,[o,c])=>Qh(o.evaluate(l),c.evaluate(l))]]},"feature-state":[je,[an],(l,[o])=>Qh(o.evaluate(l),l.featureState||{})],properties:[jo,[],l=>l.properties()],"geometry-type":[an,[],l=>l.geometryType()],id:[je,[],l=>l.id()],zoom:[le,[],l=>l.globals.zoom],"heatmap-density":[le,[],l=>l.globals.heatmapDensity||0],"line-progress":[le,[],l=>l.globals.lineProgress||0],accumulated:[je,[],l=>l.globals.accumulated===void 0?null:l.globals.accumulated],"+":[le,Na(le),(l,o)=>{let c=0;for(const f of o)c+=f.evaluate(l);return c}],"*":[le,Na(le),(l,o)=>{let c=1;for(const f of o)c*=f.evaluate(l);return c}],"-":{type:le,overloads:[[[le,le],(l,[o,c])=>o.evaluate(l)-c.evaluate(l)],[[le],(l,[o])=>-o.evaluate(l)]]},"/":[le,[le,le],(l,[o,c])=>o.evaluate(l)/c.evaluate(l)],"%":[le,[le,le],(l,[o,c])=>o.evaluate(l)%c.evaluate(l)],ln2:[le,[],()=>Math.LN2],pi:[le,[],()=>Math.PI],e:[le,[],()=>Math.E],"^":[le,[le,le],(l,[o,c])=>Math.pow(o.evaluate(l),c.evaluate(l))],sqrt:[le,[le],(l,[o])=>Math.sqrt(o.evaluate(l))],log10:[le,[le],(l,[o])=>Math.log(o.evaluate(l))/Math.LN10],ln:[le,[le],(l,[o])=>Math.log(o.evaluate(l))],log2:[le,[le],(l,[o])=>Math.log(o.evaluate(l))/Math.LN2],sin:[le,[le],(l,[o])=>Math.sin(o.evaluate(l))],cos:[le,[le],(l,[o])=>Math.cos(o.evaluate(l))],tan:[le,[le],(l,[o])=>Math.tan(o.evaluate(l))],asin:[le,[le],(l,[o])=>Math.asin(o.evaluate(l))],acos:[le,[le],(l,[o])=>Math.acos(o.evaluate(l))],atan:[le,[le],(l,[o])=>Math.atan(o.evaluate(l))],min:[le,Na(le),(l,o)=>Math.min(...o.map(c=>c.evaluate(l)))],max:[le,Na(le),(l,o)=>Math.max(...o.map(c=>c.evaluate(l)))],abs:[le,[le],(l,[o])=>Math.abs(o.evaluate(l))],round:[le,[le],(l,[o])=>{const c=o.evaluate(l);return c<0?-Math.round(-c):Math.round(c)}],floor:[le,[le],(l,[o])=>Math.floor(o.evaluate(l))],ceil:[le,[le],(l,[o])=>Math.ceil(o.evaluate(l))],"filter-==":[Ye,[an,je],(l,[o,c])=>l.properties()[o.value]===c.value],"filter-id-==":[Ye,[je],(l,[o])=>l.id()===o.value],"filter-type-==":[Ye,[an],(l,[o])=>l.geometryType()===o.value],"filter-<":[Ye,[an,je],(l,[o,c])=>{const f=l.properties()[o.value],g=c.value;return typeof f==typeof g&&f<g}],"filter-id-<":[Ye,[je],(l,[o])=>{const c=l.id(),f=o.value;return typeof c==typeof f&&c<f}],"filter->":[Ye,[an,je],(l,[o,c])=>{const f=l.properties()[o.value],g=c.value;return typeof f==typeof g&&f>g}],"filter-id->":[Ye,[je],(l,[o])=>{const c=l.id(),f=o.value;return typeof c==typeof f&&c>f}],"filter-<=":[Ye,[an,je],(l,[o,c])=>{const f=l.properties()[o.value],g=c.value;return typeof f==typeof g&&f<=g}],"filter-id-<=":[Ye,[je],(l,[o])=>{const c=l.id(),f=o.value;return typeof c==typeof f&&c<=f}],"filter->=":[Ye,[an,je],(l,[o,c])=>{const f=l.properties()[o.value],g=c.value;return typeof f==typeof g&&f>=g}],"filter-id->=":[Ye,[je],(l,[o])=>{const c=l.id(),f=o.value;return typeof c==typeof f&&c>=f}],"filter-has":[Ye,[je],(l,[o])=>o.value in l.properties()],"filter-has-id":[Ye,[],l=>l.id()!==null&&l.id()!==void 0],"filter-type-in":[Ye,[q(an)],(l,[o])=>o.value.indexOf(l.geometryType())>=0],"filter-id-in":[Ye,[q(je)],(l,[o])=>o.value.indexOf(l.id())>=0],"filter-in-small":[Ye,[an,q(je)],(l,[o,c])=>c.value.indexOf(l.properties()[o.value])>=0],"filter-in-large":[Ye,[an,q(je)],(l,[o,c])=>function(f,g,x,b){for(;x<=b;){const I=x+b>>1;if(g[I]===f)return!0;g[I]>f?b=I-1:x=I+1}return!1}(l.properties()[o.value],c.value,0,c.value.length-1)],all:{type:Ye,overloads:[[[Ye,Ye],(l,[o,c])=>o.evaluate(l)&&c.evaluate(l)],[Na(Ye),(l,o)=>{for(const c of o)if(!c.evaluate(l))return!1;return!0}]]},any:{type:Ye,overloads:[[[Ye,Ye],(l,[o,c])=>o.evaluate(l)||c.evaluate(l)],[Na(Ye),(l,o)=>{for(const c of o)if(c.evaluate(l))return!0;return!1}]]},"!":[Ye,[Ye],(l,[o])=>!o.evaluate(l)],"is-supported-script":[Ye,[an],(l,[o])=>{const c=l.globals&&l.globals.isSupportedScript;return!c||c(o.evaluate(l))}],upcase:[an,[an],(l,[o])=>o.evaluate(l).toUpperCase()],downcase:[an,[an],(l,[o])=>o.evaluate(l).toLowerCase()],concat:[an,Na(je),(l,o)=>o.map(c=>qn(c.evaluate(l))).join("")],"resolved-locale":[an,[as],(l,[o])=>o.evaluate(l).resolvedLocale()]});class sh{constructor(o,c){var f;this.expression=o,this._warningHistory={},this._evaluator=new E,this._defaultValue=c?(f=c).type==="color"&&$r(f.default)?new or(0,0,0,0):f.type==="color"?or.parse(f.default)||null:f.type==="padding"?Lo.parse(f.default)||null:f.type==="variableAnchorOffsetCollection"?io.parse(f.default)||null:f.default===void 0?null:f.default:null,this._enumValues=c&&c.type==="enum"?c.values:null}evaluateWithoutErrorHandling(o,c,f,g,x,b){return this._evaluator.globals=o,this._evaluator.feature=c,this._evaluator.featureState=f,this._evaluator.canonical=g,this._evaluator.availableImages=x||null,this._evaluator.formattedSection=b,this.expression.evaluate(this._evaluator)}evaluate(o,c,f,g,x,b){this._evaluator.globals=o,this._evaluator.feature=c||null,this._evaluator.featureState=f||null,this._evaluator.canonical=g,this._evaluator.availableImages=x||null,this._evaluator.formattedSection=b||null;try{const I=this.expression.evaluate(this._evaluator);if(I==null||typeof I=="number"&&I!=I)return this._defaultValue;if(this._enumValues&&!(I in this._enumValues))throw new kr(`Expected value to be one of ${Object.keys(this._enumValues).map(L=>JSON.stringify(L)).join(", ")}, but found ${JSON.stringify(I)} instead.`);return I}catch(I){return this._warningHistory[I.message]||(this._warningHistory[I.message]=!0,typeof console<"u"&&console.warn(I.message)),this._defaultValue}}}function Pa(l){return Array.isArray(l)&&l.length>0&&typeof l[0]=="string"&&l[0]in vc}function uf(l,o){const c=new A(vc,Hp,[],o?function(g){const x={color:ro,string:an,number:le,enum:an,boolean:Ye,formatted:ot,padding:V,resolvedImage:G,variableAnchorOffsetCollection:J};return g.type==="array"?q(x[g.value]||je,g.length):x[g.type]}(o):void 0),f=c.parse(l,void 0,void 0,void 0,o&&o.type==="string"?{typeAnnotation:"coerce"}:void 0);return f?af(new sh(f,o)):ou(c.errors)}class ah{constructor(o,c){this.kind=o,this._styleExpression=c,this.isStateDependent=o!=="constant"&&!ih(c.expression)}evaluateWithoutErrorHandling(o,c,f,g,x,b){return this._styleExpression.evaluateWithoutErrorHandling(o,c,f,g,x,b)}evaluate(o,c,f,g,x,b){return this._styleExpression.evaluate(o,c,f,g,x,b)}}class bl{constructor(o,c,f,g){this.kind=o,this.zoomStops=f,this._styleExpression=c,this.isStateDependent=o!=="camera"&&!ih(c.expression),this.interpolationType=g}evaluateWithoutErrorHandling(o,c,f,g,x,b){return this._styleExpression.evaluateWithoutErrorHandling(o,c,f,g,x,b)}evaluate(o,c,f,g,x,b){return this._styleExpression.evaluate(o,c,f,g,x,b)}interpolationFactor(o,c,f){return this.interpolationType?cs.interpolationFactor(this.interpolationType,o,c,f):0}}function lf(l,o){const c=uf(l,o);if(c.result==="error")return c;const f=c.value.expression,g=yr(f);if(!g&&!_l(o))return ou([new wr("","data expressions not supported")]);const x=Wp(f,["zoom"]);if(!x&&!oh(o))return ou([new wr("","zoom expressions not supported")]);const b=tp(f);return b||x?b instanceof wr?ou([b]):b instanceof cs&&!md(o)?ou([new wr("",'"interpolate" expressions cannot be used with this property')]):af(b?new bl(g?"camera":"composite",c.value,b.labels,b instanceof cs?b.interpolation:void 0):new ah(g?"constant":"source",c.value)):ou([new wr("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')])}class uh{constructor(o,c){this._parameters=o,this._specification=c,uo(this,Ln(this._parameters,this._specification))}static deserialize(o){return new uh(o._parameters,o._specification)}static serialize(o){return{_parameters:o._parameters,_specification:o._specification}}}function tp(l){let o=null;if(l instanceof Qp)o=tp(l.result);else if(l instanceof Kp){for(const c of l.args)if(o=tp(c),o)break}else(l instanceof Ou||l instanceof cs)&&l.input instanceof us&&l.input.name==="zoom"&&(o=l);return o instanceof wr||l.eachChild(c=>{const f=tp(c);f instanceof wr?o=f:!o&&f?o=new wr("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):o&&f&&o!==f&&(o=new wr("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),o}function ep(l){if(l===!0||l===!1)return!0;if(!Array.isArray(l)||l.length===0)return!1;switch(l[0]){case"has":return l.length>=2&&l[1]!=="$id"&&l[1]!=="$type";case"in":return l.length>=3&&(typeof l[1]!="string"||Array.isArray(l[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return l.length!==3||Array.isArray(l[1])||Array.isArray(l[2]);case"any":case"all":for(const o of l.slice(1))if(!ep(o)&&typeof o!="boolean")return!1;return!0;default:return!0}}const Eg={type:"boolean",default:!1,transition:!1,"property-type":"data-driven",expression:{interpolated:!1,parameters:["zoom","feature"]}};function cf(l){if(l==null)return{filter:()=>!0,needGeometry:!1};ep(l)||(l=pf(l));const o=uf(l,Eg);if(o.result==="error")throw new Error(o.value.map(c=>`${c.key}: ${c.message}`).join(", "));return{filter:(c,f,g)=>o.value.evaluate(c,f,{},g),needGeometry:xc(l)}}function hf(l,o){return l<o?-1:l>o?1:0}function xc(l){if(!Array.isArray(l))return!1;if(l[0]==="within")return!0;for(let o=1;o<l.length;o++)if(xc(l[o]))return!0;return!1}function pf(l){if(!l)return!0;const o=l[0];return l.length<=1?o!=="any":o==="=="?su(l[1],l[2],"=="):o==="!="?lh(su(l[1],l[2],"==")):o==="<"||o===">"||o==="<="||o===">="?su(l[1],l[2],o):o==="any"?(c=l.slice(1),["any"].concat(c.map(pf))):o==="all"?["all"].concat(l.slice(1).map(pf)):o==="none"?["all"].concat(l.slice(1).map(pf).map(lh)):o==="in"?Ig(l[1],l.slice(2)):o==="!in"?lh(Ig(l[1],l.slice(2))):o==="has"?wl(l[1]):o==="!has"?lh(wl(l[1])):o!=="within"||l;var c}function su(l,o,c){switch(l){case"$type":return[`filter-type-${c}`,o];case"$id":return[`filter-id-${c}`,o];default:return[`filter-${c}`,l,o]}}function Ig(l,o){if(o.length===0)return!1;switch(l){case"$type":return["filter-type-in",["literal",o]];case"$id":return["filter-id-in",["literal",o]];default:return o.length>200&&!o.some(c=>typeof c!=typeof o[0])?["filter-in-large",l,["literal",o.sort(hf)]]:["filter-in-small",l,["literal",o]]}}function wl(l){switch(l){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",l]}}function lh(l){return["!",l]}function ff(l){const o=typeof l;if(o==="number"||o==="boolean"||o==="string"||l==null)return JSON.stringify(l);if(Array.isArray(l)){let g="[";for(const x of l)g+=`${ff(x)},`;return`${g}]`}const c=Object.keys(l).sort();let f="{";for(let g=0;g<c.length;g++)f+=`${JSON.stringify(c[g])}:${ff(l[c[g]])},`;return`${f}}`}function bc(l){let o="";for(const c of hi)o+=`/${ff(l[c])}`;return o}function df(l){const o=l.value;return o?[new se(l.key,o,"constants have been deprecated as of v8")]:[]}function Vr(l){return l instanceof Number||l instanceof String||l instanceof Boolean?l.valueOf():l}function El(l){if(Array.isArray(l))return l.map(El);if(l instanceof Object&&!(l instanceof Number||l instanceof String||l instanceof Boolean)){const o={};for(const c in l)o[c]=El(l[c]);return o}return Vr(l)}function Yo(l){const o=l.key,c=l.value,f=l.valueSpec||{},g=l.objectElementValidators||{},x=l.style,b=l.styleSpec,I=l.validateSpec;let L=[];const M=Zn(c);if(M!=="object")return[new se(o,c,`object expected, ${M} found`)];for(const R in c){const z=R.split(".")[0],U=f[z]||f["*"];let Y;if(g[z])Y=g[z];else if(f[z])Y=I;else if(g["*"])Y=g["*"];else{if(!f["*"]){L.push(new se(o,c[R],`unknown property "${R}"`));continue}Y=I}L=L.concat(Y({key:(o&&`${o}.`)+R,value:c[R],valueSpec:U,style:x,styleSpec:b,object:c,objectKey:R,validateSpec:I},c))}for(const R in f)g[R]||f[R].required&&f[R].default===void 0&&c[R]===void 0&&L.push(new se(o,c,`missing required property "${R}"`));return L}function au(l){const o=l.value,c=l.valueSpec,f=l.style,g=l.styleSpec,x=l.key,b=l.arrayElementValidator||l.validateSpec;if(Zn(o)!=="array")return[new se(x,o,`array expected, ${Zn(o)} found`)];if(c.length&&o.length!==c.length)return[new se(x,o,`array length ${c.length} expected, length ${o.length} found`)];if(c["min-length"]&&o.length<c["min-length"])return[new se(x,o,`array length at least ${c["min-length"]} expected, length ${o.length} found`)];let I={type:c.value,values:c.values};g.$version<7&&(I.function=c.function),Zn(c.value)==="object"&&(I=c.value);let L=[];for(let M=0;M<o.length;M++)L=L.concat(b({array:o,arrayIndex:M,value:o[M],valueSpec:I,validateSpec:l.validateSpec,style:f,styleSpec:g,key:`${x}[${M}]`}));return L}function ch(l){const o=l.key,c=l.value,f=l.valueSpec;let g=Zn(c);return g==="number"&&c!=c&&(g="NaN"),g!=="number"?[new se(o,c,`number expected, ${g} found`)]:"minimum"in f&&c<f.minimum?[new se(o,c,`${c} is less than the minimum value ${f.minimum}`)]:"maximum"in f&&c>f.maximum?[new se(o,c,`${c} is greater than the maximum value ${f.maximum}`)]:[]}function gf(l){const o=l.valueSpec,c=Vr(l.value.type);let f,g,x,b={};const I=c!=="categorical"&&l.value.property===void 0,L=!I,M=Zn(l.value.stops)==="array"&&Zn(l.value.stops[0])==="array"&&Zn(l.value.stops[0][0])==="object",R=Yo({key:l.key,value:l.value,valueSpec:l.styleSpec.function,validateSpec:l.validateSpec,style:l.style,styleSpec:l.styleSpec,objectElementValidators:{stops:function(Y){if(c==="identity")return[new se(Y.key,Y.value,'identity function may not have a "stops" property')];let H=[];const Q=Y.value;return H=H.concat(au({key:Y.key,value:Q,valueSpec:Y.valueSpec,validateSpec:Y.validateSpec,style:Y.style,styleSpec:Y.styleSpec,arrayElementValidator:z})),Zn(Q)==="array"&&Q.length===0&&H.push(new se(Y.key,Q,"array must have at least one stop")),H},default:function(Y){return Y.validateSpec({key:Y.key,value:Y.value,valueSpec:o,validateSpec:Y.validateSpec,style:Y.style,styleSpec:Y.styleSpec})}}});return c==="identity"&&I&&R.push(new se(l.key,l.value,'missing required property "property"')),c==="identity"||l.value.stops||R.push(new se(l.key,l.value,'missing required property "stops"')),c==="exponential"&&l.valueSpec.expression&&!md(l.valueSpec)&&R.push(new se(l.key,l.value,"exponential functions not supported")),l.styleSpec.$version>=8&&(L&&!_l(l.valueSpec)?R.push(new se(l.key,l.value,"property functions not supported")):I&&!oh(l.valueSpec)&&R.push(new se(l.key,l.value,"zoom functions not supported"))),c!=="categorical"&&!M||l.value.property!==void 0||R.push(new se(l.key,l.value,'"property" property is required')),R;function z(Y){let H=[];const Q=Y.value,ut=Y.key;if(Zn(Q)!=="array")return[new se(ut,Q,`array expected, ${Zn(Q)} found`)];if(Q.length!==2)return[new se(ut,Q,`array length 2 expected, length ${Q.length} found`)];if(M){if(Zn(Q[0])!=="object")return[new se(ut,Q,`object expected, ${Zn(Q[0])} found`)];if(Q[0].zoom===void 0)return[new se(ut,Q,"object stop key must have zoom")];if(Q[0].value===void 0)return[new se(ut,Q,"object stop key must have value")];if(x&&x>Vr(Q[0].zoom))return[new se(ut,Q[0].zoom,"stop zoom values must appear in ascending order")];Vr(Q[0].zoom)!==x&&(x=Vr(Q[0].zoom),g=void 0,b={}),H=H.concat(Yo({key:`${ut}[0]`,value:Q[0],valueSpec:{zoom:{}},validateSpec:Y.validateSpec,style:Y.style,styleSpec:Y.styleSpec,objectElementValidators:{zoom:ch,value:U}}))}else H=H.concat(U({key:`${ut}[0]`,value:Q[0],valueSpec:{},validateSpec:Y.validateSpec,style:Y.style,styleSpec:Y.styleSpec},Q));return Pa(El(Q[1]))?H.concat([new se(`${ut}[1]`,Q[1],"expressions are not allowed in function stops.")]):H.concat(Y.validateSpec({key:`${ut}[1]`,value:Q[1],valueSpec:o,validateSpec:Y.validateSpec,style:Y.style,styleSpec:Y.styleSpec}))}function U(Y,H){const Q=Zn(Y.value),ut=Vr(Y.value),ht=Y.value!==null?Y.value:H;if(f){if(Q!==f)return[new se(Y.key,ht,`${Q} stop domain type must match previous stop domain type ${f}`)]}else f=Q;if(Q!=="number"&&Q!=="string"&&Q!=="boolean")return[new se(Y.key,ht,"stop domain value must be a number, string, or boolean")];if(Q!=="number"&&c!=="categorical"){let Et=`number expected, ${Q} found`;return _l(o)&&c===void 0&&(Et+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new se(Y.key,ht,Et)]}return c!=="categorical"||Q!=="number"||isFinite(ut)&&Math.floor(ut)===ut?c!=="categorical"&&Q==="number"&&g!==void 0&&ut<g?[new se(Y.key,ht,"stop domain values must appear in ascending order")]:(g=ut,c==="categorical"&&ut in b?[new se(Y.key,ht,"stop domain values must be unique")]:(b[ut]=!0,[])):[new se(Y.key,ht,`integer expected, found ${ut}`)]}}function It(l){const o=(l.expressionContext==="property"?lf:uf)(El(l.value),l.valueSpec);if(o.result==="error")return o.value.map(f=>new se(`${l.key}${f.key}`,l.value,f.message));const c=o.value.expression||o.value._styleExpression.expression;if(l.expressionContext==="property"&&l.propertyKey==="text-font"&&!c.outputDefined())return[new se(l.key,l.value,`Invalid data expression for "${l.propertyKey}". Output values must be contained as literals within the expression.`)];if(l.expressionContext==="property"&&l.propertyType==="layout"&&!ih(c))return[new se(l.key,l.value,'"feature-state" data expressions are not supported with layout properties.')];if(l.expressionContext==="filter"&&!ih(c))return[new se(l.key,l.value,'"feature-state" data expressions are not supported with filters.')];if(l.expressionContext&&l.expressionContext.indexOf("cluster")===0){if(!Wp(c,["zoom","feature-state"]))return[new se(l.key,l.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(l.expressionContext==="cluster-initial"&&!yr(c))return[new se(l.key,l.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function Gt(l){const o=l.key,c=l.value,f=l.valueSpec,g=[];return Array.isArray(f.values)?f.values.indexOf(Vr(c))===-1&&g.push(new se(o,c,`expected one of [${f.values.join(", ")}], ${JSON.stringify(c)} found`)):Object.keys(f.values).indexOf(Vr(c))===-1&&g.push(new se(o,c,`expected one of [${Object.keys(f.values).join(", ")}], ${JSON.stringify(c)} found`)),g}function ge(l){return ep(El(l.value))?It(uo({},l,{expressionContext:"filter",valueSpec:{value:"boolean"}})):Xe(l)}function Xe(l){const o=l.value,c=l.key;if(Zn(o)!=="array")return[new se(c,o,`array expected, ${Zn(o)} found`)];const f=l.styleSpec;let g,x=[];if(o.length<1)return[new se(c,o,"filter array must have at least 1 element")];switch(x=x.concat(Gt({key:`${c}[0]`,value:o[0],valueSpec:f.filter_operator,style:l.style,styleSpec:l.styleSpec})),Vr(o[0])){case"<":case"<=":case">":case">=":o.length>=2&&Vr(o[1])==="$type"&&x.push(new se(c,o,`"$type" cannot be use with operator "${o[0]}"`));case"==":case"!=":o.length!==3&&x.push(new se(c,o,`filter array for operator "${o[0]}" must have 3 elements`));case"in":case"!in":o.length>=2&&(g=Zn(o[1]),g!=="string"&&x.push(new se(`${c}[1]`,o[1],`string expected, ${g} found`)));for(let b=2;b<o.length;b++)g=Zn(o[b]),Vr(o[1])==="$type"?x=x.concat(Gt({key:`${c}[${b}]`,value:o[b],valueSpec:f.geometry_type,style:l.style,styleSpec:l.styleSpec})):g!=="string"&&g!=="number"&&g!=="boolean"&&x.push(new se(`${c}[${b}]`,o[b],`string, number, or boolean expected, ${g} found`));break;case"any":case"all":case"none":for(let b=1;b<o.length;b++)x=x.concat(Xe({key:`${c}[${b}]`,value:o[b],style:l.style,styleSpec:l.styleSpec}));break;case"has":case"!has":g=Zn(o[1]),o.length!==2?x.push(new se(c,o,`filter array for "${o[0]}" operator must have 2 elements`)):g!=="string"&&x.push(new se(`${c}[1]`,o[1],`string expected, ${g} found`));break;case"within":g=Zn(o[1]),o.length!==2?x.push(new se(c,o,`filter array for "${o[0]}" operator must have 2 elements`)):g!=="object"&&x.push(new se(`${c}[1]`,o[1],`object expected, ${g} found`))}return x}function Pr(l,o){const c=l.key,f=l.validateSpec,g=l.style,x=l.styleSpec,b=l.value,I=l.objectKey,L=x[`${o}_${l.layerType}`];if(!L)return[];const M=I.match(/^(.*)-transition$/);if(o==="paint"&&M&&L[M[1]]&&L[M[1]].transition)return f({key:c,value:b,valueSpec:x.transition,style:g,styleSpec:x});const R=l.valueSpec||L[I];if(!R)return[new se(c,b,`unknown property "${I}"`)];let z;if(Zn(b)==="string"&&_l(R)&&!R.tokens&&(z=/^{([^}]+)}$/.exec(b)))return[new se(c,b,`"${I}" does not support interpolation syntax
Use an identity property function instead: \`{ "type": "identity", "property": ${JSON.stringify(z[1])} }\`.`)];const U=[];return l.layerType==="symbol"&&(I==="text-field"&&g&&!g.glyphs&&U.push(new se(c,b,'use of "text-field" requires a style "glyphs" property')),I==="text-font"&&$r(El(b))&&Vr(b.type)==="identity"&&U.push(new se(c,b,'"text-font" does not support identity functions'))),U.concat(f({key:l.key,value:b,valueSpec:R,style:g,styleSpec:x,expressionContext:"property",propertyType:o,propertyKey:I}))}function An(l){return Pr(l,"paint")}function ni(l){return Pr(l,"layout")}function di(l){let o=[];const c=l.value,f=l.key,g=l.style,x=l.styleSpec;c.type||c.ref||o.push(new se(f,c,'either "type" or "ref" is required'));let b=Vr(c.type);const I=Vr(c.ref);if(c.id){const L=Vr(c.id);for(let M=0;M<l.arrayIndex;M++){const R=g.layers[M];Vr(R.id)===L&&o.push(new se(f,c.id,`duplicate layer id "${c.id}", previously used at line ${R.id.__line__}`))}}if("ref"in c){let L;["type","source","source-layer","filter","layout"].forEach(M=>{M in c&&o.push(new se(f,c[M],`"${M}" is prohibited for ref layers`))}),g.layers.forEach(M=>{Vr(M.id)===I&&(L=M)}),L?L.ref?o.push(new se(f,c.ref,"ref cannot reference another ref layer")):b=Vr(L.type):o.push(new se(f,c.ref,`ref layer "${I}" not found`))}else if(b!=="background")if(c.source){const L=g.sources&&g.sources[c.source],M=L&&Vr(L.type);L?M==="vector"&&b==="raster"?o.push(new se(f,c.source,`layer "${c.id}" requires a raster source`)):M!=="raster-dem"&&b==="hillshade"?o.push(new se(f,c.source,`layer "${c.id}" requires a raster-dem source`)):M==="raster"&&b!=="raster"?o.push(new se(f,c.source,`layer "${c.id}" requires a vector source`)):M!=="vector"||c["source-layer"]?M==="raster-dem"&&b!=="hillshade"?o.push(new se(f,c.source,"raster-dem source can only be used with layer type 'hillshade'.")):b!=="line"||!c.paint||!c.paint["line-gradient"]||M==="geojson"&&L.lineMetrics||o.push(new se(f,c,`layer "${c.id}" specifies a line-gradient, which requires a GeoJSON source with \`lineMetrics\` enabled.`)):o.push(new se(f,c,`layer "${c.id}" must specify a "source-layer"`)):o.push(new se(f,c.source,`source "${c.source}" not found`))}else o.push(new se(f,c,'missing required property "source"'));return o=o.concat(Yo({key:f,value:c,valueSpec:x.layer,style:l.style,styleSpec:l.styleSpec,validateSpec:l.validateSpec,objectElementValidators:{"*":()=>[],type:()=>l.validateSpec({key:`${f}.type`,value:c.type,valueSpec:x.layer.type,style:l.style,styleSpec:l.styleSpec,validateSpec:l.validateSpec,object:c,objectKey:"type"}),filter:ge,layout:L=>Yo({layer:c,key:L.key,value:L.value,style:L.style,styleSpec:L.styleSpec,validateSpec:L.validateSpec,objectElementValidators:{"*":M=>ni(uo({layerType:b},M))}}),paint:L=>Yo({layer:c,key:L.key,value:L.value,style:L.style,styleSpec:L.styleSpec,validateSpec:L.validateSpec,objectElementValidators:{"*":M=>An(uo({layerType:b},M))}})}})),o}function Li(l){const o=l.value,c=l.key,f=Zn(o);return f!=="string"?[new se(c,o,`string expected, ${f} found`)]:[]}const Hr={promoteId:function({key:l,value:o}){if(Zn(o)==="string")return Li({key:l,value:o});{const c=[];for(const f in o)c.push(...Li({key:`${l}.${f}`,value:o[f]}));return c}}};function ur(l){const o=l.value,c=l.key,f=l.styleSpec,g=l.style,x=l.validateSpec;if(!o.type)return[new se(c,o,'"type" is required')];const b=Vr(o.type);let I;switch(b){case"vector":case"raster":return I=Yo({key:c,value:o,valueSpec:f[`source_${b.replace("-","_")}`],style:l.style,styleSpec:f,objectElementValidators:Hr,validateSpec:x}),I;case"raster-dem":return I=function(L){var M;const R=(M=L.sourceName)!==null&&M!==void 0?M:"",z=L.value,U=L.styleSpec,Y=U.source_raster_dem,H=L.style;let Q=[];const ut=Zn(z);if(z===void 0)return Q;if(ut!=="object")return Q.push(new se("source_raster_dem",z,`object expected, ${ut} found`)),Q;const ht=Vr(z.encoding)==="custom",Et=["redFactor","greenFactor","blueFactor","baseShift"],mt=L.value.encoding?`"${L.value.encoding}"`:"Default";for(const St in z)!ht&&Et.includes(St)?Q.push(new se(St,z[St],`In "${R}": "${St}" is only valid when "encoding" is set to "custom". ${mt} encoding found`)):Y[St]?Q=Q.concat(L.validateSpec({key:St,value:z[St],valueSpec:Y[St],validateSpec:L.validateSpec,style:H,styleSpec:U})):Q.push(new se(St,z[St],`unknown property "${St}"`));return Q}({sourceName:c,value:o,style:l.style,styleSpec:f,validateSpec:x}),I;case"geojson":if(I=Yo({key:c,value:o,valueSpec:f.source_geojson,style:g,styleSpec:f,validateSpec:x,objectElementValidators:Hr}),o.cluster)for(const L in o.clusterProperties){const[M,R]=o.clusterProperties[L],z=typeof M=="string"?[M,["accumulated"],["get",L]]:M;I.push(...It({key:`${c}.${L}.map`,value:R,validateSpec:x,expressionContext:"cluster-map"})),I.push(...It({key:`${c}.${L}.reduce`,value:z,validateSpec:x,expressionContext:"cluster-reduce"}))}return I;case"video":return Yo({key:c,value:o,valueSpec:f.source_video,style:g,validateSpec:x,styleSpec:f});case"image":return Yo({key:c,value:o,valueSpec:f.source_image,style:g,validateSpec:x,styleSpec:f});case"canvas":return[new se(c,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return Gt({key:`${c}.type`,value:o.type,valueSpec:{values:["vector","raster","raster-dem","geojson","video","image"]},style:g,validateSpec:x,styleSpec:f})}}function hs(l){const o=l.value,c=l.styleSpec,f=c.light,g=l.style;let x=[];const b=Zn(o);if(o===void 0)return x;if(b!=="object")return x=x.concat([new se("light",o,`object expected, ${b} found`)]),x;for(const I in o){const L=I.match(/^(.*)-transition$/);x=x.concat(L&&f[L[1]]&&f[L[1]].transition?l.validateSpec({key:I,value:o[I],valueSpec:c.transition,validateSpec:l.validateSpec,style:g,styleSpec:c}):f[I]?l.validateSpec({key:I,value:o[I],valueSpec:f[I],validateSpec:l.validateSpec,style:g,styleSpec:c}):[new se(I,o[I],`unknown property "${I}"`)])}return x}function uu(l){const o=l.value,c=l.styleSpec,f=c.terrain,g=l.style;let x=[];const b=Zn(o);if(o===void 0)return x;if(b!=="object")return x=x.concat([new se("terrain",o,`object expected, ${b} found`)]),x;for(const I in o)x=x.concat(f[I]?l.validateSpec({key:I,value:o[I],valueSpec:f[I],validateSpec:l.validateSpec,style:g,styleSpec:c}):[new se(I,o[I],`unknown property "${I}"`)]);return x}function No(l){let o=[];const c=l.value,f=l.key;if(Array.isArray(c)){const g=[],x=[];for(const b in c)c[b].id&&g.includes(c[b].id)&&o.push(new se(f,c,`all the sprites' ids must be unique, but ${c[b].id} is duplicated`)),g.push(c[b].id),c[b].url&&x.includes(c[b].url)&&o.push(new se(f,c,`all the sprites' URLs must be unique, but ${c[b].url} is duplicated`)),x.push(c[b].url),o=o.concat(Yo({key:`${f}[${b}]`,value:c[b],valueSpec:{id:{type:"string",required:!0},url:{type:"string",required:!0}},validateSpec:l.validateSpec}));return o}return Li({key:f,value:c})}const lu={"*":()=>[],array:au,boolean:function(l){const o=l.value,c=l.key,f=Zn(o);return f!=="boolean"?[new se(c,o,`boolean expected, ${f} found`)]:[]},number:ch,color:function(l){const o=l.key,c=l.value,f=Zn(c);return f!=="string"?[new se(o,c,`color expected, ${f} found`)]:or.parse(String(c))?[]:[new se(o,c,`color expected, "${c}" found`)]},constants:df,enum:Gt,filter:ge,function:gf,layer:di,object:Yo,source:ur,light:hs,terrain:uu,string:Li,formatted:function(l){return Li(l).length===0?[]:It(l)},resolvedImage:function(l){return Li(l).length===0?[]:It(l)},padding:function(l){const o=l.key,c=l.value;if(Zn(c)==="array"){if(c.length<1||c.length>4)return[new se(o,c,`padding requires 1 to 4 values; ${c.length} values found`)];const f={type:"number"};let g=[];for(let x=0;x<c.length;x++)g=g.concat(l.validateSpec({key:`${o}[${x}]`,value:c[x],validateSpec:l.validateSpec,valueSpec:f}));return g}return ch({key:o,value:c,valueSpec:{}})},variableAnchorOffsetCollection:function(l){const o=l.key,c=l.value,f=Zn(c),g=l.styleSpec;if(f!=="array"||c.length<1||c.length%2!=0)return[new se(o,c,"variableAnchorOffsetCollection requires a non-empty array of even length")];let x=[];for(let b=0;b<c.length;b+=2)x=x.concat(Gt({key:`${o}[${b}]`,value:c[b],valueSpec:g.layout_symbol["text-anchor"]})),x=x.concat(au({key:`${o}[${b+1}]`,value:c[b+1],valueSpec:{length:2,value:"number"},validateSpec:l.validateSpec,style:l.style,styleSpec:g}));return x},sprite:No};function ps(l){const o=l.value,c=l.valueSpec,f=l.styleSpec;return l.validateSpec=ps,c.expression&&$r(Vr(o))?gf(l):c.expression&&Pa(El(o))?It(l):c.type&&lu[c.type]?lu[c.type](l):Yo(uo({},l,{valueSpec:c.type?f[c.type]:c}))}function np(l){const o=l.value,c=l.key,f=Li(l);return f.length||(o.indexOf("{fontstack}")===-1&&f.push(new se(c,o,'"glyphs" url must include a "{fontstack}" token')),o.indexOf("{range}")===-1&&f.push(new se(c,o,'"glyphs" url must include a "{range}" token'))),f}function lo(l,o=Vt){let c=[];return c=c.concat(ps({key:"",value:l,valueSpec:o.$root,styleSpec:o,style:l,validateSpec:ps,objectElementValidators:{glyphs:np,"*":()=>[]}})),l.constants&&(c=c.concat(df({key:"constants",value:l.constants,style:l,styleSpec:o,validateSpec:ps}))),rp(c)}function $s(l){return function(o){return l({...o,validateSpec:ps})}}function rp(l){return[].concat(l).sort((o,c)=>o.line-c.line)}function Fu(l){return function(...o){return rp(l.apply(this,o))}}lo.source=Fu($s(ur)),lo.sprite=Fu($s(No)),lo.glyphs=Fu($s(np)),lo.light=Fu($s(hs)),lo.terrain=Fu($s(uu)),lo.layer=Fu($s(di)),lo.filter=Fu($s(ge)),lo.paintProperty=Fu($s(An)),lo.layoutProperty=Fu($s(ni));const ku=lo,Er=ku.light,lr=ku.paintProperty,ip=ku.layoutProperty;function Ma(l,o){let c=!1;if(o&&o.length)for(const f of o)l.fire(new Yn(new Error(f.message))),c=!0;return c}class Il{constructor(o,c,f){const g=this.cells=[];if(o instanceof ArrayBuffer){this.arrayBuffer=o;const b=new Int32Array(this.arrayBuffer);o=b[0],this.d=(c=b[1])+2*(f=b[2]);for(let L=0;L<this.d*this.d;L++){const M=b[3+L],R=b[3+L+1];g.push(M===R?null:b.subarray(M,R))}const I=b[3+g.length+1];this.keys=b.subarray(b[3+g.length],I),this.bboxes=b.subarray(I),this.insert=this._insertReadonly}else{this.d=c+2*f;for(let b=0;b<this.d*this.d;b++)g.push([]);this.keys=[],this.bboxes=[]}this.n=c,this.extent=o,this.padding=f,this.scale=c/o,this.uid=0;const x=f/c*o;this.min=-x,this.max=o+x}insert(o,c,f,g,x){this._forEachCell(c,f,g,x,this._insertCell,this.uid++,void 0,void 0),this.keys.push(o),this.bboxes.push(c),this.bboxes.push(f),this.bboxes.push(g),this.bboxes.push(x)}_insertReadonly(){throw new Error("Cannot insert into a GridIndex created from an ArrayBuffer.")}_insertCell(o,c,f,g,x,b){this.cells[x].push(b)}query(o,c,f,g,x){const b=this.min,I=this.max;if(o<=b&&c<=b&&I<=f&&I<=g&&!x)return Array.prototype.slice.call(this.keys);{const L=[];return this._forEachCell(o,c,f,g,this._queryCell,L,{},x),L}}_queryCell(o,c,f,g,x,b,I,L){const M=this.cells[x];if(M!==null){const R=this.keys,z=this.bboxes;for(let U=0;U<M.length;U++){const Y=M[U];if(I[Y]===void 0){const H=4*Y;(L?L(z[H+0],z[H+1],z[H+2],z[H+3]):o<=z[H+2]&&c<=z[H+3]&&f>=z[H+0]&&g>=z[H+1])?(I[Y]=!0,b.push(R[Y])):I[Y]=!1}}}}_forEachCell(o,c,f,g,x,b,I,L){const M=this._convertToCellCoord(o),R=this._convertToCellCoord(c),z=this._convertToCellCoord(f),U=this._convertToCellCoord(g);for(let Y=M;Y<=z;Y++)for(let H=R;H<=U;H++){const Q=this.d*H+Y;if((!L||L(this._convertFromCellCoord(Y),this._convertFromCellCoord(H),this._convertFromCellCoord(Y+1),this._convertFromCellCoord(H+1)))&&x.call(this,o,c,f,g,Q,b,I,L))return}}_convertFromCellCoord(o){return(o-this.padding)/this.scale}_convertToCellCoord(o){return Math.max(0,Math.min(this.d-1,Math.floor(o*this.scale)+this.padding))}toArrayBuffer(){if(this.arrayBuffer)return this.arrayBuffer;const o=this.cells,c=3+this.cells.length+1+1;let f=0;for(let b=0;b<this.cells.length;b++)f+=this.cells[b].length;const g=new Int32Array(c+f+this.keys.length+this.bboxes.length);g[0]=this.extent,g[1]=this.n,g[2]=this.padding;let x=c;for(let b=0;b<o.length;b++){const I=o[b];g[3+b]=x,g.set(I,x),x+=I.length}return g[3+o.length]=x,g.set(this.keys,x),x+=this.keys.length,g[3+o.length+1]=x,g.set(this.bboxes,x),x+=this.bboxes.length,g.buffer}static serialize(o,c){const f=o.toArrayBuffer();return c&&c.push(f),{buffer:f}}static deserialize(o){return new Il(o.buffer)}}const Ni={};function ve(l,o,c={}){if(Ni[l])throw new Error(`${l} is already registered.`);Object.defineProperty(o,"_classRegistryKey",{value:l,writeable:!1}),Ni[l]={klass:o,omit:c.omit||[],shallow:c.shallow||[]}}ve("Object",Object),ve("TransferableGridIndex",Il),ve("Color",or),ve("Error",Error),ve("AJAXError",ks),ve("ResolvedImage",oo),ve("StylePropertyFunction",uh),ve("StyleExpression",sh,{omit:["_evaluator"]}),ve("ZoomDependentExpression",bl),ve("ZoomConstantExpression",ah),ve("CompoundExpression",us,{omit:["_evaluate"]});for(const l in vc)vc[l]._classRegistryKey||ve(`Expression_${l}`,vc[l]);function Aa(l){return l&&typeof ArrayBuffer<"u"&&(l instanceof ArrayBuffer||l.constructor&&l.constructor.name==="ArrayBuffer")}function aa(l,o){if(l==null||typeof l=="boolean"||typeof l=="number"||typeof l=="string"||l instanceof Boolean||l instanceof Number||l instanceof String||l instanceof Date||l instanceof RegExp||l instanceof Blob)return l;if(Aa(l)||xn(l))return o&&o.push(l),l;if(ArrayBuffer.isView(l)){const c=l;return o&&o.push(c.buffer),c}if(l instanceof ImageData)return o&&o.push(l.data.buffer),l;if(Array.isArray(l)){const c=[];for(const f of l)c.push(aa(f,o));return c}if(typeof l=="object"){const c=l.constructor,f=c._classRegistryKey;if(!f)throw new Error("can't serialize object of unregistered class");if(!Ni[f])throw new Error(`${f} is not registered.`);const g=c.serialize?c.serialize(l,o):{};if(c.serialize){if(o&&g===o[o.length-1])throw new Error("statically serialized object won't survive transfer of $name property")}else{for(const x in l){if(!l.hasOwnProperty(x)||Ni[f].omit.indexOf(x)>=0)continue;const b=l[x];g[x]=Ni[f].shallow.indexOf(x)>=0?b:aa(b,o)}l instanceof Error&&(g.message=l.message)}if(g.$name)throw new Error("$name property is reserved for worker serialization logic.");return f!=="Object"&&(g.$name=f),g}throw new Error("can't serialize object of type "+typeof l)}function zu(l){if(l==null||typeof l=="boolean"||typeof l=="number"||typeof l=="string"||l instanceof Boolean||l instanceof Number||l instanceof String||l instanceof Date||l instanceof RegExp||l instanceof Blob||Aa(l)||xn(l)||ArrayBuffer.isView(l)||l instanceof ImageData)return l;if(Array.isArray(l))return l.map(zu);if(typeof l=="object"){const o=l.$name||"Object";if(!Ni[o])throw new Error(`can't deserialize unregistered class ${o}`);const{klass:c}=Ni[o];if(!c)throw new Error(`can't deserialize unregistered class ${o}`);if(c.deserialize)return c.deserialize(l);const f=Object.create(c.prototype);for(const g of Object.keys(l)){if(g==="$name")continue;const x=l[g];f[g]=Ni[o].shallow.indexOf(g)>=0?x:zu(x)}return f}throw new Error("can't deserialize object of type "+typeof l)}class wc{constructor(){this.first=!0}update(o,c){const f=Math.floor(o);return this.first?(this.first=!1,this.lastIntegerZoom=f,this.lastIntegerZoomTime=0,this.lastZoom=o,this.lastFloorZoom=f,!0):(this.lastFloorZoom>f?(this.lastIntegerZoom=f+1,this.lastIntegerZoomTime=c):this.lastFloorZoom<f&&(this.lastIntegerZoom=f,this.lastIntegerZoomTime=c),o!==this.lastZoom&&(this.lastZoom=o,this.lastFloorZoom=f,!0))}}const he={"Latin-1 Supplement":l=>l>=128&&l<=255,Arabic:l=>l>=1536&&l<=1791,"Arabic Supplement":l=>l>=1872&&l<=1919,"Arabic Extended-A":l=>l>=2208&&l<=2303,"Hangul Jamo":l=>l>=4352&&l<=4607,"Unified Canadian Aboriginal Syllabics":l=>l>=5120&&l<=5759,Khmer:l=>l>=6016&&l<=6143,"Unified Canadian Aboriginal Syllabics Extended":l=>l>=6320&&l<=6399,"General Punctuation":l=>l>=8192&&l<=8303,"Letterlike Symbols":l=>l>=8448&&l<=8527,"Number Forms":l=>l>=8528&&l<=8591,"Miscellaneous Technical":l=>l>=8960&&l<=9215,"Control Pictures":l=>l>=9216&&l<=9279,"Optical Character Recognition":l=>l>=9280&&l<=9311,"Enclosed Alphanumerics":l=>l>=9312&&l<=9471,"Geometric Shapes":l=>l>=9632&&l<=9727,"Miscellaneous Symbols":l=>l>=9728&&l<=9983,"Miscellaneous Symbols and Arrows":l=>l>=11008&&l<=11263,"CJK Radicals Supplement":l=>l>=11904&&l<=12031,"Kangxi Radicals":l=>l>=12032&&l<=12255,"Ideographic Description Characters":l=>l>=12272&&l<=12287,"CJK Symbols and Punctuation":l=>l>=12288&&l<=12351,Hiragana:l=>l>=12352&&l<=12447,Katakana:l=>l>=12448&&l<=12543,Bopomofo:l=>l>=12544&&l<=12591,"Hangul Compatibility Jamo":l=>l>=12592&&l<=12687,Kanbun:l=>l>=12688&&l<=12703,"Bopomofo Extended":l=>l>=12704&&l<=12735,"CJK Strokes":l=>l>=12736&&l<=12783,"Katakana Phonetic Extensions":l=>l>=12784&&l<=12799,"Enclosed CJK Letters and Months":l=>l>=12800&&l<=13055,"CJK Compatibility":l=>l>=13056&&l<=13311,"CJK Unified Ideographs Extension A":l=>l>=13312&&l<=19903,"Yijing Hexagram Symbols":l=>l>=19904&&l<=19967,"CJK Unified Ideographs":l=>l>=19968&&l<=40959,"Yi Syllables":l=>l>=40960&&l<=42127,"Yi Radicals":l=>l>=42128&&l<=42191,"Hangul Jamo Extended-A":l=>l>=43360&&l<=43391,"Hangul Syllables":l=>l>=44032&&l<=55215,"Hangul Jamo Extended-B":l=>l>=55216&&l<=55295,"Private Use Area":l=>l>=57344&&l<=63743,"CJK Compatibility Ideographs":l=>l>=63744&&l<=64255,"Arabic Presentation Forms-A":l=>l>=64336&&l<=65023,"Vertical Forms":l=>l>=65040&&l<=65055,"CJK Compatibility Forms":l=>l>=65072&&l<=65103,"Small Form Variants":l=>l>=65104&&l<=65135,"Arabic Presentation Forms-B":l=>l>=65136&&l<=65279,"Halfwidth and Fullwidth Forms":l=>l>=65280&&l<=65519};function mf(l){for(const o of l)if(ph(o.charCodeAt(0)))return!0;return!1}function hh(l){for(const o of l)if(!yd(o.charCodeAt(0)))return!1;return!0}function yd(l){return!(he.Arabic(l)||he["Arabic Supplement"](l)||he["Arabic Extended-A"](l)||he["Arabic Presentation Forms-A"](l)||he["Arabic Presentation Forms-B"](l))}function ph(l){return!(l!==746&&l!==747&&(l<4352||!(he["Bopomofo Extended"](l)||he.Bopomofo(l)||he["CJK Compatibility Forms"](l)&&!(l>=65097&&l<=65103)||he["CJK Compatibility Ideographs"](l)||he["CJK Compatibility"](l)||he["CJK Radicals Supplement"](l)||he["CJK Strokes"](l)||!(!he["CJK Symbols and Punctuation"](l)||l>=12296&&l<=12305||l>=12308&&l<=12319||l===12336)||he["CJK Unified Ideographs Extension A"](l)||he["CJK Unified Ideographs"](l)||he["Enclosed CJK Letters and Months"](l)||he["Hangul Compatibility Jamo"](l)||he["Hangul Jamo Extended-A"](l)||he["Hangul Jamo Extended-B"](l)||he["Hangul Jamo"](l)||he["Hangul Syllables"](l)||he.Hiragana(l)||he["Ideographic Description Characters"](l)||he.Kanbun(l)||he["Kangxi Radicals"](l)||he["Katakana Phonetic Extensions"](l)||he.Katakana(l)&&l!==12540||!(!he["Halfwidth and Fullwidth Forms"](l)||l===65288||l===65289||l===65293||l>=65306&&l<=65310||l===65339||l===65341||l===65343||l>=65371&&l<=65503||l===65507||l>=65512&&l<=65519)||!(!he["Small Form Variants"](l)||l>=65112&&l<=65118||l>=65123&&l<=65126)||he["Unified Canadian Aboriginal Syllabics"](l)||he["Unified Canadian Aboriginal Syllabics Extended"](l)||he["Vertical Forms"](l)||he["Yijing Hexagram Symbols"](l)||he["Yi Syllables"](l)||he["Yi Radicals"](l))))}function op(l){return!(ph(l)||function(o){return!!(he["Latin-1 Supplement"](o)&&(o===167||o===169||o===174||o===177||o===188||o===189||o===190||o===215||o===247)||he["General Punctuation"](o)&&(o===8214||o===8224||o===8225||o===8240||o===8241||o===8251||o===8252||o===8258||o===8263||o===8264||o===8265||o===8273)||he["Letterlike Symbols"](o)||he["Number Forms"](o)||he["Miscellaneous Technical"](o)&&(o>=8960&&o<=8967||o>=8972&&o<=8991||o>=8996&&o<=9e3||o===9003||o>=9085&&o<=9114||o>=9150&&o<=9165||o===9167||o>=9169&&o<=9179||o>=9186&&o<=9215)||he["Control Pictures"](o)&&o!==9251||he["Optical Character Recognition"](o)||he["Enclosed Alphanumerics"](o)||he["Geometric Shapes"](o)||he["Miscellaneous Symbols"](o)&&!(o>=9754&&o<=9759)||he["Miscellaneous Symbols and Arrows"](o)&&(o>=11026&&o<=11055||o>=11088&&o<=11097||o>=11192&&o<=11243)||he["CJK Symbols and Punctuation"](o)||he.Katakana(o)||he["Private Use Area"](o)||he["CJK Compatibility Forms"](o)||he["Small Form Variants"](o)||he["Halfwidth and Fullwidth Forms"](o)||o===8734||o===8756||o===8757||o>=9984&&o<=10087||o>=10102&&o<=10131||o===65532||o===65533)}(l))}function _d(l){return l>=1424&&l<=2303||he["Arabic Presentation Forms-A"](l)||he["Arabic Presentation Forms-B"](l)}function sp(l,o){return!(!o&&_d(l)||l>=2304&&l<=3583||l>=3840&&l<=4255||he.Khmer(l))}function yf(l){for(const o of l)if(_d(o.charCodeAt(0)))return!0;return!1}const Ym="deferred",Zm="loading",Hm="loaded";let Wm=null,ua="unavailable",fh=null;const vd=function(l){l&&typeof l=="string"&&l.indexOf("NetworkError")>-1&&(ua="error"),Wm&&Wm(l)};function Jm(){xd.fire(new Ci("pluginStateChange",{pluginStatus:ua,pluginURL:fh}))}const xd=new no,Km=function(){return ua},k_=function(){if(ua!==Ym||!fh)throw new Error("rtl-text-plugin cannot be downloaded unless a pluginURL is specified");ua=Zm,Jm(),fh&&Fn({url:fh},l=>{l?vd(l):(ua=Hm,Jm())})},Da={applyArabicShaping:null,processBidirectionalText:null,processStyledBidirectionalText:null,isLoaded:()=>ua===Hm||Da.applyArabicShaping!=null,isLoading:()=>ua===Zm,setState(l){if(!Ge())throw new Error("Cannot set the state of the rtl-text-plugin when not in the web-worker context");ua=l.pluginStatus,fh=l.pluginURL},isParsed(){if(!Ge())throw new Error("rtl-text-plugin is only parsed on the worker-threads");return Da.applyArabicShaping!=null&&Da.processBidirectionalText!=null&&Da.processStyledBidirectionalText!=null},getPluginURL(){if(!Ge())throw new Error("rtl-text-plugin url can only be queried from the worker threads");return fh}};class Ur{constructor(o,c){this.zoom=o,c?(this.now=c.now,this.fadeDuration=c.fadeDuration,this.zoomHistory=c.zoomHistory,this.transition=c.transition):(this.now=0,this.fadeDuration=0,this.zoomHistory=new wc,this.transition={})}isSupportedScript(o){return function(c,f){for(const g of c)if(!sp(g.charCodeAt(0),f))return!1;return!0}(o,Da.isLoaded())}crossFadingFactor(){return this.fadeDuration===0?1:Math.min((this.now-this.zoomHistory.lastIntegerZoomTime)/this.fadeDuration,1)}getCrossfadeParameters(){const o=this.zoom,c=o-Math.floor(o),f=this.crossFadingFactor();return o>this.zoomHistory.lastIntegerZoom?{fromScale:2,toScale:1,t:c+(1-c)*f}:{fromScale:.5,toScale:1,t:1-(1-f)*c}}}class Sg{constructor(o,c){this.property=o,this.value=c,this.expression=function(f,g){if($r(f))return new uh(f,g);if(Pa(f)){const x=lf(f,g);if(x.result==="error")throw new Error(x.value.map(b=>`${b.key}: ${b.message}`).join(", "));return x.value}{let x=f;return g.type==="color"&&typeof f=="string"?x=or.parse(f):g.type!=="padding"||typeof f!="number"&&!Array.isArray(f)?g.type==="variableAnchorOffsetCollection"&&Array.isArray(f)&&(x=io.parse(f)):x=Lo.parse(f),{kind:"constant",evaluate:()=>x}}}(c===void 0?o.specification.default:c,o.specification)}isDataDriven(){return this.expression.kind==="source"||this.expression.kind==="composite"}possiblyEvaluate(o,c,f){return this.property.possiblyEvaluate(this,o,c,f)}}class Qm{constructor(o){this.property=o,this.value=new Sg(o,void 0)}transitioned(o,c){return new B_(this.property,this.value,c,At({},o.transition,this.transition),o.now)}untransitioned(){return new B_(this.property,this.value,null,{},0)}}class z_{constructor(o){this._properties=o,this._values=Object.create(o.defaultTransitionablePropertyValues)}getValue(o){return Kt(this._values[o].value.value)}setValue(o,c){Object.prototype.hasOwnProperty.call(this._values,o)||(this._values[o]=new Qm(this._values[o].property)),this._values[o].value=new Sg(this._values[o].property,c===null?void 0:Kt(c))}getTransition(o){return Kt(this._values[o].transition)}setTransition(o,c){Object.prototype.hasOwnProperty.call(this._values,o)||(this._values[o]=new Qm(this._values[o].property)),this._values[o].transition=Kt(c)||void 0}serialize(){const o={};for(const c of Object.keys(this._values)){const f=this.getValue(c);f!==void 0&&(o[c]=f);const g=this.getTransition(c);g!==void 0&&(o[`${c}-transition`]=g)}return o}transitioned(o,c){const f=new $_(this._properties);for(const g of Object.keys(this._values))f._values[g]=this._values[g].transitioned(o,c._values[g]);return f}untransitioned(){const o=new $_(this._properties);for(const c of Object.keys(this._values))o._values[c]=this._values[c].untransitioned();return o}}class B_{constructor(o,c,f,g,x){this.property=o,this.value=c,this.begin=x+g.delay||0,this.end=this.begin+g.duration||0,o.specification.transition&&(g.delay||g.duration)&&(this.prior=f)}possiblyEvaluate(o,c,f){const g=o.now||0,x=this.value.possiblyEvaluate(o,c,f),b=this.prior;if(b){if(g>this.end)return this.prior=null,x;if(this.value.isDataDriven())return this.prior=null,x;if(g<this.begin)return b.possiblyEvaluate(o,c,f);{const I=(g-this.begin)/(this.end-this.begin);return this.property.interpolate(b.possiblyEvaluate(o,c,f),x,function(L){if(L<=0)return 0;if(L>=1)return 1;const M=L*L,R=M*L;return 4*(L<.5?R:3*(L-M)+R-.75)}(I))}}return x}}class $_{constructor(o){this._properties=o,this._values=Object.create(o.defaultTransitioningPropertyValues)}possiblyEvaluate(o,c,f){const g=new Cg(this._properties);for(const x of Object.keys(this._values))g._values[x]=this._values[x].possiblyEvaluate(o,c,f);return g}hasTransition(){for(const o of Object.keys(this._values))if(this._values[o].prior)return!0;return!1}}class O0{constructor(o){this._properties=o,this._values=Object.create(o.defaultPropertyValues)}hasValue(o){return this._values[o].value!==void 0}getValue(o){return Kt(this._values[o].value)}setValue(o,c){this._values[o]=new Sg(this._values[o].property,c===null?void 0:Kt(c))}serialize(){const o={};for(const c of Object.keys(this._values)){const f=this.getValue(c);f!==void 0&&(o[c]=f)}return o}possiblyEvaluate(o,c,f){const g=new Cg(this._properties);for(const x of Object.keys(this._values))g._values[x]=this._values[x].possiblyEvaluate(o,c,f);return g}}class Vs{constructor(o,c,f){this.property=o,this.value=c,this.parameters=f}isConstant(){return this.value.kind==="constant"}constantOr(o){return this.value.kind==="constant"?this.value.value:o}evaluate(o,c,f,g){return this.property.evaluate(this.value,this.parameters,o,c,f,g)}}class Cg{constructor(o){this._properties=o,this._values=Object.create(o.defaultPossiblyEvaluatedValues)}get(o){return this._values[o]}}class ze{constructor(o){this.specification=o}possiblyEvaluate(o,c){if(o.isDataDriven())throw new Error("Value should not be data driven");return o.expression.evaluate(c)}interpolate(o,c,f){const g=Xo[this.specification.type];return g?g(o,c,f):o}}class Ze{constructor(o,c){this.specification=o,this.overrides=c}possiblyEvaluate(o,c,f,g){return new Vs(this,o.expression.kind==="constant"||o.expression.kind==="camera"?{kind:"constant",value:o.expression.evaluate(c,null,{},f,g)}:o.expression,c)}interpolate(o,c,f){if(o.value.kind!=="constant"||c.value.kind!=="constant")return o;if(o.value.value===void 0||c.value.value===void 0)return new Vs(this,{kind:"constant",value:void 0},o.parameters);const g=Xo[this.specification.type];if(g){const x=g(o.value.value,c.value.value,f);return new Vs(this,{kind:"constant",value:x},o.parameters)}return o}evaluate(o,c,f,g,x,b){return o.kind==="constant"?o.value:o.evaluate(c,f,g,x,b)}}class bd extends Ze{possiblyEvaluate(o,c,f,g){if(o.value===void 0)return new Vs(this,{kind:"constant",value:void 0},c);if(o.expression.kind==="constant"){const x=o.expression.evaluate(c,null,{},f,g),b=o.property.specification.type==="resolvedImage"&&typeof x!="string"?x.name:x,I=this._calculate(b,b,b,c);return new Vs(this,{kind:"constant",value:I},c)}if(o.expression.kind==="camera"){const x=this._calculate(o.expression.evaluate({zoom:c.zoom-1}),o.expression.evaluate({zoom:c.zoom}),o.expression.evaluate({zoom:c.zoom+1}),c);return new Vs(this,{kind:"constant",value:x},c)}return new Vs(this,o.expression,c)}evaluate(o,c,f,g,x,b){if(o.kind==="source"){const I=o.evaluate(c,f,g,x,b);return this._calculate(I,I,I,c)}return o.kind==="composite"?this._calculate(o.evaluate({zoom:Math.floor(c.zoom)-1},f,g),o.evaluate({zoom:Math.floor(c.zoom)},f,g),o.evaluate({zoom:Math.floor(c.zoom)+1},f,g),c):o.value}_calculate(o,c,f,g){return g.zoom>g.zoomHistory.lastIntegerZoom?{from:o,to:c}:{from:f,to:c}}interpolate(o){return o}}class ty{constructor(o){this.specification=o}possiblyEvaluate(o,c,f,g){if(o.value!==void 0){if(o.expression.kind==="constant"){const x=o.expression.evaluate(c,null,{},f,g);return this._calculate(x,x,x,c)}return this._calculate(o.expression.evaluate(new Ur(Math.floor(c.zoom-1),c)),o.expression.evaluate(new Ur(Math.floor(c.zoom),c)),o.expression.evaluate(new Ur(Math.floor(c.zoom+1),c)),c)}}_calculate(o,c,f,g){return g.zoom>g.zoomHistory.lastIntegerZoom?{from:o,to:c}:{from:f,to:c}}interpolate(o){return o}}class ey{constructor(o){this.specification=o}possiblyEvaluate(o,c,f,g){return!!o.expression.evaluate(c,null,{},f,g)}interpolate(){return!1}}class Gi{constructor(o){this.properties=o,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];for(const c in o){const f=o[c];f.specification.overridable&&this.overridableProperties.push(c);const g=this.defaultPropertyValues[c]=new Sg(f,void 0),x=this.defaultTransitionablePropertyValues[c]=new Qm(f);this.defaultTransitioningPropertyValues[c]=x.untransitioned(),this.defaultPossiblyEvaluatedValues[c]=g.possiblyEvaluate({})}}}ve("DataDrivenProperty",Ze),ve("DataConstantProperty",ze),ve("CrossFadedDataDrivenProperty",bd),ve("CrossFadedProperty",ty),ve("ColorRampProperty",ey);const ny="-transition";class cu extends no{constructor(o,c){if(super(),this.id=o.id,this.type=o.type,this._featureFilter={filter:()=>!0,needGeometry:!1},o.type!=="custom"&&(this.metadata=o.metadata,this.minzoom=o.minzoom,this.maxzoom=o.maxzoom,o.type!=="background"&&(this.source=o.source,this.sourceLayer=o["source-layer"],this.filter=o.filter),c.layout&&(this._unevaluatedLayout=new O0(c.layout)),c.paint)){this._transitionablePaint=new z_(c.paint);for(const f in o.paint)this.setPaintProperty(f,o.paint[f],{validate:!1});for(const f in o.layout)this.setLayoutProperty(f,o.layout[f],{validate:!1});this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new Cg(c.paint)}}getCrossfadeParameters(){return this._crossfadeParameters}getLayoutProperty(o){return o==="visibility"?this.visibility:this._unevaluatedLayout.getValue(o)}setLayoutProperty(o,c,f={}){c!=null&&this._validate(ip,`layers.${this.id}.layout.${o}`,o,c,f)||(o!=="visibility"?this._unevaluatedLayout.setValue(o,c):this.visibility=c)}getPaintProperty(o){return o.endsWith(ny)?this._transitionablePaint.getTransition(o.slice(0,-11)):this._transitionablePaint.getValue(o)}setPaintProperty(o,c,f={}){if(c!=null&&this._validate(lr,`layers.${this.id}.paint.${o}`,o,c,f))return!1;if(o.endsWith(ny))return this._transitionablePaint.setTransition(o.slice(0,-11),c||void 0),!1;{const g=this._transitionablePaint._values[o],x=g.property.specification["property-type"]==="cross-faded-data-driven",b=g.value.isDataDriven(),I=g.value;this._transitionablePaint.setValue(o,c),this._handleSpecialPaintPropertyUpdate(o);const L=this._transitionablePaint._values[o].value;return L.isDataDriven()||b||x||this._handleOverridablePaintPropertyUpdate(o,I,L)}}_handleSpecialPaintPropertyUpdate(o){}_handleOverridablePaintPropertyUpdate(o,c,f){return!1}isHidden(o){return!!(this.minzoom&&o<this.minzoom)||!!(this.maxzoom&&o>=this.maxzoom)||this.visibility==="none"}updateTransitions(o){this._transitioningPaint=this._transitionablePaint.transitioned(o,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(o,c){o.getCrossfadeParameters&&(this._crossfadeParameters=o.getCrossfadeParameters()),this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(o,void 0,c)),this.paint=this._transitioningPaint.possiblyEvaluate(o,void 0,c)}serialize(){const o={id:this.id,type:this.type,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.visibility&&(o.layout=o.layout||{},o.layout.visibility=this.visibility),be(o,(c,f)=>!(c===void 0||f==="layout"&&!Object.keys(c).length||f==="paint"&&!Object.keys(c).length))}_validate(o,c,f,g,x={}){return(!x||x.validate!==!1)&&Ma(this,o.call(ku,{key:c,layerType:this.type,objectKey:f,value:g,styleSpec:Vt,style:{glyphs:!0,sprite:!0}}))}is3D(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}resize(){}isStateDependent(){for(const o in this.paint._values){const c=this.paint.get(o);if(c instanceof Vs&&_l(c.property.specification)&&(c.value.kind==="source"||c.value.kind==="composite")&&c.value.isStateDependent)return!0}return!1}}const V_={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class ap{constructor(o,c){this._structArray=o,this._pos1=c*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class gi{constructor(){this.isTransferred=!1,this.capacity=-1,this.resize(0)}static serialize(o,c){return o._trim(),c&&(o.isTransferred=!0,c.push(o.arrayBuffer)),{length:o.length,arrayBuffer:o.arrayBuffer}}static deserialize(o){const c=Object.create(this.prototype);return c.arrayBuffer=o.arrayBuffer,c.length=o.length,c.capacity=o.arrayBuffer.byteLength/c.bytesPerElement,c._refreshViews(),c}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(o){this.reserve(o),this.length=o}reserve(o){if(o>this.capacity){this.capacity=Math.max(o,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const c=this.uint8;this._refreshViews(),c&&this.uint8.set(c)}}_refreshViews(){throw new Error("_refreshViews() must be implemented by each concrete StructArray layout")}}function ri(l,o=1){let c=0,f=0;return{members:l.map(g=>{const x=V_[g.type].BYTES_PER_ELEMENT,b=c=_f(c,Math.max(o,x)),I=g.components||1;return f=Math.max(f,x),c+=x*I,{name:g.name,type:g.type,components:I,offset:b}}),size:_f(c,Math.max(f,o)),alignment:o}}function _f(l,o){return Math.ceil(l/o)*o}class wd extends gi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(o,c){const f=this.length;return this.resize(f+1),this.emplace(f,o,c)}emplace(o,c,f){const g=2*o;return this.int16[g+0]=c,this.int16[g+1]=f,o}}wd.prototype.bytesPerElement=4,ve("StructArrayLayout2i4",wd);class Ed extends gi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(o,c,f){const g=this.length;return this.resize(g+1),this.emplace(g,o,c,f)}emplace(o,c,f,g){const x=3*o;return this.int16[x+0]=c,this.int16[x+1]=f,this.int16[x+2]=g,o}}Ed.prototype.bytesPerElement=6,ve("StructArrayLayout3i6",Ed);class up extends gi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(o,c,f,g){const x=this.length;return this.resize(x+1),this.emplace(x,o,c,f,g)}emplace(o,c,f,g,x){const b=4*o;return this.int16[b+0]=c,this.int16[b+1]=f,this.int16[b+2]=g,this.int16[b+3]=x,o}}up.prototype.bytesPerElement=8,ve("StructArrayLayout4i8",up);class ry extends gi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(o,c,f,g,x,b){const I=this.length;return this.resize(I+1),this.emplace(I,o,c,f,g,x,b)}emplace(o,c,f,g,x,b,I){const L=6*o;return this.int16[L+0]=c,this.int16[L+1]=f,this.int16[L+2]=g,this.int16[L+3]=x,this.int16[L+4]=b,this.int16[L+5]=I,o}}ry.prototype.bytesPerElement=12,ve("StructArrayLayout2i4i12",ry);class iy extends gi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(o,c,f,g,x,b){const I=this.length;return this.resize(I+1),this.emplace(I,o,c,f,g,x,b)}emplace(o,c,f,g,x,b,I){const L=4*o,M=8*o;return this.int16[L+0]=c,this.int16[L+1]=f,this.uint8[M+4]=g,this.uint8[M+5]=x,this.uint8[M+6]=b,this.uint8[M+7]=I,o}}iy.prototype.bytesPerElement=8,ve("StructArrayLayout2i4ub8",iy);class vf extends gi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(o,c){const f=this.length;return this.resize(f+1),this.emplace(f,o,c)}emplace(o,c,f){const g=2*o;return this.float32[g+0]=c,this.float32[g+1]=f,o}}vf.prototype.bytesPerElement=8,ve("StructArrayLayout2f8",vf);class oy extends gi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(o,c,f,g,x,b,I,L,M,R){const z=this.length;return this.resize(z+1),this.emplace(z,o,c,f,g,x,b,I,L,M,R)}emplace(o,c,f,g,x,b,I,L,M,R,z){const U=10*o;return this.uint16[U+0]=c,this.uint16[U+1]=f,this.uint16[U+2]=g,this.uint16[U+3]=x,this.uint16[U+4]=b,this.uint16[U+5]=I,this.uint16[U+6]=L,this.uint16[U+7]=M,this.uint16[U+8]=R,this.uint16[U+9]=z,o}}oy.prototype.bytesPerElement=20,ve("StructArrayLayout10ui20",oy);class sy extends gi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(o,c,f,g,x,b,I,L,M,R,z,U){const Y=this.length;return this.resize(Y+1),this.emplace(Y,o,c,f,g,x,b,I,L,M,R,z,U)}emplace(o,c,f,g,x,b,I,L,M,R,z,U,Y){const H=12*o;return this.int16[H+0]=c,this.int16[H+1]=f,this.int16[H+2]=g,this.int16[H+3]=x,this.uint16[H+4]=b,this.uint16[H+5]=I,this.uint16[H+6]=L,this.uint16[H+7]=M,this.int16[H+8]=R,this.int16[H+9]=z,this.int16[H+10]=U,this.int16[H+11]=Y,o}}sy.prototype.bytesPerElement=24,ve("StructArrayLayout4i4ui4i24",sy);class cr extends gi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(o,c,f){const g=this.length;return this.resize(g+1),this.emplace(g,o,c,f)}emplace(o,c,f,g){const x=3*o;return this.float32[x+0]=c,this.float32[x+1]=f,this.float32[x+2]=g,o}}cr.prototype.bytesPerElement=12,ve("StructArrayLayout3f12",cr);class y extends gi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(o){const c=this.length;return this.resize(c+1),this.emplace(c,o)}emplace(o,c){return this.uint32[1*o+0]=c,o}}y.prototype.bytesPerElement=4,ve("StructArrayLayout1ul4",y);class s extends gi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(o,c,f,g,x,b,I,L,M){const R=this.length;return this.resize(R+1),this.emplace(R,o,c,f,g,x,b,I,L,M)}emplace(o,c,f,g,x,b,I,L,M,R){const z=10*o,U=5*o;return this.int16[z+0]=c,this.int16[z+1]=f,this.int16[z+2]=g,this.int16[z+3]=x,this.int16[z+4]=b,this.int16[z+5]=I,this.uint32[U+3]=L,this.uint16[z+8]=M,this.uint16[z+9]=R,o}}s.prototype.bytesPerElement=20,ve("StructArrayLayout6i1ul2ui20",s);class p extends gi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(o,c,f,g,x,b){const I=this.length;return this.resize(I+1),this.emplace(I,o,c,f,g,x,b)}emplace(o,c,f,g,x,b,I){const L=6*o;return this.int16[L+0]=c,this.int16[L+1]=f,this.int16[L+2]=g,this.int16[L+3]=x,this.int16[L+4]=b,this.int16[L+5]=I,o}}p.prototype.bytesPerElement=12,ve("StructArrayLayout2i2i2i12",p);class d extends gi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(o,c,f,g,x){const b=this.length;return this.resize(b+1),this.emplace(b,o,c,f,g,x)}emplace(o,c,f,g,x,b){const I=4*o,L=8*o;return this.float32[I+0]=c,this.float32[I+1]=f,this.float32[I+2]=g,this.int16[L+6]=x,this.int16[L+7]=b,o}}d.prototype.bytesPerElement=16,ve("StructArrayLayout2f1f2i16",d);class m extends gi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(o,c,f,g){const x=this.length;return this.resize(x+1),this.emplace(x,o,c,f,g)}emplace(o,c,f,g,x){const b=12*o,I=3*o;return this.uint8[b+0]=c,this.uint8[b+1]=f,this.float32[I+1]=g,this.float32[I+2]=x,o}}m.prototype.bytesPerElement=12,ve("StructArrayLayout2ub2f12",m);class v extends gi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(o,c,f){const g=this.length;return this.resize(g+1),this.emplace(g,o,c,f)}emplace(o,c,f,g){const x=3*o;return this.uint16[x+0]=c,this.uint16[x+1]=f,this.uint16[x+2]=g,o}}v.prototype.bytesPerElement=6,ve("StructArrayLayout3ui6",v);class S extends gi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(o,c,f,g,x,b,I,L,M,R,z,U,Y,H,Q,ut,ht){const Et=this.length;return this.resize(Et+1),this.emplace(Et,o,c,f,g,x,b,I,L,M,R,z,U,Y,H,Q,ut,ht)}emplace(o,c,f,g,x,b,I,L,M,R,z,U,Y,H,Q,ut,ht,Et){const mt=24*o,St=12*o,Dt=48*o;return this.int16[mt+0]=c,this.int16[mt+1]=f,this.uint16[mt+2]=g,this.uint16[mt+3]=x,this.uint32[St+2]=b,this.uint32[St+3]=I,this.uint32[St+4]=L,this.uint16[mt+10]=M,this.uint16[mt+11]=R,this.uint16[mt+12]=z,this.float32[St+7]=U,this.float32[St+8]=Y,this.uint8[Dt+36]=H,this.uint8[Dt+37]=Q,this.uint8[Dt+38]=ut,this.uint32[St+10]=ht,this.int16[mt+22]=Et,o}}S.prototype.bytesPerElement=48,ve("StructArrayLayout2i2ui3ul3ui2f3ub1ul1i48",S);class T extends gi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(o,c,f,g,x,b,I,L,M,R,z,U,Y,H,Q,ut,ht,Et,mt,St,Dt,Ht,Ie,Ae,Ee,_e,ce,Ne){const pe=this.length;return this.resize(pe+1),this.emplace(pe,o,c,f,g,x,b,I,L,M,R,z,U,Y,H,Q,ut,ht,Et,mt,St,Dt,Ht,Ie,Ae,Ee,_e,ce,Ne)}emplace(o,c,f,g,x,b,I,L,M,R,z,U,Y,H,Q,ut,ht,Et,mt,St,Dt,Ht,Ie,Ae,Ee,_e,ce,Ne,pe){const re=32*o,qe=16*o;return this.int16[re+0]=c,this.int16[re+1]=f,this.int16[re+2]=g,this.int16[re+3]=x,this.int16[re+4]=b,this.int16[re+5]=I,this.int16[re+6]=L,this.int16[re+7]=M,this.uint16[re+8]=R,this.uint16[re+9]=z,this.uint16[re+10]=U,this.uint16[re+11]=Y,this.uint16[re+12]=H,this.uint16[re+13]=Q,this.uint16[re+14]=ut,this.uint16[re+15]=ht,this.uint16[re+16]=Et,this.uint16[re+17]=mt,this.uint16[re+18]=St,this.uint16[re+19]=Dt,this.uint16[re+20]=Ht,this.uint16[re+21]=Ie,this.uint16[re+22]=Ae,this.uint32[qe+12]=Ee,this.float32[qe+13]=_e,this.float32[qe+14]=ce,this.uint16[re+30]=Ne,this.uint16[re+31]=pe,o}}T.prototype.bytesPerElement=64,ve("StructArrayLayout8i15ui1ul2f2ui64",T);class N extends gi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(o){const c=this.length;return this.resize(c+1),this.emplace(c,o)}emplace(o,c){return this.float32[1*o+0]=c,o}}N.prototype.bytesPerElement=4,ve("StructArrayLayout1f4",N);class O extends gi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(o,c,f){const g=this.length;return this.resize(g+1),this.emplace(g,o,c,f)}emplace(o,c,f,g){const x=3*o;return this.uint16[6*o+0]=c,this.float32[x+1]=f,this.float32[x+2]=g,o}}O.prototype.bytesPerElement=12,ve("StructArrayLayout1ui2f12",O);class F extends gi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(o,c,f){const g=this.length;return this.resize(g+1),this.emplace(g,o,c,f)}emplace(o,c,f,g){const x=4*o;return this.uint32[2*o+0]=c,this.uint16[x+2]=f,this.uint16[x+3]=g,o}}F.prototype.bytesPerElement=8,ve("StructArrayLayout1ul2ui8",F);class k extends gi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(o,c){const f=this.length;return this.resize(f+1),this.emplace(f,o,c)}emplace(o,c,f){const g=2*o;return this.uint16[g+0]=c,this.uint16[g+1]=f,o}}k.prototype.bytesPerElement=4,ve("StructArrayLayout2ui4",k);class j extends gi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(o){const c=this.length;return this.resize(c+1),this.emplace(c,o)}emplace(o,c){return this.uint16[1*o+0]=c,o}}j.prototype.bytesPerElement=2,ve("StructArrayLayout1ui2",j);class tt extends gi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(o,c,f,g){const x=this.length;return this.resize(x+1),this.emplace(x,o,c,f,g)}emplace(o,c,f,g,x){const b=4*o;return this.float32[b+0]=c,this.float32[b+1]=f,this.float32[b+2]=g,this.float32[b+3]=x,o}}tt.prototype.bytesPerElement=16,ve("StructArrayLayout4f16",tt);class et extends ap{get anchorPointX(){return this._structArray.int16[this._pos2+0]}get anchorPointY(){return this._structArray.int16[this._pos2+1]}get x1(){return this._structArray.int16[this._pos2+2]}get y1(){return this._structArray.int16[this._pos2+3]}get x2(){return this._structArray.int16[this._pos2+4]}get y2(){return this._structArray.int16[this._pos2+5]}get featureIndex(){return this._structArray.uint32[this._pos4+3]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+8]}get bucketIndex(){return this._structArray.uint16[this._pos2+9]}get anchorPoint(){return new D(this.anchorPointX,this.anchorPointY)}}et.prototype.size=20;class st extends s{get(o){return new et(this,o)}}ve("CollisionBoxArray",st);class K extends ap{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+2]}get numGlyphs(){return this._structArray.uint16[this._pos2+3]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+2]}get lineStartIndex(){return this._structArray.uint32[this._pos4+3]}get lineLength(){return this._structArray.uint32[this._pos4+4]}get segment(){return this._structArray.uint16[this._pos2+10]}get lowerSize(){return this._structArray.uint16[this._pos2+11]}get upperSize(){return this._structArray.uint16[this._pos2+12]}get lineOffsetX(){return this._structArray.float32[this._pos4+7]}get lineOffsetY(){return this._structArray.float32[this._pos4+8]}get writingMode(){return this._structArray.uint8[this._pos1+36]}get placedOrientation(){return this._structArray.uint8[this._pos1+37]}set placedOrientation(o){this._structArray.uint8[this._pos1+37]=o}get hidden(){return this._structArray.uint8[this._pos1+38]}set hidden(o){this._structArray.uint8[this._pos1+38]=o}get crossTileID(){return this._structArray.uint32[this._pos4+10]}set crossTileID(o){this._structArray.uint32[this._pos4+10]=o}get associatedIconIndex(){return this._structArray.int16[this._pos2+22]}}K.prototype.size=48;class xt extends S{get(o){return new K(this,o)}}ve("PlacedSymbolArray",xt);class Nt extends ap{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+2]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+3]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+4]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+5]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+6]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+7]}get key(){return this._structArray.uint16[this._pos2+8]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+9]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+10]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+11]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+12]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+13]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+14]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+15]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+16]}get featureIndex(){return this._structArray.uint16[this._pos2+17]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+18]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+19]}get numIconVertices(){return this._structArray.uint16[this._pos2+20]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+21]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+22]}get crossTileID(){return this._structArray.uint32[this._pos4+12]}set crossTileID(o){this._structArray.uint32[this._pos4+12]=o}get textBoxScale(){return this._structArray.float32[this._pos4+13]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+14]}get textAnchorOffsetStartIndex(){return this._structArray.uint16[this._pos2+30]}get textAnchorOffsetEndIndex(){return this._structArray.uint16[this._pos2+31]}}Nt.prototype.size=64;class lt extends T{get(o){return new Nt(this,o)}}ve("SymbolInstanceArray",lt);class wt extends N{getoffsetX(o){return this.float32[1*o+0]}}ve("GlyphOffsetArray",wt);class Ft extends Ed{getx(o){return this.int16[3*o+0]}gety(o){return this.int16[3*o+1]}gettileUnitDistanceFromAnchor(o){return this.int16[3*o+2]}}ve("SymbolLineVertexArray",Ft);class kt extends ap{get textAnchor(){return this._structArray.uint16[this._pos2+0]}get textOffset0(){return this._structArray.float32[this._pos4+1]}get textOffset1(){return this._structArray.float32[this._pos4+2]}}kt.prototype.size=12;class Zt extends O{get(o){return new kt(this,o)}}ve("TextAnchorOffsetArray",Zt);class ee extends ap{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}}ee.prototype.size=8;class Jt extends F{get(o){return new ee(this,o)}}ve("FeatureIndexArray",Jt);class ue extends wd{}class Me extends wd{}class Nn extends wd{}class ye extends ry{}class He extends iy{}class De extends vf{}class _r extends oy{}class Tn extends sy{}class _n extends cr{}class Pn extends y{}class Pi extends p{}class Dr extends m{}class Zo extends v{}class co extends k{}const qi=ri([{name:"a_pos",components:2,type:"Int16"}],4),{members:Oa}=qi;class Gr{constructor(o=[]){this.segments=o}prepareSegment(o,c,f,g){let x=this.segments[this.segments.length-1];return o>Gr.MAX_VERTEX_ARRAY_LENGTH&&vt(`Max vertices per segment is ${Gr.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${o}`),(!x||x.vertexLength+o>Gr.MAX_VERTEX_ARRAY_LENGTH||x.sortKey!==g)&&(x={vertexOffset:c.length,primitiveOffset:f.length,vertexLength:0,primitiveLength:0},g!==void 0&&(x.sortKey=g),this.segments.push(x)),x}get(){return this.segments}destroy(){for(const o of this.segments)for(const c in o.vaos)o.vaos[c].destroy()}static simpleSegment(o,c,f,g){return new Gr([{vertexOffset:o,primitiveOffset:c,vertexLength:f,primitiveLength:g,vaos:{},sortKey:0}])}}function Sl(l,o){return 256*(l=zt(Math.floor(l),0,255))+zt(Math.floor(o),0,255)}Gr.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,ve("SegmentVector",Gr);const Cl=ri([{name:"a_pattern_from",components:4,type:"Uint16"},{name:"a_pattern_to",components:4,type:"Uint16"},{name:"a_pixel_ratio_from",components:1,type:"Uint16"},{name:"a_pixel_ratio_to",components:1,type:"Uint16"}]);var dh={exports:{}},lp={exports:{}};lp.exports=function(l,o){var c,f,g,x,b,I,L,M;for(f=l.length-(c=3&l.length),g=o,b=3432918353,I=461845907,M=0;M<f;)L=255&l.charCodeAt(M)|(255&l.charCodeAt(++M))<<8|(255&l.charCodeAt(++M))<<16|(255&l.charCodeAt(++M))<<24,++M,g=27492+(65535&(x=5*(65535&(g=(g^=L=(65535&(L=(L=(65535&L)*b+(((L>>>16)*b&65535)<<16)&4294967295)<<15|L>>>17))*I+(((L>>>16)*I&65535)<<16)&4294967295)<<13|g>>>19))+((5*(g>>>16)&65535)<<16)&4294967295))+((58964+(x>>>16)&65535)<<16);switch(L=0,c){case 3:L^=(255&l.charCodeAt(M+2))<<16;case 2:L^=(255&l.charCodeAt(M+1))<<8;case 1:g^=L=(65535&(L=(L=(65535&(L^=255&l.charCodeAt(M)))*b+(((L>>>16)*b&65535)<<16)&4294967295)<<15|L>>>17))*I+(((L>>>16)*I&65535)<<16)&4294967295}return g^=l.length,g=2246822507*(65535&(g^=g>>>16))+((2246822507*(g>>>16)&65535)<<16)&4294967295,g=3266489909*(65535&(g^=g>>>13))+((3266489909*(g>>>16)&65535)<<16)&4294967295,(g^=g>>>16)>>>0};var xf=lp.exports,fs={exports:{}};fs.exports=function(l,o){for(var c,f=l.length,g=o^f,x=0;f>=4;)c=1540483477*(65535&(c=255&l.charCodeAt(x)|(255&l.charCodeAt(++x))<<8|(255&l.charCodeAt(++x))<<16|(255&l.charCodeAt(++x))<<24))+((1540483477*(c>>>16)&65535)<<16),g=1540483477*(65535&g)+((1540483477*(g>>>16)&65535)<<16)^(c=1540483477*(65535&(c^=c>>>24))+((1540483477*(c>>>16)&65535)<<16)),f-=4,++x;switch(f){case 3:g^=(255&l.charCodeAt(x+2))<<16;case 2:g^=(255&l.charCodeAt(x+1))<<8;case 1:g=1540483477*(65535&(g^=255&l.charCodeAt(x)))+((1540483477*(g>>>16)&65535)<<16)}return g=1540483477*(65535&(g^=g>>>13))+((1540483477*(g>>>16)&65535)<<16),(g^=g>>>15)>>>0};var Ho=xf,Us=fs.exports;dh.exports=Ho,dh.exports.murmur3=Ho,dh.exports.murmur2=Us;var cp=w(dh.exports);class Mi{constructor(){this.ids=[],this.positions=[],this.indexed=!1}add(o,c,f,g){this.ids.push(ho(o)),this.positions.push(c,f,g)}getPositions(o){if(!this.indexed)throw new Error("Trying to get index, but feature positions are not indexed");const c=ho(o);let f=0,g=this.ids.length-1;for(;f<g;){const b=f+g>>1;this.ids[b]>=c?g=b:f=b+1}const x=[];for(;this.ids[f]===c;)x.push({index:this.positions[3*f],start:this.positions[3*f+1],end:this.positions[3*f+2]}),f++;return x}static serialize(o,c){const f=new Float64Array(o.ids),g=new Uint32Array(o.positions);return la(f,g,0,f.length-1),c&&c.push(f.buffer,g.buffer),{ids:f,positions:g}}static deserialize(o){const c=new Mi;return c.ids=o.ids,c.positions=o.positions,c.indexed=!0,c}}function ho(l){const o=+l;return!isNaN(o)&&o<=Number.MAX_SAFE_INTEGER?o:cp(String(l))}function la(l,o,c,f){for(;c<f;){const g=l[c+f>>1];let x=c-1,b=f+1;for(;;){do x++;while(l[x]<g);do b--;while(l[b]>g);if(x>=b)break;Ai(l,x,b),Ai(o,3*x,3*b),Ai(o,3*x+1,3*b+1),Ai(o,3*x+2,3*b+2)}b-c<f-b?(la(l,o,c,b),c=b+1):(la(l,o,b+1,f),f=b)}}function Ai(l,o,c){const f=l[o];l[o]=l[c],l[c]=f}ve("FeaturePositionMap",Mi);class hp{constructor(o,c){this.gl=o.gl,this.location=c}}class Tg extends hp{constructor(o,c){super(o,c),this.current=0}set(o){this.current!==o&&(this.current=o,this.gl.uniform1f(this.location,o))}}class U_ extends hp{constructor(o,c){super(o,c),this.current=[0,0,0,0]}set(o){o[0]===this.current[0]&&o[1]===this.current[1]&&o[2]===this.current[2]&&o[3]===this.current[3]||(this.current=o,this.gl.uniform4f(this.location,o[0],o[1],o[2],o[3]))}}class G_ extends hp{constructor(o,c){super(o,c),this.current=or.transparent}set(o){o.r===this.current.r&&o.g===this.current.g&&o.b===this.current.b&&o.a===this.current.a||(this.current=o,this.gl.uniform4f(this.location,o.r,o.g,o.b,o.a))}}const R0=new Float32Array(16);function ay(l){return[Sl(255*l.r,255*l.g),Sl(255*l.b,255*l.a)]}class Tl{constructor(o,c,f){this.value=o,this.uniformNames=c.map(g=>`u_${g}`),this.type=f}setUniform(o,c,f){o.set(f.constantOr(this.value))}getBinding(o,c,f){return this.type==="color"?new G_(o,c):new Tg(o,c)}}class pp{constructor(o,c){this.uniformNames=c.map(f=>`u_${f}`),this.patternFrom=null,this.patternTo=null,this.pixelRatioFrom=1,this.pixelRatioTo=1}setConstantPatternPositions(o,c){this.pixelRatioFrom=c.pixelRatio,this.pixelRatioTo=o.pixelRatio,this.patternFrom=c.tlbr,this.patternTo=o.tlbr}setUniform(o,c,f,g){const x=g==="u_pattern_to"?this.patternTo:g==="u_pattern_from"?this.patternFrom:g==="u_pixel_ratio_to"?this.pixelRatioTo:g==="u_pixel_ratio_from"?this.pixelRatioFrom:null;x&&o.set(x)}getBinding(o,c,f){return f.substr(0,9)==="u_pattern"?new U_(o,c):new Tg(o,c)}}class Ll{constructor(o,c,f,g){this.expression=o,this.type=f,this.maxValue=0,this.paintVertexAttributes=c.map(x=>({name:`a_${x}`,type:"Float32",components:f==="color"?2:1,offset:0})),this.paintVertexArray=new g}populatePaintArray(o,c,f,g,x){const b=this.paintVertexArray.length,I=this.expression.evaluate(new Ur(0),c,{},g,[],x);this.paintVertexArray.resize(o),this._setPaintValue(b,o,I)}updatePaintArray(o,c,f,g){const x=this.expression.evaluate({zoom:0},f,g);this._setPaintValue(o,c,x)}_setPaintValue(o,c,f){if(this.type==="color"){const g=ay(f);for(let x=o;x<c;x++)this.paintVertexArray.emplace(x,g[0],g[1])}else{for(let g=o;g<c;g++)this.paintVertexArray.emplace(g,f);this.maxValue=Math.max(this.maxValue,Math.abs(f))}}upload(o){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=o.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class hu{constructor(o,c,f,g,x,b){this.expression=o,this.uniformNames=c.map(I=>`u_${I}_t`),this.type=f,this.useIntegerZoom=g,this.zoom=x,this.maxValue=0,this.paintVertexAttributes=c.map(I=>({name:`a_${I}`,type:"Float32",components:f==="color"?4:2,offset:0})),this.paintVertexArray=new b}populatePaintArray(o,c,f,g,x){const b=this.expression.evaluate(new Ur(this.zoom),c,{},g,[],x),I=this.expression.evaluate(new Ur(this.zoom+1),c,{},g,[],x),L=this.paintVertexArray.length;this.paintVertexArray.resize(o),this._setPaintValue(L,o,b,I)}updatePaintArray(o,c,f,g){const x=this.expression.evaluate({zoom:this.zoom},f,g),b=this.expression.evaluate({zoom:this.zoom+1},f,g);this._setPaintValue(o,c,x,b)}_setPaintValue(o,c,f,g){if(this.type==="color"){const x=ay(f),b=ay(g);for(let I=o;I<c;I++)this.paintVertexArray.emplace(I,x[0],x[1],b[0],b[1])}else{for(let x=o;x<c;x++)this.paintVertexArray.emplace(x,f,g);this.maxValue=Math.max(this.maxValue,Math.abs(f),Math.abs(g))}}upload(o){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=o.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(o,c){const f=this.useIntegerZoom?Math.floor(c.zoom):c.zoom,g=zt(this.expression.interpolationFactor(f,this.zoom,this.zoom+1),0,1);o.set(g)}getBinding(o,c,f){return new Tg(o,c)}}class Nl{constructor(o,c,f,g,x,b){this.expression=o,this.type=c,this.useIntegerZoom=f,this.zoom=g,this.layerId=b,this.zoomInPaintVertexArray=new x,this.zoomOutPaintVertexArray=new x}populatePaintArray(o,c,f){const g=this.zoomInPaintVertexArray.length;this.zoomInPaintVertexArray.resize(o),this.zoomOutPaintVertexArray.resize(o),this._setPaintValues(g,o,c.patterns&&c.patterns[this.layerId],f)}updatePaintArray(o,c,f,g,x){this._setPaintValues(o,c,f.patterns&&f.patterns[this.layerId],x)}_setPaintValues(o,c,f,g){if(!g||!f)return;const{min:x,mid:b,max:I}=f,L=g[x],M=g[b],R=g[I];if(L&&M&&R)for(let z=o;z<c;z++)this.zoomInPaintVertexArray.emplace(z,M.tl[0],M.tl[1],M.br[0],M.br[1],L.tl[0],L.tl[1],L.br[0],L.br[1],M.pixelRatio,L.pixelRatio),this.zoomOutPaintVertexArray.emplace(z,M.tl[0],M.tl[1],M.br[0],M.br[1],R.tl[0],R.tl[1],R.br[0],R.br[1],M.pixelRatio,R.pixelRatio)}upload(o){this.zoomInPaintVertexArray&&this.zoomInPaintVertexArray.arrayBuffer&&this.zoomOutPaintVertexArray&&this.zoomOutPaintVertexArray.arrayBuffer&&(this.zoomInPaintVertexBuffer=o.createVertexBuffer(this.zoomInPaintVertexArray,Cl.members,this.expression.isStateDependent),this.zoomOutPaintVertexBuffer=o.createVertexBuffer(this.zoomOutPaintVertexArray,Cl.members,this.expression.isStateDependent))}destroy(){this.zoomOutPaintVertexBuffer&&this.zoomOutPaintVertexBuffer.destroy(),this.zoomInPaintVertexBuffer&&this.zoomInPaintVertexBuffer.destroy()}}class uy{constructor(o,c,f){this.binders={},this._buffers=[];const g=[];for(const x in o.paint._values){if(!f(x))continue;const b=o.paint.get(x);if(!(b instanceof Vs&&_l(b.property.specification)))continue;const I=BT(x,o.type),L=b.value,M=b.property.specification.type,R=b.property.useIntegerZoom,z=b.property.specification["property-type"],U=z==="cross-faded"||z==="cross-faded-data-driven";if(L.kind==="constant")this.binders[x]=U?new pp(L.value,I):new Tl(L.value,I,M),g.push(`/u_${x}`);else if(L.kind==="source"||U){const Y=mw(x,M,"source");this.binders[x]=U?new Nl(L,M,R,c,Y,o.id):new Ll(L,I,M,Y),g.push(`/a_${x}`)}else{const Y=mw(x,M,"composite");this.binders[x]=new hu(L,I,M,R,c,Y),g.push(`/z_${x}`)}}this.cacheKey=g.sort().join("")}getMaxValue(o){const c=this.binders[o];return c instanceof Ll||c instanceof hu?c.maxValue:0}populatePaintArrays(o,c,f,g,x){for(const b in this.binders){const I=this.binders[b];(I instanceof Ll||I instanceof hu||I instanceof Nl)&&I.populatePaintArray(o,c,f,g,x)}}setConstantPatternPositions(o,c){for(const f in this.binders){const g=this.binders[f];g instanceof pp&&g.setConstantPatternPositions(o,c)}}updatePaintArrays(o,c,f,g,x){let b=!1;for(const I in o){const L=c.getPositions(I);for(const M of L){const R=f.feature(M.index);for(const z in this.binders){const U=this.binders[z];if((U instanceof Ll||U instanceof hu||U instanceof Nl)&&U.expression.isStateDependent===!0){const Y=g.paint.get(z);U.expression=Y.value,U.updatePaintArray(M.start,M.end,R,o[I],x),b=!0}}}}return b}defines(){const o=[];for(const c in this.binders){const f=this.binders[c];(f instanceof Tl||f instanceof pp)&&o.push(...f.uniformNames.map(g=>`#define HAS_UNIFORM_${g}`))}return o}getBinderAttributes(){const o=[];for(const c in this.binders){const f=this.binders[c];if(f instanceof Ll||f instanceof hu)for(let g=0;g<f.paintVertexAttributes.length;g++)o.push(f.paintVertexAttributes[g].name);else if(f instanceof Nl)for(let g=0;g<Cl.members.length;g++)o.push(Cl.members[g].name)}return o}getBinderUniforms(){const o=[];for(const c in this.binders){const f=this.binders[c];if(f instanceof Tl||f instanceof pp||f instanceof hu)for(const g of f.uniformNames)o.push(g)}return o}getPaintVertexBuffers(){return this._buffers}getUniforms(o,c){const f=[];for(const g in this.binders){const x=this.binders[g];if(x instanceof Tl||x instanceof pp||x instanceof hu){for(const b of x.uniformNames)if(c[b]){const I=x.getBinding(o,c[b],b);f.push({name:b,property:g,binding:I})}}}return f}setUniforms(o,c,f,g){for(const{name:x,property:b,binding:I}of c)this.binders[b].setUniform(I,g,f.get(b),x)}updatePaintBuffers(o){this._buffers=[];for(const c in this.binders){const f=this.binders[c];if(o&&f instanceof Nl){const g=o.fromScale===2?f.zoomInPaintVertexBuffer:f.zoomOutPaintVertexBuffer;g&&this._buffers.push(g)}else(f instanceof Ll||f instanceof hu)&&f.paintVertexBuffer&&this._buffers.push(f.paintVertexBuffer)}}upload(o){for(const c in this.binders){const f=this.binders[c];(f instanceof Ll||f instanceof hu||f instanceof Nl)&&f.upload(o)}this.updatePaintBuffers()}destroy(){for(const o in this.binders){const c=this.binders[o];(c instanceof Ll||c instanceof hu||c instanceof Nl)&&c.destroy()}}}class Ec{constructor(o,c,f=()=>!0){this.programConfigurations={};for(const g of o)this.programConfigurations[g.id]=new uy(g,c,f);this.needsUpload=!1,this._featureMap=new Mi,this._bufferOffset=0}populatePaintArrays(o,c,f,g,x,b){for(const I in this.programConfigurations)this.programConfigurations[I].populatePaintArrays(o,c,g,x,b);c.id!==void 0&&this._featureMap.add(c.id,f,this._bufferOffset,o),this._bufferOffset=o,this.needsUpload=!0}updatePaintArrays(o,c,f,g){for(const x of f)this.needsUpload=this.programConfigurations[x.id].updatePaintArrays(o,this._featureMap,c,x,g)||this.needsUpload}get(o){return this.programConfigurations[o]}upload(o){if(this.needsUpload){for(const c in this.programConfigurations)this.programConfigurations[c].upload(o);this.needsUpload=!1}}destroy(){for(const o in this.programConfigurations)this.programConfigurations[o].destroy()}}function BT(l,o){return{"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-extrusion-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"]}[l]||[l.replace(`${o}-`,"").replace(/-/g,"_")]}function mw(l,o,c){const f={color:{source:vf,composite:tt},number:{source:N,composite:vf}},g=function(x){return{"line-pattern":{source:_r,composite:_r},"fill-pattern":{source:_r,composite:_r},"fill-extrusion-pattern":{source:_r,composite:_r}}[x]}(l);return g&&g[c]||f[o][c]}ve("ConstantBinder",Tl),ve("CrossFadedConstantBinder",pp),ve("SourceExpressionBinder",Ll),ve("CrossFadedCompositeBinder",Nl),ve("CompositeExpressionBinder",hu),ve("ProgramConfiguration",uy,{omit:["_buffers"]}),ve("ProgramConfigurationSet",Ec);const so=8192,F0=Math.pow(2,14)-1,yw=-F0-1;function Id(l){const o=so/l.extent,c=l.loadGeometry();for(let f=0;f<c.length;f++){const g=c[f];for(let x=0;x<g.length;x++){const b=g[x],I=Math.round(b.x*o),L=Math.round(b.y*o);b.x=zt(I,yw,F0),b.y=zt(L,yw,F0),(I<b.x||I>b.x+1||L<b.y||L>b.y+1)&&vt("Geometry exceeds allowed extent, reduce your vector tile buffer size")}}return c}function Sd(l,o){return{type:l.type,id:l.id,properties:l.properties,geometry:o?Id(l):[]}}function q_(l,o,c,f,g){l.emplaceBack(2*o+(f+1)/2,2*c+(g+1)/2)}class k0{constructor(o){this.zoom=o.zoom,this.overscaling=o.overscaling,this.layers=o.layers,this.layerIds=this.layers.map(c=>c.id),this.index=o.index,this.hasPattern=!1,this.layoutVertexArray=new Me,this.indexArray=new Zo,this.segments=new Gr,this.programConfigurations=new Ec(o.layers,o.zoom),this.stateDependentLayerIds=this.layers.filter(c=>c.isStateDependent()).map(c=>c.id)}populate(o,c,f){const g=this.layers[0],x=[];let b=null,I=!1;g.type==="circle"&&(b=g.layout.get("circle-sort-key"),I=!b.isConstant());for(const{feature:L,id:M,index:R,sourceLayerIndex:z}of o){const U=this.layers[0]._featureFilter.needGeometry,Y=Sd(L,U);if(!this.layers[0]._featureFilter.filter(new Ur(this.zoom),Y,f))continue;const H=I?b.evaluate(Y,{},f):void 0,Q={id:M,properties:L.properties,type:L.type,sourceLayerIndex:z,index:R,geometry:U?Y.geometry:Id(L),patterns:{},sortKey:H};x.push(Q)}I&&x.sort((L,M)=>L.sortKey-M.sortKey);for(const L of x){const{geometry:M,index:R,sourceLayerIndex:z}=L,U=o[R].feature;this.addFeature(L,M,R,f),c.featureIndex.insert(U,M,R,z,this.index)}}update(o,c,f){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(o,c,this.stateDependentLayers,f)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(o){this.uploaded||(this.layoutVertexBuffer=o.createVertexBuffer(this.layoutVertexArray,Oa),this.indexBuffer=o.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(o),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(o,c,f,g){for(const x of c)for(const b of x){const I=b.x,L=b.y;if(I<0||I>=so||L<0||L>=so)continue;const M=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,o.sortKey),R=M.vertexLength;q_(this.layoutVertexArray,I,L,-1,-1),q_(this.layoutVertexArray,I,L,1,-1),q_(this.layoutVertexArray,I,L,1,1),q_(this.layoutVertexArray,I,L,-1,1),this.indexArray.emplaceBack(R,R+1,R+2),this.indexArray.emplaceBack(R,R+3,R+2),M.vertexLength+=4,M.primitiveLength+=2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,o,f,{},g)}}function _w(l,o){for(let c=0;c<l.length;c++)if(Lg(o,l[c]))return!0;for(let c=0;c<o.length;c++)if(Lg(l,o[c]))return!0;return!!z0(l,o)}function $T(l,o,c){return!!Lg(l,o)||!!B0(o,l,c)}function vw(l,o){if(l.length===1)return bw(o,l[0]);for(let c=0;c<o.length;c++){const f=o[c];for(let g=0;g<f.length;g++)if(Lg(l,f[g]))return!0}for(let c=0;c<l.length;c++)if(bw(o,l[c]))return!0;for(let c=0;c<o.length;c++)if(z0(l,o[c]))return!0;return!1}function VT(l,o,c){if(l.length>1){if(z0(l,o))return!0;for(let f=0;f<o.length;f++)if(B0(o[f],l,c))return!0}for(let f=0;f<l.length;f++)if(B0(l[f],o,c))return!0;return!1}function z0(l,o){if(l.length===0||o.length===0)return!1;for(let c=0;c<l.length-1;c++){const f=l[c],g=l[c+1];for(let x=0;x<o.length-1;x++)if(UT(f,g,o[x],o[x+1]))return!0}return!1}function UT(l,o,c,f){return Qt(l,c,f)!==Qt(o,c,f)&&Qt(l,o,c)!==Qt(l,o,f)}function B0(l,o,c){const f=c*c;if(o.length===1)return l.distSqr(o[0])<f;for(let g=1;g<o.length;g++)if(xw(l,o[g-1],o[g])<f)return!0;return!1}function xw(l,o,c){const f=o.distSqr(c);if(f===0)return l.distSqr(o);const g=((l.x-o.x)*(c.x-o.x)+(l.y-o.y)*(c.y-o.y))/f;return l.distSqr(g<0?o:g>1?c:c.sub(o)._mult(g)._add(o))}function bw(l,o){let c,f,g,x=!1;for(let b=0;b<l.length;b++){c=l[b];for(let I=0,L=c.length-1;I<c.length;L=I++)f=c[I],g=c[L],f.y>o.y!=g.y>o.y&&o.x<(g.x-f.x)*(o.y-f.y)/(g.y-f.y)+f.x&&(x=!x)}return x}function Lg(l,o){let c=!1;for(let f=0,g=l.length-1;f<l.length;g=f++){const x=l[f],b=l[g];x.y>o.y!=b.y>o.y&&o.x<(b.x-x.x)*(o.y-x.y)/(b.y-x.y)+x.x&&(c=!c)}return c}function GT(l,o,c){const f=c[0],g=c[2];if(l.x<f.x&&o.x<f.x||l.x>g.x&&o.x>g.x||l.y<f.y&&o.y<f.y||l.y>g.y&&o.y>g.y)return!1;const x=Qt(l,o,c[0]);return x!==Qt(l,o,c[1])||x!==Qt(l,o,c[2])||x!==Qt(l,o,c[3])}function ly(l,o,c){const f=o.paint.get(l).value;return f.kind==="constant"?f.value:c.programConfigurations.get(o.id).getMaxValue(l)}function j_(l){return Math.sqrt(l[0]*l[0]+l[1]*l[1])}function X_(l,o,c,f,g){if(!o[0]&&!o[1])return l;const x=D.convert(o)._mult(g);c==="viewport"&&x._rotate(-f);const b=[];for(let I=0;I<l.length;I++)b.push(l[I].sub(x));return b}let ww,Ew;ve("CircleBucket",k0,{omit:["layers"]});var qT={get paint(){return Ew=Ew||new Gi({"circle-radius":new Ze(Vt.paint_circle["circle-radius"]),"circle-color":new Ze(Vt.paint_circle["circle-color"]),"circle-blur":new Ze(Vt.paint_circle["circle-blur"]),"circle-opacity":new Ze(Vt.paint_circle["circle-opacity"]),"circle-translate":new ze(Vt.paint_circle["circle-translate"]),"circle-translate-anchor":new ze(Vt.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new ze(Vt.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new ze(Vt.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new Ze(Vt.paint_circle["circle-stroke-width"]),"circle-stroke-color":new Ze(Vt.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new Ze(Vt.paint_circle["circle-stroke-opacity"])})},get layout(){return ww=ww||new Gi({"circle-sort-key":new Ze(Vt.layout_circle["circle-sort-key"])})}},ca=1e-6,Ng=typeof Float32Array<"u"?Float32Array:Array;function $0(l){return l[0]=1,l[1]=0,l[2]=0,l[3]=0,l[4]=0,l[5]=1,l[6]=0,l[7]=0,l[8]=0,l[9]=0,l[10]=1,l[11]=0,l[12]=0,l[13]=0,l[14]=0,l[15]=1,l}function Iw(l,o,c){var f=o[0],g=o[1],x=o[2],b=o[3],I=o[4],L=o[5],M=o[6],R=o[7],z=o[8],U=o[9],Y=o[10],H=o[11],Q=o[12],ut=o[13],ht=o[14],Et=o[15],mt=c[0],St=c[1],Dt=c[2],Ht=c[3];return l[0]=mt*f+St*I+Dt*z+Ht*Q,l[1]=mt*g+St*L+Dt*U+Ht*ut,l[2]=mt*x+St*M+Dt*Y+Ht*ht,l[3]=mt*b+St*R+Dt*H+Ht*Et,l[4]=(mt=c[4])*f+(St=c[5])*I+(Dt=c[6])*z+(Ht=c[7])*Q,l[5]=mt*g+St*L+Dt*U+Ht*ut,l[6]=mt*x+St*M+Dt*Y+Ht*ht,l[7]=mt*b+St*R+Dt*H+Ht*Et,l[8]=(mt=c[8])*f+(St=c[9])*I+(Dt=c[10])*z+(Ht=c[11])*Q,l[9]=mt*g+St*L+Dt*U+Ht*ut,l[10]=mt*x+St*M+Dt*Y+Ht*ht,l[11]=mt*b+St*R+Dt*H+Ht*Et,l[12]=(mt=c[12])*f+(St=c[13])*I+(Dt=c[14])*z+(Ht=c[15])*Q,l[13]=mt*g+St*L+Dt*U+Ht*ut,l[14]=mt*x+St*M+Dt*Y+Ht*ht,l[15]=mt*b+St*R+Dt*H+Ht*Et,l}Math.hypot||(Math.hypot=function(){for(var l=0,o=arguments.length;o--;)l+=arguments[o]*arguments[o];return Math.sqrt(l)});var cy,jT=Iw;function Y_(l,o,c){var f=o[0],g=o[1],x=o[2],b=o[3];return l[0]=c[0]*f+c[4]*g+c[8]*x+c[12]*b,l[1]=c[1]*f+c[5]*g+c[9]*x+c[13]*b,l[2]=c[2]*f+c[6]*g+c[10]*x+c[14]*b,l[3]=c[3]*f+c[7]*g+c[11]*x+c[15]*b,l}cy=new Ng(4),Ng!=Float32Array&&(cy[0]=0,cy[1]=0,cy[2]=0,cy[3]=0);class XT extends cu{constructor(o){super(o,qT)}createBucket(o){return new k0(o)}queryRadius(o){const c=o;return ly("circle-radius",this,c)+ly("circle-stroke-width",this,c)+j_(this.paint.get("circle-translate"))}queryIntersectsFeature(o,c,f,g,x,b,I,L){const M=X_(o,this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),b.angle,I),R=this.paint.get("circle-radius").evaluate(c,f)+this.paint.get("circle-stroke-width").evaluate(c,f),z=this.paint.get("circle-pitch-alignment")==="map",U=z?M:function(H,Q){return H.map(ut=>Sw(ut,Q))}(M,L),Y=z?R*I:R;for(const H of g)for(const Q of H){const ut=z?Q:Sw(Q,L);let ht=Y;const Et=Y_([],[Q.x,Q.y,0,1],L);if(this.paint.get("circle-pitch-scale")==="viewport"&&this.paint.get("circle-pitch-alignment")==="map"?ht*=Et[3]/b.cameraToCenterDistance:this.paint.get("circle-pitch-scale")==="map"&&this.paint.get("circle-pitch-alignment")==="viewport"&&(ht*=b.cameraToCenterDistance/Et[3]),$T(U,ut,ht))return!0}return!1}}function Sw(l,o){const c=Y_([],[l.x,l.y,0,1],o);return new D(c[0]/c[3],c[1]/c[3])}class Cw extends k0{}let Tw;ve("HeatmapBucket",Cw,{omit:["layers"]});var YT={get paint(){return Tw=Tw||new Gi({"heatmap-radius":new Ze(Vt.paint_heatmap["heatmap-radius"]),"heatmap-weight":new Ze(Vt.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new ze(Vt.paint_heatmap["heatmap-intensity"]),"heatmap-color":new ey(Vt.paint_heatmap["heatmap-color"]),"heatmap-opacity":new ze(Vt.paint_heatmap["heatmap-opacity"])})}};function V0(l,{width:o,height:c},f,g){if(g){if(g instanceof Uint8ClampedArray)g=new Uint8Array(g.buffer);else if(g.length!==o*c*f)throw new RangeError(`mismatched image size. expected: ${g.length} but got: ${o*c*f}`)}else g=new Uint8Array(o*c*f);return l.width=o,l.height=c,l.data=g,l}function Lw(l,{width:o,height:c},f){if(o===l.width&&c===l.height)return;const g=V0({},{width:o,height:c},f);U0(l,g,{x:0,y:0},{x:0,y:0},{width:Math.min(l.width,o),height:Math.min(l.height,c)},f),l.width=o,l.height=c,l.data=g.data}function U0(l,o,c,f,g,x){if(g.width===0||g.height===0)return o;if(g.width>l.width||g.height>l.height||c.x>l.width-g.width||c.y>l.height-g.height)throw new RangeError("out of range source coordinates for image copy");if(g.width>o.width||g.height>o.height||f.x>o.width-g.width||f.y>o.height-g.height)throw new RangeError("out of range destination coordinates for image copy");const b=l.data,I=o.data;if(b===I)throw new Error("srcData equals dstData, so image is already copied");for(let L=0;L<g.height;L++){const M=((c.y+L)*l.width+c.x)*x,R=((f.y+L)*o.width+f.x)*x;for(let z=0;z<g.width*x;z++)I[R+z]=b[M+z]}return o}class hy{constructor(o,c){V0(this,o,1,c)}resize(o){Lw(this,o,1)}clone(){return new hy({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(o,c,f,g,x){U0(o,c,f,g,x,1)}}class Bu{constructor(o,c){V0(this,o,4,c)}resize(o){Lw(this,o,4)}replace(o,c){c?this.data.set(o):this.data=o instanceof Uint8ClampedArray?new Uint8Array(o.buffer):o}clone(){return new Bu({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(o,c,f,g,x){U0(o,c,f,g,x,4)}}function Nw(l){const o={},c=l.resolution||256,f=l.clips?l.clips.length:1,g=l.image||new Bu({width:c,height:f});if(Math.log(c)/Math.LN2%1!=0)throw new Error(`width is not a power of 2 - ${c}`);const x=(b,I,L)=>{o[l.evaluationKey]=L;const M=l.expression.evaluate(o);g.data[b+I+0]=Math.floor(255*M.r/M.a),g.data[b+I+1]=Math.floor(255*M.g/M.a),g.data[b+I+2]=Math.floor(255*M.b/M.a),g.data[b+I+3]=Math.floor(255*M.a)};if(l.clips)for(let b=0,I=0;b<f;++b,I+=4*c)for(let L=0,M=0;L<c;L++,M+=4){const R=L/(c-1),{start:z,end:U}=l.clips[b];x(I,M,z*(1-R)+U*R)}else for(let b=0,I=0;b<c;b++,I+=4)x(0,I,b/(c-1));return g}ve("AlphaImage",hy),ve("RGBAImage",Bu);class ZT extends cu{createBucket(o){return new Cw(o)}constructor(o){super(o,YT),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(o){o==="heatmap-color"&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=Nw({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)}queryRadius(){return 0}queryIntersectsFeature(){return!1}hasOffscreenPass(){return this.paint.get("heatmap-opacity")!==0&&this.visibility!=="none"}}let Pw;var HT={get paint(){return Pw=Pw||new Gi({"hillshade-illumination-direction":new ze(Vt.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new ze(Vt.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new ze(Vt.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new ze(Vt.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new ze(Vt.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new ze(Vt.paint_hillshade["hillshade-accent-color"])})}};class WT extends cu{constructor(o){super(o,HT)}hasOffscreenPass(){return this.paint.get("hillshade-exaggeration")!==0&&this.visibility!=="none"}}const JT=ri([{name:"a_pos",components:2,type:"Int16"}],4),{members:KT}=JT;var G0={exports:{}};function Z_(l,o,c){c=c||2;var f,g,x,b,I,L,M,R=o&&o.length,z=R?o[0]*c:l.length,U=Mw(l,0,z,c,!0),Y=[];if(!U||U.next===U.prev)return Y;if(R&&(U=function(Q,ut,ht,Et){var mt,St,Dt,Ht=[];for(mt=0,St=ut.length;mt<St;mt++)(Dt=Mw(Q,ut[mt]*Et,mt<St-1?ut[mt+1]*Et:Q.length,Et,!1))===Dt.next&&(Dt.steiner=!0),Ht.push(sL(Dt));for(Ht.sort(rL),mt=0;mt<Ht.length;mt++)ht=iL(Ht[mt],ht);return ht}(l,o,U,c)),l.length>80*c){f=x=l[0],g=b=l[1];for(var H=c;H<z;H+=c)(I=l[H])<f&&(f=I),(L=l[H+1])<g&&(g=L),I>x&&(x=I),L>b&&(b=L);M=(M=Math.max(x-f,b-g))!==0?32767/M:0}return py(U,Y,c,f,g,M,0),Y}function Mw(l,o,c,f,g){var x,b;if(g===X0(l,o,c,f)>0)for(x=o;x<c;x+=f)b=Ow(x,l[x],l[x+1],b);else for(x=c-f;x>=o;x-=f)b=Ow(x,l[x],l[x+1],b);return b&&H_(b,b.next)&&(dy(b),b=b.next),b}function Cd(l,o){if(!l)return l;o||(o=l);var c,f=l;do if(c=!1,f.steiner||!H_(f,f.next)&&ji(f.prev,f,f.next)!==0)f=f.next;else{if(dy(f),(f=o=f.prev)===f.next)break;c=!0}while(c||f!==o);return o}function py(l,o,c,f,g,x,b){if(l){!b&&x&&function(R,z,U,Y){var H=R;do H.z===0&&(H.z=q0(H.x,H.y,z,U,Y)),H.prevZ=H.prev,H.nextZ=H.next,H=H.next;while(H!==R);H.prevZ.nextZ=null,H.prevZ=null,function(Q){var ut,ht,Et,mt,St,Dt,Ht,Ie,Ae=1;do{for(ht=Q,Q=null,St=null,Dt=0;ht;){for(Dt++,Et=ht,Ht=0,ut=0;ut<Ae&&(Ht++,Et=Et.nextZ);ut++);for(Ie=Ae;Ht>0||Ie>0&&Et;)Ht!==0&&(Ie===0||!Et||ht.z<=Et.z)?(mt=ht,ht=ht.nextZ,Ht--):(mt=Et,Et=Et.nextZ,Ie--),St?St.nextZ=mt:Q=mt,mt.prevZ=St,St=mt;ht=Et}St.nextZ=null,Ae*=2}while(Dt>1)}(H)}(l,f,g,x);for(var I,L,M=l;l.prev!==l.next;)if(I=l.prev,L=l.next,x?tL(l,f,g,x):QT(l))o.push(I.i/c|0),o.push(l.i/c|0),o.push(L.i/c|0),dy(l),l=L.next,M=L.next;else if((l=L)===M){b?b===1?py(l=eL(Cd(l),o,c),o,c,f,g,x,2):b===2&&nL(l,o,c,f,g,x):py(Cd(l),o,c,f,g,x,1);break}}}function QT(l){var o=l.prev,c=l,f=l.next;if(ji(o,c,f)>=0)return!1;for(var g=o.x,x=c.x,b=f.x,I=o.y,L=c.y,M=f.y,R=g<x?g<b?g:b:x<b?x:b,z=I<L?I<M?I:M:L<M?L:M,U=g>x?g>b?g:b:x>b?x:b,Y=I>L?I>M?I:M:L>M?L:M,H=f.next;H!==o;){if(H.x>=R&&H.x<=U&&H.y>=z&&H.y<=Y&&Pg(g,I,x,L,b,M,H.x,H.y)&&ji(H.prev,H,H.next)>=0)return!1;H=H.next}return!0}function tL(l,o,c,f){var g=l.prev,x=l,b=l.next;if(ji(g,x,b)>=0)return!1;for(var I=g.x,L=x.x,M=b.x,R=g.y,z=x.y,U=b.y,Y=I<L?I<M?I:M:L<M?L:M,H=R<z?R<U?R:U:z<U?z:U,Q=I>L?I>M?I:M:L>M?L:M,ut=R>z?R>U?R:U:z>U?z:U,ht=q0(Y,H,o,c,f),Et=q0(Q,ut,o,c,f),mt=l.prevZ,St=l.nextZ;mt&&mt.z>=ht&&St&&St.z<=Et;){if(mt.x>=Y&&mt.x<=Q&&mt.y>=H&&mt.y<=ut&&mt!==g&&mt!==b&&Pg(I,R,L,z,M,U,mt.x,mt.y)&&ji(mt.prev,mt,mt.next)>=0||(mt=mt.prevZ,St.x>=Y&&St.x<=Q&&St.y>=H&&St.y<=ut&&St!==g&&St!==b&&Pg(I,R,L,z,M,U,St.x,St.y)&&ji(St.prev,St,St.next)>=0))return!1;St=St.nextZ}for(;mt&&mt.z>=ht;){if(mt.x>=Y&&mt.x<=Q&&mt.y>=H&&mt.y<=ut&&mt!==g&&mt!==b&&Pg(I,R,L,z,M,U,mt.x,mt.y)&&ji(mt.prev,mt,mt.next)>=0)return!1;mt=mt.prevZ}for(;St&&St.z<=Et;){if(St.x>=Y&&St.x<=Q&&St.y>=H&&St.y<=ut&&St!==g&&St!==b&&Pg(I,R,L,z,M,U,St.x,St.y)&&ji(St.prev,St,St.next)>=0)return!1;St=St.nextZ}return!0}function eL(l,o,c){var f=l;do{var g=f.prev,x=f.next.next;!H_(g,x)&&Aw(g,f,f.next,x)&&fy(g,x)&&fy(x,g)&&(o.push(g.i/c|0),o.push(f.i/c|0),o.push(x.i/c|0),dy(f),dy(f.next),f=l=x),f=f.next}while(f!==l);return Cd(f)}function nL(l,o,c,f,g,x){var b=l;do{for(var I=b.next.next;I!==b.prev;){if(b.i!==I.i&&aL(b,I)){var L=Dw(b,I);return b=Cd(b,b.next),L=Cd(L,L.next),py(b,o,c,f,g,x,0),void py(L,o,c,f,g,x,0)}I=I.next}b=b.next}while(b!==l)}function rL(l,o){return l.x-o.x}function iL(l,o){var c=function(g,x){var b,I=x,L=g.x,M=g.y,R=-1/0;do{if(M<=I.y&&M>=I.next.y&&I.next.y!==I.y){var z=I.x+(M-I.y)*(I.next.x-I.x)/(I.next.y-I.y);if(z<=L&&z>R&&(R=z,b=I.x<I.next.x?I:I.next,z===L))return b}I=I.next}while(I!==x);if(!b)return null;var U,Y=b,H=b.x,Q=b.y,ut=1/0;I=b;do L>=I.x&&I.x>=H&&L!==I.x&&Pg(M<Q?L:R,M,H,Q,M<Q?R:L,M,I.x,I.y)&&(U=Math.abs(M-I.y)/(L-I.x),fy(I,g)&&(U<ut||U===ut&&(I.x>b.x||I.x===b.x&&oL(b,I)))&&(b=I,ut=U)),I=I.next;while(I!==Y);return b}(l,o);if(!c)return o;var f=Dw(c,l);return Cd(f,f.next),Cd(c,c.next)}function oL(l,o){return ji(l.prev,l,o.prev)<0&&ji(o.next,l,l.next)<0}function q0(l,o,c,f,g){return(l=1431655765&((l=858993459&((l=252645135&((l=16711935&((l=(l-c)*g|0)|l<<8))|l<<4))|l<<2))|l<<1))|(o=1431655765&((o=858993459&((o=252645135&((o=16711935&((o=(o-f)*g|0)|o<<8))|o<<4))|o<<2))|o<<1))<<1}function sL(l){var o=l,c=l;do(o.x<c.x||o.x===c.x&&o.y<c.y)&&(c=o),o=o.next;while(o!==l);return c}function Pg(l,o,c,f,g,x,b,I){return(g-b)*(o-I)>=(l-b)*(x-I)&&(l-b)*(f-I)>=(c-b)*(o-I)&&(c-b)*(x-I)>=(g-b)*(f-I)}function aL(l,o){return l.next.i!==o.i&&l.prev.i!==o.i&&!function(c,f){var g=c;do{if(g.i!==c.i&&g.next.i!==c.i&&g.i!==f.i&&g.next.i!==f.i&&Aw(g,g.next,c,f))return!0;g=g.next}while(g!==c);return!1}(l,o)&&(fy(l,o)&&fy(o,l)&&function(c,f){var g=c,x=!1,b=(c.x+f.x)/2,I=(c.y+f.y)/2;do g.y>I!=g.next.y>I&&g.next.y!==g.y&&b<(g.next.x-g.x)*(I-g.y)/(g.next.y-g.y)+g.x&&(x=!x),g=g.next;while(g!==c);return x}(l,o)&&(ji(l.prev,l,o.prev)||ji(l,o.prev,o))||H_(l,o)&&ji(l.prev,l,l.next)>0&&ji(o.prev,o,o.next)>0)}function ji(l,o,c){return(o.y-l.y)*(c.x-o.x)-(o.x-l.x)*(c.y-o.y)}function H_(l,o){return l.x===o.x&&l.y===o.y}function Aw(l,o,c,f){var g=J_(ji(l,o,c)),x=J_(ji(l,o,f)),b=J_(ji(c,f,l)),I=J_(ji(c,f,o));return g!==x&&b!==I||!(g!==0||!W_(l,c,o))||!(x!==0||!W_(l,f,o))||!(b!==0||!W_(c,l,f))||!(I!==0||!W_(c,o,f))}function W_(l,o,c){return o.x<=Math.max(l.x,c.x)&&o.x>=Math.min(l.x,c.x)&&o.y<=Math.max(l.y,c.y)&&o.y>=Math.min(l.y,c.y)}function J_(l){return l>0?1:l<0?-1:0}function fy(l,o){return ji(l.prev,l,l.next)<0?ji(l,o,l.next)>=0&&ji(l,l.prev,o)>=0:ji(l,o,l.prev)<0||ji(l,l.next,o)<0}function Dw(l,o){var c=new j0(l.i,l.x,l.y),f=new j0(o.i,o.x,o.y),g=l.next,x=o.prev;return l.next=o,o.prev=l,c.next=g,g.prev=c,f.next=c,c.prev=f,x.next=f,f.prev=x,f}function Ow(l,o,c,f){var g=new j0(l,o,c);return f?(g.next=f.next,g.prev=f,f.next.prev=g,f.next=g):(g.prev=g,g.next=g),g}function dy(l){l.next.prev=l.prev,l.prev.next=l.next,l.prevZ&&(l.prevZ.nextZ=l.nextZ),l.nextZ&&(l.nextZ.prevZ=l.prevZ)}function j0(l,o,c){this.i=l,this.x=o,this.y=c,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}function X0(l,o,c,f){for(var g=0,x=o,b=c-f;x<c;x+=f)g+=(l[b]-l[x])*(l[x+1]+l[b+1]),b=x;return g}G0.exports=Z_,G0.exports.default=Z_,Z_.deviation=function(l,o,c,f){var g=o&&o.length,x=Math.abs(X0(l,0,g?o[0]*c:l.length,c));if(g)for(var b=0,I=o.length;b<I;b++)x-=Math.abs(X0(l,o[b]*c,b<I-1?o[b+1]*c:l.length,c));var L=0;for(b=0;b<f.length;b+=3){var M=f[b]*c,R=f[b+1]*c,z=f[b+2]*c;L+=Math.abs((l[M]-l[z])*(l[R+1]-l[M+1])-(l[M]-l[R])*(l[z+1]-l[M+1]))}return x===0&&L===0?0:Math.abs((L-x)/x)},Z_.flatten=function(l){for(var o=l[0][0].length,c={vertices:[],holes:[],dimensions:o},f=0,g=0;g<l.length;g++){for(var x=0;x<l[g].length;x++)for(var b=0;b<o;b++)c.vertices.push(l[g][x][b]);g>0&&c.holes.push(f+=l[g-1].length)}return c};var Rw=w(G0.exports);function uL(l,o,c,f,g){Fw(l,o,c||0,f||l.length-1,g||lL)}function Fw(l,o,c,f,g){for(;f>c;){if(f-c>600){var x=f-c+1,b=o-c+1,I=Math.log(x),L=.5*Math.exp(2*I/3),M=.5*Math.sqrt(I*L*(x-L)/x)*(b-x/2<0?-1:1);Fw(l,o,Math.max(c,Math.floor(o-b*L/x+M)),Math.min(f,Math.floor(o+(x-b)*L/x+M)),g)}var R=l[o],z=c,U=f;for(gy(l,c,o),g(l[f],R)>0&&gy(l,c,f);z<U;){for(gy(l,z,U),z++,U--;g(l[z],R)<0;)z++;for(;g(l[U],R)>0;)U--}g(l[c],R)===0?gy(l,c,U):gy(l,++U,f),U<=o&&(c=U+1),o<=U&&(f=U-1)}}function gy(l,o,c){var f=l[o];l[o]=l[c],l[c]=f}function lL(l,o){return l<o?-1:l>o?1:0}function Y0(l,o){const c=l.length;if(c<=1)return[l];const f=[];let g,x;for(let b=0;b<c;b++){const I=Te(l[b]);I!==0&&(l[b].area=Math.abs(I),x===void 0&&(x=I<0),x===I<0?(g&&f.push(g),g=[l[b]]):g.push(l[b]))}if(g&&f.push(g),o>1)for(let b=0;b<f.length;b++)f[b].length<=o||(uL(f[b],o,1,f[b].length-1,cL),f[b]=f[b].slice(0,o));return f}function cL(l,o){return o.area-l.area}function Z0(l,o,c){const f=c.patternDependencies;let g=!1;for(const x of o){const b=x.paint.get(`${l}-pattern`);b.isConstant()||(g=!0);const I=b.constantOr(null);I&&(g=!0,f[I.to]=!0,f[I.from]=!0)}return g}function H0(l,o,c,f,g){const x=g.patternDependencies;for(const b of o){const I=b.paint.get(`${l}-pattern`).value;if(I.kind!=="constant"){let L=I.evaluate({zoom:f-1},c,{},g.availableImages),M=I.evaluate({zoom:f},c,{},g.availableImages),R=I.evaluate({zoom:f+1},c,{},g.availableImages);L=L&&L.name?L.name:L,M=M&&M.name?M.name:M,R=R&&R.name?R.name:R,x[L]=!0,x[M]=!0,x[R]=!0,c.patterns[b.id]={min:L,mid:M,max:R}}}return c}class W0{constructor(o){this.zoom=o.zoom,this.overscaling=o.overscaling,this.layers=o.layers,this.layerIds=this.layers.map(c=>c.id),this.index=o.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new Nn,this.indexArray=new Zo,this.indexArray2=new co,this.programConfigurations=new Ec(o.layers,o.zoom),this.segments=new Gr,this.segments2=new Gr,this.stateDependentLayerIds=this.layers.filter(c=>c.isStateDependent()).map(c=>c.id)}populate(o,c,f){this.hasPattern=Z0("fill",this.layers,c);const g=this.layers[0].layout.get("fill-sort-key"),x=!g.isConstant(),b=[];for(const{feature:I,id:L,index:M,sourceLayerIndex:R}of o){const z=this.layers[0]._featureFilter.needGeometry,U=Sd(I,z);if(!this.layers[0]._featureFilter.filter(new Ur(this.zoom),U,f))continue;const Y=x?g.evaluate(U,{},f,c.availableImages):void 0,H={id:L,properties:I.properties,type:I.type,sourceLayerIndex:R,index:M,geometry:z?U.geometry:Id(I),patterns:{},sortKey:Y};b.push(H)}x&&b.sort((I,L)=>I.sortKey-L.sortKey);for(const I of b){const{geometry:L,index:M,sourceLayerIndex:R}=I;if(this.hasPattern){const z=H0("fill",this.layers,I,this.zoom,c);this.patternFeatures.push(z)}else this.addFeature(I,L,M,f,{});c.featureIndex.insert(o[M].feature,L,M,R,this.index)}}update(o,c,f){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(o,c,this.stateDependentLayers,f)}addFeatures(o,c,f){for(const g of this.patternFeatures)this.addFeature(g,g.geometry,g.index,c,f)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(o){this.uploaded||(this.layoutVertexBuffer=o.createVertexBuffer(this.layoutVertexArray,KT),this.indexBuffer=o.createIndexBuffer(this.indexArray),this.indexBuffer2=o.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(o),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())}addFeature(o,c,f,g,x){for(const b of Y0(c,500)){let I=0;for(const Y of b)I+=Y.length;const L=this.segments.prepareSegment(I,this.layoutVertexArray,this.indexArray),M=L.vertexLength,R=[],z=[];for(const Y of b){if(Y.length===0)continue;Y!==b[0]&&z.push(R.length/2);const H=this.segments2.prepareSegment(Y.length,this.layoutVertexArray,this.indexArray2),Q=H.vertexLength;this.layoutVertexArray.emplaceBack(Y[0].x,Y[0].y),this.indexArray2.emplaceBack(Q+Y.length-1,Q),R.push(Y[0].x),R.push(Y[0].y);for(let ut=1;ut<Y.length;ut++)this.layoutVertexArray.emplaceBack(Y[ut].x,Y[ut].y),this.indexArray2.emplaceBack(Q+ut-1,Q+ut),R.push(Y[ut].x),R.push(Y[ut].y);H.vertexLength+=Y.length,H.primitiveLength+=Y.length}const U=Rw(R,z);for(let Y=0;Y<U.length;Y+=3)this.indexArray.emplaceBack(M+U[Y],M+U[Y+1],M+U[Y+2]);L.vertexLength+=I,L.primitiveLength+=U.length/3}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,o,f,x,g)}}let kw,zw;ve("FillBucket",W0,{omit:["layers","patternFeatures"]});var hL={get paint(){return zw=zw||new Gi({"fill-antialias":new ze(Vt.paint_fill["fill-antialias"]),"fill-opacity":new Ze(Vt.paint_fill["fill-opacity"]),"fill-color":new Ze(Vt.paint_fill["fill-color"]),"fill-outline-color":new Ze(Vt.paint_fill["fill-outline-color"]),"fill-translate":new ze(Vt.paint_fill["fill-translate"]),"fill-translate-anchor":new ze(Vt.paint_fill["fill-translate-anchor"]),"fill-pattern":new bd(Vt.paint_fill["fill-pattern"])})},get layout(){return kw=kw||new Gi({"fill-sort-key":new Ze(Vt.layout_fill["fill-sort-key"])})}};class pL extends cu{constructor(o){super(o,hL)}recalculate(o,c){super.recalculate(o,c);const f=this.paint._values["fill-outline-color"];f.value.kind==="constant"&&f.value.value===void 0&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(o){return new W0(o)}queryRadius(){return j_(this.paint.get("fill-translate"))}queryIntersectsFeature(o,c,f,g,x,b,I){return vw(X_(o,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),b.angle,I),g)}isTileClipped(){return!0}}const fL=ri([{name:"a_pos",components:2,type:"Int16"},{name:"a_normal_ed",components:4,type:"Int16"}],4),dL=ri([{name:"a_centroid",components:2,type:"Int16"}],4),{members:gL}=fL;var bf={},mL=C,Bw=Mg;function Mg(l,o,c,f,g){this.properties={},this.extent=c,this.type=0,this._pbf=l,this._geometry=-1,this._keys=f,this._values=g,l.readFields(yL,this,o)}function yL(l,o,c){l==1?o.id=c.readVarint():l==2?function(f,g){for(var x=f.readVarint()+f.pos;f.pos<x;){var b=g._keys[f.readVarint()],I=g._values[f.readVarint()];g.properties[b]=I}}(c,o):l==3?o.type=c.readVarint():l==4&&(o._geometry=c.pos)}function _L(l){for(var o,c,f=0,g=0,x=l.length,b=x-1;g<x;b=g++)f+=((c=l[b]).x-(o=l[g]).x)*(o.y+c.y);return f}Mg.types=["Unknown","Point","LineString","Polygon"],Mg.prototype.loadGeometry=function(){var l=this._pbf;l.pos=this._geometry;for(var o,c=l.readVarint()+l.pos,f=1,g=0,x=0,b=0,I=[];l.pos<c;){if(g<=0){var L=l.readVarint();f=7&L,g=L>>3}if(g--,f===1||f===2)x+=l.readSVarint(),b+=l.readSVarint(),f===1&&(o&&I.push(o),o=[]),o.push(new mL(x,b));else{if(f!==7)throw new Error("unknown command "+f);o&&o.push(o[0].clone())}}return o&&I.push(o),I},Mg.prototype.bbox=function(){var l=this._pbf;l.pos=this._geometry;for(var o=l.readVarint()+l.pos,c=1,f=0,g=0,x=0,b=1/0,I=-1/0,L=1/0,M=-1/0;l.pos<o;){if(f<=0){var R=l.readVarint();c=7&R,f=R>>3}if(f--,c===1||c===2)(g+=l.readSVarint())<b&&(b=g),g>I&&(I=g),(x+=l.readSVarint())<L&&(L=x),x>M&&(M=x);else if(c!==7)throw new Error("unknown command "+c)}return[b,L,I,M]},Mg.prototype.toGeoJSON=function(l,o,c){var f,g,x=this.extent*Math.pow(2,c),b=this.extent*l,I=this.extent*o,L=this.loadGeometry(),M=Mg.types[this.type];function R(Y){for(var H=0;H<Y.length;H++){var Q=Y[H];Y[H]=[360*(Q.x+b)/x-180,360/Math.PI*Math.atan(Math.exp((180-360*(Q.y+I)/x)*Math.PI/180))-90]}}switch(this.type){case 1:var z=[];for(f=0;f<L.length;f++)z[f]=L[f][0];R(L=z);break;case 2:for(f=0;f<L.length;f++)R(L[f]);break;case 3:for(L=function(Y){var H=Y.length;if(H<=1)return[Y];for(var Q,ut,ht=[],Et=0;Et<H;Et++){var mt=_L(Y[Et]);mt!==0&&(ut===void 0&&(ut=mt<0),ut===mt<0?(Q&&ht.push(Q),Q=[Y[Et]]):Q.push(Y[Et]))}return Q&&ht.push(Q),ht}(L),f=0;f<L.length;f++)for(g=0;g<L[f].length;g++)R(L[f][g])}L.length===1?L=L[0]:M="Multi"+M;var U={type:"Feature",geometry:{type:M,coordinates:L},properties:this.properties};return"id"in this&&(U.id=this.id),U};var vL=Bw,$w=Vw;function Vw(l,o){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=l,this._keys=[],this._values=[],this._features=[],l.readFields(xL,this,o),this.length=this._features.length}function xL(l,o,c){l===15?o.version=c.readVarint():l===1?o.name=c.readString():l===5?o.extent=c.readVarint():l===2?o._features.push(c.pos):l===3?o._keys.push(c.readString()):l===4&&o._values.push(function(f){for(var g=null,x=f.readVarint()+f.pos;f.pos<x;){var b=f.readVarint()>>3;g=b===1?f.readString():b===2?f.readFloat():b===3?f.readDouble():b===4?f.readVarint64():b===5?f.readVarint():b===6?f.readSVarint():b===7?f.readBoolean():null}return g}(c))}Vw.prototype.feature=function(l){if(l<0||l>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[l];var o=this._pbf.readVarint()+this._pbf.pos;return new vL(this._pbf,o,this.extent,this._keys,this._values)};var bL=$w;function wL(l,o,c){if(l===3){var f=new bL(c,c.readVarint()+c.pos);f.length&&(o[f.name]=f)}}bf.VectorTile=function(l,o){this.layers=l.readFields(wL,{},o)},bf.VectorTileFeature=Bw,bf.VectorTileLayer=$w;const EL=bf.VectorTileFeature.types,J0=Math.pow(2,13);function my(l,o,c,f,g,x,b,I){l.emplaceBack(o,c,2*Math.floor(f*J0)+b,g*J0*2,x*J0*2,Math.round(I))}class K0{constructor(o){this.zoom=o.zoom,this.overscaling=o.overscaling,this.layers=o.layers,this.layerIds=this.layers.map(c=>c.id),this.index=o.index,this.hasPattern=!1,this.layoutVertexArray=new ye,this.centroidVertexArray=new ue,this.indexArray=new Zo,this.programConfigurations=new Ec(o.layers,o.zoom),this.segments=new Gr,this.stateDependentLayerIds=this.layers.filter(c=>c.isStateDependent()).map(c=>c.id)}populate(o,c,f){this.features=[],this.hasPattern=Z0("fill-extrusion",this.layers,c);for(const{feature:g,id:x,index:b,sourceLayerIndex:I}of o){const L=this.layers[0]._featureFilter.needGeometry,M=Sd(g,L);if(!this.layers[0]._featureFilter.filter(new Ur(this.zoom),M,f))continue;const R={id:x,sourceLayerIndex:I,index:b,geometry:L?M.geometry:Id(g),properties:g.properties,type:g.type,patterns:{}};this.hasPattern?this.features.push(H0("fill-extrusion",this.layers,R,this.zoom,c)):this.addFeature(R,R.geometry,b,f,{}),c.featureIndex.insert(g,R.geometry,b,I,this.index,!0)}}addFeatures(o,c,f){for(const g of this.features){const{geometry:x}=g;this.addFeature(g,x,g.index,c,f)}}update(o,c,f){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(o,c,this.stateDependentLayers,f)}isEmpty(){return this.layoutVertexArray.length===0&&this.centroidVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(o){this.uploaded||(this.layoutVertexBuffer=o.createVertexBuffer(this.layoutVertexArray,gL),this.centroidVertexBuffer=o.createVertexBuffer(this.centroidVertexArray,dL.members,!0),this.indexBuffer=o.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(o),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.centroidVertexBuffer.destroy())}addFeature(o,c,f,g,x){const b={x:0,y:0,vertexCount:0};for(const I of Y0(c,500)){let L=0;for(const H of I)L+=H.length;let M=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray);for(const H of I){if(H.length===0||SL(H))continue;let Q=0;for(let ut=0;ut<H.length;ut++){const ht=H[ut];if(ut>=1){const Et=H[ut-1];if(!IL(ht,Et)){M.vertexLength+4>Gr.MAX_VERTEX_ARRAY_LENGTH&&(M=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray));const mt=ht.sub(Et)._perp()._unit(),St=Et.dist(ht);Q+St>32768&&(Q=0),my(this.layoutVertexArray,ht.x,ht.y,mt.x,mt.y,0,0,Q),my(this.layoutVertexArray,ht.x,ht.y,mt.x,mt.y,0,1,Q),b.x+=2*ht.x,b.y+=2*ht.y,b.vertexCount+=2,Q+=St,my(this.layoutVertexArray,Et.x,Et.y,mt.x,mt.y,0,0,Q),my(this.layoutVertexArray,Et.x,Et.y,mt.x,mt.y,0,1,Q),b.x+=2*Et.x,b.y+=2*Et.y,b.vertexCount+=2;const Dt=M.vertexLength;this.indexArray.emplaceBack(Dt,Dt+2,Dt+1),this.indexArray.emplaceBack(Dt+1,Dt+2,Dt+3),M.vertexLength+=4,M.primitiveLength+=2}}}}if(M.vertexLength+L>Gr.MAX_VERTEX_ARRAY_LENGTH&&(M=this.segments.prepareSegment(L,this.layoutVertexArray,this.indexArray)),EL[o.type]!=="Polygon")continue;const R=[],z=[],U=M.vertexLength;for(const H of I)if(H.length!==0){H!==I[0]&&z.push(R.length/2);for(let Q=0;Q<H.length;Q++){const ut=H[Q];my(this.layoutVertexArray,ut.x,ut.y,0,0,1,1,0),b.x+=ut.x,b.y+=ut.y,b.vertexCount+=1,R.push(ut.x),R.push(ut.y)}}const Y=Rw(R,z);for(let H=0;H<Y.length;H+=3)this.indexArray.emplaceBack(U+Y[H],U+Y[H+2],U+Y[H+1]);M.primitiveLength+=Y.length/3,M.vertexLength+=L}for(let I=0;I<b.vertexCount;I++)this.centroidVertexArray.emplaceBack(Math.floor(b.x/b.vertexCount),Math.floor(b.y/b.vertexCount));this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,o,f,x,g)}}function IL(l,o){return l.x===o.x&&(l.x<0||l.x>so)||l.y===o.y&&(l.y<0||l.y>so)}function SL(l){return l.every(o=>o.x<0)||l.every(o=>o.x>so)||l.every(o=>o.y<0)||l.every(o=>o.y>so)}let Uw;ve("FillExtrusionBucket",K0,{omit:["layers","features"]});var CL={get paint(){return Uw=Uw||new Gi({"fill-extrusion-opacity":new ze(Vt["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new Ze(Vt["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new ze(Vt["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new ze(Vt["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new bd(Vt["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new Ze(Vt["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new Ze(Vt["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new ze(Vt["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"])})}};class TL extends cu{constructor(o){super(o,CL)}createBucket(o){return new K0(o)}queryRadius(){return j_(this.paint.get("fill-extrusion-translate"))}is3D(){return!0}queryIntersectsFeature(o,c,f,g,x,b,I,L){const M=X_(o,this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),b.angle,I),R=this.paint.get("fill-extrusion-height").evaluate(c,f),z=this.paint.get("fill-extrusion-base").evaluate(c,f),U=function(H,Q,ut,ht){const Et=[];for(const mt of H){const St=[mt.x,mt.y,0,1];Y_(St,St,Q),Et.push(new D(St[0]/St[3],St[1]/St[3]))}return Et}(M,L),Y=function(H,Q,ut,ht){const Et=[],mt=[],St=ht[8]*Q,Dt=ht[9]*Q,Ht=ht[10]*Q,Ie=ht[11]*Q,Ae=ht[8]*ut,Ee=ht[9]*ut,_e=ht[10]*ut,ce=ht[11]*ut;for(const Ne of H){const pe=[],re=[];for(const qe of Ne){const Re=qe.x,bn=qe.y,qr=ht[0]*Re+ht[4]*bn+ht[12],Wr=ht[1]*Re+ht[5]*bn+ht[13],fo=ht[2]*Re+ht[6]*bn+ht[14],pu=ht[3]*Re+ht[7]*bn+ht[15],ha=fo+Ht,ao=pu+Ie,Wo=qr+Ae,gs=Wr+Ee,pa=fo+_e,fa=pu+ce,go=new D((qr+St)/ao,(Wr+Dt)/ao);go.z=ha/ao,pe.push(go);const mo=new D(Wo/fa,gs/fa);mo.z=pa/fa,re.push(mo)}Et.push(pe),mt.push(re)}return[Et,mt]}(g,z,R,L);return function(H,Q,ut){let ht=1/0;vw(ut,Q)&&(ht=Gw(ut,Q[0]));for(let Et=0;Et<Q.length;Et++){const mt=Q[Et],St=H[Et];for(let Dt=0;Dt<mt.length-1;Dt++){const Ht=mt[Dt],Ie=[Ht,mt[Dt+1],St[Dt+1],St[Dt],Ht];_w(ut,Ie)&&(ht=Math.min(ht,Gw(ut,Ie)))}}return ht!==1/0&&ht}(Y[0],Y[1],U)}}function yy(l,o){return l.x*o.x+l.y*o.y}function Gw(l,o){if(l.length===1){let c=0;const f=o[c++];let g;for(;!g||f.equals(g);)if(g=o[c++],!g)return 1/0;for(;c<o.length;c++){const x=o[c],b=l[0],I=g.sub(f),L=x.sub(f),M=b.sub(f),R=yy(I,I),z=yy(I,L),U=yy(L,L),Y=yy(M,I),H=yy(M,L),Q=R*U-z*z,ut=(U*Y-z*H)/Q,ht=(R*H-z*Y)/Q,Et=f.z*(1-ut-ht)+g.z*ut+x.z*ht;if(isFinite(Et))return Et}return 1/0}{let c=1/0;for(const f of o)c=Math.min(c,f.z);return c}}const LL=ri([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"}],4),{members:NL}=LL,PL=ri([{name:"a_uv_x",components:1,type:"Float32"},{name:"a_split_index",components:1,type:"Float32"}]),{members:ML}=PL,AL=bf.VectorTileFeature.types,DL=Math.cos(Math.PI/180*37.5),qw=Math.pow(2,14)/.5;class Q0{constructor(o){this.zoom=o.zoom,this.overscaling=o.overscaling,this.layers=o.layers,this.layerIds=this.layers.map(c=>c.id),this.index=o.index,this.hasPattern=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(c=>{this.gradients[c.id]={}}),this.layoutVertexArray=new He,this.layoutVertexArray2=new De,this.indexArray=new Zo,this.programConfigurations=new Ec(o.layers,o.zoom),this.segments=new Gr,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter(c=>c.isStateDependent()).map(c=>c.id)}populate(o,c,f){this.hasPattern=Z0("line",this.layers,c);const g=this.layers[0].layout.get("line-sort-key"),x=!g.isConstant(),b=[];for(const{feature:I,id:L,index:M,sourceLayerIndex:R}of o){const z=this.layers[0]._featureFilter.needGeometry,U=Sd(I,z);if(!this.layers[0]._featureFilter.filter(new Ur(this.zoom),U,f))continue;const Y=x?g.evaluate(U,{},f):void 0,H={id:L,properties:I.properties,type:I.type,sourceLayerIndex:R,index:M,geometry:z?U.geometry:Id(I),patterns:{},sortKey:Y};b.push(H)}x&&b.sort((I,L)=>I.sortKey-L.sortKey);for(const I of b){const{geometry:L,index:M,sourceLayerIndex:R}=I;if(this.hasPattern){const z=H0("line",this.layers,I,this.zoom,c);this.patternFeatures.push(z)}else this.addFeature(I,L,M,f,{});c.featureIndex.insert(o[M].feature,L,M,R,this.index)}}update(o,c,f){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(o,c,this.stateDependentLayers,f)}addFeatures(o,c,f){for(const g of this.patternFeatures)this.addFeature(g,g.geometry,g.index,c,f)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(o){this.uploaded||(this.layoutVertexArray2.length!==0&&(this.layoutVertexBuffer2=o.createVertexBuffer(this.layoutVertexArray2,ML)),this.layoutVertexBuffer=o.createVertexBuffer(this.layoutVertexArray,NL),this.indexBuffer=o.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(o),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(o){if(o.properties&&Object.prototype.hasOwnProperty.call(o.properties,"mapbox_clip_start")&&Object.prototype.hasOwnProperty.call(o.properties,"mapbox_clip_end"))return{start:+o.properties.mapbox_clip_start,end:+o.properties.mapbox_clip_end}}addFeature(o,c,f,g,x){const b=this.layers[0].layout,I=b.get("line-join").evaluate(o,{}),L=b.get("line-cap"),M=b.get("line-miter-limit"),R=b.get("line-round-limit");this.lineClips=this.lineFeatureClips(o);for(const z of c)this.addLine(z,o,I,L,M,R);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,o,f,x,g)}addLine(o,c,f,g,x,b){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,this.lineClips){this.lineClipsArray.push(this.lineClips);for(let ht=0;ht<o.length-1;ht++)this.totalDistance+=o[ht].dist(o[ht+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}const I=AL[c.type]==="Polygon";let L=o.length;for(;L>=2&&o[L-1].equals(o[L-2]);)L--;let M=0;for(;M<L-1&&o[M].equals(o[M+1]);)M++;if(L<(I?3:2))return;f==="bevel"&&(x=1.05);const R=this.overscaling<=16?15*so/(512*this.overscaling):0,z=this.segments.prepareSegment(10*L,this.layoutVertexArray,this.indexArray);let U,Y,H,Q,ut;this.e1=this.e2=-1,I&&(U=o[L-2],ut=o[M].sub(U)._unit()._perp());for(let ht=M;ht<L;ht++){if(H=ht===L-1?I?o[M+1]:void 0:o[ht+1],H&&o[ht].equals(H))continue;ut&&(Q=ut),U&&(Y=U),U=o[ht],ut=H?H.sub(U)._unit()._perp():Q,Q=Q||ut;let Et=Q.add(ut);Et.x===0&&Et.y===0||Et._unit();const mt=Q.x*ut.x+Q.y*ut.y,St=Et.x*ut.x+Et.y*ut.y,Dt=St!==0?1/St:1/0,Ht=2*Math.sqrt(2-2*St),Ie=St<DL&&Y&&H,Ae=Q.x*ut.y-Q.y*ut.x>0;if(Ie&&ht>M){const ce=U.dist(Y);if(ce>2*R){const Ne=U.sub(U.sub(Y)._mult(R/ce)._round());this.updateDistance(Y,Ne),this.addCurrentVertex(Ne,Q,0,0,z),Y=Ne}}const Ee=Y&&H;let _e=Ee?f:I?"butt":g;if(Ee&&_e==="round"&&(Dt<b?_e="miter":Dt<=2&&(_e="fakeround")),_e==="miter"&&Dt>x&&(_e="bevel"),_e==="bevel"&&(Dt>2&&(_e="flipbevel"),Dt<x&&(_e="miter")),Y&&this.updateDistance(Y,U),_e==="miter")Et._mult(Dt),this.addCurrentVertex(U,Et,0,0,z);else if(_e==="flipbevel"){if(Dt>100)Et=ut.mult(-1);else{const ce=Dt*Q.add(ut).mag()/Q.sub(ut).mag();Et._perp()._mult(ce*(Ae?-1:1))}this.addCurrentVertex(U,Et,0,0,z),this.addCurrentVertex(U,Et.mult(-1),0,0,z)}else if(_e==="bevel"||_e==="fakeround"){const ce=-Math.sqrt(Dt*Dt-1),Ne=Ae?ce:0,pe=Ae?0:ce;if(Y&&this.addCurrentVertex(U,Q,Ne,pe,z),_e==="fakeround"){const re=Math.round(180*Ht/Math.PI/20);for(let qe=1;qe<re;qe++){let Re=qe/re;if(Re!==.5){const qr=Re-.5;Re+=Re*qr*(Re-1)*((1.0904+mt*(mt*(3.55645-1.43519*mt)-3.2452))*qr*qr+(.848013+mt*(.215638*mt-1.06021)))}const bn=ut.sub(Q)._mult(Re)._add(Q)._unit()._mult(Ae?-1:1);this.addHalfVertex(U,bn.x,bn.y,!1,Ae,0,z)}}H&&this.addCurrentVertex(U,ut,-Ne,-pe,z)}else if(_e==="butt")this.addCurrentVertex(U,Et,0,0,z);else if(_e==="square"){const ce=Y?1:-1;this.addCurrentVertex(U,Et,ce,ce,z)}else _e==="round"&&(Y&&(this.addCurrentVertex(U,Q,0,0,z),this.addCurrentVertex(U,Q,1,1,z,!0)),H&&(this.addCurrentVertex(U,ut,-1,-1,z,!0),this.addCurrentVertex(U,ut,0,0,z)));if(Ie&&ht<L-1){const ce=U.dist(H);if(ce>2*R){const Ne=U.add(H.sub(U)._mult(R/ce)._round());this.updateDistance(U,Ne),this.addCurrentVertex(Ne,ut,0,0,z),U=Ne}}}}addCurrentVertex(o,c,f,g,x,b=!1){const I=c.y*g-c.x,L=-c.y-c.x*g;this.addHalfVertex(o,c.x+c.y*f,c.y-c.x*f,b,!1,f,x),this.addHalfVertex(o,I,L,b,!0,-g,x),this.distance>qw/2&&this.totalDistance===0&&(this.distance=0,this.updateScaledDistance(),this.addCurrentVertex(o,c,f,g,x,b))}addHalfVertex({x:o,y:c},f,g,x,b,I,L){const M=.5*(this.lineClips?this.scaledDistance*(qw-1):this.scaledDistance);this.layoutVertexArray.emplaceBack((o<<1)+(x?1:0),(c<<1)+(b?1:0),Math.round(63*f)+128,Math.round(63*g)+128,1+(I===0?0:I<0?-1:1)|(63&M)<<2,M>>6),this.lineClips&&this.layoutVertexArray2.emplaceBack((this.scaledDistance-this.lineClips.start)/(this.lineClips.end-this.lineClips.start),this.lineClipsArray.length);const R=L.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,R),L.primitiveLength++),b?this.e2=R:this.e1=R}updateScaledDistance(){this.scaledDistance=this.lineClips?this.lineClips.start+(this.lineClips.end-this.lineClips.start)*this.distance/this.totalDistance:this.distance}updateDistance(o,c){this.distance+=o.dist(c),this.updateScaledDistance()}}let jw,Xw;ve("LineBucket",Q0,{omit:["layers","patternFeatures"]});var Yw={get paint(){return Xw=Xw||new Gi({"line-opacity":new Ze(Vt.paint_line["line-opacity"]),"line-color":new Ze(Vt.paint_line["line-color"]),"line-translate":new ze(Vt.paint_line["line-translate"]),"line-translate-anchor":new ze(Vt.paint_line["line-translate-anchor"]),"line-width":new Ze(Vt.paint_line["line-width"]),"line-gap-width":new Ze(Vt.paint_line["line-gap-width"]),"line-offset":new Ze(Vt.paint_line["line-offset"]),"line-blur":new Ze(Vt.paint_line["line-blur"]),"line-dasharray":new ty(Vt.paint_line["line-dasharray"]),"line-pattern":new bd(Vt.paint_line["line-pattern"]),"line-gradient":new ey(Vt.paint_line["line-gradient"])})},get layout(){return jw=jw||new Gi({"line-cap":new ze(Vt.layout_line["line-cap"]),"line-join":new Ze(Vt.layout_line["line-join"]),"line-miter-limit":new ze(Vt.layout_line["line-miter-limit"]),"line-round-limit":new ze(Vt.layout_line["line-round-limit"]),"line-sort-key":new Ze(Vt.layout_line["line-sort-key"])})}};class OL extends Ze{possiblyEvaluate(o,c){return c=new Ur(Math.floor(c.zoom),{now:c.now,fadeDuration:c.fadeDuration,zoomHistory:c.zoomHistory,transition:c.transition}),super.possiblyEvaluate(o,c)}evaluate(o,c,f,g){return c=At({},c,{zoom:Math.floor(c.zoom)}),super.evaluate(o,c,f,g)}}let K_;class RL extends cu{constructor(o){super(o,Yw),this.gradientVersion=0,K_||(K_=new OL(Yw.paint.properties["line-width"].specification),K_.useIntegerZoom=!0)}_handleSpecialPaintPropertyUpdate(o){if(o==="line-gradient"){const c=this.gradientExpression();this.stepInterpolant=!!function(f){return f._styleExpression!==void 0}(c)&&c._styleExpression.expression instanceof Ou,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}recalculate(o,c){super.recalculate(o,c),this.paint._values["line-floorwidth"]=K_.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,o)}createBucket(o){return new Q0(o)}queryRadius(o){const c=o,f=Zw(ly("line-width",this,c),ly("line-gap-width",this,c)),g=ly("line-offset",this,c);return f/2+Math.abs(g)+j_(this.paint.get("line-translate"))}queryIntersectsFeature(o,c,f,g,x,b,I){const L=X_(o,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),b.angle,I),M=I/2*Zw(this.paint.get("line-width").evaluate(c,f),this.paint.get("line-gap-width").evaluate(c,f)),R=this.paint.get("line-offset").evaluate(c,f);return R&&(g=function(z,U){const Y=[];for(let H=0;H<z.length;H++){const Q=z[H],ut=[];for(let ht=0;ht<Q.length;ht++){const Et=Q[ht-1],mt=Q[ht],St=Q[ht+1],Dt=ht===0?new D(0,0):mt.sub(Et)._unit()._perp(),Ht=ht===Q.length-1?new D(0,0):St.sub(mt)._unit()._perp(),Ie=Dt._add(Ht)._unit(),Ae=Ie.x*Ht.x+Ie.y*Ht.y;Ae!==0&&Ie._mult(1/Ae),ut.push(Ie._mult(U)._add(mt))}Y.push(ut)}return Y}(g,R*I)),function(z,U,Y){for(let H=0;H<U.length;H++){const Q=U[H];if(z.length>=3){for(let ut=0;ut<Q.length;ut++)if(Lg(z,Q[ut]))return!0}if(VT(z,Q,Y))return!0}return!1}(L,g,M)}isTileClipped(){return!0}}function Zw(l,o){return o>0?o+2*l:l}const FL=ri([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_data",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),kL=ri([{name:"a_projected_pos",components:3,type:"Float32"}],4);ri([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const zL=ri([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"}]);ri([{type:"Int16",name:"anchorPointX"},{type:"Int16",name:"anchorPointY"},{type:"Int16",name:"x1"},{type:"Int16",name:"y1"},{type:"Int16",name:"x2"},{type:"Int16",name:"y2"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const Hw=ri([{name:"a_pos",components:2,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),BL=ri([{name:"a_pos",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);function $L(l,o,c){return l.sections.forEach(f=>{f.text=function(g,x,b){const I=x.layout.get("text-transform").evaluate(b,{});return I==="uppercase"?g=g.toLocaleUpperCase():I==="lowercase"&&(g=g.toLocaleLowerCase()),Da.applyArabicShaping&&(g=Da.applyArabicShaping(g)),g}(f.text,o,c)}),l}ri([{name:"triangle",components:3,type:"Uint16"}]),ri([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"}]),ri([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",name:"textBoxScale"},{type:"Float32",name:"collisionCircleDiameter"},{type:"Uint16",name:"textAnchorOffsetStartIndex"},{type:"Uint16",name:"textAnchorOffsetEndIndex"}]),ri([{type:"Float32",name:"offsetX"}]),ri([{type:"Int16",name:"x"},{type:"Int16",name:"y"},{type:"Int16",name:"tileUnitDistanceFromAnchor"}]),ri([{type:"Uint16",name:"textAnchor"},{type:"Float32",components:2,name:"textOffset"}]);const _y={"!":"︕","#":"＃",$:"＄","%":"％","&":"＆","(":"︵",")":"︶","*":"＊","+":"＋",",":"︐","-":"︲",".":"・","/":"／",":":"︓",";":"︔","<":"︿","=":"＝",">":"﹀","?":"︖","@":"＠","[":"﹇","\\":"＼","]":"﹈","^":"＾",_:"︳","`":"｀","{":"︷","|":"―","}":"︸","~":"～","¢":"￠","£":"￡","¥":"￥","¦":"￤","¬":"￢","¯":"￣","–":"︲","—":"︱","‘":"﹃","’":"﹄","“":"﹁","”":"﹂","…":"︙","‧":"・","₩":"￦","、":"︑","。":"︒","〈":"︿","〉":"﹀","《":"︽","》":"︾","「":"﹁","」":"﹂","『":"﹃","』":"﹄","【":"︻","】":"︼","〔":"︹","〕":"︺","〖":"︗","〗":"︘","！":"︕","（":"︵","）":"︶","，":"︐","－":"︲","．":"・","：":"︓","；":"︔","＜":"︿","＞":"﹀","？":"︖","［":"﹇","］":"﹈","＿":"︳","｛":"︷","｜":"―","｝":"︸","｟":"︵","｠":"︶","｡":"︒","｢":"﹁","｣":"﹂"};var po=24,Ww=Ir,Jw=function(l,o,c,f,g){var x,b,I=8*g-f-1,L=(1<<I)-1,M=L>>1,R=-7,z=c?g-1:0,U=c?-1:1,Y=l[o+z];for(z+=U,x=Y&(1<<-R)-1,Y>>=-R,R+=I;R>0;x=256*x+l[o+z],z+=U,R-=8);for(b=x&(1<<-R)-1,x>>=-R,R+=f;R>0;b=256*b+l[o+z],z+=U,R-=8);if(x===0)x=1-M;else{if(x===L)return b?NaN:1/0*(Y?-1:1);b+=Math.pow(2,f),x-=M}return(Y?-1:1)*b*Math.pow(2,x-f)},Kw=function(l,o,c,f,g,x){var b,I,L,M=8*x-g-1,R=(1<<M)-1,z=R>>1,U=g===23?Math.pow(2,-24)-Math.pow(2,-77):0,Y=f?0:x-1,H=f?1:-1,Q=o<0||o===0&&1/o<0?1:0;for(o=Math.abs(o),isNaN(o)||o===1/0?(I=isNaN(o)?1:0,b=R):(b=Math.floor(Math.log(o)/Math.LN2),o*(L=Math.pow(2,-b))<1&&(b--,L*=2),(o+=b+z>=1?U/L:U*Math.pow(2,1-z))*L>=2&&(b++,L/=2),b+z>=R?(I=0,b=R):b+z>=1?(I=(o*L-1)*Math.pow(2,g),b+=z):(I=o*Math.pow(2,z-1)*Math.pow(2,g),b=0));g>=8;l[c+Y]=255&I,Y+=H,I/=256,g-=8);for(b=b<<g|I,M+=g;M>0;l[c+Y]=255&b,Y+=H,b/=256,M-=8);l[c+Y-H]|=128*Q};function Ir(l){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(l)?l:new Uint8Array(l||0),this.pos=0,this.type=0,this.length=this.buf.length}Ir.Varint=0,Ir.Fixed64=1,Ir.Bytes=2,Ir.Fixed32=5;var tx=4294967296,Qw=1/tx,t1=typeof TextDecoder>"u"?null:new TextDecoder("utf8");function fp(l){return l.type===Ir.Bytes?l.readVarint()+l.pos:l.pos+1}function VL(l,o,c){return c?4294967296*o+(l>>>0):4294967296*(o>>>0)+(l>>>0)}function e1(l,o,c){var f=o<=16383?1:o<=2097151?2:o<=268435455?3:Math.floor(Math.log(o)/(7*Math.LN2));c.realloc(f);for(var g=c.pos-1;g>=l;g--)c.buf[g+f]=c.buf[g]}function UL(l,o){for(var c=0;c<l.length;c++)o.writeVarint(l[c])}function GL(l,o){for(var c=0;c<l.length;c++)o.writeSVarint(l[c])}function qL(l,o){for(var c=0;c<l.length;c++)o.writeFloat(l[c])}function jL(l,o){for(var c=0;c<l.length;c++)o.writeDouble(l[c])}function XL(l,o){for(var c=0;c<l.length;c++)o.writeBoolean(l[c])}function YL(l,o){for(var c=0;c<l.length;c++)o.writeFixed32(l[c])}function ZL(l,o){for(var c=0;c<l.length;c++)o.writeSFixed32(l[c])}function HL(l,o){for(var c=0;c<l.length;c++)o.writeFixed64(l[c])}function WL(l,o){for(var c=0;c<l.length;c++)o.writeSFixed64(l[c])}function Q_(l,o){return(l[o]|l[o+1]<<8|l[o+2]<<16)+16777216*l[o+3]}function Ag(l,o,c){l[c]=o,l[c+1]=o>>>8,l[c+2]=o>>>16,l[c+3]=o>>>24}function n1(l,o){return(l[o]|l[o+1]<<8|l[o+2]<<16)+(l[o+3]<<24)}Ir.prototype={destroy:function(){this.buf=null},readFields:function(l,o,c){for(c=c||this.length;this.pos<c;){var f=this.readVarint(),g=f>>3,x=this.pos;this.type=7&f,l(g,o,this),this.pos===x&&this.skip(f)}return o},readMessage:function(l,o){return this.readFields(l,o,this.readVarint()+this.pos)},readFixed32:function(){var l=Q_(this.buf,this.pos);return this.pos+=4,l},readSFixed32:function(){var l=n1(this.buf,this.pos);return this.pos+=4,l},readFixed64:function(){var l=Q_(this.buf,this.pos)+Q_(this.buf,this.pos+4)*tx;return this.pos+=8,l},readSFixed64:function(){var l=Q_(this.buf,this.pos)+n1(this.buf,this.pos+4)*tx;return this.pos+=8,l},readFloat:function(){var l=Jw(this.buf,this.pos,!0,23,4);return this.pos+=4,l},readDouble:function(){var l=Jw(this.buf,this.pos,!0,52,8);return this.pos+=8,l},readVarint:function(l){var o,c,f=this.buf;return o=127&(c=f[this.pos++]),c<128?o:(o|=(127&(c=f[this.pos++]))<<7,c<128?o:(o|=(127&(c=f[this.pos++]))<<14,c<128?o:(o|=(127&(c=f[this.pos++]))<<21,c<128?o:function(g,x,b){var I,L,M=b.buf;if(I=(112&(L=M[b.pos++]))>>4,L<128||(I|=(127&(L=M[b.pos++]))<<3,L<128)||(I|=(127&(L=M[b.pos++]))<<10,L<128)||(I|=(127&(L=M[b.pos++]))<<17,L<128)||(I|=(127&(L=M[b.pos++]))<<24,L<128)||(I|=(1&(L=M[b.pos++]))<<31,L<128))return VL(g,I,x);throw new Error("Expected varint not more than 10 bytes")}(o|=(15&(c=f[this.pos]))<<28,l,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var l=this.readVarint();return l%2==1?(l+1)/-2:l/2},readBoolean:function(){return!!this.readVarint()},readString:function(){var l=this.readVarint()+this.pos,o=this.pos;return this.pos=l,l-o>=12&&t1?function(c,f,g){return t1.decode(c.subarray(f,g))}(this.buf,o,l):function(c,f,g){for(var x="",b=f;b<g;){var I,L,M,R=c[b],z=null,U=R>239?4:R>223?3:R>191?2:1;if(b+U>g)break;U===1?R<128&&(z=R):U===2?(192&(I=c[b+1]))==128&&(z=(31&R)<<6|63&I)<=127&&(z=null):U===3?(L=c[b+2],(192&(I=c[b+1]))==128&&(192&L)==128&&((z=(15&R)<<12|(63&I)<<6|63&L)<=2047||z>=55296&&z<=57343)&&(z=null)):U===4&&(L=c[b+2],M=c[b+3],(192&(I=c[b+1]))==128&&(192&L)==128&&(192&M)==128&&((z=(15&R)<<18|(63&I)<<12|(63&L)<<6|63&M)<=65535||z>=1114112)&&(z=null)),z===null?(z=65533,U=1):z>65535&&(z-=65536,x+=String.fromCharCode(z>>>10&1023|55296),z=56320|1023&z),x+=String.fromCharCode(z),b+=U}return x}(this.buf,o,l)},readBytes:function(){var l=this.readVarint()+this.pos,o=this.buf.subarray(this.pos,l);return this.pos=l,o},readPackedVarint:function(l,o){if(this.type!==Ir.Bytes)return l.push(this.readVarint(o));var c=fp(this);for(l=l||[];this.pos<c;)l.push(this.readVarint(o));return l},readPackedSVarint:function(l){if(this.type!==Ir.Bytes)return l.push(this.readSVarint());var o=fp(this);for(l=l||[];this.pos<o;)l.push(this.readSVarint());return l},readPackedBoolean:function(l){if(this.type!==Ir.Bytes)return l.push(this.readBoolean());var o=fp(this);for(l=l||[];this.pos<o;)l.push(this.readBoolean());return l},readPackedFloat:function(l){if(this.type!==Ir.Bytes)return l.push(this.readFloat());var o=fp(this);for(l=l||[];this.pos<o;)l.push(this.readFloat());return l},readPackedDouble:function(l){if(this.type!==Ir.Bytes)return l.push(this.readDouble());var o=fp(this);for(l=l||[];this.pos<o;)l.push(this.readDouble());return l},readPackedFixed32:function(l){if(this.type!==Ir.Bytes)return l.push(this.readFixed32());var o=fp(this);for(l=l||[];this.pos<o;)l.push(this.readFixed32());return l},readPackedSFixed32:function(l){if(this.type!==Ir.Bytes)return l.push(this.readSFixed32());var o=fp(this);for(l=l||[];this.pos<o;)l.push(this.readSFixed32());return l},readPackedFixed64:function(l){if(this.type!==Ir.Bytes)return l.push(this.readFixed64());var o=fp(this);for(l=l||[];this.pos<o;)l.push(this.readFixed64());return l},readPackedSFixed64:function(l){if(this.type!==Ir.Bytes)return l.push(this.readSFixed64());var o=fp(this);for(l=l||[];this.pos<o;)l.push(this.readSFixed64());return l},skip:function(l){var o=7&l;if(o===Ir.Varint)for(;this.buf[this.pos++]>127;);else if(o===Ir.Bytes)this.pos=this.readVarint()+this.pos;else if(o===Ir.Fixed32)this.pos+=4;else{if(o!==Ir.Fixed64)throw new Error("Unimplemented type: "+o);this.pos+=8}},writeTag:function(l,o){this.writeVarint(l<<3|o)},realloc:function(l){for(var o=this.length||16;o<this.pos+l;)o*=2;if(o!==this.length){var c=new Uint8Array(o);c.set(this.buf),this.buf=c,this.length=o}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(l){this.realloc(4),Ag(this.buf,l,this.pos),this.pos+=4},writeSFixed32:function(l){this.realloc(4),Ag(this.buf,l,this.pos),this.pos+=4},writeFixed64:function(l){this.realloc(8),Ag(this.buf,-1&l,this.pos),Ag(this.buf,Math.floor(l*Qw),this.pos+4),this.pos+=8},writeSFixed64:function(l){this.realloc(8),Ag(this.buf,-1&l,this.pos),Ag(this.buf,Math.floor(l*Qw),this.pos+4),this.pos+=8},writeVarint:function(l){(l=+l||0)>268435455||l<0?function(o,c){var f,g;if(o>=0?(f=o%4294967296|0,g=o/4294967296|0):(g=~(-o/4294967296),4294967295^(f=~(-o%4294967296))?f=f+1|0:(f=0,g=g+1|0)),o>=18446744073709552e3||o<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");c.realloc(10),function(x,b,I){I.buf[I.pos++]=127&x|128,x>>>=7,I.buf[I.pos++]=127&x|128,x>>>=7,I.buf[I.pos++]=127&x|128,x>>>=7,I.buf[I.pos++]=127&x|128,I.buf[I.pos]=127&(x>>>=7)}(f,0,c),function(x,b){var I=(7&x)<<4;b.buf[b.pos++]|=I|((x>>>=3)?128:0),x&&(b.buf[b.pos++]=127&x|((x>>>=7)?128:0),x&&(b.buf[b.pos++]=127&x|((x>>>=7)?128:0),x&&(b.buf[b.pos++]=127&x|((x>>>=7)?128:0),x&&(b.buf[b.pos++]=127&x|((x>>>=7)?128:0),x&&(b.buf[b.pos++]=127&x)))))}(g,c)}(l,this):(this.realloc(4),this.buf[this.pos++]=127&l|(l>127?128:0),l<=127||(this.buf[this.pos++]=127&(l>>>=7)|(l>127?128:0),l<=127||(this.buf[this.pos++]=127&(l>>>=7)|(l>127?128:0),l<=127||(this.buf[this.pos++]=l>>>7&127))))},writeSVarint:function(l){this.writeVarint(l<0?2*-l-1:2*l)},writeBoolean:function(l){this.writeVarint(!!l)},writeString:function(l){l=String(l),this.realloc(4*l.length),this.pos++;var o=this.pos;this.pos=function(f,g,x){for(var b,I,L=0;L<g.length;L++){if((b=g.charCodeAt(L))>55295&&b<57344){if(!I){b>56319||L+1===g.length?(f[x++]=239,f[x++]=191,f[x++]=189):I=b;continue}if(b<56320){f[x++]=239,f[x++]=191,f[x++]=189,I=b;continue}b=I-55296<<10|b-56320|65536,I=null}else I&&(f[x++]=239,f[x++]=191,f[x++]=189,I=null);b<128?f[x++]=b:(b<2048?f[x++]=b>>6|192:(b<65536?f[x++]=b>>12|224:(f[x++]=b>>18|240,f[x++]=b>>12&63|128),f[x++]=b>>6&63|128),f[x++]=63&b|128)}return x}(this.buf,l,this.pos);var c=this.pos-o;c>=128&&e1(o,c,this),this.pos=o-1,this.writeVarint(c),this.pos+=c},writeFloat:function(l){this.realloc(4),Kw(this.buf,l,this.pos,!0,23,4),this.pos+=4},writeDouble:function(l){this.realloc(8),Kw(this.buf,l,this.pos,!0,52,8),this.pos+=8},writeBytes:function(l){var o=l.length;this.writeVarint(o),this.realloc(o);for(var c=0;c<o;c++)this.buf[this.pos++]=l[c]},writeRawMessage:function(l,o){this.pos++;var c=this.pos;l(o,this);var f=this.pos-c;f>=128&&e1(c,f,this),this.pos=c-1,this.writeVarint(f),this.pos+=f},writeMessage:function(l,o,c){this.writeTag(l,Ir.Bytes),this.writeRawMessage(o,c)},writePackedVarint:function(l,o){o.length&&this.writeMessage(l,UL,o)},writePackedSVarint:function(l,o){o.length&&this.writeMessage(l,GL,o)},writePackedBoolean:function(l,o){o.length&&this.writeMessage(l,XL,o)},writePackedFloat:function(l,o){o.length&&this.writeMessage(l,qL,o)},writePackedDouble:function(l,o){o.length&&this.writeMessage(l,jL,o)},writePackedFixed32:function(l,o){o.length&&this.writeMessage(l,YL,o)},writePackedSFixed32:function(l,o){o.length&&this.writeMessage(l,ZL,o)},writePackedFixed64:function(l,o){o.length&&this.writeMessage(l,HL,o)},writePackedSFixed64:function(l,o){o.length&&this.writeMessage(l,WL,o)},writeBytesField:function(l,o){this.writeTag(l,Ir.Bytes),this.writeBytes(o)},writeFixed32Field:function(l,o){this.writeTag(l,Ir.Fixed32),this.writeFixed32(o)},writeSFixed32Field:function(l,o){this.writeTag(l,Ir.Fixed32),this.writeSFixed32(o)},writeFixed64Field:function(l,o){this.writeTag(l,Ir.Fixed64),this.writeFixed64(o)},writeSFixed64Field:function(l,o){this.writeTag(l,Ir.Fixed64),this.writeSFixed64(o)},writeVarintField:function(l,o){this.writeTag(l,Ir.Varint),this.writeVarint(o)},writeSVarintField:function(l,o){this.writeTag(l,Ir.Varint),this.writeSVarint(o)},writeStringField:function(l,o){this.writeTag(l,Ir.Bytes),this.writeString(o)},writeFloatField:function(l,o){this.writeTag(l,Ir.Fixed32),this.writeFloat(o)},writeDoubleField:function(l,o){this.writeTag(l,Ir.Fixed64),this.writeDouble(o)},writeBooleanField:function(l,o){this.writeVarintField(l,!!o)}};var ex=w(Ww);const nx=3;function JL(l,o,c){l===1&&c.readMessage(KL,o)}function KL(l,o,c){if(l===3){const{id:f,bitmap:g,width:x,height:b,left:I,top:L,advance:M}=c.readMessage(QL,{});o.push({id:f,bitmap:new hy({width:x+2*nx,height:b+2*nx},g),metrics:{width:x,height:b,left:I,top:L,advance:M}})}}function QL(l,o,c){l===1?o.id=c.readVarint():l===2?o.bitmap=c.readBytes():l===3?o.width=c.readVarint():l===4?o.height=c.readVarint():l===5?o.left=c.readSVarint():l===6?o.top=c.readSVarint():l===7&&(o.advance=c.readVarint())}const r1=nx;function i1(l){let o=0,c=0;for(const b of l)o+=b.w*b.h,c=Math.max(c,b.w);l.sort((b,I)=>I.h-b.h);const f=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(o/.95)),c),h:1/0}];let g=0,x=0;for(const b of l)for(let I=f.length-1;I>=0;I--){const L=f[I];if(!(b.w>L.w||b.h>L.h)){if(b.x=L.x,b.y=L.y,x=Math.max(x,b.y+b.h),g=Math.max(g,b.x+b.w),b.w===L.w&&b.h===L.h){const M=f.pop();I<f.length&&(f[I]=M)}else b.h===L.h?(L.x+=b.w,L.w-=b.w):b.w===L.w?(L.y+=b.h,L.h-=b.h):(f.push({x:L.x+b.w,y:L.y,w:L.w-b.w,h:b.h}),L.y+=b.h,L.h-=b.h);break}}return{w:g,h:x,fill:o/(g*x)||0}}const Ra=1;class rx{constructor(o,{pixelRatio:c,version:f,stretchX:g,stretchY:x,content:b}){this.paddedRect=o,this.pixelRatio=c,this.stretchX=g,this.stretchY=x,this.content=b,this.version=f}get tl(){return[this.paddedRect.x+Ra,this.paddedRect.y+Ra]}get br(){return[this.paddedRect.x+this.paddedRect.w-Ra,this.paddedRect.y+this.paddedRect.h-Ra]}get tlbr(){return this.tl.concat(this.br)}get displaySize(){return[(this.paddedRect.w-2*Ra)/this.pixelRatio,(this.paddedRect.h-2*Ra)/this.pixelRatio]}}class o1{constructor(o,c){const f={},g={};this.haveRenderCallbacks=[];const x=[];this.addImages(o,f,x),this.addImages(c,g,x);const{w:b,h:I}=i1(x),L=new Bu({width:b||1,height:I||1});for(const M in o){const R=o[M],z=f[M].paddedRect;Bu.copy(R.data,L,{x:0,y:0},{x:z.x+Ra,y:z.y+Ra},R.data)}for(const M in c){const R=c[M],z=g[M].paddedRect,U=z.x+Ra,Y=z.y+Ra,H=R.data.width,Q=R.data.height;Bu.copy(R.data,L,{x:0,y:0},{x:U,y:Y},R.data),Bu.copy(R.data,L,{x:0,y:Q-1},{x:U,y:Y-1},{width:H,height:1}),Bu.copy(R.data,L,{x:0,y:0},{x:U,y:Y+Q},{width:H,height:1}),Bu.copy(R.data,L,{x:H-1,y:0},{x:U-1,y:Y},{width:1,height:Q}),Bu.copy(R.data,L,{x:0,y:0},{x:U+H,y:Y},{width:1,height:Q})}this.image=L,this.iconPositions=f,this.patternPositions=g}addImages(o,c,f){for(const g in o){const x=o[g],b={x:0,y:0,w:x.data.width+2*Ra,h:x.data.height+2*Ra};f.push(b),c[g]=new rx(b,x),x.hasRenderCallback&&this.haveRenderCallbacks.push(g)}}patchUpdatedImages(o,c){o.dispatchRenderCallbacks(this.haveRenderCallbacks);for(const f in o.updatedImages)this.patchUpdatedImage(this.iconPositions[f],o.getImage(f),c),this.patchUpdatedImage(this.patternPositions[f],o.getImage(f),c)}patchUpdatedImage(o,c,f){if(!o||!c||o.version===c.version)return;o.version=c.version;const[g,x]=o.tl;f.update(c.data,void 0,{x:g,y:x})}}var wf;ve("ImagePosition",rx),ve("ImageAtlas",o1),u.ai=void 0,(wf=u.ai||(u.ai={}))[wf.none=0]="none",wf[wf.horizontal=1]="horizontal",wf[wf.vertical=2]="vertical",wf[wf.horizontalOnly=3]="horizontalOnly";const vy=-17;class xy{constructor(){this.scale=1,this.fontStack="",this.imageName=null}static forText(o,c){const f=new xy;return f.scale=o||1,f.fontStack=c,f}static forImage(o){const c=new xy;return c.imageName=o,c}}class Dg{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(o,c){const f=new Dg;for(let g=0;g<o.sections.length;g++){const x=o.sections[g];x.image?f.addImageSection(x):f.addTextSection(x,c)}return f}length(){return this.text.length}getSection(o){return this.sections[this.sectionIndex[o]]}getSectionIndex(o){return this.sectionIndex[o]}getCharCode(o){return this.text.charCodeAt(o)}verticalizePunctuation(){this.text=function(o){let c="";for(let f=0;f<o.length;f++){const g=o.charCodeAt(f+1)||null,x=o.charCodeAt(f-1)||null;c+=g&&op(g)&&!_y[o[f+1]]||x&&op(x)&&!_y[o[f-1]]||!_y[o[f]]?o[f]:_y[o[f]]}return c}(this.text)}trim(){let o=0;for(let f=0;f<this.text.length&&ev[this.text.charCodeAt(f)];f++)o++;let c=this.text.length;for(let f=this.text.length-1;f>=0&&f>=o&&ev[this.text.charCodeAt(f)];f--)c--;this.text=this.text.substring(o,c),this.sectionIndex=this.sectionIndex.slice(o,c)}substring(o,c){const f=new Dg;return f.text=this.text.substring(o,c),f.sectionIndex=this.sectionIndex.slice(o,c),f.sections=this.sections,f}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce((o,c)=>Math.max(o,this.sections[c].scale),0)}addTextSection(o,c){this.text+=o.text,this.sections.push(xy.forText(o.scale,o.fontStack||c));const f=this.sections.length-1;for(let g=0;g<o.text.length;++g)this.sectionIndex.push(f)}addImageSection(o){const c=o.image?o.image.name:"";if(c.length===0)return void vt("Can't add FormattedSection with an empty image.");const f=this.getNextImageSectionCharCode();f?(this.text+=String.fromCharCode(f),this.sections.push(xy.forImage(c)),this.sectionIndex.push(this.sections.length-1)):vt("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function tv(l,o,c,f,g,x,b,I,L,M,R,z,U,Y,H,Q){const ut=Dg.fromFeature(l,g);let ht;z===u.ai.vertical&&ut.verticalizePunctuation();const{processBidirectionalText:Et,processStyledBidirectionalText:mt}=Da;if(Et&&ut.sections.length===1){ht=[];const Ht=Et(ut.toString(),ix(ut,M,x,o,f,Y,H));for(const Ie of Ht){const Ae=new Dg;Ae.text=Ie,Ae.sections=ut.sections;for(let Ee=0;Ee<Ie.length;Ee++)Ae.sectionIndex.push(0);ht.push(Ae)}}else if(mt){ht=[];const Ht=mt(ut.text,ut.sectionIndex,ix(ut,M,x,o,f,Y,H));for(const Ie of Ht){const Ae=new Dg;Ae.text=Ie[0],Ae.sectionIndex=Ie[1],Ae.sections=ut.sections,ht.push(Ae)}}else ht=function(Ht,Ie){const Ae=[],Ee=Ht.text;let _e=0;for(const ce of Ie)Ae.push(Ht.substring(_e,ce)),_e=ce;return _e<Ee.length&&Ae.push(Ht.substring(_e,Ee.length)),Ae}(ut,ix(ut,M,x,o,f,Y,H));const St=[],Dt={positionedLines:St,text:ut.toString(),top:R[1],bottom:R[1],left:R[0],right:R[0],writingMode:z,iconsInText:!1,verticalizable:!1};return function(Ht,Ie,Ae,Ee,_e,ce,Ne,pe,re,qe,Re,bn){let qr=0,Wr=vy,fo=0,pu=0;const ha=pe==="right"?1:pe==="left"?0:.5;let ao=0;for(const go of _e){go.trim();const mo=go.getMaxScale(),Gs=(mo-1)*po,da={positionedGlyphs:[],lineOffset:0};Ht.positionedLines[ao]=da;const qs=da.positionedGlyphs;let Fa=0;if(!go.length()){Wr+=ce,++ao;continue}for(let yo=0;yo<go.length();yo++){const Dn=go.getSection(yo),js=go.getSectionIndex(yo),ms=go.getCharCode(yo);let _o=0,Pl=null,Ic=null,Sc=null,dp=po;const Ml=!(re===u.ai.horizontal||!Re&&!ph(ms)||Re&&(ev[ms]||(Wo=ms,he.Arabic(Wo)||he["Arabic Supplement"](Wo)||he["Arabic Extended-A"](Wo)||he["Arabic Presentation Forms-A"](Wo)||he["Arabic Presentation Forms-B"](Wo))));if(Dn.imageName){const Vu=Ee[Dn.imageName];if(!Vu)continue;Sc=Dn.imageName,Ht.iconsInText=Ht.iconsInText||!0,Ic=Vu.paddedRect;const za=Vu.displaySize;Dn.scale=Dn.scale*po/bn,Pl={width:za[0],height:za[1],left:Ra,top:-r1,advance:Ml?za[1]:za[0]},_o=Gs+(po-za[1]*Dn.scale),dp=Pl.advance;const gp=Ml?za[0]*Dn.scale-po*mo:za[1]*Dn.scale-po*mo;gp>0&&gp>Fa&&(Fa=gp)}else{const Vu=Ae[Dn.fontStack],za=Vu&&Vu[ms];if(za&&za.rect)Ic=za.rect,Pl=za.metrics;else{const gp=Ie[Dn.fontStack],Sy=gp&&gp[ms];if(!Sy)continue;Pl=Sy.metrics}_o=(mo-Dn.scale)*po}Ml?(Ht.verticalizable=!0,qs.push({glyph:ms,imageName:Sc,x:qr,y:Wr+_o,vertical:Ml,scale:Dn.scale,fontStack:Dn.fontStack,sectionIndex:js,metrics:Pl,rect:Ic}),qr+=dp*Dn.scale+qe):(qs.push({glyph:ms,imageName:Sc,x:qr,y:Wr+_o,vertical:Ml,scale:Dn.scale,fontStack:Dn.fontStack,sectionIndex:js,metrics:Pl,rect:Ic}),qr+=Pl.advance*Dn.scale+qe)}qs.length!==0&&(fo=Math.max(qr-qe,fo),nN(qs,0,qs.length-1,ha,Fa)),qr=0;const ka=ce*mo+Fa;da.lineOffset=Math.max(Fa,Gs),Wr+=ka,pu=Math.max(ka,pu),++ao}var Wo;const gs=Wr-vy,{horizontalAlign:pa,verticalAlign:fa}=ox(Ne);(function(go,mo,Gs,da,qs,Fa,ka,yo,Dn){const js=(mo-Gs)*qs;let ms=0;ms=Fa!==ka?-yo*da-vy:(-da*Dn+.5)*ka;for(const _o of go)for(const Pl of _o.positionedGlyphs)Pl.x+=js,Pl.y+=ms})(Ht.positionedLines,ha,pa,fa,fo,pu,ce,gs,_e.length),Ht.top+=-fa*gs,Ht.bottom=Ht.top+gs,Ht.left+=-pa*fo,Ht.right=Ht.left+fo}(Dt,o,c,f,ht,b,I,L,z,M,U,Q),!function(Ht){for(const Ie of Ht)if(Ie.positionedGlyphs.length!==0)return!1;return!0}(St)&&Dt}const ev={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},tN={10:!0,32:!0,38:!0,40:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0};function s1(l,o,c,f,g,x){if(o.imageName){const b=f[o.imageName];return b?b.displaySize[0]*o.scale*po/x+g:0}{const b=c[o.fontStack],I=b&&b[l];return I?I.metrics.advance*o.scale+g:0}}function a1(l,o,c,f){const g=Math.pow(l-o,2);return f?l<o?g/2:2*g:g+Math.abs(c)*c}function eN(l,o,c){let f=0;return l===10&&(f-=1e4),c&&(f+=150),l!==40&&l!==65288||(f+=50),o!==41&&o!==65289||(f+=50),f}function u1(l,o,c,f,g,x){let b=null,I=a1(o,c,g,x);for(const L of f){const M=a1(o-L.x,c,g,x)+L.badness;M<=I&&(b=L,I=M)}return{index:l,x:o,priorBreak:b,badness:I}}function l1(l){return l?l1(l.priorBreak).concat(l.index):[]}function ix(l,o,c,f,g,x,b){if(x!=="point")return[];if(!l)return[];const I=[],L=function(U,Y,H,Q,ut,ht){let Et=0;for(let mt=0;mt<U.length();mt++){const St=U.getSection(mt);Et+=s1(U.getCharCode(mt),St,Q,ut,Y,ht)}return Et/Math.max(1,Math.ceil(Et/H))}(l,o,c,f,g,b),M=l.text.indexOf("​")>=0;let R=0;for(let U=0;U<l.length();U++){const Y=l.getSection(U),H=l.getCharCode(U);if(ev[H]||(R+=s1(H,Y,f,g,o,b)),U<l.length()-1){const Q=!((z=H)<11904||!(he["Bopomofo Extended"](z)||he.Bopomofo(z)||he["CJK Compatibility Forms"](z)||he["CJK Compatibility Ideographs"](z)||he["CJK Compatibility"](z)||he["CJK Radicals Supplement"](z)||he["CJK Strokes"](z)||he["CJK Symbols and Punctuation"](z)||he["CJK Unified Ideographs Extension A"](z)||he["CJK Unified Ideographs"](z)||he["Enclosed CJK Letters and Months"](z)||he["Halfwidth and Fullwidth Forms"](z)||he.Hiragana(z)||he["Ideographic Description Characters"](z)||he["Kangxi Radicals"](z)||he["Katakana Phonetic Extensions"](z)||he.Katakana(z)||he["Vertical Forms"](z)||he["Yi Radicals"](z)||he["Yi Syllables"](z)));(tN[H]||Q||Y.imageName)&&I.push(u1(U+1,R,L,I,eN(H,l.getCharCode(U+1),Q&&M),!1))}}var z;return l1(u1(l.length(),R,L,I,0,!0))}function ox(l){let o=.5,c=.5;switch(l){case"right":case"top-right":case"bottom-right":o=1;break;case"left":case"top-left":case"bottom-left":o=0}switch(l){case"bottom":case"bottom-right":case"bottom-left":c=1;break;case"top":case"top-right":case"top-left":c=0}return{horizontalAlign:o,verticalAlign:c}}function nN(l,o,c,f,g){if(!f&&!g)return;const x=l[c],b=(l[c].x+x.metrics.advance*x.scale)*f;for(let I=o;I<=c;I++)l[I].x-=b,l[I].y+=g}function rN(l,o,c){const{horizontalAlign:f,verticalAlign:g}=ox(c),x=o[0]-l.displaySize[0]*f,b=o[1]-l.displaySize[1]*g;return{image:l,top:b,bottom:b+l.displaySize[1],left:x,right:x+l.displaySize[0]}}function c1(l,o,c,f,g,x){const b=l.image;let I;if(b.content){const ut=b.content,ht=b.pixelRatio||1;I=[ut[0]/ht,ut[1]/ht,b.displaySize[0]-ut[2]/ht,b.displaySize[1]-ut[3]/ht]}const L=o.left*x,M=o.right*x;let R,z,U,Y;c==="width"||c==="both"?(Y=g[0]+L-f[3],z=g[0]+M+f[1]):(Y=g[0]+(L+M-b.displaySize[0])/2,z=Y+b.displaySize[0]);const H=o.top*x,Q=o.bottom*x;return c==="height"||c==="both"?(R=g[1]+H-f[0],U=g[1]+Q+f[2]):(R=g[1]+(H+Q-b.displaySize[1])/2,U=R+b.displaySize[1]),{image:b,top:R,right:z,bottom:U,left:Y,collisionPadding:I}}const by=255,gh=128,Ef=by*gh;function h1(l,o){const{expression:c}=o;if(c.kind==="constant")return{kind:"constant",layoutSize:c.evaluate(new Ur(l+1))};if(c.kind==="source")return{kind:"source"};{const{zoomStops:f,interpolationType:g}=c;let x=0;for(;x<f.length&&f[x]<=l;)x++;x=Math.max(0,x-1);let b=x;for(;b<f.length&&f[b]<l+1;)b++;b=Math.min(f.length-1,b);const I=f[x],L=f[b];return c.kind==="composite"?{kind:"composite",minZoom:I,maxZoom:L,interpolationType:g}:{kind:"camera",minZoom:I,maxZoom:L,minSize:c.evaluate(new Ur(I)),maxSize:c.evaluate(new Ur(L)),interpolationType:g}}}function sx(l,o,c){let f="never";const g=l.get(o);return g?f=g:l.get(c)&&(f="always"),f}const iN=bf.VectorTileFeature.types,oN=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function nv(l,o,c,f,g,x,b,I,L,M,R,z,U){const Y=I?Math.min(Ef,Math.round(I[0])):0,H=I?Math.min(Ef,Math.round(I[1])):0;l.emplaceBack(o,c,Math.round(32*f),Math.round(32*g),x,b,(Y<<1)+(L?1:0),H,16*M,16*R,256*z,256*U)}function ax(l,o,c){l.emplaceBack(o.x,o.y,c),l.emplaceBack(o.x,o.y,c),l.emplaceBack(o.x,o.y,c),l.emplaceBack(o.x,o.y,c)}function sN(l){for(const o of l.sections)if(yf(o.text))return!0;return!1}class ux{constructor(o){this.layoutVertexArray=new Tn,this.indexArray=new Zo,this.programConfigurations=o,this.segments=new Gr,this.dynamicLayoutVertexArray=new _n,this.opacityVertexArray=new Pn,this.hasVisibleVertices=!1,this.placedSymbolArray=new xt}isEmpty(){return this.layoutVertexArray.length===0&&this.indexArray.length===0&&this.dynamicLayoutVertexArray.length===0&&this.opacityVertexArray.length===0}upload(o,c,f,g){this.isEmpty()||(f&&(this.layoutVertexBuffer=o.createVertexBuffer(this.layoutVertexArray,FL.members),this.indexBuffer=o.createIndexBuffer(this.indexArray,c),this.dynamicLayoutVertexBuffer=o.createVertexBuffer(this.dynamicLayoutVertexArray,kL.members,!0),this.opacityVertexBuffer=o.createVertexBuffer(this.opacityVertexArray,oN,!0),this.opacityVertexBuffer.itemSize=1),(f||g)&&this.programConfigurations.upload(o))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy())}}ve("SymbolBuffers",ux);class lx{constructor(o,c,f){this.layoutVertexArray=new o,this.layoutAttributes=c,this.indexArray=new f,this.segments=new Gr,this.collisionVertexArray=new Dr}upload(o){this.layoutVertexBuffer=o.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=o.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=o.createVertexBuffer(this.collisionVertexArray,zL.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy())}}ve("CollisionBuffers",lx);class Og{constructor(o){this.collisionBoxArray=o.collisionBoxArray,this.zoom=o.zoom,this.overscaling=o.overscaling,this.layers=o.layers,this.layerIds=this.layers.map(b=>b.id),this.index=o.index,this.pixelRatio=o.pixelRatio,this.sourceLayerIndex=o.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=$0([]),this.placementViewportMatrix=$0([]);const c=this.layers[0]._unevaluatedLayout._values;this.textSizeData=h1(this.zoom,c["text-size"]),this.iconSizeData=h1(this.zoom,c["icon-size"]);const f=this.layers[0].layout,g=f.get("symbol-sort-key"),x=f.get("symbol-z-order");this.canOverlap=sx(f,"text-overlap","text-allow-overlap")!=="never"||sx(f,"icon-overlap","icon-allow-overlap")!=="never"||f.get("text-ignore-placement")||f.get("icon-ignore-placement"),this.sortFeaturesByKey=x!=="viewport-y"&&!g.isConstant(),this.sortFeaturesByY=(x==="viewport-y"||x==="auto"&&!this.sortFeaturesByKey)&&this.canOverlap,f.get("symbol-placement")==="point"&&(this.writingModes=f.get("text-writing-mode").map(b=>u.ai[b])),this.stateDependentLayerIds=this.layers.filter(b=>b.isStateDependent()).map(b=>b.id),this.sourceID=o.sourceID}createArrays(){this.text=new ux(new Ec(this.layers,this.zoom,o=>/^text/.test(o))),this.icon=new ux(new Ec(this.layers,this.zoom,o=>/^icon/.test(o))),this.glyphOffsetArray=new wt,this.lineVertexArray=new Ft,this.symbolInstances=new lt,this.textAnchorOffsets=new Zt}calculateGlyphDependencies(o,c,f,g,x){for(let b=0;b<o.length;b++)if(c[o.charCodeAt(b)]=!0,(f||g)&&x){const I=_y[o.charAt(b)];I&&(c[I.charCodeAt(0)]=!0)}}populate(o,c,f){const g=this.layers[0],x=g.layout,b=x.get("text-font"),I=x.get("text-field"),L=x.get("icon-image"),M=(I.value.kind!=="constant"||I.value.value instanceof Ar&&!I.value.value.isEmpty()||I.value.value.toString().length>0)&&(b.value.kind!=="constant"||b.value.value.length>0),R=L.value.kind!=="constant"||!!L.value.value||Object.keys(L.parameters).length>0,z=x.get("symbol-sort-key");if(this.features=[],!M&&!R)return;const U=c.iconDependencies,Y=c.glyphDependencies,H=c.availableImages,Q=new Ur(this.zoom);for(const{feature:ut,id:ht,index:Et,sourceLayerIndex:mt}of o){const St=g._featureFilter.needGeometry,Dt=Sd(ut,St);if(!g._featureFilter.filter(Q,Dt,f))continue;let Ht,Ie;if(St||(Dt.geometry=Id(ut)),M){const Ee=g.getValueAndResolveTokens("text-field",Dt,f,H),_e=Ar.factory(Ee);sN(_e)&&(this.hasRTLText=!0),(!this.hasRTLText||Km()==="unavailable"||this.hasRTLText&&Da.isParsed())&&(Ht=$L(_e,g,Dt))}if(R){const Ee=g.getValueAndResolveTokens("icon-image",Dt,f,H);Ie=Ee instanceof oo?Ee:oo.fromString(Ee)}if(!Ht&&!Ie)continue;const Ae=this.sortFeaturesByKey?z.evaluate(Dt,{},f):void 0;if(this.features.push({id:ht,text:Ht,icon:Ie,index:Et,sourceLayerIndex:mt,geometry:Dt.geometry,properties:ut.properties,type:iN[ut.type],sortKey:Ae}),Ie&&(U[Ie.name]=!0),Ht){const Ee=b.evaluate(Dt,{},f).join(","),_e=x.get("text-rotation-alignment")!=="viewport"&&x.get("symbol-placement")!=="point";this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(u.ai.vertical)>=0;for(const ce of Ht.sections)if(ce.image)U[ce.image.name]=!0;else{const Ne=mf(Ht.toString()),pe=ce.fontStack||Ee,re=Y[pe]=Y[pe]||{};this.calculateGlyphDependencies(ce.text,re,_e,this.allowVerticalPlacement,Ne)}}}x.get("symbol-placement")==="line"&&(this.features=function(ut){const ht={},Et={},mt=[];let St=0;function Dt(Ee){mt.push(ut[Ee]),St++}function Ht(Ee,_e,ce){const Ne=Et[Ee];return delete Et[Ee],Et[_e]=Ne,mt[Ne].geometry[0].pop(),mt[Ne].geometry[0]=mt[Ne].geometry[0].concat(ce[0]),Ne}function Ie(Ee,_e,ce){const Ne=ht[_e];return delete ht[_e],ht[Ee]=Ne,mt[Ne].geometry[0].shift(),mt[Ne].geometry[0]=ce[0].concat(mt[Ne].geometry[0]),Ne}function Ae(Ee,_e,ce){const Ne=ce?_e[0][_e[0].length-1]:_e[0][0];return`${Ee}:${Ne.x}:${Ne.y}`}for(let Ee=0;Ee<ut.length;Ee++){const _e=ut[Ee],ce=_e.geometry,Ne=_e.text?_e.text.toString():null;if(!Ne){Dt(Ee);continue}const pe=Ae(Ne,ce),re=Ae(Ne,ce,!0);if(pe in Et&&re in ht&&Et[pe]!==ht[re]){const qe=Ie(pe,re,ce),Re=Ht(pe,re,mt[qe].geometry);delete ht[pe],delete Et[re],Et[Ae(Ne,mt[Re].geometry,!0)]=Re,mt[qe].geometry=null}else pe in Et?Ht(pe,re,ce):re in ht?Ie(pe,re,ce):(Dt(Ee),ht[pe]=St-1,Et[re]=St-1)}return mt.filter(Ee=>Ee.geometry)}(this.features)),this.sortFeaturesByKey&&this.features.sort((ut,ht)=>ut.sortKey-ht.sortKey)}update(o,c,f){this.stateDependentLayers.length&&(this.text.programConfigurations.updatePaintArrays(o,c,this.layers,f),this.icon.programConfigurations.updatePaintArrays(o,c,this.layers,f))}isEmpty(){return this.symbolInstances.length===0&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(o){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(o),this.iconCollisionBox.upload(o)),this.text.upload(o,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload),this.icon.upload(o,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(o,c){const f=this.lineVertexArray.length;if(o.segment!==void 0){let g=o.dist(c[o.segment+1]),x=o.dist(c[o.segment]);const b={};for(let I=o.segment+1;I<c.length;I++)b[I]={x:c[I].x,y:c[I].y,tileUnitDistanceFromAnchor:g},I<c.length-1&&(g+=c[I+1].dist(c[I]));for(let I=o.segment||0;I>=0;I--)b[I]={x:c[I].x,y:c[I].y,tileUnitDistanceFromAnchor:x},I>0&&(x+=c[I-1].dist(c[I]));for(let I=0;I<c.length;I++){const L=b[I];this.lineVertexArray.emplaceBack(L.x,L.y,L.tileUnitDistanceFromAnchor)}}return{lineStartIndex:f,lineLength:this.lineVertexArray.length-f}}addSymbols(o,c,f,g,x,b,I,L,M,R,z,U){const Y=o.indexArray,H=o.layoutVertexArray,Q=o.segments.prepareSegment(4*c.length,H,Y,this.canOverlap?b.sortKey:void 0),ut=this.glyphOffsetArray.length,ht=Q.vertexLength,Et=this.allowVerticalPlacement&&I===u.ai.vertical?Math.PI/2:0,mt=b.text&&b.text.sections;for(let St=0;St<c.length;St++){const{tl:Dt,tr:Ht,bl:Ie,br:Ae,tex:Ee,pixelOffsetTL:_e,pixelOffsetBR:ce,minFontScaleX:Ne,minFontScaleY:pe,glyphOffset:re,isSDF:qe,sectionIndex:Re}=c[St],bn=Q.vertexLength,qr=re[1];nv(H,L.x,L.y,Dt.x,qr+Dt.y,Ee.x,Ee.y,f,qe,_e.x,_e.y,Ne,pe),nv(H,L.x,L.y,Ht.x,qr+Ht.y,Ee.x+Ee.w,Ee.y,f,qe,ce.x,_e.y,Ne,pe),nv(H,L.x,L.y,Ie.x,qr+Ie.y,Ee.x,Ee.y+Ee.h,f,qe,_e.x,ce.y,Ne,pe),nv(H,L.x,L.y,Ae.x,qr+Ae.y,Ee.x+Ee.w,Ee.y+Ee.h,f,qe,ce.x,ce.y,Ne,pe),ax(o.dynamicLayoutVertexArray,L,Et),Y.emplaceBack(bn,bn+1,bn+2),Y.emplaceBack(bn+1,bn+2,bn+3),Q.vertexLength+=4,Q.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(re[0]),St!==c.length-1&&Re===c[St+1].sectionIndex||o.programConfigurations.populatePaintArrays(H.length,b,b.index,{},U,mt&&mt[Re])}o.placedSymbolArray.emplaceBack(L.x,L.y,ut,this.glyphOffsetArray.length-ut,ht,M,R,L.segment,f?f[0]:0,f?f[1]:0,g[0],g[1],I,0,!1,0,z)}_addCollisionDebugVertex(o,c,f,g,x,b){return c.emplaceBack(0,0),o.emplaceBack(f.x,f.y,g,x,Math.round(b.x),Math.round(b.y))}addCollisionDebugVertices(o,c,f,g,x,b,I){const L=x.segments.prepareSegment(4,x.layoutVertexArray,x.indexArray),M=L.vertexLength,R=x.layoutVertexArray,z=x.collisionVertexArray,U=I.anchorX,Y=I.anchorY;this._addCollisionDebugVertex(R,z,b,U,Y,new D(o,c)),this._addCollisionDebugVertex(R,z,b,U,Y,new D(f,c)),this._addCollisionDebugVertex(R,z,b,U,Y,new D(f,g)),this._addCollisionDebugVertex(R,z,b,U,Y,new D(o,g)),L.vertexLength+=4;const H=x.indexArray;H.emplaceBack(M,M+1),H.emplaceBack(M+1,M+2),H.emplaceBack(M+2,M+3),H.emplaceBack(M+3,M),L.primitiveLength+=4}addDebugCollisionBoxes(o,c,f,g){for(let x=o;x<c;x++){const b=this.collisionBoxArray.get(x);this.addCollisionDebugVertices(b.x1,b.y1,b.x2,b.y2,g?this.textCollisionBox:this.iconCollisionBox,b.anchorPoint,f)}}generateCollisionDebugBuffers(){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new lx(Pi,Hw.members,co),this.iconCollisionBox=new lx(Pi,Hw.members,co);for(let o=0;o<this.symbolInstances.length;o++){const c=this.symbolInstances.get(o);this.addDebugCollisionBoxes(c.textBoxStartIndex,c.textBoxEndIndex,c,!0),this.addDebugCollisionBoxes(c.verticalTextBoxStartIndex,c.verticalTextBoxEndIndex,c,!0),this.addDebugCollisionBoxes(c.iconBoxStartIndex,c.iconBoxEndIndex,c,!1),this.addDebugCollisionBoxes(c.verticalIconBoxStartIndex,c.verticalIconBoxEndIndex,c,!1)}}_deserializeCollisionBoxesForSymbol(o,c,f,g,x,b,I,L,M){const R={};for(let z=c;z<f;z++){const U=o.get(z);R.textBox={x1:U.x1,y1:U.y1,x2:U.x2,y2:U.y2,anchorPointX:U.anchorPointX,anchorPointY:U.anchorPointY},R.textFeatureIndex=U.featureIndex;break}for(let z=g;z<x;z++){const U=o.get(z);R.verticalTextBox={x1:U.x1,y1:U.y1,x2:U.x2,y2:U.y2,anchorPointX:U.anchorPointX,anchorPointY:U.anchorPointY},R.verticalTextFeatureIndex=U.featureIndex;break}for(let z=b;z<I;z++){const U=o.get(z);R.iconBox={x1:U.x1,y1:U.y1,x2:U.x2,y2:U.y2,anchorPointX:U.anchorPointX,anchorPointY:U.anchorPointY},R.iconFeatureIndex=U.featureIndex;break}for(let z=L;z<M;z++){const U=o.get(z);R.verticalIconBox={x1:U.x1,y1:U.y1,x2:U.x2,y2:U.y2,anchorPointX:U.anchorPointX,anchorPointY:U.anchorPointY},R.verticalIconFeatureIndex=U.featureIndex;break}return R}deserializeCollisionBoxes(o){this.collisionArrays=[];for(let c=0;c<this.symbolInstances.length;c++){const f=this.symbolInstances.get(c);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(o,f.textBoxStartIndex,f.textBoxEndIndex,f.verticalTextBoxStartIndex,f.verticalTextBoxEndIndex,f.iconBoxStartIndex,f.iconBoxEndIndex,f.verticalIconBoxStartIndex,f.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}addIndicesForPlacedSymbol(o,c){const f=o.placedSymbolArray.get(c),g=f.vertexStartIndex+4*f.numGlyphs;for(let x=f.vertexStartIndex;x<g;x+=4)o.indexArray.emplaceBack(x,x+1,x+2),o.indexArray.emplaceBack(x+1,x+2,x+3)}getSortedSymbolIndexes(o){if(this.sortedAngle===o&&this.symbolInstanceIndexes!==void 0)return this.symbolInstanceIndexes;const c=Math.sin(o),f=Math.cos(o),g=[],x=[],b=[];for(let I=0;I<this.symbolInstances.length;++I){b.push(I);const L=this.symbolInstances.get(I);g.push(0|Math.round(c*L.anchorX+f*L.anchorY)),x.push(L.featureIndex)}return b.sort((I,L)=>g[I]-g[L]||x[L]-x[I]),b}addToSortKeyRanges(o,c){const f=this.sortKeyRanges[this.sortKeyRanges.length-1];f&&f.sortKey===c?f.symbolInstanceEnd=o+1:this.sortKeyRanges.push({sortKey:c,symbolInstanceStart:o,symbolInstanceEnd:o+1})}sortFeatures(o){if(this.sortFeaturesByY&&this.sortedAngle!==o&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(o),this.sortedAngle=o,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const c of this.symbolInstanceIndexes){const f=this.symbolInstances.get(c);this.featureSortOrder.push(f.featureIndex),[f.rightJustifiedTextSymbolIndex,f.centerJustifiedTextSymbolIndex,f.leftJustifiedTextSymbolIndex].forEach((g,x,b)=>{g>=0&&b.indexOf(g)===x&&this.addIndicesForPlacedSymbol(this.text,g)}),f.verticalPlacedTextSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.text,f.verticalPlacedTextSymbolIndex),f.placedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,f.placedIconSymbolIndex),f.verticalPlacedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,f.verticalPlacedIconSymbolIndex)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}let p1,f1;ve("SymbolBucket",Og,{omit:["layers","collisionBoxArray","features","compareText"]}),Og.MAX_GLYPHS=65535,Og.addDynamicAttributes=ax;var cx={get paint(){return f1=f1||new Gi({"icon-opacity":new Ze(Vt.paint_symbol["icon-opacity"]),"icon-color":new Ze(Vt.paint_symbol["icon-color"]),"icon-halo-color":new Ze(Vt.paint_symbol["icon-halo-color"]),"icon-halo-width":new Ze(Vt.paint_symbol["icon-halo-width"]),"icon-halo-blur":new Ze(Vt.paint_symbol["icon-halo-blur"]),"icon-translate":new ze(Vt.paint_symbol["icon-translate"]),"icon-translate-anchor":new ze(Vt.paint_symbol["icon-translate-anchor"]),"text-opacity":new Ze(Vt.paint_symbol["text-opacity"]),"text-color":new Ze(Vt.paint_symbol["text-color"],{runtimeType:ro,getOverride:l=>l.textColor,hasOverride:l=>!!l.textColor}),"text-halo-color":new Ze(Vt.paint_symbol["text-halo-color"]),"text-halo-width":new Ze(Vt.paint_symbol["text-halo-width"]),"text-halo-blur":new Ze(Vt.paint_symbol["text-halo-blur"]),"text-translate":new ze(Vt.paint_symbol["text-translate"]),"text-translate-anchor":new ze(Vt.paint_symbol["text-translate-anchor"])})},get layout(){return p1=p1||new Gi({"symbol-placement":new ze(Vt.layout_symbol["symbol-placement"]),"symbol-spacing":new ze(Vt.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new ze(Vt.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new Ze(Vt.layout_symbol["symbol-sort-key"]),"symbol-z-order":new ze(Vt.layout_symbol["symbol-z-order"]),"icon-allow-overlap":new ze(Vt.layout_symbol["icon-allow-overlap"]),"icon-overlap":new ze(Vt.layout_symbol["icon-overlap"]),"icon-ignore-placement":new ze(Vt.layout_symbol["icon-ignore-placement"]),"icon-optional":new ze(Vt.layout_symbol["icon-optional"]),"icon-rotation-alignment":new ze(Vt.layout_symbol["icon-rotation-alignment"]),"icon-size":new Ze(Vt.layout_symbol["icon-size"]),"icon-text-fit":new ze(Vt.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new ze(Vt.layout_symbol["icon-text-fit-padding"]),"icon-image":new Ze(Vt.layout_symbol["icon-image"]),"icon-rotate":new Ze(Vt.layout_symbol["icon-rotate"]),"icon-padding":new Ze(Vt.layout_symbol["icon-padding"]),"icon-keep-upright":new ze(Vt.layout_symbol["icon-keep-upright"]),"icon-offset":new Ze(Vt.layout_symbol["icon-offset"]),"icon-anchor":new Ze(Vt.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new ze(Vt.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new ze(Vt.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new ze(Vt.layout_symbol["text-rotation-alignment"]),"text-field":new Ze(Vt.layout_symbol["text-field"]),"text-font":new Ze(Vt.layout_symbol["text-font"]),"text-size":new Ze(Vt.layout_symbol["text-size"]),"text-max-width":new Ze(Vt.layout_symbol["text-max-width"]),"text-line-height":new ze(Vt.layout_symbol["text-line-height"]),"text-letter-spacing":new Ze(Vt.layout_symbol["text-letter-spacing"]),"text-justify":new Ze(Vt.layout_symbol["text-justify"]),"text-radial-offset":new Ze(Vt.layout_symbol["text-radial-offset"]),"text-variable-anchor":new ze(Vt.layout_symbol["text-variable-anchor"]),"text-variable-anchor-offset":new Ze(Vt.layout_symbol["text-variable-anchor-offset"]),"text-anchor":new Ze(Vt.layout_symbol["text-anchor"]),"text-max-angle":new ze(Vt.layout_symbol["text-max-angle"]),"text-writing-mode":new ze(Vt.layout_symbol["text-writing-mode"]),"text-rotate":new Ze(Vt.layout_symbol["text-rotate"]),"text-padding":new ze(Vt.layout_symbol["text-padding"]),"text-keep-upright":new ze(Vt.layout_symbol["text-keep-upright"]),"text-transform":new Ze(Vt.layout_symbol["text-transform"]),"text-offset":new Ze(Vt.layout_symbol["text-offset"]),"text-allow-overlap":new ze(Vt.layout_symbol["text-allow-overlap"]),"text-overlap":new ze(Vt.layout_symbol["text-overlap"]),"text-ignore-placement":new ze(Vt.layout_symbol["text-ignore-placement"]),"text-optional":new ze(Vt.layout_symbol["text-optional"])})}};class d1{constructor(o){if(o.property.overrides===void 0)throw new Error("overrides must be provided to instantiate FormatSectionOverride class");this.type=o.property.overrides?o.property.overrides.runtimeType:Co,this.defaultValue=o}evaluate(o){if(o.formattedSection){const c=this.defaultValue.property.overrides;if(c&&c.hasOverride(o.formattedSection))return c.getOverride(o.formattedSection)}return o.feature&&o.featureState?this.defaultValue.evaluate(o.feature,o.featureState):this.defaultValue.property.specification.default}eachChild(o){this.defaultValue.isConstant()||o(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}ve("FormatSectionOverride",d1,{omit:["defaultValue"]});class rv extends cu{constructor(o){super(o,cx)}recalculate(o,c){if(super.recalculate(o,c),this.layout.get("icon-rotation-alignment")==="auto"&&(this.layout._values["icon-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-rotation-alignment")==="auto"&&(this.layout._values["text-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-pitch-alignment")==="auto"&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")==="map"?"map":"viewport"),this.layout.get("icon-pitch-alignment")==="auto"&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment")),this.layout.get("symbol-placement")==="point"){const f=this.layout.get("text-writing-mode");if(f){const g=[];for(const x of f)g.indexOf(x)<0&&g.push(x);this.layout._values["text-writing-mode"]=g}else this.layout._values["text-writing-mode"]=["horizontal"]}this._setPaintOverrides()}getValueAndResolveTokens(o,c,f,g){const x=this.layout.get(o).evaluate(c,{},f,g),b=this._unevaluatedLayout._values[o];return b.isDataDriven()||Pa(b.value)||!x?x:function(I,L){return L.replace(/{([^{}]+)}/g,(M,R)=>I&&R in I?String(I[R]):"")}(c.properties,x)}createBucket(o){return new Og(o)}queryRadius(){return 0}queryIntersectsFeature(){throw new Error("Should take a different path in FeatureIndex")}_setPaintOverrides(){for(const o of cx.paint.overridableProperties){if(!rv.hasPaintOverride(this.layout,o))continue;const c=this.paint.get(o),f=new d1(c),g=new sh(f,c.property.specification);let x=null;x=c.value.kind==="constant"||c.value.kind==="source"?new ah("source",g):new bl("composite",g,c.value.zoomStops),this.paint._values[o]=new Vs(c.property,x,c.parameters)}}_handleOverridablePaintPropertyUpdate(o,c,f){return!(!this.layout||c.isDataDriven()||f.isDataDriven())&&rv.hasPaintOverride(this.layout,o)}static hasPaintOverride(o,c){const f=o.get("text-field"),g=cx.paint.properties[c];let x=!1;const b=I=>{for(const L of I)if(g.overrides&&g.overrides.hasOverride(L))return void(x=!0)};if(f.value.kind==="constant"&&f.value.value instanceof Ar)b(f.value.value.sections);else if(f.value.kind==="source"){const I=M=>{x||(M instanceof Du&&Fr(M.value)===ot?b(M.value.sections):M instanceof Kh?b(M.sections):M.eachChild(I))},L=f.value;L._styleExpression&&I(L._styleExpression.expression)}return x}}let g1;var aN={get paint(){return g1=g1||new Gi({"background-color":new ze(Vt.paint_background["background-color"]),"background-pattern":new ty(Vt.paint_background["background-pattern"]),"background-opacity":new ze(Vt.paint_background["background-opacity"])})}};class uN extends cu{constructor(o){super(o,aN)}}let m1;var lN={get paint(){return m1=m1||new Gi({"raster-opacity":new ze(Vt.paint_raster["raster-opacity"]),"raster-hue-rotate":new ze(Vt.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new ze(Vt.paint_raster["raster-brightness-min"]),"raster-brightness-max":new ze(Vt.paint_raster["raster-brightness-max"]),"raster-saturation":new ze(Vt.paint_raster["raster-saturation"]),"raster-contrast":new ze(Vt.paint_raster["raster-contrast"]),"raster-resampling":new ze(Vt.paint_raster["raster-resampling"]),"raster-fade-duration":new ze(Vt.paint_raster["raster-fade-duration"])})}};class cN extends cu{constructor(o){super(o,lN)}}class hN extends cu{constructor(o){super(o,{}),this.onAdd=c=>{this.implementation.onAdd&&this.implementation.onAdd(c,c.painter.context.gl)},this.onRemove=c=>{this.implementation.onRemove&&this.implementation.onRemove(c,c.painter.context.gl)},this.implementation=o}is3D(){return this.implementation.renderingMode==="3d"}hasOffscreenPass(){return this.implementation.prerender!==void 0}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){throw new Error("Custom layers cannot be serialized")}}class pN{constructor(o){this._callback=o,this._triggered=!1,typeof MessageChannel<"u"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._callback()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(()=>{this._triggered=!1,this._callback()},0))}remove(){delete this._channel,this._callback=()=>{}}}const hx=63710088e-1;class If{constructor(o,c){if(isNaN(o)||isNaN(c))throw new Error(`Invalid LngLat object: (${o}, ${c})`);if(this.lng=+o,this.lat=+c,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new If(Ot(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(o){const c=Math.PI/180,f=this.lat*c,g=o.lat*c,x=Math.sin(f)*Math.sin(g)+Math.cos(f)*Math.cos(g)*Math.cos((o.lng-this.lng)*c);return hx*Math.acos(Math.min(x,1))}static convert(o){if(o instanceof If)return o;if(Array.isArray(o)&&(o.length===2||o.length===3))return new If(Number(o[0]),Number(o[1]));if(!Array.isArray(o)&&typeof o=="object"&&o!==null)return new If(Number("lng"in o?o.lng:o.lon),Number(o.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}const y1=2*Math.PI*hx;function _1(l){return y1*Math.cos(l*Math.PI/180)}function v1(l){return(180+l)/360}function x1(l){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+l*Math.PI/360)))/360}function b1(l,o){return l/_1(o)}function w1(l){return 360*l-180}function px(l){return 360/Math.PI*Math.atan(Math.exp((180-360*l)*Math.PI/180))-90}class iv{constructor(o,c,f=0){this.x=+o,this.y=+c,this.z=+f}static fromLngLat(o,c=0){const f=If.convert(o);return new iv(v1(f.lng),x1(f.lat),b1(c,f.lat))}toLngLat(){return new If(w1(this.x),px(this.y))}toAltitude(){return this.z*_1(px(this.y))}meterInMercatorCoordinateUnits(){return 1/y1*(o=px(this.y),1/Math.cos(o*Math.PI/180));var o}}function E1(l,o,c){var f=2*Math.PI*6378137/256/Math.pow(2,c);return[l*f-2*Math.PI*6378137/2,o*f-2*Math.PI*6378137/2]}class fx{constructor(o,c,f){if(o<0||o>25||f<0||f>=Math.pow(2,o)||c<0||c>=Math.pow(2,o))throw new Error(`x=${c}, y=${f}, z=${o} outside of bounds. 0<=x<${Math.pow(2,o)}, 0<=y<${Math.pow(2,o)} 0<=z<=25 `);this.z=o,this.x=c,this.y=f,this.key=wy(0,o,o,c,f)}equals(o){return this.z===o.z&&this.x===o.x&&this.y===o.y}url(o,c,f){const g=(b=this.y,I=this.z,L=E1(256*(x=this.x),256*(b=Math.pow(2,I)-b-1),I),M=E1(256*(x+1),256*(b+1),I),L[0]+","+L[1]+","+M[0]+","+M[1]);var x,b,I,L,M;const R=function(z,U,Y){let H,Q="";for(let ut=z;ut>0;ut--)H=1<<ut-1,Q+=(U&H?1:0)+(Y&H?2:0);return Q}(this.z,this.x,this.y);return o[(this.x+this.y)%o.length].replace(/{prefix}/g,(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String(f==="tms"?Math.pow(2,this.z)-this.y-1:this.y)).replace(/{ratio}/g,c>1?"@2x":"").replace(/{quadkey}/g,R).replace(/{bbox-epsg-3857}/g,g)}isChildOf(o){const c=this.z-o.z;return c>0&&o.x===this.x>>c&&o.y===this.y>>c}getTilePoint(o){const c=Math.pow(2,this.z);return new D((o.x*c-this.x)*so,(o.y*c-this.y)*so)}toString(){return`${this.z}/${this.x}/${this.y}`}}class I1{constructor(o,c){this.wrap=o,this.canonical=c,this.key=wy(o,c.z,c.z,c.x,c.y)}}class $u{constructor(o,c,f,g,x){if(o<f)throw new Error(`overscaledZ should be >= z; overscaledZ = ${o}; z = ${f}`);this.overscaledZ=o,this.wrap=c,this.canonical=new fx(f,+g,+x),this.key=wy(c,o,f,g,x)}clone(){return new $u(this.overscaledZ,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)}equals(o){return this.overscaledZ===o.overscaledZ&&this.wrap===o.wrap&&this.canonical.equals(o.canonical)}scaledTo(o){if(o>this.overscaledZ)throw new Error(`targetZ > this.overscaledZ; targetZ = ${o}; overscaledZ = ${this.overscaledZ}`);const c=this.canonical.z-o;return o>this.canonical.z?new $u(o,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new $u(o,this.wrap,o,this.canonical.x>>c,this.canonical.y>>c)}calculateScaledKey(o,c){if(o>this.overscaledZ)throw new Error(`targetZ > this.overscaledZ; targetZ = ${o}; overscaledZ = ${this.overscaledZ}`);const f=this.canonical.z-o;return o>this.canonical.z?wy(this.wrap*+c,o,this.canonical.z,this.canonical.x,this.canonical.y):wy(this.wrap*+c,o,o,this.canonical.x>>f,this.canonical.y>>f)}isChildOf(o){if(o.wrap!==this.wrap)return!1;const c=this.canonical.z-o.canonical.z;return o.overscaledZ===0||o.overscaledZ<this.overscaledZ&&o.canonical.x===this.canonical.x>>c&&o.canonical.y===this.canonical.y>>c}children(o){if(this.overscaledZ>=o)return[new $u(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];const c=this.canonical.z+1,f=2*this.canonical.x,g=2*this.canonical.y;return[new $u(c,this.wrap,c,f,g),new $u(c,this.wrap,c,f+1,g),new $u(c,this.wrap,c,f,g+1),new $u(c,this.wrap,c,f+1,g+1)]}isLessThan(o){return this.wrap<o.wrap||!(this.wrap>o.wrap)&&(this.overscaledZ<o.overscaledZ||!(this.overscaledZ>o.overscaledZ)&&(this.canonical.x<o.canonical.x||!(this.canonical.x>o.canonical.x)&&this.canonical.y<o.canonical.y))}wrapped(){return new $u(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(o){return new $u(this.overscaledZ,o,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new I1(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}getTilePoint(o){return this.canonical.getTilePoint(new iv(o.x-this.wrap,o.y))}}function wy(l,o,c,f,g){(l*=2)<0&&(l=-1*l-1);const x=1<<c;return(x*x*l+x*g+f).toString(36)+c.toString(36)+o.toString(36)}ve("CanonicalTileID",fx),ve("OverscaledTileID",$u,{omit:["posMatrix"]});class S1{constructor(o,c,f,g=1,x=1,b=1,I=0){if(this.uid=o,c.height!==c.width)throw new RangeError("DEM tiles must be square");if(f&&!["mapbox","terrarium","custom"].includes(f))return void vt(`"${f}" is not a valid encoding type. Valid types include "mapbox", "terrarium" and "custom".`);this.stride=c.height;const L=this.dim=c.height-2;switch(this.data=new Uint32Array(c.data.buffer),f){case"terrarium":this.redFactor=256,this.greenFactor=1,this.blueFactor=1/256,this.baseShift=32768;break;case"custom":this.redFactor=g,this.greenFactor=x,this.blueFactor=b,this.baseShift=I;break;default:this.redFactor=6553.6,this.greenFactor=25.6,this.blueFactor=.1,this.baseShift=1e4}for(let M=0;M<L;M++)this.data[this._idx(-1,M)]=this.data[this._idx(0,M)],this.data[this._idx(L,M)]=this.data[this._idx(L-1,M)],this.data[this._idx(M,-1)]=this.data[this._idx(M,0)],this.data[this._idx(M,L)]=this.data[this._idx(M,L-1)];this.data[this._idx(-1,-1)]=this.data[this._idx(0,0)],this.data[this._idx(L,-1)]=this.data[this._idx(L-1,0)],this.data[this._idx(-1,L)]=this.data[this._idx(0,L-1)],this.data[this._idx(L,L)]=this.data[this._idx(L-1,L-1)],this.min=Number.MAX_SAFE_INTEGER,this.max=Number.MIN_SAFE_INTEGER;for(let M=0;M<L;M++)for(let R=0;R<L;R++){const z=this.get(M,R);z>this.max&&(this.max=z),z<this.min&&(this.min=z)}}get(o,c){const f=new Uint8Array(this.data.buffer),g=4*this._idx(o,c);return this.unpack(f[g],f[g+1],f[g+2])}getUnpackVector(){return[this.redFactor,this.greenFactor,this.blueFactor,this.baseShift]}_idx(o,c){if(o<-1||o>=this.dim+1||c<-1||c>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(c+1)*this.stride+(o+1)}unpack(o,c,f){return o*this.redFactor+c*this.greenFactor+f*this.blueFactor-this.baseShift}getPixels(){return new Bu({width:this.stride,height:this.stride},new Uint8Array(this.data.buffer))}backfillBorder(o,c,f){if(this.dim!==o.dim)throw new Error("dem dimension mismatch");let g=c*this.dim,x=c*this.dim+this.dim,b=f*this.dim,I=f*this.dim+this.dim;switch(c){case-1:g=x-1;break;case 1:x=g+1}switch(f){case-1:b=I-1;break;case 1:I=b+1}const L=-c*this.dim,M=-f*this.dim;for(let R=b;R<I;R++)for(let z=g;z<x;z++)this.data[this._idx(z,R)]=o.data[this._idx(z+L,R+M)]}}ve("DEMData",S1);class C1{constructor(o){this._stringToNumber={},this._numberToString=[];for(let c=0;c<o.length;c++){const f=o[c];this._stringToNumber[f]=c,this._numberToString[c]=f}}encode(o){return this._stringToNumber[o]}decode(o){if(o>=this._numberToString.length)throw new Error(`Out of bounds. Index requested n=${o} can't be >= this._numberToString.length ${this._numberToString.length}`);return this._numberToString[o]}}class T1{constructor(o,c,f,g,x){this.type="Feature",this._vectorTileFeature=o,o._z=c,o._x=f,o._y=g,this.properties=o.properties,this.id=x}get geometry(){return this._geometry===void 0&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._vectorTileFeature._x,this._vectorTileFeature._y,this._vectorTileFeature._z).geometry),this._geometry}set geometry(o){this._geometry=o}toJSON(){const o={geometry:this.geometry};for(const c in this)c!=="_geometry"&&c!=="_vectorTileFeature"&&(o[c]=this[c]);return o}}class L1{constructor(o,c){this.tileID=o,this.x=o.canonical.x,this.y=o.canonical.y,this.z=o.canonical.z,this.grid=new Il(so,16,0),this.grid3D=new Il(so,16,0),this.featureIndexArray=new Jt,this.promoteId=c}insert(o,c,f,g,x,b){const I=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(f,g,x);const L=b?this.grid3D:this.grid;for(let M=0;M<c.length;M++){const R=c[M],z=[1/0,1/0,-1/0,-1/0];for(let U=0;U<R.length;U++){const Y=R[U];z[0]=Math.min(z[0],Y.x),z[1]=Math.min(z[1],Y.y),z[2]=Math.max(z[2],Y.x),z[3]=Math.max(z[3],Y.y)}z[0]<so&&z[1]<so&&z[2]>=0&&z[3]>=0&&L.insert(I,z[0],z[1],z[2],z[3])}}loadVTLayers(){return this.vtLayers||(this.vtLayers=new bf.VectorTile(new ex(this.rawTileData)).layers,this.sourceLayerCoder=new C1(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"])),this.vtLayers}query(o,c,f,g){this.loadVTLayers();const x=o.params||{},b=so/o.tileSize/o.scale,I=cf(x.filter),L=o.queryGeometry,M=o.queryPadding*b,R=P1(L),z=this.grid.query(R.minX-M,R.minY-M,R.maxX+M,R.maxY+M),U=P1(o.cameraQueryGeometry),Y=this.grid3D.query(U.minX-M,U.minY-M,U.maxX+M,U.maxY+M,(ut,ht,Et,mt)=>function(St,Dt,Ht,Ie,Ae){for(const _e of St)if(Dt<=_e.x&&Ht<=_e.y&&Ie>=_e.x&&Ae>=_e.y)return!0;const Ee=[new D(Dt,Ht),new D(Dt,Ae),new D(Ie,Ae),new D(Ie,Ht)];if(St.length>2){for(const _e of Ee)if(Lg(St,_e))return!0}for(let _e=0;_e<St.length-1;_e++)if(GT(St[_e],St[_e+1],Ee))return!0;return!1}(o.cameraQueryGeometry,ut-M,ht-M,Et+M,mt+M));for(const ut of Y)z.push(ut);z.sort(fN);const H={};let Q;for(let ut=0;ut<z.length;ut++){const ht=z[ut];if(ht===Q)continue;Q=ht;const Et=this.featureIndexArray.get(ht);let mt=null;this.loadMatchingFeature(H,Et.bucketIndex,Et.sourceLayerIndex,Et.featureIndex,I,x.layers,x.availableImages,c,f,g,(St,Dt,Ht)=>(mt||(mt=Id(St)),Dt.queryIntersectsFeature(L,St,Ht,mt,this.z,o.transform,b,o.pixelPosMatrix)))}return H}loadMatchingFeature(o,c,f,g,x,b,I,L,M,R,z){const U=this.bucketLayerIDs[c];if(b&&!function(ut,ht){for(let Et=0;Et<ut.length;Et++)if(ht.indexOf(ut[Et])>=0)return!0;return!1}(b,U))return;const Y=this.sourceLayerCoder.decode(f),H=this.vtLayers[Y].feature(g);if(x.needGeometry){const ut=Sd(H,!0);if(!x.filter(new Ur(this.tileID.overscaledZ),ut,this.tileID.canonical))return}else if(!x.filter(new Ur(this.tileID.overscaledZ),H))return;const Q=this.getId(H,Y);for(let ut=0;ut<U.length;ut++){const ht=U[ut];if(b&&b.indexOf(ht)<0)continue;const Et=L[ht];if(!Et)continue;let mt={};Q&&R&&(mt=R.getState(Et.sourceLayer||"_geojsonTileLayer",Q));const St=At({},M[ht]);St.paint=N1(St.paint,Et.paint,H,mt,I),St.layout=N1(St.layout,Et.layout,H,mt,I);const Dt=!z||z(H,Et,mt);if(!Dt)continue;const Ht=new T1(H,this.z,this.x,this.y,Q);Ht.layer=St;let Ie=o[ht];Ie===void 0&&(Ie=o[ht]=[]),Ie.push({featureIndex:g,feature:Ht,intersectionZ:Dt})}}lookupSymbolFeatures(o,c,f,g,x,b,I,L){const M={};this.loadVTLayers();const R=cf(x);for(const z of o)this.loadMatchingFeature(M,f,g,z,R,b,I,L,c);return M}hasLayer(o){for(const c of this.bucketLayerIDs)for(const f of c)if(o===f)return!0;return!1}getId(o,c){let f=o.id;return this.promoteId&&(f=o.properties[typeof this.promoteId=="string"?this.promoteId:this.promoteId[c]],typeof f=="boolean"&&(f=Number(f))),f}}function N1(l,o,c,f,g){return Yt(l,(x,b)=>{const I=o instanceof Cg?o.get(b):null;return I&&I.evaluate?I.evaluate(c,f,g):I})}function P1(l){let o=1/0,c=1/0,f=-1/0,g=-1/0;for(const x of l)o=Math.min(o,x.x),c=Math.min(c,x.y),f=Math.max(f,x.x),g=Math.max(g,x.y);return{minX:o,minY:c,maxX:f,maxY:g}}function fN(l,o){return o-l}function M1(l,o,c,f,g){const x=[];for(let b=0;b<l.length;b++){const I=l[b];let L;for(let M=0;M<I.length-1;M++){let R=I[M],z=I[M+1];R.x<o&&z.x<o||(R.x<o?R=new D(o,R.y+(o-R.x)/(z.x-R.x)*(z.y-R.y))._round():z.x<o&&(z=new D(o,R.y+(o-R.x)/(z.x-R.x)*(z.y-R.y))._round()),R.y<c&&z.y<c||(R.y<c?R=new D(R.x+(c-R.y)/(z.y-R.y)*(z.x-R.x),c)._round():z.y<c&&(z=new D(R.x+(c-R.y)/(z.y-R.y)*(z.x-R.x),c)._round()),R.x>=f&&z.x>=f||(R.x>=f?R=new D(f,R.y+(f-R.x)/(z.x-R.x)*(z.y-R.y))._round():z.x>=f&&(z=new D(f,R.y+(f-R.x)/(z.x-R.x)*(z.y-R.y))._round()),R.y>=g&&z.y>=g||(R.y>=g?R=new D(R.x+(g-R.y)/(z.y-R.y)*(z.x-R.x),g)._round():z.y>=g&&(z=new D(R.x+(g-R.y)/(z.y-R.y)*(z.x-R.x),g)._round()),L&&R.equals(L[L.length-1])||(L=[R],x.push(L)),L.push(z)))))}}return x}ve("FeatureIndex",L1,{omit:["rawTileData","sourceLayerCoder"]});class Sf extends D{constructor(o,c,f,g){super(o,c),this.angle=f,g!==void 0&&(this.segment=g)}clone(){return new Sf(this.x,this.y,this.angle,this.segment)}}function A1(l,o,c,f,g){if(o.segment===void 0||c===0)return!0;let x=o,b=o.segment+1,I=0;for(;I>-c/2;){if(b--,b<0)return!1;I-=l[b].dist(x),x=l[b]}I+=l[b].dist(l[b+1]),b++;const L=[];let M=0;for(;I<c/2;){const R=l[b],z=l[b+1];if(!z)return!1;let U=l[b-1].angleTo(R)-R.angleTo(z);for(U=Math.abs((U+3*Math.PI)%(2*Math.PI)-Math.PI),L.push({distance:I,angleDelta:U}),M+=U;I-L[0].distance>f;)M-=L.shift().angleDelta;if(M>g)return!1;b++,I+=R.dist(z)}return!0}function D1(l){let o=0;for(let c=0;c<l.length-1;c++)o+=l[c].dist(l[c+1]);return o}function O1(l,o,c){return l?.6*o*c:0}function R1(l,o){return Math.max(l?l.right-l.left:0,o?o.right-o.left:0)}function dN(l,o,c,f,g,x){const b=O1(c,g,x),I=R1(c,f)*x;let L=0;const M=D1(l)/2;for(let R=0;R<l.length-1;R++){const z=l[R],U=l[R+1],Y=z.dist(U);if(L+Y>M){const H=(M-L)/Y,Q=Xo.number(z.x,U.x,H),ut=Xo.number(z.y,U.y,H),ht=new Sf(Q,ut,U.angleTo(z),R);return ht._round(),!b||A1(l,ht,I,b,o)?ht:void 0}L+=Y}}function gN(l,o,c,f,g,x,b,I,L){const M=O1(f,x,b),R=R1(f,g),z=R*b,U=l[0].x===0||l[0].x===L||l[0].y===0||l[0].y===L;return o-z<o/4&&(o=z+o/4),F1(l,U?o/2*I%o:(R/2+2*x)*b*I%o,o,M,c,z,U,!1,L)}function F1(l,o,c,f,g,x,b,I,L){const M=x/2,R=D1(l);let z=0,U=o-c,Y=[];for(let H=0;H<l.length-1;H++){const Q=l[H],ut=l[H+1],ht=Q.dist(ut),Et=ut.angleTo(Q);for(;U+c<z+ht;){U+=c;const mt=(U-z)/ht,St=Xo.number(Q.x,ut.x,mt),Dt=Xo.number(Q.y,ut.y,mt);if(St>=0&&St<L&&Dt>=0&&Dt<L&&U-M>=0&&U+M<=R){const Ht=new Sf(St,Dt,Et,H);Ht._round(),f&&!A1(l,Ht,x,f,g)||Y.push(Ht)}}z+=ht}return I||Y.length||b||(Y=F1(l,z/2,c,f,g,x,b,!0,L)),Y}ve("Anchor",Sf);const Rg=Ra;function k1(l,o,c,f){const g=[],x=l.image,b=x.pixelRatio,I=x.paddedRect.w-2*Rg,L=x.paddedRect.h-2*Rg,M=l.right-l.left,R=l.bottom-l.top,z=x.stretchX||[[0,I]],U=x.stretchY||[[0,L]],Y=(ce,Ne)=>ce+Ne[1]-Ne[0],H=z.reduce(Y,0),Q=U.reduce(Y,0),ut=I-H,ht=L-Q;let Et=0,mt=H,St=0,Dt=Q,Ht=0,Ie=ut,Ae=0,Ee=ht;if(x.content&&f){const ce=x.content;Et=ov(z,0,ce[0]),St=ov(U,0,ce[1]),mt=ov(z,ce[0],ce[2]),Dt=ov(U,ce[1],ce[3]),Ht=ce[0]-Et,Ae=ce[1]-St,Ie=ce[2]-ce[0]-mt,Ee=ce[3]-ce[1]-Dt}const _e=(ce,Ne,pe,re)=>{const qe=sv(ce.stretch-Et,mt,M,l.left),Re=av(ce.fixed-Ht,Ie,ce.stretch,H),bn=sv(Ne.stretch-St,Dt,R,l.top),qr=av(Ne.fixed-Ae,Ee,Ne.stretch,Q),Wr=sv(pe.stretch-Et,mt,M,l.left),fo=av(pe.fixed-Ht,Ie,pe.stretch,H),pu=sv(re.stretch-St,Dt,R,l.top),ha=av(re.fixed-Ae,Ee,re.stretch,Q),ao=new D(qe,bn),Wo=new D(Wr,bn),gs=new D(Wr,pu),pa=new D(qe,pu),fa=new D(Re/b,qr/b),go=new D(fo/b,ha/b),mo=o*Math.PI/180;if(mo){const qs=Math.sin(mo),Fa=Math.cos(mo),ka=[Fa,-qs,qs,Fa];ao._matMult(ka),Wo._matMult(ka),pa._matMult(ka),gs._matMult(ka)}const Gs=ce.stretch+ce.fixed,da=Ne.stretch+Ne.fixed;return{tl:ao,tr:Wo,bl:pa,br:gs,tex:{x:x.paddedRect.x+Rg+Gs,y:x.paddedRect.y+Rg+da,w:pe.stretch+pe.fixed-Gs,h:re.stretch+re.fixed-da},writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:fa,pixelOffsetBR:go,minFontScaleX:Ie/b/M,minFontScaleY:Ee/b/R,isSDF:c}};if(f&&(x.stretchX||x.stretchY)){const ce=z1(z,ut,H),Ne=z1(U,ht,Q);for(let pe=0;pe<ce.length-1;pe++){const re=ce[pe],qe=ce[pe+1];for(let Re=0;Re<Ne.length-1;Re++)g.push(_e(re,Ne[Re],qe,Ne[Re+1]))}}else g.push(_e({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:I+1},{fixed:0,stretch:L+1}));return g}function ov(l,o,c){let f=0;for(const g of l)f+=Math.max(o,Math.min(c,g[1]))-Math.max(o,Math.min(c,g[0]));return f}function z1(l,o,c){const f=[{fixed:-Rg,stretch:0}];for(const[g,x]of l){const b=f[f.length-1];f.push({fixed:g-b.stretch,stretch:b.stretch}),f.push({fixed:g-b.stretch,stretch:b.stretch+(x-g)})}return f.push({fixed:o+Rg,stretch:c}),f}function sv(l,o,c,f){return l/o*c+f}function av(l,o,c,f){return l-o*c/f}class uv{constructor(o,c,f,g,x,b,I,L,M,R){if(this.boxStartIndex=o.length,M){let z=b.top,U=b.bottom;const Y=b.collisionPadding;Y&&(z-=Y[1],U+=Y[3]);let H=U-z;H>0&&(H=Math.max(10,H),this.circleDiameter=H)}else{let z=b.top*I-L[0],U=b.bottom*I+L[2],Y=b.left*I-L[3],H=b.right*I+L[1];const Q=b.collisionPadding;if(Q&&(Y-=Q[0]*I,z-=Q[1]*I,H+=Q[2]*I,U+=Q[3]*I),R){const ut=new D(Y,z),ht=new D(H,z),Et=new D(Y,U),mt=new D(H,U),St=R*Math.PI/180;ut._rotate(St),ht._rotate(St),Et._rotate(St),mt._rotate(St),Y=Math.min(ut.x,ht.x,Et.x,mt.x),H=Math.max(ut.x,ht.x,Et.x,mt.x),z=Math.min(ut.y,ht.y,Et.y,mt.y),U=Math.max(ut.y,ht.y,Et.y,mt.y)}o.emplaceBack(c.x,c.y,Y,z,H,U,f,g,x)}this.boxEndIndex=o.length}}class mN{constructor(o=[],c=yN){if(this.data=o,this.length=this.data.length,this.compare=c,this.length>0)for(let f=(this.length>>1)-1;f>=0;f--)this._down(f)}push(o){this.data.push(o),this.length++,this._up(this.length-1)}pop(){if(this.length===0)return;const o=this.data[0],c=this.data.pop();return this.length--,this.length>0&&(this.data[0]=c,this._down(0)),o}peek(){return this.data[0]}_up(o){const{data:c,compare:f}=this,g=c[o];for(;o>0;){const x=o-1>>1,b=c[x];if(f(g,b)>=0)break;c[o]=b,o=x}c[o]=g}_down(o){const{data:c,compare:f}=this,g=this.length>>1,x=c[o];for(;o<g;){let b=1+(o<<1),I=c[b];const L=b+1;if(L<this.length&&f(c[L],I)<0&&(b=L,I=c[L]),f(I,x)>=0)break;c[o]=I,o=b}c[o]=x}}function yN(l,o){return l<o?-1:l>o?1:0}function _N(l,o=1,c=!1){let f=1/0,g=1/0,x=-1/0,b=-1/0;const I=l[0];for(let Y=0;Y<I.length;Y++){const H=I[Y];(!Y||H.x<f)&&(f=H.x),(!Y||H.y<g)&&(g=H.y),(!Y||H.x>x)&&(x=H.x),(!Y||H.y>b)&&(b=H.y)}const L=Math.min(x-f,b-g);let M=L/2;const R=new mN([],vN);if(L===0)return new D(f,g);for(let Y=f;Y<x;Y+=L)for(let H=g;H<b;H+=L)R.push(new Fg(Y+M,H+M,M,l));let z=function(Y){let H=0,Q=0,ut=0;const ht=Y[0];for(let Et=0,mt=ht.length,St=mt-1;Et<mt;St=Et++){const Dt=ht[Et],Ht=ht[St],Ie=Dt.x*Ht.y-Ht.x*Dt.y;Q+=(Dt.x+Ht.x)*Ie,ut+=(Dt.y+Ht.y)*Ie,H+=3*Ie}return new Fg(Q/H,ut/H,0,Y)}(l),U=R.length;for(;R.length;){const Y=R.pop();(Y.d>z.d||!z.d)&&(z=Y,c&&console.log("found best %d after %d probes",Math.round(1e4*Y.d)/1e4,U)),Y.max-z.d<=o||(M=Y.h/2,R.push(new Fg(Y.p.x-M,Y.p.y-M,M,l)),R.push(new Fg(Y.p.x+M,Y.p.y-M,M,l)),R.push(new Fg(Y.p.x-M,Y.p.y+M,M,l)),R.push(new Fg(Y.p.x+M,Y.p.y+M,M,l)),U+=4)}return c&&(console.log(`num probes: ${U}`),console.log(`best distance: ${z.d}`)),z.p}function vN(l,o){return o.max-l.max}function Fg(l,o,c,f){this.p=new D(l,o),this.h=c,this.d=function(g,x){let b=!1,I=1/0;for(let L=0;L<x.length;L++){const M=x[L];for(let R=0,z=M.length,U=z-1;R<z;U=R++){const Y=M[R],H=M[U];Y.y>g.y!=H.y>g.y&&g.x<(H.x-Y.x)*(g.y-Y.y)/(H.y-Y.y)+Y.x&&(b=!b),I=Math.min(I,xw(g,Y,H))}}return(b?1:-1)*Math.sqrt(I)}(this.p,f),this.max=this.d+this.h*Math.SQRT2}var ds;u.aq=void 0,(ds=u.aq||(u.aq={}))[ds.center=1]="center",ds[ds.left=2]="left",ds[ds.right=3]="right",ds[ds.top=4]="top",ds[ds.bottom=5]="bottom",ds[ds["top-left"]=6]="top-left",ds[ds["top-right"]=7]="top-right",ds[ds["bottom-left"]=8]="bottom-left",ds[ds["bottom-right"]=9]="bottom-right";const Cf=7,dx=Number.POSITIVE_INFINITY;function B1(l,o){return o[1]!==dx?function(c,f,g){let x=0,b=0;switch(f=Math.abs(f),g=Math.abs(g),c){case"top-right":case"top-left":case"top":b=g-Cf;break;case"bottom-right":case"bottom-left":case"bottom":b=-g+Cf}switch(c){case"top-right":case"bottom-right":case"right":x=-f;break;case"top-left":case"bottom-left":case"left":x=f}return[x,b]}(l,o[0],o[1]):function(c,f){let g=0,x=0;f<0&&(f=0);const b=f/Math.SQRT2;switch(c){case"top-right":case"top-left":x=b-Cf;break;case"bottom-right":case"bottom-left":x=-b+Cf;break;case"bottom":x=-f+Cf;break;case"top":x=f-Cf}switch(c){case"top-right":case"bottom-right":g=-b;break;case"top-left":case"bottom-left":g=b;break;case"left":g=f;break;case"right":g=-f}return[g,x]}(l,o[0])}function $1(l,o,c){var f;const g=l.layout,x=(f=g.get("text-variable-anchor-offset"))===null||f===void 0?void 0:f.evaluate(o,{},c);if(x){const I=x.values,L=[];for(let M=0;M<I.length;M+=2){const R=L[M]=I[M],z=I[M+1].map(U=>U*po);R.startsWith("top")?z[1]-=Cf:R.startsWith("bottom")&&(z[1]+=Cf),L[M+1]=z}return new io(L)}const b=g.get("text-variable-anchor");if(b){let I;I=l._unevaluatedLayout.getValue("text-radial-offset")!==void 0?[g.get("text-radial-offset").evaluate(o,{},c)*po,dx]:g.get("text-offset").evaluate(o,{},c).map(M=>M*po);const L=[];for(const M of b)L.push(M,B1(M,I));return new io(L)}return null}function gx(l){switch(l){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function xN(l,o,c,f,g,x,b,I,L,M,R){let z=x.textMaxSize.evaluate(o,{});z===void 0&&(z=b);const U=l.layers[0].layout,Y=U.get("icon-offset").evaluate(o,{},R),H=U1(c.horizontal),Q=b/24,ut=l.tilePixelRatio*Q,ht=l.tilePixelRatio*z/24,Et=l.tilePixelRatio*I,mt=l.tilePixelRatio*U.get("symbol-spacing"),St=U.get("text-padding")*l.tilePixelRatio,Dt=function(re,qe,Re,bn=1){const qr=re.get("icon-padding").evaluate(qe,{},Re),Wr=qr&&qr.values;return[Wr[0]*bn,Wr[1]*bn,Wr[2]*bn,Wr[3]*bn]}(U,o,R,l.tilePixelRatio),Ht=U.get("text-max-angle")/180*Math.PI,Ie=U.get("text-rotation-alignment")!=="viewport"&&U.get("symbol-placement")!=="point",Ae=U.get("icon-rotation-alignment")==="map"&&U.get("symbol-placement")!=="point",Ee=U.get("symbol-placement"),_e=mt/2,ce=U.get("icon-text-fit");let Ne;f&&ce!=="none"&&(l.allowVerticalPlacement&&c.vertical&&(Ne=c1(f,c.vertical,ce,U.get("icon-text-fit-padding"),Y,Q)),H&&(f=c1(f,H,ce,U.get("icon-text-fit-padding"),Y,Q)));const pe=(re,qe)=>{qe.x<0||qe.x>=so||qe.y<0||qe.y>=so||function(Re,bn,qr,Wr,fo,pu,ha,ao,Wo,gs,pa,fa,go,mo,Gs,da,qs,Fa,ka,yo,Dn,js,ms,_o,Pl){const Ic=Re.addToLineVertexArray(bn,qr);let Sc,dp,Ml,Vu,za=0,gp=0,Sy=0,X1=0,Ex=-1,Ix=-1;const mp={};let Y1=cp("");if(Re.allowVerticalPlacement&&Wr.vertical){const Xs=ao.layout.get("text-rotate").evaluate(Dn,{},_o)+90;Ml=new uv(Wo,bn,gs,pa,fa,Wr.vertical,go,mo,Gs,Xs),ha&&(Vu=new uv(Wo,bn,gs,pa,fa,ha,qs,Fa,Gs,Xs))}if(fo){const Xs=ao.layout.get("icon-rotate").evaluate(Dn,{}),Uu=ao.layout.get("icon-text-fit")!=="none",Td=k1(fo,Xs,ms,Uu),Tc=ha?k1(ha,Xs,ms,Uu):void 0;dp=new uv(Wo,bn,gs,pa,fa,fo,qs,Fa,!1,Xs),za=4*Td.length;const Ld=Re.iconSizeData;let mh=null;Ld.kind==="source"?(mh=[gh*ao.layout.get("icon-size").evaluate(Dn,{})],mh[0]>Ef&&vt(`${Re.layerIds[0]}: Value for "icon-size" is >= ${by}. Reduce your "icon-size".`)):Ld.kind==="composite"&&(mh=[gh*js.compositeIconSizes[0].evaluate(Dn,{},_o),gh*js.compositeIconSizes[1].evaluate(Dn,{},_o)],(mh[0]>Ef||mh[1]>Ef)&&vt(`${Re.layerIds[0]}: Value for "icon-size" is >= ${by}. Reduce your "icon-size".`)),Re.addSymbols(Re.icon,Td,mh,yo,ka,Dn,u.ai.none,bn,Ic.lineStartIndex,Ic.lineLength,-1,_o),Ex=Re.icon.placedSymbolArray.length-1,Tc&&(gp=4*Tc.length,Re.addSymbols(Re.icon,Tc,mh,yo,ka,Dn,u.ai.vertical,bn,Ic.lineStartIndex,Ic.lineLength,-1,_o),Ix=Re.icon.placedSymbolArray.length-1)}const Z1=Object.keys(Wr.horizontal);for(const Xs of Z1){const Uu=Wr.horizontal[Xs];if(!Sc){Y1=cp(Uu.text);const Tc=ao.layout.get("text-rotate").evaluate(Dn,{},_o);Sc=new uv(Wo,bn,gs,pa,fa,Uu,go,mo,Gs,Tc)}const Td=Uu.positionedLines.length===1;if(Sy+=V1(Re,bn,Uu,pu,ao,Gs,Dn,da,Ic,Wr.vertical?u.ai.horizontal:u.ai.horizontalOnly,Td?Z1:[Xs],mp,Ex,js,_o),Td)break}Wr.vertical&&(X1+=V1(Re,bn,Wr.vertical,pu,ao,Gs,Dn,da,Ic,u.ai.vertical,["vertical"],mp,Ix,js,_o));const EN=Sc?Sc.boxStartIndex:Re.collisionBoxArray.length,IN=Sc?Sc.boxEndIndex:Re.collisionBoxArray.length,SN=Ml?Ml.boxStartIndex:Re.collisionBoxArray.length,CN=Ml?Ml.boxEndIndex:Re.collisionBoxArray.length,TN=dp?dp.boxStartIndex:Re.collisionBoxArray.length,LN=dp?dp.boxEndIndex:Re.collisionBoxArray.length,NN=Vu?Vu.boxStartIndex:Re.collisionBoxArray.length,PN=Vu?Vu.boxEndIndex:Re.collisionBoxArray.length;let Cc=-1;const cv=(Xs,Uu)=>Xs&&Xs.circleDiameter?Math.max(Xs.circleDiameter,Uu):Uu;Cc=cv(Sc,Cc),Cc=cv(Ml,Cc),Cc=cv(dp,Cc),Cc=cv(Vu,Cc);const H1=Cc>-1?1:0;H1&&(Cc*=Pl/po),Re.glyphOffsetArray.length>=Og.MAX_GLYPHS&&vt("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),Dn.sortKey!==void 0&&Re.addToSortKeyRanges(Re.symbolInstances.length,Dn.sortKey);const MN=$1(ao,Dn,_o),[AN,DN]=function(Xs,Uu){const Td=Xs.length,Tc=Uu==null?void 0:Uu.values;if((Tc==null?void 0:Tc.length)>0)for(let Ld=0;Ld<Tc.length;Ld+=2){const mh=Tc[Ld+1];Xs.emplaceBack(u.aq[Tc[Ld]],mh[0],mh[1])}return[Td,Xs.length]}(Re.textAnchorOffsets,MN);Re.symbolInstances.emplaceBack(bn.x,bn.y,mp.right>=0?mp.right:-1,mp.center>=0?mp.center:-1,mp.left>=0?mp.left:-1,mp.vertical||-1,Ex,Ix,Y1,EN,IN,SN,CN,TN,LN,NN,PN,gs,Sy,X1,za,gp,H1,0,go,Cc,AN,DN)}(l,qe,re,c,f,g,Ne,l.layers[0],l.collisionBoxArray,o.index,o.sourceLayerIndex,l.index,ut,[St,St,St,St],Ie,L,Et,Dt,Ae,Y,o,x,M,R,b)};if(Ee==="line")for(const re of M1(o.geometry,0,0,so,so)){const qe=gN(re,mt,Ht,c.vertical||H,f,24,ht,l.overscaling,so);for(const Re of qe)H&&bN(l,H.text,_e,Re)||pe(re,Re)}else if(Ee==="line-center"){for(const re of o.geometry)if(re.length>1){const qe=dN(re,Ht,c.vertical||H,f,24,ht);qe&&pe(re,qe)}}else if(o.type==="Polygon")for(const re of Y0(o.geometry,0)){const qe=_N(re,16);pe(re[0],new Sf(qe.x,qe.y,0))}else if(o.type==="LineString")for(const re of o.geometry)pe(re,new Sf(re[0].x,re[0].y,0));else if(o.type==="Point")for(const re of o.geometry)for(const qe of re)pe([qe],new Sf(qe.x,qe.y,0))}function V1(l,o,c,f,g,x,b,I,L,M,R,z,U,Y,H){const Q=function(Et,mt,St,Dt,Ht,Ie,Ae,Ee){const _e=Dt.layout.get("text-rotate").evaluate(Ie,{})*Math.PI/180,ce=[];for(const Ne of mt.positionedLines)for(const pe of Ne.positionedGlyphs){if(!pe.rect)continue;const re=pe.rect||{};let qe=r1+1,Re=!0,bn=1,qr=0;const Wr=(Ht||Ee)&&pe.vertical,fo=pe.metrics.advance*pe.scale/2;if(Ee&&mt.verticalizable&&(qr=Ne.lineOffset/2-(pe.imageName?-(po-pe.metrics.width*pe.scale)/2:(pe.scale-1)*po)),pe.imageName){const yo=Ae[pe.imageName];Re=yo.sdf,bn=yo.pixelRatio,qe=Ra/bn}const pu=Ht?[pe.x+fo,pe.y]:[0,0];let ha=Ht?[0,0]:[pe.x+fo+St[0],pe.y+St[1]-qr],ao=[0,0];Wr&&(ao=ha,ha=[0,0]);const Wo=pe.metrics.isDoubleResolution?2:1,gs=(pe.metrics.left-qe)*pe.scale-fo+ha[0],pa=(-pe.metrics.top-qe)*pe.scale+ha[1],fa=gs+re.w/Wo*pe.scale/bn,go=pa+re.h/Wo*pe.scale/bn,mo=new D(gs,pa),Gs=new D(fa,pa),da=new D(gs,go),qs=new D(fa,go);if(Wr){const yo=new D(-fo,fo-vy),Dn=-Math.PI/2,js=po/2-fo,ms=new D(5-vy-js,-(pe.imageName?js:0)),_o=new D(...ao);mo._rotateAround(Dn,yo)._add(ms)._add(_o),Gs._rotateAround(Dn,yo)._add(ms)._add(_o),da._rotateAround(Dn,yo)._add(ms)._add(_o),qs._rotateAround(Dn,yo)._add(ms)._add(_o)}if(_e){const yo=Math.sin(_e),Dn=Math.cos(_e),js=[Dn,-yo,yo,Dn];mo._matMult(js),Gs._matMult(js),da._matMult(js),qs._matMult(js)}const Fa=new D(0,0),ka=new D(0,0);ce.push({tl:mo,tr:Gs,bl:da,br:qs,tex:re,writingMode:mt.writingMode,glyphOffset:pu,sectionIndex:pe.sectionIndex,isSDF:Re,pixelOffsetTL:Fa,pixelOffsetBR:ka,minFontScaleX:0,minFontScaleY:0})}return ce}(0,c,I,g,x,b,f,l.allowVerticalPlacement),ut=l.textSizeData;let ht=null;ut.kind==="source"?(ht=[gh*g.layout.get("text-size").evaluate(b,{})],ht[0]>Ef&&vt(`${l.layerIds[0]}: Value for "text-size" is >= ${by}. Reduce your "text-size".`)):ut.kind==="composite"&&(ht=[gh*Y.compositeTextSizes[0].evaluate(b,{},H),gh*Y.compositeTextSizes[1].evaluate(b,{},H)],(ht[0]>Ef||ht[1]>Ef)&&vt(`${l.layerIds[0]}: Value for "text-size" is >= ${by}. Reduce your "text-size".`)),l.addSymbols(l.text,Q,ht,I,x,b,M,o,L.lineStartIndex,L.lineLength,U,H);for(const Et of R)z[Et]=l.text.placedSymbolArray.length-1;return 4*Q.length}function U1(l){for(const o in l)return l[o];return null}function bN(l,o,c,f){const g=l.compareText;if(o in g){const x=g[o];for(let b=x.length-1;b>=0;b--)if(f.dist(x[b])<c)return!0}else g[o]=[];return g[o].push(f),!1}const G1=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array];class mx{static from(o){if(!(o instanceof ArrayBuffer))throw new Error("Data must be an instance of ArrayBuffer.");const[c,f]=new Uint8Array(o,0,2);if(c!==219)throw new Error("Data does not appear to be in a KDBush format.");const g=f>>4;if(g!==1)throw new Error(`Got v${g} data when expected v1.`);const x=G1[15&f];if(!x)throw new Error("Unrecognized array type.");const[b]=new Uint16Array(o,2,1),[I]=new Uint32Array(o,4,1);return new mx(I,b,x,o)}constructor(o,c=64,f=Float64Array,g){if(isNaN(o)||o<0)throw new Error(`Unpexpected numItems value: ${o}.`);this.numItems=+o,this.nodeSize=Math.min(Math.max(+c,2),65535),this.ArrayType=f,this.IndexArrayType=o<65536?Uint16Array:Uint32Array;const x=G1.indexOf(this.ArrayType),b=2*o*this.ArrayType.BYTES_PER_ELEMENT,I=o*this.IndexArrayType.BYTES_PER_ELEMENT,L=(8-I%8)%8;if(x<0)throw new Error(`Unexpected typed array class: ${f}.`);g&&g instanceof ArrayBuffer?(this.data=g,this.ids=new this.IndexArrayType(this.data,8,o),this.coords=new this.ArrayType(this.data,8+I+L,2*o),this._pos=2*o,this._finished=!0):(this.data=new ArrayBuffer(8+b+I+L),this.ids=new this.IndexArrayType(this.data,8,o),this.coords=new this.ArrayType(this.data,8+I+L,2*o),this._pos=0,this._finished=!1,new Uint8Array(this.data,0,2).set([219,16+x]),new Uint16Array(this.data,2,1)[0]=c,new Uint32Array(this.data,4,1)[0]=o)}add(o,c){const f=this._pos>>1;return this.ids[f]=f,this.coords[this._pos++]=o,this.coords[this._pos++]=c,f}finish(){const o=this._pos>>1;if(o!==this.numItems)throw new Error(`Added ${o} items when expected ${this.numItems}.`);return yx(this.ids,this.coords,this.nodeSize,0,this.numItems-1,0),this._finished=!0,this}range(o,c,f,g){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:x,coords:b,nodeSize:I}=this,L=[0,x.length-1,0],M=[];for(;L.length;){const R=L.pop()||0,z=L.pop()||0,U=L.pop()||0;if(z-U<=I){for(let ut=U;ut<=z;ut++){const ht=b[2*ut],Et=b[2*ut+1];ht>=o&&ht<=f&&Et>=c&&Et<=g&&M.push(x[ut])}continue}const Y=U+z>>1,H=b[2*Y],Q=b[2*Y+1];H>=o&&H<=f&&Q>=c&&Q<=g&&M.push(x[Y]),(R===0?o<=H:c<=Q)&&(L.push(U),L.push(Y-1),L.push(1-R)),(R===0?f>=H:g>=Q)&&(L.push(Y+1),L.push(z),L.push(1-R))}return M}within(o,c,f){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:g,coords:x,nodeSize:b}=this,I=[0,g.length-1,0],L=[],M=f*f;for(;I.length;){const R=I.pop()||0,z=I.pop()||0,U=I.pop()||0;if(z-U<=b){for(let ut=U;ut<=z;ut++)j1(x[2*ut],x[2*ut+1],o,c)<=M&&L.push(g[ut]);continue}const Y=U+z>>1,H=x[2*Y],Q=x[2*Y+1];j1(H,Q,o,c)<=M&&L.push(g[Y]),(R===0?o-f<=H:c-f<=Q)&&(I.push(U),I.push(Y-1),I.push(1-R)),(R===0?o+f>=H:c+f>=Q)&&(I.push(Y+1),I.push(z),I.push(1-R))}return L}}function yx(l,o,c,f,g,x){if(g-f<=c)return;const b=f+g>>1;q1(l,o,b,f,g,x),yx(l,o,c,f,b-1,1-x),yx(l,o,c,b+1,g,1-x)}function q1(l,o,c,f,g,x){for(;g>f;){if(g-f>600){const M=g-f+1,R=c-f+1,z=Math.log(M),U=.5*Math.exp(2*z/3),Y=.5*Math.sqrt(z*U*(M-U)/M)*(R-M/2<0?-1:1);q1(l,o,c,Math.max(f,Math.floor(c-R*U/M+Y)),Math.min(g,Math.floor(c+(M-R)*U/M+Y)),x)}const b=o[2*c+x];let I=f,L=g;for(Ey(l,o,f,c),o[2*g+x]>b&&Ey(l,o,f,g);I<L;){for(Ey(l,o,I,L),I++,L--;o[2*I+x]<b;)I++;for(;o[2*L+x]>b;)L--}o[2*f+x]===b?Ey(l,o,f,L):(L++,Ey(l,o,L,g)),L<=c&&(f=L+1),c<=L&&(g=L-1)}}function Ey(l,o,c,f){_x(l,c,f),_x(o,2*c,2*f),_x(o,2*c+1,2*f+1)}function _x(l,o,c){const f=l[o];l[o]=l[c],l[c]=f}function j1(l,o,c,f){const g=l-c,x=o-f;return g*g+x*x}var vx;u.bh=void 0,(vx=u.bh||(u.bh={})).create="create",vx.load="load",vx.fullLoad="fullLoad";let lv=null,Iy=[];const xx=1e3/60,bx="loadTime",wx="fullLoadTime",wN={mark(l){performance.mark(l)},frame(l){const o=l;lv!=null&&Iy.push(o-lv),lv=o},clearMetrics(){lv=null,Iy=[],performance.clearMeasures(bx),performance.clearMeasures(wx);for(const l in u.bh)performance.clearMarks(u.bh[l])},getPerformanceMetrics(){performance.measure(bx,u.bh.create,u.bh.load),performance.measure(wx,u.bh.create,u.bh.fullLoad);const l=performance.getEntriesByName(bx)[0].duration,o=performance.getEntriesByName(wx)[0].duration,c=Iy.length,f=1/(Iy.reduce((x,b)=>x+b,0)/c/1e3),g=Iy.filter(x=>x>xx).reduce((x,b)=>x+(b-xx)/xx,0);return{loadTime:l,fullLoadTime:o,fps:f,percentDroppedFrames:g/(c+g)*100,totalFrames:c}}};u.$=function(l,o,c){var f,g,x,b,I,L,M,R,z,U,Y,H,Q=c[0],ut=c[1],ht=c[2];return o===l?(l[12]=o[0]*Q+o[4]*ut+o[8]*ht+o[12],l[13]=o[1]*Q+o[5]*ut+o[9]*ht+o[13],l[14]=o[2]*Q+o[6]*ut+o[10]*ht+o[14],l[15]=o[3]*Q+o[7]*ut+o[11]*ht+o[15]):(g=o[1],x=o[2],b=o[3],I=o[4],L=o[5],M=o[6],R=o[7],z=o[8],U=o[9],Y=o[10],H=o[11],l[0]=f=o[0],l[1]=g,l[2]=x,l[3]=b,l[4]=I,l[5]=L,l[6]=M,l[7]=R,l[8]=z,l[9]=U,l[10]=Y,l[11]=H,l[12]=f*Q+I*ut+z*ht+o[12],l[13]=g*Q+L*ut+U*ht+o[13],l[14]=x*Q+M*ut+Y*ht+o[14],l[15]=b*Q+R*ut+H*ht+o[15]),l},u.A=Ng,u.B=Xo,u.C=class{constructor(l,o,c){this.receive=f=>{const g=f.data,x=g.id;if(x&&(!g.targetMapId||this.mapId===g.targetMapId))if(g.type==="<cancel>"){delete this.tasks[x];const b=this.cancelCallbacks[x];delete this.cancelCallbacks[x],b&&b()}else Ge()||g.mustQueue?(this.tasks[x]=g,this.taskQueue.push(x),this.invoker.trigger()):this.processTask(x,g)},this.process=()=>{if(!this.taskQueue.length)return;const f=this.taskQueue.shift(),g=this.tasks[f];delete this.tasks[f],this.taskQueue.length&&this.invoker.trigger(),g&&this.processTask(f,g)},this.target=l,this.parent=o,this.mapId=c,this.callbacks={},this.tasks={},this.taskQueue=[],this.cancelCallbacks={},this.invoker=new pN(this.process),this.target.addEventListener("message",this.receive,!1),this.globalScope=Ge()?l:window}send(l,o,c,f,g=!1){const x=Math.round(1e18*Math.random()).toString(36).substring(0,10);c&&(this.callbacks[x]=c);const b=[],I={id:x,type:l,hasCallback:!!c,targetMapId:f,mustQueue:g,sourceMapId:this.mapId,data:aa(o,b)};return this.target.postMessage(I,{transfer:b}),{cancel:()=>{c&&delete this.callbacks[x],this.target.postMessage({id:x,type:"<cancel>",targetMapId:f,sourceMapId:this.mapId})}}}processTask(l,o){if(o.type==="<response>"){const c=this.callbacks[l];delete this.callbacks[l],c&&(o.error?c(zu(o.error)):c(null,zu(o.data)))}else{let c=!1;const f=[],g=o.hasCallback?(I,L)=>{c=!0,delete this.cancelCallbacks[l];const M={id:l,type:"<response>",sourceMapId:this.mapId,error:I?aa(I):null,data:aa(L,f)};this.target.postMessage(M,{transfer:f})}:I=>{c=!0};let x=null;const b=zu(o.data);if(this.parent[o.type])x=this.parent[o.type](o.sourceMapId,b,g);else if("getWorkerSource"in this.parent){const I=o.type.split(".");x=this.parent.getWorkerSource(o.sourceMapId,I[0],b.source)[I[1]](b,g)}else g(new Error(`Could not find function ${o.type}`));!c&&x&&x.cancel&&(this.cancelCallbacks[l]=x.cancel)}}remove(){this.invoker.remove(),this.target.removeEventListener("message",this.receive,!1)}},u.D=ze,u.E=no,u.F=function(l,o){const c={};for(let f=0;f<o.length;f++){const g=o[f];g in l&&(c[g]=l[g])}return c},u.G=v1,u.H=x1,u.I=rx,u.J=ct,u.K=pt,u.L=If,u.M=jn,u.N=so,u.O=$u,u.P=D,u.Q=ri,u.R=Bu,u.S=Gr,u.T=z_,u.U=iv,u.V=class extends up{},u.W=fx,u.X=function(l,o){const c=window.document.createElement("video");c.muted=!0,c.onloadstart=function(){o(null,c)};for(let f=0;f<l.length;f++){const g=window.document.createElement("source");Xn(l[f])||(c.crossOrigin="Anonymous"),g.src=l[f],c.appendChild(g)}return{cancel:()=>{}}},u.Y=se,u.Z=function(){var l=new Ng(16);return Ng!=Float32Array&&(l[1]=0,l[2]=0,l[3]=0,l[4]=0,l[6]=0,l[7]=0,l[8]=0,l[9]=0,l[11]=0,l[12]=0,l[13]=0,l[14]=0),l[0]=1,l[5]=1,l[10]=1,l[15]=1,l},u._=_,u.a=xn,u.a$=class extends j{},u.a0=function(l,o,c){var f=c[0],g=c[1],x=c[2];return l[0]=o[0]*f,l[1]=o[1]*f,l[2]=o[2]*f,l[3]=o[3]*f,l[4]=o[4]*g,l[5]=o[5]*g,l[6]=o[6]*g,l[7]=o[7]*g,l[8]=o[8]*x,l[9]=o[9]*x,l[10]=o[10]*x,l[11]=o[11]*x,l[12]=o[12],l[13]=o[13],l[14]=o[14],l[15]=o[15],l},u.a1=Iw,u.a2=function(){return Rt++},u.a3=st,u.a4=Og,u.a5=function(){Da.isLoading()||Da.isLoaded()||Km()!=="deferred"||k_()},u.a6=cf,u.a7=Sd,u.a8=Ur,u.a9=T1,u.aA=vd,u.aB=function(l){l=l.slice();const o=Object.create(null);for(let c=0;c<l.length;c++)o[l[c].id]=l[c];for(let c=0;c<l.length;c++)"ref"in l[c]&&(l[c]=$i(l[c],o[l[c].ref]));return l},u.aC=function(l){if(l.type==="custom")return new hN(l);switch(l.type){case"background":return new uN(l);case"circle":return new XT(l);case"fill":return new pL(l);case"fill-extrusion":return new TL(l);case"heatmap":return new ZT(l);case"hillshade":return new WT(l);case"line":return new RL(l);case"raster":return new cN(l);case"symbol":return new rv(l)}},u.aD=Kt,u.aE=function(l,o){if(!l)return[{command:vn.setStyle,args:[o]}];let c=[];try{if(!Gn(l.version,o.version))return[{command:vn.setStyle,args:[o]}];Gn(l.center,o.center)||c.push({command:vn.setCenter,args:[o.center]}),Gn(l.zoom,o.zoom)||c.push({command:vn.setZoom,args:[o.zoom]}),Gn(l.bearing,o.bearing)||c.push({command:vn.setBearing,args:[o.bearing]}),Gn(l.pitch,o.pitch)||c.push({command:vn.setPitch,args:[o.pitch]}),Gn(l.sprite,o.sprite)||c.push({command:vn.setSprite,args:[o.sprite]}),Gn(l.glyphs,o.glyphs)||c.push({command:vn.setGlyphs,args:[o.glyphs]}),Gn(l.transition,o.transition)||c.push({command:vn.setTransition,args:[o.transition]}),Gn(l.light,o.light)||c.push({command:vn.setLight,args:[o.light]});const f={},g=[];(function(b,I,L,M){let R;for(R in I=I||{},b=b||{})Object.prototype.hasOwnProperty.call(b,R)&&(Object.prototype.hasOwnProperty.call(I,R)||pi(R,L,M));for(R in I)Object.prototype.hasOwnProperty.call(I,R)&&(Object.prototype.hasOwnProperty.call(b,R)?Gn(b[R],I[R])||(b[R].type==="geojson"&&I[R].type==="geojson"&&Ta(b,I,R)?L.push({command:vn.setGeoJSONSourceData,args:[R,I[R].data]}):os(R,I,L,M)):zs(R,I,L))})(l.sources,o.sources,g,f);const x=[];l.layers&&l.layers.forEach(b=>{f[b.source]?c.push({command:vn.removeLayer,args:[b.id]}):x.push(b)}),c=c.concat(g),function(b,I,L){I=I||[];const M=(b=b||[]).map(ss),R=I.map(ss),z=b.reduce(ia,{}),U=I.reduce(ia,{}),Y=M.slice(),H=Object.create(null);let Q,ut,ht,Et,mt,St,Dt;for(Q=0,ut=0;Q<M.length;Q++)ht=M[Q],Object.prototype.hasOwnProperty.call(U,ht)?ut++:(L.push({command:vn.removeLayer,args:[ht]}),Y.splice(Y.indexOf(ht,ut),1));for(Q=0,ut=0;Q<R.length;Q++)ht=R[R.length-1-Q],Y[Y.length-1-Q]!==ht&&(Object.prototype.hasOwnProperty.call(z,ht)?(L.push({command:vn.removeLayer,args:[ht]}),Y.splice(Y.lastIndexOf(ht,Y.length-ut),1)):ut++,St=Y[Y.length-Q],L.push({command:vn.addLayer,args:[U[ht],St]}),Y.splice(Y.length-Q,0,ht),H[ht]=!0);for(Q=0;Q<R.length;Q++)if(ht=R[Q],Et=z[ht],mt=U[ht],!H[ht]&&!Gn(Et,mt))if(Gn(Et.source,mt.source)&&Gn(Et["source-layer"],mt["source-layer"])&&Gn(Et.type,mt.type)){for(Dt in ra(Et.layout,mt.layout,L,ht,null,vn.setLayoutProperty),ra(Et.paint,mt.paint,L,ht,null,vn.setPaintProperty),Gn(Et.filter,mt.filter)||L.push({command:vn.setFilter,args:[ht,mt.filter]}),Gn(Et.minzoom,mt.minzoom)&&Gn(Et.maxzoom,mt.maxzoom)||L.push({command:vn.setLayerZoomRange,args:[ht,mt.minzoom,mt.maxzoom]}),Et)Object.prototype.hasOwnProperty.call(Et,Dt)&&Dt!=="layout"&&Dt!=="paint"&&Dt!=="filter"&&Dt!=="metadata"&&Dt!=="minzoom"&&Dt!=="maxzoom"&&(Dt.indexOf("paint.")===0?ra(Et[Dt],mt[Dt],L,ht,Dt.slice(6),vn.setPaintProperty):Gn(Et[Dt],mt[Dt])||L.push({command:vn.setLayerProperty,args:[ht,Dt,mt[Dt]]}));for(Dt in mt)Object.prototype.hasOwnProperty.call(mt,Dt)&&!Object.prototype.hasOwnProperty.call(Et,Dt)&&Dt!=="layout"&&Dt!=="paint"&&Dt!=="filter"&&Dt!=="metadata"&&Dt!=="minzoom"&&Dt!=="maxzoom"&&(Dt.indexOf("paint.")===0?ra(Et[Dt],mt[Dt],L,ht,Dt.slice(6),vn.setPaintProperty):Gn(Et[Dt],mt[Dt])||L.push({command:vn.setLayerProperty,args:[ht,Dt,mt[Dt]]}))}else L.push({command:vn.removeLayer,args:[ht]}),St=Y[Y.lastIndexOf(ht)+1],L.push({command:vn.addLayer,args:[mt,St]})}(x,o.layers,c)}catch(f){console.warn("Unable to compute style diff:",f),c=[{command:vn.setStyle,args:[o]}]}return c},u.aF=function(l){const o=[],c=l.id;return c===void 0&&o.push({message:`layers.${c}: missing required property "id"`}),l.render===void 0&&o.push({message:`layers.${c}: missing required method "render"`}),l.renderingMode&&l.renderingMode!=="2d"&&l.renderingMode!=="3d"&&o.push({message:`layers.${c}: property "renderingMode" must be either "2d" or "3d"`}),o},u.aG=function l(o,c){if(Array.isArray(o)){if(!Array.isArray(c)||o.length!==c.length)return!1;for(let f=0;f<o.length;f++)if(!l(o[f],c[f]))return!1;return!0}if(typeof o=="object"&&o!==null&&c!==null){if(typeof c!="object"||Object.keys(o).length!==Object.keys(c).length)return!1;for(const f in o)if(!l(o[f],c[f]))return!1;return!0}return o===c},u.aH=Yt,u.aI=be,u.aJ=xd,u.aK=function(l){return l({pluginStatus:ua,pluginURL:fh}),xd.on("pluginStateChange",l),l},u.aL=class extends hp{constructor(l,o){super(l,o),this.current=0}set(l){this.current!==l&&(this.current=l,this.gl.uniform1i(this.location,l))}},u.aM=Tg,u.aN=class extends hp{constructor(l,o){super(l,o),this.current=R0}set(l){if(l[12]!==this.current[12]||l[0]!==this.current[0])return this.current=l,void this.gl.uniformMatrix4fv(this.location,!1,l);for(let o=1;o<16;o++)if(l[o]!==this.current[o]){this.current=l,this.gl.uniformMatrix4fv(this.location,!1,l);break}}},u.aO=U_,u.aP=class extends hp{constructor(l,o){super(l,o),this.current=[0,0,0]}set(l){l[0]===this.current[0]&&l[1]===this.current[1]&&l[2]===this.current[2]||(this.current=l,this.gl.uniform3f(this.location,l[0],l[1],l[2]))}},u.aQ=class extends hp{constructor(l,o){super(l,o),this.current=[0,0]}set(l){l[0]===this.current[0]&&l[1]===this.current[1]||(this.current=l,this.gl.uniform2f(this.location,l[0],l[1]))}},u.aR=G_,u.aS=function(l,o,c,f,g,x,b){var I=1/(o-c),L=1/(f-g),M=1/(x-b);return l[0]=-2*I,l[1]=0,l[2]=0,l[3]=0,l[4]=0,l[5]=-2*L,l[6]=0,l[7]=0,l[8]=0,l[9]=0,l[10]=2*M,l[11]=0,l[12]=(o+c)*I,l[13]=(g+f)*L,l[14]=(b+x)*M,l[15]=1,l},u.aT=or,u.aU=jT,u.aV=class extends d{},u.aW=BL,u.aX=class extends v{},u.aY=function(l){return l<=1?1:Math.pow(2,Math.ceil(Math.log(l)/Math.LN2))},u.aZ=Nw,u.a_=ue,u.aa=function(l){const o={};if(l.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,(c,f,g,x)=>{const b=g||x;return o[f]=!b||b.toLowerCase(),""}),o["max-age"]){const c=parseInt(o["max-age"],10);isNaN(c)?delete o["max-age"]:o["max-age"]=c}return o},u.ab=function(l,o){const c=[];for(const f in l)f in o||c.push(f);return c},u.ac=function(l){if(gn==null){const o=l.navigator?l.navigator.userAgent:null;gn=!!l.safari||!(!o||!(/\b(iPad|iPhone|iPod)\b/.test(o)||o.match("Safari")&&!o.match("Chrome")))}return gn},u.ad=zt,u.ae=function(l,o,c){var f=Math.sin(c),g=Math.cos(c),x=o[0],b=o[1],I=o[2],L=o[3],M=o[4],R=o[5],z=o[6],U=o[7];return o!==l&&(l[8]=o[8],l[9]=o[9],l[10]=o[10],l[11]=o[11],l[12]=o[12],l[13]=o[13],l[14]=o[14],l[15]=o[15]),l[0]=x*g+M*f,l[1]=b*g+R*f,l[2]=I*g+z*f,l[3]=L*g+U*f,l[4]=M*g-x*f,l[5]=R*g-b*f,l[6]=z*g-I*f,l[7]=U*g-L*f,l},u.af=function(l){var o=new Ng(16);return o[0]=l[0],o[1]=l[1],o[2]=l[2],o[3]=l[3],o[4]=l[4],o[5]=l[5],o[6]=l[6],o[7]=l[7],o[8]=l[8],o[9]=l[9],o[10]=l[10],o[11]=l[11],o[12]=l[12],o[13]=l[13],o[14]=l[14],o[15]=l[15],o},u.ag=Y_,u.ah=function(l,o){let c=0,f=0;if(l.kind==="constant")f=l.layoutSize;else if(l.kind!=="source"){const{interpolationType:g,minZoom:x,maxZoom:b}=l,I=g?zt(cs.interpolationFactor(g,o,x,b),0,1):0;l.kind==="camera"?f=Xo.number(l.minSize,l.maxSize,I):c=I}return{uSizeT:c,uSize:f}},u.aj=function(l,{uSize:o,uSizeT:c},{lowerSize:f,upperSize:g}){return l.kind==="source"?f/gh:l.kind==="composite"?Xo.number(f/gh,g/gh,c):o},u.ak=ax,u.al=function(l,o,c,f){const g=o.y-l.y,x=o.x-l.x,b=f.y-c.y,I=f.x-c.x,L=b*x-I*g;if(L===0)return null;const M=(I*(l.y-c.y)-b*(l.x-c.x))/L;return new D(l.x+M*x,l.y+M*g)},u.am=M1,u.an=_w,u.ao=$0,u.ap=po,u.ar=sx,u.as=function(l,o){var c=o[0],f=o[1],g=o[2],x=o[3],b=o[4],I=o[5],L=o[6],M=o[7],R=o[8],z=o[9],U=o[10],Y=o[11],H=o[12],Q=o[13],ut=o[14],ht=o[15],Et=c*I-f*b,mt=c*L-g*b,St=c*M-x*b,Dt=f*L-g*I,Ht=f*M-x*I,Ie=g*M-x*L,Ae=R*Q-z*H,Ee=R*ut-U*H,_e=R*ht-Y*H,ce=z*ut-U*Q,Ne=z*ht-Y*Q,pe=U*ht-Y*ut,re=Et*pe-mt*Ne+St*ce+Dt*_e-Ht*Ee+Ie*Ae;return re?(l[0]=(I*pe-L*Ne+M*ce)*(re=1/re),l[1]=(g*Ne-f*pe-x*ce)*re,l[2]=(Q*Ie-ut*Ht+ht*Dt)*re,l[3]=(U*Ht-z*Ie-Y*Dt)*re,l[4]=(L*_e-b*pe-M*Ee)*re,l[5]=(c*pe-g*_e+x*Ee)*re,l[6]=(ut*St-H*Ie-ht*mt)*re,l[7]=(R*Ie-U*St+Y*mt)*re,l[8]=(b*Ne-I*_e+M*Ae)*re,l[9]=(f*_e-c*Ne-x*Ae)*re,l[10]=(H*Ht-Q*St+ht*Et)*re,l[11]=(z*St-R*Ht-Y*Et)*re,l[12]=(I*Ee-b*ce-L*Ae)*re,l[13]=(c*ce-f*Ee+g*Ae)*re,l[14]=(Q*mt-H*Dt-ut*Et)*re,l[15]=(R*Dt-z*mt+U*Et)*re,l):null},u.at=gx,u.au=ox,u.av=mx,u.aw=function(){const l={},o=Vt.$version;for(const c in Vt.$root){const f=Vt.$root[c];if(f.required){let g=null;g=c==="version"?o:f.type==="array"?[]:{},g!=null&&(l[c]=g)}}return l},u.ax=vn,u.ay=wc,u.az=br,u.b=function(l,o){const c=new Blob([new Uint8Array(l)],{type:"image/png"});createImageBitmap(c).then(f=>{o(null,f)}).catch(f=>{o(new Error(`Could not load image because of ${f.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`))})},u.b0=Zo,u.b1=function(l,o){var c=l[0],f=l[1],g=l[2],x=l[3],b=l[4],I=l[5],L=l[6],M=l[7],R=l[8],z=l[9],U=l[10],Y=l[11],H=l[12],Q=l[13],ut=l[14],ht=l[15],Et=o[0],mt=o[1],St=o[2],Dt=o[3],Ht=o[4],Ie=o[5],Ae=o[6],Ee=o[7],_e=o[8],ce=o[9],Ne=o[10],pe=o[11],re=o[12],qe=o[13],Re=o[14],bn=o[15];return Math.abs(c-Et)<=ca*Math.max(1,Math.abs(c),Math.abs(Et))&&Math.abs(f-mt)<=ca*Math.max(1,Math.abs(f),Math.abs(mt))&&Math.abs(g-St)<=ca*Math.max(1,Math.abs(g),Math.abs(St))&&Math.abs(x-Dt)<=ca*Math.max(1,Math.abs(x),Math.abs(Dt))&&Math.abs(b-Ht)<=ca*Math.max(1,Math.abs(b),Math.abs(Ht))&&Math.abs(I-Ie)<=ca*Math.max(1,Math.abs(I),Math.abs(Ie))&&Math.abs(L-Ae)<=ca*Math.max(1,Math.abs(L),Math.abs(Ae))&&Math.abs(M-Ee)<=ca*Math.max(1,Math.abs(M),Math.abs(Ee))&&Math.abs(R-_e)<=ca*Math.max(1,Math.abs(R),Math.abs(_e))&&Math.abs(z-ce)<=ca*Math.max(1,Math.abs(z),Math.abs(ce))&&Math.abs(U-Ne)<=ca*Math.max(1,Math.abs(U),Math.abs(Ne))&&Math.abs(Y-pe)<=ca*Math.max(1,Math.abs(Y),Math.abs(pe))&&Math.abs(H-re)<=ca*Math.max(1,Math.abs(H),Math.abs(re))&&Math.abs(Q-qe)<=ca*Math.max(1,Math.abs(Q),Math.abs(qe))&&Math.abs(ut-Re)<=ca*Math.max(1,Math.abs(ut),Math.abs(Re))&&Math.abs(ht-bn)<=ca*Math.max(1,Math.abs(ht),Math.abs(bn))},u.b2=function(l,o){return l[0]=o[0],l[1]=o[1],l[2]=o[2],l[3]=o[3],l[4]=o[4],l[5]=o[5],l[6]=o[6],l[7]=o[7],l[8]=o[8],l[9]=o[9],l[10]=o[10],l[11]=o[11],l[12]=o[12],l[13]=o[13],l[14]=o[14],l[15]=o[15],l},u.b3=function(l,o,c){return l[0]=o[0]*c[0],l[1]=o[1]*c[1],l[2]=o[2]*c[2],l[3]=o[3]*c[3],l},u.b4=function(l,o){return l[0]*o[0]+l[1]*o[1]+l[2]*o[2]+l[3]*o[3]},u.b5=Ot,u.b6=I1,u.b7=b1,u.b8=function(l,o,c,f,g){var x,b=1/Math.tan(o/2);return l[0]=b/c,l[1]=0,l[2]=0,l[3]=0,l[4]=0,l[5]=b,l[6]=0,l[7]=0,l[8]=0,l[9]=0,l[11]=-1,l[12]=0,l[13]=0,l[15]=0,g!=null&&g!==1/0?(l[10]=(g+f)*(x=1/(f-g)),l[14]=2*g*f*x):(l[10]=-1,l[14]=-2*f),l},u.b9=function(l,o,c){var f=Math.sin(c),g=Math.cos(c),x=o[4],b=o[5],I=o[6],L=o[7],M=o[8],R=o[9],z=o[10],U=o[11];return o!==l&&(l[0]=o[0],l[1]=o[1],l[2]=o[2],l[3]=o[3],l[12]=o[12],l[13]=o[13],l[14]=o[14],l[15]=o[15]),l[4]=x*g+M*f,l[5]=b*g+R*f,l[6]=I*g+z*f,l[7]=L*g+U*f,l[8]=M*g-x*f,l[9]=R*g-b*f,l[10]=z*g-I*f,l[11]=U*g-L*f,l},u.bA=C,u.bB=Ww,u.bC=uf,u.bD=Da,u.ba=gt,u.bb=Ut,u.bc=function(l,o){return l[0]=o[0],l[1]=0,l[2]=0,l[3]=0,l[4]=0,l[5]=o[1],l[6]=0,l[7]=0,l[8]=0,l[9]=0,l[10]=o[2],l[11]=0,l[12]=0,l[13]=0,l[14]=0,l[15]=1,l},u.bd=class extends Ed{},u.be=hx,u.bf=w1,u.bg=wN,u.bi=ks,u.bj=function(l,o,c=!1){if(ua===Ym||ua===Zm||ua===Hm)throw new Error("setRTLTextPlugin cannot be called multiple times.");fh=ci.resolveURL(l),ua=Ym,Wm=o,Jm(),c||k_()},u.bk=Km,u.bl=function(l,o){const c={};for(let g=0;g<l.length;g++){const x=o&&o[l[g].id]||bc(l[g]);o&&(o[l[g].id]=x);let b=c[x];b||(b=c[x]=[]),b.push(l[g])}const f=[];for(const g in c)f.push(c[g]);return f},u.bm=ve,u.bn=C1,u.bo=L1,u.bp=o1,u.bq=function(l){l.bucket.createArrays(),l.bucket.tilePixelRatio=so/(512*l.bucket.overscaling),l.bucket.compareText={},l.bucket.iconsNeedLinear=!1;const o=l.bucket.layers[0],c=o.layout,f=o._unevaluatedLayout._values,g={layoutIconSize:f["icon-size"].possiblyEvaluate(new Ur(l.bucket.zoom+1),l.canonical),layoutTextSize:f["text-size"].possiblyEvaluate(new Ur(l.bucket.zoom+1),l.canonical),textMaxSize:f["text-size"].possiblyEvaluate(new Ur(18))};if(l.bucket.textSizeData.kind==="composite"){const{minZoom:M,maxZoom:R}=l.bucket.textSizeData;g.compositeTextSizes=[f["text-size"].possiblyEvaluate(new Ur(M),l.canonical),f["text-size"].possiblyEvaluate(new Ur(R),l.canonical)]}if(l.bucket.iconSizeData.kind==="composite"){const{minZoom:M,maxZoom:R}=l.bucket.iconSizeData;g.compositeIconSizes=[f["icon-size"].possiblyEvaluate(new Ur(M),l.canonical),f["icon-size"].possiblyEvaluate(new Ur(R),l.canonical)]}const x=c.get("text-line-height")*po,b=c.get("text-rotation-alignment")!=="viewport"&&c.get("symbol-placement")!=="point",I=c.get("text-keep-upright"),L=c.get("text-size");for(const M of l.bucket.features){const R=c.get("text-font").evaluate(M,{},l.canonical).join(","),z=L.evaluate(M,{},l.canonical),U=g.layoutTextSize.evaluate(M,{},l.canonical),Y=g.layoutIconSize.evaluate(M,{},l.canonical),H={horizontal:{},vertical:void 0},Q=M.text;let ut,ht=[0,0];if(Q){const St=Q.toString(),Dt=c.get("text-letter-spacing").evaluate(M,{},l.canonical)*po,Ht=hh(St)?Dt:0,Ie=c.get("text-anchor").evaluate(M,{},l.canonical),Ae=$1(o,M,l.canonical);if(!Ae){const pe=c.get("text-radial-offset").evaluate(M,{},l.canonical);ht=pe?B1(Ie,[pe*po,dx]):c.get("text-offset").evaluate(M,{},l.canonical).map(re=>re*po)}let Ee=b?"center":c.get("text-justify").evaluate(M,{},l.canonical);const _e=c.get("symbol-placement"),ce=_e==="point"?c.get("text-max-width").evaluate(M,{},l.canonical)*po:0,Ne=()=>{l.bucket.allowVerticalPlacement&&mf(St)&&(H.vertical=tv(Q,l.glyphMap,l.glyphPositions,l.imagePositions,R,ce,x,Ie,"left",Ht,ht,u.ai.vertical,!0,_e,U,z))};if(!b&&Ae){const pe=new Set;if(Ee==="auto")for(let qe=0;qe<Ae.values.length;qe+=2)pe.add(gx(Ae.values[qe]));else pe.add(Ee);let re=!1;for(const qe of pe)if(!H.horizontal[qe])if(re)H.horizontal[qe]=H.horizontal[0];else{const Re=tv(Q,l.glyphMap,l.glyphPositions,l.imagePositions,R,ce,x,"center",qe,Ht,ht,u.ai.horizontal,!1,_e,U,z);Re&&(H.horizontal[qe]=Re,re=Re.positionedLines.length===1)}Ne()}else{Ee==="auto"&&(Ee=gx(Ie));const pe=tv(Q,l.glyphMap,l.glyphPositions,l.imagePositions,R,ce,x,Ie,Ee,Ht,ht,u.ai.horizontal,!1,_e,U,z);pe&&(H.horizontal[Ee]=pe),Ne(),mf(St)&&b&&I&&(H.vertical=tv(Q,l.glyphMap,l.glyphPositions,l.imagePositions,R,ce,x,Ie,Ee,Ht,ht,u.ai.vertical,!1,_e,U,z))}}let Et=!1;if(M.icon&&M.icon.name){const St=l.imageMap[M.icon.name];St&&(ut=rN(l.imagePositions[M.icon.name],c.get("icon-offset").evaluate(M,{},l.canonical),c.get("icon-anchor").evaluate(M,{},l.canonical)),Et=!!St.sdf,l.bucket.sdfIcons===void 0?l.bucket.sdfIcons=Et:l.bucket.sdfIcons!==Et&&vt("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(St.pixelRatio!==l.bucket.pixelRatio||c.get("icon-rotate").constantOr(1)!==0)&&(l.bucket.iconsNeedLinear=!0))}const mt=U1(H.horizontal)||H.vertical;l.bucket.iconsInText=!!mt&&mt.iconsInText,(mt||ut)&&xN(l.bucket,M,H,ut,l.imageMap,g,U,Y,ht,Et,l.canonical)}l.showCollisionBoxes&&l.bucket.generateCollisionDebugBuffers()},u.br=Q0,u.bs=W0,u.bt=K0,u.bu=class{constructor(l){this._marks={start:[l.url,"start"].join("#"),end:[l.url,"end"].join("#"),measure:l.url.toString()},performance.mark(this._marks.start)}finish(){performance.mark(this._marks.end);let l=performance.getEntriesByName(this._marks.measure);return l.length===0&&(performance.measure(this._marks.measure,this._marks.start,this._marks.end),l=performance.getEntriesByName(this._marks.measure),performance.clearMarks(this._marks.start),performance.clearMarks(this._marks.end),performance.clearMeasures(this._marks.measure)),l}},u.bv=ex,u.bw=bf,u.bx=function(l,o,c,f,g){return _(this,void 0,void 0,function*(){if(pt())try{return yield jn(l,o,c,f,g)}catch{}return function(x,b,I,L,M){const R=x.width,z=x.height;$n&&Fe||($n=new OffscreenCanvas(R,z),Fe=$n.getContext("2d",{willReadFrequently:!0})),$n.width=R,$n.height=z,Fe.drawImage(x,0,0,R,z);const U=Fe.getImageData(b,I,L,M);return Fe.clearRect(0,0,R,z),U.data}(l,o,c,f,g)})},u.by=S1,u.bz=w,u.c=fl,u.d=function(l,o){const c=new Image;c.onload=()=>{o(null,c),URL.revokeObjectURL(c.src),c.onload=null,window.requestAnimationFrame(()=>{c.src=ei})},c.onerror=()=>o(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));const f=new Blob([new Uint8Array(l)],{type:"image/png"});c.src=l.byteLength?URL.createObjectURL(f):ei},u.e=At,u.f=function(l,o){return qo(At(l,{type:"json"}),o)},u.g=nn,u.h=ci,u.i=Ge,u.j=Yn,u.k=Ci,u.l=Fn,u.m=qo,u.n=function(l){return new ex(l).readFields(JL,[])},u.o=function(l,o,c){if(!l.length)return c(null,[]);let f=l.length;const g=new Array(l.length);let x=null;l.forEach((b,I)=>{o(b,(L,M)=>{L&&(x=L),g[I]=M,--f==0&&c(x,g)})})},u.p=i1,u.q=hy,u.r=Gi,u.s=Xn,u.t=Er,u.u=he,u.v=Vt,u.w=vt,u.x=Ma,u.y=ku,u.z=function([l,o,c]){return o+=90,o*=Math.PI/180,c*=Math.PI/180,{x:l*Math.cos(o)*Math.sin(c),y:l*Math.sin(o)*Math.sin(c),z:l*Math.cos(c)}}}),a(["./shared"],function(u){class _{constructor(V){this.keyCache={},V&&this.replace(V)}replace(V){this._layerConfigs={},this._layers={},this.update(V,[])}update(V,G){for(const q of V){this._layerConfigs[q.id]=q;const nt=this._layers[q.id]=u.aC(q);nt._featureFilter=u.a6(nt.filter),this.keyCache[q.id]&&delete this.keyCache[q.id]}for(const q of G)delete this.keyCache[q],delete this._layerConfigs[q],delete this._layers[q];this.familiesBySource={};const J=u.bl(Object.values(this._layerConfigs),this.keyCache);for(const q of J){const nt=q.map(jt=>this._layers[jt.id]),bt=nt[0];if(bt.visibility==="none")continue;const ft=bt.source||"";let it=this.familiesBySource[ft];it||(it=this.familiesBySource[ft]={});const dt=bt.sourceLayer||"_geojsonTileLayer";let qt=it[dt];qt||(qt=it[dt]=[]),qt.push(nt)}}}class w{constructor(V){const G={},J=[];for(const ft in V){const it=V[ft],dt=G[ft]={};for(const qt in it){const jt=it[+qt];if(!jt||jt.bitmap.width===0||jt.bitmap.height===0)continue;const Xt={x:0,y:0,w:jt.bitmap.width+2,h:jt.bitmap.height+2};J.push(Xt),dt[qt]={rect:Xt,metrics:jt.metrics}}}const{w:q,h:nt}=u.p(J),bt=new u.q({width:q||1,height:nt||1});for(const ft in V){const it=V[ft];for(const dt in it){const qt=it[+dt];if(!qt||qt.bitmap.width===0||qt.bitmap.height===0)continue;const jt=G[ft][dt].rect;u.q.copy(qt.bitmap,bt,{x:0,y:0},{x:jt.x+1,y:jt.y+1},qt.bitmap)}}this.image=bt,this.positions=G}}u.bm("GlyphAtlas",w);class C{constructor(V){this.tileID=new u.O(V.tileID.overscaledZ,V.tileID.wrap,V.tileID.canonical.z,V.tileID.canonical.x,V.tileID.canonical.y),this.uid=V.uid,this.zoom=V.zoom,this.pixelRatio=V.pixelRatio,this.tileSize=V.tileSize,this.source=V.source,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=V.showCollisionBoxes,this.collectResourceTiming=!!V.collectResourceTiming,this.returnDependencies=!!V.returnDependencies,this.promoteId=V.promoteId,this.inFlightDependencies=[],this.dependencySentinel=-1}parse(V,G,J,q,nt){this.status="parsing",this.data=V,this.collisionBoxArray=new u.a3;const bt=new u.bn(Object.keys(V.layers).sort()),ft=new u.bo(this.tileID,this.promoteId);ft.bucketLayerIDs=[];const it={},dt={featureIndex:ft,iconDependencies:{},patternDependencies:{},glyphDependencies:{},availableImages:J},qt=G.familiesBySource[this.source];for(const kn in qt){const Mn=V.layers[kn];if(!Mn)continue;Mn.version===1&&u.w(`Vector tile source "${this.source}" layer "${kn}" does not use vector tile spec v2 and therefore may have some rendering errors.`);const To=bt.encode(kn),mr=[];for(let Ti=0;Ti<Mn.length;Ti++){const Vi=Mn.feature(Ti),oa=ft.getId(Vi,kn);mr.push({feature:Vi,id:oa,index:Ti,sourceLayerIndex:To})}for(const Ti of qt[kn]){const Vi=Ti[0];Vi.source!==this.source&&u.w(`layer.source = ${Vi.source} does not equal this.source = ${this.source}`),Vi.minzoom&&this.zoom<Math.floor(Vi.minzoom)||Vi.maxzoom&&this.zoom>=Vi.maxzoom||Vi.visibility!=="none"&&(P(Ti,this.zoom,J),(it[Vi.id]=Vi.createBucket({index:ft.bucketLayerIDs.length,layers:Ti,zoom:this.zoom,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:To,sourceID:this.source})).populate(mr,dt,this.tileID.canonical),ft.bucketLayerIDs.push(Ti.map(oa=>oa.id)))}}let jt,Xt,Pe,Qe;const Le=u.aH(dt.glyphDependencies,kn=>Object.keys(kn).map(Number));this.inFlightDependencies.forEach(kn=>kn==null?void 0:kn.cancel()),this.inFlightDependencies=[];const ke=++this.dependencySentinel;Object.keys(Le).length?this.inFlightDependencies.push(q.send("getGlyphs",{uid:this.uid,stacks:Le,source:this.source,tileID:this.tileID,type:"glyphs"},(kn,Mn)=>{ke===this.dependencySentinel&&(jt||(jt=kn,Xt=Mn,yn.call(this)))})):Xt={};const on=Object.keys(dt.iconDependencies);on.length?this.inFlightDependencies.push(q.send("getImages",{icons:on,source:this.source,tileID:this.tileID,type:"icons"},(kn,Mn)=>{ke===this.dependencySentinel&&(jt||(jt=kn,Pe=Mn,yn.call(this)))})):Pe={};const ir=Object.keys(dt.patternDependencies);function yn(){if(jt)return nt(jt);if(Xt&&Pe&&Qe){const kn=new w(Xt),Mn=new u.bp(Pe,Qe);for(const To in it){const mr=it[To];mr instanceof u.a4?(P(mr.layers,this.zoom,J),u.bq({bucket:mr,glyphMap:Xt,glyphPositions:kn.positions,imageMap:Pe,imagePositions:Mn.iconPositions,showCollisionBoxes:this.showCollisionBoxes,canonical:this.tileID.canonical})):mr.hasPattern&&(mr instanceof u.br||mr instanceof u.bs||mr instanceof u.bt)&&(P(mr.layers,this.zoom,J),mr.addFeatures(dt,this.tileID.canonical,Mn.patternPositions))}this.status="done",nt(null,{buckets:Object.values(it).filter(To=>!To.isEmpty()),featureIndex:ft,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:kn.image,imageAtlas:Mn,glyphMap:this.returnDependencies?Xt:null,iconMap:this.returnDependencies?Pe:null,glyphPositions:this.returnDependencies?kn.positions:null})}}ir.length?this.inFlightDependencies.push(q.send("getImages",{icons:ir,source:this.source,tileID:this.tileID,type:"patterns"},(kn,Mn)=>{ke===this.dependencySentinel&&(jt||(jt=kn,Qe=Mn,yn.call(this)))})):Qe={},yn.call(this)}}function P(ot,V,G){const J=new u.a8(V);for(const q of ot)q.recalculate(J,G)}function D(ot,V){const G=u.l(ot.request,(J,q,nt,bt)=>{if(J)V(J);else if(q)try{const ft=new u.bw.VectorTile(new u.bv(q));V(null,{vectorTile:ft,rawData:q,cacheControl:nt,expires:bt})}catch(ft){const it=new Uint8Array(q);let dt=`Unable to parse the tile at ${ot.request.url}, `;dt+=it[0]===31&&it[1]===139?"please make sure the data is not gzipped and that you have configured the relevant header in the server":`got error: ${ft.messge}`,V(new Error(dt))}});return()=>{G.cancel(),V()}}class B{constructor(V,G,J,q){this.actor=V,this.layerIndex=G,this.availableImages=J,this.loadVectorData=q||D,this.fetching={},this.loading={},this.loaded={}}loadTile(V,G){const J=V.uid;this.loading||(this.loading={});const q=!!(V&&V.request&&V.request.collectResourceTiming)&&new u.bu(V.request),nt=this.loading[J]=new C(V);nt.abort=this.loadVectorData(V,(bt,ft)=>{if(delete this.loading[J],bt||!ft)return nt.status="done",this.loaded[J]=nt,G(bt);const it=ft.rawData,dt={};ft.expires&&(dt.expires=ft.expires),ft.cacheControl&&(dt.cacheControl=ft.cacheControl);const qt={};if(q){const jt=q.finish();jt&&(qt.resourceTiming=JSON.parse(JSON.stringify(jt)))}nt.vectorTile=ft.vectorTile,nt.parse(ft.vectorTile,this.layerIndex,this.availableImages,this.actor,(jt,Xt)=>{if(delete this.fetching[J],jt||!Xt)return G(jt);G(null,u.e({rawTileData:it.slice(0)},Xt,dt,qt))}),this.loaded=this.loaded||{},this.loaded[J]=nt,this.fetching[J]={rawTileData:it,cacheControl:dt,resourceTiming:qt}})}reloadTile(V,G){const J=this.loaded,q=V.uid;if(J&&J[q]){const nt=J[q];nt.showCollisionBoxes=V.showCollisionBoxes,nt.status==="parsing"?nt.parse(nt.vectorTile,this.layerIndex,this.availableImages,this.actor,(bt,ft)=>{if(bt||!ft)return G(bt,ft);let it;if(this.fetching[q]){const{rawTileData:dt,cacheControl:qt,resourceTiming:jt}=this.fetching[q];delete this.fetching[q],it=u.e({rawTileData:dt.slice(0)},ft,qt,jt)}else it=ft;G(null,it)}):nt.status==="done"&&(nt.vectorTile?nt.parse(nt.vectorTile,this.layerIndex,this.availableImages,this.actor,G):G())}}abortTile(V,G){const J=this.loading,q=V.uid;J&&J[q]&&J[q].abort&&(J[q].abort(),delete J[q]),G()}removeTile(V,G){const J=this.loaded,q=V.uid;J&&J[q]&&delete J[q],G()}}class ${constructor(){this.loaded={}}loadTile(V,G){return u._(this,void 0,void 0,function*(){const{uid:J,encoding:q,rawImageData:nt,redFactor:bt,greenFactor:ft,blueFactor:it,baseShift:dt}=V,qt=nt.width+2,jt=nt.height+2,Xt=u.a(nt)?new u.R({width:qt,height:jt},yield u.bx(nt,-1,-1,qt,jt)):nt,Pe=new u.by(J,Xt,q,bt,ft,it,dt);this.loaded=this.loaded||{},this.loaded[J]=Pe,G(null,Pe)})}removeTile(V){const G=this.loaded,J=V.uid;G&&G[J]&&delete G[J]}}function Z(ot,V){if(ot.length!==0){W(ot[0],V);for(var G=1;G<ot.length;G++)W(ot[G],!V)}}function W(ot,V){for(var G=0,J=0,q=0,nt=ot.length,bt=nt-1;q<nt;bt=q++){var ft=(ot[q][0]-ot[bt][0])*(ot[bt][1]+ot[q][1]),it=G+ft;J+=Math.abs(G)>=Math.abs(ft)?G-it+ft:ft-it+G,G=it}G+J>=0!=!!V&&ot.reverse()}var rt=u.bz(function ot(V,G){var J,q=V&&V.type;if(q==="FeatureCollection")for(J=0;J<V.features.length;J++)ot(V.features[J],G);else if(q==="GeometryCollection")for(J=0;J<V.geometries.length;J++)ot(V.geometries[J],G);else if(q==="Feature")ot(V.geometry,G);else if(q==="Polygon")Z(V.coordinates,G);else if(q==="MultiPolygon")for(J=0;J<V.coordinates.length;J++)Z(V.coordinates[J],G);return V});const ct=u.bw.VectorTileFeature.prototype.toGeoJSON;var pt={exports:{}},gt=u.bA,Ut=u.bw.VectorTileFeature,zt=Ot;function Ot(ot,V){this.options=V||{},this.features=ot,this.length=ot.length}function At(ot,V){this.id=typeof ot.id=="number"?ot.id:void 0,this.type=ot.type,this.rawGeometry=ot.type===1?[ot.geometry]:ot.geometry,this.properties=ot.tags,this.extent=V||4096}Ot.prototype.feature=function(ot){return new At(this.features[ot],this.options.extent)},At.prototype.loadGeometry=function(){var ot=this.rawGeometry;this.geometry=[];for(var V=0;V<ot.length;V++){for(var G=ot[V],J=[],q=0;q<G.length;q++)J.push(new gt(G[q][0],G[q][1]));this.geometry.push(J)}return this.geometry},At.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var ot=this.geometry,V=1/0,G=-1/0,J=1/0,q=-1/0,nt=0;nt<ot.length;nt++)for(var bt=ot[nt],ft=0;ft<bt.length;ft++){var it=bt[ft];V=Math.min(V,it.x),G=Math.max(G,it.x),J=Math.min(J,it.y),q=Math.max(q,it.y)}return[V,J,G,q]},At.prototype.toGeoJSON=Ut.prototype.toGeoJSON;var Rt=u.bB,Yt=zt;function be(ot){var V=new Rt;return function(G,J){for(var q in G.layers)J.writeMessage(3,Kt,G.layers[q])}(ot,V),V.finish()}function Kt(ot,V){var G;V.writeVarintField(15,ot.version||1),V.writeStringField(1,ot.name||""),V.writeVarintField(5,ot.extent||4096);var J={keys:[],values:[],keycache:{},valuecache:{}};for(G=0;G<ot.length;G++)J.feature=ot.feature(G),V.writeMessage(2,Ke,J);var q=J.keys;for(G=0;G<q.length;G++)V.writeStringField(3,q[G]);var nt=J.values;for(G=0;G<nt.length;G++)V.writeMessage(4,gn,nt[G])}function Ke(ot,V){var G=ot.feature;G.id!==void 0&&V.writeVarintField(1,G.id),V.writeMessage(2,vt,ot),V.writeVarintField(3,G.type),V.writeMessage(4,Ge,G)}function vt(ot,V){var G=ot.feature,J=ot.keys,q=ot.values,nt=ot.keycache,bt=ot.valuecache;for(var ft in G.properties){var it=G.properties[ft],dt=nt[ft];if(it!==null){dt===void 0&&(J.push(ft),nt[ft]=dt=J.length-1),V.writeVarint(dt);var qt=typeof it;qt!=="string"&&qt!=="boolean"&&qt!=="number"&&(it=JSON.stringify(it));var jt=qt+":"+it,Xt=bt[jt];Xt===void 0&&(q.push(it),bt[jt]=Xt=q.length-1),V.writeVarint(Xt)}}}function Qt(ot,V){return(V<<3)+(7&ot)}function Te(ot){return ot<<1^ot>>31}function Ge(ot,V){for(var G=ot.loadGeometry(),J=ot.type,q=0,nt=0,bt=G.length,ft=0;ft<bt;ft++){var it=G[ft],dt=1;J===1&&(dt=it.length),V.writeVarint(Qt(1,dt));for(var qt=J===3?it.length-1:it.length,jt=0;jt<qt;jt++){jt===1&&J!==1&&V.writeVarint(Qt(2,qt-1));var Xt=it[jt].x-q,Pe=it[jt].y-nt;V.writeVarint(Te(Xt)),V.writeVarint(Te(Pe)),q+=Xt,nt+=Pe}J===3&&V.writeVarint(Qt(7,1))}}function gn(ot,V){var G=typeof ot;G==="string"?V.writeStringField(1,ot):G==="boolean"?V.writeBooleanField(7,ot):G==="number"&&(ot%1!=0?V.writeDoubleField(3,ot):ot<0?V.writeSVarintField(6,ot):V.writeVarintField(5,ot))}pt.exports=be,pt.exports.fromVectorTileJs=be,pt.exports.fromGeojsonVt=function(ot,V){V=V||{};var G={};for(var J in ot)G[J]=new Yt(ot[J].features,V),G[J].name=J,G[J].version=V.version,G[J].extent=V.extent;return be({layers:G})},pt.exports.GeoJSONWrapper=Yt;var xn=u.bz(pt.exports);const ei={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:ot=>ot},jn=Math.fround||($n=new Float32Array(1),ot=>($n[0]=+ot,$n[0]));var $n;const Fe=3,Vn=5,rr=6;class ci{constructor(V){this.options=Object.assign(Object.create(ei),V),this.trees=new Array(this.options.maxZoom+1),this.stride=this.options.reduce?7:6,this.clusterProps=[]}load(V){const{log:G,minZoom:J,maxZoom:q}=this.options;G&&console.time("total time");const nt=`prepare ${V.length} points`;G&&console.time(nt),this.points=V;const bt=[];for(let it=0;it<V.length;it++){const dt=V[it];if(!dt.geometry)continue;const[qt,jt]=dt.geometry.coordinates,Xt=jn(br(qt)),Pe=jn(nn(jt));bt.push(Xt,Pe,1/0,it,-1,1),this.options.reduce&&bt.push(0)}let ft=this.trees[q+1]=this._createTree(bt);G&&console.timeEnd(nt);for(let it=q;it>=J;it--){const dt=+Date.now();ft=this.trees[it]=this._createTree(this._cluster(ft,it)),G&&console.log("z%d: %d clusters in %dms",it,ft.numItems,+Date.now()-dt)}return G&&console.timeEnd("total time"),this}getClusters(V,G){let J=((V[0]+180)%360+360)%360-180;const q=Math.max(-90,Math.min(90,V[1]));let nt=V[2]===180?180:((V[2]+180)%360+360)%360-180;const bt=Math.max(-90,Math.min(90,V[3]));if(V[2]-V[0]>=360)J=-180,nt=180;else if(J>nt){const jt=this.getClusters([J,q,180,bt],G),Xt=this.getClusters([-180,q,nt,bt],G);return jt.concat(Xt)}const ft=this.trees[this._limitZoom(G)],it=ft.range(br(J),nn(bt),br(nt),nn(q)),dt=ft.data,qt=[];for(const jt of it){const Xt=this.stride*jt;qt.push(dt[Xt+Vn]>1?fl(dt,Xt,this.clusterProps):this.points[dt[Xt+Fe]])}return qt}getChildren(V){const G=this._getOriginId(V),J=this._getOriginZoom(V),q="No cluster with the specified id.",nt=this.trees[J];if(!nt)throw new Error(q);const bt=nt.data;if(G*this.stride>=bt.length)throw new Error(q);const ft=this.options.radius/(this.options.extent*Math.pow(2,J-1)),it=nt.within(bt[G*this.stride],bt[G*this.stride+1],ft),dt=[];for(const qt of it){const jt=qt*this.stride;bt[jt+4]===V&&dt.push(bt[jt+Vn]>1?fl(bt,jt,this.clusterProps):this.points[bt[jt+Fe]])}if(dt.length===0)throw new Error(q);return dt}getLeaves(V,G,J){const q=[];return this._appendLeaves(q,V,G=G||10,J=J||0,0),q}getTile(V,G,J){const q=this.trees[this._limitZoom(V)],nt=Math.pow(2,V),{extent:bt,radius:ft}=this.options,it=ft/bt,dt=(J-it)/nt,qt=(J+1+it)/nt,jt={features:[]};return this._addTileFeatures(q.range((G-it)/nt,dt,(G+1+it)/nt,qt),q.data,G,J,nt,jt),G===0&&this._addTileFeatures(q.range(1-it/nt,dt,1,qt),q.data,nt,J,nt,jt),G===nt-1&&this._addTileFeatures(q.range(0,dt,it/nt,qt),q.data,-1,J,nt,jt),jt.features.length?jt:null}getClusterExpansionZoom(V){let G=this._getOriginZoom(V)-1;for(;G<=this.options.maxZoom;){const J=this.getChildren(V);if(G++,J.length!==1)break;V=J[0].properties.cluster_id}return G}_appendLeaves(V,G,J,q,nt){const bt=this.getChildren(G);for(const ft of bt){const it=ft.properties;if(it&&it.cluster?nt+it.point_count<=q?nt+=it.point_count:nt=this._appendLeaves(V,it.cluster_id,J,q,nt):nt<q?nt++:V.push(ft),V.length===J)break}return nt}_createTree(V){const G=new u.av(V.length/this.stride|0,this.options.nodeSize,Float32Array);for(let J=0;J<V.length;J+=this.stride)G.add(V[J],V[J+1]);return G.finish(),G.data=V,G}_addTileFeatures(V,G,J,q,nt,bt){for(const ft of V){const it=ft*this.stride,dt=G[it+Vn]>1;let qt,jt,Xt;if(dt)qt=ks(G,it,this.clusterProps),jt=G[it],Xt=G[it+1];else{const Le=this.points[G[it+Fe]];qt=Le.properties;const[ke,on]=Le.geometry.coordinates;jt=br(ke),Xt=nn(on)}const Pe={type:1,geometry:[[Math.round(this.options.extent*(jt*nt-J)),Math.round(this.options.extent*(Xt*nt-q))]],tags:qt};let Qe;Qe=dt||this.options.generateId?G[it+Fe]:this.points[G[it+Fe]].id,Qe!==void 0&&(Pe.id=Qe),bt.features.push(Pe)}}_limitZoom(V){return Math.max(this.options.minZoom,Math.min(Math.floor(+V),this.options.maxZoom+1))}_cluster(V,G){const{radius:J,extent:q,reduce:nt,minPoints:bt}=this.options,ft=J/(q*Math.pow(2,G)),it=V.data,dt=[],qt=this.stride;for(let jt=0;jt<it.length;jt+=qt){if(it[jt+2]<=G)continue;it[jt+2]=G;const Xt=it[jt],Pe=it[jt+1],Qe=V.within(it[jt],it[jt+1],ft),Le=it[jt+Vn];let ke=Le;for(const on of Qe){const ir=on*qt;it[ir+2]>G&&(ke+=it[ir+Vn])}if(ke>Le&&ke>=bt){let on,ir=Xt*Le,yn=Pe*Le,kn=-1;const Mn=((jt/qt|0)<<5)+(G+1)+this.points.length;for(const To of Qe){const mr=To*qt;if(it[mr+2]<=G)continue;it[mr+2]=G;const Ti=it[mr+Vn];ir+=it[mr]*Ti,yn+=it[mr+1]*Ti,it[mr+4]=Mn,nt&&(on||(on=this._map(it,jt,!0),kn=this.clusterProps.length,this.clusterProps.push(on)),nt(on,this._map(it,mr)))}it[jt+4]=Mn,dt.push(ir/ke,yn/ke,1/0,Mn,-1,ke),nt&&dt.push(kn)}else{for(let on=0;on<qt;on++)dt.push(it[jt+on]);if(ke>1)for(const on of Qe){const ir=on*qt;if(!(it[ir+2]<=G)){it[ir+2]=G;for(let yn=0;yn<qt;yn++)dt.push(it[ir+yn])}}}}return dt}_getOriginId(V){return V-this.points.length>>5}_getOriginZoom(V){return(V-this.points.length)%32}_map(V,G,J){if(V[G+Vn]>1){const bt=this.clusterProps[V[G+rr]];return J?Object.assign({},bt):bt}const q=this.points[V[G+Fe]].properties,nt=this.options.map(q);return J&&nt===q?Object.assign({},nt):nt}}function fl(ot,V,G){return{type:"Feature",id:ot[V+Fe],properties:ks(ot,V,G),geometry:{type:"Point",coordinates:[(J=ot[V],360*(J-.5)),dl(ot[V+1])]}};var J}function ks(ot,V,G){const J=ot[V+Vn],q=J>=1e4?`${Math.round(J/1e3)}k`:J>=1e3?Math.round(J/100)/10+"k":J,nt=ot[V+rr],bt=nt===-1?{}:Object.assign({},G[nt]);return Object.assign(bt,{cluster:!0,cluster_id:ot[V+Fe],point_count:J,point_count_abbreviated:q})}function br(ot){return ot/360+.5}function nn(ot){const V=Math.sin(ot*Math.PI/180),G=.5-.25*Math.log((1+V)/(1-V))/Math.PI;return G<0?0:G>1?1:G}function dl(ot){const V=(180-360*ot)*Math.PI/180;return 360*Math.atan(Math.exp(V))/Math.PI-90}function qo(ot,V,G,J){for(var q,nt=J,bt=G-V>>1,ft=G-V,it=ot[V],dt=ot[V+1],qt=ot[G],jt=ot[G+1],Xt=V+3;Xt<G;Xt+=3){var Pe=Fn(ot[Xt],ot[Xt+1],it,dt,qt,jt);if(Pe>nt)q=Xt,nt=Pe;else if(Pe===nt){var Qe=Math.abs(Xt-bt);Qe<ft&&(q=Xt,ft=Qe)}}nt>J&&(q-V>3&&qo(ot,V,q,J),ot[q+2]=nt,G-q>3&&qo(ot,q,G,J))}function Fn(ot,V,G,J,q,nt){var bt=q-G,ft=nt-J;if(bt!==0||ft!==0){var it=((ot-G)*bt+(V-J)*ft)/(bt*bt+ft*ft);it>1?(G=q,J=nt):it>0&&(G+=bt*it,J+=ft*it)}return(bt=ot-G)*bt+(ft=V-J)*ft}function Xn(ot,V,G,J){var q={id:ot===void 0?null:ot,type:V,geometry:G,tags:J,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};return function(nt){var bt=nt.geometry,ft=nt.type;if(ft==="Point"||ft==="MultiPoint"||ft==="LineString")mn(nt,bt);else if(ft==="Polygon"||ft==="MultiLineString")for(var it=0;it<bt.length;it++)mn(nt,bt[it]);else if(ft==="MultiPolygon")for(it=0;it<bt.length;it++)for(var dt=0;dt<bt[it].length;dt++)mn(nt,bt[it][dt])}(q),q}function mn(ot,V){for(var G=0;G<V.length;G+=3)ot.minX=Math.min(ot.minX,V[G]),ot.minY=Math.min(ot.minY,V[G+1]),ot.maxX=Math.max(ot.maxX,V[G]),ot.maxY=Math.max(ot.maxY,V[G+1])}function Un(ot,V,G,J){if(V.geometry){var q=V.geometry.coordinates,nt=V.geometry.type,bt=Math.pow(G.tolerance/((1<<G.maxZoom)*G.extent),2),ft=[],it=V.id;if(G.promoteId?it=V.properties[G.promoteId]:G.generateId&&(it=J||0),nt==="Point")Ci(q,ft);else if(nt==="MultiPoint")for(var dt=0;dt<q.length;dt++)Ci(q[dt],ft);else if(nt==="LineString")Yn(q,ft,bt,!1);else if(nt==="MultiLineString"){if(G.lineMetrics){for(dt=0;dt<q.length;dt++)Yn(q[dt],ft=[],bt,!1),ot.push(Xn(it,"LineString",ft,V.properties));return}no(q,ft,bt,!1)}else if(nt==="Polygon")no(q,ft,bt,!0);else{if(nt!=="MultiPolygon"){if(nt==="GeometryCollection"){for(dt=0;dt<V.geometry.geometries.length;dt++)Un(ot,{id:it,geometry:V.geometry.geometries[dt],properties:V.properties},G,J);return}throw new Error("Input data is not a valid GeoJSON object.")}for(dt=0;dt<q.length;dt++){var qt=[];no(q[dt],qt,bt,!0),ft.push(qt)}}ot.push(Xn(it,nt,ft,V.properties))}}function Ci(ot,V){V.push(Vt(ot[0])),V.push(hi(ot[1])),V.push(0)}function Yn(ot,V,G,J){for(var q,nt,bt=0,ft=0;ft<ot.length;ft++){var it=Vt(ot[ft][0]),dt=hi(ot[ft][1]);V.push(it),V.push(dt),V.push(0),ft>0&&(bt+=J?(q*dt-it*nt)/2:Math.sqrt(Math.pow(it-q,2)+Math.pow(dt-nt,2))),q=it,nt=dt}var qt=V.length-3;V[2]=1,qo(V,0,qt,G),V[qt+2]=1,V.size=Math.abs(bt),V.start=0,V.end=V.size}function no(ot,V,G,J){for(var q=0;q<ot.length;q++){var nt=[];Yn(ot[q],nt,G,J),V.push(nt)}}function Vt(ot){return ot/360+.5}function hi(ot){var V=Math.sin(ot*Math.PI/180),G=.5-.25*Math.log((1+V)/(1-V))/Math.PI;return G<0?0:G>1?1:G}function $i(ot,V,G,J,q,nt,bt,ft){if(J/=V,nt>=(G/=V)&&bt<J)return ot;if(bt<G||nt>=J)return null;for(var it=[],dt=0;dt<ot.length;dt++){var qt=ot[dt],jt=qt.geometry,Xt=qt.type,Pe=q===0?qt.minX:qt.minY,Qe=q===0?qt.maxX:qt.maxY;if(Pe>=G&&Qe<J)it.push(qt);else if(!(Qe<G||Pe>=J)){var Le=[];if(Xt==="Point"||Xt==="MultiPoint")Gn(jt,Le,G,J,q);else if(Xt==="LineString")vn(jt,Le,G,J,q,!1,ft.lineMetrics);else if(Xt==="MultiLineString")pi(jt,Le,G,J,q,!1);else if(Xt==="Polygon")pi(jt,Le,G,J,q,!0);else if(Xt==="MultiPolygon")for(var ke=0;ke<jt.length;ke++){var on=[];pi(jt[ke],on,G,J,q,!0),on.length&&Le.push(on)}if(Le.length){if(ft.lineMetrics&&Xt==="LineString"){for(ke=0;ke<Le.length;ke++)it.push(Xn(qt.id,Xt,Le[ke],qt.tags));continue}Xt!=="LineString"&&Xt!=="MultiLineString"||(Le.length===1?(Xt="LineString",Le=Le[0]):Xt="MultiLineString"),Xt!=="Point"&&Xt!=="MultiPoint"||(Xt=Le.length===3?"Point":"MultiPoint"),it.push(Xn(qt.id,Xt,Le,qt.tags))}}}return it.length?it:null}function Gn(ot,V,G,J,q){for(var nt=0;nt<ot.length;nt+=3){var bt=ot[nt+q];bt>=G&&bt<=J&&(V.push(ot[nt]),V.push(ot[nt+1]),V.push(ot[nt+2]))}}function vn(ot,V,G,J,q,nt,bt){for(var ft,it,dt=zs(ot),qt=q===0?Ta:ra,jt=ot.start,Xt=0;Xt<ot.length-3;Xt+=3){var Pe=ot[Xt],Qe=ot[Xt+1],Le=ot[Xt+2],ke=ot[Xt+3],on=ot[Xt+4],ir=q===0?Pe:Qe,yn=q===0?ke:on,kn=!1;bt&&(ft=Math.sqrt(Math.pow(Pe-ke,2)+Math.pow(Qe-on,2))),ir<G?yn>G&&(it=qt(dt,Pe,Qe,ke,on,G),bt&&(dt.start=jt+ft*it)):ir>J?yn<J&&(it=qt(dt,Pe,Qe,ke,on,J),bt&&(dt.start=jt+ft*it)):os(dt,Pe,Qe,Le),yn<G&&ir>=G&&(it=qt(dt,Pe,Qe,ke,on,G),kn=!0),yn>J&&ir<=J&&(it=qt(dt,Pe,Qe,ke,on,J),kn=!0),!nt&&kn&&(bt&&(dt.end=jt+ft*it),V.push(dt),dt=zs(ot)),bt&&(jt+=ft)}var Mn=ot.length-3;Pe=ot[Mn],Qe=ot[Mn+1],Le=ot[Mn+2],(ir=q===0?Pe:Qe)>=G&&ir<=J&&os(dt,Pe,Qe,Le),Mn=dt.length-3,nt&&Mn>=3&&(dt[Mn]!==dt[0]||dt[Mn+1]!==dt[1])&&os(dt,dt[0],dt[1],dt[2]),dt.length&&V.push(dt)}function zs(ot){var V=[];return V.size=ot.size,V.start=ot.start,V.end=ot.end,V}function pi(ot,V,G,J,q,nt){for(var bt=0;bt<ot.length;bt++)vn(ot[bt],V,G,J,q,nt,!1)}function os(ot,V,G,J){ot.push(V),ot.push(G),ot.push(J)}function Ta(ot,V,G,J,q,nt){var bt=(nt-V)/(J-V);return ot.push(nt),ot.push(G+(q-G)*bt),ot.push(1),bt}function ra(ot,V,G,J,q,nt){var bt=(nt-G)/(q-G);return ot.push(V+(J-V)*bt),ot.push(nt),ot.push(1),bt}function ss(ot,V){for(var G=[],J=0;J<ot.length;J++){var q,nt=ot[J],bt=nt.type;if(bt==="Point"||bt==="MultiPoint"||bt==="LineString")q=ia(nt.geometry,V);else if(bt==="MultiLineString"||bt==="Polygon"){q=[];for(var ft=0;ft<nt.geometry.length;ft++)q.push(ia(nt.geometry[ft],V))}else if(bt==="MultiPolygon")for(q=[],ft=0;ft<nt.geometry.length;ft++){for(var it=[],dt=0;dt<nt.geometry[ft].length;dt++)it.push(ia(nt.geometry[ft][dt],V));q.push(it)}G.push(Xn(nt.id,bt,q,nt.tags))}return G}function ia(ot,V){var G=[];G.size=ot.size,ot.start!==void 0&&(G.start=ot.start,G.end=ot.end);for(var J=0;J<ot.length;J+=3)G.push(ot[J]+V,ot[J+1],ot[J+2]);return G}function se(ot,V){if(ot.transformed)return ot;var G,J,q,nt=1<<ot.z,bt=ot.x,ft=ot.y;for(G=0;G<ot.features.length;G++){var it=ot.features[G],dt=it.geometry,qt=it.type;if(it.geometry=[],qt===1)for(J=0;J<dt.length;J+=2)it.geometry.push(uo(dt[J],dt[J+1],V,nt,bt,ft));else for(J=0;J<dt.length;J++){var jt=[];for(q=0;q<dt[J].length;q+=2)jt.push(uo(dt[J][q],dt[J][q+1],V,nt,bt,ft));it.geometry.push(jt)}}return ot.transformed=!0,ot}function uo(ot,V,G,J,q,nt){return[Math.round(G*(ot*J-q)),Math.round(G*(V*J-nt))]}function wr(ot,V,G,J,q){for(var nt=V===q.maxZoom?0:q.tolerance/((1<<V)*q.extent),bt={features:[],numPoints:0,numSimplified:0,numFeatures:0,source:null,x:G,y:J,z:V,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0},ft=0;ft<ot.length;ft++){bt.numFeatures++,Au(bt,ot[ft],nt,q);var it=ot[ft].minX,dt=ot[ft].minY,qt=ot[ft].maxX,jt=ot[ft].maxY;it<bt.minX&&(bt.minX=it),dt<bt.minY&&(bt.minY=dt),qt>bt.maxX&&(bt.maxX=qt),jt>bt.maxY&&(bt.maxY=jt)}return bt}function Au(ot,V,G,J){var q=V.geometry,nt=V.type,bt=[];if(nt==="Point"||nt==="MultiPoint")for(var ft=0;ft<q.length;ft+=3)bt.push(q[ft]),bt.push(q[ft+1]),ot.numPoints++,ot.numSimplified++;else if(nt==="LineString")Co(bt,q,ot,G,!1,!1);else if(nt==="MultiLineString"||nt==="Polygon")for(ft=0;ft<q.length;ft++)Co(bt,q[ft],ot,G,nt==="Polygon",ft===0);else if(nt==="MultiPolygon")for(var it=0;it<q.length;it++){var dt=q[it];for(ft=0;ft<dt.length;ft++)Co(bt,dt[ft],ot,G,!0,ft===0)}if(bt.length){var qt=V.tags||null;if(nt==="LineString"&&J.lineMetrics){for(var jt in qt={},V.tags)qt[jt]=V.tags[jt];qt.mapbox_clip_start=q.start/q.size,qt.mapbox_clip_end=q.end/q.size}var Xt={geometry:bt,type:nt==="Polygon"||nt==="MultiPolygon"?3:nt==="LineString"||nt==="MultiLineString"?2:1,tags:qt};V.id!==null&&(Xt.id=V.id),ot.features.push(Xt)}}function Co(ot,V,G,J,q,nt){var bt=J*J;if(J>0&&V.size<(q?bt:J))G.numPoints+=V.length/3;else{for(var ft=[],it=0;it<V.length;it+=3)(J===0||V[it+2]>bt)&&(G.numSimplified++,ft.push(V[it]),ft.push(V[it+1])),G.numPoints++;q&&function(dt,qt){for(var jt=0,Xt=0,Pe=dt.length,Qe=Pe-2;Xt<Pe;Qe=Xt,Xt+=2)jt+=(dt[Xt]-dt[Qe])*(dt[Xt+1]+dt[Qe+1]);if(jt>0===qt)for(Xt=0,Pe=dt.length;Xt<Pe/2;Xt+=2){var Le=dt[Xt],ke=dt[Xt+1];dt[Xt]=dt[Pe-2-Xt],dt[Xt+1]=dt[Pe-1-Xt],dt[Pe-2-Xt]=Le,dt[Pe-1-Xt]=ke}}(ft,nt),ot.push(ft)}}function le(ot,V){var G=(V=this.options=function(q,nt){for(var bt in nt)q[bt]=nt[bt];return q}(Object.create(this.options),V)).debug;if(G&&console.time("preprocess data"),V.maxZoom<0||V.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(V.promoteId&&V.generateId)throw new Error("promoteId and generateId cannot be used together.");var J=function(q,nt){var bt=[];if(q.type==="FeatureCollection")for(var ft=0;ft<q.features.length;ft++)Un(bt,q.features[ft],nt,ft);else Un(bt,q.type==="Feature"?q:{geometry:q},nt);return bt}(ot,V);this.tiles={},this.tileCoords=[],G&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",V.indexMaxZoom,V.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),J=function(q,nt){var bt=nt.buffer/nt.extent,ft=q,it=$i(q,1,-1-bt,bt,0,-1,2,nt),dt=$i(q,1,1-bt,2+bt,0,-1,2,nt);return(it||dt)&&(ft=$i(q,1,-bt,1+bt,0,-1,2,nt)||[],it&&(ft=ss(it,1).concat(ft)),dt&&(ft=ft.concat(ss(dt,-1)))),ft}(J,V),J.length&&this.splitTile(J,0,0,0),G&&(J.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}function an(ot,V,G){return 32*((1<<ot)*G+V)+ot}function Ye(ot,V){return V?ot.properties[V]:ot.id}function ro(ot,V){if(ot==null)return!0;if(ot.type==="Feature")return Ye(ot,V)!=null;if(ot.type==="FeatureCollection"){const G=new Set;for(const J of ot.features){const q=Ye(J,V);if(q==null||G.has(q))return!1;G.add(q)}return!0}return!1}function jo(ot,V){const G=new Map;if(ot!=null)if(ot.type==="Feature")G.set(Ye(ot,V),ot);else for(const J of ot.features)G.set(Ye(J,V),J);return G}le.prototype.options={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0},le.prototype.splitTile=function(ot,V,G,J,q,nt,bt){for(var ft=[ot,V,G,J],it=this.options,dt=it.debug;ft.length;){J=ft.pop(),G=ft.pop(),V=ft.pop(),ot=ft.pop();var qt=1<<V,jt=an(V,G,J),Xt=this.tiles[jt];if(!Xt&&(dt>1&&console.time("creation"),Xt=this.tiles[jt]=wr(ot,V,G,J,it),this.tileCoords.push({z:V,x:G,y:J}),dt)){dt>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",V,G,J,Xt.numFeatures,Xt.numPoints,Xt.numSimplified),console.timeEnd("creation"));var Pe="z"+V;this.stats[Pe]=(this.stats[Pe]||0)+1,this.total++}if(Xt.source=ot,q){if(V===it.maxZoom||V===q)continue;var Qe=1<<q-V;if(G!==Math.floor(nt/Qe)||J!==Math.floor(bt/Qe))continue}else if(V===it.indexMaxZoom||Xt.numPoints<=it.indexMaxPoints)continue;if(Xt.source=null,ot.length!==0){dt>1&&console.time("clipping");var Le,ke,on,ir,yn,kn,Mn=.5*it.buffer/it.extent,To=.5-Mn,mr=.5+Mn,Ti=1+Mn;Le=ke=on=ir=null,yn=$i(ot,qt,G-Mn,G+mr,0,Xt.minX,Xt.maxX,it),kn=$i(ot,qt,G+To,G+Ti,0,Xt.minX,Xt.maxX,it),ot=null,yn&&(Le=$i(yn,qt,J-Mn,J+mr,1,Xt.minY,Xt.maxY,it),ke=$i(yn,qt,J+To,J+Ti,1,Xt.minY,Xt.maxY,it),yn=null),kn&&(on=$i(kn,qt,J-Mn,J+mr,1,Xt.minY,Xt.maxY,it),ir=$i(kn,qt,J+To,J+Ti,1,Xt.minY,Xt.maxY,it),kn=null),dt>1&&console.timeEnd("clipping"),ft.push(Le||[],V+1,2*G,2*J),ft.push(ke||[],V+1,2*G,2*J+1),ft.push(on||[],V+1,2*G+1,2*J),ft.push(ir||[],V+1,2*G+1,2*J+1)}}},le.prototype.getTile=function(ot,V,G){var J=this.options,q=J.extent,nt=J.debug;if(ot<0||ot>24)return null;var bt=1<<ot,ft=an(ot,V=(V%bt+bt)%bt,G);if(this.tiles[ft])return se(this.tiles[ft],q);nt>1&&console.log("drilling down to z%d-%d-%d",ot,V,G);for(var it,dt=ot,qt=V,jt=G;!it&&dt>0;)dt--,qt=Math.floor(qt/2),jt=Math.floor(jt/2),it=this.tiles[an(dt,qt,jt)];return it&&it.source?(nt>1&&console.log("found parent tile z%d-%d-%d",dt,qt,jt),nt>1&&console.time("drilling down"),this.splitTile(it.source,dt,qt,jt,ot,V,G),nt>1&&console.timeEnd("drilling down"),this.tiles[ft]?se(this.tiles[ft],q):null):null};class je extends B{constructor(V,G,J,q){super(V,G,J),this._dataUpdateable=new Map,this.loadGeoJSON=(nt,bt)=>{const{promoteId:ft}=nt;if(nt.request)return u.f(nt.request,(it,dt,qt,jt)=>{this._dataUpdateable=ro(dt,ft)?jo(dt,ft):void 0,bt(it,dt,qt,jt)});if(typeof nt.data=="string")try{const it=JSON.parse(nt.data);this._dataUpdateable=ro(it,ft)?jo(it,ft):void 0,bt(null,it)}catch{bt(new Error(`Input data given to '${nt.source}' is not a valid GeoJSON object.`))}else nt.dataDiff?this._dataUpdateable?(function(it,dt,qt){var jt,Xt,Pe,Qe;if(dt.removeAll&&it.clear(),dt.remove)for(const Le of dt.remove)it.delete(Le);if(dt.add)for(const Le of dt.add){const ke=Ye(Le,qt);ke!=null&&it.set(ke,Le)}if(dt.update)for(const Le of dt.update){let ke=it.get(Le.id);if(ke==null)continue;const on=!Le.removeAllProperties&&(((jt=Le.removeProperties)===null||jt===void 0?void 0:jt.length)>0||((Xt=Le.addOrUpdateProperties)===null||Xt===void 0?void 0:Xt.length)>0);if((Le.newGeometry||Le.removeAllProperties||on)&&(ke=Object.assign({},ke),it.set(Le.id,ke),on&&(ke.properties=Object.assign({},ke.properties))),Le.newGeometry&&(ke.geometry=Le.newGeometry),Le.removeAllProperties)ke.properties={};else if(((Pe=Le.removeProperties)===null||Pe===void 0?void 0:Pe.length)>0)for(const ir of Le.removeProperties)Object.prototype.hasOwnProperty.call(ke.properties,ir)&&delete ke.properties[ir];if(((Qe=Le.addOrUpdateProperties)===null||Qe===void 0?void 0:Qe.length)>0)for(const{key:ir,value:yn}of Le.addOrUpdateProperties)ke.properties[ir]=yn}}(this._dataUpdateable,nt.dataDiff,ft),bt(null,{type:"FeatureCollection",features:Array.from(this._dataUpdateable.values())})):bt(new Error(`Cannot update existing geojson data in ${nt.source}`)):bt(new Error(`Input data given to '${nt.source}' is not a valid GeoJSON object.`));return{cancel:()=>{}}},this.loadVectorData=this.loadGeoJSONTile,q&&(this.loadGeoJSON=q)}loadGeoJSONTile(V,G){const J=V.tileID.canonical;if(!this._geoJSONIndex)return G(null,null);const q=this._geoJSONIndex.getTile(J.z,J.x,J.y);if(!q)return G(null,null);const nt=new class{constructor(ft){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=u.N,this.length=ft.length,this._features=ft}feature(ft){return new class{constructor(it){this._feature=it,this.extent=u.N,this.type=it.type,this.properties=it.tags,"id"in it&&!isNaN(it.id)&&(this.id=parseInt(it.id,10))}loadGeometry(){if(this._feature.type===1){const it=[];for(const dt of this._feature.geometry)it.push([new u.P(dt[0],dt[1])]);return it}{const it=[];for(const dt of this._feature.geometry){const qt=[];for(const jt of dt)qt.push(new u.P(jt[0],jt[1]));it.push(qt)}return it}}toGeoJSON(it,dt,qt){return ct.call(this,it,dt,qt)}}(this._features[ft])}}(q.features);let bt=xn(nt);bt.byteOffset===0&&bt.byteLength===bt.buffer.byteLength||(bt=new Uint8Array(bt)),G(null,{vectorTile:nt,rawData:bt.buffer})}loadData(V,G){var J;(J=this._pendingRequest)===null||J===void 0||J.cancel(),this._pendingCallback&&this._pendingCallback(null,{abandoned:!0});const q=!!(V&&V.request&&V.request.collectResourceTiming)&&new u.bu(V.request);this._pendingCallback=G,this._pendingRequest=this.loadGeoJSON(V,(nt,bt)=>{if(delete this._pendingCallback,delete this._pendingRequest,nt||!bt)return G(nt);if(typeof bt!="object")return G(new Error(`Input data given to '${V.source}' is not a valid GeoJSON object.`));{rt(bt,!0);try{if(V.filter){const it=u.bC(V.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if(it.result==="error")throw new Error(it.value.map(dt=>`${dt.key}: ${dt.message}`).join(", "));bt={type:"FeatureCollection",features:bt.features.filter(dt=>it.value.evaluate({zoom:0},dt))}}this._geoJSONIndex=V.cluster?new ci(function({superclusterOptions:it,clusterProperties:dt}){if(!dt||!it)return it;const qt={},jt={},Xt={accumulated:null,zoom:0},Pe={properties:null},Qe=Object.keys(dt);for(const Le of Qe){const[ke,on]=dt[Le],ir=u.bC(on),yn=u.bC(typeof ke=="string"?[ke,["accumulated"],["get",Le]]:ke);qt[Le]=ir.value,jt[Le]=yn.value}return it.map=Le=>{Pe.properties=Le;const ke={};for(const on of Qe)ke[on]=qt[on].evaluate(Xt,Pe);return ke},it.reduce=(Le,ke)=>{Pe.properties=ke;for(const on of Qe)Xt.accumulated=Le[on],Le[on]=jt[on].evaluate(Xt,Pe)},it}(V)).load(bt.features):function(it,dt){return new le(it,dt)}(bt,V.geojsonVtOptions)}catch(it){return G(it)}this.loaded={};const ft={};if(q){const it=q.finish();it&&(ft.resourceTiming={},ft.resourceTiming[V.source]=JSON.parse(JSON.stringify(it)))}G(null,ft)}})}reloadTile(V,G){const J=this.loaded;return J&&J[V.uid]?super.reloadTile(V,G):this.loadTile(V,G)}removeSource(V,G){this._pendingCallback&&this._pendingCallback(null,{abandoned:!0}),G()}getClusterExpansionZoom(V,G){try{G(null,this._geoJSONIndex.getClusterExpansionZoom(V.clusterId))}catch(J){G(J)}}getClusterChildren(V,G){try{G(null,this._geoJSONIndex.getChildren(V.clusterId))}catch(J){G(J)}}getClusterLeaves(V,G){try{G(null,this._geoJSONIndex.getLeaves(V.clusterId,V.limit,V.offset))}catch(J){G(J)}}}class as{constructor(V){this.self=V,this.actor=new u.C(V,this),this.layerIndexes={},this.availableImages={},this.workerSourceTypes={vector:B,geojson:je},this.workerSources={},this.demWorkerSources={},this.self.registerWorkerSource=(G,J)=>{if(this.workerSourceTypes[G])throw new Error(`Worker source with name "${G}" already registered.`);this.workerSourceTypes[G]=J},this.self.registerRTLTextPlugin=G=>{if(u.bD.isParsed())throw new Error("RTL text plugin already registered.");u.bD.applyArabicShaping=G.applyArabicShaping,u.bD.processBidirectionalText=G.processBidirectionalText,u.bD.processStyledBidirectionalText=G.processStyledBidirectionalText}}setReferrer(V,G){this.referrer=G}setImages(V,G,J){this.availableImages[V]=G;for(const q in this.workerSources[V]){const nt=this.workerSources[V][q];for(const bt in nt)nt[bt].availableImages=G}J()}setLayers(V,G,J){this.getLayerIndex(V).replace(G),J()}updateLayers(V,G,J){this.getLayerIndex(V).update(G.layers,G.removedIds),J()}loadTile(V,G,J){this.getWorkerSource(V,G.type,G.source).loadTile(G,J)}loadDEMTile(V,G,J){this.getDEMWorkerSource(V,G.source).loadTile(G,J)}reloadTile(V,G,J){this.getWorkerSource(V,G.type,G.source).reloadTile(G,J)}abortTile(V,G,J){this.getWorkerSource(V,G.type,G.source).abortTile(G,J)}removeTile(V,G,J){this.getWorkerSource(V,G.type,G.source).removeTile(G,J)}removeDEMTile(V,G){this.getDEMWorkerSource(V,G.source).removeTile(G)}removeSource(V,G,J){if(!this.workerSources[V]||!this.workerSources[V][G.type]||!this.workerSources[V][G.type][G.source])return;const q=this.workerSources[V][G.type][G.source];delete this.workerSources[V][G.type][G.source],q.removeSource!==void 0?q.removeSource(G,J):J()}loadWorkerSource(V,G,J){try{this.self.importScripts(G.url),J()}catch(q){J(q.toString())}}syncRTLPluginState(V,G,J){try{u.bD.setState(G);const q=u.bD.getPluginURL();if(u.bD.isLoaded()&&!u.bD.isParsed()&&q!=null){this.self.importScripts(q);const nt=u.bD.isParsed();J(nt?void 0:new Error(`RTL Text Plugin failed to import scripts from ${q}`),nt)}}catch(q){J(q.toString())}}getAvailableImages(V){let G=this.availableImages[V];return G||(G=[]),G}getLayerIndex(V){let G=this.layerIndexes[V];return G||(G=this.layerIndexes[V]=new _),G}getWorkerSource(V,G,J){return this.workerSources[V]||(this.workerSources[V]={}),this.workerSources[V][G]||(this.workerSources[V][G]={}),this.workerSources[V][G][J]||(this.workerSources[V][G][J]=new this.workerSourceTypes[G]({send:(q,nt,bt)=>{this.actor.send(q,nt,bt,V)}},this.getLayerIndex(V),this.getAvailableImages(V))),this.workerSources[V][G][J]}getDEMWorkerSource(V,G){return this.demWorkerSources[V]||(this.demWorkerSources[V]={}),this.demWorkerSources[V][G]||(this.demWorkerSources[V][G]=new $),this.demWorkerSources[V][G]}}return u.i()&&(self.worker=new as(self)),as}),a(["./shared"],function(u){var _="3.6.2";class w{static testProp(s){if(!w.docStyle)return s[0];for(let p=0;p<s.length;p++)if(s[p]in w.docStyle)return s[p];return s[0]}static create(s,p,d){const m=window.document.createElement(s);return p!==void 0&&(m.className=p),d&&d.appendChild(m),m}static createNS(s,p){return window.document.createElementNS(s,p)}static disableDrag(){w.docStyle&&w.selectProp&&(w.userSelect=w.docStyle[w.selectProp],w.docStyle[w.selectProp]="none")}static enableDrag(){w.docStyle&&w.selectProp&&(w.docStyle[w.selectProp]=w.userSelect)}static setTransform(s,p){s.style[w.transformProp]=p}static addEventListener(s,p,d,m={}){s.addEventListener(p,d,"passive"in m?m:m.capture)}static removeEventListener(s,p,d,m={}){s.removeEventListener(p,d,"passive"in m?m:m.capture)}static suppressClickInternal(s){s.preventDefault(),s.stopPropagation(),window.removeEventListener("click",w.suppressClickInternal,!0)}static suppressClick(){window.addEventListener("click",w.suppressClickInternal,!0),window.setTimeout(()=>{window.removeEventListener("click",w.suppressClickInternal,!0)},0)}static mousePos(s,p){const d=s.getBoundingClientRect();return new u.P(p.clientX-d.left-s.clientLeft,p.clientY-d.top-s.clientTop)}static touchPos(s,p){const d=s.getBoundingClientRect(),m=[];for(let v=0;v<p.length;v++)m.push(new u.P(p[v].clientX-d.left-s.clientLeft,p[v].clientY-d.top-s.clientTop));return m}static mouseButton(s){return s.button}static remove(s){s.parentNode&&s.parentNode.removeChild(s)}}w.docStyle=typeof window<"u"&&window.document&&window.document.documentElement.style,w.selectProp=w.testProp(["userSelect","MozUserSelect","WebkitUserSelect","msUserSelect"]),w.transformProp=w.testProp(["transform","WebkitTransform"]);const C={supported:!1,testSupport:function(y){!B&&D&&($?Z(y):P=y)}};let P,D,B=!1,$=!1;function Z(y){const s=y.createTexture();y.bindTexture(y.TEXTURE_2D,s);try{if(y.texImage2D(y.TEXTURE_2D,0,y.RGBA,y.RGBA,y.UNSIGNED_BYTE,D),y.isContextLost())return;C.supported=!0}catch{}y.deleteTexture(s),B=!0}var W,rt;typeof document<"u"&&(D=document.createElement("img"),D.onload=function(){P&&Z(P),P=null,$=!0},D.onerror=function(){B=!0,P=null},D.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA="),function(y){let s,p,d,m;y.resetRequestQueue=()=>{s=[],p=0,d=0,m={}},y.addThrottleControl=O=>{const F=d++;return m[F]=O,F},y.removeThrottleControl=O=>{delete m[O],T()},y.getImage=(O,F,k=!0)=>{C.supported&&(O.headers||(O.headers={}),O.headers.accept="image/webp,*/*");const j={requestParameters:O,supportImageRefresh:k,callback:F,cancelled:!1,completed:!1,cancel:()=>{j.completed||j.cancelled||(j.cancelled=!0,j.innerRequest&&(j.innerRequest.cancel(),p--),T())}};return s.push(j),T(),j};const v=O=>{const{requestParameters:F,supportImageRefresh:k,callback:j}=O;return u.e(F,{type:"image"}),(k!==!1||u.i()||u.g(F.url)||F.headers&&!Object.keys(F.headers).reduce((tt,et)=>tt&&et==="accept",!0)?u.m:N)(F,(tt,et,st,K)=>{S(O,j,tt,et,st,K)})},S=(O,F,k,j,tt,et)=>{k?F(k):j instanceof HTMLImageElement||u.a(j)?F(null,j):j&&((st,K)=>{typeof createImageBitmap=="function"?u.b(st,K):u.d(st,K)})(j,(st,K)=>{st!=null?F(st):K!=null&&F(null,K,{cacheControl:tt,expires:et})}),O.cancelled||(O.completed=!0,p--,T())},T=()=>{const O=(()=>{const F=Object.keys(m);let k=!1;if(F.length>0){for(const j of F)if(k=m[j](),k)break}return k})()?u.c.MAX_PARALLEL_IMAGE_REQUESTS_PER_FRAME:u.c.MAX_PARALLEL_IMAGE_REQUESTS;for(let F=p;F<O&&s.length>0;F++){const k=s.shift();if(k.cancelled){F--;continue}const j=v(k);p++,k.innerRequest=j}},N=(O,F)=>{const k=new Image,j=O.url;let tt=!1;const et=O.credentials;return et&&et==="include"?k.crossOrigin="use-credentials":(et&&et==="same-origin"||!u.s(j))&&(k.crossOrigin="anonymous"),k.fetchPriority="high",k.onload=()=>{F(null,k),k.onerror=k.onload=null},k.onerror=()=>{tt||F(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.")),k.onerror=k.onload=null},k.src=j,{cancel:()=>{tt=!0,k.src=""}}}}(W||(W={})),W.resetRequestQueue(),function(y){y.Glyphs="Glyphs",y.Image="Image",y.Source="Source",y.SpriteImage="SpriteImage",y.SpriteJSON="SpriteJSON",y.Style="Style",y.Tile="Tile",y.Unknown="Unknown"}(rt||(rt={}));class ct{constructor(s){this._transformRequestFn=s}transformRequest(s,p){return this._transformRequestFn&&this._transformRequestFn(s,p)||{url:s}}normalizeSpriteURL(s,p,d){const m=function(v){const S=v.match(pt);if(!S)throw new Error(`Unable to parse URL "${v}"`);return{protocol:S[1],authority:S[2],path:S[3]||"/",params:S[4]?S[4].split("&"):[]}}(s);return m.path+=`${p}${d}`,function(v){const S=v.params.length?`?${v.params.join("&")}`:"";return`${v.protocol}://${v.authority}${v.path}${S}`}(m)}setTransformRequest(s){this._transformRequestFn=s}}const pt=/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;function gt(y){var s=new u.A(3);return s[0]=y[0],s[1]=y[1],s[2]=y[2],s}var Ut,zt=function(y,s,p){return y[0]=s[0]-p[0],y[1]=s[1]-p[1],y[2]=s[2]-p[2],y};Ut=new u.A(3),u.A!=Float32Array&&(Ut[0]=0,Ut[1]=0,Ut[2]=0);var Ot=function(y){var s=y[0],p=y[1];return s*s+p*p};function At(y){const s=[];if(typeof y=="string")s.push({id:"default",url:y});else if(y&&y.length>0){const p=[];for(const{id:d,url:m}of y){const v=`${d}${m}`;p.indexOf(v)===-1&&(p.push(v),s.push({id:d,url:m}))}}return s}function Rt(y,s,p,d,m){if(d)return void y(d);if(m!==Object.values(s).length||m!==Object.values(p).length)return;const v={};for(const S in s){v[S]={};const T=u.h.getImageCanvasContext(p[S]),N=s[S];for(const O in N){const{width:F,height:k,x:j,y:tt,sdf:et,pixelRatio:st,stretchX:K,stretchY:xt,content:Nt}=N[O];v[S][O]={data:null,pixelRatio:st,sdf:et,stretchX:K,stretchY:xt,content:Nt,spriteData:{width:F,height:k,x:j,y:tt,context:T}}}}y(null,v)}(function(){var y=new u.A(2);u.A!=Float32Array&&(y[0]=0,y[1]=0)})();class Yt{constructor(s,p,d,m){this.context=s,this.format=d,this.texture=s.gl.createTexture(),this.update(p,m)}update(s,p,d){const{width:m,height:v}=s,S=!(this.size&&this.size[0]===m&&this.size[1]===v||d),{context:T}=this,{gl:N}=T;if(this.useMipmap=!!(p&&p.useMipmap),N.bindTexture(N.TEXTURE_2D,this.texture),T.pixelStoreUnpackFlipY.set(!1),T.pixelStoreUnpack.set(1),T.pixelStoreUnpackPremultiplyAlpha.set(this.format===N.RGBA&&(!p||p.premultiply!==!1)),S)this.size=[m,v],s instanceof HTMLImageElement||s instanceof HTMLCanvasElement||s instanceof HTMLVideoElement||s instanceof ImageData||u.a(s)?N.texImage2D(N.TEXTURE_2D,0,this.format,this.format,N.UNSIGNED_BYTE,s):N.texImage2D(N.TEXTURE_2D,0,this.format,m,v,0,this.format,N.UNSIGNED_BYTE,s.data);else{const{x:O,y:F}=d||{x:0,y:0};s instanceof HTMLImageElement||s instanceof HTMLCanvasElement||s instanceof HTMLVideoElement||s instanceof ImageData||u.a(s)?N.texSubImage2D(N.TEXTURE_2D,0,O,F,N.RGBA,N.UNSIGNED_BYTE,s):N.texSubImage2D(N.TEXTURE_2D,0,O,F,m,v,N.RGBA,N.UNSIGNED_BYTE,s.data)}this.useMipmap&&this.isSizePowerOfTwo()&&N.generateMipmap(N.TEXTURE_2D)}bind(s,p,d){const{context:m}=this,{gl:v}=m;v.bindTexture(v.TEXTURE_2D,this.texture),d!==v.LINEAR_MIPMAP_NEAREST||this.isSizePowerOfTwo()||(d=v.LINEAR),s!==this.filter&&(v.texParameteri(v.TEXTURE_2D,v.TEXTURE_MAG_FILTER,s),v.texParameteri(v.TEXTURE_2D,v.TEXTURE_MIN_FILTER,d||s),this.filter=s),p!==this.wrap&&(v.texParameteri(v.TEXTURE_2D,v.TEXTURE_WRAP_S,p),v.texParameteri(v.TEXTURE_2D,v.TEXTURE_WRAP_T,p),this.wrap=p)}isSizePowerOfTwo(){return this.size[0]===this.size[1]&&Math.log(this.size[0])/Math.LN2%1==0}destroy(){const{gl:s}=this.context;s.deleteTexture(this.texture),this.texture=null}}function be(y){const{userImage:s}=y;return!!(s&&s.render&&s.render())&&(y.data.replace(new Uint8Array(s.data.buffer)),!0)}class Kt extends u.E{constructor(){super(),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded=!1,this.requestors=[],this.patterns={},this.atlasImage=new u.R({width:1,height:1}),this.dirty=!0}isLoaded(){return this.loaded}setLoaded(s){if(this.loaded!==s&&(this.loaded=s,s)){for(const{ids:p,callback:d}of this.requestors)this._notify(p,d);this.requestors=[]}}getImage(s){const p=this.images[s];if(p&&!p.data&&p.spriteData){const d=p.spriteData;p.data=new u.R({width:d.width,height:d.height},d.context.getImageData(d.x,d.y,d.width,d.height).data),p.spriteData=null}return p}addImage(s,p){if(this.images[s])throw new Error(`Image id ${s} already exist, use updateImage instead`);this._validate(s,p)&&(this.images[s]=p)}_validate(s,p){let d=!0;const m=p.data||p.spriteData;return this._validateStretch(p.stretchX,m&&m.width)||(this.fire(new u.j(new Error(`Image "${s}" has invalid "stretchX" value`))),d=!1),this._validateStretch(p.stretchY,m&&m.height)||(this.fire(new u.j(new Error(`Image "${s}" has invalid "stretchY" value`))),d=!1),this._validateContent(p.content,p)||(this.fire(new u.j(new Error(`Image "${s}" has invalid "content" value`))),d=!1),d}_validateStretch(s,p){if(!s)return!0;let d=0;for(const m of s){if(m[0]<d||m[1]<m[0]||p<m[1])return!1;d=m[1]}return!0}_validateContent(s,p){if(!s)return!0;if(s.length!==4)return!1;const d=p.spriteData,m=d&&d.width||p.data.width,v=d&&d.height||p.data.height;return!(s[0]<0||m<s[0]||s[1]<0||v<s[1]||s[2]<0||m<s[2]||s[3]<0||v<s[3]||s[2]<s[0]||s[3]<s[1])}updateImage(s,p,d=!0){const m=this.getImage(s);if(d&&(m.data.width!==p.data.width||m.data.height!==p.data.height))throw new Error(`size mismatch between old image (${m.data.width}x${m.data.height}) and new image (${p.data.width}x${p.data.height}).`);p.version=m.version+1,this.images[s]=p,this.updatedImages[s]=!0}removeImage(s){const p=this.images[s];delete this.images[s],delete this.patterns[s],p.userImage&&p.userImage.onRemove&&p.userImage.onRemove()}listImages(){return Object.keys(this.images)}getImages(s,p){let d=!0;if(!this.isLoaded())for(const m of s)this.images[m]||(d=!1);this.isLoaded()||d?this._notify(s,p):this.requestors.push({ids:s,callback:p})}_notify(s,p){const d={};for(const m of s){let v=this.getImage(m);v||(this.fire(new u.k("styleimagemissing",{id:m})),v=this.getImage(m)),v?d[m]={data:v.data.clone(),pixelRatio:v.pixelRatio,sdf:v.sdf,version:v.version,stretchX:v.stretchX,stretchY:v.stretchY,content:v.content,hasRenderCallback:!!(v.userImage&&v.userImage.render)}:u.w(`Image "${m}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`)}p(null,d)}getPixelSize(){const{width:s,height:p}=this.atlasImage;return{width:s,height:p}}getPattern(s){const p=this.patterns[s],d=this.getImage(s);if(!d)return null;if(p&&p.position.version===d.version)return p.position;if(p)p.position.version=d.version;else{const m={w:d.data.width+2,h:d.data.height+2,x:0,y:0},v=new u.I(m,d);this.patterns[s]={bin:m,position:v}}return this._updatePatternAtlas(),this.patterns[s].position}bind(s){const p=s.gl;this.atlasTexture?this.dirty&&(this.atlasTexture.update(this.atlasImage),this.dirty=!1):this.atlasTexture=new Yt(s,this.atlasImage,p.RGBA),this.atlasTexture.bind(p.LINEAR,p.CLAMP_TO_EDGE)}_updatePatternAtlas(){const s=[];for(const v in this.patterns)s.push(this.patterns[v].bin);const{w:p,h:d}=u.p(s),m=this.atlasImage;m.resize({width:p||1,height:d||1});for(const v in this.patterns){const{bin:S}=this.patterns[v],T=S.x+1,N=S.y+1,O=this.getImage(v).data,F=O.width,k=O.height;u.R.copy(O,m,{x:0,y:0},{x:T,y:N},{width:F,height:k}),u.R.copy(O,m,{x:0,y:k-1},{x:T,y:N-1},{width:F,height:1}),u.R.copy(O,m,{x:0,y:0},{x:T,y:N+k},{width:F,height:1}),u.R.copy(O,m,{x:F-1,y:0},{x:T-1,y:N},{width:1,height:k}),u.R.copy(O,m,{x:0,y:0},{x:T+F,y:N},{width:1,height:k})}this.dirty=!0}beginFrame(){this.callbackDispatchedThisFrame={}}dispatchRenderCallbacks(s){for(const p of s){if(this.callbackDispatchedThisFrame[p])continue;this.callbackDispatchedThisFrame[p]=!0;const d=this.getImage(p);d||u.w(`Image with ID: "${p}" was not found`),be(d)&&this.updateImage(p,d)}}}const Ke=1e20;function vt(y,s,p,d,m,v,S,T,N){for(let O=s;O<s+d;O++)Qt(y,p*v+O,v,m,S,T,N);for(let O=p;O<p+m;O++)Qt(y,O*v+s,1,d,S,T,N)}function Qt(y,s,p,d,m,v,S){v[0]=0,S[0]=-Ke,S[1]=Ke,m[0]=y[s];for(let T=1,N=0,O=0;T<d;T++){m[T]=y[s+T*p];const F=T*T;do{const k=v[N];O=(m[T]-m[k]+F-k*k)/(T-k)/2}while(O<=S[N]&&--N>-1);N++,v[N]=T,S[N]=O,S[N+1]=Ke}for(let T=0,N=0;T<d;T++){for(;S[N+1]<T;)N++;const O=v[N],F=T-O;y[s+T*p]=m[O]+F*F}}class Te{constructor(s,p){this.requestManager=s,this.localIdeographFontFamily=p,this.entries={}}setURL(s){this.url=s}getGlyphs(s,p){const d=[];for(const m in s)for(const v of s[m])d.push({stack:m,id:v});u.o(d,({stack:m,id:v},S)=>{let T=this.entries[m];T||(T=this.entries[m]={glyphs:{},requests:{},ranges:{}});let N=T.glyphs[v];if(N!==void 0)return void S(null,{stack:m,id:v,glyph:N});if(N=this._tinySDF(T,m,v),N)return T.glyphs[v]=N,void S(null,{stack:m,id:v,glyph:N});const O=Math.floor(v/256);if(256*O>65535)return void S(new Error("glyphs > 65535 not supported"));if(T.ranges[O])return void S(null,{stack:m,id:v,glyph:N});if(!this.url)return void S(new Error("glyphsUrl is not set"));let F=T.requests[O];F||(F=T.requests[O]=[],Te.loadGlyphRange(m,O,this.url,this.requestManager,(k,j)=>{if(j){for(const tt in j)this._doesCharSupportLocalGlyph(+tt)||(T.glyphs[+tt]=j[+tt]);T.ranges[O]=!0}for(const tt of F)tt(k,j);delete T.requests[O]})),F.push((k,j)=>{k?S(k):j&&S(null,{stack:m,id:v,glyph:j[v]||null})})},(m,v)=>{if(m)p(m);else if(v){const S={};for(const{stack:T,id:N,glyph:O}of v)(S[T]||(S[T]={}))[N]=O&&{id:O.id,bitmap:O.bitmap.clone(),metrics:O.metrics};p(null,S)}})}_doesCharSupportLocalGlyph(s){return!!this.localIdeographFontFamily&&(u.u["CJK Unified Ideographs"](s)||u.u["Hangul Syllables"](s)||u.u.Hiragana(s)||u.u.Katakana(s))}_tinySDF(s,p,d){const m=this.localIdeographFontFamily;if(!m||!this._doesCharSupportLocalGlyph(d))return;let v=s.tinySDF;if(!v){let T="400";/bold/i.test(p)?T="900":/medium/i.test(p)?T="500":/light/i.test(p)&&(T="200"),v=s.tinySDF=new Te.TinySDF({fontSize:48,buffer:6,radius:16,cutoff:.25,fontFamily:m,fontWeight:T})}const S=v.draw(String.fromCharCode(d));return{id:d,bitmap:new u.q({width:S.width||60,height:S.height||60},S.data),metrics:{width:S.glyphWidth/2||24,height:S.glyphHeight/2||24,left:S.glyphLeft/2+.5||0,top:S.glyphTop/2-27.5||-8,advance:S.glyphAdvance/2||24,isDoubleResolution:!0}}}}Te.loadGlyphRange=function(y,s,p,d,m){const v=256*s,S=v+255,T=d.transformRequest(p.replace("{fontstack}",y).replace("{range}",`${v}-${S}`),rt.Glyphs);u.l(T,(N,O)=>{if(N)m(N);else if(O){const F={};for(const k of u.n(O))F[k.id]=k;m(null,F)}})},Te.TinySDF=class{constructor({fontSize:y=24,buffer:s=3,radius:p=8,cutoff:d=.25,fontFamily:m="sans-serif",fontWeight:v="normal",fontStyle:S="normal"}={}){this.buffer=s,this.cutoff=d,this.radius=p;const T=this.size=y+4*s,N=this._createCanvas(T),O=this.ctx=N.getContext("2d",{willReadFrequently:!0});O.font=`${S} ${v} ${y}px ${m}`,O.textBaseline="alphabetic",O.textAlign="left",O.fillStyle="black",this.gridOuter=new Float64Array(T*T),this.gridInner=new Float64Array(T*T),this.f=new Float64Array(T),this.z=new Float64Array(T+1),this.v=new Uint16Array(T)}_createCanvas(y){const s=document.createElement("canvas");return s.width=s.height=y,s}draw(y){const{width:s,actualBoundingBoxAscent:p,actualBoundingBoxDescent:d,actualBoundingBoxLeft:m,actualBoundingBoxRight:v}=this.ctx.measureText(y),S=Math.ceil(p),T=Math.max(0,Math.min(this.size-this.buffer,Math.ceil(v-m))),N=Math.min(this.size-this.buffer,S+Math.ceil(d)),O=T+2*this.buffer,F=N+2*this.buffer,k=Math.max(O*F,0),j=new Uint8ClampedArray(k),tt={data:j,width:O,height:F,glyphWidth:T,glyphHeight:N,glyphTop:S,glyphLeft:0,glyphAdvance:s};if(T===0||N===0)return tt;const{ctx:et,buffer:st,gridInner:K,gridOuter:xt}=this;et.clearRect(st,st,T,N),et.fillText(y,st,st+S);const Nt=et.getImageData(st,st,T,N);xt.fill(Ke,0,k),K.fill(0,0,k);for(let lt=0;lt<N;lt++)for(let wt=0;wt<T;wt++){const Ft=Nt.data[4*(lt*T+wt)+3]/255;if(Ft===0)continue;const kt=(lt+st)*O+wt+st;if(Ft===1)xt[kt]=0,K[kt]=Ke;else{const Zt=.5-Ft;xt[kt]=Zt>0?Zt*Zt:0,K[kt]=Zt<0?Zt*Zt:0}}vt(xt,0,0,O,F,O,this.f,this.v,this.z),vt(K,st,st,T,N,O,this.f,this.v,this.z);for(let lt=0;lt<k;lt++){const wt=Math.sqrt(xt[lt])-Math.sqrt(K[lt]);j[lt]=Math.round(255-255*(wt/this.radius+this.cutoff))}return tt}};class Ge{constructor(){this.specification=u.v.light.position}possiblyEvaluate(s,p){return u.z(s.expression.evaluate(p))}interpolate(s,p,d){return{x:u.B.number(s.x,p.x,d),y:u.B.number(s.y,p.y,d),z:u.B.number(s.z,p.z,d)}}}let gn;class xn extends u.E{constructor(s){super(),gn=gn||new u.r({anchor:new u.D(u.v.light.anchor),position:new Ge,color:new u.D(u.v.light.color),intensity:new u.D(u.v.light.intensity)}),this._transitionable=new u.T(gn),this.setLight(s),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(s,p={}){if(!this._validate(u.t,s,p))for(const d in s){const m=s[d];d.endsWith("-transition")?this._transitionable.setTransition(d.slice(0,-11),m):this._transitionable.setValue(d,m)}}updateTransitions(s){this._transitioning=this._transitionable.transitioned(s,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(s){this.properties=this._transitioning.possiblyEvaluate(s)}_validate(s,p,d){return(!d||d.validate!==!1)&&u.x(this,s.call(u.y,u.e({value:p,style:{glyphs:!0,sprite:!0},styleSpec:u.v})))}}class ei{constructor(s,p){this.width=s,this.height=p,this.nextRow=0,this.data=new Uint8Array(this.width*this.height),this.dashEntry={}}getDash(s,p){const d=s.join(",")+String(p);return this.dashEntry[d]||(this.dashEntry[d]=this.addDash(s,p)),this.dashEntry[d]}getDashRanges(s,p,d){const m=[];let v=s.length%2==1?-s[s.length-1]*d:0,S=s[0]*d,T=!0;m.push({left:v,right:S,isDash:T,zeroLength:s[0]===0});let N=s[0];for(let O=1;O<s.length;O++){T=!T;const F=s[O];v=N*d,N+=F,S=N*d,m.push({left:v,right:S,isDash:T,zeroLength:F===0})}return m}addRoundDash(s,p,d){const m=p/2;for(let v=-d;v<=d;v++){const S=this.width*(this.nextRow+d+v);let T=0,N=s[T];for(let O=0;O<this.width;O++){O/N.right>1&&(N=s[++T]);const F=Math.abs(O-N.left),k=Math.abs(O-N.right),j=Math.min(F,k);let tt;const et=v/d*(m+1);if(N.isDash){const st=m-Math.abs(et);tt=Math.sqrt(j*j+st*st)}else tt=m-Math.sqrt(j*j+et*et);this.data[S+O]=Math.max(0,Math.min(255,tt+128))}}}addRegularDash(s){for(let T=s.length-1;T>=0;--T){const N=s[T],O=s[T+1];N.zeroLength?s.splice(T,1):O&&O.isDash===N.isDash&&(O.left=N.left,s.splice(T,1))}const p=s[0],d=s[s.length-1];p.isDash===d.isDash&&(p.left=d.left-this.width,d.right=p.right+this.width);const m=this.width*this.nextRow;let v=0,S=s[v];for(let T=0;T<this.width;T++){T/S.right>1&&(S=s[++v]);const N=Math.abs(T-S.left),O=Math.abs(T-S.right),F=Math.min(N,O);this.data[m+T]=Math.max(0,Math.min(255,(S.isDash?F:-F)+128))}}addDash(s,p){const d=p?7:0,m=2*d+1;if(this.nextRow+m>this.height)return u.w("LineAtlas out of space"),null;let v=0;for(let T=0;T<s.length;T++)v+=s[T];if(v!==0){const T=this.width/v,N=this.getDashRanges(s,this.width,T);p?this.addRoundDash(N,T,d):this.addRegularDash(N)}const S={y:(this.nextRow+d+.5)/this.height,height:2*d/this.height,width:v};return this.nextRow+=m,this.dirty=!0,S}bind(s){const p=s.gl;this.texture?(p.bindTexture(p.TEXTURE_2D,this.texture),this.dirty&&(this.dirty=!1,p.texSubImage2D(p.TEXTURE_2D,0,0,0,this.width,this.height,p.ALPHA,p.UNSIGNED_BYTE,this.data))):(this.texture=p.createTexture(),p.bindTexture(p.TEXTURE_2D,this.texture),p.texParameteri(p.TEXTURE_2D,p.TEXTURE_WRAP_S,p.REPEAT),p.texParameteri(p.TEXTURE_2D,p.TEXTURE_WRAP_T,p.REPEAT),p.texParameteri(p.TEXTURE_2D,p.TEXTURE_MIN_FILTER,p.LINEAR),p.texParameteri(p.TEXTURE_2D,p.TEXTURE_MAG_FILTER,p.LINEAR),p.texImage2D(p.TEXTURE_2D,0,p.ALPHA,this.width,this.height,0,p.ALPHA,p.UNSIGNED_BYTE,this.data))}}class jn{constructor(s,p,d){this.workerPool=s,this.actors=[],this.currentActor=0,this.id=d;const m=this.workerPool.acquire(d);for(let v=0;v<m.length;v++){const S=new u.C(m[v],p,d);S.name=`Worker ${v}`,this.actors.push(S)}if(!this.actors.length)throw new Error("No actors found")}broadcast(s,p,d){u.o(this.actors,(m,v)=>{m.send(s,p,v)},d=d||function(){})}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(s=!0){this.actors.forEach(p=>{p.remove()}),this.actors=[],s&&this.workerPool.release(this.id)}}function $n(y,s,p){const d=function(m,v){if(m)return p(m);if(v){const S=u.F(u.e(v,y),["tiles","minzoom","maxzoom","attribution","bounds","scheme","tileSize","encoding"]);v.vector_layers&&(S.vectorLayers=v.vector_layers,S.vectorLayerIds=S.vectorLayers.map(T=>T.id)),p(null,S)}};return y.url?u.f(s.transformRequest(y.url,rt.Source),d):u.h.frame(()=>d(null,y))}class Fe{constructor(s,p){s&&(p?this.setSouthWest(s).setNorthEast(p):Array.isArray(s)&&(s.length===4?this.setSouthWest([s[0],s[1]]).setNorthEast([s[2],s[3]]):this.setSouthWest(s[0]).setNorthEast(s[1])))}setNorthEast(s){return this._ne=s instanceof u.L?new u.L(s.lng,s.lat):u.L.convert(s),this}setSouthWest(s){return this._sw=s instanceof u.L?new u.L(s.lng,s.lat):u.L.convert(s),this}extend(s){const p=this._sw,d=this._ne;let m,v;if(s instanceof u.L)m=s,v=s;else{if(!(s instanceof Fe))return Array.isArray(s)?s.length===4||s.every(Array.isArray)?this.extend(Fe.convert(s)):this.extend(u.L.convert(s)):s&&("lng"in s||"lon"in s)&&"lat"in s?this.extend(u.L.convert(s)):this;if(m=s._sw,v=s._ne,!m||!v)return this}return p||d?(p.lng=Math.min(m.lng,p.lng),p.lat=Math.min(m.lat,p.lat),d.lng=Math.max(v.lng,d.lng),d.lat=Math.max(v.lat,d.lat)):(this._sw=new u.L(m.lng,m.lat),this._ne=new u.L(v.lng,v.lat)),this}getCenter(){return new u.L((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new u.L(this.getWest(),this.getNorth())}getSouthEast(){return new u.L(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(s){const{lng:p,lat:d}=u.L.convert(s);let m=this._sw.lng<=p&&p<=this._ne.lng;return this._sw.lng>this._ne.lng&&(m=this._sw.lng>=p&&p>=this._ne.lng),this._sw.lat<=d&&d<=this._ne.lat&&m}static convert(s){return s instanceof Fe?s:s&&new Fe(s)}static fromLngLat(s,p=0){const d=360*p/40075017,m=d/Math.cos(Math.PI/180*s.lat);return new Fe(new u.L(s.lng-m,s.lat-d),new u.L(s.lng+m,s.lat+d))}}class Vn{constructor(s,p,d){this.bounds=Fe.convert(this.validateBounds(s)),this.minzoom=p||0,this.maxzoom=d||24}validateBounds(s){return Array.isArray(s)&&s.length===4?[Math.max(-180,s[0]),Math.max(-90,s[1]),Math.min(180,s[2]),Math.min(90,s[3])]:[-180,-90,180,90]}contains(s){const p=Math.pow(2,s.z),d=Math.floor(u.G(this.bounds.getWest())*p),m=Math.floor(u.H(this.bounds.getNorth())*p),v=Math.ceil(u.G(this.bounds.getEast())*p),S=Math.ceil(u.H(this.bounds.getSouth())*p);return s.x>=d&&s.x<v&&s.y>=m&&s.y<S}}class rr extends u.E{constructor(s,p,d,m){if(super(),this.load=()=>{this._loaded=!1,this.fire(new u.k("dataloading",{dataType:"source"})),this._tileJSONRequest=$n(this._options,this.map._requestManager,(v,S)=>{this._tileJSONRequest=null,this._loaded=!0,this.map.style.sourceCaches[this.id].clearTiles(),v?this.fire(new u.j(v)):S&&(u.e(this,S),S.bounds&&(this.tileBounds=new Vn(S.bounds,this.minzoom,this.maxzoom)),this.fire(new u.k("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new u.k("data",{dataType:"source",sourceDataType:"content"})))})},this.serialize=()=>u.e({},this._options),this.id=s,this.dispatcher=d,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,u.e(this,u.F(p,["url","scheme","tileSize","promoteId"])),this._options=u.e({type:"vector"},p),this._collectResourceTiming=p.collectResourceTiming,this.tileSize!==512)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(m)}loaded(){return this._loaded}hasTile(s){return!this.tileBounds||this.tileBounds.contains(s.canonical)}onAdd(s){this.map=s,this.load()}setSourceProperty(s){this._tileJSONRequest&&this._tileJSONRequest.cancel(),s(),this.load()}setTiles(s){return this.setSourceProperty(()=>{this._options.tiles=s}),this}setUrl(s){return this.setSourceProperty(()=>{this.url=s,this._options.url=s}),this}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}loadTile(s,p){const d=s.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme),m={request:this.map._requestManager.transformRequest(d,rt.Tile),uid:s.uid,tileID:s.tileID,zoom:s.tileID.overscaledZ,tileSize:this.tileSize*s.tileID.overscaleFactor(),type:this.type,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId};function v(S,T){return delete s.request,s.aborted?p(null):S&&S.status!==404?p(S):(T&&T.resourceTiming&&(s.resourceTiming=T.resourceTiming),this.map._refreshExpiredTiles&&T&&s.setExpiryData(T),s.loadVectorData(T,this.map.painter),p(null),void(s.reloadCallback&&(this.loadTile(s,s.reloadCallback),s.reloadCallback=null)))}m.request.collectResourceTiming=this._collectResourceTiming,s.actor&&s.state!=="expired"?s.state==="loading"?s.reloadCallback=p:s.request=s.actor.send("reloadTile",m,v.bind(this)):(s.actor=this.dispatcher.getActor(),s.request=s.actor.send("loadTile",m,v.bind(this)))}abortTile(s){s.request&&(s.request.cancel(),delete s.request),s.actor&&s.actor.send("abortTile",{uid:s.uid,type:this.type,source:this.id},void 0)}unloadTile(s){s.unloadVectorData(),s.actor&&s.actor.send("removeTile",{uid:s.uid,type:this.type,source:this.id},void 0)}hasTransition(){return!1}}class ci extends u.E{constructor(s,p,d,m){super(),this.id=s,this.dispatcher=d,this.setEventedParent(m),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=u.e({type:"raster"},p),u.e(this,u.F(p,["url","scheme","tileSize"]))}load(){this._loaded=!1,this.fire(new u.k("dataloading",{dataType:"source"})),this._tileJSONRequest=$n(this._options,this.map._requestManager,(s,p)=>{this._tileJSONRequest=null,this._loaded=!0,s?this.fire(new u.j(s)):p&&(u.e(this,p),p.bounds&&(this.tileBounds=new Vn(p.bounds,this.minzoom,this.maxzoom)),this.fire(new u.k("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new u.k("data",{dataType:"source",sourceDataType:"content"})))})}loaded(){return this._loaded}onAdd(s){this.map=s,this.load()}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}setSourceProperty(s){this._tileJSONRequest&&this._tileJSONRequest.cancel(),s(),this.load()}setTiles(s){return this.setSourceProperty(()=>{this._options.tiles=s}),this}serialize(){return u.e({},this._options)}hasTile(s){return!this.tileBounds||this.tileBounds.contains(s.canonical)}loadTile(s,p){const d=s.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme);s.request=W.getImage(this.map._requestManager.transformRequest(d,rt.Tile),(m,v,S)=>{if(delete s.request,s.aborted)s.state="unloaded",p(null);else if(m)s.state="errored",p(m);else if(v){this.map._refreshExpiredTiles&&S&&s.setExpiryData(S);const T=this.map.painter.context,N=T.gl;s.texture=this.map.painter.getTileTexture(v.width),s.texture?s.texture.update(v,{useMipmap:!0}):(s.texture=new Yt(T,v,N.RGBA,{useMipmap:!0}),s.texture.bind(N.LINEAR,N.CLAMP_TO_EDGE,N.LINEAR_MIPMAP_NEAREST),T.extTextureFilterAnisotropic&&N.texParameterf(N.TEXTURE_2D,T.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,T.extTextureFilterAnisotropicMax)),s.state="loaded",p(null)}},this.map._refreshExpiredTiles)}abortTile(s,p){s.request&&(s.request.cancel(),delete s.request),p()}unloadTile(s,p){s.texture&&this.map.painter.saveTileTexture(s.texture),p()}hasTransition(){return!1}}class fl extends ci{constructor(s,p,d,m){super(s,p,d,m),this.type="raster-dem",this.maxzoom=22,this._options=u.e({type:"raster-dem"},p),this.encoding=p.encoding||"mapbox",this.redFactor=p.redFactor,this.greenFactor=p.greenFactor,this.blueFactor=p.blueFactor,this.baseShift=p.baseShift}loadTile(s,p){const d=s.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme),m=this.map._requestManager.transformRequest(d,rt.Tile);function v(S,T){S&&(s.state="errored",p(S)),T&&(s.dem=T,s.needsHillshadePrepare=!0,s.needsTerrainPrepare=!0,s.state="loaded",p(null))}s.neighboringTiles=this._getNeighboringTiles(s.tileID),s.request=W.getImage(m,(S,T,N)=>u._(this,void 0,void 0,function*(){if(delete s.request,s.aborted)s.state="unloaded",p(null);else if(S)s.state="errored",p(S);else if(T){this.map._refreshExpiredTiles&&s.setExpiryData(N);const O=u.a(T)&&u.J()?T:yield function(k){return u._(this,void 0,void 0,function*(){if(typeof VideoFrame<"u"&&u.K()){const j=k.width+2,tt=k.height+2;try{return new u.R({width:j,height:tt},yield u.M(k,-1,-1,j,tt))}catch{}}return u.h.getImageData(k,1)})}(T),F={uid:s.uid,coord:s.tileID,source:this.id,rawImageData:O,encoding:this.encoding,redFactor:this.redFactor,greenFactor:this.greenFactor,blueFactor:this.blueFactor,baseShift:this.baseShift};s.actor&&s.state!=="expired"||(s.actor=this.dispatcher.getActor(),s.actor.send("loadDEMTile",F,v))}}),this.map._refreshExpiredTiles)}_getNeighboringTiles(s){const p=s.canonical,d=Math.pow(2,p.z),m=(p.x-1+d)%d,v=p.x===0?s.wrap-1:s.wrap,S=(p.x+1+d)%d,T=p.x+1===d?s.wrap+1:s.wrap,N={};return N[new u.O(s.overscaledZ,v,p.z,m,p.y).key]={backfilled:!1},N[new u.O(s.overscaledZ,T,p.z,S,p.y).key]={backfilled:!1},p.y>0&&(N[new u.O(s.overscaledZ,v,p.z,m,p.y-1).key]={backfilled:!1},N[new u.O(s.overscaledZ,s.wrap,p.z,p.x,p.y-1).key]={backfilled:!1},N[new u.O(s.overscaledZ,T,p.z,S,p.y-1).key]={backfilled:!1}),p.y+1<d&&(N[new u.O(s.overscaledZ,v,p.z,m,p.y+1).key]={backfilled:!1},N[new u.O(s.overscaledZ,s.wrap,p.z,p.x,p.y+1).key]={backfilled:!1},N[new u.O(s.overscaledZ,T,p.z,S,p.y+1).key]={backfilled:!1}),N}unloadTile(s){s.demTexture&&this.map.painter.saveTileTexture(s.demTexture),s.fbo&&(s.fbo.destroy(),delete s.fbo),s.dem&&delete s.dem,delete s.neighboringTiles,s.state="unloaded",s.actor&&s.actor.send("removeDEMTile",{uid:s.uid,source:this.id})}}class ks extends u.E{constructor(s,p,d,m){super(),this.load=()=>{this._updateWorkerData()},this.serialize=()=>u.e({},this._options,{type:this.type,data:this._data}),this.id=s,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._removed=!1,this._pendingLoads=0,this.actor=d.getActor(),this.setEventedParent(m),this._data=p.data,this._options=u.e({},p),this._collectResourceTiming=p.collectResourceTiming,p.maxzoom!==void 0&&(this.maxzoom=p.maxzoom),p.type&&(this.type=p.type),p.attribution&&(this.attribution=p.attribution),this.promoteId=p.promoteId;const v=u.N/this.tileSize;this.workerOptions=u.e({source:this.id,cluster:p.cluster||!1,geojsonVtOptions:{buffer:(p.buffer!==void 0?p.buffer:128)*v,tolerance:(p.tolerance!==void 0?p.tolerance:.375)*v,extent:u.N,maxZoom:this.maxzoom,lineMetrics:p.lineMetrics||!1,generateId:p.generateId||!1},superclusterOptions:{maxZoom:p.clusterMaxZoom!==void 0?p.clusterMaxZoom:this.maxzoom-1,minPoints:Math.max(2,p.clusterMinPoints||2),extent:u.N,radius:(p.clusterRadius||50)*v,log:!1,generateId:p.generateId||!1},clusterProperties:p.clusterProperties,filter:p.filter},p.workerOptions),typeof this.promoteId=="string"&&(this.workerOptions.promoteId=this.promoteId)}onAdd(s){this.map=s,this.load()}setData(s){return this._data=s,this._updateWorkerData(),this}updateData(s){return this._updateWorkerData(s),this}setClusterOptions(s){return this.workerOptions.cluster=s.cluster,s&&(s.clusterRadius!==void 0&&(this.workerOptions.superclusterOptions.radius=s.clusterRadius),s.clusterMaxZoom!==void 0&&(this.workerOptions.superclusterOptions.maxZoom=s.clusterMaxZoom)),this._updateWorkerData(),this}getClusterExpansionZoom(s,p){return this.actor.send("geojson.getClusterExpansionZoom",{clusterId:s,source:this.id},p),this}getClusterChildren(s,p){return this.actor.send("geojson.getClusterChildren",{clusterId:s,source:this.id},p),this}getClusterLeaves(s,p,d,m){return this.actor.send("geojson.getClusterLeaves",{source:this.id,clusterId:s,limit:p,offset:d},m),this}_updateWorkerData(s){const p=u.e({},this.workerOptions);s?p.dataDiff=s:typeof this._data=="string"?(p.request=this.map._requestManager.transformRequest(u.h.resolveURL(this._data),rt.Source),p.request.collectResourceTiming=this._collectResourceTiming):p.data=JSON.stringify(this._data),this._pendingLoads++,this.fire(new u.k("dataloading",{dataType:"source"})),this.actor.send(`${this.type}.loadData`,p,(d,m)=>{if(this._pendingLoads--,this._removed||m&&m.abandoned)return void this.fire(new u.k("dataabort",{dataType:"source"}));let v=null;if(m&&m.resourceTiming&&m.resourceTiming[this.id]&&(v=m.resourceTiming[this.id].slice(0)),d)return void this.fire(new u.j(d));const S={dataType:"source"};this._collectResourceTiming&&v&&v.length>0&&u.e(S,{resourceTiming:v}),this.fire(new u.k("data",Object.assign(Object.assign({},S),{sourceDataType:"metadata"}))),this.fire(new u.k("data",Object.assign(Object.assign({},S),{sourceDataType:"content"})))})}loaded(){return this._pendingLoads===0}loadTile(s,p){const d=s.actor?"reloadTile":"loadTile";s.actor=this.actor;const m={type:this.type,uid:s.uid,tileID:s.tileID,zoom:s.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId};s.request=this.actor.send(d,m,(v,S)=>(delete s.request,s.unloadVectorData(),s.aborted?p(null):v?p(v):(s.loadVectorData(S,this.map.painter,d==="reloadTile"),p(null))))}abortTile(s){s.request&&(s.request.cancel(),delete s.request),s.aborted=!0}unloadTile(s){s.unloadVectorData(),this.actor.send("removeTile",{uid:s.uid,type:this.type,source:this.id})}onRemove(){this._removed=!0,this.actor.send("removeSource",{type:this.type,source:this.id})}hasTransition(){return!1}}var br=u.Q([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);class nn extends u.E{constructor(s,p,d,m){super(),this.load=(v,S)=>{this._loaded=!1,this.fire(new u.k("dataloading",{dataType:"source"})),this.url=this.options.url,this._request=W.getImage(this.map._requestManager.transformRequest(this.url,rt.Image),(T,N)=>{this._request=null,this._loaded=!0,T?this.fire(new u.j(T)):N&&(this.image=N,v&&(this.coordinates=v),S&&S(),this._finishLoading())})},this.prepare=()=>{if(Object.keys(this.tiles).length===0||!this.image)return;const v=this.map.painter.context,S=v.gl;this.boundsBuffer||(this.boundsBuffer=v.createVertexBuffer(this._boundsArray,br.members)),this.boundsSegments||(this.boundsSegments=u.S.simpleSegment(0,0,4,2)),this.texture||(this.texture=new Yt(v,this.image,S.RGBA),this.texture.bind(S.LINEAR,S.CLAMP_TO_EDGE));let T=!1;for(const N in this.tiles){const O=this.tiles[N];O.state!=="loaded"&&(O.state="loaded",O.texture=this.texture,T=!0)}T&&this.fire(new u.k("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))},this.serialize=()=>({type:"image",url:this.options.url,coordinates:this.coordinates}),this.id=s,this.dispatcher=d,this.coordinates=p.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.setEventedParent(m),this.options=p}loaded(){return this._loaded}updateImage(s){return s.url?(this._request&&(this._request.cancel(),this._request=null),this.options.url=s.url,this.load(s.coordinates,()=>{this.texture=null}),this):this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new u.k("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(s){this.map=s,this.load()}onRemove(){this._request&&(this._request.cancel(),this._request=null)}setCoordinates(s){this.coordinates=s;const p=s.map(u.U.fromLngLat);this.tileID=function(m){let v=1/0,S=1/0,T=-1/0,N=-1/0;for(const j of m)v=Math.min(v,j.x),S=Math.min(S,j.y),T=Math.max(T,j.x),N=Math.max(N,j.y);const O=Math.max(T-v,N-S),F=Math.max(0,Math.floor(-Math.log(O)/Math.LN2)),k=Math.pow(2,F);return new u.W(F,Math.floor((v+T)/2*k),Math.floor((S+N)/2*k))}(p),this.minzoom=this.maxzoom=this.tileID.z;const d=p.map(m=>this.tileID.getTilePoint(m)._round());return this._boundsArray=new u.V,this._boundsArray.emplaceBack(d[0].x,d[0].y,0,0),this._boundsArray.emplaceBack(d[1].x,d[1].y,u.N,0),this._boundsArray.emplaceBack(d[3].x,d[3].y,0,u.N),this._boundsArray.emplaceBack(d[2].x,d[2].y,u.N,u.N),this.boundsBuffer&&(this.boundsBuffer.destroy(),delete this.boundsBuffer),this.fire(new u.k("data",{dataType:"source",sourceDataType:"content"})),this}loadTile(s,p){this.tileID&&this.tileID.equals(s.tileID.canonical)?(this.tiles[String(s.tileID.wrap)]=s,s.buckets={},p(null)):(s.state="errored",p(null))}hasTransition(){return!1}}class dl extends nn{constructor(s,p,d,m){super(s,p,d,m),this.load=()=>{this._loaded=!1;const v=this.options;this.urls=[];for(const S of v.urls)this.urls.push(this.map._requestManager.transformRequest(S,rt.Source).url);u.X(this.urls,(S,T)=>{this._loaded=!0,S?this.fire(new u.j(S)):T&&(this.video=T,this.video.loop=!0,this.video.addEventListener("playing",()=>{this.map.triggerRepaint()}),this.map&&this.video.play(),this._finishLoading())})},this.prepare=()=>{if(Object.keys(this.tiles).length===0||this.video.readyState<2)return;const v=this.map.painter.context,S=v.gl;this.boundsBuffer||(this.boundsBuffer=v.createVertexBuffer(this._boundsArray,br.members)),this.boundsSegments||(this.boundsSegments=u.S.simpleSegment(0,0,4,2)),this.texture?this.video.paused||(this.texture.bind(S.LINEAR,S.CLAMP_TO_EDGE),S.texSubImage2D(S.TEXTURE_2D,0,0,0,S.RGBA,S.UNSIGNED_BYTE,this.video)):(this.texture=new Yt(v,this.video,S.RGBA),this.texture.bind(S.LINEAR,S.CLAMP_TO_EDGE));let T=!1;for(const N in this.tiles){const O=this.tiles[N];O.state!=="loaded"&&(O.state="loaded",O.texture=this.texture,T=!0)}T&&this.fire(new u.k("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))},this.serialize=()=>({type:"video",urls:this.urls,coordinates:this.coordinates}),this.roundZoom=!0,this.type="video",this.options=p}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(s){if(this.video){const p=this.video.seekable;s<p.start(0)||s>p.end(0)?this.fire(new u.j(new u.Y(`sources.${this.id}`,null,`Playback for this video can be set only between the ${p.start(0)} and ${p.end(0)}-second mark.`))):this.video.currentTime=s}}getVideo(){return this.video}onAdd(s){this.map||(this.map=s,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}hasTransition(){return this.video&&!this.video.paused}}class qo extends nn{constructor(s,p,d,m){super(s,p,d,m),this.load=()=>{this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof HTMLCanvasElement?this.options.canvas:document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new u.j(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())},this.prepare=()=>{let v=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,v=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,v=!0),this._hasInvalidDimensions()||Object.keys(this.tiles).length===0)return;const S=this.map.painter.context,T=S.gl;this.boundsBuffer||(this.boundsBuffer=S.createVertexBuffer(this._boundsArray,br.members)),this.boundsSegments||(this.boundsSegments=u.S.simpleSegment(0,0,4,2)),this.texture?(v||this._playing)&&this.texture.update(this.canvas,{premultiply:!0}):this.texture=new Yt(S,this.canvas,T.RGBA,{premultiply:!0});let N=!1;for(const O in this.tiles){const F=this.tiles[O];F.state!=="loaded"&&(F.state="loaded",F.texture=this.texture,N=!0)}N&&this.fire(new u.k("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))},this.serialize=()=>({type:"canvas",coordinates:this.coordinates}),p.coordinates?Array.isArray(p.coordinates)&&p.coordinates.length===4&&!p.coordinates.some(v=>!Array.isArray(v)||v.length!==2||v.some(S=>typeof S!="number"))||this.fire(new u.j(new u.Y(`sources.${s}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new u.j(new u.Y(`sources.${s}`,null,'missing required property "coordinates"'))),p.animate&&typeof p.animate!="boolean"&&this.fire(new u.j(new u.Y(`sources.${s}`,null,'optional "animate" property must be a boolean value'))),p.canvas?typeof p.canvas=="string"||p.canvas instanceof HTMLCanvasElement||this.fire(new u.j(new u.Y(`sources.${s}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new u.j(new u.Y(`sources.${s}`,null,'missing required property "canvas"'))),this.options=p,this.animate=p.animate===void 0||p.animate}getCanvas(){return this.canvas}onAdd(s){this.map=s,this.load(),this.canvas&&this.animate&&this.play()}onRemove(){this.pause()}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const s of[this.canvas.width,this.canvas.height])if(isNaN(s)||s<=0)return!0;return!1}}const Fn={},Xn=y=>{switch(y){case"geojson":return ks;case"image":return nn;case"raster":return ci;case"raster-dem":return fl;case"vector":return rr;case"video":return dl;case"canvas":return qo}return Fn[y]};function mn(y,s){const p=u.Z();return u.$(p,p,[1,1,0]),u.a0(p,p,[.5*y.width,.5*y.height,1]),u.a1(p,p,y.calculatePosMatrix(s.toUnwrapped()))}function Un(y,s,p,d,m,v){const S=function(k,j,tt){if(k)for(const et of k){const st=j[et];if(st&&st.source===tt&&st.type==="fill-extrusion")return!0}else for(const et in j){const st=j[et];if(st.source===tt&&st.type==="fill-extrusion")return!0}return!1}(m&&m.layers,s,y.id),T=v.maxPitchScaleFactor(),N=y.tilesIn(d,T,S);N.sort(Ci);const O=[];for(const k of N)O.push({wrappedTileID:k.tileID.wrapped().key,queryResults:k.tile.queryRenderedFeatures(s,p,y._state,k.queryGeometry,k.cameraQueryGeometry,k.scale,m,v,T,mn(y.transform,k.tileID))});const F=function(k){const j={},tt={};for(const et of k){const st=et.queryResults,K=et.wrappedTileID,xt=tt[K]=tt[K]||{};for(const Nt in st){const lt=st[Nt],wt=xt[Nt]=xt[Nt]||{},Ft=j[Nt]=j[Nt]||[];for(const kt of lt)wt[kt.featureIndex]||(wt[kt.featureIndex]=!0,Ft.push(kt))}}return j}(O);for(const k in F)F[k].forEach(j=>{const tt=j.feature,et=y.getFeatureState(tt.layer["source-layer"],tt.id);tt.source=tt.layer.source,tt.layer["source-layer"]&&(tt.sourceLayer=tt.layer["source-layer"]),tt.state=et});return F}function Ci(y,s){const p=y.tileID,d=s.tileID;return p.overscaledZ-d.overscaledZ||p.canonical.y-d.canonical.y||p.wrap-d.wrap||p.canonical.x-d.canonical.x}class Yn{constructor(s,p){this.timeAdded=0,this.fadeEndTime=0,this.tileID=s,this.uid=u.a2(),this.uses=0,this.tileSize=p,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.rtt=[],this.rttCoords={},this.expiredRequestCount=0,this.state="loading"}registerFadeDuration(s){const p=s+this.timeAdded;p<this.fadeEndTime||(this.fadeEndTime=p)}wasRequested(){return this.state==="errored"||this.state==="loaded"||this.state==="reloading"}clearTextures(s){this.demTexture&&s.saveTileTexture(this.demTexture),this.demTexture=null}loadVectorData(s,p,d){if(this.hasData()&&this.unloadVectorData(),this.state="loaded",s){s.featureIndex&&(this.latestFeatureIndex=s.featureIndex,s.rawTileData?(this.latestRawTileData=s.rawTileData,this.latestFeatureIndex.rawTileData=s.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=s.collisionBoxArray,this.buckets=function(m,v){const S={};if(!v)return S;for(const T of m){const N=T.layerIds.map(O=>v.getLayer(O)).filter(Boolean);if(N.length!==0){T.layers=N,T.stateDependentLayerIds&&(T.stateDependentLayers=T.stateDependentLayerIds.map(O=>N.filter(F=>F.id===O)[0]));for(const O of N)S[O.id]=T}}return S}(s.buckets,p.style),this.hasSymbolBuckets=!1;for(const m in this.buckets){const v=this.buckets[m];if(v instanceof u.a4){if(this.hasSymbolBuckets=!0,!d)break;v.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const m in this.buckets){const v=this.buckets[m];if(v instanceof u.a4&&v.hasRTLText){this.hasRTLText=!0,u.a5();break}}this.queryPadding=0;for(const m in this.buckets){const v=this.buckets[m];this.queryPadding=Math.max(this.queryPadding,p.style.getLayer(m).queryRadius(v))}s.imageAtlas&&(this.imageAtlas=s.imageAtlas),s.glyphAtlasImage&&(this.glyphAtlasImage=s.glyphAtlasImage)}else this.collisionBoxArray=new u.a3}unloadVectorData(){for(const s in this.buckets)this.buckets[s].destroy();this.buckets={},this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.imageAtlas&&(this.imageAtlas=null),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.latestFeatureIndex=null,this.state="unloaded"}getBucket(s){return this.buckets[s.id]}upload(s){for(const d in this.buckets){const m=this.buckets[d];m.uploadPending()&&m.upload(s)}const p=s.gl;this.imageAtlas&&!this.imageAtlas.uploaded&&(this.imageAtlasTexture=new Yt(s,this.imageAtlas.image,p.RGBA),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new Yt(s,this.glyphAtlasImage,p.ALPHA),this.glyphAtlasImage=null)}prepare(s){this.imageAtlas&&this.imageAtlas.patchUpdatedImages(s,this.imageAtlasTexture)}queryRenderedFeatures(s,p,d,m,v,S,T,N,O,F){return this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData?this.latestFeatureIndex.query({queryGeometry:m,cameraQueryGeometry:v,scale:S,tileSize:this.tileSize,pixelPosMatrix:F,transform:N,params:T,queryPadding:this.queryPadding*O},s,p,d):{}}querySourceFeatures(s,p){const d=this.latestFeatureIndex;if(!d||!d.rawTileData)return;const m=d.loadVTLayers(),v=p&&p.sourceLayer?p.sourceLayer:"",S=m._geojsonTileLayer||m[v];if(!S)return;const T=u.a6(p&&p.filter),{z:N,x:O,y:F}=this.tileID.canonical,k={z:N,x:O,y:F};for(let j=0;j<S.length;j++){const tt=S.feature(j);if(T.needGeometry){const K=u.a7(tt,!0);if(!T.filter(new u.a8(this.tileID.overscaledZ),K,this.tileID.canonical))continue}else if(!T.filter(new u.a8(this.tileID.overscaledZ),tt))continue;const et=d.getId(tt,v),st=new u.a9(tt,N,O,F,et);st.tile=k,s.push(st)}}hasData(){return this.state==="loaded"||this.state==="reloading"||this.state==="expired"}patternsLoaded(){return this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length}setExpiryData(s){const p=this.expirationTime;if(s.cacheControl){const d=u.aa(s.cacheControl);d["max-age"]&&(this.expirationTime=Date.now()+1e3*d["max-age"])}else s.expires&&(this.expirationTime=new Date(s.expires).getTime());if(this.expirationTime){const d=Date.now();let m=!1;if(this.expirationTime>d)m=!1;else if(p)if(this.expirationTime<p)m=!0;else{const v=this.expirationTime-p;v?this.expirationTime=d+Math.max(v,3e4):m=!0}else m=!0;m?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-new Date().getTime(),Math.pow(2,31)-1)}setFeatureState(s,p){if(!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData||Object.keys(s).length===0)return;const d=this.latestFeatureIndex.loadVTLayers();for(const m in this.buckets){if(!p.style.hasLayer(m))continue;const v=this.buckets[m],S=v.layers[0].sourceLayer||"_geojsonTileLayer",T=d[S],N=s[S];if(!T||!N||Object.keys(N).length===0)continue;v.update(N,T,this.imageAtlas&&this.imageAtlas.patternPositions||{});const O=p&&p.style&&p.style.getLayer(m);O&&(this.queryPadding=Math.max(this.queryPadding,O.queryRadius(v)))}}holdingForFade(){return this.symbolFadeHoldUntil!==void 0}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<u.h.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(s){this.symbolFadeHoldUntil=u.h.now()+s}setDependencies(s,p){const d={};for(const m of p)d[m]=!0;this.dependencies[s]=d}hasDependency(s,p){for(const d of s){const m=this.dependencies[d];if(m){for(const v of p)if(m[v])return!0}}return!1}}class no{constructor(s,p){this.max=s,this.onRemove=p,this.reset()}reset(){for(const s in this.data)for(const p of this.data[s])p.timeout&&clearTimeout(p.timeout),this.onRemove(p.value);return this.data={},this.order=[],this}add(s,p,d){const m=s.wrapped().key;this.data[m]===void 0&&(this.data[m]=[]);const v={value:p,timeout:void 0};if(d!==void 0&&(v.timeout=setTimeout(()=>{this.remove(s,v)},d)),this.data[m].push(v),this.order.push(m),this.order.length>this.max){const S=this._getAndRemoveByKey(this.order[0]);S&&this.onRemove(S)}return this}has(s){return s.wrapped().key in this.data}getAndRemove(s){return this.has(s)?this._getAndRemoveByKey(s.wrapped().key):null}_getAndRemoveByKey(s){const p=this.data[s].shift();return p.timeout&&clearTimeout(p.timeout),this.data[s].length===0&&delete this.data[s],this.order.splice(this.order.indexOf(s),1),p.value}getByKey(s){const p=this.data[s];return p?p[0].value:null}get(s){return this.has(s)?this.data[s.wrapped().key][0].value:null}remove(s,p){if(!this.has(s))return this;const d=s.wrapped().key,m=p===void 0?0:this.data[d].indexOf(p),v=this.data[d][m];return this.data[d].splice(m,1),v.timeout&&clearTimeout(v.timeout),this.data[d].length===0&&delete this.data[d],this.onRemove(v.value),this.order.splice(this.order.indexOf(d),1),this}setMaxSize(s){for(this.max=s;this.order.length>this.max;){const p=this._getAndRemoveByKey(this.order[0]);p&&this.onRemove(p)}return this}filter(s){const p=[];for(const d in this.data)for(const m of this.data[d])s(m.value)||p.push(m);for(const d of p)this.remove(d.value.tileID,d)}}class Vt{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(s,p,d){const m=String(p);if(this.stateChanges[s]=this.stateChanges[s]||{},this.stateChanges[s][m]=this.stateChanges[s][m]||{},u.e(this.stateChanges[s][m],d),this.deletedStates[s]===null){this.deletedStates[s]={};for(const v in this.state[s])v!==m&&(this.deletedStates[s][v]=null)}else if(this.deletedStates[s]&&this.deletedStates[s][m]===null){this.deletedStates[s][m]={};for(const v in this.state[s][m])d[v]||(this.deletedStates[s][m][v]=null)}else for(const v in d)this.deletedStates[s]&&this.deletedStates[s][m]&&this.deletedStates[s][m][v]===null&&delete this.deletedStates[s][m][v]}removeFeatureState(s,p,d){if(this.deletedStates[s]===null)return;const m=String(p);if(this.deletedStates[s]=this.deletedStates[s]||{},d&&p!==void 0)this.deletedStates[s][m]!==null&&(this.deletedStates[s][m]=this.deletedStates[s][m]||{},this.deletedStates[s][m][d]=null);else if(p!==void 0)if(this.stateChanges[s]&&this.stateChanges[s][m])for(d in this.deletedStates[s][m]={},this.stateChanges[s][m])this.deletedStates[s][m][d]=null;else this.deletedStates[s][m]=null;else this.deletedStates[s]=null}getState(s,p){const d=String(p),m=u.e({},(this.state[s]||{})[d],(this.stateChanges[s]||{})[d]);if(this.deletedStates[s]===null)return{};if(this.deletedStates[s]){const v=this.deletedStates[s][p];if(v===null)return{};for(const S in v)delete m[S]}return m}initializeTileState(s,p){s.setFeatureState(this.state,p)}coalesceChanges(s,p){const d={};for(const m in this.stateChanges){this.state[m]=this.state[m]||{};const v={};for(const S in this.stateChanges[m])this.state[m][S]||(this.state[m][S]={}),u.e(this.state[m][S],this.stateChanges[m][S]),v[S]=this.state[m][S];d[m]=v}for(const m in this.deletedStates){this.state[m]=this.state[m]||{};const v={};if(this.deletedStates[m]===null)for(const S in this.state[m])v[S]={},this.state[m][S]={};else for(const S in this.deletedStates[m]){if(this.deletedStates[m][S]===null)this.state[m][S]={};else for(const T of Object.keys(this.deletedStates[m][S]))delete this.state[m][S][T];v[S]=this.state[m][S]}d[m]=d[m]||{},u.e(d[m],v)}if(this.stateChanges={},this.deletedStates={},Object.keys(d).length!==0)for(const m in s)s[m].setFeatureState(d,p)}}class hi extends u.E{constructor(s,p,d){super(),this.id=s,this.dispatcher=d,this.on("data",m=>{m.dataType==="source"&&m.sourceDataType==="metadata"&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&m.dataType==="source"&&m.sourceDataType==="content"&&(this.reload(),this.transform&&this.update(this.transform,this.terrain),this._didEmitContent=!0)}),this.on("dataloading",()=>{this._sourceErrored=!1}),this.on("error",()=>{this._sourceErrored=this._source.loaded()}),this._source=((m,v,S,T)=>{const N=new(Xn(v.type))(m,v,S,T);if(N.id!==m)throw new Error(`Expected Source id to be ${m} instead of ${N.id}`);return N})(s,p,d,this),this._tiles={},this._cache=new no(0,this._unloadTile.bind(this)),this._timers={},this._cacheTimers={},this._maxTileCacheSize=null,this._maxTileCacheZoomLevels=null,this._loadedParentTiles={},this._coveredTiles={},this._state=new Vt,this._didEmitContent=!1,this._updated=!1}onAdd(s){this.map=s,this._maxTileCacheSize=s?s._maxTileCacheSize:null,this._maxTileCacheZoomLevels=s?s._maxTileCacheZoomLevels:null,this._source&&this._source.onAdd&&this._source.onAdd(s)}onRemove(s){this.clearTiles(),this._source&&this._source.onRemove&&this._source.onRemove(s)}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;if(!(this.used===void 0&&this.usedForTerrain===void 0||this.used||this.usedForTerrain))return!0;if(!this._updated)return!1;for(const s in this._tiles){const p=this._tiles[s];if(p.state!=="loaded"&&p.state!=="errored")return!1}return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;const s=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,s&&this.reload(),this.transform&&this.update(this.transform,this.terrain)}_loadTile(s,p){return this._source.loadTile(s,p)}_unloadTile(s){if(this._source.unloadTile)return this._source.unloadTile(s,()=>{})}_abortTile(s){this._source.abortTile&&this._source.abortTile(s,()=>{}),this._source.fire(new u.k("dataabort",{tile:s,coord:s.tileID,dataType:"source"}))}serialize(){return this._source.serialize()}prepare(s){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null);for(const p in this._tiles){const d=this._tiles[p];d.upload(s),d.prepare(this.map.style.imageManager)}}getIds(){return Object.values(this._tiles).map(s=>s.tileID).sort($i).map(s=>s.key)}getRenderableIds(s){const p=[];for(const d in this._tiles)this._isIdRenderable(d,s)&&p.push(this._tiles[d]);return s?p.sort((d,m)=>{const v=d.tileID,S=m.tileID,T=new u.P(v.canonical.x,v.canonical.y)._rotate(this.transform.angle),N=new u.P(S.canonical.x,S.canonical.y)._rotate(this.transform.angle);return v.overscaledZ-S.overscaledZ||N.y-T.y||N.x-T.x}).map(d=>d.tileID.key):p.map(d=>d.tileID).sort($i).map(d=>d.key)}hasRenderableParent(s){const p=this.findLoadedParent(s,0);return!!p&&this._isIdRenderable(p.tileID.key)}_isIdRenderable(s,p){return this._tiles[s]&&this._tiles[s].hasData()&&!this._coveredTiles[s]&&(p||!this._tiles[s].holdingForFade())}reload(){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(const s in this._tiles)this._tiles[s].state!=="errored"&&this._reloadTile(s,"reloading")}}_reloadTile(s,p){const d=this._tiles[s];d&&(d.state!=="loading"&&(d.state=p),this._loadTile(d,this._tileLoaded.bind(this,d,s,p)))}_tileLoaded(s,p,d,m){if(m)return s.state="errored",void(m.status!==404?this._source.fire(new u.j(m,{tile:s})):this.update(this.transform,this.terrain));s.timeAdded=u.h.now(),d==="expired"&&(s.refreshedUponExpiration=!0),this._setTileReloadTimer(p,s),this.getSource().type==="raster-dem"&&s.dem&&this._backfillDEM(s),this._state.initializeTileState(s,this.map?this.map.painter:null),s.aborted||this._source.fire(new u.k("data",{dataType:"source",tile:s,coord:s.tileID}))}_backfillDEM(s){const p=this.getRenderableIds();for(let m=0;m<p.length;m++){const v=p[m];if(s.neighboringTiles&&s.neighboringTiles[v]){const S=this.getTileByID(v);d(s,S),d(S,s)}}function d(m,v){m.needsHillshadePrepare=!0,m.needsTerrainPrepare=!0;let S=v.tileID.canonical.x-m.tileID.canonical.x;const T=v.tileID.canonical.y-m.tileID.canonical.y,N=Math.pow(2,m.tileID.canonical.z),O=v.tileID.key;S===0&&T===0||Math.abs(T)>1||(Math.abs(S)>1&&(Math.abs(S+N)===1?S+=N:Math.abs(S-N)===1&&(S-=N)),v.dem&&m.dem&&(m.dem.backfillBorder(v.dem,S,T),m.neighboringTiles&&m.neighboringTiles[O]&&(m.neighboringTiles[O].backfilled=!0)))}}getTile(s){return this.getTileByID(s.key)}getTileByID(s){return this._tiles[s]}_retainLoadedChildren(s,p,d,m){for(const v in this._tiles){let S=this._tiles[v];if(m[v]||!S.hasData()||S.tileID.overscaledZ<=p||S.tileID.overscaledZ>d)continue;let T=S.tileID;for(;S&&S.tileID.overscaledZ>p+1;){const O=S.tileID.scaledTo(S.tileID.overscaledZ-1);S=this._tiles[O.key],S&&S.hasData()&&(T=O)}let N=T;for(;N.overscaledZ>p;)if(N=N.scaledTo(N.overscaledZ-1),s[N.key]){m[T.key]=T;break}}}findLoadedParent(s,p){if(s.key in this._loadedParentTiles){const d=this._loadedParentTiles[s.key];return d&&d.tileID.overscaledZ>=p?d:null}for(let d=s.overscaledZ-1;d>=p;d--){const m=s.scaledTo(d),v=this._getLoadedTile(m);if(v)return v}}_getLoadedTile(s){const p=this._tiles[s.key];return p&&p.hasData()?p:this._cache.getByKey(s.wrapped().key)}updateCacheSize(s){const p=Math.ceil(s.width/this._source.tileSize)+1,d=Math.ceil(s.height/this._source.tileSize)+1,m=Math.floor(p*d*(this._maxTileCacheZoomLevels===null?u.c.MAX_TILE_CACHE_ZOOM_LEVELS:this._maxTileCacheZoomLevels)),v=typeof this._maxTileCacheSize=="number"?Math.min(this._maxTileCacheSize,m):m;this._cache.setMaxSize(v)}handleWrapJump(s){const p=Math.round((s-(this._prevLng===void 0?s:this._prevLng))/360);if(this._prevLng=s,p){const d={};for(const m in this._tiles){const v=this._tiles[m];v.tileID=v.tileID.unwrapTo(v.tileID.wrap+p),d[v.tileID.key]=v}this._tiles=d;for(const m in this._timers)clearTimeout(this._timers[m]),delete this._timers[m];for(const m in this._tiles)this._setTileReloadTimer(m,this._tiles[m])}}update(s,p){if(this.transform=s,this.terrain=p,!this._sourceLoaded||this._paused)return;let d;this.updateCacheSize(s),this.handleWrapJump(this.transform.center.lng),this._coveredTiles={},this.used||this.usedForTerrain?this._source.tileID?d=s.getVisibleUnwrappedCoordinates(this._source.tileID).map(F=>new u.O(F.canonical.z,F.wrap,F.canonical.z,F.canonical.x,F.canonical.y)):(d=s.coveringTiles({tileSize:this.usedForTerrain?this.tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:!this.usedForTerrain&&this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled,terrain:p}),this._source.hasTile&&(d=d.filter(F=>this._source.hasTile(F)))):d=[];const m=s.coveringZoomLevel(this._source),v=Math.max(m-hi.maxOverzooming,this._source.minzoom),S=Math.max(m+hi.maxUnderzooming,this._source.minzoom);if(this.usedForTerrain){const F={};for(const k of d)if(k.canonical.z>this._source.minzoom){const j=k.scaledTo(k.canonical.z-1);F[j.key]=j;const tt=k.scaledTo(Math.max(this._source.minzoom,Math.min(k.canonical.z,5)));F[tt.key]=tt}d=d.concat(Object.values(F))}const T=d.length===0&&!this._updated&&this._didEmitContent;this._updated=!0,T&&this.fire(new u.k("data",{sourceDataType:"idle",dataType:"source",sourceId:this.id}));const N=this._updateRetainedTiles(d,m);if(Gn(this._source.type)){const F={},k={},j=Object.keys(N),tt=u.h.now();for(const et of j){const st=N[et],K=this._tiles[et];if(!K||K.fadeEndTime!==0&&K.fadeEndTime<=tt)continue;const xt=this.findLoadedParent(st,v);xt&&(this._addTile(xt.tileID),F[xt.tileID.key]=xt.tileID),k[et]=st}this._retainLoadedChildren(k,m,S,N);for(const et in F)N[et]||(this._coveredTiles[et]=!0,N[et]=F[et]);if(p){const et={},st={};for(const K of d)this._tiles[K.key].hasData()?et[K.key]=K:st[K.key]=K;for(const K in st){const xt=st[K].children(this._source.maxzoom);this._tiles[xt[0].key]&&this._tiles[xt[1].key]&&this._tiles[xt[2].key]&&this._tiles[xt[3].key]&&(et[xt[0].key]=N[xt[0].key]=xt[0],et[xt[1].key]=N[xt[1].key]=xt[1],et[xt[2].key]=N[xt[2].key]=xt[2],et[xt[3].key]=N[xt[3].key]=xt[3],delete st[K])}for(const K in st){const xt=this.findLoadedParent(st[K],this._source.minzoom);if(xt){et[xt.tileID.key]=N[xt.tileID.key]=xt.tileID;for(const Nt in et)et[Nt].isChildOf(xt.tileID)&&delete et[Nt]}}for(const K in this._tiles)et[K]||(this._coveredTiles[K]=!0)}}for(const F in N)this._tiles[F].clearFadeHold();const O=u.ab(this._tiles,N);for(const F of O){const k=this._tiles[F];k.hasSymbolBuckets&&!k.holdingForFade()?k.setHoldDuration(this.map._fadeDuration):k.hasSymbolBuckets&&!k.symbolFadeFinished()||this._removeTile(F)}this._updateLoadedParentTileCache()}releaseSymbolFadeTiles(){for(const s in this._tiles)this._tiles[s].holdingForFade()&&this._removeTile(s)}_updateRetainedTiles(s,p){const d={},m={},v=Math.max(p-hi.maxOverzooming,this._source.minzoom),S=Math.max(p+hi.maxUnderzooming,this._source.minzoom),T={};for(const N of s){const O=this._addTile(N);d[N.key]=N,O.hasData()||p<this._source.maxzoom&&(T[N.key]=N)}this._retainLoadedChildren(T,p,S,d);for(const N of s){let O=this._tiles[N.key];if(O.hasData())continue;if(p+1>this._source.maxzoom){const k=N.children(this._source.maxzoom)[0],j=this.getTile(k);if(j&&j.hasData()){d[k.key]=k;continue}}else{const k=N.children(this._source.maxzoom);if(d[k[0].key]&&d[k[1].key]&&d[k[2].key]&&d[k[3].key])continue}let F=O.wasRequested();for(let k=N.overscaledZ-1;k>=v;--k){const j=N.scaledTo(k);if(m[j.key])break;if(m[j.key]=!0,O=this.getTile(j),!O&&F&&(O=this._addTile(j)),O){const tt=O.hasData();if((F||tt)&&(d[j.key]=j),F=O.wasRequested(),tt)break}}}return d}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(const s in this._tiles){const p=[];let d,m=this._tiles[s].tileID;for(;m.overscaledZ>0;){if(m.key in this._loadedParentTiles){d=this._loadedParentTiles[m.key];break}p.push(m.key);const v=m.scaledTo(m.overscaledZ-1);if(d=this._getLoadedTile(v),d)break;m=v}for(const v of p)this._loadedParentTiles[v]=d}}_addTile(s){let p=this._tiles[s.key];if(p)return p;p=this._cache.getAndRemove(s),p&&(this._setTileReloadTimer(s.key,p),p.tileID=s,this._state.initializeTileState(p,this.map?this.map.painter:null),this._cacheTimers[s.key]&&(clearTimeout(this._cacheTimers[s.key]),delete this._cacheTimers[s.key],this._setTileReloadTimer(s.key,p)));const d=p;return p||(p=new Yn(s,this._source.tileSize*s.overscaleFactor()),this._loadTile(p,this._tileLoaded.bind(this,p,s.key,p.state))),p.uses++,this._tiles[s.key]=p,d||this._source.fire(new u.k("dataloading",{tile:p,coord:p.tileID,dataType:"source"})),p}_setTileReloadTimer(s,p){s in this._timers&&(clearTimeout(this._timers[s]),delete this._timers[s]);const d=p.getExpiryTimeout();d&&(this._timers[s]=setTimeout(()=>{this._reloadTile(s,"expired"),delete this._timers[s]},d))}_removeTile(s){const p=this._tiles[s];p&&(p.uses--,delete this._tiles[s],this._timers[s]&&(clearTimeout(this._timers[s]),delete this._timers[s]),p.uses>0||(p.hasData()&&p.state!=="reloading"?this._cache.add(p.tileID,p,p.getExpiryTimeout()):(p.aborted=!0,this._abortTile(p),this._unloadTile(p))))}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const s in this._tiles)this._removeTile(s);this._cache.reset()}tilesIn(s,p,d){const m=[],v=this.transform;if(!v)return m;const S=d?v.getCameraQueryGeometry(s):s,T=s.map(et=>v.pointCoordinate(et,this.terrain)),N=S.map(et=>v.pointCoordinate(et,this.terrain)),O=this.getIds();let F=1/0,k=1/0,j=-1/0,tt=-1/0;for(const et of N)F=Math.min(F,et.x),k=Math.min(k,et.y),j=Math.max(j,et.x),tt=Math.max(tt,et.y);for(let et=0;et<O.length;et++){const st=this._tiles[O[et]];if(st.holdingForFade())continue;const K=st.tileID,xt=Math.pow(2,v.zoom-st.tileID.overscaledZ),Nt=p*st.queryPadding*u.N/st.tileSize/xt,lt=[K.getTilePoint(new u.U(F,k)),K.getTilePoint(new u.U(j,tt))];if(lt[0].x-Nt<u.N&&lt[0].y-Nt<u.N&&lt[1].x+Nt>=0&&lt[1].y+Nt>=0){const wt=T.map(kt=>K.getTilePoint(kt)),Ft=N.map(kt=>K.getTilePoint(kt));m.push({tile:st,tileID:K,queryGeometry:wt,cameraQueryGeometry:Ft,scale:xt})}}return m}getVisibleCoordinates(s){const p=this.getRenderableIds(s).map(d=>this._tiles[d].tileID);for(const d of p)d.posMatrix=this.transform.calculatePosMatrix(d.toUnwrapped());return p}hasTransition(){if(this._source.hasTransition())return!0;if(Gn(this._source.type)){const s=u.h.now();for(const p in this._tiles)if(this._tiles[p].fadeEndTime>=s)return!0}return!1}setFeatureState(s,p,d){this._state.updateState(s=s||"_geojsonTileLayer",p,d)}removeFeatureState(s,p,d){this._state.removeFeatureState(s=s||"_geojsonTileLayer",p,d)}getFeatureState(s,p){return this._state.getState(s=s||"_geojsonTileLayer",p)}setDependencies(s,p,d){const m=this._tiles[s];m&&m.setDependencies(p,d)}reloadTilesForDependencies(s,p){for(const d in this._tiles)this._tiles[d].hasDependency(s,p)&&this._reloadTile(d,"reloading");this._cache.filter(d=>!d.hasDependency(s,p))}}function $i(y,s){const p=Math.abs(2*y.wrap)-+(y.wrap<0),d=Math.abs(2*s.wrap)-+(s.wrap<0);return y.overscaledZ-s.overscaledZ||d-p||s.canonical.y-y.canonical.y||s.canonical.x-y.canonical.x}function Gn(y){return y==="raster"||y==="image"||y==="video"}hi.maxOverzooming=10,hi.maxUnderzooming=3;const vn="mapboxgl_preloaded_worker_pool";class zs{constructor(){this.active={}}acquire(s){if(!this.workers)for(this.workers=[];this.workers.length<zs.workerCount;)this.workers.push(new Worker(u.c.WORKER_URL));return this.active[s]=!0,this.workers.slice()}release(s){delete this.active[s],this.numActive()===0&&(this.workers.forEach(p=>{p.terminate()}),this.workers=null)}isPreloaded(){return!!this.active[vn]}numActive(){return Object.keys(this.active).length}}const pi=Math.floor(u.h.hardwareConcurrency/2);let os;function Ta(){return os||(os=new zs),os}zs.workerCount=u.ac(globalThis)?Math.max(Math.min(pi,3),1):1;class ra{constructor(s,p){this.reset(s,p)}reset(s,p){this.points=s||[],this._distances=[0];for(let d=1;d<this.points.length;d++)this._distances[d]=this._distances[d-1]+this.points[d].dist(this.points[d-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(p||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(s){if(this.points.length===1)return this.points[0];s=u.ad(s,0,1);let p=1,d=this._distances[p];const m=s*this.paddedLength+this.padding;for(;d<m&&p<this._distances.length;)d=this._distances[++p];const v=p-1,S=this._distances[v],T=d-S,N=T>0?(m-S)/T:0;return this.points[v].mult(1-N).add(this.points[p].mult(N))}}function ss(y,s){let p=!0;return y==="always"||y!=="never"&&s!=="never"||(p=!1),p}class ia{constructor(s,p,d){const m=this.boxCells=[],v=this.circleCells=[];this.xCellCount=Math.ceil(s/d),this.yCellCount=Math.ceil(p/d);for(let S=0;S<this.xCellCount*this.yCellCount;S++)m.push([]),v.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=s,this.height=p,this.xScale=this.xCellCount/s,this.yScale=this.yCellCount/p,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(s,p,d,m,v){this._forEachCell(p,d,m,v,this._insertBoxCell,this.boxUid++),this.boxKeys.push(s),this.bboxes.push(p),this.bboxes.push(d),this.bboxes.push(m),this.bboxes.push(v)}insertCircle(s,p,d,m){this._forEachCell(p-m,d-m,p+m,d+m,this._insertCircleCell,this.circleUid++),this.circleKeys.push(s),this.circles.push(p),this.circles.push(d),this.circles.push(m)}_insertBoxCell(s,p,d,m,v,S){this.boxCells[v].push(S)}_insertCircleCell(s,p,d,m,v,S){this.circleCells[v].push(S)}_query(s,p,d,m,v,S,T){if(d<0||s>this.width||m<0||p>this.height)return[];const N=[];if(s<=0&&p<=0&&this.width<=d&&this.height<=m){if(v)return[{key:null,x1:s,y1:p,x2:d,y2:m}];for(let O=0;O<this.boxKeys.length;O++)N.push({key:this.boxKeys[O],x1:this.bboxes[4*O],y1:this.bboxes[4*O+1],x2:this.bboxes[4*O+2],y2:this.bboxes[4*O+3]});for(let O=0;O<this.circleKeys.length;O++){const F=this.circles[3*O],k=this.circles[3*O+1],j=this.circles[3*O+2];N.push({key:this.circleKeys[O],x1:F-j,y1:k-j,x2:F+j,y2:k+j})}}else this._forEachCell(s,p,d,m,this._queryCell,N,{hitTest:v,overlapMode:S,seenUids:{box:{},circle:{}}},T);return N}query(s,p,d,m){return this._query(s,p,d,m,!1,null)}hitTest(s,p,d,m,v,S){return this._query(s,p,d,m,!0,v,S).length>0}hitTestCircle(s,p,d,m,v){const S=s-d,T=s+d,N=p-d,O=p+d;if(T<0||S>this.width||O<0||N>this.height)return!1;const F=[];return this._forEachCell(S,N,T,O,this._queryCellCircle,F,{hitTest:!0,overlapMode:m,circle:{x:s,y:p,radius:d},seenUids:{box:{},circle:{}}},v),F.length>0}_queryCell(s,p,d,m,v,S,T,N){const{seenUids:O,hitTest:F,overlapMode:k}=T,j=this.boxCells[v];if(j!==null){const et=this.bboxes;for(const st of j)if(!O.box[st]){O.box[st]=!0;const K=4*st,xt=this.boxKeys[st];if(s<=et[K+2]&&p<=et[K+3]&&d>=et[K+0]&&m>=et[K+1]&&(!N||N(xt))&&(!F||!ss(k,xt.overlapMode))&&(S.push({key:xt,x1:et[K],y1:et[K+1],x2:et[K+2],y2:et[K+3]}),F))return!0}}const tt=this.circleCells[v];if(tt!==null){const et=this.circles;for(const st of tt)if(!O.circle[st]){O.circle[st]=!0;const K=3*st,xt=this.circleKeys[st];if(this._circleAndRectCollide(et[K],et[K+1],et[K+2],s,p,d,m)&&(!N||N(xt))&&(!F||!ss(k,xt.overlapMode))){const Nt=et[K],lt=et[K+1],wt=et[K+2];if(S.push({key:xt,x1:Nt-wt,y1:lt-wt,x2:Nt+wt,y2:lt+wt}),F)return!0}}}return!1}_queryCellCircle(s,p,d,m,v,S,T,N){const{circle:O,seenUids:F,overlapMode:k}=T,j=this.boxCells[v];if(j!==null){const et=this.bboxes;for(const st of j)if(!F.box[st]){F.box[st]=!0;const K=4*st,xt=this.boxKeys[st];if(this._circleAndRectCollide(O.x,O.y,O.radius,et[K+0],et[K+1],et[K+2],et[K+3])&&(!N||N(xt))&&!ss(k,xt.overlapMode))return S.push(!0),!0}}const tt=this.circleCells[v];if(tt!==null){const et=this.circles;for(const st of tt)if(!F.circle[st]){F.circle[st]=!0;const K=3*st,xt=this.circleKeys[st];if(this._circlesCollide(et[K],et[K+1],et[K+2],O.x,O.y,O.radius)&&(!N||N(xt))&&!ss(k,xt.overlapMode))return S.push(!0),!0}}}_forEachCell(s,p,d,m,v,S,T,N){const O=this._convertToXCellCoord(s),F=this._convertToYCellCoord(p),k=this._convertToXCellCoord(d),j=this._convertToYCellCoord(m);for(let tt=O;tt<=k;tt++)for(let et=F;et<=j;et++)if(v.call(this,s,p,d,m,this.xCellCount*et+tt,S,T,N))return}_convertToXCellCoord(s){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(s*this.xScale)))}_convertToYCellCoord(s){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(s*this.yScale)))}_circlesCollide(s,p,d,m,v,S){const T=m-s,N=v-p,O=d+S;return O*O>T*T+N*N}_circleAndRectCollide(s,p,d,m,v,S,T){const N=(S-m)/2,O=Math.abs(s-(m+N));if(O>N+d)return!1;const F=(T-v)/2,k=Math.abs(p-(v+F));if(k>F+d)return!1;if(O<=N||k<=F)return!0;const j=O-N,tt=k-F;return j*j+tt*tt<=d*d}}function se(y,s,p,d,m){const v=u.Z();return s?(u.a0(v,v,[1/m,1/m,1]),p||u.ae(v,v,d.angle)):u.a1(v,d.labelPlaneMatrix,y),v}function uo(y,s,p,d,m){if(s){const v=u.af(y);return u.a0(v,v,[m,m,1]),p||u.ae(v,v,-d.angle),v}return d.glCoordMatrix}function wr(y,s,p){let d;p?(d=[y.x,y.y,p(y.x,y.y),1],u.ag(d,d,s)):(d=[y.x,y.y,0,1],q(d,d,s));const m=d[3];return{point:new u.P(d[0]/m,d[1]/m),signedDistanceFromCamera:m}}function Au(y,s){return .5+y/s*.5}function Co(y,s){const p=y[0]/y[3],d=y[1]/y[3];return p>=-s[0]&&p<=s[0]&&d>=-s[1]&&d<=s[1]}function le(y,s,p,d,m,v,S,T,N,O){const F=d?y.textSizeData:y.iconSizeData,k=u.ah(F,p.transform.zoom),j=[256/p.width*2+1,256/p.height*2+1],tt=d?y.text.dynamicLayoutVertexArray:y.icon.dynamicLayoutVertexArray;tt.clear();const et=y.lineVertexArray,st=d?y.text.placedSymbolArray:y.icon.placedSymbolArray,K=p.transform.width/p.transform.height;let xt=!1;for(let Nt=0;Nt<st.length;Nt++){const lt=st.get(Nt);if(lt.hidden||lt.writingMode===u.ai.vertical&&!xt){J(lt.numGlyphs,tt);continue}let wt;if(xt=!1,O?(wt=[lt.anchorX,lt.anchorY,O(lt.anchorX,lt.anchorY),1],u.ag(wt,wt,s)):(wt=[lt.anchorX,lt.anchorY,0,1],q(wt,wt,s)),!Co(wt,j)){J(lt.numGlyphs,tt);continue}const Ft=Au(p.transform.cameraToCenterDistance,wt[3]),kt=u.aj(F,k,lt),Zt=S?kt/Ft:kt*Ft,ee=new u.P(lt.anchorX,lt.anchorY),Jt=wr(ee,m,O).point,ue={projections:{},offsets:{}},Me=ro(lt,Zt,!1,T,s,m,v,y.glyphOffsetArray,et,tt,Jt,ee,ue,K,N,O);xt=Me.useVertical,(Me.notEnoughRoom||xt||Me.needsFlipping&&ro(lt,Zt,!0,T,s,m,v,y.glyphOffsetArray,et,tt,Jt,ee,ue,K,N,O).notEnoughRoom)&&J(lt.numGlyphs,tt)}d?y.text.dynamicLayoutVertexBuffer.updateData(tt):y.icon.dynamicLayoutVertexBuffer.updateData(tt)}function an(y,s,p,d,m,v,S,T,N,O,F,k,j){const tt=T.glyphStartIndex+T.numGlyphs,et=T.lineStartIndex,st=T.lineStartIndex+T.lineLength,K=s.getoffsetX(T.glyphStartIndex),xt=s.getoffsetX(tt-1),Nt=V(y*K,p,d,m,v,S,T.segment,et,st,N,O,F,k,j);if(!Nt)return null;const lt=V(y*xt,p,d,m,v,S,T.segment,et,st,N,O,F,k,j);return lt?{first:Nt,last:lt}:null}function Ye(y,s,p,d){return y===u.ai.horizontal&&Math.abs(p.y-s.y)>Math.abs(p.x-s.x)*d?{useVertical:!0}:(y===u.ai.vertical?s.y<p.y:s.x>p.x)?{needsFlipping:!0}:null}function ro(y,s,p,d,m,v,S,T,N,O,F,k,j,tt,et,st){const K=s/24,xt=y.lineOffsetX*K,Nt=y.lineOffsetY*K;let lt;if(y.numGlyphs>1){const wt=y.glyphStartIndex+y.numGlyphs,Ft=y.lineStartIndex,kt=y.lineStartIndex+y.lineLength,Zt=an(K,T,xt,Nt,p,F,k,y,N,v,j,et,st);if(!Zt)return{notEnoughRoom:!0};const ee=wr(Zt.first.point,S,st).point,Jt=wr(Zt.last.point,S,st).point;if(d&&!p){const ue=Ye(y.writingMode,ee,Jt,tt);if(ue)return ue}lt=[Zt.first];for(let ue=y.glyphStartIndex+1;ue<wt-1;ue++)lt.push(V(K*T.getoffsetX(ue),xt,Nt,p,F,k,y.segment,Ft,kt,N,v,j,et,st));lt.push(Zt.last)}else{if(d&&!p){const Ft=wr(k,m,st).point,kt=y.lineStartIndex+y.segment+1,Zt=new u.P(N.getx(kt),N.gety(kt)),ee=wr(Zt,m,st),Jt=ee.signedDistanceFromCamera>0?ee.point:jo(k,Zt,Ft,1,m,st),ue=Ye(y.writingMode,Ft,Jt,tt);if(ue)return ue}const wt=V(K*T.getoffsetX(y.glyphStartIndex),xt,Nt,p,F,k,y.segment,y.lineStartIndex,y.lineStartIndex+y.lineLength,N,v,j,et,st);if(!wt)return{notEnoughRoom:!0};lt=[wt]}for(const wt of lt)u.ak(O,wt.point,wt.angle);return{}}function jo(y,s,p,d,m,v){const S=wr(y.add(y.sub(s)._unit()),m,v).point,T=p.sub(S);return p.add(T._mult(d/T.mag()))}function je(y,s){const{projectionCache:p,lineVertexArray:d,labelPlaneMatrix:m,tileAnchorPoint:v,distanceFromAnchor:S,getElevation:T,previousVertex:N,direction:O,absOffsetX:F}=s;if(p.projections[y])return p.projections[y];const k=new u.P(d.getx(y),d.gety(y)),j=wr(k,m,T);if(j.signedDistanceFromCamera>0)return p.projections[y]=j.point,j.point;const tt=y-O;return jo(S===0?v:new u.P(d.getx(tt),d.gety(tt)),k,N,F-S+1,m,T)}function as(y,s,p){return y._unit()._perp()._mult(s*p)}function ot(y,s,p,d,m,v,S,T){const{projectionCache:N,direction:O}=T;if(N.offsets[y])return N.offsets[y];const F=p.add(s);if(y+O<d||y+O>=m)return N.offsets[y]=F,F;const k=je(y+O,T),j=as(k.sub(p),S,O),tt=p.add(j),et=k.add(j);return N.offsets[y]=u.al(v,F,tt,et)||F,N.offsets[y]}function V(y,s,p,d,m,v,S,T,N,O,F,k,j,tt){const et=d?y-s:y+s;let st=et>0?1:-1,K=0;d&&(st*=-1,K=Math.PI),st<0&&(K+=Math.PI);let xt,Nt,lt=st>0?T+S:T+S+1,wt=m,Ft=m,kt=0,Zt=0;const ee=Math.abs(et),Jt=[];let ue;for(;kt+Zt<=ee;){if(lt+=st,lt<T||lt>=N)return null;kt+=Zt,Ft=wt,Nt=xt;const ye={projectionCache:k,lineVertexArray:O,labelPlaneMatrix:F,tileAnchorPoint:v,distanceFromAnchor:kt,getElevation:tt,previousVertex:Ft,direction:st,absOffsetX:ee};if(wt=je(lt,ye),p===0)Jt.push(Ft),ue=wt.sub(Ft);else{let He;const De=wt.sub(Ft);He=De.mag()===0?as(je(lt+st,ye).sub(wt),p,st):as(De,p,st),Nt||(Nt=Ft.add(He)),xt=ot(lt,He,wt,T,N,Nt,p,ye),Jt.push(Nt),ue=xt.sub(Nt)}Zt=ue.mag()}const Me=ue._mult((ee-kt)/Zt)._add(Nt||Ft),Nn=K+Math.atan2(wt.y-Ft.y,wt.x-Ft.x);return Jt.push(Me),{point:Me,angle:j?Nn:0,path:Jt}}const G=new Float32Array([-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0]);function J(y,s){for(let p=0;p<y;p++){const d=s.length;s.resize(d+4),s.float32.set(G,3*d)}}function q(y,s,p){const d=s[0],m=s[1];return y[0]=p[0]*d+p[4]*m+p[12],y[1]=p[1]*d+p[5]*m+p[13],y[3]=p[3]*d+p[7]*m+p[15],y}const nt=100;class bt{constructor(s,p=new ia(s.width+200,s.height+200,25),d=new ia(s.width+200,s.height+200,25)){this.transform=s,this.grid=p,this.ignoredGrid=d,this.pitchfactor=Math.cos(s._pitch)*s.cameraToCenterDistance,this.screenRightBoundary=s.width+nt,this.screenBottomBoundary=s.height+nt,this.gridRightBoundary=s.width+200,this.gridBottomBoundary=s.height+200,this.perspectiveRatioCutoff=.6}placeCollisionBox(s,p,d,m,v,S){const T=this.projectAndGetPerspectiveRatio(m,s.anchorPointX,s.anchorPointY,S),N=d*T.perspectiveRatio,O=s.x1*N+T.point.x,F=s.y1*N+T.point.y,k=s.x2*N+T.point.x,j=s.y2*N+T.point.y;return!this.isInsideGrid(O,F,k,j)||p!=="always"&&this.grid.hitTest(O,F,k,j,p,v)||T.perspectiveRatio<this.perspectiveRatioCutoff?{box:[],offscreen:!1}:{box:[O,F,k,j],offscreen:this.isOffscreen(O,F,k,j)}}placeCollisionCircles(s,p,d,m,v,S,T,N,O,F,k,j,tt,et){const st=[],K=new u.P(p.anchorX,p.anchorY),xt=wr(K,S,et),Nt=Au(this.transform.cameraToCenterDistance,xt.signedDistanceFromCamera),lt=(F?v/Nt:v*Nt)/u.ap,wt=wr(K,T,et).point,Ft=an(lt,m,p.lineOffsetX*lt,p.lineOffsetY*lt,!1,wt,K,p,d,T,{projections:{},offsets:{}},!1,et);let kt=!1,Zt=!1,ee=!0;if(Ft){const Jt=.5*j*Nt+tt,ue=new u.P(-100,-100),Me=new u.P(this.screenRightBoundary,this.screenBottomBoundary),Nn=new ra,ye=Ft.first,He=Ft.last;let De=[];for(let _n=ye.path.length-1;_n>=1;_n--)De.push(ye.path[_n]);for(let _n=1;_n<He.path.length;_n++)De.push(He.path[_n]);const _r=2.5*Jt;if(N){const _n=De.map(Pn=>wr(Pn,N,et));De=_n.some(Pn=>Pn.signedDistanceFromCamera<=0)?[]:_n.map(Pn=>Pn.point)}let Tn=[];if(De.length>0){const _n=De[0].clone(),Pn=De[0].clone();for(let Pi=1;Pi<De.length;Pi++)_n.x=Math.min(_n.x,De[Pi].x),_n.y=Math.min(_n.y,De[Pi].y),Pn.x=Math.max(Pn.x,De[Pi].x),Pn.y=Math.max(Pn.y,De[Pi].y);Tn=_n.x>=ue.x&&Pn.x<=Me.x&&_n.y>=ue.y&&Pn.y<=Me.y?[De]:Pn.x<ue.x||_n.x>Me.x||Pn.y<ue.y||_n.y>Me.y?[]:u.am([De],ue.x,ue.y,Me.x,Me.y)}for(const _n of Tn){Nn.reset(_n,.25*Jt);let Pn=0;Pn=Nn.length<=.5*Jt?1:Math.ceil(Nn.paddedLength/_r)+1;for(let Pi=0;Pi<Pn;Pi++){const Dr=Pi/Math.max(Pn-1,1),Zo=Nn.lerp(Dr),co=Zo.x+nt,qi=Zo.y+nt;st.push(co,qi,Jt,0);const Oa=co-Jt,Gr=qi-Jt,Sl=co+Jt,Cl=qi+Jt;if(ee=ee&&this.isOffscreen(Oa,Gr,Sl,Cl),Zt=Zt||this.isInsideGrid(Oa,Gr,Sl,Cl),s!=="always"&&this.grid.hitTestCircle(co,qi,Jt,s,k)&&(kt=!0,!O))return{circles:[],offscreen:!1,collisionDetected:kt}}}}return{circles:!O&&kt||!Zt||Nt<this.perspectiveRatioCutoff?[]:st,offscreen:ee,collisionDetected:kt}}queryRenderedSymbols(s){if(s.length===0||this.grid.keysLength()===0&&this.ignoredGrid.keysLength()===0)return{};const p=[];let d=1/0,m=1/0,v=-1/0,S=-1/0;for(const F of s){const k=new u.P(F.x+nt,F.y+nt);d=Math.min(d,k.x),m=Math.min(m,k.y),v=Math.max(v,k.x),S=Math.max(S,k.y),p.push(k)}const T=this.grid.query(d,m,v,S).concat(this.ignoredGrid.query(d,m,v,S)),N={},O={};for(const F of T){const k=F.key;if(N[k.bucketInstanceId]===void 0&&(N[k.bucketInstanceId]={}),N[k.bucketInstanceId][k.featureIndex])continue;const j=[new u.P(F.x1,F.y1),new u.P(F.x2,F.y1),new u.P(F.x2,F.y2),new u.P(F.x1,F.y2)];u.an(p,j)&&(N[k.bucketInstanceId][k.featureIndex]=!0,O[k.bucketInstanceId]===void 0&&(O[k.bucketInstanceId]=[]),O[k.bucketInstanceId].push(k.featureIndex))}return O}insertCollisionBox(s,p,d,m,v,S){(d?this.ignoredGrid:this.grid).insert({bucketInstanceId:m,featureIndex:v,collisionGroupID:S,overlapMode:p},s[0],s[1],s[2],s[3])}insertCollisionCircles(s,p,d,m,v,S){const T=d?this.ignoredGrid:this.grid,N={bucketInstanceId:m,featureIndex:v,collisionGroupID:S,overlapMode:p};for(let O=0;O<s.length;O+=4)T.insertCircle(N,s[O],s[O+1],s[O+2])}projectAndGetPerspectiveRatio(s,p,d,m){let v;return m?(v=[p,d,m(p,d),1],u.ag(v,v,s)):(v=[p,d,0,1],q(v,v,s)),{point:new u.P((v[0]/v[3]+1)/2*this.transform.width+nt,(-v[1]/v[3]+1)/2*this.transform.height+nt),perspectiveRatio:.5+this.transform.cameraToCenterDistance/v[3]*.5}}isOffscreen(s,p,d,m){return d<nt||s>=this.screenRightBoundary||m<nt||p>this.screenBottomBoundary}isInsideGrid(s,p,d,m){return d>=0&&s<this.gridRightBoundary&&m>=0&&p<this.gridBottomBoundary}getViewportMatrix(){const s=u.ao([]);return u.$(s,s,[-100,-100,0]),s}}function ft(y,s,p){return s*(u.N/(y.tileSize*Math.pow(2,p-y.tileID.overscaledZ)))}class it{constructor(s,p,d,m){this.opacity=s?Math.max(0,Math.min(1,s.opacity+(s.placed?p:-p))):m&&d?1:0,this.placed=d}isHidden(){return this.opacity===0&&!this.placed}}class dt{constructor(s,p,d,m,v){this.text=new it(s?s.text:null,p,d,v),this.icon=new it(s?s.icon:null,p,m,v)}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class qt{constructor(s,p,d){this.text=s,this.icon=p,this.skipFade=d}}class jt{constructor(){this.invProjMatrix=u.Z(),this.viewportMatrix=u.Z(),this.circles=[]}}class Xt{constructor(s,p,d,m,v){this.bucketInstanceId=s,this.featureIndex=p,this.sourceLayerIndex=d,this.bucketIndex=m,this.tileID=v}}class Pe{constructor(s){this.crossSourceCollisions=s,this.maxGroupID=0,this.collisionGroups={}}get(s){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[s]){const p=++this.maxGroupID;this.collisionGroups[s]={ID:p,predicate:d=>d.collisionGroupID===p}}return this.collisionGroups[s]}}function Qe(y,s,p,d,m){const{horizontalAlign:v,verticalAlign:S}=u.au(y);return new u.P(-(v-.5)*s+d[0]*m,-(S-.5)*p+d[1]*m)}function Le(y,s,p,d,m,v){const{x1:S,x2:T,y1:N,y2:O,anchorPointX:F,anchorPointY:k}=y,j=new u.P(s,p);return d&&j._rotate(m?v:-v),{x1:S+j.x,y1:N+j.y,x2:T+j.x,y2:O+j.y,anchorPointX:F,anchorPointY:k}}class ke{constructor(s,p,d,m,v){this.transform=s.clone(),this.terrain=p,this.collisionIndex=new bt(this.transform),this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=d,this.retainedQueryData={},this.collisionGroups=new Pe(m),this.collisionCircleArrays={},this.prevPlacement=v,v&&(v.prevPlacement=void 0),this.placedOrientations={}}getBucketParts(s,p,d,m){const v=d.getBucket(p),S=d.latestFeatureIndex;if(!v||!S||p.id!==v.layerIds[0])return;const T=d.collisionBoxArray,N=v.layers[0].layout,O=Math.pow(2,this.transform.zoom-d.tileID.overscaledZ),F=d.tileSize/u.N,k=this.transform.calculatePosMatrix(d.tileID.toUnwrapped()),j=N.get("text-pitch-alignment")==="map",tt=N.get("text-rotation-alignment")==="map",et=ft(d,1,this.transform.zoom),st=se(k,j,tt,this.transform,et);let K=null;if(j){const Nt=uo(k,j,tt,this.transform,et);K=u.a1([],this.transform.labelPlaneMatrix,Nt)}this.retainedQueryData[v.bucketInstanceId]=new Xt(v.bucketInstanceId,S,v.sourceLayerIndex,v.index,d.tileID);const xt={bucket:v,layout:N,posMatrix:k,textLabelPlaneMatrix:st,labelToScreenMatrix:K,scale:O,textPixelRatio:F,holdingForFade:d.holdingForFade(),collisionBoxArray:T,partiallyEvaluatedTextSize:u.ah(v.textSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(v.sourceID)};if(m)for(const Nt of v.sortKeyRanges){const{sortKey:lt,symbolInstanceStart:wt,symbolInstanceEnd:Ft}=Nt;s.push({sortKey:lt,symbolInstanceStart:wt,symbolInstanceEnd:Ft,parameters:xt})}else s.push({symbolInstanceStart:0,symbolInstanceEnd:v.symbolInstances.length,parameters:xt})}attemptAnchorPlacement(s,p,d,m,v,S,T,N,O,F,k,j,tt,et,st,K){const xt=u.aq[s.textAnchor],Nt=[s.textOffset0,s.textOffset1],lt=Qe(xt,d,m,Nt,v),wt=this.collisionIndex.placeCollisionBox(Le(p,lt.x,lt.y,S,T,this.transform.angle),k,N,O,F.predicate,K);if((!st||this.collisionIndex.placeCollisionBox(Le(st,lt.x,lt.y,S,T,this.transform.angle),k,N,O,F.predicate,K).box.length!==0)&&wt.box.length>0){let Ft;if(this.prevPlacement&&this.prevPlacement.variableOffsets[j.crossTileID]&&this.prevPlacement.placements[j.crossTileID]&&this.prevPlacement.placements[j.crossTileID].text&&(Ft=this.prevPlacement.variableOffsets[j.crossTileID].anchor),j.crossTileID===0)throw new Error("symbolInstance.crossTileID can't be 0");return this.variableOffsets[j.crossTileID]={textOffset:Nt,width:d,height:m,anchor:xt,textBoxScale:v,prevAnchor:Ft},this.markUsedJustification(tt,xt,j,et),tt.allowVerticalPlacement&&(this.markUsedOrientation(tt,et,j),this.placedOrientations[j.crossTileID]=et),{shift:lt,placedGlyphBoxes:wt}}}placeLayerBucketPart(s,p,d){const{bucket:m,layout:v,posMatrix:S,textLabelPlaneMatrix:T,labelToScreenMatrix:N,textPixelRatio:O,holdingForFade:F,collisionBoxArray:k,partiallyEvaluatedTextSize:j,collisionGroup:tt}=s.parameters,et=v.get("text-optional"),st=v.get("icon-optional"),K=u.ar(v,"text-overlap","text-allow-overlap"),xt=K==="always",Nt=u.ar(v,"icon-overlap","icon-allow-overlap"),lt=Nt==="always",wt=v.get("text-rotation-alignment")==="map",Ft=v.get("text-pitch-alignment")==="map",kt=v.get("icon-text-fit")!=="none",Zt=v.get("symbol-z-order")==="viewport-y",ee=xt&&(lt||!m.hasIconData()||st),Jt=lt&&(xt||!m.hasTextData()||et);!m.collisionArrays&&k&&m.deserializeCollisionBoxes(k);const ue=this.retainedQueryData[m.bucketInstanceId].tileID,Me=this.terrain?(ye,He)=>this.terrain.getElevation(ue,ye,He):null,Nn=(ye,He)=>{var De,_r;if(p[ye.crossTileID])return;if(F)return void(this.placements[ye.crossTileID]=new qt(!1,!1,!1));let Tn=!1,_n=!1,Pn=!0,Pi=null,Dr={box:null,offscreen:null},Zo={box:null,offscreen:null},co=null,qi=null,Oa=null,Gr=0,Sl=0,Cl=0;He.textFeatureIndex?Gr=He.textFeatureIndex:ye.useRuntimeCollisionCircles&&(Gr=ye.featureIndex),He.verticalTextFeatureIndex&&(Sl=He.verticalTextFeatureIndex);const dh=He.textBox;if(dh){const fs=Mi=>{let ho=u.ai.horizontal;if(m.allowVerticalPlacement&&!Mi&&this.prevPlacement){const la=this.prevPlacement.placedOrientations[ye.crossTileID];la&&(this.placedOrientations[ye.crossTileID]=la,ho=la,this.markUsedOrientation(m,ho,ye))}return ho},Ho=(Mi,ho)=>{if(m.allowVerticalPlacement&&ye.numVerticalGlyphVertices>0&&He.verticalTextBox){for(const la of m.writingModes)if(la===u.ai.vertical?(Dr=ho(),Zo=Dr):Dr=Mi(),Dr&&Dr.box&&Dr.box.length)break}else Dr=Mi()},Us=ye.textAnchorOffsetStartIndex,cp=ye.textAnchorOffsetEndIndex;if(cp===Us){const Mi=(ho,la)=>{const Ai=this.collisionIndex.placeCollisionBox(ho,K,O,S,tt.predicate,Me);return Ai&&Ai.box&&Ai.box.length&&(this.markUsedOrientation(m,la,ye),this.placedOrientations[ye.crossTileID]=la),Ai};Ho(()=>Mi(dh,u.ai.horizontal),()=>{const ho=He.verticalTextBox;return m.allowVerticalPlacement&&ye.numVerticalGlyphVertices>0&&ho?Mi(ho,u.ai.vertical):{box:null,offscreen:null}}),fs(Dr&&Dr.box&&Dr.box.length)}else{let Mi=u.aq[(_r=(De=this.prevPlacement)===null||De===void 0?void 0:De.variableOffsets[ye.crossTileID])===null||_r===void 0?void 0:_r.anchor];const ho=(Ai,hp,Tg)=>{const U_=Ai.x2-Ai.x1,G_=Ai.y2-Ai.y1,R0=ye.textBoxScale,ay=kt&&Nt==="never"?hp:null;let Tl={box:[],offscreen:!1},pp=K==="never"?1:2,Ll="never";Mi&&pp++;for(let hu=0;hu<pp;hu++){for(let Nl=Us;Nl<cp;Nl++){const uy=m.textAnchorOffsets.get(Nl);if(Mi&&uy.textAnchor!==Mi)continue;const Ec=this.attemptAnchorPlacement(uy,Ai,U_,G_,R0,wt,Ft,O,S,tt,Ll,ye,m,Tg,ay,Me);if(Ec&&(Tl=Ec.placedGlyphBoxes,Tl&&Tl.box&&Tl.box.length))return Tn=!0,Pi=Ec.shift,Tl}Mi?Mi=null:Ll=K}return Tl};Ho(()=>ho(dh,He.iconBox,u.ai.horizontal),()=>{const Ai=He.verticalTextBox;return m.allowVerticalPlacement&&!(Dr&&Dr.box&&Dr.box.length)&&ye.numVerticalGlyphVertices>0&&Ai?ho(Ai,He.verticalIconBox,u.ai.vertical):{box:null,offscreen:null}}),Dr&&(Tn=Dr.box,Pn=Dr.offscreen);const la=fs(Dr&&Dr.box);if(!Tn&&this.prevPlacement){const Ai=this.prevPlacement.variableOffsets[ye.crossTileID];Ai&&(this.variableOffsets[ye.crossTileID]=Ai,this.markUsedJustification(m,Ai.anchor,ye,la))}}}if(co=Dr,Tn=co&&co.box&&co.box.length>0,Pn=co&&co.offscreen,ye.useRuntimeCollisionCircles){const fs=m.text.placedSymbolArray.get(ye.centerJustifiedTextSymbolIndex),Ho=u.aj(m.textSizeData,j,fs),Us=v.get("text-padding");qi=this.collisionIndex.placeCollisionCircles(K,fs,m.lineVertexArray,m.glyphOffsetArray,Ho,S,T,N,d,Ft,tt.predicate,ye.collisionCircleDiameter,Us,Me),qi.circles.length&&qi.collisionDetected&&!d&&u.w("Collisions detected, but collision boxes are not shown"),Tn=xt||qi.circles.length>0&&!qi.collisionDetected,Pn=Pn&&qi.offscreen}if(He.iconFeatureIndex&&(Cl=He.iconFeatureIndex),He.iconBox){const fs=Ho=>{const Us=kt&&Pi?Le(Ho,Pi.x,Pi.y,wt,Ft,this.transform.angle):Ho;return this.collisionIndex.placeCollisionBox(Us,Nt,O,S,tt.predicate,Me)};Zo&&Zo.box&&Zo.box.length&&He.verticalIconBox?(Oa=fs(He.verticalIconBox),_n=Oa.box.length>0):(Oa=fs(He.iconBox),_n=Oa.box.length>0),Pn=Pn&&Oa.offscreen}const lp=et||ye.numHorizontalGlyphVertices===0&&ye.numVerticalGlyphVertices===0,xf=st||ye.numIconVertices===0;if(lp||xf?xf?lp||(_n=_n&&Tn):Tn=_n&&Tn:_n=Tn=_n&&Tn,Tn&&co&&co.box&&this.collisionIndex.insertCollisionBox(co.box,K,v.get("text-ignore-placement"),m.bucketInstanceId,Zo&&Zo.box&&Sl?Sl:Gr,tt.ID),_n&&Oa&&this.collisionIndex.insertCollisionBox(Oa.box,Nt,v.get("icon-ignore-placement"),m.bucketInstanceId,Cl,tt.ID),qi&&(Tn&&this.collisionIndex.insertCollisionCircles(qi.circles,K,v.get("text-ignore-placement"),m.bucketInstanceId,Gr,tt.ID),d)){const fs=m.bucketInstanceId;let Ho=this.collisionCircleArrays[fs];Ho===void 0&&(Ho=this.collisionCircleArrays[fs]=new jt);for(let Us=0;Us<qi.circles.length;Us+=4)Ho.circles.push(qi.circles[Us+0]),Ho.circles.push(qi.circles[Us+1]),Ho.circles.push(qi.circles[Us+2]),Ho.circles.push(qi.collisionDetected?1:0)}if(ye.crossTileID===0)throw new Error("symbolInstance.crossTileID can't be 0");if(m.bucketInstanceId===0)throw new Error("bucket.bucketInstanceId can't be 0");this.placements[ye.crossTileID]=new qt(Tn||ee,_n||Jt,Pn||m.justReloaded),p[ye.crossTileID]=!0};if(Zt){if(s.symbolInstanceStart!==0)throw new Error("bucket.bucketInstanceId should be 0");const ye=m.getSortedSymbolIndexes(this.transform.angle);for(let He=ye.length-1;He>=0;--He){const De=ye[He];Nn(m.symbolInstances.get(De),m.collisionArrays[De])}}else for(let ye=s.symbolInstanceStart;ye<s.symbolInstanceEnd;ye++)Nn(m.symbolInstances.get(ye),m.collisionArrays[ye]);if(d&&m.bucketInstanceId in this.collisionCircleArrays){const ye=this.collisionCircleArrays[m.bucketInstanceId];u.as(ye.invProjMatrix,S),ye.viewportMatrix=this.collisionIndex.getViewportMatrix()}m.justReloaded=!1}markUsedJustification(s,p,d,m){let v;v=m===u.ai.vertical?d.verticalPlacedTextSymbolIndex:{left:d.leftJustifiedTextSymbolIndex,center:d.centerJustifiedTextSymbolIndex,right:d.rightJustifiedTextSymbolIndex}[u.at(p)];const S=[d.leftJustifiedTextSymbolIndex,d.centerJustifiedTextSymbolIndex,d.rightJustifiedTextSymbolIndex,d.verticalPlacedTextSymbolIndex];for(const T of S)T>=0&&(s.text.placedSymbolArray.get(T).crossTileID=v>=0&&T!==v?0:d.crossTileID)}markUsedOrientation(s,p,d){const m=p===u.ai.horizontal||p===u.ai.horizontalOnly?p:0,v=p===u.ai.vertical?p:0,S=[d.leftJustifiedTextSymbolIndex,d.centerJustifiedTextSymbolIndex,d.rightJustifiedTextSymbolIndex];for(const T of S)s.text.placedSymbolArray.get(T).placedOrientation=m;d.verticalPlacedTextSymbolIndex&&(s.text.placedSymbolArray.get(d.verticalPlacedTextSymbolIndex).placedOrientation=v)}commit(s){this.commitTime=s,this.zoomAtLastRecencyCheck=this.transform.zoom;const p=this.prevPlacement;let d=!1;this.prevZoomAdjustment=p?p.zoomAdjustment(this.transform.zoom):0;const m=p?p.symbolFadeChange(s):1,v=p?p.opacities:{},S=p?p.variableOffsets:{},T=p?p.placedOrientations:{};for(const N in this.placements){const O=this.placements[N],F=v[N];F?(this.opacities[N]=new dt(F,m,O.text,O.icon),d=d||O.text!==F.text.placed||O.icon!==F.icon.placed):(this.opacities[N]=new dt(null,m,O.text,O.icon,O.skipFade),d=d||O.text||O.icon)}for(const N in v){const O=v[N];if(!this.opacities[N]){const F=new dt(O,m,!1,!1);F.isHidden()||(this.opacities[N]=F,d=d||O.text.placed||O.icon.placed)}}for(const N in S)this.variableOffsets[N]||!this.opacities[N]||this.opacities[N].isHidden()||(this.variableOffsets[N]=S[N]);for(const N in T)this.placedOrientations[N]||!this.opacities[N]||this.opacities[N].isHidden()||(this.placedOrientations[N]=T[N]);if(p&&p.lastPlacementChangeTime===void 0)throw new Error("Last placement time for previous placement is not defined");d?this.lastPlacementChangeTime=s:typeof this.lastPlacementChangeTime!="number"&&(this.lastPlacementChangeTime=p?p.lastPlacementChangeTime:s)}updateLayerOpacities(s,p){const d={};for(const m of p){const v=m.getBucket(s);v&&m.latestFeatureIndex&&s.id===v.layerIds[0]&&this.updateBucketOpacities(v,d,m.collisionBoxArray)}}updateBucketOpacities(s,p,d){s.hasTextData()&&(s.text.opacityVertexArray.clear(),s.text.hasVisibleVertices=!1),s.hasIconData()&&(s.icon.opacityVertexArray.clear(),s.icon.hasVisibleVertices=!1),s.hasIconCollisionBoxData()&&s.iconCollisionBox.collisionVertexArray.clear(),s.hasTextCollisionBoxData()&&s.textCollisionBox.collisionVertexArray.clear();const m=s.layers[0],v=m.layout,S=new dt(null,0,!1,!1,!0),T=v.get("text-allow-overlap"),N=v.get("icon-allow-overlap"),O=m._unevaluatedLayout.hasValue("text-variable-anchor")||m._unevaluatedLayout.hasValue("text-variable-anchor-offset"),F=v.get("text-rotation-alignment")==="map",k=v.get("text-pitch-alignment")==="map",j=v.get("icon-text-fit")!=="none",tt=new dt(null,0,T&&(N||!s.hasIconData()||v.get("icon-optional")),N&&(T||!s.hasTextData()||v.get("text-optional")),!0);!s.collisionArrays&&d&&(s.hasIconCollisionBoxData()||s.hasTextCollisionBoxData())&&s.deserializeCollisionBoxes(d);const et=(st,K,xt)=>{for(let Nt=0;Nt<K/4;Nt++)st.opacityVertexArray.emplaceBack(xt);st.hasVisibleVertices=st.hasVisibleVertices||xt!==oa};for(let st=0;st<s.symbolInstances.length;st++){const K=s.symbolInstances.get(st),{numHorizontalGlyphVertices:xt,numVerticalGlyphVertices:Nt,crossTileID:lt}=K;let wt=this.opacities[lt];p[lt]?wt=S:wt||(wt=tt,this.opacities[lt]=wt),p[lt]=!0;const Ft=K.numIconVertices>0,kt=this.placedOrientations[K.crossTileID],Zt=kt===u.ai.vertical,ee=kt===u.ai.horizontal||kt===u.ai.horizontalOnly;if(xt>0||Nt>0){const Jt=Vi(wt.text);et(s.text,xt,Zt?oa:Jt),et(s.text,Nt,ee?oa:Jt);const ue=wt.text.isHidden();[K.rightJustifiedTextSymbolIndex,K.centerJustifiedTextSymbolIndex,K.leftJustifiedTextSymbolIndex].forEach(ye=>{ye>=0&&(s.text.placedSymbolArray.get(ye).hidden=ue||Zt?1:0)}),K.verticalPlacedTextSymbolIndex>=0&&(s.text.placedSymbolArray.get(K.verticalPlacedTextSymbolIndex).hidden=ue||ee?1:0);const Me=this.variableOffsets[K.crossTileID];Me&&this.markUsedJustification(s,Me.anchor,K,kt);const Nn=this.placedOrientations[K.crossTileID];Nn&&(this.markUsedJustification(s,"left",K,Nn),this.markUsedOrientation(s,Nn,K))}if(Ft){const Jt=Vi(wt.icon),ue=!(j&&K.verticalPlacedIconSymbolIndex&&Zt);K.placedIconSymbolIndex>=0&&(et(s.icon,K.numIconVertices,ue?Jt:oa),s.icon.placedSymbolArray.get(K.placedIconSymbolIndex).hidden=wt.icon.isHidden()),K.verticalPlacedIconSymbolIndex>=0&&(et(s.icon,K.numVerticalIconVertices,ue?oa:Jt),s.icon.placedSymbolArray.get(K.verticalPlacedIconSymbolIndex).hidden=wt.icon.isHidden())}if(s.hasIconCollisionBoxData()||s.hasTextCollisionBoxData()){const Jt=s.collisionArrays[st];if(Jt){let ue=new u.P(0,0);if(Jt.textBox||Jt.verticalTextBox){let Nn=!0;if(O){const ye=this.variableOffsets[lt];ye?(ue=Qe(ye.anchor,ye.width,ye.height,ye.textOffset,ye.textBoxScale),F&&ue._rotate(k?this.transform.angle:-this.transform.angle)):Nn=!1}Jt.textBox&&on(s.textCollisionBox.collisionVertexArray,wt.text.placed,!Nn||Zt,ue.x,ue.y),Jt.verticalTextBox&&on(s.textCollisionBox.collisionVertexArray,wt.text.placed,!Nn||ee,ue.x,ue.y)}const Me=!!(!ee&&Jt.verticalIconBox);Jt.iconBox&&on(s.iconCollisionBox.collisionVertexArray,wt.icon.placed,Me,j?ue.x:0,j?ue.y:0),Jt.verticalIconBox&&on(s.iconCollisionBox.collisionVertexArray,wt.icon.placed,!Me,j?ue.x:0,j?ue.y:0)}}}if(s.sortFeatures(this.transform.angle),this.retainedQueryData[s.bucketInstanceId]&&(this.retainedQueryData[s.bucketInstanceId].featureSortOrder=s.featureSortOrder),s.hasTextData()&&s.text.opacityVertexBuffer&&s.text.opacityVertexBuffer.updateData(s.text.opacityVertexArray),s.hasIconData()&&s.icon.opacityVertexBuffer&&s.icon.opacityVertexBuffer.updateData(s.icon.opacityVertexArray),s.hasIconCollisionBoxData()&&s.iconCollisionBox.collisionVertexBuffer&&s.iconCollisionBox.collisionVertexBuffer.updateData(s.iconCollisionBox.collisionVertexArray),s.hasTextCollisionBoxData()&&s.textCollisionBox.collisionVertexBuffer&&s.textCollisionBox.collisionVertexBuffer.updateData(s.textCollisionBox.collisionVertexArray),s.text.opacityVertexArray.length!==s.text.layoutVertexArray.length/4)throw new Error(`bucket.text.opacityVertexArray.length (= ${s.text.opacityVertexArray.length}) !== bucket.text.layoutVertexArray.length (= ${s.text.layoutVertexArray.length}) / 4`);if(s.icon.opacityVertexArray.length!==s.icon.layoutVertexArray.length/4)throw new Error(`bucket.icon.opacityVertexArray.length (= ${s.icon.opacityVertexArray.length}) !== bucket.icon.layoutVertexArray.length (= ${s.icon.layoutVertexArray.length}) / 4`);if(s.bucketInstanceId in this.collisionCircleArrays){const st=this.collisionCircleArrays[s.bucketInstanceId];s.placementInvProjMatrix=st.invProjMatrix,s.placementViewportMatrix=st.viewportMatrix,s.collisionCircleArray=st.circles,delete this.collisionCircleArrays[s.bucketInstanceId]}}symbolFadeChange(s){return this.fadeDuration===0?1:(s-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(s){return Math.max(0,(this.transform.zoom-s)/1.5)}hasTransitions(s){return this.stale||s-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(s,p){const d=this.zoomAtLastRecencyCheck===p?1-this.zoomAdjustment(p):1;return this.zoomAtLastRecencyCheck=p,this.commitTime+this.fadeDuration*d>s}setStale(){this.stale=!0}}function on(y,s,p,d,m){y.emplaceBack(s?1:0,p?1:0,d||0,m||0),y.emplaceBack(s?1:0,p?1:0,d||0,m||0),y.emplaceBack(s?1:0,p?1:0,d||0,m||0),y.emplaceBack(s?1:0,p?1:0,d||0,m||0)}const ir=Math.pow(2,25),yn=Math.pow(2,24),kn=Math.pow(2,17),Mn=Math.pow(2,16),To=Math.pow(2,9),mr=Math.pow(2,8),Ti=Math.pow(2,1);function Vi(y){if(y.opacity===0&&!y.placed)return 0;if(y.opacity===1&&y.placed)return 4294967295;const s=y.placed?1:0,p=Math.floor(127*y.opacity);return p*ir+s*yn+p*kn+s*Mn+p*To+s*mr+p*Ti+s}const oa=0;class Xh{constructor(s){this._sortAcrossTiles=s.layout.get("symbol-z-order")!=="viewport-y"&&!s.layout.get("symbol-sort-key").isConstant(),this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs={},this._bucketParts=[]}continuePlacement(s,p,d,m,v){const S=this._bucketParts;for(;this._currentTileIndex<s.length;)if(p.getBucketParts(S,m,s[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,v())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,S.sort((T,N)=>T.sortKey-N.sortKey));this._currentPartIndex<S.length;)if(p.placeLayerBucketPart(S[this._currentPartIndex],this._seenCrossTileIDs,d),this._currentPartIndex++,v())return!0;return!1}}class gl{constructor(s,p,d,m,v,S,T,N){this.placement=new ke(s,p,S,T,N),this._currentPlacementIndex=d.length-1,this._forceFullPlacement=m,this._showCollisionBoxes=v,this._done=!1}isDone(){return this._done}continuePlacement(s,p,d){const m=u.h.now(),v=()=>!this._forceFullPlacement&&u.h.now()-m>2;for(;this._currentPlacementIndex>=0;){const S=p[s[this._currentPlacementIndex]],T=this.placement.collisionIndex.transform.zoom;if(S.type==="symbol"&&(!S.minzoom||S.minzoom<=T)&&(!S.maxzoom||S.maxzoom>T)){if(this._inProgressLayer||(this._inProgressLayer=new Xh(S)),this._inProgressLayer.continuePlacement(d[S.source],this.placement,this._showCollisionBoxes,S,v))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(s){return this.placement.commit(s),this.placement}}const ml=512/u.N/2;class Ui{constructor(s,p,d){this.tileID=s,this.bucketInstanceId=d,this._symbolsByKey={};const m=new Map;for(let v=0;v<p.length;v++){const S=p.get(v),T=S.key,N=m.get(T);N?N.push(S):m.set(T,[S])}for(const[v,S]of m){const T={positions:S.map(N=>({x:Math.floor(N.anchorX*ml),y:Math.floor(N.anchorY*ml)})),crossTileIDs:S.map(N=>N.crossTileID)};if(T.positions.length>128){const N=new u.av(T.positions.length,16,Uint16Array);for(const{x:O,y:F}of T.positions)N.add(O,F);N.finish(),delete T.positions,T.index=N}this._symbolsByKey[v]=T}}getScaledCoordinates(s,p){const{x:d,y:m,z:v}=this.tileID.canonical,{x:S,y:T,z:N}=p.canonical,O=ml/Math.pow(2,N-v),F=(T*u.N+s.anchorY)*O,k=m*u.N*ml;return{x:Math.floor((S*u.N+s.anchorX)*O-d*u.N*ml),y:Math.floor(F-k)}}findMatches(s,p,d){const m=this.tileID.canonical.z<p.canonical.z?1:Math.pow(2,this.tileID.canonical.z-p.canonical.z);for(let v=0;v<s.length;v++){const S=s.get(v);if(S.crossTileID)continue;const T=this._symbolsByKey[S.key];if(!T)continue;const N=this.getScaledCoordinates(S,p);if(T.index){const O=T.index.range(N.x-m,N.y-m,N.x+m,N.y+m).sort();for(const F of O){const k=T.crossTileIDs[F];if(!d[k]){d[k]=!0,S.crossTileID=k;break}}}else if(T.positions)for(let O=0;O<T.positions.length;O++){const F=T.positions[O],k=T.crossTileIDs[O];if(Math.abs(F.x-N.x)<=m&&Math.abs(F.y-N.y)<=m&&!d[k]){d[k]=!0,S.crossTileID=k;break}}}}getCrossTileIDsLists(){return Object.values(this._symbolsByKey).map(({crossTileIDs:s})=>s)}}class or{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class Yp{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(s){const p=Math.round((s-this.lng)/360);if(p!==0)for(const d in this.indexes){const m=this.indexes[d],v={};for(const S in m){const T=m[S];T.tileID=T.tileID.unwrapTo(T.tileID.wrap+p),v[T.tileID.key]=T}this.indexes[d]=v}this.lng=s}addBucket(s,p,d){if(this.indexes[s.overscaledZ]&&this.indexes[s.overscaledZ][s.key]){if(this.indexes[s.overscaledZ][s.key].bucketInstanceId===p.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(s.overscaledZ,this.indexes[s.overscaledZ][s.key])}for(let v=0;v<p.symbolInstances.length;v++)p.symbolInstances.get(v).crossTileID=0;this.usedCrossTileIDs[s.overscaledZ]||(this.usedCrossTileIDs[s.overscaledZ]={});const m=this.usedCrossTileIDs[s.overscaledZ];for(const v in this.indexes){const S=this.indexes[v];if(Number(v)>s.overscaledZ)for(const T in S){const N=S[T];N.tileID.isChildOf(s)&&N.findMatches(p.symbolInstances,s,m)}else{const T=S[s.scaledTo(Number(v)).key];T&&T.findMatches(p.symbolInstances,s,m)}}for(let v=0;v<p.symbolInstances.length;v++){const S=p.symbolInstances.get(v);S.crossTileID||(S.crossTileID=d.generate(),m[S.crossTileID]=!0)}return this.indexes[s.overscaledZ]===void 0&&(this.indexes[s.overscaledZ]={}),this.indexes[s.overscaledZ][s.key]=new Ui(s,p.symbolInstances,p.bucketInstanceId),!0}removeBucketCrossTileIDs(s,p){for(const d of p.getCrossTileIDsLists())for(const m of d)delete this.usedCrossTileIDs[s][m]}removeStaleBuckets(s){let p=!1;for(const d in this.indexes){const m=this.indexes[d];for(const v in m)s[m[v].bucketInstanceId]||(this.removeBucketCrossTileIDs(d,m[v]),delete m[v],p=!0)}return p}}class La{constructor(){this.layerIndexes={},this.crossTileIDs=new or,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(s,p,d){let m=this.layerIndexes[s.id];m===void 0&&(m=this.layerIndexes[s.id]=new Yp);let v=!1;const S={};m.handleWrapJump(d);for(const T of p){const N=T.getBucket(s);N&&s.id===N.layerIds[0]&&(N.bucketInstanceId||(N.bucketInstanceId=++this.maxBucketInstanceId),m.addBucket(T.tileID,N,this.crossTileIDs)&&(v=!0),S[N.bucketInstanceId]=!0)}return m.removeStaleBuckets(S)&&(v=!0),v}pruneUnusedLayers(s){const p={};s.forEach(d=>{p[d]=!0});for(const d in this.layerIndexes)p[d]||delete this.layerIndexes[d]}}const Ar=(y,s)=>u.x(y,s&&s.filter(p=>p.identifier!=="source.canvas")),Lo=u.F(u.ax,["addLayer","removeLayer","setPaintProperty","setLayoutProperty","setFilter","addSource","removeSource","setLayerZoomRange","setLight","setTransition","setGeoJSONSourceData","setGlyphs","setSprite"]),yc=u.F(u.ax,["setCenter","setZoom","setBearing","setPitch"]),io=u.aw();class oo extends u.E{constructor(s,p={}){super(),this.map=s,this.dispatcher=new jn(Ta(),this,s._getMapId()),this.imageManager=new Kt,this.imageManager.setEventedParent(this),this.glyphManager=new Te(s._requestManager,p.localIdeographFontFamily),this.lineAtlas=new ei(256,512),this.crossTileSymbolIndex=new La,this._spritesImagesIds={},this._layers={},this._order=[],this.sourceCaches={},this.zoomHistory=new u.ay,this._loaded=!1,this._availableImages=[],this._resetUpdates(),this.dispatcher.broadcast("setReferrer",u.az());const d=this;this._rtlTextPluginCallback=oo.registerForPluginStateChange(m=>{d.dispatcher.broadcast("syncRTLPluginState",{pluginStatus:m.pluginStatus,pluginURL:m.pluginURL},(v,S)=>{if(u.aA(v),S&&S.every(T=>T))for(const T in d.sourceCaches){const N=d.sourceCaches[T].getSource().type;N!=="vector"&&N!=="geojson"||d.sourceCaches[T].reload()}})}),this.on("data",m=>{if(m.dataType!=="source"||m.sourceDataType!=="metadata")return;const v=this.sourceCaches[m.sourceId];if(!v)return;const S=v.getSource();if(S&&S.vectorLayerIds)for(const T in this._layers){const N=this._layers[T];N.source===S.id&&this._validateLayer(N)}})}loadURL(s,p={},d){this.fire(new u.k("dataloading",{dataType:"style"})),p.validate=typeof p.validate!="boolean"||p.validate;const m=this.map._requestManager.transformRequest(s,rt.Style);this._request=u.f(m,(v,S)=>{this._request=null,v?this.fire(new u.j(v)):S&&this._load(S,p,d)})}loadJSON(s,p={},d){this.fire(new u.k("dataloading",{dataType:"style"})),this._request=u.h.frame(()=>{this._request=null,p.validate=p.validate!==!1,this._load(s,p,d)})}loadEmpty(){this.fire(new u.k("dataloading",{dataType:"style"})),this._load(io,{validate:!1})}_load(s,p,d){var m;const v=p.transformStyle?p.transformStyle(d,s):s;if(!p.validate||!Ar(this,u.y(v))){this._loaded=!0,this.stylesheet=v;for(const S in v.sources)this.addSource(S,v.sources[S],{validate:!1});v.sprite?this._loadSprite(v.sprite):this.imageManager.setLoaded(!0),this.glyphManager.setURL(v.glyphs),this._createLayers(),this.light=new xn(this.stylesheet.light),this.map.setTerrain((m=this.stylesheet.terrain)!==null&&m!==void 0?m:null),this.fire(new u.k("data",{dataType:"style"})),this.fire(new u.k("style.load"))}}_createLayers(){const s=u.aB(this.stylesheet.layers);this.dispatcher.broadcast("setLayers",s),this._order=s.map(p=>p.id),this._layers={},this._serializedLayers=null;for(const p of s){const d=u.aC(p);d.setEventedParent(this,{layer:{id:p.id}}),this._layers[p.id]=d}}_loadSprite(s,p=!1,d=void 0){this.imageManager.setLoaded(!1),this._spriteRequest=function(m,v,S,T){const N=At(m),O=N.length,F=S>1?"@2x":"",k={},j={},tt={};for(const{id:et,url:st}of N){const K=v.transformRequest(v.normalizeSpriteURL(st,F,".json"),rt.SpriteJSON),xt=`${et}_${K.url}`;k[xt]=u.f(K,(wt,Ft)=>{delete k[xt],j[et]=Ft,Rt(T,j,tt,wt,O)});const Nt=v.transformRequest(v.normalizeSpriteURL(st,F,".png"),rt.SpriteImage),lt=`${et}_${Nt.url}`;k[lt]=W.getImage(Nt,(wt,Ft)=>{delete k[lt],tt[et]=Ft,Rt(T,j,tt,wt,O)})}return{cancel(){for(const et of Object.values(k))et.cancel()}}}(s,this.map._requestManager,this.map.getPixelRatio(),(m,v)=>{if(this._spriteRequest=null,m)this.fire(new u.j(m));else if(v)for(const S in v){this._spritesImagesIds[S]=[];const T=this._spritesImagesIds[S]?this._spritesImagesIds[S].filter(N=>!(N in v)):[];for(const N of T)this.imageManager.removeImage(N),this._changedImages[N]=!0;for(const N in v[S]){const O=S==="default"?N:`${S}:${N}`;this._spritesImagesIds[S].push(O),O in this.imageManager.images?this.imageManager.updateImage(O,v[S][N],!1):this.imageManager.addImage(O,v[S][N]),p&&(this._changedImages[O]=!0)}}this.imageManager.setLoaded(!0),this._availableImages=this.imageManager.listImages(),p&&(this._changed=!0),this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new u.k("data",{dataType:"style"})),d&&d(m)})}_unloadSprite(){for(const s of Object.values(this._spritesImagesIds).flat())this.imageManager.removeImage(s),this._changedImages[s]=!0;this._spritesImagesIds={},this._availableImages=this.imageManager.listImages(),this._changed=!0,this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new u.k("data",{dataType:"style"}))}_validateLayer(s){const p=this.sourceCaches[s.source];if(!p)return;const d=s.sourceLayer;if(!d)return;const m=p.getSource();(m.type==="geojson"||m.vectorLayerIds&&m.vectorLayerIds.indexOf(d)===-1)&&this.fire(new u.j(new Error(`Source layer "${d}" does not exist on source "${m.id}" as specified by style layer "${s.id}".`)))}loaded(){if(!this._loaded||Object.keys(this._updatedSources).length)return!1;for(const s in this.sourceCaches)if(!this.sourceCaches[s].loaded())return!1;return!!this.imageManager.isLoaded()}_serializeByIds(s){const p=this._serializedAllLayers();if(!s||s.length===0)return Object.values(p);const d=[];for(const m of s)p[m]&&d.push(p[m]);return d}_serializedAllLayers(){let s=this._serializedLayers;if(s)return s;s=this._serializedLayers={};const p=Object.keys(this._layers);for(const d of p){const m=this._layers[d];m.type!=="custom"&&(s[d]=m.serialize())}return s}hasTransitions(){if(this.light&&this.light.hasTransition())return!0;for(const s in this.sourceCaches)if(this.sourceCaches[s].hasTransition())return!0;for(const s in this._layers)if(this._layers[s].hasTransition())return!0;return!1}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading.")}update(s){if(!this._loaded)return;const p=this._changed;if(this._changed){const m=Object.keys(this._updatedLayers),v=Object.keys(this._removedLayers);(m.length||v.length)&&this._updateWorkerLayers(m,v);for(const S in this._updatedSources){const T=this._updatedSources[S];if(T==="reload")this._reloadSource(S);else{if(T!=="clear")throw new Error(`Invalid action ${T}`);this._clearSource(S)}}this._updateTilesForChangedImages(),this._updateTilesForChangedGlyphs();for(const S in this._updatedPaintProps)this._layers[S].updateTransitions(s);this.light.updateTransitions(s),this._resetUpdates()}const d={};for(const m in this.sourceCaches){const v=this.sourceCaches[m];d[m]=v.used,v.used=!1}for(const m of this._order){const v=this._layers[m];v.recalculate(s,this._availableImages),!v.isHidden(s.zoom)&&v.source&&(this.sourceCaches[v.source].used=!0)}for(const m in d){const v=this.sourceCaches[m];d[m]!==v.used&&v.fire(new u.k("data",{sourceDataType:"visibility",dataType:"source",sourceId:m}))}this.light.recalculate(s),this.z=s.zoom,p&&this.fire(new u.k("data",{dataType:"style"}))}_updateTilesForChangedImages(){const s=Object.keys(this._changedImages);if(s.length){for(const p in this.sourceCaches)this.sourceCaches[p].reloadTilesForDependencies(["icons","patterns"],s);this._changedImages={}}}_updateTilesForChangedGlyphs(){if(this._glyphsDidChange){for(const s in this.sourceCaches)this.sourceCaches[s].reloadTilesForDependencies(["glyphs"],[""]);this._glyphsDidChange=!1}}_updateWorkerLayers(s,p){this.dispatcher.broadcast("updateLayers",{layers:this._serializeByIds(s),removedIds:p})}_resetUpdates(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSources={},this._updatedPaintProps={},this._changedImages={},this._glyphsDidChange=!1}setState(s,p={}){this._checkLoaded();const d=this.serialize();if(s=p.transformStyle?p.transformStyle(d,s):s,Ar(this,u.y(s)))return!1;(s=u.aD(s)).layers=u.aB(s.layers);const m=u.aE(d,s).filter(S=>!(S.command in yc));if(m.length===0)return!1;const v=m.filter(S=>!(S.command in Lo));if(v.length>0)throw new Error(`Unimplemented: ${v.map(S=>S.command).join(", ")}.`);for(const S of m)S.command!=="setTransition"&&this[S.command].apply(this,S.args);return this.stylesheet=s,this._serializedLayers=null,!0}addImage(s,p){if(this.getImage(s))return this.fire(new u.j(new Error(`An image named "${s}" already exists.`)));this.imageManager.addImage(s,p),this._afterImageUpdated(s)}updateImage(s,p){this.imageManager.updateImage(s,p)}getImage(s){return this.imageManager.getImage(s)}removeImage(s){if(!this.getImage(s))return this.fire(new u.j(new Error(`An image named "${s}" does not exist.`)));this.imageManager.removeImage(s),this._afterImageUpdated(s)}_afterImageUpdated(s){this._availableImages=this.imageManager.listImages(),this._changedImages[s]=!0,this._changed=!0,this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new u.k("data",{dataType:"style"}))}listImages(){return this._checkLoaded(),this.imageManager.listImages()}addSource(s,p,d={}){if(this._checkLoaded(),this.sourceCaches[s]!==void 0)throw new Error(`Source "${s}" already exists.`);if(!p.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(p).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(p.type)>=0&&this._validate(u.y.source,`sources.${s}`,p,null,d))return;this.map&&this.map._collectResourceTiming&&(p.collectResourceTiming=!0);const m=this.sourceCaches[s]=new hi(s,p,this.dispatcher);m.style=this,m.setEventedParent(this,()=>({isSourceLoaded:m.loaded(),source:m.serialize(),sourceId:s})),m.onAdd(this.map),this._changed=!0}removeSource(s){if(this._checkLoaded(),this.sourceCaches[s]===void 0)throw new Error("There is no source with this ID");for(const d in this._layers)if(this._layers[d].source===s)return this.fire(new u.j(new Error(`Source "${s}" cannot be removed while layer "${d}" is using it.`)));const p=this.sourceCaches[s];delete this.sourceCaches[s],delete this._updatedSources[s],p.fire(new u.k("data",{sourceDataType:"metadata",dataType:"source",sourceId:s})),p.setEventedParent(null),p.onRemove(this.map),this._changed=!0}setGeoJSONSourceData(s,p){if(this._checkLoaded(),this.sourceCaches[s]===void 0)throw new Error(`There is no source with this ID=${s}`);const d=this.sourceCaches[s].getSource();if(d.type!=="geojson")throw new Error(`geojsonSource.type is ${d.type}, which is !== 'geojson`);d.setData(p),this._changed=!0}getSource(s){return this.sourceCaches[s]&&this.sourceCaches[s].getSource()}addLayer(s,p,d={}){this._checkLoaded();const m=s.id;if(this.getLayer(m))return void this.fire(new u.j(new Error(`Layer "${m}" already exists on this map.`)));let v;if(s.type==="custom"){if(Ar(this,u.aF(s)))return;v=u.aC(s)}else{if("source"in s&&typeof s.source=="object"&&(this.addSource(m,s.source),s=u.aD(s),s=u.e(s,{source:m})),this._validate(u.y.layer,`layers.${m}`,s,{arrayIndex:-1},d))return;v=u.aC(s),this._validateLayer(v),v.setEventedParent(this,{layer:{id:m}})}const S=p?this._order.indexOf(p):this._order.length;if(p&&S===-1)this.fire(new u.j(new Error(`Cannot add layer "${m}" before non-existing layer "${p}".`)));else{if(this._order.splice(S,0,m),this._layerOrderChanged=!0,this._layers[m]=v,this._removedLayers[m]&&v.source&&v.type!=="custom"){const T=this._removedLayers[m];delete this._removedLayers[m],T.type!==v.type?this._updatedSources[v.source]="clear":(this._updatedSources[v.source]="reload",this.sourceCaches[v.source].pause())}this._updateLayer(v),v.onAdd&&v.onAdd(this.map)}}moveLayer(s,p){if(this._checkLoaded(),this._changed=!0,!this._layers[s])return void this.fire(new u.j(new Error(`The layer '${s}' does not exist in the map's style and cannot be moved.`)));if(s===p)return;const d=this._order.indexOf(s);this._order.splice(d,1);const m=p?this._order.indexOf(p):this._order.length;p&&m===-1?this.fire(new u.j(new Error(`Cannot move layer "${s}" before non-existing layer "${p}".`))):(this._order.splice(m,0,s),this._layerOrderChanged=!0)}removeLayer(s){this._checkLoaded();const p=this._layers[s];if(!p)return void this.fire(new u.j(new Error(`Cannot remove non-existing layer "${s}".`)));p.setEventedParent(null);const d=this._order.indexOf(s);this._order.splice(d,1),this._layerOrderChanged=!0,this._changed=!0,this._removedLayers[s]=p,delete this._layers[s],this._serializedLayers&&delete this._serializedLayers[s],delete this._updatedLayers[s],delete this._updatedPaintProps[s],p.onRemove&&p.onRemove(this.map)}getLayer(s){return this._layers[s]}getLayersOrder(){return[...this._order]}hasLayer(s){return s in this._layers}setLayerZoomRange(s,p,d){this._checkLoaded();const m=this.getLayer(s);m?m.minzoom===p&&m.maxzoom===d||(p!=null&&(m.minzoom=p),d!=null&&(m.maxzoom=d),this._updateLayer(m)):this.fire(new u.j(new Error(`Cannot set the zoom range of non-existing layer "${s}".`)))}setFilter(s,p,d={}){this._checkLoaded();const m=this.getLayer(s);if(m){if(!u.aG(m.filter,p))return p==null?(m.filter=void 0,void this._updateLayer(m)):void(this._validate(u.y.filter,`layers.${m.id}.filter`,p,null,d)||(m.filter=u.aD(p),this._updateLayer(m)))}else this.fire(new u.j(new Error(`Cannot filter non-existing layer "${s}".`)))}getFilter(s){return u.aD(this.getLayer(s).filter)}setLayoutProperty(s,p,d,m={}){this._checkLoaded();const v=this.getLayer(s);v?u.aG(v.getLayoutProperty(p),d)||(v.setLayoutProperty(p,d,m),this._updateLayer(v)):this.fire(new u.j(new Error(`Cannot style non-existing layer "${s}".`)))}getLayoutProperty(s,p){const d=this.getLayer(s);if(d)return d.getLayoutProperty(p);this.fire(new u.j(new Error(`Cannot get style of non-existing layer "${s}".`)))}setPaintProperty(s,p,d,m={}){this._checkLoaded();const v=this.getLayer(s);v?u.aG(v.getPaintProperty(p),d)||(v.setPaintProperty(p,d,m)&&this._updateLayer(v),this._changed=!0,this._updatedPaintProps[s]=!0):this.fire(new u.j(new Error(`Cannot style non-existing layer "${s}".`)))}getPaintProperty(s,p){return this.getLayer(s).getPaintProperty(p)}setFeatureState(s,p){this._checkLoaded();const d=s.source,m=s.sourceLayer,v=this.sourceCaches[d];if(v===void 0)return void this.fire(new u.j(new Error(`The source '${d}' does not exist in the map's style.`)));const S=v.getSource().type;S==="geojson"&&m?this.fire(new u.j(new Error("GeoJSON sources cannot have a sourceLayer parameter."))):S!=="vector"||m?(s.id===void 0&&this.fire(new u.j(new Error("The feature id parameter must be provided."))),v.setFeatureState(m,s.id,p)):this.fire(new u.j(new Error("The sourceLayer parameter must be provided for vector source types.")))}removeFeatureState(s,p){this._checkLoaded();const d=s.source,m=this.sourceCaches[d];if(m===void 0)return void this.fire(new u.j(new Error(`The source '${d}' does not exist in the map's style.`)));const v=m.getSource().type,S=v==="vector"?s.sourceLayer:void 0;v!=="vector"||S?p&&typeof s.id!="string"&&typeof s.id!="number"?this.fire(new u.j(new Error("A feature id is required to remove its specific state property."))):m.removeFeatureState(S,s.id,p):this.fire(new u.j(new Error("The sourceLayer parameter must be provided for vector source types.")))}getFeatureState(s){this._checkLoaded();const p=s.source,d=s.sourceLayer,m=this.sourceCaches[p];if(m!==void 0)return m.getSource().type!=="vector"||d?(s.id===void 0&&this.fire(new u.j(new Error("The feature id parameter must be provided."))),m.getFeatureState(d,s.id)):void this.fire(new u.j(new Error("The sourceLayer parameter must be provided for vector source types.")));this.fire(new u.j(new Error(`The source '${p}' does not exist in the map's style.`)))}getTransition(){return u.e({duration:300,delay:0},this.stylesheet&&this.stylesheet.transition)}serialize(){if(!this._loaded)return;const s=u.aH(this.sourceCaches,v=>v.serialize()),p=this._serializeByIds(this._order),d=this.map.getTerrain()||void 0,m=this.stylesheet;return u.aI({version:m.version,name:m.name,metadata:m.metadata,light:m.light,center:m.center,zoom:m.zoom,bearing:m.bearing,pitch:m.pitch,sprite:m.sprite,glyphs:m.glyphs,transition:m.transition,sources:s,layers:p,terrain:d},v=>v!==void 0)}_updateLayer(s){this._updatedLayers[s.id]=!0,s.source&&!this._updatedSources[s.source]&&this.sourceCaches[s.source].getSource().type!=="raster"&&(this._updatedSources[s.source]="reload",this.sourceCaches[s.source].pause()),this._serializedLayers=null,this._changed=!0}_flattenAndSortRenderedFeatures(s){const p=S=>this._layers[S].type==="fill-extrusion",d={},m=[];for(let S=this._order.length-1;S>=0;S--){const T=this._order[S];if(p(T)){d[T]=S;for(const N of s){const O=N[T];if(O)for(const F of O)m.push(F)}}}m.sort((S,T)=>T.intersectionZ-S.intersectionZ);const v=[];for(let S=this._order.length-1;S>=0;S--){const T=this._order[S];if(p(T))for(let N=m.length-1;N>=0;N--){const O=m[N].feature;if(d[O.layer.id]<S)break;v.push(O),m.pop()}else for(const N of s){const O=N[T];if(O)for(const F of O)v.push(F.feature)}}return v}queryRenderedFeatures(s,p,d){p&&p.filter&&this._validate(u.y.filter,"queryRenderedFeatures.filter",p.filter,null,p);const m={};if(p&&p.layers){if(!Array.isArray(p.layers))return this.fire(new u.j(new Error("parameters.layers must be an Array."))),[];for(const T of p.layers){const N=this._layers[T];if(!N)return this.fire(new u.j(new Error(`The layer '${T}' does not exist in the map's style and cannot be queried for features.`))),[];m[N.source]=!0}}const v=[];p.availableImages=this._availableImages;const S=this._serializedAllLayers();for(const T in this.sourceCaches)p.layers&&!m[T]||v.push(Un(this.sourceCaches[T],this._layers,S,s,p,d));return this.placement&&v.push(function(T,N,O,F,k,j,tt){const et={},st=j.queryRenderedSymbols(F),K=[];for(const xt of Object.keys(st).map(Number))K.push(tt[xt]);K.sort(Ci);for(const xt of K){const Nt=xt.featureIndex.lookupSymbolFeatures(st[xt.bucketInstanceId],N,xt.bucketIndex,xt.sourceLayerIndex,k.filter,k.layers,k.availableImages,T);for(const lt in Nt){const wt=et[lt]=et[lt]||[],Ft=Nt[lt];Ft.sort((kt,Zt)=>{const ee=xt.featureSortOrder;if(ee){const Jt=ee.indexOf(kt.featureIndex);return ee.indexOf(Zt.featureIndex)-Jt}return Zt.featureIndex-kt.featureIndex});for(const kt of Ft)wt.push(kt)}}for(const xt in et)et[xt].forEach(Nt=>{const lt=Nt.feature,wt=O[T[xt].source].getFeatureState(lt.layer["source-layer"],lt.id);lt.source=lt.layer.source,lt.layer["source-layer"]&&(lt.sourceLayer=lt.layer["source-layer"]),lt.state=wt});return et}(this._layers,S,this.sourceCaches,s,p,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(v)}querySourceFeatures(s,p){p&&p.filter&&this._validate(u.y.filter,"querySourceFeatures.filter",p.filter,null,p);const d=this.sourceCaches[s];return d?function(m,v){const S=m.getRenderableIds().map(O=>m.getTileByID(O)),T=[],N={};for(let O=0;O<S.length;O++){const F=S[O],k=F.tileID.canonical.key;N[k]||(N[k]=!0,F.querySourceFeatures(T,v))}return T}(d,p):[]}addSourceType(s,p,d){return Xn(s)?d(new Error(`A source type called "${s}" already exists.`)):(((m,v)=>{Fn[m]=v})(s,p),p.workerSourceURL?void this.dispatcher.broadcast("loadWorkerSource",{name:s,url:p.workerSourceURL},d):d(null,null))}getLight(){return this.light.getLight()}setLight(s,p={}){this._checkLoaded();const d=this.light.getLight();let m=!1;for(const S in s)if(!u.aG(s[S],d[S])){m=!0;break}if(!m)return;const v={now:u.h.now(),transition:u.e({duration:300,delay:0},this.stylesheet.transition)};this.light.setLight(s,p),this.light.updateTransitions(v)}_validate(s,p,d,m,v={}){return(!v||v.validate!==!1)&&Ar(this,s.call(u.y,u.e({key:p,style:this.serialize(),value:d,styleSpec:u.v},m)))}_remove(s=!0){this._request&&(this._request.cancel(),this._request=null),this._spriteRequest&&(this._spriteRequest.cancel(),this._spriteRequest=null),u.aJ.off("pluginStateChange",this._rtlTextPluginCallback);for(const p in this._layers)this._layers[p].setEventedParent(null);for(const p in this.sourceCaches){const d=this.sourceCaches[p];d.setEventedParent(null),d.onRemove(this.map)}this.imageManager.setEventedParent(null),this.setEventedParent(null),this.dispatcher.remove(s)}_clearSource(s){this.sourceCaches[s].clearTiles()}_reloadSource(s){this.sourceCaches[s].resume(),this.sourceCaches[s].reload()}_updateSources(s){for(const p in this.sourceCaches)this.sourceCaches[p].update(s,this.map.terrain)}_generateCollisionBoxes(){for(const s in this.sourceCaches)this._reloadSource(s)}_updatePlacement(s,p,d,m,v=!1){let S=!1,T=!1;const N={};for(const O of this._order){const F=this._layers[O];if(F.type!=="symbol")continue;if(!N[F.source]){const j=this.sourceCaches[F.source];N[F.source]=j.getRenderableIds(!0).map(tt=>j.getTileByID(tt)).sort((tt,et)=>et.tileID.overscaledZ-tt.tileID.overscaledZ||(tt.tileID.isLessThan(et.tileID)?-1:1))}const k=this.crossTileSymbolIndex.addLayer(F,N[F.source],s.center.lng);S=S||k}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._order),((v=v||this._layerOrderChanged||d===0)||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(u.h.now(),s.zoom))&&(this.pauseablePlacement=new gl(s,this.map.terrain,this._order,v,p,d,m,this.placement),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._order,this._layers,N),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(u.h.now()),T=!0),S&&this.pauseablePlacement.placement.setStale()),T||S)for(const O of this._order){const F=this._layers[O];F.type==="symbol"&&this.placement.updateLayerOpacities(F,N[F.source])}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(u.h.now())}_releaseSymbolFadeTiles(){for(const s in this.sourceCaches)this.sourceCaches[s].releaseSymbolFadeTiles()}getImages(s,p,d){this.imageManager.getImages(p.icons,d),this._updateTilesForChangedImages();const m=this.sourceCaches[p.source];m&&m.setDependencies(p.tileID.key,p.type,p.icons)}getGlyphs(s,p,d){this.glyphManager.getGlyphs(p.stacks,d);const m=this.sourceCaches[p.source];m&&m.setDependencies(p.tileID.key,p.type,[""])}getResource(s,p,d){return u.m(p,d)}getGlyphsUrl(){return this.stylesheet.glyphs||null}setGlyphs(s,p={}){this._checkLoaded(),s&&this._validate(u.y.glyphs,"glyphs",s,null,p)||(this._glyphsDidChange=!0,this.stylesheet.glyphs=s,this.glyphManager.entries={},this.glyphManager.setURL(s))}addSprite(s,p,d={},m){this._checkLoaded();const v=[{id:s,url:p}],S=[...At(this.stylesheet.sprite),...v];this._validate(u.y.sprite,"sprite",S,null,d)||(this.stylesheet.sprite=S,this._loadSprite(v,!0,m))}removeSprite(s){this._checkLoaded();const p=At(this.stylesheet.sprite);if(p.find(d=>d.id===s)){if(this._spritesImagesIds[s])for(const d of this._spritesImagesIds[s])this.imageManager.removeImage(d),this._changedImages[d]=!0;p.splice(p.findIndex(d=>d.id===s),1),this.stylesheet.sprite=p.length>0?p:void 0,delete this._spritesImagesIds[s],this._availableImages=this.imageManager.listImages(),this._changed=!0,this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new u.k("data",{dataType:"style"}))}else this.fire(new u.j(new Error(`Sprite "${s}" doesn't exists on this map.`)))}getSprite(){return At(this.stylesheet.sprite)}setSprite(s,p={},d){this._checkLoaded(),s&&this._validate(u.y.sprite,"sprite",s,null,p)||(this.stylesheet.sprite=s,s?this._loadSprite(s,!0,d):(this._unloadSprite(),d&&d(null)))}}oo.registerForPluginStateChange=u.aK;var Zp=u.Q([{name:"a_pos",type:"Int16",components:2}]),rh="attribute vec3 a_pos3d;uniform mat4 u_matrix;uniform float u_ele_delta;varying vec2 v_texture_pos;varying float v_depth;void main() {float extent=8192.0;float ele_delta=a_pos3d.z==1.0 ? u_ele_delta : 0.0;v_texture_pos=a_pos3d.xy/extent;gl_Position=u_matrix*vec4(a_pos3d.xy,get_elevation(a_pos3d.xy)-ele_delta,1.0);v_depth=gl_Position.z/gl_Position.w;}";const Fr={prelude:qn(`#ifdef GL_ES
precision mediump float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif
`,`#ifdef GL_ES
precision highp float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif
vec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0
);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}
#ifdef TERRAIN3D
uniform sampler2D u_terrain;uniform float u_terrain_dim;uniform mat4 u_terrain_matrix;uniform vec4 u_terrain_unpack;uniform float u_terrain_exaggeration;uniform highp sampler2D u_depth;
#endif
const highp vec4 bitSh=vec4(256.*256.*256.,256.*256.,256.,1.);const highp vec4 bitShifts=vec4(1.)/bitSh;highp float unpack(highp vec4 color) {return dot(color,bitShifts);}highp float depthOpacity(vec3 frag) {
#ifdef TERRAIN3D
highp float d=unpack(texture2D(u_depth,frag.xy*0.5+0.5))+0.0001-frag.z;return 1.0-max(0.0,min(1.0,-d*500.0));
#else
return 1.0;
#endif
}float calculate_visibility(vec4 pos) {
#ifdef TERRAIN3D
vec3 frag=pos.xyz/pos.w;highp float d=depthOpacity(frag);if (d > 0.95) return 1.0;return (d+depthOpacity(frag+vec3(0.0,0.01,0.0)))/2.0;
#else
return 1.0;
#endif
}float ele(vec2 pos) {
#ifdef TERRAIN3D
vec4 rgb=(texture2D(u_terrain,pos)*255.0)*u_terrain_unpack;return rgb.r+rgb.g+rgb.b-u_terrain_unpack.a;
#else
return 0.0;
#endif
}float get_elevation(vec2 pos) {
#ifdef TERRAIN3D
vec2 coord=(u_terrain_matrix*vec4(pos,0.0,1.0)).xy*u_terrain_dim+1.0;vec2 f=fract(coord);vec2 c=(floor(coord)+0.5)/(u_terrain_dim+2.0);float d=1.0/(u_terrain_dim+2.0);float tl=ele(c);float tr=ele(c+vec2(d,0.0));float bl=ele(c+vec2(0.0,d));float br=ele(c+vec2(d,d));float elevation=mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);return elevation*u_terrain_exaggeration;
#else
return 0.0;
#endif
}`),background:qn(`uniform vec4 u_color;uniform float u_opacity;void main() {gl_FragColor=u_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),backgroundPattern:qn(`uniform vec2 u_pattern_tl_a;uniform vec2 u_pattern_br_a;uniform vec2 u_pattern_tl_b;uniform vec2 u_pattern_br_b;uniform vec2 u_texsize;uniform float u_mix;uniform float u_opacity;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(u_pattern_tl_a/u_texsize,u_pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(u_pattern_tl_b/u_texsize,u_pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);gl_FragColor=mix(color1,color2,u_mix)*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_pattern_size_a;uniform vec2 u_pattern_size_b;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_scale_a;uniform float u_scale_b;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_a*u_pattern_size_a,u_tile_units_to_pixels,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_b*u_pattern_size_b,u_tile_units_to_pixels,a_pos);}"),circle:qn(`varying vec3 v_data;varying float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=v_data.xy;float extrude_length=length(extrude);lowp float antialiasblur=v_data.z;float antialiased_blur=-max(blur,antialiasblur);float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width));gl_FragColor=v_visibility*opacity_t*mix(color*opacity,stroke_color*stroke_opacity,color_t);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform bool u_scale_with_map;uniform bool u_pitch_with_map;uniform vec2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;attribute vec2 a_pos;varying vec3 v_data;varying float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main(void) {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);float ele=get_elevation(circle_center);v_visibility=calculate_visibility(u_matrix*vec4(circle_center,ele,1.0));if (u_pitch_with_map) {vec2 corner_position=circle_center;if (u_scale_with_map) {corner_position+=extrude*(radius+stroke_width)*u_extrude_scale;} else {vec4 projected_center=u_matrix*vec4(circle_center,0,1);corner_position+=extrude*(radius+stroke_width)*u_extrude_scale*(projected_center.w/u_camera_to_center_distance);}gl_Position=u_matrix*vec4(corner_position,ele,1);} else {gl_Position=u_matrix*vec4(circle_center,ele,1);if (u_scale_with_map) {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*u_camera_to_center_distance;} else {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*gl_Position.w;}}lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);}`),clippingMask:qn("void main() {gl_FragColor=vec4(1.0);}","attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),heatmap:qn(`uniform highp float u_intensity;varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
float d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);gl_FragColor=vec4(val,1.0,1.0,1.0);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;attribute vec2 a_pos;varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#pragma mapbox: define mediump float radius
const highp float ZERO=1.0/255.0/16.0;
#define GAUSS_COEF 0.3989422804014327
void main(void) {
#pragma mapbox: initialize highp float weight
#pragma mapbox: initialize mediump float radius
vec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec4 pos=vec4(floor(a_pos*0.5)+extrude,0,1);gl_Position=u_matrix*pos;}`),heatmapTexture:qn(`uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;varying vec2 v_pos;void main() {float t=texture2D(u_image,v_pos).r;vec4 color=texture2D(u_color_ramp,vec2(t,0.5));gl_FragColor=color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(0.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_world;attribute vec2 a_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos*u_world,0,1);v_pos.x=a_pos.x;v_pos.y=1.0-a_pos.y;}"),collisionBox:qn("varying float v_placed;varying float v_notUsed;void main() {float alpha=0.5;gl_FragColor=vec4(1.0,0.0,0.0,1.0)*alpha;if (v_placed > 0.5) {gl_FragColor=vec4(0.0,0.0,1.0,0.5)*alpha;}if (v_notUsed > 0.5) {gl_FragColor*=.1;}}","attribute vec2 a_pos;attribute vec2 a_anchor_pos;attribute vec2 a_extrude;attribute vec2 a_placed;attribute vec2 a_shift;uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;varying float v_placed;varying float v_notUsed;void main() {vec4 projectedPoint=u_matrix*vec4(a_anchor_pos,0,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);gl_Position=u_matrix*vec4(a_pos,get_elevation(a_pos),1.0);gl_Position.xy+=(a_extrude+a_shift)*u_extrude_scale*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;}"),collisionCircle:qn("varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);gl_FragColor=color*alpha*opacity_t;}","attribute vec2 a_pos;attribute float a_radius;attribute vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}"),debug:qn("uniform highp vec4 u_color;uniform sampler2D u_overlay;varying vec2 v_uv;void main() {vec4 overlay_color=texture2D(u_overlay,v_uv);gl_FragColor=mix(u_color,overlay_color,overlay_color.a);}","attribute vec2 a_pos;varying vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {v_uv=a_pos/8192.0;gl_Position=u_matrix*vec4(a_pos*u_overlay_scale,get_elevation(a_pos),1);}"),fill:qn(`#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_FragColor=color*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);}`),fillOutline:qn(`varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);gl_FragColor=outline_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;uniform vec2 u_world;varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;}`),fillOutlinePattern:qn(`uniform vec2 u_texsize;uniform sampler2D u_image;uniform float u_fade;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);gl_FragColor=mix(color1,color2,u_fade)*alpha*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;gl_Position=u_matrix*vec4(a_pos,0,1);vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,a_pos);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;}`),fillPattern:qn(`#ifdef GL_ES
precision highp float;
#endif
uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);gl_FragColor=mix(color1,color2,u_fade)*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileZoomRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileZoomRatio,a_pos);}`),fillExtrusion:qn(`varying vec4 v_color;void main() {gl_FragColor=v_color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;attribute vec2 a_pos;attribute vec4 a_normal_ed;
#ifdef TERRAIN3D
attribute vec2 a_centroid;
#endif
varying vec4 v_color;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
vec3 normal=a_normal_ed.xyz;
#ifdef TERRAIN3D
float height_terrain3d_offset=get_elevation(a_centroid);float base_terrain3d_offset=height_terrain3d_offset-(base > 0.0 ? 0.0 : 10.0);
#else
float height_terrain3d_offset=0.0;float base_terrain3d_offset=0.0;
#endif
base=max(0.0,base)+base_terrain3d_offset;height=max(0.0,height)+height_terrain3d_offset;float t=mod(normal.x,2.0);gl_Position=u_matrix*vec4(a_pos,t > 0.0 ? height : base,1);float colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;v_color=vec4(0.0,0.0,0.0,1.0);vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;float directional=clamp(dot(normal/16384.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_color.r+=clamp(color.r*directional*u_lightcolor.r,mix(0.0,0.3,1.0-u_lightcolor.r),1.0);v_color.g+=clamp(color.g*directional*u_lightcolor.g,mix(0.0,0.3,1.0-u_lightcolor.g),1.0);v_color.b+=clamp(color.b*directional*u_lightcolor.b,mix(0.0,0.3,1.0-u_lightcolor.b),1.0);v_color*=u_opacity;}`),fillExtrusionPattern:qn(`uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);vec4 mixedColor=mix(color1,color2,u_fade);gl_FragColor=mixedColor*v_lighting;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform vec3 u_scale;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;attribute vec2 a_pos;attribute vec4 a_normal_ed;
#ifdef TERRAIN3D
attribute vec2 a_centroid;
#endif
varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec3 normal=a_normal_ed.xyz;float edgedistance=a_normal_ed.w;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;
#ifdef TERRAIN3D
float height_terrain3d_offset=get_elevation(a_centroid);float base_terrain3d_offset=height_terrain3d_offset-(base > 0.0 ? 0.0 : 10.0);
#else
float height_terrain3d_offset=0.0;float base_terrain3d_offset=0.0;
#endif
base=max(0.0,base)+base_terrain3d_offset;height=max(0.0,height)+height_terrain3d_offset;float t=mod(normal.x,2.0);float z=t > 0.0 ? height : base;gl_Position=u_matrix*vec4(a_pos,z,1);vec2 pos=normal.x==1.0 && normal.y==0.0 && normal.z==16384.0
? a_pos
: vec2(edgedistance,z*u_height_factor);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float directional=clamp(dot(normal/16383.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_lighting.rgb+=clamp(directional*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;}`),hillshadePrepare:qn(`#ifdef GL_ES
precision highp float;
#endif
uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;uniform vec4 u_unpack;float getElevation(vec2 coord,float bias) {vec4 data=texture2D(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack)/4.0;}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y),0.0);float b=getElevation(v_pos+vec2(0,-epsilon.y),0.0);float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y),0.0);float d=getElevation(v_pos+vec2(-epsilon.x,0),0.0);float e=getElevation(v_pos,0.0);float f=getElevation(v_pos+vec2(epsilon.x,0),0.0);float g=getElevation(v_pos+vec2(-epsilon.x,epsilon.y),0.0);float h=getElevation(v_pos+vec2(0,epsilon.y),0.0);float i=getElevation(v_pos+vec2(epsilon.x,epsilon.y),0.0);float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2((c+f+f+i)-(a+d+d+g),(g+h+h+i)-(a+b+b+c))/pow(2.0,exaggeration+(19.2562-u_zoom));gl_FragColor=clamp(vec4(deriv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_dimension;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:qn(`uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;
#define PI 3.141592653589793
void main() {vec4 pixel=texture2D(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);gl_FragColor=accent_color*(1.0-shade_color.a)+shade_color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;}"),line:qn(`uniform lowp float u_device_pixel_ratio;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp float v_linesofar;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;v_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*2.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_width2=vec2(outset,inset);}`),lineGradient:qn(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;varying highp vec2 v_uv;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);vec4 color=texture2D(u_image,v_uv);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;attribute float a_uv_x;attribute float a_split_index;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_units_to_pixels;uniform float u_image_height;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp vec2 v_uv;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec2(a_uv_x,a_split_index*texel_height-half_texel_height);vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_width2=vec2(outset,inset);}`),linePattern:qn(`#ifdef GL_ES
precision highp float;
#endif
uniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform float u_fade;uniform mediump vec3 u_scale;uniform sampler2D u_image;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;vec2 pattern_size_a=vec2(display_size_a.x*fromScale/tileZoomRatio,display_size_a.y);vec2 pattern_size_b=vec2(display_size_b.x*toScale/tileZoomRatio,display_size_b.y);float aspect_a=display_size_a.y/v_width;float aspect_b=display_size_b.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float x_a=mod(v_linesofar/pattern_size_a.x*aspect_a,1.0);float x_b=mod(v_linesofar/pattern_size_b.x*aspect_b,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos_a=mix(pattern_tl_a*texel_size-texel_size,pattern_br_a*texel_size+texel_size,vec2(x_a,y));vec2 pos_b=mix(pattern_tl_b*texel_size-texel_size,pattern_br_b*texel_size+texel_size,vec2(x_b,y));vec4 color=mix(texture2D(u_image,pos_a),texture2D(u_image,pos_b),u_fade);gl_FragColor=color*alpha*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform vec2 u_units_to_pixels;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;}`),lineSDF:qn(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;uniform float u_sdfgamma;uniform float u_mix;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float sdfdist_a=texture2D(u_image,v_tex_a).a;float sdfdist_b=texture2D(u_image,v_tex_b).a;float sdfdist=mix(sdfdist_a,sdfdist_b,u_mix);alpha*=smoothstep(0.5-u_sdfgamma/floorwidth,0.5+u_sdfgamma/floorwidth,sdfdist);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_patternscale_a;uniform float u_tex_y_a;uniform vec2 u_patternscale_b;uniform float u_tex_y_b;uniform vec2 u_units_to_pixels;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_tex_a=vec2(a_linesofar*u_patternscale_a.x/floorwidth,normal.y*u_patternscale_a.y+u_tex_y_a);v_tex_b=vec2(a_linesofar*u_patternscale_b.x/floorwidth,normal.y*u_patternscale_b.y+u_tex_y_b);v_width2=vec2(outset,inset);}`),raster:qn(`uniform float u_fade_t;uniform float u_opacity;uniform sampler2D u_image0;uniform sampler2D u_image1;varying vec2 v_pos0;varying vec2 v_pos1;uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;void main() {vec4 color0=texture2D(u_image0,v_pos0);vec4 color1=texture2D(u_image1,v_pos1);if (color0.a > 0.0) {color0.rgb=color0.rgb/color0.a;}if (color1.a > 0.0) {color1.rgb=color1.rgb/color1.a;}vec4 color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 rgb=color.rgb;rgb=vec3(dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);gl_FragColor=vec4(mix(u_high_vec,u_low_vec,rgb)*color.a,color.a);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform float u_buffer_scale;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos0;varying vec2 v_pos1;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos0=(((a_texture_pos/8192.0)-0.5)/u_buffer_scale )+0.5;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;}"),symbolIcon:qn(`uniform sampler2D u_texture;varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
lowp float alpha=opacity*v_fade_opacity;gl_FragColor=texture2D(u_texture,v_tex)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec4 a_pixeloffset;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_minFontScale=a_pixeloffset.zw/256.0;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,ele,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),ele,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,ele,1.0);float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*max(a_minFontScale,fontScale)+a_pxoffset/16.0),z,1.0);v_tex=a_tex/u_texsize;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float visibility=calculate_visibility(projectedPoint);v_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));}`),symbolSDF:qn(`#define SDF_PX 8.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float inner_edge=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);inner_edge=inner_edge+gamma*gamma_scale;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(inner_edge-gamma_scaled,inner_edge+gamma_scaled,dist);if (u_is_halo) {lowp float halo_edge=(6.0-halo_width/fontScale)/SDF_PX;alpha=min(smoothstep(halo_edge-gamma_scaled,halo_edge+gamma_scaled,dist),1.0-alpha);}gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec4 a_pixeloffset;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,ele,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),ele,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,ele,1.0);float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset),z,1.0);float gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float visibility=calculate_visibility(projectedPoint);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,interpolated_fade_opacity);}`),symbolTextAndIcon:qn(`#define SDF_PX 8.0
#define SDF 1.0
#define ICON 0.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;gl_FragColor=texture2D(u_texture_icon,tex_icon)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
return;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_texsize_icon;varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,ele,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),ele,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,ele,1.0);float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale),z,1.0);float gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float visibility=calculate_visibility(projectedPoint);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));v_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,interpolated_fade_opacity,is_sdf);}`),terrain:qn("uniform sampler2D u_texture;varying vec2 v_texture_pos;void main() {gl_FragColor=texture2D(u_texture,v_texture_pos);}",rh),terrainDepth:qn("varying float v_depth;const highp vec4 bitSh=vec4(256.*256.*256.,256.*256.,256.,1.);const highp vec4 bitMsk=vec4(0.,vec3(1./256.0));highp vec4 pack(highp float value) {highp vec4 comp=fract(value*bitSh);comp-=comp.xxyz*bitMsk;return comp;}void main() {gl_FragColor=pack(v_depth);}",rh),terrainCoords:qn("precision mediump float;uniform sampler2D u_texture;uniform float u_terrain_coords_id;varying vec2 v_texture_pos;void main() {vec4 rgba=texture2D(u_texture,v_texture_pos);gl_FragColor=vec4(rgba.r,rgba.g,rgba.b,u_terrain_coords_id);}",rh)};function qn(y,s){const p=/#pragma mapbox: ([\w]+) ([\w]+) ([\w]+) ([\w]+)/g,d=s.match(/attribute ([\w]+) ([\w]+)/g),m=y.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),v=s.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),S=v?v.concat(m):m,T={};return{fragmentSource:y=y.replace(p,(N,O,F,k,j)=>(T[j]=!0,O==="define"?`
#ifndef HAS_UNIFORM_u_${j}
varying ${F} ${k} ${j};
#else
uniform ${F} ${k} u_${j};
#endif
`:`
#ifdef HAS_UNIFORM_u_${j}
    ${F} ${k} ${j} = u_${j};
#endif
`)),vertexSource:s=s.replace(p,(N,O,F,k,j)=>{const tt=k==="float"?"vec2":"vec4",et=j.match(/color/)?"color":tt;return T[j]?O==="define"?`
#ifndef HAS_UNIFORM_u_${j}
uniform lowp float u_${j}_t;
attribute ${F} ${tt} a_${j};
varying ${F} ${k} ${j};
#else
uniform ${F} ${k} u_${j};
#endif
`:et==="vec4"?`
#ifndef HAS_UNIFORM_u_${j}
    ${j} = a_${j};
#else
    ${F} ${k} ${j} = u_${j};
#endif
`:`
#ifndef HAS_UNIFORM_u_${j}
    ${j} = unpack_mix_${et}(a_${j}, u_${j}_t);
#else
    ${F} ${k} ${j} = u_${j};
#endif
`:O==="define"?`
#ifndef HAS_UNIFORM_u_${j}
uniform lowp float u_${j}_t;
attribute ${F} ${tt} a_${j};
#else
uniform ${F} ${k} u_${j};
#endif
`:et==="vec4"?`
#ifndef HAS_UNIFORM_u_${j}
    ${F} ${k} ${j} = a_${j};
#else
    ${F} ${k} ${j} = u_${j};
#endif
`:`
#ifndef HAS_UNIFORM_u_${j}
    ${F} ${k} ${j} = unpack_mix_${et}(a_${j}, u_${j}_t);
#else
    ${F} ${k} ${j} = u_${j};
#endif
`}),staticAttributes:d,staticUniforms:S}}class Du{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffer=null,this.vao=null}bind(s,p,d,m,v,S,T,N,O){this.context=s;let F=this.boundPaintVertexBuffers.length!==m.length;for(let k=0;!F&&k<m.length;k++)this.boundPaintVertexBuffers[k]!==m[k]&&(F=!0);!this.vao||this.boundProgram!==p||this.boundLayoutVertexBuffer!==d||F||this.boundIndexBuffer!==v||this.boundVertexOffset!==S||this.boundDynamicVertexBuffer!==T||this.boundDynamicVertexBuffer2!==N||this.boundDynamicVertexBuffer3!==O?this.freshBind(p,d,m,v,S,T,N,O):(s.bindVertexArray.set(this.vao),T&&T.bind(),v&&v.dynamicDraw&&v.bind(),N&&N.bind(),O&&O.bind())}freshBind(s,p,d,m,v,S,T,N){const O=s.numAttributes,F=this.context,k=F.gl;this.vao&&this.destroy(),this.vao=F.createVertexArray(),F.bindVertexArray.set(this.vao),this.boundProgram=s,this.boundLayoutVertexBuffer=p,this.boundPaintVertexBuffers=d,this.boundIndexBuffer=m,this.boundVertexOffset=v,this.boundDynamicVertexBuffer=S,this.boundDynamicVertexBuffer2=T,this.boundDynamicVertexBuffer3=N,p.enableAttributes(k,s);for(const j of d)j.enableAttributes(k,s);S&&S.enableAttributes(k,s),T&&T.enableAttributes(k,s),N&&N.enableAttributes(k,s),p.bind(),p.setVertexAttribPointers(k,s,v);for(const j of d)j.bind(),j.setVertexAttribPointers(k,s,v);S&&(S.bind(),S.setVertexAttribPointers(k,s,v)),m&&m.bind(),T&&(T.bind(),T.setVertexAttribPointers(k,s,v)),N&&(N.bind(),N.setVertexAttribPointers(k,s,v)),F.currentNumAttributes=O}destroy(){this.vao&&(this.context.deleteVertexArray(this.vao),this.vao=null)}}function kr(y){const s=[];for(let p=0;p<y.length;p++){if(y[p]===null)continue;const d=y[p].split(" ");s.push(d.pop())}return s}class Yh{constructor(s,p,d,m,v,S){const T=s.gl;this.program=T.createProgram();const N=kr(p.staticAttributes),O=d?d.getBinderAttributes():[],F=N.concat(O),k=Fr.prelude.staticUniforms?kr(Fr.prelude.staticUniforms):[],j=p.staticUniforms?kr(p.staticUniforms):[],tt=d?d.getBinderUniforms():[],et=k.concat(j).concat(tt),st=[];for(const kt of et)st.indexOf(kt)<0&&st.push(kt);const K=d?d.defines():[];v&&K.push("#define OVERDRAW_INSPECTOR;"),S&&K.push("#define TERRAIN3D;");const xt=K.concat(Fr.prelude.fragmentSource,p.fragmentSource).join(`
`),Nt=K.concat(Fr.prelude.vertexSource,p.vertexSource).join(`
`),lt=T.createShader(T.FRAGMENT_SHADER);if(T.isContextLost())return void(this.failedToCreate=!0);if(T.shaderSource(lt,xt),T.compileShader(lt),!T.getShaderParameter(lt,T.COMPILE_STATUS))throw new Error(`Could not compile fragment shader: ${T.getShaderInfoLog(lt)}`);T.attachShader(this.program,lt);const wt=T.createShader(T.VERTEX_SHADER);if(T.isContextLost())return void(this.failedToCreate=!0);if(T.shaderSource(wt,Nt),T.compileShader(wt),!T.getShaderParameter(wt,T.COMPILE_STATUS))throw new Error(`Could not compile vertex shader: ${T.getShaderInfoLog(wt)}`);T.attachShader(this.program,wt),this.attributes={};const Ft={};this.numAttributes=F.length;for(let kt=0;kt<this.numAttributes;kt++)F[kt]&&(T.bindAttribLocation(this.program,kt,F[kt]),this.attributes[F[kt]]=kt);if(T.linkProgram(this.program),!T.getProgramParameter(this.program,T.LINK_STATUS))throw new Error(`Program failed to link: ${T.getProgramInfoLog(this.program)}`);T.deleteShader(wt),T.deleteShader(lt);for(let kt=0;kt<st.length;kt++){const Zt=st[kt];if(Zt&&!Ft[Zt]){const ee=T.getUniformLocation(this.program,Zt);ee&&(Ft[Zt]=ee)}}this.fixedUniforms=m(s,Ft),this.terrainUniforms=((kt,Zt)=>({u_depth:new u.aL(kt,Zt.u_depth),u_terrain:new u.aL(kt,Zt.u_terrain),u_terrain_dim:new u.aM(kt,Zt.u_terrain_dim),u_terrain_matrix:new u.aN(kt,Zt.u_terrain_matrix),u_terrain_unpack:new u.aO(kt,Zt.u_terrain_unpack),u_terrain_exaggeration:new u.aM(kt,Zt.u_terrain_exaggeration)}))(s,Ft),this.binderUniforms=d?d.getUniforms(s,Ft):[]}draw(s,p,d,m,v,S,T,N,O,F,k,j,tt,et,st,K,xt,Nt){const lt=s.gl;if(this.failedToCreate)return;if(s.program.set(this.program),s.setDepthMode(d),s.setStencilMode(m),s.setColorMode(v),s.setCullFace(S),N){s.activeTexture.set(lt.TEXTURE2),lt.bindTexture(lt.TEXTURE_2D,N.depthTexture),s.activeTexture.set(lt.TEXTURE3),lt.bindTexture(lt.TEXTURE_2D,N.texture);for(const Ft in this.terrainUniforms)this.terrainUniforms[Ft].set(N[Ft])}for(const Ft in this.fixedUniforms)this.fixedUniforms[Ft].set(T[Ft]);st&&st.setUniforms(s,this.binderUniforms,tt,{zoom:et});let wt=0;switch(p){case lt.LINES:wt=2;break;case lt.TRIANGLES:wt=3;break;case lt.LINE_STRIP:wt=1}for(const Ft of j.get()){const kt=Ft.vaos||(Ft.vaos={});(kt[O]||(kt[O]=new Du)).bind(s,this,F,st?st.getPaintVertexBuffers():[],k,Ft.vertexOffset,K,xt,Nt),lt.drawElements(p,Ft.primitiveLength*wt,lt.UNSIGNED_SHORT,Ft.primitiveOffset*wt*2)}}}function sa(y,s,p){const d=1/ft(p,1,s.transform.tileZoom),m=Math.pow(2,p.tileID.overscaledZ),v=p.tileSize*Math.pow(2,s.transform.tileZoom)/m,S=v*(p.tileID.canonical.x+p.tileID.wrap*m),T=v*p.tileID.canonical.y;return{u_image:0,u_texsize:p.imageAtlasTexture.size,u_scale:[d,y.fromScale,y.toScale],u_fade:y.t,u_pixel_coord_upper:[S>>16,T>>16],u_pixel_coord_lower:[65535&S,65535&T]}}const pd=(y,s,p,d)=>{const m=s.style.light,v=m.properties.get("position"),S=[v.x,v.y,v.z],T=function(){var O=new u.A(9);return u.A!=Float32Array&&(O[1]=0,O[2]=0,O[3]=0,O[5]=0,O[6]=0,O[7]=0),O[0]=1,O[4]=1,O[8]=1,O}();m.properties.get("anchor")==="viewport"&&function(O,F){var k=Math.sin(F),j=Math.cos(F);O[0]=j,O[1]=k,O[2]=0,O[3]=-k,O[4]=j,O[5]=0,O[6]=0,O[7]=0,O[8]=1}(T,-s.transform.angle),function(O,F,k){var j=F[0],tt=F[1],et=F[2];O[0]=j*k[0]+tt*k[3]+et*k[6],O[1]=j*k[1]+tt*k[4]+et*k[7],O[2]=j*k[2]+tt*k[5]+et*k[8]}(S,S,T);const N=m.properties.get("color");return{u_matrix:y,u_lightpos:S,u_lightintensity:m.properties.get("intensity"),u_lightcolor:[N.r,N.g,N.b],u_vertical_gradient:+p,u_opacity:d}},yl=(y,s,p,d,m,v,S)=>u.e(pd(y,s,p,d),sa(v,s,S),{u_height_factor:-Math.pow(2,m.overscaledZ)/S.tileSize/8}),Zh=y=>({u_matrix:y}),E=(y,s,p,d)=>u.e(Zh(y),sa(p,s,d)),A=(y,s)=>({u_matrix:y,u_world:s}),X=(y,s,p,d,m)=>u.e(E(y,s,p,d),{u_world:m}),at=(y,s,p,d)=>{const m=y.transform;let v,S;if(d.paint.get("circle-pitch-alignment")==="map"){const T=ft(p,1,m.zoom);v=!0,S=[T,T]}else v=!1,S=m.pixelsToGLUnits;return{u_camera_to_center_distance:m.cameraToCenterDistance,u_scale_with_map:+(d.paint.get("circle-pitch-scale")==="map"),u_matrix:y.translatePosMatrix(s.posMatrix,p,d.paint.get("circle-translate"),d.paint.get("circle-translate-anchor")),u_pitch_with_map:+v,u_device_pixel_ratio:y.pixelRatio,u_extrude_scale:S}},yt=(y,s,p)=>{const d=ft(p,1,s.zoom),m=Math.pow(2,s.zoom-p.tileID.overscaledZ),v=p.tileID.overscaleFactor();return{u_matrix:y,u_camera_to_center_distance:s.cameraToCenterDistance,u_pixels_to_tile_units:d,u_extrude_scale:[s.pixelsToGLUnits[0]/(d*m),s.pixelsToGLUnits[1]/(d*m)],u_overscale_factor:v}},_t=(y,s,p=1)=>({u_matrix:y,u_color:s,u_overlay:0,u_overlay_scale:p}),Ct=y=>({u_matrix:y}),te=(y,s,p,d)=>({u_matrix:y,u_extrude_scale:ft(s,1,p),u_intensity:d});function ae(y,s){const p=Math.pow(2,s.canonical.z),d=s.canonical.y;return[new u.U(0,d/p).toLngLat().lat,new u.U(0,(d+1)/p).toLngLat().lat]}const xe=(y,s,p,d)=>{const m=y.transform;return{u_matrix:cn(y,s,p,d),u_ratio:1/ft(s,1,m.zoom),u_device_pixel_ratio:y.pixelRatio,u_units_to_pixels:[1/m.pixelsToGLUnits[0],1/m.pixelsToGLUnits[1]]}},we=(y,s,p,d,m)=>u.e(xe(y,s,p,m),{u_image:0,u_image_height:d}),me=(y,s,p,d,m)=>{const v=y.transform,S=zr(s,v);return{u_matrix:cn(y,s,p,m),u_texsize:s.imageAtlasTexture.size,u_ratio:1/ft(s,1,v.zoom),u_device_pixel_ratio:y.pixelRatio,u_image:0,u_scale:[S,d.fromScale,d.toScale],u_fade:d.t,u_units_to_pixels:[1/v.pixelsToGLUnits[0],1/v.pixelsToGLUnits[1]]}},sn=(y,s,p,d,m,v)=>{const S=y.lineAtlas,T=zr(s,y.transform),N=p.layout.get("line-cap")==="round",O=S.getDash(d.from,N),F=S.getDash(d.to,N),k=O.width*m.fromScale,j=F.width*m.toScale;return u.e(xe(y,s,p,v),{u_patternscale_a:[T/k,-O.height/2],u_patternscale_b:[T/j,-F.height/2],u_sdfgamma:S.width/(256*Math.min(k,j)*y.pixelRatio)/2,u_image:0,u_tex_y_a:O.y,u_tex_y_b:F.y,u_mix:m.t})};function zr(y,s){return 1/ft(y,1,s.tileZoom)}function cn(y,s,p,d){return y.translatePosMatrix(d?d.posMatrix:s.tileID.posMatrix,s,p.paint.get("line-translate"),p.paint.get("line-translate-anchor"))}const fi=(y,s,p,d,m)=>{return{u_matrix:y,u_tl_parent:s,u_scale_parent:p,u_buffer_scale:1,u_fade_t:d.mix,u_opacity:d.opacity*m.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:m.paint.get("raster-brightness-min"),u_brightness_high:m.paint.get("raster-brightness-max"),u_saturation_factor:(S=m.paint.get("raster-saturation"),S>0?1-1/(1.001-S):-S),u_contrast_factor:(v=m.paint.get("raster-contrast"),v>0?1/(1-v):1+v),u_spin_weights:Wt(m.paint.get("raster-hue-rotate"))};var v,S};function Wt(y){y*=Math.PI/180;const s=Math.sin(y),p=Math.cos(y);return[(2*p+1)/3,(-Math.sqrt(3)*s-p+1)/3,(Math.sqrt(3)*s-p+1)/3]}const Oe=(y,s,p,d,m,v,S,T,N,O)=>{const F=m.transform;return{u_is_size_zoom_constant:+(y==="constant"||y==="source"),u_is_size_feature_constant:+(y==="constant"||y==="camera"),u_size_t:s?s.uSizeT:0,u_size:s?s.uSize:0,u_camera_to_center_distance:F.cameraToCenterDistance,u_pitch:F.pitch/360*2*Math.PI,u_rotate_symbol:+p,u_aspect_ratio:F.width/F.height,u_fade_change:m.options.fadeDuration?m.symbolFadeChange:1,u_matrix:v,u_label_plane_matrix:S,u_coord_matrix:T,u_is_text:+N,u_pitch_with_map:+d,u_texsize:O,u_texture:0}},sr=(y,s,p,d,m,v,S,T,N,O,F)=>{const k=m.transform;return u.e(Oe(y,s,p,d,m,v,S,T,N,O),{u_gamma_scale:d?Math.cos(k._pitch)*k.cameraToCenterDistance:1,u_device_pixel_ratio:m.pixelRatio,u_is_halo:+F})},Br=(y,s,p,d,m,v,S,T,N,O)=>u.e(sr(y,s,p,d,m,v,S,T,!0,N,!0),{u_texsize_icon:O,u_texture_icon:1}),Zr=(y,s,p)=>({u_matrix:y,u_opacity:s,u_color:p}),us=(y,s,p,d,m,v)=>u.e(function(S,T,N,O){const F=N.imageManager.getPattern(S.from.toString()),k=N.imageManager.getPattern(S.to.toString()),{width:j,height:tt}=N.imageManager.getPixelSize(),et=Math.pow(2,O.tileID.overscaledZ),st=O.tileSize*Math.pow(2,N.transform.tileZoom)/et,K=st*(O.tileID.canonical.x+O.tileID.wrap*et),xt=st*O.tileID.canonical.y;return{u_image:0,u_pattern_tl_a:F.tl,u_pattern_br_a:F.br,u_pattern_tl_b:k.tl,u_pattern_br_b:k.br,u_texsize:[j,tt],u_mix:T.t,u_pattern_size_a:F.displaySize,u_pattern_size_b:k.displaySize,u_scale_a:T.fromScale,u_scale_b:T.toScale,u_tile_units_to_pixels:1/ft(O,1,N.transform.tileZoom),u_pixel_coord_upper:[K>>16,xt>>16],u_pixel_coord_lower:[65535&K,65535&xt]}}(d,v,p,m),{u_matrix:y,u_opacity:s}),Hp={fillExtrusion:(y,s)=>({u_matrix:new u.aN(y,s.u_matrix),u_lightpos:new u.aP(y,s.u_lightpos),u_lightintensity:new u.aM(y,s.u_lightintensity),u_lightcolor:new u.aP(y,s.u_lightcolor),u_vertical_gradient:new u.aM(y,s.u_vertical_gradient),u_opacity:new u.aM(y,s.u_opacity)}),fillExtrusionPattern:(y,s)=>({u_matrix:new u.aN(y,s.u_matrix),u_lightpos:new u.aP(y,s.u_lightpos),u_lightintensity:new u.aM(y,s.u_lightintensity),u_lightcolor:new u.aP(y,s.u_lightcolor),u_vertical_gradient:new u.aM(y,s.u_vertical_gradient),u_height_factor:new u.aM(y,s.u_height_factor),u_image:new u.aL(y,s.u_image),u_texsize:new u.aQ(y,s.u_texsize),u_pixel_coord_upper:new u.aQ(y,s.u_pixel_coord_upper),u_pixel_coord_lower:new u.aQ(y,s.u_pixel_coord_lower),u_scale:new u.aP(y,s.u_scale),u_fade:new u.aM(y,s.u_fade),u_opacity:new u.aM(y,s.u_opacity)}),fill:(y,s)=>({u_matrix:new u.aN(y,s.u_matrix)}),fillPattern:(y,s)=>({u_matrix:new u.aN(y,s.u_matrix),u_image:new u.aL(y,s.u_image),u_texsize:new u.aQ(y,s.u_texsize),u_pixel_coord_upper:new u.aQ(y,s.u_pixel_coord_upper),u_pixel_coord_lower:new u.aQ(y,s.u_pixel_coord_lower),u_scale:new u.aP(y,s.u_scale),u_fade:new u.aM(y,s.u_fade)}),fillOutline:(y,s)=>({u_matrix:new u.aN(y,s.u_matrix),u_world:new u.aQ(y,s.u_world)}),fillOutlinePattern:(y,s)=>({u_matrix:new u.aN(y,s.u_matrix),u_world:new u.aQ(y,s.u_world),u_image:new u.aL(y,s.u_image),u_texsize:new u.aQ(y,s.u_texsize),u_pixel_coord_upper:new u.aQ(y,s.u_pixel_coord_upper),u_pixel_coord_lower:new u.aQ(y,s.u_pixel_coord_lower),u_scale:new u.aP(y,s.u_scale),u_fade:new u.aM(y,s.u_fade)}),circle:(y,s)=>({u_camera_to_center_distance:new u.aM(y,s.u_camera_to_center_distance),u_scale_with_map:new u.aL(y,s.u_scale_with_map),u_pitch_with_map:new u.aL(y,s.u_pitch_with_map),u_extrude_scale:new u.aQ(y,s.u_extrude_scale),u_device_pixel_ratio:new u.aM(y,s.u_device_pixel_ratio),u_matrix:new u.aN(y,s.u_matrix)}),collisionBox:(y,s)=>({u_matrix:new u.aN(y,s.u_matrix),u_camera_to_center_distance:new u.aM(y,s.u_camera_to_center_distance),u_pixels_to_tile_units:new u.aM(y,s.u_pixels_to_tile_units),u_extrude_scale:new u.aQ(y,s.u_extrude_scale),u_overscale_factor:new u.aM(y,s.u_overscale_factor)}),collisionCircle:(y,s)=>({u_matrix:new u.aN(y,s.u_matrix),u_inv_matrix:new u.aN(y,s.u_inv_matrix),u_camera_to_center_distance:new u.aM(y,s.u_camera_to_center_distance),u_viewport_size:new u.aQ(y,s.u_viewport_size)}),debug:(y,s)=>({u_color:new u.aR(y,s.u_color),u_matrix:new u.aN(y,s.u_matrix),u_overlay:new u.aL(y,s.u_overlay),u_overlay_scale:new u.aM(y,s.u_overlay_scale)}),clippingMask:(y,s)=>({u_matrix:new u.aN(y,s.u_matrix)}),heatmap:(y,s)=>({u_extrude_scale:new u.aM(y,s.u_extrude_scale),u_intensity:new u.aM(y,s.u_intensity),u_matrix:new u.aN(y,s.u_matrix)}),heatmapTexture:(y,s)=>({u_matrix:new u.aN(y,s.u_matrix),u_world:new u.aQ(y,s.u_world),u_image:new u.aL(y,s.u_image),u_color_ramp:new u.aL(y,s.u_color_ramp),u_opacity:new u.aM(y,s.u_opacity)}),hillshade:(y,s)=>({u_matrix:new u.aN(y,s.u_matrix),u_image:new u.aL(y,s.u_image),u_latrange:new u.aQ(y,s.u_latrange),u_light:new u.aQ(y,s.u_light),u_shadow:new u.aR(y,s.u_shadow),u_highlight:new u.aR(y,s.u_highlight),u_accent:new u.aR(y,s.u_accent)}),hillshadePrepare:(y,s)=>({u_matrix:new u.aN(y,s.u_matrix),u_image:new u.aL(y,s.u_image),u_dimension:new u.aQ(y,s.u_dimension),u_zoom:new u.aM(y,s.u_zoom),u_unpack:new u.aO(y,s.u_unpack)}),line:(y,s)=>({u_matrix:new u.aN(y,s.u_matrix),u_ratio:new u.aM(y,s.u_ratio),u_device_pixel_ratio:new u.aM(y,s.u_device_pixel_ratio),u_units_to_pixels:new u.aQ(y,s.u_units_to_pixels)}),lineGradient:(y,s)=>({u_matrix:new u.aN(y,s.u_matrix),u_ratio:new u.aM(y,s.u_ratio),u_device_pixel_ratio:new u.aM(y,s.u_device_pixel_ratio),u_units_to_pixels:new u.aQ(y,s.u_units_to_pixels),u_image:new u.aL(y,s.u_image),u_image_height:new u.aM(y,s.u_image_height)}),linePattern:(y,s)=>({u_matrix:new u.aN(y,s.u_matrix),u_texsize:new u.aQ(y,s.u_texsize),u_ratio:new u.aM(y,s.u_ratio),u_device_pixel_ratio:new u.aM(y,s.u_device_pixel_ratio),u_image:new u.aL(y,s.u_image),u_units_to_pixels:new u.aQ(y,s.u_units_to_pixels),u_scale:new u.aP(y,s.u_scale),u_fade:new u.aM(y,s.u_fade)}),lineSDF:(y,s)=>({u_matrix:new u.aN(y,s.u_matrix),u_ratio:new u.aM(y,s.u_ratio),u_device_pixel_ratio:new u.aM(y,s.u_device_pixel_ratio),u_units_to_pixels:new u.aQ(y,s.u_units_to_pixels),u_patternscale_a:new u.aQ(y,s.u_patternscale_a),u_patternscale_b:new u.aQ(y,s.u_patternscale_b),u_sdfgamma:new u.aM(y,s.u_sdfgamma),u_image:new u.aL(y,s.u_image),u_tex_y_a:new u.aM(y,s.u_tex_y_a),u_tex_y_b:new u.aM(y,s.u_tex_y_b),u_mix:new u.aM(y,s.u_mix)}),raster:(y,s)=>({u_matrix:new u.aN(y,s.u_matrix),u_tl_parent:new u.aQ(y,s.u_tl_parent),u_scale_parent:new u.aM(y,s.u_scale_parent),u_buffer_scale:new u.aM(y,s.u_buffer_scale),u_fade_t:new u.aM(y,s.u_fade_t),u_opacity:new u.aM(y,s.u_opacity),u_image0:new u.aL(y,s.u_image0),u_image1:new u.aL(y,s.u_image1),u_brightness_low:new u.aM(y,s.u_brightness_low),u_brightness_high:new u.aM(y,s.u_brightness_high),u_saturation_factor:new u.aM(y,s.u_saturation_factor),u_contrast_factor:new u.aM(y,s.u_contrast_factor),u_spin_weights:new u.aP(y,s.u_spin_weights)}),symbolIcon:(y,s)=>({u_is_size_zoom_constant:new u.aL(y,s.u_is_size_zoom_constant),u_is_size_feature_constant:new u.aL(y,s.u_is_size_feature_constant),u_size_t:new u.aM(y,s.u_size_t),u_size:new u.aM(y,s.u_size),u_camera_to_center_distance:new u.aM(y,s.u_camera_to_center_distance),u_pitch:new u.aM(y,s.u_pitch),u_rotate_symbol:new u.aL(y,s.u_rotate_symbol),u_aspect_ratio:new u.aM(y,s.u_aspect_ratio),u_fade_change:new u.aM(y,s.u_fade_change),u_matrix:new u.aN(y,s.u_matrix),u_label_plane_matrix:new u.aN(y,s.u_label_plane_matrix),u_coord_matrix:new u.aN(y,s.u_coord_matrix),u_is_text:new u.aL(y,s.u_is_text),u_pitch_with_map:new u.aL(y,s.u_pitch_with_map),u_texsize:new u.aQ(y,s.u_texsize),u_texture:new u.aL(y,s.u_texture)}),symbolSDF:(y,s)=>({u_is_size_zoom_constant:new u.aL(y,s.u_is_size_zoom_constant),u_is_size_feature_constant:new u.aL(y,s.u_is_size_feature_constant),u_size_t:new u.aM(y,s.u_size_t),u_size:new u.aM(y,s.u_size),u_camera_to_center_distance:new u.aM(y,s.u_camera_to_center_distance),u_pitch:new u.aM(y,s.u_pitch),u_rotate_symbol:new u.aL(y,s.u_rotate_symbol),u_aspect_ratio:new u.aM(y,s.u_aspect_ratio),u_fade_change:new u.aM(y,s.u_fade_change),u_matrix:new u.aN(y,s.u_matrix),u_label_plane_matrix:new u.aN(y,s.u_label_plane_matrix),u_coord_matrix:new u.aN(y,s.u_coord_matrix),u_is_text:new u.aL(y,s.u_is_text),u_pitch_with_map:new u.aL(y,s.u_pitch_with_map),u_texsize:new u.aQ(y,s.u_texsize),u_texture:new u.aL(y,s.u_texture),u_gamma_scale:new u.aM(y,s.u_gamma_scale),u_device_pixel_ratio:new u.aM(y,s.u_device_pixel_ratio),u_is_halo:new u.aL(y,s.u_is_halo)}),symbolTextAndIcon:(y,s)=>({u_is_size_zoom_constant:new u.aL(y,s.u_is_size_zoom_constant),u_is_size_feature_constant:new u.aL(y,s.u_is_size_feature_constant),u_size_t:new u.aM(y,s.u_size_t),u_size:new u.aM(y,s.u_size),u_camera_to_center_distance:new u.aM(y,s.u_camera_to_center_distance),u_pitch:new u.aM(y,s.u_pitch),u_rotate_symbol:new u.aL(y,s.u_rotate_symbol),u_aspect_ratio:new u.aM(y,s.u_aspect_ratio),u_fade_change:new u.aM(y,s.u_fade_change),u_matrix:new u.aN(y,s.u_matrix),u_label_plane_matrix:new u.aN(y,s.u_label_plane_matrix),u_coord_matrix:new u.aN(y,s.u_coord_matrix),u_is_text:new u.aL(y,s.u_is_text),u_pitch_with_map:new u.aL(y,s.u_pitch_with_map),u_texsize:new u.aQ(y,s.u_texsize),u_texsize_icon:new u.aQ(y,s.u_texsize_icon),u_texture:new u.aL(y,s.u_texture),u_texture_icon:new u.aL(y,s.u_texture_icon),u_gamma_scale:new u.aM(y,s.u_gamma_scale),u_device_pixel_ratio:new u.aM(y,s.u_device_pixel_ratio),u_is_halo:new u.aL(y,s.u_is_halo)}),background:(y,s)=>({u_matrix:new u.aN(y,s.u_matrix),u_opacity:new u.aM(y,s.u_opacity),u_color:new u.aR(y,s.u_color)}),backgroundPattern:(y,s)=>({u_matrix:new u.aN(y,s.u_matrix),u_opacity:new u.aM(y,s.u_opacity),u_image:new u.aL(y,s.u_image),u_pattern_tl_a:new u.aQ(y,s.u_pattern_tl_a),u_pattern_br_a:new u.aQ(y,s.u_pattern_br_a),u_pattern_tl_b:new u.aQ(y,s.u_pattern_tl_b),u_pattern_br_b:new u.aQ(y,s.u_pattern_br_b),u_texsize:new u.aQ(y,s.u_texsize),u_mix:new u.aM(y,s.u_mix),u_pattern_size_a:new u.aQ(y,s.u_pattern_size_a),u_pattern_size_b:new u.aQ(y,s.u_pattern_size_b),u_scale_a:new u.aM(y,s.u_scale_a),u_scale_b:new u.aM(y,s.u_scale_b),u_pixel_coord_upper:new u.aQ(y,s.u_pixel_coord_upper),u_pixel_coord_lower:new u.aQ(y,s.u_pixel_coord_lower),u_tile_units_to_pixels:new u.aM(y,s.u_tile_units_to_pixels)}),terrain:(y,s)=>({u_matrix:new u.aN(y,s.u_matrix),u_texture:new u.aL(y,s.u_texture),u_ele_delta:new u.aM(y,s.u_ele_delta)}),terrainDepth:(y,s)=>({u_matrix:new u.aN(y,s.u_matrix),u_ele_delta:new u.aM(y,s.u_ele_delta)}),terrainCoords:(y,s)=>({u_matrix:new u.aN(y,s.u_matrix),u_texture:new u.aL(y,s.u_texture),u_terrain_coords_id:new u.aM(y,s.u_terrain_coords_id),u_ele_delta:new u.aM(y,s.u_ele_delta)})};class yr{constructor(s,p,d){this.context=s;const m=s.gl;this.buffer=m.createBuffer(),this.dynamicDraw=!!d,this.context.unbindVAO(),s.bindElementBuffer.set(this.buffer),m.bufferData(m.ELEMENT_ARRAY_BUFFER,p.arrayBuffer,this.dynamicDraw?m.DYNAMIC_DRAW:m.STATIC_DRAW),this.dynamicDraw||delete p.arrayBuffer}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(s){const p=this.context.gl;if(!this.dynamicDraw)throw new Error("Attempted to update data while not in dynamic mode.");this.context.unbindVAO(),this.bind(),p.bufferSubData(p.ELEMENT_ARRAY_BUFFER,0,s.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}const ih={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class Wp{constructor(s,p,d,m){this.length=p.length,this.attributes=d,this.itemSize=p.bytesPerElement,this.dynamicDraw=m,this.context=s;const v=s.gl;this.buffer=v.createBuffer(),s.bindVertexBuffer.set(this.buffer),v.bufferData(v.ARRAY_BUFFER,p.arrayBuffer,this.dynamicDraw?v.DYNAMIC_DRAW:v.STATIC_DRAW),this.dynamicDraw||delete p.arrayBuffer}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(s){if(s.length!==this.length)throw new Error(`Length of new data is ${s.length}, which doesn't match current length of ${this.length}`);const p=this.context.gl;this.bind(),p.bufferSubData(p.ARRAY_BUFFER,0,s.arrayBuffer)}enableAttributes(s,p){for(let d=0;d<this.attributes.length;d++){const m=p.attributes[this.attributes[d].name];m!==void 0&&s.enableVertexAttribArray(m)}}setVertexAttribPointers(s,p,d){for(let m=0;m<this.attributes.length;m++){const v=this.attributes[m],S=p.attributes[v.name];S!==void 0&&s.vertexAttribPointer(S,v.components,s[ih[v.type]],!1,this.itemSize,v.offset+this.itemSize*(d||0))}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}const ls=new WeakMap;function Ou(y){var s;if(ls.has(y))return ls.get(y);{const p=(s=y.getParameter(y.VERSION))===null||s===void 0?void 0:s.startsWith("WebGL 2.0");return ls.set(y,p),p}}class Cn{constructor(s){this.gl=s.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(s){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class Hh extends Cn{getDefault(){return u.aT.transparent}set(s){const p=this.current;(s.r!==p.r||s.g!==p.g||s.b!==p.b||s.a!==p.a||this.dirty)&&(this.gl.clearColor(s.r,s.g,s.b,s.a),this.current=s,this.dirty=!1)}}class Xo extends Cn{getDefault(){return 1}set(s){(s!==this.current||this.dirty)&&(this.gl.clearDepth(s),this.current=s,this.dirty=!1)}}class cs extends Cn{getDefault(){return 0}set(s){(s!==this.current||this.dirty)&&(this.gl.clearStencil(s),this.current=s,this.dirty=!1)}}class Jp extends Cn{getDefault(){return[!0,!0,!0,!0]}set(s){const p=this.current;(s[0]!==p[0]||s[1]!==p[1]||s[2]!==p[2]||s[3]!==p[3]||this.dirty)&&(this.gl.colorMask(s[0],s[1],s[2],s[3]),this.current=s,this.dirty=!1)}}class Kp extends Cn{getDefault(){return!0}set(s){(s!==this.current||this.dirty)&&(this.gl.depthMask(s),this.current=s,this.dirty=!1)}}class Qp extends Cn{getDefault(){return 255}set(s){(s!==this.current||this.dirty)&&(this.gl.stencilMask(s),this.current=s,this.dirty=!1)}}class fd extends Cn{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(s){const p=this.current;(s.func!==p.func||s.ref!==p.ref||s.mask!==p.mask||this.dirty)&&(this.gl.stencilFunc(s.func,s.ref,s.mask),this.current=s,this.dirty=!1)}}class tf extends Cn{getDefault(){const s=this.gl;return[s.KEEP,s.KEEP,s.KEEP]}set(s){const p=this.current;(s[0]!==p[0]||s[1]!==p[1]||s[2]!==p[2]||this.dirty)&&(this.gl.stencilOp(s[0],s[1],s[2]),this.current=s,this.dirty=!1)}}class Wh extends Cn{getDefault(){return!1}set(s){if(s===this.current&&!this.dirty)return;const p=this.gl;s?p.enable(p.STENCIL_TEST):p.disable(p.STENCIL_TEST),this.current=s,this.dirty=!1}}class ef extends Cn{getDefault(){return[0,1]}set(s){const p=this.current;(s[0]!==p[0]||s[1]!==p[1]||this.dirty)&&(this.gl.depthRange(s[0],s[1]),this.current=s,this.dirty=!1)}}class dd extends Cn{getDefault(){return!1}set(s){if(s===this.current&&!this.dirty)return;const p=this.gl;s?p.enable(p.DEPTH_TEST):p.disable(p.DEPTH_TEST),this.current=s,this.dirty=!1}}class nf extends Cn{getDefault(){return this.gl.LESS}set(s){(s!==this.current||this.dirty)&&(this.gl.depthFunc(s),this.current=s,this.dirty=!1)}}class Jh extends Cn{getDefault(){return!1}set(s){if(s===this.current&&!this.dirty)return;const p=this.gl;s?p.enable(p.BLEND):p.disable(p.BLEND),this.current=s,this.dirty=!1}}class rf extends Cn{getDefault(){const s=this.gl;return[s.ONE,s.ZERO]}set(s){const p=this.current;(s[0]!==p[0]||s[1]!==p[1]||this.dirty)&&(this.gl.blendFunc(s[0],s[1]),this.current=s,this.dirty=!1)}}class _c extends Cn{getDefault(){return u.aT.transparent}set(s){const p=this.current;(s.r!==p.r||s.g!==p.g||s.b!==p.b||s.a!==p.a||this.dirty)&&(this.gl.blendColor(s.r,s.g,s.b,s.a),this.current=s,this.dirty=!1)}}class iu extends Cn{getDefault(){return this.gl.FUNC_ADD}set(s){(s!==this.current||this.dirty)&&(this.gl.blendEquation(s),this.current=s,this.dirty=!1)}}class _g extends Cn{getDefault(){return!1}set(s){if(s===this.current&&!this.dirty)return;const p=this.gl;s?p.enable(p.CULL_FACE):p.disable(p.CULL_FACE),this.current=s,this.dirty=!1}}class vg extends Cn{getDefault(){return this.gl.BACK}set(s){(s!==this.current||this.dirty)&&(this.gl.cullFace(s),this.current=s,this.dirty=!1)}}class jm extends Cn{getDefault(){return this.gl.CCW}set(s){(s!==this.current||this.dirty)&&(this.gl.frontFace(s),this.current=s,this.dirty=!1)}}class xg extends Cn{getDefault(){return null}set(s){(s!==this.current||this.dirty)&&(this.gl.useProgram(s),this.current=s,this.dirty=!1)}}class of extends Cn{getDefault(){return this.gl.TEXTURE0}set(s){(s!==this.current||this.dirty)&&(this.gl.activeTexture(s),this.current=s,this.dirty=!1)}}class sf extends Cn{getDefault(){const s=this.gl;return[0,0,s.drawingBufferWidth,s.drawingBufferHeight]}set(s){const p=this.current;(s[0]!==p[0]||s[1]!==p[1]||s[2]!==p[2]||s[3]!==p[3]||this.dirty)&&(this.gl.viewport(s[0],s[1],s[2],s[3]),this.current=s,this.dirty=!1)}}class Kh extends Cn{getDefault(){return null}set(s){if(s===this.current&&!this.dirty)return;const p=this.gl;p.bindFramebuffer(p.FRAMEBUFFER,s),this.current=s,this.dirty=!1}}class gd extends Cn{getDefault(){return null}set(s){if(s===this.current&&!this.dirty)return;const p=this.gl;p.bindRenderbuffer(p.RENDERBUFFER,s),this.current=s,this.dirty=!1}}class Ru extends Cn{getDefault(){return null}set(s){if(s===this.current&&!this.dirty)return;const p=this.gl;p.bindTexture(p.TEXTURE_2D,s),this.current=s,this.dirty=!1}}class vc extends Cn{getDefault(){return null}set(s){if(s===this.current&&!this.dirty)return;const p=this.gl;p.bindBuffer(p.ARRAY_BUFFER,s),this.current=s,this.dirty=!1}}class bg extends Cn{getDefault(){return null}set(s){const p=this.gl;p.bindBuffer(p.ELEMENT_ARRAY_BUFFER,s),this.current=s,this.dirty=!1}}class wg extends Cn{getDefault(){return null}set(s){var p;if(s===this.current&&!this.dirty)return;const d=this.gl;Ou(d)?d.bindVertexArray(s):(p=d.getExtension("OES_vertex_array_object"))===null||p===void 0||p.bindVertexArrayOES(s),this.current=s,this.dirty=!1}}class Qh extends Cn{getDefault(){return 4}set(s){if(s===this.current&&!this.dirty)return;const p=this.gl;p.pixelStorei(p.UNPACK_ALIGNMENT,s),this.current=s,this.dirty=!1}}class Na extends Cn{getDefault(){return!1}set(s){if(s===this.current&&!this.dirty)return;const p=this.gl;p.pixelStorei(p.UNPACK_PREMULTIPLY_ALPHA_WEBGL,s),this.current=s,this.dirty=!1}}class af extends Cn{getDefault(){return!1}set(s){if(s===this.current&&!this.dirty)return;const p=this.gl;p.pixelStorei(p.UNPACK_FLIP_Y_WEBGL,s),this.current=s,this.dirty=!1}}class ou extends Cn{constructor(s,p){super(s),this.context=s,this.parent=p}getDefault(){return null}}class _l extends ou{setDirty(){this.dirty=!0}set(s){if(s===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const p=this.gl;p.framebufferTexture2D(p.FRAMEBUFFER,p.COLOR_ATTACHMENT0,p.TEXTURE_2D,s,0),this.current=s,this.dirty=!1}}class oh extends ou{set(s){if(s===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const p=this.gl;p.framebufferRenderbuffer(p.FRAMEBUFFER,p.DEPTH_ATTACHMENT,p.RENDERBUFFER,s),this.current=s,this.dirty=!1}}class md extends ou{set(s){if(s===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const p=this.gl;p.framebufferRenderbuffer(p.FRAMEBUFFER,p.DEPTH_STENCIL_ATTACHMENT,p.RENDERBUFFER,s),this.current=s,this.dirty=!1}}class Zn{constructor(s,p,d,m,v){this.context=s,this.width=p,this.height=d;const S=s.gl,T=this.framebuffer=S.createFramebuffer();if(this.colorAttachment=new _l(s,T),m)this.depthAttachment=v?new md(s,T):new oh(s,T);else if(v)throw new Error("Stencil cannot be setted without depth");if(S.checkFramebufferStatus(S.FRAMEBUFFER)!==S.FRAMEBUFFER_COMPLETE)throw new Error("Framebuffer is not complete")}destroy(){const s=this.context.gl,p=this.colorAttachment.get();if(p&&s.deleteTexture(p),this.depthAttachment){const d=this.depthAttachment.get();d&&s.deleteRenderbuffer(d)}s.deleteFramebuffer(this.framebuffer)}}class $r{constructor(s,p,d){this.blendFunction=s,this.blendColor=p,this.mask=d}}$r.Replace=[1,0],$r.disabled=new $r($r.Replace,u.aT.transparent,[!1,!1,!1,!1]),$r.unblended=new $r($r.Replace,u.aT.transparent,[!0,!0,!0,!0]),$r.alphaBlended=new $r([1,771],u.aT.transparent,[!0,!0,!0,!0]);class Xm{constructor(s){var p,d;if(this.gl=s,this.clearColor=new Hh(this),this.clearDepth=new Xo(this),this.clearStencil=new cs(this),this.colorMask=new Jp(this),this.depthMask=new Kp(this),this.stencilMask=new Qp(this),this.stencilFunc=new fd(this),this.stencilOp=new tf(this),this.stencilTest=new Wh(this),this.depthRange=new ef(this),this.depthTest=new dd(this),this.depthFunc=new nf(this),this.blend=new Jh(this),this.blendFunc=new rf(this),this.blendColor=new _c(this),this.blendEquation=new iu(this),this.cullFace=new _g(this),this.cullFaceSide=new vg(this),this.frontFace=new jm(this),this.program=new xg(this),this.activeTexture=new of(this),this.viewport=new sf(this),this.bindFramebuffer=new Kh(this),this.bindRenderbuffer=new gd(this),this.bindTexture=new Ru(this),this.bindVertexBuffer=new vc(this),this.bindElementBuffer=new bg(this),this.bindVertexArray=new wg(this),this.pixelStoreUnpack=new Qh(this),this.pixelStoreUnpackPremultiplyAlpha=new Na(this),this.pixelStoreUnpackFlipY=new af(this),this.extTextureFilterAnisotropic=s.getExtension("EXT_texture_filter_anisotropic")||s.getExtension("MOZ_EXT_texture_filter_anisotropic")||s.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=s.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT)),this.maxTextureSize=s.getParameter(s.MAX_TEXTURE_SIZE),Ou(s)){this.HALF_FLOAT=s.HALF_FLOAT;const m=s.getExtension("EXT_color_buffer_half_float");this.RGBA16F=(p=s.RGBA16F)!==null&&p!==void 0?p:m==null?void 0:m.RGBA16F_EXT,this.RGB16F=(d=s.RGB16F)!==null&&d!==void 0?d:m==null?void 0:m.RGB16F_EXT,s.getExtension("EXT_color_buffer_float")}else{s.getExtension("EXT_color_buffer_half_float"),s.getExtension("OES_texture_half_float_linear");const m=s.getExtension("OES_texture_half_float");this.HALF_FLOAT=m==null?void 0:m.HALF_FLOAT_OES}}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.bindVertexArray.dirty=!0,this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(s,p){return new yr(this,s,p)}createVertexBuffer(s,p,d){return new Wp(this,s,p,d)}createRenderbuffer(s,p,d){const m=this.gl,v=m.createRenderbuffer();return this.bindRenderbuffer.set(v),m.renderbufferStorage(m.RENDERBUFFER,s,p,d),this.bindRenderbuffer.set(null),v}createFramebuffer(s,p,d,m){return new Zn(this,s,p,d,m)}clear({color:s,depth:p,stencil:d}){const m=this.gl;let v=0;s&&(v|=m.COLOR_BUFFER_BIT,this.clearColor.set(s),this.colorMask.set([!0,!0,!0,!0])),p!==void 0&&(v|=m.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(p),this.depthMask.set(!0)),d!==void 0&&(v|=m.STENCIL_BUFFER_BIT,this.clearStencil.set(d),this.stencilMask.set(255)),m.clear(v)}setCullFace(s){s.enable===!1?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(s.mode),this.frontFace.set(s.frontFace))}setDepthMode(s){s.func!==this.gl.ALWAYS||s.mask?(this.depthTest.set(!0),this.depthFunc.set(s.func),this.depthMask.set(s.mask),this.depthRange.set(s.range)):this.depthTest.set(!1)}setStencilMode(s){s.test.func!==this.gl.ALWAYS||s.mask?(this.stencilTest.set(!0),this.stencilMask.set(s.mask),this.stencilOp.set([s.fail,s.depthFail,s.pass]),this.stencilFunc.set({func:s.test.func,ref:s.ref,mask:s.test.mask})):this.stencilTest.set(!1)}setColorMode(s){u.aG(s.blendFunction,$r.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(s.blendFunction),this.blendColor.set(s.blendColor)),this.colorMask.set(s.mask)}createVertexArray(){var s;return Ou(this.gl)?this.gl.createVertexArray():(s=this.gl.getExtension("OES_vertex_array_object"))===null||s===void 0?void 0:s.createVertexArrayOES()}deleteVertexArray(s){var p;return Ou(this.gl)?this.gl.deleteVertexArray(s):(p=this.gl.getExtension("OES_vertex_array_object"))===null||p===void 0?void 0:p.deleteVertexArrayOES(s)}unbindVAO(){this.bindVertexArray.set(null)}}class Ln{constructor(s,p,d){this.func=s,this.mask=p,this.range=d}}Ln.ReadOnly=!1,Ln.ReadWrite=!0,Ln.disabled=new Ln(519,Ln.ReadOnly,[0,1]);const vl=7680;class Nr{constructor(s,p,d,m,v,S){this.test=s,this.ref=p,this.mask=d,this.fail=m,this.depthFail=v,this.pass=S}}Nr.disabled=new Nr({func:519,mask:0},0,0,vl,vl,vl);class ar{constructor(s,p,d){this.enable=s,this.mode=p,this.frontFace=d}}let Bs;function xl(y,s,p,d,m,v,S){const T=y.context,N=T.gl,O=y.useProgram("collisionBox"),F=[];let k=0,j=0;for(let lt=0;lt<d.length;lt++){const wt=d[lt],Ft=s.getTile(wt),kt=Ft.getBucket(p);if(!kt)continue;let Zt=wt.posMatrix;m[0]===0&&m[1]===0||(Zt=y.translatePosMatrix(wt.posMatrix,Ft,m,v));const ee=S?kt.textCollisionBox:kt.iconCollisionBox,Jt=kt.collisionCircleArray;if(Jt.length>0){const ue=u.Z(),Me=Zt;u.aU(ue,kt.placementInvProjMatrix,y.transform.glCoordMatrix),u.aU(ue,ue,kt.placementViewportMatrix),F.push({circleArray:Jt,circleOffset:j,transform:Me,invTransform:ue,coord:wt}),k+=Jt.length/4,j=k}ee&&O.draw(T,N.LINES,Ln.disabled,Nr.disabled,y.colorModeForRenderPass(),ar.disabled,yt(Zt,y.transform,Ft),y.style.map.terrain&&y.style.map.terrain.getTerrainData(wt),p.id,ee.layoutVertexBuffer,ee.indexBuffer,ee.segments,null,y.transform.zoom,null,null,ee.collisionVertexBuffer)}if(!S||!F.length)return;const tt=y.useProgram("collisionCircle"),et=new u.aV;et.resize(4*k),et._trim();let st=0;for(const lt of F)for(let wt=0;wt<lt.circleArray.length/4;wt++){const Ft=4*wt,kt=lt.circleArray[Ft+0],Zt=lt.circleArray[Ft+1],ee=lt.circleArray[Ft+2],Jt=lt.circleArray[Ft+3];et.emplace(st++,kt,Zt,ee,Jt,0),et.emplace(st++,kt,Zt,ee,Jt,1),et.emplace(st++,kt,Zt,ee,Jt,2),et.emplace(st++,kt,Zt,ee,Jt,3)}(!Bs||Bs.length<2*k)&&(Bs=function(lt){const wt=2*lt,Ft=new u.aX;Ft.resize(wt),Ft._trim();for(let kt=0;kt<wt;kt++){const Zt=6*kt;Ft.uint16[Zt+0]=4*kt+0,Ft.uint16[Zt+1]=4*kt+1,Ft.uint16[Zt+2]=4*kt+2,Ft.uint16[Zt+3]=4*kt+2,Ft.uint16[Zt+4]=4*kt+3,Ft.uint16[Zt+5]=4*kt+0}return Ft}(k));const K=T.createIndexBuffer(Bs,!0),xt=T.createVertexBuffer(et,u.aW.members,!0);for(const lt of F){const wt={u_matrix:lt.transform,u_inv_matrix:lt.invTransform,u_camera_to_center_distance:(Nt=y.transform).cameraToCenterDistance,u_viewport_size:[Nt.width,Nt.height]};tt.draw(T,N.TRIANGLES,Ln.disabled,Nr.disabled,y.colorModeForRenderPass(),ar.disabled,wt,y.style.map.terrain&&y.style.map.terrain.getTerrainData(lt.coord),p.id,xt,K,u.S.simpleSegment(0,2*lt.circleOffset,lt.circleArray.length,lt.circleArray.length/2),null,y.transform.zoom,null,null,null)}var Nt;xt.destroy(),K.destroy()}ar.disabled=new ar(!1,1029,2305),ar.backCCW=new ar(!0,1029,2305);const sh=u.ao(new Float32Array(16));function Pa(y,s,p,d,m,v){const{horizontalAlign:S,verticalAlign:T}=u.au(y);return new u.P((-(S-.5)*s/m+d[0])*v,(-(T-.5)*p/m+d[1])*v)}function uf(y,s,p,d,m,v,S,T,N,O,F){const k=y.text.placedSymbolArray,j=y.text.dynamicLayoutVertexArray,tt=y.icon.dynamicLayoutVertexArray,et={};j.clear();for(let st=0;st<k.length;st++){const K=k.get(st),xt=K.hidden||!K.crossTileID||y.allowVerticalPlacement&&!K.placedOrientation?null:d[K.crossTileID];if(xt){const Nt=new u.P(K.anchorX,K.anchorY),lt=wr(Nt,p?S:v,F),wt=Au(m.cameraToCenterDistance,lt.signedDistanceFromCamera);let Ft=u.aj(y.textSizeData,N,K)*wt/u.ap;p&&(Ft*=y.tilePixelRatio/T);const{width:kt,height:Zt,anchor:ee,textOffset:Jt,textBoxScale:ue}=xt,Me=Pa(ee,kt,Zt,Jt,ue,Ft),Nn=p?wr(Nt.add(Me),v,F).point:lt.point.add(s?Me.rotate(-m.angle):Me),ye=y.allowVerticalPlacement&&K.placedOrientation===u.ai.vertical?Math.PI/2:0;for(let He=0;He<K.numGlyphs;He++)u.ak(j,Nn,ye);O&&K.associatedIconIndex>=0&&(et[K.associatedIconIndex]={shiftedAnchor:Nn,angle:ye})}else J(K.numGlyphs,j)}if(O){tt.clear();const st=y.icon.placedSymbolArray;for(let K=0;K<st.length;K++){const xt=st.get(K);if(xt.hidden)J(xt.numGlyphs,tt);else{const Nt=et[K];if(Nt)for(let lt=0;lt<xt.numGlyphs;lt++)u.ak(tt,Nt.shiftedAnchor,Nt.angle);else J(xt.numGlyphs,tt)}}y.icon.dynamicLayoutVertexBuffer.updateData(tt)}y.text.dynamicLayoutVertexBuffer.updateData(j)}function ah(y,s,p){return p.iconsInText&&s?"symbolTextAndIcon":y?"symbolSDF":"symbolIcon"}function bl(y,s,p,d,m,v,S,T,N,O,F,k){const j=y.context,tt=j.gl,et=y.transform,st=T==="map",K=N==="map",xt=T!=="viewport"&&p.layout.get("symbol-placement")!=="point",Nt=st&&!K&&!xt,lt=!p.layout.get("symbol-sort-key").isConstant();let wt=!1;const Ft=y.depthModeForSublayer(0,Ln.ReadOnly),kt=p._unevaluatedLayout.hasValue("text-variable-anchor")||p._unevaluatedLayout.hasValue("text-variable-anchor-offset"),Zt=[];for(const ee of d){const Jt=s.getTile(ee),ue=Jt.getBucket(p);if(!ue)continue;const Me=m?ue.text:ue.icon;if(!Me||!Me.segments.get().length||!Me.hasVisibleVertices)continue;const Nn=Me.programConfigurations.get(p.id),ye=m||ue.sdfIcons,He=m?ue.textSizeData:ue.iconSizeData,De=K||et.pitch!==0,_r=y.useProgram(ah(ye,m,ue),Nn),Tn=u.ah(He,et.zoom),_n=y.style.map.terrain&&y.style.map.terrain.getTerrainData(ee);let Pn,Pi,Dr,Zo,co=[0,0],qi=null;if(m)Pi=Jt.glyphAtlasTexture,Dr=tt.LINEAR,Pn=Jt.glyphAtlasTexture.size,ue.iconsInText&&(co=Jt.imageAtlasTexture.size,qi=Jt.imageAtlasTexture,Zo=De||y.options.rotating||y.options.zooming||He.kind==="composite"||He.kind==="camera"?tt.LINEAR:tt.NEAREST);else{const Mi=p.layout.get("icon-size").constantOr(0)!==1||ue.iconsNeedLinear;Pi=Jt.imageAtlasTexture,Dr=ye||y.options.rotating||y.options.zooming||Mi||De?tt.LINEAR:tt.NEAREST,Pn=Jt.imageAtlasTexture.size}const Oa=ft(Jt,1,y.transform.zoom),Gr=se(ee.posMatrix,K,st,y.transform,Oa),Sl=uo(ee.posMatrix,K,st,y.transform,Oa),Cl=kt&&ue.hasTextData(),dh=p.layout.get("icon-text-fit")!=="none"&&Cl&&ue.hasIconData();if(xt){const Mi=y.style.map.terrain?(la,Ai)=>y.style.map.terrain.getElevation(ee,la,Ai):null,ho=p.layout.get("text-rotation-alignment")==="map";le(ue,ee.posMatrix,y,m,Gr,Sl,K,O,ho,Mi)}const lp=y.translatePosMatrix(ee.posMatrix,Jt,v,S),xf=xt||m&&kt||dh?sh:Gr,fs=y.translatePosMatrix(Sl,Jt,v,S,!0),Ho=ye&&p.paint.get(m?"text-halo-width":"icon-halo-width").constantOr(1)!==0;let Us;Us=ye?ue.iconsInText?Br(He.kind,Tn,Nt,K,y,lp,xf,fs,Pn,co):sr(He.kind,Tn,Nt,K,y,lp,xf,fs,m,Pn,!0):Oe(He.kind,Tn,Nt,K,y,lp,xf,fs,m,Pn);const cp={program:_r,buffers:Me,uniformValues:Us,atlasTexture:Pi,atlasTextureIcon:qi,atlasInterpolation:Dr,atlasInterpolationIcon:Zo,isSDF:ye,hasHalo:Ho};if(lt&&ue.canOverlap){wt=!0;const Mi=Me.segments.get();for(const ho of Mi)Zt.push({segments:new u.S([ho]),sortKey:ho.sortKey,state:cp,terrainData:_n})}else Zt.push({segments:Me.segments,sortKey:0,state:cp,terrainData:_n})}wt&&Zt.sort((ee,Jt)=>ee.sortKey-Jt.sortKey);for(const ee of Zt){const Jt=ee.state;if(j.activeTexture.set(tt.TEXTURE0),Jt.atlasTexture.bind(Jt.atlasInterpolation,tt.CLAMP_TO_EDGE),Jt.atlasTextureIcon&&(j.activeTexture.set(tt.TEXTURE1),Jt.atlasTextureIcon&&Jt.atlasTextureIcon.bind(Jt.atlasInterpolationIcon,tt.CLAMP_TO_EDGE)),Jt.isSDF){const ue=Jt.uniformValues;Jt.hasHalo&&(ue.u_is_halo=1,lf(Jt.buffers,ee.segments,p,y,Jt.program,Ft,F,k,ue,ee.terrainData)),ue.u_is_halo=0}lf(Jt.buffers,ee.segments,p,y,Jt.program,Ft,F,k,Jt.uniformValues,ee.terrainData)}}function lf(y,s,p,d,m,v,S,T,N,O){const F=d.context;m.draw(F,F.gl.TRIANGLES,v,S,T,ar.disabled,N,O,p.id,y.layoutVertexBuffer,y.indexBuffer,s,p.paint,d.transform.zoom,y.programConfigurations.get(p.id),y.dynamicLayoutVertexBuffer,y.opacityVertexBuffer)}function uh(y,s,p,d,m){if(!p||!d||!d.imageAtlas)return;const v=d.imageAtlas.patternPositions;let S=v[p.to.toString()],T=v[p.from.toString()];if(!S&&T&&(S=T),!T&&S&&(T=S),!S||!T){const N=m.getPaintProperty(s);S=v[N],T=v[N]}S&&T&&y.setConstantPatternPositions(S,T)}function tp(y,s,p,d,m,v,S){const T=y.context.gl,N="fill-pattern",O=p.paint.get(N),F=O&&O.constantOr(1),k=p.getCrossfadeParameters();let j,tt,et,st,K;S?(tt=F&&!p.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",j=T.LINES):(tt=F?"fillPattern":"fill",j=T.TRIANGLES);const xt=O.constantOr(null);for(const Nt of d){const lt=s.getTile(Nt);if(F&&!lt.patternsLoaded())continue;const wt=lt.getBucket(p);if(!wt)continue;const Ft=wt.programConfigurations.get(p.id),kt=y.useProgram(tt,Ft),Zt=y.style.map.terrain&&y.style.map.terrain.getTerrainData(Nt);F&&(y.context.activeTexture.set(T.TEXTURE0),lt.imageAtlasTexture.bind(T.LINEAR,T.CLAMP_TO_EDGE),Ft.updatePaintBuffers(k)),uh(Ft,N,xt,lt,p);const ee=Zt?Nt:null,Jt=y.translatePosMatrix(ee?ee.posMatrix:Nt.posMatrix,lt,p.paint.get("fill-translate"),p.paint.get("fill-translate-anchor"));if(S){st=wt.indexBuffer2,K=wt.segments2;const ue=[T.drawingBufferWidth,T.drawingBufferHeight];et=tt==="fillOutlinePattern"&&F?X(Jt,y,k,lt,ue):A(Jt,ue)}else st=wt.indexBuffer,K=wt.segments,et=F?E(Jt,y,k,lt):Zh(Jt);kt.draw(y.context,j,m,y.stencilModeForClipping(Nt),v,ar.disabled,et,Zt,p.id,wt.layoutVertexBuffer,st,K,p.paint,y.transform.zoom,Ft)}}function ep(y,s,p,d,m,v,S){const T=y.context,N=T.gl,O="fill-extrusion-pattern",F=p.paint.get(O),k=F.constantOr(1),j=p.getCrossfadeParameters(),tt=p.paint.get("fill-extrusion-opacity"),et=F.constantOr(null);for(const st of d){const K=s.getTile(st),xt=K.getBucket(p);if(!xt)continue;const Nt=y.style.map.terrain&&y.style.map.terrain.getTerrainData(st),lt=xt.programConfigurations.get(p.id),wt=y.useProgram(k?"fillExtrusionPattern":"fillExtrusion",lt);k&&(y.context.activeTexture.set(N.TEXTURE0),K.imageAtlasTexture.bind(N.LINEAR,N.CLAMP_TO_EDGE),lt.updatePaintBuffers(j)),uh(lt,O,et,K,p);const Ft=y.translatePosMatrix(st.posMatrix,K,p.paint.get("fill-extrusion-translate"),p.paint.get("fill-extrusion-translate-anchor")),kt=p.paint.get("fill-extrusion-vertical-gradient"),Zt=k?yl(Ft,y,kt,tt,st,j,K):pd(Ft,y,kt,tt);wt.draw(T,T.gl.TRIANGLES,m,v,S,ar.backCCW,Zt,Nt,p.id,xt.layoutVertexBuffer,xt.indexBuffer,xt.segments,p.paint,y.transform.zoom,lt,y.style.map.terrain&&xt.centroidVertexBuffer)}}function Eg(y,s,p,d,m,v,S){const T=y.context,N=T.gl,O=p.fbo;if(!O)return;const F=y.useProgram("hillshade"),k=y.style.map.terrain&&y.style.map.terrain.getTerrainData(s);T.activeTexture.set(N.TEXTURE0),N.bindTexture(N.TEXTURE_2D,O.colorAttachment.get()),F.draw(T,N.TRIANGLES,m,v,S,ar.disabled,((j,tt,et,st)=>{const K=et.paint.get("hillshade-shadow-color"),xt=et.paint.get("hillshade-highlight-color"),Nt=et.paint.get("hillshade-accent-color");let lt=et.paint.get("hillshade-illumination-direction")*(Math.PI/180);et.paint.get("hillshade-illumination-anchor")==="viewport"&&(lt-=j.transform.angle);const wt=!j.options.moving;return{u_matrix:st?st.posMatrix:j.transform.calculatePosMatrix(tt.tileID.toUnwrapped(),wt),u_image:0,u_latrange:ae(0,tt.tileID),u_light:[et.paint.get("hillshade-exaggeration"),lt],u_shadow:K,u_highlight:xt,u_accent:Nt}})(y,p,d,k?s:null),k,d.id,y.rasterBoundsBuffer,y.quadTriangleIndexBuffer,y.rasterBoundsSegments)}function cf(y,s,p,d,m,v){const S=y.context,T=S.gl,N=s.dem;if(N&&N.data){const O=N.dim,F=N.stride,k=N.getPixels();if(S.activeTexture.set(T.TEXTURE1),S.pixelStoreUnpackPremultiplyAlpha.set(!1),s.demTexture=s.demTexture||y.getTileTexture(F),s.demTexture){const tt=s.demTexture;tt.update(k,{premultiply:!1}),tt.bind(T.NEAREST,T.CLAMP_TO_EDGE)}else s.demTexture=new Yt(S,k,T.RGBA,{premultiply:!1}),s.demTexture.bind(T.NEAREST,T.CLAMP_TO_EDGE);S.activeTexture.set(T.TEXTURE0);let j=s.fbo;if(!j){const tt=new Yt(S,{width:O,height:O,data:null},T.RGBA);tt.bind(T.LINEAR,T.CLAMP_TO_EDGE),j=s.fbo=S.createFramebuffer(O,O,!0,!1),j.colorAttachment.set(tt.texture)}S.bindFramebuffer.set(j.framebuffer),S.viewport.set([0,0,O,O]),y.useProgram("hillshadePrepare").draw(S,T.TRIANGLES,d,m,v,ar.disabled,((tt,et)=>{const st=et.stride,K=u.Z();return u.aS(K,0,u.N,-u.N,0,0,1),u.$(K,K,[0,-u.N,0]),{u_matrix:K,u_image:1,u_dimension:[st,st],u_zoom:tt.overscaledZ,u_unpack:et.getUnpackVector()}})(s.tileID,N),null,p.id,y.rasterBoundsBuffer,y.quadTriangleIndexBuffer,y.rasterBoundsSegments),s.needsHillshadePrepare=!1}}function hf(y,s,p,d,m,v){const S=d.paint.get("raster-fade-duration");if(!v&&S>0){const T=u.h.now(),N=(T-y.timeAdded)/S,O=s?(T-s.timeAdded)/S:-1,F=p.getSource(),k=m.coveringZoomLevel({tileSize:F.tileSize,roundZoom:F.roundZoom}),j=!s||Math.abs(s.tileID.overscaledZ-k)>Math.abs(y.tileID.overscaledZ-k),tt=j&&y.refreshedUponExpiration?1:u.ad(j?N:1-O,0,1);return y.refreshedUponExpiration&&N>=1&&(y.refreshedUponExpiration=!1),s?{opacity:1,mix:1-tt}:{opacity:tt,mix:0}}return{opacity:1,mix:0}}const xc=new u.aT(1,0,0,1),pf=new u.aT(0,1,0,1),su=new u.aT(0,0,1,1),Ig=new u.aT(1,0,1,1),wl=new u.aT(0,1,1,1);function lh(y,s,p,d){bc(y,0,s+p/2,y.transform.width,p,d)}function ff(y,s,p,d){bc(y,s-p/2,0,p,y.transform.height,d)}function bc(y,s,p,d,m,v){const S=y.context,T=S.gl;T.enable(T.SCISSOR_TEST),T.scissor(s*y.pixelRatio,p*y.pixelRatio,d*y.pixelRatio,m*y.pixelRatio),S.clear({color:v}),T.disable(T.SCISSOR_TEST)}function df(y,s,p){const d=y.context,m=d.gl,v=p.posMatrix,S=y.useProgram("debug"),T=Ln.disabled,N=Nr.disabled,O=y.colorModeForRenderPass(),F="$debug",k=y.style.map.terrain&&y.style.map.terrain.getTerrainData(p);d.activeTexture.set(m.TEXTURE0);const j=s.getTileByID(p.key).latestRawTileData,tt=Math.floor((j&&j.byteLength||0)/1024),et=s.getTile(p).tileSize,st=512/Math.min(et,512)*(p.overscaledZ/y.transform.zoom)*.5;let K=p.canonical.toString();p.overscaledZ!==p.canonical.z&&(K+=` => ${p.overscaledZ}`),function(xt,Nt){xt.initDebugOverlayCanvas();const lt=xt.debugOverlayCanvas,wt=xt.context.gl,Ft=xt.debugOverlayCanvas.getContext("2d");Ft.clearRect(0,0,lt.width,lt.height),Ft.shadowColor="white",Ft.shadowBlur=2,Ft.lineWidth=1.5,Ft.strokeStyle="white",Ft.textBaseline="top",Ft.font="bold 36px Open Sans, sans-serif",Ft.fillText(Nt,5,5),Ft.strokeText(Nt,5,5),xt.debugOverlayTexture.update(lt),xt.debugOverlayTexture.bind(wt.LINEAR,wt.CLAMP_TO_EDGE)}(y,`${K} ${tt}kB`),S.draw(d,m.TRIANGLES,T,N,$r.alphaBlended,ar.disabled,_t(v,u.aT.transparent,st),null,F,y.debugBuffer,y.quadTriangleIndexBuffer,y.debugSegments),S.draw(d,m.LINE_STRIP,T,N,O,ar.disabled,_t(v,u.aT.red),k,F,y.debugBuffer,y.tileBorderIndexBuffer,y.debugSegments)}function Vr(y,s,p){const d=y.context,m=d.gl,v=y.colorModeForRenderPass(),S=new Ln(m.LEQUAL,Ln.ReadWrite,y.depthRangeFor3D),T=y.useProgram("terrain"),N=s.getTerrainMesh();d.bindFramebuffer.set(null),d.viewport.set([0,0,y.width,y.height]);for(const O of p){const F=y.renderToTexture.getTexture(O),k=s.getTerrainData(O.tileID);d.activeTexture.set(m.TEXTURE0),m.bindTexture(m.TEXTURE_2D,F.texture);const j={u_matrix:y.transform.calculatePosMatrix(O.tileID.toUnwrapped()),u_texture:0,u_ele_delta:s.getMeshFrameDelta(y.transform.zoom)};T.draw(d,m.TRIANGLES,S,Nr.disabled,v,ar.backCCW,j,k,"terrain",N.vertexBuffer,N.indexBuffer,N.segments)}}class El{constructor(s,p){this.context=new Xm(s),this.transform=p,this._tileTextures={},this.terrainFacilitator={dirty:!0,matrix:u.Z(),renderTime:0},this.setup(),this.numSublayers=hi.maxUnderzooming+hi.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.crossTileSymbolIndex=new La}resize(s,p,d){if(this.width=Math.floor(s*d),this.height=Math.floor(p*d),this.pixelRatio=d,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(const m of this.style._order)this.style._layers[m].resize()}setup(){const s=this.context,p=new u.a_;p.emplaceBack(0,0),p.emplaceBack(u.N,0),p.emplaceBack(0,u.N),p.emplaceBack(u.N,u.N),this.tileExtentBuffer=s.createVertexBuffer(p,Zp.members),this.tileExtentSegments=u.S.simpleSegment(0,0,4,2);const d=new u.a_;d.emplaceBack(0,0),d.emplaceBack(u.N,0),d.emplaceBack(0,u.N),d.emplaceBack(u.N,u.N),this.debugBuffer=s.createVertexBuffer(d,Zp.members),this.debugSegments=u.S.simpleSegment(0,0,4,5);const m=new u.V;m.emplaceBack(0,0,0,0),m.emplaceBack(u.N,0,u.N,0),m.emplaceBack(0,u.N,0,u.N),m.emplaceBack(u.N,u.N,u.N,u.N),this.rasterBoundsBuffer=s.createVertexBuffer(m,br.members),this.rasterBoundsSegments=u.S.simpleSegment(0,0,4,2);const v=new u.a_;v.emplaceBack(0,0),v.emplaceBack(1,0),v.emplaceBack(0,1),v.emplaceBack(1,1),this.viewportBuffer=s.createVertexBuffer(v,Zp.members),this.viewportSegments=u.S.simpleSegment(0,0,4,2);const S=new u.a$;S.emplaceBack(0),S.emplaceBack(1),S.emplaceBack(3),S.emplaceBack(2),S.emplaceBack(0),this.tileBorderIndexBuffer=s.createIndexBuffer(S);const T=new u.b0;T.emplaceBack(0,1,2),T.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=s.createIndexBuffer(T);const N=this.context.gl;this.stencilClearMode=new Nr({func:N.ALWAYS,mask:0},0,255,N.ZERO,N.ZERO,N.ZERO)}clearStencil(){const s=this.context,p=s.gl;this.nextStencilID=1,this.currentStencilSource=void 0;const d=u.Z();u.aS(d,0,this.width,this.height,0,0,1),u.a0(d,d,[p.drawingBufferWidth,p.drawingBufferHeight,0]),this.useProgram("clippingMask").draw(s,p.TRIANGLES,Ln.disabled,this.stencilClearMode,$r.disabled,ar.disabled,Ct(d),null,"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}_renderTileClippingMasks(s,p){if(this.currentStencilSource===s.source||!s.isTileClipped()||!p||!p.length)return;this.currentStencilSource=s.source;const d=this.context,m=d.gl;this.nextStencilID+p.length>256&&this.clearStencil(),d.setColorMode($r.disabled),d.setDepthMode(Ln.disabled);const v=this.useProgram("clippingMask");this._tileClippingMaskIDs={};for(const S of p){const T=this._tileClippingMaskIDs[S.key]=this.nextStencilID++,N=this.style.map.terrain&&this.style.map.terrain.getTerrainData(S);v.draw(d,m.TRIANGLES,Ln.disabled,new Nr({func:m.ALWAYS,mask:0},T,255,m.KEEP,m.KEEP,m.REPLACE),$r.disabled,ar.disabled,Ct(S.posMatrix),N,"$clipping",this.tileExtentBuffer,this.quadTriangleIndexBuffer,this.tileExtentSegments)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();const s=this.nextStencilID++,p=this.context.gl;return new Nr({func:p.NOTEQUAL,mask:255},s,255,p.KEEP,p.KEEP,p.REPLACE)}stencilModeForClipping(s){const p=this.context.gl;return new Nr({func:p.EQUAL,mask:255},this._tileClippingMaskIDs[s.key],0,p.KEEP,p.KEEP,p.REPLACE)}stencilConfigForOverlap(s){const p=this.context.gl,d=s.sort((S,T)=>T.overscaledZ-S.overscaledZ),m=d[d.length-1].overscaledZ,v=d[0].overscaledZ-m+1;if(v>1){this.currentStencilSource=void 0,this.nextStencilID+v>256&&this.clearStencil();const S={};for(let T=0;T<v;T++)S[T+m]=new Nr({func:p.GEQUAL,mask:255},T+this.nextStencilID,255,p.KEEP,p.KEEP,p.REPLACE);return this.nextStencilID+=v,[S,d]}return[{[m]:Nr.disabled},d]}colorModeForRenderPass(){const s=this.context.gl;return this._showOverdrawInspector?new $r([s.CONSTANT_COLOR,s.ONE],new u.aT(.125,.125,.125,0),[!0,!0,!0,!0]):this.renderPass==="opaque"?$r.unblended:$r.alphaBlended}depthModeForSublayer(s,p,d){if(!this.opaquePassEnabledForLayer())return Ln.disabled;const m=1-((1+this.currentLayer)*this.numSublayers+s)*this.depthEpsilon;return new Ln(d||this.context.gl.LEQUAL,p,[m,m])}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}render(s,p){this.style=s,this.options=p,this.lineAtlas=s.lineAtlas,this.imageManager=s.imageManager,this.glyphManager=s.glyphManager,this.symbolFadeChange=s.placement.symbolFadeChange(u.h.now()),this.imageManager.beginFrame();const d=this.style._order,m=this.style.sourceCaches,v={},S={},T={};for(const N in m){const O=m[N];O.used&&O.prepare(this.context),v[N]=O.getVisibleCoordinates(),S[N]=v[N].slice().reverse(),T[N]=O.getVisibleCoordinates(!0).reverse()}this.opaquePassCutoff=1/0;for(let N=0;N<d.length;N++)if(this.style._layers[d[N]].is3D()){this.opaquePassCutoff=N;break}if(this.renderToTexture){this.renderToTexture.prepareForRender(this.style,this.transform.zoom),this.opaquePassCutoff=0;const N=this.style.map.terrain.sourceCache.tilesAfterTime(this.terrainFacilitator.renderTime);(this.terrainFacilitator.dirty||!u.b1(this.terrainFacilitator.matrix,this.transform.projMatrix)||N.length)&&(u.b2(this.terrainFacilitator.matrix,this.transform.projMatrix),this.terrainFacilitator.renderTime=Date.now(),this.terrainFacilitator.dirty=!1,function(O,F){const k=O.context,j=k.gl,tt=$r.unblended,et=new Ln(j.LEQUAL,Ln.ReadWrite,[0,1]),st=F.getTerrainMesh(),K=F.sourceCache.getRenderableTiles(),xt=O.useProgram("terrainDepth");k.bindFramebuffer.set(F.getFramebuffer("depth").framebuffer),k.viewport.set([0,0,O.width/devicePixelRatio,O.height/devicePixelRatio]),k.clear({color:u.aT.transparent,depth:1});for(const Nt of K){const lt=F.getTerrainData(Nt.tileID),wt={u_matrix:O.transform.calculatePosMatrix(Nt.tileID.toUnwrapped()),u_ele_delta:F.getMeshFrameDelta(O.transform.zoom)};xt.draw(k,j.TRIANGLES,et,Nr.disabled,tt,ar.backCCW,wt,lt,"terrain",st.vertexBuffer,st.indexBuffer,st.segments)}k.bindFramebuffer.set(null),k.viewport.set([0,0,O.width,O.height])}(this,this.style.map.terrain),function(O,F){const k=O.context,j=k.gl,tt=$r.unblended,et=new Ln(j.LEQUAL,Ln.ReadWrite,[0,1]),st=F.getTerrainMesh(),K=F.getCoordsTexture(),xt=F.sourceCache.getRenderableTiles(),Nt=O.useProgram("terrainCoords");k.bindFramebuffer.set(F.getFramebuffer("coords").framebuffer),k.viewport.set([0,0,O.width/devicePixelRatio,O.height/devicePixelRatio]),k.clear({color:u.aT.transparent,depth:1}),F.coordsIndex=[];for(const lt of xt){const wt=F.getTerrainData(lt.tileID);k.activeTexture.set(j.TEXTURE0),j.bindTexture(j.TEXTURE_2D,K.texture);const Ft={u_matrix:O.transform.calculatePosMatrix(lt.tileID.toUnwrapped()),u_terrain_coords_id:(255-F.coordsIndex.length)/255,u_texture:0,u_ele_delta:F.getMeshFrameDelta(O.transform.zoom)};Nt.draw(k,j.TRIANGLES,et,Nr.disabled,tt,ar.backCCW,Ft,wt,"terrain",st.vertexBuffer,st.indexBuffer,st.segments),F.coordsIndex.push(lt.tileID.key)}k.bindFramebuffer.set(null),k.viewport.set([0,0,O.width,O.height])}(this,this.style.map.terrain))}this.renderPass="offscreen";for(const N of d){const O=this.style._layers[N];if(!O.hasOffscreenPass()||O.isHidden(this.transform.zoom))continue;const F=S[O.source];(O.type==="custom"||F.length)&&this.renderLayer(this,m[O.source],O,F)}if(this.context.bindFramebuffer.set(null),this.context.clear({color:p.showOverdrawInspector?u.aT.black:u.aT.transparent,depth:1}),this.clearStencil(),this._showOverdrawInspector=p.showOverdrawInspector,this.depthRangeFor3D=[0,1-(s._order.length+2)*this.numSublayers*this.depthEpsilon],!this.renderToTexture)for(this.renderPass="opaque",this.currentLayer=d.length-1;this.currentLayer>=0;this.currentLayer--){const N=this.style._layers[d[this.currentLayer]],O=m[N.source],F=v[N.source];this._renderTileClippingMasks(N,F),this.renderLayer(this,O,N,F)}for(this.renderPass="translucent",this.currentLayer=0;this.currentLayer<d.length;this.currentLayer++){const N=this.style._layers[d[this.currentLayer]],O=m[N.source];if(this.renderToTexture&&this.renderToTexture.renderLayer(N))continue;const F=(N.type==="symbol"?T:S)[N.source];this._renderTileClippingMasks(N,v[N.source]),this.renderLayer(this,O,N,F)}if(this.options.showTileBoundaries){const N=function(O,F){let k=null;const j=Object.values(O._layers).flatMap(K=>K.source&&!K.isHidden(F)?[O.sourceCaches[K.source]]:[]),tt=j.filter(K=>K.getSource().type==="vector"),et=j.filter(K=>K.getSource().type!=="vector"),st=K=>{(!k||k.getSource().maxzoom<K.getSource().maxzoom)&&(k=K)};return tt.forEach(K=>st(K)),k||et.forEach(K=>st(K)),k}(this.style,this.transform.zoom);N&&function(O,F,k){for(let j=0;j<k.length;j++)df(O,F,k[j])}(this,N,N.getVisibleCoordinates())}this.options.showPadding&&function(N){const O=N.transform.padding;lh(N,N.transform.height-(O.top||0),3,xc),lh(N,O.bottom||0,3,pf),ff(N,O.left||0,3,su),ff(N,N.transform.width-(O.right||0),3,Ig);const F=N.transform.centerPoint;(function(k,j,tt,et){bc(k,j-1,tt-10,2,20,et),bc(k,j-10,tt-1,20,2,et)})(N,F.x,N.transform.height-F.y,wl)}(this),this.context.setDefault()}renderLayer(s,p,d,m){if(!d.isHidden(this.transform.zoom)&&(d.type==="background"||d.type==="custom"||(m||[]).length))switch(this.id=d.id,d.type){case"symbol":(function(v,S,T,N,O){if(v.renderPass!=="translucent")return;const F=Nr.disabled,k=v.colorModeForRenderPass();(T._unevaluatedLayout.hasValue("text-variable-anchor")||T._unevaluatedLayout.hasValue("text-variable-anchor-offset"))&&function(j,tt,et,st,K,xt,Nt){const lt=tt.transform,wt=K==="map",Ft=xt==="map";for(const kt of j){const Zt=st.getTile(kt),ee=Zt.getBucket(et);if(!ee||!ee.text||!ee.text.segments.get().length)continue;const Jt=u.ah(ee.textSizeData,lt.zoom),ue=ft(Zt,1,tt.transform.zoom),Me=se(kt.posMatrix,Ft,wt,tt.transform,ue),Nn=et.layout.get("icon-text-fit")!=="none"&&ee.hasIconData();if(Jt){const ye=Math.pow(2,lt.zoom-Zt.tileID.overscaledZ);uf(ee,wt,Ft,Nt,lt,Me,kt.posMatrix,ye,Jt,Nn,tt.style.map.terrain?(He,De)=>tt.style.map.terrain.getElevation(kt,He,De):null)}}}(N,v,T,S,T.layout.get("text-rotation-alignment"),T.layout.get("text-pitch-alignment"),O),T.paint.get("icon-opacity").constantOr(1)!==0&&bl(v,S,T,N,!1,T.paint.get("icon-translate"),T.paint.get("icon-translate-anchor"),T.layout.get("icon-rotation-alignment"),T.layout.get("icon-pitch-alignment"),T.layout.get("icon-keep-upright"),F,k),T.paint.get("text-opacity").constantOr(1)!==0&&bl(v,S,T,N,!0,T.paint.get("text-translate"),T.paint.get("text-translate-anchor"),T.layout.get("text-rotation-alignment"),T.layout.get("text-pitch-alignment"),T.layout.get("text-keep-upright"),F,k),S.map.showCollisionBoxes&&(xl(v,S,T,N,T.paint.get("text-translate"),T.paint.get("text-translate-anchor"),!0),xl(v,S,T,N,T.paint.get("icon-translate"),T.paint.get("icon-translate-anchor"),!1))})(s,p,d,m,this.style.placement.variableOffsets);break;case"circle":(function(v,S,T,N){if(v.renderPass!=="translucent")return;const O=T.paint.get("circle-opacity"),F=T.paint.get("circle-stroke-width"),k=T.paint.get("circle-stroke-opacity"),j=!T.layout.get("circle-sort-key").isConstant();if(O.constantOr(1)===0&&(F.constantOr(1)===0||k.constantOr(1)===0))return;const tt=v.context,et=tt.gl,st=v.depthModeForSublayer(0,Ln.ReadOnly),K=Nr.disabled,xt=v.colorModeForRenderPass(),Nt=[];for(let lt=0;lt<N.length;lt++){const wt=N[lt],Ft=S.getTile(wt),kt=Ft.getBucket(T);if(!kt)continue;const Zt=kt.programConfigurations.get(T.id),ee=v.useProgram("circle",Zt),Jt=kt.layoutVertexBuffer,ue=kt.indexBuffer,Me=v.style.map.terrain&&v.style.map.terrain.getTerrainData(wt),Nn={programConfiguration:Zt,program:ee,layoutVertexBuffer:Jt,indexBuffer:ue,uniformValues:at(v,wt,Ft,T),terrainData:Me};if(j){const ye=kt.segments.get();for(const He of ye)Nt.push({segments:new u.S([He]),sortKey:He.sortKey,state:Nn})}else Nt.push({segments:kt.segments,sortKey:0,state:Nn})}j&&Nt.sort((lt,wt)=>lt.sortKey-wt.sortKey);for(const lt of Nt){const{programConfiguration:wt,program:Ft,layoutVertexBuffer:kt,indexBuffer:Zt,uniformValues:ee,terrainData:Jt}=lt.state;Ft.draw(tt,et.TRIANGLES,st,K,xt,ar.disabled,ee,Jt,T.id,kt,Zt,lt.segments,T.paint,v.transform.zoom,wt)}})(s,p,d,m);break;case"heatmap":(function(v,S,T,N){if(T.paint.get("heatmap-opacity")!==0)if(v.renderPass==="offscreen"){const O=v.context,F=O.gl,k=Nr.disabled,j=new $r([F.ONE,F.ONE],u.aT.transparent,[!0,!0,!0,!0]);(function(tt,et,st){const K=tt.gl;tt.activeTexture.set(K.TEXTURE1),tt.viewport.set([0,0,et.width/4,et.height/4]);let xt=st.heatmapFbo;if(xt)K.bindTexture(K.TEXTURE_2D,xt.colorAttachment.get()),tt.bindFramebuffer.set(xt.framebuffer);else{const Nt=K.createTexture();K.bindTexture(K.TEXTURE_2D,Nt),K.texParameteri(K.TEXTURE_2D,K.TEXTURE_WRAP_S,K.CLAMP_TO_EDGE),K.texParameteri(K.TEXTURE_2D,K.TEXTURE_WRAP_T,K.CLAMP_TO_EDGE),K.texParameteri(K.TEXTURE_2D,K.TEXTURE_MIN_FILTER,K.LINEAR),K.texParameteri(K.TEXTURE_2D,K.TEXTURE_MAG_FILTER,K.LINEAR),xt=st.heatmapFbo=tt.createFramebuffer(et.width/4,et.height/4,!1,!1),function(lt,wt,Ft,kt){var Zt,ee;const Jt=lt.gl,ue=(Zt=lt.HALF_FLOAT)!==null&&Zt!==void 0?Zt:Jt.UNSIGNED_BYTE,Me=(ee=lt.RGBA16F)!==null&&ee!==void 0?ee:Jt.RGBA;Jt.texImage2D(Jt.TEXTURE_2D,0,Me,wt.width/4,wt.height/4,0,Jt.RGBA,ue,null),kt.colorAttachment.set(Ft)}(tt,et,Nt,xt)}})(O,v,T),O.clear({color:u.aT.transparent});for(let tt=0;tt<N.length;tt++){const et=N[tt];if(S.hasRenderableParent(et))continue;const st=S.getTile(et),K=st.getBucket(T);if(!K)continue;const xt=K.programConfigurations.get(T.id),Nt=v.useProgram("heatmap",xt),{zoom:lt}=v.transform;Nt.draw(O,F.TRIANGLES,Ln.disabled,k,j,ar.disabled,te(et.posMatrix,st,lt,T.paint.get("heatmap-intensity")),null,T.id,K.layoutVertexBuffer,K.indexBuffer,K.segments,T.paint,v.transform.zoom,xt)}O.viewport.set([0,0,v.width,v.height])}else v.renderPass==="translucent"&&(v.context.setColorMode(v.colorModeForRenderPass()),function(O,F){const k=O.context,j=k.gl,tt=F.heatmapFbo;if(!tt)return;k.activeTexture.set(j.TEXTURE0),j.bindTexture(j.TEXTURE_2D,tt.colorAttachment.get()),k.activeTexture.set(j.TEXTURE1);let et=F.colorRampTexture;et||(et=F.colorRampTexture=new Yt(k,F.colorRamp,j.RGBA)),et.bind(j.LINEAR,j.CLAMP_TO_EDGE),O.useProgram("heatmapTexture").draw(k,j.TRIANGLES,Ln.disabled,Nr.disabled,O.colorModeForRenderPass(),ar.disabled,((st,K,xt,Nt)=>{const lt=u.Z();u.aS(lt,0,st.width,st.height,0,0,1);const wt=st.context.gl;return{u_matrix:lt,u_world:[wt.drawingBufferWidth,wt.drawingBufferHeight],u_image:0,u_color_ramp:1,u_opacity:K.paint.get("heatmap-opacity")}})(O,F),null,F.id,O.viewportBuffer,O.quadTriangleIndexBuffer,O.viewportSegments,F.paint,O.transform.zoom)}(v,T))})(s,p,d,m);break;case"line":(function(v,S,T,N){if(v.renderPass!=="translucent")return;const O=T.paint.get("line-opacity"),F=T.paint.get("line-width");if(O.constantOr(1)===0||F.constantOr(1)===0)return;const k=v.depthModeForSublayer(0,Ln.ReadOnly),j=v.colorModeForRenderPass(),tt=T.paint.get("line-dasharray"),et=T.paint.get("line-pattern"),st=et.constantOr(1),K=T.paint.get("line-gradient"),xt=T.getCrossfadeParameters(),Nt=st?"linePattern":tt?"lineSDF":K?"lineGradient":"line",lt=v.context,wt=lt.gl;let Ft=!0;for(const kt of N){const Zt=S.getTile(kt);if(st&&!Zt.patternsLoaded())continue;const ee=Zt.getBucket(T);if(!ee)continue;const Jt=ee.programConfigurations.get(T.id),ue=v.context.program.get(),Me=v.useProgram(Nt,Jt),Nn=Ft||Me.program!==ue,ye=v.style.map.terrain&&v.style.map.terrain.getTerrainData(kt),He=et.constantOr(null);if(He&&Zt.imageAtlas){const Tn=Zt.imageAtlas,_n=Tn.patternPositions[He.to.toString()],Pn=Tn.patternPositions[He.from.toString()];_n&&Pn&&Jt.setConstantPatternPositions(_n,Pn)}const De=ye?kt:null,_r=st?me(v,Zt,T,xt,De):tt?sn(v,Zt,T,tt,xt,De):K?we(v,Zt,T,ee.lineClipsArray.length,De):xe(v,Zt,T,De);if(st)lt.activeTexture.set(wt.TEXTURE0),Zt.imageAtlasTexture.bind(wt.LINEAR,wt.CLAMP_TO_EDGE),Jt.updatePaintBuffers(xt);else if(tt&&(Nn||v.lineAtlas.dirty))lt.activeTexture.set(wt.TEXTURE0),v.lineAtlas.bind(lt);else if(K){const Tn=ee.gradients[T.id];let _n=Tn.texture;if(T.gradientVersion!==Tn.version){let Pn=256;if(T.stepInterpolant){const Pi=S.getSource().maxzoom,Dr=kt.canonical.z===Pi?Math.ceil(1<<v.transform.maxZoom-kt.canonical.z):1;Pn=u.ad(u.aY(ee.maxLineLength/u.N*1024*Dr),256,lt.maxTextureSize)}Tn.gradient=u.aZ({expression:T.gradientExpression(),evaluationKey:"lineProgress",resolution:Pn,image:Tn.gradient||void 0,clips:ee.lineClipsArray}),Tn.texture?Tn.texture.update(Tn.gradient):Tn.texture=new Yt(lt,Tn.gradient,wt.RGBA),Tn.version=T.gradientVersion,_n=Tn.texture}lt.activeTexture.set(wt.TEXTURE0),_n.bind(T.stepInterpolant?wt.NEAREST:wt.LINEAR,wt.CLAMP_TO_EDGE)}Me.draw(lt,wt.TRIANGLES,k,v.stencilModeForClipping(kt),j,ar.disabled,_r,ye,T.id,ee.layoutVertexBuffer,ee.indexBuffer,ee.segments,T.paint,v.transform.zoom,Jt,ee.layoutVertexBuffer2),Ft=!1}})(s,p,d,m);break;case"fill":(function(v,S,T,N){const O=T.paint.get("fill-color"),F=T.paint.get("fill-opacity");if(F.constantOr(1)===0)return;const k=v.colorModeForRenderPass(),j=T.paint.get("fill-pattern"),tt=v.opaquePassEnabledForLayer()&&!j.constantOr(1)&&O.constantOr(u.aT.transparent).a===1&&F.constantOr(0)===1?"opaque":"translucent";if(v.renderPass===tt){const et=v.depthModeForSublayer(1,v.renderPass==="opaque"?Ln.ReadWrite:Ln.ReadOnly);tp(v,S,T,N,et,k,!1)}if(v.renderPass==="translucent"&&T.paint.get("fill-antialias")){const et=v.depthModeForSublayer(T.getPaintProperty("fill-outline-color")?2:0,Ln.ReadOnly);tp(v,S,T,N,et,k,!0)}})(s,p,d,m);break;case"fill-extrusion":(function(v,S,T,N){const O=T.paint.get("fill-extrusion-opacity");if(O!==0&&v.renderPass==="translucent"){const F=new Ln(v.context.gl.LEQUAL,Ln.ReadWrite,v.depthRangeFor3D);if(O!==1||T.paint.get("fill-extrusion-pattern").constantOr(1))ep(v,S,T,N,F,Nr.disabled,$r.disabled),ep(v,S,T,N,F,v.stencilModeFor3D(),v.colorModeForRenderPass());else{const k=v.colorModeForRenderPass();ep(v,S,T,N,F,Nr.disabled,k)}}})(s,p,d,m);break;case"hillshade":(function(v,S,T,N){if(v.renderPass!=="offscreen"&&v.renderPass!=="translucent")return;const O=v.context,F=v.depthModeForSublayer(0,Ln.ReadOnly),k=v.colorModeForRenderPass(),[j,tt]=v.renderPass==="translucent"?v.stencilConfigForOverlap(N):[{},N];for(const et of tt){const st=S.getTile(et);st.needsHillshadePrepare!==void 0&&st.needsHillshadePrepare&&v.renderPass==="offscreen"?cf(v,st,T,F,Nr.disabled,k):v.renderPass==="translucent"&&Eg(v,et,st,T,F,j[et.overscaledZ],k)}O.viewport.set([0,0,v.width,v.height])})(s,p,d,m);break;case"raster":(function(v,S,T,N){if(v.renderPass!=="translucent"||T.paint.get("raster-opacity")===0||!N.length)return;const O=v.context,F=O.gl,k=S.getSource(),j=v.useProgram("raster"),tt=v.colorModeForRenderPass(),[et,st]=k instanceof nn?[{},N]:v.stencilConfigForOverlap(N),K=st[st.length-1].overscaledZ,xt=!v.options.moving;for(const Nt of st){const lt=v.depthModeForSublayer(Nt.overscaledZ-K,T.paint.get("raster-opacity")===1?Ln.ReadWrite:Ln.ReadOnly,F.LESS),wt=S.getTile(Nt);wt.registerFadeDuration(T.paint.get("raster-fade-duration"));const Ft=S.findLoadedParent(Nt,0),kt=hf(wt,Ft,S,T,v.transform,v.style.map.terrain);let Zt,ee;const Jt=T.paint.get("raster-resampling")==="nearest"?F.NEAREST:F.LINEAR;O.activeTexture.set(F.TEXTURE0),wt.texture.bind(Jt,F.CLAMP_TO_EDGE,F.LINEAR_MIPMAP_NEAREST),O.activeTexture.set(F.TEXTURE1),Ft?(Ft.texture.bind(Jt,F.CLAMP_TO_EDGE,F.LINEAR_MIPMAP_NEAREST),Zt=Math.pow(2,Ft.tileID.overscaledZ-wt.tileID.overscaledZ),ee=[wt.tileID.canonical.x*Zt%1,wt.tileID.canonical.y*Zt%1]):wt.texture.bind(Jt,F.CLAMP_TO_EDGE,F.LINEAR_MIPMAP_NEAREST);const ue=v.style.map.terrain&&v.style.map.terrain.getTerrainData(Nt),Me=ue?Nt:null,Nn=Me?Me.posMatrix:v.transform.calculatePosMatrix(Nt.toUnwrapped(),xt),ye=fi(Nn,ee||[0,0],Zt||1,kt,T);k instanceof nn?j.draw(O,F.TRIANGLES,lt,Nr.disabled,tt,ar.disabled,ye,ue,T.id,k.boundsBuffer,v.quadTriangleIndexBuffer,k.boundsSegments):j.draw(O,F.TRIANGLES,lt,et[Nt.overscaledZ],tt,ar.disabled,ye,ue,T.id,v.rasterBoundsBuffer,v.quadTriangleIndexBuffer,v.rasterBoundsSegments)}})(s,p,d,m);break;case"background":(function(v,S,T,N){const O=T.paint.get("background-color"),F=T.paint.get("background-opacity");if(F===0)return;const k=v.context,j=k.gl,tt=v.transform,et=tt.tileSize,st=T.paint.get("background-pattern");if(v.isPatternMissing(st))return;const K=!st&&O.a===1&&F===1&&v.opaquePassEnabledForLayer()?"opaque":"translucent";if(v.renderPass!==K)return;const xt=Nr.disabled,Nt=v.depthModeForSublayer(0,K==="opaque"?Ln.ReadWrite:Ln.ReadOnly),lt=v.colorModeForRenderPass(),wt=v.useProgram(st?"backgroundPattern":"background"),Ft=N||tt.coveringTiles({tileSize:et,terrain:v.style.map.terrain});st&&(k.activeTexture.set(j.TEXTURE0),v.imageManager.bind(v.context));const kt=T.getCrossfadeParameters();for(const Zt of Ft){const ee=N?Zt.posMatrix:v.transform.calculatePosMatrix(Zt.toUnwrapped()),Jt=st?us(ee,F,v,st,{tileID:Zt,tileSize:et},kt):Zr(ee,F,O),ue=v.style.map.terrain&&v.style.map.terrain.getTerrainData(Zt);wt.draw(k,j.TRIANGLES,Nt,xt,lt,ar.disabled,Jt,ue,T.id,v.tileExtentBuffer,v.quadTriangleIndexBuffer,v.tileExtentSegments)}})(s,0,d,m);break;case"custom":(function(v,S,T){const N=v.context,O=T.implementation;if(v.renderPass==="offscreen"){const F=O.prerender;F&&(v.setCustomLayerDefaults(),N.setColorMode(v.colorModeForRenderPass()),F.call(O,N.gl,v.transform.customLayerMatrix()),N.setDirty(),v.setBaseState())}else if(v.renderPass==="translucent"){v.setCustomLayerDefaults(),N.setColorMode(v.colorModeForRenderPass()),N.setStencilMode(Nr.disabled);const F=O.renderingMode==="3d"?new Ln(v.context.gl.LEQUAL,Ln.ReadWrite,v.depthRangeFor3D):v.depthModeForSublayer(0,Ln.ReadOnly);N.setDepthMode(F),O.render(N.gl,v.transform.customLayerMatrix()),N.setDirty(),v.setBaseState(),N.bindFramebuffer.set(null)}})(s,0,d)}}translatePosMatrix(s,p,d,m,v){if(!d[0]&&!d[1])return s;const S=v?m==="map"?this.transform.angle:0:m==="viewport"?-this.transform.angle:0;if(S){const O=Math.sin(S),F=Math.cos(S);d=[d[0]*F-d[1]*O,d[0]*O+d[1]*F]}const T=[v?d[0]:ft(p,d[0],this.transform.zoom),v?d[1]:ft(p,d[1],this.transform.zoom),0],N=new Float32Array(16);return u.$(N,s,T),N}saveTileTexture(s){const p=this._tileTextures[s.size[0]];p?p.push(s):this._tileTextures[s.size[0]]=[s]}getTileTexture(s){const p=this._tileTextures[s];return p&&p.length>0?p.pop():null}isPatternMissing(s){if(!s)return!1;if(!s.from||!s.to)return!0;const p=this.imageManager.getPattern(s.from.toString()),d=this.imageManager.getPattern(s.to.toString());return!p||!d}useProgram(s,p){this.cache=this.cache||{};const d=s+(p?p.cacheKey:"")+(this._showOverdrawInspector?"/overdraw":"")+(this.style.map.terrain?"/terrain":"");return this.cache[d]||(this.cache[d]=new Yh(this.context,Fr[s],p,Hp[s],this._showOverdrawInspector,this.style.map.terrain)),this.cache[d]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){const s=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(s.FUNC_ADD)}initDebugOverlayCanvas(){this.debugOverlayCanvas==null&&(this.debugOverlayCanvas=document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new Yt(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))}destroy(){this.debugOverlayTexture&&this.debugOverlayTexture.destroy()}overLimit(){const{drawingBufferWidth:s,drawingBufferHeight:p}=this.context.gl;return this.width!==s||this.height!==p}}class Yo{constructor(s,p){this.points=s,this.planes=p}static fromInvProjectionMatrix(s,p,d){const m=Math.pow(2,d),v=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(T=>{const N=1/(T=u.ag([],T,s))[3]/p*m;return u.b3(T,T,[N,N,1/T[3],N])}),S=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map(T=>{const N=function(j,tt){var et=tt[0],st=tt[1],K=tt[2],xt=et*et+st*st+K*K;return xt>0&&(xt=1/Math.sqrt(xt)),j[0]=tt[0]*xt,j[1]=tt[1]*xt,j[2]=tt[2]*xt,j}([],function(j,tt,et){var st=tt[0],K=tt[1],xt=tt[2],Nt=et[0],lt=et[1],wt=et[2];return j[0]=K*wt-xt*lt,j[1]=xt*Nt-st*wt,j[2]=st*lt-K*Nt,j}([],zt([],v[T[0]],v[T[1]]),zt([],v[T[2]],v[T[1]]))),O=-((F=N)[0]*(k=v[T[1]])[0]+F[1]*k[1]+F[2]*k[2]);var F,k;return N.concat(O)});return new Yo(v,S)}}class au{constructor(s,p){this.min=s,this.max=p,this.center=function(d,m,v){return d[0]=.5*m[0],d[1]=.5*m[1],d[2]=.5*m[2],d}([],function(d,m,v){return d[0]=m[0]+v[0],d[1]=m[1]+v[1],d[2]=m[2]+v[2],d}([],this.min,this.max))}quadrant(s){const p=[s%2==0,s<2],d=gt(this.min),m=gt(this.max);for(let v=0;v<p.length;v++)d[v]=p[v]?this.min[v]:this.center[v],m[v]=p[v]?this.center[v]:this.max[v];return m[2]=this.max[2],new au(d,m)}distanceX(s){return Math.max(Math.min(this.max[0],s[0]),this.min[0])-s[0]}distanceY(s){return Math.max(Math.min(this.max[1],s[1]),this.min[1])-s[1]}intersects(s){const p=[[this.min[0],this.min[1],this.min[2],1],[this.max[0],this.min[1],this.min[2],1],[this.max[0],this.max[1],this.min[2],1],[this.min[0],this.max[1],this.min[2],1],[this.min[0],this.min[1],this.max[2],1],[this.max[0],this.min[1],this.max[2],1],[this.max[0],this.max[1],this.max[2],1],[this.min[0],this.max[1],this.max[2],1]];let d=!0;for(let m=0;m<s.planes.length;m++){const v=s.planes[m];let S=0;for(let T=0;T<p.length;T++)u.b4(v,p[T])>=0&&S++;if(S===0)return 0;S!==p.length&&(d=!1)}if(d)return 2;for(let m=0;m<3;m++){let v=Number.MAX_VALUE,S=-Number.MAX_VALUE;for(let T=0;T<s.points.length;T++){const N=s.points[T][m]-this.min[m];v=Math.min(v,N),S=Math.max(S,N)}if(S<0||v>this.max[m]-this.min[m])return 0}return 1}}class ch{constructor(s=0,p=0,d=0,m=0){if(isNaN(s)||s<0||isNaN(p)||p<0||isNaN(d)||d<0||isNaN(m)||m<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=s,this.bottom=p,this.left=d,this.right=m}interpolate(s,p,d){return p.top!=null&&s.top!=null&&(this.top=u.B.number(s.top,p.top,d)),p.bottom!=null&&s.bottom!=null&&(this.bottom=u.B.number(s.bottom,p.bottom,d)),p.left!=null&&s.left!=null&&(this.left=u.B.number(s.left,p.left,d)),p.right!=null&&s.right!=null&&(this.right=u.B.number(s.right,p.right,d)),this}getCenter(s,p){const d=u.ad((this.left+s-this.right)/2,0,s),m=u.ad((this.top+p-this.bottom)/2,0,p);return new u.P(d,m)}equals(s){return this.top===s.top&&this.bottom===s.bottom&&this.left===s.left&&this.right===s.right}clone(){return new ch(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}class gf{constructor(s,p,d,m,v){this.tileSize=512,this.maxValidLatitude=85.051129,this._renderWorldCopies=v===void 0||!!v,this._minZoom=s||0,this._maxZoom=p||22,this._minPitch=d??0,this._maxPitch=m??60,this.setMaxBounds(),this.width=0,this.height=0,this._center=new u.L(0,0),this._elevation=0,this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._unmodified=!0,this._edgeInsets=new ch,this._posMatrixCache={},this._alignedPosMatrixCache={},this._minEleveationForCurrentTile=0}clone(){const s=new gf(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies);return s.apply(this),s}apply(s){this.tileSize=s.tileSize,this.latRange=s.latRange,this.width=s.width,this.height=s.height,this._center=s._center,this._elevation=s._elevation,this._minEleveationForCurrentTile=s._minEleveationForCurrentTile,this.zoom=s.zoom,this.angle=s.angle,this._fov=s._fov,this._pitch=s._pitch,this._unmodified=s._unmodified,this._edgeInsets=s._edgeInsets.clone(),this._calcMatrices()}get minZoom(){return this._minZoom}set minZoom(s){this._minZoom!==s&&(this._minZoom=s,this.zoom=Math.max(this.zoom,s))}get maxZoom(){return this._maxZoom}set maxZoom(s){this._maxZoom!==s&&(this._maxZoom=s,this.zoom=Math.min(this.zoom,s))}get minPitch(){return this._minPitch}set minPitch(s){this._minPitch!==s&&(this._minPitch=s,this.pitch=Math.max(this.pitch,s))}get maxPitch(){return this._maxPitch}set maxPitch(s){this._maxPitch!==s&&(this._maxPitch=s,this.pitch=Math.min(this.pitch,s))}get renderWorldCopies(){return this._renderWorldCopies}set renderWorldCopies(s){s===void 0?s=!0:s===null&&(s=!1),this._renderWorldCopies=s}get worldSize(){return this.tileSize*this.scale}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new u.P(this.width,this.height)}get bearing(){return-this.angle/Math.PI*180}set bearing(s){const p=-u.b5(s,-180,180)*Math.PI/180;this.angle!==p&&(this._unmodified=!1,this.angle=p,this._calcMatrices(),this.rotationMatrix=function(){var d=new u.A(4);return u.A!=Float32Array&&(d[1]=0,d[2]=0),d[0]=1,d[3]=1,d}(),function(d,m,v){var S=m[0],T=m[1],N=m[2],O=m[3],F=Math.sin(v),k=Math.cos(v);d[0]=S*k+N*F,d[1]=T*k+O*F,d[2]=S*-F+N*k,d[3]=T*-F+O*k}(this.rotationMatrix,this.rotationMatrix,this.angle))}get pitch(){return this._pitch/Math.PI*180}set pitch(s){const p=u.ad(s,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==p&&(this._unmodified=!1,this._pitch=p,this._calcMatrices())}get fov(){return this._fov/Math.PI*180}set fov(s){s=Math.max(.01,Math.min(60,s)),this._fov!==s&&(this._unmodified=!1,this._fov=s/180*Math.PI,this._calcMatrices())}get zoom(){return this._zoom}set zoom(s){const p=Math.min(Math.max(s,this.minZoom),this.maxZoom);this._zoom!==p&&(this._unmodified=!1,this._zoom=p,this.tileZoom=Math.max(0,Math.floor(p)),this.scale=this.zoomScale(p),this._constrain(),this._calcMatrices())}get center(){return this._center}set center(s){s.lat===this._center.lat&&s.lng===this._center.lng||(this._unmodified=!1,this._center=s,this._constrain(),this._calcMatrices())}get elevation(){return this._elevation}set elevation(s){s!==this._elevation&&(this._elevation=s,this._constrain(),this._calcMatrices())}get padding(){return this._edgeInsets.toJSON()}set padding(s){this._edgeInsets.equals(s)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,s,1),this._calcMatrices())}get centerPoint(){return this._edgeInsets.getCenter(this.width,this.height)}isPaddingEqual(s){return this._edgeInsets.equals(s)}interpolatePadding(s,p,d){this._unmodified=!1,this._edgeInsets.interpolate(s,p,d),this._constrain(),this._calcMatrices()}coveringZoomLevel(s){const p=(s.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/s.tileSize));return Math.max(0,p)}getVisibleUnwrappedCoordinates(s){const p=[new u.b6(0,s)];if(this._renderWorldCopies){const d=this.pointCoordinate(new u.P(0,0)),m=this.pointCoordinate(new u.P(this.width,0)),v=this.pointCoordinate(new u.P(this.width,this.height)),S=this.pointCoordinate(new u.P(0,this.height)),T=Math.floor(Math.min(d.x,m.x,v.x,S.x)),N=Math.floor(Math.max(d.x,m.x,v.x,S.x)),O=1;for(let F=T-O;F<=N+O;F++)F!==0&&p.push(new u.b6(F,s))}return p}coveringTiles(s){var p,d;let m=this.coveringZoomLevel(s);const v=m;if(s.minzoom!==void 0&&m<s.minzoom)return[];s.maxzoom!==void 0&&m>s.maxzoom&&(m=s.maxzoom);const S=this.pointCoordinate(this.getCameraPoint()),T=u.U.fromLngLat(this.center),N=Math.pow(2,m),O=[N*S.x,N*S.y,0],F=[N*T.x,N*T.y,0],k=Yo.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,m);let j=s.minzoom||0;!s.terrain&&this.pitch<=60&&this._edgeInsets.top<.1&&(j=m);const tt=s.terrain?2/Math.min(this.tileSize,s.tileSize)*this.tileSize:3,et=lt=>({aabb:new au([lt*N,0,0],[(lt+1)*N,N,0]),zoom:0,x:0,y:0,wrap:lt,fullyVisible:!1}),st=[],K=[],xt=m,Nt=s.reparseOverscaled?v:m;if(this._renderWorldCopies)for(let lt=1;lt<=3;lt++)st.push(et(-lt)),st.push(et(lt));for(st.push(et(0));st.length>0;){const lt=st.pop(),wt=lt.x,Ft=lt.y;let kt=lt.fullyVisible;if(!kt){const Me=lt.aabb.intersects(k);if(Me===0)continue;kt=Me===2}const Zt=s.terrain?O:F,ee=lt.aabb.distanceX(Zt),Jt=lt.aabb.distanceY(Zt),ue=Math.max(Math.abs(ee),Math.abs(Jt));if(lt.zoom===xt||ue>tt+(1<<xt-lt.zoom)-2&&lt.zoom>=j){const Me=xt-lt.zoom,Nn=O[0]-.5-(wt<<Me),ye=O[1]-.5-(Ft<<Me);K.push({tileID:new u.O(lt.zoom===xt?Nt:lt.zoom,lt.wrap,lt.zoom,wt,Ft),distanceSq:Ot([F[0]-.5-wt,F[1]-.5-Ft]),tileDistanceToCamera:Math.sqrt(Nn*Nn+ye*ye)})}else for(let Me=0;Me<4;Me++){const Nn=(wt<<1)+Me%2,ye=(Ft<<1)+(Me>>1),He=lt.zoom+1;let De=lt.aabb.quadrant(Me);if(s.terrain){const _r=new u.O(He,lt.wrap,He,Nn,ye),Tn=s.terrain.getMinMaxElevation(_r),_n=(p=Tn.minElevation)!==null&&p!==void 0?p:this.elevation,Pn=(d=Tn.maxElevation)!==null&&d!==void 0?d:this.elevation;De=new au([De.min[0],De.min[1],_n],[De.max[0],De.max[1],Pn])}st.push({aabb:De,zoom:He,x:Nn,y:ye,wrap:lt.wrap,fullyVisible:kt})}}return K.sort((lt,wt)=>lt.distanceSq-wt.distanceSq).map(lt=>lt.tileID)}resize(s,p){this.width=s,this.height=p,this.pixelsToGLUnits=[2/s,-2/p],this._constrain(),this._calcMatrices()}get unmodified(){return this._unmodified}zoomScale(s){return Math.pow(2,s)}scaleZoom(s){return Math.log(s)/Math.LN2}project(s){const p=u.ad(s.lat,-this.maxValidLatitude,this.maxValidLatitude);return new u.P(u.G(s.lng)*this.worldSize,u.H(p)*this.worldSize)}unproject(s){return new u.U(s.x/this.worldSize,s.y/this.worldSize).toLngLat()}get point(){return this.project(this.center)}getCameraPosition(){return{lngLat:this.pointLocation(this.getCameraPoint()),altitude:Math.cos(this._pitch)*this.cameraToCenterDistance/this._pixelPerMeter+this.elevation}}recalculateZoom(s){const p=this.pointLocation(this.centerPoint,s),d=s.getElevationForLngLatZoom(p,this.tileZoom);if(!(this.elevation-d))return;const m=this.getCameraPosition(),v=u.U.fromLngLat(m.lngLat,m.altitude),S=u.U.fromLngLat(p,d),T=v.x-S.x,N=v.y-S.y,O=v.z-S.z,F=Math.sqrt(T*T+N*N+O*O),k=this.scaleZoom(this.cameraToCenterDistance/F/this.tileSize);this._elevation=d,this._center=p,this.zoom=k}setLocationAtPoint(s,p){const d=this.pointCoordinate(p),m=this.pointCoordinate(this.centerPoint),v=this.locationCoordinate(s),S=new u.U(v.x-(d.x-m.x),v.y-(d.y-m.y));this.center=this.coordinateLocation(S),this._renderWorldCopies&&(this.center=this.center.wrap())}locationPoint(s,p){return p?this.coordinatePoint(this.locationCoordinate(s),p.getElevationForLngLatZoom(s,this.tileZoom),this.pixelMatrix3D):this.coordinatePoint(this.locationCoordinate(s))}pointLocation(s,p){return this.coordinateLocation(this.pointCoordinate(s,p))}locationCoordinate(s){return u.U.fromLngLat(s)}coordinateLocation(s){return s&&s.toLngLat()}pointCoordinate(s,p){if(p){const j=p.pointCoordinate(s);if(j!=null)return j}const d=[s.x,s.y,0,1],m=[s.x,s.y,1,1];u.ag(d,d,this.pixelMatrixInverse),u.ag(m,m,this.pixelMatrixInverse);const v=d[3],S=m[3],T=d[1]/v,N=m[1]/S,O=d[2]/v,F=m[2]/S,k=O===F?0:(0-O)/(F-O);return new u.U(u.B.number(d[0]/v,m[0]/S,k)/this.worldSize,u.B.number(T,N,k)/this.worldSize)}coordinatePoint(s,p=0,d=this.pixelMatrix){const m=[s.x*this.worldSize,s.y*this.worldSize,p,1];return u.ag(m,m,d),new u.P(m[0]/m[3],m[1]/m[3])}getBounds(){const s=Math.max(0,this.height/2-this.getHorizon());return new Fe().extend(this.pointLocation(new u.P(0,s))).extend(this.pointLocation(new u.P(this.width,s))).extend(this.pointLocation(new u.P(this.width,this.height))).extend(this.pointLocation(new u.P(0,this.height)))}getMaxBounds(){return this.latRange&&this.latRange.length===2&&this.lngRange&&this.lngRange.length===2?new Fe([this.lngRange[0],this.latRange[0]],[this.lngRange[1],this.latRange[1]]):null}getHorizon(){return Math.tan(Math.PI/2-this._pitch)*this.cameraToCenterDistance*.85}setMaxBounds(s){s?(this.lngRange=[s.getWest(),s.getEast()],this.latRange=[s.getSouth(),s.getNorth()],this._constrain()):(this.lngRange=null,this.latRange=[-this.maxValidLatitude,this.maxValidLatitude])}calculatePosMatrix(s,p=!1){const d=s.key,m=p?this._alignedPosMatrixCache:this._posMatrixCache;if(m[d])return m[d];const v=s.canonical,S=this.worldSize/this.zoomScale(v.z),T=v.x+Math.pow(2,v.z)*s.wrap,N=u.ao(new Float64Array(16));return u.$(N,N,[T*S,v.y*S,0]),u.a0(N,N,[S/u.N,S/u.N,1]),u.a1(N,p?this.alignedProjMatrix:this.projMatrix,N),m[d]=new Float32Array(N),m[d]}customLayerMatrix(){return this.mercatorMatrix.slice()}_constrain(){if(!this.center||!this.width||!this.height||this._constraining)return;this._constraining=!0;let s,p,d,m,v=-90,S=90,T=-180,N=180;const O=this.size,F=this._unmodified;if(this.latRange){const tt=this.latRange;v=u.H(tt[1])*this.worldSize,S=u.H(tt[0])*this.worldSize,s=S-v<O.y?O.y/(S-v):0}if(this.lngRange){const tt=this.lngRange;T=u.b5(u.G(tt[0])*this.worldSize,0,this.worldSize),N=u.b5(u.G(tt[1])*this.worldSize,0,this.worldSize),N<T&&(N+=this.worldSize),p=N-T<O.x?O.x/(N-T):0}const k=this.point,j=Math.max(p||0,s||0);if(j)return this.center=this.unproject(new u.P(p?(N+T)/2:k.x,s?(S+v)/2:k.y)),this.zoom+=this.scaleZoom(j),this._unmodified=F,void(this._constraining=!1);if(this.latRange){const tt=k.y,et=O.y/2;tt-et<v&&(m=v+et),tt+et>S&&(m=S-et)}if(this.lngRange){const tt=(T+N)/2,et=u.b5(k.x,tt-this.worldSize/2,tt+this.worldSize/2),st=O.x/2;et-st<T&&(d=T+st),et+st>N&&(d=N-st)}d===void 0&&m===void 0||(this.center=this.unproject(new u.P(d!==void 0?d:k.x,m!==void 0?m:k.y)).wrap()),this._unmodified=F,this._constraining=!1}_calcMatrices(){if(!this.height)return;const s=this.centerOffset,p=this.point.x,d=this.point.y;this.cameraToCenterDistance=.5/Math.tan(this._fov/2)*this.height,this._pixelPerMeter=u.b7(1,this.center.lat)*this.worldSize;let m=u.ao(new Float64Array(16));u.a0(m,m,[this.width/2,-this.height/2,1]),u.$(m,m,[1,-1,0]),this.labelPlaneMatrix=m,m=u.ao(new Float64Array(16)),u.a0(m,m,[1,-1,1]),u.$(m,m,[-1,-1,0]),u.a0(m,m,[2/this.width,2/this.height,1]),this.glCoordMatrix=m;const v=this.cameraToCenterDistance+this._elevation*this._pixelPerMeter/Math.cos(this._pitch),S=Math.min(this.elevation,this._minEleveationForCurrentTile),T=v-S*this._pixelPerMeter/Math.cos(this._pitch),N=S<0?T:v,O=Math.PI/2+this._pitch,F=this._fov*(.5+s.y/this.height),k=Math.sin(F)*N/Math.sin(u.ad(Math.PI-O-F,.01,Math.PI-.01)),j=this.getHorizon(),tt=2*Math.atan(j/this.cameraToCenterDistance)*(.5+s.y/(2*j)),et=Math.sin(tt)*N/Math.sin(u.ad(Math.PI-O-tt,.01,Math.PI-.01)),st=Math.min(k,et),K=1.01*(Math.cos(Math.PI/2-this._pitch)*st+N),xt=this.height/50;m=new Float64Array(16),u.b8(m,this._fov,this.width/this.height,xt,K),m[8]=2*-s.x/this.width,m[9]=2*s.y/this.height,u.a0(m,m,[1,-1,1]),u.$(m,m,[0,0,-this.cameraToCenterDistance]),u.b9(m,m,this._pitch),u.ae(m,m,this.angle),u.$(m,m,[-p,-d,0]),this.mercatorMatrix=u.a0([],m,[this.worldSize,this.worldSize,this.worldSize]),u.a0(m,m,[1,1,this._pixelPerMeter]),this.pixelMatrix=u.a1(new Float64Array(16),this.labelPlaneMatrix,m),u.$(m,m,[0,0,-this.elevation]),this.projMatrix=m,this.invProjMatrix=u.as([],m),this.pixelMatrix3D=u.a1(new Float64Array(16),this.labelPlaneMatrix,m);const Nt=this.width%2/2,lt=this.height%2/2,wt=Math.cos(this.angle),Ft=Math.sin(this.angle),kt=p-Math.round(p)+wt*Nt+Ft*lt,Zt=d-Math.round(d)+wt*lt+Ft*Nt,ee=new Float64Array(m);if(u.$(ee,ee,[kt>.5?kt-1:kt,Zt>.5?Zt-1:Zt,0]),this.alignedProjMatrix=ee,m=u.as(new Float64Array(16),this.pixelMatrix),!m)throw new Error("failed to invert matrix");this.pixelMatrixInverse=m,this._posMatrixCache={},this._alignedPosMatrixCache={}}maxPitchScaleFactor(){if(!this.pixelMatrixInverse)return 1;const s=this.pointCoordinate(new u.P(0,0)),p=[s.x*this.worldSize,s.y*this.worldSize,0,1];return u.ag(p,p,this.pixelMatrix)[3]/this.cameraToCenterDistance}getCameraPoint(){const s=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new u.P(0,s))}getCameraQueryGeometry(s){const p=this.getCameraPoint();if(s.length===1)return[s[0],p];{let d=p.x,m=p.y,v=p.x,S=p.y;for(const T of s)d=Math.min(d,T.x),m=Math.min(m,T.y),v=Math.max(v,T.x),S=Math.max(S,T.y);return[new u.P(d,m),new u.P(v,m),new u.P(v,S),new u.P(d,S),new u.P(d,m)]}}}function It(y,s){let p,d=!1,m=null,v=null;const S=()=>{m=null,d&&(y.apply(v,p),m=setTimeout(S,s),d=!1)};return(...T)=>(d=!0,v=this,p=T,m||S(),m)}class Gt{constructor(s){this._getCurrentHash=()=>{const p=window.location.hash.replace("#","");if(this._hashName){let d;return p.split("&").map(m=>m.split("=")).forEach(m=>{m[0]===this._hashName&&(d=m)}),(d&&d[1]||"").split("/")}return p.split("/")},this._onHashChange=()=>{const p=this._getCurrentHash();if(p.length>=3&&!p.some(d=>isNaN(d))){const d=this._map.dragRotate.isEnabled()&&this._map.touchZoomRotate.isEnabled()?+(p[3]||0):this._map.getBearing();return this._map.jumpTo({center:[+p[2],+p[1]],zoom:+p[0],bearing:d,pitch:+(p[4]||0)}),!0}return!1},this._updateHashUnthrottled=()=>{const p=window.location.href.replace(/(#.+)?$/,this.getHashString());try{window.history.replaceState(window.history.state,null,p)}catch{}},this._updateHash=It(this._updateHashUnthrottled,300),this._hashName=s&&encodeURIComponent(s)}addTo(s){return this._map=s,addEventListener("hashchange",this._onHashChange,!1),this._map.on("moveend",this._updateHash),this}remove(){return removeEventListener("hashchange",this._onHashChange,!1),this._map.off("moveend",this._updateHash),clearTimeout(this._updateHash()),delete this._map,this}getHashString(s){const p=this._map.getCenter(),d=Math.round(100*this._map.getZoom())/100,m=Math.ceil((d*Math.LN2+Math.log(512/360/.5))/Math.LN10),v=Math.pow(10,m),S=Math.round(p.lng*v)/v,T=Math.round(p.lat*v)/v,N=this._map.getBearing(),O=this._map.getPitch();let F="";if(F+=s?`/${S}/${T}/${d}`:`${d}/${T}/${S}`,(N||O)&&(F+="/"+Math.round(10*N)/10),O&&(F+=`/${Math.round(O)}`),this._hashName){const k=this._hashName;let j=!1;const tt=window.location.hash.slice(1).split("&").map(et=>{const st=et.split("=")[0];return st===k?(j=!0,`${st}=${F}`):et}).filter(et=>et);return j||tt.push(`${k}=${F}`),`#${tt.join("&")}`}return`#${F}`}}const ge={linearity:.3,easing:u.ba(0,0,.3,1)},Xe=u.e({deceleration:2500,maxSpeed:1400},ge),Pr=u.e({deceleration:20,maxSpeed:1400},ge),An=u.e({deceleration:1e3,maxSpeed:360},ge),ni=u.e({deceleration:1e3,maxSpeed:90},ge);class di{constructor(s){this._map=s,this.clear()}clear(){this._inertiaBuffer=[]}record(s){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:u.h.now(),settings:s})}_drainInertiaBuffer(){const s=this._inertiaBuffer,p=u.h.now();for(;s.length>0&&p-s[0].time>160;)s.shift()}_onMoveEnd(s){if(this._drainInertiaBuffer(),this._inertiaBuffer.length<2)return;const p={zoom:0,bearing:0,pitch:0,pan:new u.P(0,0),pinchAround:void 0,around:void 0};for(const{settings:v}of this._inertiaBuffer)p.zoom+=v.zoomDelta||0,p.bearing+=v.bearingDelta||0,p.pitch+=v.pitchDelta||0,v.panDelta&&p.pan._add(v.panDelta),v.around&&(p.around=v.around),v.pinchAround&&(p.pinchAround=v.pinchAround);const d=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,m={};if(p.pan.mag()){const v=Hr(p.pan.mag(),d,u.e({},Xe,s||{}));m.offset=p.pan.mult(v.amount/p.pan.mag()),m.center=this._map.transform.center,Li(m,v)}if(p.zoom){const v=Hr(p.zoom,d,Pr);m.zoom=this._map.transform.zoom+v.amount,Li(m,v)}if(p.bearing){const v=Hr(p.bearing,d,An);m.bearing=this._map.transform.bearing+u.ad(v.amount,-179,179),Li(m,v)}if(p.pitch){const v=Hr(p.pitch,d,ni);m.pitch=this._map.transform.pitch+v.amount,Li(m,v)}if(m.zoom||m.bearing){const v=p.pinchAround===void 0?p.around:p.pinchAround;m.around=v?this._map.unproject(v):this._map.getCenter()}return this.clear(),u.e(m,{noMoveStart:!0})}}function Li(y,s){(!y.duration||y.duration<s.duration)&&(y.duration=s.duration,y.easing=s.easing)}function Hr(y,s,p){const{maxSpeed:d,linearity:m,deceleration:v}=p,S=u.ad(y*m/(s/1e3),-d,d),T=Math.abs(S)/(v*m);return{easing:p.easing,duration:1e3*T,amount:S*(T/2)}}class ur extends u.k{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(s,p,d,m={}){const v=w.mousePos(p.getCanvasContainer(),d),S=p.unproject(v);super(s,u.e({point:v,lngLat:S,originalEvent:d},m)),this._defaultPrevented=!1,this.target=p}}class hs extends u.k{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(s,p,d){const m=s==="touchend"?d.changedTouches:d.touches,v=w.touchPos(p.getCanvasContainer(),m),S=v.map(N=>p.unproject(N)),T=v.reduce((N,O,F,k)=>N.add(O.div(k.length)),new u.P(0,0));super(s,{points:v,point:T,lngLats:S,lngLat:p.unproject(T),originalEvent:d}),this._defaultPrevented=!1}}class uu extends u.k{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(s,p,d){super(s,{originalEvent:d}),this._defaultPrevented=!1}}class No{constructor(s,p){this._map=s,this._clickTolerance=p.clickTolerance}reset(){delete this._mousedownPos}wheel(s){return this._firePreventable(new uu(s.type,this._map,s))}mousedown(s,p){return this._mousedownPos=p,this._firePreventable(new ur(s.type,this._map,s))}mouseup(s){this._map.fire(new ur(s.type,this._map,s))}click(s,p){this._mousedownPos&&this._mousedownPos.dist(p)>=this._clickTolerance||this._map.fire(new ur(s.type,this._map,s))}dblclick(s){return this._firePreventable(new ur(s.type,this._map,s))}mouseover(s){this._map.fire(new ur(s.type,this._map,s))}mouseout(s){this._map.fire(new ur(s.type,this._map,s))}touchstart(s){return this._firePreventable(new hs(s.type,this._map,s))}touchmove(s){this._map.fire(new hs(s.type,this._map,s))}touchend(s){this._map.fire(new hs(s.type,this._map,s))}touchcancel(s){this._map.fire(new hs(s.type,this._map,s))}_firePreventable(s){if(this._map.fire(s),s.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class lu{constructor(s){this._map=s}reset(){this._delayContextMenu=!1,this._ignoreContextMenu=!0,delete this._contextMenuEvent}mousemove(s){this._map.fire(new ur(s.type,this._map,s))}mousedown(){this._delayContextMenu=!0,this._ignoreContextMenu=!1}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new ur("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(s){this._delayContextMenu?this._contextMenuEvent=s:this._ignoreContextMenu||this._map.fire(new ur(s.type,this._map,s)),this._map.listens("contextmenu")&&s.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class ps{constructor(s){this._map=s}get transform(){return this._map._requestedCameraState||this._map.transform}get center(){return{lng:this.transform.center.lng,lat:this.transform.center.lat}}get zoom(){return this.transform.zoom}get pitch(){return this.transform.pitch}get bearing(){return this.transform.bearing}unproject(s){return this.transform.pointLocation(u.P.convert(s),this._map.terrain)}}class np{constructor(s,p){this._map=s,this._tr=new ps(s),this._el=s.getCanvasContainer(),this._container=s.getContainer(),this._clickTolerance=p.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(s,p){this.isEnabled()&&s.shiftKey&&s.button===0&&(w.disableDrag(),this._startPos=this._lastPos=p,this._active=!0)}mousemoveWindow(s,p){if(!this._active)return;const d=p;if(this._lastPos.equals(d)||!this._box&&d.dist(this._startPos)<this._clickTolerance)return;const m=this._startPos;this._lastPos=d,this._box||(this._box=w.create("div","maplibregl-boxzoom",this._container),this._container.classList.add("maplibregl-crosshair"),this._fireEvent("boxzoomstart",s));const v=Math.min(m.x,d.x),S=Math.max(m.x,d.x),T=Math.min(m.y,d.y),N=Math.max(m.y,d.y);w.setTransform(this._box,`translate(${v}px,${T}px)`),this._box.style.width=S-v+"px",this._box.style.height=N-T+"px"}mouseupWindow(s,p){if(!this._active||s.button!==0)return;const d=this._startPos,m=p;if(this.reset(),w.suppressClick(),d.x!==m.x||d.y!==m.y)return this._map.fire(new u.k("boxzoomend",{originalEvent:s})),{cameraAnimation:v=>v.fitScreenCoordinates(d,m,this._tr.bearing,{linear:!0})};this._fireEvent("boxzoomcancel",s)}keydown(s){this._active&&s.keyCode===27&&(this.reset(),this._fireEvent("boxzoomcancel",s))}reset(){this._active=!1,this._container.classList.remove("maplibregl-crosshair"),this._box&&(w.remove(this._box),this._box=null),w.enableDrag(),delete this._startPos,delete this._lastPos}_fireEvent(s,p){return this._map.fire(new u.k(s,{originalEvent:p}))}}function lo(y,s){if(y.length!==s.length)throw new Error(`The number of touches and points are not equal - touches ${y.length}, points ${s.length}`);const p={};for(let d=0;d<y.length;d++)p[y[d].identifier]=s[d];return p}class $s{constructor(s){this.reset(),this.numTouches=s.numTouches}reset(){delete this.centroid,delete this.startTime,delete this.touches,this.aborted=!1}touchstart(s,p,d){(this.centroid||d.length>this.numTouches)&&(this.aborted=!0),this.aborted||(this.startTime===void 0&&(this.startTime=s.timeStamp),d.length===this.numTouches&&(this.centroid=function(m){const v=new u.P(0,0);for(const S of m)v._add(S);return v.div(m.length)}(p),this.touches=lo(d,p)))}touchmove(s,p,d){if(this.aborted||!this.centroid)return;const m=lo(d,p);for(const v in this.touches){const S=m[v];(!S||S.dist(this.touches[v])>30)&&(this.aborted=!0)}}touchend(s,p,d){if((!this.centroid||s.timeStamp-this.startTime>500)&&(this.aborted=!0),d.length===0){const m=!this.aborted&&this.centroid;if(this.reset(),m)return m}}}class rp{constructor(s){this.singleTap=new $s(s),this.numTaps=s.numTaps,this.reset()}reset(){this.lastTime=1/0,delete this.lastTap,this.count=0,this.singleTap.reset()}touchstart(s,p,d){this.singleTap.touchstart(s,p,d)}touchmove(s,p,d){this.singleTap.touchmove(s,p,d)}touchend(s,p,d){const m=this.singleTap.touchend(s,p,d);if(m){const v=s.timeStamp-this.lastTime<500,S=!this.lastTap||this.lastTap.dist(m)<30;if(v&&S||this.reset(),this.count++,this.lastTime=s.timeStamp,this.lastTap=m,this.count===this.numTaps)return this.reset(),m}}}class Fu{constructor(s){this._tr=new ps(s),this._zoomIn=new rp({numTouches:1,numTaps:2}),this._zoomOut=new rp({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(s,p,d){this._zoomIn.touchstart(s,p,d),this._zoomOut.touchstart(s,p,d)}touchmove(s,p,d){this._zoomIn.touchmove(s,p,d),this._zoomOut.touchmove(s,p,d)}touchend(s,p,d){const m=this._zoomIn.touchend(s,p,d),v=this._zoomOut.touchend(s,p,d),S=this._tr;return m?(this._active=!0,s.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:T=>T.easeTo({duration:300,zoom:S.zoom+1,around:S.unproject(m)},{originalEvent:s})}):v?(this._active=!0,s.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:T=>T.easeTo({duration:300,zoom:S.zoom-1,around:S.unproject(v)},{originalEvent:s})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class ku{constructor(s){this._enabled=!!s.enable,this._moveStateManager=s.moveStateManager,this._clickTolerance=s.clickTolerance||1,this._moveFunction=s.move,this._activateOnStart=!!s.activateOnStart,s.assignEvents(this),this.reset()}reset(s){this._active=!1,this._moved=!1,delete this._lastPoint,this._moveStateManager.endMove(s)}_move(...s){const p=this._moveFunction(...s);if(p.bearingDelta||p.pitchDelta||p.around||p.panDelta)return this._active=!0,p}dragStart(s,p){this.isEnabled()&&!this._lastPoint&&this._moveStateManager.isValidStartEvent(s)&&(this._moveStateManager.startMove(s),this._lastPoint=p.length?p[0]:p,this._activateOnStart&&this._lastPoint&&(this._active=!0))}dragMove(s,p){if(!this.isEnabled())return;const d=this._lastPoint;if(!d)return;if(s.preventDefault(),!this._moveStateManager.isValidMoveEvent(s))return void this.reset(s);const m=p.length?p[0]:p;return!this._moved&&m.dist(d)<this._clickTolerance?void 0:(this._moved=!0,this._lastPoint=m,this._move(d,m))}dragEnd(s){this.isEnabled()&&this._lastPoint&&this._moveStateManager.isValidEndEvent(s)&&(this._moved&&w.suppressClick(),this.reset(s))}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}getClickTolerance(){return this._clickTolerance}}const Er={0:1,2:2};class lr{constructor(s){this._correctEvent=s.checkCorrectEvent}startMove(s){const p=w.mouseButton(s);this._eventButton=p}endMove(s){delete this._eventButton}isValidStartEvent(s){return this._correctEvent(s)}isValidMoveEvent(s){return!function(p,d){const m=Er[d];return p.buttons===void 0||(p.buttons&m)!==m}(s,this._eventButton)}isValidEndEvent(s){return w.mouseButton(s)===this._eventButton}}class ip{constructor(){this._firstTouch=void 0}_isOneFingerTouch(s){return s.targetTouches.length===1}_isSameTouchEvent(s){return s.targetTouches[0].identifier===this._firstTouch}startMove(s){this._firstTouch=s.targetTouches[0].identifier}endMove(s){delete this._firstTouch}isValidStartEvent(s){return this._isOneFingerTouch(s)}isValidMoveEvent(s){return this._isOneFingerTouch(s)&&this._isSameTouchEvent(s)}isValidEndEvent(s){return this._isOneFingerTouch(s)&&this._isSameTouchEvent(s)}}const Ma=y=>{y.mousedown=y.dragStart,y.mousemoveWindow=y.dragMove,y.mouseup=y.dragEnd,y.contextmenu=function(s){s.preventDefault()}},Il=({enable:y,clickTolerance:s,bearingDegreesPerPixelMoved:p=.8})=>{const d=new lr({checkCorrectEvent:m=>w.mouseButton(m)===0&&m.ctrlKey||w.mouseButton(m)===2});return new ku({clickTolerance:s,move:(m,v)=>({bearingDelta:(v.x-m.x)*p}),moveStateManager:d,enable:y,assignEvents:Ma})},Ni=({enable:y,clickTolerance:s,pitchDegreesPerPixelMoved:p=-.5})=>{const d=new lr({checkCorrectEvent:m=>w.mouseButton(m)===0&&m.ctrlKey||w.mouseButton(m)===2});return new ku({clickTolerance:s,move:(m,v)=>({pitchDelta:(v.y-m.y)*p}),moveStateManager:d,enable:y,assignEvents:Ma})};class ve{constructor(s,p){this._minTouches=s.cooperativeGestures?2:1,this._clickTolerance=s.clickTolerance||1,this._map=p,this.reset()}reset(){this._active=!1,this._touches={},this._sum=new u.P(0,0),setTimeout(()=>{this._cancelCooperativeMessage=!1},200)}touchstart(s,p,d){return this._calculateTransform(s,p,d)}touchmove(s,p,d){if(this._map._cooperativeGestures&&(this._minTouches===2&&d.length<2&&!this._cancelCooperativeMessage?this._map._onCooperativeGesture(s,!1,d.length):this._cancelCooperativeMessage||(this._cancelCooperativeMessage=!0)),this._active&&!(d.length<this._minTouches))return s.preventDefault(),this._calculateTransform(s,p,d)}touchend(s,p,d){this._calculateTransform(s,p,d),this._active&&d.length<this._minTouches&&this.reset()}touchcancel(){this.reset()}_calculateTransform(s,p,d){d.length>0&&(this._active=!0);const m=lo(d,p),v=new u.P(0,0),S=new u.P(0,0);let T=0;for(const O in m){const F=m[O],k=this._touches[O];k&&(v._add(F),S._add(F.sub(k)),T++,m[O]=F)}if(this._touches=m,T<this._minTouches||!S.mag())return;const N=S.div(T);return this._sum._add(N),this._sum.mag()<this._clickTolerance?void 0:{around:v.div(T),panDelta:N}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Aa{constructor(){this.reset()}reset(){this._active=!1,delete this._firstTwoTouches}touchstart(s,p,d){this._firstTwoTouches||d.length<2||(this._firstTwoTouches=[d[0].identifier,d[1].identifier],this._start([p[0],p[1]]))}touchmove(s,p,d){if(!this._firstTwoTouches)return;s.preventDefault();const[m,v]=this._firstTwoTouches,S=aa(d,p,m),T=aa(d,p,v);if(!S||!T)return;const N=this._aroundCenter?null:S.add(T).div(2);return this._move([S,T],N,s)}touchend(s,p,d){if(!this._firstTwoTouches)return;const[m,v]=this._firstTwoTouches,S=aa(d,p,m),T=aa(d,p,v);S&&T||(this._active&&w.suppressClick(),this.reset())}touchcancel(){this.reset()}enable(s){this._enabled=!0,this._aroundCenter=!!s&&s.around==="center"}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}function aa(y,s,p){for(let d=0;d<y.length;d++)if(y[d].identifier===p)return s[d]}function zu(y,s){return Math.log(y/s)/Math.LN2}class wc extends Aa{reset(){super.reset(),delete this._distance,delete this._startDistance}_start(s){this._startDistance=this._distance=s[0].dist(s[1])}_move(s,p){const d=this._distance;if(this._distance=s[0].dist(s[1]),this._active||!(Math.abs(zu(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:zu(this._distance,d),pinchAround:p}}}function he(y,s){return 180*y.angleWith(s)/Math.PI}class mf extends Aa{reset(){super.reset(),delete this._minDiameter,delete this._startVector,delete this._vector}_start(s){this._startVector=this._vector=s[0].sub(s[1]),this._minDiameter=s[0].dist(s[1])}_move(s,p){const d=this._vector;if(this._vector=s[0].sub(s[1]),this._active||!this._isBelowThreshold(this._vector))return this._active=!0,{bearingDelta:he(this._vector,d),pinchAround:p}}_isBelowThreshold(s){this._minDiameter=Math.min(this._minDiameter,s.mag());const p=25/(Math.PI*this._minDiameter)*360,d=he(s,this._startVector);return Math.abs(d)<p}}function hh(y){return Math.abs(y.y)>Math.abs(y.x)}class yd extends Aa{constructor(s){super(),this._map=s}reset(){super.reset(),this._valid=void 0,delete this._firstMove,delete this._lastPoints}touchstart(s,p,d){super.touchstart(s,p,d),this._currentTouchCount=d.length}_start(s){this._lastPoints=s,hh(s[0].sub(s[1]))&&(this._valid=!1)}_move(s,p,d){if(this._map._cooperativeGestures&&this._currentTouchCount<3)return;const m=s[0].sub(this._lastPoints[0]),v=s[1].sub(this._lastPoints[1]);return this._valid=this.gestureBeginsVertically(m,v,d.timeStamp),this._valid?(this._lastPoints=s,this._active=!0,{pitchDelta:(m.y+v.y)/2*-.5}):void 0}gestureBeginsVertically(s,p,d){if(this._valid!==void 0)return this._valid;const m=s.mag()>=2,v=p.mag()>=2;if(!m&&!v)return;if(!m||!v)return this._firstMove===void 0&&(this._firstMove=d),d-this._firstMove<100&&void 0;const S=s.y>0==p.y>0;return hh(s)&&hh(p)&&S}}const ph={panStep:100,bearingStep:15,pitchStep:10};class op{constructor(s){this._tr=new ps(s);const p=ph;this._panStep=p.panStep,this._bearingStep=p.bearingStep,this._pitchStep=p.pitchStep,this._rotationDisabled=!1}reset(){this._active=!1}keydown(s){if(s.altKey||s.ctrlKey||s.metaKey)return;let p=0,d=0,m=0,v=0,S=0;switch(s.keyCode){case 61:case 107:case 171:case 187:p=1;break;case 189:case 109:case 173:p=-1;break;case 37:s.shiftKey?d=-1:(s.preventDefault(),v=-1);break;case 39:s.shiftKey?d=1:(s.preventDefault(),v=1);break;case 38:s.shiftKey?m=1:(s.preventDefault(),S=-1);break;case 40:s.shiftKey?m=-1:(s.preventDefault(),S=1);break;default:return}return this._rotationDisabled&&(d=0,m=0),{cameraAnimation:T=>{const N=this._tr;T.easeTo({duration:300,easeId:"keyboardHandler",easing:_d,zoom:p?Math.round(N.zoom)+p*(s.shiftKey?2:1):N.zoom,bearing:N.bearing+d*this._bearingStep,pitch:N.pitch+m*this._pitchStep,offset:[-v*this._panStep,-S*this._panStep],center:N.center},{originalEvent:s})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function _d(y){return y*(2-y)}const sp=4.000244140625;class yf{constructor(s,p){this._onTimeout=d=>{this._type="wheel",this._delta-=this._lastValue,this._active||this._start(d)},this._map=s,this._tr=new ps(s),this._el=s.getCanvasContainer(),this._triggerRenderFrame=p,this._delta=0,this._defaultZoomRate=.01,this._wheelZoomRate=.0022222222222222222}setZoomRate(s){this._defaultZoomRate=s}setWheelZoomRate(s){this._wheelZoomRate=s}isEnabled(){return!!this._enabled}isActive(){return!!this._active||this._finishTimeout!==void 0}isZooming(){return!!this._zooming}enable(s){this.isEnabled()||(this._enabled=!0,this._aroundCenter=!!s&&s.around==="center")}disable(){this.isEnabled()&&(this._enabled=!1)}wheel(s){if(!this.isEnabled())return;if(this._map._cooperativeGestures){if(!s[this._map._metaKey])return;s.preventDefault()}let p=s.deltaMode===WheelEvent.DOM_DELTA_LINE?40*s.deltaY:s.deltaY;const d=u.h.now(),m=d-(this._lastWheelEventTime||0);this._lastWheelEventTime=d,p!==0&&p%sp==0?this._type="wheel":p!==0&&Math.abs(p)<4?this._type="trackpad":m>400?(this._type=null,this._lastValue=p,this._timeout=setTimeout(this._onTimeout,40,s)):this._type||(this._type=Math.abs(m*p)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,p+=this._lastValue)),s.shiftKey&&p&&(p/=4),this._type&&(this._lastWheelEvent=s,this._delta-=p,this._active||this._start(s)),s.preventDefault()}_start(s){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);const p=w.mousePos(this._el,s),d=this._tr;this._around=u.L.convert(this._aroundCenter?d.center:d.unproject(p)),this._aroundPoint=d.transform.locationPoint(this._around),this._frameId||(this._frameId=!0,this._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;const s=this._tr.transform;if(this._delta!==0){const T=this._type==="wheel"&&Math.abs(this._delta)>sp?this._wheelZoomRate:this._defaultZoomRate;let N=2/(1+Math.exp(-Math.abs(this._delta*T)));this._delta<0&&N!==0&&(N=1/N);const O=typeof this._targetZoom=="number"?s.zoomScale(this._targetZoom):s.scale;this._targetZoom=Math.min(s.maxZoom,Math.max(s.minZoom,s.scaleZoom(O*N))),this._type==="wheel"&&(this._startZoom=s.zoom,this._easing=this._smoothOutEasing(200)),this._delta=0}const p=typeof this._targetZoom=="number"?this._targetZoom:s.zoom,d=this._startZoom,m=this._easing;let v,S=!1;if(this._type==="wheel"&&d&&m){const T=Math.min((u.h.now()-this._lastWheelEventTime)/200,1),N=m(T);v=u.B.number(d,p,N),T<1?this._frameId||(this._frameId=!0):S=!0}else v=p,S=!0;return this._active=!0,S&&(this._active=!1,this._finishTimeout=setTimeout(()=>{this._zooming=!1,this._triggerRenderFrame(),delete this._targetZoom,delete this._finishTimeout},200)),{noInertia:!0,needsRenderFrame:!S,zoomDelta:v-s.zoom,around:this._aroundPoint,originalEvent:this._lastWheelEvent}}_smoothOutEasing(s){let p=u.bb;if(this._prevEase){const d=this._prevEase,m=(u.h.now()-d.start)/d.duration,v=d.easing(m+.01)-d.easing(m),S=.27/Math.sqrt(v*v+1e-4)*.01,T=Math.sqrt(.0729-S*S);p=u.ba(S,T,.25,1)}return this._prevEase={start:u.h.now(),duration:s,easing:p},p}reset(){this._active=!1,this._zooming=!1,delete this._targetZoom,this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout)}}class Ym{constructor(s,p){this._clickZoom=s,this._tapZoom=p}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class Zm{constructor(s){this._tr=new ps(s),this.reset()}reset(){this._active=!1}dblclick(s,p){return s.preventDefault(),{cameraAnimation:d=>{d.easeTo({duration:300,zoom:this._tr.zoom+(s.shiftKey?-1:1),around:this._tr.unproject(p)},{originalEvent:s})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Hm{constructor(){this._tap=new rp({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,delete this._swipePoint,delete this._swipeTouch,delete this._tapTime,delete this._tapPoint,this._tap.reset()}touchstart(s,p,d){if(!this._swipePoint)if(this._tapTime){const m=p[0],v=s.timeStamp-this._tapTime<500,S=this._tapPoint.dist(m)<30;v&&S?d.length>0&&(this._swipePoint=m,this._swipeTouch=d[0].identifier):this.reset()}else this._tap.touchstart(s,p,d)}touchmove(s,p,d){if(this._tapTime){if(this._swipePoint){if(d[0].identifier!==this._swipeTouch)return;const m=p[0],v=m.y-this._swipePoint.y;return this._swipePoint=m,s.preventDefault(),this._active=!0,{zoomDelta:v/128}}}else this._tap.touchmove(s,p,d)}touchend(s,p,d){if(this._tapTime)this._swipePoint&&d.length===0&&this.reset();else{const m=this._tap.touchend(s,p,d);m&&(this._tapTime=s.timeStamp,this._tapPoint=m)}}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Wm{constructor(s,p,d){this._el=s,this._mousePan=p,this._touchPan=d}enable(s){this._inertiaOptions=s||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("maplibregl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("maplibregl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class ua{constructor(s,p,d){this._pitchWithRotate=s.pitchWithRotate,this._mouseRotate=p,this._mousePitch=d}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()}}class fh{constructor(s,p,d,m){this._el=s,this._touchZoom=p,this._touchRotate=d,this._tapDragZoom=m,this._rotationDisabled=!1,this._enabled=!0}enable(s){this._touchZoom.enable(s),this._rotationDisabled||this._touchRotate.enable(s),this._tapDragZoom.enable(),this._el.classList.add("maplibregl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("maplibregl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}const vd=y=>y.zoom||y.drag||y.pitch||y.rotate;class Jm extends u.k{}function xd(y){return y.panDelta&&y.panDelta.mag()||y.zoomDelta||y.bearingDelta||y.pitchDelta}class Km{constructor(s,p){this.handleWindowEvent=m=>{this.handleEvent(m,`${m.type}Window`)},this.handleEvent=(m,v)=>{if(m.type==="blur")return void this.stop(!0);this._updatingCamera=!0;const S=m.type==="renderFrame"?void 0:m,T={needsRenderFrame:!1},N={},O={},F=m.touches,k=F?this._getMapTouches(F):void 0,j=k?w.touchPos(this._el,k):w.mousePos(this._el,m);for(const{handlerName:st,handler:K,allowed:xt}of this._handlers){if(!K.isEnabled())continue;let Nt;this._blockedByActive(O,xt,st)?K.reset():K[v||m.type]&&(Nt=K[v||m.type](m,j,k),this.mergeHandlerResult(T,N,Nt,st,S),Nt&&Nt.needsRenderFrame&&this._triggerRenderFrame()),(Nt||K.isActive())&&(O[st]=K)}const tt={};for(const st in this._previousActiveHandlers)O[st]||(tt[st]=S);this._previousActiveHandlers=O,(Object.keys(tt).length||xd(T))&&(this._changes.push([T,N,tt]),this._triggerRenderFrame()),(Object.keys(O).length||xd(T))&&this._map._stop(!0),this._updatingCamera=!1;const{cameraAnimation:et}=T;et&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],et(this._map))},this._map=s,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new di(s),this._bearingSnap=p.bearingSnap,this._previousActiveHandlers={},this._eventsInProgress={},this._addDefaultHandlers(p);const d=this._el;this._listeners=[[d,"touchstart",{passive:!0}],[d,"touchmove",{passive:!1}],[d,"touchend",void 0],[d,"touchcancel",void 0],[d,"mousedown",void 0],[d,"mousemove",void 0],[d,"mouseup",void 0],[document,"mousemove",{capture:!0}],[document,"mouseup",void 0],[d,"mouseover",void 0],[d,"mouseout",void 0],[d,"dblclick",void 0],[d,"click",void 0],[d,"keydown",{capture:!1}],[d,"keyup",void 0],[d,"wheel",{passive:!1}],[d,"contextmenu",void 0],[window,"blur",void 0]];for(const[m,v,S]of this._listeners)w.addEventListener(m,v,m===document?this.handleWindowEvent:this.handleEvent,S)}destroy(){for(const[s,p,d]of this._listeners)w.removeEventListener(s,p,s===document?this.handleWindowEvent:this.handleEvent,d)}_addDefaultHandlers(s){const p=this._map,d=p.getCanvasContainer();this._add("mapEvent",new No(p,s));const m=p.boxZoom=new np(p,s);this._add("boxZoom",m),s.interactive&&s.boxZoom&&m.enable();const v=new Fu(p),S=new Zm(p);p.doubleClickZoom=new Ym(S,v),this._add("tapZoom",v),this._add("clickZoom",S),s.interactive&&s.doubleClickZoom&&p.doubleClickZoom.enable();const T=new Hm;this._add("tapDragZoom",T);const N=p.touchPitch=new yd(p);this._add("touchPitch",N),s.interactive&&s.touchPitch&&p.touchPitch.enable(s.touchPitch);const O=Il(s),F=Ni(s);p.dragRotate=new ua(s,O,F),this._add("mouseRotate",O,["mousePitch"]),this._add("mousePitch",F,["mouseRotate"]),s.interactive&&s.dragRotate&&p.dragRotate.enable();const k=(({enable:xt,clickTolerance:Nt})=>{const lt=new lr({checkCorrectEvent:wt=>w.mouseButton(wt)===0&&!wt.ctrlKey});return new ku({clickTolerance:Nt,move:(wt,Ft)=>({around:Ft,panDelta:Ft.sub(wt)}),activateOnStart:!0,moveStateManager:lt,enable:xt,assignEvents:Ma})})(s),j=new ve(s,p);p.dragPan=new Wm(d,k,j),this._add("mousePan",k),this._add("touchPan",j,["touchZoom","touchRotate"]),s.interactive&&s.dragPan&&p.dragPan.enable(s.dragPan);const tt=new mf,et=new wc;p.touchZoomRotate=new fh(d,et,tt,T),this._add("touchRotate",tt,["touchPan","touchZoom"]),this._add("touchZoom",et,["touchPan","touchRotate"]),s.interactive&&s.touchZoomRotate&&p.touchZoomRotate.enable(s.touchZoomRotate);const st=p.scrollZoom=new yf(p,()=>this._triggerRenderFrame());this._add("scrollZoom",st,["mousePan"]),s.interactive&&s.scrollZoom&&p.scrollZoom.enable(s.scrollZoom);const K=p.keyboard=new op(p);this._add("keyboard",K),s.interactive&&s.keyboard&&p.keyboard.enable(),this._add("blockableMapEvent",new lu(p))}_add(s,p,d){this._handlers.push({handlerName:s,handler:p,allowed:d}),this._handlersById[s]=p}stop(s){if(!this._updatingCamera){for(const{handler:p}of this._handlers)p.reset();this._inertia.clear(),this._fireEvents({},{},s),this._changes=[]}}isActive(){for(const{handler:s}of this._handlers)if(s.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return!!vd(this._eventsInProgress)||this.isZooming()}_blockedByActive(s,p,d){for(const m in s)if(m!==d&&(!p||p.indexOf(m)<0))return!0;return!1}_getMapTouches(s){const p=[];for(const d of s)this._el.contains(d.target)&&p.push(d);return p}mergeHandlerResult(s,p,d,m,v){if(!d)return;u.e(s,d);const S={handlerName:m,originalEvent:d.originalEvent||v};d.zoomDelta!==void 0&&(p.zoom=S),d.panDelta!==void 0&&(p.drag=S),d.pitchDelta!==void 0&&(p.pitch=S),d.bearingDelta!==void 0&&(p.rotate=S)}_applyChanges(){const s={},p={},d={};for(const[m,v,S]of this._changes)m.panDelta&&(s.panDelta=(s.panDelta||new u.P(0,0))._add(m.panDelta)),m.zoomDelta&&(s.zoomDelta=(s.zoomDelta||0)+m.zoomDelta),m.bearingDelta&&(s.bearingDelta=(s.bearingDelta||0)+m.bearingDelta),m.pitchDelta&&(s.pitchDelta=(s.pitchDelta||0)+m.pitchDelta),m.around!==void 0&&(s.around=m.around),m.pinchAround!==void 0&&(s.pinchAround=m.pinchAround),m.noInertia&&(s.noInertia=m.noInertia),u.e(p,v),u.e(d,S);this._updateMapTransform(s,p,d),this._changes=[]}_updateMapTransform(s,p,d){const m=this._map,v=m._getTransformForUpdate(),S=m.terrain;if(!(xd(s)||S&&this._terrainMovement))return this._fireEvents(p,d,!0);let{panDelta:T,zoomDelta:N,bearingDelta:O,pitchDelta:F,around:k,pinchAround:j}=s;j!==void 0&&(k=j),m._stop(!0),k=k||m.transform.centerPoint;const tt=v.pointLocation(T?k.sub(T):k);O&&(v.bearing+=O),F&&(v.pitch+=F),N&&(v.zoom+=N),S?this._terrainMovement||!p.drag&&!p.zoom?p.drag&&this._terrainMovement?v.center=v.pointLocation(v.centerPoint.sub(T)):v.setLocationAtPoint(tt,k):(this._terrainMovement=!0,this._map._elevationFreeze=!0,v.setLocationAtPoint(tt,k),this._map.once("moveend",()=>{this._map._elevationFreeze=!1,this._terrainMovement=!1,v.recalculateZoom(m.terrain)})):v.setLocationAtPoint(tt,k),m._applyUpdatedTransform(v),this._map._update(),s.noInertia||this._inertia.record(s),this._fireEvents(p,d,!0)}_fireEvents(s,p,d){const m=vd(this._eventsInProgress),v=vd(s),S={};for(const F in s){const{originalEvent:k}=s[F];this._eventsInProgress[F]||(S[`${F}start`]=k),this._eventsInProgress[F]=s[F]}!m&&v&&this._fireEvent("movestart",v.originalEvent);for(const F in S)this._fireEvent(F,S[F]);v&&this._fireEvent("move",v.originalEvent);for(const F in s){const{originalEvent:k}=s[F];this._fireEvent(F,k)}const T={};let N;for(const F in this._eventsInProgress){const{handlerName:k,originalEvent:j}=this._eventsInProgress[F];this._handlersById[k].isActive()||(delete this._eventsInProgress[F],N=p[k]||j,T[`${F}end`]=N)}for(const F in T)this._fireEvent(F,T[F]);const O=vd(this._eventsInProgress);if(d&&(m||v)&&!O){this._updatingCamera=!0;const F=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),k=j=>j!==0&&-this._bearingSnap<j&&j<this._bearingSnap;!F||!F.essential&&u.h.prefersReducedMotion?(this._map.fire(new u.k("moveend",{originalEvent:N})),k(this._map.getBearing())&&this._map.resetNorth()):(k(F.bearing||this._map.getBearing())&&(F.bearing=0),F.freezeElevation=!0,this._map.easeTo(F,{originalEvent:N})),this._updatingCamera=!1}}_fireEvent(s,p){this._map.fire(new u.k(s,p?{originalEvent:p}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add(s=>{delete this._frameId,this.handleEvent(new Jm("renderFrame",{timeStamp:s})),this._applyChanges()})}_triggerRenderFrame(){this._frameId===void 0&&(this._frameId=this._requestFrame())}}class k_ extends u.E{constructor(s,p){super(),this._renderFrameCallback=()=>{const d=Math.min((u.h.now()-this._easeStart)/this._easeOptions.duration,1);this._onEaseFrame(this._easeOptions.easing(d)),d<1&&this._easeFrameId?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()},this._moving=!1,this._zooming=!1,this.transform=s,this._bearingSnap=p.bearingSnap,this.on("moveend",()=>{delete this._requestedCameraState})}getCenter(){return new u.L(this.transform.center.lng,this.transform.center.lat)}setCenter(s,p){return this.jumpTo({center:s},p)}panBy(s,p,d){return s=u.P.convert(s).mult(-1),this.panTo(this.transform.center,u.e({offset:s},p),d)}panTo(s,p,d){return this.easeTo(u.e({center:s},p),d)}getZoom(){return this.transform.zoom}setZoom(s,p){return this.jumpTo({zoom:s},p),this}zoomTo(s,p,d){return this.easeTo(u.e({zoom:s},p),d)}zoomIn(s,p){return this.zoomTo(this.getZoom()+1,s,p),this}zoomOut(s,p){return this.zoomTo(this.getZoom()-1,s,p),this}getBearing(){return this.transform.bearing}setBearing(s,p){return this.jumpTo({bearing:s},p),this}getPadding(){return this.transform.padding}setPadding(s,p){return this.jumpTo({padding:s},p),this}rotateTo(s,p,d){return this.easeTo(u.e({bearing:s},p),d)}resetNorth(s,p){return this.rotateTo(0,u.e({duration:1e3},s),p),this}resetNorthPitch(s,p){return this.easeTo(u.e({bearing:0,pitch:0,duration:1e3},s),p),this}snapToNorth(s,p){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(s,p):this}getPitch(){return this.transform.pitch}setPitch(s,p){return this.jumpTo({pitch:s},p),this}cameraForBounds(s,p){s=Fe.convert(s);const d=p&&p.bearing||0;return this._cameraForBoxAndBearing(s.getNorthWest(),s.getSouthEast(),d,p)}_cameraForBoxAndBearing(s,p,d,m){const v={top:0,bottom:0,right:0,left:0};if(typeof(m=u.e({padding:v,offset:[0,0],maxZoom:this.transform.maxZoom},m)).padding=="number"){const Ft=m.padding;m.padding={top:Ft,bottom:Ft,right:Ft,left:Ft}}m.padding=u.e(v,m.padding);const S=this.transform,T=S.padding,N=S.project(u.L.convert(s)),O=S.project(u.L.convert(p)),F=N.rotate(-d*Math.PI/180),k=O.rotate(-d*Math.PI/180),j=new u.P(Math.max(F.x,k.x),Math.max(F.y,k.y)),tt=new u.P(Math.min(F.x,k.x),Math.min(F.y,k.y)),et=j.sub(tt),st=(S.width-(T.left+T.right+m.padding.left+m.padding.right))/et.x,K=(S.height-(T.top+T.bottom+m.padding.top+m.padding.bottom))/et.y;if(K<0||st<0)return void u.w("Map cannot fit within canvas with the given bounds, padding, and/or offset.");const xt=Math.min(S.scaleZoom(S.scale*Math.min(st,K)),m.maxZoom),Nt=u.P.convert(m.offset),lt=new u.P((m.padding.left-m.padding.right)/2,(m.padding.top-m.padding.bottom)/2).rotate(d*Math.PI/180),wt=Nt.add(lt).mult(S.scale/S.zoomScale(xt));return{center:S.unproject(N.add(O).div(2).sub(wt)),zoom:xt,bearing:d}}fitBounds(s,p,d){return this._fitInternal(this.cameraForBounds(s,p),p,d)}fitScreenCoordinates(s,p,d,m,v){return this._fitInternal(this._cameraForBoxAndBearing(this.transform.pointLocation(u.P.convert(s)),this.transform.pointLocation(u.P.convert(p)),d,m),m,v)}_fitInternal(s,p,d){return s?(delete(p=u.e(s,p)).padding,p.linear?this.easeTo(p,d):this.flyTo(p,d)):this}jumpTo(s,p){this.stop();const d=this._getTransformForUpdate();let m=!1,v=!1,S=!1;return"zoom"in s&&d.zoom!==+s.zoom&&(m=!0,d.zoom=+s.zoom),s.center!==void 0&&(d.center=u.L.convert(s.center)),"bearing"in s&&d.bearing!==+s.bearing&&(v=!0,d.bearing=+s.bearing),"pitch"in s&&d.pitch!==+s.pitch&&(S=!0,d.pitch=+s.pitch),s.padding==null||d.isPaddingEqual(s.padding)||(d.padding=s.padding),this._applyUpdatedTransform(d),this.fire(new u.k("movestart",p)).fire(new u.k("move",p)),m&&this.fire(new u.k("zoomstart",p)).fire(new u.k("zoom",p)).fire(new u.k("zoomend",p)),v&&this.fire(new u.k("rotatestart",p)).fire(new u.k("rotate",p)).fire(new u.k("rotateend",p)),S&&this.fire(new u.k("pitchstart",p)).fire(new u.k("pitch",p)).fire(new u.k("pitchend",p)),this.fire(new u.k("moveend",p))}calculateCameraOptionsFromTo(s,p,d,m=0){const v=u.U.fromLngLat(s,p),S=u.U.fromLngLat(d,m),T=S.x-v.x,N=S.y-v.y,O=S.z-v.z,F=Math.hypot(T,N,O);if(F===0)throw new Error("Can't calculate camera options with same From and To");const k=Math.hypot(T,N),j=this.transform.scaleZoom(this.transform.cameraToCenterDistance/F/this.transform.tileSize),tt=180*Math.atan2(T,-N)/Math.PI;let et=180*Math.acos(k/F)/Math.PI;return et=O<0?90-et:90+et,{center:S.toLngLat(),zoom:j,pitch:et,bearing:tt}}easeTo(s,p){this._stop(!1,s.easeId),((s=u.e({offset:[0,0],duration:500,easing:u.bb},s)).animate===!1||!s.essential&&u.h.prefersReducedMotion)&&(s.duration=0);const d=this._getTransformForUpdate(),m=this.getZoom(),v=this.getBearing(),S=this.getPitch(),T=this.getPadding(),N="zoom"in s?+s.zoom:m,O="bearing"in s?this._normalizeBearing(s.bearing,v):v,F="pitch"in s?+s.pitch:S,k="padding"in s?s.padding:d.padding,j=u.P.convert(s.offset);let tt=d.centerPoint.add(j);const et=d.pointLocation(tt),st=u.L.convert(s.center||et);this._normalizeCenter(st);const K=d.project(et),xt=d.project(st).sub(K),Nt=d.zoomScale(N-m);let lt,wt;s.around&&(lt=u.L.convert(s.around),wt=d.locationPoint(lt));const Ft={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=this._zooming||N!==m,this._rotating=this._rotating||v!==O,this._pitching=this._pitching||F!==S,this._padding=!d.isPaddingEqual(k),this._easeId=s.easeId,this._prepareEase(p,s.noMoveStart,Ft),this.terrain&&this._prepareElevation(st),this._ease(kt=>{if(this._zooming&&(d.zoom=u.B.number(m,N,kt)),this._rotating&&(d.bearing=u.B.number(v,O,kt)),this._pitching&&(d.pitch=u.B.number(S,F,kt)),this._padding&&(d.interpolatePadding(T,k,kt),tt=d.centerPoint.add(j)),this.terrain&&!s.freezeElevation&&this._updateElevation(kt),lt)d.setLocationAtPoint(lt,wt);else{const Zt=d.zoomScale(d.zoom-m),ee=N>m?Math.min(2,Nt):Math.max(.5,Nt),Jt=Math.pow(ee,1-kt),ue=d.unproject(K.add(xt.mult(kt*Jt)).mult(Zt));d.setLocationAtPoint(d.renderWorldCopies?ue.wrap():ue,tt)}this._applyUpdatedTransform(d),this._fireMoveEvents(p)},kt=>{this.terrain&&this._finalizeElevation(),this._afterEase(p,kt)},s),this}_prepareEase(s,p,d={}){this._moving=!0,p||d.moving||this.fire(new u.k("movestart",s)),this._zooming&&!d.zooming&&this.fire(new u.k("zoomstart",s)),this._rotating&&!d.rotating&&this.fire(new u.k("rotatestart",s)),this._pitching&&!d.pitching&&this.fire(new u.k("pitchstart",s))}_prepareElevation(s){this._elevationCenter=s,this._elevationStart=this.transform.elevation,this._elevationTarget=this.terrain.getElevationForLngLatZoom(s,this.transform.tileZoom),this._elevationFreeze=!0}_updateElevation(s){this.transform._minEleveationForCurrentTile=this.terrain.getMinTileElevationForLngLatZoom(this._elevationCenter,this.transform.tileZoom);const p=this.terrain.getElevationForLngLatZoom(this._elevationCenter,this.transform.tileZoom);if(s<1&&p!==this._elevationTarget){const d=this._elevationTarget-this._elevationStart;this._elevationStart+=s*(d-(p-(d*s+this._elevationStart))/(1-s)),this._elevationTarget=p}this.transform.elevation=u.B.number(this._elevationStart,this._elevationTarget,s)}_finalizeElevation(){this._elevationFreeze=!1,this.transform.recalculateZoom(this.terrain)}_getTransformForUpdate(){return this.transformCameraUpdate?(this._requestedCameraState||(this._requestedCameraState=this.transform.clone()),this._requestedCameraState):this.transform}_applyUpdatedTransform(s){if(!this.transformCameraUpdate)return;const p=s.clone(),{center:d,zoom:m,pitch:v,bearing:S,elevation:T}=this.transformCameraUpdate(p);d&&(p.center=d),m!==void 0&&(p.zoom=m),v!==void 0&&(p.pitch=v),S!==void 0&&(p.bearing=S),T!==void 0&&(p.elevation=T),this.transform.apply(p)}_fireMoveEvents(s){this.fire(new u.k("move",s)),this._zooming&&this.fire(new u.k("zoom",s)),this._rotating&&this.fire(new u.k("rotate",s)),this._pitching&&this.fire(new u.k("pitch",s))}_afterEase(s,p){if(this._easeId&&p&&this._easeId===p)return;delete this._easeId;const d=this._zooming,m=this._rotating,v=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,d&&this.fire(new u.k("zoomend",s)),m&&this.fire(new u.k("rotateend",s)),v&&this.fire(new u.k("pitchend",s)),this.fire(new u.k("moveend",s))}flyTo(s,p){if(!s.essential&&u.h.prefersReducedMotion){const De=u.F(s,["center","zoom","bearing","pitch","around"]);return this.jumpTo(De,p)}this.stop(),s=u.e({offset:[0,0],speed:1.2,curve:1.42,easing:u.bb},s);const d=this._getTransformForUpdate(),m=this.getZoom(),v=this.getBearing(),S=this.getPitch(),T=this.getPadding(),N="zoom"in s?u.ad(+s.zoom,d.minZoom,d.maxZoom):m,O="bearing"in s?this._normalizeBearing(s.bearing,v):v,F="pitch"in s?+s.pitch:S,k="padding"in s?s.padding:d.padding,j=d.zoomScale(N-m),tt=u.P.convert(s.offset);let et=d.centerPoint.add(tt);const st=d.pointLocation(et),K=u.L.convert(s.center||st);this._normalizeCenter(K);const xt=d.project(st),Nt=d.project(K).sub(xt);let lt=s.curve;const wt=Math.max(d.width,d.height),Ft=wt/j,kt=Nt.mag();if("minZoom"in s){const De=u.ad(Math.min(s.minZoom,m,N),d.minZoom,d.maxZoom),_r=wt/d.zoomScale(De-m);lt=Math.sqrt(_r/kt*2)}const Zt=lt*lt;function ee(De){const _r=(Ft*Ft-wt*wt+(De?-1:1)*Zt*Zt*kt*kt)/(2*(De?Ft:wt)*Zt*kt);return Math.log(Math.sqrt(_r*_r+1)-_r)}function Jt(De){return(Math.exp(De)-Math.exp(-De))/2}function ue(De){return(Math.exp(De)+Math.exp(-De))/2}const Me=ee(!1);let Nn=function(De){return ue(Me)/ue(Me+lt*De)},ye=function(De){return wt*((ue(Me)*(Jt(_r=Me+lt*De)/ue(_r))-Jt(Me))/Zt)/kt;var _r},He=(ee(!0)-Me)/lt;if(Math.abs(kt)<1e-6||!isFinite(He)){if(Math.abs(wt-Ft)<1e-6)return this.easeTo(s,p);const De=Ft<wt?-1:1;He=Math.abs(Math.log(Ft/wt))/lt,ye=function(){return 0},Nn=function(_r){return Math.exp(De*lt*_r)}}return s.duration="duration"in s?+s.duration:1e3*He/("screenSpeed"in s?+s.screenSpeed/lt:+s.speed),s.maxDuration&&s.duration>s.maxDuration&&(s.duration=0),this._zooming=!0,this._rotating=v!==O,this._pitching=F!==S,this._padding=!d.isPaddingEqual(k),this._prepareEase(p,!1),this.terrain&&this._prepareElevation(K),this._ease(De=>{const _r=De*He,Tn=1/Nn(_r);d.zoom=De===1?N:m+d.scaleZoom(Tn),this._rotating&&(d.bearing=u.B.number(v,O,De)),this._pitching&&(d.pitch=u.B.number(S,F,De)),this._padding&&(d.interpolatePadding(T,k,De),et=d.centerPoint.add(tt)),this.terrain&&!s.freezeElevation&&this._updateElevation(De);const _n=De===1?K:d.unproject(xt.add(Nt.mult(ye(_r))).mult(Tn));d.setLocationAtPoint(d.renderWorldCopies?_n.wrap():_n,et),this._applyUpdatedTransform(d),this._fireMoveEvents(p)},()=>{this.terrain&&this._finalizeElevation(),this._afterEase(p)},s),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_stop(s,p){if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),delete this._easeFrameId,delete this._onEaseFrame),this._onEaseEnd){const d=this._onEaseEnd;delete this._onEaseEnd,d.call(this,p)}if(!s){const d=this.handlers;d&&d.stop(!1)}return this}_ease(s,p,d){d.animate===!1||d.duration===0?(s(1),p()):(this._easeStart=u.h.now(),this._easeOptions=d,this._onEaseFrame=s,this._onEaseEnd=p,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_normalizeBearing(s,p){s=u.b5(s,-180,180);const d=Math.abs(s-p);return Math.abs(s-360-p)<d&&(s-=360),Math.abs(s+360-p)<d&&(s+=360),s}_normalizeCenter(s){const p=this.transform;if(!p.renderWorldCopies||p.lngRange)return;const d=s.lng-p.center.lng;s.lng+=d>180?-360:d<-180?360:0}queryTerrainElevation(s){return this.terrain?this.terrain.getElevationForLngLatZoom(u.L.convert(s),this.transform.tileZoom)-this.transform.elevation:null}}class Da{constructor(s={}){this._toggleAttribution=()=>{this._container.classList.contains("maplibregl-compact")&&(this._container.classList.contains("maplibregl-compact-show")?(this._container.setAttribute("open",""),this._container.classList.remove("maplibregl-compact-show")):(this._container.classList.add("maplibregl-compact-show"),this._container.removeAttribute("open")))},this._updateData=p=>{!p||p.sourceDataType!=="metadata"&&p.sourceDataType!=="visibility"&&p.dataType!=="style"&&p.type!=="terrain"||this._updateAttributions()},this._updateCompact=()=>{this._map.getCanvasContainer().offsetWidth<=640||this._compact?this._compact===!1?this._container.setAttribute("open",""):this._container.classList.contains("maplibregl-compact")||this._container.classList.contains("maplibregl-attrib-empty")||(this._container.setAttribute("open",""),this._container.classList.add("maplibregl-compact","maplibregl-compact-show")):(this._container.setAttribute("open",""),this._container.classList.contains("maplibregl-compact")&&this._container.classList.remove("maplibregl-compact","maplibregl-compact-show"))},this._updateCompactMinimize=()=>{this._container.classList.contains("maplibregl-compact")&&this._container.classList.contains("maplibregl-compact-show")&&this._container.classList.remove("maplibregl-compact-show")},this.options=s}getDefaultPosition(){return"bottom-right"}onAdd(s){return this._map=s,this._compact=this.options&&this.options.compact,this._container=w.create("details","maplibregl-ctrl maplibregl-ctrl-attrib"),this._compactButton=w.create("summary","maplibregl-ctrl-attrib-button",this._container),this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=w.create("div","maplibregl-ctrl-attrib-inner",this._container),this._updateAttributions(),this._updateCompact(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("terrain",this._updateData),this._map.on("resize",this._updateCompact),this._map.on("drag",this._updateCompactMinimize),this._container}onRemove(){w.remove(this._container),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("terrain",this._updateData),this._map.off("resize",this._updateCompact),this._map.off("drag",this._updateCompactMinimize),this._map=void 0,this._compact=void 0,this._attribHTML=void 0}_setElementTitle(s,p){const d=this._map._getUIString(`AttributionControl.${p}`);s.title=d,s.setAttribute("aria-label",d)}_updateAttributions(){if(!this._map.style)return;let s=[];if(this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?s=s.concat(this.options.customAttribution.map(m=>typeof m!="string"?"":m)):typeof this.options.customAttribution=="string"&&s.push(this.options.customAttribution)),this._map.style.stylesheet){const m=this._map.style.stylesheet;this.styleOwner=m.owner,this.styleId=m.id}const p=this._map.style.sourceCaches;for(const m in p){const v=p[m];if(v.used||v.usedForTerrain){const S=v.getSource();S.attribution&&s.indexOf(S.attribution)<0&&s.push(S.attribution)}}s=s.filter(m=>String(m).trim()),s.sort((m,v)=>m.length-v.length),s=s.filter((m,v)=>{for(let S=v+1;S<s.length;S++)if(s[S].indexOf(m)>=0)return!1;return!0});const d=s.join(" | ");d!==this._attribHTML&&(this._attribHTML=d,s.length?(this._innerContainer.innerHTML=d,this._container.classList.remove("maplibregl-attrib-empty")):this._container.classList.add("maplibregl-attrib-empty"),this._updateCompact(),this._editLink=null)}}class Ur{constructor(s={}){this._updateCompact=()=>{const p=this._container.children;if(p.length){const d=p[0];this._map.getCanvasContainer().offsetWidth<=640||this._compact?this._compact!==!1&&d.classList.add("maplibregl-compact"):d.classList.remove("maplibregl-compact")}},this.options=s}getDefaultPosition(){return"bottom-left"}onAdd(s){this._map=s,this._compact=this.options&&this.options.compact,this._container=w.create("div","maplibregl-ctrl");const p=w.create("a","maplibregl-ctrl-logo");return p.target="_blank",p.rel="noopener nofollow",p.href="https://maplibre.org/",p.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),p.setAttribute("rel","noopener nofollow"),this._container.appendChild(p),this._container.style.display="block",this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){w.remove(this._container),this._map.off("resize",this._updateCompact),this._map=void 0,this._compact=void 0}}class Sg{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(s){const p=++this._id;return this._queue.push({callback:s,id:p,cancelled:!1}),p}remove(s){const p=this._currentlyRunning,d=p?this._queue.concat(p):this._queue;for(const m of d)if(m.id===s)return void(m.cancelled=!0)}run(s=0){if(this._currentlyRunning)throw new Error("Attempting to run(), but is already running.");const p=this._currentlyRunning=this._queue;this._queue=[];for(const d of p)if(!d.cancelled&&(d.callback(s),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}const Qm={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"Mapbox logo","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","ScaleControl.Feet":"ft","ScaleControl.Meters":"m","ScaleControl.Kilometers":"km","ScaleControl.Miles":"mi","ScaleControl.NauticalMiles":"nm","TerrainControl.enableTerrain":"Enable terrain","TerrainControl.disableTerrain":"Disable terrain"};var z_=u.Q([{name:"a_pos3d",type:"Int16",components:3}]);class B_ extends u.E{constructor(s){super(),this.sourceCache=s,this._tiles={},this._renderableTilesKeys=[],this._sourceTileCache={},this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.deltaZoom=1,s.usedForTerrain=!0,s.tileSize=this.tileSize*2**this.deltaZoom}destruct(){this.sourceCache.usedForTerrain=!1,this.sourceCache.tileSize=null}update(s,p){this.sourceCache.update(s,p),this._renderableTilesKeys=[];const d={};for(const m of s.coveringTiles({tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,reparseOverscaled:!1,terrain:p}))d[m.key]=!0,this._renderableTilesKeys.push(m.key),this._tiles[m.key]||(m.posMatrix=new Float64Array(16),u.aS(m.posMatrix,0,u.N,0,u.N,0,1),this._tiles[m.key]=new Yn(m,this.tileSize));for(const m in this._tiles)d[m]||delete this._tiles[m]}freeRtt(s){for(const p in this._tiles){const d=this._tiles[p];(!s||d.tileID.equals(s)||d.tileID.isChildOf(s)||s.isChildOf(d.tileID))&&(d.rtt=[])}}getRenderableTiles(){return this._renderableTilesKeys.map(s=>this.getTileByID(s))}getTileByID(s){return this._tiles[s]}getTerrainCoords(s){const p={};for(const d of this._renderableTilesKeys){const m=this._tiles[d].tileID;if(m.canonical.equals(s.canonical)){const v=s.clone();v.posMatrix=new Float64Array(16),u.aS(v.posMatrix,0,u.N,0,u.N,0,1),p[d]=v}else if(m.canonical.isChildOf(s.canonical)){const v=s.clone();v.posMatrix=new Float64Array(16);const S=m.canonical.z-s.canonical.z,T=m.canonical.x-(m.canonical.x>>S<<S),N=m.canonical.y-(m.canonical.y>>S<<S),O=u.N>>S;u.aS(v.posMatrix,0,O,0,O,0,1),u.$(v.posMatrix,v.posMatrix,[-T*O,-N*O,0]),p[d]=v}else if(s.canonical.isChildOf(m.canonical)){const v=s.clone();v.posMatrix=new Float64Array(16);const S=s.canonical.z-m.canonical.z,T=s.canonical.x-(s.canonical.x>>S<<S),N=s.canonical.y-(s.canonical.y>>S<<S),O=u.N>>S;u.aS(v.posMatrix,0,u.N,0,u.N,0,1),u.$(v.posMatrix,v.posMatrix,[T*O,N*O,0]),u.a0(v.posMatrix,v.posMatrix,[1/2**S,1/2**S,0]),p[d]=v}}return p}getSourceTile(s,p){const d=this.sourceCache._source;let m=s.overscaledZ-this.deltaZoom;if(m>d.maxzoom&&(m=d.maxzoom),m<d.minzoom)return null;this._sourceTileCache[s.key]||(this._sourceTileCache[s.key]=s.scaledTo(m).key);let v=this.sourceCache.getTileByID(this._sourceTileCache[s.key]);if((!v||!v.dem)&&p)for(;m>=d.minzoom&&(!v||!v.dem);)v=this.sourceCache.getTileByID(s.scaledTo(m--).key);return v}tilesAfterTime(s=Date.now()){return Object.values(this._tiles).filter(p=>p.timeAdded>=s)}}class $_{constructor(s,p,d){this.painter=s,this.sourceCache=new B_(p),this.options=d,this.exaggeration=typeof d.exaggeration=="number"?d.exaggeration:1,this.qualityFactor=2,this.meshSize=128,this._demMatrixCache={},this.coordsIndex=[],this._coordsTextureSize=1024}getDEMElevation(s,p,d,m=u.N){var v;if(!(p>=0&&p<m&&d>=0&&d<m))return 0;const S=this.getTerrainData(s),T=(v=S.tile)===null||v===void 0?void 0:v.dem;if(!T)return 0;const N=function(et,st,K){var xt=st[0],Nt=st[1];return et[0]=K[0]*xt+K[4]*Nt+K[12],et[1]=K[1]*xt+K[5]*Nt+K[13],et}([],[p/m*u.N,d/m*u.N],S.u_terrain_matrix),O=[N[0]*T.dim,N[1]*T.dim],F=Math.floor(O[0]),k=Math.floor(O[1]),j=O[0]-F,tt=O[1]-k;return T.get(F,k)*(1-j)*(1-tt)+T.get(F+1,k)*j*(1-tt)+T.get(F,k+1)*(1-j)*tt+T.get(F+1,k+1)*j*tt}getElevationForLngLatZoom(s,p){const{tileID:d,mercatorX:m,mercatorY:v}=this._getOverscaledTileIDFromLngLatZoom(s,p);return this.getElevation(d,m%u.N,v%u.N,u.N)}getElevation(s,p,d,m=u.N){return this.getDEMElevation(s,p,d,m)*this.exaggeration}getTerrainData(s){if(!this._emptyDemTexture){const m=this.painter.context,v=new u.R({width:1,height:1},new Uint8Array(4));this._emptyDepthTexture=new Yt(m,v,m.gl.RGBA,{premultiply:!1}),this._emptyDemUnpack=[0,0,0,0],this._emptyDemTexture=new Yt(m,new u.R({width:1,height:1}),m.gl.RGBA,{premultiply:!1}),this._emptyDemTexture.bind(m.gl.NEAREST,m.gl.CLAMP_TO_EDGE),this._emptyDemMatrix=u.ao([])}const p=this.sourceCache.getSourceTile(s,!0);if(p&&p.dem&&(!p.demTexture||p.needsTerrainPrepare)){const m=this.painter.context;p.demTexture=this.painter.getTileTexture(p.dem.stride),p.demTexture?p.demTexture.update(p.dem.getPixels(),{premultiply:!1}):p.demTexture=new Yt(m,p.dem.getPixels(),m.gl.RGBA,{premultiply:!1}),p.demTexture.bind(m.gl.NEAREST,m.gl.CLAMP_TO_EDGE),p.needsTerrainPrepare=!1}const d=p&&p+p.tileID.key+s.key;if(d&&!this._demMatrixCache[d]){const m=this.sourceCache.sourceCache._source.maxzoom;let v=s.canonical.z-p.tileID.canonical.z;s.overscaledZ>s.canonical.z&&(s.canonical.z>=m?v=s.canonical.z-m:u.w("cannot calculate elevation if elevation maxzoom > source.maxzoom"));const S=s.canonical.x-(s.canonical.x>>v<<v),T=s.canonical.y-(s.canonical.y>>v<<v),N=u.bc(new Float64Array(16),[1/(u.N<<v),1/(u.N<<v),0]);u.$(N,N,[S*u.N,T*u.N,0]),this._demMatrixCache[s.key]={matrix:N,coord:s}}return{u_depth:2,u_terrain:3,u_terrain_dim:p&&p.dem&&p.dem.dim||1,u_terrain_matrix:d?this._demMatrixCache[s.key].matrix:this._emptyDemMatrix,u_terrain_unpack:p&&p.dem&&p.dem.getUnpackVector()||this._emptyDemUnpack,u_terrain_exaggeration:this.exaggeration,texture:(p&&p.demTexture||this._emptyDemTexture).texture,depthTexture:(this._fboDepthTexture||this._emptyDepthTexture).texture,tile:p}}getFramebuffer(s){const p=this.painter,d=p.width/devicePixelRatio,m=p.height/devicePixelRatio;return!this._fbo||this._fbo.width===d&&this._fbo.height===m||(this._fbo.destroy(),this._fboCoordsTexture.destroy(),this._fboDepthTexture.destroy(),delete this._fbo,delete this._fboDepthTexture,delete this._fboCoordsTexture),this._fboCoordsTexture||(this._fboCoordsTexture=new Yt(p.context,{width:d,height:m,data:null},p.context.gl.RGBA,{premultiply:!1}),this._fboCoordsTexture.bind(p.context.gl.NEAREST,p.context.gl.CLAMP_TO_EDGE)),this._fboDepthTexture||(this._fboDepthTexture=new Yt(p.context,{width:d,height:m,data:null},p.context.gl.RGBA,{premultiply:!1}),this._fboDepthTexture.bind(p.context.gl.NEAREST,p.context.gl.CLAMP_TO_EDGE)),this._fbo||(this._fbo=p.context.createFramebuffer(d,m,!0,!1),this._fbo.depthAttachment.set(p.context.createRenderbuffer(p.context.gl.DEPTH_COMPONENT16,d,m))),this._fbo.colorAttachment.set(s==="coords"?this._fboCoordsTexture.texture:this._fboDepthTexture.texture),this._fbo}getCoordsTexture(){const s=this.painter.context;if(this._coordsTexture)return this._coordsTexture;const p=new Uint8Array(this._coordsTextureSize*this._coordsTextureSize*4);for(let v=0,S=0;v<this._coordsTextureSize;v++)for(let T=0;T<this._coordsTextureSize;T++,S+=4)p[S+0]=255&T,p[S+1]=255&v,p[S+2]=T>>8<<4|v>>8,p[S+3]=0;const d=new u.R({width:this._coordsTextureSize,height:this._coordsTextureSize},new Uint8Array(p.buffer)),m=new Yt(s,d,s.gl.RGBA,{premultiply:!1});return m.bind(s.gl.NEAREST,s.gl.CLAMP_TO_EDGE),this._coordsTexture=m,m}pointCoordinate(s){const p=new Uint8Array(4),d=this.painter.context,m=d.gl;d.bindFramebuffer.set(this.getFramebuffer("coords").framebuffer),m.readPixels(s.x,this.painter.height/devicePixelRatio-s.y-1,1,1,m.RGBA,m.UNSIGNED_BYTE,p),d.bindFramebuffer.set(null);const v=p[0]+(p[2]>>4<<8),S=p[1]+((15&p[2])<<8),T=this.coordsIndex[255-p[3]],N=T&&this.sourceCache.getTileByID(T);if(!N)return null;const O=this._coordsTextureSize,F=(1<<N.tileID.canonical.z)*O;return new u.U(this._allowMercatorOverflow(s,(N.tileID.canonical.x*O+v)/F),(N.tileID.canonical.y*O+S)/F,this.getElevation(N.tileID,v,S,O))}getTerrainMesh(){if(this._mesh)return this._mesh;const s=this.painter.context,p=new u.bd,d=new u.b0,m=this.meshSize,v=u.N/m,S=m*m;for(let k=0;k<=m;k++)for(let j=0;j<=m;j++)p.emplaceBack(j*v,k*v,0);for(let k=0;k<S;k+=m+1)for(let j=0;j<m;j++)d.emplaceBack(j+k,m+j+k+1,m+j+k+2),d.emplaceBack(j+k,m+j+k+2,j+k+1);const T=p.length,N=T+2*(m+1);for(const k of[0,1])for(let j=0;j<=m;j++)for(const tt of[0,1])p.emplaceBack(j*v,k*u.N,tt);for(let k=0;k<2*m;k+=2)d.emplaceBack(N+k,N+k+1,N+k+3),d.emplaceBack(N+k,N+k+3,N+k+2),d.emplaceBack(T+k,T+k+3,T+k+1),d.emplaceBack(T+k,T+k+2,T+k+3);const O=p.length,F=O+2*(m+1);for(const k of[0,1])for(let j=0;j<=m;j++)for(const tt of[0,1])p.emplaceBack(k*u.N,j*v,tt);for(let k=0;k<2*m;k+=2)d.emplaceBack(O+k,O+k+1,O+k+3),d.emplaceBack(O+k,O+k+3,O+k+2),d.emplaceBack(F+k,F+k+3,F+k+1),d.emplaceBack(F+k,F+k+2,F+k+3);return this._mesh={indexBuffer:s.createIndexBuffer(d),vertexBuffer:s.createVertexBuffer(p,z_.members),segments:u.S.simpleSegment(0,0,p.length,d.length)},this._mesh}getMeshFrameDelta(s){return 2*Math.PI*u.be/Math.pow(2,s)/5}getMinTileElevationForLngLatZoom(s,p){var d;const{tileID:m}=this._getOverscaledTileIDFromLngLatZoom(s,p);return(d=this.getMinMaxElevation(m).minElevation)!==null&&d!==void 0?d:0}getMinMaxElevation(s){const p=this.getTerrainData(s).tile,d={minElevation:null,maxElevation:null};return p&&p.dem&&(d.minElevation=p.dem.min*this.exaggeration,d.maxElevation=p.dem.max*this.exaggeration),d}_getOverscaledTileIDFromLngLatZoom(s,p){const d=u.U.fromLngLat(s.wrap()),m=(1<<p)*u.N,v=d.x*m,S=d.y*m,T=Math.floor(v/u.N),N=Math.floor(S/u.N);return{tileID:new u.O(p,0,p,T,N),mercatorX:v,mercatorY:S}}_allowMercatorOverflow(s,p){const d=s.x<this.painter.width/2;let m=u.bf(p);const v=this.painter.transform.center.lng;return d&&Math.sign(m)>0&&Math.sign(v)<0||!d&&Math.sign(m)<0&&Math.sign(v)>0?(m=360*Math.sign(v)+m,u.G(m)):p}}class O0{constructor(s,p,d){this._context=s,this._size=p,this._tileSize=d,this._objects=[],this._recentlyUsed=[],this._stamp=0}destruct(){for(const s of this._objects)s.texture.destroy(),s.fbo.destroy()}_createObject(s){const p=this._context.createFramebuffer(this._tileSize,this._tileSize,!0,!0),d=new Yt(this._context,{width:this._tileSize,height:this._tileSize,data:null},this._context.gl.RGBA);return d.bind(this._context.gl.LINEAR,this._context.gl.CLAMP_TO_EDGE),p.depthAttachment.set(this._context.createRenderbuffer(this._context.gl.DEPTH_STENCIL,this._tileSize,this._tileSize)),p.colorAttachment.set(d.texture),{id:s,fbo:p,texture:d,stamp:-1,inUse:!1}}getObjectForId(s){return this._objects[s]}useObject(s){s.inUse=!0,this._recentlyUsed=this._recentlyUsed.filter(p=>s.id!==p),this._recentlyUsed.push(s.id)}stampObject(s){s.stamp=++this._stamp}getOrCreateFreeObject(){for(const p of this._recentlyUsed)if(!this._objects[p].inUse)return this._objects[p];if(this._objects.length>=this._size)throw new Error("No free RenderPool available, call freeAllObjects() required!");const s=this._createObject(this._objects.length);return this._objects.push(s),s}freeObject(s){s.inUse=!1}freeAllObjects(){for(const s of this._objects)this.freeObject(s)}isFull(){return!(this._objects.length<this._size)&&this._objects.some(s=>!s.inUse)===!1}}const Vs={background:!0,fill:!0,line:!0,raster:!0,hillshade:!0};class Cg{constructor(s,p){this.painter=s,this.terrain=p,this.pool=new O0(s.context,30,p.sourceCache.tileSize*p.qualityFactor)}destruct(){this.pool.destruct()}getTexture(s){return this.pool.getObjectForId(s.rtt[this._stacks.length-1].id).texture}prepareForRender(s,p){this._stacks=[],this._prevType=null,this._rttTiles=[],this._renderableTiles=this.terrain.sourceCache.getRenderableTiles(),this._renderableLayerIds=s._order.filter(d=>!s._layers[d].isHidden(p)),this._coordsDescendingInv={};for(const d in s.sourceCaches){this._coordsDescendingInv[d]={};const m=s.sourceCaches[d].getVisibleCoordinates();for(const v of m){const S=this.terrain.sourceCache.getTerrainCoords(v);for(const T in S)this._coordsDescendingInv[d][T]||(this._coordsDescendingInv[d][T]=[]),this._coordsDescendingInv[d][T].push(S[T])}}this._coordsDescendingInvStr={};for(const d of s._order){const m=s._layers[d],v=m.source;if(Vs[m.type]&&!this._coordsDescendingInvStr[v]){this._coordsDescendingInvStr[v]={};for(const S in this._coordsDescendingInv[v])this._coordsDescendingInvStr[v][S]=this._coordsDescendingInv[v][S].map(T=>T.key).sort().join()}}for(const d of this._renderableTiles)for(const m in this._coordsDescendingInvStr){const v=this._coordsDescendingInvStr[m][d.tileID.key];v&&v!==d.rttCoords[m]&&(d.rtt=[])}}renderLayer(s){if(s.isHidden(this.painter.transform.zoom))return!1;const p=s.type,d=this.painter,m=this._renderableLayerIds[this._renderableLayerIds.length-1]===s.id;if(Vs[p]&&(this._prevType&&Vs[this._prevType]||this._stacks.push([]),this._prevType=p,this._stacks[this._stacks.length-1].push(s.id),!m))return!0;if(Vs[this._prevType]||Vs[p]&&m){this._prevType=p;const v=this._stacks.length-1,S=this._stacks[v]||[];for(const T of this._renderableTiles){if(this.pool.isFull()&&(Vr(this.painter,this.terrain,this._rttTiles),this._rttTiles=[],this.pool.freeAllObjects()),this._rttTiles.push(T),T.rtt[v]){const O=this.pool.getObjectForId(T.rtt[v].id);if(O.stamp===T.rtt[v].stamp){this.pool.useObject(O);continue}}const N=this.pool.getOrCreateFreeObject();this.pool.useObject(N),this.pool.stampObject(N),T.rtt[v]={id:N.id,stamp:N.stamp},d.context.bindFramebuffer.set(N.fbo.framebuffer),d.context.clear({color:u.aT.transparent,stencil:0}),d.currentStencilSource=void 0;for(let O=0;O<S.length;O++){const F=d.style._layers[S[O]],k=F.source?this._coordsDescendingInv[F.source][T.tileID.key]:[T.tileID];d.context.viewport.set([0,0,N.fbo.width,N.fbo.height]),d._renderTileClippingMasks(F,k),d.renderLayer(d,d.style.sourceCaches[F.source],F,k),F.source&&(T.rttCoords[F.source]=this._coordsDescendingInvStr[F.source][T.tileID.key])}}return Vr(this.painter,this.terrain,this._rttTiles),this._rttTiles=[],this.pool.freeAllObjects(),Vs[p]}return!1}}const ze=_,Ze={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:60,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:void 0,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,hash:!1,attributionControl:!0,maplibreLogo:!1,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,maxTileCacheSize:null,maxTileCacheZoomLevels:u.c.MAX_TILE_CACHE_ZOOM_LEVELS,localIdeographFontFamily:"sans-serif",transformRequest:null,transformCameraUpdate:null,fadeDuration:300,crossSourceCollisions:!0,validateStyle:!0,maxCanvasSize:[4096,4096]},bd=y=>{y.touchstart=y.dragStart,y.touchmoveWindow=y.dragMove,y.touchend=y.dragEnd},ty={showCompass:!0,showZoom:!0,visualizePitch:!1};class ey{constructor(s,p,d=!1){this.mousedown=S=>{this.startMouse(u.e({},S,{ctrlKey:!0,preventDefault:()=>S.preventDefault()}),w.mousePos(this.element,S)),w.addEventListener(window,"mousemove",this.mousemove),w.addEventListener(window,"mouseup",this.mouseup)},this.mousemove=S=>{this.moveMouse(S,w.mousePos(this.element,S))},this.mouseup=S=>{this.mouseRotate.dragEnd(S),this.mousePitch&&this.mousePitch.dragEnd(S),this.offTemp()},this.touchstart=S=>{S.targetTouches.length!==1?this.reset():(this._startPos=this._lastPos=w.touchPos(this.element,S.targetTouches)[0],this.startTouch(S,this._startPos),w.addEventListener(window,"touchmove",this.touchmove,{passive:!1}),w.addEventListener(window,"touchend",this.touchend))},this.touchmove=S=>{S.targetTouches.length!==1?this.reset():(this._lastPos=w.touchPos(this.element,S.targetTouches)[0],this.moveTouch(S,this._lastPos))},this.touchend=S=>{S.targetTouches.length===0&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),delete this._startPos,delete this._lastPos,this.offTemp()},this.reset=()=>{this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),this.touchRotate.reset(),this.touchPitch&&this.touchPitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()},this._clickTolerance=10;const m=s.dragRotate._mouseRotate.getClickTolerance(),v=s.dragRotate._mousePitch.getClickTolerance();this.element=p,this.mouseRotate=Il({clickTolerance:m,enable:!0}),this.touchRotate=(({enable:S,clickTolerance:T,bearingDegreesPerPixelMoved:N=.8})=>{const O=new ip;return new ku({clickTolerance:T,move:(F,k)=>({bearingDelta:(k.x-F.x)*N}),moveStateManager:O,enable:S,assignEvents:bd})})({clickTolerance:m,enable:!0}),this.map=s,d&&(this.mousePitch=Ni({clickTolerance:v,enable:!0}),this.touchPitch=(({enable:S,clickTolerance:T,pitchDegreesPerPixelMoved:N=-.5})=>{const O=new ip;return new ku({clickTolerance:T,move:(F,k)=>({pitchDelta:(k.y-F.y)*N}),moveStateManager:O,enable:S,assignEvents:bd})})({clickTolerance:v,enable:!0})),w.addEventListener(p,"mousedown",this.mousedown),w.addEventListener(p,"touchstart",this.touchstart,{passive:!1}),w.addEventListener(p,"touchcancel",this.reset)}startMouse(s,p){this.mouseRotate.dragStart(s,p),this.mousePitch&&this.mousePitch.dragStart(s,p),w.disableDrag()}startTouch(s,p){this.touchRotate.dragStart(s,p),this.touchPitch&&this.touchPitch.dragStart(s,p),w.disableDrag()}moveMouse(s,p){const d=this.map,{bearingDelta:m}=this.mouseRotate.dragMove(s,p)||{};if(m&&d.setBearing(d.getBearing()+m),this.mousePitch){const{pitchDelta:v}=this.mousePitch.dragMove(s,p)||{};v&&d.setPitch(d.getPitch()+v)}}moveTouch(s,p){const d=this.map,{bearingDelta:m}=this.touchRotate.dragMove(s,p)||{};if(m&&d.setBearing(d.getBearing()+m),this.touchPitch){const{pitchDelta:v}=this.touchPitch.dragMove(s,p)||{};v&&d.setPitch(d.getPitch()+v)}}off(){const s=this.element;w.removeEventListener(s,"mousedown",this.mousedown),w.removeEventListener(s,"touchstart",this.touchstart,{passive:!1}),w.removeEventListener(window,"touchmove",this.touchmove,{passive:!1}),w.removeEventListener(window,"touchend",this.touchend),w.removeEventListener(s,"touchcancel",this.reset),this.offTemp()}offTemp(){w.enableDrag(),w.removeEventListener(window,"mousemove",this.mousemove),w.removeEventListener(window,"mouseup",this.mouseup),w.removeEventListener(window,"touchmove",this.touchmove,{passive:!1}),w.removeEventListener(window,"touchend",this.touchend)}}let Gi;function ny(y,s,p){if(y=new u.L(y.lng,y.lat),s){const d=new u.L(y.lng-360,y.lat),m=new u.L(y.lng+360,y.lat),v=p.locationPoint(y).distSqr(s);p.locationPoint(d).distSqr(s)<v?y=d:p.locationPoint(m).distSqr(s)<v&&(y=m)}for(;Math.abs(y.lng-p.center.lng)>180;){const d=p.locationPoint(y);if(d.x>=0&&d.y>=0&&d.x<=p.width&&d.y<=p.height)break;y.lng>p.center.lng?y.lng-=360:y.lng+=360}return y}const cu={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};function V_(y,s,p){const d=y.classList;for(const m in cu)d.remove(`maplibregl-${p}-anchor-${m}`);d.add(`maplibregl-${p}-anchor-${s}`)}class ap extends u.E{constructor(s){if(super(),this._onKeyPress=p=>{const d=p.code,m=p.charCode||p.keyCode;d!=="Space"&&d!=="Enter"&&m!==32&&m!==13||this.togglePopup()},this._onMapClick=p=>{const d=p.originalEvent.target,m=this._element;this._popup&&(d===m||m.contains(d))&&this.togglePopup()},this._update=p=>{if(!this._map)return;const d=this._map.loaded()&&!this._map.isMoving();((p==null?void 0:p.type)==="terrain"||(p==null?void 0:p.type)==="render"&&!d)&&this._map.once("render",this._update),this._map.transform.renderWorldCopies&&(this._lngLat=ny(this._lngLat,this._pos,this._map.transform)),this._pos=this._map.project(this._lngLat)._add(this._offset);let m="";this._rotationAlignment==="viewport"||this._rotationAlignment==="auto"?m=`rotateZ(${this._rotation}deg)`:this._rotationAlignment==="map"&&(m=`rotateZ(${this._rotation-this._map.getBearing()}deg)`);let v="";this._pitchAlignment==="viewport"||this._pitchAlignment==="auto"?v="rotateX(0deg)":this._pitchAlignment==="map"&&(v=`rotateX(${this._map.getPitch()}deg)`),p&&p.type!=="moveend"||(this._pos=this._pos.round()),w.setTransform(this._element,`${cu[this._anchor]} translate(${this._pos.x}px, ${this._pos.y}px) ${v} ${m}`),this._map.terrain&&!this._opacityTimeout&&(this._opacityTimeout=setTimeout(()=>{const S=this._map.unproject(this._pos),T=40075016686e-3*Math.abs(Math.cos(this._lngLat.lat*Math.PI/180))/Math.pow(2,this._map.transform.tileZoom+8);this._element.style.opacity=S.distanceTo(this._lngLat)>20*T?"0.2":"1.0",this._opacityTimeout=null},100))},this._onMove=p=>{if(!this._isDragging){const d=this._clickTolerance||this._map._clickTolerance;this._isDragging=p.point.dist(this._pointerdownPos)>=d}this._isDragging&&(this._pos=p.point.sub(this._positionDelta),this._lngLat=this._map.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none",this._state==="pending"&&(this._state="active",this.fire(new u.k("dragstart"))),this.fire(new u.k("drag")))},this._onUp=()=>{this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1,this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),this._state==="active"&&this.fire(new u.k("dragend")),this._state="inactive"},this._addDragHandler=p=>{this._element.contains(p.originalEvent.target)&&(p.preventDefault(),this._positionDelta=p.point.sub(this._pos).add(this._offset),this._pointerdownPos=p.point,this._state="pending",this._map.on("mousemove",this._onMove),this._map.on("touchmove",this._onMove),this._map.once("mouseup",this._onUp),this._map.once("touchend",this._onUp))},this._anchor=s&&s.anchor||"center",this._color=s&&s.color||"#3FB1CE",this._scale=s&&s.scale||1,this._draggable=s&&s.draggable||!1,this._clickTolerance=s&&s.clickTolerance||0,this._isDragging=!1,this._state="inactive",this._rotation=s&&s.rotation||0,this._rotationAlignment=s&&s.rotationAlignment||"auto",this._pitchAlignment=s&&s.pitchAlignment&&s.pitchAlignment!=="auto"?s.pitchAlignment:this._rotationAlignment,s&&s.element)this._element=s.element,this._offset=u.P.convert(s&&s.offset||[0,0]);else{this._defaultMarker=!0,this._element=w.create("div"),this._element.setAttribute("aria-label","Map marker");const p=w.createNS("http://www.w3.org/2000/svg","svg"),d=41,m=27;p.setAttributeNS(null,"display","block"),p.setAttributeNS(null,"height",`${d}px`),p.setAttributeNS(null,"width",`${m}px`),p.setAttributeNS(null,"viewBox",`0 0 ${m} ${d}`);const v=w.createNS("http://www.w3.org/2000/svg","g");v.setAttributeNS(null,"stroke","none"),v.setAttributeNS(null,"stroke-width","1"),v.setAttributeNS(null,"fill","none"),v.setAttributeNS(null,"fill-rule","evenodd");const S=w.createNS("http://www.w3.org/2000/svg","g");S.setAttributeNS(null,"fill-rule","nonzero");const T=w.createNS("http://www.w3.org/2000/svg","g");T.setAttributeNS(null,"transform","translate(3.0, 29.0)"),T.setAttributeNS(null,"fill","#000000");const N=[{rx:"10.5",ry:"5.25002273"},{rx:"10.5",ry:"5.25002273"},{rx:"9.5",ry:"4.77275007"},{rx:"8.5",ry:"4.29549936"},{rx:"7.5",ry:"3.81822308"},{rx:"6.5",ry:"3.34094679"},{rx:"5.5",ry:"2.86367051"},{rx:"4.5",ry:"2.38636864"}];for(const xt of N){const Nt=w.createNS("http://www.w3.org/2000/svg","ellipse");Nt.setAttributeNS(null,"opacity","0.04"),Nt.setAttributeNS(null,"cx","10.5"),Nt.setAttributeNS(null,"cy","5.80029008"),Nt.setAttributeNS(null,"rx",xt.rx),Nt.setAttributeNS(null,"ry",xt.ry),T.appendChild(Nt)}const O=w.createNS("http://www.w3.org/2000/svg","g");O.setAttributeNS(null,"fill",this._color);const F=w.createNS("http://www.w3.org/2000/svg","path");F.setAttributeNS(null,"d","M27,13.5 C27,19.074644 20.250001,27.000002 14.75,34.500002 C14.016665,35.500004 12.983335,35.500004 12.25,34.500002 C6.7499993,27.000002 0,19.222562 0,13.5 C0,6.0441559 6.0441559,0 13.5,0 C20.955844,0 27,6.0441559 27,13.5 Z"),O.appendChild(F);const k=w.createNS("http://www.w3.org/2000/svg","g");k.setAttributeNS(null,"opacity","0.25"),k.setAttributeNS(null,"fill","#000000");const j=w.createNS("http://www.w3.org/2000/svg","path");j.setAttributeNS(null,"d","M13.5,0 C6.0441559,0 0,6.0441559 0,13.5 C0,19.222562 6.7499993,27 12.25,34.5 C13,35.522727 14.016664,35.500004 14.75,34.5 C20.250001,27 27,19.074644 27,13.5 C27,6.0441559 20.955844,0 13.5,0 Z M13.5,1 C20.415404,1 26,6.584596 26,13.5 C26,15.898657 24.495584,19.181431 22.220703,22.738281 C19.945823,26.295132 16.705119,30.142167 13.943359,33.908203 C13.743445,34.180814 13.612715,34.322738 13.5,34.441406 C13.387285,34.322738 13.256555,34.180814 13.056641,33.908203 C10.284481,30.127985 7.4148684,26.314159 5.015625,22.773438 C2.6163816,19.232715 1,15.953538 1,13.5 C1,6.584596 6.584596,1 13.5,1 Z"),k.appendChild(j);const tt=w.createNS("http://www.w3.org/2000/svg","g");tt.setAttributeNS(null,"transform","translate(6.0, 7.0)"),tt.setAttributeNS(null,"fill","#FFFFFF");const et=w.createNS("http://www.w3.org/2000/svg","g");et.setAttributeNS(null,"transform","translate(8.0, 8.0)");const st=w.createNS("http://www.w3.org/2000/svg","circle");st.setAttributeNS(null,"fill","#000000"),st.setAttributeNS(null,"opacity","0.25"),st.setAttributeNS(null,"cx","5.5"),st.setAttributeNS(null,"cy","5.5"),st.setAttributeNS(null,"r","5.4999962");const K=w.createNS("http://www.w3.org/2000/svg","circle");K.setAttributeNS(null,"fill","#FFFFFF"),K.setAttributeNS(null,"cx","5.5"),K.setAttributeNS(null,"cy","5.5"),K.setAttributeNS(null,"r","5.4999962"),et.appendChild(st),et.appendChild(K),S.appendChild(T),S.appendChild(O),S.appendChild(k),S.appendChild(tt),S.appendChild(et),p.appendChild(S),p.setAttributeNS(null,"height",d*this._scale+"px"),p.setAttributeNS(null,"width",m*this._scale+"px"),this._element.appendChild(p),this._offset=u.P.convert(s&&s.offset||[0,-14])}if(this._element.classList.add("maplibregl-marker"),this._element.addEventListener("dragstart",p=>{p.preventDefault()}),this._element.addEventListener("mousedown",p=>{p.preventDefault()}),V_(this._element,this._anchor,"marker"),s&&s.className)for(const p of s.className.split(" "))this._element.classList.add(p);this._popup=null}addTo(s){return this.remove(),this._map=s,s.getCanvasContainer().appendChild(this._element),s.on("move",this._update),s.on("moveend",this._update),s.on("terrain",this._update),this.setDraggable(this._draggable),this._update(),this._map.on("click",this._onMapClick),this}remove(){return this._opacityTimeout&&(clearTimeout(this._opacityTimeout),delete this._opacityTimeout),this._map&&(this._map.off("click",this._onMapClick),this._map.off("move",this._update),this._map.off("moveend",this._update),this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler),this._map.off("mouseup",this._onUp),this._map.off("touchend",this._onUp),this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),delete this._map),w.remove(this._element),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(s){return this._lngLat=u.L.convert(s),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(),this}getElement(){return this._element}setPopup(s){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),s){if(!("offset"in s.options)){const p=Math.abs(13.5)/Math.SQRT2;s.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[p,-1*(38.1-13.5+p)],"bottom-right":[-p,-1*(38.1-13.5+p)],left:[13.5,-1*(38.1-13.5)],right:[-13.5,-1*(38.1-13.5)]}:this._offset}this._popup=s,this._lngLat&&this._popup.setLngLat(this._lngLat),this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress)}return this}getPopup(){return this._popup}togglePopup(){const s=this._popup;return s?(s.isOpen()?s.remove():s.addTo(this._map),this):this}getOffset(){return this._offset}setOffset(s){return this._offset=u.P.convert(s),this._update(),this}addClassName(s){this._element.classList.add(s)}removeClassName(s){this._element.classList.remove(s)}toggleClassName(s){return this._element.classList.toggle(s)}setDraggable(s){return this._draggable=!!s,this._map&&(s?(this._map.on("mousedown",this._addDragHandler),this._map.on("touchstart",this._addDragHandler)):(this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(s){return this._rotation=s||0,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(s){return this._rotationAlignment=s||"auto",this._update(),this}getRotationAlignment(){return this._rotationAlignment}setPitchAlignment(s){return this._pitchAlignment=s&&s!=="auto"?s:this._rotationAlignment,this._update(),this}getPitchAlignment(){return this._pitchAlignment}}const gi={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0};let ri=0,_f=!1;const wd={maxWidth:100,unit:"metric"};function Ed(y,s,p){const d=p&&p.maxWidth||100,m=y._container.clientHeight/2,v=y.unproject([0,m]),S=y.unproject([d,m]),T=v.distanceTo(S);if(p&&p.unit==="imperial"){const N=3.2808*T;N>5280?up(s,d,N/5280,y._getUIString("ScaleControl.Miles")):up(s,d,N,y._getUIString("ScaleControl.Feet"))}else p&&p.unit==="nautical"?up(s,d,T/1852,y._getUIString("ScaleControl.NauticalMiles")):T>=1e3?up(s,d,T/1e3,y._getUIString("ScaleControl.Kilometers")):up(s,d,T,y._getUIString("ScaleControl.Meters"))}function up(y,s,p,d){const m=function(v){const S=Math.pow(10,`${Math.floor(v)}`.length-1);let T=v/S;return T=T>=10?10:T>=5?5:T>=3?3:T>=2?2:T>=1?1:function(N){const O=Math.pow(10,Math.ceil(-Math.log(N)/Math.LN10));return Math.round(N*O)/O}(T),S*T}(p);y.style.width=s*(m/p)+"px",y.innerHTML=`${m}&nbsp;${d}`}const ry={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px"},iy=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function vf(y){if(y){if(typeof y=="number"){const s=Math.round(Math.abs(y)/Math.SQRT2);return{center:new u.P(0,0),top:new u.P(0,y),"top-left":new u.P(s,s),"top-right":new u.P(-s,s),bottom:new u.P(0,-y),"bottom-left":new u.P(s,-s),"bottom-right":new u.P(-s,-s),left:new u.P(y,0),right:new u.P(-y,0)}}if(y instanceof u.P||Array.isArray(y)){const s=u.P.convert(y);return{center:s,top:s,"top-left":s,"top-right":s,bottom:s,"bottom-left":s,"bottom-right":s,left:s,right:s}}return{center:u.P.convert(y.center||[0,0]),top:u.P.convert(y.top||[0,0]),"top-left":u.P.convert(y["top-left"]||[0,0]),"top-right":u.P.convert(y["top-right"]||[0,0]),bottom:u.P.convert(y.bottom||[0,0]),"bottom-left":u.P.convert(y["bottom-left"]||[0,0]),"bottom-right":u.P.convert(y["bottom-right"]||[0,0]),left:u.P.convert(y.left||[0,0]),right:u.P.convert(y.right||[0,0])}}return vf(new u.P(0,0))}const oy={extend:(y,...s)=>u.e(y,...s),run(y){y()},logToElement(y,s=!1,p="log"){const d=window.document.getElementById(p);d&&(s&&(d.innerHTML=""),d.innerHTML+=`<br>${y}`)}},sy=_;class cr{static get version(){return sy}static get workerCount(){return zs.workerCount}static set workerCount(s){zs.workerCount=s}static get maxParallelImageRequests(){return u.c.MAX_PARALLEL_IMAGE_REQUESTS}static set maxParallelImageRequests(s){u.c.MAX_PARALLEL_IMAGE_REQUESTS=s}static get workerUrl(){return u.c.WORKER_URL}static set workerUrl(s){u.c.WORKER_URL=s}static addProtocol(s,p){u.c.REGISTERED_PROTOCOLS[s]=p}static removeProtocol(s){delete u.c.REGISTERED_PROTOCOLS[s]}}return cr.Map=class extends k_{constructor(y){if(u.bg.mark(u.bh.create),(y=u.e({},Ze,y)).minZoom!=null&&y.maxZoom!=null&&y.minZoom>y.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(y.minPitch!=null&&y.maxPitch!=null&&y.minPitch>y.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(y.minPitch!=null&&y.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(y.maxPitch!=null&&y.maxPitch>85)throw new Error("maxPitch must be less than or equal to 85");if(super(new gf(y.minZoom,y.maxZoom,y.minPitch,y.maxPitch,y.renderWorldCopies),{bearingSnap:y.bearingSnap}),this._cooperativeGesturesOnWheel=s=>{this._onCooperativeGesture(s,s[this._metaKey],1)},this._contextLost=s=>{s.preventDefault(),this._frame&&(this._frame.cancel(),this._frame=null),this.fire(new u.k("webglcontextlost",{originalEvent:s}))},this._contextRestored=s=>{this._setupPainter(),this.resize(),this._update(),this.fire(new u.k("webglcontextrestored",{originalEvent:s}))},this._onMapScroll=s=>{if(s.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1},this._onWindowOnline=()=>{this._update()},this._interactive=y.interactive,this._cooperativeGestures=y.cooperativeGestures,this._metaKey=navigator.platform.indexOf("Mac")===0?"metaKey":"ctrlKey",this._maxTileCacheSize=y.maxTileCacheSize,this._maxTileCacheZoomLevels=y.maxTileCacheZoomLevels,this._failIfMajorPerformanceCaveat=y.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=y.preserveDrawingBuffer,this._antialias=y.antialias,this._trackResize=y.trackResize,this._bearingSnap=y.bearingSnap,this._refreshExpiredTiles=y.refreshExpiredTiles,this._fadeDuration=y.fadeDuration,this._crossSourceCollisions=y.crossSourceCollisions,this._crossFadingFactor=1,this._collectResourceTiming=y.collectResourceTiming,this._renderTaskQueue=new Sg,this._controls=[],this._mapId=u.a2(),this._locale=u.e({},Qm,y.locale),this._clickTolerance=y.clickTolerance,this._overridePixelRatio=y.pixelRatio,this._maxCanvasSize=y.maxCanvasSize,this.transformCameraUpdate=y.transformCameraUpdate,this._imageQueueHandle=W.addThrottleControl(()=>this.isMoving()),this._requestManager=new ct(y.transformRequest),typeof y.container=="string"){if(this._container=document.getElementById(y.container),!this._container)throw new Error(`Container '${y.container}' not found.`)}else{if(!(y.container instanceof HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=y.container}if(y.maxBounds&&this.setMaxBounds(y.maxBounds),this._setupContainer(),this._setupPainter(),this.on("move",()=>this._update(!1)),this.on("moveend",()=>this._update(!1)),this.on("zoom",()=>this._update(!0)),this.on("terrain",()=>{this.painter.terrainFacilitator.dirty=!0,this._update(!0)}),this.once("idle",()=>{this._idleTriggered=!0}),typeof window<"u"){addEventListener("online",this._onWindowOnline,!1);let s=!1;const p=It(d=>{this._trackResize&&!this._removed&&this.resize(d)._update()},50);this._resizeObserver=new ResizeObserver(d=>{s?p(d):s=!0}),this._resizeObserver.observe(this._container)}this.handlers=new Km(this,y),this._cooperativeGestures&&this._setupCooperativeGestures(),this._hash=y.hash&&new Gt(typeof y.hash=="string"&&y.hash||void 0).addTo(this),this._hash&&this._hash._onHashChange()||(this.jumpTo({center:y.center,zoom:y.zoom,bearing:y.bearing,pitch:y.pitch}),y.bounds&&(this.resize(),this.fitBounds(y.bounds,u.e({},y.fitBoundsOptions,{duration:0})))),this.resize(),this._localIdeographFontFamily=y.localIdeographFontFamily,this._validateStyle=y.validateStyle,y.style&&this.setStyle(y.style,{localIdeographFontFamily:y.localIdeographFontFamily}),y.attributionControl&&this.addControl(new Da({customAttribution:y.customAttribution})),y.maplibreLogo&&this.addControl(new Ur,y.logoPosition),this.on("style.load",()=>{this.transform.unmodified&&this.jumpTo(this.style.stylesheet)}),this.on("data",s=>{this._update(s.dataType==="style"),this.fire(new u.k(`${s.dataType}data`,s))}),this.on("dataloading",s=>{this.fire(new u.k(`${s.dataType}dataloading`,s))}),this.on("dataabort",s=>{this.fire(new u.k("sourcedataabort",s))})}_getMapId(){return this._mapId}addControl(y,s){if(s===void 0&&(s=y.getDefaultPosition?y.getDefaultPosition():"top-right"),!y||!y.onAdd)return this.fire(new u.j(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));const p=y.onAdd(this);this._controls.push(y);const d=this._controlPositions[s];return s.indexOf("bottom")!==-1?d.insertBefore(p,d.firstChild):d.appendChild(p),this}removeControl(y){if(!y||!y.onRemove)return this.fire(new u.j(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));const s=this._controls.indexOf(y);return s>-1&&this._controls.splice(s,1),y.onRemove(this),this}hasControl(y){return this._controls.indexOf(y)>-1}calculateCameraOptionsFromTo(y,s,p,d){return d==null&&this.terrain&&(d=this.terrain.getElevationForLngLatZoom(p,this.transform.tileZoom)),super.calculateCameraOptionsFromTo(y,s,p,d)}resize(y){var s;const p=this._containerDimensions(),d=p[0],m=p[1],v=this._getClampedPixelRatio(d,m);if(this._resizeCanvas(d,m,v),this.painter.resize(d,m,v),this.painter.overLimit()){const T=this.painter.context.gl;this._maxCanvasSize=[T.drawingBufferWidth,T.drawingBufferHeight];const N=this._getClampedPixelRatio(d,m);this._resizeCanvas(d,m,N),this.painter.resize(d,m,N)}this.transform.resize(d,m),(s=this._requestedCameraState)===null||s===void 0||s.resize(d,m);const S=!this._moving;return S&&(this.stop(),this.fire(new u.k("movestart",y)).fire(new u.k("move",y))),this.fire(new u.k("resize",y)),S&&this.fire(new u.k("moveend",y)),this}_getClampedPixelRatio(y,s){const{0:p,1:d}=this._maxCanvasSize,m=this.getPixelRatio(),v=y*m,S=s*m;return Math.min(v>p?p/v:1,S>d?d/S:1)*m}getPixelRatio(){var y;return(y=this._overridePixelRatio)!==null&&y!==void 0?y:devicePixelRatio}setPixelRatio(y){this._overridePixelRatio=y,this.resize()}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()}setMaxBounds(y){return this.transform.setMaxBounds(Fe.convert(y)),this._update()}setMinZoom(y){if((y=y??-2)>=-2&&y<=this.transform.maxZoom)return this.transform.minZoom=y,this._update(),this.getZoom()<y&&this.setZoom(y),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(y){if((y=y??22)>=this.transform.minZoom)return this.transform.maxZoom=y,this._update(),this.getZoom()>y&&this.setZoom(y),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(y){if((y=y??0)<0)throw new Error("minPitch must be greater than or equal to 0");if(y>=0&&y<=this.transform.maxPitch)return this.transform.minPitch=y,this._update(),this.getPitch()<y&&this.setPitch(y),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(y){if((y=y??60)>85)throw new Error("maxPitch must be less than or equal to 85");if(y>=this.transform.minPitch)return this.transform.maxPitch=y,this._update(),this.getPitch()>y&&this.setPitch(y),this;throw new Error("maxPitch must be greater than the current minPitch")}getMaxPitch(){return this.transform.maxPitch}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(y){return this.transform.renderWorldCopies=y,this._update()}getCooperativeGestures(){return this._cooperativeGestures}setCooperativeGestures(y){return this._cooperativeGestures=y,this._cooperativeGestures?this._setupCooperativeGestures():this._destroyCooperativeGestures(),this}project(y){return this.transform.locationPoint(u.L.convert(y),this.style&&this.terrain)}unproject(y){return this.transform.pointLocation(u.P.convert(y),this.terrain)}isMoving(){var y;return this._moving||((y=this.handlers)===null||y===void 0?void 0:y.isMoving())}isZooming(){var y;return this._zooming||((y=this.handlers)===null||y===void 0?void 0:y.isZooming())}isRotating(){var y;return this._rotating||((y=this.handlers)===null||y===void 0?void 0:y.isRotating())}_createDelegatedListener(y,s,p){if(y==="mouseenter"||y==="mouseover"){let d=!1;return{layer:s,listener:p,delegates:{mousemove:m=>{const v=this.getLayer(s)?this.queryRenderedFeatures(m.point,{layers:[s]}):[];v.length?d||(d=!0,p.call(this,new ur(y,this,m.originalEvent,{features:v}))):d=!1},mouseout:()=>{d=!1}}}}if(y==="mouseleave"||y==="mouseout"){let d=!1;return{layer:s,listener:p,delegates:{mousemove:m=>{(this.getLayer(s)?this.queryRenderedFeatures(m.point,{layers:[s]}):[]).length?d=!0:d&&(d=!1,p.call(this,new ur(y,this,m.originalEvent)))},mouseout:m=>{d&&(d=!1,p.call(this,new ur(y,this,m.originalEvent)))}}}}{const d=m=>{const v=this.getLayer(s)?this.queryRenderedFeatures(m.point,{layers:[s]}):[];v.length&&(m.features=v,p.call(this,m),delete m.features)};return{layer:s,listener:p,delegates:{[y]:d}}}}on(y,s,p){if(p===void 0)return super.on(y,s);const d=this._createDelegatedListener(y,s,p);this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[y]=this._delegatedListeners[y]||[],this._delegatedListeners[y].push(d);for(const m in d.delegates)this.on(m,d.delegates[m]);return this}once(y,s,p){if(p===void 0)return super.once(y,s);const d=this._createDelegatedListener(y,s,p);for(const m in d.delegates)this.once(m,d.delegates[m]);return this}off(y,s,p){return p===void 0?super.off(y,s):(this._delegatedListeners&&this._delegatedListeners[y]&&(d=>{const m=this._delegatedListeners[y];for(let v=0;v<m.length;v++){const S=m[v];if(S.layer===s&&S.listener===p){for(const T in S.delegates)this.off(T,S.delegates[T]);return m.splice(v,1),this}}})(),this)}queryRenderedFeatures(y,s){if(!this.style)return[];let p;const d=y instanceof u.P||Array.isArray(y),m=d?y:[[0,0],[this.transform.width,this.transform.height]];if(s=s||(d?{}:y)||{},m instanceof u.P||typeof m[0]=="number")p=[u.P.convert(m)];else{const v=u.P.convert(m[0]),S=u.P.convert(m[1]);p=[v,new u.P(S.x,v.y),S,new u.P(v.x,S.y),v]}return this.style.queryRenderedFeatures(p,s,this.transform)}querySourceFeatures(y,s){return this.style.querySourceFeatures(y,s)}setStyle(y,s){return(s=u.e({},{localIdeographFontFamily:this._localIdeographFontFamily,validate:this._validateStyle},s)).diff!==!1&&s.localIdeographFontFamily===this._localIdeographFontFamily&&this.style&&y?(this._diffStyle(y,s),this):(this._localIdeographFontFamily=s.localIdeographFontFamily,this._updateStyle(y,s))}setTransformRequest(y){return this._requestManager.setTransformRequest(y),this}_getUIString(y){const s=this._locale[y];if(s==null)throw new Error(`Missing UI string '${y}'`);return s}_updateStyle(y,s){if(s.transformStyle&&this.style&&!this.style._loaded)return void this.style.once("style.load",()=>this._updateStyle(y,s));const p=this.style&&s.transformStyle?this.style.serialize():void 0;return this.style&&(this.style.setEventedParent(null),this.style._remove(!y)),y?(this.style=new oo(this,s||{}),this.style.setEventedParent(this,{style:this.style}),typeof y=="string"?this.style.loadURL(y,s,p):this.style.loadJSON(y,s,p),this):(delete this.style,this)}_lazyInitEmptyStyle(){this.style||(this.style=new oo(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}_diffStyle(y,s){if(typeof y=="string"){const p=this._requestManager.transformRequest(y,rt.Style);u.f(p,(d,m)=>{d?this.fire(new u.j(d)):m&&this._updateDiff(m,s)})}else typeof y=="object"&&this._updateDiff(y,s)}_updateDiff(y,s){try{this.style.setState(y,s)&&this._update(!0)}catch(p){u.w(`Unable to perform style diff: ${p.message||p.error||p}.  Rebuilding the style from scratch.`),this._updateStyle(y,s)}}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():u.w("There is no style added to the map.")}addSource(y,s){return this._lazyInitEmptyStyle(),this.style.addSource(y,s),this._update(!0)}isSourceLoaded(y){const s=this.style&&this.style.sourceCaches[y];if(s!==void 0)return s.loaded();this.fire(new u.j(new Error(`There is no source with ID '${y}'`)))}setTerrain(y){if(this.style._checkLoaded(),this._terrainDataCallback&&this.style.off("data",this._terrainDataCallback),y){const s=this.style.sourceCaches[y.source];if(!s)throw new Error(`cannot load terrain, because there exists no source with ID: ${y.source}`);for(const p in this.style._layers){const d=this.style._layers[p];d.type==="hillshade"&&d.source===y.source&&u.w("You are using the same source for a hillshade layer and for 3D terrain. Please consider using two separate sources to improve rendering quality.")}this.terrain=new $_(this.painter,s,y),this.painter.renderToTexture=new Cg(this.painter,this.terrain),this.transform._minEleveationForCurrentTile=this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom),this.transform.elevation=this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom),this._terrainDataCallback=p=>{p.dataType==="style"?this.terrain.sourceCache.freeRtt():p.dataType==="source"&&p.tile&&(p.sourceId!==y.source||this._elevationFreeze||(this.transform._minEleveationForCurrentTile=this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom),this.transform.elevation=this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom)),this.terrain.sourceCache.freeRtt(p.tile.tileID))},this.style.on("data",this._terrainDataCallback)}else this.terrain&&this.terrain.sourceCache.destruct(),this.terrain=null,this.painter.renderToTexture&&this.painter.renderToTexture.destruct(),this.painter.renderToTexture=null,this.transform._minEleveationForCurrentTile=0,this.transform.elevation=0;return this.fire(new u.k("terrain",{terrain:y})),this}getTerrain(){var y,s;return(s=(y=this.terrain)===null||y===void 0?void 0:y.options)!==null&&s!==void 0?s:null}areTilesLoaded(){const y=this.style&&this.style.sourceCaches;for(const s in y){const p=y[s]._tiles;for(const d in p){const m=p[d];if(m.state!=="loaded"&&m.state!=="errored")return!1}}return!0}addSourceType(y,s,p){return this._lazyInitEmptyStyle(),this.style.addSourceType(y,s,p)}removeSource(y){return this.style.removeSource(y),this._update(!0)}getSource(y){return this.style.getSource(y)}addImage(y,s,p={}){const{pixelRatio:d=1,sdf:m=!1,stretchX:v,stretchY:S,content:T}=p;if(this._lazyInitEmptyStyle(),!(s instanceof HTMLImageElement||u.a(s))){if(s.width===void 0||s.height===void 0)return this.fire(new u.j(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));{const{width:N,height:O,data:F}=s,k=s;return this.style.addImage(y,{data:new u.R({width:N,height:O},new Uint8Array(F)),pixelRatio:d,stretchX:v,stretchY:S,content:T,sdf:m,version:0,userImage:k}),k.onAdd&&k.onAdd(this,y),this}}{const{width:N,height:O,data:F}=u.h.getImageData(s);this.style.addImage(y,{data:new u.R({width:N,height:O},F),pixelRatio:d,stretchX:v,stretchY:S,content:T,sdf:m,version:0})}}updateImage(y,s){const p=this.style.getImage(y);if(!p)return this.fire(new u.j(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));const d=s instanceof HTMLImageElement||u.a(s)?u.h.getImageData(s):s,{width:m,height:v,data:S}=d;if(m===void 0||v===void 0)return this.fire(new u.j(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));if(m!==p.data.width||v!==p.data.height)return this.fire(new u.j(new Error("The width and height of the updated image must be that same as the previous version of the image")));const T=!(s instanceof HTMLImageElement||u.a(s));return p.data.replace(S,T),this.style.updateImage(y,p),this}getImage(y){return this.style.getImage(y)}hasImage(y){return y?!!this.style.getImage(y):(this.fire(new u.j(new Error("Missing required image id"))),!1)}removeImage(y){this.style.removeImage(y)}loadImage(y,s){W.getImage(this._requestManager.transformRequest(y,rt.Image),s)}listImages(){return this.style.listImages()}addLayer(y,s){return this._lazyInitEmptyStyle(),this.style.addLayer(y,s),this._update(!0)}moveLayer(y,s){return this.style.moveLayer(y,s),this._update(!0)}removeLayer(y){return this.style.removeLayer(y),this._update(!0)}getLayer(y){return this.style.getLayer(y)}getLayersOrder(){return this.style.getLayersOrder()}setLayerZoomRange(y,s,p){return this.style.setLayerZoomRange(y,s,p),this._update(!0)}setFilter(y,s,p={}){return this.style.setFilter(y,s,p),this._update(!0)}getFilter(y){return this.style.getFilter(y)}setPaintProperty(y,s,p,d={}){return this.style.setPaintProperty(y,s,p,d),this._update(!0)}getPaintProperty(y,s){return this.style.getPaintProperty(y,s)}setLayoutProperty(y,s,p,d={}){return this.style.setLayoutProperty(y,s,p,d),this._update(!0)}getLayoutProperty(y,s){return this.style.getLayoutProperty(y,s)}setGlyphs(y,s={}){return this._lazyInitEmptyStyle(),this.style.setGlyphs(y,s),this._update(!0)}getGlyphs(){return this.style.getGlyphsUrl()}addSprite(y,s,p={}){return this._lazyInitEmptyStyle(),this.style.addSprite(y,s,p,d=>{d||this._update(!0)}),this}removeSprite(y){return this._lazyInitEmptyStyle(),this.style.removeSprite(y),this._update(!0)}getSprite(){return this.style.getSprite()}setSprite(y,s={}){return this._lazyInitEmptyStyle(),this.style.setSprite(y,s,p=>{p||this._update(!0)}),this}setLight(y,s={}){return this._lazyInitEmptyStyle(),this.style.setLight(y,s),this._update(!0)}getLight(){return this.style.getLight()}setFeatureState(y,s){return this.style.setFeatureState(y,s),this._update()}removeFeatureState(y,s){return this.style.removeFeatureState(y,s),this._update()}getFeatureState(y){return this.style.getFeatureState(y)}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}_containerDimensions(){let y=0,s=0;return this._container&&(y=this._container.clientWidth||400,s=this._container.clientHeight||300),[y,s]}_setupContainer(){const y=this._container;y.classList.add("maplibregl-map");const s=this._canvasContainer=w.create("div","maplibregl-canvas-container",y);this._interactive&&s.classList.add("maplibregl-interactive"),this._canvas=w.create("canvas","maplibregl-canvas",s),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("tabindex","0"),this._canvas.setAttribute("aria-label","Map"),this._canvas.setAttribute("role","region");const p=this._containerDimensions(),d=this._getClampedPixelRatio(p[0],p[1]);this._resizeCanvas(p[0],p[1],d);const m=this._controlContainer=w.create("div","maplibregl-control-container",y),v=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach(S=>{v[S]=w.create("div",`maplibregl-ctrl-${S} `,m)}),this._container.addEventListener("scroll",this._onMapScroll,!1)}_setupCooperativeGestures(){this._cooperativeGesturesScreen=w.create("div","maplibregl-cooperative-gesture-screen",this._container);let y=typeof this._cooperativeGestures!="boolean"&&this._cooperativeGestures.windowsHelpText?this._cooperativeGestures.windowsHelpText:"Use Ctrl + scroll to zoom the map";navigator.platform.indexOf("Mac")===0&&(y=typeof this._cooperativeGestures!="boolean"&&this._cooperativeGestures.macHelpText?this._cooperativeGestures.macHelpText:"Use ⌘ + scroll to zoom the map"),this._cooperativeGesturesScreen.innerHTML=`
            <div class="maplibregl-desktop-message">${y}</div>
            <div class="maplibregl-mobile-message">${typeof this._cooperativeGestures!="boolean"&&this._cooperativeGestures.mobileHelpText?this._cooperativeGestures.mobileHelpText:"Use two fingers to move the map"}</div>
        `,this._cooperativeGesturesScreen.setAttribute("aria-hidden","true"),this._canvasContainer.addEventListener("wheel",this._cooperativeGesturesOnWheel,!1),this._canvasContainer.classList.add("maplibregl-cooperative-gestures")}_destroyCooperativeGestures(){w.remove(this._cooperativeGesturesScreen),this._canvasContainer.removeEventListener("wheel",this._cooperativeGesturesOnWheel,!1),this._canvasContainer.classList.remove("maplibregl-cooperative-gestures")}_resizeCanvas(y,s,p){this._canvas.width=Math.floor(p*y),this._canvas.height=Math.floor(p*s),this._canvas.style.width=`${y}px`,this._canvas.style.height=`${s}px`}_setupPainter(){const y={alpha:!0,stencil:!0,depth:!0,failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1};let s=null;this._canvas.addEventListener("webglcontextcreationerror",d=>{s={requestedAttributes:y},d&&(s.statusMessage=d.statusMessage,s.type=d.type)},{once:!0});const p=this._canvas.getContext("webgl2",y)||this._canvas.getContext("webgl",y);if(!p){const d="Failed to initialize WebGL";throw s?(s.message=d,new Error(JSON.stringify(s))):new Error(d)}this.painter=new El(p,this.transform),C.testSupport(p)}_onCooperativeGesture(y,s,p){return!s&&p<2&&(this._cooperativeGesturesScreen.classList.add("maplibregl-show"),setTimeout(()=>{this._cooperativeGesturesScreen.classList.remove("maplibregl-show")},100)),!1}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}_update(y){return this.style&&this.style._loaded?(this._styleDirty=this._styleDirty||y,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(y){return this._update(),this._renderTaskQueue.add(y)}_cancelRenderFrame(y){this._renderTaskQueue.remove(y)}_render(y){const s=this._idleTriggered?this._fadeDuration:0;if(this.painter.context.setDirty(),this.painter.setBaseState(),this._renderTaskQueue.run(y),this._removed)return;let p=!1;if(this.style&&this._styleDirty){this._styleDirty=!1;const m=this.transform.zoom,v=u.h.now();this.style.zoomHistory.update(m,v);const S=new u.a8(m,{now:v,fadeDuration:s,zoomHistory:this.style.zoomHistory,transition:this.style.getTransition()}),T=S.crossFadingFactor();T===1&&T===this._crossFadingFactor||(p=!0,this._crossFadingFactor=T),this.style.update(S)}this.style&&this._sourcesDirty&&(this._sourcesDirty=!1,this.style._updateSources(this.transform)),this.terrain?(this.terrain.sourceCache.update(this.transform,this.terrain),this.transform._minEleveationForCurrentTile=this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom),this._elevationFreeze||(this.transform.elevation=this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom))):(this.transform._minEleveationForCurrentTile=0,this.transform.elevation=0),this._placementDirty=this.style&&this.style._updatePlacement(this.painter.transform,this.showCollisionBoxes,s,this._crossSourceCollisions),this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showOverdrawInspector:this._showOverdrawInspector,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:s,showPadding:this.showPadding}),this.fire(new u.k("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,u.bg.mark(u.bh.load),this.fire(new u.k("load"))),this.style&&(this.style.hasTransitions()||p)&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles();const d=this._sourcesDirty||this._styleDirty||this._placementDirty;return d||this._repaint?this.triggerRepaint():!this.isMoving()&&this.loaded()&&this.fire(new u.k("idle")),!this._loaded||this._fullyLoaded||d||(this._fullyLoaded=!0,u.bg.mark(u.bh.fullLoad)),this}redraw(){return this.style&&(this._frame&&(this._frame.cancel(),this._frame=null),this._render(0)),this}remove(){var y;this._hash&&this._hash.remove();for(const p of this._controls)p.onRemove(this);this._controls=[],this._frame&&(this._frame.cancel(),this._frame=null),this._renderTaskQueue.clear(),this.painter.destroy(),this.handlers.destroy(),delete this.handlers,this.setStyle(null),typeof window<"u"&&removeEventListener("online",this._onWindowOnline,!1),W.removeThrottleControl(this._imageQueueHandle),(y=this._resizeObserver)===null||y===void 0||y.disconnect();const s=this.painter.context.gl.getExtension("WEBGL_lose_context");s&&s.loseContext(),this._canvas.removeEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.removeEventListener("webglcontextlost",this._contextLost,!1),w.remove(this._canvasContainer),w.remove(this._controlContainer),this._cooperativeGestures&&this._destroyCooperativeGestures(),this._container.classList.remove("maplibregl-map"),u.bg.clearMetrics(),this._removed=!0,this.fire(new u.k("remove"))}triggerRepaint(){this.style&&!this._frame&&(this._frame=u.h.frame(y=>{u.bg.frame(y),this._frame=null,this._render(y)}))}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(y){this._showTileBoundaries!==y&&(this._showTileBoundaries=y,this._update())}get showPadding(){return!!this._showPadding}set showPadding(y){this._showPadding!==y&&(this._showPadding=y,this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(y){this._showCollisionBoxes!==y&&(this._showCollisionBoxes=y,y?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(y){this._showOverdrawInspector!==y&&(this._showOverdrawInspector=y,this._update())}get repaint(){return!!this._repaint}set repaint(y){this._repaint!==y&&(this._repaint=y,this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(y){this._vertices=y,this._update()}get version(){return ze}getCameraTargetElevation(){return this.transform.elevation}},cr.NavigationControl=class{constructor(y){this._updateZoomButtons=()=>{const s=this._map.getZoom(),p=s===this._map.getMaxZoom(),d=s===this._map.getMinZoom();this._zoomInButton.disabled=p,this._zoomOutButton.disabled=d,this._zoomInButton.setAttribute("aria-disabled",p.toString()),this._zoomOutButton.setAttribute("aria-disabled",d.toString())},this._rotateCompassArrow=()=>{const s=this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(this._map.transform.pitch*(Math.PI/180)),.5)}) rotateX(${this._map.transform.pitch}deg) rotateZ(${this._map.transform.angle*(180/Math.PI)}deg)`:`rotate(${this._map.transform.angle*(180/Math.PI)}deg)`;this._compassIcon.style.transform=s},this._setButtonTitle=(s,p)=>{const d=this._map._getUIString(`NavigationControl.${p}`);s.title=d,s.setAttribute("aria-label",d)},this.options=u.e({},ty,y),this._container=w.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._container.addEventListener("contextmenu",s=>s.preventDefault()),this.options.showZoom&&(this._zoomInButton=this._createButton("maplibregl-ctrl-zoom-in",s=>this._map.zoomIn({},{originalEvent:s})),w.create("span","maplibregl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("maplibregl-ctrl-zoom-out",s=>this._map.zoomOut({},{originalEvent:s})),w.create("span","maplibregl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(this._compass=this._createButton("maplibregl-ctrl-compass",s=>{this.options.visualizePitch?this._map.resetNorthPitch({},{originalEvent:s}):this._map.resetNorth({},{originalEvent:s})}),this._compassIcon=w.create("span","maplibregl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}onAdd(y){return this._map=y,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),this._map.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&this._map.on("pitch",this._rotateCompassArrow),this._map.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new ey(this._map,this._compass,this.options.visualizePitch)),this._container}onRemove(){w.remove(this._container),this.options.showZoom&&this._map.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&this._map.off("pitch",this._rotateCompassArrow),this._map.off("rotate",this._rotateCompassArrow),this._handler.off(),delete this._handler),delete this._map}_createButton(y,s){const p=w.create("button",y,this._container);return p.type="button",p.addEventListener("click",s),p}},cr.GeolocateControl=class extends u.E{constructor(y){super(),this._onSuccess=s=>{if(this._map){if(this._isOutOfMapMaxBounds(s))return this._setErrorState(),this.fire(new u.k("outofmaxbounds",s)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=s,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background");break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}this.options.showUserLocation&&this._watchState!=="OFF"&&this._updateMarker(s),this.options.trackUserLocation&&this._watchState!=="ACTIVE_LOCK"||this._updateCamera(s),this.options.showUserLocation&&this._dotElement.classList.remove("maplibregl-user-location-dot-stale"),this.fire(new u.k("geolocate",s)),this._finish()}},this._updateCamera=s=>{const p=new u.L(s.coords.longitude,s.coords.latitude),d=s.coords.accuracy,m=this._map.getBearing(),v=u.e({bearing:m},this.options.fitBoundsOptions),S=Fe.fromLngLat(p,d);this._map.fitBounds(S,v,{geolocateSource:!0})},this._updateMarker=s=>{if(s){const p=new u.L(s.coords.longitude,s.coords.latitude);this._accuracyCircleMarker.setLngLat(p).addTo(this._map),this._userLocationDotMarker.setLngLat(p).addTo(this._map),this._accuracy=s.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()},this._onZoom=()=>{this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()},this._onError=s=>{if(this._map){if(this.options.trackUserLocation)if(s.code===1){this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;const p=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.title=p,this._geolocateButton.setAttribute("aria-label",p),this._geolocationWatchID!==void 0&&this._clearWatch()}else{if(s.code===3&&_f)return;this._setErrorState()}this._watchState!=="OFF"&&this.options.showUserLocation&&this._dotElement.classList.add("maplibregl-user-location-dot-stale"),this.fire(new u.k("error",s)),this._finish()}},this._finish=()=>{this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0},this._setupUI=s=>{if(this._map){if(this._container.addEventListener("contextmenu",p=>p.preventDefault()),this._geolocateButton=w.create("button","maplibregl-ctrl-geolocate",this._container),w.create("span","maplibregl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",s===!1){u.w("Geolocation support is not available so the GeolocateControl will be disabled.");const p=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.title=p,this._geolocateButton.setAttribute("aria-label",p)}else{const p=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.title=p,this._geolocateButton.setAttribute("aria-label",p)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=w.create("div","maplibregl-user-location-dot"),this._userLocationDotMarker=new ap({element:this._dotElement}),this._circleElement=w.create("div","maplibregl-user-location-accuracy-circle"),this._accuracyCircleMarker=new ap({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",this.trigger.bind(this)),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",p=>{p.geolocateSource||this._watchState!=="ACTIVE_LOCK"||p.originalEvent&&p.originalEvent.type==="resize"||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this.fire(new u.k("trackuserlocationend")))})}},this.options=u.e({},gi,y)}onAdd(y){return this._map=y,this._container=w.create("div","maplibregl-ctrl maplibregl-ctrl-group"),function(s,p=!1){Gi===void 0||p?window.navigator.permissions!==void 0?window.navigator.permissions.query({name:"geolocation"}).then(d=>{Gi=d.state!=="denied",s(Gi)}).catch(()=>{Gi=!!window.navigator.geolocation,s(Gi)}):(Gi=!!window.navigator.geolocation,s(Gi)):s(Gi)}(this._setupUI),this._container}onRemove(){this._geolocationWatchID!==void 0&&(window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),w.remove(this._container),this._map.off("zoom",this._onZoom),this._map=void 0,ri=0,_f=!1}_isOutOfMapMaxBounds(y){const s=this._map.getMaxBounds(),p=y.coords;return s&&(p.longitude<s.getWest()||p.longitude>s.getEast()||p.latitude<s.getSouth()||p.latitude>s.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting");break;case"ACTIVE_ERROR":break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}}_updateCircleRadius(){const y=this._map.getBounds(),s=y.getSouthEast(),p=y.getNorthEast(),d=s.distanceTo(p),m=Math.ceil(this._accuracy/(d/this._map._container.clientHeight)*2);this._circleElement.style.width=`${m}px`,this._circleElement.style.height=`${m}px`}trigger(){if(!this._setup)return u.w("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new u.k("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":ri--,_f=!1,this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this.fire(new u.k("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new u.k("trackuserlocationstart"));break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"OFF":break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}if(this._watchState==="OFF"&&this._geolocationWatchID!==void 0)this._clearWatch();else if(this._geolocationWatchID===void 0){let y;this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),ri++,ri>1?(y={maximumAge:6e5,timeout:0},_f=!0):(y=this.options.positionOptions,_f=!1),this._geolocationWatchID=window.navigator.geolocation.watchPosition(this._onSuccess,this._onError,y)}}else window.navigator.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0}_clearWatch(){window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},cr.AttributionControl=Da,cr.LogoControl=Ur,cr.ScaleControl=class{constructor(y){this._onMove=()=>{Ed(this._map,this._container,this.options)},this.setUnit=s=>{this.options.unit=s,Ed(this._map,this._container,this.options)},this.options=u.e({},wd,y)}getDefaultPosition(){return"bottom-left"}onAdd(y){return this._map=y,this._container=w.create("div","maplibregl-ctrl maplibregl-ctrl-scale",y.getContainer()),this._map.on("move",this._onMove),this._onMove(),this._container}onRemove(){w.remove(this._container),this._map.off("move",this._onMove),this._map=void 0}},cr.FullscreenControl=class extends u.E{constructor(y={}){super(),this._onFullscreenChange=()=>{(window.document.fullscreenElement||window.document.mozFullScreenElement||window.document.webkitFullscreenElement||window.document.msFullscreenElement)===this._container!==this._fullscreen&&this._handleFullscreenChange()},this._onClickFullscreen=()=>{this._isFullscreen()?this._exitFullscreen():this._requestFullscreen()},this._fullscreen=!1,y&&y.container&&(y.container instanceof HTMLElement?this._container=y.container:u.w("Full screen control 'container' must be a DOM element.")),"onfullscreenchange"in document?this._fullscreenchange="fullscreenchange":"onmozfullscreenchange"in document?this._fullscreenchange="mozfullscreenchange":"onwebkitfullscreenchange"in document?this._fullscreenchange="webkitfullscreenchange":"onmsfullscreenchange"in document&&(this._fullscreenchange="MSFullscreenChange")}onAdd(y){return this._map=y,this._container||(this._container=this._map.getContainer()),this._controlContainer=w.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._setupUI(),this._controlContainer}onRemove(){w.remove(this._controlContainer),this._map=null,window.document.removeEventListener(this._fullscreenchange,this._onFullscreenChange)}_setupUI(){const y=this._fullscreenButton=w.create("button","maplibregl-ctrl-fullscreen",this._controlContainer);w.create("span","maplibregl-ctrl-icon",y).setAttribute("aria-hidden","true"),y.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),window.document.addEventListener(this._fullscreenchange,this._onFullscreenChange)}_updateTitle(){const y=this._getTitle();this._fullscreenButton.setAttribute("aria-label",y),this._fullscreenButton.title=y}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_handleFullscreenChange(){this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("maplibregl-ctrl-shrink"),this._fullscreenButton.classList.toggle("maplibregl-ctrl-fullscreen"),this._updateTitle(),this._fullscreen?(this.fire(new u.k("fullscreenstart")),this._map._cooperativeGestures&&(this._prevCooperativeGestures=this._map._cooperativeGestures,this._map.setCooperativeGestures())):(this.fire(new u.k("fullscreenend")),this._prevCooperativeGestures&&(this._map.setCooperativeGestures(this._prevCooperativeGestures),delete this._prevCooperativeGestures))}_exitFullscreen(){window.document.exitFullscreen?window.document.exitFullscreen():window.document.mozCancelFullScreen?window.document.mozCancelFullScreen():window.document.msExitFullscreen?window.document.msExitFullscreen():window.document.webkitCancelFullScreen?window.document.webkitCancelFullScreen():this._togglePseudoFullScreen()}_requestFullscreen(){this._container.requestFullscreen?this._container.requestFullscreen():this._container.mozRequestFullScreen?this._container.mozRequestFullScreen():this._container.msRequestFullscreen?this._container.msRequestFullscreen():this._container.webkitRequestFullscreen?this._container.webkitRequestFullscreen():this._togglePseudoFullScreen()}_togglePseudoFullScreen(){this._container.classList.toggle("maplibregl-pseudo-fullscreen"),this._handleFullscreenChange(),this._map.resize()}},cr.TerrainControl=class{constructor(y){this._toggleTerrain=()=>{this._map.getTerrain()?this._map.setTerrain(null):this._map.setTerrain(this.options),this._updateTerrainIcon()},this._updateTerrainIcon=()=>{this._terrainButton.classList.remove("maplibregl-ctrl-terrain"),this._terrainButton.classList.remove("maplibregl-ctrl-terrain-enabled"),this._map.terrain?(this._terrainButton.classList.add("maplibregl-ctrl-terrain-enabled"),this._terrainButton.title=this._map._getUIString("TerrainControl.disableTerrain")):(this._terrainButton.classList.add("maplibregl-ctrl-terrain"),this._terrainButton.title=this._map._getUIString("TerrainControl.enableTerrain"))},this.options=y}onAdd(y){return this._map=y,this._container=w.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._terrainButton=w.create("button","maplibregl-ctrl-terrain",this._container),w.create("span","maplibregl-ctrl-icon",this._terrainButton).setAttribute("aria-hidden","true"),this._terrainButton.type="button",this._terrainButton.addEventListener("click",this._toggleTerrain),this._updateTerrainIcon(),this._map.on("terrain",this._updateTerrainIcon),this._container}onRemove(){w.remove(this._container),this._map.off("terrain",this._updateTerrainIcon),this._map=void 0}},cr.Popup=class extends u.E{constructor(y){super(),this.remove=()=>(this._content&&w.remove(this._content),this._container&&(w.remove(this._container),delete this._container),this._map&&(this._map.off("move",this._update),this._map.off("move",this._onClose),this._map.off("click",this._onClose),this._map.off("remove",this.remove),this._map.off("mousemove",this._onMouseMove),this._map.off("mouseup",this._onMouseUp),this._map.off("drag",this._onDrag),delete this._map),this.fire(new u.k("close")),this),this._onMouseUp=s=>{this._update(s.point)},this._onMouseMove=s=>{this._update(s.point)},this._onDrag=s=>{this._update(s.point)},this._update=s=>{if(!this._map||!this._lngLat&&!this._trackPointer||!this._content)return;if(!this._container){if(this._container=w.create("div","maplibregl-popup",this._map.getContainer()),this._tip=w.create("div","maplibregl-popup-tip",this._container),this._container.appendChild(this._content),this.options.className)for(const S of this.options.className.split(" "))this._container.classList.add(S);this._trackPointer&&this._container.classList.add("maplibregl-popup-track-pointer")}if(this.options.maxWidth&&this._container.style.maxWidth!==this.options.maxWidth&&(this._container.style.maxWidth=this.options.maxWidth),this._map.transform.renderWorldCopies&&!this._trackPointer&&(this._lngLat=ny(this._lngLat,this._pos,this._map.transform)),this._trackPointer&&!s)return;const p=this._pos=this._trackPointer&&s?s:this._map.project(this._lngLat);let d=this.options.anchor;const m=vf(this.options.offset);if(!d){const S=this._container.offsetWidth,T=this._container.offsetHeight;let N;N=p.y+m.bottom.y<T?["top"]:p.y>this._map.transform.height-T?["bottom"]:[],p.x<S/2?N.push("left"):p.x>this._map.transform.width-S/2&&N.push("right"),d=N.length===0?"bottom":N.join("-")}const v=p.add(m[d]).round();w.setTransform(this._container,`${cu[d]} translate(${v.x}px,${v.y}px)`),V_(this._container,d,"popup")},this._onClose=()=>{this.remove()},this.options=u.e(Object.create(ry),y)}addTo(y){return this._map&&this.remove(),this._map=y,this.options.closeOnClick&&this._map.on("click",this._onClose),this.options.closeOnMove&&this._map.on("move",this._onClose),this._map.on("remove",this.remove),this._update(),this._focusFirstElement(),this._trackPointer?(this._map.on("mousemove",this._onMouseMove),this._map.on("mouseup",this._onMouseUp),this._container&&this._container.classList.add("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer")):this._map.on("move",this._update),this.fire(new u.k("open")),this}isOpen(){return!!this._map}getLngLat(){return this._lngLat}setLngLat(y){return this._lngLat=u.L.convert(y),this._pos=null,this._trackPointer=!1,this._update(),this._map&&(this._map.on("move",this._update),this._map.off("mousemove",this._onMouseMove),this._container&&this._container.classList.remove("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.remove("maplibregl-track-pointer")),this}trackPointer(){return this._trackPointer=!0,this._pos=null,this._update(),this._map&&(this._map.off("move",this._update),this._map.on("mousemove",this._onMouseMove),this._map.on("drag",this._onDrag),this._container&&this._container.classList.add("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer")),this}getElement(){return this._container}setText(y){return this.setDOMContent(document.createTextNode(y))}setHTML(y){const s=document.createDocumentFragment(),p=document.createElement("body");let d;for(p.innerHTML=y;d=p.firstChild,d;)s.appendChild(d);return this.setDOMContent(s)}getMaxWidth(){var y;return(y=this._container)===null||y===void 0?void 0:y.style.maxWidth}setMaxWidth(y){return this.options.maxWidth=y,this._update(),this}setDOMContent(y){if(this._content)for(;this._content.hasChildNodes();)this._content.firstChild&&this._content.removeChild(this._content.firstChild);else this._content=w.create("div","maplibregl-popup-content",this._container);return this._content.appendChild(y),this._createCloseButton(),this._update(),this._focusFirstElement(),this}addClassName(y){this._container&&this._container.classList.add(y)}removeClassName(y){this._container&&this._container.classList.remove(y)}setOffset(y){return this.options.offset=y,this._update(),this}toggleClassName(y){if(this._container)return this._container.classList.toggle(y)}_createCloseButton(){this.options.closeButton&&(this._closeButton=w.create("button","maplibregl-popup-close-button",this._content),this._closeButton.type="button",this._closeButton.setAttribute("aria-label","Close popup"),this._closeButton.innerHTML="&#215;",this._closeButton.addEventListener("click",this._onClose))}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;const y=this._container.querySelector(iy);y&&y.focus()}},cr.Marker=ap,cr.Style=oo,cr.LngLat=u.L,cr.LngLatBounds=Fe,cr.Point=u.P,cr.MercatorCoordinate=u.U,cr.Evented=u.E,cr.AJAXError=u.bi,cr.config=u.c,cr.CanvasSource=qo,cr.GeoJSONSource=ks,cr.ImageSource=nn,cr.RasterDEMTileSource=fl,cr.RasterTileSource=ci,cr.VectorTileSource=rr,cr.VideoSource=dl,cr.setRTLTextPlugin=u.bj,cr.getRTLTextPluginStatus=u.bk,cr.prewarm=function(){Ta().acquire(vn)},cr.clearPrewarmedResources=function(){const y=os;y&&(y.isPreloaded()&&y.numActive()===1?(y.release(vn),os=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},oy.extend(cr,{isSafari:u.ac,getPerformanceMetrics:u.bg.getPerformanceMetrics}),cr});var h=i;return h})})(qI);var pP=qI.exports;const XI=VI(pP),fP=Object.freeze(Object.defineProperty({__proto__:null,default:XI},Symbol.toStringTag,{value:"Module"}));var YI={},dP=Object.defineProperty,gP=(t,e,n)=>e in t?dP(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n,sE=(t,e,n)=>(gP(t,typeof e!="symbol"?e+"":e,n),n),ZI=(t,e,n)=>{if(!e.has(t))throw TypeError("Cannot "+n)},Lc=(t,e,n)=>(ZI(t,e,"read from private field"),n?n.call(t):e.get(t)),aE=(t,e,n)=>{if(e.has(t))throw TypeError("Cannot add the same private member more than once");e instanceof WeakSet?e.add(t):e.set(t,n)},Tx=(t,e,n,r)=>(ZI(t,e,"write to private field"),r?r.call(t,n):e.set(t,n),n);function xi(){}function mP(t,e){for(const n in e)t[n]=e[n];return t}function HI(t){return t()}function uE(){return Object.create(null)}function Xp(t){t.forEach(HI)}function WI(t){return typeof t=="function"}function id(t,e){return t!=t?e==e:t!==e||t&&typeof t=="object"||typeof t=="function"}let pv;function ya(t,e){return t===e?!0:(pv||(pv=document.createElement("a")),pv.href=e,t===pv.href)}function yP(t){return Object.keys(t).length===0}function _P(t,e,n,r){if(t){const i=JI(t,e,n,r);return t[0](i)}}function JI(t,e,n,r){return t[1]&&r?mP(n.ctx.slice(),t[1](r(e))):n.ctx}function vP(t,e,n,r){if(t[2]&&r){const i=t[2](r(n));if(e.dirty===void 0)return i;if(typeof i=="object"){const a=[],h=Math.max(e.dirty.length,i.length);for(let u=0;u<h;u+=1)a[u]=e.dirty[u]|i[u];return a}return e.dirty|i}return e.dirty}function xP(t,e,n,r,i,a){if(i){const h=JI(e,n,r,a);t.p(h,i)}}function bP(t){if(t.ctx.length>32){const e=[],n=t.ctx.length/32;for(let r=0;r<n;r++)e[r]=-1;return e}return-1}function lE(t){return t??""}function hr(t,e){t.appendChild(e)}function ki(t,e,n){t.insertBefore(e,n||null)}function Ei(t){t.parentNode&&t.parentNode.removeChild(t)}function jr(t){return document.createElement(t)}function Ac(t){return document.createElementNS("http://www.w3.org/2000/svg",t)}function kf(t){return document.createTextNode(t)}function Gu(){return kf(" ")}function wP(){return kf("")}function Va(t,e,n,r){return t.addEventListener(e,n,r),()=>t.removeEventListener(e,n,r)}function EP(t){return function(e){return e.preventDefault(),t.call(this,e)}}function ne(t,e,n){n==null?t.removeAttribute(e):t.getAttribute(e)!==n&&t.setAttribute(e,n)}function IP(t){return Array.from(t.childNodes)}function ky(t,e){e=""+e,t.data!==e&&(t.data=e)}function cE(t,e){t.value=e??""}function fv(t,e,n,r){n==null?t.style.removeProperty(e):t.style.setProperty(e,n,r?"important":"")}function Vl(t,e,n){t.classList.toggle(e,!!n)}function SP(t,e,{bubbles:n=!1,cancelable:r=!1}={}){return new CustomEvent(t,{detail:e,bubbles:n,cancelable:r})}let zy;function Ry(t){zy=t}function KI(){if(!zy)throw new Error("Function called outside component initialization");return zy}function CP(t){KI().$$.on_destroy.push(t)}function TP(){const t=KI();return(e,n,{cancelable:r=!1}={})=>{const i=t.$$.callbacks[e];if(i){const a=SP(e,n,{cancelable:r});return i.slice().forEach(h=>{h.call(t,a)}),!a.defaultPrevented}return!0}}function hE(t,e){const n=t.$$.callbacks[e.type];n&&n.slice().forEach(r=>r.call(this,e))}const Bg=[],Ux=[];let Gg=[];const pE=[],LP=Promise.resolve();let Gx=!1;function NP(){Gx||(Gx=!0,LP.then(QI))}function qx(t){Gg.push(t)}const Lx=new Set;let kg=0;function QI(){if(kg!==0)return;const t=zy;do{try{for(;kg<Bg.length;){const e=Bg[kg];kg++,Ry(e),PP(e.$$)}}catch(e){throw Bg.length=0,kg=0,e}for(Ry(null),Bg.length=0,kg=0;Ux.length;)Ux.pop()();for(let e=0;e<Gg.length;e+=1){const n=Gg[e];Lx.has(n)||(Lx.add(n),n())}Gg.length=0}while(Bg.length);for(;pE.length;)pE.pop()();Gx=!1,Lx.clear(),Ry(t)}function PP(t){if(t.fragment!==null){t.update(),Xp(t.before_update);const e=t.dirty;t.dirty=[-1],t.fragment&&t.fragment.p(t.ctx,e),t.after_update.forEach(qx)}}function MP(t){const e=[],n=[];Gg.forEach(r=>t.indexOf(r)===-1?e.push(r):n.push(r)),n.forEach(r=>r()),Gg=e}const Sv=new Set;let Nd;function Cv(){Nd={r:0,c:[],p:Nd}}function Tv(){Nd.r||Xp(Nd.c),Nd=Nd.p}function vo(t,e){t&&t.i&&(Sv.delete(t),t.i(e))}function ys(t,e,n,r){if(t&&t.o){if(Sv.has(t))return;Sv.add(t),Nd.c.push(()=>{Sv.delete(t),r&&(n&&t.d(1),r())}),t.o(e)}else r&&r()}function fE(t){return(t==null?void 0:t.length)!==void 0?t:Array.from(t)}function AP(t,e){ys(t,1,1,()=>{e.delete(t.key)})}function DP(t,e,n,r,i,a,h,u,_,w,C,P){let D=t.length,B=a.length,$=D;const Z={};for(;$--;)Z[t[$].key]=$;const W=[],rt=new Map,ct=new Map,pt=[];for($=B;$--;){const Ot=P(i,a,$),At=n(Ot);let Rt=h.get(At);Rt?r&&pt.push(()=>Rt.p(Ot,e)):(Rt=w(At,Ot),Rt.c()),rt.set(At,W[$]=Rt),At in Z&&ct.set(At,Math.abs($-Z[At]))}const gt=new Set,Ut=new Set;function zt(Ot){vo(Ot,1),Ot.m(u,C),h.set(Ot.key,Ot),C=Ot.first,B--}for(;D&&B;){const Ot=W[B-1],At=t[D-1],Rt=Ot.key,Yt=At.key;Ot===At?(C=Ot.first,D--,B--):rt.has(Yt)?!h.has(Rt)||gt.has(Rt)?zt(Ot):Ut.has(Yt)?D--:ct.get(Rt)>ct.get(Yt)?(Ut.add(Rt),zt(Ot)):(gt.add(Yt),D--):(_(At,h),D--)}for(;D--;){const Ot=t[D];rt.has(Ot.key)||_(Ot,h)}for(;B;)zt(W[B-1]);return Xp(pt),W}function zf(t){t&&t.c()}function Sp(t,e,n){const{fragment:r,after_update:i}=t.$$;r&&r.m(e,n),qx(()=>{const a=t.$$.on_mount.map(HI).filter(WI);t.$$.on_destroy?t.$$.on_destroy.push(...a):Xp(a),t.$$.on_mount=[]}),i.forEach(qx)}function Cp(t,e){const n=t.$$;n.fragment!==null&&(MP(n.after_update),Xp(n.on_destroy),n.fragment&&n.fragment.d(e),n.on_destroy=n.fragment=null,n.ctx=[])}function OP(t,e){t.$$.dirty[0]===-1&&(Bg.push(t),NP(),t.$$.dirty.fill(0)),t.$$.dirty[e/31|0]|=1<<e%31}function od(t,e,n,r,i,a,h=null,u=[-1]){const _=zy;Ry(t);const w=t.$$={fragment:null,ctx:[],props:a,update:xi,not_equal:i,bound:uE(),on_mount:[],on_destroy:[],on_disconnect:[],before_update:[],after_update:[],context:new Map(e.context||(_?_.$$.context:[])),callbacks:uE(),dirty:u,skip_bound:!1,root:e.target||_.$$.root};h&&h(w.root);let C=!1;if(w.ctx=n?n(t,e.props||{},(P,D,...B)=>{const $=B.length?B[0]:D;return w.ctx&&i(w.ctx[P],w.ctx[P]=$)&&(!w.skip_bound&&w.bound[P]&&w.bound[P]($),C&&OP(t,P)),D}):[],w.update(),C=!0,Xp(w.before_update),w.fragment=r?r(w.ctx):!1,e.target){if(e.hydrate){const P=IP(e.target);w.fragment&&w.fragment.l(P),P.forEach(Ei)}else w.fragment&&w.fragment.c();e.intro&&vo(t.$$.fragment),Sp(t,e.target,e.anchor),QI()}Ry(_)}let sd=class{constructor(){sE(this,"$$"),sE(this,"$$set")}$destroy(){Cp(this,1),this.$destroy=xi}$on(e,n){if(!WI(n))return xi;const r=this.$$.callbacks[e]||(this.$$.callbacks[e]=[]);return r.push(n),()=>{const i=r.indexOf(n);i!==-1&&r.splice(i,1)}}$set(e){this.$$set&&!yP(e)&&(this.$$.skip_bound=!0,this.$$set(e),this.$$.skip_bound=!1)}};const RP="4";typeof window<"u"&&(window.__svelte||(window.__svelte={v:new Set})).v.add(RP);function FP(t){let e,n;return{c(){e=Ac("svg"),n=Ac("path"),ne(n,"d","M13.12.706a.982.982 0 0 0-1.391 0L6.907 5.517 2.087.696a.982.982 0 1 0-1.391 1.39l4.821 4.821L.696 11.73a.982.982 0 1 0 1.39 1.39l4.821-4.821 4.822 4.821a.982.982 0 1 0 1.39-1.39L8.298 6.908l4.821-4.822a.988.988 0 0 0 0-1.38Z"),ne(e,"viewBox","0 0 14 14"),ne(e,"width","13"),ne(e,"height","13"),ne(e,"class","svelte-en2qvf")},m(r,i){ki(r,e,i),hr(e,n)},p:xi,i:xi,o:xi,d(r){r&&Ei(e)}}}class tS extends sd{constructor(e){super(),od(this,e,null,FP,id,{})}}function kP(t){let e,n;return{c(){e=Ac("svg"),n=Ac("path"),ne(n,"d","M15 0C6.705 0 0 6.705 0 15C0 23.295 6.705 30 15 30C23.295 30 30 23.295 30 15C30 6.705 23.295 0 15 0ZM22.5 20.385L20.385 22.5L15 17.115L9.615 22.5L7.5 20.385L12.885 15L7.5 9.615L9.615 7.5L15 12.885L20.385 7.5L22.5 9.615L17.115 15L22.5 20.385Z"),ne(e,"viewBox","0 0 30 30"),ne(e,"fill","none"),ne(e,"xmlns","http://www.w3.org/2000/svg"),ne(e,"class","svelte-d2loi5")},m(r,i){ki(r,e,i),hr(e,n)},p:xi,i:xi,o:xi,d(r){r&&Ei(e)}}}class eS extends sd{constructor(e){super(),od(this,e,null,kP,id,{})}}function zP(t){let e,n;return{c(){e=jr("img"),ya(e.src,n=t[3]+"area.svg")||ne(e,"src",n),ne(e,"alt",t[6]),ne(e,"class","svelte-ltkwvy")},m(r,i){ki(r,e,i)},p(r,i){i&8&&!ya(e.src,n=r[3]+"area.svg")&&ne(e,"src",n),i&64&&ne(e,"alt",r[6])},d(r){r&&Ei(e)}}}function BP(t){let e,n;return{c(){e=jr("img"),ya(e.src,n=t[3]+"reverse.svg")||ne(e,"src",n),ne(e,"alt",t[6]),ne(e,"class","svelte-ltkwvy")},m(r,i){ki(r,e,i)},p(r,i){i&8&&!ya(e.src,n=r[3]+"reverse.svg")&&ne(e,"src",n),i&64&&ne(e,"alt",r[6])},d(r){r&&Ei(e)}}}function $P(t){let e,n;return{c(){e=jr("img"),ya(e.src,n=t[3]+"poi.svg")||ne(e,"src",n),ne(e,"alt",t[6]),ne(e,"class","svelte-ltkwvy")},m(r,i){ki(r,e,i)},p(r,i){i&8&&!ya(e.src,n=r[3]+"poi.svg")&&ne(e,"src",n),i&64&&ne(e,"alt",r[6])},d(r){r&&Ei(e)}}}function VP(t){let e,n;return{c(){e=jr("img"),ya(e.src,n=t[3]+"postal_code.svg")||ne(e,"src",n),ne(e,"alt",t[6]),ne(e,"class","svelte-ltkwvy")},m(r,i){ki(r,e,i)},p(r,i){i&8&&!ya(e.src,n=r[3]+"postal_code.svg")&&ne(e,"src",n),i&64&&ne(e,"alt",r[6])},d(r){r&&Ei(e)}}}function UP(t){let e,n;return{c(){e=jr("img"),ya(e.src,n=t[3]+"street.svg")||ne(e,"src",n),ne(e,"alt",t[6]),ne(e,"class","svelte-ltkwvy")},m(r,i){ki(r,e,i)},p(r,i){i&8&&!ya(e.src,n=r[3]+"street.svg")&&ne(e,"src",n),i&64&&ne(e,"alt",r[6])},d(r){r&&Ei(e)}}}function GP(t){let e,n;return{c(){e=jr("img"),ya(e.src,n=t[3]+"road.svg")||ne(e,"src",n),ne(e,"alt",t[6]),ne(e,"class","svelte-ltkwvy")},m(r,i){ki(r,e,i)},p(r,i){i&8&&!ya(e.src,n=r[3]+"road.svg")&&ne(e,"src",n),i&64&&ne(e,"alt",r[6])},d(r){r&&Ei(e)}}}function qP(t){let e,n;return{c(){e=jr("img"),ya(e.src,n=t[3]+"housenumber.svg")||ne(e,"src",n),ne(e,"alt",t[6]),ne(e,"class","svelte-ltkwvy")},m(r,i){ki(r,e,i)},p(r,i){i&8&&!ya(e.src,n=r[3]+"housenumber.svg")&&ne(e,"src",n),i&64&&ne(e,"alt",r[6])},d(r){r&&Ei(e)}}}function jP(t){let e,n,r,i;return{c(){e=jr("img"),ya(e.src,n=t[5])||ne(e,"src",n),ne(e,"alt",t[4]),ne(e,"class","svelte-ltkwvy")},m(a,h){ki(a,e,h),r||(i=Va(e,"error",t[14]),r=!0)},p(a,h){h&32&&!ya(e.src,n=a[5])&&ne(e,"src",n),h&16&&ne(e,"alt",a[4])},d(a){a&&Ei(e),r=!1,i()}}}function dE(t){let e,n;return{c(){e=jr("span"),n=kf(t[6]),ne(e,"class","secondary svelte-ltkwvy")},m(r,i){ki(r,e,i),hr(e,n)},p(r,i){i&64&&ky(n,r[6])},d(r){r&&Ei(e)}}}function XP(t){var e,n;let r,i,a,h,u,_,w,C,P=(t[7]?t[0].place_name:t[0].place_name.replace(/,.*/,""))+"",D,B,$=t[2]==="always"||t[2]&&!t[0].address&&((e=t[0].properties)==null?void 0:e.kind)!=="road"&&((n=t[0].properties)==null?void 0:n.kind)!=="road_relation"&&!t[0].id.startsWith("address.")&&!t[0].id.startsWith("postal_code.")&&(!t[0].id.startsWith("poi.")||!t[5])&&!t[7],Z,W,rt=(t[7]?"":t[0].place_name.replace(/[^,]*,?\s*/,""))+"",ct,pt,gt;function Ut(Rt,Yt){var be,Kt;return Yt&1&&(i=null),Yt&1&&(a=null),Yt&1&&(h=null),Rt[5]?jP:Rt[0].address?qP:((be=Rt[0].properties)==null?void 0:be.kind)==="road"||((Kt=Rt[0].properties)==null?void 0:Kt.kind)==="road_relation"?GP:(i==null&&(i=!!Rt[0].id.startsWith("address.")),i?UP:(a==null&&(a=!!Rt[0].id.startsWith("postal_code.")),a?VP:(h==null&&(h=!!Rt[0].id.startsWith("poi.")),h?$P:Rt[7]?BP:zP)))}let zt=Ut(t,-1),Ot=zt(t),At=$&&dE(t);return{c(){r=jr("li"),Ot.c(),u=Gu(),_=jr("span"),w=jr("span"),C=jr("span"),D=kf(P),B=Gu(),At&&At.c(),Z=Gu(),W=jr("span"),ct=kf(rt),ne(C,"class","primary svelte-ltkwvy"),ne(w,"class","svelte-ltkwvy"),ne(W,"class","line2 svelte-ltkwvy"),ne(_,"class","texts svelte-ltkwvy"),ne(r,"tabindex","0"),ne(r,"data-selected",t[1]),ne(r,"class","svelte-ltkwvy"),Vl(r,"selected",t[1])},m(Rt,Yt){ki(Rt,r,Yt),Ot.m(r,null),hr(r,u),hr(r,_),hr(_,w),hr(w,C),hr(C,D),hr(w,B),At&&At.m(w,null),hr(_,Z),hr(_,W),hr(W,ct),pt||(gt=[Va(r,"mouseenter",t[12]),Va(r,"focus",t[13])],pt=!0)},p(Rt,[Yt]){var be,Kt;zt===(zt=Ut(Rt,Yt))&&Ot?Ot.p(Rt,Yt):(Ot.d(1),Ot=zt(Rt),Ot&&(Ot.c(),Ot.m(r,u))),Yt&1&&P!==(P=(Rt[7]?Rt[0].place_name:Rt[0].place_name.replace(/,.*/,""))+"")&&ky(D,P),Yt&37&&($=Rt[2]==="always"||Rt[2]&&!Rt[0].address&&((be=Rt[0].properties)==null?void 0:be.kind)!=="road"&&((Kt=Rt[0].properties)==null?void 0:Kt.kind)!=="road_relation"&&!Rt[0].id.startsWith("address.")&&!Rt[0].id.startsWith("postal_code.")&&(!Rt[0].id.startsWith("poi.")||!Rt[5])&&!Rt[7]),$?At?At.p(Rt,Yt):(At=dE(Rt),At.c(),At.m(w,null)):At&&(At.d(1),At=null),Yt&1&&rt!==(rt=(Rt[7]?"":Rt[0].place_name.replace(/[^,]*,?\s*/,""))+"")&&ky(ct,rt),Yt&2&&ne(r,"data-selected",Rt[1]),Yt&2&&Vl(r,"selected",Rt[1])},i:xi,o:xi,d(Rt){Rt&&Ei(r),Ot.d(),At&&At.d(),pt=!1,Xp(gt)}}}function YP(t,e,n){var r;let i,a,{feature:h}=e,{selected:u=!1}=e,{showPlaceType:_}=e,{missingIconsCache:w}=e,{iconsBaseUrl:C}=e;const P=(r=h.properties)==null?void 0:r.categories;let D,B,$=0,Z=h.place_type[0]==="reverse";function W(gt){B&&w.add(B),n(10,$++,$)}function rt(gt){hE.call(this,t,gt)}function ct(gt){hE.call(this,t,gt)}const pt=gt=>W(gt.currentTarget);return t.$$set=gt=>{"feature"in gt&&n(0,h=gt.feature),"selected"in gt&&n(1,u=gt.selected),"showPlaceType"in gt&&n(2,_=gt.showPlaceType),"missingIconsCache"in gt&&n(9,w=gt.missingIconsCache),"iconsBaseUrl"in gt&&n(3,C=gt.iconsBaseUrl)},t.$$.update=()=>{var gt,Ut,zt,Ot;if(t.$$.dirty&3640)do n(11,i--,i),n(4,D=P==null?void 0:P[i]),n(5,B=D?C+D.replace(/ /g,"_")+".svg":void 0);while(i>-1&&(!B||w.has(B)));t.$$.dirty&1&&n(6,a=h.id.startsWith("poi.")?(Ut=(gt=h.properties)==null?void 0:gt.categories)==null?void 0:Ut.join(", "):((Ot=(zt=h.properties)==null?void 0:zt.place_type_name)==null?void 0:Ot[0])??h.place_type[0])},n(11,i=(P==null?void 0:P.length)??0),[h,u,_,C,D,B,a,Z,W,w,$,i,rt,ct,pt]}class ZP extends sd{constructor(e){super(),od(this,e,YP,XP,id,{feature:0,selected:1,showPlaceType:2,missingIconsCache:9,iconsBaseUrl:3})}}function HP(t){let e;return{c(){e=jr("div"),e.innerHTML='<svg viewBox="0 0 18 18" width="24" height="24" class="svelte-7cmwmc"><path fill="#333" d="M4.4 4.4l.8.8c2.1-2.1 5.5-2.1 7.6 0l.8-.8c-2.5-2.5-6.7-2.5-9.2 0z"></path><path opacity=".1" d="M12.8 12.9c-2.1 2.1-5.5 2.1-7.6 0-2.1-2.1-2.1-5.5 0-7.7l-.8-.8c-2.5 2.5-2.5 6.7 0 9.2s6.6 2.5 9.2 0 2.5-6.6 0-9.2l-.8.8c2.2 2.1 2.2 5.6 0 7.7z"></path></svg>',ne(e,"class","svelte-7cmwmc")},m(n,r){ki(n,e,r)},p:xi,i:xi,o:xi,d(n){n&&Ei(e)}}}class WP extends sd{constructor(e){super(),od(this,e,null,HP,id,{})}}function JP(t){let e,n,r;return{c(){e=Ac("svg"),n=Ac("path"),ne(n,"stroke-width","4"),ne(n,"d","M 5,33.103579 C 5,17.607779 18.457,5 35,5 C 51.543,5 65,17.607779 65,33.103579 C 65,56.388679 40.4668,76.048179 36.6112,79.137779 C 36.3714,79.329879 36.2116,79.457979 36.1427,79.518879 C 35.8203,79.800879 35.4102,79.942779 35,79.942779 C 34.5899,79.942779 34.1797,79.800879 33.8575,79.518879 C 33.7886,79.457979 33.6289,79.330079 33.3893,79.138079 C 29.5346,76.049279 5,56.389379 5,33.103579 Z M 35.0001,49.386379 C 43.1917,49.386379 49.8323,42.646079 49.8323,34.331379 C 49.8323,26.016779 43.1917,19.276479 35.0001,19.276479 C 26.8085,19.276479 20.1679,26.016779 20.1679,34.331379 C 20.1679,42.646079 26.8085,49.386379 35.0001,49.386379 Z"),ne(n,"class","svelte-gzo3ar"),ne(e,"width",r=t[0]==="list"?20:void 0),ne(e,"viewBox","0 0 70 85"),ne(e,"fill","none"),ne(e,"class","svelte-gzo3ar"),Vl(e,"in-map",t[0]!=="list"),Vl(e,"list-icon",t[0]==="list")},m(i,a){ki(i,e,a),hr(e,n)},p(i,[a]){a&1&&r!==(r=i[0]==="list"?20:void 0)&&ne(e,"width",r),a&1&&Vl(e,"in-map",i[0]!=="list"),a&1&&Vl(e,"list-icon",i[0]==="list")},i:xi,o:xi,d(i){i&&Ei(e)}}}function KP(t,e,n){let{displayIn:r}=e;return t.$$set=i=>{"displayIn"in i&&n(0,r=i.displayIn)},[r]}class QP extends sd{constructor(e){super(),od(this,e,KP,JP,id,{displayIn:0})}}function tM(t){let e,n;return{c(){e=Ac("svg"),n=Ac("path"),ne(n,"d","M30.003-26.765C13.46-26.765 0-14.158 0 1.337c0 23.286 24.535 42.952 28.39 46.04.24.192.402.316.471.376.323.282.732.424 1.142.424.41 0 .82-.142 1.142-.424.068-.06.231-.183.471-.376 3.856-3.09 28.39-22.754 28.39-46.04 0-15.495-13.46-28.102-30.003-28.102Zm1.757 12.469c4.38 0 7.858 1.052 10.431 3.158 2.595 2.105 3.89 4.913 3.89 8.422 0 2.34-.53 4.362-1.593 6.063-1.063 1.702-3.086 3.616-6.063 5.742-2.042 1.51-3.337 2.659-3.89 3.446-.532.787-.8 1.82-.8 3.096v1.914h-8.449V15.18c0-2.041.434-3.815 1.306-5.325.872-1.51 2.467-3.118 4.785-4.82 2.233-1.594 3.7-2.89 4.402-3.889a5.582 5.582 0 0 0 1.087-3.35c0-1.382-.51-2.435-1.531-3.158-1.02-.723-2.45-1.087-4.28-1.087-3.19 0-6.826 1.047-10.91 3.131l-3.472-6.986c4.742-2.659 9.77-3.992 15.087-3.992Zm-1.88 37.324c1.765 0 3.124.472 4.08 1.408.98.936 1.47 2.276 1.47 4.02 0 1.68-.49 3.007-1.47 3.985-.977.957-2.336 1.435-4.08 1.435-1.787 0-3.171-.465-4.15-1.4-.978-.958-1.47-2.298-1.47-4.02 0-1.787.48-3.14 1.436-4.054.957-.915 2.355-1.374 4.184-1.374Z"),ne(e,"viewBox","0 0 60.006 21.412"),ne(e,"width","14"),ne(e,"height","20"),ne(e,"class","svelte-en2qvf")},m(r,i){ki(r,e,i),hr(e,n)},p:xi,i:xi,o:xi,d(r){r&&Ei(e)}}}class eM extends sd{constructor(e){super(),od(this,e,null,tM,id,{})}}function nM(t){let e,n,r;return{c(){e=Ac("svg"),n=Ac("circle"),r=Ac("path"),ne(n,"cx","4.789"),ne(n,"cy","4.787"),ne(n,"r","3.85"),fv(n,"stroke-width","1.875"),fv(n,"fill","none"),ne(r,"d","M12.063 12.063 7.635 7.635"),fv(r,"stroke-width","1.875"),fv(r,"stroke-linecap","round"),ne(e,"xmlns","http://www.w3.org/2000/svg"),ne(e,"width","13"),ne(e,"height","13"),ne(e,"viewBox","0 0 13 13"),ne(e,"class","svelte-1bpbt60")},m(i,a){ki(i,e,a),hr(e,n),hr(e,r)},p:xi,i:xi,o:xi,d(i){i&&Ei(e)}}}class rM extends sd{constructor(e){super(),od(this,e,null,nM,id,{})}}function iM(t,e,n){const r=e[1],i=e[0],a=r-i;return t===r&&n?t:((t-i)%a+a)%a+i}function gE(t){const e=[...t];return e[2]<e[0]&&(e[2]+=360),e}let Ty;async function oM(t,e,n){const r=t==null?void 0:t.getCenterAndZoom();for(const i of e??[])if(!(r&&(i.minZoom!=null&&i.minZoom>r[0]||i.maxZoom!=null&&i.maxZoom<r[0]))){if(i.type==="fixed")return i.coordinates.join(",");t:if(i.type==="client-geolocation"){if(Ty&&i.cachedLocationExpiry&&Ty.time+i.cachedLocationExpiry>Date.now()){if(!Ty.coords)break t;return Ty.coords}let a;try{return a=await new Promise((h,u)=>{n.signal.addEventListener("abort",()=>{u(Error("aborted"))}),navigator.geolocation.getCurrentPosition(_=>{h([_.coords.longitude,_.coords.latitude].map(w=>w.toFixed(6)).join(","))},_=>{u(_)},i)}),a}catch{}finally{i.cachedLocationExpiry&&(Ty={time:Date.now(),coords:a})}if(n.signal.aborted)return}if(i.type==="server-geolocation")return"ip";if(r&&i.type==="map-center")return r[1].toFixed(6)+","+r[2].toFixed(6)}}const mE=/(NORTH|SOUTH|[NS])?[\s]*([+-]?[0-8]?[0-9](?:[\.,]\d{3,}))[\s]*([•º°]?)[\s]*(NORTH|SOUTH|[NS])?[\s]*[,/;]?[\s]*(EAST|WEST|[EW])?[\s]*([+-]?[0-1]?[0-9]?[0-9](?:[\.,]\d{3,}))[\s]*([•º°]?)[\s]*(EAST|WEST|[EW])?/i,yE=/(NORTH|SOUTH|[NS])?\s*([+-]?[0-8]?[0-9])\s*(\.)\s*([0-5]?[0-9])\s*(\.)\s*((?:[0-5]?[0-9])(?:[\.,]\d{1,3})?)?\s*(NORTH|SOUTH|[NS])?(?:\s*[,/;]\s*|\s*)(EAST|WEST|[EW])?\s*([+-]?[0-1]?[0-9]?[0-9])\s*(\.)\s*([0-5]?[0-9])\s*(\.)\s*((?:[0-5]?[0-9])(?:[\.,]\d{1,3})?)?\s*(EAST|WEST|[EW])?/i,_E=/(NORTH|SOUTH|[NS])?\s*([+-]?[0-8]?[0-9])\s*(D(?:EG)?(?:REES)?)\s*([0-5]?[0-9])\s*(M(?:IN)?(?:UTES)?)\s*((?:[0-5]?[0-9])(?:[\.,]\d{1,3})?)?\s*(S(?:EC)?(?:ONDS)?)?\s*(NORTH|SOUTH|[NS])?(?:\s*[,/;]\s*|\s*)(EAST|WEST|[EW])?\s*([+-]?[0-1]?[0-9]?[0-9])\s*(D(?:EG)?(?:REES)?)\s*([0-5]?[0-9])\s*(M(?:IN)?(?:UTES)?)\s*((?:[0-5]?[0-9])(?:[\.,]\d{1,3})?)?\s*(S(?:EC)?(?:ONDS)?)\s*(EAST|WEST|[EW])?/i,vE=/(NORTH|SOUTH|[NS])?\s*([+-]?[0-8]?[0-9])\s*([•º°\.:]|D(?:EG)?(?:REES)?)?\s*,?([0-5]?[0-9](?:[\.,]\d{1,})?)?\s*(['′´’\.:]|M(?:IN)?(?:UTES)?)?\s*,?((?:[0-5]?[0-9])(?:[\.,]\d{1,3})?)?\s*(''|′′|’’|´´|["″”\.])?\s*(NORTH|SOUTH|[NS])?(?:\s*[,/;]\s*|\s*)(EAST|WEST|[EW])?\s*([+-]?[0-1]?[0-9]?[0-9])\s*([•º°\.:]|D(?:EG)?(?:REES)?)?\s*,?([0-5]?[0-9](?:[\.,]\d{1,})?)?\s*(['′´’\.:]|M(?:IN)?(?:UTES)?)?\s*,?((?:[0-5]?[0-9])(?:[\.,]\d{1,3})?)?\s*(''|′′|´´|’’|["″”\.])?\s*(EAST|WEST|[EW])?/i;function sM(t){if(!["DMS","DM","DD"].includes(t))throw new Error("invalid format specified");if(this.decimalCoordinates&&this.decimalCoordinates.trim()){if(t=="DD")return this.decimalCoordinates;const e=this.decimalCoordinates.split(",").map(h=>Number(h.trim()));let n=xE(e[0],t),r=xE(e[1],t);n.endsWith('.0"')&&r.endsWith('.0"')&&(n=n.replace(/\.0"$/,'"'),r=r.replace(/\.0"$/,'"'));const i=e[0]>=0?" N":" S",a=e[1]>=0?" E":" W";return`${n+i}, ${r+a}`}else throw new Error("no decimal coordinates to convert")}function xE(t,e){const n=Math.abs(t),r=Math.floor(n),i=(n-r)*60;if(e=="DM"){let u=aM(i,3).toFixed(3).padStart(6,"0");return`${r}° ${u}'`}let a=Math.floor(i),h=((i-a)*60).toFixed(1).padStart(4,"0");return a=a.toString().padStart(2,"0"),`${r}° ${a}' ${h}"`}function aM(t,e){const n=Math.pow(10,e);return Math.round((t+Number.EPSILON)*n)/n}function vb(t,e){e||(e=5),t=t.replace(/\s+/g," ").trim();let n=null,r=null,i="",a="",h=[],u=!1;if(mE.test(t))if(h=mE.exec(t),u=dv(h),u){if(n=h[2],r=h[6],n.includes(",")&&(n=n.replace(",",".")),r.includes(",")&&(r=r.replace(",",".")),Number(Math.round(n))==Number(n))throw new Error("integer only coordinate provided");if(Number(Math.round(r))==Number(r))throw new Error("integer only coordinate provided");h[1]?(i=h[1],a=h[5]):h[4]&&(i=h[4],a=h[8])}else throw new Error("invalid decimal coordinate format");else if(yE.test(t))if(h=yE.exec(t),u=dv(h),u)n=Math.abs(parseInt(h[2])),h[4]&&(n+=h[4]/60),h[6]&&(n+=h[6].replace(",",".")/3600),parseInt(h[2])<0&&(n=-1*n),r=Math.abs(parseInt(h[9])),h[11]&&(r+=h[11]/60),h[13]&&(r+=h[13].replace(",",".")/3600),parseInt(h[9])<0&&(r=-1*r),h[1]?(i=h[1],a=h[8]):h[7]&&(i=h[7],a=h[14]);else throw new Error("invalid DMS coordinates format");else if(_E.test(t))if(h=_E.exec(t),u=dv(h),u)n=Math.abs(parseInt(h[2])),h[4]&&(n+=h[4]/60),h[6]&&(n+=h[6]/3600),parseInt(h[2])<0&&(n=-1*n),r=Math.abs(parseInt(h[10])),h[12]&&(r+=h[12]/60),h[14]&&(r+=h[14]/3600),parseInt(h[10])<0&&(r=-1*r),h[1]?(i=h[1],a=h[9]):h[8]&&(i=h[8],a=h[16]);else throw new Error("invalid DMS coordinates format");else if(vE.test(t))if(h=vE.exec(t),u=dv(h),u)n=Math.abs(parseInt(h[2])),h[4]&&(n+=h[4]/60),h[6]&&(n+=h[6]/3600),parseInt(h[2])<0&&(n=-1*n),r=Math.abs(parseInt(h[10])),h[12]&&(r+=h[12]/60),h[14]&&(r+=h[14]/3600),parseInt(h[10])<0&&(r=-1*r),h[1]?(i=h[1],a=h[9]):h[8]&&(i=h[8],a=h[16]);else throw new Error("invalid coordinates format");if(u){if(Math.abs(r)>=180)throw new Error("invalid longitude value");if(Math.abs(n)>=90)throw new Error("invalid latitude value");if((i||a)&&(!i||!a))throw new Error("invalid coordinates format");if(i&&i==a)throw new Error("invalid coordinates format");let _=/S|SOUTH/i;_.test(i)&&n>0&&(n=-1*n),_=/W|WEST/i,_.test(a)&&r>0&&(r=-1*r);const w=h[0].trim();let C,P;const D=/[,/;\u0020]/g,B=w.match(D);if(B==null){const W=Math.floor(t.length/2);C=w.substring(0,W).trim(),P=w.substring(W).trim()}else{let W;B.length%2==1?W=Math.floor(B.length/2):W=B.length/2-1;let rt=0;if(W==0)rt=w.indexOf(B[0]),C=w.substring(0,rt).trim(),P=w.substring(rt+1).trim();else{let ct=0,pt=0;for(;ct<=W;)rt=w.indexOf(B[ct],pt),pt=rt+1,ct++;C=w.substring(0,rt).trim(),P=w.substring(rt+1).trim()}}const $=C.split(".");if($.length==2&&$[1]==0&&$[1].length!=2)throw new Error("invalid coordinates format");const Z=P.split(".");if(Z.length==2&&Z[1]==0&&Z[1].length!=2)throw new Error("invalid coordinates format");if(/^\d+$/.test(C)||/^\d+$/.test(P))throw new Error("degree only coordinate/s provided");return isNaN(n)&&n.includes(",")&&(n=n.replace(",",".")),n=Number(Number(n).toFixed(e)),isNaN(r)&&r.includes(",")&&(r=r.replace(",",".")),r=Number(Number(r).toFixed(e)),Object.freeze({verbatimCoordinates:w,verbatimLatitude:C,verbatimLongitude:P,decimalLatitude:n,decimalLongitude:r,decimalCoordinates:`${n},${r}`,closeEnough:uM,toCoordinateFormat:sM})}else throw new Error("coordinates pattern match failed")}function dv(t){if(!isNaN(t[0]))return!1;const e=[...t];if(e.shift(),e.length%2>0)return!1;const n=/^[-+]?\d+([\.,]\d+)?$/,r=/[eastsouthnorthwest]+/i,i=e.length/2;for(let a=0;a<i;a++){const h=e[a],u=e[a+i],_=n.test(h)&&n.test(u),w=r.test(h)&&r.test(u),C=h==u;if(!(h==null&&u==null)){if(h==null||u==null)return!1;if(_||w||C)continue;return!1}}return!0}function bE(t,e){const n=Math.abs(t-e);return Number(n.toFixed(6))<=1e-5}function uM(t){if(t.includes(",")){const e=t.split(",");if(Number(e[0])==NaN||Number(e[1])==NaN)throw new Error("coords are not valid decimals");return bE(this.decimalLatitude,Number(e[0]))&&bE(this.decimalLongitude,e[1])}else throw new Error("coords being tested must be separated by a comma")}const lM=Object.freeze({DMS:"DMS",DM:"DM",DD:"DD"});vb.to=lM;const cM=[{verbatimCoordinates:"40.123, -74.123",verbatimLatitude:"40.123",verbatimLongitude:"-74.123"},{verbatimCoordinates:"40.123° N 74.123° W",verbatimLatitude:"40.123° N",verbatimLongitude:"74.123° W"},{verbatimCoordinates:"40.123° N 74.123° W",verbatimLatitude:"40.123° N",verbatimLongitude:"74.123° W"},{verbatimCoordinates:'40° 7´ 22.8" N 74° 7´ 22.8" W',verbatimLatitude:'40° 7´ 22.8" N',verbatimLongitude:'74° 7´ 22.8" W'},{verbatimCoordinates:"40° 7.38’ , -74° 7.38’",verbatimLatitude:"40° 7.38’",verbatimLongitude:"-74° 7.38’"},{verbatimCoordinates:"N40°7’22.8’’, W74°7’22.8’’",verbatimLatitude:"N40°7’22.8’’",verbatimLongitude:"W74°7’22.8’’"},{verbatimCoordinates:'40°7’22.8"N, 74°7’22.8"W',verbatimLatitude:'40°7’22.8"N',verbatimLongitude:'74°7’22.8"W'},{verbatimCoordinates:`40°7'22.8"N, 74°7'22.8"W`,verbatimLatitude:`40°7'22.8"N`,verbatimLongitude:`74°7'22.8"W`},{verbatimCoordinates:"40 7 22.8, -74 7 22.8",verbatimLatitude:"40 7 22.8",verbatimLongitude:"-74 7 22.8"},{verbatimCoordinates:"40.123 -74.123",verbatimLatitude:"40.123",verbatimLongitude:"-74.123"},{verbatimCoordinates:"40.123°,-74.123°",verbatimLatitude:"40.123°",verbatimLongitude:"-74.123°"},{verbatimCoordinates:"40.123N74.123W",verbatimLatitude:"40.123N",verbatimLongitude:"74.123W"},{verbatimCoordinates:"4007.38N7407.38W",verbatimLatitude:"4007.38N",verbatimLongitude:"7407.38W"},{verbatimCoordinates:'40°7’22.8"N, 74°7’22.8"W',verbatimLatitude:'40°7’22.8"N',verbatimLongitude:'74°7’22.8"W'},{verbatimCoordinates:"400722.8N740722.8W",verbatimLatitude:"400722.8N",verbatimLongitude:"740722.8W"},{verbatimCoordinates:"N 40 7.38 W 74 7.38",verbatimLatitude:"N 40 7.38",verbatimLongitude:"W 74 7.38"},{verbatimCoordinates:"40:7:22.8N 74:7:22.8W",verbatimLatitude:"40:7:22.8N",verbatimLongitude:"74:7:22.8W"},{verbatimCoordinates:"40:7:23N,74:7:23W",verbatimLatitude:"40:7:23N",verbatimLongitude:"74:7:23W",decimalLatitude:40.1230555555,decimalLongitude:-74.1230555555},{verbatimCoordinates:'40°7’23"N 74°7’23"W',verbatimLatitude:'40°7’23"N',verbatimLongitude:'74°7’23"W',decimalLatitude:40.1230555555,decimalLongitude:-74.12305555555555},{verbatimCoordinates:'40°7’23"S 74°7’23"E',verbatimLatitude:'40°7’23"S',verbatimLongitude:'74°7’23"E',decimalLatitude:-40.1230555555,decimalLongitude:74.12305555555555},{verbatimCoordinates:'40°7’23" -74°7’23"',verbatimLatitude:'40°7’23"',verbatimLongitude:'-74°7’23"',decimalLatitude:40.1230555555,decimalLongitude:-74.123055555},{verbatimCoordinates:'40d 7’ 23" N 74d 7’ 23" W',verbatimLatitude:'40d 7’ 23" N',verbatimLongitude:'74d 7’ 23" W',decimalLatitude:40.1230555555,decimalLongitude:-74.123055555},{verbatimCoordinates:"40.123N 74.123W",verbatimLatitude:"40.123N",verbatimLongitude:"74.123W"},{verbatimCoordinates:"40° 7.38, -74° 7.38",verbatimLatitude:"40° 7.38",verbatimLongitude:"-74° 7.38"},{verbatimCoordinates:"40° 7.38, -74° 7.38",verbatimLatitude:"40° 7.38",verbatimLongitude:"-74° 7.38"},{verbatimCoordinates:"40 7 22.8; -74 7 22.8",verbatimLatitude:"40 7 22.8",verbatimLongitude:"-74 7 22.8"}],hM={decimalLatitude:40.123,decimalLongitude:-74.123},pM=[{verbatimCoordinates:`50°4'17.698"south, 14°24'2.826"east`,verbatimLatitude:`50°4'17.698"south`,verbatimLongitude:`14°24'2.826"east`,decimalLatitude:-50.07158277777778,decimalLongitude:14.400785},{verbatimCoordinates:"50d4m17.698S 14d24m2.826E",verbatimLatitude:"50d4m17.698S",verbatimLongitude:"14d24m2.826E",decimalLatitude:-50.07158277777778,decimalLongitude:14.400785},{verbatimCoordinates:"40:26:46N,79:56:55W",verbatimLatitude:"40:26:46N",verbatimLongitude:"79:56:55W",decimalLatitude:40.44611111111111,decimalLongitude:-79.9486111111111},{verbatimCoordinates:"40:26:46.302N 79:56:55.903W",verbatimLatitude:"40:26:46.302N",verbatimLongitude:"79:56:55.903W",decimalLatitude:40.446195,decimalLongitude:-79.94886194444445},{verbatimCoordinates:"40°26′47″N 79°58′36″W",verbatimLatitude:"40°26′47″N",verbatimLongitude:"79°58′36″W",decimalLatitude:40.44638888888889,decimalLongitude:-79.97666666666667},{verbatimCoordinates:"40d 26′ 47″ N 79d 58′ 36″ W",verbatimLatitude:"40d 26′ 47″ N",verbatimLongitude:"79d 58′ 36″ W",decimalLatitude:40.44638888888889,decimalLongitude:-79.97666666666667},{verbatimCoordinates:"40.446195N 79.948862W",verbatimLatitude:"40.446195N",verbatimLongitude:"79.948862W",decimalLatitude:40.446195,decimalLongitude:-79.948862},{verbatimCoordinates:"40,446195° 79,948862°",verbatimLatitude:"40,446195°",verbatimLongitude:"79,948862°",decimalLatitude:40.446195,decimalLongitude:79.948862},{verbatimCoordinates:"40° 26.7717, -79° 56.93172",verbatimLatitude:"40° 26.7717",verbatimLongitude:"-79° 56.93172",decimalLatitude:40.446195,decimalLongitude:-79.948862},{verbatimCoordinates:"40.446195, -79.948862",verbatimLatitude:"40.446195",verbatimLongitude:"-79.948862",decimalLatitude:40.446195,decimalLongitude:-79.948862},{verbatimCoordinates:"40.123256; -74.123256",verbatimLatitude:"40.123256",verbatimLongitude:"-74.123256",decimalLatitude:40.123256,decimalLongitude:-74.123256},{verbatimCoordinates:"18°24S 22°45E",verbatimLatitude:"18°24S",verbatimLongitude:"22°45E",decimalLatitude:-18.4,decimalLongitude:22.75}],fM=[{verbatimCoordinates:"10.432342S 10.6345345E",verbatimLatitude:"10.432342S",verbatimLongitude:"10.6345345E",decimalLatitude:-10.432342,decimalLongitude:10.6345345},{verbatimCoordinates:"10.00S 10.00E",verbatimLatitude:"10.00S",verbatimLongitude:"10.00E",decimalLatitude:-10,decimalLongitude:10},{verbatimCoordinates:"00.00S 01.00E",verbatimLatitude:"00.00S",verbatimLongitude:"01.00E",decimalLatitude:0,decimalLongitude:1},{verbatimCoordinates:"18.24S 22.45E",verbatimLatitude:"18.24S",verbatimLongitude:"22.45E",decimalLatitude:-18.4,decimalLongitude:22.75},{verbatimCoordinates:"27deg 15min 45.2sec S 18deg 32min 53.7sec E",verbatimLatitude:"27deg 15min 45.2sec S",verbatimLongitude:"18deg 32min 53.7sec E",decimalLatitude:-27.262555555555554,decimalLongitude:18.54825},{verbatimCoordinates:"-23.3245° S / 28.2344° E",verbatimLatitude:"-23.3245° S",verbatimLongitude:"28.2344° E",decimalLatitude:-23.3245,decimalLongitude:28.2344},{verbatimCoordinates:"40° 26.7717 -79° 56.93172",verbatimLatitude:"40° 26.7717",verbatimLongitude:"-79° 56.93172",decimalLatitude:40.446195,decimalLongitude:-79.948862},{verbatimCoordinates:"27.15.45S 18.32.53E",verbatimLatitude:"27.15.45S",verbatimLongitude:"18.32.53E",decimalLatitude:-27.2625,decimalLongitude:18.548055},{verbatimCoordinates:"-27.15.45 18.32.53",verbatimLatitude:"-27.15.45",verbatimLongitude:"18.32.53",decimalLatitude:-27.2625,decimalLongitude:18.548055},{verbatimCoordinates:"27.15.45.2S 18.32.53.4E",verbatimLatitude:"27.15.45.2S",verbatimLongitude:"18.32.53.4E",decimalLatitude:-27.262556,decimalLongitude:18.548167},{verbatimCoordinates:"27.15.45,2S 18.32.53,4E",verbatimLatitude:"27.15.45,2S",verbatimLongitude:"18.32.53,4E",decimalLatitude:-27.262556,decimalLongitude:18.548167},{verbatimCoordinates:"S23.43563 °  E22.45634 °",verbatimLatitude:"S23.43563 °",verbatimLongitude:"E22.45634 °",decimalLatitude:-23.43563,decimalLongitude:22.45634},{verbatimCoordinates:"27,71372° S 23,07771° E",verbatimLatitude:"27,71372° S",verbatimLongitude:"23,07771° E",decimalLatitude:-27.71372,decimalLongitude:23.07771},{verbatimCoordinates:"27.45.34 S 23.23.23 E",verbatimLatitude:"27.45.34 S",verbatimLongitude:"23.23.23 E",decimalLatitude:-27.759444,decimalLongitude:23.38972222},{verbatimCoordinates:"S 27.45.34 E 23.23.23",verbatimLatitude:"S 27.45.34",verbatimLongitude:"E 23.23.23",decimalLatitude:-27.759444,decimalLongitude:23.38972222}];function dM(){const t=[];return cM.forEach(e=>{e.decimalLatitude?t.push(e):t.push({...e,...hM})}),[...t,...pM,...fM]}const gM=dM();vb.formats=gM.map(t=>t.verbatimCoordinates);const mM=vb;function wE(t,e,n){const r=t.slice();return r[81]=e[n],r[83]=n,r}function EE(t){let e,n;return e=new WP({}),{c(){zf(e.$$.fragment)},m(r,i){Sp(e,r,i),n=!0},i(r){n||(vo(e.$$.fragment,r),n=!0)},o(r){ys(e.$$.fragment,r),n=!1},d(r){Cp(e,r)}}}function IE(t){let e,n,r,i,a;return n=new eM({}),{c(){e=jr("button"),zf(n.$$.fragment),ne(e,"type","button"),ne(e,"title",t[9]),ne(e,"class","svelte-zh3kmv"),Vl(e,"active",t[0])},m(h,u){ki(h,e,u),Sp(n,e,null),r=!0,i||(a=Va(e,"click",t[67]),i=!0)},p(h,u){(!r||u[0]&512)&&ne(e,"title",h[9]),(!r||u[0]&1)&&Vl(e,"active",h[0])},i(h){r||(vo(n.$$.fragment,h),r=!0)},o(h){ys(n.$$.fragment,h),r=!1},d(h){h&&Ei(e),Cp(n),i=!1,a()}}}function yM(t){let e,n=[],r=new Map,i,a,h,u=fE(t[14]);const _=w=>w[81].id+(w[81].address?","+w[81].address:"");for(let w=0;w<u.length;w+=1){let C=wE(t,u,w),P=_(C);r.set(P,n[w]=SE(P,C))}return{c(){e=jr("ul");for(let w=0;w<n.length;w+=1)n[w].c();ne(e,"class","svelte-zh3kmv")},m(w,C){ki(w,e,C);for(let P=0;P<n.length;P+=1)n[P]&&n[P].m(e,null);i=!0,a||(h=[Va(e,"mouseleave",t[71]),Va(e,"blur",t[72])],a=!0)},p(w,C){C[0]&17880064&&(u=fE(w[14]),Cv(),n=DP(n,C,_,1,w,u,r,e,AP,SE,null,wE),Tv())},i(w){if(!i){for(let C=0;C<u.length;C+=1)vo(n[C]);i=!0}},o(w){for(let C=0;C<n.length;C+=1)ys(n[C]);i=!1},d(w){w&&Ei(e);for(let C=0;C<n.length;C+=1)n[C].d();a=!1,Xp(h)}}}function _M(t){let e,n,r,i,a,h;return n=new eS({}),{c(){e=jr("div"),zf(n.$$.fragment),r=Gu(),i=jr("div"),a=kf(t[7]),ne(i,"class","svelte-zh3kmv"),ne(e,"class","no-results svelte-zh3kmv")},m(u,_){ki(u,e,_),Sp(n,e,null),hr(e,r),hr(e,i),hr(i,a),h=!0},p(u,_){(!h||_[0]&128)&&ky(a,u[7])},i(u){h||(vo(n.$$.fragment,u),h=!0)},o(u){ys(n.$$.fragment,u),h=!1},d(u){u&&Ei(e),Cp(n)}}}function vM(t){let e="",n;return{c(){n=kf(e)},m(r,i){ki(r,n,i)},p:xi,i:xi,o:xi,d(r){r&&Ei(n)}}}function xM(t){let e,n,r,i,a,h,u,_,w,C,P;return n=new eS({}),_=new tS({}),{c(){e=jr("div"),zf(n.$$.fragment),r=Gu(),i=jr("div"),a=kf(t[6]),h=Gu(),u=jr("button"),zf(_.$$.fragment),ne(i,"class","svelte-zh3kmv"),ne(u,"class","svelte-zh3kmv"),ne(e,"class","error svelte-zh3kmv")},m(D,B){ki(D,e,B),Sp(n,e,null),hr(e,r),hr(e,i),hr(i,a),hr(e,h),hr(e,u),Sp(_,u,null),w=!0,C||(P=Va(u,"click",t[68]),C=!0)},p(D,B){(!w||B[0]&64)&&ky(a,D[6])},i(D){w||(vo(n.$$.fragment,D),vo(_.$$.fragment,D),w=!0)},o(D){ys(n.$$.fragment,D),ys(_.$$.fragment,D),w=!1},d(D){D&&Ei(e),Cp(n),Cp(_),C=!1,P()}}}function SE(t,e){let n,r,i;function a(){return e[69](e[83])}function h(){return e[70](e[81])}return r=new ZP({props:{feature:e[81],showPlaceType:e[10],selected:e[15]===e[83],missingIconsCache:e[20],iconsBaseUrl:e[12]}}),r.$on("mouseenter",a),r.$on("focus",h),{key:t,first:null,c(){n=wP(),zf(r.$$.fragment),this.first=n},m(u,_){ki(u,n,_),Sp(r,u,_),i=!0},p(u,_){e=u;const w={};_[0]&16384&&(w.feature=e[81]),_[0]&1024&&(w.showPlaceType=e[10]),_[0]&49152&&(w.selected=e[15]===e[83]),_[0]&4096&&(w.iconsBaseUrl=e[12]),r.$set(w)},i(u){i||(vo(r.$$.fragment,u),i=!0)},o(u){ys(r.$$.fragment,u),i=!1},d(u){u&&Ei(n),Cp(r,u)}}}function bM(t){let e,n,r,i,a,h,u,_,w,C,P,D,B,$,Z,W,rt,ct,pt,gt,Ut,zt=!1;a=new rM({}),P=new tS({});let Ot=t[19]&&EE(),At=t[5]===!0&&IE(t);const Rt=t[59].default,Yt=_P(Rt,t,t[58],null),be=[xM,vM,_M,yM],Kt=[];function Ke(vt,Qt){var Te,Ge;return vt[18]?0:vt[16]?((Te=vt[14])==null?void 0:Te.length)===0?2:vt[16]&&(Ge=vt[14])!=null&&Ge.length?3:-1:1}return~(W=Ke(t))&&(rt=Kt[W]=be[W](t)),{c(){e=Gu(),n=jr("form"),r=jr("div"),i=jr("button"),zf(a.$$.fragment),h=Gu(),u=jr("input"),_=Gu(),w=jr("div"),C=jr("button"),zf(P.$$.fragment),D=Gu(),Ot&&Ot.c(),B=Gu(),At&&At.c(),$=Gu(),Yt&&Yt.c(),Z=Gu(),rt&&rt.c(),ne(i,"class","search-button svelte-zh3kmv"),ne(i,"type","button"),ne(u,"placeholder",t[8]),ne(u,"aria-label",t[8]),ne(u,"class","svelte-zh3kmv"),ne(C,"type","button"),ne(C,"title",t[3]),ne(C,"class","svelte-zh3kmv"),ne(w,"class","clear-button-container svelte-zh3kmv"),Vl(w,"displayable",t[1]!==""),ne(r,"class","input-group svelte-zh3kmv"),ne(n,"tabindex","0"),ne(n,"class",ct=lE(t[2])+" svelte-zh3kmv"),Vl(n,"can-collapse",t[4]&&t[1]==="")},m(vt,Qt){ki(vt,e,Qt),ki(vt,n,Qt),hr(n,r),hr(r,i),Sp(a,i,null),hr(r,h),hr(r,u),t[61](u),cE(u,t[1]),hr(r,_),hr(r,w),hr(w,C),Sp(P,C,null),hr(w,D),Ot&&Ot.m(w,null),hr(r,B),At&&At.m(r,null),hr(r,$),Yt&&Yt.m(r,null),hr(n,Z),~W&&Kt[W].m(n,null),pt=!0,gt||(Ut=[Va(i,"click",t[60]),Va(u,"input",t[62]),Va(u,"focus",t[63]),Va(u,"blur",t[64]),Va(u,"keydown",t[22]),Va(u,"input",t[65]),Va(C,"click",t[66]),Va(n,"submit",EP(t[21]))],gt=!0)},p(vt,Qt){(!pt||Qt[0]&256)&&ne(u,"placeholder",vt[8]),(!pt||Qt[0]&256)&&ne(u,"aria-label",vt[8]),Qt[0]&2&&u.value!==vt[1]&&cE(u,vt[1]),(!pt||Qt[0]&8)&&ne(C,"title",vt[3]),vt[19]?Ot?Qt[0]&524288&&vo(Ot,1):(Ot=EE(),Ot.c(),vo(Ot,1),Ot.m(w,null)):Ot&&(Cv(),ys(Ot,1,1,()=>{Ot=null}),Tv()),(!pt||Qt[0]&2)&&Vl(w,"displayable",vt[1]!==""),vt[5]===!0?At?(At.p(vt,Qt),Qt[0]&32&&vo(At,1)):(At=IE(vt),At.c(),vo(At,1),At.m(r,$)):At&&(Cv(),ys(At,1,1,()=>{At=null}),Tv()),Yt&&Yt.p&&(!pt||Qt[1]&134217728)&&xP(Yt,Rt,vt,vt[58],pt?vP(Rt,vt[58],Qt,null):bP(vt[58]),null);let Te=W;W=Ke(vt),W===Te?~W&&Kt[W].p(vt,Qt):(rt&&(Cv(),ys(Kt[Te],1,1,()=>{Kt[Te]=null}),Tv()),~W?(rt=Kt[W],rt?rt.p(vt,Qt):(rt=Kt[W]=be[W](vt),rt.c()),vo(rt,1),rt.m(n,null)):rt=null),(!pt||Qt[0]&4&&ct!==(ct=lE(vt[2])+" svelte-zh3kmv"))&&ne(n,"class",ct),(!pt||Qt[0]&22)&&Vl(n,"can-collapse",vt[4]&&vt[1]==="")},i(vt){pt||(vo(zt),vo(a.$$.fragment,vt),vo(P.$$.fragment,vt),vo(Ot),vo(At),vo(Yt,vt),vo(rt),pt=!0)},o(vt){ys(zt),ys(a.$$.fragment,vt),ys(P.$$.fragment,vt),ys(Ot),ys(At),ys(Yt,vt),ys(rt),pt=!1},d(vt){vt&&(Ei(e),Ei(n)),Cp(a),t[61](null),Cp(P),Ot&&Ot.d(),At&&At.d(),Yt&&Yt.d(vt),~W&&Kt[W].d(),gt=!1,Xp(Ut)}}}function wM(t,e,n){let r,{$$slots:i={},$$scope:a}=e,{class:h=void 0}=e,{apiKey:u}=e,{bbox:_=void 0}=e,{clearButtonTitle:w="clear"}=e,{clearOnBlur:C=!1}=e,{collapsed:P=!1}=e,{country:D=void 0}=e,{debounceSearch:B=200}=e,{enableReverse:$=!1}=e,{errorMessage:Z="Something went wrong…"}=e,{filter:W=()=>!0}=e,{flyTo:rt=!0}=e,{fuzzyMatch:ct=!0}=e,{language:pt=void 0}=e,{limit:gt=void 0}=e,{mapController:Ut=void 0}=e,{minLength:zt=2}=e,{noResultsMessage:Ot="Oops! Looks like you're trying to predict something that's not quite right. We can't seem to find what you're looking for. Maybe try double-checking your spelling or try a different search term. Keep on typing - we'll do our best to get you where you need to go!"}=e,{placeholder:At="Search"}=e,{proximity:Rt=[{type:"server-geolocation"}]}=e,{reverseActive:Yt=$==="always"}=e,{reverseButtonTitle:be="toggle reverse geocoding"}=e,{searchValue:Kt=""}=e,{showFullGeometry:Ke=!0}=e,{showPlaceType:vt="ifNeeded"}=e,{showResultsWhileTyping:Qt=!0}=e,{selectFirst:Te=!0}=e,{flyToSelected:Ge=!1}=e,{markerOnSelected:gn=!0}=e,{types:xn=void 0}=e,{excludeTypes:ei=!1}=e,{zoom:jn=16}=e,{maxZoom:$n=18}=e,{apiUrl:Fe="https://api.maptiler.com/geocoding"}=e,{fetchParameters:Vn={}}=e,{iconsBaseUrl:rr="https://cdn.maptiler.com/maptiler-geocoding-control/v1.2.2/icons/"}=e,{adjustUrlQuery:ci=q=>{}}=e;function fl(){Ci.focus()}function ks(){Ci.blur()}function br(q,nt=!0){n(1,Kt=q),nt?(n(15,Yn=-1),os()):(uo(),setTimeout(()=>{Ci.focus(),Ci.select()}))}function nn(){n(14,Fn=void 0),n(55,mn=void 0),n(15,Yn=-1)}function dl(){n(54,Xn=[]),n(55,mn=void 0)}let qo=!1,Fn,Xn,mn,Un="",Ci,Yn=-1,no,Vt=[],hi,$i,Gn,vn;const zs=new Set,pi=TP();CP(()=>{Ut&&(Ut.setEventHandler(void 0),Ut.indicateReverse(!1),Ut.setSelectedMarker(-1),Ut.setMarkers(void 0,void 0))});function os(q){if($i&&(clearTimeout($i),$i=void 0),Yn>-1&&Fn)n(55,mn=Fn[Yn]),n(1,Kt=mn.place_type[0]==="reverse"?mn.place_name:mn.place_name.replace(/,.*/,"")),n(18,no=void 0),n(54,Xn=void 0),n(15,Yn=-1);else if(Kt){const nt=q||!Ta(Kt);ra(Kt,{exact:!0}).then(()=>{n(54,Xn=Fn),n(55,mn=void 0),nt&&ss()}).catch(bt=>n(18,no=bt))}}function Ta(q){try{return mM(q,6)}catch{return!1}}async function ra(q,{byId:nt=!1,exact:bt=!1}={}){n(18,no=void 0),hi==null||hi.abort();const ft=new AbortController;n(19,hi=ft);try{const it=Ta(q),dt=new URLSearchParams;if(pt!==void 0&&dt.set("language",Array.isArray(pt)?pt.join(","):pt??""),xn&&dt.set("types",xn.join(",")),ei&&dt.set("excludeTypes",String(ei)),_&&dt.set("bbox",_.map(Pe=>Pe.toFixed(6)).join(",")),D&&dt.set("country",Array.isArray(D)?D.join(","):D),!nt&&!it){const Pe=await oM(Ut,Rt,ft);Pe&&dt.set("proximity",Pe),(bt||!Qt)&&dt.set("autocomplete","false"),dt.set("fuzzyMatch",String(ct))}gt!==void 0&&(!it||(xn==null?void 0:xn.length)===1)&&dt.set("limit",String(gt)),dt.set("key",u),ci(dt);const qt=Fe+"/"+encodeURIComponent(it?it.decimalLongitude+","+it.decimalLatitude:q)+".json?"+dt.toString();if(qt===Un){nt?(n(14,Fn=void 0),n(55,mn=Vt[0])):n(14,Fn=Vt);return}Un=qt;const jt=await fetch(qt,{signal:ft.signal,...Vn});if(!jt.ok)throw new Error(await jt.text());const Xt=await jt.json();pi("response",{url:qt,featureCollection:Xt}),nt?(n(14,Fn=void 0),n(55,mn=Xt.features[0]),Vt=[mn]):(n(14,Fn=Xt.features.filter(W)),it&&Fn.unshift({type:"Feature",properties:{},id:"reverse_"+it.decimalLongitude+"_"+it.decimalLatitude,text:it.decimalLatitude+", "+it.decimalLongitude,place_name:it.decimalLatitude+", "+it.decimalLongitude,place_type:["reverse"],center:[it.decimalLongitude,it.decimalLatitude],bbox:[it.decimalLongitude,it.decimalLatitude,it.decimalLongitude,it.decimalLatitude],geometry:{type:"Point",coordinates:[it.decimalLongitude,it.decimalLatitude]}}),Vt=Fn,it&&Ci.focus())}catch(it){if(it&&typeof it=="object"&&"name"in it&&it.name==="AbortError")return;throw it}finally{ft===hi&&n(19,hi=void 0)}}function ss(){var q;if(!(Xn!=null&&Xn.length)||!rt)return;const nt=[180,90,-180,-90],bt=!Xn.some(ft=>!ft.matching_text);for(const ft of Xn)if(bt||!ft.matching_text)for(const it of[0,1,2,3])nt[it]=Math[it<2?"min":"max"](nt[it],((q=ft.bbox)==null?void 0:q[it])??ft.center[it%2]);Ut&&Xn.length>0&&(mn&&nt[0]===nt[2]&&nt[1]===nt[3]?Ut.flyTo(mn.center,jn):Ut.fitBounds(gE(nt),50,$n))}function ia(q){n(0,Yt=$==="always"),n(14,Fn=void 0),n(55,mn=void 0),n(15,Yn=-1),br(q[1].toFixed(6)+", "+iM(q[0],[-180,180],!0).toFixed(6),!1)}function se(q){if(!Fn)return;let nt=q.key==="ArrowDown"?1:q.key==="ArrowUp"?-1:0;nt&&(Yn===(Te?0:-1)&&nt===-1&&n(15,Yn=Fn.length),n(15,Yn+=nt),Yn>=Fn.length&&n(15,Yn=-1),Yn<0&&Te&&n(15,Yn=0),q.preventDefault())}function uo(q=!0){if(n(18,no=void 0),Qt){if($i&&clearTimeout($i),Kt.length<zt)return;const nt=Kt;$i=window.setTimeout(()=>{ra(nt).catch(bt=>n(18,no=bt))},q?B:0)}else n(14,Fn=void 0),n(18,no=void 0)}function wr(q){n(55,mn=q),n(1,Kt=q.place_name),n(15,Yn=-1)}const Au=()=>Ci.focus();function Co(q){Ux[q?"unshift":"push"](()=>{Ci=q,n(17,Ci)})}function le(){Kt=this.value,n(1,Kt),n(13,qo),n(27,C)}const an=()=>n(13,qo=!0),Ye=()=>n(13,qo=!1),ro=()=>uo(),jo=()=>{n(1,Kt=""),Ci.focus()},je=()=>n(0,Yt=!Yt),as=()=>n(18,no=void 0),ot=q=>n(15,Yn=q),V=q=>wr(q),G=()=>{Te||n(15,Yn=-1)},J=()=>{};return t.$$set=q=>{"class"in q&&n(2,h=q.class),"apiKey"in q&&n(25,u=q.apiKey),"bbox"in q&&n(26,_=q.bbox),"clearButtonTitle"in q&&n(3,w=q.clearButtonTitle),"clearOnBlur"in q&&n(27,C=q.clearOnBlur),"collapsed"in q&&n(4,P=q.collapsed),"country"in q&&n(28,D=q.country),"debounceSearch"in q&&n(29,B=q.debounceSearch),"enableReverse"in q&&n(5,$=q.enableReverse),"errorMessage"in q&&n(6,Z=q.errorMessage),"filter"in q&&n(30,W=q.filter),"flyTo"in q&&n(31,rt=q.flyTo),"fuzzyMatch"in q&&n(32,ct=q.fuzzyMatch),"language"in q&&n(33,pt=q.language),"limit"in q&&n(34,gt=q.limit),"mapController"in q&&n(35,Ut=q.mapController),"minLength"in q&&n(36,zt=q.minLength),"noResultsMessage"in q&&n(7,Ot=q.noResultsMessage),"placeholder"in q&&n(8,At=q.placeholder),"proximity"in q&&n(37,Rt=q.proximity),"reverseActive"in q&&n(0,Yt=q.reverseActive),"reverseButtonTitle"in q&&n(9,be=q.reverseButtonTitle),"searchValue"in q&&n(1,Kt=q.searchValue),"showFullGeometry"in q&&n(38,Ke=q.showFullGeometry),"showPlaceType"in q&&n(10,vt=q.showPlaceType),"showResultsWhileTyping"in q&&n(39,Qt=q.showResultsWhileTyping),"selectFirst"in q&&n(11,Te=q.selectFirst),"flyToSelected"in q&&n(40,Ge=q.flyToSelected),"markerOnSelected"in q&&n(41,gn=q.markerOnSelected),"types"in q&&n(42,xn=q.types),"excludeTypes"in q&&n(43,ei=q.excludeTypes),"zoom"in q&&n(44,jn=q.zoom),"maxZoom"in q&&n(45,$n=q.maxZoom),"apiUrl"in q&&n(46,Fe=q.apiUrl),"fetchParameters"in q&&n(47,Vn=q.fetchParameters),"iconsBaseUrl"in q&&n(12,rr=q.iconsBaseUrl),"adjustUrlQuery"in q&&n(48,ci=q.adjustUrlQuery),"$$scope"in q&&n(58,a=q.$$scope)},t.$$.update=()=>{if(t.$$.dirty[0]&134225920&&setTimeout(()=>{n(16,Gn=qo),C&&!qo&&n(1,Kt="")}),t.$$.dirty[0]&16386|t.$$.dirty[1]&32&&Kt.length<zt&&(n(55,mn=void 0),n(14,Fn=void 0),n(18,no=void 0),n(54,Xn=Fn)),t.$$.dirty[1]&16777344&&Ke&&mn&&!mn.address&&mn.geometry.type==="Point"&&mn.place_type[0]!=="reverse"&&ra(mn.id,{byId:!0}).catch(q=>n(18,no=q)),t.$$.dirty[1]&50356241&&(Ut&&mn&&mn.id!==vn&&rt&&(!mn.bbox||mn.bbox[0]===mn.bbox[2]&&mn.bbox[1]===mn.bbox[3]?Ut.flyTo(mn.center,mn.id.startsWith("poi.")||mn.id.startsWith("address.")?$n:jn):Ut.fitBounds(gE(mn.bbox),50,$n),n(14,Fn=void 0),n(54,Xn=void 0),n(15,Yn=-1)),n(56,vn=mn==null?void 0:mn.id)),t.$$.dirty[0]&18432&&Te&&Fn!=null&&Fn.length&&n(15,Yn=0),t.$$.dirty[0]&2050&&(Te||n(15,Yn=-1)),t.$$.dirty[0]&16384|t.$$.dirty[1]&8388608&&Xn!==Fn&&n(54,Xn=void 0),t.$$.dirty[0]&81921|t.$$.dirty[1]&8388624&&Ut&&Ut.setEventHandler(q=>{switch(q.type){case"mapClick":Yt&&ia(q.coordinates);break;case"markerClick":{const nt=Fn==null?void 0:Fn.find(bt=>bt.id===q.id);nt&&wr(nt)}break;case"markerMouseEnter":Xn&&n(15,Yn=Gn?(Fn==null?void 0:Fn.findIndex(nt=>nt.id===q.id))??-1:-1);break;case"markerMouseLeave":Xn&&n(15,Yn=-1);break}}),t.$$.dirty[0]&49152&&n(57,r=Fn==null?void 0:Fn[Yn]),t.$$.dirty[1]&67133969&&Ut&&r&&rt&&Ge&&Ut.flyTo(r.center,r.id.startsWith("poi.")||r.id.startsWith("address.")?$n:jn),t.$$.dirty[1]&1040&&(gn||Ut==null||Ut.setMarkers(void 0,void 0)),t.$$.dirty[1]&75498512&&Ut&&gn&&!Xn&&(Ut.setMarkers(r?[r]:void 0,void 0),Ut.setSelectedMarker(r?0:-1)),t.$$.dirty[1]&25165840&&Ut&&Ut.setMarkers(Xn,mn),t.$$.dirty[0]&32768|t.$$.dirty[1]&8388624&&Xn&&Ut&&Ut.setSelectedMarker(Yn),t.$$.dirty[0]&2|t.$$.dirty[1]&16&&Ut){const q=Ta(Kt);Ut.setReverseMarker(q?[q.decimalLongitude,q.decimalLatitude]:void 0)}t.$$.dirty[1]&67108864&&pi("select",r),t.$$.dirty[1]&16777216&&pi("pick",mn),t.$$.dirty[0]&81920&&pi("optionsVisibilityChange",Gn&&!!Fn),t.$$.dirty[0]&16384&&pi("featuresListed",Fn),t.$$.dirty[1]&8388608&&pi("featuresMarked",Xn),t.$$.dirty[0]&1&&pi("reverseToggle",Yt),t.$$.dirty[0]&2&&pi("queryChange",Kt),t.$$.dirty[0]&1|t.$$.dirty[1]&16&&Ut&&Ut.indicateReverse(Yt)},[Yt,Kt,h,w,P,$,Z,Ot,At,be,vt,Te,rr,qo,Fn,Yn,Gn,Ci,no,hi,zs,os,se,uo,wr,u,_,C,D,B,W,rt,ct,pt,gt,Ut,zt,Rt,Ke,Qt,Ge,gn,xn,ei,jn,$n,Fe,Vn,ci,fl,ks,br,nn,dl,Xn,mn,vn,r,a,i,Au,Co,le,an,Ye,ro,jo,je,as,ot,V,G,J]}let EM=class extends sd{constructor(t){super(),od(this,t,wM,bM,id,{class:2,apiKey:25,bbox:26,clearButtonTitle:3,clearOnBlur:27,collapsed:4,country:28,debounceSearch:29,enableReverse:5,errorMessage:6,filter:30,flyTo:31,fuzzyMatch:32,language:33,limit:34,mapController:35,minLength:36,noResultsMessage:7,placeholder:8,proximity:37,reverseActive:0,reverseButtonTitle:9,searchValue:1,showFullGeometry:38,showPlaceType:10,showResultsWhileTyping:39,selectFirst:11,flyToSelected:40,markerOnSelected:41,types:42,excludeTypes:43,zoom:44,maxZoom:45,apiUrl:46,fetchParameters:47,iconsBaseUrl:12,adjustUrlQuery:48,focus:49,blur:50,setQuery:51,clearList:52,clearMap:53},null,[-1,-1,-1])}get focus(){return this.$$.ctx[49]}get blur(){return this.$$.ctx[50]}get setQuery(){return this.$$.ctx[51]}get clearList(){return this.$$.ctx[52]}get clearMap(){return this.$$.ctx[53]}};/**
 * splaytree v3.1.2
 * Fast Splay tree for Node and browser
 *
 * @author Alexander Milevski <info@w8r.name>
 * @license MIT
 * @preserve
 *//*! *****************************************************************************
Copyright (c) Microsoft Corporation. All rights reserved.
Licensed under the Apache License, Version 2.0 (the "License"); you may not use
this file except in compliance with the License. You may obtain a copy of the
License at http://www.apache.org/licenses/LICENSE-2.0

THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
MERCHANTABLITY OR NON-INFRINGEMENT.

See the Apache Version 2.0 License for specific language governing permissions
and limitations under the License.
***************************************************************************** */function IM(t,e){var n={label:0,sent:function(){if(a[0]&1)throw a[1];return a[1]},trys:[],ops:[]},r,i,a,h;return h={next:u(0),throw:u(1),return:u(2)},typeof Symbol=="function"&&(h[Symbol.iterator]=function(){return this}),h;function u(w){return function(C){return _([w,C])}}function _(w){if(r)throw new TypeError("Generator is already executing.");for(;n;)try{if(r=1,i&&(a=w[0]&2?i.return:w[0]?i.throw||((a=i.return)&&a.call(i),0):i.next)&&!(a=a.call(i,w[1])).done)return a;switch(i=0,a&&(w=[w[0]&2,a.value]),w[0]){case 0:case 1:a=w;break;case 4:return n.label++,{value:w[1],done:!1};case 5:n.label++,i=w[1],w=[0];continue;case 7:w=n.ops.pop(),n.trys.pop();continue;default:if(a=n.trys,!(a=a.length>0&&a[a.length-1])&&(w[0]===6||w[0]===2)){n=0;continue}if(w[0]===3&&(!a||w[1]>a[0]&&w[1]<a[3])){n.label=w[1];break}if(w[0]===6&&n.label<a[1]){n.label=a[1],a=w;break}if(a&&n.label<a[2]){n.label=a[2],n.ops.push(w);break}a[2]&&n.ops.pop(),n.trys.pop();continue}w=e.call(t,n)}catch(C){w=[6,C],i=0}finally{r=a=0}if(w[0]&5)throw w[1];return{value:w[0]?w[1]:void 0,done:!0}}}var Bf=function(){function t(e,n){this.next=null,this.key=e,this.data=n,this.left=null,this.right=null}return t}();function SM(t,e){return t>e?1:t<e?-1:0}function Mf(t,e,n){for(var r=new Bf(null,null),i=r,a=r;;){var h=n(t,e.key);if(h<0){if(e.left===null)break;if(n(t,e.left.key)<0){var u=e.left;if(e.left=u.right,u.right=e,e=u,e.left===null)break}a.left=e,a=e,e=e.left}else if(h>0){if(e.right===null)break;if(n(t,e.right.key)>0){var u=e.right;if(e.right=u.left,u.left=e,e=u,e.right===null)break}i.right=e,i=e,e=e.right}else break}return i.right=e.left,a.left=e.right,e.left=r.right,e.right=r.left,e}function Nx(t,e,n,r){var i=new Bf(t,e);if(n===null)return i.left=i.right=null,i;n=Mf(t,n,r);var a=r(t,n.key);return a<0?(i.left=n.left,i.right=n,n.left=null):a>=0&&(i.right=n.right,i.left=n,n.right=null),i}function CE(t,e,n){var r=null,i=null;if(e){e=Mf(t,e,n);var a=n(e.key,t);a===0?(r=e.left,i=e.right):a<0?(i=e.right,e.right=null,r=e):(r=e.left,e.left=null,i=e)}return{left:r,right:i}}function CM(t,e,n){return e===null?t:(t===null||(e=Mf(t.key,e,n),e.left=t),e)}function jx(t,e,n,r,i){if(t){r(""+e+(n?"└── ":"├── ")+i(t)+`
`);var a=e+(n?"    ":"│   ");t.left&&jx(t.left,a,!1,r,i),t.right&&jx(t.right,a,!0,r,i)}}var xb=function(){function t(e){e===void 0&&(e=SM),this._root=null,this._size=0,this._comparator=e}return t.prototype.insert=function(e,n){return this._size++,this._root=Nx(e,n,this._root,this._comparator)},t.prototype.add=function(e,n){var r=new Bf(e,n);this._root===null&&(r.left=r.right=null,this._size++,this._root=r);var i=this._comparator,a=Mf(e,this._root,i),h=i(e,a.key);return h===0?this._root=a:(h<0?(r.left=a.left,r.right=a,a.left=null):h>0&&(r.right=a.right,r.left=a,a.right=null),this._size++,this._root=r),this._root},t.prototype.remove=function(e){this._root=this._remove(e,this._root,this._comparator)},t.prototype._remove=function(e,n,r){var i;if(n===null)return null;n=Mf(e,n,r);var a=r(e,n.key);return a===0?(n.left===null?i=n.right:(i=Mf(e,n.left,r),i.right=n.right),this._size--,i):n},t.prototype.pop=function(){var e=this._root;if(e){for(;e.left;)e=e.left;return this._root=Mf(e.key,this._root,this._comparator),this._root=this._remove(e.key,this._root,this._comparator),{key:e.key,data:e.data}}return null},t.prototype.findStatic=function(e){for(var n=this._root,r=this._comparator;n;){var i=r(e,n.key);if(i===0)return n;i<0?n=n.left:n=n.right}return null},t.prototype.find=function(e){return this._root&&(this._root=Mf(e,this._root,this._comparator),this._comparator(e,this._root.key)!==0)?null:this._root},t.prototype.contains=function(e){for(var n=this._root,r=this._comparator;n;){var i=r(e,n.key);if(i===0)return!0;i<0?n=n.left:n=n.right}return!1},t.prototype.forEach=function(e,n){for(var r=this._root,i=[],a=!1;!a;)r!==null?(i.push(r),r=r.left):i.length!==0?(r=i.pop(),e.call(n,r),r=r.right):a=!0;return this},t.prototype.range=function(e,n,r,i){for(var a=[],h=this._comparator,u=this._root,_;a.length!==0||u;)if(u)a.push(u),u=u.left;else{if(u=a.pop(),_=h(u.key,n),_>0)break;if(h(u.key,e)>=0&&r.call(i,u))return this;u=u.right}return this},t.prototype.keys=function(){var e=[];return this.forEach(function(n){var r=n.key;return e.push(r)}),e},t.prototype.values=function(){var e=[];return this.forEach(function(n){var r=n.data;return e.push(r)}),e},t.prototype.min=function(){return this._root?this.minNode(this._root).key:null},t.prototype.max=function(){return this._root?this.maxNode(this._root).key:null},t.prototype.minNode=function(e){if(e===void 0&&(e=this._root),e)for(;e.left;)e=e.left;return e},t.prototype.maxNode=function(e){if(e===void 0&&(e=this._root),e)for(;e.right;)e=e.right;return e},t.prototype.at=function(e){for(var n=this._root,r=!1,i=0,a=[];!r;)if(n)a.push(n),n=n.left;else if(a.length>0){if(n=a.pop(),i===e)return n;i++,n=n.right}else r=!0;return null},t.prototype.next=function(e){var n=this._root,r=null;if(e.right){for(r=e.right;r.left;)r=r.left;return r}for(var i=this._comparator;n;){var a=i(e.key,n.key);if(a===0)break;a<0?(r=n,n=n.left):n=n.right}return r},t.prototype.prev=function(e){var n=this._root,r=null;if(e.left!==null){for(r=e.left;r.right;)r=r.right;return r}for(var i=this._comparator;n;){var a=i(e.key,n.key);if(a===0)break;a<0?n=n.left:(r=n,n=n.right)}return r},t.prototype.clear=function(){return this._root=null,this._size=0,this},t.prototype.toList=function(){return LM(this._root)},t.prototype.load=function(e,n,r){n===void 0&&(n=[]),r===void 0&&(r=!1);var i=e.length,a=this._comparator;if(r&&Zx(e,n,0,i-1,a),this._root===null)this._root=Xx(e,n,0,i),this._size=i;else{var h=NM(this.toList(),TM(e,n),a);i=this._size+i,this._root=Yx({head:h},0,i)}return this},t.prototype.isEmpty=function(){return this._root===null},Object.defineProperty(t.prototype,"size",{get:function(){return this._size},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"root",{get:function(){return this._root},enumerable:!0,configurable:!0}),t.prototype.toString=function(e){e===void 0&&(e=function(r){return String(r.key)});var n=[];return jx(this._root,"",!0,function(r){return n.push(r)},e),n.join("")},t.prototype.update=function(e,n,r){var i=this._comparator,a=CE(e,this._root,i),h=a.left,u=a.right;i(e,n)<0?u=Nx(n,r,u,i):h=Nx(n,r,h,i),this._root=CM(h,u,i)},t.prototype.split=function(e){return CE(e,this._root,this._comparator)},t.prototype[Symbol.iterator]=function(){var e,n,r;return IM(this,function(i){switch(i.label){case 0:e=this._root,n=[],r=!1,i.label=1;case 1:return r?[3,6]:e===null?[3,2]:(n.push(e),e=e.left,[3,5]);case 2:return n.length===0?[3,4]:(e=n.pop(),[4,e]);case 3:return i.sent(),e=e.right,[3,5];case 4:r=!0,i.label=5;case 5:return[3,1];case 6:return[2]}})},t}();function Xx(t,e,n,r){var i=r-n;if(i>0){var a=n+Math.floor(i/2),h=t[a],u=e[a],_=new Bf(h,u);return _.left=Xx(t,e,n,a),_.right=Xx(t,e,a+1,r),_}return null}function TM(t,e){for(var n=new Bf(null,null),r=n,i=0;i<t.length;i++)r=r.next=new Bf(t[i],e[i]);return r.next=null,n.next}function LM(t){for(var e=t,n=[],r=!1,i=new Bf(null,null),a=i;!r;)e?(n.push(e),e=e.left):n.length>0?(e=a=a.next=n.pop(),e=e.right):r=!0;return a.next=null,i.next}function Yx(t,e,n){var r=n-e;if(r>0){var i=e+Math.floor(r/2),a=Yx(t,e,i),h=t.head;return h.left=a,t.head=t.head.next,h.right=Yx(t,i+1,n),h}return null}function NM(t,e,n){for(var r=new Bf(null,null),i=r,a=t,h=e;a!==null&&h!==null;)n(a.key,h.key)<0?(i.next=a,a=a.next):(i.next=h,h=h.next),i=i.next;return a!==null?i.next=a:h!==null&&(i.next=h),r.next}function Zx(t,e,n,r,i){if(!(n>=r)){for(var a=t[n+r>>1],h=n-1,u=r+1;;){do h++;while(i(t[h],a)<0);do u--;while(i(t[u],a)>0);if(h>=u)break;var _=t[h];t[h]=t[u],t[u]=_,_=e[h],e[h]=e[u],e[u]=_}Zx(t,e,n,u,i),Zx(t,e,u+1,r,i)}}function pc(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function TE(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function Xa(t,e,n){return e&&TE(t.prototype,e),n&&TE(t,n),t}var Ly=function(t,e){return t.ll.x<=e.x&&e.x<=t.ur.x&&t.ll.y<=e.y&&e.y<=t.ur.y},Hx=function(t,e){if(e.ur.x<t.ll.x||t.ur.x<e.ll.x||e.ur.y<t.ll.y||t.ur.y<e.ll.y)return null;var n=t.ll.x<e.ll.x?e.ll.x:t.ll.x,r=t.ur.x<e.ur.x?t.ur.x:e.ur.x,i=t.ll.y<e.ll.y?e.ll.y:t.ll.y,a=t.ur.y<e.ur.y?t.ur.y:e.ur.y;return{ll:{x:n,y:i},ur:{x:r,y:a}}},Af=Number.EPSILON;Af===void 0&&(Af=Math.pow(2,-52));var PM=Af*Af,Wx=function(t,e){if(-Af<t&&t<Af&&-Af<e&&e<Af)return 0;var n=t-e;return n*n<PM*t*e?0:t<e?-1:1},MM=function(){function t(){pc(this,t),this.reset()}return Xa(t,[{key:"reset",value:function(){this.xRounder=new LE,this.yRounder=new LE}},{key:"round",value:function(e,n){return{x:this.xRounder.round(e),y:this.yRounder.round(n)}}}]),t}(),LE=function(){function t(){pc(this,t),this.tree=new xb,this.round(0)}return Xa(t,[{key:"round",value:function(e){var n=this.tree.add(e),r=this.tree.prev(n);if(r!==null&&Wx(n.key,r.key)===0)return this.tree.remove(e),r.key;var i=this.tree.next(n);return i!==null&&Wx(n.key,i.key)===0?(this.tree.remove(e),i.key):e}}]),t}(),By=new MM,Fy=function(t,e){return t.x*e.y-t.y*e.x},nS=function(t,e){return t.x*e.x+t.y*e.y},NE=function(t,e,n){var r={x:e.x-t.x,y:e.y-t.y},i={x:n.x-t.x,y:n.y-t.y},a=Fy(r,i);return Wx(a,0)},Dv=function(t){return Math.sqrt(nS(t,t))},AM=function(t,e,n){var r={x:e.x-t.x,y:e.y-t.y},i={x:n.x-t.x,y:n.y-t.y};return Fy(i,r)/Dv(i)/Dv(r)},DM=function(t,e,n){var r={x:e.x-t.x,y:e.y-t.y},i={x:n.x-t.x,y:n.y-t.y};return nS(i,r)/Dv(i)/Dv(r)},PE=function(t,e,n){return e.y===0?null:{x:t.x+e.x/e.y*(n-t.y),y:n}},ME=function(t,e,n){return e.x===0?null:{x:n,y:t.y+e.y/e.x*(n-t.x)}},OM=function(t,e,n,r){if(e.x===0)return ME(n,r,t.x);if(r.x===0)return ME(t,e,n.x);if(e.y===0)return PE(n,r,t.y);if(r.y===0)return PE(t,e,n.y);var i=Fy(e,r);if(i==0)return null;var a={x:n.x-t.x,y:n.y-t.y},h=Fy(a,e)/i,u=Fy(a,r)/i,_=t.x+u*e.x,w=n.x+h*r.x,C=t.y+u*e.y,P=n.y+h*r.y,D=(_+w)/2,B=(C+P)/2;return{x:D,y:B}},Eh=function(){Xa(t,null,[{key:"compare",value:function(e,n){var r=t.comparePoints(e.point,n.point);return r!==0?r:(e.point!==n.point&&e.link(n),e.isLeft!==n.isLeft?e.isLeft?1:-1:Ov.compare(e.segment,n.segment))}},{key:"comparePoints",value:function(e,n){return e.x<n.x?-1:e.x>n.x?1:e.y<n.y?-1:e.y>n.y?1:0}}]);function t(e,n){pc(this,t),e.events===void 0?e.events=[this]:e.events.push(this),this.point=e,this.isLeft=n}return Xa(t,[{key:"link",value:function(e){if(e.point===this.point)throw new Error("Tried to link already linked events");for(var n=e.point.events,r=0,i=n.length;r<i;r++){var a=n[r];this.point.events.push(a),a.point=this.point}this.checkForConsuming()}},{key:"checkForConsuming",value:function(){for(var e=this.point.events.length,n=0;n<e;n++){var r=this.point.events[n];if(r.segment.consumedBy===void 0)for(var i=n+1;i<e;i++){var a=this.point.events[i];a.consumedBy===void 0&&r.otherSE.point.events===a.otherSE.point.events&&r.segment.consume(a.segment)}}}},{key:"getAvailableLinkedEvents",value:function(){for(var e=[],n=0,r=this.point.events.length;n<r;n++){var i=this.point.events[n];i!==this&&!i.segment.ringOut&&i.segment.isInResult()&&e.push(i)}return e}},{key:"getLeftmostComparator",value:function(e){var n=this,r=new Map,i=function(a){var h=a.otherSE;r.set(a,{sine:AM(n.point,e.point,h.point),cosine:DM(n.point,e.point,h.point)})};return function(a,h){r.has(a)||i(a),r.has(h)||i(h);var u=r.get(a),_=u.sine,w=u.cosine,C=r.get(h),P=C.sine,D=C.cosine;return _>=0&&P>=0?w<D?1:w>D?-1:0:_<0&&P<0?w<D?-1:w>D?1:0:P<_?-1:P>_?1:0}}}]),t}(),RM=0,Ov=function(){Xa(t,null,[{key:"compare",value:function(e,n){var r=e.leftSE.point.x,i=n.leftSE.point.x,a=e.rightSE.point.x,h=n.rightSE.point.x;if(h<r)return 1;if(a<i)return-1;var u=e.leftSE.point.y,_=n.leftSE.point.y,w=e.rightSE.point.y,C=n.rightSE.point.y;if(r<i){if(_<u&&_<w)return 1;if(_>u&&_>w)return-1;var P=e.comparePoint(n.leftSE.point);if(P<0)return 1;if(P>0)return-1;var D=n.comparePoint(e.rightSE.point);return D!==0?D:-1}if(r>i){if(u<_&&u<C)return-1;if(u>_&&u>C)return 1;var B=n.comparePoint(e.leftSE.point);if(B!==0)return B;var $=e.comparePoint(n.rightSE.point);return $<0?1:$>0?-1:1}if(u<_)return-1;if(u>_)return 1;if(a<h){var Z=n.comparePoint(e.rightSE.point);if(Z!==0)return Z}if(a>h){var W=e.comparePoint(n.rightSE.point);if(W<0)return 1;if(W>0)return-1}if(a!==h){var rt=w-u,ct=a-r,pt=C-_,gt=h-i;if(rt>ct&&pt<gt)return 1;if(rt<ct&&pt>gt)return-1}return a>h?1:a<h||w<C?-1:w>C?1:e.id<n.id?-1:e.id>n.id?1:0}}]);function t(e,n,r,i){pc(this,t),this.id=++RM,this.leftSE=e,e.segment=this,e.otherSE=n,this.rightSE=n,n.segment=this,n.otherSE=e,this.rings=r,this.windings=i}return Xa(t,[{key:"replaceRightSE",value:function(e){this.rightSE=e,this.rightSE.segment=this,this.rightSE.otherSE=this.leftSE,this.leftSE.otherSE=this.rightSE}},{key:"bbox",value:function(){var e=this.leftSE.point.y,n=this.rightSE.point.y;return{ll:{x:this.leftSE.point.x,y:e<n?e:n},ur:{x:this.rightSE.point.x,y:e>n?e:n}}}},{key:"vector",value:function(){return{x:this.rightSE.point.x-this.leftSE.point.x,y:this.rightSE.point.y-this.leftSE.point.y}}},{key:"isAnEndpoint",value:function(e){return e.x===this.leftSE.point.x&&e.y===this.leftSE.point.y||e.x===this.rightSE.point.x&&e.y===this.rightSE.point.y}},{key:"comparePoint",value:function(e){if(this.isAnEndpoint(e))return 0;var n=this.leftSE.point,r=this.rightSE.point,i=this.vector();if(n.x===r.x)return e.x===n.x?0:e.x<n.x?1:-1;var a=(e.y-n.y)/i.y,h=n.x+a*i.x;if(e.x===h)return 0;var u=(e.x-n.x)/i.x,_=n.y+u*i.y;return e.y===_?0:e.y<_?-1:1}},{key:"getIntersection",value:function(e){var n=this.bbox(),r=e.bbox(),i=Hx(n,r);if(i===null)return null;var a=this.leftSE.point,h=this.rightSE.point,u=e.leftSE.point,_=e.rightSE.point,w=Ly(n,u)&&this.comparePoint(u)===0,C=Ly(r,a)&&e.comparePoint(a)===0,P=Ly(n,_)&&this.comparePoint(_)===0,D=Ly(r,h)&&e.comparePoint(h)===0;if(C&&w)return D&&!P?h:!D&&P?_:null;if(C)return P&&a.x===_.x&&a.y===_.y?null:a;if(w)return D&&h.x===u.x&&h.y===u.y?null:u;if(D&&P)return null;if(D)return h;if(P)return _;var B=OM(a,this.vector(),u,e.vector());return B===null||!Ly(i,B)?null:By.round(B.x,B.y)}},{key:"split",value:function(e){var n=[],r=e.events!==void 0,i=new Eh(e,!0),a=new Eh(e,!1),h=this.rightSE;this.replaceRightSE(a),n.push(a),n.push(i);var u=new t(i,h,this.rings.slice(),this.windings.slice());return Eh.comparePoints(u.leftSE.point,u.rightSE.point)>0&&u.swapEvents(),Eh.comparePoints(this.leftSE.point,this.rightSE.point)>0&&this.swapEvents(),r&&(i.checkForConsuming(),a.checkForConsuming()),n}},{key:"swapEvents",value:function(){var e=this.rightSE;this.rightSE=this.leftSE,this.leftSE=e,this.leftSE.isLeft=!0,this.rightSE.isLeft=!1;for(var n=0,r=this.windings.length;n<r;n++)this.windings[n]*=-1}},{key:"consume",value:function(e){for(var n=this,r=e;n.consumedBy;)n=n.consumedBy;for(;r.consumedBy;)r=r.consumedBy;var i=t.compare(n,r);if(i!==0){if(i>0){var a=n;n=r,r=a}if(n.prev===r){var h=n;n=r,r=h}for(var u=0,_=r.rings.length;u<_;u++){var w=r.rings[u],C=r.windings[u],P=n.rings.indexOf(w);P===-1?(n.rings.push(w),n.windings.push(C)):n.windings[P]+=C}r.rings=null,r.windings=null,r.consumedBy=n,r.leftSE.consumedBy=n.leftSE,r.rightSE.consumedBy=n.rightSE}}},{key:"prevInResult",value:function(){return this._prevInResult!==void 0?this._prevInResult:(this.prev?this.prev.isInResult()?this._prevInResult=this.prev:this._prevInResult=this.prev.prevInResult():this._prevInResult=null,this._prevInResult)}},{key:"beforeState",value:function(){if(this._beforeState!==void 0)return this._beforeState;if(!this.prev)this._beforeState={rings:[],windings:[],multiPolys:[]};else{var e=this.prev.consumedBy||this.prev;this._beforeState=e.afterState()}return this._beforeState}},{key:"afterState",value:function(){if(this._afterState!==void 0)return this._afterState;var e=this.beforeState();this._afterState={rings:e.rings.slice(0),windings:e.windings.slice(0),multiPolys:[]};for(var n=this._afterState.rings,r=this._afterState.windings,i=this._afterState.multiPolys,a=0,h=this.rings.length;a<h;a++){var u=this.rings[a],_=this.windings[a],w=n.indexOf(u);w===-1?(n.push(u),r.push(_)):r[w]+=_}for(var C=[],P=[],D=0,B=n.length;D<B;D++)if(r[D]!==0){var $=n[D],Z=$.poly;if(P.indexOf(Z)===-1)if($.isExterior)C.push(Z);else{P.indexOf(Z)===-1&&P.push(Z);var W=C.indexOf($.poly);W!==-1&&C.splice(W,1)}}for(var rt=0,ct=C.length;rt<ct;rt++){var pt=C[rt].multiPoly;i.indexOf(pt)===-1&&i.push(pt)}return this._afterState}},{key:"isInResult",value:function(){if(this.consumedBy)return!1;if(this._isInResult!==void 0)return this._isInResult;var e=this.beforeState().multiPolys,n=this.afterState().multiPolys;switch(Mc.type){case"union":{var r=e.length===0,i=n.length===0;this._isInResult=r!==i;break}case"intersection":{var a,h;e.length<n.length?(a=e.length,h=n.length):(a=n.length,h=e.length),this._isInResult=h===Mc.numMultiPolys&&a<h;break}case"xor":{var u=Math.abs(e.length-n.length);this._isInResult=u%2===1;break}case"difference":{var _=function(w){return w.length===1&&w[0].isSubject};this._isInResult=_(e)!==_(n);break}default:throw new Error("Unrecognized operation type found ".concat(Mc.type))}return this._isInResult}}],[{key:"fromRing",value:function(e,n,r){var i,a,h,u=Eh.comparePoints(e,n);if(u<0)i=e,a=n,h=1;else if(u>0)i=n,a=e,h=-1;else throw new Error("Tried to create degenerate segment at [".concat(e.x,", ").concat(e.y,"]"));var _=new Eh(i,!0),w=new Eh(a,!1);return new t(_,w,[r],[h])}}]),t}(),AE=function(){function t(e,n,r){if(pc(this,t),!Array.isArray(e)||e.length===0)throw new Error("Input geometry is not a valid Polygon or MultiPolygon");if(this.poly=n,this.isExterior=r,this.segments=[],typeof e[0][0]!="number"||typeof e[0][1]!="number")throw new Error("Input geometry is not a valid Polygon or MultiPolygon");var i=By.round(e[0][0],e[0][1]);this.bbox={ll:{x:i.x,y:i.y},ur:{x:i.x,y:i.y}};for(var a=i,h=1,u=e.length;h<u;h++){if(typeof e[h][0]!="number"||typeof e[h][1]!="number")throw new Error("Input geometry is not a valid Polygon or MultiPolygon");var _=By.round(e[h][0],e[h][1]);_.x===a.x&&_.y===a.y||(this.segments.push(Ov.fromRing(a,_,this)),_.x<this.bbox.ll.x&&(this.bbox.ll.x=_.x),_.y<this.bbox.ll.y&&(this.bbox.ll.y=_.y),_.x>this.bbox.ur.x&&(this.bbox.ur.x=_.x),_.y>this.bbox.ur.y&&(this.bbox.ur.y=_.y),a=_)}(i.x!==a.x||i.y!==a.y)&&this.segments.push(Ov.fromRing(a,i,this))}return Xa(t,[{key:"getSweepEvents",value:function(){for(var e=[],n=0,r=this.segments.length;n<r;n++){var i=this.segments[n];e.push(i.leftSE),e.push(i.rightSE)}return e}}]),t}(),FM=function(){function t(e,n){if(pc(this,t),!Array.isArray(e))throw new Error("Input geometry is not a valid Polygon or MultiPolygon");this.exteriorRing=new AE(e[0],this,!0),this.bbox={ll:{x:this.exteriorRing.bbox.ll.x,y:this.exteriorRing.bbox.ll.y},ur:{x:this.exteriorRing.bbox.ur.x,y:this.exteriorRing.bbox.ur.y}},this.interiorRings=[];for(var r=1,i=e.length;r<i;r++){var a=new AE(e[r],this,!1);a.bbox.ll.x<this.bbox.ll.x&&(this.bbox.ll.x=a.bbox.ll.x),a.bbox.ll.y<this.bbox.ll.y&&(this.bbox.ll.y=a.bbox.ll.y),a.bbox.ur.x>this.bbox.ur.x&&(this.bbox.ur.x=a.bbox.ur.x),a.bbox.ur.y>this.bbox.ur.y&&(this.bbox.ur.y=a.bbox.ur.y),this.interiorRings.push(a)}this.multiPoly=n}return Xa(t,[{key:"getSweepEvents",value:function(){for(var e=this.exteriorRing.getSweepEvents(),n=0,r=this.interiorRings.length;n<r;n++)for(var i=this.interiorRings[n].getSweepEvents(),a=0,h=i.length;a<h;a++)e.push(i[a]);return e}}]),t}(),DE=function(){function t(e,n){if(pc(this,t),!Array.isArray(e))throw new Error("Input geometry is not a valid Polygon or MultiPolygon");try{typeof e[0][0][0]=="number"&&(e=[e])}catch{}this.polys=[],this.bbox={ll:{x:Number.POSITIVE_INFINITY,y:Number.POSITIVE_INFINITY},ur:{x:Number.NEGATIVE_INFINITY,y:Number.NEGATIVE_INFINITY}};for(var r=0,i=e.length;r<i;r++){var a=new FM(e[r],this);a.bbox.ll.x<this.bbox.ll.x&&(this.bbox.ll.x=a.bbox.ll.x),a.bbox.ll.y<this.bbox.ll.y&&(this.bbox.ll.y=a.bbox.ll.y),a.bbox.ur.x>this.bbox.ur.x&&(this.bbox.ur.x=a.bbox.ur.x),a.bbox.ur.y>this.bbox.ur.y&&(this.bbox.ur.y=a.bbox.ur.y),this.polys.push(a)}this.isSubject=n}return Xa(t,[{key:"getSweepEvents",value:function(){for(var e=[],n=0,r=this.polys.length;n<r;n++)for(var i=this.polys[n].getSweepEvents(),a=0,h=i.length;a<h;a++)e.push(i[a]);return e}}]),t}(),kM=function(){Xa(t,null,[{key:"factory",value:function(e){for(var n=[],r=0,i=e.length;r<i;r++){var a=e[r];if(!(!a.isInResult()||a.ringOut)){for(var h=null,u=a.leftSE,_=a.rightSE,w=[u],C=u.point,P=[];h=u,u=_,w.push(u),u.point!==C;)for(;;){var D=u.getAvailableLinkedEvents();if(D.length===0){var B=w[0].point,$=w[w.length-1].point;throw new Error("Unable to complete output ring starting at [".concat(B.x,",")+" ".concat(B.y,"]. Last matching segment found ends at")+" [".concat($.x,", ").concat($.y,"]."))}if(D.length===1){_=D[0].otherSE;break}for(var Z=null,W=0,rt=P.length;W<rt;W++)if(P[W].point===u.point){Z=W;break}if(Z!==null){var ct=P.splice(Z)[0],pt=w.splice(ct.index);pt.unshift(pt[0].otherSE),n.push(new t(pt.reverse()));continue}P.push({index:w.length,point:u.point});var gt=u.getLeftmostComparator(h);_=D.sort(gt)[0].otherSE;break}n.push(new t(w))}}return n}}]);function t(e){pc(this,t),this.events=e;for(var n=0,r=e.length;n<r;n++)e[n].segment.ringOut=this;this.poly=null}return Xa(t,[{key:"getGeom",value:function(){for(var e=this.events[0].point,n=[e],r=1,i=this.events.length-1;r<i;r++){var a=this.events[r].point,h=this.events[r+1].point;NE(a,e,h)!==0&&(n.push(a),e=a)}if(n.length===1)return null;var u=n[0],_=n[1];NE(u,e,_)===0&&n.shift(),n.push(n[0]);for(var w=this.isExteriorRing()?1:-1,C=this.isExteriorRing()?0:n.length-1,P=this.isExteriorRing()?n.length:-1,D=[],B=C;B!=P;B+=w)D.push([n[B].x,n[B].y]);return D}},{key:"isExteriorRing",value:function(){if(this._isExteriorRing===void 0){var e=this.enclosingRing();this._isExteriorRing=e?!e.isExteriorRing():!0}return this._isExteriorRing}},{key:"enclosingRing",value:function(){return this._enclosingRing===void 0&&(this._enclosingRing=this._calcEnclosingRing()),this._enclosingRing}},{key:"_calcEnclosingRing",value:function(){for(var e=this.events[0],n=1,r=this.events.length;n<r;n++){var i=this.events[n];Eh.compare(e,i)>0&&(e=i)}for(var a=e.segment.prevInResult(),h=a?a.prevInResult():null;;){if(!a)return null;if(!h)return a.ringOut;if(h.ringOut!==a.ringOut)return h.ringOut.enclosingRing()!==a.ringOut?a.ringOut:a.ringOut.enclosingRing();a=h.prevInResult(),h=a?a.prevInResult():null}}}]),t}(),OE=function(){function t(e){pc(this,t),this.exteriorRing=e,e.poly=this,this.interiorRings=[]}return Xa(t,[{key:"addInterior",value:function(e){this.interiorRings.push(e),e.poly=this}},{key:"getGeom",value:function(){var e=[this.exteriorRing.getGeom()];if(e[0]===null)return null;for(var n=0,r=this.interiorRings.length;n<r;n++){var i=this.interiorRings[n].getGeom();i!==null&&e.push(i)}return e}}]),t}(),zM=function(){function t(e){pc(this,t),this.rings=e,this.polys=this._composePolys(e)}return Xa(t,[{key:"getGeom",value:function(){for(var e=[],n=0,r=this.polys.length;n<r;n++){var i=this.polys[n].getGeom();i!==null&&e.push(i)}return e}},{key:"_composePolys",value:function(e){for(var n=[],r=0,i=e.length;r<i;r++){var a=e[r];if(!a.poly)if(a.isExteriorRing())n.push(new OE(a));else{var h=a.enclosingRing();h.poly||n.push(new OE(h)),h.poly.addInterior(a)}}return n}}]),t}(),BM=function(){function t(e){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:Ov.compare;pc(this,t),this.queue=e,this.tree=new xb(n),this.segments=[]}return Xa(t,[{key:"process",value:function(e){var n=e.segment,r=[];if(e.consumedBy)return e.isLeft?this.queue.remove(e.otherSE):this.tree.remove(n),r;var i=e.isLeft?this.tree.insert(n):this.tree.find(n);if(!i)throw new Error("Unable to find segment #".concat(n.id," ")+"[".concat(n.leftSE.point.x,", ").concat(n.leftSE.point.y,"] -> ")+"[".concat(n.rightSE.point.x,", ").concat(n.rightSE.point.y,"] ")+"in SweepLine tree. Please submit a bug report.");for(var a=i,h=i,u=void 0,_=void 0;u===void 0;)a=this.tree.prev(a),a===null?u=null:a.key.consumedBy===void 0&&(u=a.key);for(;_===void 0;)h=this.tree.next(h),h===null?_=null:h.key.consumedBy===void 0&&(_=h.key);if(e.isLeft){var w=null;if(u){var C=u.getIntersection(n);if(C!==null&&(n.isAnEndpoint(C)||(w=C),!u.isAnEndpoint(C)))for(var P=this._splitSafely(u,C),D=0,B=P.length;D<B;D++)r.push(P[D])}var $=null;if(_){var Z=_.getIntersection(n);if(Z!==null&&(n.isAnEndpoint(Z)||($=Z),!_.isAnEndpoint(Z)))for(var W=this._splitSafely(_,Z),rt=0,ct=W.length;rt<ct;rt++)r.push(W[rt])}if(w!==null||$!==null){var pt=null;if(w===null)pt=$;else if($===null)pt=w;else{var gt=Eh.comparePoints(w,$);pt=gt<=0?w:$}this.queue.remove(n.rightSE),r.push(n.rightSE);for(var Ut=n.split(pt),zt=0,Ot=Ut.length;zt<Ot;zt++)r.push(Ut[zt])}r.length>0?(this.tree.remove(n),r.push(e)):(this.segments.push(n),n.prev=u)}else{if(u&&_){var At=u.getIntersection(_);if(At!==null){if(!u.isAnEndpoint(At))for(var Rt=this._splitSafely(u,At),Yt=0,be=Rt.length;Yt<be;Yt++)r.push(Rt[Yt]);if(!_.isAnEndpoint(At))for(var Kt=this._splitSafely(_,At),Ke=0,vt=Kt.length;Ke<vt;Ke++)r.push(Kt[Ke])}}this.tree.remove(n)}return r}},{key:"_splitSafely",value:function(e,n){this.tree.remove(e);var r=e.rightSE;this.queue.remove(r);var i=e.split(n);return i.push(r),e.consumedBy===void 0&&this.tree.insert(e),i}}]),t}(),RE=typeof process<"u"&&YI.POLYGON_CLIPPING_MAX_QUEUE_SIZE||1e6,$M=typeof process<"u"&&YI.POLYGON_CLIPPING_MAX_SWEEPLINE_SEGMENTS||1e6,VM=function(){function t(){pc(this,t)}return Xa(t,[{key:"run",value:function(e,n,r){Mc.type=e,By.reset();for(var i=[new DE(n,!0)],a=0,h=r.length;a<h;a++)i.push(new DE(r[a],!1));if(Mc.numMultiPolys=i.length,Mc.type==="difference")for(var u=i[0],_=1;_<i.length;)Hx(i[_].bbox,u.bbox)!==null?_++:i.splice(_,1);if(Mc.type==="intersection"){for(var w=0,C=i.length;w<C;w++)for(var P=i[w],D=w+1,B=i.length;D<B;D++)if(Hx(P.bbox,i[D].bbox)===null)return[]}for(var $=new xb(Eh.compare),Z=0,W=i.length;Z<W;Z++)for(var rt=i[Z].getSweepEvents(),ct=0,pt=rt.length;ct<pt;ct++)if($.insert(rt[ct]),$.size>RE)throw new Error("Infinite loop when putting segment endpoints in a priority queue (queue size too big). Please file a bug report.");for(var gt=new BM($),Ut=$.size,zt=$.pop();zt;){var Ot=zt.key;if($.size===Ut){var At=Ot.segment;throw new Error("Unable to pop() ".concat(Ot.isLeft?"left":"right"," SweepEvent ")+"[".concat(Ot.point.x,", ").concat(Ot.point.y,"] from segment #").concat(At.id," ")+"[".concat(At.leftSE.point.x,", ").concat(At.leftSE.point.y,"] -> ")+"[".concat(At.rightSE.point.x,", ").concat(At.rightSE.point.y,"] from queue. ")+"Please file a bug report.")}if($.size>RE)throw new Error("Infinite loop when passing sweep line over endpoints (queue size too big). Please file a bug report.");if(gt.segments.length>$M)throw new Error("Infinite loop when passing sweep line over endpoints (too many sweep line segments). Please file a bug report.");for(var Rt=gt.process(Ot),Yt=0,be=Rt.length;Yt<be;Yt++){var Kt=Rt[Yt];Kt.consumedBy===void 0&&$.insert(Kt)}Ut=$.size,zt=$.pop()}By.reset();var Ke=kM.factory(gt.segments),vt=new zM(Ke);return vt.getGeom()}}]),t}(),Mc=new VM,UM=function(t){for(var e=arguments.length,n=new Array(e>1?e-1:0),r=1;r<e;r++)n[r-1]=arguments[r];return Mc.run("union",t,n)},GM=function(t){for(var e=arguments.length,n=new Array(e>1?e-1:0),r=1;r<e;r++)n[r-1]=arguments[r];return Mc.run("intersection",t,n)},qM=function(t){for(var e=arguments.length,n=new Array(e>1?e-1:0),r=1;r<e;r++)n[r-1]=arguments[r];return Mc.run("xor",t,n)},jM=function(t){for(var e=arguments.length,n=new Array(e>1?e-1:0),r=1;r<e;r++)n[r-1]=arguments[r];return Mc.run("difference",t,n)},rS={union:UM,intersection:GM,xor:qM,difference:jM},Ba=63710088e-1,iS={centimeters:Ba*100,centimetres:Ba*100,degrees:Ba/111325,feet:Ba*3.28084,inches:Ba*39.37,kilometers:Ba/1e3,kilometres:Ba/1e3,meters:Ba,metres:Ba,miles:Ba/1609.344,millimeters:Ba*1e3,millimetres:Ba*1e3,nauticalmiles:Ba/1852,radians:1,yards:Ba*1.0936};function a0(t,e,n){n===void 0&&(n={});var r={type:"Feature"};return(n.id===0||n.id)&&(r.id=n.id),n.bbox&&(r.bbox=n.bbox),r.properties=e||{},r.geometry=t,r}function XM(t,e,n){if(n===void 0&&(n={}),!t)throw new Error("coordinates is required");if(!Array.isArray(t))throw new Error("coordinates must be an Array");if(t.length<2)throw new Error("coordinates must be at least 2 numbers long");if(!FE(t[0])||!FE(t[1]))throw new Error("coordinates must contain numbers");var r={type:"Point",coordinates:t};return a0(r,e,n)}function oS(t,e,n){n===void 0&&(n={});for(var r=0,i=t;r<i.length;r++){var a=i[r];if(a.length<4)throw new Error("Each LinearRing of a Polygon must have 4 or more Positions.");for(var h=0;h<a[a.length-1].length;h++)if(a[a.length-1][h]!==a[0][h])throw new Error("First and last Position are not equivalent.")}var u={type:"Polygon",coordinates:t};return a0(u,e,n)}function Jx(t,e){e===void 0&&(e={});var n={type:"FeatureCollection"};return e.id&&(n.id=e.id),e.bbox&&(n.bbox=e.bbox),n.features=t,n}function sS(t,e,n){n===void 0&&(n={});var r={type:"MultiPolygon",coordinates:t};return a0(r,e,n)}function YM(t,e){e===void 0&&(e="kilometers");var n=iS[e];if(!n)throw new Error(e+" units is invalid");return t*n}function ZM(t,e){e===void 0&&(e="kilometers");var n=iS[e];if(!n)throw new Error(e+" units is invalid");return t/n}function FE(t){return!isNaN(t)&&t!==null&&!Array.isArray(t)}function Rv(t){return t.type==="Feature"?t.geometry:t}function HM(t,e,n){n===void 0&&(n={});var r=Rv(t),i=Rv(e),a=rS.union(r.coordinates,i.coordinates);return a.length===0?null:a.length===1?oS(a[0],n.properties):sS(a,n.properties)}function aS(t,e,n){if(t!==null)for(var r,i,a,h,u,_,w,C=0,P=0,D,B=t.type,$=B==="FeatureCollection",Z=B==="Feature",W=$?t.features.length:1,rt=0;rt<W;rt++){w=$?t.features[rt].geometry:Z?t.geometry:t,D=w?w.type==="GeometryCollection":!1,u=D?w.geometries.length:1;for(var ct=0;ct<u;ct++){var pt=0,gt=0;if(h=D?w.geometries[ct]:w,h!==null){_=h.coordinates;var Ut=h.type;switch(C=n&&(Ut==="Polygon"||Ut==="MultiPolygon")?1:0,Ut){case null:break;case"Point":if(e(_,P,rt,pt,gt)===!1)return!1;P++,pt++;break;case"LineString":case"MultiPoint":for(r=0;r<_.length;r++){if(e(_[r],P,rt,pt,gt)===!1)return!1;P++,Ut==="MultiPoint"&&pt++}Ut==="LineString"&&pt++;break;case"Polygon":case"MultiLineString":for(r=0;r<_.length;r++){for(i=0;i<_[r].length-C;i++){if(e(_[r][i],P,rt,pt,gt)===!1)return!1;P++}Ut==="MultiLineString"&&pt++,Ut==="Polygon"&&gt++}Ut==="Polygon"&&pt++;break;case"MultiPolygon":for(r=0;r<_.length;r++){for(gt=0,i=0;i<_[r].length;i++){for(a=0;a<_[r][i].length-C;a++){if(e(_[r][i][a],P,rt,pt,gt)===!1)return!1;P++}gt++}pt++}break;case"GeometryCollection":for(r=0;r<h.geometries.length;r++)if(aS(h.geometries[r],e,n)===!1)return!1;break;default:throw new Error("Unknown Geometry Type")}}}}}function kE(t,e){if(t.type==="Feature")e(t,0);else if(t.type==="FeatureCollection")for(var n=0;n<t.features.length&&e(t.features[n],n)!==!1;n++);}function uS(t,e){var n,r,i,a,h,u,_,w,C,P,D=0,B=t.type==="FeatureCollection",$=t.type==="Feature",Z=B?t.features.length:1;for(n=0;n<Z;n++){for(u=B?t.features[n].geometry:$?t.geometry:t,w=B?t.features[n].properties:$?t.properties:{},C=B?t.features[n].bbox:$?t.bbox:void 0,P=B?t.features[n].id:$?t.id:void 0,_=u?u.type==="GeometryCollection":!1,h=_?u.geometries.length:1,i=0;i<h;i++){if(a=_?u.geometries[i]:u,a===null){if(e(null,D,w,C,P)===!1)return!1;continue}switch(a.type){case"Point":case"LineString":case"MultiPoint":case"Polygon":case"MultiLineString":case"MultiPolygon":{if(e(a,D,w,C,P)===!1)return!1;break}case"GeometryCollection":{for(r=0;r<a.geometries.length;r++)if(e(a.geometries[r],D,w,C,P)===!1)return!1;break}default:throw new Error("Unknown Geometry Type")}}D++}}function Kx(t){var e=[1/0,1/0,-1/0,-1/0];return aS(t,function(n){e[0]>n[0]&&(e[0]=n[0]),e[1]>n[1]&&(e[1]=n[1]),e[2]<n[0]&&(e[2]=n[0]),e[3]<n[1]&&(e[3]=n[1])}),e}Kx.default=Kx;function WM(t,e){e===void 0&&(e={});var n=Kx(t),r=(n[0]+n[2])/2,i=(n[1]+n[3])/2;return XM([r,i],e.properties,e)}"fill"in Array.prototype||Object.defineProperty(Array.prototype,"fill",{configurable:!0,value:function(t){if(this===void 0||this===null)throw new TypeError(this+" is not an object");var e=Object(this),n=Math.max(Math.min(e.length,9007199254740991),0)||0,r=1 in arguments&&parseInt(Number(arguments[1]),10)||0;r=r<0?Math.max(n+r,0):Math.min(r,n);var i=2 in arguments&&arguments[2]!==void 0?parseInt(Number(arguments[2]),10)||0:n;for(i=i<0?Math.max(n+arguments[2],0):Math.min(i,n);r<i;)e[r]=t,++r;return e},writable:!0});Number.isFinite=Number.isFinite||function(t){return typeof t=="number"&&isFinite(t)};Number.isInteger=Number.isInteger||function(t){return typeof t=="number"&&isFinite(t)&&Math.floor(t)===t};Number.parseFloat=Number.parseFloat||parseFloat;Number.isNaN=Number.isNaN||function(t){return t!==t};Math.trunc=Math.trunc||function(t){return t<0?Math.ceil(t):Math.floor(t)};var Pd=function(){};Pd.prototype.interfaces_=function(){return[]};Pd.prototype.getClass=function(){return Pd};Pd.prototype.equalsWithTolerance=function(t,e,n){return Math.abs(t-e)<=n};var Xr=function(t){function e(n){t.call(this,n),this.name="IllegalArgumentException",this.message=n,this.stack=new t().stack}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e}(Error),un=function(){},lS={MAX_VALUE:{configurable:!0}};un.isNaN=function(t){return Number.isNaN(t)};un.doubleToLongBits=function(t){return t};un.longBitsToDouble=function(t){return t};un.isInfinite=function(t){return!Number.isFinite(t)};lS.MAX_VALUE.get=function(){return Number.MAX_VALUE};Object.defineProperties(un,lS);var Tu=function(){},u0=function(){},qg=function(){};function Lu(){}var Tt=function t(){if(this.x=null,this.y=null,this.z=null,arguments.length===0)this.x=0,this.y=0,this.z=t.NULL_ORDINATE;else if(arguments.length===1){var e=arguments[0];this.x=e.x,this.y=e.y,this.z=e.z}else arguments.length===2?(this.x=arguments[0],this.y=arguments[1],this.z=t.NULL_ORDINATE):arguments.length===3&&(this.x=arguments[0],this.y=arguments[1],this.z=arguments[2])},og={DimensionalComparator:{configurable:!0},serialVersionUID:{configurable:!0},NULL_ORDINATE:{configurable:!0},X:{configurable:!0},Y:{configurable:!0},Z:{configurable:!0}};Tt.prototype.setOrdinate=function(t,e){switch(t){case Tt.X:this.x=e;break;case Tt.Y:this.y=e;break;case Tt.Z:this.z=e;break;default:throw new Xr("Invalid ordinate index: "+t)}};Tt.prototype.equals2D=function(){if(arguments.length===1){var t=arguments[0];return!(this.x!==t.x||this.y!==t.y)}else if(arguments.length===2){var e=arguments[0],n=arguments[1];return!(!Pd.equalsWithTolerance(this.x,e.x,n)||!Pd.equalsWithTolerance(this.y,e.y,n))}};Tt.prototype.getOrdinate=function(t){switch(t){case Tt.X:return this.x;case Tt.Y:return this.y;case Tt.Z:return this.z}throw new Xr("Invalid ordinate index: "+t)};Tt.prototype.equals3D=function(t){return this.x===t.x&&this.y===t.y&&(this.z===t.z||un.isNaN(this.z))&&un.isNaN(t.z)};Tt.prototype.equals=function(t){return t instanceof Tt?this.equals2D(t):!1};Tt.prototype.equalInZ=function(t,e){return Pd.equalsWithTolerance(this.z,t.z,e)};Tt.prototype.compareTo=function(t){var e=t;return this.x<e.x?-1:this.x>e.x?1:this.y<e.y?-1:this.y>e.y?1:0};Tt.prototype.clone=function(){};Tt.prototype.copy=function(){return new Tt(this)};Tt.prototype.toString=function(){return"("+this.x+", "+this.y+", "+this.z+")"};Tt.prototype.distance3D=function(t){var e=this.x-t.x,n=this.y-t.y,r=this.z-t.z;return Math.sqrt(e*e+n*n+r*r)};Tt.prototype.distance=function(t){var e=this.x-t.x,n=this.y-t.y;return Math.sqrt(e*e+n*n)};Tt.prototype.hashCode=function(){var t=17;return t=37*t+Tt.hashCode(this.x),t=37*t+Tt.hashCode(this.y),t};Tt.prototype.setCoordinate=function(t){this.x=t.x,this.y=t.y,this.z=t.z};Tt.prototype.interfaces_=function(){return[Tu,u0,Lu]};Tt.prototype.getClass=function(){return Tt};Tt.hashCode=function(){if(arguments.length===1){var t=arguments[0],e=un.doubleToLongBits(t);return Math.trunc((e^e)>>>32)}};og.DimensionalComparator.get=function(){return _p};og.serialVersionUID.get=function(){return 6683108902428367e3};og.NULL_ORDINATE.get=function(){return un.NaN};og.X.get=function(){return 0};og.Y.get=function(){return 1};og.Z.get=function(){return 2};Object.defineProperties(Tt,og);var _p=function(t){if(this._dimensionsToTest=2,arguments.length!==0&&arguments.length===1){var e=arguments[0];if(e!==2&&e!==3)throw new Xr("only 2 or 3 dimensions may be specified");this._dimensionsToTest=e}};_p.prototype.compare=function(t,e){var n=t,r=e,i=_p.compare(n.x,r.x);if(i!==0)return i;var a=_p.compare(n.y,r.y);if(a!==0)return a;if(this._dimensionsToTest<=2)return 0;var h=_p.compare(n.z,r.z);return h};_p.prototype.interfaces_=function(){return[qg]};_p.prototype.getClass=function(){return _p};_p.compare=function(t,e){return t<e?-1:t>e?1:un.isNaN(t)?un.isNaN(e)?0:-1:un.isNaN(e)?1:0};var jg=function(){};jg.prototype.create=function(){};jg.prototype.interfaces_=function(){return[]};jg.prototype.getClass=function(){return jg};var Pt=function(){},v_={INTERIOR:{configurable:!0},BOUNDARY:{configurable:!0},EXTERIOR:{configurable:!0},NONE:{configurable:!0}};Pt.prototype.interfaces_=function(){return[]};Pt.prototype.getClass=function(){return Pt};Pt.toLocationSymbol=function(t){switch(t){case Pt.EXTERIOR:return"e";case Pt.BOUNDARY:return"b";case Pt.INTERIOR:return"i";case Pt.NONE:return"-"}throw new Xr("Unknown location value: "+t)};v_.INTERIOR.get=function(){return 0};v_.BOUNDARY.get=function(){return 1};v_.EXTERIOR.get=function(){return 2};v_.NONE.get=function(){return-1};Object.defineProperties(Pt,v_);var tn=function(t,e){return t.interfaces_&&t.interfaces_().indexOf(e)>-1},Ya=function(){},cS={LOG_10:{configurable:!0}};Ya.prototype.interfaces_=function(){return[]};Ya.prototype.getClass=function(){return Ya};Ya.log10=function(t){var e=Math.log(t);return un.isInfinite(e)||un.isNaN(e)?e:e/Ya.LOG_10};Ya.min=function(t,e,n,r){var i=t;return e<i&&(i=e),n<i&&(i=n),r<i&&(i=r),i};Ya.clamp=function(){if(typeof arguments[2]=="number"&&typeof arguments[0]=="number"&&typeof arguments[1]=="number"){var t=arguments[0],e=arguments[1],n=arguments[2];return t<e?e:t>n?n:t}else if(Number.isInteger(arguments[2])&&Number.isInteger(arguments[0])&&Number.isInteger(arguments[1])){var r=arguments[0],i=arguments[1],a=arguments[2];return r<i?i:r>a?a:r}};Ya.wrap=function(t,e){return t<0?e- -t%e:t%e};Ya.max=function(){if(arguments.length===3){var t=arguments[0],e=arguments[1],n=arguments[2],r=t;return e>r&&(r=e),n>r&&(r=n),r}else if(arguments.length===4){var i=arguments[0],a=arguments[1],h=arguments[2],u=arguments[3],_=i;return a>_&&(_=a),h>_&&(_=h),u>_&&(_=u),_}};Ya.average=function(t,e){return(t+e)/2};cS.LOG_10.get=function(){return Math.log(10)};Object.defineProperties(Ya,cS);var fc=function(t){this.str=t};fc.prototype.append=function(t){this.str+=t};fc.prototype.setCharAt=function(t,e){this.str=this.str.substr(0,t)+e+this.str.substr(t+1)};fc.prototype.toString=function(t){return this.str};var Xl=function(t){this.value=t};Xl.prototype.intValue=function(){return this.value};Xl.prototype.compareTo=function(t){return this.value<t?-1:this.value>t?1:0};Xl.isNaN=function(t){return Number.isNaN(t)};var $y=function(){};$y.isWhitespace=function(t){return t<=32&&t>=0||t===127};$y.toUpperCase=function(t){return t.toUpperCase()};var Bt=function t(){if(this._hi=0,this._lo=0,arguments.length===0)this.init(0);else if(arguments.length===1){if(typeof arguments[0]=="number"){var e=arguments[0];this.init(e)}else if(arguments[0]instanceof t){var n=arguments[0];this.init(n)}else if(typeof arguments[0]=="string"){var r=arguments[0];t.call(this,t.parse(r))}}else if(arguments.length===2){var i=arguments[0],a=arguments[1];this.init(i,a)}},ul={PI:{configurable:!0},TWO_PI:{configurable:!0},PI_2:{configurable:!0},E:{configurable:!0},NaN:{configurable:!0},EPS:{configurable:!0},SPLIT:{configurable:!0},MAX_PRINT_DIGITS:{configurable:!0},TEN:{configurable:!0},ONE:{configurable:!0},SCI_NOT_EXPONENT_CHAR:{configurable:!0},SCI_NOT_ZERO:{configurable:!0}};Bt.prototype.le=function(t){return(this._hi<t._hi||this._hi===t._hi)&&this._lo<=t._lo};Bt.prototype.extractSignificantDigits=function(t,e){var n=this.abs(),r=Bt.magnitude(n._hi),i=Bt.TEN.pow(r);n=n.divide(i),n.gt(Bt.TEN)?(n=n.divide(Bt.TEN),r+=1):n.lt(Bt.ONE)&&(n=n.multiply(Bt.TEN),r-=1);for(var a=r+1,h=new fc,u=Bt.MAX_PRINT_DIGITS-1,_=0;_<=u;_++){t&&_===a&&h.append(".");var w=Math.trunc(n._hi);if(w<0)break;var C=!1,P=0;w>9?(C=!0,P="9"):P="0"+w,h.append(P),n=n.subtract(Bt.valueOf(w)).multiply(Bt.TEN),C&&n.selfAdd(Bt.TEN);var D=!0,B=Bt.magnitude(n._hi);if(B<0&&Math.abs(B)>=u-_&&(D=!1),!D)break}return e[0]=r,h.toString()};Bt.prototype.sqr=function(){return this.multiply(this)};Bt.prototype.doubleValue=function(){return this._hi+this._lo};Bt.prototype.subtract=function(){if(arguments[0]instanceof Bt){var t=arguments[0];return this.add(t.negate())}else if(typeof arguments[0]=="number"){var e=arguments[0];return this.add(-e)}};Bt.prototype.equals=function(){if(arguments.length===1){var t=arguments[0];return this._hi===t._hi&&this._lo===t._lo}};Bt.prototype.isZero=function(){return this._hi===0&&this._lo===0};Bt.prototype.selfSubtract=function(){if(arguments[0]instanceof Bt){var t=arguments[0];return this.isNaN()?this:this.selfAdd(-t._hi,-t._lo)}else if(typeof arguments[0]=="number"){var e=arguments[0];return this.isNaN()?this:this.selfAdd(-e,0)}};Bt.prototype.getSpecialNumberString=function(){return this.isZero()?"0.0":this.isNaN()?"NaN ":null};Bt.prototype.min=function(t){return this.le(t)?this:t};Bt.prototype.selfDivide=function(){if(arguments.length===1){if(arguments[0]instanceof Bt){var t=arguments[0];return this.selfDivide(t._hi,t._lo)}else if(typeof arguments[0]=="number"){var e=arguments[0];return this.selfDivide(e,0)}}else if(arguments.length===2){var n=arguments[0],r=arguments[1],i=null,a=null,h=null,u=null,_=null,w=null,C=null,P=null;return _=this._hi/n,w=Bt.SPLIT*_,i=w-_,P=Bt.SPLIT*n,i=w-i,a=_-i,h=P-n,C=_*n,h=P-h,u=n-h,P=i*h-C+i*u+a*h+a*u,w=(this._hi-C-P+this._lo-_*r)/n,P=_+w,this._hi=P,this._lo=_-P+w,this}};Bt.prototype.dump=function(){return"DD<"+this._hi+", "+this._lo+">"};Bt.prototype.divide=function(){if(arguments[0]instanceof Bt){var t=arguments[0],e=null,n=null,r=null,i=null,a=null,h=null,u=null,_=null;a=this._hi/t._hi,h=Bt.SPLIT*a,e=h-a,_=Bt.SPLIT*t._hi,e=h-e,n=a-e,r=_-t._hi,u=a*t._hi,r=_-r,i=t._hi-r,_=e*r-u+e*i+n*r+n*i,h=(this._hi-u-_+this._lo-a*t._lo)/t._hi,_=a+h;var w=_,C=a-_+h;return new Bt(w,C)}else if(typeof arguments[0]=="number"){var P=arguments[0];return un.isNaN(P)?Bt.createNaN():Bt.copy(this).selfDivide(P,0)}};Bt.prototype.ge=function(t){return(this._hi>t._hi||this._hi===t._hi)&&this._lo>=t._lo};Bt.prototype.pow=function(t){if(t===0)return Bt.valueOf(1);var e=new Bt(this),n=Bt.valueOf(1),r=Math.abs(t);if(r>1)for(;r>0;)r%2===1&&n.selfMultiply(e),r/=2,r>0&&(e=e.sqr());else n=e;return t<0?n.reciprocal():n};Bt.prototype.ceil=function(){if(this.isNaN())return Bt.NaN;var t=Math.ceil(this._hi),e=0;return t===this._hi&&(e=Math.ceil(this._lo)),new Bt(t,e)};Bt.prototype.compareTo=function(t){var e=t;return this._hi<e._hi?-1:this._hi>e._hi?1:this._lo<e._lo?-1:this._lo>e._lo?1:0};Bt.prototype.rint=function(){if(this.isNaN())return this;var t=this.add(.5);return t.floor()};Bt.prototype.setValue=function(){if(arguments[0]instanceof Bt){var t=arguments[0];return this.init(t),this}else if(typeof arguments[0]=="number"){var e=arguments[0];return this.init(e),this}};Bt.prototype.max=function(t){return this.ge(t)?this:t};Bt.prototype.sqrt=function(){if(this.isZero())return Bt.valueOf(0);if(this.isNegative())return Bt.NaN;var t=1/Math.sqrt(this._hi),e=this._hi*t,n=Bt.valueOf(e),r=this.subtract(n.sqr()),i=r._hi*(t*.5);return n.add(i)};Bt.prototype.selfAdd=function(){if(arguments.length===1){if(arguments[0]instanceof Bt){var t=arguments[0];return this.selfAdd(t._hi,t._lo)}else if(typeof arguments[0]=="number"){var e=arguments[0],n=null,r=null,i=null,a=null,h=null,u=null;return i=this._hi+e,h=i-this._hi,a=i-h,a=e-h+(this._hi-a),u=a+this._lo,n=i+u,r=u+(i-n),this._hi=n+r,this._lo=r+(n-this._hi),this}}else if(arguments.length===2){var _=arguments[0],w=arguments[1],C=null,P=null,D=null,B=null,$=null,Z=null,W=null,rt=null;$=this._hi+_,D=this._lo+w,W=$-this._hi,rt=D-this._lo,Z=$-W,B=D-rt,Z=_-W+(this._hi-Z),B=w-rt+(this._lo-B),W=Z+D,C=$+W,P=W+($-C),W=B+P;var ct=C+W,pt=W+(C-ct);return this._hi=ct,this._lo=pt,this}};Bt.prototype.selfMultiply=function(){if(arguments.length===1){if(arguments[0]instanceof Bt){var t=arguments[0];return this.selfMultiply(t._hi,t._lo)}else if(typeof arguments[0]=="number"){var e=arguments[0];return this.selfMultiply(e,0)}}else if(arguments.length===2){var n=arguments[0],r=arguments[1],i=null,a=null,h=null,u=null,_=null,w=null;_=Bt.SPLIT*this._hi,i=_-this._hi,w=Bt.SPLIT*n,i=_-i,a=this._hi-i,h=w-n,_=this._hi*n,h=w-h,u=n-h,w=i*h-_+i*u+a*h+a*u+(this._hi*r+this._lo*n);var C=_+w;i=_-C;var P=w+i;return this._hi=C,this._lo=P,this}};Bt.prototype.selfSqr=function(){return this.selfMultiply(this)};Bt.prototype.floor=function(){if(this.isNaN())return Bt.NaN;var t=Math.floor(this._hi),e=0;return t===this._hi&&(e=Math.floor(this._lo)),new Bt(t,e)};Bt.prototype.negate=function(){return this.isNaN()?this:new Bt(-this._hi,-this._lo)};Bt.prototype.clone=function(){};Bt.prototype.multiply=function(){if(arguments[0]instanceof Bt){var t=arguments[0];return t.isNaN()?Bt.createNaN():Bt.copy(this).selfMultiply(t)}else if(typeof arguments[0]=="number"){var e=arguments[0];return un.isNaN(e)?Bt.createNaN():Bt.copy(this).selfMultiply(e,0)}};Bt.prototype.isNaN=function(){return un.isNaN(this._hi)};Bt.prototype.intValue=function(){return Math.trunc(this._hi)};Bt.prototype.toString=function(){var t=Bt.magnitude(this._hi);return t>=-3&&t<=20?this.toStandardNotation():this.toSciNotation()};Bt.prototype.toStandardNotation=function(){var t=this.getSpecialNumberString();if(t!==null)return t;var e=new Array(1).fill(null),n=this.extractSignificantDigits(!0,e),r=e[0]+1,i=n;if(n.charAt(0)===".")i="0"+n;else if(r<0)i="0."+Bt.stringOfChar("0",-r)+n;else if(n.indexOf(".")===-1){var a=r-n.length,h=Bt.stringOfChar("0",a);i=n+h+".0"}return this.isNegative()?"-"+i:i};Bt.prototype.reciprocal=function(){var t=null,e=null,n=null,r=null,i=null,a=null,h=null,u=null;i=1/this._hi,a=Bt.SPLIT*i,t=a-i,u=Bt.SPLIT*this._hi,t=a-t,e=i-t,n=u-this._hi,h=i*this._hi,n=u-n,r=this._hi-n,u=t*n-h+t*r+e*n+e*r,a=(1-h-u-i*this._lo)/this._hi;var _=i+a,w=i-_+a;return new Bt(_,w)};Bt.prototype.toSciNotation=function(){if(this.isZero())return Bt.SCI_NOT_ZERO;var t=this.getSpecialNumberString();if(t!==null)return t;var e=new Array(1).fill(null),n=this.extractSignificantDigits(!1,e),r=Bt.SCI_NOT_EXPONENT_CHAR+e[0];if(n.charAt(0)==="0")throw new Error("Found leading zero: "+n);var i="";n.length>1&&(i=n.substring(1));var a=n.charAt(0)+"."+i;return this.isNegative()?"-"+a+r:a+r};Bt.prototype.abs=function(){return this.isNaN()?Bt.NaN:this.isNegative()?this.negate():new Bt(this)};Bt.prototype.isPositive=function(){return(this._hi>0||this._hi===0)&&this._lo>0};Bt.prototype.lt=function(t){return(this._hi<t._hi||this._hi===t._hi)&&this._lo<t._lo};Bt.prototype.add=function(){if(arguments[0]instanceof Bt){var t=arguments[0];return Bt.copy(this).selfAdd(t)}else if(typeof arguments[0]=="number"){var e=arguments[0];return Bt.copy(this).selfAdd(e)}};Bt.prototype.init=function(){if(arguments.length===1){if(typeof arguments[0]=="number"){var t=arguments[0];this._hi=t,this._lo=0}else if(arguments[0]instanceof Bt){var e=arguments[0];this._hi=e._hi,this._lo=e._lo}}else if(arguments.length===2){var n=arguments[0],r=arguments[1];this._hi=n,this._lo=r}};Bt.prototype.gt=function(t){return(this._hi>t._hi||this._hi===t._hi)&&this._lo>t._lo};Bt.prototype.isNegative=function(){return(this._hi<0||this._hi===0)&&this._lo<0};Bt.prototype.trunc=function(){return this.isNaN()?Bt.NaN:this.isPositive()?this.floor():this.ceil()};Bt.prototype.signum=function(){return this._hi>0?1:this._hi<0?-1:this._lo>0?1:this._lo<0?-1:0};Bt.prototype.interfaces_=function(){return[Lu,Tu,u0]};Bt.prototype.getClass=function(){return Bt};Bt.sqr=function(t){return Bt.valueOf(t).selfMultiply(t)};Bt.valueOf=function(){if(typeof arguments[0]=="string"){var t=arguments[0];return Bt.parse(t)}else if(typeof arguments[0]=="number"){var e=arguments[0];return new Bt(e)}};Bt.sqrt=function(t){return Bt.valueOf(t).sqrt()};Bt.parse=function(t){for(var e=0,n=t.length;$y.isWhitespace(t.charAt(e));)e++;var r=!1;if(e<n){var i=t.charAt(e);(i==="-"||i==="+")&&(e++,i==="-"&&(r=!0))}for(var a=new Bt,h=0,u=0,_=0;!(e>=n);){var w=t.charAt(e);if(e++,$y.isDigit(w)){var C=w-"0";a.selfMultiply(Bt.TEN),a.selfAdd(C),h++;continue}if(w==="."){u=h;continue}if(w==="e"||w==="E"){var P=t.substring(e);try{_=Xl.parseInt(P)}catch(W){throw W instanceof Error?new Error("Invalid exponent "+P+" in string "+t):W}finally{}break}throw new Error("Unexpected character '"+w+"' at position "+e+" in string "+t)}var D=a,B=h-u-_;if(B===0)D=a;else if(B>0){var $=Bt.TEN.pow(B);D=a.divide($)}else if(B<0){var Z=Bt.TEN.pow(-B);D=a.multiply(Z)}return r?D.negate():D};Bt.createNaN=function(){return new Bt(un.NaN,un.NaN)};Bt.copy=function(t){return new Bt(t)};Bt.magnitude=function(t){var e=Math.abs(t),n=Math.log(e)/Math.log(10),r=Math.trunc(Math.floor(n)),i=Math.pow(10,r);return i*10<=e&&(r+=1),r};Bt.stringOfChar=function(t,e){for(var n=new fc,r=0;r<e;r++)n.append(t);return n.toString()};ul.PI.get=function(){return new Bt(3.141592653589793,12246467991473532e-32)};ul.TWO_PI.get=function(){return new Bt(6.283185307179586,24492935982947064e-32)};ul.PI_2.get=function(){return new Bt(1.5707963267948966,6123233995736766e-32)};ul.E.get=function(){return new Bt(2.718281828459045,14456468917292502e-32)};ul.NaN.get=function(){return new Bt(un.NaN,un.NaN)};ul.EPS.get=function(){return 123259516440783e-46};ul.SPLIT.get=function(){return 134217729};ul.MAX_PRINT_DIGITS.get=function(){return 32};ul.TEN.get=function(){return Bt.valueOf(10)};ul.ONE.get=function(){return Bt.valueOf(1)};ul.SCI_NOT_EXPONENT_CHAR.get=function(){return"E"};ul.SCI_NOT_ZERO.get=function(){return"0.0E0"};Object.defineProperties(Bt,ul);var Hs=function(){},hS={DP_SAFE_EPSILON:{configurable:!0}};Hs.prototype.interfaces_=function(){return[]};Hs.prototype.getClass=function(){return Hs};Hs.orientationIndex=function(t,e,n){var r=Hs.orientationIndexFilter(t,e,n);if(r<=1)return r;var i=Bt.valueOf(e.x).selfAdd(-t.x),a=Bt.valueOf(e.y).selfAdd(-t.y),h=Bt.valueOf(n.x).selfAdd(-e.x),u=Bt.valueOf(n.y).selfAdd(-e.y);return i.selfMultiply(u).selfSubtract(a.selfMultiply(h)).signum()};Hs.signOfDet2x2=function(t,e,n,r){var i=t.multiply(r).selfSubtract(e.multiply(n));return i.signum()};Hs.intersection=function(t,e,n,r){var i=Bt.valueOf(r.y).selfSubtract(n.y).selfMultiply(Bt.valueOf(e.x).selfSubtract(t.x)),a=Bt.valueOf(r.x).selfSubtract(n.x).selfMultiply(Bt.valueOf(e.y).selfSubtract(t.y)),h=i.subtract(a),u=Bt.valueOf(r.x).selfSubtract(n.x).selfMultiply(Bt.valueOf(t.y).selfSubtract(n.y)),_=Bt.valueOf(r.y).selfSubtract(n.y).selfMultiply(Bt.valueOf(t.x).selfSubtract(n.x)),w=u.subtract(_),C=w.selfDivide(h).doubleValue(),P=Bt.valueOf(t.x).selfAdd(Bt.valueOf(e.x).selfSubtract(t.x).selfMultiply(C)).doubleValue(),D=Bt.valueOf(e.x).selfSubtract(t.x).selfMultiply(Bt.valueOf(t.y).selfSubtract(n.y)),B=Bt.valueOf(e.y).selfSubtract(t.y).selfMultiply(Bt.valueOf(t.x).selfSubtract(n.x)),$=D.subtract(B),Z=$.selfDivide(h).doubleValue(),W=Bt.valueOf(n.y).selfAdd(Bt.valueOf(r.y).selfSubtract(n.y).selfMultiply(Z)).doubleValue();return new Tt(P,W)};Hs.orientationIndexFilter=function(t,e,n){var r=null,i=(t.x-n.x)*(e.y-n.y),a=(t.y-n.y)*(e.x-n.x),h=i-a;if(i>0){if(a<=0)return Hs.signum(h);r=i+a}else if(i<0){if(a>=0)return Hs.signum(h);r=-i-a}else return Hs.signum(h);var u=Hs.DP_SAFE_EPSILON*r;return h>=u||-h>=u?Hs.signum(h):2};Hs.signum=function(t){return t>0?1:t<0?-1:0};hS.DP_SAFE_EPSILON.get=function(){return 1e-15};Object.defineProperties(Hs,hS);var zn=function(){},x_={X:{configurable:!0},Y:{configurable:!0},Z:{configurable:!0},M:{configurable:!0}};x_.X.get=function(){return 0};x_.Y.get=function(){return 1};x_.Z.get=function(){return 2};x_.M.get=function(){return 3};zn.prototype.setOrdinate=function(t,e,n){};zn.prototype.size=function(){};zn.prototype.getOrdinate=function(t,e){};zn.prototype.getCoordinate=function(){};zn.prototype.getCoordinateCopy=function(t){};zn.prototype.getDimension=function(){};zn.prototype.getX=function(t){};zn.prototype.clone=function(){};zn.prototype.expandEnvelope=function(t){};zn.prototype.copy=function(){};zn.prototype.getY=function(t){};zn.prototype.toCoordinateArray=function(){};zn.prototype.interfaces_=function(){return[u0]};zn.prototype.getClass=function(){return zn};Object.defineProperties(zn,x_);var pS=function(){},Dm=function(t){function e(){t.call(this,"Projective point not representable on the Cartesian plane.")}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.interfaces_=function(){return[]},e.prototype.getClass=function(){return e},e}(pS),Fo=function(){};Fo.arraycopy=function(t,e,n,r,i){for(var a=0,h=e;h<e+i;h++)n[r+a]=t[h],a++};Fo.getProperty=function(t){return{"line.separator":`
`}[t]};var qu=function t(){if(this.x=null,this.y=null,this.w=null,arguments.length===0)this.x=0,this.y=0,this.w=1;else if(arguments.length===1){var e=arguments[0];this.x=e.x,this.y=e.y,this.w=1}else if(arguments.length===2){if(typeof arguments[0]=="number"&&typeof arguments[1]=="number"){var n=arguments[0],r=arguments[1];this.x=n,this.y=r,this.w=1}else if(arguments[0]instanceof t&&arguments[1]instanceof t){var i=arguments[0],a=arguments[1];this.x=i.y*a.w-a.y*i.w,this.y=a.x*i.w-i.x*a.w,this.w=i.x*a.y-a.x*i.y}else if(arguments[0]instanceof Tt&&arguments[1]instanceof Tt){var h=arguments[0],u=arguments[1];this.x=h.y-u.y,this.y=u.x-h.x,this.w=h.x*u.y-u.x*h.y}}else if(arguments.length===3){var _=arguments[0],w=arguments[1],C=arguments[2];this.x=_,this.y=w,this.w=C}else if(arguments.length===4){var P=arguments[0],D=arguments[1],B=arguments[2],$=arguments[3],Z=P.y-D.y,W=D.x-P.x,rt=P.x*D.y-D.x*P.y,ct=B.y-$.y,pt=$.x-B.x,gt=B.x*$.y-$.x*B.y;this.x=W*gt-pt*rt,this.y=ct*rt-Z*gt,this.w=Z*pt-ct*W}};qu.prototype.getY=function(){var t=this.y/this.w;if(un.isNaN(t)||un.isInfinite(t))throw new Dm;return t};qu.prototype.getX=function(){var t=this.x/this.w;if(un.isNaN(t)||un.isInfinite(t))throw new Dm;return t};qu.prototype.getCoordinate=function(){var t=new Tt;return t.x=this.getX(),t.y=this.getY(),t};qu.prototype.interfaces_=function(){return[]};qu.prototype.getClass=function(){return qu};qu.intersection=function(t,e,n,r){var i=t.y-e.y,a=e.x-t.x,h=t.x*e.y-e.x*t.y,u=n.y-r.y,_=r.x-n.x,w=n.x*r.y-r.x*n.y,C=a*w-_*h,P=u*h-i*w,D=i*_-u*a,B=C/D,$=P/D;if(un.isNaN(B)||un.isInfinite(B)||un.isNaN($)||un.isInfinite($))throw new Dm;return new Tt(B,$)};var Be=function t(){if(this._minx=null,this._maxx=null,this._miny=null,this._maxy=null,arguments.length===0)this.init();else if(arguments.length===1){if(arguments[0]instanceof Tt){var e=arguments[0];this.init(e.x,e.x,e.y,e.y)}else if(arguments[0]instanceof t){var n=arguments[0];this.init(n)}}else if(arguments.length===2){var r=arguments[0],i=arguments[1];this.init(r.x,i.x,r.y,i.y)}else if(arguments.length===4){var a=arguments[0],h=arguments[1],u=arguments[2],_=arguments[3];this.init(a,h,u,_)}},fS={serialVersionUID:{configurable:!0}};Be.prototype.getArea=function(){return this.getWidth()*this.getHeight()};Be.prototype.equals=function(t){if(!(t instanceof Be))return!1;var e=t;return this.isNull()?e.isNull():this._maxx===e.getMaxX()&&this._maxy===e.getMaxY()&&this._minx===e.getMinX()&&this._miny===e.getMinY()};Be.prototype.intersection=function(t){if(this.isNull()||t.isNull()||!this.intersects(t))return new Be;var e=this._minx>t._minx?this._minx:t._minx,n=this._miny>t._miny?this._miny:t._miny,r=this._maxx<t._maxx?this._maxx:t._maxx,i=this._maxy<t._maxy?this._maxy:t._maxy;return new Be(e,r,n,i)};Be.prototype.isNull=function(){return this._maxx<this._minx};Be.prototype.getMaxX=function(){return this._maxx};Be.prototype.covers=function(){if(arguments.length===1){if(arguments[0]instanceof Tt){var t=arguments[0];return this.covers(t.x,t.y)}else if(arguments[0]instanceof Be){var e=arguments[0];return this.isNull()||e.isNull()?!1:e.getMinX()>=this._minx&&e.getMaxX()<=this._maxx&&e.getMinY()>=this._miny&&e.getMaxY()<=this._maxy}}else if(arguments.length===2){var n=arguments[0],r=arguments[1];return this.isNull()?!1:n>=this._minx&&n<=this._maxx&&r>=this._miny&&r<=this._maxy}};Be.prototype.intersects=function(){if(arguments.length===1){if(arguments[0]instanceof Be){var t=arguments[0];return this.isNull()||t.isNull()?!1:!(t._minx>this._maxx||t._maxx<this._minx||t._miny>this._maxy||t._maxy<this._miny)}else if(arguments[0]instanceof Tt){var e=arguments[0];return this.intersects(e.x,e.y)}}else if(arguments.length===2){var n=arguments[0],r=arguments[1];return this.isNull()?!1:!(n>this._maxx||n<this._minx||r>this._maxy||r<this._miny)}};Be.prototype.getMinY=function(){return this._miny};Be.prototype.getMinX=function(){return this._minx};Be.prototype.expandToInclude=function(){if(arguments.length===1){if(arguments[0]instanceof Tt){var t=arguments[0];this.expandToInclude(t.x,t.y)}else if(arguments[0]instanceof Be){var e=arguments[0];if(e.isNull())return null;this.isNull()?(this._minx=e.getMinX(),this._maxx=e.getMaxX(),this._miny=e.getMinY(),this._maxy=e.getMaxY()):(e._minx<this._minx&&(this._minx=e._minx),e._maxx>this._maxx&&(this._maxx=e._maxx),e._miny<this._miny&&(this._miny=e._miny),e._maxy>this._maxy&&(this._maxy=e._maxy))}}else if(arguments.length===2){var n=arguments[0],r=arguments[1];this.isNull()?(this._minx=n,this._maxx=n,this._miny=r,this._maxy=r):(n<this._minx&&(this._minx=n),n>this._maxx&&(this._maxx=n),r<this._miny&&(this._miny=r),r>this._maxy&&(this._maxy=r))}};Be.prototype.minExtent=function(){if(this.isNull())return 0;var t=this.getWidth(),e=this.getHeight();return t<e?t:e};Be.prototype.getWidth=function(){return this.isNull()?0:this._maxx-this._minx};Be.prototype.compareTo=function(t){var e=t;return this.isNull()?e.isNull()?0:-1:e.isNull()?1:this._minx<e._minx?-1:this._minx>e._minx?1:this._miny<e._miny?-1:this._miny>e._miny?1:this._maxx<e._maxx?-1:this._maxx>e._maxx?1:this._maxy<e._maxy?-1:this._maxy>e._maxy?1:0};Be.prototype.translate=function(t,e){if(this.isNull())return null;this.init(this.getMinX()+t,this.getMaxX()+t,this.getMinY()+e,this.getMaxY()+e)};Be.prototype.toString=function(){return"Env["+this._minx+" : "+this._maxx+", "+this._miny+" : "+this._maxy+"]"};Be.prototype.setToNull=function(){this._minx=0,this._maxx=-1,this._miny=0,this._maxy=-1};Be.prototype.getHeight=function(){return this.isNull()?0:this._maxy-this._miny};Be.prototype.maxExtent=function(){if(this.isNull())return 0;var t=this.getWidth(),e=this.getHeight();return t>e?t:e};Be.prototype.expandBy=function(){if(arguments.length===1){var t=arguments[0];this.expandBy(t,t)}else if(arguments.length===2){var e=arguments[0],n=arguments[1];if(this.isNull())return null;this._minx-=e,this._maxx+=e,this._miny-=n,this._maxy+=n,(this._minx>this._maxx||this._miny>this._maxy)&&this.setToNull()}};Be.prototype.contains=function(){if(arguments.length===1){if(arguments[0]instanceof Be){var t=arguments[0];return this.covers(t)}else if(arguments[0]instanceof Tt){var e=arguments[0];return this.covers(e)}}else if(arguments.length===2){var n=arguments[0],r=arguments[1];return this.covers(n,r)}};Be.prototype.centre=function(){return this.isNull()?null:new Tt((this.getMinX()+this.getMaxX())/2,(this.getMinY()+this.getMaxY())/2)};Be.prototype.init=function(){if(arguments.length===0)this.setToNull();else if(arguments.length===1){if(arguments[0]instanceof Tt){var t=arguments[0];this.init(t.x,t.x,t.y,t.y)}else if(arguments[0]instanceof Be){var e=arguments[0];this._minx=e._minx,this._maxx=e._maxx,this._miny=e._miny,this._maxy=e._maxy}}else if(arguments.length===2){var n=arguments[0],r=arguments[1];this.init(n.x,r.x,n.y,r.y)}else if(arguments.length===4){var i=arguments[0],a=arguments[1],h=arguments[2],u=arguments[3];i<a?(this._minx=i,this._maxx=a):(this._minx=a,this._maxx=i),h<u?(this._miny=h,this._maxy=u):(this._miny=u,this._maxy=h)}};Be.prototype.getMaxY=function(){return this._maxy};Be.prototype.distance=function(t){if(this.intersects(t))return 0;var e=0;this._maxx<t._minx?e=t._minx-this._maxx:this._minx>t._maxx&&(e=this._minx-t._maxx);var n=0;return this._maxy<t._miny?n=t._miny-this._maxy:this._miny>t._maxy&&(n=this._miny-t._maxy),e===0?n:n===0?e:Math.sqrt(e*e+n*n)};Be.prototype.hashCode=function(){var t=17;return t=37*t+Tt.hashCode(this._minx),t=37*t+Tt.hashCode(this._maxx),t=37*t+Tt.hashCode(this._miny),t=37*t+Tt.hashCode(this._maxy),t};Be.prototype.interfaces_=function(){return[Tu,Lu]};Be.prototype.getClass=function(){return Be};Be.intersects=function(){if(arguments.length===3){var t=arguments[0],e=arguments[1],n=arguments[2];return n.x>=(t.x<e.x?t.x:e.x)&&n.x<=(t.x>e.x?t.x:e.x)&&n.y>=(t.y<e.y?t.y:e.y)&&n.y<=(t.y>e.y?t.y:e.y)}else if(arguments.length===4){var r=arguments[0],i=arguments[1],a=arguments[2],h=arguments[3],u=Math.min(a.x,h.x),_=Math.max(a.x,h.x),w=Math.min(r.x,i.x),C=Math.max(r.x,i.x);return!(w>_||C<u||(u=Math.min(a.y,h.y),_=Math.max(a.y,h.y),w=Math.min(r.y,i.y),C=Math.max(r.y,i.y),w>_)||C<u)}};fS.serialVersionUID.get=function(){return 5873921885273102e3};Object.defineProperties(Be,fS);var Dl={typeStr:/^\s*(\w+)\s*\(\s*(.*)\s*\)\s*$/,emptyTypeStr:/^\s*(\w+)\s*EMPTY\s*$/,spaces:/\s+/,parenComma:/\)\s*,\s*\(/,doubleParenComma:/\)\s*\)\s*,\s*\(\s*\(/,trimParens:/^\s*\(?(.*?)\)?\s*$/},l0=function(t){this.geometryFactory=t||new wn};l0.prototype.read=function(t){var e,n,r;t=t.replace(/[\n\r]/g," ");var i=Dl.typeStr.exec(t);if(t.search("EMPTY")!==-1&&(i=Dl.emptyTypeStr.exec(t),i[2]=void 0),i&&(n=i[1].toLowerCase(),r=i[2],Vg[n]&&(e=Vg[n].apply(this,[r]))),e===void 0)throw new Error("Could not parse WKT "+t);return e};l0.prototype.write=function(t){return this.extractGeometry(t)};l0.prototype.extractGeometry=function(t){var e=t.getGeometryType().toLowerCase();if(!vh[e])return null;var n=e.toUpperCase(),r;return t.isEmpty()?r=n+" EMPTY":r=n+"("+vh[e].apply(this,[t])+")",r};var vh={coordinate:function(t){return t.x+" "+t.y},point:function(t){return vh.coordinate.call(this,t._coordinates._coordinates[0])},multipoint:function(t){for(var e=this,n=[],r=0,i=t._geometries.length;r<i;++r)n.push("("+vh.point.apply(e,[t._geometries[r]])+")");return n.join(",")},linestring:function(t){for(var e=this,n=[],r=0,i=t._points._coordinates.length;r<i;++r)n.push(vh.coordinate.apply(e,[t._points._coordinates[r]]));return n.join(",")},linearring:function(t){for(var e=this,n=[],r=0,i=t._points._coordinates.length;r<i;++r)n.push(vh.coordinate.apply(e,[t._points._coordinates[r]]));return n.join(",")},multilinestring:function(t){for(var e=this,n=[],r=0,i=t._geometries.length;r<i;++r)n.push("("+vh.linestring.apply(e,[t._geometries[r]])+")");return n.join(",")},polygon:function(t){var e=this,n=[];n.push("("+vh.linestring.apply(this,[t._shell])+")");for(var r=0,i=t._holes.length;r<i;++r)n.push("("+vh.linestring.apply(e,[t._holes[r]])+")");return n.join(",")},multipolygon:function(t){for(var e=this,n=[],r=0,i=t._geometries.length;r<i;++r)n.push("("+vh.polygon.apply(e,[t._geometries[r]])+")");return n.join(",")},geometrycollection:function(t){for(var e=this,n=[],r=0,i=t._geometries.length;r<i;++r)n.push(e.extractGeometry(t._geometries[r]));return n.join(",")}},Vg={point:function(t){if(t===void 0)return this.geometryFactory.createPoint();var e=t.trim().split(Dl.spaces);return this.geometryFactory.createPoint(new Tt(Number.parseFloat(e[0]),Number.parseFloat(e[1])))},multipoint:function(t){var e=this;if(t===void 0)return this.geometryFactory.createMultiPoint();for(var n,r=t.trim().split(","),i=[],a=0,h=r.length;a<h;++a)n=r[a].replace(Dl.trimParens,"$1"),i.push(Vg.point.apply(e,[n]));return this.geometryFactory.createMultiPoint(i)},linestring:function(t){if(t===void 0)return this.geometryFactory.createLineString();for(var e=t.trim().split(","),n=[],r,i=0,a=e.length;i<a;++i)r=e[i].trim().split(Dl.spaces),n.push(new Tt(Number.parseFloat(r[0]),Number.parseFloat(r[1])));return this.geometryFactory.createLineString(n)},linearring:function(t){if(t===void 0)return this.geometryFactory.createLinearRing();for(var e=t.trim().split(","),n=[],r,i=0,a=e.length;i<a;++i)r=e[i].trim().split(Dl.spaces),n.push(new Tt(Number.parseFloat(r[0]),Number.parseFloat(r[1])));return this.geometryFactory.createLinearRing(n)},multilinestring:function(t){var e=this;if(t===void 0)return this.geometryFactory.createMultiLineString();for(var n,r=t.trim().split(Dl.parenComma),i=[],a=0,h=r.length;a<h;++a)n=r[a].replace(Dl.trimParens,"$1"),i.push(Vg.linestring.apply(e,[n]));return this.geometryFactory.createMultiLineString(i)},polygon:function(t){var e=this;if(t===void 0)return this.geometryFactory.createPolygon();for(var n,r,i,a=t.trim().split(Dl.parenComma),h,u=[],_=0,w=a.length;_<w;++_)n=a[_].replace(Dl.trimParens,"$1"),r=Vg.linestring.apply(e,[n]),i=e.geometryFactory.createLinearRing(r._points),_===0?h=i:u.push(i);return this.geometryFactory.createPolygon(h,u)},multipolygon:function(t){var e=this;if(t===void 0)return this.geometryFactory.createMultiPolygon();for(var n,r=t.trim().split(Dl.doubleParenComma),i=[],a=0,h=r.length;a<h;++a)n=r[a].replace(Dl.trimParens,"$1"),i.push(Vg.polygon.apply(e,[n]));return this.geometryFactory.createMultiPolygon(i)},geometrycollection:function(t){var e=this;if(t===void 0)return this.geometryFactory.createGeometryCollection();t=t.replace(/,\s*([A-Za-z])/g,"|$1");for(var n=t.trim().split("|"),r=[],i=0,a=n.length;i<a;++i)r.push(e.read(n[i]));return this.geometryFactory.createGeometryCollection(r)}},Zu=function(t){this.parser=new l0(t)};Zu.prototype.write=function(t){return this.parser.write(t)};Zu.toLineString=function(t,e){if(arguments.length!==2)throw new Error("Not implemented");return"LINESTRING ( "+t.x+" "+t.y+", "+e.x+" "+e.y+" )"};var Ph=function(t){function e(n){t.call(this,n),this.name="RuntimeException",this.message=n,this.stack=new t().stack}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e}(Error),Fv=function(t){function e(){if(t.call(this),arguments.length===0)t.call(this);else if(arguments.length===1){var n=arguments[0];t.call(this,n)}}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.interfaces_=function(){return[]},e.prototype.getClass=function(){return e},e}(Ph),fn=function(){};fn.prototype.interfaces_=function(){return[]};fn.prototype.getClass=function(){return fn};fn.shouldNeverReachHere=function(){if(arguments.length===0)fn.shouldNeverReachHere(null);else if(arguments.length===1){var t=arguments[0];throw new Fv("Should never reach here"+(t!==null?": "+t:""))}};fn.isTrue=function(){var t,e;if(arguments.length===1)t=arguments[0],fn.isTrue(t,null);else if(arguments.length===2&&(t=arguments[0],e=arguments[1],!t))throw e===null?new Fv:new Fv(e)};fn.equals=function(){var t,e,n;if(arguments.length===2)t=arguments[0],e=arguments[1],fn.equals(t,e,null);else if(arguments.length===3&&(t=arguments[0],e=arguments[1],n=arguments[2],!e.equals(t)))throw new Fv("Expected "+t+" but encountered "+e+(n!==null?": "+n:""))};var Jr=function(){this._result=null,this._inputLines=Array(2).fill().map(function(){return Array(2)}),this._intPt=new Array(2).fill(null),this._intLineIndex=null,this._isProper=null,this._pa=null,this._pb=null,this._precisionModel=null,this._intPt[0]=new Tt,this._intPt[1]=new Tt,this._pa=this._intPt[0],this._pb=this._intPt[1],this._result=0},sg={DONT_INTERSECT:{configurable:!0},DO_INTERSECT:{configurable:!0},COLLINEAR:{configurable:!0},NO_INTERSECTION:{configurable:!0},POINT_INTERSECTION:{configurable:!0},COLLINEAR_INTERSECTION:{configurable:!0}};Jr.prototype.getIndexAlongSegment=function(t,e){return this.computeIntLineIndex(),this._intLineIndex[t][e]};Jr.prototype.getTopologySummary=function(){var t=new fc;return this.isEndPoint()&&t.append(" endpoint"),this._isProper&&t.append(" proper"),this.isCollinear()&&t.append(" collinear"),t.toString()};Jr.prototype.computeIntersection=function(t,e,n,r){this._inputLines[0][0]=t,this._inputLines[0][1]=e,this._inputLines[1][0]=n,this._inputLines[1][1]=r,this._result=this.computeIntersect(t,e,n,r)};Jr.prototype.getIntersectionNum=function(){return this._result};Jr.prototype.computeIntLineIndex=function(){if(arguments.length===0)this._intLineIndex===null&&(this._intLineIndex=Array(2).fill().map(function(){return Array(2)}),this.computeIntLineIndex(0),this.computeIntLineIndex(1));else if(arguments.length===1){var t=arguments[0],e=this.getEdgeDistance(t,0),n=this.getEdgeDistance(t,1);e>n?(this._intLineIndex[t][0]=0,this._intLineIndex[t][1]=1):(this._intLineIndex[t][0]=1,this._intLineIndex[t][1]=0)}};Jr.prototype.isProper=function(){return this.hasIntersection()&&this._isProper};Jr.prototype.setPrecisionModel=function(t){this._precisionModel=t};Jr.prototype.isInteriorIntersection=function(){var t=this;if(arguments.length===0)return!!(this.isInteriorIntersection(0)||this.isInteriorIntersection(1));if(arguments.length===1){for(var e=arguments[0],n=0;n<this._result;n++)if(!(t._intPt[n].equals2D(t._inputLines[e][0])||t._intPt[n].equals2D(t._inputLines[e][1])))return!0;return!1}};Jr.prototype.getIntersection=function(t){return this._intPt[t]};Jr.prototype.isEndPoint=function(){return this.hasIntersection()&&!this._isProper};Jr.prototype.hasIntersection=function(){return this._result!==Jr.NO_INTERSECTION};Jr.prototype.getEdgeDistance=function(t,e){var n=Jr.computeEdgeDistance(this._intPt[e],this._inputLines[t][0],this._inputLines[t][1]);return n};Jr.prototype.isCollinear=function(){return this._result===Jr.COLLINEAR_INTERSECTION};Jr.prototype.toString=function(){return Zu.toLineString(this._inputLines[0][0],this._inputLines[0][1])+" - "+Zu.toLineString(this._inputLines[1][0],this._inputLines[1][1])+this.getTopologySummary()};Jr.prototype.getEndpoint=function(t,e){return this._inputLines[t][e]};Jr.prototype.isIntersection=function(t){for(var e=this,n=0;n<this._result;n++)if(e._intPt[n].equals2D(t))return!0;return!1};Jr.prototype.getIntersectionAlongSegment=function(t,e){return this.computeIntLineIndex(),this._intPt[this._intLineIndex[t][e]]};Jr.prototype.interfaces_=function(){return[]};Jr.prototype.getClass=function(){return Jr};Jr.computeEdgeDistance=function(t,e,n){var r=Math.abs(n.x-e.x),i=Math.abs(n.y-e.y),a=-1;if(t.equals(e))a=0;else if(t.equals(n))r>i?a=r:a=i;else{var h=Math.abs(t.x-e.x),u=Math.abs(t.y-e.y);r>i?a=h:a=u,a===0&&!t.equals(e)&&(a=Math.max(h,u))}return fn.isTrue(!(a===0&&!t.equals(e)),"Bad distance calculation"),a};Jr.nonRobustComputeEdgeDistance=function(t,e,n){var r=t.x-e.x,i=t.y-e.y,a=Math.sqrt(r*r+i*i);return fn.isTrue(!(a===0&&!t.equals(e)),"Invalid distance calculation"),a};sg.DONT_INTERSECT.get=function(){return 0};sg.DO_INTERSECT.get=function(){return 1};sg.COLLINEAR.get=function(){return 2};sg.NO_INTERSECTION.get=function(){return 0};sg.POINT_INTERSECTION.get=function(){return 1};sg.COLLINEAR_INTERSECTION.get=function(){return 2};Object.defineProperties(Jr,sg);var ad=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.isInSegmentEnvelopes=function(n){var r=new Be(this._inputLines[0][0],this._inputLines[0][1]),i=new Be(this._inputLines[1][0],this._inputLines[1][1]);return r.contains(n)&&i.contains(n)},e.prototype.computeIntersection=function(){if(arguments.length===3){var n=arguments[0],r=arguments[1],i=arguments[2];if(this._isProper=!1,Be.intersects(r,i,n)&&Se.orientationIndex(r,i,n)===0&&Se.orientationIndex(i,r,n)===0)return this._isProper=!0,(n.equals(r)||n.equals(i))&&(this._isProper=!1),this._result=t.POINT_INTERSECTION,null;this._result=t.NO_INTERSECTION}else return t.prototype.computeIntersection.apply(this,arguments)},e.prototype.normalizeToMinimum=function(n,r,i,a,h){h.x=this.smallestInAbsValue(n.x,r.x,i.x,a.x),h.y=this.smallestInAbsValue(n.y,r.y,i.y,a.y),n.x-=h.x,n.y-=h.y,r.x-=h.x,r.y-=h.y,i.x-=h.x,i.y-=h.y,a.x-=h.x,a.y-=h.y},e.prototype.safeHCoordinateIntersection=function(n,r,i,a){var h=null;try{h=qu.intersection(n,r,i,a)}catch(u){if(u instanceof Dm)h=e.nearestEndpoint(n,r,i,a);else throw u}finally{}return h},e.prototype.intersection=function(n,r,i,a){var h=this.intersectionWithNormalization(n,r,i,a);return this.isInSegmentEnvelopes(h)||(h=new Tt(e.nearestEndpoint(n,r,i,a))),this._precisionModel!==null&&this._precisionModel.makePrecise(h),h},e.prototype.smallestInAbsValue=function(n,r,i,a){var h=n,u=Math.abs(h);return Math.abs(r)<u&&(h=r,u=Math.abs(r)),Math.abs(i)<u&&(h=i,u=Math.abs(i)),Math.abs(a)<u&&(h=a),h},e.prototype.checkDD=function(n,r,i,a,h){var u=Hs.intersection(n,r,i,a),_=this.isInSegmentEnvelopes(u);Fo.out.println("DD in env = "+_+"  --------------------- "+u),h.distance(u)>1e-4&&Fo.out.println("Distance = "+h.distance(u))},e.prototype.intersectionWithNormalization=function(n,r,i,a){var h=new Tt(n),u=new Tt(r),_=new Tt(i),w=new Tt(a),C=new Tt;this.normalizeToEnvCentre(h,u,_,w,C);var P=this.safeHCoordinateIntersection(h,u,_,w);return P.x+=C.x,P.y+=C.y,P},e.prototype.computeCollinearIntersection=function(n,r,i,a){var h=Be.intersects(n,r,i),u=Be.intersects(n,r,a),_=Be.intersects(i,a,n),w=Be.intersects(i,a,r);return h&&u?(this._intPt[0]=i,this._intPt[1]=a,t.COLLINEAR_INTERSECTION):_&&w?(this._intPt[0]=n,this._intPt[1]=r,t.COLLINEAR_INTERSECTION):h&&_?(this._intPt[0]=i,this._intPt[1]=n,i.equals(n)&&!u&&!w?t.POINT_INTERSECTION:t.COLLINEAR_INTERSECTION):h&&w?(this._intPt[0]=i,this._intPt[1]=r,i.equals(r)&&!u&&!_?t.POINT_INTERSECTION:t.COLLINEAR_INTERSECTION):u&&_?(this._intPt[0]=a,this._intPt[1]=n,a.equals(n)&&!h&&!w?t.POINT_INTERSECTION:t.COLLINEAR_INTERSECTION):u&&w?(this._intPt[0]=a,this._intPt[1]=r,a.equals(r)&&!h&&!_?t.POINT_INTERSECTION:t.COLLINEAR_INTERSECTION):t.NO_INTERSECTION},e.prototype.normalizeToEnvCentre=function(n,r,i,a,h){var u=n.x<r.x?n.x:r.x,_=n.y<r.y?n.y:r.y,w=n.x>r.x?n.x:r.x,C=n.y>r.y?n.y:r.y,P=i.x<a.x?i.x:a.x,D=i.y<a.y?i.y:a.y,B=i.x>a.x?i.x:a.x,$=i.y>a.y?i.y:a.y,Z=u>P?u:P,W=w<B?w:B,rt=_>D?_:D,ct=C<$?C:$,pt=(Z+W)/2,gt=(rt+ct)/2;h.x=pt,h.y=gt,n.x-=h.x,n.y-=h.y,r.x-=h.x,r.y-=h.y,i.x-=h.x,i.y-=h.y,a.x-=h.x,a.y-=h.y},e.prototype.computeIntersect=function(n,r,i,a){if(this._isProper=!1,!Be.intersects(n,r,i,a))return t.NO_INTERSECTION;var h=Se.orientationIndex(n,r,i),u=Se.orientationIndex(n,r,a);if(h>0&&u>0||h<0&&u<0)return t.NO_INTERSECTION;var _=Se.orientationIndex(i,a,n),w=Se.orientationIndex(i,a,r);if(_>0&&w>0||_<0&&w<0)return t.NO_INTERSECTION;var C=h===0&&u===0&&_===0&&w===0;return C?this.computeCollinearIntersection(n,r,i,a):(h===0||u===0||_===0||w===0?(this._isProper=!1,n.equals2D(i)||n.equals2D(a)?this._intPt[0]=n:r.equals2D(i)||r.equals2D(a)?this._intPt[0]=r:h===0?this._intPt[0]=new Tt(i):u===0?this._intPt[0]=new Tt(a):_===0?this._intPt[0]=new Tt(n):w===0&&(this._intPt[0]=new Tt(r))):(this._isProper=!0,this._intPt[0]=this.intersection(n,r,i,a)),t.POINT_INTERSECTION)},e.prototype.interfaces_=function(){return[]},e.prototype.getClass=function(){return e},e.nearestEndpoint=function(n,r,i,a){var h=n,u=Se.distancePointLine(n,i,a),_=Se.distancePointLine(r,i,a);return _<u&&(u=_,h=r),_=Se.distancePointLine(i,n,r),_<u&&(u=_,h=i),_=Se.distancePointLine(a,n,r),_<u&&(u=_,h=a),h},e}(Jr),Md=function(){};Md.prototype.interfaces_=function(){return[]};Md.prototype.getClass=function(){return Md};Md.orientationIndex=function(t,e,n){var r=e.x-t.x,i=e.y-t.y,a=n.x-e.x,h=n.y-e.y;return Md.signOfDet2x2(r,i,a,h)};Md.signOfDet2x2=function(t,e,n,r){var i=null,a=null,h=null;if(i=1,t===0||r===0)return e===0||n===0?0:e>0?n>0?-i:i:n>0?i:-i;if(e===0||n===0)return r>0?t>0?i:-i:t>0?-i:i;if(e>0?r>0?e<=r||(i=-i,a=t,t=n,n=a,a=e,e=r,r=a):e<=-r?(i=-i,n=-n,r=-r):(a=t,t=-n,n=a,a=e,e=-r,r=a):r>0?-e<=r?(i=-i,t=-t,e=-e):(a=-t,t=n,n=a,a=-e,e=r,r=a):e>=r?(t=-t,e=-e,n=-n,r=-r):(i=-i,a=-t,t=-n,n=a,a=-e,e=-r,r=a),t>0)if(n>0){if(!(t<=n))return i}else return i;else{if(n>0)return-i;if(t>=n)i=-i,t=-t,n=-n;else return-i}for(;;){if(h=Math.floor(n/t),n=n-h*t,r=r-h*e,r<0)return-i;if(r>e)return i;if(t>n+n){if(e<r+r)return i}else{if(e>r+r)return-i;n=t-n,r=e-r,i=-i}if(r===0)return n===0?0:-i;if(n===0||(h=Math.floor(t/n),t=t-h*n,e=e-h*r,e<0))return i;if(e>r)return-i;if(n>t+t){if(r<e+e)return-i}else{if(r>e+e)return i;t=n-t,e=r-e,i=-i}if(e===0)return t===0?0:i;if(t===0)return-i}};var Ul=function(){this._p=null,this._crossingCount=0,this._isPointOnSegment=!1;var t=arguments[0];this._p=t};Ul.prototype.countSegment=function(t,e){if(t.x<this._p.x&&e.x<this._p.x)return null;if(this._p.x===e.x&&this._p.y===e.y)return this._isPointOnSegment=!0,null;if(t.y===this._p.y&&e.y===this._p.y){var n=t.x,r=e.x;return n>r&&(n=e.x,r=t.x),this._p.x>=n&&this._p.x<=r&&(this._isPointOnSegment=!0),null}if(t.y>this._p.y&&e.y<=this._p.y||e.y>this._p.y&&t.y<=this._p.y){var i=t.x-this._p.x,a=t.y-this._p.y,h=e.x-this._p.x,u=e.y-this._p.y,_=Md.signOfDet2x2(i,a,h,u);if(_===0)return this._isPointOnSegment=!0,null;u<a&&(_=-_),_>0&&this._crossingCount++}};Ul.prototype.isPointInPolygon=function(){return this.getLocation()!==Pt.EXTERIOR};Ul.prototype.getLocation=function(){return this._isPointOnSegment?Pt.BOUNDARY:this._crossingCount%2===1?Pt.INTERIOR:Pt.EXTERIOR};Ul.prototype.isOnSegment=function(){return this._isPointOnSegment};Ul.prototype.interfaces_=function(){return[]};Ul.prototype.getClass=function(){return Ul};Ul.locatePointInRing=function(){if(arguments[0]instanceof Tt&&tn(arguments[1],zn)){for(var t=arguments[0],e=arguments[1],n=new Ul(t),r=new Tt,i=new Tt,a=1;a<e.size();a++)if(e.getCoordinate(a,r),e.getCoordinate(a-1,i),n.countSegment(r,i),n.isOnSegment())return n.getLocation();return n.getLocation()}else if(arguments[0]instanceof Tt&&arguments[1]instanceof Array){for(var h=arguments[0],u=arguments[1],_=new Ul(h),w=1;w<u.length;w++){var C=u[w],P=u[w-1];if(_.countSegment(C,P),_.isOnSegment())return _.getLocation()}return _.getLocation()}};var Se=function(){},ag={CLOCKWISE:{configurable:!0},RIGHT:{configurable:!0},COUNTERCLOCKWISE:{configurable:!0},LEFT:{configurable:!0},COLLINEAR:{configurable:!0},STRAIGHT:{configurable:!0}};Se.prototype.interfaces_=function(){return[]};Se.prototype.getClass=function(){return Se};Se.orientationIndex=function(t,e,n){return Hs.orientationIndex(t,e,n)};Se.signedArea=function(){if(arguments[0]instanceof Array){var t=arguments[0];if(t.length<3)return 0;for(var e=0,n=t[0].x,r=1;r<t.length-1;r++){var i=t[r].x-n,a=t[r+1].y,h=t[r-1].y;e+=i*(h-a)}return e/2}else if(tn(arguments[0],zn)){var u=arguments[0],_=u.size();if(_<3)return 0;var w=new Tt,C=new Tt,P=new Tt;u.getCoordinate(0,C),u.getCoordinate(1,P);var D=C.x;P.x-=D;for(var B=0,$=1;$<_-1;$++)w.y=C.y,C.x=P.x,C.y=P.y,u.getCoordinate($+1,P),P.x-=D,B+=C.x*(w.y-P.y);return B/2}};Se.distanceLineLine=function(t,e,n,r){if(t.equals(e))return Se.distancePointLine(t,n,r);if(n.equals(r))return Se.distancePointLine(r,t,e);var i=!1;if(!Be.intersects(t,e,n,r))i=!0;else{var a=(e.x-t.x)*(r.y-n.y)-(e.y-t.y)*(r.x-n.x);if(a===0)i=!0;else{var h=(t.y-n.y)*(r.x-n.x)-(t.x-n.x)*(r.y-n.y),u=(t.y-n.y)*(e.x-t.x)-(t.x-n.x)*(e.y-t.y),_=u/a,w=h/a;(w<0||w>1||_<0||_>1)&&(i=!0)}}return i?Ya.min(Se.distancePointLine(t,n,r),Se.distancePointLine(e,n,r),Se.distancePointLine(n,t,e),Se.distancePointLine(r,t,e)):0};Se.isPointInRing=function(t,e){return Se.locatePointInRing(t,e)!==Pt.EXTERIOR};Se.computeLength=function(t){var e=t.size();if(e<=1)return 0;var n=0,r=new Tt;t.getCoordinate(0,r);for(var i=r.x,a=r.y,h=1;h<e;h++){t.getCoordinate(h,r);var u=r.x,_=r.y,w=u-i,C=_-a;n+=Math.sqrt(w*w+C*C),i=u,a=_}return n};Se.isCCW=function(t){var e=t.length-1;if(e<3)throw new Xr("Ring has fewer than 4 points, so orientation cannot be determined");for(var n=t[0],r=0,i=1;i<=e;i++){var a=t[i];a.y>n.y&&(n=a,r=i)}var h=r;do h=h-1,h<0&&(h=e);while(t[h].equals2D(n)&&h!==r);var u=r;do u=(u+1)%e;while(t[u].equals2D(n)&&u!==r);var _=t[h],w=t[u];if(_.equals2D(n)||w.equals2D(n)||_.equals2D(w))return!1;var C=Se.computeOrientation(_,n,w),P=!1;return C===0?P=_.x>w.x:P=C>0,P};Se.locatePointInRing=function(t,e){return Ul.locatePointInRing(t,e)};Se.distancePointLinePerpendicular=function(t,e,n){var r=(n.x-e.x)*(n.x-e.x)+(n.y-e.y)*(n.y-e.y),i=((e.y-t.y)*(n.x-e.x)-(e.x-t.x)*(n.y-e.y))/r;return Math.abs(i)*Math.sqrt(r)};Se.computeOrientation=function(t,e,n){return Se.orientationIndex(t,e,n)};Se.distancePointLine=function(){if(arguments.length===2){var t=arguments[0],e=arguments[1];if(e.length===0)throw new Xr("Line array must contain at least one vertex");for(var n=t.distance(e[0]),r=0;r<e.length-1;r++){var i=Se.distancePointLine(t,e[r],e[r+1]);i<n&&(n=i)}return n}else if(arguments.length===3){var a=arguments[0],h=arguments[1],u=arguments[2];if(h.x===u.x&&h.y===u.y)return a.distance(h);var _=(u.x-h.x)*(u.x-h.x)+(u.y-h.y)*(u.y-h.y),w=((a.x-h.x)*(u.x-h.x)+(a.y-h.y)*(u.y-h.y))/_;if(w<=0)return a.distance(h);if(w>=1)return a.distance(u);var C=((h.y-a.y)*(u.x-h.x)-(h.x-a.x)*(u.y-h.y))/_;return Math.abs(C)*Math.sqrt(_)}};Se.isOnLine=function(t,e){for(var n=new ad,r=1;r<e.length;r++){var i=e[r-1],a=e[r];if(n.computeIntersection(t,i,a),n.hasIntersection())return!0}return!1};ag.CLOCKWISE.get=function(){return-1};ag.RIGHT.get=function(){return Se.CLOCKWISE};ag.COUNTERCLOCKWISE.get=function(){return 1};ag.LEFT.get=function(){return Se.COUNTERCLOCKWISE};ag.COLLINEAR.get=function(){return 0};ag.STRAIGHT.get=function(){return Se.COLLINEAR};Object.defineProperties(Se,ag);var Mh=function(){};Mh.prototype.filter=function(t){};Mh.prototype.interfaces_=function(){return[]};Mh.prototype.getClass=function(){return Mh};var We=function(){var t=arguments[0];this._envelope=null,this._factory=null,this._SRID=null,this._userData=null,this._factory=t,this._SRID=t.getSRID()},eh={serialVersionUID:{configurable:!0},SORTINDEX_POINT:{configurable:!0},SORTINDEX_MULTIPOINT:{configurable:!0},SORTINDEX_LINESTRING:{configurable:!0},SORTINDEX_LINEARRING:{configurable:!0},SORTINDEX_MULTILINESTRING:{configurable:!0},SORTINDEX_POLYGON:{configurable:!0},SORTINDEX_MULTIPOLYGON:{configurable:!0},SORTINDEX_GEOMETRYCOLLECTION:{configurable:!0},geometryChangedFilter:{configurable:!0}};We.prototype.isGeometryCollection=function(){return this.getSortIndex()===We.SORTINDEX_GEOMETRYCOLLECTION};We.prototype.getFactory=function(){return this._factory};We.prototype.getGeometryN=function(t){return this};We.prototype.getArea=function(){return 0};We.prototype.isRectangle=function(){return!1};We.prototype.equals=function(){if(arguments[0]instanceof We){var t=arguments[0];return t===null?!1:this.equalsTopo(t)}else if(arguments[0]instanceof Object){var e=arguments[0];if(!(e instanceof We))return!1;var n=e;return this.equalsExact(n)}};We.prototype.equalsExact=function(t){return this===t||this.equalsExact(t,0)};We.prototype.geometryChanged=function(){this.apply(We.geometryChangedFilter)};We.prototype.geometryChangedAction=function(){this._envelope=null};We.prototype.equalsNorm=function(t){return t===null?!1:this.norm().equalsExact(t.norm())};We.prototype.getLength=function(){return 0};We.prototype.getNumGeometries=function(){return 1};We.prototype.compareTo=function(){if(arguments.length===1){var t=arguments[0],e=t;return this.getSortIndex()!==e.getSortIndex()?this.getSortIndex()-e.getSortIndex():this.isEmpty()&&e.isEmpty()?0:this.isEmpty()?-1:e.isEmpty()?1:this.compareToSameClass(t)}else if(arguments.length===2){var n=arguments[0],r=arguments[1];return this.getSortIndex()!==n.getSortIndex()?this.getSortIndex()-n.getSortIndex():this.isEmpty()&&n.isEmpty()?0:this.isEmpty()?-1:n.isEmpty()?1:this.compareToSameClass(n,r)}};We.prototype.getUserData=function(){return this._userData};We.prototype.getSRID=function(){return this._SRID};We.prototype.getEnvelope=function(){return this.getFactory().toGeometry(this.getEnvelopeInternal())};We.prototype.checkNotGeometryCollection=function(t){if(t.getSortIndex()===We.SORTINDEX_GEOMETRYCOLLECTION)throw new Xr("This method does not support GeometryCollection arguments")};We.prototype.equal=function(t,e,n){return n===0?t.equals(e):t.distance(e)<=n};We.prototype.norm=function(){var t=this.copy();return t.normalize(),t};We.prototype.getPrecisionModel=function(){return this._factory.getPrecisionModel()};We.prototype.getEnvelopeInternal=function(){return this._envelope===null&&(this._envelope=this.computeEnvelopeInternal()),new Be(this._envelope)};We.prototype.setSRID=function(t){this._SRID=t};We.prototype.setUserData=function(t){this._userData=t};We.prototype.compare=function(t,e){for(var n=t.iterator(),r=e.iterator();n.hasNext()&&r.hasNext();){var i=n.next(),a=r.next(),h=i.compareTo(a);if(h!==0)return h}return n.hasNext()?1:r.hasNext()?-1:0};We.prototype.hashCode=function(){return this.getEnvelopeInternal().hashCode()};We.prototype.isGeometryCollectionOrDerived=function(){return this.getSortIndex()===We.SORTINDEX_GEOMETRYCOLLECTION||this.getSortIndex()===We.SORTINDEX_MULTIPOINT||this.getSortIndex()===We.SORTINDEX_MULTILINESTRING||this.getSortIndex()===We.SORTINDEX_MULTIPOLYGON};We.prototype.interfaces_=function(){return[u0,Tu,Lu]};We.prototype.getClass=function(){return We};We.hasNonEmptyElements=function(t){for(var e=0;e<t.length;e++)if(!t[e].isEmpty())return!0;return!1};We.hasNullElements=function(t){for(var e=0;e<t.length;e++)if(t[e]===null)return!0;return!1};eh.serialVersionUID.get=function(){return 8763622679187377e3};eh.SORTINDEX_POINT.get=function(){return 0};eh.SORTINDEX_MULTIPOINT.get=function(){return 1};eh.SORTINDEX_LINESTRING.get=function(){return 2};eh.SORTINDEX_LINEARRING.get=function(){return 3};eh.SORTINDEX_MULTILINESTRING.get=function(){return 4};eh.SORTINDEX_POLYGON.get=function(){return 5};eh.SORTINDEX_MULTIPOLYGON.get=function(){return 6};eh.SORTINDEX_GEOMETRYCOLLECTION.get=function(){return 7};eh.geometryChangedFilter.get=function(){return bb};Object.defineProperties(We,eh);var bb=function(){};bb.interfaces_=function(){return[Mh]};bb.filter=function(t){t.geometryChangedAction()};var kc=function(){};kc.prototype.filter=function(t){};kc.prototype.interfaces_=function(){return[]};kc.prototype.getClass=function(){return kc};var vu=function(){},Uh={Mod2BoundaryNodeRule:{configurable:!0},EndPointBoundaryNodeRule:{configurable:!0},MultiValentEndPointBoundaryNodeRule:{configurable:!0},MonoValentEndPointBoundaryNodeRule:{configurable:!0},MOD2_BOUNDARY_RULE:{configurable:!0},ENDPOINT_BOUNDARY_RULE:{configurable:!0},MULTIVALENT_ENDPOINT_BOUNDARY_RULE:{configurable:!0},MONOVALENT_ENDPOINT_BOUNDARY_RULE:{configurable:!0},OGC_SFS_BOUNDARY_RULE:{configurable:!0}};vu.prototype.isInBoundary=function(t){};vu.prototype.interfaces_=function(){return[]};vu.prototype.getClass=function(){return vu};Uh.Mod2BoundaryNodeRule.get=function(){return Xg};Uh.EndPointBoundaryNodeRule.get=function(){return Yg};Uh.MultiValentEndPointBoundaryNodeRule.get=function(){return Zg};Uh.MonoValentEndPointBoundaryNodeRule.get=function(){return Hg};Uh.MOD2_BOUNDARY_RULE.get=function(){return new Xg};Uh.ENDPOINT_BOUNDARY_RULE.get=function(){return new Yg};Uh.MULTIVALENT_ENDPOINT_BOUNDARY_RULE.get=function(){return new Zg};Uh.MONOVALENT_ENDPOINT_BOUNDARY_RULE.get=function(){return new Hg};Uh.OGC_SFS_BOUNDARY_RULE.get=function(){return vu.MOD2_BOUNDARY_RULE};Object.defineProperties(vu,Uh);var Xg=function(){};Xg.prototype.isInBoundary=function(t){return t%2===1};Xg.prototype.interfaces_=function(){return[vu]};Xg.prototype.getClass=function(){return Xg};var Yg=function(){};Yg.prototype.isInBoundary=function(t){return t>0};Yg.prototype.interfaces_=function(){return[vu]};Yg.prototype.getClass=function(){return Yg};var Zg=function(){};Zg.prototype.isInBoundary=function(t){return t>1};Zg.prototype.interfaces_=function(){return[vu]};Zg.prototype.getClass=function(){return Zg};var Hg=function(){};Hg.prototype.isInBoundary=function(t){return t===1};Hg.prototype.interfaces_=function(){return[vu]};Hg.prototype.getClass=function(){return Hg};var Xi=function(){};Xi.prototype.add=function(){};Xi.prototype.addAll=function(){};Xi.prototype.isEmpty=function(){};Xi.prototype.iterator=function(){};Xi.prototype.size=function(){};Xi.prototype.toArray=function(){};Xi.prototype.remove=function(){};function wb(t){this.message=t||""}wb.prototype=new Error;wb.prototype.name="IndexOutOfBoundsException";var Om=function(){};Om.prototype.hasNext=function(){};Om.prototype.next=function(){};Om.prototype.remove=function(){};var ju=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.get=function(){},e.prototype.set=function(){},e.prototype.isEmpty=function(){},e}(Xi);function Rm(t){this.message=t||""}Rm.prototype=new Error;Rm.prototype.name="NoSuchElementException";var fe=function(t){function e(){t.call(this),this.array_=[],arguments[0]instanceof Xi&&this.addAll(arguments[0])}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.ensureCapacity=function(){},e.prototype.interfaces_=function(){return[t,Xi]},e.prototype.add=function(n){return arguments.length===1?this.array_.push(n):this.array_.splice(arguments[0],arguments[1]),!0},e.prototype.clear=function(){this.array_=[]},e.prototype.addAll=function(n){for(var r=this,i=n.iterator();i.hasNext();)r.add(i.next());return!0},e.prototype.set=function(n,r){var i=this.array_[n];return this.array_[n]=r,i},e.prototype.iterator=function(){return new JM(this)},e.prototype.get=function(n){if(n<0||n>=this.size())throw new wb;return this.array_[n]},e.prototype.isEmpty=function(){return this.array_.length===0},e.prototype.size=function(){return this.array_.length},e.prototype.toArray=function(){for(var n=this,r=[],i=0,a=this.array_.length;i<a;i++)r.push(n.array_[i]);return r},e.prototype.remove=function(n){for(var r=this,i=!1,a=0,h=this.array_.length;a<h;a++)if(r.array_[a]===n){r.array_.splice(a,1),i=!0;break}return i},e}(ju),JM=function(t){function e(n){t.call(this),this.arrayList_=n,this.position_=0}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.next=function(){if(this.position_===this.arrayList_.size())throw new Rm;return this.arrayList_.get(this.position_++)},e.prototype.hasNext=function(){return this.position_<this.arrayList_.size()},e.prototype.set=function(n){return this.arrayList_.set(this.position_-1,n)},e.prototype.remove=function(){this.arrayList_.remove(this.arrayList_.get(this.position_))},e}(Om),b_=function(t){function e(){if(t.call(this),arguments.length!==0){if(arguments.length===1){var r=arguments[0];this.ensureCapacity(r.length),this.add(r,!0)}else if(arguments.length===2){var i=arguments[0],a=arguments[1];this.ensureCapacity(i.length),this.add(i,a)}}}t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e;var n={coordArrayType:{configurable:!0}};return n.coordArrayType.get=function(){return new Array(0).fill(null)},e.prototype.getCoordinate=function(r){return this.get(r)},e.prototype.addAll=function(){var r=this;if(arguments.length===2){for(var i=arguments[0],a=arguments[1],h=!1,u=i.iterator();u.hasNext();)r.add(u.next(),a),h=!0;return h}else return t.prototype.addAll.apply(this,arguments)},e.prototype.clone=function(){for(var r=this,i=t.prototype.clone.call(this),a=0;a<this.size();a++)i.add(a,r.get(a).copy());return i},e.prototype.toCoordinateArray=function(){return this.toArray(e.coordArrayType)},e.prototype.add=function(){var r=this;if(arguments.length===1){var i=arguments[0];t.prototype.add.call(this,i)}else if(arguments.length===2){if(arguments[0]instanceof Array&&typeof arguments[1]=="boolean"){var a=arguments[0],h=arguments[1];return this.add(a,h,!0),!0}else if(arguments[0]instanceof Tt&&typeof arguments[1]=="boolean"){var u=arguments[0],_=arguments[1];if(!_&&this.size()>=1){var w=this.get(this.size()-1);if(w.equals2D(u))return null}t.prototype.add.call(this,u)}else if(arguments[0]instanceof Object&&typeof arguments[1]=="boolean"){var C=arguments[0],P=arguments[1];return this.add(C,P),!0}}else if(arguments.length===3){if(typeof arguments[2]=="boolean"&&arguments[0]instanceof Array&&typeof arguments[1]=="boolean"){var D=arguments[0],B=arguments[1],$=arguments[2];if($)for(var Z=0;Z<D.length;Z++)r.add(D[Z],B);else for(var W=D.length-1;W>=0;W--)r.add(D[W],B);return!0}else if(typeof arguments[2]=="boolean"&&Number.isInteger(arguments[0])&&arguments[1]instanceof Tt){var rt=arguments[0],ct=arguments[1],pt=arguments[2];if(!pt){var gt=this.size();if(gt>0){if(rt>0){var Ut=this.get(rt-1);if(Ut.equals2D(ct))return null}if(rt<gt){var zt=this.get(rt);if(zt.equals2D(ct))return null}}}t.prototype.add.call(this,rt,ct)}}else if(arguments.length===4){var Ot=arguments[0],At=arguments[1],Rt=arguments[2],Yt=arguments[3],be=1;Rt>Yt&&(be=-1);for(var Kt=Rt;Kt!==Yt;Kt+=be)r.add(Ot[Kt],At);return!0}},e.prototype.closeRing=function(){this.size()>0&&this.add(new Tt(this.get(0)),!1)},e.prototype.interfaces_=function(){return[]},e.prototype.getClass=function(){return e},Object.defineProperties(e,n),e}(fe),In=function(){},c0={ForwardComparator:{configurable:!0},BidirectionalComparator:{configurable:!0},coordArrayType:{configurable:!0}};c0.ForwardComparator.get=function(){return Vy};c0.BidirectionalComparator.get=function(){return Wg};c0.coordArrayType.get=function(){return new Array(0).fill(null)};In.prototype.interfaces_=function(){return[]};In.prototype.getClass=function(){return In};In.isRing=function(t){return!(t.length<4||!t[0].equals2D(t[t.length-1]))};In.ptNotInList=function(t,e){for(var n=0;n<t.length;n++){var r=t[n];if(In.indexOf(r,e)<0)return r}return null};In.scroll=function(t,e){var n=In.indexOf(e,t);if(n<0)return null;var r=new Array(t.length).fill(null);Fo.arraycopy(t,n,r,0,t.length-n),Fo.arraycopy(t,0,r,t.length-n,n),Fo.arraycopy(r,0,t,0,t.length)};In.equals=function(){if(arguments.length===2){var t=arguments[0],e=arguments[1];if(t===e)return!0;if(t===null||e===null||t.length!==e.length)return!1;for(var n=0;n<t.length;n++)if(!t[n].equals(e[n]))return!1;return!0}else if(arguments.length===3){var r=arguments[0],i=arguments[1],a=arguments[2];if(r===i)return!0;if(r===null||i===null||r.length!==i.length)return!1;for(var h=0;h<r.length;h++)if(a.compare(r[h],i[h])!==0)return!1;return!0}};In.intersection=function(t,e){for(var n=new b_,r=0;r<t.length;r++)e.intersects(t[r])&&n.add(t[r],!0);return n.toCoordinateArray()};In.hasRepeatedPoints=function(t){for(var e=1;e<t.length;e++)if(t[e-1].equals(t[e]))return!0;return!1};In.removeRepeatedPoints=function(t){if(!In.hasRepeatedPoints(t))return t;var e=new b_(t,!1);return e.toCoordinateArray()};In.reverse=function(t){for(var e=t.length-1,n=Math.trunc(e/2),r=0;r<=n;r++){var i=t[r];t[r]=t[e-r],t[e-r]=i}};In.removeNull=function(t){for(var e=0,n=0;n<t.length;n++)t[n]!==null&&e++;var r=new Array(e).fill(null);if(e===0)return r;for(var i=0,a=0;a<t.length;a++)t[a]!==null&&(r[i++]=t[a]);return r};In.copyDeep=function(){if(arguments.length===1){for(var t=arguments[0],e=new Array(t.length).fill(null),n=0;n<t.length;n++)e[n]=new Tt(t[n]);return e}else if(arguments.length===5)for(var r=arguments[0],i=arguments[1],a=arguments[2],h=arguments[3],u=arguments[4],_=0;_<u;_++)a[h+_]=new Tt(r[i+_])};In.isEqualReversed=function(t,e){for(var n=0;n<t.length;n++){var r=t[n],i=e[t.length-n-1];if(r.compareTo(i)!==0)return!1}return!0};In.envelope=function(t){for(var e=new Be,n=0;n<t.length;n++)e.expandToInclude(t[n]);return e};In.toCoordinateArray=function(t){return t.toArray(In.coordArrayType)};In.atLeastNCoordinatesOrNothing=function(t,e){return e.length>=t?e:[]};In.indexOf=function(t,e){for(var n=0;n<e.length;n++)if(t.equals(e[n]))return n;return-1};In.increasingDirection=function(t){for(var e=0;e<Math.trunc(t.length/2);e++){var n=t.length-1-e,r=t[e].compareTo(t[n]);if(r!==0)return r}return 1};In.compare=function(t,e){for(var n=0;n<t.length&&n<e.length;){var r=t[n].compareTo(e[n]);if(r!==0)return r;n++}return n<e.length?-1:n<t.length?1:0};In.minCoordinate=function(t){for(var e=null,n=0;n<t.length;n++)(e===null||e.compareTo(t[n])>0)&&(e=t[n]);return e};In.extract=function(t,e,n){e=Ya.clamp(e,0,t.length),n=Ya.clamp(n,-1,t.length);var r=n-e+1;n<0&&(r=0),e>=t.length&&(r=0),n<e&&(r=0);var i=new Array(r).fill(null);if(r===0)return i;for(var a=0,h=e;h<=n;h++)i[a++]=t[h];return i};Object.defineProperties(In,c0);var Vy=function(){};Vy.prototype.compare=function(t,e){var n=t,r=e;return In.compare(n,r)};Vy.prototype.interfaces_=function(){return[qg]};Vy.prototype.getClass=function(){return Vy};var Wg=function(){};Wg.prototype.compare=function(t,e){var n=t,r=e;if(n.length<r.length)return-1;if(n.length>r.length)return 1;if(n.length===0)return 0;var i=In.compare(n,r),a=In.isEqualReversed(n,r);return a?0:i};Wg.prototype.OLDcompare=function(t,e){var n=t,r=e;if(n.length<r.length)return-1;if(n.length>r.length)return 1;if(n.length===0)return 0;for(var i=In.increasingDirection(n),a=In.increasingDirection(r),h=i>0?0:n.length-1,u=a>0?0:n.length-1,_=0;_<n.length;_++){var w=n[h].compareTo(r[u]);if(w!==0)return w;h+=i,u+=a}return 0};Wg.prototype.interfaces_=function(){return[qg]};Wg.prototype.getClass=function(){return Wg};var ug=function(){};ug.prototype.get=function(){};ug.prototype.put=function(){};ug.prototype.size=function(){};ug.prototype.values=function(){};ug.prototype.entrySet=function(){};var KM=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e}(ug);function w_(t){this.message=t||""}w_.prototype=new Error;w_.prototype.name="OperationNotSupported";function h0(){}h0.prototype=new Xi;h0.prototype.contains=function(){};var Eb=function(t){function e(){t.call(this),this.array_=[],arguments[0]instanceof Xi&&this.addAll(arguments[0])}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.contains=function(n){for(var r=this,i=0,a=this.array_.length;i<a;i++){var h=r.array_[i];if(h===n)return!0}return!1},e.prototype.add=function(n){return this.contains(n)?!1:(this.array_.push(n),!0)},e.prototype.addAll=function(n){for(var r=this,i=n.iterator();i.hasNext();)r.add(i.next());return!0},e.prototype.remove=function(n){throw new Error},e.prototype.size=function(){return this.array_.length},e.prototype.isEmpty=function(){return this.array_.length===0},e.prototype.toArray=function(){for(var n=this,r=[],i=0,a=this.array_.length;i<a;i++)r.push(n.array_[i]);return r},e.prototype.iterator=function(){return new QM(this)},e}(h0),QM=function(t){function e(n){t.call(this),this.hashSet_=n,this.position_=0}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.next=function(){if(this.position_===this.hashSet_.size())throw new Rm;return this.hashSet_.array_[this.position_++]},e.prototype.hasNext=function(){return this.position_<this.hashSet_.size()},e.prototype.remove=function(){throw new w_},e}(Om),Ih=0,Tf=1;function zE(t){return t===null?Ih:t.color}function Sr(t){return t===null?null:t.parent}function yh(t,e){t!==null&&(t.color=e)}function Px(t){return t===null?null:t.left}function BE(t){return t===null?null:t.right}function Qo(){this.root_=null,this.size_=0}Qo.prototype=new KM;Qo.prototype.get=function(t){for(var e=this.root_;e!==null;){var n=t.compareTo(e.key);if(n<0)e=e.left;else if(n>0)e=e.right;else return e.value}return null};Qo.prototype.put=function(t,e){if(this.root_===null)return this.root_={key:t,value:e,left:null,right:null,parent:null,color:Ih,getValue:function(){return this.value},getKey:function(){return this.key}},this.size_=1,null;var n=this.root_,r,i;do if(r=n,i=t.compareTo(n.key),i<0)n=n.left;else if(i>0)n=n.right;else{var a=n.value;return n.value=e,a}while(n!==null);var h={key:t,left:null,right:null,value:e,parent:r,color:Ih,getValue:function(){return this.value},getKey:function(){return this.key}};return i<0?r.left=h:r.right=h,this.fixAfterInsertion(h),this.size_++,null};Qo.prototype.fixAfterInsertion=function(t){var e=this;for(t.color=Tf;t!=null&&t!==this.root_&&t.parent.color===Tf;)if(Sr(t)===Px(Sr(Sr(t)))){var n=BE(Sr(Sr(t)));zE(n)===Tf?(yh(Sr(t),Ih),yh(n,Ih),yh(Sr(Sr(t)),Tf),t=Sr(Sr(t))):(t===BE(Sr(t))&&(t=Sr(t),e.rotateLeft(t)),yh(Sr(t),Ih),yh(Sr(Sr(t)),Tf),e.rotateRight(Sr(Sr(t))))}else{var r=Px(Sr(Sr(t)));zE(r)===Tf?(yh(Sr(t),Ih),yh(r,Ih),yh(Sr(Sr(t)),Tf),t=Sr(Sr(t))):(t===Px(Sr(t))&&(t=Sr(t),e.rotateRight(t)),yh(Sr(t),Ih),yh(Sr(Sr(t)),Tf),e.rotateLeft(Sr(Sr(t))))}this.root_.color=Ih};Qo.prototype.values=function(){var t=new fe,e=this.getFirstEntry();if(e!==null)for(t.add(e.value);(e=Qo.successor(e))!==null;)t.add(e.value);return t};Qo.prototype.entrySet=function(){var t=new Eb,e=this.getFirstEntry();if(e!==null)for(t.add(e);(e=Qo.successor(e))!==null;)t.add(e);return t};Qo.prototype.rotateLeft=function(t){if(t!=null){var e=t.right;t.right=e.left,e.left!=null&&(e.left.parent=t),e.parent=t.parent,t.parent===null?this.root_=e:t.parent.left===t?t.parent.left=e:t.parent.right=e,e.left=t,t.parent=e}};Qo.prototype.rotateRight=function(t){if(t!=null){var e=t.left;t.left=e.right,e.right!=null&&(e.right.parent=t),e.parent=t.parent,t.parent===null?this.root_=e:t.parent.right===t?t.parent.right=e:t.parent.left=e,e.right=t,t.parent=e}};Qo.prototype.getFirstEntry=function(){var t=this.root_;if(t!=null)for(;t.left!=null;)t=t.left;return t};Qo.successor=function(t){if(t===null)return null;if(t.right!==null){for(var e=t.right;e.left!==null;)e=e.left;return e}else{for(var n=t.parent,r=t;n!==null&&r===n.right;)r=n,n=n.parent;return n}};Qo.prototype.size=function(){return this.size_};var Uy=function(){};Uy.prototype.interfaces_=function(){return[]};Uy.prototype.getClass=function(){return Uy};function dS(){}dS.prototype=new h0;function Yl(){this.array_=[],arguments[0]instanceof Xi&&this.addAll(arguments[0])}Yl.prototype=new dS;Yl.prototype.contains=function(t){for(var e=this,n=0,r=this.array_.length;n<r;n++){var i=e.array_[n];if(i.compareTo(t)===0)return!0}return!1};Yl.prototype.add=function(t){var e=this;if(this.contains(t))return!1;for(var n=0,r=this.array_.length;n<r;n++){var i=e.array_[n];if(i.compareTo(t)===1)return e.array_.splice(n,0,t),!0}return this.array_.push(t),!0};Yl.prototype.addAll=function(t){for(var e=this,n=t.iterator();n.hasNext();)e.add(n.next());return!0};Yl.prototype.remove=function(t){throw new w_};Yl.prototype.size=function(){return this.array_.length};Yl.prototype.isEmpty=function(){return this.array_.length===0};Yl.prototype.toArray=function(){for(var t=this,e=[],n=0,r=this.array_.length;n<r;n++)e.push(t.array_[n]);return e};Yl.prototype.iterator=function(){return new p0(this)};var p0=function(t){this.treeSet_=t,this.position_=0};p0.prototype.next=function(){if(this.position_===this.treeSet_.size())throw new Rm;return this.treeSet_.array_[this.position_++]};p0.prototype.hasNext=function(){return this.position_<this.treeSet_.size()};p0.prototype.remove=function(){throw new w_};var Df=function(){};Df.sort=function(){var t=arguments[0],e,n,r,i;if(arguments.length===1)i=function(h,u){return h.compareTo(u)},t.sort(i);else if(arguments.length===2)r=arguments[1],i=function(h,u){return r.compare(h,u)},t.sort(i);else if(arguments.length===3){n=t.slice(arguments[1],arguments[2]),n.sort();var a=t.slice(0,arguments[1]).concat(n,t.slice(arguments[2],t.length));for(t.splice(0,t.length),e=0;e<a.length;e++)t.push(a[e])}else if(arguments.length===4)for(n=t.slice(arguments[1],arguments[2]),r=arguments[3],i=function(h,u){return r.compare(h,u)},n.sort(i),a=t.slice(0,arguments[1]).concat(n,t.slice(arguments[2],t.length)),t.splice(0,t.length),e=0;e<a.length;e++)t.push(a[e])};Df.asList=function(t){for(var e=new fe,n=0,r=t.length;n<r;n++)e.add(t[n]);return e};var Hn=function(){},ll={P:{configurable:!0},L:{configurable:!0},A:{configurable:!0},FALSE:{configurable:!0},TRUE:{configurable:!0},DONTCARE:{configurable:!0},SYM_FALSE:{configurable:!0},SYM_TRUE:{configurable:!0},SYM_DONTCARE:{configurable:!0},SYM_P:{configurable:!0},SYM_L:{configurable:!0},SYM_A:{configurable:!0}};ll.P.get=function(){return 0};ll.L.get=function(){return 1};ll.A.get=function(){return 2};ll.FALSE.get=function(){return-1};ll.TRUE.get=function(){return-2};ll.DONTCARE.get=function(){return-3};ll.SYM_FALSE.get=function(){return"F"};ll.SYM_TRUE.get=function(){return"T"};ll.SYM_DONTCARE.get=function(){return"*"};ll.SYM_P.get=function(){return"0"};ll.SYM_L.get=function(){return"1"};ll.SYM_A.get=function(){return"2"};Hn.prototype.interfaces_=function(){return[]};Hn.prototype.getClass=function(){return Hn};Hn.toDimensionSymbol=function(t){switch(t){case Hn.FALSE:return Hn.SYM_FALSE;case Hn.TRUE:return Hn.SYM_TRUE;case Hn.DONTCARE:return Hn.SYM_DONTCARE;case Hn.P:return Hn.SYM_P;case Hn.L:return Hn.SYM_L;case Hn.A:return Hn.SYM_A}throw new Xr("Unknown dimension value: "+t)};Hn.toDimensionValue=function(t){switch($y.toUpperCase(t)){case Hn.SYM_FALSE:return Hn.FALSE;case Hn.SYM_TRUE:return Hn.TRUE;case Hn.SYM_DONTCARE:return Hn.DONTCARE;case Hn.SYM_P:return Hn.P;case Hn.SYM_L:return Hn.L;case Hn.SYM_A:return Hn.A}throw new Xr("Unknown dimension symbol: "+t)};Object.defineProperties(Hn,ll);var Zl=function(){};Zl.prototype.filter=function(t){};Zl.prototype.interfaces_=function(){return[]};Zl.prototype.getClass=function(){return Zl};var Hu=function(){};Hu.prototype.filter=function(t,e){};Hu.prototype.isDone=function(){};Hu.prototype.isGeometryChanged=function(){};Hu.prototype.interfaces_=function(){return[]};Hu.prototype.getClass=function(){return Hu};var Ls=function(t){function e(r,i){if(t.call(this,i),this._geometries=r||[],t.hasNullElements(this._geometries))throw new Xr("geometries must not contain null elements")}t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e;var n={serialVersionUID:{configurable:!0}};return e.prototype.computeEnvelopeInternal=function(){for(var r=this,i=new Be,a=0;a<this._geometries.length;a++)i.expandToInclude(r._geometries[a].getEnvelopeInternal());return i},e.prototype.getGeometryN=function(r){return this._geometries[r]},e.prototype.getSortIndex=function(){return t.SORTINDEX_GEOMETRYCOLLECTION},e.prototype.getCoordinates=function(){for(var r=this,i=new Array(this.getNumPoints()).fill(null),a=-1,h=0;h<this._geometries.length;h++)for(var u=r._geometries[h].getCoordinates(),_=0;_<u.length;_++)a++,i[a]=u[_];return i},e.prototype.getArea=function(){for(var r=this,i=0,a=0;a<this._geometries.length;a++)i+=r._geometries[a].getArea();return i},e.prototype.equalsExact=function(){var r=this;if(arguments.length===2){var i=arguments[0],a=arguments[1];if(!this.isEquivalentClass(i))return!1;var h=i;if(this._geometries.length!==h._geometries.length)return!1;for(var u=0;u<this._geometries.length;u++)if(!r._geometries[u].equalsExact(h._geometries[u],a))return!1;return!0}else return t.prototype.equalsExact.apply(this,arguments)},e.prototype.normalize=function(){for(var r=this,i=0;i<this._geometries.length;i++)r._geometries[i].normalize();Df.sort(this._geometries)},e.prototype.getCoordinate=function(){return this.isEmpty()?null:this._geometries[0].getCoordinate()},e.prototype.getBoundaryDimension=function(){for(var r=this,i=Hn.FALSE,a=0;a<this._geometries.length;a++)i=Math.max(i,r._geometries[a].getBoundaryDimension());return i},e.prototype.getDimension=function(){for(var r=this,i=Hn.FALSE,a=0;a<this._geometries.length;a++)i=Math.max(i,r._geometries[a].getDimension());return i},e.prototype.getLength=function(){for(var r=this,i=0,a=0;a<this._geometries.length;a++)i+=r._geometries[a].getLength();return i},e.prototype.getNumPoints=function(){for(var r=this,i=0,a=0;a<this._geometries.length;a++)i+=r._geometries[a].getNumPoints();return i},e.prototype.getNumGeometries=function(){return this._geometries.length},e.prototype.reverse=function(){for(var r=this,i=this._geometries.length,a=new Array(i).fill(null),h=0;h<this._geometries.length;h++)a[h]=r._geometries[h].reverse();return this.getFactory().createGeometryCollection(a)},e.prototype.compareToSameClass=function(){var r=this;if(arguments.length===1){var i=arguments[0],a=new Yl(Df.asList(this._geometries)),h=new Yl(Df.asList(i._geometries));return this.compare(a,h)}else if(arguments.length===2){for(var u=arguments[0],_=arguments[1],w=u,C=this.getNumGeometries(),P=w.getNumGeometries(),D=0;D<C&&D<P;){var B=r.getGeometryN(D),$=w.getGeometryN(D),Z=B.compareToSameClass($,_);if(Z!==0)return Z;D++}return D<C?1:D<P?-1:0}},e.prototype.apply=function(){var r=this;if(tn(arguments[0],kc))for(var i=arguments[0],a=0;a<this._geometries.length;a++)r._geometries[a].apply(i);else if(tn(arguments[0],Hu)){var h=arguments[0];if(this._geometries.length===0)return null;for(var u=0;u<this._geometries.length&&(r._geometries[u].apply(h),!h.isDone());u++);h.isGeometryChanged()&&this.geometryChanged()}else if(tn(arguments[0],Zl)){var _=arguments[0];_.filter(this);for(var w=0;w<this._geometries.length;w++)r._geometries[w].apply(_)}else if(tn(arguments[0],Mh)){var C=arguments[0];C.filter(this);for(var P=0;P<this._geometries.length;P++)r._geometries[P].apply(C)}},e.prototype.getBoundary=function(){return this.checkNotGeometryCollection(this),fn.shouldNeverReachHere(),null},e.prototype.clone=function(){var r=this,i=t.prototype.clone.call(this);i._geometries=new Array(this._geometries.length).fill(null);for(var a=0;a<this._geometries.length;a++)i._geometries[a]=r._geometries[a].clone();return i},e.prototype.getGeometryType=function(){return"GeometryCollection"},e.prototype.copy=function(){for(var r=this,i=new Array(this._geometries.length).fill(null),a=0;a<i.length;a++)i[a]=r._geometries[a].copy();return new e(i,this._factory)},e.prototype.isEmpty=function(){for(var r=this,i=0;i<this._geometries.length;i++)if(!r._geometries[i].isEmpty())return!1;return!0},e.prototype.interfaces_=function(){return[]},e.prototype.getClass=function(){return e},n.serialVersionUID.get=function(){return-5694727726395021e3},Object.defineProperties(e,n),e}(We),$f=function(t){function e(){t.apply(this,arguments)}t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e;var n={serialVersionUID:{configurable:!0}};return e.prototype.getSortIndex=function(){return We.SORTINDEX_MULTILINESTRING},e.prototype.equalsExact=function(){if(arguments.length===2){var r=arguments[0],i=arguments[1];return this.isEquivalentClass(r)?t.prototype.equalsExact.call(this,r,i):!1}else return t.prototype.equalsExact.apply(this,arguments)},e.prototype.getBoundaryDimension=function(){return this.isClosed()?Hn.FALSE:0},e.prototype.isClosed=function(){var r=this;if(this.isEmpty())return!1;for(var i=0;i<this._geometries.length;i++)if(!r._geometries[i].isClosed())return!1;return!0},e.prototype.getDimension=function(){return 1},e.prototype.reverse=function(){for(var r=this,i=this._geometries.length,a=new Array(i).fill(null),h=0;h<this._geometries.length;h++)a[i-1-h]=r._geometries[h].reverse();return this.getFactory().createMultiLineString(a)},e.prototype.getBoundary=function(){return new fu(this).getBoundary()},e.prototype.getGeometryType=function(){return"MultiLineString"},e.prototype.copy=function(){for(var r=this,i=new Array(this._geometries.length).fill(null),a=0;a<i.length;a++)i[a]=r._geometries[a].copy();return new e(i,this._factory)},e.prototype.interfaces_=function(){return[Uy]},e.prototype.getClass=function(){return e},n.serialVersionUID.get=function(){return 8166665132445434e3},Object.defineProperties(e,n),e}(Ls),fu=function(){if(this._geom=null,this._geomFact=null,this._bnRule=null,this._endpointMap=null,arguments.length===1){var t=arguments[0],e=vu.MOD2_BOUNDARY_RULE;this._geom=t,this._geomFact=t.getFactory(),this._bnRule=e}else if(arguments.length===2){var n=arguments[0],r=arguments[1];this._geom=n,this._geomFact=n.getFactory(),this._bnRule=r}};fu.prototype.boundaryMultiLineString=function(t){if(this._geom.isEmpty())return this.getEmptyMultiPoint();var e=this.computeBoundaryCoordinates(t);return e.length===1?this._geomFact.createPoint(e[0]):this._geomFact.createMultiPointFromCoords(e)};fu.prototype.getBoundary=function(){return this._geom instanceof si?this.boundaryLineString(this._geom):this._geom instanceof $f?this.boundaryMultiLineString(this._geom):this._geom.getBoundary()};fu.prototype.boundaryLineString=function(t){if(this._geom.isEmpty())return this.getEmptyMultiPoint();if(t.isClosed()){var e=this._bnRule.isInBoundary(2);return e?t.getStartPoint():this._geomFact.createMultiPoint()}return this._geomFact.createMultiPoint([t.getStartPoint(),t.getEndPoint()])};fu.prototype.getEmptyMultiPoint=function(){return this._geomFact.createMultiPoint()};fu.prototype.computeBoundaryCoordinates=function(t){var e=this,n=new fe;this._endpointMap=new Qo;for(var r=0;r<t.getNumGeometries();r++){var i=t.getGeometryN(r);i.getNumPoints()!==0&&(e.addEndpoint(i.getCoordinateN(0)),e.addEndpoint(i.getCoordinateN(i.getNumPoints()-1)))}for(var a=this._endpointMap.entrySet().iterator();a.hasNext();){var h=a.next(),u=h.getValue(),_=u.count;e._bnRule.isInBoundary(_)&&n.add(h.getKey())}return In.toCoordinateArray(n)};fu.prototype.addEndpoint=function(t){var e=this._endpointMap.get(t);e===null&&(e=new kv,this._endpointMap.put(t,e)),e.count++};fu.prototype.interfaces_=function(){return[]};fu.prototype.getClass=function(){return fu};fu.getBoundary=function(){if(arguments.length===1){var t=arguments[0],e=new fu(t);return e.getBoundary()}else if(arguments.length===2){var n=arguments[0],r=arguments[1],i=new fu(n,r);return i.getBoundary()}};var kv=function(){this.count=null};kv.prototype.interfaces_=function(){return[]};kv.prototype.getClass=function(){return kv};function tA(){}function eA(){}var nA=function(){};function rA(){}function iA(){}function oA(){}var du=function(){},Ib={NEWLINE:{configurable:!0},SIMPLE_ORDINATE_FORMAT:{configurable:!0}};du.prototype.interfaces_=function(){return[]};du.prototype.getClass=function(){return du};du.chars=function(t,e){for(var n=new Array(e).fill(null),r=0;r<e;r++)n[r]=t;return String(n)};du.getStackTrace=function(){if(arguments.length===1){var t=arguments[0],e=new rA,n=new tA;return t.printStackTrace(n),e.toString()}else if(arguments.length===2){var r=arguments[0],i=arguments[1],a="";new eA(du.getStackTrace(r));for(var h=new oA,u=0;u<i;u++)try{a+=h.readLine()+du.NEWLINE}catch(_){if(_ instanceof iA)fn.shouldNeverReachHere();else throw _}finally{}return a}};du.split=function(t,e){for(var n=e.length,r=new fe,i=""+t,a=i.indexOf(e);a>=0;){var h=i.substring(0,a);r.add(h),i=i.substring(a+n),a=i.indexOf(e)}i.length>0&&r.add(i);for(var u=new Array(r.size()).fill(null),_=0;_<u.length;_++)u[_]=r.get(_);return u};du.toString=function(){if(arguments.length===1){var t=arguments[0];return du.SIMPLE_ORDINATE_FORMAT.format(t)}};du.spaces=function(t){return du.chars(" ",t)};Ib.NEWLINE.get=function(){return Fo.getProperty("line.separator")};Ib.SIMPLE_ORDINATE_FORMAT.get=function(){return new nA};Object.defineProperties(du,Ib);var bi=function(){};bi.prototype.interfaces_=function(){return[]};bi.prototype.getClass=function(){return bi};bi.copyCoord=function(t,e,n,r){for(var i=Math.min(t.getDimension(),n.getDimension()),a=0;a<i;a++)n.setOrdinate(r,a,t.getOrdinate(e,a))};bi.isRing=function(t){var e=t.size();return e===0?!0:e<=3?!1:t.getOrdinate(0,zn.X)===t.getOrdinate(e-1,zn.X)&&t.getOrdinate(0,zn.Y)===t.getOrdinate(e-1,zn.Y)};bi.isEqual=function(t,e){var n=t.size(),r=e.size();if(n!==r)return!1;for(var i=Math.min(t.getDimension(),e.getDimension()),a=0;a<n;a++)for(var h=0;h<i;h++){var u=t.getOrdinate(a,h),_=e.getOrdinate(a,h);if(t.getOrdinate(a,h)!==e.getOrdinate(a,h)&&!(un.isNaN(u)&&un.isNaN(_)))return!1}return!0};bi.extend=function(t,e,n){var r=t.create(n,e.getDimension()),i=e.size();if(bi.copy(e,0,r,0,i),i>0)for(var a=i;a<n;a++)bi.copy(e,i-1,r,a,1);return r};bi.reverse=function(t){for(var e=t.size()-1,n=Math.trunc(e/2),r=0;r<=n;r++)bi.swap(t,r,e-r)};bi.swap=function(t,e,n){if(e===n)return null;for(var r=0;r<t.getDimension();r++){var i=t.getOrdinate(e,r);t.setOrdinate(e,r,t.getOrdinate(n,r)),t.setOrdinate(n,r,i)}};bi.copy=function(t,e,n,r,i){for(var a=0;a<i;a++)bi.copyCoord(t,e+a,n,r+a)};bi.toString=function(){if(arguments.length===1){var t=arguments[0],e=t.size();if(e===0)return"()";var n=t.getDimension(),r=new fc;r.append("(");for(var i=0;i<e;i++){i>0&&r.append(" ");for(var a=0;a<n;a++)a>0&&r.append(","),r.append(du.toString(t.getOrdinate(i,a)))}return r.append(")"),r.toString()}};bi.ensureValidRing=function(t,e){var n=e.size();if(n===0)return e;if(n<=3)return bi.createClosedRing(t,e,4);var r=e.getOrdinate(0,zn.X)===e.getOrdinate(n-1,zn.X)&&e.getOrdinate(0,zn.Y)===e.getOrdinate(n-1,zn.Y);return r?e:bi.createClosedRing(t,e,n+1)};bi.createClosedRing=function(t,e,n){var r=t.create(n,e.getDimension()),i=e.size();bi.copy(e,0,r,0,i);for(var a=i;a<n;a++)bi.copy(e,0,r,a,1);return r};var si=function(t){function e(r,i){t.call(this,i),this._points=null,this.init(r)}t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e;var n={serialVersionUID:{configurable:!0}};return e.prototype.computeEnvelopeInternal=function(){return this.isEmpty()?new Be:this._points.expandEnvelope(new Be)},e.prototype.isRing=function(){return this.isClosed()&&this.isSimple()},e.prototype.getSortIndex=function(){return t.SORTINDEX_LINESTRING},e.prototype.getCoordinates=function(){return this._points.toCoordinateArray()},e.prototype.equalsExact=function(){var r=this;if(arguments.length===2){var i=arguments[0],a=arguments[1];if(!this.isEquivalentClass(i))return!1;var h=i;if(this._points.size()!==h._points.size())return!1;for(var u=0;u<this._points.size();u++)if(!r.equal(r._points.getCoordinate(u),h._points.getCoordinate(u),a))return!1;return!0}else return t.prototype.equalsExact.apply(this,arguments)},e.prototype.normalize=function(){for(var r=this,i=0;i<Math.trunc(this._points.size()/2);i++){var a=r._points.size()-1-i;if(!r._points.getCoordinate(i).equals(r._points.getCoordinate(a)))return r._points.getCoordinate(i).compareTo(r._points.getCoordinate(a))>0&&bi.reverse(r._points),null}},e.prototype.getCoordinate=function(){return this.isEmpty()?null:this._points.getCoordinate(0)},e.prototype.getBoundaryDimension=function(){return this.isClosed()?Hn.FALSE:0},e.prototype.isClosed=function(){return this.isEmpty()?!1:this.getCoordinateN(0).equals2D(this.getCoordinateN(this.getNumPoints()-1))},e.prototype.getEndPoint=function(){return this.isEmpty()?null:this.getPointN(this.getNumPoints()-1)},e.prototype.getDimension=function(){return 1},e.prototype.getLength=function(){return Se.computeLength(this._points)},e.prototype.getNumPoints=function(){return this._points.size()},e.prototype.reverse=function(){var r=this._points.copy();bi.reverse(r);var i=this.getFactory().createLineString(r);return i},e.prototype.compareToSameClass=function(){var r=this;if(arguments.length===1){for(var i=arguments[0],a=i,h=0,u=0;h<this._points.size()&&u<a._points.size();){var _=r._points.getCoordinate(h).compareTo(a._points.getCoordinate(u));if(_!==0)return _;h++,u++}return h<this._points.size()?1:u<a._points.size()?-1:0}else if(arguments.length===2){var w=arguments[0],C=arguments[1],P=w;return C.compare(this._points,P._points)}},e.prototype.apply=function(){var r=this;if(tn(arguments[0],kc))for(var i=arguments[0],a=0;a<this._points.size();a++)i.filter(r._points.getCoordinate(a));else if(tn(arguments[0],Hu)){var h=arguments[0];if(this._points.size()===0)return null;for(var u=0;u<this._points.size()&&(h.filter(r._points,u),!h.isDone());u++);h.isGeometryChanged()&&this.geometryChanged()}else if(tn(arguments[0],Zl)){var _=arguments[0];_.filter(this)}else if(tn(arguments[0],Mh)){var w=arguments[0];w.filter(this)}},e.prototype.getBoundary=function(){return new fu(this).getBoundary()},e.prototype.isEquivalentClass=function(r){return r instanceof e},e.prototype.clone=function(){var r=t.prototype.clone.call(this);return r._points=this._points.clone(),r},e.prototype.getCoordinateN=function(r){return this._points.getCoordinate(r)},e.prototype.getGeometryType=function(){return"LineString"},e.prototype.copy=function(){return new e(this._points.copy(),this._factory)},e.prototype.getCoordinateSequence=function(){return this._points},e.prototype.isEmpty=function(){return this._points.size()===0},e.prototype.init=function(r){if(r===null&&(r=this.getFactory().getCoordinateSequenceFactory().create([])),r.size()===1)throw new Xr("Invalid number of points in LineString (found "+r.size()+" - must be 0 or >= 2)");this._points=r},e.prototype.isCoordinate=function(r){for(var i=this,a=0;a<this._points.size();a++)if(i._points.getCoordinate(a).equals(r))return!0;return!1},e.prototype.getStartPoint=function(){return this.isEmpty()?null:this.getPointN(0)},e.prototype.getPointN=function(r){return this.getFactory().createPoint(this._points.getCoordinate(r))},e.prototype.interfaces_=function(){return[Uy]},e.prototype.getClass=function(){return e},n.serialVersionUID.get=function(){return 0x2b2b51ba435c8e00},Object.defineProperties(e,n),e}(We),Gy=function(){};Gy.prototype.interfaces_=function(){return[]};Gy.prototype.getClass=function(){return Gy};var _a=function(t){function e(r,i){t.call(this,i),this._coordinates=r||null,this.init(this._coordinates)}t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e;var n={serialVersionUID:{configurable:!0}};return e.prototype.computeEnvelopeInternal=function(){if(this.isEmpty())return new Be;var r=new Be;return r.expandToInclude(this._coordinates.getX(0),this._coordinates.getY(0)),r},e.prototype.getSortIndex=function(){return t.SORTINDEX_POINT},e.prototype.getCoordinates=function(){return this.isEmpty()?[]:[this.getCoordinate()]},e.prototype.equalsExact=function(){if(arguments.length===2){var r=arguments[0],i=arguments[1];return this.isEquivalentClass(r)?this.isEmpty()&&r.isEmpty()?!0:this.isEmpty()!==r.isEmpty()?!1:this.equal(r.getCoordinate(),this.getCoordinate(),i):!1}else return t.prototype.equalsExact.apply(this,arguments)},e.prototype.normalize=function(){},e.prototype.getCoordinate=function(){return this._coordinates.size()!==0?this._coordinates.getCoordinate(0):null},e.prototype.getBoundaryDimension=function(){return Hn.FALSE},e.prototype.getDimension=function(){return 0},e.prototype.getNumPoints=function(){return this.isEmpty()?0:1},e.prototype.reverse=function(){return this.copy()},e.prototype.getX=function(){if(this.getCoordinate()===null)throw new Error("getX called on empty Point");return this.getCoordinate().x},e.prototype.compareToSameClass=function(){if(arguments.length===1){var r=arguments[0],i=r;return this.getCoordinate().compareTo(i.getCoordinate())}else if(arguments.length===2){var a=arguments[0],h=arguments[1],u=a;return h.compare(this._coordinates,u._coordinates)}},e.prototype.apply=function(){if(tn(arguments[0],kc)){var r=arguments[0];if(this.isEmpty())return null;r.filter(this.getCoordinate())}else if(tn(arguments[0],Hu)){var i=arguments[0];if(this.isEmpty())return null;i.filter(this._coordinates,0),i.isGeometryChanged()&&this.geometryChanged()}else if(tn(arguments[0],Zl)){var a=arguments[0];a.filter(this)}else if(tn(arguments[0],Mh)){var h=arguments[0];h.filter(this)}},e.prototype.getBoundary=function(){return this.getFactory().createGeometryCollection(null)},e.prototype.clone=function(){var r=t.prototype.clone.call(this);return r._coordinates=this._coordinates.clone(),r},e.prototype.getGeometryType=function(){return"Point"},e.prototype.copy=function(){return new e(this._coordinates.copy(),this._factory)},e.prototype.getCoordinateSequence=function(){return this._coordinates},e.prototype.getY=function(){if(this.getCoordinate()===null)throw new Error("getY called on empty Point");return this.getCoordinate().y},e.prototype.isEmpty=function(){return this._coordinates.size()===0},e.prototype.init=function(r){r===null&&(r=this.getFactory().getCoordinateSequenceFactory().create([])),fn.isTrue(r.size()<=1),this._coordinates=r},e.prototype.isSimple=function(){return!0},e.prototype.interfaces_=function(){return[Gy]},e.prototype.getClass=function(){return e},n.serialVersionUID.get=function(){return 4902022702746615e3},Object.defineProperties(e,n),e}(We),Tp=function(){};Tp.prototype.interfaces_=function(){return[]};Tp.prototype.getClass=function(){return Tp};var to=function(t){function e(r,i,a){if(t.call(this,a),this._shell=null,this._holes=null,r===null&&(r=this.getFactory().createLinearRing()),i===null&&(i=[]),t.hasNullElements(i))throw new Xr("holes must not contain null elements");if(r.isEmpty()&&t.hasNonEmptyElements(i))throw new Xr("shell is empty but holes are not");this._shell=r,this._holes=i}t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e;var n={serialVersionUID:{configurable:!0}};return e.prototype.computeEnvelopeInternal=function(){return this._shell.getEnvelopeInternal()},e.prototype.getSortIndex=function(){return t.SORTINDEX_POLYGON},e.prototype.getCoordinates=function(){var r=this;if(this.isEmpty())return[];for(var i=new Array(this.getNumPoints()).fill(null),a=-1,h=this._shell.getCoordinates(),u=0;u<h.length;u++)a++,i[a]=h[u];for(var _=0;_<this._holes.length;_++)for(var w=r._holes[_].getCoordinates(),C=0;C<w.length;C++)a++,i[a]=w[C];return i},e.prototype.getArea=function(){var r=this,i=0;i+=Math.abs(Se.signedArea(this._shell.getCoordinateSequence()));for(var a=0;a<this._holes.length;a++)i-=Math.abs(Se.signedArea(r._holes[a].getCoordinateSequence()));return i},e.prototype.isRectangle=function(){if(this.getNumInteriorRing()!==0||this._shell===null||this._shell.getNumPoints()!==5)return!1;for(var r=this._shell.getCoordinateSequence(),i=this.getEnvelopeInternal(),a=0;a<5;a++){var h=r.getX(a);if(!(h===i.getMinX()||h===i.getMaxX()))return!1;var u=r.getY(a);if(!(u===i.getMinY()||u===i.getMaxY()))return!1}for(var _=r.getX(0),w=r.getY(0),C=1;C<=4;C++){var P=r.getX(C),D=r.getY(C),B=P!==_,$=D!==w;if(B===$)return!1;_=P,w=D}return!0},e.prototype.equalsExact=function(){var r=this;if(arguments.length===2){var i=arguments[0],a=arguments[1];if(!this.isEquivalentClass(i))return!1;var h=i,u=this._shell,_=h._shell;if(!u.equalsExact(_,a)||this._holes.length!==h._holes.length)return!1;for(var w=0;w<this._holes.length;w++)if(!r._holes[w].equalsExact(h._holes[w],a))return!1;return!0}else return t.prototype.equalsExact.apply(this,arguments)},e.prototype.normalize=function(){var r=this;if(arguments.length===0){this.normalize(this._shell,!0);for(var i=0;i<this._holes.length;i++)r.normalize(r._holes[i],!1);Df.sort(this._holes)}else if(arguments.length===2){var a=arguments[0],h=arguments[1];if(a.isEmpty())return null;var u=new Array(a.getCoordinates().length-1).fill(null);Fo.arraycopy(a.getCoordinates(),0,u,0,u.length);var _=In.minCoordinate(a.getCoordinates());In.scroll(u,_),Fo.arraycopy(u,0,a.getCoordinates(),0,u.length),a.getCoordinates()[u.length]=u[0],Se.isCCW(a.getCoordinates())===h&&In.reverse(a.getCoordinates())}},e.prototype.getCoordinate=function(){return this._shell.getCoordinate()},e.prototype.getNumInteriorRing=function(){return this._holes.length},e.prototype.getBoundaryDimension=function(){return 1},e.prototype.getDimension=function(){return 2},e.prototype.getLength=function(){var r=this,i=0;i+=this._shell.getLength();for(var a=0;a<this._holes.length;a++)i+=r._holes[a].getLength();return i},e.prototype.getNumPoints=function(){for(var r=this,i=this._shell.getNumPoints(),a=0;a<this._holes.length;a++)i+=r._holes[a].getNumPoints();return i},e.prototype.reverse=function(){var r=this,i=this.copy();i._shell=this._shell.copy().reverse(),i._holes=new Array(this._holes.length).fill(null);for(var a=0;a<this._holes.length;a++)i._holes[a]=r._holes[a].copy().reverse();return i},e.prototype.convexHull=function(){return this.getExteriorRing().convexHull()},e.prototype.compareToSameClass=function(){var r=this;if(arguments.length===1){var i=arguments[0],a=this._shell,h=i._shell;return a.compareToSameClass(h)}else if(arguments.length===2){var u=arguments[0],_=arguments[1],w=u,C=this._shell,P=w._shell,D=C.compareToSameClass(P,_);if(D!==0)return D;for(var B=this.getNumInteriorRing(),$=w.getNumInteriorRing(),Z=0;Z<B&&Z<$;){var W=r.getInteriorRingN(Z),rt=w.getInteriorRingN(Z),ct=W.compareToSameClass(rt,_);if(ct!==0)return ct;Z++}return Z<B?1:Z<$?-1:0}},e.prototype.apply=function(r){var i=this;if(tn(r,kc)){this._shell.apply(r);for(var a=0;a<this._holes.length;a++)i._holes[a].apply(r)}else if(tn(r,Hu)){if(this._shell.apply(r),!r.isDone())for(var h=0;h<this._holes.length&&(i._holes[h].apply(r),!r.isDone());h++);r.isGeometryChanged()&&this.geometryChanged()}else if(tn(r,Zl))r.filter(this);else if(tn(r,Mh)){r.filter(this),this._shell.apply(r);for(var u=0;u<this._holes.length;u++)i._holes[u].apply(r)}},e.prototype.getBoundary=function(){var r=this;if(this.isEmpty())return this.getFactory().createMultiLineString();var i=new Array(this._holes.length+1).fill(null);i[0]=this._shell;for(var a=0;a<this._holes.length;a++)i[a+1]=r._holes[a];return i.length<=1?this.getFactory().createLinearRing(i[0].getCoordinateSequence()):this.getFactory().createMultiLineString(i)},e.prototype.clone=function(){var r=this,i=t.prototype.clone.call(this);i._shell=this._shell.clone(),i._holes=new Array(this._holes.length).fill(null);for(var a=0;a<this._holes.length;a++)i._holes[a]=r._holes[a].clone();return i},e.prototype.getGeometryType=function(){return"Polygon"},e.prototype.copy=function(){for(var r=this,i=this._shell.copy(),a=new Array(this._holes.length).fill(null),h=0;h<a.length;h++)a[h]=r._holes[h].copy();return new e(i,a,this._factory)},e.prototype.getExteriorRing=function(){return this._shell},e.prototype.isEmpty=function(){return this._shell.isEmpty()},e.prototype.getInteriorRingN=function(r){return this._holes[r]},e.prototype.interfaces_=function(){return[Tp]},e.prototype.getClass=function(){return e},n.serialVersionUID.get=function(){return-0x307ffefd8dc97200},Object.defineProperties(e,n),e}(We),Jg=function(t){function e(){t.apply(this,arguments)}t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e;var n={serialVersionUID:{configurable:!0}};return e.prototype.getSortIndex=function(){return We.SORTINDEX_MULTIPOINT},e.prototype.isValid=function(){return!0},e.prototype.equalsExact=function(){if(arguments.length===2){var r=arguments[0],i=arguments[1];return this.isEquivalentClass(r)?t.prototype.equalsExact.call(this,r,i):!1}else return t.prototype.equalsExact.apply(this,arguments)},e.prototype.getCoordinate=function(){if(arguments.length===1){var r=arguments[0];return this._geometries[r].getCoordinate()}else return t.prototype.getCoordinate.apply(this,arguments)},e.prototype.getBoundaryDimension=function(){return Hn.FALSE},e.prototype.getDimension=function(){return 0},e.prototype.getBoundary=function(){return this.getFactory().createGeometryCollection(null)},e.prototype.getGeometryType=function(){return"MultiPoint"},e.prototype.copy=function(){for(var r=this,i=new Array(this._geometries.length).fill(null),a=0;a<i.length;a++)i[a]=r._geometries[a].copy();return new e(i,this._factory)},e.prototype.interfaces_=function(){return[Gy]},e.prototype.getClass=function(){return e},n.serialVersionUID.get=function(){return-8048474874175356e3},Object.defineProperties(e,n),e}(Ls),zc=function(t){function e(r,i){r instanceof Tt&&i instanceof wn&&(r=i.getCoordinateSequenceFactory().create(r)),t.call(this,r,i),this.validateConstruction()}t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e;var n={MINIMUM_VALID_SIZE:{configurable:!0},serialVersionUID:{configurable:!0}};return e.prototype.getSortIndex=function(){return We.SORTINDEX_LINEARRING},e.prototype.getBoundaryDimension=function(){return Hn.FALSE},e.prototype.isClosed=function(){return this.isEmpty()?!0:t.prototype.isClosed.call(this)},e.prototype.reverse=function(){var r=this._points.copy();bi.reverse(r);var i=this.getFactory().createLinearRing(r);return i},e.prototype.validateConstruction=function(){if(!this.isEmpty()&&!t.prototype.isClosed.call(this))throw new Xr("Points of LinearRing do not form a closed linestring");if(this.getCoordinateSequence().size()>=1&&this.getCoordinateSequence().size()<e.MINIMUM_VALID_SIZE)throw new Xr("Invalid number of points in LinearRing (found "+this.getCoordinateSequence().size()+" - must be 0 or >= 4)")},e.prototype.getGeometryType=function(){return"LinearRing"},e.prototype.copy=function(){return new e(this._points.copy(),this._factory)},e.prototype.interfaces_=function(){return[]},e.prototype.getClass=function(){return e},n.MINIMUM_VALID_SIZE.get=function(){return 4},n.serialVersionUID.get=function(){return-0x3b229e262367a600},Object.defineProperties(e,n),e}(si),Dc=function(t){function e(){t.apply(this,arguments)}t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e;var n={serialVersionUID:{configurable:!0}};return e.prototype.getSortIndex=function(){return We.SORTINDEX_MULTIPOLYGON},e.prototype.equalsExact=function(){if(arguments.length===2){var r=arguments[0],i=arguments[1];return this.isEquivalentClass(r)?t.prototype.equalsExact.call(this,r,i):!1}else return t.prototype.equalsExact.apply(this,arguments)},e.prototype.getBoundaryDimension=function(){return 1},e.prototype.getDimension=function(){return 2},e.prototype.reverse=function(){for(var r=this,i=this._geometries.length,a=new Array(i).fill(null),h=0;h<this._geometries.length;h++)a[h]=r._geometries[h].reverse();return this.getFactory().createMultiPolygon(a)},e.prototype.getBoundary=function(){var r=this;if(this.isEmpty())return this.getFactory().createMultiLineString();for(var i=new fe,a=0;a<this._geometries.length;a++)for(var h=r._geometries[a],u=h.getBoundary(),_=0;_<u.getNumGeometries();_++)i.add(u.getGeometryN(_));var w=new Array(i.size()).fill(null);return this.getFactory().createMultiLineString(i.toArray(w))},e.prototype.getGeometryType=function(){return"MultiPolygon"},e.prototype.copy=function(){for(var r=this,i=new Array(this._geometries.length).fill(null),a=0;a<i.length;a++)i[a]=r._geometries[a].copy();return new e(i,this._factory)},e.prototype.interfaces_=function(){return[Tp]},e.prototype.getClass=function(){return e},n.serialVersionUID.get=function(){return-0x7a5aa1369171980},Object.defineProperties(e,n),e}(Ls),xu=function(t){this._factory=t||null,this._isUserDataCopied=!1},f0={NoOpGeometryOperation:{configurable:!0},CoordinateOperation:{configurable:!0},CoordinateSequenceOperation:{configurable:!0}};xu.prototype.setCopyUserData=function(t){this._isUserDataCopied=t};xu.prototype.edit=function(t,e){if(t===null)return null;var n=this.editInternal(t,e);return this._isUserDataCopied&&n.setUserData(t.getUserData()),n};xu.prototype.editInternal=function(t,e){return this._factory===null&&(this._factory=t.getFactory()),t instanceof Ls?this.editGeometryCollection(t,e):t instanceof to?this.editPolygon(t,e):t instanceof _a?e.edit(t,this._factory):t instanceof si?e.edit(t,this._factory):(fn.shouldNeverReachHere("Unsupported Geometry class: "+t.getClass().getName()),null)};xu.prototype.editGeometryCollection=function(t,e){for(var n=this,r=e.edit(t,this._factory),i=new fe,a=0;a<r.getNumGeometries();a++){var h=n.edit(r.getGeometryN(a),e);h===null||h.isEmpty()||i.add(h)}return r.getClass()===Jg?this._factory.createMultiPoint(i.toArray([])):r.getClass()===$f?this._factory.createMultiLineString(i.toArray([])):r.getClass()===Dc?this._factory.createMultiPolygon(i.toArray([])):this._factory.createGeometryCollection(i.toArray([]))};xu.prototype.editPolygon=function(t,e){var n=this,r=e.edit(t,this._factory);if(r===null&&(r=this._factory.createPolygon(null)),r.isEmpty())return r;var i=this.edit(r.getExteriorRing(),e);if(i===null||i.isEmpty())return this._factory.createPolygon();for(var a=new fe,h=0;h<r.getNumInteriorRing();h++){var u=n.edit(r.getInteriorRingN(h),e);u===null||u.isEmpty()||a.add(u)}return this._factory.createPolygon(i,a.toArray([]))};xu.prototype.interfaces_=function(){return[]};xu.prototype.getClass=function(){return xu};xu.GeometryEditorOperation=function(){};f0.NoOpGeometryOperation.get=function(){return qy};f0.CoordinateOperation.get=function(){return jy};f0.CoordinateSequenceOperation.get=function(){return Xy};Object.defineProperties(xu,f0);var qy=function(){};qy.prototype.edit=function(t,e){return t};qy.prototype.interfaces_=function(){return[xu.GeometryEditorOperation]};qy.prototype.getClass=function(){return qy};var jy=function(){};jy.prototype.edit=function(t,e){var n=this.editCoordinates(t.getCoordinates(),t);return n===null?t:t instanceof zc?e.createLinearRing(n):t instanceof si?e.createLineString(n):t instanceof _a?n.length>0?e.createPoint(n[0]):e.createPoint():t};jy.prototype.interfaces_=function(){return[xu.GeometryEditorOperation]};jy.prototype.getClass=function(){return jy};var Xy=function(){};Xy.prototype.edit=function(t,e){return t instanceof zc?e.createLinearRing(this.edit(t.getCoordinateSequence(),t)):t instanceof si?e.createLineString(this.edit(t.getCoordinateSequence(),t)):t instanceof _a?e.createPoint(this.edit(t.getCoordinateSequence(),t)):t};Xy.prototype.interfaces_=function(){return[xu.GeometryEditorOperation]};Xy.prototype.getClass=function(){return Xy};var mi=function(){var t=this;if(this._dimension=3,this._coordinates=null,arguments.length===1){if(arguments[0]instanceof Array)this._coordinates=arguments[0],this._dimension=3;else if(Number.isInteger(arguments[0])){var e=arguments[0];this._coordinates=new Array(e).fill(null);for(var n=0;n<e;n++)t._coordinates[n]=new Tt}else if(tn(arguments[0],zn)){var r=arguments[0];if(r===null)return this._coordinates=new Array(0).fill(null),null;this._dimension=r.getDimension(),this._coordinates=new Array(r.size()).fill(null);for(var i=0;i<this._coordinates.length;i++)t._coordinates[i]=r.getCoordinateCopy(i)}}else if(arguments.length===2){if(arguments[0]instanceof Array&&Number.isInteger(arguments[1])){var a=arguments[0],h=arguments[1];this._coordinates=a,this._dimension=h,a===null&&(this._coordinates=new Array(0).fill(null))}else if(Number.isInteger(arguments[0])&&Number.isInteger(arguments[1])){var u=arguments[0],_=arguments[1];this._coordinates=new Array(u).fill(null),this._dimension=_;for(var w=0;w<u;w++)t._coordinates[w]=new Tt}}},gS={serialVersionUID:{configurable:!0}};mi.prototype.setOrdinate=function(t,e,n){switch(e){case zn.X:this._coordinates[t].x=n;break;case zn.Y:this._coordinates[t].y=n;break;case zn.Z:this._coordinates[t].z=n;break;default:throw new Xr("invalid ordinateIndex")}};mi.prototype.size=function(){return this._coordinates.length};mi.prototype.getOrdinate=function(t,e){switch(e){case zn.X:return this._coordinates[t].x;case zn.Y:return this._coordinates[t].y;case zn.Z:return this._coordinates[t].z}return un.NaN};mi.prototype.getCoordinate=function(){if(arguments.length===1){var t=arguments[0];return this._coordinates[t]}else if(arguments.length===2){var e=arguments[0],n=arguments[1];n.x=this._coordinates[e].x,n.y=this._coordinates[e].y,n.z=this._coordinates[e].z}};mi.prototype.getCoordinateCopy=function(t){return new Tt(this._coordinates[t])};mi.prototype.getDimension=function(){return this._dimension};mi.prototype.getX=function(t){return this._coordinates[t].x};mi.prototype.clone=function(){for(var t=this,e=new Array(this.size()).fill(null),n=0;n<this._coordinates.length;n++)e[n]=t._coordinates[n].clone();return new mi(e,this._dimension)};mi.prototype.expandEnvelope=function(t){for(var e=this,n=0;n<this._coordinates.length;n++)t.expandToInclude(e._coordinates[n]);return t};mi.prototype.copy=function(){for(var t=this,e=new Array(this.size()).fill(null),n=0;n<this._coordinates.length;n++)e[n]=t._coordinates[n].copy();return new mi(e,this._dimension)};mi.prototype.toString=function(){var t=this;if(this._coordinates.length>0){var e=new fc(17*this._coordinates.length);e.append("("),e.append(this._coordinates[0]);for(var n=1;n<this._coordinates.length;n++)e.append(", "),e.append(t._coordinates[n]);return e.append(")"),e.toString()}else return"()"};mi.prototype.getY=function(t){return this._coordinates[t].y};mi.prototype.toCoordinateArray=function(){return this._coordinates};mi.prototype.interfaces_=function(){return[zn,Lu]};mi.prototype.getClass=function(){return mi};gS.serialVersionUID.get=function(){return-0xcb44a778db18e00};Object.defineProperties(mi,gS);var Bc=function(){},Sb={serialVersionUID:{configurable:!0},instanceObject:{configurable:!0}};Bc.prototype.readResolve=function(){return Bc.instance()};Bc.prototype.create=function(){if(arguments.length===1){if(arguments[0]instanceof Array){var t=arguments[0];return new mi(t)}else if(tn(arguments[0],zn)){var e=arguments[0];return new mi(e)}}else if(arguments.length===2){var n=arguments[0],r=arguments[1];return r>3&&(r=3),r<2?new mi(n):new mi(n,r)}};Bc.prototype.interfaces_=function(){return[jg,Lu]};Bc.prototype.getClass=function(){return Bc};Bc.instance=function(){return Bc.instanceObject};Sb.serialVersionUID.get=function(){return-0x38e49fa6cf6f2e00};Sb.instanceObject.get=function(){return new Bc};Object.defineProperties(Bc,Sb);var mS=function(t){function e(){t.call(this),this.map_=new Map}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.get=function(n){return this.map_.get(n)||null},e.prototype.put=function(n,r){return this.map_.set(n,r),r},e.prototype.values=function(){for(var n=new fe,r=this.map_.values(),i=r.next();!i.done;)n.add(i.value),i=r.next();return n},e.prototype.entrySet=function(){var n=new Eb;return this.map_.entries().forEach(function(r){return n.add(r)}),n},e.prototype.size=function(){return this.map_.size()},e}(ug),Qn=function t(){if(this._modelType=null,this._scale=null,arguments.length===0)this._modelType=t.FLOATING;else if(arguments.length===1){if(arguments[0]instanceof Hl){var e=arguments[0];this._modelType=e,e===t.FIXED&&this.setScale(1)}else if(typeof arguments[0]=="number"){var n=arguments[0];this._modelType=t.FIXED,this.setScale(n)}else if(arguments[0]instanceof t){var r=arguments[0];this._modelType=r._modelType,this._scale=r._scale}}},Cb={serialVersionUID:{configurable:!0},maximumPreciseValue:{configurable:!0}};Qn.prototype.equals=function(t){if(!(t instanceof Qn))return!1;var e=t;return this._modelType===e._modelType&&this._scale===e._scale};Qn.prototype.compareTo=function(t){var e=t,n=this.getMaximumSignificantDigits(),r=e.getMaximumSignificantDigits();return new Xl(n).compareTo(new Xl(r))};Qn.prototype.getScale=function(){return this._scale};Qn.prototype.isFloating=function(){return this._modelType===Qn.FLOATING||this._modelType===Qn.FLOATING_SINGLE};Qn.prototype.getType=function(){return this._modelType};Qn.prototype.toString=function(){var t="UNKNOWN";return this._modelType===Qn.FLOATING?t="Floating":this._modelType===Qn.FLOATING_SINGLE?t="Floating-Single":this._modelType===Qn.FIXED&&(t="Fixed (Scale="+this.getScale()+")"),t};Qn.prototype.makePrecise=function(){if(typeof arguments[0]=="number"){var t=arguments[0];if(un.isNaN(t))return t;if(this._modelType===Qn.FLOATING_SINGLE){var e=t;return e}return this._modelType===Qn.FIXED?Math.round(t*this._scale)/this._scale:t}else if(arguments[0]instanceof Tt){var n=arguments[0];if(this._modelType===Qn.FLOATING)return null;n.x=this.makePrecise(n.x),n.y=this.makePrecise(n.y)}};Qn.prototype.getMaximumSignificantDigits=function(){var t=16;return this._modelType===Qn.FLOATING?t=16:this._modelType===Qn.FLOATING_SINGLE?t=6:this._modelType===Qn.FIXED&&(t=1+Math.trunc(Math.ceil(Math.log(this.getScale())/Math.log(10)))),t};Qn.prototype.setScale=function(t){this._scale=Math.abs(t)};Qn.prototype.interfaces_=function(){return[Lu,Tu]};Qn.prototype.getClass=function(){return Qn};Qn.mostPrecise=function(t,e){return t.compareTo(e)>=0?t:e};Cb.serialVersionUID.get=function(){return 7777263578777804e3};Cb.maximumPreciseValue.get=function(){return 9007199254740992};Object.defineProperties(Qn,Cb);var Hl=function t(e){this._name=e||null,t.nameToTypeMap.put(e,this)},Tb={serialVersionUID:{configurable:!0},nameToTypeMap:{configurable:!0}};Hl.prototype.readResolve=function(){return Hl.nameToTypeMap.get(this._name)};Hl.prototype.toString=function(){return this._name};Hl.prototype.interfaces_=function(){return[Lu]};Hl.prototype.getClass=function(){return Hl};Tb.serialVersionUID.get=function(){return-552860263173159e4};Tb.nameToTypeMap.get=function(){return new mS};Object.defineProperties(Hl,Tb);Qn.Type=Hl;Qn.FIXED=new Hl("FIXED");Qn.FLOATING=new Hl("FLOATING");Qn.FLOATING_SINGLE=new Hl("FLOATING SINGLE");var wn=function t(){this._precisionModel=new Qn,this._SRID=0,this._coordinateSequenceFactory=t.getDefaultCoordinateSequenceFactory(),arguments.length===0||(arguments.length===1?tn(arguments[0],jg)?this._coordinateSequenceFactory=arguments[0]:arguments[0]instanceof Qn&&(this._precisionModel=arguments[0]):arguments.length===2?(this._precisionModel=arguments[0],this._SRID=arguments[1]):arguments.length===3&&(this._precisionModel=arguments[0],this._SRID=arguments[1],this._coordinateSequenceFactory=arguments[2]))},yS={serialVersionUID:{configurable:!0}};wn.prototype.toGeometry=function(t){return t.isNull()?this.createPoint(null):t.getMinX()===t.getMaxX()&&t.getMinY()===t.getMaxY()?this.createPoint(new Tt(t.getMinX(),t.getMinY())):t.getMinX()===t.getMaxX()||t.getMinY()===t.getMaxY()?this.createLineString([new Tt(t.getMinX(),t.getMinY()),new Tt(t.getMaxX(),t.getMaxY())]):this.createPolygon(this.createLinearRing([new Tt(t.getMinX(),t.getMinY()),new Tt(t.getMinX(),t.getMaxY()),new Tt(t.getMaxX(),t.getMaxY()),new Tt(t.getMaxX(),t.getMinY()),new Tt(t.getMinX(),t.getMinY())]),null)};wn.prototype.createLineString=function(t){if(t){if(t instanceof Array)return new si(this.getCoordinateSequenceFactory().create(t),this);if(tn(t,zn))return new si(t,this)}else return new si(this.getCoordinateSequenceFactory().create([]),this)};wn.prototype.createMultiLineString=function(){if(arguments.length===0)return new $f(null,this);if(arguments.length===1){var t=arguments[0];return new $f(t,this)}};wn.prototype.buildGeometry=function(t){for(var e=null,n=!1,r=!1,i=t.iterator();i.hasNext();){var a=i.next(),h=a.getClass();e===null&&(e=h),h!==e&&(n=!0),a.isGeometryCollectionOrDerived()&&(r=!0)}if(e===null)return this.createGeometryCollection();if(n||r)return this.createGeometryCollection(wn.toGeometryArray(t));var u=t.iterator().next(),_=t.size()>1;if(_){if(u instanceof to)return this.createMultiPolygon(wn.toPolygonArray(t));if(u instanceof si)return this.createMultiLineString(wn.toLineStringArray(t));if(u instanceof _a)return this.createMultiPoint(wn.toPointArray(t));fn.shouldNeverReachHere("Unhandled class: "+u.getClass().getName())}return u};wn.prototype.createMultiPointFromCoords=function(t){return this.createMultiPoint(t!==null?this.getCoordinateSequenceFactory().create(t):null)};wn.prototype.createPoint=function(){if(arguments.length===0)return this.createPoint(this.getCoordinateSequenceFactory().create([]));if(arguments.length===1){if(arguments[0]instanceof Tt){var t=arguments[0];return this.createPoint(t!==null?this.getCoordinateSequenceFactory().create([t]):null)}else if(tn(arguments[0],zn)){var e=arguments[0];return new _a(e,this)}}};wn.prototype.getCoordinateSequenceFactory=function(){return this._coordinateSequenceFactory};wn.prototype.createPolygon=function(){if(arguments.length===0)return new to(null,null,this);if(arguments.length===1){if(tn(arguments[0],zn)){var t=arguments[0];return this.createPolygon(this.createLinearRing(t))}else if(arguments[0]instanceof Array){var e=arguments[0];return this.createPolygon(this.createLinearRing(e))}else if(arguments[0]instanceof zc){var n=arguments[0];return this.createPolygon(n,null)}}else if(arguments.length===2){var r=arguments[0],i=arguments[1];return new to(r,i,this)}};wn.prototype.getSRID=function(){return this._SRID};wn.prototype.createGeometryCollection=function(){if(arguments.length===0)return new Ls(null,this);if(arguments.length===1){var t=arguments[0];return new Ls(t,this)}};wn.prototype.createGeometry=function(t){var e=new xu(this);return e.edit(t,{edit:function(){if(arguments.length===2){var n=arguments[0];return this._coordinateSequenceFactory.create(n)}}})};wn.prototype.getPrecisionModel=function(){return this._precisionModel};wn.prototype.createLinearRing=function(){if(arguments.length===0)return this.createLinearRing(this.getCoordinateSequenceFactory().create([]));if(arguments.length===1){if(arguments[0]instanceof Array){var t=arguments[0];return this.createLinearRing(t!==null?this.getCoordinateSequenceFactory().create(t):null)}else if(tn(arguments[0],zn)){var e=arguments[0];return new zc(e,this)}}};wn.prototype.createMultiPolygon=function(){if(arguments.length===0)return new Dc(null,this);if(arguments.length===1){var t=arguments[0];return new Dc(t,this)}};wn.prototype.createMultiPoint=function(){var t=this;if(arguments.length===0)return new Jg(null,this);if(arguments.length===1){if(arguments[0]instanceof Array){var e=arguments[0];return new Jg(e,this)}else if(arguments[0]instanceof Array){var n=arguments[0];return this.createMultiPoint(n!==null?this.getCoordinateSequenceFactory().create(n):null)}else if(tn(arguments[0],zn)){var r=arguments[0];if(r===null)return this.createMultiPoint(new Array(0).fill(null));for(var i=new Array(r.size()).fill(null),a=0;a<r.size();a++){var h=t.getCoordinateSequenceFactory().create(1,r.getDimension());bi.copy(r,a,h,0,1),i[a]=t.createPoint(h)}return this.createMultiPoint(i)}}};wn.prototype.interfaces_=function(){return[Lu]};wn.prototype.getClass=function(){return wn};wn.toMultiPolygonArray=function(t){var e=new Array(t.size()).fill(null);return t.toArray(e)};wn.toGeometryArray=function(t){if(t===null)return null;var e=new Array(t.size()).fill(null);return t.toArray(e)};wn.getDefaultCoordinateSequenceFactory=function(){return Bc.instance()};wn.toMultiLineStringArray=function(t){var e=new Array(t.size()).fill(null);return t.toArray(e)};wn.toLineStringArray=function(t){var e=new Array(t.size()).fill(null);return t.toArray(e)};wn.toMultiPointArray=function(t){var e=new Array(t.size()).fill(null);return t.toArray(e)};wn.toLinearRingArray=function(t){var e=new Array(t.size()).fill(null);return t.toArray(e)};wn.toPointArray=function(t){var e=new Array(t.size()).fill(null);return t.toArray(e)};wn.toPolygonArray=function(t){var e=new Array(t.size()).fill(null);return t.toArray(e)};wn.createPointFromInternalCoord=function(t,e){return e.getPrecisionModel().makePrecise(t),e.getFactory().createPoint(t)};yS.serialVersionUID.get=function(){return-6820524753094096e3};Object.defineProperties(wn,yS);var sA=["Point","MultiPoint","LineString","MultiLineString","Polygon","MultiPolygon"],d0=function(t){this.geometryFactory=t||new wn};d0.prototype.read=function(t){var e;typeof t=="string"?e=JSON.parse(t):e=t;var n=e.type;if(!kl[n])throw new Error("Unknown GeoJSON type: "+e.type);return sA.indexOf(n)!==-1?kl[n].apply(this,[e.coordinates]):n==="GeometryCollection"?kl[n].apply(this,[e.geometries]):kl[n].apply(this,[e])};d0.prototype.write=function(t){var e=t.getGeometryType();if(!xh[e])throw new Error("Geometry is not supported");return xh[e].apply(this,[t])};var kl={Feature:function(t){var e={};for(var n in t)e[n]=t[n];if(t.geometry){var r=t.geometry.type;if(!kl[r])throw new Error("Unknown GeoJSON type: "+t.type);e.geometry=this.read(t.geometry)}return t.bbox&&(e.bbox=kl.bbox.apply(this,[t.bbox])),e},FeatureCollection:function(t){var e=this,n={};if(t.features){n.features=[];for(var r=0;r<t.features.length;++r)n.features.push(e.read(t.features[r]))}return t.bbox&&(n.bbox=this.parse.bbox.apply(this,[t.bbox])),n},coordinates:function(t){for(var e=[],n=0;n<t.length;++n){var r=t[n];e.push(new Tt(r[0],r[1]))}return e},bbox:function(t){return this.geometryFactory.createLinearRing([new Tt(t[0],t[1]),new Tt(t[2],t[1]),new Tt(t[2],t[3]),new Tt(t[0],t[3]),new Tt(t[0],t[1])])},Point:function(t){var e=new Tt(t[0],t[1]);return this.geometryFactory.createPoint(e)},MultiPoint:function(t){for(var e=this,n=[],r=0;r<t.length;++r)n.push(kl.Point.apply(e,[t[r]]));return this.geometryFactory.createMultiPoint(n)},LineString:function(t){var e=kl.coordinates.apply(this,[t]);return this.geometryFactory.createLineString(e)},MultiLineString:function(t){for(var e=this,n=[],r=0;r<t.length;++r)n.push(kl.LineString.apply(e,[t[r]]));return this.geometryFactory.createMultiLineString(n)},Polygon:function(t){for(var e=this,n=kl.coordinates.apply(this,[t[0]]),r=this.geometryFactory.createLinearRing(n),i=[],a=1;a<t.length;++a){var h=t[a],u=kl.coordinates.apply(e,[h]),_=e.geometryFactory.createLinearRing(u);i.push(_)}return this.geometryFactory.createPolygon(r,i)},MultiPolygon:function(t){for(var e=this,n=[],r=0;r<t.length;++r){var i=t[r];n.push(kl.Polygon.apply(e,[i]))}return this.geometryFactory.createMultiPolygon(n)},GeometryCollection:function(t){for(var e=this,n=[],r=0;r<t.length;++r){var i=t[r];n.push(e.read(i))}return this.geometryFactory.createGeometryCollection(n)}},xh={coordinate:function(t){return[t.x,t.y]},Point:function(t){var e=xh.coordinate.apply(this,[t.getCoordinate()]);return{type:"Point",coordinates:e}},MultiPoint:function(t){for(var e=this,n=[],r=0;r<t._geometries.length;++r){var i=t._geometries[r],a=xh.Point.apply(e,[i]);n.push(a.coordinates)}return{type:"MultiPoint",coordinates:n}},LineString:function(t){for(var e=this,n=[],r=t.getCoordinates(),i=0;i<r.length;++i){var a=r[i];n.push(xh.coordinate.apply(e,[a]))}return{type:"LineString",coordinates:n}},MultiLineString:function(t){for(var e=this,n=[],r=0;r<t._geometries.length;++r){var i=t._geometries[r],a=xh.LineString.apply(e,[i]);n.push(a.coordinates)}return{type:"MultiLineString",coordinates:n}},Polygon:function(t){var e=this,n=[],r=xh.LineString.apply(this,[t._shell]);n.push(r.coordinates);for(var i=0;i<t._holes.length;++i){var a=t._holes[i],h=xh.LineString.apply(e,[a]);n.push(h.coordinates)}return{type:"Polygon",coordinates:n}},MultiPolygon:function(t){for(var e=this,n=[],r=0;r<t._geometries.length;++r){var i=t._geometries[r],a=xh.Polygon.apply(e,[i]);n.push(a.coordinates)}return{type:"MultiPolygon",coordinates:n}},GeometryCollection:function(t){for(var e=this,n=[],r=0;r<t._geometries.length;++r){var i=t._geometries[r],a=i.getGeometryType();n.push(xh[a].apply(e,[i]))}return{type:"GeometryCollection",geometries:n}}},Lb=function(t){this.geometryFactory=t||new wn,this.precisionModel=this.geometryFactory.getPrecisionModel(),this.parser=new d0(this.geometryFactory)};Lb.prototype.read=function(t){var e=this.parser.read(t);return this.precisionModel.getType()===Qn.FIXED&&this.reducePrecision(e),e};Lb.prototype.reducePrecision=function(t){var e=this,n,r;if(t.coordinate)this.precisionModel.makePrecise(t.coordinate);else if(t.points)for(n=0,r=t.points.length;n<r;n++)e.precisionModel.makePrecise(t.points[n]);else if(t.geometries)for(n=0,r=t.geometries.length;n<r;n++)e.reducePrecision(t.geometries[n])};var _S=function(){this.parser=new d0(this.geometryFactory)};_S.prototype.write=function(t){return this.parser.write(t)};var ie=function(){},g0={ON:{configurable:!0},LEFT:{configurable:!0},RIGHT:{configurable:!0}};ie.prototype.interfaces_=function(){return[]};ie.prototype.getClass=function(){return ie};ie.opposite=function(t){return t===ie.LEFT?ie.RIGHT:t===ie.RIGHT?ie.LEFT:t};g0.ON.get=function(){return 0};g0.LEFT.get=function(){return 1};g0.RIGHT.get=function(){return 2};Object.defineProperties(ie,g0);function m0(t){this.message=t||""}m0.prototype=new Error;m0.prototype.name="EmptyStackException";function dc(){this.array_=[]}dc.prototype=new ju;dc.prototype.add=function(t){return this.array_.push(t),!0};dc.prototype.get=function(t){if(t<0||t>=this.size())throw new Error;return this.array_[t]};dc.prototype.push=function(t){return this.array_.push(t),t};dc.prototype.pop=function(t){if(this.array_.length===0)throw new m0;return this.array_.pop()};dc.prototype.peek=function(){if(this.array_.length===0)throw new m0;return this.array_[this.array_.length-1]};dc.prototype.empty=function(){return this.array_.length===0};dc.prototype.isEmpty=function(){return this.empty()};dc.prototype.search=function(t){return this.array_.indexOf(t)};dc.prototype.size=function(){return this.array_.length};dc.prototype.toArray=function(){for(var t=this,e=[],n=0,r=this.array_.length;n<r;n++)e.push(t.array_[n]);return e};var Wl=function(){this._minIndex=-1,this._minCoord=null,this._minDe=null,this._orientedDe=null};Wl.prototype.getCoordinate=function(){return this._minCoord};Wl.prototype.getRightmostSide=function(t,e){var n=this.getRightmostSideOfSegment(t,e);return n<0&&(n=this.getRightmostSideOfSegment(t,e-1)),n<0&&(this._minCoord=null,this.checkForRightmostCoordinate(t)),n};Wl.prototype.findRightmostEdgeAtVertex=function(){var t=this._minDe.getEdge().getCoordinates();fn.isTrue(this._minIndex>0&&this._minIndex<t.length,"rightmost point expected to be interior vertex of edge");var e=t[this._minIndex-1],n=t[this._minIndex+1],r=Se.computeOrientation(this._minCoord,n,e),i=!1;(e.y<this._minCoord.y&&n.y<this._minCoord.y&&r===Se.COUNTERCLOCKWISE||e.y>this._minCoord.y&&n.y>this._minCoord.y&&r===Se.CLOCKWISE)&&(i=!0),i&&(this._minIndex=this._minIndex-1)};Wl.prototype.getRightmostSideOfSegment=function(t,e){var n=t.getEdge(),r=n.getCoordinates();if(e<0||e+1>=r.length||r[e].y===r[e+1].y)return-1;var i=ie.LEFT;return r[e].y<r[e+1].y&&(i=ie.RIGHT),i};Wl.prototype.getEdge=function(){return this._orientedDe};Wl.prototype.checkForRightmostCoordinate=function(t){for(var e=this,n=t.getEdge().getCoordinates(),r=0;r<n.length-1;r++)(e._minCoord===null||n[r].x>e._minCoord.x)&&(e._minDe=t,e._minIndex=r,e._minCoord=n[r])};Wl.prototype.findRightmostEdgeAtNode=function(){var t=this._minDe.getNode(),e=t.getEdges();this._minDe=e.getRightmostEdge(),this._minDe.isForward()||(this._minDe=this._minDe.getSym(),this._minIndex=this._minDe.getEdge().getCoordinates().length-1)};Wl.prototype.findEdge=function(t){for(var e=this,n=t.iterator();n.hasNext();){var r=n.next();r.isForward()&&e.checkForRightmostCoordinate(r)}fn.isTrue(this._minIndex!==0||this._minCoord.equals(this._minDe.getCoordinate()),"inconsistency in rightmost processing"),this._minIndex===0?this.findRightmostEdgeAtNode():this.findRightmostEdgeAtVertex(),this._orientedDe=this._minDe;var i=this.getRightmostSide(this._minDe,this._minIndex);i===ie.LEFT&&(this._orientedDe=this._minDe.getSym())};Wl.prototype.interfaces_=function(){return[]};Wl.prototype.getClass=function(){return Wl};var Ah=function(t){function e(n,r){t.call(this,e.msgWithCoord(n,r)),this.pt=r?new Tt(r):null,this.name="TopologyException"}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.getCoordinate=function(){return this.pt},e.prototype.interfaces_=function(){return[]},e.prototype.getClass=function(){return e},e.msgWithCoord=function(n,r){return r?n:n+" [ "+r+" ]"},e}(Ph),y0=function(){this.array_=[]};y0.prototype.addLast=function(t){this.array_.push(t)};y0.prototype.removeFirst=function(){return this.array_.shift()};y0.prototype.isEmpty=function(){return this.array_.length===0};var Ns=function(){this._finder=null,this._dirEdgeList=new fe,this._nodes=new fe,this._rightMostCoord=null,this._env=null,this._finder=new Wl};Ns.prototype.clearVisitedEdges=function(){for(var t=this._dirEdgeList.iterator();t.hasNext();){var e=t.next();e.setVisited(!1)}};Ns.prototype.getRightmostCoordinate=function(){return this._rightMostCoord};Ns.prototype.computeNodeDepth=function(t){for(var e=this,n=null,r=t.getEdges().iterator();r.hasNext();){var i=r.next();if(i.isVisited()||i.getSym().isVisited()){n=i;break}}if(n===null)throw new Ah("unable to find edge to compute depths at "+t.getCoordinate());t.getEdges().computeDepths(n);for(var a=t.getEdges().iterator();a.hasNext();){var h=a.next();h.setVisited(!0),e.copySymDepths(h)}};Ns.prototype.computeDepth=function(t){this.clearVisitedEdges();var e=this._finder.getEdge();e.setEdgeDepths(ie.RIGHT,t),this.copySymDepths(e),this.computeDepths(e)};Ns.prototype.create=function(t){this.addReachable(t),this._finder.findEdge(this._dirEdgeList),this._rightMostCoord=this._finder.getCoordinate()};Ns.prototype.findResultEdges=function(){for(var t=this._dirEdgeList.iterator();t.hasNext();){var e=t.next();e.getDepth(ie.RIGHT)>=1&&e.getDepth(ie.LEFT)<=0&&!e.isInteriorAreaEdge()&&e.setInResult(!0)}};Ns.prototype.computeDepths=function(t){var e=this,n=new Eb,r=new y0,i=t.getNode();for(r.addLast(i),n.add(i),t.setVisited(!0);!r.isEmpty();){var a=r.removeFirst();n.add(a),e.computeNodeDepth(a);for(var h=a.getEdges().iterator();h.hasNext();){var u=h.next(),_=u.getSym();if(!_.isVisited()){var w=_.getNode();n.contains(w)||(r.addLast(w),n.add(w))}}}};Ns.prototype.compareTo=function(t){var e=t;return this._rightMostCoord.x<e._rightMostCoord.x?-1:this._rightMostCoord.x>e._rightMostCoord.x?1:0};Ns.prototype.getEnvelope=function(){if(this._env===null){for(var t=new Be,e=this._dirEdgeList.iterator();e.hasNext();)for(var n=e.next(),r=n.getEdge().getCoordinates(),i=0;i<r.length-1;i++)t.expandToInclude(r[i]);this._env=t}return this._env};Ns.prototype.addReachable=function(t){var e=this,n=new dc;for(n.add(t);!n.empty();){var r=n.pop();e.add(r,n)}};Ns.prototype.copySymDepths=function(t){var e=t.getSym();e.setDepth(ie.LEFT,t.getDepth(ie.RIGHT)),e.setDepth(ie.RIGHT,t.getDepth(ie.LEFT))};Ns.prototype.add=function(t,e){var n=this;t.setVisited(!0),this._nodes.add(t);for(var r=t.getEdges().iterator();r.hasNext();){var i=r.next();n._dirEdgeList.add(i);var a=i.getSym(),h=a.getNode();h.isVisited()||e.push(h)}};Ns.prototype.getNodes=function(){return this._nodes};Ns.prototype.getDirectedEdges=function(){return this._dirEdgeList};Ns.prototype.interfaces_=function(){return[Tu]};Ns.prototype.getClass=function(){return Ns};var Tr=function t(){var e=this;if(this.location=null,arguments.length===1){if(arguments[0]instanceof Array){var n=arguments[0];this.init(n.length)}else if(Number.isInteger(arguments[0])){var r=arguments[0];this.init(1),this.location[ie.ON]=r}else if(arguments[0]instanceof t){var i=arguments[0];if(this.init(i.location.length),i!==null)for(var a=0;a<this.location.length;a++)e.location[a]=i.location[a]}}else if(arguments.length===3){var h=arguments[0],u=arguments[1],_=arguments[2];this.init(3),this.location[ie.ON]=h,this.location[ie.LEFT]=u,this.location[ie.RIGHT]=_}};Tr.prototype.setAllLocations=function(t){for(var e=this,n=0;n<this.location.length;n++)e.location[n]=t};Tr.prototype.isNull=function(){for(var t=this,e=0;e<this.location.length;e++)if(t.location[e]!==Pt.NONE)return!1;return!0};Tr.prototype.setAllLocationsIfNull=function(t){for(var e=this,n=0;n<this.location.length;n++)e.location[n]===Pt.NONE&&(e.location[n]=t)};Tr.prototype.isLine=function(){return this.location.length===1};Tr.prototype.merge=function(t){var e=this;if(t.location.length>this.location.length){var n=new Array(3).fill(null);n[ie.ON]=this.location[ie.ON],n[ie.LEFT]=Pt.NONE,n[ie.RIGHT]=Pt.NONE,this.location=n}for(var r=0;r<this.location.length;r++)e.location[r]===Pt.NONE&&r<t.location.length&&(e.location[r]=t.location[r])};Tr.prototype.getLocations=function(){return this.location};Tr.prototype.flip=function(){if(this.location.length<=1)return null;var t=this.location[ie.LEFT];this.location[ie.LEFT]=this.location[ie.RIGHT],this.location[ie.RIGHT]=t};Tr.prototype.toString=function(){var t=new fc;return this.location.length>1&&t.append(Pt.toLocationSymbol(this.location[ie.LEFT])),t.append(Pt.toLocationSymbol(this.location[ie.ON])),this.location.length>1&&t.append(Pt.toLocationSymbol(this.location[ie.RIGHT])),t.toString()};Tr.prototype.setLocations=function(t,e,n){this.location[ie.ON]=t,this.location[ie.LEFT]=e,this.location[ie.RIGHT]=n};Tr.prototype.get=function(t){return t<this.location.length?this.location[t]:Pt.NONE};Tr.prototype.isArea=function(){return this.location.length>1};Tr.prototype.isAnyNull=function(){for(var t=this,e=0;e<this.location.length;e++)if(t.location[e]===Pt.NONE)return!0;return!1};Tr.prototype.setLocation=function(){if(arguments.length===1){var t=arguments[0];this.setLocation(ie.ON,t)}else if(arguments.length===2){var e=arguments[0],n=arguments[1];this.location[e]=n}};Tr.prototype.init=function(t){this.location=new Array(t).fill(null),this.setAllLocations(Pt.NONE)};Tr.prototype.isEqualOnSide=function(t,e){return this.location[e]===t.location[e]};Tr.prototype.allPositionsEqual=function(t){for(var e=this,n=0;n<this.location.length;n++)if(e.location[n]!==t)return!1;return!0};Tr.prototype.interfaces_=function(){return[]};Tr.prototype.getClass=function(){return Tr};var pr=function t(){if(this.elt=new Array(2).fill(null),arguments.length===1){if(Number.isInteger(arguments[0])){var e=arguments[0];this.elt[0]=new Tr(e),this.elt[1]=new Tr(e)}else if(arguments[0]instanceof t){var n=arguments[0];this.elt[0]=new Tr(n.elt[0]),this.elt[1]=new Tr(n.elt[1])}}else if(arguments.length===2){var r=arguments[0],i=arguments[1];this.elt[0]=new Tr(Pt.NONE),this.elt[1]=new Tr(Pt.NONE),this.elt[r].setLocation(i)}else if(arguments.length===3){var a=arguments[0],h=arguments[1],u=arguments[2];this.elt[0]=new Tr(a,h,u),this.elt[1]=new Tr(a,h,u)}else if(arguments.length===4){var _=arguments[0],w=arguments[1],C=arguments[2],P=arguments[3];this.elt[0]=new Tr(Pt.NONE,Pt.NONE,Pt.NONE),this.elt[1]=new Tr(Pt.NONE,Pt.NONE,Pt.NONE),this.elt[_].setLocations(w,C,P)}};pr.prototype.getGeometryCount=function(){var t=0;return this.elt[0].isNull()||t++,this.elt[1].isNull()||t++,t};pr.prototype.setAllLocations=function(t,e){this.elt[t].setAllLocations(e)};pr.prototype.isNull=function(t){return this.elt[t].isNull()};pr.prototype.setAllLocationsIfNull=function(){if(arguments.length===1){var t=arguments[0];this.setAllLocationsIfNull(0,t),this.setAllLocationsIfNull(1,t)}else if(arguments.length===2){var e=arguments[0],n=arguments[1];this.elt[e].setAllLocationsIfNull(n)}};pr.prototype.isLine=function(t){return this.elt[t].isLine()};pr.prototype.merge=function(t){for(var e=this,n=0;n<2;n++)e.elt[n]===null&&t.elt[n]!==null?e.elt[n]=new Tr(t.elt[n]):e.elt[n].merge(t.elt[n])};pr.prototype.flip=function(){this.elt[0].flip(),this.elt[1].flip()};pr.prototype.getLocation=function(){if(arguments.length===1){var t=arguments[0];return this.elt[t].get(ie.ON)}else if(arguments.length===2){var e=arguments[0],n=arguments[1];return this.elt[e].get(n)}};pr.prototype.toString=function(){var t=new fc;return this.elt[0]!==null&&(t.append("A:"),t.append(this.elt[0].toString())),this.elt[1]!==null&&(t.append(" B:"),t.append(this.elt[1].toString())),t.toString()};pr.prototype.isArea=function(){if(arguments.length===0)return this.elt[0].isArea()||this.elt[1].isArea();if(arguments.length===1){var t=arguments[0];return this.elt[t].isArea()}};pr.prototype.isAnyNull=function(t){return this.elt[t].isAnyNull()};pr.prototype.setLocation=function(){if(arguments.length===2){var t=arguments[0],e=arguments[1];this.elt[t].setLocation(ie.ON,e)}else if(arguments.length===3){var n=arguments[0],r=arguments[1],i=arguments[2];this.elt[n].setLocation(r,i)}};pr.prototype.isEqualOnSide=function(t,e){return this.elt[0].isEqualOnSide(t.elt[0],e)&&this.elt[1].isEqualOnSide(t.elt[1],e)};pr.prototype.allPositionsEqual=function(t,e){return this.elt[t].allPositionsEqual(e)};pr.prototype.toLine=function(t){this.elt[t].isArea()&&(this.elt[t]=new Tr(this.elt[t].location[0]))};pr.prototype.interfaces_=function(){return[]};pr.prototype.getClass=function(){return pr};pr.toLineLabel=function(t){for(var e=new pr(Pt.NONE),n=0;n<2;n++)e.setLocation(n,t.getLocation(n));return e};var zi=function(){this._startDe=null,this._maxNodeDegree=-1,this._edges=new fe,this._pts=new fe,this._label=new pr(Pt.NONE),this._ring=null,this._isHole=null,this._shell=null,this._holes=new fe,this._geometryFactory=null;var t=arguments[0],e=arguments[1];this._geometryFactory=e,this.computePoints(t),this.computeRing()};zi.prototype.computeRing=function(){var t=this;if(this._ring!==null)return null;for(var e=new Array(this._pts.size()).fill(null),n=0;n<this._pts.size();n++)e[n]=t._pts.get(n);this._ring=this._geometryFactory.createLinearRing(e),this._isHole=Se.isCCW(this._ring.getCoordinates())};zi.prototype.isIsolated=function(){return this._label.getGeometryCount()===1};zi.prototype.computePoints=function(t){var e=this;this._startDe=t;var n=t,r=!0;do{if(n===null)throw new Ah("Found null DirectedEdge");if(n.getEdgeRing()===e)throw new Ah("Directed Edge visited twice during ring-building at "+n.getCoordinate());e._edges.add(n);var i=n.getLabel();fn.isTrue(i.isArea()),e.mergeLabel(i),e.addPoints(n.getEdge(),n.isForward(),r),r=!1,e.setEdgeRing(n,e),n=e.getNext(n)}while(n!==this._startDe)};zi.prototype.getLinearRing=function(){return this._ring};zi.prototype.getCoordinate=function(t){return this._pts.get(t)};zi.prototype.computeMaxNodeDegree=function(){var t=this;this._maxNodeDegree=0;var e=this._startDe;do{var n=e.getNode(),r=n.getEdges().getOutgoingDegree(t);r>t._maxNodeDegree&&(t._maxNodeDegree=r),e=t.getNext(e)}while(e!==this._startDe);this._maxNodeDegree*=2};zi.prototype.addPoints=function(t,e,n){var r=this,i=t.getCoordinates();if(e){var a=1;n&&(a=0);for(var h=a;h<i.length;h++)r._pts.add(i[h])}else{var u=i.length-2;n&&(u=i.length-1);for(var _=u;_>=0;_--)r._pts.add(i[_])}};zi.prototype.isHole=function(){return this._isHole};zi.prototype.setInResult=function(){var t=this._startDe;do t.getEdge().setInResult(!0),t=t.getNext();while(t!==this._startDe)};zi.prototype.containsPoint=function(t){var e=this.getLinearRing(),n=e.getEnvelopeInternal();if(!n.contains(t)||!Se.isPointInRing(t,e.getCoordinates()))return!1;for(var r=this._holes.iterator();r.hasNext();){var i=r.next();if(i.containsPoint(t))return!1}return!0};zi.prototype.addHole=function(t){this._holes.add(t)};zi.prototype.isShell=function(){return this._shell===null};zi.prototype.getLabel=function(){return this._label};zi.prototype.getEdges=function(){return this._edges};zi.prototype.getMaxNodeDegree=function(){return this._maxNodeDegree<0&&this.computeMaxNodeDegree(),this._maxNodeDegree};zi.prototype.getShell=function(){return this._shell};zi.prototype.mergeLabel=function(){if(arguments.length===1){var t=arguments[0];this.mergeLabel(t,0),this.mergeLabel(t,1)}else if(arguments.length===2){var e=arguments[0],n=arguments[1],r=e.getLocation(n,ie.RIGHT);if(r===Pt.NONE)return null;if(this._label.getLocation(n)===Pt.NONE)return this._label.setLocation(n,r),null}};zi.prototype.setShell=function(t){this._shell=t,t!==null&&t.addHole(this)};zi.prototype.toPolygon=function(t){for(var e=this,n=new Array(this._holes.size()).fill(null),r=0;r<this._holes.size();r++)n[r]=e._holes.get(r).getLinearRing();var i=t.createPolygon(this.getLinearRing(),n);return i};zi.prototype.interfaces_=function(){return[]};zi.prototype.getClass=function(){return zi};var aA=function(t){function e(){var n=arguments[0],r=arguments[1];t.call(this,n,r)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.setEdgeRing=function(n,r){n.setMinEdgeRing(r)},e.prototype.getNext=function(n){return n.getNextMin()},e.prototype.interfaces_=function(){return[]},e.prototype.getClass=function(){return e},e}(zi),uA=function(t){function e(){var n=arguments[0],r=arguments[1];t.call(this,n,r)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.buildMinimalRings=function(){var n=this,r=new fe,i=this._startDe;do{if(i.getMinEdgeRing()===null){var a=new aA(i,n._geometryFactory);r.add(a)}i=i.getNext()}while(i!==this._startDe);return r},e.prototype.setEdgeRing=function(n,r){n.setEdgeRing(r)},e.prototype.linkDirectedEdgesForMinimalEdgeRings=function(){var n=this,r=this._startDe;do{var i=r.getNode();i.getEdges().linkMinimalDirectedEdges(n),r=r.getNext()}while(r!==this._startDe)},e.prototype.getNext=function(n){return n.getNext()},e.prototype.interfaces_=function(){return[]},e.prototype.getClass=function(){return e},e}(zi),Za=function(){if(this._label=null,this._isInResult=!1,this._isCovered=!1,this._isCoveredSet=!1,this._isVisited=!1,arguments.length!==0&&arguments.length===1){var t=arguments[0];this._label=t}};Za.prototype.setVisited=function(t){this._isVisited=t};Za.prototype.setInResult=function(t){this._isInResult=t};Za.prototype.isCovered=function(){return this._isCovered};Za.prototype.isCoveredSet=function(){return this._isCoveredSet};Za.prototype.setLabel=function(t){this._label=t};Za.prototype.getLabel=function(){return this._label};Za.prototype.setCovered=function(t){this._isCovered=t,this._isCoveredSet=!0};Za.prototype.updateIM=function(t){fn.isTrue(this._label.getGeometryCount()>=2,"found partial label"),this.computeIM(t)};Za.prototype.isInResult=function(){return this._isInResult};Za.prototype.isVisited=function(){return this._isVisited};Za.prototype.interfaces_=function(){return[]};Za.prototype.getClass=function(){return Za};var _0=function(t){function e(){t.call(this),this._coord=null,this._edges=null;var n=arguments[0],r=arguments[1];this._coord=n,this._edges=r,this._label=new pr(0,Pt.NONE)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.isIncidentEdgeInResult=function(){for(var n=this.getEdges().getEdges().iterator();n.hasNext();){var r=n.next();if(r.getEdge().isInResult())return!0}return!1},e.prototype.isIsolated=function(){return this._label.getGeometryCount()===1},e.prototype.getCoordinate=function(){return this._coord},e.prototype.print=function(n){n.println("node "+this._coord+" lbl: "+this._label)},e.prototype.computeIM=function(n){},e.prototype.computeMergedLocation=function(n,r){var i=Pt.NONE;if(i=this._label.getLocation(r),!n.isNull(r)){var a=n.getLocation(r);i!==Pt.BOUNDARY&&(i=a)}return i},e.prototype.setLabel=function(){if(arguments.length===2){var n=arguments[0],r=arguments[1];this._label===null?this._label=new pr(n,r):this._label.setLocation(n,r)}else return t.prototype.setLabel.apply(this,arguments)},e.prototype.getEdges=function(){return this._edges},e.prototype.mergeLabel=function(){var n=this;if(arguments[0]instanceof e){var r=arguments[0];this.mergeLabel(r._label)}else if(arguments[0]instanceof pr)for(var i=arguments[0],a=0;a<2;a++){var h=n.computeMergedLocation(i,a),u=n._label.getLocation(a);u===Pt.NONE&&n._label.setLocation(a,h)}},e.prototype.add=function(n){this._edges.insert(n),n.setNode(this)},e.prototype.setLabelBoundary=function(n){if(this._label===null)return null;var r=Pt.NONE;this._label!==null&&(r=this._label.getLocation(n));var i=null;switch(r){case Pt.BOUNDARY:i=Pt.INTERIOR;break;case Pt.INTERIOR:i=Pt.BOUNDARY;break;default:i=Pt.BOUNDARY;break}this._label.setLocation(n,i)},e.prototype.interfaces_=function(){return[]},e.prototype.getClass=function(){return e},e}(Za),Jl=function(){this.nodeMap=new Qo,this.nodeFact=null;var t=arguments[0];this.nodeFact=t};Jl.prototype.find=function(t){return this.nodeMap.get(t)};Jl.prototype.addNode=function(){if(arguments[0]instanceof Tt){var t=arguments[0],e=this.nodeMap.get(t);return e===null&&(e=this.nodeFact.createNode(t),this.nodeMap.put(t,e)),e}else if(arguments[0]instanceof _0){var n=arguments[0],r=this.nodeMap.get(n.getCoordinate());return r===null?(this.nodeMap.put(n.getCoordinate(),n),n):(r.mergeLabel(n),r)}};Jl.prototype.print=function(t){for(var e=this.iterator();e.hasNext();){var n=e.next();n.print(t)}};Jl.prototype.iterator=function(){return this.nodeMap.values().iterator()};Jl.prototype.values=function(){return this.nodeMap.values()};Jl.prototype.getBoundaryNodes=function(t){for(var e=new fe,n=this.iterator();n.hasNext();){var r=n.next();r.getLabel().getLocation(t)===Pt.BOUNDARY&&e.add(r)}return e};Jl.prototype.add=function(t){var e=t.getCoordinate(),n=this.addNode(e);n.add(t)};Jl.prototype.interfaces_=function(){return[]};Jl.prototype.getClass=function(){return Jl};var dr=function(){},E_={NE:{configurable:!0},NW:{configurable:!0},SW:{configurable:!0},SE:{configurable:!0}};dr.prototype.interfaces_=function(){return[]};dr.prototype.getClass=function(){return dr};dr.isNorthern=function(t){return t===dr.NE||t===dr.NW};dr.isOpposite=function(t,e){if(t===e)return!1;var n=(t-e+4)%4;return n===2};dr.commonHalfPlane=function(t,e){if(t===e)return t;var n=(t-e+4)%4;if(n===2)return-1;var r=t<e?t:e,i=t>e?t:e;return r===0&&i===3?3:r};dr.isInHalfPlane=function(t,e){return e===dr.SE?t===dr.SE||t===dr.SW:t===e||t===e+1};dr.quadrant=function(){if(typeof arguments[0]=="number"&&typeof arguments[1]=="number"){var t=arguments[0],e=arguments[1];if(t===0&&e===0)throw new Xr("Cannot compute the quadrant for point ( "+t+", "+e+" )");return t>=0?e>=0?dr.NE:dr.SE:e>=0?dr.NW:dr.SW}else if(arguments[0]instanceof Tt&&arguments[1]instanceof Tt){var n=arguments[0],r=arguments[1];if(r.x===n.x&&r.y===n.y)throw new Xr("Cannot compute the quadrant for two identical points "+n);return r.x>=n.x?r.y>=n.y?dr.NE:dr.SE:r.y>=n.y?dr.NW:dr.SW}};E_.NE.get=function(){return 0};E_.NW.get=function(){return 1};E_.SW.get=function(){return 2};E_.SE.get=function(){return 3};Object.defineProperties(dr,E_);var ts=function(){if(this._edge=null,this._label=null,this._node=null,this._p0=null,this._p1=null,this._dx=null,this._dy=null,this._quadrant=null,arguments.length===1){var t=arguments[0];this._edge=t}else if(arguments.length===3){var e=arguments[0],n=arguments[1],r=arguments[2],i=null;this._edge=e,this.init(n,r),this._label=i}else if(arguments.length===4){var a=arguments[0],h=arguments[1],u=arguments[2],_=arguments[3];this._edge=a,this.init(h,u),this._label=_}};ts.prototype.compareDirection=function(t){return this._dx===t._dx&&this._dy===t._dy?0:this._quadrant>t._quadrant?1:this._quadrant<t._quadrant?-1:Se.computeOrientation(t._p0,t._p1,this._p1)};ts.prototype.getDy=function(){return this._dy};ts.prototype.getCoordinate=function(){return this._p0};ts.prototype.setNode=function(t){this._node=t};ts.prototype.print=function(t){var e=Math.atan2(this._dy,this._dx),n=this.getClass().getName(),r=n.lastIndexOf("."),i=n.substring(r+1);t.print("  "+i+": "+this._p0+" - "+this._p1+" "+this._quadrant+":"+e+"   "+this._label)};ts.prototype.compareTo=function(t){var e=t;return this.compareDirection(e)};ts.prototype.getDirectedCoordinate=function(){return this._p1};ts.prototype.getDx=function(){return this._dx};ts.prototype.getLabel=function(){return this._label};ts.prototype.getEdge=function(){return this._edge};ts.prototype.getQuadrant=function(){return this._quadrant};ts.prototype.getNode=function(){return this._node};ts.prototype.toString=function(){var t=Math.atan2(this._dy,this._dx),e=this.getClass().getName(),n=e.lastIndexOf("."),r=e.substring(n+1);return"  "+r+": "+this._p0+" - "+this._p1+" "+this._quadrant+":"+t+"   "+this._label};ts.prototype.computeLabel=function(t){};ts.prototype.init=function(t,e){this._p0=t,this._p1=e,this._dx=e.x-t.x,this._dy=e.y-t.y,this._quadrant=dr.quadrant(this._dx,this._dy),fn.isTrue(!(this._dx===0&&this._dy===0),"EdgeEnd with identical endpoints found")};ts.prototype.interfaces_=function(){return[Tu]};ts.prototype.getClass=function(){return ts};var Qx=function(t){function e(){var n=arguments[0],r=arguments[1];if(t.call(this,n),this._isForward=null,this._isInResult=!1,this._isVisited=!1,this._sym=null,this._next=null,this._nextMin=null,this._edgeRing=null,this._minEdgeRing=null,this._depth=[0,-999,-999],this._isForward=r,r)this.init(n.getCoordinate(0),n.getCoordinate(1));else{var i=n.getNumPoints()-1;this.init(n.getCoordinate(i),n.getCoordinate(i-1))}this.computeDirectedLabel()}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.getNextMin=function(){return this._nextMin},e.prototype.getDepth=function(n){return this._depth[n]},e.prototype.setVisited=function(n){this._isVisited=n},e.prototype.computeDirectedLabel=function(){this._label=new pr(this._edge.getLabel()),this._isForward||this._label.flip()},e.prototype.getNext=function(){return this._next},e.prototype.setDepth=function(n,r){if(this._depth[n]!==-999&&this._depth[n]!==r)throw new Ah("assigned depths do not match",this.getCoordinate());this._depth[n]=r},e.prototype.isInteriorAreaEdge=function(){for(var n=this,r=!0,i=0;i<2;i++)n._label.isArea(i)&&n._label.getLocation(i,ie.LEFT)===Pt.INTERIOR&&n._label.getLocation(i,ie.RIGHT)===Pt.INTERIOR||(r=!1);return r},e.prototype.setNextMin=function(n){this._nextMin=n},e.prototype.print=function(n){t.prototype.print.call(this,n),n.print(" "+this._depth[ie.LEFT]+"/"+this._depth[ie.RIGHT]),n.print(" ("+this.getDepthDelta()+")"),this._isInResult&&n.print(" inResult")},e.prototype.setMinEdgeRing=function(n){this._minEdgeRing=n},e.prototype.isLineEdge=function(){var n=this._label.isLine(0)||this._label.isLine(1),r=!this._label.isArea(0)||this._label.allPositionsEqual(0,Pt.EXTERIOR),i=!this._label.isArea(1)||this._label.allPositionsEqual(1,Pt.EXTERIOR);return n&&r&&i},e.prototype.setEdgeRing=function(n){this._edgeRing=n},e.prototype.getMinEdgeRing=function(){return this._minEdgeRing},e.prototype.getDepthDelta=function(){var n=this._edge.getDepthDelta();return this._isForward||(n=-n),n},e.prototype.setInResult=function(n){this._isInResult=n},e.prototype.getSym=function(){return this._sym},e.prototype.isForward=function(){return this._isForward},e.prototype.getEdge=function(){return this._edge},e.prototype.printEdge=function(n){this.print(n),n.print(" "),this._isForward?this._edge.print(n):this._edge.printReverse(n)},e.prototype.setSym=function(n){this._sym=n},e.prototype.setVisitedEdge=function(n){this.setVisited(n),this._sym.setVisited(n)},e.prototype.setEdgeDepths=function(n,r){var i=this.getEdge().getDepthDelta();this._isForward||(i=-i);var a=1;n===ie.LEFT&&(a=-1);var h=ie.opposite(n),u=i*a,_=r+u;this.setDepth(n,r),this.setDepth(h,_)},e.prototype.getEdgeRing=function(){return this._edgeRing},e.prototype.isInResult=function(){return this._isInResult},e.prototype.setNext=function(n){this._next=n},e.prototype.isVisited=function(){return this._isVisited},e.prototype.interfaces_=function(){return[]},e.prototype.getClass=function(){return e},e.depthFactor=function(n,r){return n===Pt.EXTERIOR&&r===Pt.INTERIOR?1:n===Pt.INTERIOR&&r===Pt.EXTERIOR?-1:0},e}(ts),Kg=function(){};Kg.prototype.createNode=function(t){return new _0(t,null)};Kg.prototype.interfaces_=function(){return[]};Kg.prototype.getClass=function(){return Kg};var Kr=function(){if(this._edges=new fe,this._nodes=null,this._edgeEndList=new fe,arguments.length===0)this._nodes=new Jl(new Kg);else if(arguments.length===1){var t=arguments[0];this._nodes=new Jl(t)}};Kr.prototype.printEdges=function(t){var e=this;t.println("Edges:");for(var n=0;n<this._edges.size();n++){t.println("edge "+n+":");var r=e._edges.get(n);r.print(t),r.eiList.print(t)}};Kr.prototype.find=function(t){return this._nodes.find(t)};Kr.prototype.addNode=function(){if(arguments[0]instanceof _0){var t=arguments[0];return this._nodes.addNode(t)}else if(arguments[0]instanceof Tt){var e=arguments[0];return this._nodes.addNode(e)}};Kr.prototype.getNodeIterator=function(){return this._nodes.iterator()};Kr.prototype.linkResultDirectedEdges=function(){for(var t=this._nodes.iterator();t.hasNext();){var e=t.next();e.getEdges().linkResultDirectedEdges()}};Kr.prototype.debugPrintln=function(t){Fo.out.println(t)};Kr.prototype.isBoundaryNode=function(t,e){var n=this._nodes.find(e);if(n===null)return!1;var r=n.getLabel();return r!==null&&r.getLocation(t)===Pt.BOUNDARY};Kr.prototype.linkAllDirectedEdges=function(){for(var t=this._nodes.iterator();t.hasNext();){var e=t.next();e.getEdges().linkAllDirectedEdges()}};Kr.prototype.matchInSameDirection=function(t,e,n,r){return t.equals(n)?Se.computeOrientation(t,e,r)===Se.COLLINEAR&&dr.quadrant(t,e)===dr.quadrant(n,r):!1};Kr.prototype.getEdgeEnds=function(){return this._edgeEndList};Kr.prototype.debugPrint=function(t){Fo.out.print(t)};Kr.prototype.getEdgeIterator=function(){return this._edges.iterator()};Kr.prototype.findEdgeInSameDirection=function(t,e){for(var n=this,r=0;r<this._edges.size();r++){var i=n._edges.get(r),a=i.getCoordinates();if(n.matchInSameDirection(t,e,a[0],a[1])||n.matchInSameDirection(t,e,a[a.length-1],a[a.length-2]))return i}return null};Kr.prototype.insertEdge=function(t){this._edges.add(t)};Kr.prototype.findEdgeEnd=function(t){for(var e=this.getEdgeEnds().iterator();e.hasNext();){var n=e.next();if(n.getEdge()===t)return n}return null};Kr.prototype.addEdges=function(t){for(var e=this,n=t.iterator();n.hasNext();){var r=n.next();e._edges.add(r);var i=new Qx(r,!0),a=new Qx(r,!1);i.setSym(a),a.setSym(i),e.add(i),e.add(a)}};Kr.prototype.add=function(t){this._nodes.add(t),this._edgeEndList.add(t)};Kr.prototype.getNodes=function(){return this._nodes.values()};Kr.prototype.findEdge=function(t,e){for(var n=this,r=0;r<this._edges.size();r++){var i=n._edges.get(r),a=i.getCoordinates();if(t.equals(a[0])&&e.equals(a[1]))return i}return null};Kr.prototype.interfaces_=function(){return[]};Kr.prototype.getClass=function(){return Kr};Kr.linkResultDirectedEdges=function(t){for(var e=t.iterator();e.hasNext();){var n=e.next();n.getEdges().linkResultDirectedEdges()}};var va=function(){this._geometryFactory=null,this._shellList=new fe;var t=arguments[0];this._geometryFactory=t};va.prototype.sortShellsAndHoles=function(t,e,n){for(var r=t.iterator();r.hasNext();){var i=r.next();i.isHole()?n.add(i):e.add(i)}};va.prototype.computePolygons=function(t){for(var e=this,n=new fe,r=t.iterator();r.hasNext();){var i=r.next(),a=i.toPolygon(e._geometryFactory);n.add(a)}return n};va.prototype.placeFreeHoles=function(t,e){for(var n=this,r=e.iterator();r.hasNext();){var i=r.next();if(i.getShell()===null){var a=n.findEdgeRingContaining(i,t);if(a===null)throw new Ah("unable to assign hole to a shell",i.getCoordinate(0));i.setShell(a)}}};va.prototype.buildMinimalEdgeRings=function(t,e,n){for(var r=this,i=new fe,a=t.iterator();a.hasNext();){var h=a.next();if(h.getMaxNodeDegree()>2){h.linkDirectedEdgesForMinimalEdgeRings();var u=h.buildMinimalRings(),_=r.findShell(u);_!==null?(r.placePolygonHoles(_,u),e.add(_)):n.addAll(u)}else i.add(h)}return i};va.prototype.containsPoint=function(t){for(var e=this._shellList.iterator();e.hasNext();){var n=e.next();if(n.containsPoint(t))return!0}return!1};va.prototype.buildMaximalEdgeRings=function(t){for(var e=this,n=new fe,r=t.iterator();r.hasNext();){var i=r.next();if(i.isInResult()&&i.getLabel().isArea()&&i.getEdgeRing()===null){var a=new uA(i,e._geometryFactory);n.add(a),a.setInResult()}}return n};va.prototype.placePolygonHoles=function(t,e){for(var n=e.iterator();n.hasNext();){var r=n.next();r.isHole()&&r.setShell(t)}};va.prototype.getPolygons=function(){var t=this.computePolygons(this._shellList);return t};va.prototype.findEdgeRingContaining=function(t,e){for(var n=t.getLinearRing(),r=n.getEnvelopeInternal(),i=n.getCoordinateN(0),a=null,h=null,u=e.iterator();u.hasNext();){var _=u.next(),w=_.getLinearRing(),C=w.getEnvelopeInternal();a!==null&&(h=a.getLinearRing().getEnvelopeInternal());var P=!1;C.contains(r)&&Se.isPointInRing(i,w.getCoordinates())&&(P=!0),P&&(a===null||h.contains(C))&&(a=_)}return a};va.prototype.findShell=function(t){for(var e=0,n=null,r=t.iterator();r.hasNext();){var i=r.next();i.isHole()||(n=i,e++)}return fn.isTrue(e<=1,"found two shells in MinimalEdgeRing list"),n};va.prototype.add=function(){if(arguments.length===1){var t=arguments[0];this.add(t.getEdgeEnds(),t.getNodes())}else if(arguments.length===2){var e=arguments[0],n=arguments[1];Kr.linkResultDirectedEdges(n);var r=this.buildMaximalEdgeRings(e),i=new fe,a=this.buildMinimalEdgeRings(r,this._shellList,i);this.sortShellsAndHoles(a,this._shellList,i),this.placeFreeHoles(this._shellList,i)}};va.prototype.interfaces_=function(){return[]};va.prototype.getClass=function(){return va};var Qg=function(){};Qg.prototype.getBounds=function(){};Qg.prototype.interfaces_=function(){return[]};Qg.prototype.getClass=function(){return Qg};var Wu=function(){this._bounds=null,this._item=null;var t=arguments[0],e=arguments[1];this._bounds=t,this._item=e};Wu.prototype.getItem=function(){return this._item};Wu.prototype.getBounds=function(){return this._bounds};Wu.prototype.interfaces_=function(){return[Qg,Lu]};Wu.prototype.getClass=function(){return Wu};var Dh=function(){this._size=null,this._items=null,this._size=0,this._items=new fe,this._items.add(null)};Dh.prototype.poll=function(){if(this.isEmpty())return null;var t=this._items.get(1);return this._items.set(1,this._items.get(this._size)),this._size-=1,this.reorder(1),t};Dh.prototype.size=function(){return this._size};Dh.prototype.reorder=function(t){for(var e=this,n=null,r=this._items.get(t);t*2<=this._size&&(n=t*2,n!==e._size&&e._items.get(n+1).compareTo(e._items.get(n))<0&&n++,e._items.get(n).compareTo(r)<0);t=n)e._items.set(t,e._items.get(n));this._items.set(t,r)};Dh.prototype.clear=function(){this._size=0,this._items.clear()};Dh.prototype.isEmpty=function(){return this._size===0};Dh.prototype.add=function(t){var e=this;this._items.add(null),this._size+=1;var n=this._size;for(this._items.set(0,t);t.compareTo(this._items.get(Math.trunc(n/2)))<0;n/=2)e._items.set(n,e._items.get(Math.trunc(n/2)));this._items.set(n,t)};Dh.prototype.interfaces_=function(){return[]};Dh.prototype.getClass=function(){return Dh};var Lp=function(){};Lp.prototype.visitItem=function(t){};Lp.prototype.interfaces_=function(){return[]};Lp.prototype.getClass=function(){return Lp};var Ad=function(){};Ad.prototype.insert=function(t,e){};Ad.prototype.remove=function(t,e){};Ad.prototype.query=function(){};Ad.prototype.interfaces_=function(){return[]};Ad.prototype.getClass=function(){return Ad};var Ki=function(){if(this._childBoundables=new fe,this._bounds=null,this._level=null,arguments.length!==0&&arguments.length===1){var t=arguments[0];this._level=t}},vS={serialVersionUID:{configurable:!0}};Ki.prototype.getLevel=function(){return this._level};Ki.prototype.size=function(){return this._childBoundables.size()};Ki.prototype.getChildBoundables=function(){return this._childBoundables};Ki.prototype.addChildBoundable=function(t){fn.isTrue(this._bounds===null),this._childBoundables.add(t)};Ki.prototype.isEmpty=function(){return this._childBoundables.isEmpty()};Ki.prototype.getBounds=function(){return this._bounds===null&&(this._bounds=this.computeBounds()),this._bounds};Ki.prototype.interfaces_=function(){return[Qg,Lu]};Ki.prototype.getClass=function(){return Ki};vS.serialVersionUID.get=function(){return 6493722185909574e3};Object.defineProperties(Ki,vS);var Ju=function(){};Ju.reverseOrder=function(){return{compare:function(t,e){return e.compareTo(t)}}};Ju.min=function(t){return Ju.sort(t),t.get(0)};Ju.sort=function(t,e){var n=t.toArray();e?Df.sort(n,e):Df.sort(n);for(var r=t.iterator(),i=0,a=n.length;i<a;i++)r.next(),r.set(n[i])};Ju.singletonList=function(t){var e=new fe;return e.add(t),e};var Di=function(){this._boundable1=null,this._boundable2=null,this._distance=null,this._itemDistance=null;var t=arguments[0],e=arguments[1],n=arguments[2];this._boundable1=t,this._boundable2=e,this._itemDistance=n,this._distance=this.distance()};Di.prototype.expandToQueue=function(t,e){var n=Di.isComposite(this._boundable1),r=Di.isComposite(this._boundable2);if(n&&r)return Di.area(this._boundable1)>Di.area(this._boundable2)?(this.expand(this._boundable1,this._boundable2,t,e),null):(this.expand(this._boundable2,this._boundable1,t,e),null);if(n)return this.expand(this._boundable1,this._boundable2,t,e),null;if(r)return this.expand(this._boundable2,this._boundable1,t,e),null;throw new Xr("neither boundable is composite")};Di.prototype.isLeaves=function(){return!(Di.isComposite(this._boundable1)||Di.isComposite(this._boundable2))};Di.prototype.compareTo=function(t){var e=t;return this._distance<e._distance?-1:this._distance>e._distance?1:0};Di.prototype.expand=function(t,e,n,r){for(var i=this,a=t.getChildBoundables(),h=a.iterator();h.hasNext();){var u=h.next(),_=new Di(u,e,i._itemDistance);_.getDistance()<r&&n.add(_)}};Di.prototype.getBoundable=function(t){return t===0?this._boundable1:this._boundable2};Di.prototype.getDistance=function(){return this._distance};Di.prototype.distance=function(){return this.isLeaves()?this._itemDistance.distance(this._boundable1,this._boundable2):this._boundable1.getBounds().distance(this._boundable2.getBounds())};Di.prototype.interfaces_=function(){return[Tu]};Di.prototype.getClass=function(){return Di};Di.area=function(t){return t.getBounds().getArea()};Di.isComposite=function(t){return t instanceof Ki};var xo=function t(){if(this._root=null,this._built=!1,this._itemBoundables=new fe,this._nodeCapacity=null,arguments.length===0){var e=t.DEFAULT_NODE_CAPACITY;this._nodeCapacity=e}else if(arguments.length===1){var n=arguments[0];fn.isTrue(n>1,"Node capacity must be greater than 1"),this._nodeCapacity=n}},v0={IntersectsOp:{configurable:!0},serialVersionUID:{configurable:!0},DEFAULT_NODE_CAPACITY:{configurable:!0}};xo.prototype.getNodeCapacity=function(){return this._nodeCapacity};xo.prototype.lastNode=function(t){return t.get(t.size()-1)};xo.prototype.size=function(){var t=this;if(arguments.length===0)return this.isEmpty()?0:(this.build(),this.size(this._root));if(arguments.length===1){for(var e=arguments[0],n=0,r=e.getChildBoundables().iterator();r.hasNext();){var i=r.next();i instanceof Ki?n+=t.size(i):i instanceof Wu&&(n+=1)}return n}};xo.prototype.removeItem=function(t,e){for(var n=null,r=t.getChildBoundables().iterator();r.hasNext();){var i=r.next();i instanceof Wu&&i.getItem()===e&&(n=i)}return n!==null?(t.getChildBoundables().remove(n),!0):!1};xo.prototype.itemsTree=function(){var t=this;if(arguments.length===0){this.build();var e=this.itemsTree(this._root);return e===null?new fe:e}else if(arguments.length===1){for(var n=arguments[0],r=new fe,i=n.getChildBoundables().iterator();i.hasNext();){var a=i.next();if(a instanceof Ki){var h=t.itemsTree(a);h!==null&&r.add(h)}else a instanceof Wu?r.add(a.getItem()):fn.shouldNeverReachHere()}return r.size()<=0?null:r}};xo.prototype.insert=function(t,e){fn.isTrue(!this._built,"Cannot insert items into an STR packed R-tree after it has been built."),this._itemBoundables.add(new Wu(t,e))};xo.prototype.boundablesAtLevel=function(){var t=this;if(arguments.length===1){var e=arguments[0],n=new fe;return this.boundablesAtLevel(e,this._root,n),n}else if(arguments.length===3){var r=arguments[0],i=arguments[1],a=arguments[2];if(fn.isTrue(r>-2),i.getLevel()===r)return a.add(i),null;for(var h=i.getChildBoundables().iterator();h.hasNext();){var u=h.next();u instanceof Ki?t.boundablesAtLevel(r,u,a):(fn.isTrue(u instanceof Wu),r===-1&&a.add(u))}return null}};xo.prototype.query=function(){var t=this;if(arguments.length===1){var e=arguments[0];this.build();var n=new fe;return this.isEmpty()||this.getIntersectsOp().intersects(this._root.getBounds(),e)&&this.query(e,this._root,n),n}else if(arguments.length===2){var r=arguments[0],i=arguments[1];if(this.build(),this.isEmpty())return null;this.getIntersectsOp().intersects(this._root.getBounds(),r)&&this.query(r,this._root,i)}else if(arguments.length===3){if(tn(arguments[2],Lp)&&arguments[0]instanceof Object&&arguments[1]instanceof Ki)for(var a=arguments[0],h=arguments[1],u=arguments[2],_=h.getChildBoundables(),w=0;w<_.size();w++){var C=_.get(w);t.getIntersectsOp().intersects(C.getBounds(),a)&&(C instanceof Ki?t.query(a,C,u):C instanceof Wu?u.visitItem(C.getItem()):fn.shouldNeverReachHere())}else if(tn(arguments[2],ju)&&arguments[0]instanceof Object&&arguments[1]instanceof Ki)for(var P=arguments[0],D=arguments[1],B=arguments[2],$=D.getChildBoundables(),Z=0;Z<$.size();Z++){var W=$.get(Z);t.getIntersectsOp().intersects(W.getBounds(),P)&&(W instanceof Ki?t.query(P,W,B):W instanceof Wu?B.add(W.getItem()):fn.shouldNeverReachHere())}}};xo.prototype.build=function(){if(this._built)return null;this._root=this._itemBoundables.isEmpty()?this.createNode(0):this.createHigherLevels(this._itemBoundables,-1),this._itemBoundables=null,this._built=!0};xo.prototype.getRoot=function(){return this.build(),this._root};xo.prototype.remove=function(){var t=this;if(arguments.length===2){var e=arguments[0],n=arguments[1];return this.build(),this.getIntersectsOp().intersects(this._root.getBounds(),e)?this.remove(e,this._root,n):!1}else if(arguments.length===3){var r=arguments[0],i=arguments[1],a=arguments[2],h=this.removeItem(i,a);if(h)return!0;for(var u=null,_=i.getChildBoundables().iterator();_.hasNext();){var w=_.next();if(t.getIntersectsOp().intersects(w.getBounds(),r)&&w instanceof Ki&&(h=t.remove(r,w,a),h)){u=w;break}}return u!==null&&u.getChildBoundables().isEmpty()&&i.getChildBoundables().remove(u),h}};xo.prototype.createHigherLevels=function(t,e){fn.isTrue(!t.isEmpty());var n=this.createParentBoundables(t,e+1);return n.size()===1?n.get(0):this.createHigherLevels(n,e+1)};xo.prototype.depth=function(){var t=this;if(arguments.length===0)return this.isEmpty()?0:(this.build(),this.depth(this._root));if(arguments.length===1){for(var e=arguments[0],n=0,r=e.getChildBoundables().iterator();r.hasNext();){var i=r.next();if(i instanceof Ki){var a=t.depth(i);a>n&&(n=a)}}return n+1}};xo.prototype.createParentBoundables=function(t,e){var n=this;fn.isTrue(!t.isEmpty());var r=new fe;r.add(this.createNode(e));var i=new fe(t);Ju.sort(i,this.getComparator());for(var a=i.iterator();a.hasNext();){var h=a.next();n.lastNode(r).getChildBoundables().size()===n.getNodeCapacity()&&r.add(n.createNode(e)),n.lastNode(r).addChildBoundable(h)}return r};xo.prototype.isEmpty=function(){return this._built?this._root.isEmpty():this._itemBoundables.isEmpty()};xo.prototype.interfaces_=function(){return[Lu]};xo.prototype.getClass=function(){return xo};xo.compareDoubles=function(t,e){return t>e?1:t<e?-1:0};v0.IntersectsOp.get=function(){return lA};v0.serialVersionUID.get=function(){return-3886435814360241e3};v0.DEFAULT_NODE_CAPACITY.get=function(){return 10};Object.defineProperties(xo,v0);var lA=function(){},tm=function(){};tm.prototype.distance=function(t,e){};tm.prototype.interfaces_=function(){return[]};tm.prototype.getClass=function(){return tm};var xS=function(t){function e(r){r=r||e.DEFAULT_NODE_CAPACITY,t.call(this,r)}t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e;var n={STRtreeNode:{configurable:!0},serialVersionUID:{configurable:!0},xComparator:{configurable:!0},yComparator:{configurable:!0},intersectsOp:{configurable:!0},DEFAULT_NODE_CAPACITY:{configurable:!0}};return e.prototype.createParentBoundablesFromVerticalSlices=function(r,i){var a=this;fn.isTrue(r.length>0);for(var h=new fe,u=0;u<r.length;u++)h.addAll(a.createParentBoundablesFromVerticalSlice(r[u],i));return h},e.prototype.createNode=function(r){return new $E(r)},e.prototype.size=function(){return arguments.length===0?t.prototype.size.call(this):t.prototype.size.apply(this,arguments)},e.prototype.insert=function(){if(arguments.length===2){var r=arguments[0],i=arguments[1];if(r.isNull())return null;t.prototype.insert.call(this,r,i)}else return t.prototype.insert.apply(this,arguments)},e.prototype.getIntersectsOp=function(){return e.intersectsOp},e.prototype.verticalSlices=function(r,i){for(var a=Math.trunc(Math.ceil(r.size()/i)),h=new Array(i).fill(null),u=r.iterator(),_=0;_<i;_++){h[_]=new fe;for(var w=0;u.hasNext()&&w<a;){var C=u.next();h[_].add(C),w++}}return h},e.prototype.query=function(){if(arguments.length===1){var r=arguments[0];return t.prototype.query.call(this,r)}else if(arguments.length===2){var i=arguments[0],a=arguments[1];t.prototype.query.call(this,i,a)}else if(arguments.length===3){if(tn(arguments[2],Lp)&&arguments[0]instanceof Object&&arguments[1]instanceof Ki){var h=arguments[0],u=arguments[1],_=arguments[2];t.prototype.query.call(this,h,u,_)}else if(tn(arguments[2],ju)&&arguments[0]instanceof Object&&arguments[1]instanceof Ki){var w=arguments[0],C=arguments[1],P=arguments[2];t.prototype.query.call(this,w,C,P)}}},e.prototype.getComparator=function(){return e.yComparator},e.prototype.createParentBoundablesFromVerticalSlice=function(r,i){return t.prototype.createParentBoundables.call(this,r,i)},e.prototype.remove=function(){if(arguments.length===2){var r=arguments[0],i=arguments[1];return t.prototype.remove.call(this,r,i)}else return t.prototype.remove.apply(this,arguments)},e.prototype.depth=function(){return arguments.length===0?t.prototype.depth.call(this):t.prototype.depth.apply(this,arguments)},e.prototype.createParentBoundables=function(r,i){fn.isTrue(!r.isEmpty());var a=Math.trunc(Math.ceil(r.size()/this.getNodeCapacity())),h=new fe(r);Ju.sort(h,e.xComparator);var u=this.verticalSlices(h,Math.trunc(Math.ceil(Math.sqrt(a))));return this.createParentBoundablesFromVerticalSlices(u,i)},e.prototype.nearestNeighbour=function(){if(arguments.length===1){if(tn(arguments[0],tm)){var r=arguments[0],i=new Di(this.getRoot(),this.getRoot(),r);return this.nearestNeighbour(i)}else if(arguments[0]instanceof Di){var a=arguments[0];return this.nearestNeighbour(a,un.POSITIVE_INFINITY)}}else if(arguments.length===2){if(arguments[0]instanceof e&&tn(arguments[1],tm)){var h=arguments[0],u=arguments[1],_=new Di(this.getRoot(),h.getRoot(),u);return this.nearestNeighbour(_)}else if(arguments[0]instanceof Di&&typeof arguments[1]=="number"){var w=arguments[0],C=arguments[1],P=C,D=null,B=new Dh;for(B.add(w);!B.isEmpty()&&P>0;){var $=B.poll(),Z=$.getDistance();if(Z>=P)break;$.isLeaves()?(P=Z,D=$):$.expandToQueue(B,P)}return[D.getBoundable(0).getItem(),D.getBoundable(1).getItem()]}}else if(arguments.length===3){var W=arguments[0],rt=arguments[1],ct=arguments[2],pt=new Wu(W,rt),gt=new Di(this.getRoot(),pt,ct);return this.nearestNeighbour(gt)[0]}},e.prototype.interfaces_=function(){return[Ad,Lu]},e.prototype.getClass=function(){return e},e.centreX=function(r){return e.avg(r.getMinX(),r.getMaxX())},e.avg=function(r,i){return(r+i)/2},e.centreY=function(r){return e.avg(r.getMinY(),r.getMaxY())},n.STRtreeNode.get=function(){return $E},n.serialVersionUID.get=function(){return 0x39920f7d5f261e0},n.xComparator.get=function(){return{interfaces_:function(){return[qg]},compare:function(r,i){return t.compareDoubles(e.centreX(r.getBounds()),e.centreX(i.getBounds()))}}},n.yComparator.get=function(){return{interfaces_:function(){return[qg]},compare:function(r,i){return t.compareDoubles(e.centreY(r.getBounds()),e.centreY(i.getBounds()))}}},n.intersectsOp.get=function(){return{interfaces_:function(){return[t.IntersectsOp]},intersects:function(r,i){return r.intersects(i)}}},n.DEFAULT_NODE_CAPACITY.get=function(){return 10},Object.defineProperties(e,n),e}(xo),$E=function(t){function e(){var n=arguments[0];t.call(this,n)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.computeBounds=function(){for(var n=null,r=this.getChildBoundables().iterator();r.hasNext();){var i=r.next();n===null?n=new Be(i.getBounds()):n.expandToInclude(i.getBounds())}return n},e.prototype.interfaces_=function(){return[]},e.prototype.getClass=function(){return e},e}(Ki),Ys=function(){};Ys.prototype.interfaces_=function(){return[]};Ys.prototype.getClass=function(){return Ys};Ys.relativeSign=function(t,e){return t<e?-1:t>e?1:0};Ys.compare=function(t,e,n){if(e.equals2D(n))return 0;var r=Ys.relativeSign(e.x,n.x),i=Ys.relativeSign(e.y,n.y);switch(t){case 0:return Ys.compareValue(r,i);case 1:return Ys.compareValue(i,r);case 2:return Ys.compareValue(i,-r);case 3:return Ys.compareValue(-r,i);case 4:return Ys.compareValue(-r,-i);case 5:return Ys.compareValue(-i,-r);case 6:return Ys.compareValue(-i,r);case 7:return Ys.compareValue(r,-i)}return fn.shouldNeverReachHere("invalid octant value"),0};Ys.compareValue=function(t,e){return t<0?-1:t>0?1:e<0?-1:e>0?1:0};var Np=function(){this._segString=null,this.coord=null,this.segmentIndex=null,this._segmentOctant=null,this._isInterior=null;var t=arguments[0],e=arguments[1],n=arguments[2],r=arguments[3];this._segString=t,this.coord=new Tt(e),this.segmentIndex=n,this._segmentOctant=r,this._isInterior=!e.equals2D(t.getCoordinate(n))};Np.prototype.getCoordinate=function(){return this.coord};Np.prototype.print=function(t){t.print(this.coord),t.print(" seg # = "+this.segmentIndex)};Np.prototype.compareTo=function(t){var e=t;return this.segmentIndex<e.segmentIndex?-1:this.segmentIndex>e.segmentIndex?1:this.coord.equals2D(e.coord)?0:Ys.compare(this._segmentOctant,this.coord,e.coord)};Np.prototype.isEndPoint=function(t){return this.segmentIndex===0&&!this._isInterior||this.segmentIndex===t};Np.prototype.isInterior=function(){return this._isInterior};Np.prototype.interfaces_=function(){return[Tu]};Np.prototype.getClass=function(){return Np};var Ps=function(){this._nodeMap=new Qo,this._edge=null;var t=arguments[0];this._edge=t};Ps.prototype.getSplitCoordinates=function(){var t=this,e=new b_;this.addEndpoints();for(var n=this.iterator(),r=n.next();n.hasNext();){var i=n.next();t.addEdgeCoordinates(r,i,e),r=i}return e.toCoordinateArray()};Ps.prototype.addCollapsedNodes=function(){var t=this,e=new fe;this.findCollapsesFromInsertedNodes(e),this.findCollapsesFromExistingVertices(e);for(var n=e.iterator();n.hasNext();){var r=n.next().intValue();t.add(t._edge.getCoordinate(r),r)}};Ps.prototype.print=function(t){t.println("Intersections:");for(var e=this.iterator();e.hasNext();){var n=e.next();n.print(t)}};Ps.prototype.findCollapsesFromExistingVertices=function(t){for(var e=this,n=0;n<this._edge.size()-2;n++){var r=e._edge.getCoordinate(n),i=e._edge.getCoordinate(n+2);r.equals2D(i)&&t.add(new Xl(n+1))}};Ps.prototype.addEdgeCoordinates=function(t,e,n){var r=this,i=this._edge.getCoordinate(e.segmentIndex),a=e.isInterior()||!e.coord.equals2D(i);n.add(new Tt(t.coord),!1);for(var h=t.segmentIndex+1;h<=e.segmentIndex;h++)n.add(r._edge.getCoordinate(h));a&&n.add(new Tt(e.coord))};Ps.prototype.iterator=function(){return this._nodeMap.values().iterator()};Ps.prototype.addSplitEdges=function(t){var e=this;this.addEndpoints(),this.addCollapsedNodes();for(var n=this.iterator(),r=n.next();n.hasNext();){var i=n.next(),a=e.createSplitEdge(r,i);t.add(a),r=i}};Ps.prototype.findCollapseIndex=function(t,e,n){if(!t.coord.equals2D(e.coord))return!1;var r=e.segmentIndex-t.segmentIndex;return e.isInterior()||r--,r===1?(n[0]=t.segmentIndex+1,!0):!1};Ps.prototype.findCollapsesFromInsertedNodes=function(t){for(var e=this,n=new Array(1).fill(null),r=this.iterator(),i=r.next();r.hasNext();){var a=r.next(),h=e.findCollapseIndex(i,a,n);h&&t.add(new Xl(n[0])),i=a}};Ps.prototype.getEdge=function(){return this._edge};Ps.prototype.addEndpoints=function(){var t=this._edge.size()-1;this.add(this._edge.getCoordinate(0),0),this.add(this._edge.getCoordinate(t),t)};Ps.prototype.createSplitEdge=function(t,e){var n=this,r=e.segmentIndex-t.segmentIndex+2,i=this._edge.getCoordinate(e.segmentIndex),a=e.isInterior()||!e.coord.equals2D(i);a||r--;var h=new Array(r).fill(null),u=0;h[u++]=new Tt(t.coord);for(var _=t.segmentIndex+1;_<=e.segmentIndex;_++)h[u++]=n._edge.getCoordinate(_);return a&&(h[u]=new Tt(e.coord)),new Ii(h,this._edge.getData())};Ps.prototype.add=function(t,e){var n=new Np(this._edge,t,e,this._edge.getSegmentOctant(e)),r=this._nodeMap.get(n);return r!==null?(fn.isTrue(r.coord.equals2D(t),"Found equal nodes with different coordinates"),r):(this._nodeMap.put(n,n),n)};Ps.prototype.checkSplitEdgesCorrectness=function(t){var e=this._edge.getCoordinates(),n=t.get(0),r=n.getCoordinate(0);if(!r.equals2D(e[0]))throw new Ph("bad split edge start point at "+r);var i=t.get(t.size()-1),a=i.getCoordinates(),h=a[a.length-1];if(!h.equals2D(e[e.length-1]))throw new Ph("bad split edge end point at "+h)};Ps.prototype.interfaces_=function(){return[]};Ps.prototype.getClass=function(){return Ps};var Dd=function(){};Dd.prototype.interfaces_=function(){return[]};Dd.prototype.getClass=function(){return Dd};Dd.octant=function(){if(typeof arguments[0]=="number"&&typeof arguments[1]=="number"){var t=arguments[0],e=arguments[1];if(t===0&&e===0)throw new Xr("Cannot compute the octant for point ( "+t+", "+e+" )");var n=Math.abs(t),r=Math.abs(e);return t>=0?e>=0?n>=r?0:1:n>=r?7:6:e>=0?n>=r?3:2:n>=r?4:5}else if(arguments[0]instanceof Tt&&arguments[1]instanceof Tt){var i=arguments[0],a=arguments[1],h=a.x-i.x,u=a.y-i.y;if(h===0&&u===0)throw new Xr("Cannot compute the octant for two identical points "+i);return Dd.octant(h,u)}};var $c=function(){};$c.prototype.getCoordinates=function(){};$c.prototype.size=function(){};$c.prototype.getCoordinate=function(t){};$c.prototype.isClosed=function(){};$c.prototype.setData=function(t){};$c.prototype.getData=function(){};$c.prototype.interfaces_=function(){return[]};$c.prototype.getClass=function(){return $c};var Yy=function(){};Yy.prototype.addIntersection=function(t,e){};Yy.prototype.interfaces_=function(){return[$c]};Yy.prototype.getClass=function(){return Yy};var Ii=function(){this._nodeList=new Ps(this),this._pts=null,this._data=null;var t=arguments[0],e=arguments[1];this._pts=t,this._data=e};Ii.prototype.getCoordinates=function(){return this._pts};Ii.prototype.size=function(){return this._pts.length};Ii.prototype.getCoordinate=function(t){return this._pts[t]};Ii.prototype.isClosed=function(){return this._pts[0].equals(this._pts[this._pts.length-1])};Ii.prototype.getSegmentOctant=function(t){return t===this._pts.length-1?-1:this.safeOctant(this.getCoordinate(t),this.getCoordinate(t+1))};Ii.prototype.setData=function(t){this._data=t};Ii.prototype.safeOctant=function(t,e){return t.equals2D(e)?0:Dd.octant(t,e)};Ii.prototype.getData=function(){return this._data};Ii.prototype.addIntersection=function(){if(arguments.length===2){var t=arguments[0],e=arguments[1];this.addIntersectionNode(t,e)}else if(arguments.length===4){var n=arguments[0],r=arguments[1],i=arguments[3],a=new Tt(n.getIntersection(i));this.addIntersection(a,r)}};Ii.prototype.toString=function(){return Zu.toLineString(new mi(this._pts))};Ii.prototype.getNodeList=function(){return this._nodeList};Ii.prototype.addIntersectionNode=function(t,e){var n=e,r=n+1;if(r<this._pts.length){var i=this._pts[r];t.equals2D(i)&&(n=r)}var a=this._nodeList.add(t,n);return a};Ii.prototype.addIntersections=function(t,e,n){for(var r=this,i=0;i<t.getIntersectionNum();i++)r.addIntersection(t,e,n,i)};Ii.prototype.interfaces_=function(){return[Yy]};Ii.prototype.getClass=function(){return Ii};Ii.getNodedSubstrings=function(){if(arguments.length===1){var t=arguments[0],e=new fe;return Ii.getNodedSubstrings(t,e),e}else if(arguments.length===2)for(var n=arguments[0],r=arguments[1],i=n.iterator();i.hasNext();){var a=i.next();a.getNodeList().addSplitEdges(r)}};var Ve=function(){if(this.p0=null,this.p1=null,arguments.length===0)this.p0=new Tt,this.p1=new Tt;else if(arguments.length===1){var t=arguments[0];this.p0=new Tt(t.p0),this.p1=new Tt(t.p1)}else if(arguments.length===2)this.p0=arguments[0],this.p1=arguments[1];else if(arguments.length===4){var e=arguments[0],n=arguments[1],r=arguments[2],i=arguments[3];this.p0=new Tt(e,n),this.p1=new Tt(r,i)}},bS={serialVersionUID:{configurable:!0}};Ve.prototype.minX=function(){return Math.min(this.p0.x,this.p1.x)};Ve.prototype.orientationIndex=function(){if(arguments[0]instanceof Ve){var t=arguments[0],e=Se.orientationIndex(this.p0,this.p1,t.p0),n=Se.orientationIndex(this.p0,this.p1,t.p1);return e>=0&&n>=0||e<=0&&n<=0?Math.max(e,n):0}else if(arguments[0]instanceof Tt){var r=arguments[0];return Se.orientationIndex(this.p0,this.p1,r)}};Ve.prototype.toGeometry=function(t){return t.createLineString([this.p0,this.p1])};Ve.prototype.isVertical=function(){return this.p0.x===this.p1.x};Ve.prototype.equals=function(t){if(!(t instanceof Ve))return!1;var e=t;return this.p0.equals(e.p0)&&this.p1.equals(e.p1)};Ve.prototype.intersection=function(t){var e=new ad;return e.computeIntersection(this.p0,this.p1,t.p0,t.p1),e.hasIntersection()?e.getIntersection(0):null};Ve.prototype.project=function(){if(arguments[0]instanceof Tt){var t=arguments[0];if(t.equals(this.p0)||t.equals(this.p1))return new Tt(t);var e=this.projectionFactor(t),n=new Tt;return n.x=this.p0.x+e*(this.p1.x-this.p0.x),n.y=this.p0.y+e*(this.p1.y-this.p0.y),n}else if(arguments[0]instanceof Ve){var r=arguments[0],i=this.projectionFactor(r.p0),a=this.projectionFactor(r.p1);if(i>=1&&a>=1||i<=0&&a<=0)return null;var h=this.project(r.p0);i<0&&(h=this.p0),i>1&&(h=this.p1);var u=this.project(r.p1);return a<0&&(u=this.p0),a>1&&(u=this.p1),new Ve(h,u)}};Ve.prototype.normalize=function(){this.p1.compareTo(this.p0)<0&&this.reverse()};Ve.prototype.angle=function(){return Math.atan2(this.p1.y-this.p0.y,this.p1.x-this.p0.x)};Ve.prototype.getCoordinate=function(t){return t===0?this.p0:this.p1};Ve.prototype.distancePerpendicular=function(t){return Se.distancePointLinePerpendicular(t,this.p0,this.p1)};Ve.prototype.minY=function(){return Math.min(this.p0.y,this.p1.y)};Ve.prototype.midPoint=function(){return Ve.midPoint(this.p0,this.p1)};Ve.prototype.projectionFactor=function(t){if(t.equals(this.p0))return 0;if(t.equals(this.p1))return 1;var e=this.p1.x-this.p0.x,n=this.p1.y-this.p0.y,r=e*e+n*n;if(r<=0)return un.NaN;var i=((t.x-this.p0.x)*e+(t.y-this.p0.y)*n)/r;return i};Ve.prototype.closestPoints=function(t){var e=this.intersection(t);if(e!==null)return[e,e];var n=new Array(2).fill(null),r=un.MAX_VALUE,i=null,a=this.closestPoint(t.p0);r=a.distance(t.p0),n[0]=a,n[1]=t.p0;var h=this.closestPoint(t.p1);i=h.distance(t.p1),i<r&&(r=i,n[0]=h,n[1]=t.p1);var u=t.closestPoint(this.p0);i=u.distance(this.p0),i<r&&(r=i,n[0]=this.p0,n[1]=u);var _=t.closestPoint(this.p1);return i=_.distance(this.p1),i<r&&(r=i,n[0]=this.p1,n[1]=_),n};Ve.prototype.closestPoint=function(t){var e=this.projectionFactor(t);if(e>0&&e<1)return this.project(t);var n=this.p0.distance(t),r=this.p1.distance(t);return n<r?this.p0:this.p1};Ve.prototype.maxX=function(){return Math.max(this.p0.x,this.p1.x)};Ve.prototype.getLength=function(){return this.p0.distance(this.p1)};Ve.prototype.compareTo=function(t){var e=t,n=this.p0.compareTo(e.p0);return n!==0?n:this.p1.compareTo(e.p1)};Ve.prototype.reverse=function(){var t=this.p0;this.p0=this.p1,this.p1=t};Ve.prototype.equalsTopo=function(t){return this.p0.equals(t.p0)&&(this.p1.equals(t.p1)||this.p0.equals(t.p1))&&this.p1.equals(t.p0)};Ve.prototype.lineIntersection=function(t){try{var e=qu.intersection(this.p0,this.p1,t.p0,t.p1);return e}catch(n){if(!(n instanceof Dm))throw n}finally{}return null};Ve.prototype.maxY=function(){return Math.max(this.p0.y,this.p1.y)};Ve.prototype.pointAlongOffset=function(t,e){var n=this.p0.x+t*(this.p1.x-this.p0.x),r=this.p0.y+t*(this.p1.y-this.p0.y),i=this.p1.x-this.p0.x,a=this.p1.y-this.p0.y,h=Math.sqrt(i*i+a*a),u=0,_=0;if(e!==0){if(h<=0)throw new Error("Cannot compute offset from zero-length line segment");u=e*i/h,_=e*a/h}var w=n-_,C=r+u,P=new Tt(w,C);return P};Ve.prototype.setCoordinates=function(){if(arguments.length===1){var t=arguments[0];this.setCoordinates(t.p0,t.p1)}else if(arguments.length===2){var e=arguments[0],n=arguments[1];this.p0.x=e.x,this.p0.y=e.y,this.p1.x=n.x,this.p1.y=n.y}};Ve.prototype.segmentFraction=function(t){var e=this.projectionFactor(t);return e<0?e=0:(e>1||un.isNaN(e))&&(e=1),e};Ve.prototype.toString=function(){return"LINESTRING( "+this.p0.x+" "+this.p0.y+", "+this.p1.x+" "+this.p1.y+")"};Ve.prototype.isHorizontal=function(){return this.p0.y===this.p1.y};Ve.prototype.distance=function(){if(arguments[0]instanceof Ve){var t=arguments[0];return Se.distanceLineLine(this.p0,this.p1,t.p0,t.p1)}else if(arguments[0]instanceof Tt){var e=arguments[0];return Se.distancePointLine(e,this.p0,this.p1)}};Ve.prototype.pointAlong=function(t){var e=new Tt;return e.x=this.p0.x+t*(this.p1.x-this.p0.x),e.y=this.p0.y+t*(this.p1.y-this.p0.y),e};Ve.prototype.hashCode=function(){var t=un.doubleToLongBits(this.p0.x);t^=un.doubleToLongBits(this.p0.y)*31;var e=Math.trunc(t)^Math.trunc(t>>32),n=un.doubleToLongBits(this.p1.x);n^=un.doubleToLongBits(this.p1.y)*31;var r=Math.trunc(n)^Math.trunc(n>>32);return e^r};Ve.prototype.interfaces_=function(){return[Tu,Lu]};Ve.prototype.getClass=function(){return Ve};Ve.midPoint=function(t,e){return new Tt((t.x+e.x)/2,(t.y+e.y)/2)};bS.serialVersionUID.get=function(){return 0x2d2172135f411c00};Object.defineProperties(Ve,bS);var Zy=function(){this.tempEnv1=new Be,this.tempEnv2=new Be,this._overlapSeg1=new Ve,this._overlapSeg2=new Ve};Zy.prototype.overlap=function(){if(arguments.length!==2&&arguments.length===4){var t=arguments[0],e=arguments[1],n=arguments[2],r=arguments[3];t.getLineSegment(e,this._overlapSeg1),n.getLineSegment(r,this._overlapSeg2),this.overlap(this._overlapSeg1,this._overlapSeg2)}};Zy.prototype.interfaces_=function(){return[]};Zy.prototype.getClass=function(){return Zy};var xa=function(){this._pts=null,this._start=null,this._end=null,this._env=null,this._context=null,this._id=null;var t=arguments[0],e=arguments[1],n=arguments[2],r=arguments[3];this._pts=t,this._start=e,this._end=n,this._context=r};xa.prototype.getLineSegment=function(t,e){e.p0=this._pts[t],e.p1=this._pts[t+1]};xa.prototype.computeSelect=function(t,e,n,r){var i=this._pts[e],a=this._pts[n];if(r.tempEnv1.init(i,a),n-e===1)return r.select(this,e),null;if(!t.intersects(r.tempEnv1))return null;var h=Math.trunc((e+n)/2);e<h&&this.computeSelect(t,e,h,r),h<n&&this.computeSelect(t,h,n,r)};xa.prototype.getCoordinates=function(){for(var t=this,e=new Array(this._end-this._start+1).fill(null),n=0,r=this._start;r<=this._end;r++)e[n++]=t._pts[r];return e};xa.prototype.computeOverlaps=function(t,e){this.computeOverlapsInternal(this._start,this._end,t,t._start,t._end,e)};xa.prototype.setId=function(t){this._id=t};xa.prototype.select=function(t,e){this.computeSelect(t,this._start,this._end,e)};xa.prototype.getEnvelope=function(){if(this._env===null){var t=this._pts[this._start],e=this._pts[this._end];this._env=new Be(t,e)}return this._env};xa.prototype.getEndIndex=function(){return this._end};xa.prototype.getStartIndex=function(){return this._start};xa.prototype.getContext=function(){return this._context};xa.prototype.getId=function(){return this._id};xa.prototype.computeOverlapsInternal=function(t,e,n,r,i,a){var h=this._pts[t],u=this._pts[e],_=n._pts[r],w=n._pts[i];if(e-t===1&&i-r===1)return a.overlap(this,t,n,r),null;if(a.tempEnv1.init(h,u),a.tempEnv2.init(_,w),!a.tempEnv1.intersects(a.tempEnv2))return null;var C=Math.trunc((t+e)/2),P=Math.trunc((r+i)/2);t<C&&(r<P&&this.computeOverlapsInternal(t,C,n,r,P,a),P<i&&this.computeOverlapsInternal(t,C,n,P,i,a)),C<e&&(r<P&&this.computeOverlapsInternal(C,e,n,r,P,a),P<i&&this.computeOverlapsInternal(C,e,n,P,i,a))};xa.prototype.interfaces_=function(){return[]};xa.prototype.getClass=function(){return xa};var Gl=function(){};Gl.prototype.interfaces_=function(){return[]};Gl.prototype.getClass=function(){return Gl};Gl.getChainStartIndices=function(t){var e=0,n=new fe;n.add(new Xl(e));do{var r=Gl.findChainEnd(t,e);n.add(new Xl(r)),e=r}while(e<t.length-1);var i=Gl.toIntArray(n);return i};Gl.findChainEnd=function(t,e){for(var n=e;n<t.length-1&&t[n].equals2D(t[n+1]);)n++;if(n>=t.length-1)return t.length-1;for(var r=dr.quadrant(t[n],t[n+1]),i=e+1;i<t.length;){if(!t[i-1].equals2D(t[i])){var a=dr.quadrant(t[i-1],t[i]);if(a!==r)break}i++}return i-1};Gl.getChains=function(){if(arguments.length===1){var t=arguments[0];return Gl.getChains(t,null)}else if(arguments.length===2){for(var e=arguments[0],n=arguments[1],r=new fe,i=Gl.getChainStartIndices(e),a=0;a<i.length-1;a++){var h=new xa(e,i[a],i[a+1],n);r.add(h)}return r}};Gl.toIntArray=function(t){for(var e=new Array(t.size()).fill(null),n=0;n<e.length;n++)e[n]=t.get(n).intValue();return e};var Vf=function(){};Vf.prototype.computeNodes=function(t){};Vf.prototype.getNodedSubstrings=function(){};Vf.prototype.interfaces_=function(){return[]};Vf.prototype.getClass=function(){return Vf};var Hy=function(){if(this._segInt=null,arguments.length!==0&&arguments.length===1){var t=arguments[0];this.setSegmentIntersector(t)}};Hy.prototype.setSegmentIntersector=function(t){this._segInt=t};Hy.prototype.interfaces_=function(){return[Vf]};Hy.prototype.getClass=function(){return Hy};var Nb=function(t){function e(r){r?t.call(this,r):t.call(this),this._monoChains=new fe,this._index=new xS,this._idCounter=0,this._nodedSegStrings=null,this._nOverlaps=0}t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e;var n={SegmentOverlapAction:{configurable:!0}};return e.prototype.getMonotoneChains=function(){return this._monoChains},e.prototype.getNodedSubstrings=function(){return Ii.getNodedSubstrings(this._nodedSegStrings)},e.prototype.getIndex=function(){return this._index},e.prototype.add=function(r){for(var i=this,a=Gl.getChains(r.getCoordinates(),r),h=a.iterator();h.hasNext();){var u=h.next();u.setId(i._idCounter++),i._index.insert(u.getEnvelope(),u),i._monoChains.add(u)}},e.prototype.computeNodes=function(r){var i=this;this._nodedSegStrings=r;for(var a=r.iterator();a.hasNext();)i.add(a.next());this.intersectChains()},e.prototype.intersectChains=function(){for(var r=this,i=new VE(this._segInt),a=this._monoChains.iterator();a.hasNext();)for(var h=a.next(),u=r._index.query(h.getEnvelope()),_=u.iterator();_.hasNext();){var w=_.next();if(w.getId()>h.getId()&&(h.computeOverlaps(w,i),r._nOverlaps++),r._segInt.isDone())return null}},e.prototype.interfaces_=function(){return[]},e.prototype.getClass=function(){return e},n.SegmentOverlapAction.get=function(){return VE},Object.defineProperties(e,n),e}(Hy),VE=function(t){function e(){t.call(this),this._si=null;var n=arguments[0];this._si=n}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.overlap=function(){if(arguments.length===4){var n=arguments[0],r=arguments[1],i=arguments[2],a=arguments[3],h=n.getContext(),u=i.getContext();this._si.processIntersections(h,r,u,a)}else return t.prototype.overlap.apply(this,arguments)},e.prototype.interfaces_=function(){return[]},e.prototype.getClass=function(){return e},e}(Zy),Jn=function t(){if(this._quadrantSegments=t.DEFAULT_QUADRANT_SEGMENTS,this._endCapStyle=t.CAP_ROUND,this._joinStyle=t.JOIN_ROUND,this._mitreLimit=t.DEFAULT_MITRE_LIMIT,this._isSingleSided=!1,this._simplifyFactor=t.DEFAULT_SIMPLIFY_FACTOR,arguments.length!==0){if(arguments.length===1){var e=arguments[0];this.setQuadrantSegments(e)}else if(arguments.length===2){var n=arguments[0],r=arguments[1];this.setQuadrantSegments(n),this.setEndCapStyle(r)}else if(arguments.length===4){var i=arguments[0],a=arguments[1],h=arguments[2],u=arguments[3];this.setQuadrantSegments(i),this.setEndCapStyle(a),this.setJoinStyle(h),this.setMitreLimit(u)}}},Gh={CAP_ROUND:{configurable:!0},CAP_FLAT:{configurable:!0},CAP_SQUARE:{configurable:!0},JOIN_ROUND:{configurable:!0},JOIN_MITRE:{configurable:!0},JOIN_BEVEL:{configurable:!0},DEFAULT_QUADRANT_SEGMENTS:{configurable:!0},DEFAULT_MITRE_LIMIT:{configurable:!0},DEFAULT_SIMPLIFY_FACTOR:{configurable:!0}};Jn.prototype.getEndCapStyle=function(){return this._endCapStyle};Jn.prototype.isSingleSided=function(){return this._isSingleSided};Jn.prototype.setQuadrantSegments=function(t){this._quadrantSegments=t,this._quadrantSegments===0&&(this._joinStyle=Jn.JOIN_BEVEL),this._quadrantSegments<0&&(this._joinStyle=Jn.JOIN_MITRE,this._mitreLimit=Math.abs(this._quadrantSegments)),t<=0&&(this._quadrantSegments=1),this._joinStyle!==Jn.JOIN_ROUND&&(this._quadrantSegments=Jn.DEFAULT_QUADRANT_SEGMENTS)};Jn.prototype.getJoinStyle=function(){return this._joinStyle};Jn.prototype.setJoinStyle=function(t){this._joinStyle=t};Jn.prototype.setSimplifyFactor=function(t){this._simplifyFactor=t<0?0:t};Jn.prototype.getSimplifyFactor=function(){return this._simplifyFactor};Jn.prototype.getQuadrantSegments=function(){return this._quadrantSegments};Jn.prototype.setEndCapStyle=function(t){this._endCapStyle=t};Jn.prototype.getMitreLimit=function(){return this._mitreLimit};Jn.prototype.setMitreLimit=function(t){this._mitreLimit=t};Jn.prototype.setSingleSided=function(t){this._isSingleSided=t};Jn.prototype.interfaces_=function(){return[]};Jn.prototype.getClass=function(){return Jn};Jn.bufferDistanceError=function(t){var e=Math.PI/2/t;return 1-Math.cos(e/2)};Gh.CAP_ROUND.get=function(){return 1};Gh.CAP_FLAT.get=function(){return 2};Gh.CAP_SQUARE.get=function(){return 3};Gh.JOIN_ROUND.get=function(){return 1};Gh.JOIN_MITRE.get=function(){return 2};Gh.JOIN_BEVEL.get=function(){return 3};Gh.DEFAULT_QUADRANT_SEGMENTS.get=function(){return 8};Gh.DEFAULT_MITRE_LIMIT.get=function(){return 5};Gh.DEFAULT_SIMPLIFY_FACTOR.get=function(){return .01};Object.defineProperties(Jn,Gh);var ui=function(t){this._distanceTol=null,this._isDeleted=null,this._angleOrientation=Se.COUNTERCLOCKWISE,this._inputLine=t||null},I_={INIT:{configurable:!0},DELETE:{configurable:!0},KEEP:{configurable:!0},NUM_PTS_TO_CHECK:{configurable:!0}};ui.prototype.isDeletable=function(t,e,n,r){var i=this._inputLine[t],a=this._inputLine[e],h=this._inputLine[n];return!this.isConcave(i,a,h)||!this.isShallow(i,a,h,r)?!1:this.isShallowSampled(i,a,t,n,r)};ui.prototype.deleteShallowConcavities=function(){for(var t=this,e=1,n=this.findNextNonDeletedIndex(e),r=this.findNextNonDeletedIndex(n),i=!1;r<this._inputLine.length;){var a=!1;t.isDeletable(e,n,r,t._distanceTol)&&(t._isDeleted[n]=ui.DELETE,a=!0,i=!0),a?e=r:e=n,n=t.findNextNonDeletedIndex(e),r=t.findNextNonDeletedIndex(n)}return i};ui.prototype.isShallowConcavity=function(t,e,n,r){var i=Se.computeOrientation(t,e,n),a=i===this._angleOrientation;if(!a)return!1;var h=Se.distancePointLine(e,t,n);return h<r};ui.prototype.isShallowSampled=function(t,e,n,r,i){var a=this,h=Math.trunc((r-n)/ui.NUM_PTS_TO_CHECK);h<=0&&(h=1);for(var u=n;u<r;u+=h)if(!a.isShallow(t,e,a._inputLine[u],i))return!1;return!0};ui.prototype.isConcave=function(t,e,n){var r=Se.computeOrientation(t,e,n),i=r===this._angleOrientation;return i};ui.prototype.simplify=function(t){var e=this;this._distanceTol=Math.abs(t),t<0&&(this._angleOrientation=Se.CLOCKWISE),this._isDeleted=new Array(this._inputLine.length).fill(null);var n=!1;do n=e.deleteShallowConcavities();while(n);return this.collapseLine()};ui.prototype.findNextNonDeletedIndex=function(t){for(var e=t+1;e<this._inputLine.length&&this._isDeleted[e]===ui.DELETE;)e++;return e};ui.prototype.isShallow=function(t,e,n,r){var i=Se.distancePointLine(e,t,n);return i<r};ui.prototype.collapseLine=function(){for(var t=this,e=new b_,n=0;n<this._inputLine.length;n++)t._isDeleted[n]!==ui.DELETE&&e.add(t._inputLine[n]);return e.toCoordinateArray()};ui.prototype.interfaces_=function(){return[]};ui.prototype.getClass=function(){return ui};ui.simplify=function(t,e){var n=new ui(t);return n.simplify(e)};I_.INIT.get=function(){return 0};I_.DELETE.get=function(){return 1};I_.KEEP.get=function(){return 1};I_.NUM_PTS_TO_CHECK.get=function(){return 10};Object.defineProperties(ui,I_);var Ha=function(){this._ptList=null,this._precisionModel=null,this._minimimVertexDistance=0,this._ptList=new fe},wS={COORDINATE_ARRAY_TYPE:{configurable:!0}};Ha.prototype.getCoordinates=function(){var t=this._ptList.toArray(Ha.COORDINATE_ARRAY_TYPE);return t};Ha.prototype.setPrecisionModel=function(t){this._precisionModel=t};Ha.prototype.addPt=function(t){var e=new Tt(t);if(this._precisionModel.makePrecise(e),this.isRedundant(e))return null;this._ptList.add(e)};Ha.prototype.revere=function(){};Ha.prototype.addPts=function(t,e){var n=this;if(e)for(var r=0;r<t.length;r++)n.addPt(t[r]);else for(var i=t.length-1;i>=0;i--)n.addPt(t[i])};Ha.prototype.isRedundant=function(t){if(this._ptList.size()<1)return!1;var e=this._ptList.get(this._ptList.size()-1),n=t.distance(e);return n<this._minimimVertexDistance};Ha.prototype.toString=function(){var t=new wn,e=t.createLineString(this.getCoordinates());return e.toString()};Ha.prototype.closeRing=function(){if(this._ptList.size()<1)return null;var t=new Tt(this._ptList.get(0)),e=this._ptList.get(this._ptList.size()-1);if(t.equals(e))return null;this._ptList.add(t)};Ha.prototype.setMinimumVertexDistance=function(t){this._minimimVertexDistance=t};Ha.prototype.interfaces_=function(){return[]};Ha.prototype.getClass=function(){return Ha};wS.COORDINATE_ARRAY_TYPE.get=function(){return new Array(0).fill(null)};Object.defineProperties(Ha,wS);var On=function(){},lg={PI_TIMES_2:{configurable:!0},PI_OVER_2:{configurable:!0},PI_OVER_4:{configurable:!0},COUNTERCLOCKWISE:{configurable:!0},CLOCKWISE:{configurable:!0},NONE:{configurable:!0}};On.prototype.interfaces_=function(){return[]};On.prototype.getClass=function(){return On};On.toDegrees=function(t){return t*180/Math.PI};On.normalize=function(t){for(;t>Math.PI;)t-=On.PI_TIMES_2;for(;t<=-Math.PI;)t+=On.PI_TIMES_2;return t};On.angle=function(){if(arguments.length===1){var t=arguments[0];return Math.atan2(t.y,t.x)}else if(arguments.length===2){var e=arguments[0],n=arguments[1],r=n.x-e.x,i=n.y-e.y;return Math.atan2(i,r)}};On.isAcute=function(t,e,n){var r=t.x-e.x,i=t.y-e.y,a=n.x-e.x,h=n.y-e.y,u=r*a+i*h;return u>0};On.isObtuse=function(t,e,n){var r=t.x-e.x,i=t.y-e.y,a=n.x-e.x,h=n.y-e.y,u=r*a+i*h;return u<0};On.interiorAngle=function(t,e,n){var r=On.angle(e,t),i=On.angle(e,n);return Math.abs(i-r)};On.normalizePositive=function(t){if(t<0){for(;t<0;)t+=On.PI_TIMES_2;t>=On.PI_TIMES_2&&(t=0)}else{for(;t>=On.PI_TIMES_2;)t-=On.PI_TIMES_2;t<0&&(t=0)}return t};On.angleBetween=function(t,e,n){var r=On.angle(e,t),i=On.angle(e,n);return On.diff(r,i)};On.diff=function(t,e){var n=null;return t<e?n=e-t:n=t-e,n>Math.PI&&(n=2*Math.PI-n),n};On.toRadians=function(t){return t*Math.PI/180};On.getTurn=function(t,e){var n=Math.sin(e-t);return n>0?On.COUNTERCLOCKWISE:n<0?On.CLOCKWISE:On.NONE};On.angleBetweenOriented=function(t,e,n){var r=On.angle(e,t),i=On.angle(e,n),a=i-r;return a<=-Math.PI?a+On.PI_TIMES_2:a>Math.PI?a-On.PI_TIMES_2:a};lg.PI_TIMES_2.get=function(){return 2*Math.PI};lg.PI_OVER_2.get=function(){return Math.PI/2};lg.PI_OVER_4.get=function(){return Math.PI/4};lg.COUNTERCLOCKWISE.get=function(){return Se.COUNTERCLOCKWISE};lg.CLOCKWISE.get=function(){return Se.CLOCKWISE};lg.NONE.get=function(){return Se.COLLINEAR};Object.defineProperties(On,lg);var Or=function t(){this._maxCurveSegmentError=0,this._filletAngleQuantum=null,this._closingSegLengthFactor=1,this._segList=null,this._distance=0,this._precisionModel=null,this._bufParams=null,this._li=null,this._s0=null,this._s1=null,this._s2=null,this._seg0=new Ve,this._seg1=new Ve,this._offset0=new Ve,this._offset1=new Ve,this._side=0,this._hasNarrowConcaveAngle=!1;var e=arguments[0],n=arguments[1],r=arguments[2];this._precisionModel=e,this._bufParams=n,this._li=new ad,this._filletAngleQuantum=Math.PI/2/n.getQuadrantSegments(),n.getQuadrantSegments()>=8&&n.getJoinStyle()===Jn.JOIN_ROUND&&(this._closingSegLengthFactor=t.MAX_CLOSING_SEG_LEN_FACTOR),this.init(r)},S_={OFFSET_SEGMENT_SEPARATION_FACTOR:{configurable:!0},INSIDE_TURN_VERTEX_SNAP_DISTANCE_FACTOR:{configurable:!0},CURVE_VERTEX_SNAP_DISTANCE_FACTOR:{configurable:!0},MAX_CLOSING_SEG_LEN_FACTOR:{configurable:!0}};Or.prototype.addNextSegment=function(t,e){if(this._s0=this._s1,this._s1=this._s2,this._s2=t,this._seg0.setCoordinates(this._s0,this._s1),this.computeOffsetSegment(this._seg0,this._side,this._distance,this._offset0),this._seg1.setCoordinates(this._s1,this._s2),this.computeOffsetSegment(this._seg1,this._side,this._distance,this._offset1),this._s1.equals(this._s2))return null;var n=Se.computeOrientation(this._s0,this._s1,this._s2),r=n===Se.CLOCKWISE&&this._side===ie.LEFT||n===Se.COUNTERCLOCKWISE&&this._side===ie.RIGHT;n===0?this.addCollinear(e):r?this.addOutsideTurn(n,e):this.addInsideTurn(n,e)};Or.prototype.addLineEndCap=function(t,e){var n=new Ve(t,e),r=new Ve;this.computeOffsetSegment(n,ie.LEFT,this._distance,r);var i=new Ve;this.computeOffsetSegment(n,ie.RIGHT,this._distance,i);var a=e.x-t.x,h=e.y-t.y,u=Math.atan2(h,a);switch(this._bufParams.getEndCapStyle()){case Jn.CAP_ROUND:this._segList.addPt(r.p1),this.addFilletArc(e,u+Math.PI/2,u-Math.PI/2,Se.CLOCKWISE,this._distance),this._segList.addPt(i.p1);break;case Jn.CAP_FLAT:this._segList.addPt(r.p1),this._segList.addPt(i.p1);break;case Jn.CAP_SQUARE:var _=new Tt;_.x=Math.abs(this._distance)*Math.cos(u),_.y=Math.abs(this._distance)*Math.sin(u);var w=new Tt(r.p1.x+_.x,r.p1.y+_.y),C=new Tt(i.p1.x+_.x,i.p1.y+_.y);this._segList.addPt(w),this._segList.addPt(C);break}};Or.prototype.getCoordinates=function(){var t=this._segList.getCoordinates();return t};Or.prototype.addMitreJoin=function(t,e,n,r){var i=!0,a=null;try{a=qu.intersection(e.p0,e.p1,n.p0,n.p1);var h=r<=0?1:a.distance(t)/Math.abs(r);h>this._bufParams.getMitreLimit()&&(i=!1)}catch(u){if(u instanceof Dm)a=new Tt(0,0),i=!1;else throw u}finally{}i?this._segList.addPt(a):this.addLimitedMitreJoin(e,n,r,this._bufParams.getMitreLimit())};Or.prototype.addFilletCorner=function(t,e,n,r,i){var a=e.x-t.x,h=e.y-t.y,u=Math.atan2(h,a),_=n.x-t.x,w=n.y-t.y,C=Math.atan2(w,_);r===Se.CLOCKWISE?u<=C&&(u+=2*Math.PI):u>=C&&(u-=2*Math.PI),this._segList.addPt(e),this.addFilletArc(t,u,C,r,i),this._segList.addPt(n)};Or.prototype.addOutsideTurn=function(t,e){if(this._offset0.p1.distance(this._offset1.p0)<this._distance*Or.OFFSET_SEGMENT_SEPARATION_FACTOR)return this._segList.addPt(this._offset0.p1),null;this._bufParams.getJoinStyle()===Jn.JOIN_MITRE?this.addMitreJoin(this._s1,this._offset0,this._offset1,this._distance):this._bufParams.getJoinStyle()===Jn.JOIN_BEVEL?this.addBevelJoin(this._offset0,this._offset1):(e&&this._segList.addPt(this._offset0.p1),this.addFilletCorner(this._s1,this._offset0.p1,this._offset1.p0,t,this._distance),this._segList.addPt(this._offset1.p0))};Or.prototype.createSquare=function(t){this._segList.addPt(new Tt(t.x+this._distance,t.y+this._distance)),this._segList.addPt(new Tt(t.x+this._distance,t.y-this._distance)),this._segList.addPt(new Tt(t.x-this._distance,t.y-this._distance)),this._segList.addPt(new Tt(t.x-this._distance,t.y+this._distance)),this._segList.closeRing()};Or.prototype.addSegments=function(t,e){this._segList.addPts(t,e)};Or.prototype.addFirstSegment=function(){this._segList.addPt(this._offset1.p0)};Or.prototype.addLastSegment=function(){this._segList.addPt(this._offset1.p1)};Or.prototype.initSideSegments=function(t,e,n){this._s1=t,this._s2=e,this._side=n,this._seg1.setCoordinates(t,e),this.computeOffsetSegment(this._seg1,n,this._distance,this._offset1)};Or.prototype.addLimitedMitreJoin=function(t,e,n,r){var i=this._seg0.p1,a=On.angle(i,this._seg0.p0),h=On.angleBetweenOriented(this._seg0.p0,i,this._seg1.p1),u=h/2,_=On.normalize(a+u),w=On.normalize(_+Math.PI),C=r*n,P=C*Math.abs(Math.sin(u)),D=n-P,B=i.x+C*Math.cos(w),$=i.y+C*Math.sin(w),Z=new Tt(B,$),W=new Ve(i,Z),rt=W.pointAlongOffset(1,D),ct=W.pointAlongOffset(1,-D);this._side===ie.LEFT?(this._segList.addPt(rt),this._segList.addPt(ct)):(this._segList.addPt(ct),this._segList.addPt(rt))};Or.prototype.computeOffsetSegment=function(t,e,n,r){var i=e===ie.LEFT?1:-1,a=t.p1.x-t.p0.x,h=t.p1.y-t.p0.y,u=Math.sqrt(a*a+h*h),_=i*n*a/u,w=i*n*h/u;r.p0.x=t.p0.x-w,r.p0.y=t.p0.y+_,r.p1.x=t.p1.x-w,r.p1.y=t.p1.y+_};Or.prototype.addFilletArc=function(t,e,n,r,i){var a=this,h=r===Se.CLOCKWISE?-1:1,u=Math.abs(e-n),_=Math.trunc(u/this._filletAngleQuantum+.5);if(_<1)return null;for(var w=0,C=u/_,P=w,D=new Tt;P<u;){var B=e+h*P;D.x=t.x+i*Math.cos(B),D.y=t.y+i*Math.sin(B),a._segList.addPt(D),P+=C}};Or.prototype.addInsideTurn=function(t,e){if(this._li.computeIntersection(this._offset0.p0,this._offset0.p1,this._offset1.p0,this._offset1.p1),this._li.hasIntersection())this._segList.addPt(this._li.getIntersection(0));else if(this._hasNarrowConcaveAngle=!0,this._offset0.p1.distance(this._offset1.p0)<this._distance*Or.INSIDE_TURN_VERTEX_SNAP_DISTANCE_FACTOR)this._segList.addPt(this._offset0.p1);else{if(this._segList.addPt(this._offset0.p1),this._closingSegLengthFactor>0){var n=new Tt((this._closingSegLengthFactor*this._offset0.p1.x+this._s1.x)/(this._closingSegLengthFactor+1),(this._closingSegLengthFactor*this._offset0.p1.y+this._s1.y)/(this._closingSegLengthFactor+1));this._segList.addPt(n);var r=new Tt((this._closingSegLengthFactor*this._offset1.p0.x+this._s1.x)/(this._closingSegLengthFactor+1),(this._closingSegLengthFactor*this._offset1.p0.y+this._s1.y)/(this._closingSegLengthFactor+1));this._segList.addPt(r)}else this._segList.addPt(this._s1);this._segList.addPt(this._offset1.p0)}};Or.prototype.createCircle=function(t){var e=new Tt(t.x+this._distance,t.y);this._segList.addPt(e),this.addFilletArc(t,0,2*Math.PI,-1,this._distance),this._segList.closeRing()};Or.prototype.addBevelJoin=function(t,e){this._segList.addPt(t.p1),this._segList.addPt(e.p0)};Or.prototype.init=function(t){this._distance=t,this._maxCurveSegmentError=t*(1-Math.cos(this._filletAngleQuantum/2)),this._segList=new Ha,this._segList.setPrecisionModel(this._precisionModel),this._segList.setMinimumVertexDistance(t*Or.CURVE_VERTEX_SNAP_DISTANCE_FACTOR)};Or.prototype.addCollinear=function(t){this._li.computeIntersection(this._s0,this._s1,this._s1,this._s2);var e=this._li.getIntersectionNum();e>=2&&(this._bufParams.getJoinStyle()===Jn.JOIN_BEVEL||this._bufParams.getJoinStyle()===Jn.JOIN_MITRE?(t&&this._segList.addPt(this._offset0.p1),this._segList.addPt(this._offset1.p0)):this.addFilletCorner(this._s1,this._offset0.p1,this._offset1.p0,Se.CLOCKWISE,this._distance))};Or.prototype.closeRing=function(){this._segList.closeRing()};Or.prototype.hasNarrowConcaveAngle=function(){return this._hasNarrowConcaveAngle};Or.prototype.interfaces_=function(){return[]};Or.prototype.getClass=function(){return Or};S_.OFFSET_SEGMENT_SEPARATION_FACTOR.get=function(){return .001};S_.INSIDE_TURN_VERTEX_SNAP_DISTANCE_FACTOR.get=function(){return .001};S_.CURVE_VERTEX_SNAP_DISTANCE_FACTOR.get=function(){return 1e-6};S_.MAX_CLOSING_SEG_LEN_FACTOR.get=function(){return 80};Object.defineProperties(Or,S_);var Js=function(){this._distance=0,this._precisionModel=null,this._bufParams=null;var t=arguments[0],e=arguments[1];this._precisionModel=t,this._bufParams=e};Js.prototype.getOffsetCurve=function(t,e){if(this._distance=e,e===0)return null;var n=e<0,r=Math.abs(e),i=this.getSegGen(r);t.length<=1?this.computePointCurve(t[0],i):this.computeOffsetCurve(t,n,i);var a=i.getCoordinates();return n&&In.reverse(a),a};Js.prototype.computeSingleSidedBufferCurve=function(t,e,n){var r=this.simplifyTolerance(this._distance);if(e){n.addSegments(t,!0);var i=ui.simplify(t,-r),a=i.length-1;n.initSideSegments(i[a],i[a-1],ie.LEFT),n.addFirstSegment();for(var h=a-2;h>=0;h--)n.addNextSegment(i[h],!0)}else{n.addSegments(t,!1);var u=ui.simplify(t,r),_=u.length-1;n.initSideSegments(u[0],u[1],ie.LEFT),n.addFirstSegment();for(var w=2;w<=_;w++)n.addNextSegment(u[w],!0)}n.addLastSegment(),n.closeRing()};Js.prototype.computeRingBufferCurve=function(t,e,n){var r=this.simplifyTolerance(this._distance);e===ie.RIGHT&&(r=-r);var i=ui.simplify(t,r),a=i.length-1;n.initSideSegments(i[a-1],i[0],e);for(var h=1;h<=a;h++){var u=h!==1;n.addNextSegment(i[h],u)}n.closeRing()};Js.prototype.computeLineBufferCurve=function(t,e){var n=this.simplifyTolerance(this._distance),r=ui.simplify(t,n),i=r.length-1;e.initSideSegments(r[0],r[1],ie.LEFT);for(var a=2;a<=i;a++)e.addNextSegment(r[a],!0);e.addLastSegment(),e.addLineEndCap(r[i-1],r[i]);var h=ui.simplify(t,-n),u=h.length-1;e.initSideSegments(h[u],h[u-1],ie.LEFT);for(var _=u-2;_>=0;_--)e.addNextSegment(h[_],!0);e.addLastSegment(),e.addLineEndCap(h[1],h[0]),e.closeRing()};Js.prototype.computePointCurve=function(t,e){switch(this._bufParams.getEndCapStyle()){case Jn.CAP_ROUND:e.createCircle(t);break;case Jn.CAP_SQUARE:e.createSquare(t);break}};Js.prototype.getLineCurve=function(t,e){if(this._distance=e,e<0&&!this._bufParams.isSingleSided()||e===0)return null;var n=Math.abs(e),r=this.getSegGen(n);if(t.length<=1)this.computePointCurve(t[0],r);else if(this._bufParams.isSingleSided()){var i=e<0;this.computeSingleSidedBufferCurve(t,i,r)}else this.computeLineBufferCurve(t,r);var a=r.getCoordinates();return a};Js.prototype.getBufferParameters=function(){return this._bufParams};Js.prototype.simplifyTolerance=function(t){return t*this._bufParams.getSimplifyFactor()};Js.prototype.getRingCurve=function(t,e,n){if(this._distance=n,t.length<=2)return this.getLineCurve(t,n);if(n===0)return Js.copyCoordinates(t);var r=this.getSegGen(n);return this.computeRingBufferCurve(t,e,r),r.getCoordinates()};Js.prototype.computeOffsetCurve=function(t,e,n){var r=this.simplifyTolerance(this._distance);if(e){var i=ui.simplify(t,-r),a=i.length-1;n.initSideSegments(i[a],i[a-1],ie.LEFT),n.addFirstSegment();for(var h=a-2;h>=0;h--)n.addNextSegment(i[h],!0)}else{var u=ui.simplify(t,r),_=u.length-1;n.initSideSegments(u[0],u[1],ie.LEFT),n.addFirstSegment();for(var w=2;w<=_;w++)n.addNextSegment(u[w],!0)}n.addLastSegment()};Js.prototype.getSegGen=function(t){return new Or(this._precisionModel,this._bufParams,t)};Js.prototype.interfaces_=function(){return[]};Js.prototype.getClass=function(){return Js};Js.copyCoordinates=function(t){for(var e=new Array(t.length).fill(null),n=0;n<e.length;n++)e[n]=new Tt(t[n]);return e};var Od=function(){this._subgraphs=null,this._seg=new Ve,this._cga=new Se;var t=arguments[0];this._subgraphs=t},ES={DepthSegment:{configurable:!0}};Od.prototype.findStabbedSegments=function(){var t=this;if(arguments.length===1){for(var e=arguments[0],n=new fe,r=this._subgraphs.iterator();r.hasNext();){var i=r.next(),a=i.getEnvelope();e.y<a.getMinY()||e.y>a.getMaxY()||t.findStabbedSegments(e,i.getDirectedEdges(),n)}return n}else if(arguments.length===3){if(tn(arguments[2],ju)&&arguments[0]instanceof Tt&&arguments[1]instanceof Qx)for(var h=arguments[0],u=arguments[1],_=arguments[2],w=u.getEdge().getCoordinates(),C=0;C<w.length-1;C++){t._seg.p0=w[C],t._seg.p1=w[C+1],t._seg.p0.y>t._seg.p1.y&&t._seg.reverse();var P=Math.max(t._seg.p0.x,t._seg.p1.x);if(!(P<h.x)&&!t._seg.isHorizontal()&&!(h.y<t._seg.p0.y||h.y>t._seg.p1.y)&&Se.computeOrientation(t._seg.p0,t._seg.p1,h)!==Se.RIGHT){var D=u.getDepth(ie.LEFT);t._seg.p0.equals(w[C])||(D=u.getDepth(ie.RIGHT));var B=new Uf(t._seg,D);_.add(B)}}else if(tn(arguments[2],ju)&&arguments[0]instanceof Tt&&tn(arguments[1],ju))for(var $=arguments[0],Z=arguments[1],W=arguments[2],rt=Z.iterator();rt.hasNext();){var ct=rt.next();ct.isForward()&&t.findStabbedSegments($,ct,W)}}};Od.prototype.getDepth=function(t){var e=this.findStabbedSegments(t);if(e.size()===0)return 0;var n=Ju.min(e);return n._leftDepth};Od.prototype.interfaces_=function(){return[]};Od.prototype.getClass=function(){return Od};ES.DepthSegment.get=function(){return Uf};Object.defineProperties(Od,ES);var Uf=function(){this._upwardSeg=null,this._leftDepth=null;var t=arguments[0],e=arguments[1];this._upwardSeg=new Ve(t),this._leftDepth=e};Uf.prototype.compareTo=function(t){var e=t;if(this._upwardSeg.minX()>=e._upwardSeg.maxX())return 1;if(this._upwardSeg.maxX()<=e._upwardSeg.minX())return-1;var n=this._upwardSeg.orientationIndex(e._upwardSeg);return n!==0||(n=-1*e._upwardSeg.orientationIndex(this._upwardSeg),n!==0)?n:this._upwardSeg.compareTo(e._upwardSeg)};Uf.prototype.compareX=function(t,e){var n=t.p0.compareTo(e.p0);return n!==0?n:t.p1.compareTo(e.p1)};Uf.prototype.toString=function(){return this._upwardSeg.toString()};Uf.prototype.interfaces_=function(){return[Tu]};Uf.prototype.getClass=function(){return Uf};var tr=function(t,e,n){this.p0=t||null,this.p1=e||null,this.p2=n||null};tr.prototype.area=function(){return tr.area(this.p0,this.p1,this.p2)};tr.prototype.signedArea=function(){return tr.signedArea(this.p0,this.p1,this.p2)};tr.prototype.interpolateZ=function(t){if(t===null)throw new Xr("Supplied point is null.");return tr.interpolateZ(t,this.p0,this.p1,this.p2)};tr.prototype.longestSideLength=function(){return tr.longestSideLength(this.p0,this.p1,this.p2)};tr.prototype.isAcute=function(){return tr.isAcute(this.p0,this.p1,this.p2)};tr.prototype.circumcentre=function(){return tr.circumcentre(this.p0,this.p1,this.p2)};tr.prototype.area3D=function(){return tr.area3D(this.p0,this.p1,this.p2)};tr.prototype.centroid=function(){return tr.centroid(this.p0,this.p1,this.p2)};tr.prototype.inCentre=function(){return tr.inCentre(this.p0,this.p1,this.p2)};tr.prototype.interfaces_=function(){return[]};tr.prototype.getClass=function(){return tr};tr.area=function(t,e,n){return Math.abs(((n.x-t.x)*(e.y-t.y)-(e.x-t.x)*(n.y-t.y))/2)};tr.signedArea=function(t,e,n){return((n.x-t.x)*(e.y-t.y)-(e.x-t.x)*(n.y-t.y))/2};tr.det=function(t,e,n,r){return t*r-e*n};tr.interpolateZ=function(t,e,n,r){var i=e.x,a=e.y,h=n.x-i,u=r.x-i,_=n.y-a,w=r.y-a,C=h*w-u*_,P=t.x-i,D=t.y-a,B=(w*P-u*D)/C,$=(-_*P+h*D)/C,Z=e.z+B*(n.z-e.z)+$*(r.z-e.z);return Z};tr.longestSideLength=function(t,e,n){var r=t.distance(e),i=e.distance(n),a=n.distance(t),h=r;return i>h&&(h=i),a>h&&(h=a),h};tr.isAcute=function(t,e,n){return!(!On.isAcute(t,e,n)||!On.isAcute(e,n,t)||!On.isAcute(n,t,e))};tr.circumcentre=function(t,e,n){var r=n.x,i=n.y,a=t.x-r,h=t.y-i,u=e.x-r,_=e.y-i,w=2*tr.det(a,h,u,_),C=tr.det(h,a*a+h*h,_,u*u+_*_),P=tr.det(a,a*a+h*h,u,u*u+_*_),D=r-C/w,B=i+P/w;return new Tt(D,B)};tr.perpendicularBisector=function(t,e){var n=e.x-t.x,r=e.y-t.y,i=new qu(t.x+n/2,t.y+r/2,1),a=new qu(t.x-r+n/2,t.y+n+r/2,1);return new qu(i,a)};tr.angleBisector=function(t,e,n){var r=e.distance(t),i=e.distance(n),a=r/(r+i),h=n.x-t.x,u=n.y-t.y,_=new Tt(t.x+a*h,t.y+a*u);return _};tr.area3D=function(t,e,n){var r=e.x-t.x,i=e.y-t.y,a=e.z-t.z,h=n.x-t.x,u=n.y-t.y,_=n.z-t.z,w=i*_-a*u,C=a*h-r*_,P=r*u-i*h,D=w*w+C*C+P*P,B=Math.sqrt(D)/2;return B};tr.centroid=function(t,e,n){var r=(t.x+e.x+n.x)/3,i=(t.y+e.y+n.y)/3;return new Tt(r,i)};tr.inCentre=function(t,e,n){var r=e.distance(n),i=t.distance(n),a=t.distance(e),h=r+i+a,u=(r*t.x+i*e.x+a*n.x)/h,_=(r*t.y+i*e.y+a*n.y)/h;return new Tt(u,_)};var bu=function(){this._inputGeom=null,this._distance=null,this._curveBuilder=null,this._curveList=new fe;var t=arguments[0],e=arguments[1],n=arguments[2];this._inputGeom=t,this._distance=e,this._curveBuilder=n};bu.prototype.addPoint=function(t){if(this._distance<=0)return null;var e=t.getCoordinates(),n=this._curveBuilder.getLineCurve(e,this._distance);this.addCurve(n,Pt.EXTERIOR,Pt.INTERIOR)};bu.prototype.addPolygon=function(t){var e=this,n=this._distance,r=ie.LEFT;this._distance<0&&(n=-this._distance,r=ie.RIGHT);var i=t.getExteriorRing(),a=In.removeRepeatedPoints(i.getCoordinates());if(this._distance<0&&this.isErodedCompletely(i,this._distance)||this._distance<=0&&a.length<3)return null;this.addPolygonRing(a,n,r,Pt.EXTERIOR,Pt.INTERIOR);for(var h=0;h<t.getNumInteriorRing();h++){var u=t.getInteriorRingN(h),_=In.removeRepeatedPoints(u.getCoordinates());e._distance>0&&e.isErodedCompletely(u,-e._distance)||e.addPolygonRing(_,n,ie.opposite(r),Pt.INTERIOR,Pt.EXTERIOR)}};bu.prototype.isTriangleErodedCompletely=function(t,e){var n=new tr(t[0],t[1],t[2]),r=n.inCentre(),i=Se.distancePointLine(r,n.p0,n.p1);return i<Math.abs(e)};bu.prototype.addLineString=function(t){if(this._distance<=0&&!this._curveBuilder.getBufferParameters().isSingleSided())return null;var e=In.removeRepeatedPoints(t.getCoordinates()),n=this._curveBuilder.getLineCurve(e,this._distance);this.addCurve(n,Pt.EXTERIOR,Pt.INTERIOR)};bu.prototype.addCurve=function(t,e,n){if(t===null||t.length<2)return null;var r=new Ii(t,new pr(0,Pt.BOUNDARY,e,n));this._curveList.add(r)};bu.prototype.getCurves=function(){return this.add(this._inputGeom),this._curveList};bu.prototype.addPolygonRing=function(t,e,n,r,i){if(e===0&&t.length<zc.MINIMUM_VALID_SIZE)return null;var a=r,h=i;t.length>=zc.MINIMUM_VALID_SIZE&&Se.isCCW(t)&&(a=i,h=r,n=ie.opposite(n));var u=this._curveBuilder.getRingCurve(t,n,e);this.addCurve(u,a,h)};bu.prototype.add=function(t){if(t.isEmpty())return null;t instanceof to?this.addPolygon(t):t instanceof si?this.addLineString(t):t instanceof _a?this.addPoint(t):t instanceof Jg?this.addCollection(t):t instanceof $f?this.addCollection(t):t instanceof Dc?this.addCollection(t):t instanceof Ls&&this.addCollection(t)};bu.prototype.isErodedCompletely=function(t,e){var n=t.getCoordinates();if(n.length<4)return e<0;if(n.length===4)return this.isTriangleErodedCompletely(n,e);var r=t.getEnvelopeInternal(),i=Math.min(r.getHeight(),r.getWidth());return e<0&&2*Math.abs(e)>i};bu.prototype.addCollection=function(t){for(var e=this,n=0;n<t.getNumGeometries();n++){var r=t.getGeometryN(n);e.add(r)}};bu.prototype.interfaces_=function(){return[]};bu.prototype.getClass=function(){return bu};var em=function(){};em.prototype.locate=function(t){};em.prototype.interfaces_=function(){return[]};em.prototype.getClass=function(){return em};var Oc=function(){this._parent=null,this._atStart=null,this._max=null,this._index=null,this._subcollectionIterator=null;var t=arguments[0];this._parent=t,this._atStart=!0,this._index=0,this._max=t.getNumGeometries()};Oc.prototype.next=function(){if(this._atStart)return this._atStart=!1,Oc.isAtomic(this._parent)&&this._index++,this._parent;if(this._subcollectionIterator!==null){if(this._subcollectionIterator.hasNext())return this._subcollectionIterator.next();this._subcollectionIterator=null}if(this._index>=this._max)throw new Rm;var t=this._parent.getGeometryN(this._index++);return t instanceof Ls?(this._subcollectionIterator=new Oc(t),this._subcollectionIterator.next()):t};Oc.prototype.remove=function(){throw new Error(this.getClass().getName())};Oc.prototype.hasNext=function(){if(this._atStart)return!0;if(this._subcollectionIterator!==null){if(this._subcollectionIterator.hasNext())return!0;this._subcollectionIterator=null}return!(this._index>=this._max)};Oc.prototype.interfaces_=function(){return[Om]};Oc.prototype.getClass=function(){return Oc};Oc.isAtomic=function(t){return!(t instanceof Ls)};var qa=function(){this._geom=null;var t=arguments[0];this._geom=t};qa.prototype.locate=function(t){return qa.locate(t,this._geom)};qa.prototype.interfaces_=function(){return[em]};qa.prototype.getClass=function(){return qa};qa.isPointInRing=function(t,e){return e.getEnvelopeInternal().intersects(t)?Se.isPointInRing(t,e.getCoordinates()):!1};qa.containsPointInPolygon=function(t,e){if(e.isEmpty())return!1;var n=e.getExteriorRing();if(!qa.isPointInRing(t,n))return!1;for(var r=0;r<e.getNumInteriorRing();r++){var i=e.getInteriorRingN(r);if(qa.isPointInRing(t,i))return!1}return!0};qa.containsPoint=function(t,e){if(e instanceof to)return qa.containsPointInPolygon(t,e);if(e instanceof Ls)for(var n=new Oc(e);n.hasNext();){var r=n.next();if(r!==e&&qa.containsPoint(t,r))return!0}return!1};qa.locate=function(t,e){return e.isEmpty()?Pt.EXTERIOR:qa.containsPoint(t,e)?Pt.INTERIOR:Pt.EXTERIOR};var es=function(){this._edgeMap=new Qo,this._edgeList=null,this._ptInAreaLocation=[Pt.NONE,Pt.NONE]};es.prototype.getNextCW=function(t){this.getEdges();var e=this._edgeList.indexOf(t),n=e-1;return e===0&&(n=this._edgeList.size()-1),this._edgeList.get(n)};es.prototype.propagateSideLabels=function(t){for(var e=Pt.NONE,n=this.iterator();n.hasNext();){var r=n.next(),i=r.getLabel();i.isArea(t)&&i.getLocation(t,ie.LEFT)!==Pt.NONE&&(e=i.getLocation(t,ie.LEFT))}if(e===Pt.NONE)return null;for(var a=e,h=this.iterator();h.hasNext();){var u=h.next(),_=u.getLabel();if(_.getLocation(t,ie.ON)===Pt.NONE&&_.setLocation(t,ie.ON,a),_.isArea(t)){var w=_.getLocation(t,ie.LEFT),C=_.getLocation(t,ie.RIGHT);if(C!==Pt.NONE){if(C!==a)throw new Ah("side location conflict",u.getCoordinate());w===Pt.NONE&&fn.shouldNeverReachHere("found single null side (at "+u.getCoordinate()+")"),a=w}else fn.isTrue(_.getLocation(t,ie.LEFT)===Pt.NONE,"found single null side"),_.setLocation(t,ie.RIGHT,a),_.setLocation(t,ie.LEFT,a)}}};es.prototype.getCoordinate=function(){var t=this.iterator();if(!t.hasNext())return null;var e=t.next();return e.getCoordinate()};es.prototype.print=function(t){Fo.out.println("EdgeEndStar:   "+this.getCoordinate());for(var e=this.iterator();e.hasNext();){var n=e.next();n.print(t)}};es.prototype.isAreaLabelsConsistent=function(t){return this.computeEdgeEndLabels(t.getBoundaryNodeRule()),this.checkAreaLabelsConsistent(0)};es.prototype.checkAreaLabelsConsistent=function(t){var e=this.getEdges();if(e.size()<=0)return!0;var n=e.size()-1,r=e.get(n).getLabel(),i=r.getLocation(t,ie.LEFT);fn.isTrue(i!==Pt.NONE,"Found unlabelled area edge");for(var a=i,h=this.iterator();h.hasNext();){var u=h.next(),_=u.getLabel();fn.isTrue(_.isArea(t),"Found non-area edge");var w=_.getLocation(t,ie.LEFT),C=_.getLocation(t,ie.RIGHT);if(w===C||C!==a)return!1;a=w}return!0};es.prototype.findIndex=function(t){var e=this;this.iterator();for(var n=0;n<this._edgeList.size();n++){var r=e._edgeList.get(n);if(r===t)return n}return-1};es.prototype.iterator=function(){return this.getEdges().iterator()};es.prototype.getEdges=function(){return this._edgeList===null&&(this._edgeList=new fe(this._edgeMap.values())),this._edgeList};es.prototype.getLocation=function(t,e,n){return this._ptInAreaLocation[t]===Pt.NONE&&(this._ptInAreaLocation[t]=qa.locate(e,n[t].getGeometry())),this._ptInAreaLocation[t]};es.prototype.toString=function(){var t=new fc;t.append("EdgeEndStar:   "+this.getCoordinate()),t.append(`
`);for(var e=this.iterator();e.hasNext();){var n=e.next();t.append(n),t.append(`
`)}return t.toString()};es.prototype.computeEdgeEndLabels=function(t){for(var e=this.iterator();e.hasNext();){var n=e.next();n.computeLabel(t)}};es.prototype.computeLabelling=function(t){var e=this;this.computeEdgeEndLabels(t[0].getBoundaryNodeRule()),this.propagateSideLabels(0),this.propagateSideLabels(1);for(var n=[!1,!1],r=this.iterator();r.hasNext();)for(var i=r.next(),a=i.getLabel(),h=0;h<2;h++)a.isLine(h)&&a.getLocation(h)===Pt.BOUNDARY&&(n[h]=!0);for(var u=this.iterator();u.hasNext();)for(var _=u.next(),w=_.getLabel(),C=0;C<2;C++)if(w.isAnyNull(C)){var P=Pt.NONE;if(n[C])P=Pt.EXTERIOR;else{var D=_.getCoordinate();P=e.getLocation(C,D,t)}w.setAllLocationsIfNull(C,P)}};es.prototype.getDegree=function(){return this._edgeMap.size()};es.prototype.insertEdgeEnd=function(t,e){this._edgeMap.put(t,e),this._edgeList=null};es.prototype.interfaces_=function(){return[]};es.prototype.getClass=function(){return es};var cA=function(t){function e(){t.call(this),this._resultAreaEdgeList=null,this._label=null,this._SCANNING_FOR_INCOMING=1,this._LINKING_TO_OUTGOING=2}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.linkResultDirectedEdges=function(){var n=this;this.getResultAreaEdges();for(var r=null,i=null,a=this._SCANNING_FOR_INCOMING,h=0;h<this._resultAreaEdgeList.size();h++){var u=n._resultAreaEdgeList.get(h),_=u.getSym();if(u.getLabel().isArea())switch(r===null&&u.isInResult()&&(r=u),a){case n._SCANNING_FOR_INCOMING:if(!_.isInResult())continue;i=_,a=n._LINKING_TO_OUTGOING;break;case n._LINKING_TO_OUTGOING:if(!u.isInResult())continue;i.setNext(u),a=n._SCANNING_FOR_INCOMING;break}}if(a===this._LINKING_TO_OUTGOING){if(r===null)throw new Ah("no outgoing dirEdge found",this.getCoordinate());fn.isTrue(r.isInResult(),"unable to link last incoming dirEdge"),i.setNext(r)}},e.prototype.insert=function(n){var r=n;this.insertEdgeEnd(r,r)},e.prototype.getRightmostEdge=function(){var n=this.getEdges(),r=n.size();if(r<1)return null;var i=n.get(0);if(r===1)return i;var a=n.get(r-1),h=i.getQuadrant(),u=a.getQuadrant();return dr.isNorthern(h)&&dr.isNorthern(u)?i:!dr.isNorthern(h)&&!dr.isNorthern(u)?a:i.getDy()!==0?i:a.getDy()!==0?a:(fn.shouldNeverReachHere("found two horizontal edges incident on node"),null)},e.prototype.print=function(n){Fo.out.println("DirectedEdgeStar: "+this.getCoordinate());for(var r=this.iterator();r.hasNext();){var i=r.next();n.print("out "),i.print(n),n.println(),n.print("in "),i.getSym().print(n),n.println()}},e.prototype.getResultAreaEdges=function(){var n=this;if(this._resultAreaEdgeList!==null)return this._resultAreaEdgeList;this._resultAreaEdgeList=new fe;for(var r=this.iterator();r.hasNext();){var i=r.next();(i.isInResult()||i.getSym().isInResult())&&n._resultAreaEdgeList.add(i)}return this._resultAreaEdgeList},e.prototype.updateLabelling=function(n){for(var r=this.iterator();r.hasNext();){var i=r.next(),a=i.getLabel();a.setAllLocationsIfNull(0,n.getLocation(0)),a.setAllLocationsIfNull(1,n.getLocation(1))}},e.prototype.linkAllDirectedEdges=function(){var n=this;this.getEdges();for(var r=null,i=null,a=this._edgeList.size()-1;a>=0;a--){var h=n._edgeList.get(a),u=h.getSym();i===null&&(i=u),r!==null&&u.setNext(r),r=h}i.setNext(r)},e.prototype.computeDepths=function(){var n=this;if(arguments.length===1){var r=arguments[0],i=this.findIndex(r),a=r.getDepth(ie.LEFT),h=r.getDepth(ie.RIGHT),u=this.computeDepths(i+1,this._edgeList.size(),a),_=this.computeDepths(0,i,u);if(_!==h)throw new Ah("depth mismatch at "+r.getCoordinate())}else if(arguments.length===3){for(var w=arguments[0],C=arguments[1],P=arguments[2],D=P,B=w;B<C;B++){var $=n._edgeList.get(B);$.setEdgeDepths(ie.RIGHT,D),D=$.getDepth(ie.LEFT)}return D}},e.prototype.mergeSymLabels=function(){for(var n=this.iterator();n.hasNext();){var r=n.next(),i=r.getLabel();i.merge(r.getSym().getLabel())}},e.prototype.linkMinimalDirectedEdges=function(n){for(var r=this,i=null,a=null,h=this._SCANNING_FOR_INCOMING,u=this._resultAreaEdgeList.size()-1;u>=0;u--){var _=r._resultAreaEdgeList.get(u),w=_.getSym();switch(i===null&&_.getEdgeRing()===n&&(i=_),h){case r._SCANNING_FOR_INCOMING:if(w.getEdgeRing()!==n)continue;a=w,h=r._LINKING_TO_OUTGOING;break;case r._LINKING_TO_OUTGOING:if(_.getEdgeRing()!==n)continue;a.setNextMin(_),h=r._SCANNING_FOR_INCOMING;break}}h===this._LINKING_TO_OUTGOING&&(fn.isTrue(i!==null,"found null for first outgoing dirEdge"),fn.isTrue(i.getEdgeRing()===n,"unable to link last incoming dirEdge"),a.setNextMin(i))},e.prototype.getOutgoingDegree=function(){if(arguments.length===0){for(var n=0,r=this.iterator();r.hasNext();){var i=r.next();i.isInResult()&&n++}return n}else if(arguments.length===1){for(var a=arguments[0],h=0,u=this.iterator();u.hasNext();){var _=u.next();_.getEdgeRing()===a&&h++}return h}},e.prototype.getLabel=function(){return this._label},e.prototype.findCoveredLineEdges=function(){for(var n=Pt.NONE,r=this.iterator();r.hasNext();){var i=r.next(),a=i.getSym();if(!i.isLineEdge()){if(i.isInResult()){n=Pt.INTERIOR;break}if(a.isInResult()){n=Pt.EXTERIOR;break}}}if(n===Pt.NONE)return null;for(var h=n,u=this.iterator();u.hasNext();){var _=u.next(),w=_.getSym();_.isLineEdge()?_.getEdge().setCovered(h===Pt.INTERIOR):(_.isInResult()&&(h=Pt.EXTERIOR),w.isInResult()&&(h=Pt.INTERIOR))}},e.prototype.computeLabelling=function(n){var r=this;t.prototype.computeLabelling.call(this,n),this._label=new pr(Pt.NONE);for(var i=this.iterator();i.hasNext();)for(var a=i.next(),h=a.getEdge(),u=h.getLabel(),_=0;_<2;_++){var w=u.getLocation(_);(w===Pt.INTERIOR||w===Pt.BOUNDARY)&&r._label.setLocation(_,Pt.INTERIOR)}},e.prototype.interfaces_=function(){return[]},e.prototype.getClass=function(){return e},e}(es),IS=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.createNode=function(n){return new _0(n,new cA)},e.prototype.interfaces_=function(){return[]},e.prototype.getClass=function(){return e},e}(Kg),Pp=function t(){this._pts=null,this._orientation=null;var e=arguments[0];this._pts=e,this._orientation=t.orientation(e)};Pp.prototype.compareTo=function(t){var e=t,n=Pp.compareOriented(this._pts,this._orientation,e._pts,e._orientation);return n};Pp.prototype.interfaces_=function(){return[Tu]};Pp.prototype.getClass=function(){return Pp};Pp.orientation=function(t){return In.increasingDirection(t)===1};Pp.compareOriented=function(t,e,n,r){for(var i=e?1:-1,a=r?1:-1,h=e?t.length:-1,u=r?n.length:-1,_=e?0:t.length-1,w=r?0:n.length-1;;){var C=t[_].compareTo(n[w]);if(C!==0)return C;_+=i,w+=a;var P=_===h,D=w===u;if(P&&!D)return-1;if(!P&&D)return 1;if(P&&D)return 0}};var Ku=function(){this._edges=new fe,this._ocaMap=new Qo};Ku.prototype.print=function(t){var e=this;t.print("MULTILINESTRING ( ");for(var n=0;n<this._edges.size();n++){var r=e._edges.get(n);n>0&&t.print(","),t.print("(");for(var i=r.getCoordinates(),a=0;a<i.length;a++)a>0&&t.print(","),t.print(i[a].x+" "+i[a].y);t.println(")")}t.print(")  ")};Ku.prototype.addAll=function(t){for(var e=this,n=t.iterator();n.hasNext();)e.add(n.next())};Ku.prototype.findEdgeIndex=function(t){for(var e=this,n=0;n<this._edges.size();n++)if(e._edges.get(n).equals(t))return n;return-1};Ku.prototype.iterator=function(){return this._edges.iterator()};Ku.prototype.getEdges=function(){return this._edges};Ku.prototype.get=function(t){return this._edges.get(t)};Ku.prototype.findEqualEdge=function(t){var e=new Pp(t.getCoordinates()),n=this._ocaMap.get(e);return n};Ku.prototype.add=function(t){this._edges.add(t);var e=new Pp(t.getCoordinates());this._ocaMap.put(e,t)};Ku.prototype.interfaces_=function(){return[]};Ku.prototype.getClass=function(){return Ku};var Gf=function(){};Gf.prototype.processIntersections=function(t,e,n,r){};Gf.prototype.isDone=function(){};Gf.prototype.interfaces_=function(){return[]};Gf.prototype.getClass=function(){return Gf};var Wa=function(){this._hasIntersection=!1,this._hasProper=!1,this._hasProperInterior=!1,this._hasInterior=!1,this._properIntersectionPoint=null,this._li=null,this._isSelfIntersection=null,this.numIntersections=0,this.numInteriorIntersections=0,this.numProperIntersections=0,this.numTests=0;var t=arguments[0];this._li=t};Wa.prototype.isTrivialIntersection=function(t,e,n,r){if(t===n&&this._li.getIntersectionNum()===1){if(Wa.isAdjacentSegments(e,r))return!0;if(t.isClosed()){var i=t.size()-1;if(e===0&&r===i||r===0&&e===i)return!0}}return!1};Wa.prototype.getProperIntersectionPoint=function(){return this._properIntersectionPoint};Wa.prototype.hasProperInteriorIntersection=function(){return this._hasProperInterior};Wa.prototype.getLineIntersector=function(){return this._li};Wa.prototype.hasProperIntersection=function(){return this._hasProper};Wa.prototype.processIntersections=function(t,e,n,r){if(t===n&&e===r)return null;this.numTests++;var i=t.getCoordinates()[e],a=t.getCoordinates()[e+1],h=n.getCoordinates()[r],u=n.getCoordinates()[r+1];this._li.computeIntersection(i,a,h,u),this._li.hasIntersection()&&(this.numIntersections++,this._li.isInteriorIntersection()&&(this.numInteriorIntersections++,this._hasInterior=!0),this.isTrivialIntersection(t,e,n,r)||(this._hasIntersection=!0,t.addIntersections(this._li,e,0),n.addIntersections(this._li,r,1),this._li.isProper()&&(this.numProperIntersections++,this._hasProper=!0,this._hasProperInterior=!0)))};Wa.prototype.hasIntersection=function(){return this._hasIntersection};Wa.prototype.isDone=function(){return!1};Wa.prototype.hasInteriorIntersection=function(){return this._hasInterior};Wa.prototype.interfaces_=function(){return[Gf]};Wa.prototype.getClass=function(){return Wa};Wa.isAdjacentSegments=function(t,e){return Math.abs(t-e)===1};var Kl=function(){this.coord=null,this.segmentIndex=null,this.dist=null;var t=arguments[0],e=arguments[1],n=arguments[2];this.coord=new Tt(t),this.segmentIndex=e,this.dist=n};Kl.prototype.getSegmentIndex=function(){return this.segmentIndex};Kl.prototype.getCoordinate=function(){return this.coord};Kl.prototype.print=function(t){t.print(this.coord),t.print(" seg # = "+this.segmentIndex),t.println(" dist = "+this.dist)};Kl.prototype.compareTo=function(t){var e=t;return this.compare(e.segmentIndex,e.dist)};Kl.prototype.isEndPoint=function(t){return this.segmentIndex===0&&this.dist===0||this.segmentIndex===t};Kl.prototype.toString=function(){return this.coord+" seg # = "+this.segmentIndex+" dist = "+this.dist};Kl.prototype.getDistance=function(){return this.dist};Kl.prototype.compare=function(t,e){return this.segmentIndex<t?-1:this.segmentIndex>t?1:this.dist<e?-1:this.dist>e?1:0};Kl.prototype.interfaces_=function(){return[Tu]};Kl.prototype.getClass=function(){return Kl};var Vc=function(){this._nodeMap=new Qo,this.edge=null;var t=arguments[0];this.edge=t};Vc.prototype.print=function(t){t.println("Intersections:");for(var e=this.iterator();e.hasNext();){var n=e.next();n.print(t)}};Vc.prototype.iterator=function(){return this._nodeMap.values().iterator()};Vc.prototype.addSplitEdges=function(t){var e=this;this.addEndpoints();for(var n=this.iterator(),r=n.next();n.hasNext();){var i=n.next(),a=e.createSplitEdge(r,i);t.add(a),r=i}};Vc.prototype.addEndpoints=function(){var t=this.edge.pts.length-1;this.add(this.edge.pts[0],0,0),this.add(this.edge.pts[t],t,0)};Vc.prototype.createSplitEdge=function(t,e){var n=this,r=e.segmentIndex-t.segmentIndex+2,i=this.edge.pts[e.segmentIndex],a=e.dist>0||!e.coord.equals2D(i);a||r--;var h=new Array(r).fill(null),u=0;h[u++]=new Tt(t.coord);for(var _=t.segmentIndex+1;_<=e.segmentIndex;_++)h[u++]=n.edge.pts[_];return a&&(h[u]=e.coord),new zv(h,new pr(this.edge._label))};Vc.prototype.add=function(t,e,n){var r=new Kl(t,e,n),i=this._nodeMap.get(r);return i!==null?i:(this._nodeMap.put(r,r),r)};Vc.prototype.isIntersection=function(t){for(var e=this.iterator();e.hasNext();){var n=e.next();if(n.coord.equals(t))return!0}return!1};Vc.prototype.interfaces_=function(){return[]};Vc.prototype.getClass=function(){return Vc};var qf=function(){};qf.prototype.getChainStartIndices=function(t){var e=this,n=0,r=new fe;r.add(new Xl(n));do{var i=e.findChainEnd(t,n);r.add(new Xl(i)),n=i}while(n<t.length-1);var a=qf.toIntArray(r);return a};qf.prototype.findChainEnd=function(t,e){for(var n=dr.quadrant(t[e],t[e+1]),r=e+1;r<t.length;){var i=dr.quadrant(t[r-1],t[r]);if(i!==n)break;r++}return r-1};qf.prototype.interfaces_=function(){return[]};qf.prototype.getClass=function(){return qf};qf.toIntArray=function(t){for(var e=new Array(t.size()).fill(null),n=0;n<e.length;n++)e[n]=t.get(n).intValue();return e};var Oh=function(){this.e=null,this.pts=null,this.startIndex=null,this.env1=new Be,this.env2=new Be;var t=arguments[0];this.e=t,this.pts=t.getCoordinates();var e=new qf;this.startIndex=e.getChainStartIndices(this.pts)};Oh.prototype.getCoordinates=function(){return this.pts};Oh.prototype.getMaxX=function(t){var e=this.pts[this.startIndex[t]].x,n=this.pts[this.startIndex[t+1]].x;return e>n?e:n};Oh.prototype.getMinX=function(t){var e=this.pts[this.startIndex[t]].x,n=this.pts[this.startIndex[t+1]].x;return e<n?e:n};Oh.prototype.computeIntersectsForChain=function(){if(arguments.length===4){var t=arguments[0],e=arguments[1],n=arguments[2],r=arguments[3];this.computeIntersectsForChain(this.startIndex[t],this.startIndex[t+1],e,e.startIndex[n],e.startIndex[n+1],r)}else if(arguments.length===6){var i=arguments[0],a=arguments[1],h=arguments[2],u=arguments[3],_=arguments[4],w=arguments[5],C=this.pts[i],P=this.pts[a],D=h.pts[u],B=h.pts[_];if(a-i===1&&_-u===1)return w.addIntersections(this.e,i,h.e,u),null;if(this.env1.init(C,P),this.env2.init(D,B),!this.env1.intersects(this.env2))return null;var $=Math.trunc((i+a)/2),Z=Math.trunc((u+_)/2);i<$&&(u<Z&&this.computeIntersectsForChain(i,$,h,u,Z,w),Z<_&&this.computeIntersectsForChain(i,$,h,Z,_,w)),$<a&&(u<Z&&this.computeIntersectsForChain($,a,h,u,Z,w),Z<_&&this.computeIntersectsForChain($,a,h,Z,_,w))}};Oh.prototype.getStartIndexes=function(){return this.startIndex};Oh.prototype.computeIntersects=function(t,e){for(var n=this,r=0;r<this.startIndex.length-1;r++)for(var i=0;i<t.startIndex.length-1;i++)n.computeIntersectsForChain(r,t,i,e)};Oh.prototype.interfaces_=function(){return[]};Oh.prototype.getClass=function(){return Oh};var Oo=function t(){var e=this;this._depth=Array(2).fill().map(function(){return Array(3)});for(var n=0;n<2;n++)for(var r=0;r<3;r++)e._depth[n][r]=t.NULL_VALUE},SS={NULL_VALUE:{configurable:!0}};Oo.prototype.getDepth=function(t,e){return this._depth[t][e]};Oo.prototype.setDepth=function(t,e,n){this._depth[t][e]=n};Oo.prototype.isNull=function(){var t=this;if(arguments.length===0){for(var e=0;e<2;e++)for(var n=0;n<3;n++)if(t._depth[e][n]!==Oo.NULL_VALUE)return!1;return!0}else if(arguments.length===1){var r=arguments[0];return this._depth[r][1]===Oo.NULL_VALUE}else if(arguments.length===2){var i=arguments[0],a=arguments[1];return this._depth[i][a]===Oo.NULL_VALUE}};Oo.prototype.normalize=function(){for(var t=this,e=0;e<2;e++)if(!t.isNull(e)){var n=t._depth[e][1];t._depth[e][2]<n&&(n=t._depth[e][2]),n<0&&(n=0);for(var r=1;r<3;r++){var i=0;t._depth[e][r]>n&&(i=1),t._depth[e][r]=i}}};Oo.prototype.getDelta=function(t){return this._depth[t][ie.RIGHT]-this._depth[t][ie.LEFT]};Oo.prototype.getLocation=function(t,e){return this._depth[t][e]<=0?Pt.EXTERIOR:Pt.INTERIOR};Oo.prototype.toString=function(){return"A: "+this._depth[0][1]+","+this._depth[0][2]+" B: "+this._depth[1][1]+","+this._depth[1][2]};Oo.prototype.add=function(){var t=this;if(arguments.length===1)for(var e=arguments[0],n=0;n<2;n++)for(var r=1;r<3;r++){var i=e.getLocation(n,r);(i===Pt.EXTERIOR||i===Pt.INTERIOR)&&(t.isNull(n,r)?t._depth[n][r]=Oo.depthAtLocation(i):t._depth[n][r]+=Oo.depthAtLocation(i))}else if(arguments.length===3){var a=arguments[0],h=arguments[1],u=arguments[2];u===Pt.INTERIOR&&this._depth[a][h]++}};Oo.prototype.interfaces_=function(){return[]};Oo.prototype.getClass=function(){return Oo};Oo.depthAtLocation=function(t){return t===Pt.EXTERIOR?0:t===Pt.INTERIOR?1:Oo.NULL_VALUE};SS.NULL_VALUE.get=function(){return-1};Object.defineProperties(Oo,SS);var zv=function(t){function e(){if(t.call(this),this.pts=null,this._env=null,this.eiList=new Vc(this),this._name=null,this._mce=null,this._isIsolated=!0,this._depth=new Oo,this._depthDelta=0,arguments.length===1){var n=arguments[0];e.call(this,n,null)}else if(arguments.length===2){var r=arguments[0],i=arguments[1];this.pts=r,this._label=i}}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.getDepth=function(){return this._depth},e.prototype.getCollapsedEdge=function(){var n=new Array(2).fill(null);n[0]=this.pts[0],n[1]=this.pts[1];var r=new e(n,pr.toLineLabel(this._label));return r},e.prototype.isIsolated=function(){return this._isIsolated},e.prototype.getCoordinates=function(){return this.pts},e.prototype.setIsolated=function(n){this._isIsolated=n},e.prototype.setName=function(n){this._name=n},e.prototype.equals=function(n){var r=this;if(!(n instanceof e))return!1;var i=n;if(this.pts.length!==i.pts.length)return!1;for(var a=!0,h=!0,u=this.pts.length,_=0;_<this.pts.length;_++)if(r.pts[_].equals2D(i.pts[_])||(a=!1),r.pts[_].equals2D(i.pts[--u])||(h=!1),!a&&!h)return!1;return!0},e.prototype.getCoordinate=function(){if(arguments.length===0)return this.pts.length>0?this.pts[0]:null;if(arguments.length===1){var n=arguments[0];return this.pts[n]}},e.prototype.print=function(n){var r=this;n.print("edge "+this._name+": "),n.print("LINESTRING (");for(var i=0;i<this.pts.length;i++)i>0&&n.print(","),n.print(r.pts[i].x+" "+r.pts[i].y);n.print(")  "+this._label+" "+this._depthDelta)},e.prototype.computeIM=function(n){e.updateIM(this._label,n)},e.prototype.isCollapsed=function(){return!this._label.isArea()||this.pts.length!==3?!1:!!this.pts[0].equals(this.pts[2])},e.prototype.isClosed=function(){return this.pts[0].equals(this.pts[this.pts.length-1])},e.prototype.getMaximumSegmentIndex=function(){return this.pts.length-1},e.prototype.getDepthDelta=function(){return this._depthDelta},e.prototype.getNumPoints=function(){return this.pts.length},e.prototype.printReverse=function(n){var r=this;n.print("edge "+this._name+": ");for(var i=this.pts.length-1;i>=0;i--)n.print(r.pts[i]+" ");n.println("")},e.prototype.getMonotoneChainEdge=function(){return this._mce===null&&(this._mce=new Oh(this)),this._mce},e.prototype.getEnvelope=function(){var n=this;if(this._env===null){this._env=new Be;for(var r=0;r<this.pts.length;r++)n._env.expandToInclude(n.pts[r])}return this._env},e.prototype.addIntersection=function(n,r,i,a){var h=new Tt(n.getIntersection(a)),u=r,_=n.getEdgeDistance(i,a),w=u+1;if(w<this.pts.length){var C=this.pts[w];h.equals2D(C)&&(u=w,_=0)}this.eiList.add(h,u,_)},e.prototype.toString=function(){var n=this,r=new fc;r.append("edge "+this._name+": "),r.append("LINESTRING (");for(var i=0;i<this.pts.length;i++)i>0&&r.append(","),r.append(n.pts[i].x+" "+n.pts[i].y);return r.append(")  "+this._label+" "+this._depthDelta),r.toString()},e.prototype.isPointwiseEqual=function(n){var r=this;if(this.pts.length!==n.pts.length)return!1;for(var i=0;i<this.pts.length;i++)if(!r.pts[i].equals2D(n.pts[i]))return!1;return!0},e.prototype.setDepthDelta=function(n){this._depthDelta=n},e.prototype.getEdgeIntersectionList=function(){return this.eiList},e.prototype.addIntersections=function(n,r,i){for(var a=this,h=0;h<n.getIntersectionNum();h++)a.addIntersection(n,r,i,h)},e.prototype.interfaces_=function(){return[]},e.prototype.getClass=function(){return e},e.updateIM=function(){if(arguments.length===2){var n=arguments[0],r=arguments[1];r.setAtLeastIfValid(n.getLocation(0,ie.ON),n.getLocation(1,ie.ON),1),n.isArea()&&(r.setAtLeastIfValid(n.getLocation(0,ie.LEFT),n.getLocation(1,ie.LEFT),2),r.setAtLeastIfValid(n.getLocation(0,ie.RIGHT),n.getLocation(1,ie.RIGHT),2))}else return t.prototype.updateIM.apply(this,arguments)},e}(Za),Cs=function(t){this._workingPrecisionModel=null,this._workingNoder=null,this._geomFact=null,this._graph=null,this._edgeList=new Ku,this._bufParams=t||null};Cs.prototype.setWorkingPrecisionModel=function(t){this._workingPrecisionModel=t};Cs.prototype.insertUniqueEdge=function(t){var e=this._edgeList.findEqualEdge(t);if(e!==null){var n=e.getLabel(),r=t.getLabel();e.isPointwiseEqual(t)||(r=new pr(t.getLabel()),r.flip()),n.merge(r);var i=Cs.depthDelta(r),a=e.getDepthDelta(),h=a+i;e.setDepthDelta(h)}else this._edgeList.add(t),t.setDepthDelta(Cs.depthDelta(t.getLabel()))};Cs.prototype.buildSubgraphs=function(t,e){for(var n=new fe,r=t.iterator();r.hasNext();){var i=r.next(),a=i.getRightmostCoordinate(),h=new Od(n),u=h.getDepth(a);i.computeDepth(u),i.findResultEdges(),n.add(i),e.add(i.getDirectedEdges(),i.getNodes())}};Cs.prototype.createSubgraphs=function(t){for(var e=new fe,n=t.getNodes().iterator();n.hasNext();){var r=n.next();if(!r.isVisited()){var i=new Ns;i.create(r),e.add(i)}}return Ju.sort(e,Ju.reverseOrder()),e};Cs.prototype.createEmptyResultGeometry=function(){var t=this._geomFact.createPolygon();return t};Cs.prototype.getNoder=function(t){if(this._workingNoder!==null)return this._workingNoder;var e=new Nb,n=new ad;return n.setPrecisionModel(t),e.setSegmentIntersector(new Wa(n)),e};Cs.prototype.buffer=function(t,e){var n=this._workingPrecisionModel;n===null&&(n=t.getPrecisionModel()),this._geomFact=t.getFactory();var r=new Js(n,this._bufParams),i=new bu(t,e,r),a=i.getCurves();if(a.size()<=0)return this.createEmptyResultGeometry();this.computeNodedEdges(a,n),this._graph=new Kr(new IS),this._graph.addEdges(this._edgeList.getEdges());var h=this.createSubgraphs(this._graph),u=new va(this._geomFact);this.buildSubgraphs(h,u);var _=u.getPolygons();if(_.size()<=0)return this.createEmptyResultGeometry();var w=this._geomFact.buildGeometry(_);return w};Cs.prototype.computeNodedEdges=function(t,e){var n=this,r=this.getNoder(e);r.computeNodes(t);for(var i=r.getNodedSubstrings(),a=i.iterator();a.hasNext();){var h=a.next(),u=h.getCoordinates();if(!(u.length===2&&u[0].equals2D(u[1]))){var _=h.getData(),w=new zv(h.getCoordinates(),new pr(_));n.insertUniqueEdge(w)}}};Cs.prototype.setNoder=function(t){this._workingNoder=t};Cs.prototype.interfaces_=function(){return[]};Cs.prototype.getClass=function(){return Cs};Cs.depthDelta=function(t){var e=t.getLocation(0,ie.LEFT),n=t.getLocation(0,ie.RIGHT);return e===Pt.INTERIOR&&n===Pt.EXTERIOR?1:e===Pt.EXTERIOR&&n===Pt.INTERIOR?-1:0};Cs.convertSegStrings=function(t){for(var e=new wn,n=new fe;t.hasNext();){var r=t.next(),i=e.createLineString(r.getCoordinates());n.add(i)}return e.buildGeometry(n)};var Mp=function(){if(this._noder=null,this._scaleFactor=null,this._offsetX=null,this._offsetY=null,this._isScaled=!1,arguments.length===2){var t=arguments[0],e=arguments[1];this._noder=t,this._scaleFactor=e,this._offsetX=0,this._offsetY=0,this._isScaled=!this.isIntegerPrecision()}else if(arguments.length===4){var n=arguments[0],r=arguments[1],i=arguments[2],a=arguments[3];this._noder=n,this._scaleFactor=r,this._offsetX=i,this._offsetY=a,this._isScaled=!this.isIntegerPrecision()}};Mp.prototype.rescale=function(){var t=this;if(tn(arguments[0],Xi))for(var e=arguments[0],n=e.iterator();n.hasNext();){var r=n.next();t.rescale(r.getCoordinates())}else if(arguments[0]instanceof Array){for(var i=arguments[0],a=0;a<i.length;a++)i[a].x=i[a].x/t._scaleFactor+t._offsetX,i[a].y=i[a].y/t._scaleFactor+t._offsetY;i.length===2&&i[0].equals2D(i[1])&&Fo.out.println(i)}};Mp.prototype.scale=function(){var t=this;if(tn(arguments[0],Xi)){for(var e=arguments[0],n=new fe,r=e.iterator();r.hasNext();){var i=r.next();n.add(new Ii(t.scale(i.getCoordinates()),i.getData()))}return n}else if(arguments[0]instanceof Array){for(var a=arguments[0],h=new Array(a.length).fill(null),u=0;u<a.length;u++)h[u]=new Tt(Math.round((a[u].x-t._offsetX)*t._scaleFactor),Math.round((a[u].y-t._offsetY)*t._scaleFactor),a[u].z);var _=In.removeRepeatedPoints(h);return _}};Mp.prototype.isIntegerPrecision=function(){return this._scaleFactor===1};Mp.prototype.getNodedSubstrings=function(){var t=this._noder.getNodedSubstrings();return this._isScaled&&this.rescale(t),t};Mp.prototype.computeNodes=function(t){var e=t;this._isScaled&&(e=this.scale(t)),this._noder.computeNodes(e)};Mp.prototype.interfaces_=function(){return[Vf]};Mp.prototype.getClass=function(){return Mp};var Ql=function(){this._li=new ad,this._segStrings=null;var t=arguments[0];this._segStrings=t},CS={fact:{configurable:!0}};Ql.prototype.checkEndPtVertexIntersections=function(){var t=this;if(arguments.length===0)for(var e=this._segStrings.iterator();e.hasNext();){var n=e.next(),r=n.getCoordinates();t.checkEndPtVertexIntersections(r[0],t._segStrings),t.checkEndPtVertexIntersections(r[r.length-1],t._segStrings)}else if(arguments.length===2){for(var i=arguments[0],a=arguments[1],h=a.iterator();h.hasNext();)for(var u=h.next(),_=u.getCoordinates(),w=1;w<_.length-1;w++)if(_[w].equals(i))throw new Ph("found endpt/interior pt intersection at index "+w+" :pt "+i)}};Ql.prototype.checkInteriorIntersections=function(){var t=this;if(arguments.length===0)for(var e=this._segStrings.iterator();e.hasNext();)for(var n=e.next(),r=this._segStrings.iterator();r.hasNext();){var i=r.next();t.checkInteriorIntersections(n,i)}else if(arguments.length===2)for(var a=arguments[0],h=arguments[1],u=a.getCoordinates(),_=h.getCoordinates(),w=0;w<u.length-1;w++)for(var C=0;C<_.length-1;C++)t.checkInteriorIntersections(a,w,h,C);else if(arguments.length===4){var P=arguments[0],D=arguments[1],B=arguments[2],$=arguments[3];if(P===B&&D===$)return null;var Z=P.getCoordinates()[D],W=P.getCoordinates()[D+1],rt=B.getCoordinates()[$],ct=B.getCoordinates()[$+1];if(this._li.computeIntersection(Z,W,rt,ct),this._li.hasIntersection()&&(this._li.isProper()||this.hasInteriorIntersection(this._li,Z,W)||this.hasInteriorIntersection(this._li,rt,ct)))throw new Ph("found non-noded intersection at "+Z+"-"+W+" and "+rt+"-"+ct)}};Ql.prototype.checkValid=function(){this.checkEndPtVertexIntersections(),this.checkInteriorIntersections(),this.checkCollapses()};Ql.prototype.checkCollapses=function(){var t=this;if(arguments.length===0)for(var e=this._segStrings.iterator();e.hasNext();){var n=e.next();t.checkCollapses(n)}else if(arguments.length===1)for(var r=arguments[0],i=r.getCoordinates(),a=0;a<i.length-2;a++)t.checkCollapse(i[a],i[a+1],i[a+2])};Ql.prototype.hasInteriorIntersection=function(t,e,n){for(var r=0;r<t.getIntersectionNum();r++){var i=t.getIntersection(r);if(!(i.equals(e)||i.equals(n)))return!0}return!1};Ql.prototype.checkCollapse=function(t,e,n){if(t.equals(n))throw new Ph("found non-noded collapse at "+Ql.fact.createLineString([t,e,n]))};Ql.prototype.interfaces_=function(){return[]};Ql.prototype.getClass=function(){return Ql};CS.fact.get=function(){return new wn};Object.defineProperties(Ql,CS);var Ks=function(){this._li=null,this._pt=null,this._originalPt=null,this._ptScaled=null,this._p0Scaled=null,this._p1Scaled=null,this._scaleFactor=null,this._minx=null,this._maxx=null,this._miny=null,this._maxy=null,this._corner=new Array(4).fill(null),this._safeEnv=null;var t=arguments[0],e=arguments[1],n=arguments[2];if(this._originalPt=t,this._pt=t,this._scaleFactor=e,this._li=n,e<=0)throw new Xr("Scale factor must be non-zero");e!==1&&(this._pt=new Tt(this.scale(t.x),this.scale(t.y)),this._p0Scaled=new Tt,this._p1Scaled=new Tt),this.initCorners(this._pt)},TS={SAFE_ENV_EXPANSION_FACTOR:{configurable:!0}};Ks.prototype.intersectsScaled=function(t,e){var n=Math.min(t.x,e.x),r=Math.max(t.x,e.x),i=Math.min(t.y,e.y),a=Math.max(t.y,e.y),h=this._maxx<n||this._minx>r||this._maxy<i||this._miny>a;if(h)return!1;var u=this.intersectsToleranceSquare(t,e);return fn.isTrue(!(h&&u),"Found bad envelope test"),u};Ks.prototype.initCorners=function(t){var e=.5;this._minx=t.x-e,this._maxx=t.x+e,this._miny=t.y-e,this._maxy=t.y+e,this._corner[0]=new Tt(this._maxx,this._maxy),this._corner[1]=new Tt(this._minx,this._maxy),this._corner[2]=new Tt(this._minx,this._miny),this._corner[3]=new Tt(this._maxx,this._miny)};Ks.prototype.intersects=function(t,e){return this._scaleFactor===1?this.intersectsScaled(t,e):(this.copyScaled(t,this._p0Scaled),this.copyScaled(e,this._p1Scaled),this.intersectsScaled(this._p0Scaled,this._p1Scaled))};Ks.prototype.scale=function(t){return Math.round(t*this._scaleFactor)};Ks.prototype.getCoordinate=function(){return this._originalPt};Ks.prototype.copyScaled=function(t,e){e.x=this.scale(t.x),e.y=this.scale(t.y)};Ks.prototype.getSafeEnvelope=function(){if(this._safeEnv===null){var t=Ks.SAFE_ENV_EXPANSION_FACTOR/this._scaleFactor;this._safeEnv=new Be(this._originalPt.x-t,this._originalPt.x+t,this._originalPt.y-t,this._originalPt.y+t)}return this._safeEnv};Ks.prototype.intersectsPixelClosure=function(t,e){return this._li.computeIntersection(t,e,this._corner[0],this._corner[1]),!!(this._li.hasIntersection()||(this._li.computeIntersection(t,e,this._corner[1],this._corner[2]),this._li.hasIntersection())||(this._li.computeIntersection(t,e,this._corner[2],this._corner[3]),this._li.hasIntersection())||(this._li.computeIntersection(t,e,this._corner[3],this._corner[0]),this._li.hasIntersection()))};Ks.prototype.intersectsToleranceSquare=function(t,e){var n=!1,r=!1;return this._li.computeIntersection(t,e,this._corner[0],this._corner[1]),!!(this._li.isProper()||(this._li.computeIntersection(t,e,this._corner[1],this._corner[2]),this._li.isProper())||(this._li.hasIntersection()&&(n=!0),this._li.computeIntersection(t,e,this._corner[2],this._corner[3]),this._li.isProper())||(this._li.hasIntersection()&&(r=!0),this._li.computeIntersection(t,e,this._corner[3],this._corner[0]),this._li.isProper())||n&&r||t.equals(this._pt)||e.equals(this._pt))};Ks.prototype.addSnappedNode=function(t,e){var n=t.getCoordinate(e),r=t.getCoordinate(e+1);return this.intersects(n,r)?(t.addIntersection(this.getCoordinate(),e),!0):!1};Ks.prototype.interfaces_=function(){return[]};Ks.prototype.getClass=function(){return Ks};TS.SAFE_ENV_EXPANSION_FACTOR.get=function(){return .75};Object.defineProperties(Ks,TS);var Wy=function(){this.tempEnv1=new Be,this.selectedSegment=new Ve};Wy.prototype.select=function(){if(arguments.length!==1&&arguments.length===2){var t=arguments[0],e=arguments[1];t.getLineSegment(e,this.selectedSegment),this.select(this.selectedSegment)}};Wy.prototype.interfaces_=function(){return[]};Wy.prototype.getClass=function(){return Wy};var nm=function(){this._index=null;var t=arguments[0];this._index=t},LS={HotPixelSnapAction:{configurable:!0}};nm.prototype.snap=function(){if(arguments.length===1){var t=arguments[0];return this.snap(t,null,-1)}else if(arguments.length===3){var e=arguments[0],n=arguments[1],r=arguments[2],i=e.getSafeEnvelope(),a=new NS(e,n,r);return this._index.query(i,{interfaces_:function(){return[Lp]},visitItem:function(h){var u=h;u.select(i,a)}}),a.isNodeAdded()}};nm.prototype.interfaces_=function(){return[]};nm.prototype.getClass=function(){return nm};LS.HotPixelSnapAction.get=function(){return NS};Object.defineProperties(nm,LS);var NS=function(t){function e(){t.call(this),this._hotPixel=null,this._parentEdge=null,this._hotPixelVertexIndex=null,this._isNodeAdded=!1;var n=arguments[0],r=arguments[1],i=arguments[2];this._hotPixel=n,this._parentEdge=r,this._hotPixelVertexIndex=i}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.isNodeAdded=function(){return this._isNodeAdded},e.prototype.select=function(){if(arguments.length===2){var n=arguments[0],r=arguments[1],i=n.getContext();if(this._parentEdge!==null&&i===this._parentEdge&&r===this._hotPixelVertexIndex)return null;this._isNodeAdded=this._hotPixel.addSnappedNode(i,r)}else return t.prototype.select.apply(this,arguments)},e.prototype.interfaces_=function(){return[]},e.prototype.getClass=function(){return e},e}(Wy),Rd=function(){this._li=null,this._interiorIntersections=null;var t=arguments[0];this._li=t,this._interiorIntersections=new fe};Rd.prototype.processIntersections=function(t,e,n,r){var i=this;if(t===n&&e===r)return null;var a=t.getCoordinates()[e],h=t.getCoordinates()[e+1],u=n.getCoordinates()[r],_=n.getCoordinates()[r+1];if(this._li.computeIntersection(a,h,u,_),this._li.hasIntersection()&&this._li.isInteriorIntersection()){for(var w=0;w<this._li.getIntersectionNum();w++)i._interiorIntersections.add(i._li.getIntersection(w));t.addIntersections(this._li,e,0),n.addIntersections(this._li,r,1)}};Rd.prototype.isDone=function(){return!1};Rd.prototype.getInteriorIntersections=function(){return this._interiorIntersections};Rd.prototype.interfaces_=function(){return[Gf]};Rd.prototype.getClass=function(){return Rd};var Uc=function(){this._pm=null,this._li=null,this._scaleFactor=null,this._noder=null,this._pointSnapper=null,this._nodedSegStrings=null;var t=arguments[0];this._pm=t,this._li=new ad,this._li.setPrecisionModel(t),this._scaleFactor=t.getScale()};Uc.prototype.checkCorrectness=function(t){var e=Ii.getNodedSubstrings(t),n=new Ql(e);try{n.checkValid()}catch(r){if(r instanceof pS)r.printStackTrace();else throw r}finally{}};Uc.prototype.getNodedSubstrings=function(){return Ii.getNodedSubstrings(this._nodedSegStrings)};Uc.prototype.snapRound=function(t,e){var n=this.findInteriorIntersections(t,e);this.computeIntersectionSnaps(n),this.computeVertexSnaps(t)};Uc.prototype.findInteriorIntersections=function(t,e){var n=new Rd(e);return this._noder.setSegmentIntersector(n),this._noder.computeNodes(t),n.getInteriorIntersections()};Uc.prototype.computeVertexSnaps=function(){var t=this;if(tn(arguments[0],Xi))for(var e=arguments[0],n=e.iterator();n.hasNext();){var r=n.next();t.computeVertexSnaps(r)}else if(arguments[0]instanceof Ii)for(var i=arguments[0],a=i.getCoordinates(),h=0;h<a.length;h++){var u=new Ks(a[h],t._scaleFactor,t._li),_=t._pointSnapper.snap(u,i,h);_&&i.addIntersection(a[h],h)}};Uc.prototype.computeNodes=function(t){this._nodedSegStrings=t,this._noder=new Nb,this._pointSnapper=new nm(this._noder.getIndex()),this.snapRound(t,this._li)};Uc.prototype.computeIntersectionSnaps=function(t){for(var e=this,n=t.iterator();n.hasNext();){var r=n.next(),i=new Ks(r,e._scaleFactor,e._li);e._pointSnapper.snap(i)}};Uc.prototype.interfaces_=function(){return[Vf]};Uc.prototype.getClass=function(){return Uc};var Ao=function(){if(this._argGeom=null,this._distance=null,this._bufParams=new Jn,this._resultGeometry=null,this._saveException=null,arguments.length===1){var t=arguments[0];this._argGeom=t}else if(arguments.length===2){var e=arguments[0],n=arguments[1];this._argGeom=e,this._bufParams=n}},Fm={CAP_ROUND:{configurable:!0},CAP_BUTT:{configurable:!0},CAP_FLAT:{configurable:!0},CAP_SQUARE:{configurable:!0},MAX_PRECISION_DIGITS:{configurable:!0}};Ao.prototype.bufferFixedPrecision=function(t){var e=new Mp(new Uc(new Qn(1)),t.getScale()),n=new Cs(this._bufParams);n.setWorkingPrecisionModel(t),n.setNoder(e),this._resultGeometry=n.buffer(this._argGeom,this._distance)};Ao.prototype.bufferReducedPrecision=function(){var t=this;if(arguments.length===0){for(var e=Ao.MAX_PRECISION_DIGITS;e>=0;e--){try{t.bufferReducedPrecision(e)}catch(a){if(a instanceof Ah)t._saveException=a;else throw a}finally{}if(t._resultGeometry!==null)return null}throw this._saveException}else if(arguments.length===1){var n=arguments[0],r=Ao.precisionScaleFactor(this._argGeom,this._distance,n),i=new Qn(r);this.bufferFixedPrecision(i)}};Ao.prototype.computeGeometry=function(){if(this.bufferOriginalPrecision(),this._resultGeometry!==null)return null;var t=this._argGeom.getFactory().getPrecisionModel();t.getType()===Qn.FIXED?this.bufferFixedPrecision(t):this.bufferReducedPrecision()};Ao.prototype.setQuadrantSegments=function(t){this._bufParams.setQuadrantSegments(t)};Ao.prototype.bufferOriginalPrecision=function(){try{var t=new Cs(this._bufParams);this._resultGeometry=t.buffer(this._argGeom,this._distance)}catch(e){if(e instanceof Ph)this._saveException=e;else throw e}finally{}};Ao.prototype.getResultGeometry=function(t){return this._distance=t,this.computeGeometry(),this._resultGeometry};Ao.prototype.setEndCapStyle=function(t){this._bufParams.setEndCapStyle(t)};Ao.prototype.interfaces_=function(){return[]};Ao.prototype.getClass=function(){return Ao};Ao.bufferOp=function(){if(arguments.length===2){var t=arguments[0],e=arguments[1],n=new Ao(t),r=n.getResultGeometry(e);return r}else if(arguments.length===3){if(Number.isInteger(arguments[2])&&arguments[0]instanceof We&&typeof arguments[1]=="number"){var i=arguments[0],a=arguments[1],h=arguments[2],u=new Ao(i);u.setQuadrantSegments(h);var _=u.getResultGeometry(a);return _}else if(arguments[2]instanceof Jn&&arguments[0]instanceof We&&typeof arguments[1]=="number"){var w=arguments[0],C=arguments[1],P=arguments[2],D=new Ao(w,P),B=D.getResultGeometry(C);return B}}else if(arguments.length===4){var $=arguments[0],Z=arguments[1],W=arguments[2],rt=arguments[3],ct=new Ao($);ct.setQuadrantSegments(W),ct.setEndCapStyle(rt);var pt=ct.getResultGeometry(Z);return pt}};Ao.precisionScaleFactor=function(t,e,n){var r=t.getEnvelopeInternal(),i=Ya.max(Math.abs(r.getMaxX()),Math.abs(r.getMaxY()),Math.abs(r.getMinX()),Math.abs(r.getMinY())),a=e>0?e:0,h=i+2*a,u=Math.trunc(Math.log(h)/Math.log(10)+1),_=n-u,w=Math.pow(10,_);return w};Fm.CAP_ROUND.get=function(){return Jn.CAP_ROUND};Fm.CAP_BUTT.get=function(){return Jn.CAP_FLAT};Fm.CAP_FLAT.get=function(){return Jn.CAP_FLAT};Fm.CAP_SQUARE.get=function(){return Jn.CAP_SQUARE};Fm.MAX_PRECISION_DIGITS.get=function(){return 12};Object.defineProperties(Ao,Fm);var xs=function(){this._pt=[new Tt,new Tt],this._distance=un.NaN,this._isNull=!0};xs.prototype.getCoordinates=function(){return this._pt};xs.prototype.getCoordinate=function(t){return this._pt[t]};xs.prototype.setMinimum=function(){if(arguments.length===1){var t=arguments[0];this.setMinimum(t._pt[0],t._pt[1])}else if(arguments.length===2){var e=arguments[0],n=arguments[1];if(this._isNull)return this.initialize(e,n),null;var r=e.distance(n);r<this._distance&&this.initialize(e,n,r)}};xs.prototype.initialize=function(){if(arguments.length===0)this._isNull=!0;else if(arguments.length===2){var t=arguments[0],e=arguments[1];this._pt[0].setCoordinate(t),this._pt[1].setCoordinate(e),this._distance=t.distance(e),this._isNull=!1}else if(arguments.length===3){var n=arguments[0],r=arguments[1],i=arguments[2];this._pt[0].setCoordinate(n),this._pt[1].setCoordinate(r),this._distance=i,this._isNull=!1}};xs.prototype.getDistance=function(){return this._distance};xs.prototype.setMaximum=function(){if(arguments.length===1){var t=arguments[0];this.setMaximum(t._pt[0],t._pt[1])}else if(arguments.length===2){var e=arguments[0],n=arguments[1];if(this._isNull)return this.initialize(e,n),null;var r=e.distance(n);r>this._distance&&this.initialize(e,n,r)}};xs.prototype.interfaces_=function(){return[]};xs.prototype.getClass=function(){return xs};var Nc=function(){};Nc.prototype.interfaces_=function(){return[]};Nc.prototype.getClass=function(){return Nc};Nc.computeDistance=function(){if(arguments[2]instanceof xs&&arguments[0]instanceof si&&arguments[1]instanceof Tt)for(var t=arguments[0],e=arguments[1],n=arguments[2],r=t.getCoordinates(),i=new Ve,a=0;a<r.length-1;a++){i.setCoordinates(r[a],r[a+1]);var h=i.closestPoint(e);n.setMinimum(h,e)}else if(arguments[2]instanceof xs&&arguments[0]instanceof to&&arguments[1]instanceof Tt){var u=arguments[0],_=arguments[1],w=arguments[2];Nc.computeDistance(u.getExteriorRing(),_,w);for(var C=0;C<u.getNumInteriorRing();C++)Nc.computeDistance(u.getInteriorRingN(C),_,w)}else if(arguments[2]instanceof xs&&arguments[0]instanceof We&&arguments[1]instanceof Tt){var P=arguments[0],D=arguments[1],B=arguments[2];if(P instanceof si)Nc.computeDistance(P,D,B);else if(P instanceof to)Nc.computeDistance(P,D,B);else if(P instanceof Ls)for(var $=P,Z=0;Z<$.getNumGeometries();Z++){var W=$.getGeometryN(Z);Nc.computeDistance(W,D,B)}else B.setMinimum(P.getCoordinate(),D)}else if(arguments[2]instanceof xs&&arguments[0]instanceof Ve&&arguments[1]instanceof Tt){var rt=arguments[0],ct=arguments[1],pt=arguments[2],gt=rt.closestPoint(ct);pt.setMinimum(gt,ct)}};var jf=function(t){this._maxPtDist=new xs,this._inputGeom=t||null},Pb={MaxPointDistanceFilter:{configurable:!0},MaxMidpointDistanceFilter:{configurable:!0}};jf.prototype.computeMaxMidpointDistance=function(t){var e=new Ap(this._inputGeom);t.apply(e),this._maxPtDist.setMaximum(e.getMaxPointDistance())};jf.prototype.computeMaxVertexDistance=function(t){var e=new Fd(this._inputGeom);t.apply(e),this._maxPtDist.setMaximum(e.getMaxPointDistance())};jf.prototype.findDistance=function(t){return this.computeMaxVertexDistance(t),this.computeMaxMidpointDistance(t),this._maxPtDist.getDistance()};jf.prototype.getDistancePoints=function(){return this._maxPtDist};jf.prototype.interfaces_=function(){return[]};jf.prototype.getClass=function(){return jf};Pb.MaxPointDistanceFilter.get=function(){return Fd};Pb.MaxMidpointDistanceFilter.get=function(){return Ap};Object.defineProperties(jf,Pb);var Fd=function(t){this._maxPtDist=new xs,this._minPtDist=new xs,this._geom=t||null};Fd.prototype.filter=function(t){this._minPtDist.initialize(),Nc.computeDistance(this._geom,t,this._minPtDist),this._maxPtDist.setMaximum(this._minPtDist)};Fd.prototype.getMaxPointDistance=function(){return this._maxPtDist};Fd.prototype.interfaces_=function(){return[kc]};Fd.prototype.getClass=function(){return Fd};var Ap=function(t){this._maxPtDist=new xs,this._minPtDist=new xs,this._geom=t||null};Ap.prototype.filter=function(t,e){if(e===0)return null;var n=t.getCoordinate(e-1),r=t.getCoordinate(e),i=new Tt((n.x+r.x)/2,(n.y+r.y)/2);this._minPtDist.initialize(),Nc.computeDistance(this._geom,i,this._minPtDist),this._maxPtDist.setMaximum(this._minPtDist)};Ap.prototype.isDone=function(){return!1};Ap.prototype.isGeometryChanged=function(){return!1};Ap.prototype.getMaxPointDistance=function(){return this._maxPtDist};Ap.prototype.interfaces_=function(){return[Hu]};Ap.prototype.getClass=function(){return Ap};var Lh=function(t){this._comps=t||null};Lh.prototype.filter=function(t){t instanceof to&&this._comps.add(t)};Lh.prototype.interfaces_=function(){return[Zl]};Lh.prototype.getClass=function(){return Lh};Lh.getPolygons=function(){if(arguments.length===1){var t=arguments[0];return Lh.getPolygons(t,new fe)}else if(arguments.length===2){var e=arguments[0],n=arguments[1];return e instanceof to?n.add(e):e instanceof Ls&&e.apply(new Lh(n)),n}};var Po=function(){if(this._lines=null,this._isForcedToLineString=!1,arguments.length===1){var t=arguments[0];this._lines=t}else if(arguments.length===2){var e=arguments[0],n=arguments[1];this._lines=e,this._isForcedToLineString=n}};Po.prototype.filter=function(t){if(this._isForcedToLineString&&t instanceof zc){var e=t.getFactory().createLineString(t.getCoordinateSequence());return this._lines.add(e),null}t instanceof si&&this._lines.add(t)};Po.prototype.setForceToLineString=function(t){this._isForcedToLineString=t};Po.prototype.interfaces_=function(){return[Mh]};Po.prototype.getClass=function(){return Po};Po.getGeometry=function(){if(arguments.length===1){var t=arguments[0];return t.getFactory().buildGeometry(Po.getLines(t))}else if(arguments.length===2){var e=arguments[0],n=arguments[1];return e.getFactory().buildGeometry(Po.getLines(e,n))}};Po.getLines=function(){if(arguments.length===1){var t=arguments[0];return Po.getLines(t,!1)}else if(arguments.length===2){if(tn(arguments[0],Xi)&&tn(arguments[1],Xi)){for(var e=arguments[0],n=arguments[1],r=e.iterator();r.hasNext();){var i=r.next();Po.getLines(i,n)}return n}else if(arguments[0]instanceof We&&typeof arguments[1]=="boolean"){var a=arguments[0],h=arguments[1],u=new fe;return a.apply(new Po(u,h)),u}else if(arguments[0]instanceof We&&tn(arguments[1],Xi)){var _=arguments[0],w=arguments[1];return _ instanceof si?w.add(_):_.apply(new Po(w)),w}}else if(arguments.length===3){if(typeof arguments[2]=="boolean"&&tn(arguments[0],Xi)&&tn(arguments[1],Xi)){for(var C=arguments[0],P=arguments[1],D=arguments[2],B=C.iterator();B.hasNext();){var $=B.next();Po.getLines($,P,D)}return P}else if(typeof arguments[2]=="boolean"&&arguments[0]instanceof We&&tn(arguments[1],Xi)){var Z=arguments[0],W=arguments[1],rt=arguments[2];return Z.apply(new Po(W,rt)),W}}};var Qu=function(){if(this._boundaryRule=vu.OGC_SFS_BOUNDARY_RULE,this._isIn=null,this._numBoundaries=null,arguments.length!==0&&arguments.length===1){var t=arguments[0];if(t===null)throw new Xr("Rule must be non-null");this._boundaryRule=t}};Qu.prototype.locateInternal=function(){var t=this;if(arguments[0]instanceof Tt&&arguments[1]instanceof to){var e=arguments[0],n=arguments[1];if(n.isEmpty())return Pt.EXTERIOR;var r=n.getExteriorRing(),i=this.locateInPolygonRing(e,r);if(i===Pt.EXTERIOR)return Pt.EXTERIOR;if(i===Pt.BOUNDARY)return Pt.BOUNDARY;for(var a=0;a<n.getNumInteriorRing();a++){var h=n.getInteriorRingN(a),u=t.locateInPolygonRing(e,h);if(u===Pt.INTERIOR)return Pt.EXTERIOR;if(u===Pt.BOUNDARY)return Pt.BOUNDARY}return Pt.INTERIOR}else if(arguments[0]instanceof Tt&&arguments[1]instanceof si){var _=arguments[0],w=arguments[1];if(!w.getEnvelopeInternal().intersects(_))return Pt.EXTERIOR;var C=w.getCoordinates();return!w.isClosed()&&(_.equals(C[0])||_.equals(C[C.length-1]))?Pt.BOUNDARY:Se.isOnLine(_,C)?Pt.INTERIOR:Pt.EXTERIOR}else if(arguments[0]instanceof Tt&&arguments[1]instanceof _a){var P=arguments[0],D=arguments[1],B=D.getCoordinate();return B.equals2D(P)?Pt.INTERIOR:Pt.EXTERIOR}};Qu.prototype.locateInPolygonRing=function(t,e){return e.getEnvelopeInternal().intersects(t)?Se.locatePointInRing(t,e.getCoordinates()):Pt.EXTERIOR};Qu.prototype.intersects=function(t,e){return this.locate(t,e)!==Pt.EXTERIOR};Qu.prototype.updateLocationInfo=function(t){t===Pt.INTERIOR&&(this._isIn=!0),t===Pt.BOUNDARY&&this._numBoundaries++};Qu.prototype.computeLocation=function(t,e){var n=this;if(e instanceof _a&&this.updateLocationInfo(this.locateInternal(t,e)),e instanceof si)this.updateLocationInfo(this.locateInternal(t,e));else if(e instanceof to)this.updateLocationInfo(this.locateInternal(t,e));else if(e instanceof $f)for(var r=e,i=0;i<r.getNumGeometries();i++){var a=r.getGeometryN(i);n.updateLocationInfo(n.locateInternal(t,a))}else if(e instanceof Dc)for(var h=e,u=0;u<h.getNumGeometries();u++){var _=h.getGeometryN(u);n.updateLocationInfo(n.locateInternal(t,_))}else if(e instanceof Ls)for(var w=new Oc(e);w.hasNext();){var C=w.next();C!==e&&n.computeLocation(t,C)}};Qu.prototype.locate=function(t,e){return e.isEmpty()?Pt.EXTERIOR:e instanceof si?this.locateInternal(t,e):e instanceof to?this.locateInternal(t,e):(this._isIn=!1,this._numBoundaries=0,this.computeLocation(t,e),this._boundaryRule.isInBoundary(this._numBoundaries)?Pt.BOUNDARY:this._numBoundaries>0||this._isIn?Pt.INTERIOR:Pt.EXTERIOR)};Qu.prototype.interfaces_=function(){return[]};Qu.prototype.getClass=function(){return Qu};var bs=function t(){if(this._component=null,this._segIndex=null,this._pt=null,arguments.length===2){var e=arguments[0],n=arguments[1];t.call(this,e,t.INSIDE_AREA,n)}else if(arguments.length===3){var r=arguments[0],i=arguments[1],a=arguments[2];this._component=r,this._segIndex=i,this._pt=a}},PS={INSIDE_AREA:{configurable:!0}};bs.prototype.isInsideArea=function(){return this._segIndex===bs.INSIDE_AREA};bs.prototype.getCoordinate=function(){return this._pt};bs.prototype.getGeometryComponent=function(){return this._component};bs.prototype.getSegmentIndex=function(){return this._segIndex};bs.prototype.interfaces_=function(){return[]};bs.prototype.getClass=function(){return bs};PS.INSIDE_AREA.get=function(){return-1};Object.defineProperties(bs,PS);var xp=function(t){this._pts=t||null};xp.prototype.filter=function(t){t instanceof _a&&this._pts.add(t)};xp.prototype.interfaces_=function(){return[Zl]};xp.prototype.getClass=function(){return xp};xp.getPoints=function(){if(arguments.length===1){var t=arguments[0];return t instanceof _a?Ju.singletonList(t):xp.getPoints(t,new fe)}else if(arguments.length===2){var e=arguments[0],n=arguments[1];return e instanceof _a?n.add(e):e instanceof Ls&&e.apply(new xp(n)),n}};var kd=function(){this._locations=null;var t=arguments[0];this._locations=t};kd.prototype.filter=function(t){(t instanceof _a||t instanceof si||t instanceof to)&&this._locations.add(new bs(t,0,t.getCoordinate()))};kd.prototype.interfaces_=function(){return[Zl]};kd.prototype.getClass=function(){return kd};kd.getLocations=function(t){var e=new fe;return t.apply(new kd(e)),e};var zo=function(){if(this._geom=null,this._terminateDistance=0,this._ptLocator=new Qu,this._minDistanceLocation=null,this._minDistance=un.MAX_VALUE,arguments.length===2){var t=arguments[0],e=arguments[1];this._geom=[t,e],this._terminateDistance=0}else if(arguments.length===3){var n=arguments[0],r=arguments[1],i=arguments[2];this._geom=new Array(2).fill(null),this._geom[0]=n,this._geom[1]=r,this._terminateDistance=i}};zo.prototype.computeContainmentDistance=function(){var t=this;if(arguments.length===0){var e=new Array(2).fill(null);if(this.computeContainmentDistance(0,e),this._minDistance<=this._terminateDistance)return null;this.computeContainmentDistance(1,e)}else if(arguments.length===2){var n=arguments[0],r=arguments[1],i=1-n,a=Lh.getPolygons(this._geom[n]);if(a.size()>0){var h=kd.getLocations(this._geom[i]);if(this.computeContainmentDistance(h,a,r),this._minDistance<=this._terminateDistance)return this._minDistanceLocation[i]=r[0],this._minDistanceLocation[n]=r[1],null}}else if(arguments.length===3){if(arguments[2]instanceof Array&&tn(arguments[0],ju)&&tn(arguments[1],ju)){for(var u=arguments[0],_=arguments[1],w=arguments[2],C=0;C<u.size();C++)for(var P=u.get(C),D=0;D<_.size();D++)if(t.computeContainmentDistance(P,_.get(D),w),t._minDistance<=t._terminateDistance)return null}else if(arguments[2]instanceof Array&&arguments[0]instanceof bs&&arguments[1]instanceof to){var B=arguments[0],$=arguments[1],Z=arguments[2],W=B.getCoordinate();if(Pt.EXTERIOR!==this._ptLocator.locate(W,$))return this._minDistance=0,Z[0]=B,Z[1]=new bs($,W),null}}};zo.prototype.computeMinDistanceLinesPoints=function(t,e,n){for(var r=this,i=0;i<t.size();i++)for(var a=t.get(i),h=0;h<e.size();h++){var u=e.get(h);if(r.computeMinDistance(a,u,n),r._minDistance<=r._terminateDistance)return null}};zo.prototype.computeFacetDistance=function(){var t=new Array(2).fill(null),e=Po.getLines(this._geom[0]),n=Po.getLines(this._geom[1]),r=xp.getPoints(this._geom[0]),i=xp.getPoints(this._geom[1]);if(this.computeMinDistanceLines(e,n,t),this.updateMinDistance(t,!1),this._minDistance<=this._terminateDistance||(t[0]=null,t[1]=null,this.computeMinDistanceLinesPoints(e,i,t),this.updateMinDistance(t,!1),this._minDistance<=this._terminateDistance)||(t[0]=null,t[1]=null,this.computeMinDistanceLinesPoints(n,r,t),this.updateMinDistance(t,!0),this._minDistance<=this._terminateDistance))return null;t[0]=null,t[1]=null,this.computeMinDistancePoints(r,i,t),this.updateMinDistance(t,!1)};zo.prototype.nearestLocations=function(){return this.computeMinDistance(),this._minDistanceLocation};zo.prototype.updateMinDistance=function(t,e){if(t[0]===null)return null;e?(this._minDistanceLocation[0]=t[1],this._minDistanceLocation[1]=t[0]):(this._minDistanceLocation[0]=t[0],this._minDistanceLocation[1]=t[1])};zo.prototype.nearestPoints=function(){this.computeMinDistance();var t=[this._minDistanceLocation[0].getCoordinate(),this._minDistanceLocation[1].getCoordinate()];return t};zo.prototype.computeMinDistance=function(){var t=this;if(arguments.length===0){if(this._minDistanceLocation!==null||(this._minDistanceLocation=new Array(2).fill(null),this.computeContainmentDistance(),this._minDistance<=this._terminateDistance))return null;this.computeFacetDistance()}else if(arguments.length===3){if(arguments[2]instanceof Array&&arguments[0]instanceof si&&arguments[1]instanceof _a){var e=arguments[0],n=arguments[1],r=arguments[2];if(e.getEnvelopeInternal().distance(n.getEnvelopeInternal())>this._minDistance)return null;for(var i=e.getCoordinates(),a=n.getCoordinate(),h=0;h<i.length-1;h++){var u=Se.distancePointLine(a,i[h],i[h+1]);if(u<t._minDistance){t._minDistance=u;var _=new Ve(i[h],i[h+1]),w=_.closestPoint(a);r[0]=new bs(e,h,w),r[1]=new bs(n,0,a)}if(t._minDistance<=t._terminateDistance)return null}}else if(arguments[2]instanceof Array&&arguments[0]instanceof si&&arguments[1]instanceof si){var C=arguments[0],P=arguments[1],D=arguments[2];if(C.getEnvelopeInternal().distance(P.getEnvelopeInternal())>this._minDistance)return null;for(var B=C.getCoordinates(),$=P.getCoordinates(),Z=0;Z<B.length-1;Z++)for(var W=0;W<$.length-1;W++){var rt=Se.distanceLineLine(B[Z],B[Z+1],$[W],$[W+1]);if(rt<t._minDistance){t._minDistance=rt;var ct=new Ve(B[Z],B[Z+1]),pt=new Ve($[W],$[W+1]),gt=ct.closestPoints(pt);D[0]=new bs(C,Z,gt[0]),D[1]=new bs(P,W,gt[1])}if(t._minDistance<=t._terminateDistance)return null}}}};zo.prototype.computeMinDistancePoints=function(t,e,n){for(var r=this,i=0;i<t.size();i++)for(var a=t.get(i),h=0;h<e.size();h++){var u=e.get(h),_=a.getCoordinate().distance(u.getCoordinate());if(_<r._minDistance&&(r._minDistance=_,n[0]=new bs(a,0,a.getCoordinate()),n[1]=new bs(u,0,u.getCoordinate())),r._minDistance<=r._terminateDistance)return null}};zo.prototype.distance=function(){if(this._geom[0]===null||this._geom[1]===null)throw new Xr("null geometries are not supported");return this._geom[0].isEmpty()||this._geom[1].isEmpty()?0:(this.computeMinDistance(),this._minDistance)};zo.prototype.computeMinDistanceLines=function(t,e,n){for(var r=this,i=0;i<t.size();i++)for(var a=t.get(i),h=0;h<e.size();h++){var u=e.get(h);if(r.computeMinDistance(a,u,n),r._minDistance<=r._terminateDistance)return null}};zo.prototype.interfaces_=function(){return[]};zo.prototype.getClass=function(){return zo};zo.distance=function(t,e){var n=new zo(t,e);return n.distance()};zo.isWithinDistance=function(t,e,n){var r=new zo(t,e,n);return r.distance()<=n};zo.nearestPoints=function(t,e){var n=new zo(t,e);return n.nearestPoints()};var Jo=function(){this._pt=[new Tt,new Tt],this._distance=un.NaN,this._isNull=!0};Jo.prototype.getCoordinates=function(){return this._pt};Jo.prototype.getCoordinate=function(t){return this._pt[t]};Jo.prototype.setMinimum=function(){if(arguments.length===1){var t=arguments[0];this.setMinimum(t._pt[0],t._pt[1])}else if(arguments.length===2){var e=arguments[0],n=arguments[1];if(this._isNull)return this.initialize(e,n),null;var r=e.distance(n);r<this._distance&&this.initialize(e,n,r)}};Jo.prototype.initialize=function(){if(arguments.length===0)this._isNull=!0;else if(arguments.length===2){var t=arguments[0],e=arguments[1];this._pt[0].setCoordinate(t),this._pt[1].setCoordinate(e),this._distance=t.distance(e),this._isNull=!1}else if(arguments.length===3){var n=arguments[0],r=arguments[1],i=arguments[2];this._pt[0].setCoordinate(n),this._pt[1].setCoordinate(r),this._distance=i,this._isNull=!1}};Jo.prototype.toString=function(){return Zu.toLineString(this._pt[0],this._pt[1])};Jo.prototype.getDistance=function(){return this._distance};Jo.prototype.setMaximum=function(){if(arguments.length===1){var t=arguments[0];this.setMaximum(t._pt[0],t._pt[1])}else if(arguments.length===2){var e=arguments[0],n=arguments[1];if(this._isNull)return this.initialize(e,n),null;var r=e.distance(n);r>this._distance&&this.initialize(e,n,r)}};Jo.prototype.interfaces_=function(){return[]};Jo.prototype.getClass=function(){return Jo};var Bl=function(){};Bl.prototype.interfaces_=function(){return[]};Bl.prototype.getClass=function(){return Bl};Bl.computeDistance=function(){if(arguments[2]instanceof Jo&&arguments[0]instanceof si&&arguments[1]instanceof Tt)for(var t=arguments[0],e=arguments[1],n=arguments[2],r=new Ve,i=t.getCoordinates(),a=0;a<i.length-1;a++){r.setCoordinates(i[a],i[a+1]);var h=r.closestPoint(e);n.setMinimum(h,e)}else if(arguments[2]instanceof Jo&&arguments[0]instanceof to&&arguments[1]instanceof Tt){var u=arguments[0],_=arguments[1],w=arguments[2];Bl.computeDistance(u.getExteriorRing(),_,w);for(var C=0;C<u.getNumInteriorRing();C++)Bl.computeDistance(u.getInteriorRingN(C),_,w)}else if(arguments[2]instanceof Jo&&arguments[0]instanceof We&&arguments[1]instanceof Tt){var P=arguments[0],D=arguments[1],B=arguments[2];if(P instanceof si)Bl.computeDistance(P,D,B);else if(P instanceof to)Bl.computeDistance(P,D,B);else if(P instanceof Ls)for(var $=P,Z=0;Z<$.getNumGeometries();Z++){var W=$.getGeometryN(Z);Bl.computeDistance(W,D,B)}else B.setMinimum(P.getCoordinate(),D)}else if(arguments[2]instanceof Jo&&arguments[0]instanceof Ve&&arguments[1]instanceof Tt){var rt=arguments[0],ct=arguments[1],pt=arguments[2],gt=rt.closestPoint(ct);pt.setMinimum(gt,ct)}};var gu=function(){this._g0=null,this._g1=null,this._ptDist=new Jo,this._densifyFrac=0;var t=arguments[0],e=arguments[1];this._g0=t,this._g1=e},Mb={MaxPointDistanceFilter:{configurable:!0},MaxDensifiedByFractionDistanceFilter:{configurable:!0}};gu.prototype.getCoordinates=function(){return this._ptDist.getCoordinates()};gu.prototype.setDensifyFraction=function(t){if(t>1||t<=0)throw new Xr("Fraction is not in range (0.0 - 1.0]");this._densifyFrac=t};gu.prototype.compute=function(t,e){this.computeOrientedDistance(t,e,this._ptDist),this.computeOrientedDistance(e,t,this._ptDist)};gu.prototype.distance=function(){return this.compute(this._g0,this._g1),this._ptDist.getDistance()};gu.prototype.computeOrientedDistance=function(t,e,n){var r=new zd(e);if(t.apply(r),n.setMaximum(r.getMaxPointDistance()),this._densifyFrac>0){var i=new Dp(e,this._densifyFrac);t.apply(i),n.setMaximum(i.getMaxPointDistance())}};gu.prototype.orientedDistance=function(){return this.computeOrientedDistance(this._g0,this._g1,this._ptDist),this._ptDist.getDistance()};gu.prototype.interfaces_=function(){return[]};gu.prototype.getClass=function(){return gu};gu.distance=function(){if(arguments.length===2){var t=arguments[0],e=arguments[1],n=new gu(t,e);return n.distance()}else if(arguments.length===3){var r=arguments[0],i=arguments[1],a=arguments[2],h=new gu(r,i);return h.setDensifyFraction(a),h.distance()}};Mb.MaxPointDistanceFilter.get=function(){return zd};Mb.MaxDensifiedByFractionDistanceFilter.get=function(){return Dp};Object.defineProperties(gu,Mb);var zd=function(){this._maxPtDist=new Jo,this._minPtDist=new Jo,this._euclideanDist=new Bl,this._geom=null;var t=arguments[0];this._geom=t};zd.prototype.filter=function(t){this._minPtDist.initialize(),Bl.computeDistance(this._geom,t,this._minPtDist),this._maxPtDist.setMaximum(this._minPtDist)};zd.prototype.getMaxPointDistance=function(){return this._maxPtDist};zd.prototype.interfaces_=function(){return[kc]};zd.prototype.getClass=function(){return zd};var Dp=function(){this._maxPtDist=new Jo,this._minPtDist=new Jo,this._geom=null,this._numSubSegs=0;var t=arguments[0],e=arguments[1];this._geom=t,this._numSubSegs=Math.trunc(Math.round(1/e))};Dp.prototype.filter=function(t,e){var n=this;if(e===0)return null;for(var r=t.getCoordinate(e-1),i=t.getCoordinate(e),a=(i.x-r.x)/this._numSubSegs,h=(i.y-r.y)/this._numSubSegs,u=0;u<this._numSubSegs;u++){var _=r.x+u*a,w=r.y+u*h,C=new Tt(_,w);n._minPtDist.initialize(),Bl.computeDistance(n._geom,C,n._minPtDist),n._maxPtDist.setMaximum(n._minPtDist)}};Dp.prototype.isDone=function(){return!1};Dp.prototype.isGeometryChanged=function(){return!1};Dp.prototype.getMaxPointDistance=function(){return this._maxPtDist};Dp.prototype.interfaces_=function(){return[Hu]};Dp.prototype.getClass=function(){return Dp};var ga=function(t,e,n){this._minValidDistance=null,this._maxValidDistance=null,this._minDistanceFound=null,this._maxDistanceFound=null,this._isValid=!0,this._errMsg=null,this._errorLocation=null,this._errorIndicator=null,this._input=t||null,this._bufDistance=e||null,this._result=n||null},Ab={VERBOSE:{configurable:!0},MAX_DISTANCE_DIFF_FRAC:{configurable:!0}};ga.prototype.checkMaximumDistance=function(t,e,n){var r=new gu(e,t);if(r.setDensifyFraction(.25),this._maxDistanceFound=r.orientedDistance(),this._maxDistanceFound>n){this._isValid=!1;var i=r.getCoordinates();this._errorLocation=i[1],this._errorIndicator=t.getFactory().createLineString(i),this._errMsg="Distance between buffer curve and input is too large ("+this._maxDistanceFound+" at "+Zu.toLineString(i[0],i[1])+")"}};ga.prototype.isValid=function(){var t=Math.abs(this._bufDistance),e=ga.MAX_DISTANCE_DIFF_FRAC*t;return this._minValidDistance=t-e,this._maxValidDistance=t+e,this._input.isEmpty()||this._result.isEmpty()?!0:(this._bufDistance>0?this.checkPositiveValid():this.checkNegativeValid(),ga.VERBOSE&&Fo.out.println("Min Dist= "+this._minDistanceFound+"  err= "+(1-this._minDistanceFound/this._bufDistance)+"  Max Dist= "+this._maxDistanceFound+"  err= "+(this._maxDistanceFound/this._bufDistance-1)),this._isValid)};ga.prototype.checkNegativeValid=function(){if(!(this._input instanceof to||this._input instanceof Dc||this._input instanceof Ls))return null;var t=this.getPolygonLines(this._input);if(this.checkMinimumDistance(t,this._result,this._minValidDistance),!this._isValid)return null;this.checkMaximumDistance(t,this._result,this._maxValidDistance)};ga.prototype.getErrorIndicator=function(){return this._errorIndicator};ga.prototype.checkMinimumDistance=function(t,e,n){var r=new zo(t,e,n);if(this._minDistanceFound=r.distance(),this._minDistanceFound<n){this._isValid=!1;var i=r.nearestPoints();this._errorLocation=r.nearestPoints()[1],this._errorIndicator=t.getFactory().createLineString(i),this._errMsg="Distance between buffer curve and input is too small ("+this._minDistanceFound+" at "+Zu.toLineString(i[0],i[1])+" )"}};ga.prototype.checkPositiveValid=function(){var t=this._result.getBoundary();if(this.checkMinimumDistance(this._input,t,this._minValidDistance),!this._isValid)return null;this.checkMaximumDistance(this._input,t,this._maxValidDistance)};ga.prototype.getErrorLocation=function(){return this._errorLocation};ga.prototype.getPolygonLines=function(t){for(var e=new fe,n=new Po(e),r=Lh.getPolygons(t),i=r.iterator();i.hasNext();){var a=i.next();a.apply(n)}return t.getFactory().buildGeometry(e)};ga.prototype.getErrorMessage=function(){return this._errMsg};ga.prototype.interfaces_=function(){return[]};ga.prototype.getClass=function(){return ga};Ab.VERBOSE.get=function(){return!1};Ab.MAX_DISTANCE_DIFF_FRAC.get=function(){return .012};Object.defineProperties(ga,Ab);var Bo=function(t,e,n){this._isValid=!0,this._errorMsg=null,this._errorLocation=null,this._errorIndicator=null,this._input=t||null,this._distance=e||null,this._result=n||null},Db={VERBOSE:{configurable:!0},MAX_ENV_DIFF_FRAC:{configurable:!0}};Bo.prototype.isValid=function(){return this.checkPolygonal(),this._isValid?(this.checkExpectedEmpty(),this._isValid?(this.checkEnvelope(),this._isValid?(this.checkArea(),this._isValid?(this.checkDistance(),this._isValid):this._isValid):this._isValid):this._isValid):this._isValid};Bo.prototype.checkEnvelope=function(){if(this._distance<0)return null;var t=this._distance*Bo.MAX_ENV_DIFF_FRAC;t===0&&(t=.001);var e=new Be(this._input.getEnvelopeInternal());e.expandBy(this._distance);var n=new Be(this._result.getEnvelopeInternal());n.expandBy(t),n.contains(e)||(this._isValid=!1,this._errorMsg="Buffer envelope is incorrect",this._errorIndicator=this._input.getFactory().toGeometry(n)),this.report("Envelope")};Bo.prototype.checkDistance=function(){var t=new ga(this._input,this._distance,this._result);t.isValid()||(this._isValid=!1,this._errorMsg=t.getErrorMessage(),this._errorLocation=t.getErrorLocation(),this._errorIndicator=t.getErrorIndicator()),this.report("Distance")};Bo.prototype.checkArea=function(){var t=this._input.getArea(),e=this._result.getArea();this._distance>0&&t>e&&(this._isValid=!1,this._errorMsg="Area of positive buffer is smaller than input",this._errorIndicator=this._result),this._distance<0&&t<e&&(this._isValid=!1,this._errorMsg="Area of negative buffer is larger than input",this._errorIndicator=this._result),this.report("Area")};Bo.prototype.checkPolygonal=function(){this._result instanceof to||this._result instanceof Dc||(this._isValid=!1),this._errorMsg="Result is not polygonal",this._errorIndicator=this._result,this.report("Polygonal")};Bo.prototype.getErrorIndicator=function(){return this._errorIndicator};Bo.prototype.getErrorLocation=function(){return this._errorLocation};Bo.prototype.checkExpectedEmpty=function(){if(this._input.getDimension()>=2||this._distance>0)return null;this._result.isEmpty()||(this._isValid=!1,this._errorMsg="Result is non-empty",this._errorIndicator=this._result),this.report("ExpectedEmpty")};Bo.prototype.report=function(t){if(!Bo.VERBOSE)return null;Fo.out.println("Check "+t+": "+(this._isValid?"passed":"FAILED"))};Bo.prototype.getErrorMessage=function(){return this._errorMsg};Bo.prototype.interfaces_=function(){return[]};Bo.prototype.getClass=function(){return Bo};Bo.isValidMsg=function(t,e,n){var r=new Bo(t,e,n);return r.isValid()?null:r.getErrorMessage()};Bo.isValid=function(t,e,n){var r=new Bo(t,e,n);return!!r.isValid()};Db.VERBOSE.get=function(){return!1};Db.MAX_ENV_DIFF_FRAC.get=function(){return .012};Object.defineProperties(Bo,Db);var tc=function(){this._pts=null,this._data=null;var t=arguments[0],e=arguments[1];this._pts=t,this._data=e};tc.prototype.getCoordinates=function(){return this._pts};tc.prototype.size=function(){return this._pts.length};tc.prototype.getCoordinate=function(t){return this._pts[t]};tc.prototype.isClosed=function(){return this._pts[0].equals(this._pts[this._pts.length-1])};tc.prototype.getSegmentOctant=function(t){return t===this._pts.length-1?-1:Dd.octant(this.getCoordinate(t),this.getCoordinate(t+1))};tc.prototype.setData=function(t){this._data=t};tc.prototype.getData=function(){return this._data};tc.prototype.toString=function(){return Zu.toLineString(new mi(this._pts))};tc.prototype.interfaces_=function(){return[$c]};tc.prototype.getClass=function(){return tc};var bo=function(){this._findAllIntersections=!1,this._isCheckEndSegmentsOnly=!1,this._li=null,this._interiorIntersection=null,this._intSegments=null,this._intersections=new fe,this._intersectionCount=0,this._keepIntersections=!0;var t=arguments[0];this._li=t,this._interiorIntersection=null};bo.prototype.getInteriorIntersection=function(){return this._interiorIntersection};bo.prototype.setCheckEndSegmentsOnly=function(t){this._isCheckEndSegmentsOnly=t};bo.prototype.getIntersectionSegments=function(){return this._intSegments};bo.prototype.count=function(){return this._intersectionCount};bo.prototype.getIntersections=function(){return this._intersections};bo.prototype.setFindAllIntersections=function(t){this._findAllIntersections=t};bo.prototype.setKeepIntersections=function(t){this._keepIntersections=t};bo.prototype.processIntersections=function(t,e,n,r){if(!this._findAllIntersections&&this.hasIntersection()||t===n&&e===r)return null;if(this._isCheckEndSegmentsOnly){var i=this.isEndSegment(t,e)||this.isEndSegment(n,r);if(!i)return null}var a=t.getCoordinates()[e],h=t.getCoordinates()[e+1],u=n.getCoordinates()[r],_=n.getCoordinates()[r+1];this._li.computeIntersection(a,h,u,_),this._li.hasIntersection()&&this._li.isInteriorIntersection()&&(this._intSegments=new Array(4).fill(null),this._intSegments[0]=a,this._intSegments[1]=h,this._intSegments[2]=u,this._intSegments[3]=_,this._interiorIntersection=this._li.getIntersection(0),this._keepIntersections&&this._intersections.add(this._interiorIntersection),this._intersectionCount++)};bo.prototype.isEndSegment=function(t,e){return e===0||e>=t.size()-2};bo.prototype.hasIntersection=function(){return this._interiorIntersection!==null};bo.prototype.isDone=function(){return this._findAllIntersections?!1:this._interiorIntersection!==null};bo.prototype.interfaces_=function(){return[Gf]};bo.prototype.getClass=function(){return bo};bo.createAllIntersectionsFinder=function(t){var e=new bo(t);return e.setFindAllIntersections(!0),e};bo.createAnyIntersectionFinder=function(t){return new bo(t)};bo.createIntersectionCounter=function(t){var e=new bo(t);return e.setFindAllIntersections(!0),e.setKeepIntersections(!1),e};var tl=function(){this._li=new ad,this._segStrings=null,this._findAllIntersections=!1,this._segInt=null,this._isValid=!0;var t=arguments[0];this._segStrings=t};tl.prototype.execute=function(){if(this._segInt!==null)return null;this.checkInteriorIntersections()};tl.prototype.getIntersections=function(){return this._segInt.getIntersections()};tl.prototype.isValid=function(){return this.execute(),this._isValid};tl.prototype.setFindAllIntersections=function(t){this._findAllIntersections=t};tl.prototype.checkInteriorIntersections=function(){this._isValid=!0,this._segInt=new bo(this._li),this._segInt.setFindAllIntersections(this._findAllIntersections);var t=new Nb;if(t.setSegmentIntersector(this._segInt),t.computeNodes(this._segStrings),this._segInt.hasIntersection())return this._isValid=!1,null};tl.prototype.checkValid=function(){if(this.execute(),!this._isValid)throw new Ah(this.getErrorMessage(),this._segInt.getInteriorIntersection())};tl.prototype.getErrorMessage=function(){if(this._isValid)return"no intersections found";var t=this._segInt.getIntersectionSegments();return"found non-noded intersection between "+Zu.toLineString(t[0],t[1])+" and "+Zu.toLineString(t[2],t[3])};tl.prototype.interfaces_=function(){return[]};tl.prototype.getClass=function(){return tl};tl.computeIntersections=function(t){var e=new tl(t);return e.setFindAllIntersections(!0),e.isValid(),e.getIntersections()};var Xf=function t(){this._nv=null;var e=arguments[0];this._nv=new tl(t.toSegmentStrings(e))};Xf.prototype.checkValid=function(){this._nv.checkValid()};Xf.prototype.interfaces_=function(){return[]};Xf.prototype.getClass=function(){return Xf};Xf.toSegmentStrings=function(t){for(var e=new fe,n=t.iterator();n.hasNext();){var r=n.next();e.add(new tc(r.getCoordinates(),r))}return e};Xf.checkValid=function(t){var e=new Xf(t);e.checkValid()};var Bd=function(t){this._mapOp=t};Bd.prototype.map=function(t){for(var e=this,n=new fe,r=0;r<t.getNumGeometries();r++){var i=e._mapOp.map(t.getGeometryN(r));i.isEmpty()||n.add(i)}return t.getFactory().createGeometryCollection(wn.toGeometryArray(n))};Bd.prototype.interfaces_=function(){return[]};Bd.prototype.getClass=function(){return Bd};Bd.map=function(t,e){var n=new Bd(e);return n.map(t)};var ec=function(){this._op=null,this._geometryFactory=null,this._ptLocator=null,this._lineEdgesList=new fe,this._resultLineList=new fe;var t=arguments[0],e=arguments[1],n=arguments[2];this._op=t,this._geometryFactory=e,this._ptLocator=n};ec.prototype.collectLines=function(t){for(var e=this,n=this._op.getGraph().getEdgeEnds().iterator();n.hasNext();){var r=n.next();e.collectLineEdge(r,t,e._lineEdgesList),e.collectBoundaryTouchEdge(r,t,e._lineEdgesList)}};ec.prototype.labelIsolatedLine=function(t,e){var n=this._ptLocator.locate(t.getCoordinate(),this._op.getArgGeometry(e));t.getLabel().setLocation(e,n)};ec.prototype.build=function(t){return this.findCoveredLineEdges(),this.collectLines(t),this.buildLines(t),this._resultLineList};ec.prototype.collectLineEdge=function(t,e,n){var r=t.getLabel(),i=t.getEdge();t.isLineEdge()&&!t.isVisited()&&hn.isResultOfOp(r,e)&&!i.isCovered()&&(n.add(i),t.setVisitedEdge(!0))};ec.prototype.findCoveredLineEdges=function(){for(var t=this,e=this._op.getGraph().getNodes().iterator();e.hasNext();){var n=e.next();n.getEdges().findCoveredLineEdges()}for(var r=this._op.getGraph().getEdgeEnds().iterator();r.hasNext();){var i=r.next(),a=i.getEdge();if(i.isLineEdge()&&!a.isCoveredSet()){var h=t._op.isCoveredByA(i.getCoordinate());a.setCovered(h)}}};ec.prototype.labelIsolatedLines=function(t){for(var e=this,n=t.iterator();n.hasNext();){var r=n.next(),i=r.getLabel();r.isIsolated()&&(i.isNull(0)?e.labelIsolatedLine(r,0):e.labelIsolatedLine(r,1))}};ec.prototype.buildLines=function(t){for(var e=this,n=this._lineEdgesList.iterator();n.hasNext();){var r=n.next(),i=e._geometryFactory.createLineString(r.getCoordinates());e._resultLineList.add(i),r.setInResult(!0)}};ec.prototype.collectBoundaryTouchEdge=function(t,e,n){var r=t.getLabel();if(t.isLineEdge()||t.isVisited()||t.isInteriorAreaEdge()||t.getEdge().isInResult())return null;fn.isTrue(!(t.isInResult()||t.getSym().isInResult())||!t.getEdge().isInResult()),hn.isResultOfOp(r,e)&&e===hn.INTERSECTION&&(n.add(t.getEdge()),t.setVisitedEdge(!0))};ec.prototype.interfaces_=function(){return[]};ec.prototype.getClass=function(){return ec};var $d=function(){this._op=null,this._geometryFactory=null,this._resultPointList=new fe;var t=arguments[0],e=arguments[1];this._op=t,this._geometryFactory=e};$d.prototype.filterCoveredNodeToPoint=function(t){var e=t.getCoordinate();if(!this._op.isCoveredByLA(e)){var n=this._geometryFactory.createPoint(e);this._resultPointList.add(n)}};$d.prototype.extractNonCoveredResultNodes=function(t){for(var e=this,n=this._op.getGraph().getNodes().iterator();n.hasNext();){var r=n.next();if(!r.isInResult()&&!r.isIncidentEdgeInResult()&&(r.getEdges().getDegree()===0||t===hn.INTERSECTION)){var i=r.getLabel();hn.isResultOfOp(i,t)&&e.filterCoveredNodeToPoint(r)}}};$d.prototype.build=function(t){return this.extractNonCoveredResultNodes(t),this._resultPointList};$d.prototype.interfaces_=function(){return[]};$d.prototype.getClass=function(){return $d};var Qs=function(){this._inputGeom=null,this._factory=null,this._pruneEmptyGeometry=!0,this._preserveGeometryCollectionType=!0,this._preserveCollections=!1,this._preserveType=!1};Qs.prototype.transformPoint=function(t,e){return this._factory.createPoint(this.transformCoordinates(t.getCoordinateSequence(),t))};Qs.prototype.transformPolygon=function(t,e){var n=this,r=!0,i=this.transformLinearRing(t.getExteriorRing(),t);(i===null||!(i instanceof zc)||i.isEmpty())&&(r=!1);for(var a=new fe,h=0;h<t.getNumInteriorRing();h++){var u=n.transformLinearRing(t.getInteriorRingN(h),t);u===null||u.isEmpty()||(u instanceof zc||(r=!1),a.add(u))}if(r)return this._factory.createPolygon(i,a.toArray([]));var _=new fe;return i!==null&&_.add(i),_.addAll(a),this._factory.buildGeometry(_)};Qs.prototype.createCoordinateSequence=function(t){return this._factory.getCoordinateSequenceFactory().create(t)};Qs.prototype.getInputGeometry=function(){return this._inputGeom};Qs.prototype.transformMultiLineString=function(t,e){for(var n=this,r=new fe,i=0;i<t.getNumGeometries();i++){var a=n.transformLineString(t.getGeometryN(i),t);a!==null&&(a.isEmpty()||r.add(a))}return this._factory.buildGeometry(r)};Qs.prototype.transformCoordinates=function(t,e){return this.copy(t)};Qs.prototype.transformLineString=function(t,e){return this._factory.createLineString(this.transformCoordinates(t.getCoordinateSequence(),t))};Qs.prototype.transformMultiPoint=function(t,e){for(var n=this,r=new fe,i=0;i<t.getNumGeometries();i++){var a=n.transformPoint(t.getGeometryN(i),t);a!==null&&(a.isEmpty()||r.add(a))}return this._factory.buildGeometry(r)};Qs.prototype.transformMultiPolygon=function(t,e){for(var n=this,r=new fe,i=0;i<t.getNumGeometries();i++){var a=n.transformPolygon(t.getGeometryN(i),t);a!==null&&(a.isEmpty()||r.add(a))}return this._factory.buildGeometry(r)};Qs.prototype.copy=function(t){return t.copy()};Qs.prototype.transformGeometryCollection=function(t,e){for(var n=this,r=new fe,i=0;i<t.getNumGeometries();i++){var a=n.transform(t.getGeometryN(i));a!==null&&(n._pruneEmptyGeometry&&a.isEmpty()||r.add(a))}return this._preserveGeometryCollectionType?this._factory.createGeometryCollection(wn.toGeometryArray(r)):this._factory.buildGeometry(r)};Qs.prototype.transform=function(t){if(this._inputGeom=t,this._factory=t.getFactory(),t instanceof _a)return this.transformPoint(t,null);if(t instanceof Jg)return this.transformMultiPoint(t,null);if(t instanceof zc)return this.transformLinearRing(t,null);if(t instanceof si)return this.transformLineString(t,null);if(t instanceof $f)return this.transformMultiLineString(t,null);if(t instanceof to)return this.transformPolygon(t,null);if(t instanceof Dc)return this.transformMultiPolygon(t,null);if(t instanceof Ls)return this.transformGeometryCollection(t,null);throw new Xr("Unknown Geometry subtype: "+t.getClass().getName())};Qs.prototype.transformLinearRing=function(t,e){var n=this.transformCoordinates(t.getCoordinateSequence(),t);if(n===null)return this._factory.createLinearRing(null);var r=n.size();return r>0&&r<4&&!this._preserveType?this._factory.createLineString(n):this._factory.createLinearRing(n)};Qs.prototype.interfaces_=function(){return[]};Qs.prototype.getClass=function(){return Qs};var Gc=function t(){if(this._snapTolerance=0,this._srcPts=null,this._seg=new Ve,this._allowSnappingToSourceVertices=!1,this._isClosed=!1,arguments[0]instanceof si&&typeof arguments[1]=="number"){var e=arguments[0],n=arguments[1];t.call(this,e.getCoordinates(),n)}else if(arguments[0]instanceof Array&&typeof arguments[1]=="number"){var r=arguments[0],i=arguments[1];this._srcPts=r,this._isClosed=t.isClosed(r),this._snapTolerance=i}};Gc.prototype.snapVertices=function(t,e){for(var n=this,r=this._isClosed?t.size()-1:t.size(),i=0;i<r;i++){var a=t.get(i),h=n.findSnapForVertex(a,e);h!==null&&(t.set(i,new Tt(h)),i===0&&n._isClosed&&t.set(t.size()-1,new Tt(h)))}};Gc.prototype.findSnapForVertex=function(t,e){for(var n=this,r=0;r<e.length;r++){if(t.equals2D(e[r]))return null;if(t.distance(e[r])<n._snapTolerance)return e[r]}return null};Gc.prototype.snapTo=function(t){var e=new b_(this._srcPts);this.snapVertices(e,t),this.snapSegments(e,t);var n=e.toCoordinateArray();return n};Gc.prototype.snapSegments=function(t,e){var n=this;if(e.length===0)return null;var r=e.length;e[0].equals2D(e[e.length-1])&&(r=e.length-1);for(var i=0;i<r;i++){var a=e[i],h=n.findSegmentIndexToSnap(a,t);h>=0&&t.add(h+1,new Tt(a),!1)}};Gc.prototype.findSegmentIndexToSnap=function(t,e){for(var n=this,r=un.MAX_VALUE,i=-1,a=0;a<e.size()-1;a++){if(n._seg.p0=e.get(a),n._seg.p1=e.get(a+1),n._seg.p0.equals2D(t)||n._seg.p1.equals2D(t)){if(n._allowSnappingToSourceVertices)continue;return-1}var h=n._seg.distance(t);h<n._snapTolerance&&h<r&&(r=h,i=a)}return i};Gc.prototype.setAllowSnappingToSourceVertices=function(t){this._allowSnappingToSourceVertices=t};Gc.prototype.interfaces_=function(){return[]};Gc.prototype.getClass=function(){return Gc};Gc.isClosed=function(t){return t.length<=1?!1:t[0].equals2D(t[t.length-1])};var yi=function(t){this._srcGeom=t||null},MS={SNAP_PRECISION_FACTOR:{configurable:!0}};yi.prototype.snapTo=function(t,e){var n=this.extractTargetCoordinates(t),r=new AS(e,n);return r.transform(this._srcGeom)};yi.prototype.snapToSelf=function(t,e){var n=this.extractTargetCoordinates(this._srcGeom),r=new AS(t,n,!0),i=r.transform(this._srcGeom),a=i;return e&&tn(a,Tp)&&(a=i.buffer(0)),a};yi.prototype.computeSnapTolerance=function(t){var e=this.computeMinimumSegmentLength(t),n=e/10;return n};yi.prototype.extractTargetCoordinates=function(t){for(var e=new Yl,n=t.getCoordinates(),r=0;r<n.length;r++)e.add(n[r]);return e.toArray(new Array(0).fill(null))};yi.prototype.computeMinimumSegmentLength=function(t){for(var e=un.MAX_VALUE,n=0;n<t.length-1;n++){var r=t[n].distance(t[n+1]);r<e&&(e=r)}return e};yi.prototype.interfaces_=function(){return[]};yi.prototype.getClass=function(){return yi};yi.snap=function(t,e,n){var r=new Array(2).fill(null),i=new yi(t);r[0]=i.snapTo(e,n);var a=new yi(e);return r[1]=a.snapTo(r[0],n),r};yi.computeOverlaySnapTolerance=function(){if(arguments.length===1){var t=arguments[0],e=yi.computeSizeBasedSnapTolerance(t),n=t.getPrecisionModel();if(n.getType()===Qn.FIXED){var r=1/n.getScale()*2/1.415;r>e&&(e=r)}return e}else if(arguments.length===2){var i=arguments[0],a=arguments[1];return Math.min(yi.computeOverlaySnapTolerance(i),yi.computeOverlaySnapTolerance(a))}};yi.computeSizeBasedSnapTolerance=function(t){var e=t.getEnvelopeInternal(),n=Math.min(e.getHeight(),e.getWidth()),r=n*yi.SNAP_PRECISION_FACTOR;return r};yi.snapToSelf=function(t,e,n){var r=new yi(t);return r.snapToSelf(e,n)};MS.SNAP_PRECISION_FACTOR.get=function(){return 1e-9};Object.defineProperties(yi,MS);var AS=function(t){function e(n,r,i){t.call(this),this._snapTolerance=n||null,this._snapPts=r||null,this._isSelfSnap=i!==void 0?i:!1}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.snapLine=function(n,r){var i=new Gc(n,this._snapTolerance);return i.setAllowSnappingToSourceVertices(this._isSelfSnap),i.snapTo(r)},e.prototype.transformCoordinates=function(n,r){var i=n.toCoordinateArray(),a=this.snapLine(i,this._snapPts);return this._factory.getCoordinateSequenceFactory().create(a)},e.prototype.interfaces_=function(){return[]},e.prototype.getClass=function(){return e},e}(Qs),_s=function(){this._isFirst=!0,this._commonMantissaBitsCount=53,this._commonBits=0,this._commonSignExp=null};_s.prototype.getCommon=function(){return un.longBitsToDouble(this._commonBits)};_s.prototype.add=function(t){var e=un.doubleToLongBits(t);if(this._isFirst)return this._commonBits=e,this._commonSignExp=_s.signExpBits(this._commonBits),this._isFirst=!1,null;var n=_s.signExpBits(e);if(n!==this._commonSignExp)return this._commonBits=0,null;this._commonMantissaBitsCount=_s.numCommonMostSigMantissaBits(this._commonBits,e),this._commonBits=_s.zeroLowerBits(this._commonBits,64-(12+this._commonMantissaBitsCount))};_s.prototype.toString=function(){if(arguments.length===1){var t=arguments[0],e=un.longBitsToDouble(t),n=un.toBinaryString(t),r="0000000000000000000000000000000000000000000000000000000000000000"+n,i=r.substring(r.length-64),a=i.substring(0,1)+"  "+i.substring(1,12)+"(exp) "+i.substring(12)+" [ "+e+" ]";return a}};_s.prototype.interfaces_=function(){return[]};_s.prototype.getClass=function(){return _s};_s.getBit=function(t,e){var n=1<<e;return t&n?1:0};_s.signExpBits=function(t){return t>>52};_s.zeroLowerBits=function(t,e){var n=(1<<e)-1,r=~n,i=t&r;return i};_s.numCommonMostSigMantissaBits=function(t,e){for(var n=0,r=52;r>=0;r--){if(_s.getBit(t,r)!==_s.getBit(e,r))return n;n++}return 52};var Op=function(){this._commonCoord=null,this._ccFilter=new Vd},Ob={CommonCoordinateFilter:{configurable:!0},Translater:{configurable:!0}};Op.prototype.addCommonBits=function(t){var e=new Rp(this._commonCoord);t.apply(e),t.geometryChanged()};Op.prototype.removeCommonBits=function(t){if(this._commonCoord.x===0&&this._commonCoord.y===0)return t;var e=new Tt(this._commonCoord);e.x=-e.x,e.y=-e.y;var n=new Rp(e);return t.apply(n),t.geometryChanged(),t};Op.prototype.getCommonCoordinate=function(){return this._commonCoord};Op.prototype.add=function(t){t.apply(this._ccFilter),this._commonCoord=this._ccFilter.getCommonCoordinate()};Op.prototype.interfaces_=function(){return[]};Op.prototype.getClass=function(){return Op};Ob.CommonCoordinateFilter.get=function(){return Vd};Ob.Translater.get=function(){return Rp};Object.defineProperties(Op,Ob);var Vd=function(){this._commonBitsX=new _s,this._commonBitsY=new _s};Vd.prototype.filter=function(t){this._commonBitsX.add(t.x),this._commonBitsY.add(t.y)};Vd.prototype.getCommonCoordinate=function(){return new Tt(this._commonBitsX.getCommon(),this._commonBitsY.getCommon())};Vd.prototype.interfaces_=function(){return[kc]};Vd.prototype.getClass=function(){return Vd};var Rp=function(){this.trans=null;var t=arguments[0];this.trans=t};Rp.prototype.filter=function(t,e){var n=t.getOrdinate(e,0)+this.trans.x,r=t.getOrdinate(e,1)+this.trans.y;t.setOrdinate(e,0,n),t.setOrdinate(e,1,r)};Rp.prototype.isDone=function(){return!1};Rp.prototype.isGeometryChanged=function(){return!0};Rp.prototype.interfaces_=function(){return[Hu]};Rp.prototype.getClass=function(){return Rp};var wo=function(t,e){this._geom=new Array(2).fill(null),this._snapTolerance=null,this._cbr=null,this._geom[0]=t,this._geom[1]=e,this.computeSnapTolerance()};wo.prototype.selfSnap=function(t){var e=new yi(t),n=e.snapTo(t,this._snapTolerance);return n};wo.prototype.removeCommonBits=function(t){this._cbr=new Op,this._cbr.add(t[0]),this._cbr.add(t[1]);var e=new Array(2).fill(null);return e[0]=this._cbr.removeCommonBits(t[0].copy()),e[1]=this._cbr.removeCommonBits(t[1].copy()),e};wo.prototype.prepareResult=function(t){return this._cbr.addCommonBits(t),t};wo.prototype.getResultGeometry=function(t){var e=this.snap(this._geom),n=hn.overlayOp(e[0],e[1],t);return this.prepareResult(n)};wo.prototype.checkValid=function(t){t.isValid()||Fo.out.println("Snapped geometry is invalid")};wo.prototype.computeSnapTolerance=function(){this._snapTolerance=yi.computeOverlaySnapTolerance(this._geom[0],this._geom[1])};wo.prototype.snap=function(t){var e=this.removeCommonBits(t),n=yi.snap(e[0],e[1],this._snapTolerance);return n};wo.prototype.interfaces_=function(){return[]};wo.prototype.getClass=function(){return wo};wo.overlayOp=function(t,e,n){var r=new wo(t,e);return r.getResultGeometry(n)};wo.union=function(t,e){return wo.overlayOp(t,e,hn.UNION)};wo.intersection=function(t,e){return wo.overlayOp(t,e,hn.INTERSECTION)};wo.symDifference=function(t,e){return wo.overlayOp(t,e,hn.SYMDIFFERENCE)};wo.difference=function(t,e){return wo.overlayOp(t,e,hn.DIFFERENCE)};var Ms=function(t,e){this._geom=new Array(2).fill(null),this._geom[0]=t,this._geom[1]=e};Ms.prototype.getResultGeometry=function(t){var e=null,n=!1,r=null;try{e=hn.overlayOp(this._geom[0],this._geom[1],t);var i=!0;i&&(n=!0)}catch(a){if(a instanceof Ph)r=a;else throw a}finally{}if(!n)try{e=wo.overlayOp(this._geom[0],this._geom[1],t)}catch(a){throw a instanceof Ph?r:a}finally{}return e};Ms.prototype.interfaces_=function(){return[]};Ms.prototype.getClass=function(){return Ms};Ms.overlayOp=function(t,e,n){var r=new Ms(t,e);return r.getResultGeometry(n)};Ms.union=function(t,e){return Ms.overlayOp(t,e,hn.UNION)};Ms.intersection=function(t,e){return Ms.overlayOp(t,e,hn.INTERSECTION)};Ms.symDifference=function(t,e){return Ms.overlayOp(t,e,hn.SYMDIFFERENCE)};Ms.difference=function(t,e){return Ms.overlayOp(t,e,hn.DIFFERENCE)};var Jy=function(){this.mce=null,this.chainIndex=null;var t=arguments[0],e=arguments[1];this.mce=t,this.chainIndex=e};Jy.prototype.computeIntersections=function(t,e){this.mce.computeIntersectsForChain(this.chainIndex,t.mce,t.chainIndex,e)};Jy.prototype.interfaces_=function(){return[]};Jy.prototype.getClass=function(){return Jy};var ba=function t(){if(this._label=null,this._xValue=null,this._eventType=null,this._insertEvent=null,this._deleteEventIndex=null,this._obj=null,arguments.length===2){var e=arguments[0],n=arguments[1];this._eventType=t.DELETE,this._xValue=e,this._insertEvent=n}else if(arguments.length===3){var r=arguments[0],i=arguments[1],a=arguments[2];this._eventType=t.INSERT,this._label=r,this._xValue=i,this._obj=a}},Rb={INSERT:{configurable:!0},DELETE:{configurable:!0}};ba.prototype.isDelete=function(){return this._eventType===ba.DELETE};ba.prototype.setDeleteEventIndex=function(t){this._deleteEventIndex=t};ba.prototype.getObject=function(){return this._obj};ba.prototype.compareTo=function(t){var e=t;return this._xValue<e._xValue?-1:this._xValue>e._xValue?1:this._eventType<e._eventType?-1:this._eventType>e._eventType?1:0};ba.prototype.getInsertEvent=function(){return this._insertEvent};ba.prototype.isInsert=function(){return this._eventType===ba.INSERT};ba.prototype.isSameLabel=function(t){return this._label===null?!1:this._label===t._label};ba.prototype.getDeleteEventIndex=function(){return this._deleteEventIndex};ba.prototype.interfaces_=function(){return[Tu]};ba.prototype.getClass=function(){return ba};Rb.INSERT.get=function(){return 1};Rb.DELETE.get=function(){return 2};Object.defineProperties(ba,Rb);var Bv=function(){};Bv.prototype.interfaces_=function(){return[]};Bv.prototype.getClass=function(){return Bv};var $o=function(){this._hasIntersection=!1,this._hasProper=!1,this._hasProperInterior=!1,this._properIntersectionPoint=null,this._li=null,this._includeProper=null,this._recordIsolated=null,this._isSelfIntersection=null,this._numIntersections=0,this.numTests=0,this._bdyNodes=null,this._isDone=!1,this._isDoneWhenProperInt=!1;var t=arguments[0],e=arguments[1],n=arguments[2];this._li=t,this._includeProper=e,this._recordIsolated=n};$o.prototype.isTrivialIntersection=function(t,e,n,r){if(t===n&&this._li.getIntersectionNum()===1){if($o.isAdjacentSegments(e,r))return!0;if(t.isClosed()){var i=t.getNumPoints()-1;if(e===0&&r===i||r===0&&e===i)return!0}}return!1};$o.prototype.getProperIntersectionPoint=function(){return this._properIntersectionPoint};$o.prototype.setIsDoneIfProperInt=function(t){this._isDoneWhenProperInt=t};$o.prototype.hasProperInteriorIntersection=function(){return this._hasProperInterior};$o.prototype.isBoundaryPointInternal=function(t,e){for(var n=e.iterator();n.hasNext();){var r=n.next(),i=r.getCoordinate();if(t.isIntersection(i))return!0}return!1};$o.prototype.hasProperIntersection=function(){return this._hasProper};$o.prototype.hasIntersection=function(){return this._hasIntersection};$o.prototype.isDone=function(){return this._isDone};$o.prototype.isBoundaryPoint=function(t,e){return e===null?!1:!!(this.isBoundaryPointInternal(t,e[0])||this.isBoundaryPointInternal(t,e[1]))};$o.prototype.setBoundaryNodes=function(t,e){this._bdyNodes=new Array(2).fill(null),this._bdyNodes[0]=t,this._bdyNodes[1]=e};$o.prototype.addIntersections=function(t,e,n,r){if(t===n&&e===r)return null;this.numTests++;var i=t.getCoordinates()[e],a=t.getCoordinates()[e+1],h=n.getCoordinates()[r],u=n.getCoordinates()[r+1];this._li.computeIntersection(i,a,h,u),this._li.hasIntersection()&&(this._recordIsolated&&(t.setIsolated(!1),n.setIsolated(!1)),this._numIntersections++,this.isTrivialIntersection(t,e,n,r)||(this._hasIntersection=!0,(this._includeProper||!this._li.isProper())&&(t.addIntersections(this._li,e,0),n.addIntersections(this._li,r,1)),this._li.isProper()&&(this._properIntersectionPoint=this._li.getIntersection(0).copy(),this._hasProper=!0,this._isDoneWhenProperInt&&(this._isDone=!0),this.isBoundaryPoint(this._li,this._bdyNodes)||(this._hasProperInterior=!0))))};$o.prototype.interfaces_=function(){return[]};$o.prototype.getClass=function(){return $o};$o.isAdjacentSegments=function(t,e){return Math.abs(t-e)===1};var hA=function(t){function e(){t.call(this),this.events=new fe,this.nOverlaps=null}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.prepareEvents=function(){var n=this;Ju.sort(this.events);for(var r=0;r<this.events.size();r++){var i=n.events.get(r);i.isDelete()&&i.getInsertEvent().setDeleteEventIndex(r)}},e.prototype.computeIntersections=function(){var n=this;if(arguments.length===1){var r=arguments[0];this.nOverlaps=0,this.prepareEvents();for(var i=0;i<this.events.size();i++){var a=n.events.get(i);if(a.isInsert()&&n.processOverlaps(i,a.getDeleteEventIndex(),a,r),r.isDone())break}}else if(arguments.length===3){if(arguments[2]instanceof $o&&tn(arguments[0],ju)&&tn(arguments[1],ju)){var h=arguments[0],u=arguments[1],_=arguments[2];this.addEdges(h,h),this.addEdges(u,u),this.computeIntersections(_)}else if(typeof arguments[2]=="boolean"&&tn(arguments[0],ju)&&arguments[1]instanceof $o){var w=arguments[0],C=arguments[1],P=arguments[2];P?this.addEdges(w,null):this.addEdges(w),this.computeIntersections(C)}}},e.prototype.addEdge=function(n,r){for(var i=this,a=n.getMonotoneChainEdge(),h=a.getStartIndexes(),u=0;u<h.length-1;u++){var _=new Jy(a,u),w=new ba(r,a.getMinX(u),_);i.events.add(w),i.events.add(new ba(a.getMaxX(u),w))}},e.prototype.processOverlaps=function(n,r,i,a){for(var h=this,u=i.getObject(),_=n;_<r;_++){var w=h.events.get(_);if(w.isInsert()){var C=w.getObject();i.isSameLabel(w)||(u.computeIntersections(C,a),h.nOverlaps++)}}},e.prototype.addEdges=function(){var n=this;if(arguments.length===1)for(var r=arguments[0],i=r.iterator();i.hasNext();){var a=i.next();n.addEdge(a,a)}else if(arguments.length===2)for(var h=arguments[0],u=arguments[1],_=h.iterator();_.hasNext();){var w=_.next();n.addEdge(w,u)}},e.prototype.interfaces_=function(){return[]},e.prototype.getClass=function(){return e},e}(Bv),qc=function(){this._min=un.POSITIVE_INFINITY,this._max=un.NEGATIVE_INFINITY},DS={NodeComparator:{configurable:!0}};qc.prototype.getMin=function(){return this._min};qc.prototype.intersects=function(t,e){return!(this._min>e||this._max<t)};qc.prototype.getMax=function(){return this._max};qc.prototype.toString=function(){return Zu.toLineString(new Tt(this._min,0),new Tt(this._max,0))};qc.prototype.interfaces_=function(){return[]};qc.prototype.getClass=function(){return qc};DS.NodeComparator.get=function(){return Ky};Object.defineProperties(qc,DS);var Ky=function(){};Ky.prototype.compare=function(t,e){var n=t,r=e,i=(n._min+n._max)/2,a=(r._min+r._max)/2;return i<a?-1:i>a?1:0};Ky.prototype.interfaces_=function(){return[qg]};Ky.prototype.getClass=function(){return Ky};var pA=function(t){function e(){t.call(this),this._item=null;var n=arguments[0],r=arguments[1],i=arguments[2];this._min=n,this._max=r,this._item=i}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.query=function(n,r,i){if(!this.intersects(n,r))return null;i.visitItem(this._item)},e.prototype.interfaces_=function(){return[]},e.prototype.getClass=function(){return e},e}(qc),fA=function(t){function e(){t.call(this),this._node1=null,this._node2=null;var n=arguments[0],r=arguments[1];this._node1=n,this._node2=r,this.buildExtent(this._node1,this._node2)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.buildExtent=function(n,r){this._min=Math.min(n._min,r._min),this._max=Math.max(n._max,r._max)},e.prototype.query=function(n,r,i){if(!this.intersects(n,r))return null;this._node1!==null&&this._node1.query(n,r,i),this._node2!==null&&this._node2.query(n,r,i)},e.prototype.interfaces_=function(){return[]},e.prototype.getClass=function(){return e},e}(qc),jc=function(){this._leaves=new fe,this._root=null,this._level=0};jc.prototype.buildTree=function(){var t=this;Ju.sort(this._leaves,new qc.NodeComparator);for(var e=this._leaves,n=null,r=new fe;;){if(t.buildLevel(e,r),r.size()===1)return r.get(0);n=e,e=r,r=n}};jc.prototype.insert=function(t,e,n){if(this._root!==null)throw new Error("Index cannot be added to once it has been queried");this._leaves.add(new pA(t,e,n))};jc.prototype.query=function(t,e,n){this.init(),this._root.query(t,e,n)};jc.prototype.buildRoot=function(){if(this._root!==null)return null;this._root=this.buildTree()};jc.prototype.printNode=function(t){Fo.out.println(Zu.toLineString(new Tt(t._min,this._level),new Tt(t._max,this._level)))};jc.prototype.init=function(){if(this._root!==null)return null;this.buildRoot()};jc.prototype.buildLevel=function(t,e){this._level++,e.clear();for(var n=0;n<t.size();n+=2){var r=t.get(n),i=n+1<t.size()?t.get(n):null;if(i===null)e.add(r);else{var a=new fA(t.get(n),t.get(n+1));e.add(a)}}};jc.prototype.interfaces_=function(){return[]};jc.prototype.getClass=function(){return jc};var rm=function(){this._items=new fe};rm.prototype.visitItem=function(t){this._items.add(t)};rm.prototype.getItems=function(){return this._items};rm.prototype.interfaces_=function(){return[Lp]};rm.prototype.getClass=function(){return rm};var im=function(){this._index=null;var t=arguments[0];if(!tn(t,Tp))throw new Xr("Argument must be Polygonal");this._index=new Yf(t)},Fb={SegmentVisitor:{configurable:!0},IntervalIndexedGeometry:{configurable:!0}};im.prototype.locate=function(t){var e=new Ul(t),n=new om(e);return this._index.query(t.y,t.y,n),e.getLocation()};im.prototype.interfaces_=function(){return[em]};im.prototype.getClass=function(){return im};Fb.SegmentVisitor.get=function(){return om};Fb.IntervalIndexedGeometry.get=function(){return Yf};Object.defineProperties(im,Fb);var om=function(){this._counter=null;var t=arguments[0];this._counter=t};om.prototype.visitItem=function(t){var e=t;this._counter.countSegment(e.getCoordinate(0),e.getCoordinate(1))};om.prototype.interfaces_=function(){return[Lp]};om.prototype.getClass=function(){return om};var Yf=function(){this._index=new jc;var t=arguments[0];this.init(t)};Yf.prototype.init=function(t){for(var e=this,n=Po.getLines(t),r=n.iterator();r.hasNext();){var i=r.next(),a=i.getCoordinates();e.addLine(a)}};Yf.prototype.addLine=function(t){for(var e=this,n=1;n<t.length;n++){var r=new Ve(t[n-1],t[n]),i=Math.min(r.p0.y,r.p1.y),a=Math.max(r.p0.y,r.p1.y);e._index.insert(i,a,r)}};Yf.prototype.query=function(){if(arguments.length===2){var t=arguments[0],e=arguments[1],n=new rm;return this._index.query(t,e,n),n.getItems()}else if(arguments.length===3){var r=arguments[0],i=arguments[1],a=arguments[2];this._index.query(r,i,a)}};Yf.prototype.interfaces_=function(){return[]};Yf.prototype.getClass=function(){return Yf};var Ny=function(t){function e(){if(t.call(this),this._parentGeom=null,this._lineEdgeMap=new mS,this._boundaryNodeRule=null,this._useBoundaryDeterminationRule=!0,this._argIndex=null,this._boundaryNodes=null,this._hasTooFewPoints=!1,this._invalidPoint=null,this._areaPtLocator=null,this._ptLocator=new Qu,arguments.length===2){var n=arguments[0],r=arguments[1],i=vu.OGC_SFS_BOUNDARY_RULE;this._argIndex=n,this._parentGeom=r,this._boundaryNodeRule=i,r!==null&&this.add(r)}else if(arguments.length===3){var a=arguments[0],h=arguments[1],u=arguments[2];this._argIndex=a,this._parentGeom=h,this._boundaryNodeRule=u,h!==null&&this.add(h)}}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.insertBoundaryPoint=function(n,r){var i=this._nodes.addNode(r),a=i.getLabel(),h=1,u=Pt.NONE;u=a.getLocation(n,ie.ON),u===Pt.BOUNDARY&&h++;var _=e.determineBoundary(this._boundaryNodeRule,h);a.setLocation(n,_)},e.prototype.computeSelfNodes=function(){if(arguments.length===2){var n=arguments[0],r=arguments[1];return this.computeSelfNodes(n,r,!1)}else if(arguments.length===3){var i=arguments[0],a=arguments[1],h=arguments[2],u=new $o(i,!0,!1);u.setIsDoneIfProperInt(h);var _=this.createEdgeSetIntersector(),w=this._parentGeom instanceof zc||this._parentGeom instanceof to||this._parentGeom instanceof Dc,C=a||!w;return _.computeIntersections(this._edges,u,C),this.addSelfIntersectionNodes(this._argIndex),u}},e.prototype.computeSplitEdges=function(n){for(var r=this._edges.iterator();r.hasNext();){var i=r.next();i.eiList.addSplitEdges(n)}},e.prototype.computeEdgeIntersections=function(n,r,i){var a=new $o(r,i,!0);a.setBoundaryNodes(this.getBoundaryNodes(),n.getBoundaryNodes());var h=this.createEdgeSetIntersector();return h.computeIntersections(this._edges,n._edges,a),a},e.prototype.getGeometry=function(){return this._parentGeom},e.prototype.getBoundaryNodeRule=function(){return this._boundaryNodeRule},e.prototype.hasTooFewPoints=function(){return this._hasTooFewPoints},e.prototype.addPoint=function(){if(arguments[0]instanceof _a){var n=arguments[0],r=n.getCoordinate();this.insertPoint(this._argIndex,r,Pt.INTERIOR)}else if(arguments[0]instanceof Tt){var i=arguments[0];this.insertPoint(this._argIndex,i,Pt.INTERIOR)}},e.prototype.addPolygon=function(n){var r=this;this.addPolygonRing(n.getExteriorRing(),Pt.EXTERIOR,Pt.INTERIOR);for(var i=0;i<n.getNumInteriorRing();i++){var a=n.getInteriorRingN(i);r.addPolygonRing(a,Pt.INTERIOR,Pt.EXTERIOR)}},e.prototype.addEdge=function(n){this.insertEdge(n);var r=n.getCoordinates();this.insertPoint(this._argIndex,r[0],Pt.BOUNDARY),this.insertPoint(this._argIndex,r[r.length-1],Pt.BOUNDARY)},e.prototype.addLineString=function(n){var r=In.removeRepeatedPoints(n.getCoordinates());if(r.length<2)return this._hasTooFewPoints=!0,this._invalidPoint=r[0],null;var i=new zv(r,new pr(this._argIndex,Pt.INTERIOR));this._lineEdgeMap.put(n,i),this.insertEdge(i),fn.isTrue(r.length>=2,"found LineString with single point"),this.insertBoundaryPoint(this._argIndex,r[0]),this.insertBoundaryPoint(this._argIndex,r[r.length-1])},e.prototype.getInvalidPoint=function(){return this._invalidPoint},e.prototype.getBoundaryPoints=function(){for(var n=this.getBoundaryNodes(),r=new Array(n.size()).fill(null),i=0,a=n.iterator();a.hasNext();){var h=a.next();r[i++]=h.getCoordinate().copy()}return r},e.prototype.getBoundaryNodes=function(){return this._boundaryNodes===null&&(this._boundaryNodes=this._nodes.getBoundaryNodes(this._argIndex)),this._boundaryNodes},e.prototype.addSelfIntersectionNode=function(n,r,i){if(this.isBoundaryNode(n,r))return null;i===Pt.BOUNDARY&&this._useBoundaryDeterminationRule?this.insertBoundaryPoint(n,r):this.insertPoint(n,r,i)},e.prototype.addPolygonRing=function(n,r,i){if(n.isEmpty())return null;var a=In.removeRepeatedPoints(n.getCoordinates());if(a.length<4)return this._hasTooFewPoints=!0,this._invalidPoint=a[0],null;var h=r,u=i;Se.isCCW(a)&&(h=i,u=r);var _=new zv(a,new pr(this._argIndex,Pt.BOUNDARY,h,u));this._lineEdgeMap.put(n,_),this.insertEdge(_),this.insertPoint(this._argIndex,a[0],Pt.BOUNDARY)},e.prototype.insertPoint=function(n,r,i){var a=this._nodes.addNode(r),h=a.getLabel();h===null?a._label=new pr(n,i):h.setLocation(n,i)},e.prototype.createEdgeSetIntersector=function(){return new hA},e.prototype.addSelfIntersectionNodes=function(n){for(var r=this,i=this._edges.iterator();i.hasNext();)for(var a=i.next(),h=a.getLabel().getLocation(n),u=a.eiList.iterator();u.hasNext();){var _=u.next();r.addSelfIntersectionNode(n,_.coord,h)}},e.prototype.add=function(){if(arguments.length===1){var n=arguments[0];if(n.isEmpty())return null;if(n instanceof Dc&&(this._useBoundaryDeterminationRule=!1),n instanceof to)this.addPolygon(n);else if(n instanceof si)this.addLineString(n);else if(n instanceof _a)this.addPoint(n);else if(n instanceof Jg)this.addCollection(n);else if(n instanceof $f)this.addCollection(n);else if(n instanceof Dc)this.addCollection(n);else if(n instanceof Ls)this.addCollection(n);else throw new Error(n.getClass().getName())}else return t.prototype.add.apply(this,arguments)},e.prototype.addCollection=function(n){for(var r=this,i=0;i<n.getNumGeometries();i++){var a=n.getGeometryN(i);r.add(a)}},e.prototype.locate=function(n){return tn(this._parentGeom,Tp)&&this._parentGeom.getNumGeometries()>50?(this._areaPtLocator===null&&(this._areaPtLocator=new im(this._parentGeom)),this._areaPtLocator.locate(n)):this._ptLocator.locate(n,this._parentGeom)},e.prototype.findEdge=function(){if(arguments.length===1){var n=arguments[0];return this._lineEdgeMap.get(n)}else return t.prototype.findEdge.apply(this,arguments)},e.prototype.interfaces_=function(){return[]},e.prototype.getClass=function(){return e},e.determineBoundary=function(n,r){return n.isInBoundary(r)?Pt.BOUNDARY:Pt.INTERIOR},e}(Kr),sm=function(){if(this._li=new ad,this._resultPrecisionModel=null,this._arg=null,arguments.length===1){var t=arguments[0];this.setComputationPrecision(t.getPrecisionModel()),this._arg=new Array(1).fill(null),this._arg[0]=new Ny(0,t)}else if(arguments.length===2){var e=arguments[0],n=arguments[1],r=vu.OGC_SFS_BOUNDARY_RULE;e.getPrecisionModel().compareTo(n.getPrecisionModel())>=0?this.setComputationPrecision(e.getPrecisionModel()):this.setComputationPrecision(n.getPrecisionModel()),this._arg=new Array(2).fill(null),this._arg[0]=new Ny(0,e,r),this._arg[1]=new Ny(1,n,r)}else if(arguments.length===3){var i=arguments[0],a=arguments[1],h=arguments[2];i.getPrecisionModel().compareTo(a.getPrecisionModel())>=0?this.setComputationPrecision(i.getPrecisionModel()):this.setComputationPrecision(a.getPrecisionModel()),this._arg=new Array(2).fill(null),this._arg[0]=new Ny(0,i,h),this._arg[1]=new Ny(1,a,h)}};sm.prototype.getArgGeometry=function(t){return this._arg[t].getGeometry()};sm.prototype.setComputationPrecision=function(t){this._resultPrecisionModel=t,this._li.setPrecisionModel(this._resultPrecisionModel)};sm.prototype.interfaces_=function(){return[]};sm.prototype.getClass=function(){return sm};var Of=function(){};Of.prototype.interfaces_=function(){return[]};Of.prototype.getClass=function(){return Of};Of.map=function(){if(arguments[0]instanceof We&&tn(arguments[1],Of.MapOp)){for(var t=arguments[0],e=arguments[1],n=new fe,r=0;r<t.getNumGeometries();r++){var i=e.map(t.getGeometryN(r));i!==null&&n.add(i)}return t.getFactory().buildGeometry(n)}else if(tn(arguments[0],Xi)&&tn(arguments[1],Of.MapOp)){for(var a=arguments[0],h=arguments[1],u=new fe,_=a.iterator();_.hasNext();){var w=_.next(),C=h.map(w);C!==null&&u.add(C)}return u}};Of.MapOp=function(){};var hn=function(t){function e(){var n=arguments[0],r=arguments[1];t.call(this,n,r),this._ptLocator=new Qu,this._geomFact=null,this._resultGeom=null,this._graph=null,this._edgeList=new Ku,this._resultPolyList=new fe,this._resultLineList=new fe,this._resultPointList=new fe,this._graph=new Kr(new IS),this._geomFact=n.getFactory()}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.insertUniqueEdge=function(n){var r=this._edgeList.findEqualEdge(n);if(r!==null){var i=r.getLabel(),a=n.getLabel();r.isPointwiseEqual(n)||(a=new pr(n.getLabel()),a.flip());var h=r.getDepth();h.isNull()&&h.add(i),h.add(a),i.merge(a)}else this._edgeList.add(n)},e.prototype.getGraph=function(){return this._graph},e.prototype.cancelDuplicateResultEdges=function(){for(var n=this._graph.getEdgeEnds().iterator();n.hasNext();){var r=n.next(),i=r.getSym();r.isInResult()&&i.isInResult()&&(r.setInResult(!1),i.setInResult(!1))}},e.prototype.isCoveredByLA=function(n){return!!(this.isCovered(n,this._resultLineList)||this.isCovered(n,this._resultPolyList))},e.prototype.computeGeometry=function(n,r,i,a){var h=new fe;return h.addAll(n),h.addAll(r),h.addAll(i),h.isEmpty()?e.createEmptyResult(a,this._arg[0].getGeometry(),this._arg[1].getGeometry(),this._geomFact):this._geomFact.buildGeometry(h)},e.prototype.mergeSymLabels=function(){for(var n=this._graph.getNodes().iterator();n.hasNext();){var r=n.next();r.getEdges().mergeSymLabels()}},e.prototype.isCovered=function(n,r){for(var i=this,a=r.iterator();a.hasNext();){var h=a.next(),u=i._ptLocator.locate(n,h);if(u!==Pt.EXTERIOR)return!0}return!1},e.prototype.replaceCollapsedEdges=function(){for(var n=new fe,r=this._edgeList.iterator();r.hasNext();){var i=r.next();i.isCollapsed()&&(r.remove(),n.add(i.getCollapsedEdge()))}this._edgeList.addAll(n)},e.prototype.updateNodeLabelling=function(){for(var n=this._graph.getNodes().iterator();n.hasNext();){var r=n.next(),i=r.getEdges().getLabel();r.getLabel().merge(i)}},e.prototype.getResultGeometry=function(n){return this.computeOverlay(n),this._resultGeom},e.prototype.insertUniqueEdges=function(n){for(var r=this,i=n.iterator();i.hasNext();){var a=i.next();r.insertUniqueEdge(a)}},e.prototype.computeOverlay=function(n){this.copyPoints(0),this.copyPoints(1),this._arg[0].computeSelfNodes(this._li,!1),this._arg[1].computeSelfNodes(this._li,!1),this._arg[0].computeEdgeIntersections(this._arg[1],this._li,!0);var r=new fe;this._arg[0].computeSplitEdges(r),this._arg[1].computeSplitEdges(r),this.insertUniqueEdges(r),this.computeLabelsFromDepths(),this.replaceCollapsedEdges(),Xf.checkValid(this._edgeList.getEdges()),this._graph.addEdges(this._edgeList.getEdges()),this.computeLabelling(),this.labelIncompleteNodes(),this.findResultAreaEdges(n),this.cancelDuplicateResultEdges();var i=new va(this._geomFact);i.add(this._graph),this._resultPolyList=i.getPolygons();var a=new ec(this,this._geomFact,this._ptLocator);this._resultLineList=a.build(n);var h=new $d(this,this._geomFact,this._ptLocator);this._resultPointList=h.build(n),this._resultGeom=this.computeGeometry(this._resultPointList,this._resultLineList,this._resultPolyList,n)},e.prototype.labelIncompleteNode=function(n,r){var i=this._ptLocator.locate(n.getCoordinate(),this._arg[r].getGeometry());n.getLabel().setLocation(r,i)},e.prototype.copyPoints=function(n){for(var r=this,i=this._arg[n].getNodeIterator();i.hasNext();){var a=i.next(),h=r._graph.addNode(a.getCoordinate());h.setLabel(n,a.getLabel().getLocation(n))}},e.prototype.findResultAreaEdges=function(n){for(var r=this._graph.getEdgeEnds().iterator();r.hasNext();){var i=r.next(),a=i.getLabel();a.isArea()&&!i.isInteriorAreaEdge()&&e.isResultOfOp(a.getLocation(0,ie.RIGHT),a.getLocation(1,ie.RIGHT),n)&&i.setInResult(!0)}},e.prototype.computeLabelsFromDepths=function(){for(var n=this._edgeList.iterator();n.hasNext();){var r=n.next(),i=r.getLabel(),a=r.getDepth();if(!a.isNull()){a.normalize();for(var h=0;h<2;h++)!i.isNull(h)&&i.isArea()&&!a.isNull(h)&&(a.getDelta(h)===0?i.toLine(h):(fn.isTrue(!a.isNull(h,ie.LEFT),"depth of LEFT side has not been initialized"),i.setLocation(h,ie.LEFT,a.getLocation(h,ie.LEFT)),fn.isTrue(!a.isNull(h,ie.RIGHT),"depth of RIGHT side has not been initialized"),i.setLocation(h,ie.RIGHT,a.getLocation(h,ie.RIGHT))))}}},e.prototype.computeLabelling=function(){for(var n=this,r=this._graph.getNodes().iterator();r.hasNext();){var i=r.next();i.getEdges().computeLabelling(n._arg)}this.mergeSymLabels(),this.updateNodeLabelling()},e.prototype.labelIncompleteNodes=function(){for(var n=this,r=this._graph.getNodes().iterator();r.hasNext();){var i=r.next(),a=i.getLabel();i.isIsolated()&&(a.isNull(0)?n.labelIncompleteNode(i,0):n.labelIncompleteNode(i,1)),i.getEdges().updateLabelling(a)}},e.prototype.isCoveredByA=function(n){return!!this.isCovered(n,this._resultPolyList)},e.prototype.interfaces_=function(){return[]},e.prototype.getClass=function(){return e},e}(sm);hn.overlayOp=function(t,e,n){var r=new hn(t,e),i=r.getResultGeometry(n);return i};hn.intersection=function(t,e){if(t.isEmpty()||e.isEmpty())return hn.createEmptyResult(hn.INTERSECTION,t,e,t.getFactory());if(t.isGeometryCollection()){var n=e;return Bd.map(t,{interfaces_:function(){return[Of.MapOp]},map:function(r){return r.intersection(n)}})}return t.checkNotGeometryCollection(t),t.checkNotGeometryCollection(e),Ms.overlayOp(t,e,hn.INTERSECTION)};hn.symDifference=function(t,e){if(t.isEmpty()||e.isEmpty()){if(t.isEmpty()&&e.isEmpty())return hn.createEmptyResult(hn.SYMDIFFERENCE,t,e,t.getFactory());if(t.isEmpty())return e.copy();if(e.isEmpty())return t.copy()}return t.checkNotGeometryCollection(t),t.checkNotGeometryCollection(e),Ms.overlayOp(t,e,hn.SYMDIFFERENCE)};hn.resultDimension=function(t,e,n){var r=e.getDimension(),i=n.getDimension(),a=-1;switch(t){case hn.INTERSECTION:a=Math.min(r,i);break;case hn.UNION:a=Math.max(r,i);break;case hn.DIFFERENCE:a=r;break;case hn.SYMDIFFERENCE:a=Math.max(r,i);break}return a};hn.createEmptyResult=function(t,e,n,r){var i=null;switch(hn.resultDimension(t,e,n)){case-1:i=r.createGeometryCollection(new Array(0).fill(null));break;case 0:i=r.createPoint();break;case 1:i=r.createLineString();break;case 2:i=r.createPolygon();break}return i};hn.difference=function(t,e){return t.isEmpty()?hn.createEmptyResult(hn.DIFFERENCE,t,e,t.getFactory()):e.isEmpty()?t.copy():(t.checkNotGeometryCollection(t),t.checkNotGeometryCollection(e),Ms.overlayOp(t,e,hn.DIFFERENCE))};hn.isResultOfOp=function(){if(arguments.length===2){var t=arguments[0],e=arguments[1],n=t.getLocation(0),r=t.getLocation(1);return hn.isResultOfOp(n,r,e)}else if(arguments.length===3){var i=arguments[0],a=arguments[1],h=arguments[2];switch(i===Pt.BOUNDARY&&(i=Pt.INTERIOR),a===Pt.BOUNDARY&&(a=Pt.INTERIOR),h){case hn.INTERSECTION:return i===Pt.INTERIOR&&a===Pt.INTERIOR;case hn.UNION:return i===Pt.INTERIOR||a===Pt.INTERIOR;case hn.DIFFERENCE:return i===Pt.INTERIOR&&a!==Pt.INTERIOR;case hn.SYMDIFFERENCE:return i===Pt.INTERIOR&&a!==Pt.INTERIOR||i!==Pt.INTERIOR&&a===Pt.INTERIOR}return!1}};hn.INTERSECTION=1;hn.UNION=2;hn.DIFFERENCE=3;hn.SYMDIFFERENCE=4;var bp=function(){this._g=null,this._boundaryDistanceTolerance=null,this._linework=null,this._ptLocator=new Qu,this._seg=new Ve;var t=arguments[0],e=arguments[1];this._g=t,this._boundaryDistanceTolerance=e,this._linework=this.extractLinework(t)};bp.prototype.isWithinToleranceOfBoundary=function(t){for(var e=this,n=0;n<this._linework.getNumGeometries();n++)for(var r=e._linework.getGeometryN(n),i=r.getCoordinateSequence(),a=0;a<i.size()-1;a++){i.getCoordinate(a,e._seg.p0),i.getCoordinate(a+1,e._seg.p1);var h=e._seg.distance(t);if(h<=e._boundaryDistanceTolerance)return!0}return!1};bp.prototype.getLocation=function(t){return this.isWithinToleranceOfBoundary(t)?Pt.BOUNDARY:this._ptLocator.locate(t,this._g)};bp.prototype.extractLinework=function(t){var e=new am;t.apply(e);var n=e.getLinework(),r=wn.toLineStringArray(n);return t.getFactory().createMultiLineString(r)};bp.prototype.interfaces_=function(){return[]};bp.prototype.getClass=function(){return bp};var am=function(){this._linework=null,this._linework=new fe};am.prototype.getLinework=function(){return this._linework};am.prototype.filter=function(t){var e=this;if(t instanceof to){var n=t;this._linework.add(n.getExteriorRing());for(var r=0;r<n.getNumInteriorRing();r++)e._linework.add(n.getInteriorRingN(r))}};am.prototype.interfaces_=function(){return[Zl]};am.prototype.getClass=function(){return am};var Zf=function(){this._g=null,this._doLeft=!0,this._doRight=!0;var t=arguments[0];this._g=t};Zf.prototype.extractPoints=function(t,e,n){for(var r=this,i=t.getCoordinates(),a=0;a<i.length-1;a++)r.computeOffsetPoints(i[a],i[a+1],e,n)};Zf.prototype.setSidesToGenerate=function(t,e){this._doLeft=t,this._doRight=e};Zf.prototype.getPoints=function(t){for(var e=this,n=new fe,r=Po.getLines(this._g),i=r.iterator();i.hasNext();){var a=i.next();e.extractPoints(a,t,n)}return n};Zf.prototype.computeOffsetPoints=function(t,e,n,r){var i=e.x-t.x,a=e.y-t.y,h=Math.sqrt(i*i+a*a),u=n*i/h,_=n*a/h,w=(e.x+t.x)/2,C=(e.y+t.y)/2;if(this._doLeft){var P=new Tt(w-_,C+u);r.add(P)}if(this._doRight){var D=new Tt(w+_,C-u);r.add(D)}};Zf.prototype.interfaces_=function(){return[]};Zf.prototype.getClass=function(){return Zf};var Ja=function t(){this._geom=null,this._locFinder=null,this._location=new Array(3).fill(null),this._invalidLocation=null,this._boundaryDistanceTolerance=t.TOLERANCE,this._testCoords=new fe;var e=arguments[0],n=arguments[1],r=arguments[2];this._boundaryDistanceTolerance=t.computeBoundaryDistanceTolerance(e,n),this._geom=[e,n,r],this._locFinder=[new bp(this._geom[0],this._boundaryDistanceTolerance),new bp(this._geom[1],this._boundaryDistanceTolerance),new bp(this._geom[2],this._boundaryDistanceTolerance)]},OS={TOLERANCE:{configurable:!0}};Ja.prototype.reportResult=function(t,e,n){Fo.out.println("Overlay result invalid - A:"+Pt.toLocationSymbol(e[0])+" B:"+Pt.toLocationSymbol(e[1])+" expected:"+(n?"i":"e")+" actual:"+Pt.toLocationSymbol(e[2]))};Ja.prototype.isValid=function(t){this.addTestPts(this._geom[0]),this.addTestPts(this._geom[1]);var e=this.checkValid(t);return e};Ja.prototype.checkValid=function(){var t=this;if(arguments.length===1){for(var e=arguments[0],n=0;n<this._testCoords.size();n++){var r=t._testCoords.get(n);if(!t.checkValid(e,r))return t._invalidLocation=r,!1}return!0}else if(arguments.length===2){var i=arguments[0],a=arguments[1];return this._location[0]=this._locFinder[0].getLocation(a),this._location[1]=this._locFinder[1].getLocation(a),this._location[2]=this._locFinder[2].getLocation(a),Ja.hasLocation(this._location,Pt.BOUNDARY)?!0:this.isValidResult(i,this._location)}};Ja.prototype.addTestPts=function(t){var e=new Zf(t);this._testCoords.addAll(e.getPoints(5*this._boundaryDistanceTolerance))};Ja.prototype.isValidResult=function(t,e){var n=hn.isResultOfOp(e[0],e[1],t),r=e[2]===Pt.INTERIOR,i=!(n^r);return i||this.reportResult(t,e,n),i};Ja.prototype.getInvalidLocation=function(){return this._invalidLocation};Ja.prototype.interfaces_=function(){return[]};Ja.prototype.getClass=function(){return Ja};Ja.hasLocation=function(t,e){for(var n=0;n<3;n++)if(t[n]===e)return!0;return!1};Ja.computeBoundaryDistanceTolerance=function(t,e){return Math.min(yi.computeSizeBasedSnapTolerance(t),yi.computeSizeBasedSnapTolerance(e))};Ja.isValid=function(t,e,n,r){var i=new Ja(t,e,r);return i.isValid(n)};OS.TOLERANCE.get=function(){return 1e-6};Object.defineProperties(Ja,OS);var Ua=function t(e){this._geomFactory=null,this._skipEmpty=!1,this._inputGeoms=null,this._geomFactory=t.extractFactory(e),this._inputGeoms=e};Ua.prototype.extractElements=function(t,e){var n=this;if(t===null)return null;for(var r=0;r<t.getNumGeometries();r++){var i=t.getGeometryN(r);n._skipEmpty&&i.isEmpty()||e.add(i)}};Ua.prototype.combine=function(){for(var t=this,e=new fe,n=this._inputGeoms.iterator();n.hasNext();){var r=n.next();t.extractElements(r,e)}return e.size()===0?this._geomFactory!==null?this._geomFactory.createGeometryCollection(null):null:this._geomFactory.buildGeometry(e)};Ua.prototype.interfaces_=function(){return[]};Ua.prototype.getClass=function(){return Ua};Ua.combine=function(){if(arguments.length===1){var t=arguments[0],e=new Ua(t);return e.combine()}else if(arguments.length===2){var n=arguments[0],r=arguments[1],i=new Ua(Ua.createList(n,r));return i.combine()}else if(arguments.length===3){var a=arguments[0],h=arguments[1],u=arguments[2],_=new Ua(Ua.createList(a,h,u));return _.combine()}};Ua.extractFactory=function(t){return t.isEmpty()?null:t.iterator().next().getFactory()};Ua.createList=function(){if(arguments.length===2){var t=arguments[0],e=arguments[1],n=new fe;return n.add(t),n.add(e),n}else if(arguments.length===3){var r=arguments[0],i=arguments[1],a=arguments[2],h=new fe;return h.add(r),h.add(i),h.add(a),h}};var Ri=function(){this._inputPolys=null,this._geomFactory=null;var t=arguments[0];this._inputPolys=t,this._inputPolys===null&&(this._inputPolys=new fe)},RS={STRTREE_NODE_CAPACITY:{configurable:!0}};Ri.prototype.reduceToGeometries=function(t){for(var e=this,n=new fe,r=t.iterator();r.hasNext();){var i=r.next(),a=null;tn(i,ju)?a=e.unionTree(i):i instanceof We&&(a=i),n.add(a)}return n};Ri.prototype.extractByEnvelope=function(t,e,n){for(var r=new fe,i=0;i<e.getNumGeometries();i++){var a=e.getGeometryN(i);a.getEnvelopeInternal().intersects(t)?r.add(a):n.add(a)}return this._geomFactory.buildGeometry(r)};Ri.prototype.unionOptimized=function(t,e){var n=t.getEnvelopeInternal(),r=e.getEnvelopeInternal();if(!n.intersects(r)){var i=Ua.combine(t,e);return i}if(t.getNumGeometries()<=1&&e.getNumGeometries()<=1)return this.unionActual(t,e);var a=n.intersection(r);return this.unionUsingEnvelopeIntersection(t,e,a)};Ri.prototype.union=function(){if(this._inputPolys===null)throw new Error("union() method cannot be called twice");if(this._inputPolys.isEmpty())return null;this._geomFactory=this._inputPolys.iterator().next().getFactory();for(var t=new xS(Ri.STRTREE_NODE_CAPACITY),e=this._inputPolys.iterator();e.hasNext();){var n=e.next();t.insert(n.getEnvelopeInternal(),n)}this._inputPolys=null;var r=t.itemsTree(),i=this.unionTree(r);return i};Ri.prototype.binaryUnion=function(){if(arguments.length===1){var t=arguments[0];return this.binaryUnion(t,0,t.size())}else if(arguments.length===3){var e=arguments[0],n=arguments[1],r=arguments[2];if(r-n<=1){var i=Ri.getGeometry(e,n);return this.unionSafe(i,null)}else{if(r-n===2)return this.unionSafe(Ri.getGeometry(e,n),Ri.getGeometry(e,n+1));var a=Math.trunc((r+n)/2),h=this.binaryUnion(e,n,a),u=this.binaryUnion(e,a,r);return this.unionSafe(h,u)}}};Ri.prototype.repeatedUnion=function(t){for(var e=null,n=t.iterator();n.hasNext();){var r=n.next();e===null?e=r.copy():e=e.union(r)}return e};Ri.prototype.unionSafe=function(t,e){return t===null&&e===null?null:t===null?e.copy():e===null?t.copy():this.unionOptimized(t,e)};Ri.prototype.unionActual=function(t,e){return Ri.restrictToPolygons(t.union(e))};Ri.prototype.unionTree=function(t){var e=this.reduceToGeometries(t),n=this.binaryUnion(e);return n};Ri.prototype.unionUsingEnvelopeIntersection=function(t,e,n){var r=new fe,i=this.extractByEnvelope(n,t,r),a=this.extractByEnvelope(n,e,r),h=this.unionActual(i,a);r.add(h);var u=Ua.combine(r);return u};Ri.prototype.bufferUnion=function(){if(arguments.length===1){var t=arguments[0],e=t.get(0).getFactory(),n=e.buildGeometry(t),r=n.buffer(0);return r}else if(arguments.length===2){var i=arguments[0],a=arguments[1],h=i.getFactory(),u=h.createGeometryCollection([i,a]),_=u.buffer(0);return _}};Ri.prototype.interfaces_=function(){return[]};Ri.prototype.getClass=function(){return Ri};Ri.restrictToPolygons=function(t){if(tn(t,Tp))return t;var e=Lh.getPolygons(t);return e.size()===1?e.get(0):t.getFactory().createMultiPolygon(wn.toPolygonArray(e))};Ri.getGeometry=function(t,e){return e>=t.size()?null:t.get(e)};Ri.union=function(t){var e=new Ri(t);return e.union()};RS.STRTREE_NODE_CAPACITY.get=function(){return 4};Object.defineProperties(Ri,RS);var $v=function(){};$v.prototype.interfaces_=function(){return[]};$v.prototype.getClass=function(){return $v};$v.union=function(t,e){if(t.isEmpty()||e.isEmpty()){if(t.isEmpty()&&e.isEmpty())return hn.createEmptyResult(hn.UNION,t,e,t.getFactory());if(t.isEmpty())return e.copy();if(e.isEmpty())return t.copy()}return t.checkNotGeometryCollection(t),t.checkNotGeometryCollection(e),Ms.overlayOp(t,e,hn.UNION)};function ud(){return new Vv}function Vv(){this.reset()}Vv.prototype={constructor:Vv,reset:function(){this.s=this.t=0},add:function(t){UE(gv,t,this.t),UE(this,gv.s,this.s),this.s?this.t+=gv.t:this.s=gv.t},valueOf:function(){return this.s}};var gv=new Vv;function UE(t,e,n){var r=t.s=e+n,i=r-e,a=r-i;t.t=e-a+(n-i)}var ii=1e-6,vr=Math.PI,Ch=vr/2,GE=vr/4,Rh=vr*2,Lf=180/vr,Rl=vr/180,ws=Math.abs,dA=Math.atan,um=Math.atan2,Yi=Math.cos,Zi=Math.sin,km=Math.sqrt;function FS(t){return t>1?0:t<-1?vr:Math.acos(t)}function Ud(t){return t>1?Ch:t<-1?-Ch:Math.asin(t)}function My(){}function Uv(t,e){t&&jE.hasOwnProperty(t.type)&&jE[t.type](t,e)}var qE={Feature:function(t,e){Uv(t.geometry,e)},FeatureCollection:function(t,e){for(var n=t.features,r=-1,i=n.length;++r<i;)Uv(n[r].geometry,e)}},jE={Sphere:function(t,e){e.sphere()},Point:function(t,e){t=t.coordinates,e.point(t[0],t[1],t[2])},MultiPoint:function(t,e){for(var n=t.coordinates,r=-1,i=n.length;++r<i;)t=n[r],e.point(t[0],t[1],t[2])},LineString:function(t,e){tb(t.coordinates,e,0)},MultiLineString:function(t,e){for(var n=t.coordinates,r=-1,i=n.length;++r<i;)tb(n[r],e,0)},Polygon:function(t,e){XE(t.coordinates,e)},MultiPolygon:function(t,e){for(var n=t.coordinates,r=-1,i=n.length;++r<i;)XE(n[r],e)},GeometryCollection:function(t,e){for(var n=t.geometries,r=-1,i=n.length;++r<i;)Uv(n[r],e)}};function tb(t,e,n){var r=-1,i=t.length-n,a;for(e.lineStart();++r<i;)a=t[r],e.point(a[0],a[1],a[2]);e.lineEnd()}function XE(t,e){var n=-1,r=t.length;for(e.polygonStart();++n<r;)tb(t[n],e,1);e.polygonEnd()}function gA(t,e){t&&qE.hasOwnProperty(t.type)?qE[t.type](t,e):Uv(t,e)}ud();ud();function eb(t){return[um(t[1],t[0]),Ud(t[2])]}function lm(t){var e=t[0],n=t[1],r=Yi(n);return[r*Yi(e),r*Zi(e),Zi(n)]}function mv(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]}function Gv(t,e){return[t[1]*e[2]-t[2]*e[1],t[2]*e[0]-t[0]*e[2],t[0]*e[1]-t[1]*e[0]]}function Mx(t,e){t[0]+=e[0],t[1]+=e[1],t[2]+=e[2]}function yv(t,e){return[t[0]*e,t[1]*e,t[2]*e]}function nb(t){var e=km(t[0]*t[0]+t[1]*t[1]+t[2]*t[2]);t[0]/=e,t[1]/=e,t[2]/=e}ud();function kS(t,e){function n(r,i){return r=t(r,i),e(r[0],r[1])}return t.invert&&e.invert&&(n.invert=function(r,i){return r=e.invert(r,i),r&&t.invert(r[0],r[1])}),n}function rb(t,e){return[t>vr?t-Rh:t<-vr?t+Rh:t,e]}rb.invert=rb;function mA(t,e,n){return(t%=Rh)?e||n?kS(ZE(t),HE(e,n)):ZE(t):e||n?HE(e,n):rb}function YE(t){return function(e,n){return e+=t,[e>vr?e-Rh:e<-vr?e+Rh:e,n]}}function ZE(t){var e=YE(t);return e.invert=YE(-t),e}function HE(t,e){var n=Yi(t),r=Zi(t),i=Yi(e),a=Zi(e);function h(u,_){var w=Yi(_),C=Yi(u)*w,P=Zi(u)*w,D=Zi(_),B=D*n+C*r;return[um(P*i-B*a,C*n-D*r),Ud(B*i+P*a)]}return h.invert=function(u,_){var w=Yi(_),C=Yi(u)*w,P=Zi(u)*w,D=Zi(_),B=D*i-P*a;return[um(P*i+D*a,C*n+B*r),Ud(B*n-C*r)]},h}function yA(t,e,n,r,i,a){if(n){var h=Yi(e),u=Zi(e),_=r*n;i==null?(i=e+r*Rh,a=e-_/2):(i=WE(h,i),a=WE(h,a),(r>0?i<a:i>a)&&(i+=r*Rh));for(var w,C=i;r>0?C>a:C<a;C-=_)w=eb([h,-u*Yi(C),-u*Zi(C)]),t.point(w[0],w[1])}}function WE(t,e){e=lm(e),e[0]-=t,nb(e);var n=FS(-e[1]);return((-e[2]<0?-n:n)+Rh-ii)%Rh}function zS(){var t=[],e;return{point:function(n,r){e.push([n,r])},lineStart:function(){t.push(e=[])},lineEnd:My,rejoin:function(){t.length>1&&t.push(t.pop().concat(t.shift()))},result:function(){var n=t;return t=[],e=null,n}}}function _A(t,e,n,r,i,a){var h=t[0],u=t[1],_=e[0],w=e[1],C=0,P=1,D=_-h,B=w-u,$;if($=n-h,!(!D&&$>0)){if($/=D,D<0){if($<C)return;$<P&&(P=$)}else if(D>0){if($>P)return;$>C&&(C=$)}if($=i-h,!(!D&&$<0)){if($/=D,D<0){if($>P)return;$>C&&(C=$)}else if(D>0){if($<C)return;$<P&&(P=$)}if($=r-u,!(!B&&$>0)){if($/=B,B<0){if($<C)return;$<P&&(P=$)}else if(B>0){if($>P)return;$>C&&(C=$)}if($=a-u,!(!B&&$<0)){if($/=B,B<0){if($>P)return;$>C&&(C=$)}else if(B>0){if($<C)return;$<P&&(P=$)}return C>0&&(t[0]=h+C*D,t[1]=u+C*B),P<1&&(e[0]=h+P*D,e[1]=u+P*B),!0}}}}}function Lv(t,e){return ws(t[0]-e[0])<ii&&ws(t[1]-e[1])<ii}function _v(t,e,n,r){this.x=t,this.z=e,this.o=n,this.e=r,this.v=!1,this.n=this.p=null}function BS(t,e,n,r,i){var a=[],h=[],u,_;if(t.forEach(function($){if(!((Z=$.length-1)<=0)){var Z,W=$[0],rt=$[Z],ct;if(Lv(W,rt)){for(i.lineStart(),u=0;u<Z;++u)i.point((W=$[u])[0],W[1]);i.lineEnd();return}a.push(ct=new _v(W,$,null,!0)),h.push(ct.o=new _v(W,null,ct,!1)),a.push(ct=new _v(rt,$,null,!1)),h.push(ct.o=new _v(rt,null,ct,!0))}}),!!a.length){for(h.sort(e),JE(a),JE(h),u=0,_=h.length;u<_;++u)h[u].e=n=!n;for(var w=a[0],C,P;;){for(var D=w,B=!0;D.v;)if((D=D.n)===w)return;C=D.z,i.lineStart();do{if(D.v=D.o.v=!0,D.e){if(B)for(u=0,_=C.length;u<_;++u)i.point((P=C[u])[0],P[1]);else r(D.x,D.n.x,1,i);D=D.n}else{if(B)for(C=D.p.z,u=C.length-1;u>=0;--u)i.point((P=C[u])[0],P[1]);else r(D.x,D.p.x,-1,i);D=D.p}D=D.o,C=D.z,B=!B}while(!D.v);i.lineEnd()}}}function JE(t){if(e=t.length){for(var e,n=0,r=t[0],i;++n<e;)r.n=i=t[n],i.p=r,r=i;r.n=i=t[0],i.p=r}}function $S(t,e){return t<e?-1:t>e?1:t>=e?0:NaN}function vA(t){return t.length===1&&(t=xA(t)),{left:function(e,n,r,i){for(r==null&&(r=0),i==null&&(i=e.length);r<i;){var a=r+i>>>1;t(e[a],n)<0?r=a+1:i=a}return r},right:function(e,n,r,i){for(r==null&&(r=0),i==null&&(i=e.length);r<i;){var a=r+i>>>1;t(e[a],n)>0?i=a:r=a+1}return r}}}function xA(t){return function(e,n){return $S(t(e),n)}}vA($S);function VS(t){for(var e=t.length,n,r=-1,i=0,a,h;++r<e;)i+=t[r].length;for(a=new Array(i);--e>=0;)for(h=t[e],n=h.length;--n>=0;)a[--i]=h[n];return a}var Ay=1e9,vv=-Ay;function bA(t,e,n,r){function i(w,C){return t<=w&&w<=n&&e<=C&&C<=r}function a(w,C,P,D){var B=0,$=0;if(w==null||(B=h(w,P))!==($=h(C,P))||_(w,C)<0^P>0)do D.point(B===0||B===3?t:n,B>1?r:e);while((B=(B+P+4)%4)!==$);else D.point(C[0],C[1])}function h(w,C){return ws(w[0]-t)<ii?C>0?0:3:ws(w[0]-n)<ii?C>0?2:1:ws(w[1]-e)<ii?C>0?1:0:C>0?3:2}function u(w,C){return _(w.x,C.x)}function _(w,C){var P=h(w,1),D=h(C,1);return P!==D?P-D:P===0?C[1]-w[1]:P===1?w[0]-C[0]:P===2?w[1]-C[1]:C[0]-w[0]}return function(w){var C=w,P=zS(),D,B,$,Z,W,rt,ct,pt,gt,Ut,zt,Ot={point:At,lineStart:Kt,lineEnd:Ke,polygonStart:Yt,polygonEnd:be};function At(Qt,Te){i(Qt,Te)&&C.point(Qt,Te)}function Rt(){for(var Qt=0,Te=0,Ge=B.length;Te<Ge;++Te)for(var gn=B[Te],xn=1,ei=gn.length,jn=gn[0],$n,Fe,Vn=jn[0],rr=jn[1];xn<ei;++xn)$n=Vn,Fe=rr,jn=gn[xn],Vn=jn[0],rr=jn[1],Fe<=r?rr>r&&(Vn-$n)*(r-Fe)>(rr-Fe)*(t-$n)&&++Qt:rr<=r&&(Vn-$n)*(r-Fe)<(rr-Fe)*(t-$n)&&--Qt;return Qt}function Yt(){C=P,D=[],B=[],zt=!0}function be(){var Qt=Rt(),Te=zt&&Qt,Ge=(D=VS(D)).length;(Te||Ge)&&(w.polygonStart(),Te&&(w.lineStart(),a(null,null,1,w),w.lineEnd()),Ge&&BS(D,u,Qt,a,w),w.polygonEnd()),C=w,D=B=$=null}function Kt(){Ot.point=vt,B&&B.push($=[]),Ut=!0,gt=!1,ct=pt=NaN}function Ke(){D&&(vt(Z,W),rt&&gt&&P.rejoin(),D.push(P.result())),Ot.point=At,gt&&C.lineEnd()}function vt(Qt,Te){var Ge=i(Qt,Te);if(B&&$.push([Qt,Te]),Ut)Z=Qt,W=Te,rt=Ge,Ut=!1,Ge&&(C.lineStart(),C.point(Qt,Te));else if(Ge&&gt)C.point(Qt,Te);else{var gn=[ct=Math.max(vv,Math.min(Ay,ct)),pt=Math.max(vv,Math.min(Ay,pt))],xn=[Qt=Math.max(vv,Math.min(Ay,Qt)),Te=Math.max(vv,Math.min(Ay,Te))];_A(gn,xn,t,e,n,r)?(gt||(C.lineStart(),C.point(gn[0],gn[1])),C.point(xn[0],xn[1]),Ge||C.lineEnd(),zt=!1):Ge&&(C.lineStart(),C.point(Qt,Te),zt=!1)}ct=Qt,pt=Te,gt=Ge}return Ot}}var Ax=ud();function wA(t,e){var n=e[0],r=e[1],i=[Zi(n),-Yi(n),0],a=0,h=0;Ax.reset();for(var u=0,_=t.length;u<_;++u)if(C=(w=t[u]).length)for(var w,C,P=w[C-1],D=P[0],B=P[1]/2+GE,$=Zi(B),Z=Yi(B),W=0;W<C;++W,D=ct,$=gt,Z=Ut,P=rt){var rt=w[W],ct=rt[0],pt=rt[1]/2+GE,gt=Zi(pt),Ut=Yi(pt),zt=ct-D,Ot=zt>=0?1:-1,At=Ot*zt,Rt=At>vr,Yt=$*gt;if(Ax.add(um(Yt*Ot*Zi(At),Z*Ut+Yt*Yi(At))),a+=Rt?zt+Ot*Rh:zt,Rt^D>=n^ct>=n){var be=Gv(lm(P),lm(rt));nb(be);var Kt=Gv(i,be);nb(Kt);var Ke=(Rt^zt>=0?-1:1)*Ud(Kt[2]);(r>Ke||r===Ke&&(be[0]||be[1]))&&(h+=Rt^zt>=0?1:-1)}}return(a<-ii||a<ii&&Ax<-ii)^h&1}ud();function KE(t){return t}ud();ud();var cm=1/0,qv=cm,Qy=-cm,jv=Qy,QE={point:EA,lineStart:My,lineEnd:My,polygonStart:My,polygonEnd:My,result:function(){var t=[[cm,qv],[Qy,jv]];return Qy=jv=-(qv=cm=1/0),t}};function EA(t,e){t<cm&&(cm=t),t>Qy&&(Qy=t),e<qv&&(qv=e),e>jv&&(jv=e)}ud();function US(t,e,n,r){return function(i,a){var h=e(a),u=i.invert(r[0],r[1]),_=zS(),w=e(_),C=!1,P,D,B,$={point:Z,lineStart:rt,lineEnd:ct,polygonStart:function(){$.point=pt,$.lineStart=gt,$.lineEnd=Ut,D=[],P=[]},polygonEnd:function(){$.point=Z,$.lineStart=rt,$.lineEnd=ct,D=VS(D);var zt=wA(P,u);D.length?(C||(a.polygonStart(),C=!0),BS(D,SA,zt,n,a)):zt&&(C||(a.polygonStart(),C=!0),a.lineStart(),n(null,null,1,a),a.lineEnd()),C&&(a.polygonEnd(),C=!1),D=P=null},sphere:function(){a.polygonStart(),a.lineStart(),n(null,null,1,a),a.lineEnd(),a.polygonEnd()}};function Z(zt,Ot){var At=i(zt,Ot);t(zt=At[0],Ot=At[1])&&a.point(zt,Ot)}function W(zt,Ot){var At=i(zt,Ot);h.point(At[0],At[1])}function rt(){$.point=W,h.lineStart()}function ct(){$.point=Z,h.lineEnd()}function pt(zt,Ot){B.push([zt,Ot]);var At=i(zt,Ot);w.point(At[0],At[1])}function gt(){w.lineStart(),B=[]}function Ut(){pt(B[0][0],B[0][1]),w.lineEnd();var zt=w.clean(),Ot=_.result(),At,Rt=Ot.length,Yt,be,Kt;if(B.pop(),P.push(B),B=null,!!Rt){if(zt&1){if(be=Ot[0],(Yt=be.length-1)>0){for(C||(a.polygonStart(),C=!0),a.lineStart(),At=0;At<Yt;++At)a.point((Kt=be[At])[0],Kt[1]);a.lineEnd()}return}Rt>1&&zt&2&&Ot.push(Ot.pop().concat(Ot.shift())),D.push(Ot.filter(IA))}}return $}}function IA(t){return t.length>1}function SA(t,e){return((t=t.x)[0]<0?t[1]-Ch-ii:Ch-t[1])-((e=e.x)[0]<0?e[1]-Ch-ii:Ch-e[1])}const tI=US(function(){return!0},CA,LA,[-vr,-Ch]);function CA(t){var e=NaN,n=NaN,r=NaN,i;return{lineStart:function(){t.lineStart(),i=1},point:function(a,h){var u=a>0?vr:-vr,_=ws(a-e);ws(_-vr)<ii?(t.point(e,n=(n+h)/2>0?Ch:-Ch),t.point(r,n),t.lineEnd(),t.lineStart(),t.point(u,n),t.point(a,n),i=0):r!==u&&_>=vr&&(ws(e-r)<ii&&(e-=r*ii),ws(a-u)<ii&&(a-=u*ii),n=TA(e,n,a,h),t.point(r,n),t.lineEnd(),t.lineStart(),t.point(u,n),i=0),t.point(e=a,n=h),r=u},lineEnd:function(){t.lineEnd(),e=n=NaN},clean:function(){return 2-i}}}function TA(t,e,n,r){var i,a,h=Zi(t-n);return ws(h)>ii?dA((Zi(e)*(a=Yi(r))*Zi(n)-Zi(r)*(i=Yi(e))*Zi(t))/(i*a*h)):(e+r)/2}function LA(t,e,n,r){var i;if(t==null)i=n*Ch,r.point(-vr,i),r.point(0,i),r.point(vr,i),r.point(vr,0),r.point(vr,-i),r.point(0,-i),r.point(-vr,-i),r.point(-vr,0),r.point(-vr,i);else if(ws(t[0]-e[0])>ii){var a=t[0]<e[0]?vr:-vr;i=n*a/2,r.point(-a,i),r.point(0,i),r.point(a,i)}else r.point(e[0],e[1])}function NA(t,e){var n=Yi(t),r=n>0,i=ws(n)>ii;function a(C,P,D,B){yA(B,t,e,D,C,P)}function h(C,P){return Yi(C)*Yi(P)>n}function u(C){var P,D,B,$,Z;return{lineStart:function(){$=B=!1,Z=1},point:function(W,rt){var ct=[W,rt],pt,gt=h(W,rt),Ut=r?gt?0:w(W,rt):gt?w(W+(W<0?vr:-vr),rt):0;if(!P&&($=B=gt)&&C.lineStart(),gt!==B&&(pt=_(P,ct),(!pt||Lv(P,pt)||Lv(ct,pt))&&(ct[0]+=ii,ct[1]+=ii,gt=h(ct[0],ct[1]))),gt!==B)Z=0,gt?(C.lineStart(),pt=_(ct,P),C.point(pt[0],pt[1])):(pt=_(P,ct),C.point(pt[0],pt[1]),C.lineEnd()),P=pt;else if(i&&P&&r^gt){var zt;!(Ut&D)&&(zt=_(ct,P,!0))&&(Z=0,r?(C.lineStart(),C.point(zt[0][0],zt[0][1]),C.point(zt[1][0],zt[1][1]),C.lineEnd()):(C.point(zt[1][0],zt[1][1]),C.lineEnd(),C.lineStart(),C.point(zt[0][0],zt[0][1])))}gt&&(!P||!Lv(P,ct))&&C.point(ct[0],ct[1]),P=ct,B=gt,D=Ut},lineEnd:function(){B&&C.lineEnd(),P=null},clean:function(){return Z|($&&B)<<1}}}function _(C,P,D){var B=lm(C),$=lm(P),Z=[1,0,0],W=Gv(B,$),rt=mv(W,W),ct=W[0],pt=rt-ct*ct;if(!pt)return!D&&C;var gt=n*rt/pt,Ut=-n*ct/pt,zt=Gv(Z,W),Ot=yv(Z,gt),At=yv(W,Ut);Mx(Ot,At);var Rt=zt,Yt=mv(Ot,Rt),be=mv(Rt,Rt),Kt=Yt*Yt-be*(mv(Ot,Ot)-1);if(!(Kt<0)){var Ke=km(Kt),vt=yv(Rt,(-Yt-Ke)/be);if(Mx(vt,Ot),vt=eb(vt),!D)return vt;var Qt=C[0],Te=P[0],Ge=C[1],gn=P[1],xn;Te<Qt&&(xn=Qt,Qt=Te,Te=xn);var ei=Te-Qt,jn=ws(ei-vr)<ii,$n=jn||ei<ii;if(!jn&&gn<Ge&&(xn=Ge,Ge=gn,gn=xn),$n?jn?Ge+gn>0^vt[1]<(ws(vt[0]-Qt)<ii?Ge:gn):Ge<=vt[1]&&vt[1]<=gn:ei>vr^(Qt<=vt[0]&&vt[0]<=Te)){var Fe=yv(Rt,(-Yt+Ke)/be);return Mx(Fe,Ot),[vt,eb(Fe)]}}}function w(C,P){var D=r?t:vr-t,B=0;return C<-D?B|=1:C>D&&(B|=2),P<-D?B|=4:P>D&&(B|=8),B}return US(h,u,a,r?[0,-t]:[-vr,t-vr])}function GS(t){return function(e){var n=new ib;for(var r in t)n[r]=t[r];return n.stream=e,n}}function ib(){}ib.prototype={constructor:ib,point:function(t,e){this.stream.point(t,e)},sphere:function(){this.stream.sphere()},lineStart:function(){this.stream.lineStart()},lineEnd:function(){this.stream.lineEnd()},polygonStart:function(){this.stream.polygonStart()},polygonEnd:function(){this.stream.polygonEnd()}};function qS(t,e,n){var r=e[1][0]-e[0][0],i=e[1][1]-e[0][1],a=t.clipExtent&&t.clipExtent();t.scale(150).translate([0,0]),a!=null&&t.clipExtent(null),gA(n,t.stream(QE));var h=QE.result(),u=Math.min(r/(h[1][0]-h[0][0]),i/(h[1][1]-h[0][1])),_=+e[0][0]+(r-u*(h[1][0]+h[0][0]))/2,w=+e[0][1]+(i-u*(h[1][1]+h[0][1]))/2;return a!=null&&t.clipExtent(a),t.scale(u*150).translate([_,w])}function PA(t,e,n){return qS(t,[[0,0],e],n)}var eI=16,MA=Yi(30*Rl);function nI(t,e){return+e?DA(t,e):AA(t)}function AA(t){return GS({point:function(e,n){e=t(e,n),this.stream.point(e[0],e[1])}})}function DA(t,e){function n(r,i,a,h,u,_,w,C,P,D,B,$,Z,W){var rt=w-r,ct=C-i,pt=rt*rt+ct*ct;if(pt>4*e&&Z--){var gt=h+D,Ut=u+B,zt=_+$,Ot=km(gt*gt+Ut*Ut+zt*zt),At=Ud(zt/=Ot),Rt=ws(ws(zt)-1)<ii||ws(a-P)<ii?(a+P)/2:um(Ut,gt),Yt=t(Rt,At),be=Yt[0],Kt=Yt[1],Ke=be-r,vt=Kt-i,Qt=ct*Ke-rt*vt;(Qt*Qt/pt>e||ws((rt*Ke+ct*vt)/pt-.5)>.3||h*D+u*B+_*$<MA)&&(n(r,i,a,h,u,_,be,Kt,Rt,gt/=Ot,Ut/=Ot,zt,Z,W),W.point(be,Kt),n(be,Kt,Rt,gt,Ut,zt,w,C,P,D,B,$,Z,W))}}return function(r){var i,a,h,u,_,w,C,P,D,B,$,Z,W={point:rt,lineStart:ct,lineEnd:gt,polygonStart:function(){r.polygonStart(),W.lineStart=Ut},polygonEnd:function(){r.polygonEnd(),W.lineStart=ct}};function rt(At,Rt){At=t(At,Rt),r.point(At[0],At[1])}function ct(){P=NaN,W.point=pt,r.lineStart()}function pt(At,Rt){var Yt=lm([At,Rt]),be=t(At,Rt);n(P,D,C,B,$,Z,P=be[0],D=be[1],C=At,B=Yt[0],$=Yt[1],Z=Yt[2],eI,r),r.point(P,D)}function gt(){W.point=rt,r.lineEnd()}function Ut(){ct(),W.point=zt,W.lineEnd=Ot}function zt(At,Rt){pt(i=At,Rt),a=P,h=D,u=B,_=$,w=Z,W.point=pt}function Ot(){n(P,D,C,B,$,Z,a,h,i,u,_,w,eI,r),W.lineEnd=gt,gt()}return W}}var OA=GS({point:function(t,e){this.stream.point(t*Rl,e*Rl)}});function RA(t){return FA(function(){return t})()}function FA(t){var e,n=150,r=480,i=250,a,h,u=0,_=0,w=0,C=0,P=0,D,B,$=null,Z=tI,W=null,rt,ct,pt,gt=KE,Ut=.5,zt=nI(be,Ut),Ot,At;function Rt(vt){return vt=B(vt[0]*Rl,vt[1]*Rl),[vt[0]*n+a,h-vt[1]*n]}function Yt(vt){return vt=B.invert((vt[0]-a)/n,(h-vt[1])/n),vt&&[vt[0]*Lf,vt[1]*Lf]}function be(vt,Qt){return vt=e(vt,Qt),[vt[0]*n+a,h-vt[1]*n]}Rt.stream=function(vt){return Ot&&At===vt?Ot:Ot=OA(Z(D,zt(gt(At=vt))))},Rt.clipAngle=function(vt){return arguments.length?(Z=+vt?NA($=vt*Rl,6*Rl):($=null,tI),Ke()):$*Lf},Rt.clipExtent=function(vt){return arguments.length?(gt=vt==null?(W=rt=ct=pt=null,KE):bA(W=+vt[0][0],rt=+vt[0][1],ct=+vt[1][0],pt=+vt[1][1]),Ke()):W==null?null:[[W,rt],[ct,pt]]},Rt.scale=function(vt){return arguments.length?(n=+vt,Kt()):n},Rt.translate=function(vt){return arguments.length?(r=+vt[0],i=+vt[1],Kt()):[r,i]},Rt.center=function(vt){return arguments.length?(u=vt[0]%360*Rl,_=vt[1]%360*Rl,Kt()):[u*Lf,_*Lf]},Rt.rotate=function(vt){return arguments.length?(w=vt[0]%360*Rl,C=vt[1]%360*Rl,P=vt.length>2?vt[2]%360*Rl:0,Kt()):[w*Lf,C*Lf,P*Lf]},Rt.precision=function(vt){return arguments.length?(zt=nI(be,Ut=vt*vt),Ke()):km(Ut)},Rt.fitExtent=function(vt,Qt){return qS(Rt,vt,Qt)},Rt.fitSize=function(vt,Qt){return PA(Rt,vt,Qt)};function Kt(){B=kS(D=mA(w,C,P),e);var vt=e(u,_);return a=r-vt[0]*n,h=i+vt[1]*n,Ke()}function Ke(){return Ot=At=null,Rt}return function(){return e=t.apply(this,arguments),Rt.invert=e.invert&&Yt,Kt()}}function jS(t){return function(e,n){var r=Yi(e),i=Yi(n),a=t(r*i);return[a*i*Zi(e),a*Zi(n)]}}function XS(t){return function(e,n){var r=km(e*e+n*n),i=t(r),a=Zi(i),h=Yi(i);return[um(e*a,r*h),Ud(r&&n*a/r)]}}var kA=jS(function(t){return km(2/(1+t))});kA.invert=XS(function(t){return 2*Ud(t/2)});var YS=jS(function(t){return(t=FS(t))&&t/Zi(t)});YS.invert=XS(function(t){return t});function zA(){return RA(YS).scale(79.4188).clipAngle(180-.001)}function rI(t,e){return[t,e]}rI.invert=rI;function BA(t,e,n){n=n||{};var r=n.units||"kilometers",i=n.steps||8;if(!t)throw new Error("geojson is required");if(typeof n!="object")throw new Error("options must be an object");if(typeof i!="number")throw new Error("steps must be an number");if(e===void 0)throw new Error("radius is required");if(i<=0)throw new Error("steps must be greater than 0");var a=[];switch(t.type){case"GeometryCollection":return uS(t,function(h){var u=Nv(h,e,r,i);u&&a.push(u)}),Jx(a);case"FeatureCollection":return kE(t,function(h){var u=Nv(h,e,r,i);u&&kE(u,function(_){_&&a.push(_)})}),Jx(a)}return Nv(t,e,r,i)}function Nv(t,e,n,r){var i=t.properties||{},a=t.type==="Feature"?t.geometry:t;if(a.type==="GeometryCollection"){var h=[];return uS(t,function(Z){var W=Nv(Z,e,n,r);W&&h.push(W)}),Jx(h)}var u=$A(a),_={type:a.type,coordinates:HS(a.coordinates,u)},w=new Lb,C=w.read(_),P=YM(ZM(e,n),"meters"),D=Ao.bufferOp(C,P,r),B=new _S;if(D=B.write(D),!ZS(D.coordinates)){var $={type:D.type,coordinates:WS(D.coordinates,u)};return a0($,i)}}function ZS(t){return Array.isArray(t[0])?ZS(t[0]):isNaN(t[0])}function HS(t,e){return typeof t[0]!="object"?e(t):t.map(function(n){return HS(n,e)})}function WS(t,e){return typeof t[0]!="object"?e.invert(t):t.map(function(n){return WS(n,e)})}function $A(t){var e=WM(t).geometry.coordinates,n=[-e[0],-e[1]];return zA().rotate(n).scale(Ba)}function VA(t,e){var n=Rv(t),r=Rv(e),i=t.properties||{},a=rS.difference(n.coordinates,r.coordinates);return a.length===0?null:a.length===1?oS(a[0],i):sS(a,i)}function iI(t){let e;for(const n of t)e&&n[0]-e[0]>=180?n[0]-=360:e&&n[0]-e[0]<-180&&(n[0]+=360),e=n}function oI(t,e){const n=VA({type:"Polygon",coordinates:[[[180,90],[-180,90],[-180,-90],[180,-90],[180,90]]]},t);if(!n)return;n.properties={isMask:"y"};const r=BA(t,0);if(r.geometry.type==="Polygon")for(const i of r.geometry.coordinates)iI(i);else for(const i of r.geometry.coordinates)for(const a of i)iI(a);e({type:"FeatureCollection",features:[r,n]})}let sI={type:"FeatureCollection",features:[]};function UA(t,e,n=!0,r=!0,i={},a={},h={fill:{paint:{"fill-color":"#000","fill-opacity":.1},filter:["all",["==",["geometry-type"],"Polygon"],["has","isMask"]]},line:{layout:{"line-cap":"square"},paint:{"line-width":["case",["==",["geometry-type"],"Polygon"],2,3],"line-dasharray":[1,1],"line-color":"#3170fe"},filter:["!",["has","isMask"]]}}){let u,_=[],w,C;function P(){(h!=null&&h.fill||h!=null&&h.line)&&t.addSource("full-geom",{type:"geojson",data:sI}),h!=null&&h.fill&&t.addLayer({...h==null?void 0:h.fill,id:"full-geom-fill",type:"fill",source:"full-geom"}),h!=null&&h.line&&t.addLayer({...h==null?void 0:h.line,id:"full-geom-line",type:"line",source:"full-geom"})}t.loaded()?P():t.once("load",()=>{P()});const D=$=>{u==null||u({type:"mapClick",coordinates:[$.lngLat.lng,$.lngLat.lat]})};function B($=!1){if(!e)throw new Error;const Z=document.createElement("div");return $&&Z.classList.add("marker-interactive"),new QP({props:{displayIn:"maplibre"},target:Z}),new e.Marker({element:Z,offset:[1,-13]})}return{setEventHandler($){$?(u=$,t.on("click",D)):(u=void 0,t.off("click",D))},flyTo($,Z){t.flyTo({center:$,zoom:Z,...i})},fitBounds($,Z,W){t.fitBounds([[$[0],$[1]],[$[2],$[3]]],{padding:Z,maxZoom:W,...a})},indicateReverse($){t.getCanvasContainer().style.cursor=$?"crosshair":""},setReverseMarker($){!e||!n||(C?$?C.setLngLat($):(C.remove(),C=void 0):$&&(C=(typeof n=="object"?new e.Marker(n):B()).setLngLat($).addTo(t),C.getElement().classList.add("marker-reverse")))},setMarkers($,Z){if(!n)return;function W(rt){var ct;(ct=t.getSource("full-geom"))==null||ct.setData(rt)}for(const rt of _)rt.remove();if(_.length=0,W(sI),!!e){if(Z){let rt=!1;if(Z.geometry.type==="GeometryCollection"){const ct=Z.geometry.geometries.filter(pt=>pt.type==="Polygon"||pt.type==="MultiPolygon");if(ct.length>0){let pt=ct.pop();for(const gt of ct)pt=HM(pt,gt);oI({...Z,geometry:pt},W),rt=!0}else{const pt=Z.geometry.geometries.filter(gt=>gt.type==="LineString"||gt.type==="MultiLineString");pt.length>0&&(W({...Z,geometry:{type:"GeometryCollection",geometries:pt}}),rt=!0)}}if(!rt){if(Z.geometry.type==="Polygon"||Z.geometry.type==="MultiPolygon")oI(Z,W);else if(Z.geometry.type==="LineString"||Z.geometry.type==="MultiLineString"){W(Z);return}}n&&_.push((typeof n=="object"?new e.Marker(n):B()).setLngLat(Z.center).addTo(t))}if(r)for(const rt of $??[]){if(rt===Z)continue;const ct=(typeof r=="object"?new e.Marker(r):B(!0)).setLngLat(rt.center).setPopup(new e.Popup({offset:[1,-27],closeButton:!1,closeOnMove:!0,className:"maptiler-gc-popup"}).setText(rt.place_type[0]==="reverse"?rt.place_name:rt.place_name.replace(/,.*/,""))).addTo(t),pt=ct.getElement();pt.addEventListener("click",gt=>{gt.stopPropagation(),u==null||u({type:"markerClick",id:rt.id})}),pt.addEventListener("mouseenter",()=>{u==null||u({type:"markerMouseEnter",id:rt.id}),ct.togglePopup()}),pt.addEventListener("mouseleave",()=>{u==null||u({type:"markerMouseLeave",id:rt.id}),ct.togglePopup()}),_.push(ct)}}},setSelectedMarker($){w&&w.getElement().classList.toggle("marker-selected",!1),w=$>-1?_[$]:void 0,w==null||w.getElement().classList.toggle("marker-selected",!0)},getCenterAndZoom(){const $=t.getCenter();return[t.getZoom(),$.lng,$.lat]}}}var Al,$g;class GA extends EventTarget{constructor(e={}){super(),aE(this,Al,void 0),aE(this,$g,void 0),Tx(this,$g,e)}onAddInt(e){const n=document.createElement("div");n.className="mapboxgl-ctrl-geocoder mapboxgl-ctrl maplibregl-ctrl-geocoder maplibregl-ctrl mapboxgl-ctrl-group";const{marker:r,showResultMarkers:i,flyTo:a,fullGeometryStyle:h,...u}=Lc(this,$g),_=typeof a=="boolean"?{}:a,w=this.getExtraProps(e,n),C={mapController:UA(e,this.getMapLibreGl(),r,i,_,_,h),flyTo:a===void 0?!0:!!a,apiKey:"",...w,...u};if(!C.apiKey)throw new Error("no apiKey provided");Tx(this,Al,new EM({target:n,props:C}));for(const P of["select","pick","featuresListed","featuresMarked","response","optionsVisibilityChange","reverseToggle","queryChange"])Lc(this,Al).$on(P,D=>this.dispatchEvent(D));return n}setOptions(e){var n;Tx(this,$g,e);const{marker:r,showResultMarkers:i,flyTo:a,fullGeometryStyle:h,...u}=Lc(this,$g);(n=Lc(this,Al))==null||n.$set(u)}setQuery(e,n=!0){var r;(r=Lc(this,Al))==null||r.setQuery(e,n)}clearMap(){var e;(e=Lc(this,Al))==null||e.clearMap()}clearList(){var e;(e=Lc(this,Al))==null||e.clearList()}setReverseMode(e){var n;(n=Lc(this,Al))==null||n.$set({reverseActive:e})}focus(){var e;(e=Lc(this,Al))==null||e.focus()}blur(){var e;(e=Lc(this,Al))==null||e.blur()}onRemove(){var e;(e=Lc(this,Al))==null||e.$destroy()}}Al=new WeakMap,$g=new WeakMap;class qA extends GA{getMapLibreGl(){return fP}onAdd(e){return super.onAddInt(e)}getExtraProps(e,n){return{}}}rn.forwardRef(({position:t,...e},n)=>{const r=ig(()=>{const i=new qA({...e,maplibregl:XI});return i.addEventListener("pick",e.onSelection),i},{position:t});return rn.useImperativeHandle(n,()=>r,[r]),null});var jA={color:void 0,size:void 0,className:void 0,style:void 0,attr:void 0};Bx.createContext;var JS="1.13.6",aI=typeof self=="object"&&self.self===self&&self||typeof global=="object"&&global.global===global&&global||Function("return this")()||{},x0=Array.prototype,kb=Object.prototype,uI=typeof Symbol<"u"?Symbol.prototype:null,XA=x0.push,C_=x0.slice,t_=kb.toString,YA=kb.hasOwnProperty,KS=typeof ArrayBuffer<"u",ZA=typeof DataView<"u",HA=Array.isArray,lI=Object.keys,cI=Object.create,hI=KS&&ArrayBuffer.isView,WA=isNaN,JA=isFinite,QS=!{toString:null}.propertyIsEnumerable("toString"),pI=["valueOf","isPrototypeOf","toString","propertyIsEnumerable","hasOwnProperty","toLocaleString"],KA=Math.pow(2,53)-1;function wu(t,e){return e=e==null?t.length-1:+e,function(){for(var n=Math.max(arguments.length-e,0),r=Array(n),i=0;i<n;i++)r[i]=arguments[i+e];switch(e){case 0:return t.call(this,r);case 1:return t.call(this,arguments[0],r);case 2:return t.call(this,arguments[0],arguments[1],r)}var a=Array(e+1);for(i=0;i<e;i++)a[i]=arguments[i];return a[e]=r,t.apply(this,a)}}function cg(t){var e=typeof t;return e==="function"||e==="object"&&!!t}function QA(t){return t===null}function tC(t){return t===void 0}function eC(t){return t===!0||t===!1||t_.call(t)==="[object Boolean]"}function tD(t){return!!(t&&t.nodeType===1)}function Ca(t){var e="[object "+t+"]";return function(n){return t_.call(n)===e}}const zb=Ca("String"),nC=Ca("Number"),eD=Ca("Date"),nD=Ca("RegExp"),rD=Ca("Error"),rC=Ca("Symbol"),iC=Ca("ArrayBuffer");var oC=Ca("Function"),iD=aI.document&&aI.document.childNodes;typeof/./!="function"&&typeof Int8Array!="object"&&typeof iD!="function"&&(oC=function(t){return typeof t=="function"||!1});const Ka=oC,sC=Ca("Object");var aC=ZA&&sC(new DataView(new ArrayBuffer(8))),Bb=typeof Map<"u"&&sC(new Map),oD=Ca("DataView");function sD(t){return t!=null&&Ka(t.getInt8)&&iC(t.buffer)}const Xv=aC?sD:oD,hg=HA||Ca("Array");function ld(t,e){return t!=null&&YA.call(t,e)}var ob=Ca("Arguments");(function(){ob(arguments)||(ob=function(t){return ld(t,"callee")})})();const $b=ob;function aD(t){return!rC(t)&&JA(t)&&!isNaN(parseFloat(t))}function uC(t){return nC(t)&&WA(t)}function lC(t){return function(){return t}}function cC(t){return function(e){var n=t(e);return typeof n=="number"&&n>=0&&n<=KA}}function hC(t){return function(e){return e==null?void 0:e[t]}}const Yv=hC("byteLength"),uD=cC(Yv);var lD=/\[object ((I|Ui)nt(8|16|32)|Float(32|64)|Uint8Clamped|Big(I|Ui)nt64)Array\]/;function cD(t){return hI?hI(t)&&!Xv(t):uD(t)&&lD.test(t_.call(t))}const pC=KS?cD:lC(!1),Eu=hC("length");function hD(t){for(var e={},n=t.length,r=0;r<n;++r)e[t[r]]=!0;return{contains:function(i){return e[i]===!0},push:function(i){return e[i]=!0,t.push(i)}}}function fC(t,e){e=hD(e);var n=pI.length,r=t.constructor,i=Ka(r)&&r.prototype||kb,a="constructor";for(ld(t,a)&&!e.contains(a)&&e.push(a);n--;)a=pI[n],a in t&&t[a]!==i[a]&&!e.contains(a)&&e.push(a)}function As(t){if(!cg(t))return[];if(lI)return lI(t);var e=[];for(var n in t)ld(t,n)&&e.push(n);return QS&&fC(t,e),e}function pD(t){if(t==null)return!0;var e=Eu(t);return typeof e=="number"&&(hg(t)||zb(t)||$b(t))?e===0:Eu(As(t))===0}function dC(t,e){var n=As(e),r=n.length;if(t==null)return!r;for(var i=Object(t),a=0;a<r;a++){var h=n[a];if(e[h]!==i[h]||!(h in i))return!1}return!0}function Mr(t){if(t instanceof Mr)return t;if(!(this instanceof Mr))return new Mr(t);this._wrapped=t}Mr.VERSION=JS;Mr.prototype.value=function(){return this._wrapped};Mr.prototype.valueOf=Mr.prototype.toJSON=Mr.prototype.value;Mr.prototype.toString=function(){return String(this._wrapped)};function fI(t){return new Uint8Array(t.buffer||t,t.byteOffset||0,Yv(t))}var dI="[object DataView]";function sb(t,e,n,r){if(t===e)return t!==0||1/t===1/e;if(t==null||e==null)return!1;if(t!==t)return e!==e;var i=typeof t;return i!=="function"&&i!=="object"&&typeof e!="object"?!1:gC(t,e,n,r)}function gC(t,e,n,r){t instanceof Mr&&(t=t._wrapped),e instanceof Mr&&(e=e._wrapped);var i=t_.call(t);if(i!==t_.call(e))return!1;if(aC&&i=="[object Object]"&&Xv(t)){if(!Xv(e))return!1;i=dI}switch(i){case"[object RegExp]":case"[object String]":return""+t==""+e;case"[object Number]":return+t!=+t?+e!=+e:+t==0?1/+t===1/e:+t==+e;case"[object Date]":case"[object Boolean]":return+t==+e;case"[object Symbol]":return uI.valueOf.call(t)===uI.valueOf.call(e);case"[object ArrayBuffer]":case dI:return gC(fI(t),fI(e),n,r)}var a=i==="[object Array]";if(!a&&pC(t)){var h=Yv(t);if(h!==Yv(e))return!1;if(t.buffer===e.buffer&&t.byteOffset===e.byteOffset)return!0;a=!0}if(!a){if(typeof t!="object"||typeof e!="object")return!1;var u=t.constructor,_=e.constructor;if(u!==_&&!(Ka(u)&&u instanceof u&&Ka(_)&&_ instanceof _)&&"constructor"in t&&"constructor"in e)return!1}n=n||[],r=r||[];for(var w=n.length;w--;)if(n[w]===t)return r[w]===e;if(n.push(t),r.push(e),a){if(w=t.length,w!==e.length)return!1;for(;w--;)if(!sb(t[w],e[w],n,r))return!1}else{var C=As(t),P;if(w=C.length,As(e).length!==w)return!1;for(;w--;)if(P=C[w],!(ld(e,P)&&sb(t[P],e[P],n,r)))return!1}return n.pop(),r.pop(),!0}function fD(t,e){return sb(t,e)}function T_(t){if(!cg(t))return[];var e=[];for(var n in t)e.push(n);return QS&&fC(t,e),e}function Vb(t){var e=Eu(t);return function(n){if(n==null)return!1;var r=T_(n);if(Eu(r))return!1;for(var i=0;i<e;i++)if(!Ka(n[t[i]]))return!1;return t!==_C||!Ka(n[Ub])}}var Ub="forEach",mC="has",Gb=["clear","delete"],yC=["get",mC,"set"],dD=Gb.concat(Ub,yC),_C=Gb.concat(yC),gD=["add"].concat(Gb,Ub,mC);const mD=Bb?Vb(dD):Ca("Map"),yD=Bb?Vb(_C):Ca("WeakMap"),_D=Bb?Vb(gD):Ca("Set"),vD=Ca("WeakSet");function zm(t){for(var e=As(t),n=e.length,r=Array(n),i=0;i<n;i++)r[i]=t[e[i]];return r}function xD(t){for(var e=As(t),n=e.length,r=Array(n),i=0;i<n;i++)r[i]=[e[i],t[e[i]]];return r}function vC(t){for(var e={},n=As(t),r=0,i=n.length;r<i;r++)e[t[n[r]]]=n[r];return e}function ab(t){var e=[];for(var n in t)Ka(t[n])&&e.push(n);return e.sort()}function qb(t,e){return function(n){var r=arguments.length;if(e&&(n=Object(n)),r<2||n==null)return n;for(var i=1;i<r;i++)for(var a=arguments[i],h=t(a),u=h.length,_=0;_<u;_++){var w=h[_];(!e||n[w]===void 0)&&(n[w]=a[w])}return n}}const xC=qb(T_),Zv=qb(As),bC=qb(T_,!0);function bD(){return function(){}}function wC(t){if(!cg(t))return{};if(cI)return cI(t);var e=bD();e.prototype=t;var n=new e;return e.prototype=null,n}function wD(t,e){var n=wC(t);return e&&Zv(n,e),n}function ED(t){return cg(t)?hg(t)?t.slice():xC({},t):t}function ID(t,e){return e(t),t}function EC(t){return hg(t)?t:[t]}Mr.toPath=EC;function L_(t){return Mr.toPath(t)}function jb(t,e){for(var n=e.length,r=0;r<n;r++){if(t==null)return;t=t[e[r]]}return n?t:void 0}function IC(t,e,n){var r=jb(t,L_(e));return tC(r)?n:r}function SD(t,e){e=L_(e);for(var n=e.length,r=0;r<n;r++){var i=e[r];if(!ld(t,i))return!1;t=t[i]}return!!n}function Xb(t){return t}function e_(t){return t=Zv({},t),function(e){return dC(e,t)}}function Yb(t){return t=L_(t),function(e){return jb(e,t)}}function N_(t,e,n){if(e===void 0)return t;switch(n??3){case 1:return function(r){return t.call(e,r)};case 3:return function(r,i,a){return t.call(e,r,i,a)};case 4:return function(r,i,a,h){return t.call(e,r,i,a,h)}}return function(){return t.apply(e,arguments)}}function SC(t,e,n){return t==null?Xb:Ka(t)?N_(t,e,n):cg(t)&&!hg(t)?e_(t):Yb(t)}function Zb(t,e){return SC(t,e,1/0)}Mr.iteratee=Zb;function Nu(t,e,n){return Mr.iteratee!==Zb?Mr.iteratee(t,e):SC(t,e,n)}function CD(t,e,n){e=Nu(e,n);for(var r=As(t),i=r.length,a={},h=0;h<i;h++){var u=r[h];a[u]=e(t[u],u,t)}return a}function CC(){}function TD(t){return t==null?CC:function(e){return IC(t,e)}}function LD(t,e,n){var r=Array(Math.max(0,t));e=N_(e,n,1);for(var i=0;i<t;i++)r[i]=e(i);return r}function ub(t,e){return e==null&&(e=t,t=0),t+Math.floor(Math.random()*(e-t+1))}const n_=Date.now||function(){return new Date().getTime()};function TC(t){var e=function(a){return t[a]},n="(?:"+As(t).join("|")+")",r=RegExp(n),i=RegExp(n,"g");return function(a){return a=a==null?"":""+a,r.test(a)?a.replace(i,e):a}}const LC={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;","`":"&#x60;"},ND=TC(LC),PD=vC(LC),MD=TC(PD),AD=Mr.templateSettings={evaluate:/<%([\s\S]+?)%>/g,interpolate:/<%=([\s\S]+?)%>/g,escape:/<%-([\s\S]+?)%>/g};var Dx=/(.)^/,DD={"'":"'","\\":"\\","\r":"r","\n":"n","\u2028":"u2028","\u2029":"u2029"},OD=/\\|'|\r|\n|\u2028|\u2029/g;function RD(t){return"\\"+DD[t]}var FD=/^\s*(\w|\$)+\s*$/;function kD(t,e,n){!e&&n&&(e=n),e=bC({},e,Mr.templateSettings);var r=RegExp([(e.escape||Dx).source,(e.interpolate||Dx).source,(e.evaluate||Dx).source].join("|")+"|$","g"),i=0,a="__p+='";t.replace(r,function(w,C,P,D,B){return a+=t.slice(i,B).replace(OD,RD),i=B+w.length,C?a+=`'+
((__t=(`+C+`))==null?'':_.escape(__t))+
'`:P?a+=`'+
((__t=(`+P+`))==null?'':__t)+
'`:D&&(a+=`';
`+D+`
__p+='`),w}),a+=`';
`;var h=e.variable;if(h){if(!FD.test(h))throw new Error("variable is not a bare identifier: "+h)}else a=`with(obj||{}){
`+a+`}
`,h="obj";a=`var __t,__p='',__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,'');};
`+a+`return __p;
`;var u;try{u=new Function(h,"_",a)}catch(w){throw w.source=a,w}var _=function(w){return u.call(this,w,Mr)};return _.source="function("+h+`){
`+a+"}",_}function zD(t,e,n){e=L_(e);var r=e.length;if(!r)return Ka(n)?n.call(t):n;for(var i=0;i<r;i++){var a=t==null?void 0:t[e[i]];a===void 0&&(a=n,i=r),t=Ka(a)?a.call(t):a}return t}var BD=0;function $D(t){var e=++BD+"";return t?t+e:e}function VD(t){var e=Mr(t);return e._chain=!0,e}function NC(t,e,n,r,i){if(!(r instanceof e))return t.apply(n,i);var a=wC(t.prototype),h=t.apply(a,i);return cg(h)?h:a}var Bm=wu(function(t,e){var n=Bm.placeholder,r=function(){for(var i=0,a=e.length,h=Array(a),u=0;u<a;u++)h[u]=e[u]===n?arguments[i++]:e[u];for(;i<arguments.length;)h.push(arguments[i++]);return NC(t,r,this,this,h)};return r});Bm.placeholder=Mr;const PC=wu(function(t,e,n){if(!Ka(t))throw new TypeError("Bind must be called on a function");var r=wu(function(i){return NC(t,r,e,this,n.concat(i))});return r}),cl=cC(Eu);function pg(t,e,n,r){if(r=r||[],!e&&e!==0)e=1/0;else if(e<=0)return r.concat(t);for(var i=r.length,a=0,h=Eu(t);a<h;a++){var u=t[a];if(cl(u)&&(hg(u)||$b(u)))if(e>1)pg(u,e-1,n,r),i=r.length;else for(var _=0,w=u.length;_<w;)r[i++]=u[_++];else n||(r[i++]=u)}return r}const UD=wu(function(t,e){e=pg(e,!1,!1);var n=e.length;if(n<1)throw new Error("bindAll must be passed function names");for(;n--;){var r=e[n];t[r]=PC(t[r],t)}return t});function GD(t,e){var n=function(r){var i=n.cache,a=""+(e?e.apply(this,arguments):r);return ld(i,a)||(i[a]=t.apply(this,arguments)),i[a]};return n.cache={},n}const MC=wu(function(t,e,n){return setTimeout(function(){return t.apply(null,n)},e)}),qD=Bm(MC,Mr,1);function jD(t,e,n){var r,i,a,h,u=0;n||(n={});var _=function(){u=n.leading===!1?0:n_(),r=null,h=t.apply(i,a),r||(i=a=null)},w=function(){var C=n_();!u&&n.leading===!1&&(u=C);var P=e-(C-u);return i=this,a=arguments,P<=0||P>e?(r&&(clearTimeout(r),r=null),u=C,h=t.apply(i,a),r||(i=a=null)):!r&&n.trailing!==!1&&(r=setTimeout(_,P)),h};return w.cancel=function(){clearTimeout(r),u=0,r=i=a=null},w}function XD(t,e,n){var r,i,a,h,u,_=function(){var C=n_()-i;e>C?r=setTimeout(_,e-C):(r=null,n||(h=t.apply(u,a)),r||(a=u=null))},w=wu(function(C){return u=this,a=C,i=n_(),r||(r=setTimeout(_,e),n&&(h=t.apply(u,a))),h});return w.cancel=function(){clearTimeout(r),r=a=u=null},w}function YD(t,e){return Bm(e,t)}function Hb(t){return function(){return!t.apply(this,arguments)}}function ZD(){var t=arguments,e=t.length-1;return function(){for(var n=e,r=t[e].apply(this,arguments);n--;)r=t[n].call(this,r);return r}}function HD(t,e){return function(){if(--t<1)return e.apply(this,arguments)}}function AC(t,e){var n;return function(){return--t>0&&(n=e.apply(this,arguments)),t<=1&&(e=null),n}}const WD=Bm(AC,2);function DC(t,e,n){e=Nu(e,n);for(var r=As(t),i,a=0,h=r.length;a<h;a++)if(i=r[a],e(t[i],i,t))return i}function OC(t){return function(e,n,r){n=Nu(n,r);for(var i=Eu(e),a=t>0?0:i-1;a>=0&&a<i;a+=t)if(n(e[a],a,e))return a;return-1}}const Wb=OC(1),RC=OC(-1);function FC(t,e,n,r){n=Nu(n,r,1);for(var i=n(e),a=0,h=Eu(t);a<h;){var u=Math.floor((a+h)/2);n(t[u])<i?a=u+1:h=u}return a}function kC(t,e,n){return function(r,i,a){var h=0,u=Eu(r);if(typeof a=="number")t>0?h=a>=0?a:Math.max(a+u,h):u=a>=0?Math.min(a+1,u):a+u+1;else if(n&&a&&u)return a=n(r,i),r[a]===i?a:-1;if(i!==i)return a=e(C_.call(r,h,u),uC),a>=0?a+h:-1;for(a=t>0?h:u-1;a>=0&&a<u;a+=t)if(r[a]===i)return a;return-1}}const zC=kC(1,Wb,FC),JD=kC(-1,RC);function lb(t,e,n){var r=cl(t)?Wb:DC,i=r(t,e,n);if(i!==void 0&&i!==-1)return t[i]}function KD(t,e){return lb(t,e_(e))}function Fp(t,e,n){e=N_(e,n);var r,i;if(cl(t))for(r=0,i=t.length;r<i;r++)e(t[r],r,t);else{var a=As(t);for(r=0,i=a.length;r<i;r++)e(t[a[r]],a[r],t)}return t}function Gd(t,e,n){e=Nu(e,n);for(var r=!cl(t)&&As(t),i=(r||t).length,a=Array(i),h=0;h<i;h++){var u=r?r[h]:h;a[h]=e(t[u],u,t)}return a}function BC(t){var e=function(n,r,i,a){var h=!cl(n)&&As(n),u=(h||n).length,_=t>0?0:u-1;for(a||(i=n[h?h[_]:_],_+=t);_>=0&&_<u;_+=t){var w=h?h[_]:_;i=r(i,n[w],w,n)}return i};return function(n,r,i,a){var h=arguments.length>=3;return e(n,N_(r,a,4),i,h)}}const Ox=BC(1),gI=BC(-1);function hm(t,e,n){var r=[];return e=Nu(e,n),Fp(t,function(i,a,h){e(i,a,h)&&r.push(i)}),r}function QD(t,e,n){return hm(t,Hb(Nu(e)),n)}function mI(t,e,n){e=Nu(e,n);for(var r=!cl(t)&&As(t),i=(r||t).length,a=0;a<i;a++){var h=r?r[a]:a;if(!e(t[h],h,t))return!1}return!0}function yI(t,e,n){e=Nu(e,n);for(var r=!cl(t)&&As(t),i=(r||t).length,a=0;a<i;a++){var h=r?r[a]:a;if(e(t[h],h,t))return!0}return!1}function wp(t,e,n,r){return cl(t)||(t=zm(t)),(typeof n!="number"||r)&&(n=0),zC(t,e,n)>=0}const tO=wu(function(t,e,n){var r,i;return Ka(e)?i=e:(e=L_(e),r=e.slice(0,-1),e=e[e.length-1]),Gd(t,function(a){var h=i;if(!h){if(r&&r.length&&(a=jb(a,r)),a==null)return;h=a[e]}return h==null?h:h.apply(a,n)})});function Jb(t,e){return Gd(t,Yb(e))}function eO(t,e){return hm(t,e_(e))}function $C(t,e,n){var r=-1/0,i=-1/0,a,h;if(e==null||typeof e=="number"&&typeof t[0]!="object"&&t!=null){t=cl(t)?t:zm(t);for(var u=0,_=t.length;u<_;u++)a=t[u],a!=null&&a>r&&(r=a)}else e=Nu(e,n),Fp(t,function(w,C,P){h=e(w,C,P),(h>i||h===-1/0&&r===-1/0)&&(r=w,i=h)});return r}function nO(t,e,n){var r=1/0,i=1/0,a,h;if(e==null||typeof e=="number"&&typeof t[0]!="object"&&t!=null){t=cl(t)?t:zm(t);for(var u=0,_=t.length;u<_;u++)a=t[u],a!=null&&a<r&&(r=a)}else e=Nu(e,n),Fp(t,function(w,C,P){h=e(w,C,P),(h<i||h===1/0&&r===1/0)&&(r=w,i=h)});return r}var rO=/[^\ud800-\udfff]|[\ud800-\udbff][\udc00-\udfff]|[\ud800-\udfff]/g;function VC(t){return t?hg(t)?C_.call(t):zb(t)?t.match(rO):cl(t)?Gd(t,Xb):zm(t):[]}function UC(t,e,n){if(e==null||n)return cl(t)||(t=zm(t)),t[ub(t.length-1)];var r=VC(t),i=Eu(r);e=Math.max(Math.min(e,i),0);for(var a=i-1,h=0;h<e;h++){var u=ub(h,a),_=r[h];r[h]=r[u],r[u]=_}return r.slice(0,e)}function iO(t){return UC(t,1/0)}function oO(t,e,n){var r=0;return e=Nu(e,n),Jb(Gd(t,function(i,a,h){return{value:i,index:r++,criteria:e(i,a,h)}}).sort(function(i,a){var h=i.criteria,u=a.criteria;if(h!==u){if(h>u||h===void 0)return 1;if(h<u||u===void 0)return-1}return i.index-a.index}),"value")}function b0(t,e){return function(n,r,i){var a=e?[[],[]]:{};return r=Nu(r,i),Fp(n,function(h,u){var _=r(h,u,n);t(a,h,_)}),a}}const sO=b0(function(t,e,n){ld(t,n)?t[n].push(e):t[n]=[e]}),aO=b0(function(t,e,n){t[n]=e}),uO=b0(function(t,e,n){ld(t,n)?t[n]++:t[n]=1}),lO=b0(function(t,e,n){t[n?0:1].push(e)},!0);function cO(t){return t==null?0:cl(t)?t.length:As(t).length}function hO(t,e,n){return e in n}const GC=wu(function(t,e){var n={},r=e[0];if(t==null)return n;Ka(r)?(e.length>1&&(r=N_(r,e[1])),e=T_(t)):(r=hO,e=pg(e,!1,!1),t=Object(t));for(var i=0,a=e.length;i<a;i++){var h=e[i],u=t[h];r(u,h,t)&&(n[h]=u)}return n}),pO=wu(function(t,e){var n=e[0],r;return Ka(n)?(n=Hb(n),e.length>1&&(r=e[1])):(e=Gd(pg(e,!1,!1),String),n=function(i,a){return!wp(e,a)}),GC(t,n,r)});function qC(t,e,n){return C_.call(t,0,Math.max(0,t.length-(e==null||n?1:e)))}function Rx(t,e,n){return t==null||t.length<1?e==null||n?void 0:[]:e==null||n?t[0]:qC(t,t.length-e)}function Pv(t,e,n){return C_.call(t,e==null||n?1:e)}function fO(t,e,n){return t==null||t.length<1?e==null||n?void 0:[]:e==null||n?t[t.length-1]:Pv(t,Math.max(0,t.length-e))}function dO(t){return hm(t,Boolean)}function gO(t,e){return pg(t,e,!1)}const jC=wu(function(t,e){return e=pg(e,!0,!0),hm(t,function(n){return!wp(e,n)})}),mO=wu(function(t,e){return jC(t,e)});function cb(t,e,n,r){eC(e)||(r=n,n=e,e=!1),n!=null&&(n=Nu(n,r));for(var i=[],a=[],h=0,u=Eu(t);h<u;h++){var _=t[h],w=n?n(_,h,t):_;e&&!n?((!h||a!==w)&&i.push(_),a=w):n?wp(a,w)||(a.push(w),i.push(_)):wp(i,_)||i.push(_)}return i}const yO=wu(function(t){return cb(pg(t,!0,!0))});function _O(t){for(var e=[],n=arguments.length,r=0,i=Eu(t);r<i;r++){var a=t[r];if(!wp(e,a)){var h;for(h=1;h<n&&wp(arguments[h],a);h++);h===n&&e.push(a)}}return e}function hb(t){for(var e=t&&$C(t,Eu).length||0,n=Array(e),r=0;r<e;r++)n[r]=Jb(t,r);return n}const vO=wu(hb);function xO(t,e){for(var n={},r=0,i=Eu(t);r<i;r++)e?n[t[r]]=e[r]:n[t[r][0]]=t[r][1];return n}function bO(t,e,n){e==null&&(e=t||0,t=0),n||(n=e<t?-1:1);for(var r=Math.max(Math.ceil((e-t)/n),0),i=Array(r),a=0;a<r;a++,t+=n)i[a]=t;return i}function wO(t,e){if(e==null||e<1)return[];for(var n=[],r=0,i=t.length;r<i;)n.push(C_.call(t,r,r+=e));return n}function Kb(t,e){return t._chain?Mr(e).chain():e}function XC(t){return Fp(ab(t),function(e){var n=Mr[e]=t[e];Mr.prototype[e]=function(){var r=[this._wrapped];return XA.apply(r,arguments),Kb(this,n.apply(Mr,r))}}),Mr}Fp(["pop","push","reverse","shift","sort","splice","unshift"],function(t){var e=x0[t];Mr.prototype[t]=function(){var n=this._wrapped;return n!=null&&(e.apply(n,arguments),(t==="shift"||t==="splice")&&n.length===0&&delete n[0]),Kb(this,n)}});Fp(["concat","join","slice"],function(t){var e=x0[t];Mr.prototype[t]=function(){var n=this._wrapped;return n!=null&&(n=e.apply(n,arguments)),Kb(this,n)}});const EO=Object.freeze(Object.defineProperty({__proto__:null,VERSION:JS,after:HD,all:mI,allKeys:T_,any:yI,assign:Zv,before:AC,bind:PC,bindAll:UD,chain:VD,chunk:wO,clone:ED,collect:Gd,compact:dO,compose:ZD,constant:lC,contains:wp,countBy:uO,create:wD,debounce:XD,default:Mr,defaults:bC,defer:qD,delay:MC,detect:lb,difference:jC,drop:Pv,each:Fp,escape:ND,every:mI,extend:xC,extendOwn:Zv,filter:hm,find:lb,findIndex:Wb,findKey:DC,findLastIndex:RC,findWhere:KD,first:Rx,flatten:gO,foldl:Ox,foldr:gI,forEach:Fp,functions:ab,get:IC,groupBy:sO,has:SD,head:Rx,identity:Xb,include:wp,includes:wp,indexBy:aO,indexOf:zC,initial:qC,inject:Ox,intersection:_O,invert:vC,invoke:tO,isArguments:$b,isArray:hg,isArrayBuffer:iC,isBoolean:eC,isDataView:Xv,isDate:eD,isElement:tD,isEmpty:pD,isEqual:fD,isError:rD,isFinite:aD,isFunction:Ka,isMap:mD,isMatch:dC,isNaN:uC,isNull:QA,isNumber:nC,isObject:cg,isRegExp:nD,isSet:_D,isString:zb,isSymbol:rC,isTypedArray:pC,isUndefined:tC,isWeakMap:yD,isWeakSet:vD,iteratee:Zb,keys:As,last:fO,lastIndexOf:JD,map:Gd,mapObject:CD,matcher:e_,matches:e_,max:$C,memoize:GD,methods:ab,min:nO,mixin:XC,negate:Hb,noop:CC,now:n_,object:xO,omit:pO,once:WD,pairs:xD,partial:Bm,partition:lO,pick:GC,pluck:Jb,property:Yb,propertyOf:TD,random:ub,range:bO,reduce:Ox,reduceRight:gI,reject:QD,rest:Pv,restArguments:wu,result:zD,sample:UC,select:hm,shuffle:iO,size:cO,some:yI,sortBy:oO,sortedIndex:FC,tail:Pv,take:Rx,tap:ID,template:kD,templateSettings:AD,throttle:jD,times:LD,toArray:VC,toPath:EC,transpose:hb,unescape:MD,union:yO,uniq:cb,unique:cb,uniqueId:$D,unzip:hb,values:zm,where:eO,without:mO,wrap:YD,zip:vO},Symbol.toStringTag,{value:"Module"}));var r_=XC(EO);r_._=r_;function YC(t,e,n){if(t!==null)for(var r,i,a,h,u,_,w,C=0,P=0,D,B=t.type,$=B==="FeatureCollection",Z=B==="Feature",W=$?t.features.length:1,rt=0;rt<W;rt++){w=$?t.features[rt].geometry:Z?t.geometry:t,D=w?w.type==="GeometryCollection":!1,u=D?w.geometries.length:1;for(var ct=0;ct<u;ct++){var pt=0,gt=0;if(h=D?w.geometries[ct]:w,h!==null){_=h.coordinates;var Ut=h.type;switch(C=n&&(Ut==="Polygon"||Ut==="MultiPolygon")?1:0,Ut){case null:break;case"Point":if(e(_,P,rt,pt,gt)===!1)return!1;P++,pt++;break;case"LineString":case"MultiPoint":for(r=0;r<_.length;r++){if(e(_[r],P,rt,pt,gt)===!1)return!1;P++,Ut==="MultiPoint"&&pt++}Ut==="LineString"&&pt++;break;case"Polygon":case"MultiLineString":for(r=0;r<_.length;r++){for(i=0;i<_[r].length-C;i++){if(e(_[r][i],P,rt,pt,gt)===!1)return!1;P++}Ut==="MultiLineString"&&pt++,Ut==="Polygon"&&gt++}Ut==="Polygon"&&pt++;break;case"MultiPolygon":for(r=0;r<_.length;r++){for(gt=0,i=0;i<_[r].length;i++){for(a=0;a<_[r][i].length-C;a++){if(e(_[r][i][a],P,rt,pt,gt)===!1)return!1;P++}gt++}pt++}break;case"GeometryCollection":for(r=0;r<h.geometries.length;r++)if(YC(h.geometries[r],e,n)===!1)return!1;break;default:throw new Error("Unknown Geometry Type")}}}}}function _I(t,e){if(t.type==="Feature")e(t,0);else if(t.type==="FeatureCollection")for(var n=0;n<t.features.length&&e(t.features[n],n)!==!1;n++);}function ZC(t,e){var n,r,i,a,h,u,_,w,C,P,D=0,B=t.type==="FeatureCollection",$=t.type==="Feature",Z=B?t.features.length:1;for(n=0;n<Z;n++){for(u=B?t.features[n].geometry:$?t.geometry:t,w=B?t.features[n].properties:$?t.properties:{},C=B?t.features[n].bbox:$?t.bbox:void 0,P=B?t.features[n].id:$?t.id:void 0,_=u?u.type==="GeometryCollection":!1,h=_?u.geometries.length:1,i=0;i<h;i++){if(a=_?u.geometries[i]:u,a===null){if(e(null,D,w,C,P)===!1)return!1;continue}switch(a.type){case"Point":case"LineString":case"MultiPoint":case"Polygon":case"MultiLineString":case"MultiPolygon":{if(e(a,D,w,C,P)===!1)return!1;break}case"GeometryCollection":{for(r=0;r<a.geometries.length;r++)if(e(a.geometries[r],D,w,C,P)===!1)return!1;break}default:throw new Error("Unknown Geometry Type")}}D++}}function i_(t){var e=[1/0,1/0,-1/0,-1/0];return YC(t,function(n){e[0]>n[0]&&(e[0]=n[0]),e[1]>n[1]&&(e[1]=n[1]),e[2]<n[0]&&(e[2]=n[0]),e[3]<n[1]&&(e[3]=n[1])}),e}i_.default=i_;var $a=63710088e-1,HC={centimeters:$a*100,centimetres:$a*100,degrees:$a/111325,feet:$a*3.28084,inches:$a*39.37,kilometers:$a/1e3,kilometres:$a/1e3,meters:$a,metres:$a,miles:$a/1609.344,millimeters:$a*1e3,millimetres:$a*1e3,nauticalmiles:$a/1852,radians:1,yards:$a*1.0936};function Qb(t,e,n){n===void 0&&(n={});var r={type:"Feature"};return(n.id===0||n.id)&&(r.id=n.id),n.bbox&&(r.bbox=n.bbox),r.properties=e||{},r.geometry=t,r}function IO(t,e,n){if(n===void 0&&(n={}),!t)throw new Error("coordinates is required");if(!Array.isArray(t))throw new Error("coordinates must be an Array");if(t.length<2)throw new Error("coordinates must be at least 2 numbers long");if(!vI(t[0])||!vI(t[1]))throw new Error("coordinates must contain numbers");var r={type:"Point",coordinates:t};return Qb(r,e,n)}function SO(t,e,n){n===void 0&&(n={});for(var r=0,i=t;r<i.length;r++){var a=i[r];if(a.length<4)throw new Error("Each LinearRing of a Polygon must have 4 or more Positions.");for(var h=0;h<a[a.length-1].length;h++)if(a[a.length-1][h]!==a[0][h])throw new Error("First and last Position are not equivalent.")}var u={type:"Polygon",coordinates:t};return Qb(u,e,n)}function pb(t,e){e===void 0&&(e={});var n={type:"FeatureCollection"};return e.id&&(n.id=e.id),e.bbox&&(n.bbox=e.bbox),n.features=t,n}function CO(t,e){e===void 0&&(e="kilometers");var n=HC[e];if(!n)throw new Error(e+" units is invalid");return t*n}function TO(t,e){e===void 0&&(e="kilometers");var n=HC[e];if(!n)throw new Error(e+" units is invalid");return t/n}function vI(t){return!isNaN(t)&&t!==null&&!Array.isArray(t)}function LO(t,e){e===void 0&&(e={});var n=Number(t[0]),r=Number(t[1]),i=Number(t[2]),a=Number(t[3]);if(t.length===6)throw new Error("@turf/bbox-polygon does not support BBox with 6 positions");var h=[n,r],u=[n,a],_=[i,a],w=[i,r];return SO([[h,w,_,u,h]],e.properties,{bbox:t,id:e.id})}function NO(t,e){e===void 0&&(e={});var n=i_(t),r=(n[0]+n[2])/2,i=(n[1]+n[3])/2;return IO([r,i],e.properties,e)}"fill"in Array.prototype||Object.defineProperty(Array.prototype,"fill",{configurable:!0,value:function(t){if(this===void 0||this===null)throw new TypeError(this+" is not an object");var e=Object(this),n=Math.max(Math.min(e.length,9007199254740991),0)||0,r=1 in arguments&&parseInt(Number(arguments[1]),10)||0;r=r<0?Math.max(n+r,0):Math.min(r,n);var i=2 in arguments&&arguments[2]!==void 0?parseInt(Number(arguments[2]),10)||0:n;for(i=i<0?Math.max(n+arguments[2],0):Math.min(i,n);r<i;)e[r]=t,++r;return e},writable:!0});Number.isFinite=Number.isFinite||function(t){return typeof t=="number"&&isFinite(t)};Number.isInteger=Number.isInteger||function(t){return typeof t=="number"&&isFinite(t)&&Math.floor(t)===t};Number.parseFloat=Number.parseFloat||parseFloat;Number.isNaN=Number.isNaN||function(t){return t!==t};Math.trunc=Math.trunc||function(t){return t<0?Math.ceil(t):Math.floor(t)};var qd=function(){};qd.prototype.interfaces_=function(){return[]};qd.prototype.getClass=function(){return qd};qd.prototype.equalsWithTolerance=function(t,e,n){return Math.abs(t-e)<=n};var Yr=function(t){function e(n){t.call(this,n),this.name="IllegalArgumentException",this.message=n,this.stack=new t().stack}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e}(Error),ln=function(){},WC={MAX_VALUE:{configurable:!0}};ln.isNaN=function(t){return Number.isNaN(t)};ln.doubleToLongBits=function(t){return t};ln.longBitsToDouble=function(t){return t};ln.isInfinite=function(t){return!Number.isFinite(t)};WC.MAX_VALUE.get=function(){return Number.MAX_VALUE};Object.defineProperties(ln,WC);var Pu=function(){},w0=function(){},pm=function(){};function Mu(){}var Lt=function t(){if(this.x=null,this.y=null,this.z=null,arguments.length===0)this.x=0,this.y=0,this.z=t.NULL_ORDINATE;else if(arguments.length===1){var e=arguments[0];this.x=e.x,this.y=e.y,this.z=e.z}else arguments.length===2?(this.x=arguments[0],this.y=arguments[1],this.z=t.NULL_ORDINATE):arguments.length===3&&(this.x=arguments[0],this.y=arguments[1],this.z=arguments[2])},fg={DimensionalComparator:{configurable:!0},serialVersionUID:{configurable:!0},NULL_ORDINATE:{configurable:!0},X:{configurable:!0},Y:{configurable:!0},Z:{configurable:!0}};Lt.prototype.setOrdinate=function(t,e){switch(t){case Lt.X:this.x=e;break;case Lt.Y:this.y=e;break;case Lt.Z:this.z=e;break;default:throw new Yr("Invalid ordinate index: "+t)}};Lt.prototype.equals2D=function(){if(arguments.length===1){var t=arguments[0];return!(this.x!==t.x||this.y!==t.y)}else if(arguments.length===2){var e=arguments[0],n=arguments[1];return!(!qd.equalsWithTolerance(this.x,e.x,n)||!qd.equalsWithTolerance(this.y,e.y,n))}};Lt.prototype.getOrdinate=function(t){switch(t){case Lt.X:return this.x;case Lt.Y:return this.y;case Lt.Z:return this.z}throw new Yr("Invalid ordinate index: "+t)};Lt.prototype.equals3D=function(t){return this.x===t.x&&this.y===t.y&&(this.z===t.z||ln.isNaN(this.z))&&ln.isNaN(t.z)};Lt.prototype.equals=function(t){return t instanceof Lt?this.equals2D(t):!1};Lt.prototype.equalInZ=function(t,e){return qd.equalsWithTolerance(this.z,t.z,e)};Lt.prototype.compareTo=function(t){var e=t;return this.x<e.x?-1:this.x>e.x?1:this.y<e.y?-1:this.y>e.y?1:0};Lt.prototype.clone=function(){};Lt.prototype.copy=function(){return new Lt(this)};Lt.prototype.toString=function(){return"("+this.x+", "+this.y+", "+this.z+")"};Lt.prototype.distance3D=function(t){var e=this.x-t.x,n=this.y-t.y,r=this.z-t.z;return Math.sqrt(e*e+n*n+r*r)};Lt.prototype.distance=function(t){var e=this.x-t.x,n=this.y-t.y;return Math.sqrt(e*e+n*n)};Lt.prototype.hashCode=function(){var t=17;return t=37*t+Lt.hashCode(this.x),t=37*t+Lt.hashCode(this.y),t};Lt.prototype.setCoordinate=function(t){this.x=t.x,this.y=t.y,this.z=t.z};Lt.prototype.interfaces_=function(){return[Pu,w0,Mu]};Lt.prototype.getClass=function(){return Lt};Lt.hashCode=function(){if(arguments.length===1){var t=arguments[0],e=ln.doubleToLongBits(t);return Math.trunc((e^e)>>>32)}};fg.DimensionalComparator.get=function(){return vp};fg.serialVersionUID.get=function(){return 6683108902428367e3};fg.NULL_ORDINATE.get=function(){return ln.NaN};fg.X.get=function(){return 0};fg.Y.get=function(){return 1};fg.Z.get=function(){return 2};Object.defineProperties(Lt,fg);var vp=function(t){if(this._dimensionsToTest=2,arguments.length!==0&&arguments.length===1){var e=arguments[0];if(e!==2&&e!==3)throw new Yr("only 2 or 3 dimensions may be specified");this._dimensionsToTest=e}};vp.prototype.compare=function(t,e){var n=t,r=e,i=vp.compare(n.x,r.x);if(i!==0)return i;var a=vp.compare(n.y,r.y);if(a!==0)return a;if(this._dimensionsToTest<=2)return 0;var h=vp.compare(n.z,r.z);return h};vp.prototype.interfaces_=function(){return[pm]};vp.prototype.getClass=function(){return vp};vp.compare=function(t,e){return t<e?-1:t>e?1:ln.isNaN(t)?ln.isNaN(e)?0:-1:ln.isNaN(e)?1:0};var fm=function(){};fm.prototype.create=function(){};fm.prototype.interfaces_=function(){return[]};fm.prototype.getClass=function(){return fm};var Mt=function(){},P_={INTERIOR:{configurable:!0},BOUNDARY:{configurable:!0},EXTERIOR:{configurable:!0},NONE:{configurable:!0}};Mt.prototype.interfaces_=function(){return[]};Mt.prototype.getClass=function(){return Mt};Mt.toLocationSymbol=function(t){switch(t){case Mt.EXTERIOR:return"e";case Mt.BOUNDARY:return"b";case Mt.INTERIOR:return"i";case Mt.NONE:return"-"}throw new Yr("Unknown location value: "+t)};P_.INTERIOR.get=function(){return 0};P_.BOUNDARY.get=function(){return 1};P_.EXTERIOR.get=function(){return 2};P_.NONE.get=function(){return-1};Object.defineProperties(Mt,P_);var en=function(t,e){return t.interfaces_&&t.interfaces_().indexOf(e)>-1},Qa=function(){},JC={LOG_10:{configurable:!0}};Qa.prototype.interfaces_=function(){return[]};Qa.prototype.getClass=function(){return Qa};Qa.log10=function(t){var e=Math.log(t);return ln.isInfinite(e)||ln.isNaN(e)?e:e/Qa.LOG_10};Qa.min=function(t,e,n,r){var i=t;return e<i&&(i=e),n<i&&(i=n),r<i&&(i=r),i};Qa.clamp=function(){if(typeof arguments[2]=="number"&&typeof arguments[0]=="number"&&typeof arguments[1]=="number"){var t=arguments[0],e=arguments[1],n=arguments[2];return t<e?e:t>n?n:t}else if(Number.isInteger(arguments[2])&&Number.isInteger(arguments[0])&&Number.isInteger(arguments[1])){var r=arguments[0],i=arguments[1],a=arguments[2];return r<i?i:r>a?a:r}};Qa.wrap=function(t,e){return t<0?e- -t%e:t%e};Qa.max=function(){if(arguments.length===3){var t=arguments[0],e=arguments[1],n=arguments[2],r=t;return e>r&&(r=e),n>r&&(r=n),r}else if(arguments.length===4){var i=arguments[0],a=arguments[1],h=arguments[2],u=arguments[3],_=i;return a>_&&(_=a),h>_&&(_=h),u>_&&(_=u),_}};Qa.average=function(t,e){return(t+e)/2};JC.LOG_10.get=function(){return Math.log(10)};Object.defineProperties(Qa,JC);var gc=function(t){this.str=t};gc.prototype.append=function(t){this.str+=t};gc.prototype.setCharAt=function(t,e){this.str=this.str.substr(0,t)+e+this.str.substr(t+1)};gc.prototype.toString=function(t){return this.str};var nc=function(t){this.value=t};nc.prototype.intValue=function(){return this.value};nc.prototype.compareTo=function(t){return this.value<t?-1:this.value>t?1:0};nc.isNaN=function(t){return Number.isNaN(t)};var o_=function(){};o_.isWhitespace=function(t){return t<=32&&t>=0||t===127};o_.toUpperCase=function(t){return t.toUpperCase()};var $t=function t(){if(this._hi=0,this._lo=0,arguments.length===0)this.init(0);else if(arguments.length===1){if(typeof arguments[0]=="number"){var e=arguments[0];this.init(e)}else if(arguments[0]instanceof t){var n=arguments[0];this.init(n)}else if(typeof arguments[0]=="string"){var r=arguments[0];t.call(this,t.parse(r))}}else if(arguments.length===2){var i=arguments[0],a=arguments[1];this.init(i,a)}},hl={PI:{configurable:!0},TWO_PI:{configurable:!0},PI_2:{configurable:!0},E:{configurable:!0},NaN:{configurable:!0},EPS:{configurable:!0},SPLIT:{configurable:!0},MAX_PRINT_DIGITS:{configurable:!0},TEN:{configurable:!0},ONE:{configurable:!0},SCI_NOT_EXPONENT_CHAR:{configurable:!0},SCI_NOT_ZERO:{configurable:!0}};$t.prototype.le=function(t){return(this._hi<t._hi||this._hi===t._hi)&&this._lo<=t._lo};$t.prototype.extractSignificantDigits=function(t,e){var n=this.abs(),r=$t.magnitude(n._hi),i=$t.TEN.pow(r);n=n.divide(i),n.gt($t.TEN)?(n=n.divide($t.TEN),r+=1):n.lt($t.ONE)&&(n=n.multiply($t.TEN),r-=1);for(var a=r+1,h=new gc,u=$t.MAX_PRINT_DIGITS-1,_=0;_<=u;_++){t&&_===a&&h.append(".");var w=Math.trunc(n._hi);if(w<0)break;var C=!1,P=0;w>9?(C=!0,P="9"):P="0"+w,h.append(P),n=n.subtract($t.valueOf(w)).multiply($t.TEN),C&&n.selfAdd($t.TEN);var D=!0,B=$t.magnitude(n._hi);if(B<0&&Math.abs(B)>=u-_&&(D=!1),!D)break}return e[0]=r,h.toString()};$t.prototype.sqr=function(){return this.multiply(this)};$t.prototype.doubleValue=function(){return this._hi+this._lo};$t.prototype.subtract=function(){if(arguments[0]instanceof $t){var t=arguments[0];return this.add(t.negate())}else if(typeof arguments[0]=="number"){var e=arguments[0];return this.add(-e)}};$t.prototype.equals=function(){if(arguments.length===1){var t=arguments[0];return this._hi===t._hi&&this._lo===t._lo}};$t.prototype.isZero=function(){return this._hi===0&&this._lo===0};$t.prototype.selfSubtract=function(){if(arguments[0]instanceof $t){var t=arguments[0];return this.isNaN()?this:this.selfAdd(-t._hi,-t._lo)}else if(typeof arguments[0]=="number"){var e=arguments[0];return this.isNaN()?this:this.selfAdd(-e,0)}};$t.prototype.getSpecialNumberString=function(){return this.isZero()?"0.0":this.isNaN()?"NaN ":null};$t.prototype.min=function(t){return this.le(t)?this:t};$t.prototype.selfDivide=function(){if(arguments.length===1){if(arguments[0]instanceof $t){var t=arguments[0];return this.selfDivide(t._hi,t._lo)}else if(typeof arguments[0]=="number"){var e=arguments[0];return this.selfDivide(e,0)}}else if(arguments.length===2){var n=arguments[0],r=arguments[1],i=null,a=null,h=null,u=null,_=null,w=null,C=null,P=null;return _=this._hi/n,w=$t.SPLIT*_,i=w-_,P=$t.SPLIT*n,i=w-i,a=_-i,h=P-n,C=_*n,h=P-h,u=n-h,P=i*h-C+i*u+a*h+a*u,w=(this._hi-C-P+this._lo-_*r)/n,P=_+w,this._hi=P,this._lo=_-P+w,this}};$t.prototype.dump=function(){return"DD<"+this._hi+", "+this._lo+">"};$t.prototype.divide=function(){if(arguments[0]instanceof $t){var t=arguments[0],e=null,n=null,r=null,i=null,a=null,h=null,u=null,_=null;a=this._hi/t._hi,h=$t.SPLIT*a,e=h-a,_=$t.SPLIT*t._hi,e=h-e,n=a-e,r=_-t._hi,u=a*t._hi,r=_-r,i=t._hi-r,_=e*r-u+e*i+n*r+n*i,h=(this._hi-u-_+this._lo-a*t._lo)/t._hi,_=a+h;var w=_,C=a-_+h;return new $t(w,C)}else if(typeof arguments[0]=="number"){var P=arguments[0];return ln.isNaN(P)?$t.createNaN():$t.copy(this).selfDivide(P,0)}};$t.prototype.ge=function(t){return(this._hi>t._hi||this._hi===t._hi)&&this._lo>=t._lo};$t.prototype.pow=function(t){if(t===0)return $t.valueOf(1);var e=new $t(this),n=$t.valueOf(1),r=Math.abs(t);if(r>1)for(;r>0;)r%2===1&&n.selfMultiply(e),r/=2,r>0&&(e=e.sqr());else n=e;return t<0?n.reciprocal():n};$t.prototype.ceil=function(){if(this.isNaN())return $t.NaN;var t=Math.ceil(this._hi),e=0;return t===this._hi&&(e=Math.ceil(this._lo)),new $t(t,e)};$t.prototype.compareTo=function(t){var e=t;return this._hi<e._hi?-1:this._hi>e._hi?1:this._lo<e._lo?-1:this._lo>e._lo?1:0};$t.prototype.rint=function(){if(this.isNaN())return this;var t=this.add(.5);return t.floor()};$t.prototype.setValue=function(){if(arguments[0]instanceof $t){var t=arguments[0];return this.init(t),this}else if(typeof arguments[0]=="number"){var e=arguments[0];return this.init(e),this}};$t.prototype.max=function(t){return this.ge(t)?this:t};$t.prototype.sqrt=function(){if(this.isZero())return $t.valueOf(0);if(this.isNegative())return $t.NaN;var t=1/Math.sqrt(this._hi),e=this._hi*t,n=$t.valueOf(e),r=this.subtract(n.sqr()),i=r._hi*(t*.5);return n.add(i)};$t.prototype.selfAdd=function(){if(arguments.length===1){if(arguments[0]instanceof $t){var t=arguments[0];return this.selfAdd(t._hi,t._lo)}else if(typeof arguments[0]=="number"){var e=arguments[0],n=null,r=null,i=null,a=null,h=null,u=null;return i=this._hi+e,h=i-this._hi,a=i-h,a=e-h+(this._hi-a),u=a+this._lo,n=i+u,r=u+(i-n),this._hi=n+r,this._lo=r+(n-this._hi),this}}else if(arguments.length===2){var _=arguments[0],w=arguments[1],C=null,P=null,D=null,B=null,$=null,Z=null,W=null,rt=null;$=this._hi+_,D=this._lo+w,W=$-this._hi,rt=D-this._lo,Z=$-W,B=D-rt,Z=_-W+(this._hi-Z),B=w-rt+(this._lo-B),W=Z+D,C=$+W,P=W+($-C),W=B+P;var ct=C+W,pt=W+(C-ct);return this._hi=ct,this._lo=pt,this}};$t.prototype.selfMultiply=function(){if(arguments.length===1){if(arguments[0]instanceof $t){var t=arguments[0];return this.selfMultiply(t._hi,t._lo)}else if(typeof arguments[0]=="number"){var e=arguments[0];return this.selfMultiply(e,0)}}else if(arguments.length===2){var n=arguments[0],r=arguments[1],i=null,a=null,h=null,u=null,_=null,w=null;_=$t.SPLIT*this._hi,i=_-this._hi,w=$t.SPLIT*n,i=_-i,a=this._hi-i,h=w-n,_=this._hi*n,h=w-h,u=n-h,w=i*h-_+i*u+a*h+a*u+(this._hi*r+this._lo*n);var C=_+w;i=_-C;var P=w+i;return this._hi=C,this._lo=P,this}};$t.prototype.selfSqr=function(){return this.selfMultiply(this)};$t.prototype.floor=function(){if(this.isNaN())return $t.NaN;var t=Math.floor(this._hi),e=0;return t===this._hi&&(e=Math.floor(this._lo)),new $t(t,e)};$t.prototype.negate=function(){return this.isNaN()?this:new $t(-this._hi,-this._lo)};$t.prototype.clone=function(){};$t.prototype.multiply=function(){if(arguments[0]instanceof $t){var t=arguments[0];return t.isNaN()?$t.createNaN():$t.copy(this).selfMultiply(t)}else if(typeof arguments[0]=="number"){var e=arguments[0];return ln.isNaN(e)?$t.createNaN():$t.copy(this).selfMultiply(e,0)}};$t.prototype.isNaN=function(){return ln.isNaN(this._hi)};$t.prototype.intValue=function(){return Math.trunc(this._hi)};$t.prototype.toString=function(){var t=$t.magnitude(this._hi);return t>=-3&&t<=20?this.toStandardNotation():this.toSciNotation()};$t.prototype.toStandardNotation=function(){var t=this.getSpecialNumberString();if(t!==null)return t;var e=new Array(1).fill(null),n=this.extractSignificantDigits(!0,e),r=e[0]+1,i=n;if(n.charAt(0)===".")i="0"+n;else if(r<0)i="0."+$t.stringOfChar("0",-r)+n;else if(n.indexOf(".")===-1){var a=r-n.length,h=$t.stringOfChar("0",a);i=n+h+".0"}return this.isNegative()?"-"+i:i};$t.prototype.reciprocal=function(){var t=null,e=null,n=null,r=null,i=null,a=null,h=null,u=null;i=1/this._hi,a=$t.SPLIT*i,t=a-i,u=$t.SPLIT*this._hi,t=a-t,e=i-t,n=u-this._hi,h=i*this._hi,n=u-n,r=this._hi-n,u=t*n-h+t*r+e*n+e*r,a=(1-h-u-i*this._lo)/this._hi;var _=i+a,w=i-_+a;return new $t(_,w)};$t.prototype.toSciNotation=function(){if(this.isZero())return $t.SCI_NOT_ZERO;var t=this.getSpecialNumberString();if(t!==null)return t;var e=new Array(1).fill(null),n=this.extractSignificantDigits(!1,e),r=$t.SCI_NOT_EXPONENT_CHAR+e[0];if(n.charAt(0)==="0")throw new Error("Found leading zero: "+n);var i="";n.length>1&&(i=n.substring(1));var a=n.charAt(0)+"."+i;return this.isNegative()?"-"+a+r:a+r};$t.prototype.abs=function(){return this.isNaN()?$t.NaN:this.isNegative()?this.negate():new $t(this)};$t.prototype.isPositive=function(){return(this._hi>0||this._hi===0)&&this._lo>0};$t.prototype.lt=function(t){return(this._hi<t._hi||this._hi===t._hi)&&this._lo<t._lo};$t.prototype.add=function(){if(arguments[0]instanceof $t){var t=arguments[0];return $t.copy(this).selfAdd(t)}else if(typeof arguments[0]=="number"){var e=arguments[0];return $t.copy(this).selfAdd(e)}};$t.prototype.init=function(){if(arguments.length===1){if(typeof arguments[0]=="number"){var t=arguments[0];this._hi=t,this._lo=0}else if(arguments[0]instanceof $t){var e=arguments[0];this._hi=e._hi,this._lo=e._lo}}else if(arguments.length===2){var n=arguments[0],r=arguments[1];this._hi=n,this._lo=r}};$t.prototype.gt=function(t){return(this._hi>t._hi||this._hi===t._hi)&&this._lo>t._lo};$t.prototype.isNegative=function(){return(this._hi<0||this._hi===0)&&this._lo<0};$t.prototype.trunc=function(){return this.isNaN()?$t.NaN:this.isPositive()?this.floor():this.ceil()};$t.prototype.signum=function(){return this._hi>0?1:this._hi<0?-1:this._lo>0?1:this._lo<0?-1:0};$t.prototype.interfaces_=function(){return[Mu,Pu,w0]};$t.prototype.getClass=function(){return $t};$t.sqr=function(t){return $t.valueOf(t).selfMultiply(t)};$t.valueOf=function(){if(typeof arguments[0]=="string"){var t=arguments[0];return $t.parse(t)}else if(typeof arguments[0]=="number"){var e=arguments[0];return new $t(e)}};$t.sqrt=function(t){return $t.valueOf(t).sqrt()};$t.parse=function(t){for(var e=0,n=t.length;o_.isWhitespace(t.charAt(e));)e++;var r=!1;if(e<n){var i=t.charAt(e);(i==="-"||i==="+")&&(e++,i==="-"&&(r=!0))}for(var a=new $t,h=0,u=0,_=0;!(e>=n);){var w=t.charAt(e);if(e++,o_.isDigit(w)){var C=w-"0";a.selfMultiply($t.TEN),a.selfAdd(C),h++;continue}if(w==="."){u=h;continue}if(w==="e"||w==="E"){var P=t.substring(e);try{_=nc.parseInt(P)}catch(W){throw W instanceof Error?new Error("Invalid exponent "+P+" in string "+t):W}finally{}break}throw new Error("Unexpected character '"+w+"' at position "+e+" in string "+t)}var D=a,B=h-u-_;if(B===0)D=a;else if(B>0){var $=$t.TEN.pow(B);D=a.divide($)}else if(B<0){var Z=$t.TEN.pow(-B);D=a.multiply(Z)}return r?D.negate():D};$t.createNaN=function(){return new $t(ln.NaN,ln.NaN)};$t.copy=function(t){return new $t(t)};$t.magnitude=function(t){var e=Math.abs(t),n=Math.log(e)/Math.log(10),r=Math.trunc(Math.floor(n)),i=Math.pow(10,r);return i*10<=e&&(r+=1),r};$t.stringOfChar=function(t,e){for(var n=new gc,r=0;r<e;r++)n.append(t);return n.toString()};hl.PI.get=function(){return new $t(3.141592653589793,12246467991473532e-32)};hl.TWO_PI.get=function(){return new $t(6.283185307179586,24492935982947064e-32)};hl.PI_2.get=function(){return new $t(1.5707963267948966,6123233995736766e-32)};hl.E.get=function(){return new $t(2.718281828459045,14456468917292502e-32)};hl.NaN.get=function(){return new $t(ln.NaN,ln.NaN)};hl.EPS.get=function(){return 123259516440783e-46};hl.SPLIT.get=function(){return 134217729};hl.MAX_PRINT_DIGITS.get=function(){return 32};hl.TEN.get=function(){return $t.valueOf(10)};hl.ONE.get=function(){return $t.valueOf(1)};hl.SCI_NOT_EXPONENT_CHAR.get=function(){return"E"};hl.SCI_NOT_ZERO.get=function(){return"0.0E0"};Object.defineProperties($t,hl);var Ws=function(){},KC={DP_SAFE_EPSILON:{configurable:!0}};Ws.prototype.interfaces_=function(){return[]};Ws.prototype.getClass=function(){return Ws};Ws.orientationIndex=function(t,e,n){var r=Ws.orientationIndexFilter(t,e,n);if(r<=1)return r;var i=$t.valueOf(e.x).selfAdd(-t.x),a=$t.valueOf(e.y).selfAdd(-t.y),h=$t.valueOf(n.x).selfAdd(-e.x),u=$t.valueOf(n.y).selfAdd(-e.y);return i.selfMultiply(u).selfSubtract(a.selfMultiply(h)).signum()};Ws.signOfDet2x2=function(t,e,n,r){var i=t.multiply(r).selfSubtract(e.multiply(n));return i.signum()};Ws.intersection=function(t,e,n,r){var i=$t.valueOf(r.y).selfSubtract(n.y).selfMultiply($t.valueOf(e.x).selfSubtract(t.x)),a=$t.valueOf(r.x).selfSubtract(n.x).selfMultiply($t.valueOf(e.y).selfSubtract(t.y)),h=i.subtract(a),u=$t.valueOf(r.x).selfSubtract(n.x).selfMultiply($t.valueOf(t.y).selfSubtract(n.y)),_=$t.valueOf(r.y).selfSubtract(n.y).selfMultiply($t.valueOf(t.x).selfSubtract(n.x)),w=u.subtract(_),C=w.selfDivide(h).doubleValue(),P=$t.valueOf(t.x).selfAdd($t.valueOf(e.x).selfSubtract(t.x).selfMultiply(C)).doubleValue(),D=$t.valueOf(e.x).selfSubtract(t.x).selfMultiply($t.valueOf(t.y).selfSubtract(n.y)),B=$t.valueOf(e.y).selfSubtract(t.y).selfMultiply($t.valueOf(t.x).selfSubtract(n.x)),$=D.subtract(B),Z=$.selfDivide(h).doubleValue(),W=$t.valueOf(n.y).selfAdd($t.valueOf(r.y).selfSubtract(n.y).selfMultiply(Z)).doubleValue();return new Lt(P,W)};Ws.orientationIndexFilter=function(t,e,n){var r=null,i=(t.x-n.x)*(e.y-n.y),a=(t.y-n.y)*(e.x-n.x),h=i-a;if(i>0){if(a<=0)return Ws.signum(h);r=i+a}else if(i<0){if(a>=0)return Ws.signum(h);r=-i-a}else return Ws.signum(h);var u=Ws.DP_SAFE_EPSILON*r;return h>=u||-h>=u?Ws.signum(h):2};Ws.signum=function(t){return t>0?1:t<0?-1:0};KC.DP_SAFE_EPSILON.get=function(){return 1e-15};Object.defineProperties(Ws,KC);var Bn=function(){},M_={X:{configurable:!0},Y:{configurable:!0},Z:{configurable:!0},M:{configurable:!0}};M_.X.get=function(){return 0};M_.Y.get=function(){return 1};M_.Z.get=function(){return 2};M_.M.get=function(){return 3};Bn.prototype.setOrdinate=function(t,e,n){};Bn.prototype.size=function(){};Bn.prototype.getOrdinate=function(t,e){};Bn.prototype.getCoordinate=function(){};Bn.prototype.getCoordinateCopy=function(t){};Bn.prototype.getDimension=function(){};Bn.prototype.getX=function(t){};Bn.prototype.clone=function(){};Bn.prototype.expandEnvelope=function(t){};Bn.prototype.copy=function(){};Bn.prototype.getY=function(t){};Bn.prototype.toCoordinateArray=function(){};Bn.prototype.interfaces_=function(){return[w0]};Bn.prototype.getClass=function(){return Bn};Object.defineProperties(Bn,M_);var QC=function(){},$m=function(t){function e(){t.call(this,"Projective point not representable on the Cartesian plane.")}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.interfaces_=function(){return[]},e.prototype.getClass=function(){return e},e}(QC),ko=function(){};ko.arraycopy=function(t,e,n,r,i){for(var a=0,h=e;h<e+i;h++)n[r+a]=t[h],a++};ko.getProperty=function(t){return{"line.separator":`
`}[t]};var Xu=function t(){if(this.x=null,this.y=null,this.w=null,arguments.length===0)this.x=0,this.y=0,this.w=1;else if(arguments.length===1){var e=arguments[0];this.x=e.x,this.y=e.y,this.w=1}else if(arguments.length===2){if(typeof arguments[0]=="number"&&typeof arguments[1]=="number"){var n=arguments[0],r=arguments[1];this.x=n,this.y=r,this.w=1}else if(arguments[0]instanceof t&&arguments[1]instanceof t){var i=arguments[0],a=arguments[1];this.x=i.y*a.w-a.y*i.w,this.y=a.x*i.w-i.x*a.w,this.w=i.x*a.y-a.x*i.y}else if(arguments[0]instanceof Lt&&arguments[1]instanceof Lt){var h=arguments[0],u=arguments[1];this.x=h.y-u.y,this.y=u.x-h.x,this.w=h.x*u.y-u.x*h.y}}else if(arguments.length===3){var _=arguments[0],w=arguments[1],C=arguments[2];this.x=_,this.y=w,this.w=C}else if(arguments.length===4){var P=arguments[0],D=arguments[1],B=arguments[2],$=arguments[3],Z=P.y-D.y,W=D.x-P.x,rt=P.x*D.y-D.x*P.y,ct=B.y-$.y,pt=$.x-B.x,gt=B.x*$.y-$.x*B.y;this.x=W*gt-pt*rt,this.y=ct*rt-Z*gt,this.w=Z*pt-ct*W}};Xu.prototype.getY=function(){var t=this.y/this.w;if(ln.isNaN(t)||ln.isInfinite(t))throw new $m;return t};Xu.prototype.getX=function(){var t=this.x/this.w;if(ln.isNaN(t)||ln.isInfinite(t))throw new $m;return t};Xu.prototype.getCoordinate=function(){var t=new Lt;return t.x=this.getX(),t.y=this.getY(),t};Xu.prototype.interfaces_=function(){return[]};Xu.prototype.getClass=function(){return Xu};Xu.intersection=function(t,e,n,r){var i=t.y-e.y,a=e.x-t.x,h=t.x*e.y-e.x*t.y,u=n.y-r.y,_=r.x-n.x,w=n.x*r.y-r.x*n.y,C=a*w-_*h,P=u*h-i*w,D=i*_-u*a,B=C/D,$=P/D;if(ln.isNaN(B)||ln.isInfinite(B)||ln.isNaN($)||ln.isInfinite($))throw new $m;return new Lt(B,$)};var $e=function t(){if(this._minx=null,this._maxx=null,this._miny=null,this._maxy=null,arguments.length===0)this.init();else if(arguments.length===1){if(arguments[0]instanceof Lt){var e=arguments[0];this.init(e.x,e.x,e.y,e.y)}else if(arguments[0]instanceof t){var n=arguments[0];this.init(n)}}else if(arguments.length===2){var r=arguments[0],i=arguments[1];this.init(r.x,i.x,r.y,i.y)}else if(arguments.length===4){var a=arguments[0],h=arguments[1],u=arguments[2],_=arguments[3];this.init(a,h,u,_)}},tT={serialVersionUID:{configurable:!0}};$e.prototype.getArea=function(){return this.getWidth()*this.getHeight()};$e.prototype.equals=function(t){if(!(t instanceof $e))return!1;var e=t;return this.isNull()?e.isNull():this._maxx===e.getMaxX()&&this._maxy===e.getMaxY()&&this._minx===e.getMinX()&&this._miny===e.getMinY()};$e.prototype.intersection=function(t){if(this.isNull()||t.isNull()||!this.intersects(t))return new $e;var e=this._minx>t._minx?this._minx:t._minx,n=this._miny>t._miny?this._miny:t._miny,r=this._maxx<t._maxx?this._maxx:t._maxx,i=this._maxy<t._maxy?this._maxy:t._maxy;return new $e(e,r,n,i)};$e.prototype.isNull=function(){return this._maxx<this._minx};$e.prototype.getMaxX=function(){return this._maxx};$e.prototype.covers=function(){if(arguments.length===1){if(arguments[0]instanceof Lt){var t=arguments[0];return this.covers(t.x,t.y)}else if(arguments[0]instanceof $e){var e=arguments[0];return this.isNull()||e.isNull()?!1:e.getMinX()>=this._minx&&e.getMaxX()<=this._maxx&&e.getMinY()>=this._miny&&e.getMaxY()<=this._maxy}}else if(arguments.length===2){var n=arguments[0],r=arguments[1];return this.isNull()?!1:n>=this._minx&&n<=this._maxx&&r>=this._miny&&r<=this._maxy}};$e.prototype.intersects=function(){if(arguments.length===1){if(arguments[0]instanceof $e){var t=arguments[0];return this.isNull()||t.isNull()?!1:!(t._minx>this._maxx||t._maxx<this._minx||t._miny>this._maxy||t._maxy<this._miny)}else if(arguments[0]instanceof Lt){var e=arguments[0];return this.intersects(e.x,e.y)}}else if(arguments.length===2){var n=arguments[0],r=arguments[1];return this.isNull()?!1:!(n>this._maxx||n<this._minx||r>this._maxy||r<this._miny)}};$e.prototype.getMinY=function(){return this._miny};$e.prototype.getMinX=function(){return this._minx};$e.prototype.expandToInclude=function(){if(arguments.length===1){if(arguments[0]instanceof Lt){var t=arguments[0];this.expandToInclude(t.x,t.y)}else if(arguments[0]instanceof $e){var e=arguments[0];if(e.isNull())return null;this.isNull()?(this._minx=e.getMinX(),this._maxx=e.getMaxX(),this._miny=e.getMinY(),this._maxy=e.getMaxY()):(e._minx<this._minx&&(this._minx=e._minx),e._maxx>this._maxx&&(this._maxx=e._maxx),e._miny<this._miny&&(this._miny=e._miny),e._maxy>this._maxy&&(this._maxy=e._maxy))}}else if(arguments.length===2){var n=arguments[0],r=arguments[1];this.isNull()?(this._minx=n,this._maxx=n,this._miny=r,this._maxy=r):(n<this._minx&&(this._minx=n),n>this._maxx&&(this._maxx=n),r<this._miny&&(this._miny=r),r>this._maxy&&(this._maxy=r))}};$e.prototype.minExtent=function(){if(this.isNull())return 0;var t=this.getWidth(),e=this.getHeight();return t<e?t:e};$e.prototype.getWidth=function(){return this.isNull()?0:this._maxx-this._minx};$e.prototype.compareTo=function(t){var e=t;return this.isNull()?e.isNull()?0:-1:e.isNull()?1:this._minx<e._minx?-1:this._minx>e._minx?1:this._miny<e._miny?-1:this._miny>e._miny?1:this._maxx<e._maxx?-1:this._maxx>e._maxx?1:this._maxy<e._maxy?-1:this._maxy>e._maxy?1:0};$e.prototype.translate=function(t,e){if(this.isNull())return null;this.init(this.getMinX()+t,this.getMaxX()+t,this.getMinY()+e,this.getMaxY()+e)};$e.prototype.toString=function(){return"Env["+this._minx+" : "+this._maxx+", "+this._miny+" : "+this._maxy+"]"};$e.prototype.setToNull=function(){this._minx=0,this._maxx=-1,this._miny=0,this._maxy=-1};$e.prototype.getHeight=function(){return this.isNull()?0:this._maxy-this._miny};$e.prototype.maxExtent=function(){if(this.isNull())return 0;var t=this.getWidth(),e=this.getHeight();return t>e?t:e};$e.prototype.expandBy=function(){if(arguments.length===1){var t=arguments[0];this.expandBy(t,t)}else if(arguments.length===2){var e=arguments[0],n=arguments[1];if(this.isNull())return null;this._minx-=e,this._maxx+=e,this._miny-=n,this._maxy+=n,(this._minx>this._maxx||this._miny>this._maxy)&&this.setToNull()}};$e.prototype.contains=function(){if(arguments.length===1){if(arguments[0]instanceof $e){var t=arguments[0];return this.covers(t)}else if(arguments[0]instanceof Lt){var e=arguments[0];return this.covers(e)}}else if(arguments.length===2){var n=arguments[0],r=arguments[1];return this.covers(n,r)}};$e.prototype.centre=function(){return this.isNull()?null:new Lt((this.getMinX()+this.getMaxX())/2,(this.getMinY()+this.getMaxY())/2)};$e.prototype.init=function(){if(arguments.length===0)this.setToNull();else if(arguments.length===1){if(arguments[0]instanceof Lt){var t=arguments[0];this.init(t.x,t.x,t.y,t.y)}else if(arguments[0]instanceof $e){var e=arguments[0];this._minx=e._minx,this._maxx=e._maxx,this._miny=e._miny,this._maxy=e._maxy}}else if(arguments.length===2){var n=arguments[0],r=arguments[1];this.init(n.x,r.x,n.y,r.y)}else if(arguments.length===4){var i=arguments[0],a=arguments[1],h=arguments[2],u=arguments[3];i<a?(this._minx=i,this._maxx=a):(this._minx=a,this._maxx=i),h<u?(this._miny=h,this._maxy=u):(this._miny=u,this._maxy=h)}};$e.prototype.getMaxY=function(){return this._maxy};$e.prototype.distance=function(t){if(this.intersects(t))return 0;var e=0;this._maxx<t._minx?e=t._minx-this._maxx:this._minx>t._maxx&&(e=this._minx-t._maxx);var n=0;return this._maxy<t._miny?n=t._miny-this._maxy:this._miny>t._maxy&&(n=this._miny-t._maxy),e===0?n:n===0?e:Math.sqrt(e*e+n*n)};$e.prototype.hashCode=function(){var t=17;return t=37*t+Lt.hashCode(this._minx),t=37*t+Lt.hashCode(this._maxx),t=37*t+Lt.hashCode(this._miny),t=37*t+Lt.hashCode(this._maxy),t};$e.prototype.interfaces_=function(){return[Pu,Mu]};$e.prototype.getClass=function(){return $e};$e.intersects=function(){if(arguments.length===3){var t=arguments[0],e=arguments[1],n=arguments[2];return n.x>=(t.x<e.x?t.x:e.x)&&n.x<=(t.x>e.x?t.x:e.x)&&n.y>=(t.y<e.y?t.y:e.y)&&n.y<=(t.y>e.y?t.y:e.y)}else if(arguments.length===4){var r=arguments[0],i=arguments[1],a=arguments[2],h=arguments[3],u=Math.min(a.x,h.x),_=Math.max(a.x,h.x),w=Math.min(r.x,i.x),C=Math.max(r.x,i.x);return!(w>_||C<u||(u=Math.min(a.y,h.y),_=Math.max(a.y,h.y),w=Math.min(r.y,i.y),C=Math.max(r.y,i.y),w>_)||C<u)}};tT.serialVersionUID.get=function(){return 5873921885273102e3};Object.defineProperties($e,tT);var Ol={typeStr:/^\s*(\w+)\s*\(\s*(.*)\s*\)\s*$/,emptyTypeStr:/^\s*(\w+)\s*EMPTY\s*$/,spaces:/\s+/,parenComma:/\)\s*,\s*\(/,doubleParenComma:/\)\s*\)\s*,\s*\(\s*\(/,trimParens:/^\s*\(?(.*?)\)?\s*$/},E0=function(t){this.geometryFactory=t||new En};E0.prototype.read=function(t){var e,n,r;t=t.replace(/[\n\r]/g," ");var i=Ol.typeStr.exec(t);if(t.search("EMPTY")!==-1&&(i=Ol.emptyTypeStr.exec(t),i[2]=void 0),i&&(n=i[1].toLowerCase(),r=i[2],Ug[n]&&(e=Ug[n].apply(this,[r]))),e===void 0)throw new Error("Could not parse WKT "+t);return e};E0.prototype.write=function(t){return this.extractGeometry(t)};E0.prototype.extractGeometry=function(t){var e=t.getGeometryType().toLowerCase();if(!bh[e])return null;var n=e.toUpperCase(),r;return t.isEmpty()?r=n+" EMPTY":r=n+"("+bh[e].apply(this,[t])+")",r};var bh={coordinate:function(t){return t.x+" "+t.y},point:function(t){return bh.coordinate.call(this,t._coordinates._coordinates[0])},multipoint:function(t){for(var e=this,n=[],r=0,i=t._geometries.length;r<i;++r)n.push("("+bh.point.apply(e,[t._geometries[r]])+")");return n.join(",")},linestring:function(t){for(var e=this,n=[],r=0,i=t._points._coordinates.length;r<i;++r)n.push(bh.coordinate.apply(e,[t._points._coordinates[r]]));return n.join(",")},linearring:function(t){for(var e=this,n=[],r=0,i=t._points._coordinates.length;r<i;++r)n.push(bh.coordinate.apply(e,[t._points._coordinates[r]]));return n.join(",")},multilinestring:function(t){for(var e=this,n=[],r=0,i=t._geometries.length;r<i;++r)n.push("("+bh.linestring.apply(e,[t._geometries[r]])+")");return n.join(",")},polygon:function(t){var e=this,n=[];n.push("("+bh.linestring.apply(this,[t._shell])+")");for(var r=0,i=t._holes.length;r<i;++r)n.push("("+bh.linestring.apply(e,[t._holes[r]])+")");return n.join(",")},multipolygon:function(t){for(var e=this,n=[],r=0,i=t._geometries.length;r<i;++r)n.push("("+bh.polygon.apply(e,[t._geometries[r]])+")");return n.join(",")},geometrycollection:function(t){for(var e=this,n=[],r=0,i=t._geometries.length;r<i;++r)n.push(e.extractGeometry(t._geometries[r]));return n.join(",")}},Ug={point:function(t){if(t===void 0)return this.geometryFactory.createPoint();var e=t.trim().split(Ol.spaces);return this.geometryFactory.createPoint(new Lt(Number.parseFloat(e[0]),Number.parseFloat(e[1])))},multipoint:function(t){var e=this;if(t===void 0)return this.geometryFactory.createMultiPoint();for(var n,r=t.trim().split(","),i=[],a=0,h=r.length;a<h;++a)n=r[a].replace(Ol.trimParens,"$1"),i.push(Ug.point.apply(e,[n]));return this.geometryFactory.createMultiPoint(i)},linestring:function(t){if(t===void 0)return this.geometryFactory.createLineString();for(var e=t.trim().split(","),n=[],r,i=0,a=e.length;i<a;++i)r=e[i].trim().split(Ol.spaces),n.push(new Lt(Number.parseFloat(r[0]),Number.parseFloat(r[1])));return this.geometryFactory.createLineString(n)},linearring:function(t){if(t===void 0)return this.geometryFactory.createLinearRing();for(var e=t.trim().split(","),n=[],r,i=0,a=e.length;i<a;++i)r=e[i].trim().split(Ol.spaces),n.push(new Lt(Number.parseFloat(r[0]),Number.parseFloat(r[1])));return this.geometryFactory.createLinearRing(n)},multilinestring:function(t){var e=this;if(t===void 0)return this.geometryFactory.createMultiLineString();for(var n,r=t.trim().split(Ol.parenComma),i=[],a=0,h=r.length;a<h;++a)n=r[a].replace(Ol.trimParens,"$1"),i.push(Ug.linestring.apply(e,[n]));return this.geometryFactory.createMultiLineString(i)},polygon:function(t){var e=this;if(t===void 0)return this.geometryFactory.createPolygon();for(var n,r,i,a=t.trim().split(Ol.parenComma),h,u=[],_=0,w=a.length;_<w;++_)n=a[_].replace(Ol.trimParens,"$1"),r=Ug.linestring.apply(e,[n]),i=e.geometryFactory.createLinearRing(r._points),_===0?h=i:u.push(i);return this.geometryFactory.createPolygon(h,u)},multipolygon:function(t){var e=this;if(t===void 0)return this.geometryFactory.createMultiPolygon();for(var n,r=t.trim().split(Ol.doubleParenComma),i=[],a=0,h=r.length;a<h;++a)n=r[a].replace(Ol.trimParens,"$1"),i.push(Ug.polygon.apply(e,[n]));return this.geometryFactory.createMultiPolygon(i)},geometrycollection:function(t){var e=this;if(t===void 0)return this.geometryFactory.createGeometryCollection();t=t.replace(/,\s*([A-Za-z])/g,"|$1");for(var n=t.trim().split("|"),r=[],i=0,a=n.length;i<a;++i)r.push(e.read(n[i]));return this.geometryFactory.createGeometryCollection(r)}},el=function(t){this.parser=new E0(t)};el.prototype.write=function(t){return this.parser.write(t)};el.toLineString=function(t,e){if(arguments.length!==2)throw new Error("Not implemented");return"LINESTRING ( "+t.x+" "+t.y+", "+e.x+" "+e.y+" )"};var Fh=function(t){function e(n){t.call(this,n),this.name="RuntimeException",this.message=n,this.stack=new t().stack}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e}(Error),Hv=function(t){function e(){if(t.call(this),arguments.length===0)t.call(this);else if(arguments.length===1){var n=arguments[0];t.call(this,n)}}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.interfaces_=function(){return[]},e.prototype.getClass=function(){return e},e}(Fh),dn=function(){};dn.prototype.interfaces_=function(){return[]};dn.prototype.getClass=function(){return dn};dn.shouldNeverReachHere=function(){if(arguments.length===0)dn.shouldNeverReachHere(null);else if(arguments.length===1){var t=arguments[0];throw new Hv("Should never reach here"+(t!==null?": "+t:""))}};dn.isTrue=function(){var t,e;if(arguments.length===1)t=arguments[0],dn.isTrue(t,null);else if(arguments.length===2&&(t=arguments[0],e=arguments[1],!t))throw e===null?new Hv:new Hv(e)};dn.equals=function(){var t,e,n;if(arguments.length===2)t=arguments[0],e=arguments[1],dn.equals(t,e,null);else if(arguments.length===3&&(t=arguments[0],e=arguments[1],n=arguments[2],!e.equals(t)))throw new Hv("Expected "+t+" but encountered "+e+(n!==null?": "+n:""))};var Qr=function(){this._result=null,this._inputLines=Array(2).fill().map(function(){return Array(2)}),this._intPt=new Array(2).fill(null),this._intLineIndex=null,this._isProper=null,this._pa=null,this._pb=null,this._precisionModel=null,this._intPt[0]=new Lt,this._intPt[1]=new Lt,this._pa=this._intPt[0],this._pb=this._intPt[1],this._result=0},dg={DONT_INTERSECT:{configurable:!0},DO_INTERSECT:{configurable:!0},COLLINEAR:{configurable:!0},NO_INTERSECTION:{configurable:!0},POINT_INTERSECTION:{configurable:!0},COLLINEAR_INTERSECTION:{configurable:!0}};Qr.prototype.getIndexAlongSegment=function(t,e){return this.computeIntLineIndex(),this._intLineIndex[t][e]};Qr.prototype.getTopologySummary=function(){var t=new gc;return this.isEndPoint()&&t.append(" endpoint"),this._isProper&&t.append(" proper"),this.isCollinear()&&t.append(" collinear"),t.toString()};Qr.prototype.computeIntersection=function(t,e,n,r){this._inputLines[0][0]=t,this._inputLines[0][1]=e,this._inputLines[1][0]=n,this._inputLines[1][1]=r,this._result=this.computeIntersect(t,e,n,r)};Qr.prototype.getIntersectionNum=function(){return this._result};Qr.prototype.computeIntLineIndex=function(){if(arguments.length===0)this._intLineIndex===null&&(this._intLineIndex=Array(2).fill().map(function(){return Array(2)}),this.computeIntLineIndex(0),this.computeIntLineIndex(1));else if(arguments.length===1){var t=arguments[0],e=this.getEdgeDistance(t,0),n=this.getEdgeDistance(t,1);e>n?(this._intLineIndex[t][0]=0,this._intLineIndex[t][1]=1):(this._intLineIndex[t][0]=1,this._intLineIndex[t][1]=0)}};Qr.prototype.isProper=function(){return this.hasIntersection()&&this._isProper};Qr.prototype.setPrecisionModel=function(t){this._precisionModel=t};Qr.prototype.isInteriorIntersection=function(){var t=this;if(arguments.length===0)return!!(this.isInteriorIntersection(0)||this.isInteriorIntersection(1));if(arguments.length===1){for(var e=arguments[0],n=0;n<this._result;n++)if(!(t._intPt[n].equals2D(t._inputLines[e][0])||t._intPt[n].equals2D(t._inputLines[e][1])))return!0;return!1}};Qr.prototype.getIntersection=function(t){return this._intPt[t]};Qr.prototype.isEndPoint=function(){return this.hasIntersection()&&!this._isProper};Qr.prototype.hasIntersection=function(){return this._result!==Qr.NO_INTERSECTION};Qr.prototype.getEdgeDistance=function(t,e){var n=Qr.computeEdgeDistance(this._intPt[e],this._inputLines[t][0],this._inputLines[t][1]);return n};Qr.prototype.isCollinear=function(){return this._result===Qr.COLLINEAR_INTERSECTION};Qr.prototype.toString=function(){return el.toLineString(this._inputLines[0][0],this._inputLines[0][1])+" - "+el.toLineString(this._inputLines[1][0],this._inputLines[1][1])+this.getTopologySummary()};Qr.prototype.getEndpoint=function(t,e){return this._inputLines[t][e]};Qr.prototype.isIntersection=function(t){for(var e=this,n=0;n<this._result;n++)if(e._intPt[n].equals2D(t))return!0;return!1};Qr.prototype.getIntersectionAlongSegment=function(t,e){return this.computeIntLineIndex(),this._intPt[this._intLineIndex[t][e]]};Qr.prototype.interfaces_=function(){return[]};Qr.prototype.getClass=function(){return Qr};Qr.computeEdgeDistance=function(t,e,n){var r=Math.abs(n.x-e.x),i=Math.abs(n.y-e.y),a=-1;if(t.equals(e))a=0;else if(t.equals(n))r>i?a=r:a=i;else{var h=Math.abs(t.x-e.x),u=Math.abs(t.y-e.y);r>i?a=h:a=u,a===0&&!t.equals(e)&&(a=Math.max(h,u))}return dn.isTrue(!(a===0&&!t.equals(e)),"Bad distance calculation"),a};Qr.nonRobustComputeEdgeDistance=function(t,e,n){var r=t.x-e.x,i=t.y-e.y,a=Math.sqrt(r*r+i*i);return dn.isTrue(!(a===0&&!t.equals(e)),"Invalid distance calculation"),a};dg.DONT_INTERSECT.get=function(){return 0};dg.DO_INTERSECT.get=function(){return 1};dg.COLLINEAR.get=function(){return 2};dg.NO_INTERSECTION.get=function(){return 0};dg.POINT_INTERSECTION.get=function(){return 1};dg.COLLINEAR_INTERSECTION.get=function(){return 2};Object.defineProperties(Qr,dg);var cd=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.isInSegmentEnvelopes=function(n){var r=new $e(this._inputLines[0][0],this._inputLines[0][1]),i=new $e(this._inputLines[1][0],this._inputLines[1][1]);return r.contains(n)&&i.contains(n)},e.prototype.computeIntersection=function(){if(arguments.length===3){var n=arguments[0],r=arguments[1],i=arguments[2];if(this._isProper=!1,$e.intersects(r,i,n)&&Ce.orientationIndex(r,i,n)===0&&Ce.orientationIndex(i,r,n)===0)return this._isProper=!0,(n.equals(r)||n.equals(i))&&(this._isProper=!1),this._result=t.POINT_INTERSECTION,null;this._result=t.NO_INTERSECTION}else return t.prototype.computeIntersection.apply(this,arguments)},e.prototype.normalizeToMinimum=function(n,r,i,a,h){h.x=this.smallestInAbsValue(n.x,r.x,i.x,a.x),h.y=this.smallestInAbsValue(n.y,r.y,i.y,a.y),n.x-=h.x,n.y-=h.y,r.x-=h.x,r.y-=h.y,i.x-=h.x,i.y-=h.y,a.x-=h.x,a.y-=h.y},e.prototype.safeHCoordinateIntersection=function(n,r,i,a){var h=null;try{h=Xu.intersection(n,r,i,a)}catch(u){if(u instanceof $m)h=e.nearestEndpoint(n,r,i,a);else throw u}finally{}return h},e.prototype.intersection=function(n,r,i,a){var h=this.intersectionWithNormalization(n,r,i,a);return this.isInSegmentEnvelopes(h)||(h=new Lt(e.nearestEndpoint(n,r,i,a))),this._precisionModel!==null&&this._precisionModel.makePrecise(h),h},e.prototype.smallestInAbsValue=function(n,r,i,a){var h=n,u=Math.abs(h);return Math.abs(r)<u&&(h=r,u=Math.abs(r)),Math.abs(i)<u&&(h=i,u=Math.abs(i)),Math.abs(a)<u&&(h=a),h},e.prototype.checkDD=function(n,r,i,a,h){var u=Ws.intersection(n,r,i,a),_=this.isInSegmentEnvelopes(u);ko.out.println("DD in env = "+_+"  --------------------- "+u),h.distance(u)>1e-4&&ko.out.println("Distance = "+h.distance(u))},e.prototype.intersectionWithNormalization=function(n,r,i,a){var h=new Lt(n),u=new Lt(r),_=new Lt(i),w=new Lt(a),C=new Lt;this.normalizeToEnvCentre(h,u,_,w,C);var P=this.safeHCoordinateIntersection(h,u,_,w);return P.x+=C.x,P.y+=C.y,P},e.prototype.computeCollinearIntersection=function(n,r,i,a){var h=$e.intersects(n,r,i),u=$e.intersects(n,r,a),_=$e.intersects(i,a,n),w=$e.intersects(i,a,r);return h&&u?(this._intPt[0]=i,this._intPt[1]=a,t.COLLINEAR_INTERSECTION):_&&w?(this._intPt[0]=n,this._intPt[1]=r,t.COLLINEAR_INTERSECTION):h&&_?(this._intPt[0]=i,this._intPt[1]=n,i.equals(n)&&!u&&!w?t.POINT_INTERSECTION:t.COLLINEAR_INTERSECTION):h&&w?(this._intPt[0]=i,this._intPt[1]=r,i.equals(r)&&!u&&!_?t.POINT_INTERSECTION:t.COLLINEAR_INTERSECTION):u&&_?(this._intPt[0]=a,this._intPt[1]=n,a.equals(n)&&!h&&!w?t.POINT_INTERSECTION:t.COLLINEAR_INTERSECTION):u&&w?(this._intPt[0]=a,this._intPt[1]=r,a.equals(r)&&!h&&!_?t.POINT_INTERSECTION:t.COLLINEAR_INTERSECTION):t.NO_INTERSECTION},e.prototype.normalizeToEnvCentre=function(n,r,i,a,h){var u=n.x<r.x?n.x:r.x,_=n.y<r.y?n.y:r.y,w=n.x>r.x?n.x:r.x,C=n.y>r.y?n.y:r.y,P=i.x<a.x?i.x:a.x,D=i.y<a.y?i.y:a.y,B=i.x>a.x?i.x:a.x,$=i.y>a.y?i.y:a.y,Z=u>P?u:P,W=w<B?w:B,rt=_>D?_:D,ct=C<$?C:$,pt=(Z+W)/2,gt=(rt+ct)/2;h.x=pt,h.y=gt,n.x-=h.x,n.y-=h.y,r.x-=h.x,r.y-=h.y,i.x-=h.x,i.y-=h.y,a.x-=h.x,a.y-=h.y},e.prototype.computeIntersect=function(n,r,i,a){if(this._isProper=!1,!$e.intersects(n,r,i,a))return t.NO_INTERSECTION;var h=Ce.orientationIndex(n,r,i),u=Ce.orientationIndex(n,r,a);if(h>0&&u>0||h<0&&u<0)return t.NO_INTERSECTION;var _=Ce.orientationIndex(i,a,n),w=Ce.orientationIndex(i,a,r);if(_>0&&w>0||_<0&&w<0)return t.NO_INTERSECTION;var C=h===0&&u===0&&_===0&&w===0;return C?this.computeCollinearIntersection(n,r,i,a):(h===0||u===0||_===0||w===0?(this._isProper=!1,n.equals2D(i)||n.equals2D(a)?this._intPt[0]=n:r.equals2D(i)||r.equals2D(a)?this._intPt[0]=r:h===0?this._intPt[0]=new Lt(i):u===0?this._intPt[0]=new Lt(a):_===0?this._intPt[0]=new Lt(n):w===0&&(this._intPt[0]=new Lt(r))):(this._isProper=!0,this._intPt[0]=this.intersection(n,r,i,a)),t.POINT_INTERSECTION)},e.prototype.interfaces_=function(){return[]},e.prototype.getClass=function(){return e},e.nearestEndpoint=function(n,r,i,a){var h=n,u=Ce.distancePointLine(n,i,a),_=Ce.distancePointLine(r,i,a);return _<u&&(u=_,h=r),_=Ce.distancePointLine(i,n,r),_<u&&(u=_,h=i),_=Ce.distancePointLine(a,n,r),_<u&&(u=_,h=a),h},e}(Qr),jd=function(){};jd.prototype.interfaces_=function(){return[]};jd.prototype.getClass=function(){return jd};jd.orientationIndex=function(t,e,n){var r=e.x-t.x,i=e.y-t.y,a=n.x-e.x,h=n.y-e.y;return jd.signOfDet2x2(r,i,a,h)};jd.signOfDet2x2=function(t,e,n,r){var i=null,a=null,h=null;if(i=1,t===0||r===0)return e===0||n===0?0:e>0?n>0?-i:i:n>0?i:-i;if(e===0||n===0)return r>0?t>0?i:-i:t>0?-i:i;if(e>0?r>0?e<=r||(i=-i,a=t,t=n,n=a,a=e,e=r,r=a):e<=-r?(i=-i,n=-n,r=-r):(a=t,t=-n,n=a,a=e,e=-r,r=a):r>0?-e<=r?(i=-i,t=-t,e=-e):(a=-t,t=n,n=a,a=-e,e=r,r=a):e>=r?(t=-t,e=-e,n=-n,r=-r):(i=-i,a=-t,t=-n,n=a,a=-e,e=-r,r=a),t>0)if(n>0){if(!(t<=n))return i}else return i;else{if(n>0)return-i;if(t>=n)i=-i,t=-t,n=-n;else return-i}for(;;){if(h=Math.floor(n/t),n=n-h*t,r=r-h*e,r<0)return-i;if(r>e)return i;if(t>n+n){if(e<r+r)return i}else{if(e>r+r)return-i;n=t-n,r=e-r,i=-i}if(r===0)return n===0?0:-i;if(n===0||(h=Math.floor(t/n),t=t-h*n,e=e-h*r,e<0))return i;if(e>r)return-i;if(n>t+t){if(r<e+e)return-i}else{if(r>e+e)return i;t=n-t,e=r-e,i=-i}if(e===0)return t===0?0:i;if(t===0)return-i}};var ql=function(){this._p=null,this._crossingCount=0,this._isPointOnSegment=!1;var t=arguments[0];this._p=t};ql.prototype.countSegment=function(t,e){if(t.x<this._p.x&&e.x<this._p.x)return null;if(this._p.x===e.x&&this._p.y===e.y)return this._isPointOnSegment=!0,null;if(t.y===this._p.y&&e.y===this._p.y){var n=t.x,r=e.x;return n>r&&(n=e.x,r=t.x),this._p.x>=n&&this._p.x<=r&&(this._isPointOnSegment=!0),null}if(t.y>this._p.y&&e.y<=this._p.y||e.y>this._p.y&&t.y<=this._p.y){var i=t.x-this._p.x,a=t.y-this._p.y,h=e.x-this._p.x,u=e.y-this._p.y,_=jd.signOfDet2x2(i,a,h,u);if(_===0)return this._isPointOnSegment=!0,null;u<a&&(_=-_),_>0&&this._crossingCount++}};ql.prototype.isPointInPolygon=function(){return this.getLocation()!==Mt.EXTERIOR};ql.prototype.getLocation=function(){return this._isPointOnSegment?Mt.BOUNDARY:this._crossingCount%2===1?Mt.INTERIOR:Mt.EXTERIOR};ql.prototype.isOnSegment=function(){return this._isPointOnSegment};ql.prototype.interfaces_=function(){return[]};ql.prototype.getClass=function(){return ql};ql.locatePointInRing=function(){if(arguments[0]instanceof Lt&&en(arguments[1],Bn)){for(var t=arguments[0],e=arguments[1],n=new ql(t),r=new Lt,i=new Lt,a=1;a<e.size();a++)if(e.getCoordinate(a,r),e.getCoordinate(a-1,i),n.countSegment(r,i),n.isOnSegment())return n.getLocation();return n.getLocation()}else if(arguments[0]instanceof Lt&&arguments[1]instanceof Array){for(var h=arguments[0],u=arguments[1],_=new ql(h),w=1;w<u.length;w++){var C=u[w],P=u[w-1];if(_.countSegment(C,P),_.isOnSegment())return _.getLocation()}return _.getLocation()}};var Ce=function(){},gg={CLOCKWISE:{configurable:!0},RIGHT:{configurable:!0},COUNTERCLOCKWISE:{configurable:!0},LEFT:{configurable:!0},COLLINEAR:{configurable:!0},STRAIGHT:{configurable:!0}};Ce.prototype.interfaces_=function(){return[]};Ce.prototype.getClass=function(){return Ce};Ce.orientationIndex=function(t,e,n){return Ws.orientationIndex(t,e,n)};Ce.signedArea=function(){if(arguments[0]instanceof Array){var t=arguments[0];if(t.length<3)return 0;for(var e=0,n=t[0].x,r=1;r<t.length-1;r++){var i=t[r].x-n,a=t[r+1].y,h=t[r-1].y;e+=i*(h-a)}return e/2}else if(en(arguments[0],Bn)){var u=arguments[0],_=u.size();if(_<3)return 0;var w=new Lt,C=new Lt,P=new Lt;u.getCoordinate(0,C),u.getCoordinate(1,P);var D=C.x;P.x-=D;for(var B=0,$=1;$<_-1;$++)w.y=C.y,C.x=P.x,C.y=P.y,u.getCoordinate($+1,P),P.x-=D,B+=C.x*(w.y-P.y);return B/2}};Ce.distanceLineLine=function(t,e,n,r){if(t.equals(e))return Ce.distancePointLine(t,n,r);if(n.equals(r))return Ce.distancePointLine(r,t,e);var i=!1;if(!$e.intersects(t,e,n,r))i=!0;else{var a=(e.x-t.x)*(r.y-n.y)-(e.y-t.y)*(r.x-n.x);if(a===0)i=!0;else{var h=(t.y-n.y)*(r.x-n.x)-(t.x-n.x)*(r.y-n.y),u=(t.y-n.y)*(e.x-t.x)-(t.x-n.x)*(e.y-t.y),_=u/a,w=h/a;(w<0||w>1||_<0||_>1)&&(i=!0)}}return i?Qa.min(Ce.distancePointLine(t,n,r),Ce.distancePointLine(e,n,r),Ce.distancePointLine(n,t,e),Ce.distancePointLine(r,t,e)):0};Ce.isPointInRing=function(t,e){return Ce.locatePointInRing(t,e)!==Mt.EXTERIOR};Ce.computeLength=function(t){var e=t.size();if(e<=1)return 0;var n=0,r=new Lt;t.getCoordinate(0,r);for(var i=r.x,a=r.y,h=1;h<e;h++){t.getCoordinate(h,r);var u=r.x,_=r.y,w=u-i,C=_-a;n+=Math.sqrt(w*w+C*C),i=u,a=_}return n};Ce.isCCW=function(t){var e=t.length-1;if(e<3)throw new Yr("Ring has fewer than 4 points, so orientation cannot be determined");for(var n=t[0],r=0,i=1;i<=e;i++){var a=t[i];a.y>n.y&&(n=a,r=i)}var h=r;do h=h-1,h<0&&(h=e);while(t[h].equals2D(n)&&h!==r);var u=r;do u=(u+1)%e;while(t[u].equals2D(n)&&u!==r);var _=t[h],w=t[u];if(_.equals2D(n)||w.equals2D(n)||_.equals2D(w))return!1;var C=Ce.computeOrientation(_,n,w),P=!1;return C===0?P=_.x>w.x:P=C>0,P};Ce.locatePointInRing=function(t,e){return ql.locatePointInRing(t,e)};Ce.distancePointLinePerpendicular=function(t,e,n){var r=(n.x-e.x)*(n.x-e.x)+(n.y-e.y)*(n.y-e.y),i=((e.y-t.y)*(n.x-e.x)-(e.x-t.x)*(n.y-e.y))/r;return Math.abs(i)*Math.sqrt(r)};Ce.computeOrientation=function(t,e,n){return Ce.orientationIndex(t,e,n)};Ce.distancePointLine=function(){if(arguments.length===2){var t=arguments[0],e=arguments[1];if(e.length===0)throw new Yr("Line array must contain at least one vertex");for(var n=t.distance(e[0]),r=0;r<e.length-1;r++){var i=Ce.distancePointLine(t,e[r],e[r+1]);i<n&&(n=i)}return n}else if(arguments.length===3){var a=arguments[0],h=arguments[1],u=arguments[2];if(h.x===u.x&&h.y===u.y)return a.distance(h);var _=(u.x-h.x)*(u.x-h.x)+(u.y-h.y)*(u.y-h.y),w=((a.x-h.x)*(u.x-h.x)+(a.y-h.y)*(u.y-h.y))/_;if(w<=0)return a.distance(h);if(w>=1)return a.distance(u);var C=((h.y-a.y)*(u.x-h.x)-(h.x-a.x)*(u.y-h.y))/_;return Math.abs(C)*Math.sqrt(_)}};Ce.isOnLine=function(t,e){for(var n=new cd,r=1;r<e.length;r++){var i=e[r-1],a=e[r];if(n.computeIntersection(t,i,a),n.hasIntersection())return!0}return!1};gg.CLOCKWISE.get=function(){return-1};gg.RIGHT.get=function(){return Ce.CLOCKWISE};gg.COUNTERCLOCKWISE.get=function(){return 1};gg.LEFT.get=function(){return Ce.COUNTERCLOCKWISE};gg.COLLINEAR.get=function(){return 0};gg.STRAIGHT.get=function(){return Ce.COLLINEAR};Object.defineProperties(Ce,gg);var kh=function(){};kh.prototype.filter=function(t){};kh.prototype.interfaces_=function(){return[]};kh.prototype.getClass=function(){return kh};var Je=function(){var t=arguments[0];this._envelope=null,this._factory=null,this._SRID=null,this._userData=null,this._factory=t,this._SRID=t.getSRID()},nh={serialVersionUID:{configurable:!0},SORTINDEX_POINT:{configurable:!0},SORTINDEX_MULTIPOINT:{configurable:!0},SORTINDEX_LINESTRING:{configurable:!0},SORTINDEX_LINEARRING:{configurable:!0},SORTINDEX_MULTILINESTRING:{configurable:!0},SORTINDEX_POLYGON:{configurable:!0},SORTINDEX_MULTIPOLYGON:{configurable:!0},SORTINDEX_GEOMETRYCOLLECTION:{configurable:!0},geometryChangedFilter:{configurable:!0}};Je.prototype.isGeometryCollection=function(){return this.getSortIndex()===Je.SORTINDEX_GEOMETRYCOLLECTION};Je.prototype.getFactory=function(){return this._factory};Je.prototype.getGeometryN=function(t){return this};Je.prototype.getArea=function(){return 0};Je.prototype.isRectangle=function(){return!1};Je.prototype.equals=function(){if(arguments[0]instanceof Je){var t=arguments[0];return t===null?!1:this.equalsTopo(t)}else if(arguments[0]instanceof Object){var e=arguments[0];if(!(e instanceof Je))return!1;var n=e;return this.equalsExact(n)}};Je.prototype.equalsExact=function(t){return this===t||this.equalsExact(t,0)};Je.prototype.geometryChanged=function(){this.apply(Je.geometryChangedFilter)};Je.prototype.geometryChangedAction=function(){this._envelope=null};Je.prototype.equalsNorm=function(t){return t===null?!1:this.norm().equalsExact(t.norm())};Je.prototype.getLength=function(){return 0};Je.prototype.getNumGeometries=function(){return 1};Je.prototype.compareTo=function(){if(arguments.length===1){var t=arguments[0],e=t;return this.getSortIndex()!==e.getSortIndex()?this.getSortIndex()-e.getSortIndex():this.isEmpty()&&e.isEmpty()?0:this.isEmpty()?-1:e.isEmpty()?1:this.compareToSameClass(t)}else if(arguments.length===2){var n=arguments[0],r=arguments[1];return this.getSortIndex()!==n.getSortIndex()?this.getSortIndex()-n.getSortIndex():this.isEmpty()&&n.isEmpty()?0:this.isEmpty()?-1:n.isEmpty()?1:this.compareToSameClass(n,r)}};Je.prototype.getUserData=function(){return this._userData};Je.prototype.getSRID=function(){return this._SRID};Je.prototype.getEnvelope=function(){return this.getFactory().toGeometry(this.getEnvelopeInternal())};Je.prototype.checkNotGeometryCollection=function(t){if(t.getSortIndex()===Je.SORTINDEX_GEOMETRYCOLLECTION)throw new Yr("This method does not support GeometryCollection arguments")};Je.prototype.equal=function(t,e,n){return n===0?t.equals(e):t.distance(e)<=n};Je.prototype.norm=function(){var t=this.copy();return t.normalize(),t};Je.prototype.getPrecisionModel=function(){return this._factory.getPrecisionModel()};Je.prototype.getEnvelopeInternal=function(){return this._envelope===null&&(this._envelope=this.computeEnvelopeInternal()),new $e(this._envelope)};Je.prototype.setSRID=function(t){this._SRID=t};Je.prototype.setUserData=function(t){this._userData=t};Je.prototype.compare=function(t,e){for(var n=t.iterator(),r=e.iterator();n.hasNext()&&r.hasNext();){var i=n.next(),a=r.next(),h=i.compareTo(a);if(h!==0)return h}return n.hasNext()?1:r.hasNext()?-1:0};Je.prototype.hashCode=function(){return this.getEnvelopeInternal().hashCode()};Je.prototype.isGeometryCollectionOrDerived=function(){return this.getSortIndex()===Je.SORTINDEX_GEOMETRYCOLLECTION||this.getSortIndex()===Je.SORTINDEX_MULTIPOINT||this.getSortIndex()===Je.SORTINDEX_MULTILINESTRING||this.getSortIndex()===Je.SORTINDEX_MULTIPOLYGON};Je.prototype.interfaces_=function(){return[w0,Pu,Mu]};Je.prototype.getClass=function(){return Je};Je.hasNonEmptyElements=function(t){for(var e=0;e<t.length;e++)if(!t[e].isEmpty())return!0;return!1};Je.hasNullElements=function(t){for(var e=0;e<t.length;e++)if(t[e]===null)return!0;return!1};nh.serialVersionUID.get=function(){return 8763622679187377e3};nh.SORTINDEX_POINT.get=function(){return 0};nh.SORTINDEX_MULTIPOINT.get=function(){return 1};nh.SORTINDEX_LINESTRING.get=function(){return 2};nh.SORTINDEX_LINEARRING.get=function(){return 3};nh.SORTINDEX_MULTILINESTRING.get=function(){return 4};nh.SORTINDEX_POLYGON.get=function(){return 5};nh.SORTINDEX_MULTIPOLYGON.get=function(){return 6};nh.SORTINDEX_GEOMETRYCOLLECTION.get=function(){return 7};nh.geometryChangedFilter.get=function(){return tw};Object.defineProperties(Je,nh);var tw=function(){};tw.interfaces_=function(){return[kh]};tw.filter=function(t){t.geometryChangedAction()};var Xc=function(){};Xc.prototype.filter=function(t){};Xc.prototype.interfaces_=function(){return[]};Xc.prototype.getClass=function(){return Xc};var Iu=function(){},qh={Mod2BoundaryNodeRule:{configurable:!0},EndPointBoundaryNodeRule:{configurable:!0},MultiValentEndPointBoundaryNodeRule:{configurable:!0},MonoValentEndPointBoundaryNodeRule:{configurable:!0},MOD2_BOUNDARY_RULE:{configurable:!0},ENDPOINT_BOUNDARY_RULE:{configurable:!0},MULTIVALENT_ENDPOINT_BOUNDARY_RULE:{configurable:!0},MONOVALENT_ENDPOINT_BOUNDARY_RULE:{configurable:!0},OGC_SFS_BOUNDARY_RULE:{configurable:!0}};Iu.prototype.isInBoundary=function(t){};Iu.prototype.interfaces_=function(){return[]};Iu.prototype.getClass=function(){return Iu};qh.Mod2BoundaryNodeRule.get=function(){return dm};qh.EndPointBoundaryNodeRule.get=function(){return gm};qh.MultiValentEndPointBoundaryNodeRule.get=function(){return mm};qh.MonoValentEndPointBoundaryNodeRule.get=function(){return ym};qh.MOD2_BOUNDARY_RULE.get=function(){return new dm};qh.ENDPOINT_BOUNDARY_RULE.get=function(){return new gm};qh.MULTIVALENT_ENDPOINT_BOUNDARY_RULE.get=function(){return new mm};qh.MONOVALENT_ENDPOINT_BOUNDARY_RULE.get=function(){return new ym};qh.OGC_SFS_BOUNDARY_RULE.get=function(){return Iu.MOD2_BOUNDARY_RULE};Object.defineProperties(Iu,qh);var dm=function(){};dm.prototype.isInBoundary=function(t){return t%2===1};dm.prototype.interfaces_=function(){return[Iu]};dm.prototype.getClass=function(){return dm};var gm=function(){};gm.prototype.isInBoundary=function(t){return t>0};gm.prototype.interfaces_=function(){return[Iu]};gm.prototype.getClass=function(){return gm};var mm=function(){};mm.prototype.isInBoundary=function(t){return t>1};mm.prototype.interfaces_=function(){return[Iu]};mm.prototype.getClass=function(){return mm};var ym=function(){};ym.prototype.isInBoundary=function(t){return t===1};ym.prototype.interfaces_=function(){return[Iu]};ym.prototype.getClass=function(){return ym};var Hi=function(){};Hi.prototype.add=function(){};Hi.prototype.addAll=function(){};Hi.prototype.isEmpty=function(){};Hi.prototype.iterator=function(){};Hi.prototype.size=function(){};Hi.prototype.toArray=function(){};Hi.prototype.remove=function(){};function ew(t){this.message=t||""}ew.prototype=new Error;ew.prototype.name="IndexOutOfBoundsException";var Vm=function(){};Vm.prototype.hasNext=function(){};Vm.prototype.next=function(){};Vm.prototype.remove=function(){};var Yu=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.get=function(){},e.prototype.set=function(){},e.prototype.isEmpty=function(){},e}(Hi);function Um(t){this.message=t||""}Um.prototype=new Error;Um.prototype.name="NoSuchElementException";var de=function(t){function e(){t.call(this),this.array_=[],arguments[0]instanceof Hi&&this.addAll(arguments[0])}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.ensureCapacity=function(){},e.prototype.interfaces_=function(){return[t,Hi]},e.prototype.add=function(n){return arguments.length===1?this.array_.push(n):this.array_.splice(arguments[0],arguments[1]),!0},e.prototype.clear=function(){this.array_=[]},e.prototype.addAll=function(n){for(var r=this,i=n.iterator();i.hasNext();)r.add(i.next());return!0},e.prototype.set=function(n,r){var i=this.array_[n];return this.array_[n]=r,i},e.prototype.iterator=function(){return new PO(this)},e.prototype.get=function(n){if(n<0||n>=this.size())throw new ew;return this.array_[n]},e.prototype.isEmpty=function(){return this.array_.length===0},e.prototype.size=function(){return this.array_.length},e.prototype.toArray=function(){for(var n=this,r=[],i=0,a=this.array_.length;i<a;i++)r.push(n.array_[i]);return r},e.prototype.remove=function(n){for(var r=this,i=!1,a=0,h=this.array_.length;a<h;a++)if(r.array_[a]===n){r.array_.splice(a,1),i=!0;break}return i},e}(Yu),PO=function(t){function e(n){t.call(this),this.arrayList_=n,this.position_=0}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.next=function(){if(this.position_===this.arrayList_.size())throw new Um;return this.arrayList_.get(this.position_++)},e.prototype.hasNext=function(){return this.position_<this.arrayList_.size()},e.prototype.set=function(n){return this.arrayList_.set(this.position_-1,n)},e.prototype.remove=function(){this.arrayList_.remove(this.arrayList_.get(this.position_))},e}(Vm),A_=function(t){function e(){if(t.call(this),arguments.length!==0){if(arguments.length===1){var r=arguments[0];this.ensureCapacity(r.length),this.add(r,!0)}else if(arguments.length===2){var i=arguments[0],a=arguments[1];this.ensureCapacity(i.length),this.add(i,a)}}}t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e;var n={coordArrayType:{configurable:!0}};return n.coordArrayType.get=function(){return new Array(0).fill(null)},e.prototype.getCoordinate=function(r){return this.get(r)},e.prototype.addAll=function(){var r=this;if(arguments.length===2){for(var i=arguments[0],a=arguments[1],h=!1,u=i.iterator();u.hasNext();)r.add(u.next(),a),h=!0;return h}else return t.prototype.addAll.apply(this,arguments)},e.prototype.clone=function(){for(var r=this,i=t.prototype.clone.call(this),a=0;a<this.size();a++)i.add(a,r.get(a).copy());return i},e.prototype.toCoordinateArray=function(){return this.toArray(e.coordArrayType)},e.prototype.add=function(){var r=this;if(arguments.length===1){var i=arguments[0];t.prototype.add.call(this,i)}else if(arguments.length===2){if(arguments[0]instanceof Array&&typeof arguments[1]=="boolean"){var a=arguments[0],h=arguments[1];return this.add(a,h,!0),!0}else if(arguments[0]instanceof Lt&&typeof arguments[1]=="boolean"){var u=arguments[0],_=arguments[1];if(!_&&this.size()>=1){var w=this.get(this.size()-1);if(w.equals2D(u))return null}t.prototype.add.call(this,u)}else if(arguments[0]instanceof Object&&typeof arguments[1]=="boolean"){var C=arguments[0],P=arguments[1];return this.add(C,P),!0}}else if(arguments.length===3){if(typeof arguments[2]=="boolean"&&arguments[0]instanceof Array&&typeof arguments[1]=="boolean"){var D=arguments[0],B=arguments[1],$=arguments[2];if($)for(var Z=0;Z<D.length;Z++)r.add(D[Z],B);else for(var W=D.length-1;W>=0;W--)r.add(D[W],B);return!0}else if(typeof arguments[2]=="boolean"&&Number.isInteger(arguments[0])&&arguments[1]instanceof Lt){var rt=arguments[0],ct=arguments[1],pt=arguments[2];if(!pt){var gt=this.size();if(gt>0){if(rt>0){var Ut=this.get(rt-1);if(Ut.equals2D(ct))return null}if(rt<gt){var zt=this.get(rt);if(zt.equals2D(ct))return null}}}t.prototype.add.call(this,rt,ct)}}else if(arguments.length===4){var Ot=arguments[0],At=arguments[1],Rt=arguments[2],Yt=arguments[3],be=1;Rt>Yt&&(be=-1);for(var Kt=Rt;Kt!==Yt;Kt+=be)r.add(Ot[Kt],At);return!0}},e.prototype.closeRing=function(){this.size()>0&&this.add(new Lt(this.get(0)),!1)},e.prototype.interfaces_=function(){return[]},e.prototype.getClass=function(){return e},Object.defineProperties(e,n),e}(de),Sn=function(){},I0={ForwardComparator:{configurable:!0},BidirectionalComparator:{configurable:!0},coordArrayType:{configurable:!0}};I0.ForwardComparator.get=function(){return s_};I0.BidirectionalComparator.get=function(){return _m};I0.coordArrayType.get=function(){return new Array(0).fill(null)};Sn.prototype.interfaces_=function(){return[]};Sn.prototype.getClass=function(){return Sn};Sn.isRing=function(t){return!(t.length<4||!t[0].equals2D(t[t.length-1]))};Sn.ptNotInList=function(t,e){for(var n=0;n<t.length;n++){var r=t[n];if(Sn.indexOf(r,e)<0)return r}return null};Sn.scroll=function(t,e){var n=Sn.indexOf(e,t);if(n<0)return null;var r=new Array(t.length).fill(null);ko.arraycopy(t,n,r,0,t.length-n),ko.arraycopy(t,0,r,t.length-n,n),ko.arraycopy(r,0,t,0,t.length)};Sn.equals=function(){if(arguments.length===2){var t=arguments[0],e=arguments[1];if(t===e)return!0;if(t===null||e===null||t.length!==e.length)return!1;for(var n=0;n<t.length;n++)if(!t[n].equals(e[n]))return!1;return!0}else if(arguments.length===3){var r=arguments[0],i=arguments[1],a=arguments[2];if(r===i)return!0;if(r===null||i===null||r.length!==i.length)return!1;for(var h=0;h<r.length;h++)if(a.compare(r[h],i[h])!==0)return!1;return!0}};Sn.intersection=function(t,e){for(var n=new A_,r=0;r<t.length;r++)e.intersects(t[r])&&n.add(t[r],!0);return n.toCoordinateArray()};Sn.hasRepeatedPoints=function(t){for(var e=1;e<t.length;e++)if(t[e-1].equals(t[e]))return!0;return!1};Sn.removeRepeatedPoints=function(t){if(!Sn.hasRepeatedPoints(t))return t;var e=new A_(t,!1);return e.toCoordinateArray()};Sn.reverse=function(t){for(var e=t.length-1,n=Math.trunc(e/2),r=0;r<=n;r++){var i=t[r];t[r]=t[e-r],t[e-r]=i}};Sn.removeNull=function(t){for(var e=0,n=0;n<t.length;n++)t[n]!==null&&e++;var r=new Array(e).fill(null);if(e===0)return r;for(var i=0,a=0;a<t.length;a++)t[a]!==null&&(r[i++]=t[a]);return r};Sn.copyDeep=function(){if(arguments.length===1){for(var t=arguments[0],e=new Array(t.length).fill(null),n=0;n<t.length;n++)e[n]=new Lt(t[n]);return e}else if(arguments.length===5)for(var r=arguments[0],i=arguments[1],a=arguments[2],h=arguments[3],u=arguments[4],_=0;_<u;_++)a[h+_]=new Lt(r[i+_])};Sn.isEqualReversed=function(t,e){for(var n=0;n<t.length;n++){var r=t[n],i=e[t.length-n-1];if(r.compareTo(i)!==0)return!1}return!0};Sn.envelope=function(t){for(var e=new $e,n=0;n<t.length;n++)e.expandToInclude(t[n]);return e};Sn.toCoordinateArray=function(t){return t.toArray(Sn.coordArrayType)};Sn.atLeastNCoordinatesOrNothing=function(t,e){return e.length>=t?e:[]};Sn.indexOf=function(t,e){for(var n=0;n<e.length;n++)if(t.equals(e[n]))return n;return-1};Sn.increasingDirection=function(t){for(var e=0;e<Math.trunc(t.length/2);e++){var n=t.length-1-e,r=t[e].compareTo(t[n]);if(r!==0)return r}return 1};Sn.compare=function(t,e){for(var n=0;n<t.length&&n<e.length;){var r=t[n].compareTo(e[n]);if(r!==0)return r;n++}return n<e.length?-1:n<t.length?1:0};Sn.minCoordinate=function(t){for(var e=null,n=0;n<t.length;n++)(e===null||e.compareTo(t[n])>0)&&(e=t[n]);return e};Sn.extract=function(t,e,n){e=Qa.clamp(e,0,t.length),n=Qa.clamp(n,-1,t.length);var r=n-e+1;n<0&&(r=0),e>=t.length&&(r=0),n<e&&(r=0);var i=new Array(r).fill(null);if(r===0)return i;for(var a=0,h=e;h<=n;h++)i[a++]=t[h];return i};Object.defineProperties(Sn,I0);var s_=function(){};s_.prototype.compare=function(t,e){var n=t,r=e;return Sn.compare(n,r)};s_.prototype.interfaces_=function(){return[pm]};s_.prototype.getClass=function(){return s_};var _m=function(){};_m.prototype.compare=function(t,e){var n=t,r=e;if(n.length<r.length)return-1;if(n.length>r.length)return 1;if(n.length===0)return 0;var i=Sn.compare(n,r),a=Sn.isEqualReversed(n,r);return a?0:i};_m.prototype.OLDcompare=function(t,e){var n=t,r=e;if(n.length<r.length)return-1;if(n.length>r.length)return 1;if(n.length===0)return 0;for(var i=Sn.increasingDirection(n),a=Sn.increasingDirection(r),h=i>0?0:n.length-1,u=a>0?0:n.length-1,_=0;_<n.length;_++){var w=n[h].compareTo(r[u]);if(w!==0)return w;h+=i,u+=a}return 0};_m.prototype.interfaces_=function(){return[pm]};_m.prototype.getClass=function(){return _m};var mg=function(){};mg.prototype.get=function(){};mg.prototype.put=function(){};mg.prototype.size=function(){};mg.prototype.values=function(){};mg.prototype.entrySet=function(){};var MO=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e}(mg);function D_(t){this.message=t||""}D_.prototype=new Error;D_.prototype.name="OperationNotSupported";function S0(){}S0.prototype=new Hi;S0.prototype.contains=function(){};var nw=function(t){function e(){t.call(this),this.array_=[],arguments[0]instanceof Hi&&this.addAll(arguments[0])}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.contains=function(n){for(var r=this,i=0,a=this.array_.length;i<a;i++){var h=r.array_[i];if(h===n)return!0}return!1},e.prototype.add=function(n){return this.contains(n)?!1:(this.array_.push(n),!0)},e.prototype.addAll=function(n){for(var r=this,i=n.iterator();i.hasNext();)r.add(i.next());return!0},e.prototype.remove=function(n){throw new Error},e.prototype.size=function(){return this.array_.length},e.prototype.isEmpty=function(){return this.array_.length===0},e.prototype.toArray=function(){for(var n=this,r=[],i=0,a=this.array_.length;i<a;i++)r.push(n.array_[i]);return r},e.prototype.iterator=function(){return new AO(this)},e}(S0),AO=function(t){function e(n){t.call(this),this.hashSet_=n,this.position_=0}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.next=function(){if(this.position_===this.hashSet_.size())throw new Um;return this.hashSet_.array_[this.position_++]},e.prototype.hasNext=function(){return this.position_<this.hashSet_.size()},e.prototype.remove=function(){throw new D_},e}(Vm),Sh=0,Nf=1;function xI(t){return t===null?Sh:t.color}function Cr(t){return t===null?null:t.parent}function _h(t,e){t!==null&&(t.color=e)}function Fx(t){return t===null?null:t.left}function bI(t){return t===null?null:t.right}function ns(){this.root_=null,this.size_=0}ns.prototype=new MO;ns.prototype.get=function(t){for(var e=this.root_;e!==null;){var n=t.compareTo(e.key);if(n<0)e=e.left;else if(n>0)e=e.right;else return e.value}return null};ns.prototype.put=function(t,e){if(this.root_===null)return this.root_={key:t,value:e,left:null,right:null,parent:null,color:Sh,getValue:function(){return this.value},getKey:function(){return this.key}},this.size_=1,null;var n=this.root_,r,i;do if(r=n,i=t.compareTo(n.key),i<0)n=n.left;else if(i>0)n=n.right;else{var a=n.value;return n.value=e,a}while(n!==null);var h={key:t,left:null,right:null,value:e,parent:r,color:Sh,getValue:function(){return this.value},getKey:function(){return this.key}};return i<0?r.left=h:r.right=h,this.fixAfterInsertion(h),this.size_++,null};ns.prototype.fixAfterInsertion=function(t){var e=this;for(t.color=Nf;t!=null&&t!==this.root_&&t.parent.color===Nf;)if(Cr(t)===Fx(Cr(Cr(t)))){var n=bI(Cr(Cr(t)));xI(n)===Nf?(_h(Cr(t),Sh),_h(n,Sh),_h(Cr(Cr(t)),Nf),t=Cr(Cr(t))):(t===bI(Cr(t))&&(t=Cr(t),e.rotateLeft(t)),_h(Cr(t),Sh),_h(Cr(Cr(t)),Nf),e.rotateRight(Cr(Cr(t))))}else{var r=Fx(Cr(Cr(t)));xI(r)===Nf?(_h(Cr(t),Sh),_h(r,Sh),_h(Cr(Cr(t)),Nf),t=Cr(Cr(t))):(t===Fx(Cr(t))&&(t=Cr(t),e.rotateRight(t)),_h(Cr(t),Sh),_h(Cr(Cr(t)),Nf),e.rotateLeft(Cr(Cr(t))))}this.root_.color=Sh};ns.prototype.values=function(){var t=new de,e=this.getFirstEntry();if(e!==null)for(t.add(e.value);(e=ns.successor(e))!==null;)t.add(e.value);return t};ns.prototype.entrySet=function(){var t=new nw,e=this.getFirstEntry();if(e!==null)for(t.add(e);(e=ns.successor(e))!==null;)t.add(e);return t};ns.prototype.rotateLeft=function(t){if(t!=null){var e=t.right;t.right=e.left,e.left!=null&&(e.left.parent=t),e.parent=t.parent,t.parent===null?this.root_=e:t.parent.left===t?t.parent.left=e:t.parent.right=e,e.left=t,t.parent=e}};ns.prototype.rotateRight=function(t){if(t!=null){var e=t.left;t.left=e.right,e.right!=null&&(e.right.parent=t),e.parent=t.parent,t.parent===null?this.root_=e:t.parent.right===t?t.parent.right=e:t.parent.left=e,e.right=t,t.parent=e}};ns.prototype.getFirstEntry=function(){var t=this.root_;if(t!=null)for(;t.left!=null;)t=t.left;return t};ns.successor=function(t){if(t===null)return null;if(t.right!==null){for(var e=t.right;e.left!==null;)e=e.left;return e}else{for(var n=t.parent,r=t;n!==null&&r===n.right;)r=n,n=n.parent;return n}};ns.prototype.size=function(){return this.size_};var a_=function(){};a_.prototype.interfaces_=function(){return[]};a_.prototype.getClass=function(){return a_};function eT(){}eT.prototype=new S0;function rc(){this.array_=[],arguments[0]instanceof Hi&&this.addAll(arguments[0])}rc.prototype=new eT;rc.prototype.contains=function(t){for(var e=this,n=0,r=this.array_.length;n<r;n++){var i=e.array_[n];if(i.compareTo(t)===0)return!0}return!1};rc.prototype.add=function(t){var e=this;if(this.contains(t))return!1;for(var n=0,r=this.array_.length;n<r;n++){var i=e.array_[n];if(i.compareTo(t)===1)return e.array_.splice(n,0,t),!0}return this.array_.push(t),!0};rc.prototype.addAll=function(t){for(var e=this,n=t.iterator();n.hasNext();)e.add(n.next());return!0};rc.prototype.remove=function(t){throw new D_};rc.prototype.size=function(){return this.array_.length};rc.prototype.isEmpty=function(){return this.array_.length===0};rc.prototype.toArray=function(){for(var t=this,e=[],n=0,r=this.array_.length;n<r;n++)e.push(t.array_[n]);return e};rc.prototype.iterator=function(){return new C0(this)};var C0=function(t){this.treeSet_=t,this.position_=0};C0.prototype.next=function(){if(this.position_===this.treeSet_.size())throw new Um;return this.treeSet_.array_[this.position_++]};C0.prototype.hasNext=function(){return this.position_<this.treeSet_.size()};C0.prototype.remove=function(){throw new D_};var Rf=function(){};Rf.sort=function(){var t=arguments[0],e,n,r,i;if(arguments.length===1)i=function(h,u){return h.compareTo(u)},t.sort(i);else if(arguments.length===2)r=arguments[1],i=function(h,u){return r.compare(h,u)},t.sort(i);else if(arguments.length===3){n=t.slice(arguments[1],arguments[2]),n.sort();var a=t.slice(0,arguments[1]).concat(n,t.slice(arguments[2],t.length));for(t.splice(0,t.length),e=0;e<a.length;e++)t.push(a[e])}else if(arguments.length===4)for(n=t.slice(arguments[1],arguments[2]),r=arguments[3],i=function(h,u){return r.compare(h,u)},n.sort(i),a=t.slice(0,arguments[1]).concat(n,t.slice(arguments[2],t.length)),t.splice(0,t.length),e=0;e<a.length;e++)t.push(a[e])};Rf.asList=function(t){for(var e=new de,n=0,r=t.length;n<r;n++)e.add(t[n]);return e};var Wn=function(){},pl={P:{configurable:!0},L:{configurable:!0},A:{configurable:!0},FALSE:{configurable:!0},TRUE:{configurable:!0},DONTCARE:{configurable:!0},SYM_FALSE:{configurable:!0},SYM_TRUE:{configurable:!0},SYM_DONTCARE:{configurable:!0},SYM_P:{configurable:!0},SYM_L:{configurable:!0},SYM_A:{configurable:!0}};pl.P.get=function(){return 0};pl.L.get=function(){return 1};pl.A.get=function(){return 2};pl.FALSE.get=function(){return-1};pl.TRUE.get=function(){return-2};pl.DONTCARE.get=function(){return-3};pl.SYM_FALSE.get=function(){return"F"};pl.SYM_TRUE.get=function(){return"T"};pl.SYM_DONTCARE.get=function(){return"*"};pl.SYM_P.get=function(){return"0"};pl.SYM_L.get=function(){return"1"};pl.SYM_A.get=function(){return"2"};Wn.prototype.interfaces_=function(){return[]};Wn.prototype.getClass=function(){return Wn};Wn.toDimensionSymbol=function(t){switch(t){case Wn.FALSE:return Wn.SYM_FALSE;case Wn.TRUE:return Wn.SYM_TRUE;case Wn.DONTCARE:return Wn.SYM_DONTCARE;case Wn.P:return Wn.SYM_P;case Wn.L:return Wn.SYM_L;case Wn.A:return Wn.SYM_A}throw new Yr("Unknown dimension value: "+t)};Wn.toDimensionValue=function(t){switch(o_.toUpperCase(t)){case Wn.SYM_FALSE:return Wn.FALSE;case Wn.SYM_TRUE:return Wn.TRUE;case Wn.SYM_DONTCARE:return Wn.DONTCARE;case Wn.SYM_P:return Wn.P;case Wn.SYM_L:return Wn.L;case Wn.SYM_A:return Wn.A}throw new Yr("Unknown dimension symbol: "+t)};Object.defineProperties(Wn,pl);var ic=function(){};ic.prototype.filter=function(t){};ic.prototype.interfaces_=function(){return[]};ic.prototype.getClass=function(){return ic};var nl=function(){};nl.prototype.filter=function(t,e){};nl.prototype.isDone=function(){};nl.prototype.isGeometryChanged=function(){};nl.prototype.interfaces_=function(){return[]};nl.prototype.getClass=function(){return nl};var Ds=function(t){function e(r,i){if(t.call(this,i),this._geometries=r||[],t.hasNullElements(this._geometries))throw new Yr("geometries must not contain null elements")}t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e;var n={serialVersionUID:{configurable:!0}};return e.prototype.computeEnvelopeInternal=function(){for(var r=this,i=new $e,a=0;a<this._geometries.length;a++)i.expandToInclude(r._geometries[a].getEnvelopeInternal());return i},e.prototype.getGeometryN=function(r){return this._geometries[r]},e.prototype.getSortIndex=function(){return t.SORTINDEX_GEOMETRYCOLLECTION},e.prototype.getCoordinates=function(){for(var r=this,i=new Array(this.getNumPoints()).fill(null),a=-1,h=0;h<this._geometries.length;h++)for(var u=r._geometries[h].getCoordinates(),_=0;_<u.length;_++)a++,i[a]=u[_];return i},e.prototype.getArea=function(){for(var r=this,i=0,a=0;a<this._geometries.length;a++)i+=r._geometries[a].getArea();return i},e.prototype.equalsExact=function(){var r=this;if(arguments.length===2){var i=arguments[0],a=arguments[1];if(!this.isEquivalentClass(i))return!1;var h=i;if(this._geometries.length!==h._geometries.length)return!1;for(var u=0;u<this._geometries.length;u++)if(!r._geometries[u].equalsExact(h._geometries[u],a))return!1;return!0}else return t.prototype.equalsExact.apply(this,arguments)},e.prototype.normalize=function(){for(var r=this,i=0;i<this._geometries.length;i++)r._geometries[i].normalize();Rf.sort(this._geometries)},e.prototype.getCoordinate=function(){return this.isEmpty()?null:this._geometries[0].getCoordinate()},e.prototype.getBoundaryDimension=function(){for(var r=this,i=Wn.FALSE,a=0;a<this._geometries.length;a++)i=Math.max(i,r._geometries[a].getBoundaryDimension());return i},e.prototype.getDimension=function(){for(var r=this,i=Wn.FALSE,a=0;a<this._geometries.length;a++)i=Math.max(i,r._geometries[a].getDimension());return i},e.prototype.getLength=function(){for(var r=this,i=0,a=0;a<this._geometries.length;a++)i+=r._geometries[a].getLength();return i},e.prototype.getNumPoints=function(){for(var r=this,i=0,a=0;a<this._geometries.length;a++)i+=r._geometries[a].getNumPoints();return i},e.prototype.getNumGeometries=function(){return this._geometries.length},e.prototype.reverse=function(){for(var r=this,i=this._geometries.length,a=new Array(i).fill(null),h=0;h<this._geometries.length;h++)a[h]=r._geometries[h].reverse();return this.getFactory().createGeometryCollection(a)},e.prototype.compareToSameClass=function(){var r=this;if(arguments.length===1){var i=arguments[0],a=new rc(Rf.asList(this._geometries)),h=new rc(Rf.asList(i._geometries));return this.compare(a,h)}else if(arguments.length===2){for(var u=arguments[0],_=arguments[1],w=u,C=this.getNumGeometries(),P=w.getNumGeometries(),D=0;D<C&&D<P;){var B=r.getGeometryN(D),$=w.getGeometryN(D),Z=B.compareToSameClass($,_);if(Z!==0)return Z;D++}return D<C?1:D<P?-1:0}},e.prototype.apply=function(){var r=this;if(en(arguments[0],Xc))for(var i=arguments[0],a=0;a<this._geometries.length;a++)r._geometries[a].apply(i);else if(en(arguments[0],nl)){var h=arguments[0];if(this._geometries.length===0)return null;for(var u=0;u<this._geometries.length&&(r._geometries[u].apply(h),!h.isDone());u++);h.isGeometryChanged()&&this.geometryChanged()}else if(en(arguments[0],ic)){var _=arguments[0];_.filter(this);for(var w=0;w<this._geometries.length;w++)r._geometries[w].apply(_)}else if(en(arguments[0],kh)){var C=arguments[0];C.filter(this);for(var P=0;P<this._geometries.length;P++)r._geometries[P].apply(C)}},e.prototype.getBoundary=function(){return this.checkNotGeometryCollection(this),dn.shouldNeverReachHere(),null},e.prototype.clone=function(){var r=this,i=t.prototype.clone.call(this);i._geometries=new Array(this._geometries.length).fill(null);for(var a=0;a<this._geometries.length;a++)i._geometries[a]=r._geometries[a].clone();return i},e.prototype.getGeometryType=function(){return"GeometryCollection"},e.prototype.copy=function(){for(var r=this,i=new Array(this._geometries.length).fill(null),a=0;a<i.length;a++)i[a]=r._geometries[a].copy();return new e(i,this._factory)},e.prototype.isEmpty=function(){for(var r=this,i=0;i<this._geometries.length;i++)if(!r._geometries[i].isEmpty())return!1;return!0},e.prototype.interfaces_=function(){return[]},e.prototype.getClass=function(){return e},n.serialVersionUID.get=function(){return-5694727726395021e3},Object.defineProperties(e,n),e}(Je),Hf=function(t){function e(){t.apply(this,arguments)}t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e;var n={serialVersionUID:{configurable:!0}};return e.prototype.getSortIndex=function(){return Je.SORTINDEX_MULTILINESTRING},e.prototype.equalsExact=function(){if(arguments.length===2){var r=arguments[0],i=arguments[1];return this.isEquivalentClass(r)?t.prototype.equalsExact.call(this,r,i):!1}else return t.prototype.equalsExact.apply(this,arguments)},e.prototype.getBoundaryDimension=function(){return this.isClosed()?Wn.FALSE:0},e.prototype.isClosed=function(){var r=this;if(this.isEmpty())return!1;for(var i=0;i<this._geometries.length;i++)if(!r._geometries[i].isClosed())return!1;return!0},e.prototype.getDimension=function(){return 1},e.prototype.reverse=function(){for(var r=this,i=this._geometries.length,a=new Array(i).fill(null),h=0;h<this._geometries.length;h++)a[i-1-h]=r._geometries[h].reverse();return this.getFactory().createMultiLineString(a)},e.prototype.getBoundary=function(){return new mu(this).getBoundary()},e.prototype.getGeometryType=function(){return"MultiLineString"},e.prototype.copy=function(){for(var r=this,i=new Array(this._geometries.length).fill(null),a=0;a<i.length;a++)i[a]=r._geometries[a].copy();return new e(i,this._factory)},e.prototype.interfaces_=function(){return[a_]},e.prototype.getClass=function(){return e},n.serialVersionUID.get=function(){return 8166665132445434e3},Object.defineProperties(e,n),e}(Ds),mu=function(){if(this._geom=null,this._geomFact=null,this._bnRule=null,this._endpointMap=null,arguments.length===1){var t=arguments[0],e=Iu.MOD2_BOUNDARY_RULE;this._geom=t,this._geomFact=t.getFactory(),this._bnRule=e}else if(arguments.length===2){var n=arguments[0],r=arguments[1];this._geom=n,this._geomFact=n.getFactory(),this._bnRule=r}};mu.prototype.boundaryMultiLineString=function(t){if(this._geom.isEmpty())return this.getEmptyMultiPoint();var e=this.computeBoundaryCoordinates(t);return e.length===1?this._geomFact.createPoint(e[0]):this._geomFact.createMultiPointFromCoords(e)};mu.prototype.getBoundary=function(){return this._geom instanceof ai?this.boundaryLineString(this._geom):this._geom instanceof Hf?this.boundaryMultiLineString(this._geom):this._geom.getBoundary()};mu.prototype.boundaryLineString=function(t){if(this._geom.isEmpty())return this.getEmptyMultiPoint();if(t.isClosed()){var e=this._bnRule.isInBoundary(2);return e?t.getStartPoint():this._geomFact.createMultiPoint()}return this._geomFact.createMultiPoint([t.getStartPoint(),t.getEndPoint()])};mu.prototype.getEmptyMultiPoint=function(){return this._geomFact.createMultiPoint()};mu.prototype.computeBoundaryCoordinates=function(t){var e=this,n=new de;this._endpointMap=new ns;for(var r=0;r<t.getNumGeometries();r++){var i=t.getGeometryN(r);i.getNumPoints()!==0&&(e.addEndpoint(i.getCoordinateN(0)),e.addEndpoint(i.getCoordinateN(i.getNumPoints()-1)))}for(var a=this._endpointMap.entrySet().iterator();a.hasNext();){var h=a.next(),u=h.getValue(),_=u.count;e._bnRule.isInBoundary(_)&&n.add(h.getKey())}return Sn.toCoordinateArray(n)};mu.prototype.addEndpoint=function(t){var e=this._endpointMap.get(t);e===null&&(e=new Wv,this._endpointMap.put(t,e)),e.count++};mu.prototype.interfaces_=function(){return[]};mu.prototype.getClass=function(){return mu};mu.getBoundary=function(){if(arguments.length===1){var t=arguments[0],e=new mu(t);return e.getBoundary()}else if(arguments.length===2){var n=arguments[0],r=arguments[1],i=new mu(n,r);return i.getBoundary()}};var Wv=function(){this.count=null};Wv.prototype.interfaces_=function(){return[]};Wv.prototype.getClass=function(){return Wv};function DO(){}function OO(){}var RO=function(){};function FO(){}function kO(){}function zO(){}var yu=function(){},rw={NEWLINE:{configurable:!0},SIMPLE_ORDINATE_FORMAT:{configurable:!0}};yu.prototype.interfaces_=function(){return[]};yu.prototype.getClass=function(){return yu};yu.chars=function(t,e){for(var n=new Array(e).fill(null),r=0;r<e;r++)n[r]=t;return String(n)};yu.getStackTrace=function(){if(arguments.length===1){var t=arguments[0],e=new FO,n=new DO;return t.printStackTrace(n),e.toString()}else if(arguments.length===2){var r=arguments[0],i=arguments[1],a="";new OO(yu.getStackTrace(r));for(var h=new zO,u=0;u<i;u++)try{a+=h.readLine()+yu.NEWLINE}catch(_){if(_ instanceof kO)dn.shouldNeverReachHere();else throw _}finally{}return a}};yu.split=function(t,e){for(var n=e.length,r=new de,i=""+t,a=i.indexOf(e);a>=0;){var h=i.substring(0,a);r.add(h),i=i.substring(a+n),a=i.indexOf(e)}i.length>0&&r.add(i);for(var u=new Array(r.size()).fill(null),_=0;_<u.length;_++)u[_]=r.get(_);return u};yu.toString=function(){if(arguments.length===1){var t=arguments[0];return yu.SIMPLE_ORDINATE_FORMAT.format(t)}};yu.spaces=function(t){return yu.chars(" ",t)};rw.NEWLINE.get=function(){return ko.getProperty("line.separator")};rw.SIMPLE_ORDINATE_FORMAT.get=function(){return new RO};Object.defineProperties(yu,rw);var wi=function(){};wi.prototype.interfaces_=function(){return[]};wi.prototype.getClass=function(){return wi};wi.copyCoord=function(t,e,n,r){for(var i=Math.min(t.getDimension(),n.getDimension()),a=0;a<i;a++)n.setOrdinate(r,a,t.getOrdinate(e,a))};wi.isRing=function(t){var e=t.size();return e===0?!0:e<=3?!1:t.getOrdinate(0,Bn.X)===t.getOrdinate(e-1,Bn.X)&&t.getOrdinate(0,Bn.Y)===t.getOrdinate(e-1,Bn.Y)};wi.isEqual=function(t,e){var n=t.size(),r=e.size();if(n!==r)return!1;for(var i=Math.min(t.getDimension(),e.getDimension()),a=0;a<n;a++)for(var h=0;h<i;h++){var u=t.getOrdinate(a,h),_=e.getOrdinate(a,h);if(t.getOrdinate(a,h)!==e.getOrdinate(a,h)&&!(ln.isNaN(u)&&ln.isNaN(_)))return!1}return!0};wi.extend=function(t,e,n){var r=t.create(n,e.getDimension()),i=e.size();if(wi.copy(e,0,r,0,i),i>0)for(var a=i;a<n;a++)wi.copy(e,i-1,r,a,1);return r};wi.reverse=function(t){for(var e=t.size()-1,n=Math.trunc(e/2),r=0;r<=n;r++)wi.swap(t,r,e-r)};wi.swap=function(t,e,n){if(e===n)return null;for(var r=0;r<t.getDimension();r++){var i=t.getOrdinate(e,r);t.setOrdinate(e,r,t.getOrdinate(n,r)),t.setOrdinate(n,r,i)}};wi.copy=function(t,e,n,r,i){for(var a=0;a<i;a++)wi.copyCoord(t,e+a,n,r+a)};wi.toString=function(){if(arguments.length===1){var t=arguments[0],e=t.size();if(e===0)return"()";var n=t.getDimension(),r=new gc;r.append("(");for(var i=0;i<e;i++){i>0&&r.append(" ");for(var a=0;a<n;a++)a>0&&r.append(","),r.append(yu.toString(t.getOrdinate(i,a)))}return r.append(")"),r.toString()}};wi.ensureValidRing=function(t,e){var n=e.size();if(n===0)return e;if(n<=3)return wi.createClosedRing(t,e,4);var r=e.getOrdinate(0,Bn.X)===e.getOrdinate(n-1,Bn.X)&&e.getOrdinate(0,Bn.Y)===e.getOrdinate(n-1,Bn.Y);return r?e:wi.createClosedRing(t,e,n+1)};wi.createClosedRing=function(t,e,n){var r=t.create(n,e.getDimension()),i=e.size();wi.copy(e,0,r,0,i);for(var a=i;a<n;a++)wi.copy(e,0,r,a,1);return r};var ai=function(t){function e(r,i){t.call(this,i),this._points=null,this.init(r)}t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e;var n={serialVersionUID:{configurable:!0}};return e.prototype.computeEnvelopeInternal=function(){return this.isEmpty()?new $e:this._points.expandEnvelope(new $e)},e.prototype.isRing=function(){return this.isClosed()&&this.isSimple()},e.prototype.getSortIndex=function(){return t.SORTINDEX_LINESTRING},e.prototype.getCoordinates=function(){return this._points.toCoordinateArray()},e.prototype.equalsExact=function(){var r=this;if(arguments.length===2){var i=arguments[0],a=arguments[1];if(!this.isEquivalentClass(i))return!1;var h=i;if(this._points.size()!==h._points.size())return!1;for(var u=0;u<this._points.size();u++)if(!r.equal(r._points.getCoordinate(u),h._points.getCoordinate(u),a))return!1;return!0}else return t.prototype.equalsExact.apply(this,arguments)},e.prototype.normalize=function(){for(var r=this,i=0;i<Math.trunc(this._points.size()/2);i++){var a=r._points.size()-1-i;if(!r._points.getCoordinate(i).equals(r._points.getCoordinate(a)))return r._points.getCoordinate(i).compareTo(r._points.getCoordinate(a))>0&&wi.reverse(r._points),null}},e.prototype.getCoordinate=function(){return this.isEmpty()?null:this._points.getCoordinate(0)},e.prototype.getBoundaryDimension=function(){return this.isClosed()?Wn.FALSE:0},e.prototype.isClosed=function(){return this.isEmpty()?!1:this.getCoordinateN(0).equals2D(this.getCoordinateN(this.getNumPoints()-1))},e.prototype.getEndPoint=function(){return this.isEmpty()?null:this.getPointN(this.getNumPoints()-1)},e.prototype.getDimension=function(){return 1},e.prototype.getLength=function(){return Ce.computeLength(this._points)},e.prototype.getNumPoints=function(){return this._points.size()},e.prototype.reverse=function(){var r=this._points.copy();wi.reverse(r);var i=this.getFactory().createLineString(r);return i},e.prototype.compareToSameClass=function(){var r=this;if(arguments.length===1){for(var i=arguments[0],a=i,h=0,u=0;h<this._points.size()&&u<a._points.size();){var _=r._points.getCoordinate(h).compareTo(a._points.getCoordinate(u));if(_!==0)return _;h++,u++}return h<this._points.size()?1:u<a._points.size()?-1:0}else if(arguments.length===2){var w=arguments[0],C=arguments[1],P=w;return C.compare(this._points,P._points)}},e.prototype.apply=function(){var r=this;if(en(arguments[0],Xc))for(var i=arguments[0],a=0;a<this._points.size();a++)i.filter(r._points.getCoordinate(a));else if(en(arguments[0],nl)){var h=arguments[0];if(this._points.size()===0)return null;for(var u=0;u<this._points.size()&&(h.filter(r._points,u),!h.isDone());u++);h.isGeometryChanged()&&this.geometryChanged()}else if(en(arguments[0],ic)){var _=arguments[0];_.filter(this)}else if(en(arguments[0],kh)){var w=arguments[0];w.filter(this)}},e.prototype.getBoundary=function(){return new mu(this).getBoundary()},e.prototype.isEquivalentClass=function(r){return r instanceof e},e.prototype.clone=function(){var r=t.prototype.clone.call(this);return r._points=this._points.clone(),r},e.prototype.getCoordinateN=function(r){return this._points.getCoordinate(r)},e.prototype.getGeometryType=function(){return"LineString"},e.prototype.copy=function(){return new e(this._points.copy(),this._factory)},e.prototype.getCoordinateSequence=function(){return this._points},e.prototype.isEmpty=function(){return this._points.size()===0},e.prototype.init=function(r){if(r===null&&(r=this.getFactory().getCoordinateSequenceFactory().create([])),r.size()===1)throw new Yr("Invalid number of points in LineString (found "+r.size()+" - must be 0 or >= 2)");this._points=r},e.prototype.isCoordinate=function(r){for(var i=this,a=0;a<this._points.size();a++)if(i._points.getCoordinate(a).equals(r))return!0;return!1},e.prototype.getStartPoint=function(){return this.isEmpty()?null:this.getPointN(0)},e.prototype.getPointN=function(r){return this.getFactory().createPoint(this._points.getCoordinate(r))},e.prototype.interfaces_=function(){return[a_]},e.prototype.getClass=function(){return e},n.serialVersionUID.get=function(){return 0x2b2b51ba435c8e00},Object.defineProperties(e,n),e}(Je),u_=function(){};u_.prototype.interfaces_=function(){return[]};u_.prototype.getClass=function(){return u_};var wa=function(t){function e(r,i){t.call(this,i),this._coordinates=r||null,this.init(this._coordinates)}t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e;var n={serialVersionUID:{configurable:!0}};return e.prototype.computeEnvelopeInternal=function(){if(this.isEmpty())return new $e;var r=new $e;return r.expandToInclude(this._coordinates.getX(0),this._coordinates.getY(0)),r},e.prototype.getSortIndex=function(){return t.SORTINDEX_POINT},e.prototype.getCoordinates=function(){return this.isEmpty()?[]:[this.getCoordinate()]},e.prototype.equalsExact=function(){if(arguments.length===2){var r=arguments[0],i=arguments[1];return this.isEquivalentClass(r)?this.isEmpty()&&r.isEmpty()?!0:this.isEmpty()!==r.isEmpty()?!1:this.equal(r.getCoordinate(),this.getCoordinate(),i):!1}else return t.prototype.equalsExact.apply(this,arguments)},e.prototype.normalize=function(){},e.prototype.getCoordinate=function(){return this._coordinates.size()!==0?this._coordinates.getCoordinate(0):null},e.prototype.getBoundaryDimension=function(){return Wn.FALSE},e.prototype.getDimension=function(){return 0},e.prototype.getNumPoints=function(){return this.isEmpty()?0:1},e.prototype.reverse=function(){return this.copy()},e.prototype.getX=function(){if(this.getCoordinate()===null)throw new Error("getX called on empty Point");return this.getCoordinate().x},e.prototype.compareToSameClass=function(){if(arguments.length===1){var r=arguments[0],i=r;return this.getCoordinate().compareTo(i.getCoordinate())}else if(arguments.length===2){var a=arguments[0],h=arguments[1],u=a;return h.compare(this._coordinates,u._coordinates)}},e.prototype.apply=function(){if(en(arguments[0],Xc)){var r=arguments[0];if(this.isEmpty())return null;r.filter(this.getCoordinate())}else if(en(arguments[0],nl)){var i=arguments[0];if(this.isEmpty())return null;i.filter(this._coordinates,0),i.isGeometryChanged()&&this.geometryChanged()}else if(en(arguments[0],ic)){var a=arguments[0];a.filter(this)}else if(en(arguments[0],kh)){var h=arguments[0];h.filter(this)}},e.prototype.getBoundary=function(){return this.getFactory().createGeometryCollection(null)},e.prototype.clone=function(){var r=t.prototype.clone.call(this);return r._coordinates=this._coordinates.clone(),r},e.prototype.getGeometryType=function(){return"Point"},e.prototype.copy=function(){return new e(this._coordinates.copy(),this._factory)},e.prototype.getCoordinateSequence=function(){return this._coordinates},e.prototype.getY=function(){if(this.getCoordinate()===null)throw new Error("getY called on empty Point");return this.getCoordinate().y},e.prototype.isEmpty=function(){return this._coordinates.size()===0},e.prototype.init=function(r){r===null&&(r=this.getFactory().getCoordinateSequenceFactory().create([])),dn.isTrue(r.size()<=1),this._coordinates=r},e.prototype.isSimple=function(){return!0},e.prototype.interfaces_=function(){return[u_]},e.prototype.getClass=function(){return e},n.serialVersionUID.get=function(){return 4902022702746615e3},Object.defineProperties(e,n),e}(Je),kp=function(){};kp.prototype.interfaces_=function(){return[]};kp.prototype.getClass=function(){return kp};var eo=function(t){function e(r,i,a){if(t.call(this,a),this._shell=null,this._holes=null,r===null&&(r=this.getFactory().createLinearRing()),i===null&&(i=[]),t.hasNullElements(i))throw new Yr("holes must not contain null elements");if(r.isEmpty()&&t.hasNonEmptyElements(i))throw new Yr("shell is empty but holes are not");this._shell=r,this._holes=i}t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e;var n={serialVersionUID:{configurable:!0}};return e.prototype.computeEnvelopeInternal=function(){return this._shell.getEnvelopeInternal()},e.prototype.getSortIndex=function(){return t.SORTINDEX_POLYGON},e.prototype.getCoordinates=function(){var r=this;if(this.isEmpty())return[];for(var i=new Array(this.getNumPoints()).fill(null),a=-1,h=this._shell.getCoordinates(),u=0;u<h.length;u++)a++,i[a]=h[u];for(var _=0;_<this._holes.length;_++)for(var w=r._holes[_].getCoordinates(),C=0;C<w.length;C++)a++,i[a]=w[C];return i},e.prototype.getArea=function(){var r=this,i=0;i+=Math.abs(Ce.signedArea(this._shell.getCoordinateSequence()));for(var a=0;a<this._holes.length;a++)i-=Math.abs(Ce.signedArea(r._holes[a].getCoordinateSequence()));return i},e.prototype.isRectangle=function(){if(this.getNumInteriorRing()!==0||this._shell===null||this._shell.getNumPoints()!==5)return!1;for(var r=this._shell.getCoordinateSequence(),i=this.getEnvelopeInternal(),a=0;a<5;a++){var h=r.getX(a);if(!(h===i.getMinX()||h===i.getMaxX()))return!1;var u=r.getY(a);if(!(u===i.getMinY()||u===i.getMaxY()))return!1}for(var _=r.getX(0),w=r.getY(0),C=1;C<=4;C++){var P=r.getX(C),D=r.getY(C),B=P!==_,$=D!==w;if(B===$)return!1;_=P,w=D}return!0},e.prototype.equalsExact=function(){var r=this;if(arguments.length===2){var i=arguments[0],a=arguments[1];if(!this.isEquivalentClass(i))return!1;var h=i,u=this._shell,_=h._shell;if(!u.equalsExact(_,a)||this._holes.length!==h._holes.length)return!1;for(var w=0;w<this._holes.length;w++)if(!r._holes[w].equalsExact(h._holes[w],a))return!1;return!0}else return t.prototype.equalsExact.apply(this,arguments)},e.prototype.normalize=function(){var r=this;if(arguments.length===0){this.normalize(this._shell,!0);for(var i=0;i<this._holes.length;i++)r.normalize(r._holes[i],!1);Rf.sort(this._holes)}else if(arguments.length===2){var a=arguments[0],h=arguments[1];if(a.isEmpty())return null;var u=new Array(a.getCoordinates().length-1).fill(null);ko.arraycopy(a.getCoordinates(),0,u,0,u.length);var _=Sn.minCoordinate(a.getCoordinates());Sn.scroll(u,_),ko.arraycopy(u,0,a.getCoordinates(),0,u.length),a.getCoordinates()[u.length]=u[0],Ce.isCCW(a.getCoordinates())===h&&Sn.reverse(a.getCoordinates())}},e.prototype.getCoordinate=function(){return this._shell.getCoordinate()},e.prototype.getNumInteriorRing=function(){return this._holes.length},e.prototype.getBoundaryDimension=function(){return 1},e.prototype.getDimension=function(){return 2},e.prototype.getLength=function(){var r=this,i=0;i+=this._shell.getLength();for(var a=0;a<this._holes.length;a++)i+=r._holes[a].getLength();return i},e.prototype.getNumPoints=function(){for(var r=this,i=this._shell.getNumPoints(),a=0;a<this._holes.length;a++)i+=r._holes[a].getNumPoints();return i},e.prototype.reverse=function(){var r=this,i=this.copy();i._shell=this._shell.copy().reverse(),i._holes=new Array(this._holes.length).fill(null);for(var a=0;a<this._holes.length;a++)i._holes[a]=r._holes[a].copy().reverse();return i},e.prototype.convexHull=function(){return this.getExteriorRing().convexHull()},e.prototype.compareToSameClass=function(){var r=this;if(arguments.length===1){var i=arguments[0],a=this._shell,h=i._shell;return a.compareToSameClass(h)}else if(arguments.length===2){var u=arguments[0],_=arguments[1],w=u,C=this._shell,P=w._shell,D=C.compareToSameClass(P,_);if(D!==0)return D;for(var B=this.getNumInteriorRing(),$=w.getNumInteriorRing(),Z=0;Z<B&&Z<$;){var W=r.getInteriorRingN(Z),rt=w.getInteriorRingN(Z),ct=W.compareToSameClass(rt,_);if(ct!==0)return ct;Z++}return Z<B?1:Z<$?-1:0}},e.prototype.apply=function(r){var i=this;if(en(r,Xc)){this._shell.apply(r);for(var a=0;a<this._holes.length;a++)i._holes[a].apply(r)}else if(en(r,nl)){if(this._shell.apply(r),!r.isDone())for(var h=0;h<this._holes.length&&(i._holes[h].apply(r),!r.isDone());h++);r.isGeometryChanged()&&this.geometryChanged()}else if(en(r,ic))r.filter(this);else if(en(r,kh)){r.filter(this),this._shell.apply(r);for(var u=0;u<this._holes.length;u++)i._holes[u].apply(r)}},e.prototype.getBoundary=function(){var r=this;if(this.isEmpty())return this.getFactory().createMultiLineString();var i=new Array(this._holes.length+1).fill(null);i[0]=this._shell;for(var a=0;a<this._holes.length;a++)i[a+1]=r._holes[a];return i.length<=1?this.getFactory().createLinearRing(i[0].getCoordinateSequence()):this.getFactory().createMultiLineString(i)},e.prototype.clone=function(){var r=this,i=t.prototype.clone.call(this);i._shell=this._shell.clone(),i._holes=new Array(this._holes.length).fill(null);for(var a=0;a<this._holes.length;a++)i._holes[a]=r._holes[a].clone();return i},e.prototype.getGeometryType=function(){return"Polygon"},e.prototype.copy=function(){for(var r=this,i=this._shell.copy(),a=new Array(this._holes.length).fill(null),h=0;h<a.length;h++)a[h]=r._holes[h].copy();return new e(i,a,this._factory)},e.prototype.getExteriorRing=function(){return this._shell},e.prototype.isEmpty=function(){return this._shell.isEmpty()},e.prototype.getInteriorRingN=function(r){return this._holes[r]},e.prototype.interfaces_=function(){return[kp]},e.prototype.getClass=function(){return e},n.serialVersionUID.get=function(){return-0x307ffefd8dc97200},Object.defineProperties(e,n),e}(Je),vm=function(t){function e(){t.apply(this,arguments)}t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e;var n={serialVersionUID:{configurable:!0}};return e.prototype.getSortIndex=function(){return Je.SORTINDEX_MULTIPOINT},e.prototype.isValid=function(){return!0},e.prototype.equalsExact=function(){if(arguments.length===2){var r=arguments[0],i=arguments[1];return this.isEquivalentClass(r)?t.prototype.equalsExact.call(this,r,i):!1}else return t.prototype.equalsExact.apply(this,arguments)},e.prototype.getCoordinate=function(){if(arguments.length===1){var r=arguments[0];return this._geometries[r].getCoordinate()}else return t.prototype.getCoordinate.apply(this,arguments)},e.prototype.getBoundaryDimension=function(){return Wn.FALSE},e.prototype.getDimension=function(){return 0},e.prototype.getBoundary=function(){return this.getFactory().createGeometryCollection(null)},e.prototype.getGeometryType=function(){return"MultiPoint"},e.prototype.copy=function(){for(var r=this,i=new Array(this._geometries.length).fill(null),a=0;a<i.length;a++)i[a]=r._geometries[a].copy();return new e(i,this._factory)},e.prototype.interfaces_=function(){return[u_]},e.prototype.getClass=function(){return e},n.serialVersionUID.get=function(){return-8048474874175356e3},Object.defineProperties(e,n),e}(Ds),Yc=function(t){function e(r,i){r instanceof Lt&&i instanceof En&&(r=i.getCoordinateSequenceFactory().create(r)),t.call(this,r,i),this.validateConstruction()}t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e;var n={MINIMUM_VALID_SIZE:{configurable:!0},serialVersionUID:{configurable:!0}};return e.prototype.getSortIndex=function(){return Je.SORTINDEX_LINEARRING},e.prototype.getBoundaryDimension=function(){return Wn.FALSE},e.prototype.isClosed=function(){return this.isEmpty()?!0:t.prototype.isClosed.call(this)},e.prototype.reverse=function(){var r=this._points.copy();wi.reverse(r);var i=this.getFactory().createLinearRing(r);return i},e.prototype.validateConstruction=function(){if(!this.isEmpty()&&!t.prototype.isClosed.call(this))throw new Yr("Points of LinearRing do not form a closed linestring");if(this.getCoordinateSequence().size()>=1&&this.getCoordinateSequence().size()<e.MINIMUM_VALID_SIZE)throw new Yr("Invalid number of points in LinearRing (found "+this.getCoordinateSequence().size()+" - must be 0 or >= 4)")},e.prototype.getGeometryType=function(){return"LinearRing"},e.prototype.copy=function(){return new e(this._points.copy(),this._factory)},e.prototype.interfaces_=function(){return[]},e.prototype.getClass=function(){return e},n.MINIMUM_VALID_SIZE.get=function(){return 4},n.serialVersionUID.get=function(){return-0x3b229e262367a600},Object.defineProperties(e,n),e}(ai),Rc=function(t){function e(){t.apply(this,arguments)}t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e;var n={serialVersionUID:{configurable:!0}};return e.prototype.getSortIndex=function(){return Je.SORTINDEX_MULTIPOLYGON},e.prototype.equalsExact=function(){if(arguments.length===2){var r=arguments[0],i=arguments[1];return this.isEquivalentClass(r)?t.prototype.equalsExact.call(this,r,i):!1}else return t.prototype.equalsExact.apply(this,arguments)},e.prototype.getBoundaryDimension=function(){return 1},e.prototype.getDimension=function(){return 2},e.prototype.reverse=function(){for(var r=this,i=this._geometries.length,a=new Array(i).fill(null),h=0;h<this._geometries.length;h++)a[h]=r._geometries[h].reverse();return this.getFactory().createMultiPolygon(a)},e.prototype.getBoundary=function(){var r=this;if(this.isEmpty())return this.getFactory().createMultiLineString();for(var i=new de,a=0;a<this._geometries.length;a++)for(var h=r._geometries[a],u=h.getBoundary(),_=0;_<u.getNumGeometries();_++)i.add(u.getGeometryN(_));var w=new Array(i.size()).fill(null);return this.getFactory().createMultiLineString(i.toArray(w))},e.prototype.getGeometryType=function(){return"MultiPolygon"},e.prototype.copy=function(){for(var r=this,i=new Array(this._geometries.length).fill(null),a=0;a<i.length;a++)i[a]=r._geometries[a].copy();return new e(i,this._factory)},e.prototype.interfaces_=function(){return[kp]},e.prototype.getClass=function(){return e},n.serialVersionUID.get=function(){return-0x7a5aa1369171980},Object.defineProperties(e,n),e}(Ds),Su=function(t){this._factory=t||null,this._isUserDataCopied=!1},T0={NoOpGeometryOperation:{configurable:!0},CoordinateOperation:{configurable:!0},CoordinateSequenceOperation:{configurable:!0}};Su.prototype.setCopyUserData=function(t){this._isUserDataCopied=t};Su.prototype.edit=function(t,e){if(t===null)return null;var n=this.editInternal(t,e);return this._isUserDataCopied&&n.setUserData(t.getUserData()),n};Su.prototype.editInternal=function(t,e){return this._factory===null&&(this._factory=t.getFactory()),t instanceof Ds?this.editGeometryCollection(t,e):t instanceof eo?this.editPolygon(t,e):t instanceof wa?e.edit(t,this._factory):t instanceof ai?e.edit(t,this._factory):(dn.shouldNeverReachHere("Unsupported Geometry class: "+t.getClass().getName()),null)};Su.prototype.editGeometryCollection=function(t,e){for(var n=this,r=e.edit(t,this._factory),i=new de,a=0;a<r.getNumGeometries();a++){var h=n.edit(r.getGeometryN(a),e);h===null||h.isEmpty()||i.add(h)}return r.getClass()===vm?this._factory.createMultiPoint(i.toArray([])):r.getClass()===Hf?this._factory.createMultiLineString(i.toArray([])):r.getClass()===Rc?this._factory.createMultiPolygon(i.toArray([])):this._factory.createGeometryCollection(i.toArray([]))};Su.prototype.editPolygon=function(t,e){var n=this,r=e.edit(t,this._factory);if(r===null&&(r=this._factory.createPolygon(null)),r.isEmpty())return r;var i=this.edit(r.getExteriorRing(),e);if(i===null||i.isEmpty())return this._factory.createPolygon();for(var a=new de,h=0;h<r.getNumInteriorRing();h++){var u=n.edit(r.getInteriorRingN(h),e);u===null||u.isEmpty()||a.add(u)}return this._factory.createPolygon(i,a.toArray([]))};Su.prototype.interfaces_=function(){return[]};Su.prototype.getClass=function(){return Su};Su.GeometryEditorOperation=function(){};T0.NoOpGeometryOperation.get=function(){return l_};T0.CoordinateOperation.get=function(){return c_};T0.CoordinateSequenceOperation.get=function(){return h_};Object.defineProperties(Su,T0);var l_=function(){};l_.prototype.edit=function(t,e){return t};l_.prototype.interfaces_=function(){return[Su.GeometryEditorOperation]};l_.prototype.getClass=function(){return l_};var c_=function(){};c_.prototype.edit=function(t,e){var n=this.editCoordinates(t.getCoordinates(),t);return n===null?t:t instanceof Yc?e.createLinearRing(n):t instanceof ai?e.createLineString(n):t instanceof wa?n.length>0?e.createPoint(n[0]):e.createPoint():t};c_.prototype.interfaces_=function(){return[Su.GeometryEditorOperation]};c_.prototype.getClass=function(){return c_};var h_=function(){};h_.prototype.edit=function(t,e){return t instanceof Yc?e.createLinearRing(this.edit(t.getCoordinateSequence(),t)):t instanceof ai?e.createLineString(this.edit(t.getCoordinateSequence(),t)):t instanceof wa?e.createPoint(this.edit(t.getCoordinateSequence(),t)):t};h_.prototype.interfaces_=function(){return[Su.GeometryEditorOperation]};h_.prototype.getClass=function(){return h_};var _i=function(){var t=this;if(this._dimension=3,this._coordinates=null,arguments.length===1){if(arguments[0]instanceof Array)this._coordinates=arguments[0],this._dimension=3;else if(Number.isInteger(arguments[0])){var e=arguments[0];this._coordinates=new Array(e).fill(null);for(var n=0;n<e;n++)t._coordinates[n]=new Lt}else if(en(arguments[0],Bn)){var r=arguments[0];if(r===null)return this._coordinates=new Array(0).fill(null),null;this._dimension=r.getDimension(),this._coordinates=new Array(r.size()).fill(null);for(var i=0;i<this._coordinates.length;i++)t._coordinates[i]=r.getCoordinateCopy(i)}}else if(arguments.length===2){if(arguments[0]instanceof Array&&Number.isInteger(arguments[1])){var a=arguments[0],h=arguments[1];this._coordinates=a,this._dimension=h,a===null&&(this._coordinates=new Array(0).fill(null))}else if(Number.isInteger(arguments[0])&&Number.isInteger(arguments[1])){var u=arguments[0],_=arguments[1];this._coordinates=new Array(u).fill(null),this._dimension=_;for(var w=0;w<u;w++)t._coordinates[w]=new Lt}}},nT={serialVersionUID:{configurable:!0}};_i.prototype.setOrdinate=function(t,e,n){switch(e){case Bn.X:this._coordinates[t].x=n;break;case Bn.Y:this._coordinates[t].y=n;break;case Bn.Z:this._coordinates[t].z=n;break;default:throw new Yr("invalid ordinateIndex")}};_i.prototype.size=function(){return this._coordinates.length};_i.prototype.getOrdinate=function(t,e){switch(e){case Bn.X:return this._coordinates[t].x;case Bn.Y:return this._coordinates[t].y;case Bn.Z:return this._coordinates[t].z}return ln.NaN};_i.prototype.getCoordinate=function(){if(arguments.length===1){var t=arguments[0];return this._coordinates[t]}else if(arguments.length===2){var e=arguments[0],n=arguments[1];n.x=this._coordinates[e].x,n.y=this._coordinates[e].y,n.z=this._coordinates[e].z}};_i.prototype.getCoordinateCopy=function(t){return new Lt(this._coordinates[t])};_i.prototype.getDimension=function(){return this._dimension};_i.prototype.getX=function(t){return this._coordinates[t].x};_i.prototype.clone=function(){for(var t=this,e=new Array(this.size()).fill(null),n=0;n<this._coordinates.length;n++)e[n]=t._coordinates[n].clone();return new _i(e,this._dimension)};_i.prototype.expandEnvelope=function(t){for(var e=this,n=0;n<this._coordinates.length;n++)t.expandToInclude(e._coordinates[n]);return t};_i.prototype.copy=function(){for(var t=this,e=new Array(this.size()).fill(null),n=0;n<this._coordinates.length;n++)e[n]=t._coordinates[n].copy();return new _i(e,this._dimension)};_i.prototype.toString=function(){var t=this;if(this._coordinates.length>0){var e=new gc(17*this._coordinates.length);e.append("("),e.append(this._coordinates[0]);for(var n=1;n<this._coordinates.length;n++)e.append(", "),e.append(t._coordinates[n]);return e.append(")"),e.toString()}else return"()"};_i.prototype.getY=function(t){return this._coordinates[t].y};_i.prototype.toCoordinateArray=function(){return this._coordinates};_i.prototype.interfaces_=function(){return[Bn,Mu]};_i.prototype.getClass=function(){return _i};nT.serialVersionUID.get=function(){return-0xcb44a778db18e00};Object.defineProperties(_i,nT);var Zc=function(){},iw={serialVersionUID:{configurable:!0},instanceObject:{configurable:!0}};Zc.prototype.readResolve=function(){return Zc.instance()};Zc.prototype.create=function(){if(arguments.length===1){if(arguments[0]instanceof Array){var t=arguments[0];return new _i(t)}else if(en(arguments[0],Bn)){var e=arguments[0];return new _i(e)}}else if(arguments.length===2){var n=arguments[0],r=arguments[1];return r>3&&(r=3),r<2?new _i(n):new _i(n,r)}};Zc.prototype.interfaces_=function(){return[fm,Mu]};Zc.prototype.getClass=function(){return Zc};Zc.instance=function(){return Zc.instanceObject};iw.serialVersionUID.get=function(){return-0x38e49fa6cf6f2e00};iw.instanceObject.get=function(){return new Zc};Object.defineProperties(Zc,iw);var rT=function(t){function e(){t.call(this),this.map_=new Map}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.get=function(n){return this.map_.get(n)||null},e.prototype.put=function(n,r){return this.map_.set(n,r),r},e.prototype.values=function(){for(var n=new de,r=this.map_.values(),i=r.next();!i.done;)n.add(i.value),i=r.next();return n},e.prototype.entrySet=function(){var n=new nw;return this.map_.entries().forEach(function(r){return n.add(r)}),n},e.prototype.size=function(){return this.map_.size()},e}(mg),er=function t(){if(this._modelType=null,this._scale=null,arguments.length===0)this._modelType=t.FLOATING;else if(arguments.length===1){if(arguments[0]instanceof oc){var e=arguments[0];this._modelType=e,e===t.FIXED&&this.setScale(1)}else if(typeof arguments[0]=="number"){var n=arguments[0];this._modelType=t.FIXED,this.setScale(n)}else if(arguments[0]instanceof t){var r=arguments[0];this._modelType=r._modelType,this._scale=r._scale}}},ow={serialVersionUID:{configurable:!0},maximumPreciseValue:{configurable:!0}};er.prototype.equals=function(t){if(!(t instanceof er))return!1;var e=t;return this._modelType===e._modelType&&this._scale===e._scale};er.prototype.compareTo=function(t){var e=t,n=this.getMaximumSignificantDigits(),r=e.getMaximumSignificantDigits();return new nc(n).compareTo(new nc(r))};er.prototype.getScale=function(){return this._scale};er.prototype.isFloating=function(){return this._modelType===er.FLOATING||this._modelType===er.FLOATING_SINGLE};er.prototype.getType=function(){return this._modelType};er.prototype.toString=function(){var t="UNKNOWN";return this._modelType===er.FLOATING?t="Floating":this._modelType===er.FLOATING_SINGLE?t="Floating-Single":this._modelType===er.FIXED&&(t="Fixed (Scale="+this.getScale()+")"),t};er.prototype.makePrecise=function(){if(typeof arguments[0]=="number"){var t=arguments[0];if(ln.isNaN(t))return t;if(this._modelType===er.FLOATING_SINGLE){var e=t;return e}return this._modelType===er.FIXED?Math.round(t*this._scale)/this._scale:t}else if(arguments[0]instanceof Lt){var n=arguments[0];if(this._modelType===er.FLOATING)return null;n.x=this.makePrecise(n.x),n.y=this.makePrecise(n.y)}};er.prototype.getMaximumSignificantDigits=function(){var t=16;return this._modelType===er.FLOATING?t=16:this._modelType===er.FLOATING_SINGLE?t=6:this._modelType===er.FIXED&&(t=1+Math.trunc(Math.ceil(Math.log(this.getScale())/Math.log(10)))),t};er.prototype.setScale=function(t){this._scale=Math.abs(t)};er.prototype.interfaces_=function(){return[Mu,Pu]};er.prototype.getClass=function(){return er};er.mostPrecise=function(t,e){return t.compareTo(e)>=0?t:e};ow.serialVersionUID.get=function(){return 7777263578777804e3};ow.maximumPreciseValue.get=function(){return 9007199254740992};Object.defineProperties(er,ow);var oc=function t(e){this._name=e||null,t.nameToTypeMap.put(e,this)},sw={serialVersionUID:{configurable:!0},nameToTypeMap:{configurable:!0}};oc.prototype.readResolve=function(){return oc.nameToTypeMap.get(this._name)};oc.prototype.toString=function(){return this._name};oc.prototype.interfaces_=function(){return[Mu]};oc.prototype.getClass=function(){return oc};sw.serialVersionUID.get=function(){return-552860263173159e4};sw.nameToTypeMap.get=function(){return new rT};Object.defineProperties(oc,sw);er.Type=oc;er.FIXED=new oc("FIXED");er.FLOATING=new oc("FLOATING");er.FLOATING_SINGLE=new oc("FLOATING SINGLE");var En=function t(){this._precisionModel=new er,this._SRID=0,this._coordinateSequenceFactory=t.getDefaultCoordinateSequenceFactory(),arguments.length===0||(arguments.length===1?en(arguments[0],fm)?this._coordinateSequenceFactory=arguments[0]:arguments[0]instanceof er&&(this._precisionModel=arguments[0]):arguments.length===2?(this._precisionModel=arguments[0],this._SRID=arguments[1]):arguments.length===3&&(this._precisionModel=arguments[0],this._SRID=arguments[1],this._coordinateSequenceFactory=arguments[2]))},iT={serialVersionUID:{configurable:!0}};En.prototype.toGeometry=function(t){return t.isNull()?this.createPoint(null):t.getMinX()===t.getMaxX()&&t.getMinY()===t.getMaxY()?this.createPoint(new Lt(t.getMinX(),t.getMinY())):t.getMinX()===t.getMaxX()||t.getMinY()===t.getMaxY()?this.createLineString([new Lt(t.getMinX(),t.getMinY()),new Lt(t.getMaxX(),t.getMaxY())]):this.createPolygon(this.createLinearRing([new Lt(t.getMinX(),t.getMinY()),new Lt(t.getMinX(),t.getMaxY()),new Lt(t.getMaxX(),t.getMaxY()),new Lt(t.getMaxX(),t.getMinY()),new Lt(t.getMinX(),t.getMinY())]),null)};En.prototype.createLineString=function(t){if(t){if(t instanceof Array)return new ai(this.getCoordinateSequenceFactory().create(t),this);if(en(t,Bn))return new ai(t,this)}else return new ai(this.getCoordinateSequenceFactory().create([]),this)};En.prototype.createMultiLineString=function(){if(arguments.length===0)return new Hf(null,this);if(arguments.length===1){var t=arguments[0];return new Hf(t,this)}};En.prototype.buildGeometry=function(t){for(var e=null,n=!1,r=!1,i=t.iterator();i.hasNext();){var a=i.next(),h=a.getClass();e===null&&(e=h),h!==e&&(n=!0),a.isGeometryCollectionOrDerived()&&(r=!0)}if(e===null)return this.createGeometryCollection();if(n||r)return this.createGeometryCollection(En.toGeometryArray(t));var u=t.iterator().next(),_=t.size()>1;if(_){if(u instanceof eo)return this.createMultiPolygon(En.toPolygonArray(t));if(u instanceof ai)return this.createMultiLineString(En.toLineStringArray(t));if(u instanceof wa)return this.createMultiPoint(En.toPointArray(t));dn.shouldNeverReachHere("Unhandled class: "+u.getClass().getName())}return u};En.prototype.createMultiPointFromCoords=function(t){return this.createMultiPoint(t!==null?this.getCoordinateSequenceFactory().create(t):null)};En.prototype.createPoint=function(){if(arguments.length===0)return this.createPoint(this.getCoordinateSequenceFactory().create([]));if(arguments.length===1){if(arguments[0]instanceof Lt){var t=arguments[0];return this.createPoint(t!==null?this.getCoordinateSequenceFactory().create([t]):null)}else if(en(arguments[0],Bn)){var e=arguments[0];return new wa(e,this)}}};En.prototype.getCoordinateSequenceFactory=function(){return this._coordinateSequenceFactory};En.prototype.createPolygon=function(){if(arguments.length===0)return new eo(null,null,this);if(arguments.length===1){if(en(arguments[0],Bn)){var t=arguments[0];return this.createPolygon(this.createLinearRing(t))}else if(arguments[0]instanceof Array){var e=arguments[0];return this.createPolygon(this.createLinearRing(e))}else if(arguments[0]instanceof Yc){var n=arguments[0];return this.createPolygon(n,null)}}else if(arguments.length===2){var r=arguments[0],i=arguments[1];return new eo(r,i,this)}};En.prototype.getSRID=function(){return this._SRID};En.prototype.createGeometryCollection=function(){if(arguments.length===0)return new Ds(null,this);if(arguments.length===1){var t=arguments[0];return new Ds(t,this)}};En.prototype.createGeometry=function(t){var e=new Su(this);return e.edit(t,{edit:function(){if(arguments.length===2){var n=arguments[0];return this._coordinateSequenceFactory.create(n)}}})};En.prototype.getPrecisionModel=function(){return this._precisionModel};En.prototype.createLinearRing=function(){if(arguments.length===0)return this.createLinearRing(this.getCoordinateSequenceFactory().create([]));if(arguments.length===1){if(arguments[0]instanceof Array){var t=arguments[0];return this.createLinearRing(t!==null?this.getCoordinateSequenceFactory().create(t):null)}else if(en(arguments[0],Bn)){var e=arguments[0];return new Yc(e,this)}}};En.prototype.createMultiPolygon=function(){if(arguments.length===0)return new Rc(null,this);if(arguments.length===1){var t=arguments[0];return new Rc(t,this)}};En.prototype.createMultiPoint=function(){var t=this;if(arguments.length===0)return new vm(null,this);if(arguments.length===1){if(arguments[0]instanceof Array){var e=arguments[0];return new vm(e,this)}else if(arguments[0]instanceof Array){var n=arguments[0];return this.createMultiPoint(n!==null?this.getCoordinateSequenceFactory().create(n):null)}else if(en(arguments[0],Bn)){var r=arguments[0];if(r===null)return this.createMultiPoint(new Array(0).fill(null));for(var i=new Array(r.size()).fill(null),a=0;a<r.size();a++){var h=t.getCoordinateSequenceFactory().create(1,r.getDimension());wi.copy(r,a,h,0,1),i[a]=t.createPoint(h)}return this.createMultiPoint(i)}}};En.prototype.interfaces_=function(){return[Mu]};En.prototype.getClass=function(){return En};En.toMultiPolygonArray=function(t){var e=new Array(t.size()).fill(null);return t.toArray(e)};En.toGeometryArray=function(t){if(t===null)return null;var e=new Array(t.size()).fill(null);return t.toArray(e)};En.getDefaultCoordinateSequenceFactory=function(){return Zc.instance()};En.toMultiLineStringArray=function(t){var e=new Array(t.size()).fill(null);return t.toArray(e)};En.toLineStringArray=function(t){var e=new Array(t.size()).fill(null);return t.toArray(e)};En.toMultiPointArray=function(t){var e=new Array(t.size()).fill(null);return t.toArray(e)};En.toLinearRingArray=function(t){var e=new Array(t.size()).fill(null);return t.toArray(e)};En.toPointArray=function(t){var e=new Array(t.size()).fill(null);return t.toArray(e)};En.toPolygonArray=function(t){var e=new Array(t.size()).fill(null);return t.toArray(e)};En.createPointFromInternalCoord=function(t,e){return e.getPrecisionModel().makePrecise(t),e.getFactory().createPoint(t)};iT.serialVersionUID.get=function(){return-6820524753094096e3};Object.defineProperties(En,iT);var BO=["Point","MultiPoint","LineString","MultiLineString","Polygon","MultiPolygon"],L0=function(t){this.geometryFactory=t||new En};L0.prototype.read=function(t){var e;typeof t=="string"?e=JSON.parse(t):e=t;var n=e.type;if(!zl[n])throw new Error("Unknown GeoJSON type: "+e.type);return BO.indexOf(n)!==-1?zl[n].apply(this,[e.coordinates]):n==="GeometryCollection"?zl[n].apply(this,[e.geometries]):zl[n].apply(this,[e])};L0.prototype.write=function(t){var e=t.getGeometryType();if(!wh[e])throw new Error("Geometry is not supported");return wh[e].apply(this,[t])};var zl={Feature:function(t){var e={};for(var n in t)e[n]=t[n];if(t.geometry){var r=t.geometry.type;if(!zl[r])throw new Error("Unknown GeoJSON type: "+t.type);e.geometry=this.read(t.geometry)}return t.bbox&&(e.bbox=zl.bbox.apply(this,[t.bbox])),e},FeatureCollection:function(t){var e=this,n={};if(t.features){n.features=[];for(var r=0;r<t.features.length;++r)n.features.push(e.read(t.features[r]))}return t.bbox&&(n.bbox=this.parse.bbox.apply(this,[t.bbox])),n},coordinates:function(t){for(var e=[],n=0;n<t.length;++n){var r=t[n];e.push(new Lt(r[0],r[1]))}return e},bbox:function(t){return this.geometryFactory.createLinearRing([new Lt(t[0],t[1]),new Lt(t[2],t[1]),new Lt(t[2],t[3]),new Lt(t[0],t[3]),new Lt(t[0],t[1])])},Point:function(t){var e=new Lt(t[0],t[1]);return this.geometryFactory.createPoint(e)},MultiPoint:function(t){for(var e=this,n=[],r=0;r<t.length;++r)n.push(zl.Point.apply(e,[t[r]]));return this.geometryFactory.createMultiPoint(n)},LineString:function(t){var e=zl.coordinates.apply(this,[t]);return this.geometryFactory.createLineString(e)},MultiLineString:function(t){for(var e=this,n=[],r=0;r<t.length;++r)n.push(zl.LineString.apply(e,[t[r]]));return this.geometryFactory.createMultiLineString(n)},Polygon:function(t){for(var e=this,n=zl.coordinates.apply(this,[t[0]]),r=this.geometryFactory.createLinearRing(n),i=[],a=1;a<t.length;++a){var h=t[a],u=zl.coordinates.apply(e,[h]),_=e.geometryFactory.createLinearRing(u);i.push(_)}return this.geometryFactory.createPolygon(r,i)},MultiPolygon:function(t){for(var e=this,n=[],r=0;r<t.length;++r){var i=t[r];n.push(zl.Polygon.apply(e,[i]))}return this.geometryFactory.createMultiPolygon(n)},GeometryCollection:function(t){for(var e=this,n=[],r=0;r<t.length;++r){var i=t[r];n.push(e.read(i))}return this.geometryFactory.createGeometryCollection(n)}},wh={coordinate:function(t){return[t.x,t.y]},Point:function(t){var e=wh.coordinate.apply(this,[t.getCoordinate()]);return{type:"Point",coordinates:e}},MultiPoint:function(t){for(var e=this,n=[],r=0;r<t._geometries.length;++r){var i=t._geometries[r],a=wh.Point.apply(e,[i]);n.push(a.coordinates)}return{type:"MultiPoint",coordinates:n}},LineString:function(t){for(var e=this,n=[],r=t.getCoordinates(),i=0;i<r.length;++i){var a=r[i];n.push(wh.coordinate.apply(e,[a]))}return{type:"LineString",coordinates:n}},MultiLineString:function(t){for(var e=this,n=[],r=0;r<t._geometries.length;++r){var i=t._geometries[r],a=wh.LineString.apply(e,[i]);n.push(a.coordinates)}return{type:"MultiLineString",coordinates:n}},Polygon:function(t){var e=this,n=[],r=wh.LineString.apply(this,[t._shell]);n.push(r.coordinates);for(var i=0;i<t._holes.length;++i){var a=t._holes[i],h=wh.LineString.apply(e,[a]);n.push(h.coordinates)}return{type:"Polygon",coordinates:n}},MultiPolygon:function(t){for(var e=this,n=[],r=0;r<t._geometries.length;++r){var i=t._geometries[r],a=wh.Polygon.apply(e,[i]);n.push(a.coordinates)}return{type:"MultiPolygon",coordinates:n}},GeometryCollection:function(t){for(var e=this,n=[],r=0;r<t._geometries.length;++r){var i=t._geometries[r],a=i.getGeometryType();n.push(wh[a].apply(e,[i]))}return{type:"GeometryCollection",geometries:n}}},aw=function(t){this.geometryFactory=t||new En,this.precisionModel=this.geometryFactory.getPrecisionModel(),this.parser=new L0(this.geometryFactory)};aw.prototype.read=function(t){var e=this.parser.read(t);return this.precisionModel.getType()===er.FIXED&&this.reducePrecision(e),e};aw.prototype.reducePrecision=function(t){var e=this,n,r;if(t.coordinate)this.precisionModel.makePrecise(t.coordinate);else if(t.points)for(n=0,r=t.points.length;n<r;n++)e.precisionModel.makePrecise(t.points[n]);else if(t.geometries)for(n=0,r=t.geometries.length;n<r;n++)e.reducePrecision(t.geometries[n])};var oT=function(){this.parser=new L0(this.geometryFactory)};oT.prototype.write=function(t){return this.parser.write(t)};var oe=function(){},N0={ON:{configurable:!0},LEFT:{configurable:!0},RIGHT:{configurable:!0}};oe.prototype.interfaces_=function(){return[]};oe.prototype.getClass=function(){return oe};oe.opposite=function(t){return t===oe.LEFT?oe.RIGHT:t===oe.RIGHT?oe.LEFT:t};N0.ON.get=function(){return 0};N0.LEFT.get=function(){return 1};N0.RIGHT.get=function(){return 2};Object.defineProperties(oe,N0);function P0(t){this.message=t||""}P0.prototype=new Error;P0.prototype.name="EmptyStackException";function mc(){this.array_=[]}mc.prototype=new Yu;mc.prototype.add=function(t){return this.array_.push(t),!0};mc.prototype.get=function(t){if(t<0||t>=this.size())throw new Error;return this.array_[t]};mc.prototype.push=function(t){return this.array_.push(t),t};mc.prototype.pop=function(t){if(this.array_.length===0)throw new P0;return this.array_.pop()};mc.prototype.peek=function(){if(this.array_.length===0)throw new P0;return this.array_[this.array_.length-1]};mc.prototype.empty=function(){return this.array_.length===0};mc.prototype.isEmpty=function(){return this.empty()};mc.prototype.search=function(t){return this.array_.indexOf(t)};mc.prototype.size=function(){return this.array_.length};mc.prototype.toArray=function(){for(var t=this,e=[],n=0,r=this.array_.length;n<r;n++)e.push(t.array_[n]);return e};var sc=function(){this._minIndex=-1,this._minCoord=null,this._minDe=null,this._orientedDe=null};sc.prototype.getCoordinate=function(){return this._minCoord};sc.prototype.getRightmostSide=function(t,e){var n=this.getRightmostSideOfSegment(t,e);return n<0&&(n=this.getRightmostSideOfSegment(t,e-1)),n<0&&(this._minCoord=null,this.checkForRightmostCoordinate(t)),n};sc.prototype.findRightmostEdgeAtVertex=function(){var t=this._minDe.getEdge().getCoordinates();dn.isTrue(this._minIndex>0&&this._minIndex<t.length,"rightmost point expected to be interior vertex of edge");var e=t[this._minIndex-1],n=t[this._minIndex+1],r=Ce.computeOrientation(this._minCoord,n,e),i=!1;(e.y<this._minCoord.y&&n.y<this._minCoord.y&&r===Ce.COUNTERCLOCKWISE||e.y>this._minCoord.y&&n.y>this._minCoord.y&&r===Ce.CLOCKWISE)&&(i=!0),i&&(this._minIndex=this._minIndex-1)};sc.prototype.getRightmostSideOfSegment=function(t,e){var n=t.getEdge(),r=n.getCoordinates();if(e<0||e+1>=r.length||r[e].y===r[e+1].y)return-1;var i=oe.LEFT;return r[e].y<r[e+1].y&&(i=oe.RIGHT),i};sc.prototype.getEdge=function(){return this._orientedDe};sc.prototype.checkForRightmostCoordinate=function(t){for(var e=this,n=t.getEdge().getCoordinates(),r=0;r<n.length-1;r++)(e._minCoord===null||n[r].x>e._minCoord.x)&&(e._minDe=t,e._minIndex=r,e._minCoord=n[r])};sc.prototype.findRightmostEdgeAtNode=function(){var t=this._minDe.getNode(),e=t.getEdges();this._minDe=e.getRightmostEdge(),this._minDe.isForward()||(this._minDe=this._minDe.getSym(),this._minIndex=this._minDe.getEdge().getCoordinates().length-1)};sc.prototype.findEdge=function(t){for(var e=this,n=t.iterator();n.hasNext();){var r=n.next();r.isForward()&&e.checkForRightmostCoordinate(r)}dn.isTrue(this._minIndex!==0||this._minCoord.equals(this._minDe.getCoordinate()),"inconsistency in rightmost processing"),this._minIndex===0?this.findRightmostEdgeAtNode():this.findRightmostEdgeAtVertex(),this._orientedDe=this._minDe;var i=this.getRightmostSide(this._minDe,this._minIndex);i===oe.LEFT&&(this._orientedDe=this._minDe.getSym())};sc.prototype.interfaces_=function(){return[]};sc.prototype.getClass=function(){return sc};var zh=function(t){function e(n,r){t.call(this,e.msgWithCoord(n,r)),this.pt=r?new Lt(r):null,this.name="TopologyException"}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.getCoordinate=function(){return this.pt},e.prototype.interfaces_=function(){return[]},e.prototype.getClass=function(){return e},e.msgWithCoord=function(n,r){return r?n:n+" [ "+r+" ]"},e}(Fh),M0=function(){this.array_=[]};M0.prototype.addLast=function(t){this.array_.push(t)};M0.prototype.removeFirst=function(){return this.array_.shift()};M0.prototype.isEmpty=function(){return this.array_.length===0};var Os=function(){this._finder=null,this._dirEdgeList=new de,this._nodes=new de,this._rightMostCoord=null,this._env=null,this._finder=new sc};Os.prototype.clearVisitedEdges=function(){for(var t=this._dirEdgeList.iterator();t.hasNext();){var e=t.next();e.setVisited(!1)}};Os.prototype.getRightmostCoordinate=function(){return this._rightMostCoord};Os.prototype.computeNodeDepth=function(t){for(var e=this,n=null,r=t.getEdges().iterator();r.hasNext();){var i=r.next();if(i.isVisited()||i.getSym().isVisited()){n=i;break}}if(n===null)throw new zh("unable to find edge to compute depths at "+t.getCoordinate());t.getEdges().computeDepths(n);for(var a=t.getEdges().iterator();a.hasNext();){var h=a.next();h.setVisited(!0),e.copySymDepths(h)}};Os.prototype.computeDepth=function(t){this.clearVisitedEdges();var e=this._finder.getEdge();e.setEdgeDepths(oe.RIGHT,t),this.copySymDepths(e),this.computeDepths(e)};Os.prototype.create=function(t){this.addReachable(t),this._finder.findEdge(this._dirEdgeList),this._rightMostCoord=this._finder.getCoordinate()};Os.prototype.findResultEdges=function(){for(var t=this._dirEdgeList.iterator();t.hasNext();){var e=t.next();e.getDepth(oe.RIGHT)>=1&&e.getDepth(oe.LEFT)<=0&&!e.isInteriorAreaEdge()&&e.setInResult(!0)}};Os.prototype.computeDepths=function(t){var e=this,n=new nw,r=new M0,i=t.getNode();for(r.addLast(i),n.add(i),t.setVisited(!0);!r.isEmpty();){var a=r.removeFirst();n.add(a),e.computeNodeDepth(a);for(var h=a.getEdges().iterator();h.hasNext();){var u=h.next(),_=u.getSym();if(!_.isVisited()){var w=_.getNode();n.contains(w)||(r.addLast(w),n.add(w))}}}};Os.prototype.compareTo=function(t){var e=t;return this._rightMostCoord.x<e._rightMostCoord.x?-1:this._rightMostCoord.x>e._rightMostCoord.x?1:0};Os.prototype.getEnvelope=function(){if(this._env===null){for(var t=new $e,e=this._dirEdgeList.iterator();e.hasNext();)for(var n=e.next(),r=n.getEdge().getCoordinates(),i=0;i<r.length-1;i++)t.expandToInclude(r[i]);this._env=t}return this._env};Os.prototype.addReachable=function(t){var e=this,n=new mc;for(n.add(t);!n.empty();){var r=n.pop();e.add(r,n)}};Os.prototype.copySymDepths=function(t){var e=t.getSym();e.setDepth(oe.LEFT,t.getDepth(oe.RIGHT)),e.setDepth(oe.RIGHT,t.getDepth(oe.LEFT))};Os.prototype.add=function(t,e){var n=this;t.setVisited(!0),this._nodes.add(t);for(var r=t.getEdges().iterator();r.hasNext();){var i=r.next();n._dirEdgeList.add(i);var a=i.getSym(),h=a.getNode();h.isVisited()||e.push(h)}};Os.prototype.getNodes=function(){return this._nodes};Os.prototype.getDirectedEdges=function(){return this._dirEdgeList};Os.prototype.interfaces_=function(){return[Pu]};Os.prototype.getClass=function(){return Os};var Lr=function t(){var e=this;if(this.location=null,arguments.length===1){if(arguments[0]instanceof Array){var n=arguments[0];this.init(n.length)}else if(Number.isInteger(arguments[0])){var r=arguments[0];this.init(1),this.location[oe.ON]=r}else if(arguments[0]instanceof t){var i=arguments[0];if(this.init(i.location.length),i!==null)for(var a=0;a<this.location.length;a++)e.location[a]=i.location[a]}}else if(arguments.length===3){var h=arguments[0],u=arguments[1],_=arguments[2];this.init(3),this.location[oe.ON]=h,this.location[oe.LEFT]=u,this.location[oe.RIGHT]=_}};Lr.prototype.setAllLocations=function(t){for(var e=this,n=0;n<this.location.length;n++)e.location[n]=t};Lr.prototype.isNull=function(){for(var t=this,e=0;e<this.location.length;e++)if(t.location[e]!==Mt.NONE)return!1;return!0};Lr.prototype.setAllLocationsIfNull=function(t){for(var e=this,n=0;n<this.location.length;n++)e.location[n]===Mt.NONE&&(e.location[n]=t)};Lr.prototype.isLine=function(){return this.location.length===1};Lr.prototype.merge=function(t){var e=this;if(t.location.length>this.location.length){var n=new Array(3).fill(null);n[oe.ON]=this.location[oe.ON],n[oe.LEFT]=Mt.NONE,n[oe.RIGHT]=Mt.NONE,this.location=n}for(var r=0;r<this.location.length;r++)e.location[r]===Mt.NONE&&r<t.location.length&&(e.location[r]=t.location[r])};Lr.prototype.getLocations=function(){return this.location};Lr.prototype.flip=function(){if(this.location.length<=1)return null;var t=this.location[oe.LEFT];this.location[oe.LEFT]=this.location[oe.RIGHT],this.location[oe.RIGHT]=t};Lr.prototype.toString=function(){var t=new gc;return this.location.length>1&&t.append(Mt.toLocationSymbol(this.location[oe.LEFT])),t.append(Mt.toLocationSymbol(this.location[oe.ON])),this.location.length>1&&t.append(Mt.toLocationSymbol(this.location[oe.RIGHT])),t.toString()};Lr.prototype.setLocations=function(t,e,n){this.location[oe.ON]=t,this.location[oe.LEFT]=e,this.location[oe.RIGHT]=n};Lr.prototype.get=function(t){return t<this.location.length?this.location[t]:Mt.NONE};Lr.prototype.isArea=function(){return this.location.length>1};Lr.prototype.isAnyNull=function(){for(var t=this,e=0;e<this.location.length;e++)if(t.location[e]===Mt.NONE)return!0;return!1};Lr.prototype.setLocation=function(){if(arguments.length===1){var t=arguments[0];this.setLocation(oe.ON,t)}else if(arguments.length===2){var e=arguments[0],n=arguments[1];this.location[e]=n}};Lr.prototype.init=function(t){this.location=new Array(t).fill(null),this.setAllLocations(Mt.NONE)};Lr.prototype.isEqualOnSide=function(t,e){return this.location[e]===t.location[e]};Lr.prototype.allPositionsEqual=function(t){for(var e=this,n=0;n<this.location.length;n++)if(e.location[n]!==t)return!1;return!0};Lr.prototype.interfaces_=function(){return[]};Lr.prototype.getClass=function(){return Lr};var fr=function t(){if(this.elt=new Array(2).fill(null),arguments.length===1){if(Number.isInteger(arguments[0])){var e=arguments[0];this.elt[0]=new Lr(e),this.elt[1]=new Lr(e)}else if(arguments[0]instanceof t){var n=arguments[0];this.elt[0]=new Lr(n.elt[0]),this.elt[1]=new Lr(n.elt[1])}}else if(arguments.length===2){var r=arguments[0],i=arguments[1];this.elt[0]=new Lr(Mt.NONE),this.elt[1]=new Lr(Mt.NONE),this.elt[r].setLocation(i)}else if(arguments.length===3){var a=arguments[0],h=arguments[1],u=arguments[2];this.elt[0]=new Lr(a,h,u),this.elt[1]=new Lr(a,h,u)}else if(arguments.length===4){var _=arguments[0],w=arguments[1],C=arguments[2],P=arguments[3];this.elt[0]=new Lr(Mt.NONE,Mt.NONE,Mt.NONE),this.elt[1]=new Lr(Mt.NONE,Mt.NONE,Mt.NONE),this.elt[_].setLocations(w,C,P)}};fr.prototype.getGeometryCount=function(){var t=0;return this.elt[0].isNull()||t++,this.elt[1].isNull()||t++,t};fr.prototype.setAllLocations=function(t,e){this.elt[t].setAllLocations(e)};fr.prototype.isNull=function(t){return this.elt[t].isNull()};fr.prototype.setAllLocationsIfNull=function(){if(arguments.length===1){var t=arguments[0];this.setAllLocationsIfNull(0,t),this.setAllLocationsIfNull(1,t)}else if(arguments.length===2){var e=arguments[0],n=arguments[1];this.elt[e].setAllLocationsIfNull(n)}};fr.prototype.isLine=function(t){return this.elt[t].isLine()};fr.prototype.merge=function(t){for(var e=this,n=0;n<2;n++)e.elt[n]===null&&t.elt[n]!==null?e.elt[n]=new Lr(t.elt[n]):e.elt[n].merge(t.elt[n])};fr.prototype.flip=function(){this.elt[0].flip(),this.elt[1].flip()};fr.prototype.getLocation=function(){if(arguments.length===1){var t=arguments[0];return this.elt[t].get(oe.ON)}else if(arguments.length===2){var e=arguments[0],n=arguments[1];return this.elt[e].get(n)}};fr.prototype.toString=function(){var t=new gc;return this.elt[0]!==null&&(t.append("A:"),t.append(this.elt[0].toString())),this.elt[1]!==null&&(t.append(" B:"),t.append(this.elt[1].toString())),t.toString()};fr.prototype.isArea=function(){if(arguments.length===0)return this.elt[0].isArea()||this.elt[1].isArea();if(arguments.length===1){var t=arguments[0];return this.elt[t].isArea()}};fr.prototype.isAnyNull=function(t){return this.elt[t].isAnyNull()};fr.prototype.setLocation=function(){if(arguments.length===2){var t=arguments[0],e=arguments[1];this.elt[t].setLocation(oe.ON,e)}else if(arguments.length===3){var n=arguments[0],r=arguments[1],i=arguments[2];this.elt[n].setLocation(r,i)}};fr.prototype.isEqualOnSide=function(t,e){return this.elt[0].isEqualOnSide(t.elt[0],e)&&this.elt[1].isEqualOnSide(t.elt[1],e)};fr.prototype.allPositionsEqual=function(t,e){return this.elt[t].allPositionsEqual(e)};fr.prototype.toLine=function(t){this.elt[t].isArea()&&(this.elt[t]=new Lr(this.elt[t].location[0]))};fr.prototype.interfaces_=function(){return[]};fr.prototype.getClass=function(){return fr};fr.toLineLabel=function(t){for(var e=new fr(Mt.NONE),n=0;n<2;n++)e.setLocation(n,t.getLocation(n));return e};var Bi=function(){this._startDe=null,this._maxNodeDegree=-1,this._edges=new de,this._pts=new de,this._label=new fr(Mt.NONE),this._ring=null,this._isHole=null,this._shell=null,this._holes=new de,this._geometryFactory=null;var t=arguments[0],e=arguments[1];this._geometryFactory=e,this.computePoints(t),this.computeRing()};Bi.prototype.computeRing=function(){var t=this;if(this._ring!==null)return null;for(var e=new Array(this._pts.size()).fill(null),n=0;n<this._pts.size();n++)e[n]=t._pts.get(n);this._ring=this._geometryFactory.createLinearRing(e),this._isHole=Ce.isCCW(this._ring.getCoordinates())};Bi.prototype.isIsolated=function(){return this._label.getGeometryCount()===1};Bi.prototype.computePoints=function(t){var e=this;this._startDe=t;var n=t,r=!0;do{if(n===null)throw new zh("Found null DirectedEdge");if(n.getEdgeRing()===e)throw new zh("Directed Edge visited twice during ring-building at "+n.getCoordinate());e._edges.add(n);var i=n.getLabel();dn.isTrue(i.isArea()),e.mergeLabel(i),e.addPoints(n.getEdge(),n.isForward(),r),r=!1,e.setEdgeRing(n,e),n=e.getNext(n)}while(n!==this._startDe)};Bi.prototype.getLinearRing=function(){return this._ring};Bi.prototype.getCoordinate=function(t){return this._pts.get(t)};Bi.prototype.computeMaxNodeDegree=function(){var t=this;this._maxNodeDegree=0;var e=this._startDe;do{var n=e.getNode(),r=n.getEdges().getOutgoingDegree(t);r>t._maxNodeDegree&&(t._maxNodeDegree=r),e=t.getNext(e)}while(e!==this._startDe);this._maxNodeDegree*=2};Bi.prototype.addPoints=function(t,e,n){var r=this,i=t.getCoordinates();if(e){var a=1;n&&(a=0);for(var h=a;h<i.length;h++)r._pts.add(i[h])}else{var u=i.length-2;n&&(u=i.length-1);for(var _=u;_>=0;_--)r._pts.add(i[_])}};Bi.prototype.isHole=function(){return this._isHole};Bi.prototype.setInResult=function(){var t=this._startDe;do t.getEdge().setInResult(!0),t=t.getNext();while(t!==this._startDe)};Bi.prototype.containsPoint=function(t){var e=this.getLinearRing(),n=e.getEnvelopeInternal();if(!n.contains(t)||!Ce.isPointInRing(t,e.getCoordinates()))return!1;for(var r=this._holes.iterator();r.hasNext();){var i=r.next();if(i.containsPoint(t))return!1}return!0};Bi.prototype.addHole=function(t){this._holes.add(t)};Bi.prototype.isShell=function(){return this._shell===null};Bi.prototype.getLabel=function(){return this._label};Bi.prototype.getEdges=function(){return this._edges};Bi.prototype.getMaxNodeDegree=function(){return this._maxNodeDegree<0&&this.computeMaxNodeDegree(),this._maxNodeDegree};Bi.prototype.getShell=function(){return this._shell};Bi.prototype.mergeLabel=function(){if(arguments.length===1){var t=arguments[0];this.mergeLabel(t,0),this.mergeLabel(t,1)}else if(arguments.length===2){var e=arguments[0],n=arguments[1],r=e.getLocation(n,oe.RIGHT);if(r===Mt.NONE)return null;if(this._label.getLocation(n)===Mt.NONE)return this._label.setLocation(n,r),null}};Bi.prototype.setShell=function(t){this._shell=t,t!==null&&t.addHole(this)};Bi.prototype.toPolygon=function(t){for(var e=this,n=new Array(this._holes.size()).fill(null),r=0;r<this._holes.size();r++)n[r]=e._holes.get(r).getLinearRing();var i=t.createPolygon(this.getLinearRing(),n);return i};Bi.prototype.interfaces_=function(){return[]};Bi.prototype.getClass=function(){return Bi};var $O=function(t){function e(){var n=arguments[0],r=arguments[1];t.call(this,n,r)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.setEdgeRing=function(n,r){n.setMinEdgeRing(r)},e.prototype.getNext=function(n){return n.getNextMin()},e.prototype.interfaces_=function(){return[]},e.prototype.getClass=function(){return e},e}(Bi),VO=function(t){function e(){var n=arguments[0],r=arguments[1];t.call(this,n,r)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.buildMinimalRings=function(){var n=this,r=new de,i=this._startDe;do{if(i.getMinEdgeRing()===null){var a=new $O(i,n._geometryFactory);r.add(a)}i=i.getNext()}while(i!==this._startDe);return r},e.prototype.setEdgeRing=function(n,r){n.setEdgeRing(r)},e.prototype.linkDirectedEdgesForMinimalEdgeRings=function(){var n=this,r=this._startDe;do{var i=r.getNode();i.getEdges().linkMinimalDirectedEdges(n),r=r.getNext()}while(r!==this._startDe)},e.prototype.getNext=function(n){return n.getNext()},e.prototype.interfaces_=function(){return[]},e.prototype.getClass=function(){return e},e}(Bi),tu=function(){if(this._label=null,this._isInResult=!1,this._isCovered=!1,this._isCoveredSet=!1,this._isVisited=!1,arguments.length!==0&&arguments.length===1){var t=arguments[0];this._label=t}};tu.prototype.setVisited=function(t){this._isVisited=t};tu.prototype.setInResult=function(t){this._isInResult=t};tu.prototype.isCovered=function(){return this._isCovered};tu.prototype.isCoveredSet=function(){return this._isCoveredSet};tu.prototype.setLabel=function(t){this._label=t};tu.prototype.getLabel=function(){return this._label};tu.prototype.setCovered=function(t){this._isCovered=t,this._isCoveredSet=!0};tu.prototype.updateIM=function(t){dn.isTrue(this._label.getGeometryCount()>=2,"found partial label"),this.computeIM(t)};tu.prototype.isInResult=function(){return this._isInResult};tu.prototype.isVisited=function(){return this._isVisited};tu.prototype.interfaces_=function(){return[]};tu.prototype.getClass=function(){return tu};var A0=function(t){function e(){t.call(this),this._coord=null,this._edges=null;var n=arguments[0],r=arguments[1];this._coord=n,this._edges=r,this._label=new fr(0,Mt.NONE)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.isIncidentEdgeInResult=function(){for(var n=this.getEdges().getEdges().iterator();n.hasNext();){var r=n.next();if(r.getEdge().isInResult())return!0}return!1},e.prototype.isIsolated=function(){return this._label.getGeometryCount()===1},e.prototype.getCoordinate=function(){return this._coord},e.prototype.print=function(n){n.println("node "+this._coord+" lbl: "+this._label)},e.prototype.computeIM=function(n){},e.prototype.computeMergedLocation=function(n,r){var i=Mt.NONE;if(i=this._label.getLocation(r),!n.isNull(r)){var a=n.getLocation(r);i!==Mt.BOUNDARY&&(i=a)}return i},e.prototype.setLabel=function(){if(arguments.length===2){var n=arguments[0],r=arguments[1];this._label===null?this._label=new fr(n,r):this._label.setLocation(n,r)}else return t.prototype.setLabel.apply(this,arguments)},e.prototype.getEdges=function(){return this._edges},e.prototype.mergeLabel=function(){var n=this;if(arguments[0]instanceof e){var r=arguments[0];this.mergeLabel(r._label)}else if(arguments[0]instanceof fr)for(var i=arguments[0],a=0;a<2;a++){var h=n.computeMergedLocation(i,a),u=n._label.getLocation(a);u===Mt.NONE&&n._label.setLocation(a,h)}},e.prototype.add=function(n){this._edges.insert(n),n.setNode(this)},e.prototype.setLabelBoundary=function(n){if(this._label===null)return null;var r=Mt.NONE;this._label!==null&&(r=this._label.getLocation(n));var i=null;switch(r){case Mt.BOUNDARY:i=Mt.INTERIOR;break;case Mt.INTERIOR:i=Mt.BOUNDARY;break;default:i=Mt.BOUNDARY;break}this._label.setLocation(n,i)},e.prototype.interfaces_=function(){return[]},e.prototype.getClass=function(){return e},e}(tu),ac=function(){this.nodeMap=new ns,this.nodeFact=null;var t=arguments[0];this.nodeFact=t};ac.prototype.find=function(t){return this.nodeMap.get(t)};ac.prototype.addNode=function(){if(arguments[0]instanceof Lt){var t=arguments[0],e=this.nodeMap.get(t);return e===null&&(e=this.nodeFact.createNode(t),this.nodeMap.put(t,e)),e}else if(arguments[0]instanceof A0){var n=arguments[0],r=this.nodeMap.get(n.getCoordinate());return r===null?(this.nodeMap.put(n.getCoordinate(),n),n):(r.mergeLabel(n),r)}};ac.prototype.print=function(t){for(var e=this.iterator();e.hasNext();){var n=e.next();n.print(t)}};ac.prototype.iterator=function(){return this.nodeMap.values().iterator()};ac.prototype.values=function(){return this.nodeMap.values()};ac.prototype.getBoundaryNodes=function(t){for(var e=new de,n=this.iterator();n.hasNext();){var r=n.next();r.getLabel().getLocation(t)===Mt.BOUNDARY&&e.add(r)}return e};ac.prototype.add=function(t){var e=t.getCoordinate(),n=this.addNode(e);n.add(t)};ac.prototype.interfaces_=function(){return[]};ac.prototype.getClass=function(){return ac};var gr=function(){},O_={NE:{configurable:!0},NW:{configurable:!0},SW:{configurable:!0},SE:{configurable:!0}};gr.prototype.interfaces_=function(){return[]};gr.prototype.getClass=function(){return gr};gr.isNorthern=function(t){return t===gr.NE||t===gr.NW};gr.isOpposite=function(t,e){if(t===e)return!1;var n=(t-e+4)%4;return n===2};gr.commonHalfPlane=function(t,e){if(t===e)return t;var n=(t-e+4)%4;if(n===2)return-1;var r=t<e?t:e,i=t>e?t:e;return r===0&&i===3?3:r};gr.isInHalfPlane=function(t,e){return e===gr.SE?t===gr.SE||t===gr.SW:t===e||t===e+1};gr.quadrant=function(){if(typeof arguments[0]=="number"&&typeof arguments[1]=="number"){var t=arguments[0],e=arguments[1];if(t===0&&e===0)throw new Yr("Cannot compute the quadrant for point ( "+t+", "+e+" )");return t>=0?e>=0?gr.NE:gr.SE:e>=0?gr.NW:gr.SW}else if(arguments[0]instanceof Lt&&arguments[1]instanceof Lt){var n=arguments[0],r=arguments[1];if(r.x===n.x&&r.y===n.y)throw new Yr("Cannot compute the quadrant for two identical points "+n);return r.x>=n.x?r.y>=n.y?gr.NE:gr.SE:r.y>=n.y?gr.NW:gr.SW}};O_.NE.get=function(){return 0};O_.NW.get=function(){return 1};O_.SW.get=function(){return 2};O_.SE.get=function(){return 3};Object.defineProperties(gr,O_);var rs=function(){if(this._edge=null,this._label=null,this._node=null,this._p0=null,this._p1=null,this._dx=null,this._dy=null,this._quadrant=null,arguments.length===1){var t=arguments[0];this._edge=t}else if(arguments.length===3){var e=arguments[0],n=arguments[1],r=arguments[2],i=null;this._edge=e,this.init(n,r),this._label=i}else if(arguments.length===4){var a=arguments[0],h=arguments[1],u=arguments[2],_=arguments[3];this._edge=a,this.init(h,u),this._label=_}};rs.prototype.compareDirection=function(t){return this._dx===t._dx&&this._dy===t._dy?0:this._quadrant>t._quadrant?1:this._quadrant<t._quadrant?-1:Ce.computeOrientation(t._p0,t._p1,this._p1)};rs.prototype.getDy=function(){return this._dy};rs.prototype.getCoordinate=function(){return this._p0};rs.prototype.setNode=function(t){this._node=t};rs.prototype.print=function(t){var e=Math.atan2(this._dy,this._dx),n=this.getClass().getName(),r=n.lastIndexOf("."),i=n.substring(r+1);t.print("  "+i+": "+this._p0+" - "+this._p1+" "+this._quadrant+":"+e+"   "+this._label)};rs.prototype.compareTo=function(t){var e=t;return this.compareDirection(e)};rs.prototype.getDirectedCoordinate=function(){return this._p1};rs.prototype.getDx=function(){return this._dx};rs.prototype.getLabel=function(){return this._label};rs.prototype.getEdge=function(){return this._edge};rs.prototype.getQuadrant=function(){return this._quadrant};rs.prototype.getNode=function(){return this._node};rs.prototype.toString=function(){var t=Math.atan2(this._dy,this._dx),e=this.getClass().getName(),n=e.lastIndexOf("."),r=e.substring(n+1);return"  "+r+": "+this._p0+" - "+this._p1+" "+this._quadrant+":"+t+"   "+this._label};rs.prototype.computeLabel=function(t){};rs.prototype.init=function(t,e){this._p0=t,this._p1=e,this._dx=e.x-t.x,this._dy=e.y-t.y,this._quadrant=gr.quadrant(this._dx,this._dy),dn.isTrue(!(this._dx===0&&this._dy===0),"EdgeEnd with identical endpoints found")};rs.prototype.interfaces_=function(){return[Pu]};rs.prototype.getClass=function(){return rs};var fb=function(t){function e(){var n=arguments[0],r=arguments[1];if(t.call(this,n),this._isForward=null,this._isInResult=!1,this._isVisited=!1,this._sym=null,this._next=null,this._nextMin=null,this._edgeRing=null,this._minEdgeRing=null,this._depth=[0,-999,-999],this._isForward=r,r)this.init(n.getCoordinate(0),n.getCoordinate(1));else{var i=n.getNumPoints()-1;this.init(n.getCoordinate(i),n.getCoordinate(i-1))}this.computeDirectedLabel()}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.getNextMin=function(){return this._nextMin},e.prototype.getDepth=function(n){return this._depth[n]},e.prototype.setVisited=function(n){this._isVisited=n},e.prototype.computeDirectedLabel=function(){this._label=new fr(this._edge.getLabel()),this._isForward||this._label.flip()},e.prototype.getNext=function(){return this._next},e.prototype.setDepth=function(n,r){if(this._depth[n]!==-999&&this._depth[n]!==r)throw new zh("assigned depths do not match",this.getCoordinate());this._depth[n]=r},e.prototype.isInteriorAreaEdge=function(){for(var n=this,r=!0,i=0;i<2;i++)n._label.isArea(i)&&n._label.getLocation(i,oe.LEFT)===Mt.INTERIOR&&n._label.getLocation(i,oe.RIGHT)===Mt.INTERIOR||(r=!1);return r},e.prototype.setNextMin=function(n){this._nextMin=n},e.prototype.print=function(n){t.prototype.print.call(this,n),n.print(" "+this._depth[oe.LEFT]+"/"+this._depth[oe.RIGHT]),n.print(" ("+this.getDepthDelta()+")"),this._isInResult&&n.print(" inResult")},e.prototype.setMinEdgeRing=function(n){this._minEdgeRing=n},e.prototype.isLineEdge=function(){var n=this._label.isLine(0)||this._label.isLine(1),r=!this._label.isArea(0)||this._label.allPositionsEqual(0,Mt.EXTERIOR),i=!this._label.isArea(1)||this._label.allPositionsEqual(1,Mt.EXTERIOR);return n&&r&&i},e.prototype.setEdgeRing=function(n){this._edgeRing=n},e.prototype.getMinEdgeRing=function(){return this._minEdgeRing},e.prototype.getDepthDelta=function(){var n=this._edge.getDepthDelta();return this._isForward||(n=-n),n},e.prototype.setInResult=function(n){this._isInResult=n},e.prototype.getSym=function(){return this._sym},e.prototype.isForward=function(){return this._isForward},e.prototype.getEdge=function(){return this._edge},e.prototype.printEdge=function(n){this.print(n),n.print(" "),this._isForward?this._edge.print(n):this._edge.printReverse(n)},e.prototype.setSym=function(n){this._sym=n},e.prototype.setVisitedEdge=function(n){this.setVisited(n),this._sym.setVisited(n)},e.prototype.setEdgeDepths=function(n,r){var i=this.getEdge().getDepthDelta();this._isForward||(i=-i);var a=1;n===oe.LEFT&&(a=-1);var h=oe.opposite(n),u=i*a,_=r+u;this.setDepth(n,r),this.setDepth(h,_)},e.prototype.getEdgeRing=function(){return this._edgeRing},e.prototype.isInResult=function(){return this._isInResult},e.prototype.setNext=function(n){this._next=n},e.prototype.isVisited=function(){return this._isVisited},e.prototype.interfaces_=function(){return[]},e.prototype.getClass=function(){return e},e.depthFactor=function(n,r){return n===Mt.EXTERIOR&&r===Mt.INTERIOR?1:n===Mt.INTERIOR&&r===Mt.EXTERIOR?-1:0},e}(rs),xm=function(){};xm.prototype.createNode=function(t){return new A0(t,null)};xm.prototype.interfaces_=function(){return[]};xm.prototype.getClass=function(){return xm};var ti=function(){if(this._edges=new de,this._nodes=null,this._edgeEndList=new de,arguments.length===0)this._nodes=new ac(new xm);else if(arguments.length===1){var t=arguments[0];this._nodes=new ac(t)}};ti.prototype.printEdges=function(t){var e=this;t.println("Edges:");for(var n=0;n<this._edges.size();n++){t.println("edge "+n+":");var r=e._edges.get(n);r.print(t),r.eiList.print(t)}};ti.prototype.find=function(t){return this._nodes.find(t)};ti.prototype.addNode=function(){if(arguments[0]instanceof A0){var t=arguments[0];return this._nodes.addNode(t)}else if(arguments[0]instanceof Lt){var e=arguments[0];return this._nodes.addNode(e)}};ti.prototype.getNodeIterator=function(){return this._nodes.iterator()};ti.prototype.linkResultDirectedEdges=function(){for(var t=this._nodes.iterator();t.hasNext();){var e=t.next();e.getEdges().linkResultDirectedEdges()}};ti.prototype.debugPrintln=function(t){ko.out.println(t)};ti.prototype.isBoundaryNode=function(t,e){var n=this._nodes.find(e);if(n===null)return!1;var r=n.getLabel();return r!==null&&r.getLocation(t)===Mt.BOUNDARY};ti.prototype.linkAllDirectedEdges=function(){for(var t=this._nodes.iterator();t.hasNext();){var e=t.next();e.getEdges().linkAllDirectedEdges()}};ti.prototype.matchInSameDirection=function(t,e,n,r){return t.equals(n)?Ce.computeOrientation(t,e,r)===Ce.COLLINEAR&&gr.quadrant(t,e)===gr.quadrant(n,r):!1};ti.prototype.getEdgeEnds=function(){return this._edgeEndList};ti.prototype.debugPrint=function(t){ko.out.print(t)};ti.prototype.getEdgeIterator=function(){return this._edges.iterator()};ti.prototype.findEdgeInSameDirection=function(t,e){for(var n=this,r=0;r<this._edges.size();r++){var i=n._edges.get(r),a=i.getCoordinates();if(n.matchInSameDirection(t,e,a[0],a[1])||n.matchInSameDirection(t,e,a[a.length-1],a[a.length-2]))return i}return null};ti.prototype.insertEdge=function(t){this._edges.add(t)};ti.prototype.findEdgeEnd=function(t){for(var e=this.getEdgeEnds().iterator();e.hasNext();){var n=e.next();if(n.getEdge()===t)return n}return null};ti.prototype.addEdges=function(t){for(var e=this,n=t.iterator();n.hasNext();){var r=n.next();e._edges.add(r);var i=new fb(r,!0),a=new fb(r,!1);i.setSym(a),a.setSym(i),e.add(i),e.add(a)}};ti.prototype.add=function(t){this._nodes.add(t),this._edgeEndList.add(t)};ti.prototype.getNodes=function(){return this._nodes.values()};ti.prototype.findEdge=function(t,e){for(var n=this,r=0;r<this._edges.size();r++){var i=n._edges.get(r),a=i.getCoordinates();if(t.equals(a[0])&&e.equals(a[1]))return i}return null};ti.prototype.interfaces_=function(){return[]};ti.prototype.getClass=function(){return ti};ti.linkResultDirectedEdges=function(t){for(var e=t.iterator();e.hasNext();){var n=e.next();n.getEdges().linkResultDirectedEdges()}};var Ea=function(){this._geometryFactory=null,this._shellList=new de;var t=arguments[0];this._geometryFactory=t};Ea.prototype.sortShellsAndHoles=function(t,e,n){for(var r=t.iterator();r.hasNext();){var i=r.next();i.isHole()?n.add(i):e.add(i)}};Ea.prototype.computePolygons=function(t){for(var e=this,n=new de,r=t.iterator();r.hasNext();){var i=r.next(),a=i.toPolygon(e._geometryFactory);n.add(a)}return n};Ea.prototype.placeFreeHoles=function(t,e){for(var n=this,r=e.iterator();r.hasNext();){var i=r.next();if(i.getShell()===null){var a=n.findEdgeRingContaining(i,t);if(a===null)throw new zh("unable to assign hole to a shell",i.getCoordinate(0));i.setShell(a)}}};Ea.prototype.buildMinimalEdgeRings=function(t,e,n){for(var r=this,i=new de,a=t.iterator();a.hasNext();){var h=a.next();if(h.getMaxNodeDegree()>2){h.linkDirectedEdgesForMinimalEdgeRings();var u=h.buildMinimalRings(),_=r.findShell(u);_!==null?(r.placePolygonHoles(_,u),e.add(_)):n.addAll(u)}else i.add(h)}return i};Ea.prototype.containsPoint=function(t){for(var e=this._shellList.iterator();e.hasNext();){var n=e.next();if(n.containsPoint(t))return!0}return!1};Ea.prototype.buildMaximalEdgeRings=function(t){for(var e=this,n=new de,r=t.iterator();r.hasNext();){var i=r.next();if(i.isInResult()&&i.getLabel().isArea()&&i.getEdgeRing()===null){var a=new VO(i,e._geometryFactory);n.add(a),a.setInResult()}}return n};Ea.prototype.placePolygonHoles=function(t,e){for(var n=e.iterator();n.hasNext();){var r=n.next();r.isHole()&&r.setShell(t)}};Ea.prototype.getPolygons=function(){var t=this.computePolygons(this._shellList);return t};Ea.prototype.findEdgeRingContaining=function(t,e){for(var n=t.getLinearRing(),r=n.getEnvelopeInternal(),i=n.getCoordinateN(0),a=null,h=null,u=e.iterator();u.hasNext();){var _=u.next(),w=_.getLinearRing(),C=w.getEnvelopeInternal();a!==null&&(h=a.getLinearRing().getEnvelopeInternal());var P=!1;C.contains(r)&&Ce.isPointInRing(i,w.getCoordinates())&&(P=!0),P&&(a===null||h.contains(C))&&(a=_)}return a};Ea.prototype.findShell=function(t){for(var e=0,n=null,r=t.iterator();r.hasNext();){var i=r.next();i.isHole()||(n=i,e++)}return dn.isTrue(e<=1,"found two shells in MinimalEdgeRing list"),n};Ea.prototype.add=function(){if(arguments.length===1){var t=arguments[0];this.add(t.getEdgeEnds(),t.getNodes())}else if(arguments.length===2){var e=arguments[0],n=arguments[1];ti.linkResultDirectedEdges(n);var r=this.buildMaximalEdgeRings(e),i=new de,a=this.buildMinimalEdgeRings(r,this._shellList,i);this.sortShellsAndHoles(a,this._shellList,i),this.placeFreeHoles(this._shellList,i)}};Ea.prototype.interfaces_=function(){return[]};Ea.prototype.getClass=function(){return Ea};var bm=function(){};bm.prototype.getBounds=function(){};bm.prototype.interfaces_=function(){return[]};bm.prototype.getClass=function(){return bm};var rl=function(){this._bounds=null,this._item=null;var t=arguments[0],e=arguments[1];this._bounds=t,this._item=e};rl.prototype.getItem=function(){return this._item};rl.prototype.getBounds=function(){return this._bounds};rl.prototype.interfaces_=function(){return[bm,Mu]};rl.prototype.getClass=function(){return rl};var Bh=function(){this._size=null,this._items=null,this._size=0,this._items=new de,this._items.add(null)};Bh.prototype.poll=function(){if(this.isEmpty())return null;var t=this._items.get(1);return this._items.set(1,this._items.get(this._size)),this._size-=1,this.reorder(1),t};Bh.prototype.size=function(){return this._size};Bh.prototype.reorder=function(t){for(var e=this,n=null,r=this._items.get(t);t*2<=this._size&&(n=t*2,n!==e._size&&e._items.get(n+1).compareTo(e._items.get(n))<0&&n++,e._items.get(n).compareTo(r)<0);t=n)e._items.set(t,e._items.get(n));this._items.set(t,r)};Bh.prototype.clear=function(){this._size=0,this._items.clear()};Bh.prototype.isEmpty=function(){return this._size===0};Bh.prototype.add=function(t){var e=this;this._items.add(null),this._size+=1;var n=this._size;for(this._items.set(0,t);t.compareTo(this._items.get(Math.trunc(n/2)))<0;n/=2)e._items.set(n,e._items.get(Math.trunc(n/2)));this._items.set(n,t)};Bh.prototype.interfaces_=function(){return[]};Bh.prototype.getClass=function(){return Bh};var zp=function(){};zp.prototype.visitItem=function(t){};zp.prototype.interfaces_=function(){return[]};zp.prototype.getClass=function(){return zp};var Xd=function(){};Xd.prototype.insert=function(t,e){};Xd.prototype.remove=function(t,e){};Xd.prototype.query=function(){};Xd.prototype.interfaces_=function(){return[]};Xd.prototype.getClass=function(){return Xd};var Qi=function(){if(this._childBoundables=new de,this._bounds=null,this._level=null,arguments.length!==0&&arguments.length===1){var t=arguments[0];this._level=t}},sT={serialVersionUID:{configurable:!0}};Qi.prototype.getLevel=function(){return this._level};Qi.prototype.size=function(){return this._childBoundables.size()};Qi.prototype.getChildBoundables=function(){return this._childBoundables};Qi.prototype.addChildBoundable=function(t){dn.isTrue(this._bounds===null),this._childBoundables.add(t)};Qi.prototype.isEmpty=function(){return this._childBoundables.isEmpty()};Qi.prototype.getBounds=function(){return this._bounds===null&&(this._bounds=this.computeBounds()),this._bounds};Qi.prototype.interfaces_=function(){return[bm,Mu]};Qi.prototype.getClass=function(){return Qi};sT.serialVersionUID.get=function(){return 6493722185909574e3};Object.defineProperties(Qi,sT);var il=function(){};il.reverseOrder=function(){return{compare:function(t,e){return e.compareTo(t)}}};il.min=function(t){return il.sort(t),t.get(0)};il.sort=function(t,e){var n=t.toArray();e?Rf.sort(n,e):Rf.sort(n);for(var r=t.iterator(),i=0,a=n.length;i<a;i++)r.next(),r.set(n[i])};il.singletonList=function(t){var e=new de;return e.add(t),e};var Oi=function(){this._boundable1=null,this._boundable2=null,this._distance=null,this._itemDistance=null;var t=arguments[0],e=arguments[1],n=arguments[2];this._boundable1=t,this._boundable2=e,this._itemDistance=n,this._distance=this.distance()};Oi.prototype.expandToQueue=function(t,e){var n=Oi.isComposite(this._boundable1),r=Oi.isComposite(this._boundable2);if(n&&r)return Oi.area(this._boundable1)>Oi.area(this._boundable2)?(this.expand(this._boundable1,this._boundable2,t,e),null):(this.expand(this._boundable2,this._boundable1,t,e),null);if(n)return this.expand(this._boundable1,this._boundable2,t,e),null;if(r)return this.expand(this._boundable2,this._boundable1,t,e),null;throw new Yr("neither boundable is composite")};Oi.prototype.isLeaves=function(){return!(Oi.isComposite(this._boundable1)||Oi.isComposite(this._boundable2))};Oi.prototype.compareTo=function(t){var e=t;return this._distance<e._distance?-1:this._distance>e._distance?1:0};Oi.prototype.expand=function(t,e,n,r){for(var i=this,a=t.getChildBoundables(),h=a.iterator();h.hasNext();){var u=h.next(),_=new Oi(u,e,i._itemDistance);_.getDistance()<r&&n.add(_)}};Oi.prototype.getBoundable=function(t){return t===0?this._boundable1:this._boundable2};Oi.prototype.getDistance=function(){return this._distance};Oi.prototype.distance=function(){return this.isLeaves()?this._itemDistance.distance(this._boundable1,this._boundable2):this._boundable1.getBounds().distance(this._boundable2.getBounds())};Oi.prototype.interfaces_=function(){return[Pu]};Oi.prototype.getClass=function(){return Oi};Oi.area=function(t){return t.getBounds().getArea()};Oi.isComposite=function(t){return t instanceof Qi};var Eo=function t(){if(this._root=null,this._built=!1,this._itemBoundables=new de,this._nodeCapacity=null,arguments.length===0){var e=t.DEFAULT_NODE_CAPACITY;this._nodeCapacity=e}else if(arguments.length===1){var n=arguments[0];dn.isTrue(n>1,"Node capacity must be greater than 1"),this._nodeCapacity=n}},D0={IntersectsOp:{configurable:!0},serialVersionUID:{configurable:!0},DEFAULT_NODE_CAPACITY:{configurable:!0}};Eo.prototype.getNodeCapacity=function(){return this._nodeCapacity};Eo.prototype.lastNode=function(t){return t.get(t.size()-1)};Eo.prototype.size=function(){var t=this;if(arguments.length===0)return this.isEmpty()?0:(this.build(),this.size(this._root));if(arguments.length===1){for(var e=arguments[0],n=0,r=e.getChildBoundables().iterator();r.hasNext();){var i=r.next();i instanceof Qi?n+=t.size(i):i instanceof rl&&(n+=1)}return n}};Eo.prototype.removeItem=function(t,e){for(var n=null,r=t.getChildBoundables().iterator();r.hasNext();){var i=r.next();i instanceof rl&&i.getItem()===e&&(n=i)}return n!==null?(t.getChildBoundables().remove(n),!0):!1};Eo.prototype.itemsTree=function(){var t=this;if(arguments.length===0){this.build();var e=this.itemsTree(this._root);return e===null?new de:e}else if(arguments.length===1){for(var n=arguments[0],r=new de,i=n.getChildBoundables().iterator();i.hasNext();){var a=i.next();if(a instanceof Qi){var h=t.itemsTree(a);h!==null&&r.add(h)}else a instanceof rl?r.add(a.getItem()):dn.shouldNeverReachHere()}return r.size()<=0?null:r}};Eo.prototype.insert=function(t,e){dn.isTrue(!this._built,"Cannot insert items into an STR packed R-tree after it has been built."),this._itemBoundables.add(new rl(t,e))};Eo.prototype.boundablesAtLevel=function(){var t=this;if(arguments.length===1){var e=arguments[0],n=new de;return this.boundablesAtLevel(e,this._root,n),n}else if(arguments.length===3){var r=arguments[0],i=arguments[1],a=arguments[2];if(dn.isTrue(r>-2),i.getLevel()===r)return a.add(i),null;for(var h=i.getChildBoundables().iterator();h.hasNext();){var u=h.next();u instanceof Qi?t.boundablesAtLevel(r,u,a):(dn.isTrue(u instanceof rl),r===-1&&a.add(u))}return null}};Eo.prototype.query=function(){var t=this;if(arguments.length===1){var e=arguments[0];this.build();var n=new de;return this.isEmpty()||this.getIntersectsOp().intersects(this._root.getBounds(),e)&&this.query(e,this._root,n),n}else if(arguments.length===2){var r=arguments[0],i=arguments[1];if(this.build(),this.isEmpty())return null;this.getIntersectsOp().intersects(this._root.getBounds(),r)&&this.query(r,this._root,i)}else if(arguments.length===3){if(en(arguments[2],zp)&&arguments[0]instanceof Object&&arguments[1]instanceof Qi)for(var a=arguments[0],h=arguments[1],u=arguments[2],_=h.getChildBoundables(),w=0;w<_.size();w++){var C=_.get(w);t.getIntersectsOp().intersects(C.getBounds(),a)&&(C instanceof Qi?t.query(a,C,u):C instanceof rl?u.visitItem(C.getItem()):dn.shouldNeverReachHere())}else if(en(arguments[2],Yu)&&arguments[0]instanceof Object&&arguments[1]instanceof Qi)for(var P=arguments[0],D=arguments[1],B=arguments[2],$=D.getChildBoundables(),Z=0;Z<$.size();Z++){var W=$.get(Z);t.getIntersectsOp().intersects(W.getBounds(),P)&&(W instanceof Qi?t.query(P,W,B):W instanceof rl?B.add(W.getItem()):dn.shouldNeverReachHere())}}};Eo.prototype.build=function(){if(this._built)return null;this._root=this._itemBoundables.isEmpty()?this.createNode(0):this.createHigherLevels(this._itemBoundables,-1),this._itemBoundables=null,this._built=!0};Eo.prototype.getRoot=function(){return this.build(),this._root};Eo.prototype.remove=function(){var t=this;if(arguments.length===2){var e=arguments[0],n=arguments[1];return this.build(),this.getIntersectsOp().intersects(this._root.getBounds(),e)?this.remove(e,this._root,n):!1}else if(arguments.length===3){var r=arguments[0],i=arguments[1],a=arguments[2],h=this.removeItem(i,a);if(h)return!0;for(var u=null,_=i.getChildBoundables().iterator();_.hasNext();){var w=_.next();if(t.getIntersectsOp().intersects(w.getBounds(),r)&&w instanceof Qi&&(h=t.remove(r,w,a),h)){u=w;break}}return u!==null&&u.getChildBoundables().isEmpty()&&i.getChildBoundables().remove(u),h}};Eo.prototype.createHigherLevels=function(t,e){dn.isTrue(!t.isEmpty());var n=this.createParentBoundables(t,e+1);return n.size()===1?n.get(0):this.createHigherLevels(n,e+1)};Eo.prototype.depth=function(){var t=this;if(arguments.length===0)return this.isEmpty()?0:(this.build(),this.depth(this._root));if(arguments.length===1){for(var e=arguments[0],n=0,r=e.getChildBoundables().iterator();r.hasNext();){var i=r.next();if(i instanceof Qi){var a=t.depth(i);a>n&&(n=a)}}return n+1}};Eo.prototype.createParentBoundables=function(t,e){var n=this;dn.isTrue(!t.isEmpty());var r=new de;r.add(this.createNode(e));var i=new de(t);il.sort(i,this.getComparator());for(var a=i.iterator();a.hasNext();){var h=a.next();n.lastNode(r).getChildBoundables().size()===n.getNodeCapacity()&&r.add(n.createNode(e)),n.lastNode(r).addChildBoundable(h)}return r};Eo.prototype.isEmpty=function(){return this._built?this._root.isEmpty():this._itemBoundables.isEmpty()};Eo.prototype.interfaces_=function(){return[Mu]};Eo.prototype.getClass=function(){return Eo};Eo.compareDoubles=function(t,e){return t>e?1:t<e?-1:0};D0.IntersectsOp.get=function(){return UO};D0.serialVersionUID.get=function(){return-3886435814360241e3};D0.DEFAULT_NODE_CAPACITY.get=function(){return 10};Object.defineProperties(Eo,D0);var UO=function(){},wm=function(){};wm.prototype.distance=function(t,e){};wm.prototype.interfaces_=function(){return[]};wm.prototype.getClass=function(){return wm};var aT=function(t){function e(r){r=r||e.DEFAULT_NODE_CAPACITY,t.call(this,r)}t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e;var n={STRtreeNode:{configurable:!0},serialVersionUID:{configurable:!0},xComparator:{configurable:!0},yComparator:{configurable:!0},intersectsOp:{configurable:!0},DEFAULT_NODE_CAPACITY:{configurable:!0}};return e.prototype.createParentBoundablesFromVerticalSlices=function(r,i){var a=this;dn.isTrue(r.length>0);for(var h=new de,u=0;u<r.length;u++)h.addAll(a.createParentBoundablesFromVerticalSlice(r[u],i));return h},e.prototype.createNode=function(r){return new wI(r)},e.prototype.size=function(){return arguments.length===0?t.prototype.size.call(this):t.prototype.size.apply(this,arguments)},e.prototype.insert=function(){if(arguments.length===2){var r=arguments[0],i=arguments[1];if(r.isNull())return null;t.prototype.insert.call(this,r,i)}else return t.prototype.insert.apply(this,arguments)},e.prototype.getIntersectsOp=function(){return e.intersectsOp},e.prototype.verticalSlices=function(r,i){for(var a=Math.trunc(Math.ceil(r.size()/i)),h=new Array(i).fill(null),u=r.iterator(),_=0;_<i;_++){h[_]=new de;for(var w=0;u.hasNext()&&w<a;){var C=u.next();h[_].add(C),w++}}return h},e.prototype.query=function(){if(arguments.length===1){var r=arguments[0];return t.prototype.query.call(this,r)}else if(arguments.length===2){var i=arguments[0],a=arguments[1];t.prototype.query.call(this,i,a)}else if(arguments.length===3){if(en(arguments[2],zp)&&arguments[0]instanceof Object&&arguments[1]instanceof Qi){var h=arguments[0],u=arguments[1],_=arguments[2];t.prototype.query.call(this,h,u,_)}else if(en(arguments[2],Yu)&&arguments[0]instanceof Object&&arguments[1]instanceof Qi){var w=arguments[0],C=arguments[1],P=arguments[2];t.prototype.query.call(this,w,C,P)}}},e.prototype.getComparator=function(){return e.yComparator},e.prototype.createParentBoundablesFromVerticalSlice=function(r,i){return t.prototype.createParentBoundables.call(this,r,i)},e.prototype.remove=function(){if(arguments.length===2){var r=arguments[0],i=arguments[1];return t.prototype.remove.call(this,r,i)}else return t.prototype.remove.apply(this,arguments)},e.prototype.depth=function(){return arguments.length===0?t.prototype.depth.call(this):t.prototype.depth.apply(this,arguments)},e.prototype.createParentBoundables=function(r,i){dn.isTrue(!r.isEmpty());var a=Math.trunc(Math.ceil(r.size()/this.getNodeCapacity())),h=new de(r);il.sort(h,e.xComparator);var u=this.verticalSlices(h,Math.trunc(Math.ceil(Math.sqrt(a))));return this.createParentBoundablesFromVerticalSlices(u,i)},e.prototype.nearestNeighbour=function(){if(arguments.length===1){if(en(arguments[0],wm)){var r=arguments[0],i=new Oi(this.getRoot(),this.getRoot(),r);return this.nearestNeighbour(i)}else if(arguments[0]instanceof Oi){var a=arguments[0];return this.nearestNeighbour(a,ln.POSITIVE_INFINITY)}}else if(arguments.length===2){if(arguments[0]instanceof e&&en(arguments[1],wm)){var h=arguments[0],u=arguments[1],_=new Oi(this.getRoot(),h.getRoot(),u);return this.nearestNeighbour(_)}else if(arguments[0]instanceof Oi&&typeof arguments[1]=="number"){var w=arguments[0],C=arguments[1],P=C,D=null,B=new Bh;for(B.add(w);!B.isEmpty()&&P>0;){var $=B.poll(),Z=$.getDistance();if(Z>=P)break;$.isLeaves()?(P=Z,D=$):$.expandToQueue(B,P)}return[D.getBoundable(0).getItem(),D.getBoundable(1).getItem()]}}else if(arguments.length===3){var W=arguments[0],rt=arguments[1],ct=arguments[2],pt=new rl(W,rt),gt=new Oi(this.getRoot(),pt,ct);return this.nearestNeighbour(gt)[0]}},e.prototype.interfaces_=function(){return[Xd,Mu]},e.prototype.getClass=function(){return e},e.centreX=function(r){return e.avg(r.getMinX(),r.getMaxX())},e.avg=function(r,i){return(r+i)/2},e.centreY=function(r){return e.avg(r.getMinY(),r.getMaxY())},n.STRtreeNode.get=function(){return wI},n.serialVersionUID.get=function(){return 0x39920f7d5f261e0},n.xComparator.get=function(){return{interfaces_:function(){return[pm]},compare:function(r,i){return t.compareDoubles(e.centreX(r.getBounds()),e.centreX(i.getBounds()))}}},n.yComparator.get=function(){return{interfaces_:function(){return[pm]},compare:function(r,i){return t.compareDoubles(e.centreY(r.getBounds()),e.centreY(i.getBounds()))}}},n.intersectsOp.get=function(){return{interfaces_:function(){return[t.IntersectsOp]},intersects:function(r,i){return r.intersects(i)}}},n.DEFAULT_NODE_CAPACITY.get=function(){return 10},Object.defineProperties(e,n),e}(Eo),wI=function(t){function e(){var n=arguments[0];t.call(this,n)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.computeBounds=function(){for(var n=null,r=this.getChildBoundables().iterator();r.hasNext();){var i=r.next();n===null?n=new $e(i.getBounds()):n.expandToInclude(i.getBounds())}return n},e.prototype.interfaces_=function(){return[]},e.prototype.getClass=function(){return e},e}(Qi),Zs=function(){};Zs.prototype.interfaces_=function(){return[]};Zs.prototype.getClass=function(){return Zs};Zs.relativeSign=function(t,e){return t<e?-1:t>e?1:0};Zs.compare=function(t,e,n){if(e.equals2D(n))return 0;var r=Zs.relativeSign(e.x,n.x),i=Zs.relativeSign(e.y,n.y);switch(t){case 0:return Zs.compareValue(r,i);case 1:return Zs.compareValue(i,r);case 2:return Zs.compareValue(i,-r);case 3:return Zs.compareValue(-r,i);case 4:return Zs.compareValue(-r,-i);case 5:return Zs.compareValue(-i,-r);case 6:return Zs.compareValue(-i,r);case 7:return Zs.compareValue(r,-i)}return dn.shouldNeverReachHere("invalid octant value"),0};Zs.compareValue=function(t,e){return t<0?-1:t>0?1:e<0?-1:e>0?1:0};var Bp=function(){this._segString=null,this.coord=null,this.segmentIndex=null,this._segmentOctant=null,this._isInterior=null;var t=arguments[0],e=arguments[1],n=arguments[2],r=arguments[3];this._segString=t,this.coord=new Lt(e),this.segmentIndex=n,this._segmentOctant=r,this._isInterior=!e.equals2D(t.getCoordinate(n))};Bp.prototype.getCoordinate=function(){return this.coord};Bp.prototype.print=function(t){t.print(this.coord),t.print(" seg # = "+this.segmentIndex)};Bp.prototype.compareTo=function(t){var e=t;return this.segmentIndex<e.segmentIndex?-1:this.segmentIndex>e.segmentIndex?1:this.coord.equals2D(e.coord)?0:Zs.compare(this._segmentOctant,this.coord,e.coord)};Bp.prototype.isEndPoint=function(t){return this.segmentIndex===0&&!this._isInterior||this.segmentIndex===t};Bp.prototype.isInterior=function(){return this._isInterior};Bp.prototype.interfaces_=function(){return[Pu]};Bp.prototype.getClass=function(){return Bp};var Rs=function(){this._nodeMap=new ns,this._edge=null;var t=arguments[0];this._edge=t};Rs.prototype.getSplitCoordinates=function(){var t=this,e=new A_;this.addEndpoints();for(var n=this.iterator(),r=n.next();n.hasNext();){var i=n.next();t.addEdgeCoordinates(r,i,e),r=i}return e.toCoordinateArray()};Rs.prototype.addCollapsedNodes=function(){var t=this,e=new de;this.findCollapsesFromInsertedNodes(e),this.findCollapsesFromExistingVertices(e);for(var n=e.iterator();n.hasNext();){var r=n.next().intValue();t.add(t._edge.getCoordinate(r),r)}};Rs.prototype.print=function(t){t.println("Intersections:");for(var e=this.iterator();e.hasNext();){var n=e.next();n.print(t)}};Rs.prototype.findCollapsesFromExistingVertices=function(t){for(var e=this,n=0;n<this._edge.size()-2;n++){var r=e._edge.getCoordinate(n),i=e._edge.getCoordinate(n+2);r.equals2D(i)&&t.add(new nc(n+1))}};Rs.prototype.addEdgeCoordinates=function(t,e,n){var r=this,i=this._edge.getCoordinate(e.segmentIndex),a=e.isInterior()||!e.coord.equals2D(i);n.add(new Lt(t.coord),!1);for(var h=t.segmentIndex+1;h<=e.segmentIndex;h++)n.add(r._edge.getCoordinate(h));a&&n.add(new Lt(e.coord))};Rs.prototype.iterator=function(){return this._nodeMap.values().iterator()};Rs.prototype.addSplitEdges=function(t){var e=this;this.addEndpoints(),this.addCollapsedNodes();for(var n=this.iterator(),r=n.next();n.hasNext();){var i=n.next(),a=e.createSplitEdge(r,i);t.add(a),r=i}};Rs.prototype.findCollapseIndex=function(t,e,n){if(!t.coord.equals2D(e.coord))return!1;var r=e.segmentIndex-t.segmentIndex;return e.isInterior()||r--,r===1?(n[0]=t.segmentIndex+1,!0):!1};Rs.prototype.findCollapsesFromInsertedNodes=function(t){for(var e=this,n=new Array(1).fill(null),r=this.iterator(),i=r.next();r.hasNext();){var a=r.next(),h=e.findCollapseIndex(i,a,n);h&&t.add(new nc(n[0])),i=a}};Rs.prototype.getEdge=function(){return this._edge};Rs.prototype.addEndpoints=function(){var t=this._edge.size()-1;this.add(this._edge.getCoordinate(0),0),this.add(this._edge.getCoordinate(t),t)};Rs.prototype.createSplitEdge=function(t,e){var n=this,r=e.segmentIndex-t.segmentIndex+2,i=this._edge.getCoordinate(e.segmentIndex),a=e.isInterior()||!e.coord.equals2D(i);a||r--;var h=new Array(r).fill(null),u=0;h[u++]=new Lt(t.coord);for(var _=t.segmentIndex+1;_<=e.segmentIndex;_++)h[u++]=n._edge.getCoordinate(_);return a&&(h[u]=new Lt(e.coord)),new Si(h,this._edge.getData())};Rs.prototype.add=function(t,e){var n=new Bp(this._edge,t,e,this._edge.getSegmentOctant(e)),r=this._nodeMap.get(n);return r!==null?(dn.isTrue(r.coord.equals2D(t),"Found equal nodes with different coordinates"),r):(this._nodeMap.put(n,n),n)};Rs.prototype.checkSplitEdgesCorrectness=function(t){var e=this._edge.getCoordinates(),n=t.get(0),r=n.getCoordinate(0);if(!r.equals2D(e[0]))throw new Fh("bad split edge start point at "+r);var i=t.get(t.size()-1),a=i.getCoordinates(),h=a[a.length-1];if(!h.equals2D(e[e.length-1]))throw new Fh("bad split edge end point at "+h)};Rs.prototype.interfaces_=function(){return[]};Rs.prototype.getClass=function(){return Rs};var Yd=function(){};Yd.prototype.interfaces_=function(){return[]};Yd.prototype.getClass=function(){return Yd};Yd.octant=function(){if(typeof arguments[0]=="number"&&typeof arguments[1]=="number"){var t=arguments[0],e=arguments[1];if(t===0&&e===0)throw new Yr("Cannot compute the octant for point ( "+t+", "+e+" )");var n=Math.abs(t),r=Math.abs(e);return t>=0?e>=0?n>=r?0:1:n>=r?7:6:e>=0?n>=r?3:2:n>=r?4:5}else if(arguments[0]instanceof Lt&&arguments[1]instanceof Lt){var i=arguments[0],a=arguments[1],h=a.x-i.x,u=a.y-i.y;if(h===0&&u===0)throw new Yr("Cannot compute the octant for two identical points "+i);return Yd.octant(h,u)}};var Hc=function(){};Hc.prototype.getCoordinates=function(){};Hc.prototype.size=function(){};Hc.prototype.getCoordinate=function(t){};Hc.prototype.isClosed=function(){};Hc.prototype.setData=function(t){};Hc.prototype.getData=function(){};Hc.prototype.interfaces_=function(){return[]};Hc.prototype.getClass=function(){return Hc};var p_=function(){};p_.prototype.addIntersection=function(t,e){};p_.prototype.interfaces_=function(){return[Hc]};p_.prototype.getClass=function(){return p_};var Si=function(){this._nodeList=new Rs(this),this._pts=null,this._data=null;var t=arguments[0],e=arguments[1];this._pts=t,this._data=e};Si.prototype.getCoordinates=function(){return this._pts};Si.prototype.size=function(){return this._pts.length};Si.prototype.getCoordinate=function(t){return this._pts[t]};Si.prototype.isClosed=function(){return this._pts[0].equals(this._pts[this._pts.length-1])};Si.prototype.getSegmentOctant=function(t){return t===this._pts.length-1?-1:this.safeOctant(this.getCoordinate(t),this.getCoordinate(t+1))};Si.prototype.setData=function(t){this._data=t};Si.prototype.safeOctant=function(t,e){return t.equals2D(e)?0:Yd.octant(t,e)};Si.prototype.getData=function(){return this._data};Si.prototype.addIntersection=function(){if(arguments.length===2){var t=arguments[0],e=arguments[1];this.addIntersectionNode(t,e)}else if(arguments.length===4){var n=arguments[0],r=arguments[1],i=arguments[3],a=new Lt(n.getIntersection(i));this.addIntersection(a,r)}};Si.prototype.toString=function(){return el.toLineString(new _i(this._pts))};Si.prototype.getNodeList=function(){return this._nodeList};Si.prototype.addIntersectionNode=function(t,e){var n=e,r=n+1;if(r<this._pts.length){var i=this._pts[r];t.equals2D(i)&&(n=r)}var a=this._nodeList.add(t,n);return a};Si.prototype.addIntersections=function(t,e,n){for(var r=this,i=0;i<t.getIntersectionNum();i++)r.addIntersection(t,e,n,i)};Si.prototype.interfaces_=function(){return[p_]};Si.prototype.getClass=function(){return Si};Si.getNodedSubstrings=function(){if(arguments.length===1){var t=arguments[0],e=new de;return Si.getNodedSubstrings(t,e),e}else if(arguments.length===2)for(var n=arguments[0],r=arguments[1],i=n.iterator();i.hasNext();){var a=i.next();a.getNodeList().addSplitEdges(r)}};var Ue=function(){if(this.p0=null,this.p1=null,arguments.length===0)this.p0=new Lt,this.p1=new Lt;else if(arguments.length===1){var t=arguments[0];this.p0=new Lt(t.p0),this.p1=new Lt(t.p1)}else if(arguments.length===2)this.p0=arguments[0],this.p1=arguments[1];else if(arguments.length===4){var e=arguments[0],n=arguments[1],r=arguments[2],i=arguments[3];this.p0=new Lt(e,n),this.p1=new Lt(r,i)}},uT={serialVersionUID:{configurable:!0}};Ue.prototype.minX=function(){return Math.min(this.p0.x,this.p1.x)};Ue.prototype.orientationIndex=function(){if(arguments[0]instanceof Ue){var t=arguments[0],e=Ce.orientationIndex(this.p0,this.p1,t.p0),n=Ce.orientationIndex(this.p0,this.p1,t.p1);return e>=0&&n>=0||e<=0&&n<=0?Math.max(e,n):0}else if(arguments[0]instanceof Lt){var r=arguments[0];return Ce.orientationIndex(this.p0,this.p1,r)}};Ue.prototype.toGeometry=function(t){return t.createLineString([this.p0,this.p1])};Ue.prototype.isVertical=function(){return this.p0.x===this.p1.x};Ue.prototype.equals=function(t){if(!(t instanceof Ue))return!1;var e=t;return this.p0.equals(e.p0)&&this.p1.equals(e.p1)};Ue.prototype.intersection=function(t){var e=new cd;return e.computeIntersection(this.p0,this.p1,t.p0,t.p1),e.hasIntersection()?e.getIntersection(0):null};Ue.prototype.project=function(){if(arguments[0]instanceof Lt){var t=arguments[0];if(t.equals(this.p0)||t.equals(this.p1))return new Lt(t);var e=this.projectionFactor(t),n=new Lt;return n.x=this.p0.x+e*(this.p1.x-this.p0.x),n.y=this.p0.y+e*(this.p1.y-this.p0.y),n}else if(arguments[0]instanceof Ue){var r=arguments[0],i=this.projectionFactor(r.p0),a=this.projectionFactor(r.p1);if(i>=1&&a>=1||i<=0&&a<=0)return null;var h=this.project(r.p0);i<0&&(h=this.p0),i>1&&(h=this.p1);var u=this.project(r.p1);return a<0&&(u=this.p0),a>1&&(u=this.p1),new Ue(h,u)}};Ue.prototype.normalize=function(){this.p1.compareTo(this.p0)<0&&this.reverse()};Ue.prototype.angle=function(){return Math.atan2(this.p1.y-this.p0.y,this.p1.x-this.p0.x)};Ue.prototype.getCoordinate=function(t){return t===0?this.p0:this.p1};Ue.prototype.distancePerpendicular=function(t){return Ce.distancePointLinePerpendicular(t,this.p0,this.p1)};Ue.prototype.minY=function(){return Math.min(this.p0.y,this.p1.y)};Ue.prototype.midPoint=function(){return Ue.midPoint(this.p0,this.p1)};Ue.prototype.projectionFactor=function(t){if(t.equals(this.p0))return 0;if(t.equals(this.p1))return 1;var e=this.p1.x-this.p0.x,n=this.p1.y-this.p0.y,r=e*e+n*n;if(r<=0)return ln.NaN;var i=((t.x-this.p0.x)*e+(t.y-this.p0.y)*n)/r;return i};Ue.prototype.closestPoints=function(t){var e=this.intersection(t);if(e!==null)return[e,e];var n=new Array(2).fill(null),r=ln.MAX_VALUE,i=null,a=this.closestPoint(t.p0);r=a.distance(t.p0),n[0]=a,n[1]=t.p0;var h=this.closestPoint(t.p1);i=h.distance(t.p1),i<r&&(r=i,n[0]=h,n[1]=t.p1);var u=t.closestPoint(this.p0);i=u.distance(this.p0),i<r&&(r=i,n[0]=this.p0,n[1]=u);var _=t.closestPoint(this.p1);return i=_.distance(this.p1),i<r&&(r=i,n[0]=this.p1,n[1]=_),n};Ue.prototype.closestPoint=function(t){var e=this.projectionFactor(t);if(e>0&&e<1)return this.project(t);var n=this.p0.distance(t),r=this.p1.distance(t);return n<r?this.p0:this.p1};Ue.prototype.maxX=function(){return Math.max(this.p0.x,this.p1.x)};Ue.prototype.getLength=function(){return this.p0.distance(this.p1)};Ue.prototype.compareTo=function(t){var e=t,n=this.p0.compareTo(e.p0);return n!==0?n:this.p1.compareTo(e.p1)};Ue.prototype.reverse=function(){var t=this.p0;this.p0=this.p1,this.p1=t};Ue.prototype.equalsTopo=function(t){return this.p0.equals(t.p0)&&(this.p1.equals(t.p1)||this.p0.equals(t.p1))&&this.p1.equals(t.p0)};Ue.prototype.lineIntersection=function(t){try{var e=Xu.intersection(this.p0,this.p1,t.p0,t.p1);return e}catch(n){if(!(n instanceof $m))throw n}finally{}return null};Ue.prototype.maxY=function(){return Math.max(this.p0.y,this.p1.y)};Ue.prototype.pointAlongOffset=function(t,e){var n=this.p0.x+t*(this.p1.x-this.p0.x),r=this.p0.y+t*(this.p1.y-this.p0.y),i=this.p1.x-this.p0.x,a=this.p1.y-this.p0.y,h=Math.sqrt(i*i+a*a),u=0,_=0;if(e!==0){if(h<=0)throw new Error("Cannot compute offset from zero-length line segment");u=e*i/h,_=e*a/h}var w=n-_,C=r+u,P=new Lt(w,C);return P};Ue.prototype.setCoordinates=function(){if(arguments.length===1){var t=arguments[0];this.setCoordinates(t.p0,t.p1)}else if(arguments.length===2){var e=arguments[0],n=arguments[1];this.p0.x=e.x,this.p0.y=e.y,this.p1.x=n.x,this.p1.y=n.y}};Ue.prototype.segmentFraction=function(t){var e=this.projectionFactor(t);return e<0?e=0:(e>1||ln.isNaN(e))&&(e=1),e};Ue.prototype.toString=function(){return"LINESTRING( "+this.p0.x+" "+this.p0.y+", "+this.p1.x+" "+this.p1.y+")"};Ue.prototype.isHorizontal=function(){return this.p0.y===this.p1.y};Ue.prototype.distance=function(){if(arguments[0]instanceof Ue){var t=arguments[0];return Ce.distanceLineLine(this.p0,this.p1,t.p0,t.p1)}else if(arguments[0]instanceof Lt){var e=arguments[0];return Ce.distancePointLine(e,this.p0,this.p1)}};Ue.prototype.pointAlong=function(t){var e=new Lt;return e.x=this.p0.x+t*(this.p1.x-this.p0.x),e.y=this.p0.y+t*(this.p1.y-this.p0.y),e};Ue.prototype.hashCode=function(){var t=ln.doubleToLongBits(this.p0.x);t^=ln.doubleToLongBits(this.p0.y)*31;var e=Math.trunc(t)^Math.trunc(t>>32),n=ln.doubleToLongBits(this.p1.x);n^=ln.doubleToLongBits(this.p1.y)*31;var r=Math.trunc(n)^Math.trunc(n>>32);return e^r};Ue.prototype.interfaces_=function(){return[Pu,Mu]};Ue.prototype.getClass=function(){return Ue};Ue.midPoint=function(t,e){return new Lt((t.x+e.x)/2,(t.y+e.y)/2)};uT.serialVersionUID.get=function(){return 0x2d2172135f411c00};Object.defineProperties(Ue,uT);var f_=function(){this.tempEnv1=new $e,this.tempEnv2=new $e,this._overlapSeg1=new Ue,this._overlapSeg2=new Ue};f_.prototype.overlap=function(){if(arguments.length!==2&&arguments.length===4){var t=arguments[0],e=arguments[1],n=arguments[2],r=arguments[3];t.getLineSegment(e,this._overlapSeg1),n.getLineSegment(r,this._overlapSeg2),this.overlap(this._overlapSeg1,this._overlapSeg2)}};f_.prototype.interfaces_=function(){return[]};f_.prototype.getClass=function(){return f_};var Ia=function(){this._pts=null,this._start=null,this._end=null,this._env=null,this._context=null,this._id=null;var t=arguments[0],e=arguments[1],n=arguments[2],r=arguments[3];this._pts=t,this._start=e,this._end=n,this._context=r};Ia.prototype.getLineSegment=function(t,e){e.p0=this._pts[t],e.p1=this._pts[t+1]};Ia.prototype.computeSelect=function(t,e,n,r){var i=this._pts[e],a=this._pts[n];if(r.tempEnv1.init(i,a),n-e===1)return r.select(this,e),null;if(!t.intersects(r.tempEnv1))return null;var h=Math.trunc((e+n)/2);e<h&&this.computeSelect(t,e,h,r),h<n&&this.computeSelect(t,h,n,r)};Ia.prototype.getCoordinates=function(){for(var t=this,e=new Array(this._end-this._start+1).fill(null),n=0,r=this._start;r<=this._end;r++)e[n++]=t._pts[r];return e};Ia.prototype.computeOverlaps=function(t,e){this.computeOverlapsInternal(this._start,this._end,t,t._start,t._end,e)};Ia.prototype.setId=function(t){this._id=t};Ia.prototype.select=function(t,e){this.computeSelect(t,this._start,this._end,e)};Ia.prototype.getEnvelope=function(){if(this._env===null){var t=this._pts[this._start],e=this._pts[this._end];this._env=new $e(t,e)}return this._env};Ia.prototype.getEndIndex=function(){return this._end};Ia.prototype.getStartIndex=function(){return this._start};Ia.prototype.getContext=function(){return this._context};Ia.prototype.getId=function(){return this._id};Ia.prototype.computeOverlapsInternal=function(t,e,n,r,i,a){var h=this._pts[t],u=this._pts[e],_=n._pts[r],w=n._pts[i];if(e-t===1&&i-r===1)return a.overlap(this,t,n,r),null;if(a.tempEnv1.init(h,u),a.tempEnv2.init(_,w),!a.tempEnv1.intersects(a.tempEnv2))return null;var C=Math.trunc((t+e)/2),P=Math.trunc((r+i)/2);t<C&&(r<P&&this.computeOverlapsInternal(t,C,n,r,P,a),P<i&&this.computeOverlapsInternal(t,C,n,P,i,a)),C<e&&(r<P&&this.computeOverlapsInternal(C,e,n,r,P,a),P<i&&this.computeOverlapsInternal(C,e,n,P,i,a))};Ia.prototype.interfaces_=function(){return[]};Ia.prototype.getClass=function(){return Ia};var jl=function(){};jl.prototype.interfaces_=function(){return[]};jl.prototype.getClass=function(){return jl};jl.getChainStartIndices=function(t){var e=0,n=new de;n.add(new nc(e));do{var r=jl.findChainEnd(t,e);n.add(new nc(r)),e=r}while(e<t.length-1);var i=jl.toIntArray(n);return i};jl.findChainEnd=function(t,e){for(var n=e;n<t.length-1&&t[n].equals2D(t[n+1]);)n++;if(n>=t.length-1)return t.length-1;for(var r=gr.quadrant(t[n],t[n+1]),i=e+1;i<t.length;){if(!t[i-1].equals2D(t[i])){var a=gr.quadrant(t[i-1],t[i]);if(a!==r)break}i++}return i-1};jl.getChains=function(){if(arguments.length===1){var t=arguments[0];return jl.getChains(t,null)}else if(arguments.length===2){for(var e=arguments[0],n=arguments[1],r=new de,i=jl.getChainStartIndices(e),a=0;a<i.length-1;a++){var h=new Ia(e,i[a],i[a+1],n);r.add(h)}return r}};jl.toIntArray=function(t){for(var e=new Array(t.size()).fill(null),n=0;n<e.length;n++)e[n]=t.get(n).intValue();return e};var Wf=function(){};Wf.prototype.computeNodes=function(t){};Wf.prototype.getNodedSubstrings=function(){};Wf.prototype.interfaces_=function(){return[]};Wf.prototype.getClass=function(){return Wf};var d_=function(){if(this._segInt=null,arguments.length!==0&&arguments.length===1){var t=arguments[0];this.setSegmentIntersector(t)}};d_.prototype.setSegmentIntersector=function(t){this._segInt=t};d_.prototype.interfaces_=function(){return[Wf]};d_.prototype.getClass=function(){return d_};var uw=function(t){function e(r){r?t.call(this,r):t.call(this),this._monoChains=new de,this._index=new aT,this._idCounter=0,this._nodedSegStrings=null,this._nOverlaps=0}t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e;var n={SegmentOverlapAction:{configurable:!0}};return e.prototype.getMonotoneChains=function(){return this._monoChains},e.prototype.getNodedSubstrings=function(){return Si.getNodedSubstrings(this._nodedSegStrings)},e.prototype.getIndex=function(){return this._index},e.prototype.add=function(r){for(var i=this,a=jl.getChains(r.getCoordinates(),r),h=a.iterator();h.hasNext();){var u=h.next();u.setId(i._idCounter++),i._index.insert(u.getEnvelope(),u),i._monoChains.add(u)}},e.prototype.computeNodes=function(r){var i=this;this._nodedSegStrings=r;for(var a=r.iterator();a.hasNext();)i.add(a.next());this.intersectChains()},e.prototype.intersectChains=function(){for(var r=this,i=new EI(this._segInt),a=this._monoChains.iterator();a.hasNext();)for(var h=a.next(),u=r._index.query(h.getEnvelope()),_=u.iterator();_.hasNext();){var w=_.next();if(w.getId()>h.getId()&&(h.computeOverlaps(w,i),r._nOverlaps++),r._segInt.isDone())return null}},e.prototype.interfaces_=function(){return[]},e.prototype.getClass=function(){return e},n.SegmentOverlapAction.get=function(){return EI},Object.defineProperties(e,n),e}(d_),EI=function(t){function e(){t.call(this),this._si=null;var n=arguments[0];this._si=n}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.overlap=function(){if(arguments.length===4){var n=arguments[0],r=arguments[1],i=arguments[2],a=arguments[3],h=n.getContext(),u=i.getContext();this._si.processIntersections(h,r,u,a)}else return t.prototype.overlap.apply(this,arguments)},e.prototype.interfaces_=function(){return[]},e.prototype.getClass=function(){return e},e}(f_),Kn=function t(){if(this._quadrantSegments=t.DEFAULT_QUADRANT_SEGMENTS,this._endCapStyle=t.CAP_ROUND,this._joinStyle=t.JOIN_ROUND,this._mitreLimit=t.DEFAULT_MITRE_LIMIT,this._isSingleSided=!1,this._simplifyFactor=t.DEFAULT_SIMPLIFY_FACTOR,arguments.length!==0){if(arguments.length===1){var e=arguments[0];this.setQuadrantSegments(e)}else if(arguments.length===2){var n=arguments[0],r=arguments[1];this.setQuadrantSegments(n),this.setEndCapStyle(r)}else if(arguments.length===4){var i=arguments[0],a=arguments[1],h=arguments[2],u=arguments[3];this.setQuadrantSegments(i),this.setEndCapStyle(a),this.setJoinStyle(h),this.setMitreLimit(u)}}},jh={CAP_ROUND:{configurable:!0},CAP_FLAT:{configurable:!0},CAP_SQUARE:{configurable:!0},JOIN_ROUND:{configurable:!0},JOIN_MITRE:{configurable:!0},JOIN_BEVEL:{configurable:!0},DEFAULT_QUADRANT_SEGMENTS:{configurable:!0},DEFAULT_MITRE_LIMIT:{configurable:!0},DEFAULT_SIMPLIFY_FACTOR:{configurable:!0}};Kn.prototype.getEndCapStyle=function(){return this._endCapStyle};Kn.prototype.isSingleSided=function(){return this._isSingleSided};Kn.prototype.setQuadrantSegments=function(t){this._quadrantSegments=t,this._quadrantSegments===0&&(this._joinStyle=Kn.JOIN_BEVEL),this._quadrantSegments<0&&(this._joinStyle=Kn.JOIN_MITRE,this._mitreLimit=Math.abs(this._quadrantSegments)),t<=0&&(this._quadrantSegments=1),this._joinStyle!==Kn.JOIN_ROUND&&(this._quadrantSegments=Kn.DEFAULT_QUADRANT_SEGMENTS)};Kn.prototype.getJoinStyle=function(){return this._joinStyle};Kn.prototype.setJoinStyle=function(t){this._joinStyle=t};Kn.prototype.setSimplifyFactor=function(t){this._simplifyFactor=t<0?0:t};Kn.prototype.getSimplifyFactor=function(){return this._simplifyFactor};Kn.prototype.getQuadrantSegments=function(){return this._quadrantSegments};Kn.prototype.setEndCapStyle=function(t){this._endCapStyle=t};Kn.prototype.getMitreLimit=function(){return this._mitreLimit};Kn.prototype.setMitreLimit=function(t){this._mitreLimit=t};Kn.prototype.setSingleSided=function(t){this._isSingleSided=t};Kn.prototype.interfaces_=function(){return[]};Kn.prototype.getClass=function(){return Kn};Kn.bufferDistanceError=function(t){var e=Math.PI/2/t;return 1-Math.cos(e/2)};jh.CAP_ROUND.get=function(){return 1};jh.CAP_FLAT.get=function(){return 2};jh.CAP_SQUARE.get=function(){return 3};jh.JOIN_ROUND.get=function(){return 1};jh.JOIN_MITRE.get=function(){return 2};jh.JOIN_BEVEL.get=function(){return 3};jh.DEFAULT_QUADRANT_SEGMENTS.get=function(){return 8};jh.DEFAULT_MITRE_LIMIT.get=function(){return 5};jh.DEFAULT_SIMPLIFY_FACTOR.get=function(){return .01};Object.defineProperties(Kn,jh);var li=function(t){this._distanceTol=null,this._isDeleted=null,this._angleOrientation=Ce.COUNTERCLOCKWISE,this._inputLine=t||null},R_={INIT:{configurable:!0},DELETE:{configurable:!0},KEEP:{configurable:!0},NUM_PTS_TO_CHECK:{configurable:!0}};li.prototype.isDeletable=function(t,e,n,r){var i=this._inputLine[t],a=this._inputLine[e],h=this._inputLine[n];return!this.isConcave(i,a,h)||!this.isShallow(i,a,h,r)?!1:this.isShallowSampled(i,a,t,n,r)};li.prototype.deleteShallowConcavities=function(){for(var t=this,e=1,n=this.findNextNonDeletedIndex(e),r=this.findNextNonDeletedIndex(n),i=!1;r<this._inputLine.length;){var a=!1;t.isDeletable(e,n,r,t._distanceTol)&&(t._isDeleted[n]=li.DELETE,a=!0,i=!0),a?e=r:e=n,n=t.findNextNonDeletedIndex(e),r=t.findNextNonDeletedIndex(n)}return i};li.prototype.isShallowConcavity=function(t,e,n,r){var i=Ce.computeOrientation(t,e,n),a=i===this._angleOrientation;if(!a)return!1;var h=Ce.distancePointLine(e,t,n);return h<r};li.prototype.isShallowSampled=function(t,e,n,r,i){var a=this,h=Math.trunc((r-n)/li.NUM_PTS_TO_CHECK);h<=0&&(h=1);for(var u=n;u<r;u+=h)if(!a.isShallow(t,e,a._inputLine[u],i))return!1;return!0};li.prototype.isConcave=function(t,e,n){var r=Ce.computeOrientation(t,e,n),i=r===this._angleOrientation;return i};li.prototype.simplify=function(t){var e=this;this._distanceTol=Math.abs(t),t<0&&(this._angleOrientation=Ce.CLOCKWISE),this._isDeleted=new Array(this._inputLine.length).fill(null);var n=!1;do n=e.deleteShallowConcavities();while(n);return this.collapseLine()};li.prototype.findNextNonDeletedIndex=function(t){for(var e=t+1;e<this._inputLine.length&&this._isDeleted[e]===li.DELETE;)e++;return e};li.prototype.isShallow=function(t,e,n,r){var i=Ce.distancePointLine(e,t,n);return i<r};li.prototype.collapseLine=function(){for(var t=this,e=new A_,n=0;n<this._inputLine.length;n++)t._isDeleted[n]!==li.DELETE&&e.add(t._inputLine[n]);return e.toCoordinateArray()};li.prototype.interfaces_=function(){return[]};li.prototype.getClass=function(){return li};li.simplify=function(t,e){var n=new li(t);return n.simplify(e)};R_.INIT.get=function(){return 0};R_.DELETE.get=function(){return 1};R_.KEEP.get=function(){return 1};R_.NUM_PTS_TO_CHECK.get=function(){return 10};Object.defineProperties(li,R_);var eu=function(){this._ptList=null,this._precisionModel=null,this._minimimVertexDistance=0,this._ptList=new de},lT={COORDINATE_ARRAY_TYPE:{configurable:!0}};eu.prototype.getCoordinates=function(){var t=this._ptList.toArray(eu.COORDINATE_ARRAY_TYPE);return t};eu.prototype.setPrecisionModel=function(t){this._precisionModel=t};eu.prototype.addPt=function(t){var e=new Lt(t);if(this._precisionModel.makePrecise(e),this.isRedundant(e))return null;this._ptList.add(e)};eu.prototype.revere=function(){};eu.prototype.addPts=function(t,e){var n=this;if(e)for(var r=0;r<t.length;r++)n.addPt(t[r]);else for(var i=t.length-1;i>=0;i--)n.addPt(t[i])};eu.prototype.isRedundant=function(t){if(this._ptList.size()<1)return!1;var e=this._ptList.get(this._ptList.size()-1),n=t.distance(e);return n<this._minimimVertexDistance};eu.prototype.toString=function(){var t=new En,e=t.createLineString(this.getCoordinates());return e.toString()};eu.prototype.closeRing=function(){if(this._ptList.size()<1)return null;var t=new Lt(this._ptList.get(0)),e=this._ptList.get(this._ptList.size()-1);if(t.equals(e))return null;this._ptList.add(t)};eu.prototype.setMinimumVertexDistance=function(t){this._minimimVertexDistance=t};eu.prototype.interfaces_=function(){return[]};eu.prototype.getClass=function(){return eu};lT.COORDINATE_ARRAY_TYPE.get=function(){return new Array(0).fill(null)};Object.defineProperties(eu,lT);var Rn=function(){},yg={PI_TIMES_2:{configurable:!0},PI_OVER_2:{configurable:!0},PI_OVER_4:{configurable:!0},COUNTERCLOCKWISE:{configurable:!0},CLOCKWISE:{configurable:!0},NONE:{configurable:!0}};Rn.prototype.interfaces_=function(){return[]};Rn.prototype.getClass=function(){return Rn};Rn.toDegrees=function(t){return t*180/Math.PI};Rn.normalize=function(t){for(;t>Math.PI;)t-=Rn.PI_TIMES_2;for(;t<=-Math.PI;)t+=Rn.PI_TIMES_2;return t};Rn.angle=function(){if(arguments.length===1){var t=arguments[0];return Math.atan2(t.y,t.x)}else if(arguments.length===2){var e=arguments[0],n=arguments[1],r=n.x-e.x,i=n.y-e.y;return Math.atan2(i,r)}};Rn.isAcute=function(t,e,n){var r=t.x-e.x,i=t.y-e.y,a=n.x-e.x,h=n.y-e.y,u=r*a+i*h;return u>0};Rn.isObtuse=function(t,e,n){var r=t.x-e.x,i=t.y-e.y,a=n.x-e.x,h=n.y-e.y,u=r*a+i*h;return u<0};Rn.interiorAngle=function(t,e,n){var r=Rn.angle(e,t),i=Rn.angle(e,n);return Math.abs(i-r)};Rn.normalizePositive=function(t){if(t<0){for(;t<0;)t+=Rn.PI_TIMES_2;t>=Rn.PI_TIMES_2&&(t=0)}else{for(;t>=Rn.PI_TIMES_2;)t-=Rn.PI_TIMES_2;t<0&&(t=0)}return t};Rn.angleBetween=function(t,e,n){var r=Rn.angle(e,t),i=Rn.angle(e,n);return Rn.diff(r,i)};Rn.diff=function(t,e){var n=null;return t<e?n=e-t:n=t-e,n>Math.PI&&(n=2*Math.PI-n),n};Rn.toRadians=function(t){return t*Math.PI/180};Rn.getTurn=function(t,e){var n=Math.sin(e-t);return n>0?Rn.COUNTERCLOCKWISE:n<0?Rn.CLOCKWISE:Rn.NONE};Rn.angleBetweenOriented=function(t,e,n){var r=Rn.angle(e,t),i=Rn.angle(e,n),a=i-r;return a<=-Math.PI?a+Rn.PI_TIMES_2:a>Math.PI?a-Rn.PI_TIMES_2:a};yg.PI_TIMES_2.get=function(){return 2*Math.PI};yg.PI_OVER_2.get=function(){return Math.PI/2};yg.PI_OVER_4.get=function(){return Math.PI/4};yg.COUNTERCLOCKWISE.get=function(){return Ce.COUNTERCLOCKWISE};yg.CLOCKWISE.get=function(){return Ce.CLOCKWISE};yg.NONE.get=function(){return Ce.COLLINEAR};Object.defineProperties(Rn,yg);var Rr=function t(){this._maxCurveSegmentError=0,this._filletAngleQuantum=null,this._closingSegLengthFactor=1,this._segList=null,this._distance=0,this._precisionModel=null,this._bufParams=null,this._li=null,this._s0=null,this._s1=null,this._s2=null,this._seg0=new Ue,this._seg1=new Ue,this._offset0=new Ue,this._offset1=new Ue,this._side=0,this._hasNarrowConcaveAngle=!1;var e=arguments[0],n=arguments[1],r=arguments[2];this._precisionModel=e,this._bufParams=n,this._li=new cd,this._filletAngleQuantum=Math.PI/2/n.getQuadrantSegments(),n.getQuadrantSegments()>=8&&n.getJoinStyle()===Kn.JOIN_ROUND&&(this._closingSegLengthFactor=t.MAX_CLOSING_SEG_LEN_FACTOR),this.init(r)},F_={OFFSET_SEGMENT_SEPARATION_FACTOR:{configurable:!0},INSIDE_TURN_VERTEX_SNAP_DISTANCE_FACTOR:{configurable:!0},CURVE_VERTEX_SNAP_DISTANCE_FACTOR:{configurable:!0},MAX_CLOSING_SEG_LEN_FACTOR:{configurable:!0}};Rr.prototype.addNextSegment=function(t,e){if(this._s0=this._s1,this._s1=this._s2,this._s2=t,this._seg0.setCoordinates(this._s0,this._s1),this.computeOffsetSegment(this._seg0,this._side,this._distance,this._offset0),this._seg1.setCoordinates(this._s1,this._s2),this.computeOffsetSegment(this._seg1,this._side,this._distance,this._offset1),this._s1.equals(this._s2))return null;var n=Ce.computeOrientation(this._s0,this._s1,this._s2),r=n===Ce.CLOCKWISE&&this._side===oe.LEFT||n===Ce.COUNTERCLOCKWISE&&this._side===oe.RIGHT;n===0?this.addCollinear(e):r?this.addOutsideTurn(n,e):this.addInsideTurn(n,e)};Rr.prototype.addLineEndCap=function(t,e){var n=new Ue(t,e),r=new Ue;this.computeOffsetSegment(n,oe.LEFT,this._distance,r);var i=new Ue;this.computeOffsetSegment(n,oe.RIGHT,this._distance,i);var a=e.x-t.x,h=e.y-t.y,u=Math.atan2(h,a);switch(this._bufParams.getEndCapStyle()){case Kn.CAP_ROUND:this._segList.addPt(r.p1),this.addFilletArc(e,u+Math.PI/2,u-Math.PI/2,Ce.CLOCKWISE,this._distance),this._segList.addPt(i.p1);break;case Kn.CAP_FLAT:this._segList.addPt(r.p1),this._segList.addPt(i.p1);break;case Kn.CAP_SQUARE:var _=new Lt;_.x=Math.abs(this._distance)*Math.cos(u),_.y=Math.abs(this._distance)*Math.sin(u);var w=new Lt(r.p1.x+_.x,r.p1.y+_.y),C=new Lt(i.p1.x+_.x,i.p1.y+_.y);this._segList.addPt(w),this._segList.addPt(C);break}};Rr.prototype.getCoordinates=function(){var t=this._segList.getCoordinates();return t};Rr.prototype.addMitreJoin=function(t,e,n,r){var i=!0,a=null;try{a=Xu.intersection(e.p0,e.p1,n.p0,n.p1);var h=r<=0?1:a.distance(t)/Math.abs(r);h>this._bufParams.getMitreLimit()&&(i=!1)}catch(u){if(u instanceof $m)a=new Lt(0,0),i=!1;else throw u}finally{}i?this._segList.addPt(a):this.addLimitedMitreJoin(e,n,r,this._bufParams.getMitreLimit())};Rr.prototype.addFilletCorner=function(t,e,n,r,i){var a=e.x-t.x,h=e.y-t.y,u=Math.atan2(h,a),_=n.x-t.x,w=n.y-t.y,C=Math.atan2(w,_);r===Ce.CLOCKWISE?u<=C&&(u+=2*Math.PI):u>=C&&(u-=2*Math.PI),this._segList.addPt(e),this.addFilletArc(t,u,C,r,i),this._segList.addPt(n)};Rr.prototype.addOutsideTurn=function(t,e){if(this._offset0.p1.distance(this._offset1.p0)<this._distance*Rr.OFFSET_SEGMENT_SEPARATION_FACTOR)return this._segList.addPt(this._offset0.p1),null;this._bufParams.getJoinStyle()===Kn.JOIN_MITRE?this.addMitreJoin(this._s1,this._offset0,this._offset1,this._distance):this._bufParams.getJoinStyle()===Kn.JOIN_BEVEL?this.addBevelJoin(this._offset0,this._offset1):(e&&this._segList.addPt(this._offset0.p1),this.addFilletCorner(this._s1,this._offset0.p1,this._offset1.p0,t,this._distance),this._segList.addPt(this._offset1.p0))};Rr.prototype.createSquare=function(t){this._segList.addPt(new Lt(t.x+this._distance,t.y+this._distance)),this._segList.addPt(new Lt(t.x+this._distance,t.y-this._distance)),this._segList.addPt(new Lt(t.x-this._distance,t.y-this._distance)),this._segList.addPt(new Lt(t.x-this._distance,t.y+this._distance)),this._segList.closeRing()};Rr.prototype.addSegments=function(t,e){this._segList.addPts(t,e)};Rr.prototype.addFirstSegment=function(){this._segList.addPt(this._offset1.p0)};Rr.prototype.addLastSegment=function(){this._segList.addPt(this._offset1.p1)};Rr.prototype.initSideSegments=function(t,e,n){this._s1=t,this._s2=e,this._side=n,this._seg1.setCoordinates(t,e),this.computeOffsetSegment(this._seg1,n,this._distance,this._offset1)};Rr.prototype.addLimitedMitreJoin=function(t,e,n,r){var i=this._seg0.p1,a=Rn.angle(i,this._seg0.p0),h=Rn.angleBetweenOriented(this._seg0.p0,i,this._seg1.p1),u=h/2,_=Rn.normalize(a+u),w=Rn.normalize(_+Math.PI),C=r*n,P=C*Math.abs(Math.sin(u)),D=n-P,B=i.x+C*Math.cos(w),$=i.y+C*Math.sin(w),Z=new Lt(B,$),W=new Ue(i,Z),rt=W.pointAlongOffset(1,D),ct=W.pointAlongOffset(1,-D);this._side===oe.LEFT?(this._segList.addPt(rt),this._segList.addPt(ct)):(this._segList.addPt(ct),this._segList.addPt(rt))};Rr.prototype.computeOffsetSegment=function(t,e,n,r){var i=e===oe.LEFT?1:-1,a=t.p1.x-t.p0.x,h=t.p1.y-t.p0.y,u=Math.sqrt(a*a+h*h),_=i*n*a/u,w=i*n*h/u;r.p0.x=t.p0.x-w,r.p0.y=t.p0.y+_,r.p1.x=t.p1.x-w,r.p1.y=t.p1.y+_};Rr.prototype.addFilletArc=function(t,e,n,r,i){var a=this,h=r===Ce.CLOCKWISE?-1:1,u=Math.abs(e-n),_=Math.trunc(u/this._filletAngleQuantum+.5);if(_<1)return null;for(var w=0,C=u/_,P=w,D=new Lt;P<u;){var B=e+h*P;D.x=t.x+i*Math.cos(B),D.y=t.y+i*Math.sin(B),a._segList.addPt(D),P+=C}};Rr.prototype.addInsideTurn=function(t,e){if(this._li.computeIntersection(this._offset0.p0,this._offset0.p1,this._offset1.p0,this._offset1.p1),this._li.hasIntersection())this._segList.addPt(this._li.getIntersection(0));else if(this._hasNarrowConcaveAngle=!0,this._offset0.p1.distance(this._offset1.p0)<this._distance*Rr.INSIDE_TURN_VERTEX_SNAP_DISTANCE_FACTOR)this._segList.addPt(this._offset0.p1);else{if(this._segList.addPt(this._offset0.p1),this._closingSegLengthFactor>0){var n=new Lt((this._closingSegLengthFactor*this._offset0.p1.x+this._s1.x)/(this._closingSegLengthFactor+1),(this._closingSegLengthFactor*this._offset0.p1.y+this._s1.y)/(this._closingSegLengthFactor+1));this._segList.addPt(n);var r=new Lt((this._closingSegLengthFactor*this._offset1.p0.x+this._s1.x)/(this._closingSegLengthFactor+1),(this._closingSegLengthFactor*this._offset1.p0.y+this._s1.y)/(this._closingSegLengthFactor+1));this._segList.addPt(r)}else this._segList.addPt(this._s1);this._segList.addPt(this._offset1.p0)}};Rr.prototype.createCircle=function(t){var e=new Lt(t.x+this._distance,t.y);this._segList.addPt(e),this.addFilletArc(t,0,2*Math.PI,-1,this._distance),this._segList.closeRing()};Rr.prototype.addBevelJoin=function(t,e){this._segList.addPt(t.p1),this._segList.addPt(e.p0)};Rr.prototype.init=function(t){this._distance=t,this._maxCurveSegmentError=t*(1-Math.cos(this._filletAngleQuantum/2)),this._segList=new eu,this._segList.setPrecisionModel(this._precisionModel),this._segList.setMinimumVertexDistance(t*Rr.CURVE_VERTEX_SNAP_DISTANCE_FACTOR)};Rr.prototype.addCollinear=function(t){this._li.computeIntersection(this._s0,this._s1,this._s1,this._s2);var e=this._li.getIntersectionNum();e>=2&&(this._bufParams.getJoinStyle()===Kn.JOIN_BEVEL||this._bufParams.getJoinStyle()===Kn.JOIN_MITRE?(t&&this._segList.addPt(this._offset0.p1),this._segList.addPt(this._offset1.p0)):this.addFilletCorner(this._s1,this._offset0.p1,this._offset1.p0,Ce.CLOCKWISE,this._distance))};Rr.prototype.closeRing=function(){this._segList.closeRing()};Rr.prototype.hasNarrowConcaveAngle=function(){return this._hasNarrowConcaveAngle};Rr.prototype.interfaces_=function(){return[]};Rr.prototype.getClass=function(){return Rr};F_.OFFSET_SEGMENT_SEPARATION_FACTOR.get=function(){return .001};F_.INSIDE_TURN_VERTEX_SNAP_DISTANCE_FACTOR.get=function(){return .001};F_.CURVE_VERTEX_SNAP_DISTANCE_FACTOR.get=function(){return 1e-6};F_.MAX_CLOSING_SEG_LEN_FACTOR.get=function(){return 80};Object.defineProperties(Rr,F_);var ta=function(){this._distance=0,this._precisionModel=null,this._bufParams=null;var t=arguments[0],e=arguments[1];this._precisionModel=t,this._bufParams=e};ta.prototype.getOffsetCurve=function(t,e){if(this._distance=e,e===0)return null;var n=e<0,r=Math.abs(e),i=this.getSegGen(r);t.length<=1?this.computePointCurve(t[0],i):this.computeOffsetCurve(t,n,i);var a=i.getCoordinates();return n&&Sn.reverse(a),a};ta.prototype.computeSingleSidedBufferCurve=function(t,e,n){var r=this.simplifyTolerance(this._distance);if(e){n.addSegments(t,!0);var i=li.simplify(t,-r),a=i.length-1;n.initSideSegments(i[a],i[a-1],oe.LEFT),n.addFirstSegment();for(var h=a-2;h>=0;h--)n.addNextSegment(i[h],!0)}else{n.addSegments(t,!1);var u=li.simplify(t,r),_=u.length-1;n.initSideSegments(u[0],u[1],oe.LEFT),n.addFirstSegment();for(var w=2;w<=_;w++)n.addNextSegment(u[w],!0)}n.addLastSegment(),n.closeRing()};ta.prototype.computeRingBufferCurve=function(t,e,n){var r=this.simplifyTolerance(this._distance);e===oe.RIGHT&&(r=-r);var i=li.simplify(t,r),a=i.length-1;n.initSideSegments(i[a-1],i[0],e);for(var h=1;h<=a;h++){var u=h!==1;n.addNextSegment(i[h],u)}n.closeRing()};ta.prototype.computeLineBufferCurve=function(t,e){var n=this.simplifyTolerance(this._distance),r=li.simplify(t,n),i=r.length-1;e.initSideSegments(r[0],r[1],oe.LEFT);for(var a=2;a<=i;a++)e.addNextSegment(r[a],!0);e.addLastSegment(),e.addLineEndCap(r[i-1],r[i]);var h=li.simplify(t,-n),u=h.length-1;e.initSideSegments(h[u],h[u-1],oe.LEFT);for(var _=u-2;_>=0;_--)e.addNextSegment(h[_],!0);e.addLastSegment(),e.addLineEndCap(h[1],h[0]),e.closeRing()};ta.prototype.computePointCurve=function(t,e){switch(this._bufParams.getEndCapStyle()){case Kn.CAP_ROUND:e.createCircle(t);break;case Kn.CAP_SQUARE:e.createSquare(t);break}};ta.prototype.getLineCurve=function(t,e){if(this._distance=e,e<0&&!this._bufParams.isSingleSided()||e===0)return null;var n=Math.abs(e),r=this.getSegGen(n);if(t.length<=1)this.computePointCurve(t[0],r);else if(this._bufParams.isSingleSided()){var i=e<0;this.computeSingleSidedBufferCurve(t,i,r)}else this.computeLineBufferCurve(t,r);var a=r.getCoordinates();return a};ta.prototype.getBufferParameters=function(){return this._bufParams};ta.prototype.simplifyTolerance=function(t){return t*this._bufParams.getSimplifyFactor()};ta.prototype.getRingCurve=function(t,e,n){if(this._distance=n,t.length<=2)return this.getLineCurve(t,n);if(n===0)return ta.copyCoordinates(t);var r=this.getSegGen(n);return this.computeRingBufferCurve(t,e,r),r.getCoordinates()};ta.prototype.computeOffsetCurve=function(t,e,n){var r=this.simplifyTolerance(this._distance);if(e){var i=li.simplify(t,-r),a=i.length-1;n.initSideSegments(i[a],i[a-1],oe.LEFT),n.addFirstSegment();for(var h=a-2;h>=0;h--)n.addNextSegment(i[h],!0)}else{var u=li.simplify(t,r),_=u.length-1;n.initSideSegments(u[0],u[1],oe.LEFT),n.addFirstSegment();for(var w=2;w<=_;w++)n.addNextSegment(u[w],!0)}n.addLastSegment()};ta.prototype.getSegGen=function(t){return new Rr(this._precisionModel,this._bufParams,t)};ta.prototype.interfaces_=function(){return[]};ta.prototype.getClass=function(){return ta};ta.copyCoordinates=function(t){for(var e=new Array(t.length).fill(null),n=0;n<e.length;n++)e[n]=new Lt(t[n]);return e};var Zd=function(){this._subgraphs=null,this._seg=new Ue,this._cga=new Ce;var t=arguments[0];this._subgraphs=t},cT={DepthSegment:{configurable:!0}};Zd.prototype.findStabbedSegments=function(){var t=this;if(arguments.length===1){for(var e=arguments[0],n=new de,r=this._subgraphs.iterator();r.hasNext();){var i=r.next(),a=i.getEnvelope();e.y<a.getMinY()||e.y>a.getMaxY()||t.findStabbedSegments(e,i.getDirectedEdges(),n)}return n}else if(arguments.length===3){if(en(arguments[2],Yu)&&arguments[0]instanceof Lt&&arguments[1]instanceof fb)for(var h=arguments[0],u=arguments[1],_=arguments[2],w=u.getEdge().getCoordinates(),C=0;C<w.length-1;C++){t._seg.p0=w[C],t._seg.p1=w[C+1],t._seg.p0.y>t._seg.p1.y&&t._seg.reverse();var P=Math.max(t._seg.p0.x,t._seg.p1.x);if(!(P<h.x)&&!t._seg.isHorizontal()&&!(h.y<t._seg.p0.y||h.y>t._seg.p1.y)&&Ce.computeOrientation(t._seg.p0,t._seg.p1,h)!==Ce.RIGHT){var D=u.getDepth(oe.LEFT);t._seg.p0.equals(w[C])||(D=u.getDepth(oe.RIGHT));var B=new Jf(t._seg,D);_.add(B)}}else if(en(arguments[2],Yu)&&arguments[0]instanceof Lt&&en(arguments[1],Yu))for(var $=arguments[0],Z=arguments[1],W=arguments[2],rt=Z.iterator();rt.hasNext();){var ct=rt.next();ct.isForward()&&t.findStabbedSegments($,ct,W)}}};Zd.prototype.getDepth=function(t){var e=this.findStabbedSegments(t);if(e.size()===0)return 0;var n=il.min(e);return n._leftDepth};Zd.prototype.interfaces_=function(){return[]};Zd.prototype.getClass=function(){return Zd};cT.DepthSegment.get=function(){return Jf};Object.defineProperties(Zd,cT);var Jf=function(){this._upwardSeg=null,this._leftDepth=null;var t=arguments[0],e=arguments[1];this._upwardSeg=new Ue(t),this._leftDepth=e};Jf.prototype.compareTo=function(t){var e=t;if(this._upwardSeg.minX()>=e._upwardSeg.maxX())return 1;if(this._upwardSeg.maxX()<=e._upwardSeg.minX())return-1;var n=this._upwardSeg.orientationIndex(e._upwardSeg);return n!==0||(n=-1*e._upwardSeg.orientationIndex(this._upwardSeg),n!==0)?n:this._upwardSeg.compareTo(e._upwardSeg)};Jf.prototype.compareX=function(t,e){var n=t.p0.compareTo(e.p0);return n!==0?n:t.p1.compareTo(e.p1)};Jf.prototype.toString=function(){return this._upwardSeg.toString()};Jf.prototype.interfaces_=function(){return[Pu]};Jf.prototype.getClass=function(){return Jf};var nr=function(t,e,n){this.p0=t||null,this.p1=e||null,this.p2=n||null};nr.prototype.area=function(){return nr.area(this.p0,this.p1,this.p2)};nr.prototype.signedArea=function(){return nr.signedArea(this.p0,this.p1,this.p2)};nr.prototype.interpolateZ=function(t){if(t===null)throw new Yr("Supplied point is null.");return nr.interpolateZ(t,this.p0,this.p1,this.p2)};nr.prototype.longestSideLength=function(){return nr.longestSideLength(this.p0,this.p1,this.p2)};nr.prototype.isAcute=function(){return nr.isAcute(this.p0,this.p1,this.p2)};nr.prototype.circumcentre=function(){return nr.circumcentre(this.p0,this.p1,this.p2)};nr.prototype.area3D=function(){return nr.area3D(this.p0,this.p1,this.p2)};nr.prototype.centroid=function(){return nr.centroid(this.p0,this.p1,this.p2)};nr.prototype.inCentre=function(){return nr.inCentre(this.p0,this.p1,this.p2)};nr.prototype.interfaces_=function(){return[]};nr.prototype.getClass=function(){return nr};nr.area=function(t,e,n){return Math.abs(((n.x-t.x)*(e.y-t.y)-(e.x-t.x)*(n.y-t.y))/2)};nr.signedArea=function(t,e,n){return((n.x-t.x)*(e.y-t.y)-(e.x-t.x)*(n.y-t.y))/2};nr.det=function(t,e,n,r){return t*r-e*n};nr.interpolateZ=function(t,e,n,r){var i=e.x,a=e.y,h=n.x-i,u=r.x-i,_=n.y-a,w=r.y-a,C=h*w-u*_,P=t.x-i,D=t.y-a,B=(w*P-u*D)/C,$=(-_*P+h*D)/C,Z=e.z+B*(n.z-e.z)+$*(r.z-e.z);return Z};nr.longestSideLength=function(t,e,n){var r=t.distance(e),i=e.distance(n),a=n.distance(t),h=r;return i>h&&(h=i),a>h&&(h=a),h};nr.isAcute=function(t,e,n){return!(!Rn.isAcute(t,e,n)||!Rn.isAcute(e,n,t)||!Rn.isAcute(n,t,e))};nr.circumcentre=function(t,e,n){var r=n.x,i=n.y,a=t.x-r,h=t.y-i,u=e.x-r,_=e.y-i,w=2*nr.det(a,h,u,_),C=nr.det(h,a*a+h*h,_,u*u+_*_),P=nr.det(a,a*a+h*h,u,u*u+_*_),D=r-C/w,B=i+P/w;return new Lt(D,B)};nr.perpendicularBisector=function(t,e){var n=e.x-t.x,r=e.y-t.y,i=new Xu(t.x+n/2,t.y+r/2,1),a=new Xu(t.x-r+n/2,t.y+n+r/2,1);return new Xu(i,a)};nr.angleBisector=function(t,e,n){var r=e.distance(t),i=e.distance(n),a=r/(r+i),h=n.x-t.x,u=n.y-t.y,_=new Lt(t.x+a*h,t.y+a*u);return _};nr.area3D=function(t,e,n){var r=e.x-t.x,i=e.y-t.y,a=e.z-t.z,h=n.x-t.x,u=n.y-t.y,_=n.z-t.z,w=i*_-a*u,C=a*h-r*_,P=r*u-i*h,D=w*w+C*C+P*P,B=Math.sqrt(D)/2;return B};nr.centroid=function(t,e,n){var r=(t.x+e.x+n.x)/3,i=(t.y+e.y+n.y)/3;return new Lt(r,i)};nr.inCentre=function(t,e,n){var r=e.distance(n),i=t.distance(n),a=t.distance(e),h=r+i+a,u=(r*t.x+i*e.x+a*n.x)/h,_=(r*t.y+i*e.y+a*n.y)/h;return new Lt(u,_)};var Cu=function(){this._inputGeom=null,this._distance=null,this._curveBuilder=null,this._curveList=new de;var t=arguments[0],e=arguments[1],n=arguments[2];this._inputGeom=t,this._distance=e,this._curveBuilder=n};Cu.prototype.addPoint=function(t){if(this._distance<=0)return null;var e=t.getCoordinates(),n=this._curveBuilder.getLineCurve(e,this._distance);this.addCurve(n,Mt.EXTERIOR,Mt.INTERIOR)};Cu.prototype.addPolygon=function(t){var e=this,n=this._distance,r=oe.LEFT;this._distance<0&&(n=-this._distance,r=oe.RIGHT);var i=t.getExteriorRing(),a=Sn.removeRepeatedPoints(i.getCoordinates());if(this._distance<0&&this.isErodedCompletely(i,this._distance)||this._distance<=0&&a.length<3)return null;this.addPolygonRing(a,n,r,Mt.EXTERIOR,Mt.INTERIOR);for(var h=0;h<t.getNumInteriorRing();h++){var u=t.getInteriorRingN(h),_=Sn.removeRepeatedPoints(u.getCoordinates());e._distance>0&&e.isErodedCompletely(u,-e._distance)||e.addPolygonRing(_,n,oe.opposite(r),Mt.INTERIOR,Mt.EXTERIOR)}};Cu.prototype.isTriangleErodedCompletely=function(t,e){var n=new nr(t[0],t[1],t[2]),r=n.inCentre(),i=Ce.distancePointLine(r,n.p0,n.p1);return i<Math.abs(e)};Cu.prototype.addLineString=function(t){if(this._distance<=0&&!this._curveBuilder.getBufferParameters().isSingleSided())return null;var e=Sn.removeRepeatedPoints(t.getCoordinates()),n=this._curveBuilder.getLineCurve(e,this._distance);this.addCurve(n,Mt.EXTERIOR,Mt.INTERIOR)};Cu.prototype.addCurve=function(t,e,n){if(t===null||t.length<2)return null;var r=new Si(t,new fr(0,Mt.BOUNDARY,e,n));this._curveList.add(r)};Cu.prototype.getCurves=function(){return this.add(this._inputGeom),this._curveList};Cu.prototype.addPolygonRing=function(t,e,n,r,i){if(e===0&&t.length<Yc.MINIMUM_VALID_SIZE)return null;var a=r,h=i;t.length>=Yc.MINIMUM_VALID_SIZE&&Ce.isCCW(t)&&(a=i,h=r,n=oe.opposite(n));var u=this._curveBuilder.getRingCurve(t,n,e);this.addCurve(u,a,h)};Cu.prototype.add=function(t){if(t.isEmpty())return null;t instanceof eo?this.addPolygon(t):t instanceof ai?this.addLineString(t):t instanceof wa?this.addPoint(t):t instanceof vm?this.addCollection(t):t instanceof Hf?this.addCollection(t):t instanceof Rc?this.addCollection(t):t instanceof Ds&&this.addCollection(t)};Cu.prototype.isErodedCompletely=function(t,e){var n=t.getCoordinates();if(n.length<4)return e<0;if(n.length===4)return this.isTriangleErodedCompletely(n,e);var r=t.getEnvelopeInternal(),i=Math.min(r.getHeight(),r.getWidth());return e<0&&2*Math.abs(e)>i};Cu.prototype.addCollection=function(t){for(var e=this,n=0;n<t.getNumGeometries();n++){var r=t.getGeometryN(n);e.add(r)}};Cu.prototype.interfaces_=function(){return[]};Cu.prototype.getClass=function(){return Cu};var Em=function(){};Em.prototype.locate=function(t){};Em.prototype.interfaces_=function(){return[]};Em.prototype.getClass=function(){return Em};var Fc=function(){this._parent=null,this._atStart=null,this._max=null,this._index=null,this._subcollectionIterator=null;var t=arguments[0];this._parent=t,this._atStart=!0,this._index=0,this._max=t.getNumGeometries()};Fc.prototype.next=function(){if(this._atStart)return this._atStart=!1,Fc.isAtomic(this._parent)&&this._index++,this._parent;if(this._subcollectionIterator!==null){if(this._subcollectionIterator.hasNext())return this._subcollectionIterator.next();this._subcollectionIterator=null}if(this._index>=this._max)throw new Um;var t=this._parent.getGeometryN(this._index++);return t instanceof Ds?(this._subcollectionIterator=new Fc(t),this._subcollectionIterator.next()):t};Fc.prototype.remove=function(){throw new Error(this.getClass().getName())};Fc.prototype.hasNext=function(){if(this._atStart)return!0;if(this._subcollectionIterator!==null){if(this._subcollectionIterator.hasNext())return!0;this._subcollectionIterator=null}return!(this._index>=this._max)};Fc.prototype.interfaces_=function(){return[Vm]};Fc.prototype.getClass=function(){return Fc};Fc.isAtomic=function(t){return!(t instanceof Ds)};var ja=function(){this._geom=null;var t=arguments[0];this._geom=t};ja.prototype.locate=function(t){return ja.locate(t,this._geom)};ja.prototype.interfaces_=function(){return[Em]};ja.prototype.getClass=function(){return ja};ja.isPointInRing=function(t,e){return e.getEnvelopeInternal().intersects(t)?Ce.isPointInRing(t,e.getCoordinates()):!1};ja.containsPointInPolygon=function(t,e){if(e.isEmpty())return!1;var n=e.getExteriorRing();if(!ja.isPointInRing(t,n))return!1;for(var r=0;r<e.getNumInteriorRing();r++){var i=e.getInteriorRingN(r);if(ja.isPointInRing(t,i))return!1}return!0};ja.containsPoint=function(t,e){if(e instanceof eo)return ja.containsPointInPolygon(t,e);if(e instanceof Ds)for(var n=new Fc(e);n.hasNext();){var r=n.next();if(r!==e&&ja.containsPoint(t,r))return!0}return!1};ja.locate=function(t,e){return e.isEmpty()?Mt.EXTERIOR:ja.containsPoint(t,e)?Mt.INTERIOR:Mt.EXTERIOR};var is=function(){this._edgeMap=new ns,this._edgeList=null,this._ptInAreaLocation=[Mt.NONE,Mt.NONE]};is.prototype.getNextCW=function(t){this.getEdges();var e=this._edgeList.indexOf(t),n=e-1;return e===0&&(n=this._edgeList.size()-1),this._edgeList.get(n)};is.prototype.propagateSideLabels=function(t){for(var e=Mt.NONE,n=this.iterator();n.hasNext();){var r=n.next(),i=r.getLabel();i.isArea(t)&&i.getLocation(t,oe.LEFT)!==Mt.NONE&&(e=i.getLocation(t,oe.LEFT))}if(e===Mt.NONE)return null;for(var a=e,h=this.iterator();h.hasNext();){var u=h.next(),_=u.getLabel();if(_.getLocation(t,oe.ON)===Mt.NONE&&_.setLocation(t,oe.ON,a),_.isArea(t)){var w=_.getLocation(t,oe.LEFT),C=_.getLocation(t,oe.RIGHT);if(C!==Mt.NONE){if(C!==a)throw new zh("side location conflict",u.getCoordinate());w===Mt.NONE&&dn.shouldNeverReachHere("found single null side (at "+u.getCoordinate()+")"),a=w}else dn.isTrue(_.getLocation(t,oe.LEFT)===Mt.NONE,"found single null side"),_.setLocation(t,oe.RIGHT,a),_.setLocation(t,oe.LEFT,a)}}};is.prototype.getCoordinate=function(){var t=this.iterator();if(!t.hasNext())return null;var e=t.next();return e.getCoordinate()};is.prototype.print=function(t){ko.out.println("EdgeEndStar:   "+this.getCoordinate());for(var e=this.iterator();e.hasNext();){var n=e.next();n.print(t)}};is.prototype.isAreaLabelsConsistent=function(t){return this.computeEdgeEndLabels(t.getBoundaryNodeRule()),this.checkAreaLabelsConsistent(0)};is.prototype.checkAreaLabelsConsistent=function(t){var e=this.getEdges();if(e.size()<=0)return!0;var n=e.size()-1,r=e.get(n).getLabel(),i=r.getLocation(t,oe.LEFT);dn.isTrue(i!==Mt.NONE,"Found unlabelled area edge");for(var a=i,h=this.iterator();h.hasNext();){var u=h.next(),_=u.getLabel();dn.isTrue(_.isArea(t),"Found non-area edge");var w=_.getLocation(t,oe.LEFT),C=_.getLocation(t,oe.RIGHT);if(w===C||C!==a)return!1;a=w}return!0};is.prototype.findIndex=function(t){var e=this;this.iterator();for(var n=0;n<this._edgeList.size();n++){var r=e._edgeList.get(n);if(r===t)return n}return-1};is.prototype.iterator=function(){return this.getEdges().iterator()};is.prototype.getEdges=function(){return this._edgeList===null&&(this._edgeList=new de(this._edgeMap.values())),this._edgeList};is.prototype.getLocation=function(t,e,n){return this._ptInAreaLocation[t]===Mt.NONE&&(this._ptInAreaLocation[t]=ja.locate(e,n[t].getGeometry())),this._ptInAreaLocation[t]};is.prototype.toString=function(){var t=new gc;t.append("EdgeEndStar:   "+this.getCoordinate()),t.append(`
`);for(var e=this.iterator();e.hasNext();){var n=e.next();t.append(n),t.append(`
`)}return t.toString()};is.prototype.computeEdgeEndLabels=function(t){for(var e=this.iterator();e.hasNext();){var n=e.next();n.computeLabel(t)}};is.prototype.computeLabelling=function(t){var e=this;this.computeEdgeEndLabels(t[0].getBoundaryNodeRule()),this.propagateSideLabels(0),this.propagateSideLabels(1);for(var n=[!1,!1],r=this.iterator();r.hasNext();)for(var i=r.next(),a=i.getLabel(),h=0;h<2;h++)a.isLine(h)&&a.getLocation(h)===Mt.BOUNDARY&&(n[h]=!0);for(var u=this.iterator();u.hasNext();)for(var _=u.next(),w=_.getLabel(),C=0;C<2;C++)if(w.isAnyNull(C)){var P=Mt.NONE;if(n[C])P=Mt.EXTERIOR;else{var D=_.getCoordinate();P=e.getLocation(C,D,t)}w.setAllLocationsIfNull(C,P)}};is.prototype.getDegree=function(){return this._edgeMap.size()};is.prototype.insertEdgeEnd=function(t,e){this._edgeMap.put(t,e),this._edgeList=null};is.prototype.interfaces_=function(){return[]};is.prototype.getClass=function(){return is};var GO=function(t){function e(){t.call(this),this._resultAreaEdgeList=null,this._label=null,this._SCANNING_FOR_INCOMING=1,this._LINKING_TO_OUTGOING=2}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.linkResultDirectedEdges=function(){var n=this;this.getResultAreaEdges();for(var r=null,i=null,a=this._SCANNING_FOR_INCOMING,h=0;h<this._resultAreaEdgeList.size();h++){var u=n._resultAreaEdgeList.get(h),_=u.getSym();if(u.getLabel().isArea())switch(r===null&&u.isInResult()&&(r=u),a){case n._SCANNING_FOR_INCOMING:if(!_.isInResult())continue;i=_,a=n._LINKING_TO_OUTGOING;break;case n._LINKING_TO_OUTGOING:if(!u.isInResult())continue;i.setNext(u),a=n._SCANNING_FOR_INCOMING;break}}if(a===this._LINKING_TO_OUTGOING){if(r===null)throw new zh("no outgoing dirEdge found",this.getCoordinate());dn.isTrue(r.isInResult(),"unable to link last incoming dirEdge"),i.setNext(r)}},e.prototype.insert=function(n){var r=n;this.insertEdgeEnd(r,r)},e.prototype.getRightmostEdge=function(){var n=this.getEdges(),r=n.size();if(r<1)return null;var i=n.get(0);if(r===1)return i;var a=n.get(r-1),h=i.getQuadrant(),u=a.getQuadrant();return gr.isNorthern(h)&&gr.isNorthern(u)?i:!gr.isNorthern(h)&&!gr.isNorthern(u)?a:i.getDy()!==0?i:a.getDy()!==0?a:(dn.shouldNeverReachHere("found two horizontal edges incident on node"),null)},e.prototype.print=function(n){ko.out.println("DirectedEdgeStar: "+this.getCoordinate());for(var r=this.iterator();r.hasNext();){var i=r.next();n.print("out "),i.print(n),n.println(),n.print("in "),i.getSym().print(n),n.println()}},e.prototype.getResultAreaEdges=function(){var n=this;if(this._resultAreaEdgeList!==null)return this._resultAreaEdgeList;this._resultAreaEdgeList=new de;for(var r=this.iterator();r.hasNext();){var i=r.next();(i.isInResult()||i.getSym().isInResult())&&n._resultAreaEdgeList.add(i)}return this._resultAreaEdgeList},e.prototype.updateLabelling=function(n){for(var r=this.iterator();r.hasNext();){var i=r.next(),a=i.getLabel();a.setAllLocationsIfNull(0,n.getLocation(0)),a.setAllLocationsIfNull(1,n.getLocation(1))}},e.prototype.linkAllDirectedEdges=function(){var n=this;this.getEdges();for(var r=null,i=null,a=this._edgeList.size()-1;a>=0;a--){var h=n._edgeList.get(a),u=h.getSym();i===null&&(i=u),r!==null&&u.setNext(r),r=h}i.setNext(r)},e.prototype.computeDepths=function(){var n=this;if(arguments.length===1){var r=arguments[0],i=this.findIndex(r),a=r.getDepth(oe.LEFT),h=r.getDepth(oe.RIGHT),u=this.computeDepths(i+1,this._edgeList.size(),a),_=this.computeDepths(0,i,u);if(_!==h)throw new zh("depth mismatch at "+r.getCoordinate())}else if(arguments.length===3){for(var w=arguments[0],C=arguments[1],P=arguments[2],D=P,B=w;B<C;B++){var $=n._edgeList.get(B);$.setEdgeDepths(oe.RIGHT,D),D=$.getDepth(oe.LEFT)}return D}},e.prototype.mergeSymLabels=function(){for(var n=this.iterator();n.hasNext();){var r=n.next(),i=r.getLabel();i.merge(r.getSym().getLabel())}},e.prototype.linkMinimalDirectedEdges=function(n){for(var r=this,i=null,a=null,h=this._SCANNING_FOR_INCOMING,u=this._resultAreaEdgeList.size()-1;u>=0;u--){var _=r._resultAreaEdgeList.get(u),w=_.getSym();switch(i===null&&_.getEdgeRing()===n&&(i=_),h){case r._SCANNING_FOR_INCOMING:if(w.getEdgeRing()!==n)continue;a=w,h=r._LINKING_TO_OUTGOING;break;case r._LINKING_TO_OUTGOING:if(_.getEdgeRing()!==n)continue;a.setNextMin(_),h=r._SCANNING_FOR_INCOMING;break}}h===this._LINKING_TO_OUTGOING&&(dn.isTrue(i!==null,"found null for first outgoing dirEdge"),dn.isTrue(i.getEdgeRing()===n,"unable to link last incoming dirEdge"),a.setNextMin(i))},e.prototype.getOutgoingDegree=function(){if(arguments.length===0){for(var n=0,r=this.iterator();r.hasNext();){var i=r.next();i.isInResult()&&n++}return n}else if(arguments.length===1){for(var a=arguments[0],h=0,u=this.iterator();u.hasNext();){var _=u.next();_.getEdgeRing()===a&&h++}return h}},e.prototype.getLabel=function(){return this._label},e.prototype.findCoveredLineEdges=function(){for(var n=Mt.NONE,r=this.iterator();r.hasNext();){var i=r.next(),a=i.getSym();if(!i.isLineEdge()){if(i.isInResult()){n=Mt.INTERIOR;break}if(a.isInResult()){n=Mt.EXTERIOR;break}}}if(n===Mt.NONE)return null;for(var h=n,u=this.iterator();u.hasNext();){var _=u.next(),w=_.getSym();_.isLineEdge()?_.getEdge().setCovered(h===Mt.INTERIOR):(_.isInResult()&&(h=Mt.EXTERIOR),w.isInResult()&&(h=Mt.INTERIOR))}},e.prototype.computeLabelling=function(n){var r=this;t.prototype.computeLabelling.call(this,n),this._label=new fr(Mt.NONE);for(var i=this.iterator();i.hasNext();)for(var a=i.next(),h=a.getEdge(),u=h.getLabel(),_=0;_<2;_++){var w=u.getLocation(_);(w===Mt.INTERIOR||w===Mt.BOUNDARY)&&r._label.setLocation(_,Mt.INTERIOR)}},e.prototype.interfaces_=function(){return[]},e.prototype.getClass=function(){return e},e}(is),hT=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.createNode=function(n){return new A0(n,new GO)},e.prototype.interfaces_=function(){return[]},e.prototype.getClass=function(){return e},e}(xm),$p=function t(){this._pts=null,this._orientation=null;var e=arguments[0];this._pts=e,this._orientation=t.orientation(e)};$p.prototype.compareTo=function(t){var e=t,n=$p.compareOriented(this._pts,this._orientation,e._pts,e._orientation);return n};$p.prototype.interfaces_=function(){return[Pu]};$p.prototype.getClass=function(){return $p};$p.orientation=function(t){return Sn.increasingDirection(t)===1};$p.compareOriented=function(t,e,n,r){for(var i=e?1:-1,a=r?1:-1,h=e?t.length:-1,u=r?n.length:-1,_=e?0:t.length-1,w=r?0:n.length-1;;){var C=t[_].compareTo(n[w]);if(C!==0)return C;_+=i,w+=a;var P=_===h,D=w===u;if(P&&!D)return-1;if(!P&&D)return 1;if(P&&D)return 0}};var ol=function(){this._edges=new de,this._ocaMap=new ns};ol.prototype.print=function(t){var e=this;t.print("MULTILINESTRING ( ");for(var n=0;n<this._edges.size();n++){var r=e._edges.get(n);n>0&&t.print(","),t.print("(");for(var i=r.getCoordinates(),a=0;a<i.length;a++)a>0&&t.print(","),t.print(i[a].x+" "+i[a].y);t.println(")")}t.print(")  ")};ol.prototype.addAll=function(t){for(var e=this,n=t.iterator();n.hasNext();)e.add(n.next())};ol.prototype.findEdgeIndex=function(t){for(var e=this,n=0;n<this._edges.size();n++)if(e._edges.get(n).equals(t))return n;return-1};ol.prototype.iterator=function(){return this._edges.iterator()};ol.prototype.getEdges=function(){return this._edges};ol.prototype.get=function(t){return this._edges.get(t)};ol.prototype.findEqualEdge=function(t){var e=new $p(t.getCoordinates()),n=this._ocaMap.get(e);return n};ol.prototype.add=function(t){this._edges.add(t);var e=new $p(t.getCoordinates());this._ocaMap.put(e,t)};ol.prototype.interfaces_=function(){return[]};ol.prototype.getClass=function(){return ol};var Kf=function(){};Kf.prototype.processIntersections=function(t,e,n,r){};Kf.prototype.isDone=function(){};Kf.prototype.interfaces_=function(){return[]};Kf.prototype.getClass=function(){return Kf};var nu=function(){this._hasIntersection=!1,this._hasProper=!1,this._hasProperInterior=!1,this._hasInterior=!1,this._properIntersectionPoint=null,this._li=null,this._isSelfIntersection=null,this.numIntersections=0,this.numInteriorIntersections=0,this.numProperIntersections=0,this.numTests=0;var t=arguments[0];this._li=t};nu.prototype.isTrivialIntersection=function(t,e,n,r){if(t===n&&this._li.getIntersectionNum()===1){if(nu.isAdjacentSegments(e,r))return!0;if(t.isClosed()){var i=t.size()-1;if(e===0&&r===i||r===0&&e===i)return!0}}return!1};nu.prototype.getProperIntersectionPoint=function(){return this._properIntersectionPoint};nu.prototype.hasProperInteriorIntersection=function(){return this._hasProperInterior};nu.prototype.getLineIntersector=function(){return this._li};nu.prototype.hasProperIntersection=function(){return this._hasProper};nu.prototype.processIntersections=function(t,e,n,r){if(t===n&&e===r)return null;this.numTests++;var i=t.getCoordinates()[e],a=t.getCoordinates()[e+1],h=n.getCoordinates()[r],u=n.getCoordinates()[r+1];this._li.computeIntersection(i,a,h,u),this._li.hasIntersection()&&(this.numIntersections++,this._li.isInteriorIntersection()&&(this.numInteriorIntersections++,this._hasInterior=!0),this.isTrivialIntersection(t,e,n,r)||(this._hasIntersection=!0,t.addIntersections(this._li,e,0),n.addIntersections(this._li,r,1),this._li.isProper()&&(this.numProperIntersections++,this._hasProper=!0,this._hasProperInterior=!0)))};nu.prototype.hasIntersection=function(){return this._hasIntersection};nu.prototype.isDone=function(){return!1};nu.prototype.hasInteriorIntersection=function(){return this._hasInterior};nu.prototype.interfaces_=function(){return[Kf]};nu.prototype.getClass=function(){return nu};nu.isAdjacentSegments=function(t,e){return Math.abs(t-e)===1};var uc=function(){this.coord=null,this.segmentIndex=null,this.dist=null;var t=arguments[0],e=arguments[1],n=arguments[2];this.coord=new Lt(t),this.segmentIndex=e,this.dist=n};uc.prototype.getSegmentIndex=function(){return this.segmentIndex};uc.prototype.getCoordinate=function(){return this.coord};uc.prototype.print=function(t){t.print(this.coord),t.print(" seg # = "+this.segmentIndex),t.println(" dist = "+this.dist)};uc.prototype.compareTo=function(t){var e=t;return this.compare(e.segmentIndex,e.dist)};uc.prototype.isEndPoint=function(t){return this.segmentIndex===0&&this.dist===0||this.segmentIndex===t};uc.prototype.toString=function(){return this.coord+" seg # = "+this.segmentIndex+" dist = "+this.dist};uc.prototype.getDistance=function(){return this.dist};uc.prototype.compare=function(t,e){return this.segmentIndex<t?-1:this.segmentIndex>t?1:this.dist<e?-1:this.dist>e?1:0};uc.prototype.interfaces_=function(){return[Pu]};uc.prototype.getClass=function(){return uc};var Wc=function(){this._nodeMap=new ns,this.edge=null;var t=arguments[0];this.edge=t};Wc.prototype.print=function(t){t.println("Intersections:");for(var e=this.iterator();e.hasNext();){var n=e.next();n.print(t)}};Wc.prototype.iterator=function(){return this._nodeMap.values().iterator()};Wc.prototype.addSplitEdges=function(t){var e=this;this.addEndpoints();for(var n=this.iterator(),r=n.next();n.hasNext();){var i=n.next(),a=e.createSplitEdge(r,i);t.add(a),r=i}};Wc.prototype.addEndpoints=function(){var t=this.edge.pts.length-1;this.add(this.edge.pts[0],0,0),this.add(this.edge.pts[t],t,0)};Wc.prototype.createSplitEdge=function(t,e){var n=this,r=e.segmentIndex-t.segmentIndex+2,i=this.edge.pts[e.segmentIndex],a=e.dist>0||!e.coord.equals2D(i);a||r--;var h=new Array(r).fill(null),u=0;h[u++]=new Lt(t.coord);for(var _=t.segmentIndex+1;_<=e.segmentIndex;_++)h[u++]=n.edge.pts[_];return a&&(h[u]=e.coord),new Jv(h,new fr(this.edge._label))};Wc.prototype.add=function(t,e,n){var r=new uc(t,e,n),i=this._nodeMap.get(r);return i!==null?i:(this._nodeMap.put(r,r),r)};Wc.prototype.isIntersection=function(t){for(var e=this.iterator();e.hasNext();){var n=e.next();if(n.coord.equals(t))return!0}return!1};Wc.prototype.interfaces_=function(){return[]};Wc.prototype.getClass=function(){return Wc};var Qf=function(){};Qf.prototype.getChainStartIndices=function(t){var e=this,n=0,r=new de;r.add(new nc(n));do{var i=e.findChainEnd(t,n);r.add(new nc(i)),n=i}while(n<t.length-1);var a=Qf.toIntArray(r);return a};Qf.prototype.findChainEnd=function(t,e){for(var n=gr.quadrant(t[e],t[e+1]),r=e+1;r<t.length;){var i=gr.quadrant(t[r-1],t[r]);if(i!==n)break;r++}return r-1};Qf.prototype.interfaces_=function(){return[]};Qf.prototype.getClass=function(){return Qf};Qf.toIntArray=function(t){for(var e=new Array(t.size()).fill(null),n=0;n<e.length;n++)e[n]=t.get(n).intValue();return e};var $h=function(){this.e=null,this.pts=null,this.startIndex=null,this.env1=new $e,this.env2=new $e;var t=arguments[0];this.e=t,this.pts=t.getCoordinates();var e=new Qf;this.startIndex=e.getChainStartIndices(this.pts)};$h.prototype.getCoordinates=function(){return this.pts};$h.prototype.getMaxX=function(t){var e=this.pts[this.startIndex[t]].x,n=this.pts[this.startIndex[t+1]].x;return e>n?e:n};$h.prototype.getMinX=function(t){var e=this.pts[this.startIndex[t]].x,n=this.pts[this.startIndex[t+1]].x;return e<n?e:n};$h.prototype.computeIntersectsForChain=function(){if(arguments.length===4){var t=arguments[0],e=arguments[1],n=arguments[2],r=arguments[3];this.computeIntersectsForChain(this.startIndex[t],this.startIndex[t+1],e,e.startIndex[n],e.startIndex[n+1],r)}else if(arguments.length===6){var i=arguments[0],a=arguments[1],h=arguments[2],u=arguments[3],_=arguments[4],w=arguments[5],C=this.pts[i],P=this.pts[a],D=h.pts[u],B=h.pts[_];if(a-i===1&&_-u===1)return w.addIntersections(this.e,i,h.e,u),null;if(this.env1.init(C,P),this.env2.init(D,B),!this.env1.intersects(this.env2))return null;var $=Math.trunc((i+a)/2),Z=Math.trunc((u+_)/2);i<$&&(u<Z&&this.computeIntersectsForChain(i,$,h,u,Z,w),Z<_&&this.computeIntersectsForChain(i,$,h,Z,_,w)),$<a&&(u<Z&&this.computeIntersectsForChain($,a,h,u,Z,w),Z<_&&this.computeIntersectsForChain($,a,h,Z,_,w))}};$h.prototype.getStartIndexes=function(){return this.startIndex};$h.prototype.computeIntersects=function(t,e){for(var n=this,r=0;r<this.startIndex.length-1;r++)for(var i=0;i<t.startIndex.length-1;i++)n.computeIntersectsForChain(r,t,i,e)};$h.prototype.interfaces_=function(){return[]};$h.prototype.getClass=function(){return $h};var Ro=function t(){var e=this;this._depth=Array(2).fill().map(function(){return Array(3)});for(var n=0;n<2;n++)for(var r=0;r<3;r++)e._depth[n][r]=t.NULL_VALUE},pT={NULL_VALUE:{configurable:!0}};Ro.prototype.getDepth=function(t,e){return this._depth[t][e]};Ro.prototype.setDepth=function(t,e,n){this._depth[t][e]=n};Ro.prototype.isNull=function(){var t=this;if(arguments.length===0){for(var e=0;e<2;e++)for(var n=0;n<3;n++)if(t._depth[e][n]!==Ro.NULL_VALUE)return!1;return!0}else if(arguments.length===1){var r=arguments[0];return this._depth[r][1]===Ro.NULL_VALUE}else if(arguments.length===2){var i=arguments[0],a=arguments[1];return this._depth[i][a]===Ro.NULL_VALUE}};Ro.prototype.normalize=function(){for(var t=this,e=0;e<2;e++)if(!t.isNull(e)){var n=t._depth[e][1];t._depth[e][2]<n&&(n=t._depth[e][2]),n<0&&(n=0);for(var r=1;r<3;r++){var i=0;t._depth[e][r]>n&&(i=1),t._depth[e][r]=i}}};Ro.prototype.getDelta=function(t){return this._depth[t][oe.RIGHT]-this._depth[t][oe.LEFT]};Ro.prototype.getLocation=function(t,e){return this._depth[t][e]<=0?Mt.EXTERIOR:Mt.INTERIOR};Ro.prototype.toString=function(){return"A: "+this._depth[0][1]+","+this._depth[0][2]+" B: "+this._depth[1][1]+","+this._depth[1][2]};Ro.prototype.add=function(){var t=this;if(arguments.length===1)for(var e=arguments[0],n=0;n<2;n++)for(var r=1;r<3;r++){var i=e.getLocation(n,r);(i===Mt.EXTERIOR||i===Mt.INTERIOR)&&(t.isNull(n,r)?t._depth[n][r]=Ro.depthAtLocation(i):t._depth[n][r]+=Ro.depthAtLocation(i))}else if(arguments.length===3){var a=arguments[0],h=arguments[1],u=arguments[2];u===Mt.INTERIOR&&this._depth[a][h]++}};Ro.prototype.interfaces_=function(){return[]};Ro.prototype.getClass=function(){return Ro};Ro.depthAtLocation=function(t){return t===Mt.EXTERIOR?0:t===Mt.INTERIOR?1:Ro.NULL_VALUE};pT.NULL_VALUE.get=function(){return-1};Object.defineProperties(Ro,pT);var Jv=function(t){function e(){if(t.call(this),this.pts=null,this._env=null,this.eiList=new Wc(this),this._name=null,this._mce=null,this._isIsolated=!0,this._depth=new Ro,this._depthDelta=0,arguments.length===1){var n=arguments[0];e.call(this,n,null)}else if(arguments.length===2){var r=arguments[0],i=arguments[1];this.pts=r,this._label=i}}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.getDepth=function(){return this._depth},e.prototype.getCollapsedEdge=function(){var n=new Array(2).fill(null);n[0]=this.pts[0],n[1]=this.pts[1];var r=new e(n,fr.toLineLabel(this._label));return r},e.prototype.isIsolated=function(){return this._isIsolated},e.prototype.getCoordinates=function(){return this.pts},e.prototype.setIsolated=function(n){this._isIsolated=n},e.prototype.setName=function(n){this._name=n},e.prototype.equals=function(n){var r=this;if(!(n instanceof e))return!1;var i=n;if(this.pts.length!==i.pts.length)return!1;for(var a=!0,h=!0,u=this.pts.length,_=0;_<this.pts.length;_++)if(r.pts[_].equals2D(i.pts[_])||(a=!1),r.pts[_].equals2D(i.pts[--u])||(h=!1),!a&&!h)return!1;return!0},e.prototype.getCoordinate=function(){if(arguments.length===0)return this.pts.length>0?this.pts[0]:null;if(arguments.length===1){var n=arguments[0];return this.pts[n]}},e.prototype.print=function(n){var r=this;n.print("edge "+this._name+": "),n.print("LINESTRING (");for(var i=0;i<this.pts.length;i++)i>0&&n.print(","),n.print(r.pts[i].x+" "+r.pts[i].y);n.print(")  "+this._label+" "+this._depthDelta)},e.prototype.computeIM=function(n){e.updateIM(this._label,n)},e.prototype.isCollapsed=function(){return!this._label.isArea()||this.pts.length!==3?!1:!!this.pts[0].equals(this.pts[2])},e.prototype.isClosed=function(){return this.pts[0].equals(this.pts[this.pts.length-1])},e.prototype.getMaximumSegmentIndex=function(){return this.pts.length-1},e.prototype.getDepthDelta=function(){return this._depthDelta},e.prototype.getNumPoints=function(){return this.pts.length},e.prototype.printReverse=function(n){var r=this;n.print("edge "+this._name+": ");for(var i=this.pts.length-1;i>=0;i--)n.print(r.pts[i]+" ");n.println("")},e.prototype.getMonotoneChainEdge=function(){return this._mce===null&&(this._mce=new $h(this)),this._mce},e.prototype.getEnvelope=function(){var n=this;if(this._env===null){this._env=new $e;for(var r=0;r<this.pts.length;r++)n._env.expandToInclude(n.pts[r])}return this._env},e.prototype.addIntersection=function(n,r,i,a){var h=new Lt(n.getIntersection(a)),u=r,_=n.getEdgeDistance(i,a),w=u+1;if(w<this.pts.length){var C=this.pts[w];h.equals2D(C)&&(u=w,_=0)}this.eiList.add(h,u,_)},e.prototype.toString=function(){var n=this,r=new gc;r.append("edge "+this._name+": "),r.append("LINESTRING (");for(var i=0;i<this.pts.length;i++)i>0&&r.append(","),r.append(n.pts[i].x+" "+n.pts[i].y);return r.append(")  "+this._label+" "+this._depthDelta),r.toString()},e.prototype.isPointwiseEqual=function(n){var r=this;if(this.pts.length!==n.pts.length)return!1;for(var i=0;i<this.pts.length;i++)if(!r.pts[i].equals2D(n.pts[i]))return!1;return!0},e.prototype.setDepthDelta=function(n){this._depthDelta=n},e.prototype.getEdgeIntersectionList=function(){return this.eiList},e.prototype.addIntersections=function(n,r,i){for(var a=this,h=0;h<n.getIntersectionNum();h++)a.addIntersection(n,r,i,h)},e.prototype.interfaces_=function(){return[]},e.prototype.getClass=function(){return e},e.updateIM=function(){if(arguments.length===2){var n=arguments[0],r=arguments[1];r.setAtLeastIfValid(n.getLocation(0,oe.ON),n.getLocation(1,oe.ON),1),n.isArea()&&(r.setAtLeastIfValid(n.getLocation(0,oe.LEFT),n.getLocation(1,oe.LEFT),2),r.setAtLeastIfValid(n.getLocation(0,oe.RIGHT),n.getLocation(1,oe.RIGHT),2))}else return t.prototype.updateIM.apply(this,arguments)},e}(tu),Ts=function(t){this._workingPrecisionModel=null,this._workingNoder=null,this._geomFact=null,this._graph=null,this._edgeList=new ol,this._bufParams=t||null};Ts.prototype.setWorkingPrecisionModel=function(t){this._workingPrecisionModel=t};Ts.prototype.insertUniqueEdge=function(t){var e=this._edgeList.findEqualEdge(t);if(e!==null){var n=e.getLabel(),r=t.getLabel();e.isPointwiseEqual(t)||(r=new fr(t.getLabel()),r.flip()),n.merge(r);var i=Ts.depthDelta(r),a=e.getDepthDelta(),h=a+i;e.setDepthDelta(h)}else this._edgeList.add(t),t.setDepthDelta(Ts.depthDelta(t.getLabel()))};Ts.prototype.buildSubgraphs=function(t,e){for(var n=new de,r=t.iterator();r.hasNext();){var i=r.next(),a=i.getRightmostCoordinate(),h=new Zd(n),u=h.getDepth(a);i.computeDepth(u),i.findResultEdges(),n.add(i),e.add(i.getDirectedEdges(),i.getNodes())}};Ts.prototype.createSubgraphs=function(t){for(var e=new de,n=t.getNodes().iterator();n.hasNext();){var r=n.next();if(!r.isVisited()){var i=new Os;i.create(r),e.add(i)}}return il.sort(e,il.reverseOrder()),e};Ts.prototype.createEmptyResultGeometry=function(){var t=this._geomFact.createPolygon();return t};Ts.prototype.getNoder=function(t){if(this._workingNoder!==null)return this._workingNoder;var e=new uw,n=new cd;return n.setPrecisionModel(t),e.setSegmentIntersector(new nu(n)),e};Ts.prototype.buffer=function(t,e){var n=this._workingPrecisionModel;n===null&&(n=t.getPrecisionModel()),this._geomFact=t.getFactory();var r=new ta(n,this._bufParams),i=new Cu(t,e,r),a=i.getCurves();if(a.size()<=0)return this.createEmptyResultGeometry();this.computeNodedEdges(a,n),this._graph=new ti(new hT),this._graph.addEdges(this._edgeList.getEdges());var h=this.createSubgraphs(this._graph),u=new Ea(this._geomFact);this.buildSubgraphs(h,u);var _=u.getPolygons();if(_.size()<=0)return this.createEmptyResultGeometry();var w=this._geomFact.buildGeometry(_);return w};Ts.prototype.computeNodedEdges=function(t,e){var n=this,r=this.getNoder(e);r.computeNodes(t);for(var i=r.getNodedSubstrings(),a=i.iterator();a.hasNext();){var h=a.next(),u=h.getCoordinates();if(!(u.length===2&&u[0].equals2D(u[1]))){var _=h.getData(),w=new Jv(h.getCoordinates(),new fr(_));n.insertUniqueEdge(w)}}};Ts.prototype.setNoder=function(t){this._workingNoder=t};Ts.prototype.interfaces_=function(){return[]};Ts.prototype.getClass=function(){return Ts};Ts.depthDelta=function(t){var e=t.getLocation(0,oe.LEFT),n=t.getLocation(0,oe.RIGHT);return e===Mt.INTERIOR&&n===Mt.EXTERIOR?1:e===Mt.EXTERIOR&&n===Mt.INTERIOR?-1:0};Ts.convertSegStrings=function(t){for(var e=new En,n=new de;t.hasNext();){var r=t.next(),i=e.createLineString(r.getCoordinates());n.add(i)}return e.buildGeometry(n)};var Vp=function(){if(this._noder=null,this._scaleFactor=null,this._offsetX=null,this._offsetY=null,this._isScaled=!1,arguments.length===2){var t=arguments[0],e=arguments[1];this._noder=t,this._scaleFactor=e,this._offsetX=0,this._offsetY=0,this._isScaled=!this.isIntegerPrecision()}else if(arguments.length===4){var n=arguments[0],r=arguments[1],i=arguments[2],a=arguments[3];this._noder=n,this._scaleFactor=r,this._offsetX=i,this._offsetY=a,this._isScaled=!this.isIntegerPrecision()}};Vp.prototype.rescale=function(){var t=this;if(en(arguments[0],Hi))for(var e=arguments[0],n=e.iterator();n.hasNext();){var r=n.next();t.rescale(r.getCoordinates())}else if(arguments[0]instanceof Array){for(var i=arguments[0],a=0;a<i.length;a++)i[a].x=i[a].x/t._scaleFactor+t._offsetX,i[a].y=i[a].y/t._scaleFactor+t._offsetY;i.length===2&&i[0].equals2D(i[1])&&ko.out.println(i)}};Vp.prototype.scale=function(){var t=this;if(en(arguments[0],Hi)){for(var e=arguments[0],n=new de,r=e.iterator();r.hasNext();){var i=r.next();n.add(new Si(t.scale(i.getCoordinates()),i.getData()))}return n}else if(arguments[0]instanceof Array){for(var a=arguments[0],h=new Array(a.length).fill(null),u=0;u<a.length;u++)h[u]=new Lt(Math.round((a[u].x-t._offsetX)*t._scaleFactor),Math.round((a[u].y-t._offsetY)*t._scaleFactor),a[u].z);var _=Sn.removeRepeatedPoints(h);return _}};Vp.prototype.isIntegerPrecision=function(){return this._scaleFactor===1};Vp.prototype.getNodedSubstrings=function(){var t=this._noder.getNodedSubstrings();return this._isScaled&&this.rescale(t),t};Vp.prototype.computeNodes=function(t){var e=t;this._isScaled&&(e=this.scale(t)),this._noder.computeNodes(e)};Vp.prototype.interfaces_=function(){return[Wf]};Vp.prototype.getClass=function(){return Vp};var lc=function(){this._li=new cd,this._segStrings=null;var t=arguments[0];this._segStrings=t},fT={fact:{configurable:!0}};lc.prototype.checkEndPtVertexIntersections=function(){var t=this;if(arguments.length===0)for(var e=this._segStrings.iterator();e.hasNext();){var n=e.next(),r=n.getCoordinates();t.checkEndPtVertexIntersections(r[0],t._segStrings),t.checkEndPtVertexIntersections(r[r.length-1],t._segStrings)}else if(arguments.length===2){for(var i=arguments[0],a=arguments[1],h=a.iterator();h.hasNext();)for(var u=h.next(),_=u.getCoordinates(),w=1;w<_.length-1;w++)if(_[w].equals(i))throw new Fh("found endpt/interior pt intersection at index "+w+" :pt "+i)}};lc.prototype.checkInteriorIntersections=function(){var t=this;if(arguments.length===0)for(var e=this._segStrings.iterator();e.hasNext();)for(var n=e.next(),r=this._segStrings.iterator();r.hasNext();){var i=r.next();t.checkInteriorIntersections(n,i)}else if(arguments.length===2)for(var a=arguments[0],h=arguments[1],u=a.getCoordinates(),_=h.getCoordinates(),w=0;w<u.length-1;w++)for(var C=0;C<_.length-1;C++)t.checkInteriorIntersections(a,w,h,C);else if(arguments.length===4){var P=arguments[0],D=arguments[1],B=arguments[2],$=arguments[3];if(P===B&&D===$)return null;var Z=P.getCoordinates()[D],W=P.getCoordinates()[D+1],rt=B.getCoordinates()[$],ct=B.getCoordinates()[$+1];if(this._li.computeIntersection(Z,W,rt,ct),this._li.hasIntersection()&&(this._li.isProper()||this.hasInteriorIntersection(this._li,Z,W)||this.hasInteriorIntersection(this._li,rt,ct)))throw new Fh("found non-noded intersection at "+Z+"-"+W+" and "+rt+"-"+ct)}};lc.prototype.checkValid=function(){this.checkEndPtVertexIntersections(),this.checkInteriorIntersections(),this.checkCollapses()};lc.prototype.checkCollapses=function(){var t=this;if(arguments.length===0)for(var e=this._segStrings.iterator();e.hasNext();){var n=e.next();t.checkCollapses(n)}else if(arguments.length===1)for(var r=arguments[0],i=r.getCoordinates(),a=0;a<i.length-2;a++)t.checkCollapse(i[a],i[a+1],i[a+2])};lc.prototype.hasInteriorIntersection=function(t,e,n){for(var r=0;r<t.getIntersectionNum();r++){var i=t.getIntersection(r);if(!(i.equals(e)||i.equals(n)))return!0}return!1};lc.prototype.checkCollapse=function(t,e,n){if(t.equals(n))throw new Fh("found non-noded collapse at "+lc.fact.createLineString([t,e,n]))};lc.prototype.interfaces_=function(){return[]};lc.prototype.getClass=function(){return lc};fT.fact.get=function(){return new En};Object.defineProperties(lc,fT);var ea=function(){this._li=null,this._pt=null,this._originalPt=null,this._ptScaled=null,this._p0Scaled=null,this._p1Scaled=null,this._scaleFactor=null,this._minx=null,this._maxx=null,this._miny=null,this._maxy=null,this._corner=new Array(4).fill(null),this._safeEnv=null;var t=arguments[0],e=arguments[1],n=arguments[2];if(this._originalPt=t,this._pt=t,this._scaleFactor=e,this._li=n,e<=0)throw new Yr("Scale factor must be non-zero");e!==1&&(this._pt=new Lt(this.scale(t.x),this.scale(t.y)),this._p0Scaled=new Lt,this._p1Scaled=new Lt),this.initCorners(this._pt)},dT={SAFE_ENV_EXPANSION_FACTOR:{configurable:!0}};ea.prototype.intersectsScaled=function(t,e){var n=Math.min(t.x,e.x),r=Math.max(t.x,e.x),i=Math.min(t.y,e.y),a=Math.max(t.y,e.y),h=this._maxx<n||this._minx>r||this._maxy<i||this._miny>a;if(h)return!1;var u=this.intersectsToleranceSquare(t,e);return dn.isTrue(!(h&&u),"Found bad envelope test"),u};ea.prototype.initCorners=function(t){var e=.5;this._minx=t.x-e,this._maxx=t.x+e,this._miny=t.y-e,this._maxy=t.y+e,this._corner[0]=new Lt(this._maxx,this._maxy),this._corner[1]=new Lt(this._minx,this._maxy),this._corner[2]=new Lt(this._minx,this._miny),this._corner[3]=new Lt(this._maxx,this._miny)};ea.prototype.intersects=function(t,e){return this._scaleFactor===1?this.intersectsScaled(t,e):(this.copyScaled(t,this._p0Scaled),this.copyScaled(e,this._p1Scaled),this.intersectsScaled(this._p0Scaled,this._p1Scaled))};ea.prototype.scale=function(t){return Math.round(t*this._scaleFactor)};ea.prototype.getCoordinate=function(){return this._originalPt};ea.prototype.copyScaled=function(t,e){e.x=this.scale(t.x),e.y=this.scale(t.y)};ea.prototype.getSafeEnvelope=function(){if(this._safeEnv===null){var t=ea.SAFE_ENV_EXPANSION_FACTOR/this._scaleFactor;this._safeEnv=new $e(this._originalPt.x-t,this._originalPt.x+t,this._originalPt.y-t,this._originalPt.y+t)}return this._safeEnv};ea.prototype.intersectsPixelClosure=function(t,e){return this._li.computeIntersection(t,e,this._corner[0],this._corner[1]),!!(this._li.hasIntersection()||(this._li.computeIntersection(t,e,this._corner[1],this._corner[2]),this._li.hasIntersection())||(this._li.computeIntersection(t,e,this._corner[2],this._corner[3]),this._li.hasIntersection())||(this._li.computeIntersection(t,e,this._corner[3],this._corner[0]),this._li.hasIntersection()))};ea.prototype.intersectsToleranceSquare=function(t,e){var n=!1,r=!1;return this._li.computeIntersection(t,e,this._corner[0],this._corner[1]),!!(this._li.isProper()||(this._li.computeIntersection(t,e,this._corner[1],this._corner[2]),this._li.isProper())||(this._li.hasIntersection()&&(n=!0),this._li.computeIntersection(t,e,this._corner[2],this._corner[3]),this._li.isProper())||(this._li.hasIntersection()&&(r=!0),this._li.computeIntersection(t,e,this._corner[3],this._corner[0]),this._li.isProper())||n&&r||t.equals(this._pt)||e.equals(this._pt))};ea.prototype.addSnappedNode=function(t,e){var n=t.getCoordinate(e),r=t.getCoordinate(e+1);return this.intersects(n,r)?(t.addIntersection(this.getCoordinate(),e),!0):!1};ea.prototype.interfaces_=function(){return[]};ea.prototype.getClass=function(){return ea};dT.SAFE_ENV_EXPANSION_FACTOR.get=function(){return .75};Object.defineProperties(ea,dT);var g_=function(){this.tempEnv1=new $e,this.selectedSegment=new Ue};g_.prototype.select=function(){if(arguments.length!==1&&arguments.length===2){var t=arguments[0],e=arguments[1];t.getLineSegment(e,this.selectedSegment),this.select(this.selectedSegment)}};g_.prototype.interfaces_=function(){return[]};g_.prototype.getClass=function(){return g_};var Im=function(){this._index=null;var t=arguments[0];this._index=t},gT={HotPixelSnapAction:{configurable:!0}};Im.prototype.snap=function(){if(arguments.length===1){var t=arguments[0];return this.snap(t,null,-1)}else if(arguments.length===3){var e=arguments[0],n=arguments[1],r=arguments[2],i=e.getSafeEnvelope(),a=new mT(e,n,r);return this._index.query(i,{interfaces_:function(){return[zp]},visitItem:function(h){var u=h;u.select(i,a)}}),a.isNodeAdded()}};Im.prototype.interfaces_=function(){return[]};Im.prototype.getClass=function(){return Im};gT.HotPixelSnapAction.get=function(){return mT};Object.defineProperties(Im,gT);var mT=function(t){function e(){t.call(this),this._hotPixel=null,this._parentEdge=null,this._hotPixelVertexIndex=null,this._isNodeAdded=!1;var n=arguments[0],r=arguments[1],i=arguments[2];this._hotPixel=n,this._parentEdge=r,this._hotPixelVertexIndex=i}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.isNodeAdded=function(){return this._isNodeAdded},e.prototype.select=function(){if(arguments.length===2){var n=arguments[0],r=arguments[1],i=n.getContext();if(this._parentEdge!==null&&i===this._parentEdge&&r===this._hotPixelVertexIndex)return null;this._isNodeAdded=this._hotPixel.addSnappedNode(i,r)}else return t.prototype.select.apply(this,arguments)},e.prototype.interfaces_=function(){return[]},e.prototype.getClass=function(){return e},e}(g_),Hd=function(){this._li=null,this._interiorIntersections=null;var t=arguments[0];this._li=t,this._interiorIntersections=new de};Hd.prototype.processIntersections=function(t,e,n,r){var i=this;if(t===n&&e===r)return null;var a=t.getCoordinates()[e],h=t.getCoordinates()[e+1],u=n.getCoordinates()[r],_=n.getCoordinates()[r+1];if(this._li.computeIntersection(a,h,u,_),this._li.hasIntersection()&&this._li.isInteriorIntersection()){for(var w=0;w<this._li.getIntersectionNum();w++)i._interiorIntersections.add(i._li.getIntersection(w));t.addIntersections(this._li,e,0),n.addIntersections(this._li,r,1)}};Hd.prototype.isDone=function(){return!1};Hd.prototype.getInteriorIntersections=function(){return this._interiorIntersections};Hd.prototype.interfaces_=function(){return[Kf]};Hd.prototype.getClass=function(){return Hd};var Jc=function(){this._pm=null,this._li=null,this._scaleFactor=null,this._noder=null,this._pointSnapper=null,this._nodedSegStrings=null;var t=arguments[0];this._pm=t,this._li=new cd,this._li.setPrecisionModel(t),this._scaleFactor=t.getScale()};Jc.prototype.checkCorrectness=function(t){var e=Si.getNodedSubstrings(t),n=new lc(e);try{n.checkValid()}catch(r){if(r instanceof QC)r.printStackTrace();else throw r}finally{}};Jc.prototype.getNodedSubstrings=function(){return Si.getNodedSubstrings(this._nodedSegStrings)};Jc.prototype.snapRound=function(t,e){var n=this.findInteriorIntersections(t,e);this.computeIntersectionSnaps(n),this.computeVertexSnaps(t)};Jc.prototype.findInteriorIntersections=function(t,e){var n=new Hd(e);return this._noder.setSegmentIntersector(n),this._noder.computeNodes(t),n.getInteriorIntersections()};Jc.prototype.computeVertexSnaps=function(){var t=this;if(en(arguments[0],Hi))for(var e=arguments[0],n=e.iterator();n.hasNext();){var r=n.next();t.computeVertexSnaps(r)}else if(arguments[0]instanceof Si)for(var i=arguments[0],a=i.getCoordinates(),h=0;h<a.length;h++){var u=new ea(a[h],t._scaleFactor,t._li),_=t._pointSnapper.snap(u,i,h);_&&i.addIntersection(a[h],h)}};Jc.prototype.computeNodes=function(t){this._nodedSegStrings=t,this._noder=new uw,this._pointSnapper=new Im(this._noder.getIndex()),this.snapRound(t,this._li)};Jc.prototype.computeIntersectionSnaps=function(t){for(var e=this,n=t.iterator();n.hasNext();){var r=n.next(),i=new ea(r,e._scaleFactor,e._li);e._pointSnapper.snap(i)}};Jc.prototype.interfaces_=function(){return[Wf]};Jc.prototype.getClass=function(){return Jc};var Do=function(){if(this._argGeom=null,this._distance=null,this._bufParams=new Kn,this._resultGeometry=null,this._saveException=null,arguments.length===1){var t=arguments[0];this._argGeom=t}else if(arguments.length===2){var e=arguments[0],n=arguments[1];this._argGeom=e,this._bufParams=n}},Gm={CAP_ROUND:{configurable:!0},CAP_BUTT:{configurable:!0},CAP_FLAT:{configurable:!0},CAP_SQUARE:{configurable:!0},MAX_PRECISION_DIGITS:{configurable:!0}};Do.prototype.bufferFixedPrecision=function(t){var e=new Vp(new Jc(new er(1)),t.getScale()),n=new Ts(this._bufParams);n.setWorkingPrecisionModel(t),n.setNoder(e),this._resultGeometry=n.buffer(this._argGeom,this._distance)};Do.prototype.bufferReducedPrecision=function(){var t=this;if(arguments.length===0){for(var e=Do.MAX_PRECISION_DIGITS;e>=0;e--){try{t.bufferReducedPrecision(e)}catch(a){if(a instanceof zh)t._saveException=a;else throw a}finally{}if(t._resultGeometry!==null)return null}throw this._saveException}else if(arguments.length===1){var n=arguments[0],r=Do.precisionScaleFactor(this._argGeom,this._distance,n),i=new er(r);this.bufferFixedPrecision(i)}};Do.prototype.computeGeometry=function(){if(this.bufferOriginalPrecision(),this._resultGeometry!==null)return null;var t=this._argGeom.getFactory().getPrecisionModel();t.getType()===er.FIXED?this.bufferFixedPrecision(t):this.bufferReducedPrecision()};Do.prototype.setQuadrantSegments=function(t){this._bufParams.setQuadrantSegments(t)};Do.prototype.bufferOriginalPrecision=function(){try{var t=new Ts(this._bufParams);this._resultGeometry=t.buffer(this._argGeom,this._distance)}catch(e){if(e instanceof Fh)this._saveException=e;else throw e}finally{}};Do.prototype.getResultGeometry=function(t){return this._distance=t,this.computeGeometry(),this._resultGeometry};Do.prototype.setEndCapStyle=function(t){this._bufParams.setEndCapStyle(t)};Do.prototype.interfaces_=function(){return[]};Do.prototype.getClass=function(){return Do};Do.bufferOp=function(){if(arguments.length===2){var t=arguments[0],e=arguments[1],n=new Do(t),r=n.getResultGeometry(e);return r}else if(arguments.length===3){if(Number.isInteger(arguments[2])&&arguments[0]instanceof Je&&typeof arguments[1]=="number"){var i=arguments[0],a=arguments[1],h=arguments[2],u=new Do(i);u.setQuadrantSegments(h);var _=u.getResultGeometry(a);return _}else if(arguments[2]instanceof Kn&&arguments[0]instanceof Je&&typeof arguments[1]=="number"){var w=arguments[0],C=arguments[1],P=arguments[2],D=new Do(w,P),B=D.getResultGeometry(C);return B}}else if(arguments.length===4){var $=arguments[0],Z=arguments[1],W=arguments[2],rt=arguments[3],ct=new Do($);ct.setQuadrantSegments(W),ct.setEndCapStyle(rt);var pt=ct.getResultGeometry(Z);return pt}};Do.precisionScaleFactor=function(t,e,n){var r=t.getEnvelopeInternal(),i=Qa.max(Math.abs(r.getMaxX()),Math.abs(r.getMaxY()),Math.abs(r.getMinX()),Math.abs(r.getMinY())),a=e>0?e:0,h=i+2*a,u=Math.trunc(Math.log(h)/Math.log(10)+1),_=n-u,w=Math.pow(10,_);return w};Gm.CAP_ROUND.get=function(){return Kn.CAP_ROUND};Gm.CAP_BUTT.get=function(){return Kn.CAP_FLAT};Gm.CAP_FLAT.get=function(){return Kn.CAP_FLAT};Gm.CAP_SQUARE.get=function(){return Kn.CAP_SQUARE};Gm.MAX_PRECISION_DIGITS.get=function(){return 12};Object.defineProperties(Do,Gm);var Es=function(){this._pt=[new Lt,new Lt],this._distance=ln.NaN,this._isNull=!0};Es.prototype.getCoordinates=function(){return this._pt};Es.prototype.getCoordinate=function(t){return this._pt[t]};Es.prototype.setMinimum=function(){if(arguments.length===1){var t=arguments[0];this.setMinimum(t._pt[0],t._pt[1])}else if(arguments.length===2){var e=arguments[0],n=arguments[1];if(this._isNull)return this.initialize(e,n),null;var r=e.distance(n);r<this._distance&&this.initialize(e,n,r)}};Es.prototype.initialize=function(){if(arguments.length===0)this._isNull=!0;else if(arguments.length===2){var t=arguments[0],e=arguments[1];this._pt[0].setCoordinate(t),this._pt[1].setCoordinate(e),this._distance=t.distance(e),this._isNull=!1}else if(arguments.length===3){var n=arguments[0],r=arguments[1],i=arguments[2];this._pt[0].setCoordinate(n),this._pt[1].setCoordinate(r),this._distance=i,this._isNull=!1}};Es.prototype.getDistance=function(){return this._distance};Es.prototype.setMaximum=function(){if(arguments.length===1){var t=arguments[0];this.setMaximum(t._pt[0],t._pt[1])}else if(arguments.length===2){var e=arguments[0],n=arguments[1];if(this._isNull)return this.initialize(e,n),null;var r=e.distance(n);r>this._distance&&this.initialize(e,n,r)}};Es.prototype.interfaces_=function(){return[]};Es.prototype.getClass=function(){return Es};var Pc=function(){};Pc.prototype.interfaces_=function(){return[]};Pc.prototype.getClass=function(){return Pc};Pc.computeDistance=function(){if(arguments[2]instanceof Es&&arguments[0]instanceof ai&&arguments[1]instanceof Lt)for(var t=arguments[0],e=arguments[1],n=arguments[2],r=t.getCoordinates(),i=new Ue,a=0;a<r.length-1;a++){i.setCoordinates(r[a],r[a+1]);var h=i.closestPoint(e);n.setMinimum(h,e)}else if(arguments[2]instanceof Es&&arguments[0]instanceof eo&&arguments[1]instanceof Lt){var u=arguments[0],_=arguments[1],w=arguments[2];Pc.computeDistance(u.getExteriorRing(),_,w);for(var C=0;C<u.getNumInteriorRing();C++)Pc.computeDistance(u.getInteriorRingN(C),_,w)}else if(arguments[2]instanceof Es&&arguments[0]instanceof Je&&arguments[1]instanceof Lt){var P=arguments[0],D=arguments[1],B=arguments[2];if(P instanceof ai)Pc.computeDistance(P,D,B);else if(P instanceof eo)Pc.computeDistance(P,D,B);else if(P instanceof Ds)for(var $=P,Z=0;Z<$.getNumGeometries();Z++){var W=$.getGeometryN(Z);Pc.computeDistance(W,D,B)}else B.setMinimum(P.getCoordinate(),D)}else if(arguments[2]instanceof Es&&arguments[0]instanceof Ue&&arguments[1]instanceof Lt){var rt=arguments[0],ct=arguments[1],pt=arguments[2],gt=rt.closestPoint(ct);pt.setMinimum(gt,ct)}};var td=function(t){this._maxPtDist=new Es,this._inputGeom=t||null},lw={MaxPointDistanceFilter:{configurable:!0},MaxMidpointDistanceFilter:{configurable:!0}};td.prototype.computeMaxMidpointDistance=function(t){var e=new Up(this._inputGeom);t.apply(e),this._maxPtDist.setMaximum(e.getMaxPointDistance())};td.prototype.computeMaxVertexDistance=function(t){var e=new Wd(this._inputGeom);t.apply(e),this._maxPtDist.setMaximum(e.getMaxPointDistance())};td.prototype.findDistance=function(t){return this.computeMaxVertexDistance(t),this.computeMaxMidpointDistance(t),this._maxPtDist.getDistance()};td.prototype.getDistancePoints=function(){return this._maxPtDist};td.prototype.interfaces_=function(){return[]};td.prototype.getClass=function(){return td};lw.MaxPointDistanceFilter.get=function(){return Wd};lw.MaxMidpointDistanceFilter.get=function(){return Up};Object.defineProperties(td,lw);var Wd=function(t){this._maxPtDist=new Es,this._minPtDist=new Es,this._geom=t||null};Wd.prototype.filter=function(t){this._minPtDist.initialize(),Pc.computeDistance(this._geom,t,this._minPtDist),this._maxPtDist.setMaximum(this._minPtDist)};Wd.prototype.getMaxPointDistance=function(){return this._maxPtDist};Wd.prototype.interfaces_=function(){return[Xc]};Wd.prototype.getClass=function(){return Wd};var Up=function(t){this._maxPtDist=new Es,this._minPtDist=new Es,this._geom=t||null};Up.prototype.filter=function(t,e){if(e===0)return null;var n=t.getCoordinate(e-1),r=t.getCoordinate(e),i=new Lt((n.x+r.x)/2,(n.y+r.y)/2);this._minPtDist.initialize(),Pc.computeDistance(this._geom,i,this._minPtDist),this._maxPtDist.setMaximum(this._minPtDist)};Up.prototype.isDone=function(){return!1};Up.prototype.isGeometryChanged=function(){return!1};Up.prototype.getMaxPointDistance=function(){return this._maxPtDist};Up.prototype.interfaces_=function(){return[nl]};Up.prototype.getClass=function(){return Up};var Nh=function(t){this._comps=t||null};Nh.prototype.filter=function(t){t instanceof eo&&this._comps.add(t)};Nh.prototype.interfaces_=function(){return[ic]};Nh.prototype.getClass=function(){return Nh};Nh.getPolygons=function(){if(arguments.length===1){var t=arguments[0];return Nh.getPolygons(t,new de)}else if(arguments.length===2){var e=arguments[0],n=arguments[1];return e instanceof eo?n.add(e):e instanceof Ds&&e.apply(new Nh(n)),n}};var Mo=function(){if(this._lines=null,this._isForcedToLineString=!1,arguments.length===1){var t=arguments[0];this._lines=t}else if(arguments.length===2){var e=arguments[0],n=arguments[1];this._lines=e,this._isForcedToLineString=n}};Mo.prototype.filter=function(t){if(this._isForcedToLineString&&t instanceof Yc){var e=t.getFactory().createLineString(t.getCoordinateSequence());return this._lines.add(e),null}t instanceof ai&&this._lines.add(t)};Mo.prototype.setForceToLineString=function(t){this._isForcedToLineString=t};Mo.prototype.interfaces_=function(){return[kh]};Mo.prototype.getClass=function(){return Mo};Mo.getGeometry=function(){if(arguments.length===1){var t=arguments[0];return t.getFactory().buildGeometry(Mo.getLines(t))}else if(arguments.length===2){var e=arguments[0],n=arguments[1];return e.getFactory().buildGeometry(Mo.getLines(e,n))}};Mo.getLines=function(){if(arguments.length===1){var t=arguments[0];return Mo.getLines(t,!1)}else if(arguments.length===2){if(en(arguments[0],Hi)&&en(arguments[1],Hi)){for(var e=arguments[0],n=arguments[1],r=e.iterator();r.hasNext();){var i=r.next();Mo.getLines(i,n)}return n}else if(arguments[0]instanceof Je&&typeof arguments[1]=="boolean"){var a=arguments[0],h=arguments[1],u=new de;return a.apply(new Mo(u,h)),u}else if(arguments[0]instanceof Je&&en(arguments[1],Hi)){var _=arguments[0],w=arguments[1];return _ instanceof ai?w.add(_):_.apply(new Mo(w)),w}}else if(arguments.length===3){if(typeof arguments[2]=="boolean"&&en(arguments[0],Hi)&&en(arguments[1],Hi)){for(var C=arguments[0],P=arguments[1],D=arguments[2],B=C.iterator();B.hasNext();){var $=B.next();Mo.getLines($,P,D)}return P}else if(typeof arguments[2]=="boolean"&&arguments[0]instanceof Je&&en(arguments[1],Hi)){var Z=arguments[0],W=arguments[1],rt=arguments[2];return Z.apply(new Mo(W,rt)),W}}};var sl=function(){if(this._boundaryRule=Iu.OGC_SFS_BOUNDARY_RULE,this._isIn=null,this._numBoundaries=null,arguments.length!==0&&arguments.length===1){var t=arguments[0];if(t===null)throw new Yr("Rule must be non-null");this._boundaryRule=t}};sl.prototype.locateInternal=function(){var t=this;if(arguments[0]instanceof Lt&&arguments[1]instanceof eo){var e=arguments[0],n=arguments[1];if(n.isEmpty())return Mt.EXTERIOR;var r=n.getExteriorRing(),i=this.locateInPolygonRing(e,r);if(i===Mt.EXTERIOR)return Mt.EXTERIOR;if(i===Mt.BOUNDARY)return Mt.BOUNDARY;for(var a=0;a<n.getNumInteriorRing();a++){var h=n.getInteriorRingN(a),u=t.locateInPolygonRing(e,h);if(u===Mt.INTERIOR)return Mt.EXTERIOR;if(u===Mt.BOUNDARY)return Mt.BOUNDARY}return Mt.INTERIOR}else if(arguments[0]instanceof Lt&&arguments[1]instanceof ai){var _=arguments[0],w=arguments[1];if(!w.getEnvelopeInternal().intersects(_))return Mt.EXTERIOR;var C=w.getCoordinates();return!w.isClosed()&&(_.equals(C[0])||_.equals(C[C.length-1]))?Mt.BOUNDARY:Ce.isOnLine(_,C)?Mt.INTERIOR:Mt.EXTERIOR}else if(arguments[0]instanceof Lt&&arguments[1]instanceof wa){var P=arguments[0],D=arguments[1],B=D.getCoordinate();return B.equals2D(P)?Mt.INTERIOR:Mt.EXTERIOR}};sl.prototype.locateInPolygonRing=function(t,e){return e.getEnvelopeInternal().intersects(t)?Ce.locatePointInRing(t,e.getCoordinates()):Mt.EXTERIOR};sl.prototype.intersects=function(t,e){return this.locate(t,e)!==Mt.EXTERIOR};sl.prototype.updateLocationInfo=function(t){t===Mt.INTERIOR&&(this._isIn=!0),t===Mt.BOUNDARY&&this._numBoundaries++};sl.prototype.computeLocation=function(t,e){var n=this;if(e instanceof wa&&this.updateLocationInfo(this.locateInternal(t,e)),e instanceof ai)this.updateLocationInfo(this.locateInternal(t,e));else if(e instanceof eo)this.updateLocationInfo(this.locateInternal(t,e));else if(e instanceof Hf)for(var r=e,i=0;i<r.getNumGeometries();i++){var a=r.getGeometryN(i);n.updateLocationInfo(n.locateInternal(t,a))}else if(e instanceof Rc)for(var h=e,u=0;u<h.getNumGeometries();u++){var _=h.getGeometryN(u);n.updateLocationInfo(n.locateInternal(t,_))}else if(e instanceof Ds)for(var w=new Fc(e);w.hasNext();){var C=w.next();C!==e&&n.computeLocation(t,C)}};sl.prototype.locate=function(t,e){return e.isEmpty()?Mt.EXTERIOR:e instanceof ai?this.locateInternal(t,e):e instanceof eo?this.locateInternal(t,e):(this._isIn=!1,this._numBoundaries=0,this.computeLocation(t,e),this._boundaryRule.isInBoundary(this._numBoundaries)?Mt.BOUNDARY:this._numBoundaries>0||this._isIn?Mt.INTERIOR:Mt.EXTERIOR)};sl.prototype.interfaces_=function(){return[]};sl.prototype.getClass=function(){return sl};var Is=function t(){if(this._component=null,this._segIndex=null,this._pt=null,arguments.length===2){var e=arguments[0],n=arguments[1];t.call(this,e,t.INSIDE_AREA,n)}else if(arguments.length===3){var r=arguments[0],i=arguments[1],a=arguments[2];this._component=r,this._segIndex=i,this._pt=a}},yT={INSIDE_AREA:{configurable:!0}};Is.prototype.isInsideArea=function(){return this._segIndex===Is.INSIDE_AREA};Is.prototype.getCoordinate=function(){return this._pt};Is.prototype.getGeometryComponent=function(){return this._component};Is.prototype.getSegmentIndex=function(){return this._segIndex};Is.prototype.interfaces_=function(){return[]};Is.prototype.getClass=function(){return Is};yT.INSIDE_AREA.get=function(){return-1};Object.defineProperties(Is,yT);var Ep=function(t){this._pts=t||null};Ep.prototype.filter=function(t){t instanceof wa&&this._pts.add(t)};Ep.prototype.interfaces_=function(){return[ic]};Ep.prototype.getClass=function(){return Ep};Ep.getPoints=function(){if(arguments.length===1){var t=arguments[0];return t instanceof wa?il.singletonList(t):Ep.getPoints(t,new de)}else if(arguments.length===2){var e=arguments[0],n=arguments[1];return e instanceof wa?n.add(e):e instanceof Ds&&e.apply(new Ep(n)),n}};var Jd=function(){this._locations=null;var t=arguments[0];this._locations=t};Jd.prototype.filter=function(t){(t instanceof wa||t instanceof ai||t instanceof eo)&&this._locations.add(new Is(t,0,t.getCoordinate()))};Jd.prototype.interfaces_=function(){return[ic]};Jd.prototype.getClass=function(){return Jd};Jd.getLocations=function(t){var e=new de;return t.apply(new Jd(e)),e};var Vo=function(){if(this._geom=null,this._terminateDistance=0,this._ptLocator=new sl,this._minDistanceLocation=null,this._minDistance=ln.MAX_VALUE,arguments.length===2){var t=arguments[0],e=arguments[1];this._geom=[t,e],this._terminateDistance=0}else if(arguments.length===3){var n=arguments[0],r=arguments[1],i=arguments[2];this._geom=new Array(2).fill(null),this._geom[0]=n,this._geom[1]=r,this._terminateDistance=i}};Vo.prototype.computeContainmentDistance=function(){var t=this;if(arguments.length===0){var e=new Array(2).fill(null);if(this.computeContainmentDistance(0,e),this._minDistance<=this._terminateDistance)return null;this.computeContainmentDistance(1,e)}else if(arguments.length===2){var n=arguments[0],r=arguments[1],i=1-n,a=Nh.getPolygons(this._geom[n]);if(a.size()>0){var h=Jd.getLocations(this._geom[i]);if(this.computeContainmentDistance(h,a,r),this._minDistance<=this._terminateDistance)return this._minDistanceLocation[i]=r[0],this._minDistanceLocation[n]=r[1],null}}else if(arguments.length===3){if(arguments[2]instanceof Array&&en(arguments[0],Yu)&&en(arguments[1],Yu)){for(var u=arguments[0],_=arguments[1],w=arguments[2],C=0;C<u.size();C++)for(var P=u.get(C),D=0;D<_.size();D++)if(t.computeContainmentDistance(P,_.get(D),w),t._minDistance<=t._terminateDistance)return null}else if(arguments[2]instanceof Array&&arguments[0]instanceof Is&&arguments[1]instanceof eo){var B=arguments[0],$=arguments[1],Z=arguments[2],W=B.getCoordinate();if(Mt.EXTERIOR!==this._ptLocator.locate(W,$))return this._minDistance=0,Z[0]=B,Z[1]=new Is($,W),null}}};Vo.prototype.computeMinDistanceLinesPoints=function(t,e,n){for(var r=this,i=0;i<t.size();i++)for(var a=t.get(i),h=0;h<e.size();h++){var u=e.get(h);if(r.computeMinDistance(a,u,n),r._minDistance<=r._terminateDistance)return null}};Vo.prototype.computeFacetDistance=function(){var t=new Array(2).fill(null),e=Mo.getLines(this._geom[0]),n=Mo.getLines(this._geom[1]),r=Ep.getPoints(this._geom[0]),i=Ep.getPoints(this._geom[1]);if(this.computeMinDistanceLines(e,n,t),this.updateMinDistance(t,!1),this._minDistance<=this._terminateDistance||(t[0]=null,t[1]=null,this.computeMinDistanceLinesPoints(e,i,t),this.updateMinDistance(t,!1),this._minDistance<=this._terminateDistance)||(t[0]=null,t[1]=null,this.computeMinDistanceLinesPoints(n,r,t),this.updateMinDistance(t,!0),this._minDistance<=this._terminateDistance))return null;t[0]=null,t[1]=null,this.computeMinDistancePoints(r,i,t),this.updateMinDistance(t,!1)};Vo.prototype.nearestLocations=function(){return this.computeMinDistance(),this._minDistanceLocation};Vo.prototype.updateMinDistance=function(t,e){if(t[0]===null)return null;e?(this._minDistanceLocation[0]=t[1],this._minDistanceLocation[1]=t[0]):(this._minDistanceLocation[0]=t[0],this._minDistanceLocation[1]=t[1])};Vo.prototype.nearestPoints=function(){this.computeMinDistance();var t=[this._minDistanceLocation[0].getCoordinate(),this._minDistanceLocation[1].getCoordinate()];return t};Vo.prototype.computeMinDistance=function(){var t=this;if(arguments.length===0){if(this._minDistanceLocation!==null||(this._minDistanceLocation=new Array(2).fill(null),this.computeContainmentDistance(),this._minDistance<=this._terminateDistance))return null;this.computeFacetDistance()}else if(arguments.length===3){if(arguments[2]instanceof Array&&arguments[0]instanceof ai&&arguments[1]instanceof wa){var e=arguments[0],n=arguments[1],r=arguments[2];if(e.getEnvelopeInternal().distance(n.getEnvelopeInternal())>this._minDistance)return null;for(var i=e.getCoordinates(),a=n.getCoordinate(),h=0;h<i.length-1;h++){var u=Ce.distancePointLine(a,i[h],i[h+1]);if(u<t._minDistance){t._minDistance=u;var _=new Ue(i[h],i[h+1]),w=_.closestPoint(a);r[0]=new Is(e,h,w),r[1]=new Is(n,0,a)}if(t._minDistance<=t._terminateDistance)return null}}else if(arguments[2]instanceof Array&&arguments[0]instanceof ai&&arguments[1]instanceof ai){var C=arguments[0],P=arguments[1],D=arguments[2];if(C.getEnvelopeInternal().distance(P.getEnvelopeInternal())>this._minDistance)return null;for(var B=C.getCoordinates(),$=P.getCoordinates(),Z=0;Z<B.length-1;Z++)for(var W=0;W<$.length-1;W++){var rt=Ce.distanceLineLine(B[Z],B[Z+1],$[W],$[W+1]);if(rt<t._minDistance){t._minDistance=rt;var ct=new Ue(B[Z],B[Z+1]),pt=new Ue($[W],$[W+1]),gt=ct.closestPoints(pt);D[0]=new Is(C,Z,gt[0]),D[1]=new Is(P,W,gt[1])}if(t._minDistance<=t._terminateDistance)return null}}}};Vo.prototype.computeMinDistancePoints=function(t,e,n){for(var r=this,i=0;i<t.size();i++)for(var a=t.get(i),h=0;h<e.size();h++){var u=e.get(h),_=a.getCoordinate().distance(u.getCoordinate());if(_<r._minDistance&&(r._minDistance=_,n[0]=new Is(a,0,a.getCoordinate()),n[1]=new Is(u,0,u.getCoordinate())),r._minDistance<=r._terminateDistance)return null}};Vo.prototype.distance=function(){if(this._geom[0]===null||this._geom[1]===null)throw new Yr("null geometries are not supported");return this._geom[0].isEmpty()||this._geom[1].isEmpty()?0:(this.computeMinDistance(),this._minDistance)};Vo.prototype.computeMinDistanceLines=function(t,e,n){for(var r=this,i=0;i<t.size();i++)for(var a=t.get(i),h=0;h<e.size();h++){var u=e.get(h);if(r.computeMinDistance(a,u,n),r._minDistance<=r._terminateDistance)return null}};Vo.prototype.interfaces_=function(){return[]};Vo.prototype.getClass=function(){return Vo};Vo.distance=function(t,e){var n=new Vo(t,e);return n.distance()};Vo.isWithinDistance=function(t,e,n){var r=new Vo(t,e,n);return r.distance()<=n};Vo.nearestPoints=function(t,e){var n=new Vo(t,e);return n.nearestPoints()};var Ko=function(){this._pt=[new Lt,new Lt],this._distance=ln.NaN,this._isNull=!0};Ko.prototype.getCoordinates=function(){return this._pt};Ko.prototype.getCoordinate=function(t){return this._pt[t]};Ko.prototype.setMinimum=function(){if(arguments.length===1){var t=arguments[0];this.setMinimum(t._pt[0],t._pt[1])}else if(arguments.length===2){var e=arguments[0],n=arguments[1];if(this._isNull)return this.initialize(e,n),null;var r=e.distance(n);r<this._distance&&this.initialize(e,n,r)}};Ko.prototype.initialize=function(){if(arguments.length===0)this._isNull=!0;else if(arguments.length===2){var t=arguments[0],e=arguments[1];this._pt[0].setCoordinate(t),this._pt[1].setCoordinate(e),this._distance=t.distance(e),this._isNull=!1}else if(arguments.length===3){var n=arguments[0],r=arguments[1],i=arguments[2];this._pt[0].setCoordinate(n),this._pt[1].setCoordinate(r),this._distance=i,this._isNull=!1}};Ko.prototype.toString=function(){return el.toLineString(this._pt[0],this._pt[1])};Ko.prototype.getDistance=function(){return this._distance};Ko.prototype.setMaximum=function(){if(arguments.length===1){var t=arguments[0];this.setMaximum(t._pt[0],t._pt[1])}else if(arguments.length===2){var e=arguments[0],n=arguments[1];if(this._isNull)return this.initialize(e,n),null;var r=e.distance(n);r>this._distance&&this.initialize(e,n,r)}};Ko.prototype.interfaces_=function(){return[]};Ko.prototype.getClass=function(){return Ko};var $l=function(){};$l.prototype.interfaces_=function(){return[]};$l.prototype.getClass=function(){return $l};$l.computeDistance=function(){if(arguments[2]instanceof Ko&&arguments[0]instanceof ai&&arguments[1]instanceof Lt)for(var t=arguments[0],e=arguments[1],n=arguments[2],r=new Ue,i=t.getCoordinates(),a=0;a<i.length-1;a++){r.setCoordinates(i[a],i[a+1]);var h=r.closestPoint(e);n.setMinimum(h,e)}else if(arguments[2]instanceof Ko&&arguments[0]instanceof eo&&arguments[1]instanceof Lt){var u=arguments[0],_=arguments[1],w=arguments[2];$l.computeDistance(u.getExteriorRing(),_,w);for(var C=0;C<u.getNumInteriorRing();C++)$l.computeDistance(u.getInteriorRingN(C),_,w)}else if(arguments[2]instanceof Ko&&arguments[0]instanceof Je&&arguments[1]instanceof Lt){var P=arguments[0],D=arguments[1],B=arguments[2];if(P instanceof ai)$l.computeDistance(P,D,B);else if(P instanceof eo)$l.computeDistance(P,D,B);else if(P instanceof Ds)for(var $=P,Z=0;Z<$.getNumGeometries();Z++){var W=$.getGeometryN(Z);$l.computeDistance(W,D,B)}else B.setMinimum(P.getCoordinate(),D)}else if(arguments[2]instanceof Ko&&arguments[0]instanceof Ue&&arguments[1]instanceof Lt){var rt=arguments[0],ct=arguments[1],pt=arguments[2],gt=rt.closestPoint(ct);pt.setMinimum(gt,ct)}};var _u=function(){this._g0=null,this._g1=null,this._ptDist=new Ko,this._densifyFrac=0;var t=arguments[0],e=arguments[1];this._g0=t,this._g1=e},cw={MaxPointDistanceFilter:{configurable:!0},MaxDensifiedByFractionDistanceFilter:{configurable:!0}};_u.prototype.getCoordinates=function(){return this._ptDist.getCoordinates()};_u.prototype.setDensifyFraction=function(t){if(t>1||t<=0)throw new Yr("Fraction is not in range (0.0 - 1.0]");this._densifyFrac=t};_u.prototype.compute=function(t,e){this.computeOrientedDistance(t,e,this._ptDist),this.computeOrientedDistance(e,t,this._ptDist)};_u.prototype.distance=function(){return this.compute(this._g0,this._g1),this._ptDist.getDistance()};_u.prototype.computeOrientedDistance=function(t,e,n){var r=new Kd(e);if(t.apply(r),n.setMaximum(r.getMaxPointDistance()),this._densifyFrac>0){var i=new Gp(e,this._densifyFrac);t.apply(i),n.setMaximum(i.getMaxPointDistance())}};_u.prototype.orientedDistance=function(){return this.computeOrientedDistance(this._g0,this._g1,this._ptDist),this._ptDist.getDistance()};_u.prototype.interfaces_=function(){return[]};_u.prototype.getClass=function(){return _u};_u.distance=function(){if(arguments.length===2){var t=arguments[0],e=arguments[1],n=new _u(t,e);return n.distance()}else if(arguments.length===3){var r=arguments[0],i=arguments[1],a=arguments[2],h=new _u(r,i);return h.setDensifyFraction(a),h.distance()}};cw.MaxPointDistanceFilter.get=function(){return Kd};cw.MaxDensifiedByFractionDistanceFilter.get=function(){return Gp};Object.defineProperties(_u,cw);var Kd=function(){this._maxPtDist=new Ko,this._minPtDist=new Ko,this._euclideanDist=new $l,this._geom=null;var t=arguments[0];this._geom=t};Kd.prototype.filter=function(t){this._minPtDist.initialize(),$l.computeDistance(this._geom,t,this._minPtDist),this._maxPtDist.setMaximum(this._minPtDist)};Kd.prototype.getMaxPointDistance=function(){return this._maxPtDist};Kd.prototype.interfaces_=function(){return[Xc]};Kd.prototype.getClass=function(){return Kd};var Gp=function(){this._maxPtDist=new Ko,this._minPtDist=new Ko,this._geom=null,this._numSubSegs=0;var t=arguments[0],e=arguments[1];this._geom=t,this._numSubSegs=Math.trunc(Math.round(1/e))};Gp.prototype.filter=function(t,e){var n=this;if(e===0)return null;for(var r=t.getCoordinate(e-1),i=t.getCoordinate(e),a=(i.x-r.x)/this._numSubSegs,h=(i.y-r.y)/this._numSubSegs,u=0;u<this._numSubSegs;u++){var _=r.x+u*a,w=r.y+u*h,C=new Lt(_,w);n._minPtDist.initialize(),$l.computeDistance(n._geom,C,n._minPtDist),n._maxPtDist.setMaximum(n._minPtDist)}};Gp.prototype.isDone=function(){return!1};Gp.prototype.isGeometryChanged=function(){return!1};Gp.prototype.getMaxPointDistance=function(){return this._maxPtDist};Gp.prototype.interfaces_=function(){return[nl]};Gp.prototype.getClass=function(){return Gp};var ma=function(t,e,n){this._minValidDistance=null,this._maxValidDistance=null,this._minDistanceFound=null,this._maxDistanceFound=null,this._isValid=!0,this._errMsg=null,this._errorLocation=null,this._errorIndicator=null,this._input=t||null,this._bufDistance=e||null,this._result=n||null},hw={VERBOSE:{configurable:!0},MAX_DISTANCE_DIFF_FRAC:{configurable:!0}};ma.prototype.checkMaximumDistance=function(t,e,n){var r=new _u(e,t);if(r.setDensifyFraction(.25),this._maxDistanceFound=r.orientedDistance(),this._maxDistanceFound>n){this._isValid=!1;var i=r.getCoordinates();this._errorLocation=i[1],this._errorIndicator=t.getFactory().createLineString(i),this._errMsg="Distance between buffer curve and input is too large ("+this._maxDistanceFound+" at "+el.toLineString(i[0],i[1])+")"}};ma.prototype.isValid=function(){var t=Math.abs(this._bufDistance),e=ma.MAX_DISTANCE_DIFF_FRAC*t;return this._minValidDistance=t-e,this._maxValidDistance=t+e,this._input.isEmpty()||this._result.isEmpty()?!0:(this._bufDistance>0?this.checkPositiveValid():this.checkNegativeValid(),ma.VERBOSE&&ko.out.println("Min Dist= "+this._minDistanceFound+"  err= "+(1-this._minDistanceFound/this._bufDistance)+"  Max Dist= "+this._maxDistanceFound+"  err= "+(this._maxDistanceFound/this._bufDistance-1)),this._isValid)};ma.prototype.checkNegativeValid=function(){if(!(this._input instanceof eo||this._input instanceof Rc||this._input instanceof Ds))return null;var t=this.getPolygonLines(this._input);if(this.checkMinimumDistance(t,this._result,this._minValidDistance),!this._isValid)return null;this.checkMaximumDistance(t,this._result,this._maxValidDistance)};ma.prototype.getErrorIndicator=function(){return this._errorIndicator};ma.prototype.checkMinimumDistance=function(t,e,n){var r=new Vo(t,e,n);if(this._minDistanceFound=r.distance(),this._minDistanceFound<n){this._isValid=!1;var i=r.nearestPoints();this._errorLocation=r.nearestPoints()[1],this._errorIndicator=t.getFactory().createLineString(i),this._errMsg="Distance between buffer curve and input is too small ("+this._minDistanceFound+" at "+el.toLineString(i[0],i[1])+" )"}};ma.prototype.checkPositiveValid=function(){var t=this._result.getBoundary();if(this.checkMinimumDistance(this._input,t,this._minValidDistance),!this._isValid)return null;this.checkMaximumDistance(this._input,t,this._maxValidDistance)};ma.prototype.getErrorLocation=function(){return this._errorLocation};ma.prototype.getPolygonLines=function(t){for(var e=new de,n=new Mo(e),r=Nh.getPolygons(t),i=r.iterator();i.hasNext();){var a=i.next();a.apply(n)}return t.getFactory().buildGeometry(e)};ma.prototype.getErrorMessage=function(){return this._errMsg};ma.prototype.interfaces_=function(){return[]};ma.prototype.getClass=function(){return ma};hw.VERBOSE.get=function(){return!1};hw.MAX_DISTANCE_DIFF_FRAC.get=function(){return .012};Object.defineProperties(ma,hw);var Uo=function(t,e,n){this._isValid=!0,this._errorMsg=null,this._errorLocation=null,this._errorIndicator=null,this._input=t||null,this._distance=e||null,this._result=n||null},pw={VERBOSE:{configurable:!0},MAX_ENV_DIFF_FRAC:{configurable:!0}};Uo.prototype.isValid=function(){return this.checkPolygonal(),this._isValid?(this.checkExpectedEmpty(),this._isValid?(this.checkEnvelope(),this._isValid?(this.checkArea(),this._isValid?(this.checkDistance(),this._isValid):this._isValid):this._isValid):this._isValid):this._isValid};Uo.prototype.checkEnvelope=function(){if(this._distance<0)return null;var t=this._distance*Uo.MAX_ENV_DIFF_FRAC;t===0&&(t=.001);var e=new $e(this._input.getEnvelopeInternal());e.expandBy(this._distance);var n=new $e(this._result.getEnvelopeInternal());n.expandBy(t),n.contains(e)||(this._isValid=!1,this._errorMsg="Buffer envelope is incorrect",this._errorIndicator=this._input.getFactory().toGeometry(n)),this.report("Envelope")};Uo.prototype.checkDistance=function(){var t=new ma(this._input,this._distance,this._result);t.isValid()||(this._isValid=!1,this._errorMsg=t.getErrorMessage(),this._errorLocation=t.getErrorLocation(),this._errorIndicator=t.getErrorIndicator()),this.report("Distance")};Uo.prototype.checkArea=function(){var t=this._input.getArea(),e=this._result.getArea();this._distance>0&&t>e&&(this._isValid=!1,this._errorMsg="Area of positive buffer is smaller than input",this._errorIndicator=this._result),this._distance<0&&t<e&&(this._isValid=!1,this._errorMsg="Area of negative buffer is larger than input",this._errorIndicator=this._result),this.report("Area")};Uo.prototype.checkPolygonal=function(){this._result instanceof eo||this._result instanceof Rc||(this._isValid=!1),this._errorMsg="Result is not polygonal",this._errorIndicator=this._result,this.report("Polygonal")};Uo.prototype.getErrorIndicator=function(){return this._errorIndicator};Uo.prototype.getErrorLocation=function(){return this._errorLocation};Uo.prototype.checkExpectedEmpty=function(){if(this._input.getDimension()>=2||this._distance>0)return null;this._result.isEmpty()||(this._isValid=!1,this._errorMsg="Result is non-empty",this._errorIndicator=this._result),this.report("ExpectedEmpty")};Uo.prototype.report=function(t){if(!Uo.VERBOSE)return null;ko.out.println("Check "+t+": "+(this._isValid?"passed":"FAILED"))};Uo.prototype.getErrorMessage=function(){return this._errorMsg};Uo.prototype.interfaces_=function(){return[]};Uo.prototype.getClass=function(){return Uo};Uo.isValidMsg=function(t,e,n){var r=new Uo(t,e,n);return r.isValid()?null:r.getErrorMessage()};Uo.isValid=function(t,e,n){var r=new Uo(t,e,n);return!!r.isValid()};pw.VERBOSE.get=function(){return!1};pw.MAX_ENV_DIFF_FRAC.get=function(){return .012};Object.defineProperties(Uo,pw);var cc=function(){this._pts=null,this._data=null;var t=arguments[0],e=arguments[1];this._pts=t,this._data=e};cc.prototype.getCoordinates=function(){return this._pts};cc.prototype.size=function(){return this._pts.length};cc.prototype.getCoordinate=function(t){return this._pts[t]};cc.prototype.isClosed=function(){return this._pts[0].equals(this._pts[this._pts.length-1])};cc.prototype.getSegmentOctant=function(t){return t===this._pts.length-1?-1:Yd.octant(this.getCoordinate(t),this.getCoordinate(t+1))};cc.prototype.setData=function(t){this._data=t};cc.prototype.getData=function(){return this._data};cc.prototype.toString=function(){return el.toLineString(new _i(this._pts))};cc.prototype.interfaces_=function(){return[Hc]};cc.prototype.getClass=function(){return cc};var Io=function(){this._findAllIntersections=!1,this._isCheckEndSegmentsOnly=!1,this._li=null,this._interiorIntersection=null,this._intSegments=null,this._intersections=new de,this._intersectionCount=0,this._keepIntersections=!0;var t=arguments[0];this._li=t,this._interiorIntersection=null};Io.prototype.getInteriorIntersection=function(){return this._interiorIntersection};Io.prototype.setCheckEndSegmentsOnly=function(t){this._isCheckEndSegmentsOnly=t};Io.prototype.getIntersectionSegments=function(){return this._intSegments};Io.prototype.count=function(){return this._intersectionCount};Io.prototype.getIntersections=function(){return this._intersections};Io.prototype.setFindAllIntersections=function(t){this._findAllIntersections=t};Io.prototype.setKeepIntersections=function(t){this._keepIntersections=t};Io.prototype.processIntersections=function(t,e,n,r){if(!this._findAllIntersections&&this.hasIntersection()||t===n&&e===r)return null;if(this._isCheckEndSegmentsOnly){var i=this.isEndSegment(t,e)||this.isEndSegment(n,r);if(!i)return null}var a=t.getCoordinates()[e],h=t.getCoordinates()[e+1],u=n.getCoordinates()[r],_=n.getCoordinates()[r+1];this._li.computeIntersection(a,h,u,_),this._li.hasIntersection()&&this._li.isInteriorIntersection()&&(this._intSegments=new Array(4).fill(null),this._intSegments[0]=a,this._intSegments[1]=h,this._intSegments[2]=u,this._intSegments[3]=_,this._interiorIntersection=this._li.getIntersection(0),this._keepIntersections&&this._intersections.add(this._interiorIntersection),this._intersectionCount++)};Io.prototype.isEndSegment=function(t,e){return e===0||e>=t.size()-2};Io.prototype.hasIntersection=function(){return this._interiorIntersection!==null};Io.prototype.isDone=function(){return this._findAllIntersections?!1:this._interiorIntersection!==null};Io.prototype.interfaces_=function(){return[Kf]};Io.prototype.getClass=function(){return Io};Io.createAllIntersectionsFinder=function(t){var e=new Io(t);return e.setFindAllIntersections(!0),e};Io.createAnyIntersectionFinder=function(t){return new Io(t)};Io.createIntersectionCounter=function(t){var e=new Io(t);return e.setFindAllIntersections(!0),e.setKeepIntersections(!1),e};var al=function(){this._li=new cd,this._segStrings=null,this._findAllIntersections=!1,this._segInt=null,this._isValid=!0;var t=arguments[0];this._segStrings=t};al.prototype.execute=function(){if(this._segInt!==null)return null;this.checkInteriorIntersections()};al.prototype.getIntersections=function(){return this._segInt.getIntersections()};al.prototype.isValid=function(){return this.execute(),this._isValid};al.prototype.setFindAllIntersections=function(t){this._findAllIntersections=t};al.prototype.checkInteriorIntersections=function(){this._isValid=!0,this._segInt=new Io(this._li),this._segInt.setFindAllIntersections(this._findAllIntersections);var t=new uw;if(t.setSegmentIntersector(this._segInt),t.computeNodes(this._segStrings),this._segInt.hasIntersection())return this._isValid=!1,null};al.prototype.checkValid=function(){if(this.execute(),!this._isValid)throw new zh(this.getErrorMessage(),this._segInt.getInteriorIntersection())};al.prototype.getErrorMessage=function(){if(this._isValid)return"no intersections found";var t=this._segInt.getIntersectionSegments();return"found non-noded intersection between "+el.toLineString(t[0],t[1])+" and "+el.toLineString(t[2],t[3])};al.prototype.interfaces_=function(){return[]};al.prototype.getClass=function(){return al};al.computeIntersections=function(t){var e=new al(t);return e.setFindAllIntersections(!0),e.isValid(),e.getIntersections()};var ed=function t(){this._nv=null;var e=arguments[0];this._nv=new al(t.toSegmentStrings(e))};ed.prototype.checkValid=function(){this._nv.checkValid()};ed.prototype.interfaces_=function(){return[]};ed.prototype.getClass=function(){return ed};ed.toSegmentStrings=function(t){for(var e=new de,n=t.iterator();n.hasNext();){var r=n.next();e.add(new cc(r.getCoordinates(),r))}return e};ed.checkValid=function(t){var e=new ed(t);e.checkValid()};var Qd=function(t){this._mapOp=t};Qd.prototype.map=function(t){for(var e=this,n=new de,r=0;r<t.getNumGeometries();r++){var i=e._mapOp.map(t.getGeometryN(r));i.isEmpty()||n.add(i)}return t.getFactory().createGeometryCollection(En.toGeometryArray(n))};Qd.prototype.interfaces_=function(){return[]};Qd.prototype.getClass=function(){return Qd};Qd.map=function(t,e){var n=new Qd(e);return n.map(t)};var hc=function(){this._op=null,this._geometryFactory=null,this._ptLocator=null,this._lineEdgesList=new de,this._resultLineList=new de;var t=arguments[0],e=arguments[1],n=arguments[2];this._op=t,this._geometryFactory=e,this._ptLocator=n};hc.prototype.collectLines=function(t){for(var e=this,n=this._op.getGraph().getEdgeEnds().iterator();n.hasNext();){var r=n.next();e.collectLineEdge(r,t,e._lineEdgesList),e.collectBoundaryTouchEdge(r,t,e._lineEdgesList)}};hc.prototype.labelIsolatedLine=function(t,e){var n=this._ptLocator.locate(t.getCoordinate(),this._op.getArgGeometry(e));t.getLabel().setLocation(e,n)};hc.prototype.build=function(t){return this.findCoveredLineEdges(),this.collectLines(t),this.buildLines(t),this._resultLineList};hc.prototype.collectLineEdge=function(t,e,n){var r=t.getLabel(),i=t.getEdge();t.isLineEdge()&&!t.isVisited()&&pn.isResultOfOp(r,e)&&!i.isCovered()&&(n.add(i),t.setVisitedEdge(!0))};hc.prototype.findCoveredLineEdges=function(){for(var t=this,e=this._op.getGraph().getNodes().iterator();e.hasNext();){var n=e.next();n.getEdges().findCoveredLineEdges()}for(var r=this._op.getGraph().getEdgeEnds().iterator();r.hasNext();){var i=r.next(),a=i.getEdge();if(i.isLineEdge()&&!a.isCoveredSet()){var h=t._op.isCoveredByA(i.getCoordinate());a.setCovered(h)}}};hc.prototype.labelIsolatedLines=function(t){for(var e=this,n=t.iterator();n.hasNext();){var r=n.next(),i=r.getLabel();r.isIsolated()&&(i.isNull(0)?e.labelIsolatedLine(r,0):e.labelIsolatedLine(r,1))}};hc.prototype.buildLines=function(t){for(var e=this,n=this._lineEdgesList.iterator();n.hasNext();){var r=n.next(),i=e._geometryFactory.createLineString(r.getCoordinates());e._resultLineList.add(i),r.setInResult(!0)}};hc.prototype.collectBoundaryTouchEdge=function(t,e,n){var r=t.getLabel();if(t.isLineEdge()||t.isVisited()||t.isInteriorAreaEdge()||t.getEdge().isInResult())return null;dn.isTrue(!(t.isInResult()||t.getSym().isInResult())||!t.getEdge().isInResult()),pn.isResultOfOp(r,e)&&e===pn.INTERSECTION&&(n.add(t.getEdge()),t.setVisitedEdge(!0))};hc.prototype.interfaces_=function(){return[]};hc.prototype.getClass=function(){return hc};var tg=function(){this._op=null,this._geometryFactory=null,this._resultPointList=new de;var t=arguments[0],e=arguments[1];this._op=t,this._geometryFactory=e};tg.prototype.filterCoveredNodeToPoint=function(t){var e=t.getCoordinate();if(!this._op.isCoveredByLA(e)){var n=this._geometryFactory.createPoint(e);this._resultPointList.add(n)}};tg.prototype.extractNonCoveredResultNodes=function(t){for(var e=this,n=this._op.getGraph().getNodes().iterator();n.hasNext();){var r=n.next();if(!r.isInResult()&&!r.isIncidentEdgeInResult()&&(r.getEdges().getDegree()===0||t===pn.INTERSECTION)){var i=r.getLabel();pn.isResultOfOp(i,t)&&e.filterCoveredNodeToPoint(r)}}};tg.prototype.build=function(t){return this.extractNonCoveredResultNodes(t),this._resultPointList};tg.prototype.interfaces_=function(){return[]};tg.prototype.getClass=function(){return tg};var na=function(){this._inputGeom=null,this._factory=null,this._pruneEmptyGeometry=!0,this._preserveGeometryCollectionType=!0,this._preserveCollections=!1,this._preserveType=!1};na.prototype.transformPoint=function(t,e){return this._factory.createPoint(this.transformCoordinates(t.getCoordinateSequence(),t))};na.prototype.transformPolygon=function(t,e){var n=this,r=!0,i=this.transformLinearRing(t.getExteriorRing(),t);(i===null||!(i instanceof Yc)||i.isEmpty())&&(r=!1);for(var a=new de,h=0;h<t.getNumInteriorRing();h++){var u=n.transformLinearRing(t.getInteriorRingN(h),t);u===null||u.isEmpty()||(u instanceof Yc||(r=!1),a.add(u))}if(r)return this._factory.createPolygon(i,a.toArray([]));var _=new de;return i!==null&&_.add(i),_.addAll(a),this._factory.buildGeometry(_)};na.prototype.createCoordinateSequence=function(t){return this._factory.getCoordinateSequenceFactory().create(t)};na.prototype.getInputGeometry=function(){return this._inputGeom};na.prototype.transformMultiLineString=function(t,e){for(var n=this,r=new de,i=0;i<t.getNumGeometries();i++){var a=n.transformLineString(t.getGeometryN(i),t);a!==null&&(a.isEmpty()||r.add(a))}return this._factory.buildGeometry(r)};na.prototype.transformCoordinates=function(t,e){return this.copy(t)};na.prototype.transformLineString=function(t,e){return this._factory.createLineString(this.transformCoordinates(t.getCoordinateSequence(),t))};na.prototype.transformMultiPoint=function(t,e){for(var n=this,r=new de,i=0;i<t.getNumGeometries();i++){var a=n.transformPoint(t.getGeometryN(i),t);a!==null&&(a.isEmpty()||r.add(a))}return this._factory.buildGeometry(r)};na.prototype.transformMultiPolygon=function(t,e){for(var n=this,r=new de,i=0;i<t.getNumGeometries();i++){var a=n.transformPolygon(t.getGeometryN(i),t);a!==null&&(a.isEmpty()||r.add(a))}return this._factory.buildGeometry(r)};na.prototype.copy=function(t){return t.copy()};na.prototype.transformGeometryCollection=function(t,e){for(var n=this,r=new de,i=0;i<t.getNumGeometries();i++){var a=n.transform(t.getGeometryN(i));a!==null&&(n._pruneEmptyGeometry&&a.isEmpty()||r.add(a))}return this._preserveGeometryCollectionType?this._factory.createGeometryCollection(En.toGeometryArray(r)):this._factory.buildGeometry(r)};na.prototype.transform=function(t){if(this._inputGeom=t,this._factory=t.getFactory(),t instanceof wa)return this.transformPoint(t,null);if(t instanceof vm)return this.transformMultiPoint(t,null);if(t instanceof Yc)return this.transformLinearRing(t,null);if(t instanceof ai)return this.transformLineString(t,null);if(t instanceof Hf)return this.transformMultiLineString(t,null);if(t instanceof eo)return this.transformPolygon(t,null);if(t instanceof Rc)return this.transformMultiPolygon(t,null);if(t instanceof Ds)return this.transformGeometryCollection(t,null);throw new Yr("Unknown Geometry subtype: "+t.getClass().getName())};na.prototype.transformLinearRing=function(t,e){var n=this.transformCoordinates(t.getCoordinateSequence(),t);if(n===null)return this._factory.createLinearRing(null);var r=n.size();return r>0&&r<4&&!this._preserveType?this._factory.createLineString(n):this._factory.createLinearRing(n)};na.prototype.interfaces_=function(){return[]};na.prototype.getClass=function(){return na};var Kc=function t(){if(this._snapTolerance=0,this._srcPts=null,this._seg=new Ue,this._allowSnappingToSourceVertices=!1,this._isClosed=!1,arguments[0]instanceof ai&&typeof arguments[1]=="number"){var e=arguments[0],n=arguments[1];t.call(this,e.getCoordinates(),n)}else if(arguments[0]instanceof Array&&typeof arguments[1]=="number"){var r=arguments[0],i=arguments[1];this._srcPts=r,this._isClosed=t.isClosed(r),this._snapTolerance=i}};Kc.prototype.snapVertices=function(t,e){for(var n=this,r=this._isClosed?t.size()-1:t.size(),i=0;i<r;i++){var a=t.get(i),h=n.findSnapForVertex(a,e);h!==null&&(t.set(i,new Lt(h)),i===0&&n._isClosed&&t.set(t.size()-1,new Lt(h)))}};Kc.prototype.findSnapForVertex=function(t,e){for(var n=this,r=0;r<e.length;r++){if(t.equals2D(e[r]))return null;if(t.distance(e[r])<n._snapTolerance)return e[r]}return null};Kc.prototype.snapTo=function(t){var e=new A_(this._srcPts);this.snapVertices(e,t),this.snapSegments(e,t);var n=e.toCoordinateArray();return n};Kc.prototype.snapSegments=function(t,e){var n=this;if(e.length===0)return null;var r=e.length;e[0].equals2D(e[e.length-1])&&(r=e.length-1);for(var i=0;i<r;i++){var a=e[i],h=n.findSegmentIndexToSnap(a,t);h>=0&&t.add(h+1,new Lt(a),!1)}};Kc.prototype.findSegmentIndexToSnap=function(t,e){for(var n=this,r=ln.MAX_VALUE,i=-1,a=0;a<e.size()-1;a++){if(n._seg.p0=e.get(a),n._seg.p1=e.get(a+1),n._seg.p0.equals2D(t)||n._seg.p1.equals2D(t)){if(n._allowSnappingToSourceVertices)continue;return-1}var h=n._seg.distance(t);h<n._snapTolerance&&h<r&&(r=h,i=a)}return i};Kc.prototype.setAllowSnappingToSourceVertices=function(t){this._allowSnappingToSourceVertices=t};Kc.prototype.interfaces_=function(){return[]};Kc.prototype.getClass=function(){return Kc};Kc.isClosed=function(t){return t.length<=1?!1:t[0].equals2D(t[t.length-1])};var vi=function(t){this._srcGeom=t||null},_T={SNAP_PRECISION_FACTOR:{configurable:!0}};vi.prototype.snapTo=function(t,e){var n=this.extractTargetCoordinates(t),r=new vT(e,n);return r.transform(this._srcGeom)};vi.prototype.snapToSelf=function(t,e){var n=this.extractTargetCoordinates(this._srcGeom),r=new vT(t,n,!0),i=r.transform(this._srcGeom),a=i;return e&&en(a,kp)&&(a=i.buffer(0)),a};vi.prototype.computeSnapTolerance=function(t){var e=this.computeMinimumSegmentLength(t),n=e/10;return n};vi.prototype.extractTargetCoordinates=function(t){for(var e=new rc,n=t.getCoordinates(),r=0;r<n.length;r++)e.add(n[r]);return e.toArray(new Array(0).fill(null))};vi.prototype.computeMinimumSegmentLength=function(t){for(var e=ln.MAX_VALUE,n=0;n<t.length-1;n++){var r=t[n].distance(t[n+1]);r<e&&(e=r)}return e};vi.prototype.interfaces_=function(){return[]};vi.prototype.getClass=function(){return vi};vi.snap=function(t,e,n){var r=new Array(2).fill(null),i=new vi(t);r[0]=i.snapTo(e,n);var a=new vi(e);return r[1]=a.snapTo(r[0],n),r};vi.computeOverlaySnapTolerance=function(){if(arguments.length===1){var t=arguments[0],e=vi.computeSizeBasedSnapTolerance(t),n=t.getPrecisionModel();if(n.getType()===er.FIXED){var r=1/n.getScale()*2/1.415;r>e&&(e=r)}return e}else if(arguments.length===2){var i=arguments[0],a=arguments[1];return Math.min(vi.computeOverlaySnapTolerance(i),vi.computeOverlaySnapTolerance(a))}};vi.computeSizeBasedSnapTolerance=function(t){var e=t.getEnvelopeInternal(),n=Math.min(e.getHeight(),e.getWidth()),r=n*vi.SNAP_PRECISION_FACTOR;return r};vi.snapToSelf=function(t,e,n){var r=new vi(t);return r.snapToSelf(e,n)};_T.SNAP_PRECISION_FACTOR.get=function(){return 1e-9};Object.defineProperties(vi,_T);var vT=function(t){function e(n,r,i){t.call(this),this._snapTolerance=n||null,this._snapPts=r||null,this._isSelfSnap=i!==void 0?i:!1}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.snapLine=function(n,r){var i=new Kc(n,this._snapTolerance);return i.setAllowSnappingToSourceVertices(this._isSelfSnap),i.snapTo(r)},e.prototype.transformCoordinates=function(n,r){var i=n.toCoordinateArray(),a=this.snapLine(i,this._snapPts);return this._factory.getCoordinateSequenceFactory().create(a)},e.prototype.interfaces_=function(){return[]},e.prototype.getClass=function(){return e},e}(na),vs=function(){this._isFirst=!0,this._commonMantissaBitsCount=53,this._commonBits=0,this._commonSignExp=null};vs.prototype.getCommon=function(){return ln.longBitsToDouble(this._commonBits)};vs.prototype.add=function(t){var e=ln.doubleToLongBits(t);if(this._isFirst)return this._commonBits=e,this._commonSignExp=vs.signExpBits(this._commonBits),this._isFirst=!1,null;var n=vs.signExpBits(e);if(n!==this._commonSignExp)return this._commonBits=0,null;this._commonMantissaBitsCount=vs.numCommonMostSigMantissaBits(this._commonBits,e),this._commonBits=vs.zeroLowerBits(this._commonBits,64-(12+this._commonMantissaBitsCount))};vs.prototype.toString=function(){if(arguments.length===1){var t=arguments[0],e=ln.longBitsToDouble(t),n=ln.toBinaryString(t),r="0000000000000000000000000000000000000000000000000000000000000000"+n,i=r.substring(r.length-64),a=i.substring(0,1)+"  "+i.substring(1,12)+"(exp) "+i.substring(12)+" [ "+e+" ]";return a}};vs.prototype.interfaces_=function(){return[]};vs.prototype.getClass=function(){return vs};vs.getBit=function(t,e){var n=1<<e;return t&n?1:0};vs.signExpBits=function(t){return t>>52};vs.zeroLowerBits=function(t,e){var n=(1<<e)-1,r=~n,i=t&r;return i};vs.numCommonMostSigMantissaBits=function(t,e){for(var n=0,r=52;r>=0;r--){if(vs.getBit(t,r)!==vs.getBit(e,r))return n;n++}return 52};var qp=function(){this._commonCoord=null,this._ccFilter=new eg},fw={CommonCoordinateFilter:{configurable:!0},Translater:{configurable:!0}};qp.prototype.addCommonBits=function(t){var e=new jp(this._commonCoord);t.apply(e),t.geometryChanged()};qp.prototype.removeCommonBits=function(t){if(this._commonCoord.x===0&&this._commonCoord.y===0)return t;var e=new Lt(this._commonCoord);e.x=-e.x,e.y=-e.y;var n=new jp(e);return t.apply(n),t.geometryChanged(),t};qp.prototype.getCommonCoordinate=function(){return this._commonCoord};qp.prototype.add=function(t){t.apply(this._ccFilter),this._commonCoord=this._ccFilter.getCommonCoordinate()};qp.prototype.interfaces_=function(){return[]};qp.prototype.getClass=function(){return qp};fw.CommonCoordinateFilter.get=function(){return eg};fw.Translater.get=function(){return jp};Object.defineProperties(qp,fw);var eg=function(){this._commonBitsX=new vs,this._commonBitsY=new vs};eg.prototype.filter=function(t){this._commonBitsX.add(t.x),this._commonBitsY.add(t.y)};eg.prototype.getCommonCoordinate=function(){return new Lt(this._commonBitsX.getCommon(),this._commonBitsY.getCommon())};eg.prototype.interfaces_=function(){return[Xc]};eg.prototype.getClass=function(){return eg};var jp=function(){this.trans=null;var t=arguments[0];this.trans=t};jp.prototype.filter=function(t,e){var n=t.getOrdinate(e,0)+this.trans.x,r=t.getOrdinate(e,1)+this.trans.y;t.setOrdinate(e,0,n),t.setOrdinate(e,1,r)};jp.prototype.isDone=function(){return!1};jp.prototype.isGeometryChanged=function(){return!0};jp.prototype.interfaces_=function(){return[nl]};jp.prototype.getClass=function(){return jp};var So=function(t,e){this._geom=new Array(2).fill(null),this._snapTolerance=null,this._cbr=null,this._geom[0]=t,this._geom[1]=e,this.computeSnapTolerance()};So.prototype.selfSnap=function(t){var e=new vi(t),n=e.snapTo(t,this._snapTolerance);return n};So.prototype.removeCommonBits=function(t){this._cbr=new qp,this._cbr.add(t[0]),this._cbr.add(t[1]);var e=new Array(2).fill(null);return e[0]=this._cbr.removeCommonBits(t[0].copy()),e[1]=this._cbr.removeCommonBits(t[1].copy()),e};So.prototype.prepareResult=function(t){return this._cbr.addCommonBits(t),t};So.prototype.getResultGeometry=function(t){var e=this.snap(this._geom),n=pn.overlayOp(e[0],e[1],t);return this.prepareResult(n)};So.prototype.checkValid=function(t){t.isValid()||ko.out.println("Snapped geometry is invalid")};So.prototype.computeSnapTolerance=function(){this._snapTolerance=vi.computeOverlaySnapTolerance(this._geom[0],this._geom[1])};So.prototype.snap=function(t){var e=this.removeCommonBits(t),n=vi.snap(e[0],e[1],this._snapTolerance);return n};So.prototype.interfaces_=function(){return[]};So.prototype.getClass=function(){return So};So.overlayOp=function(t,e,n){var r=new So(t,e);return r.getResultGeometry(n)};So.union=function(t,e){return So.overlayOp(t,e,pn.UNION)};So.intersection=function(t,e){return So.overlayOp(t,e,pn.INTERSECTION)};So.symDifference=function(t,e){return So.overlayOp(t,e,pn.SYMDIFFERENCE)};So.difference=function(t,e){return So.overlayOp(t,e,pn.DIFFERENCE)};var Fs=function(t,e){this._geom=new Array(2).fill(null),this._geom[0]=t,this._geom[1]=e};Fs.prototype.getResultGeometry=function(t){var e=null,n=!1,r=null;try{e=pn.overlayOp(this._geom[0],this._geom[1],t);var i=!0;i&&(n=!0)}catch(a){if(a instanceof Fh)r=a;else throw a}finally{}if(!n)try{e=So.overlayOp(this._geom[0],this._geom[1],t)}catch(a){throw a instanceof Fh?r:a}finally{}return e};Fs.prototype.interfaces_=function(){return[]};Fs.prototype.getClass=function(){return Fs};Fs.overlayOp=function(t,e,n){var r=new Fs(t,e);return r.getResultGeometry(n)};Fs.union=function(t,e){return Fs.overlayOp(t,e,pn.UNION)};Fs.intersection=function(t,e){return Fs.overlayOp(t,e,pn.INTERSECTION)};Fs.symDifference=function(t,e){return Fs.overlayOp(t,e,pn.SYMDIFFERENCE)};Fs.difference=function(t,e){return Fs.overlayOp(t,e,pn.DIFFERENCE)};var m_=function(){this.mce=null,this.chainIndex=null;var t=arguments[0],e=arguments[1];this.mce=t,this.chainIndex=e};m_.prototype.computeIntersections=function(t,e){this.mce.computeIntersectsForChain(this.chainIndex,t.mce,t.chainIndex,e)};m_.prototype.interfaces_=function(){return[]};m_.prototype.getClass=function(){return m_};var Sa=function t(){if(this._label=null,this._xValue=null,this._eventType=null,this._insertEvent=null,this._deleteEventIndex=null,this._obj=null,arguments.length===2){var e=arguments[0],n=arguments[1];this._eventType=t.DELETE,this._xValue=e,this._insertEvent=n}else if(arguments.length===3){var r=arguments[0],i=arguments[1],a=arguments[2];this._eventType=t.INSERT,this._label=r,this._xValue=i,this._obj=a}},dw={INSERT:{configurable:!0},DELETE:{configurable:!0}};Sa.prototype.isDelete=function(){return this._eventType===Sa.DELETE};Sa.prototype.setDeleteEventIndex=function(t){this._deleteEventIndex=t};Sa.prototype.getObject=function(){return this._obj};Sa.prototype.compareTo=function(t){var e=t;return this._xValue<e._xValue?-1:this._xValue>e._xValue?1:this._eventType<e._eventType?-1:this._eventType>e._eventType?1:0};Sa.prototype.getInsertEvent=function(){return this._insertEvent};Sa.prototype.isInsert=function(){return this._eventType===Sa.INSERT};Sa.prototype.isSameLabel=function(t){return this._label===null?!1:this._label===t._label};Sa.prototype.getDeleteEventIndex=function(){return this._deleteEventIndex};Sa.prototype.interfaces_=function(){return[Pu]};Sa.prototype.getClass=function(){return Sa};dw.INSERT.get=function(){return 1};dw.DELETE.get=function(){return 2};Object.defineProperties(Sa,dw);var Kv=function(){};Kv.prototype.interfaces_=function(){return[]};Kv.prototype.getClass=function(){return Kv};var Go=function(){this._hasIntersection=!1,this._hasProper=!1,this._hasProperInterior=!1,this._properIntersectionPoint=null,this._li=null,this._includeProper=null,this._recordIsolated=null,this._isSelfIntersection=null,this._numIntersections=0,this.numTests=0,this._bdyNodes=null,this._isDone=!1,this._isDoneWhenProperInt=!1;var t=arguments[0],e=arguments[1],n=arguments[2];this._li=t,this._includeProper=e,this._recordIsolated=n};Go.prototype.isTrivialIntersection=function(t,e,n,r){if(t===n&&this._li.getIntersectionNum()===1){if(Go.isAdjacentSegments(e,r))return!0;if(t.isClosed()){var i=t.getNumPoints()-1;if(e===0&&r===i||r===0&&e===i)return!0}}return!1};Go.prototype.getProperIntersectionPoint=function(){return this._properIntersectionPoint};Go.prototype.setIsDoneIfProperInt=function(t){this._isDoneWhenProperInt=t};Go.prototype.hasProperInteriorIntersection=function(){return this._hasProperInterior};Go.prototype.isBoundaryPointInternal=function(t,e){for(var n=e.iterator();n.hasNext();){var r=n.next(),i=r.getCoordinate();if(t.isIntersection(i))return!0}return!1};Go.prototype.hasProperIntersection=function(){return this._hasProper};Go.prototype.hasIntersection=function(){return this._hasIntersection};Go.prototype.isDone=function(){return this._isDone};Go.prototype.isBoundaryPoint=function(t,e){return e===null?!1:!!(this.isBoundaryPointInternal(t,e[0])||this.isBoundaryPointInternal(t,e[1]))};Go.prototype.setBoundaryNodes=function(t,e){this._bdyNodes=new Array(2).fill(null),this._bdyNodes[0]=t,this._bdyNodes[1]=e};Go.prototype.addIntersections=function(t,e,n,r){if(t===n&&e===r)return null;this.numTests++;var i=t.getCoordinates()[e],a=t.getCoordinates()[e+1],h=n.getCoordinates()[r],u=n.getCoordinates()[r+1];this._li.computeIntersection(i,a,h,u),this._li.hasIntersection()&&(this._recordIsolated&&(t.setIsolated(!1),n.setIsolated(!1)),this._numIntersections++,this.isTrivialIntersection(t,e,n,r)||(this._hasIntersection=!0,(this._includeProper||!this._li.isProper())&&(t.addIntersections(this._li,e,0),n.addIntersections(this._li,r,1)),this._li.isProper()&&(this._properIntersectionPoint=this._li.getIntersection(0).copy(),this._hasProper=!0,this._isDoneWhenProperInt&&(this._isDone=!0),this.isBoundaryPoint(this._li,this._bdyNodes)||(this._hasProperInterior=!0))))};Go.prototype.interfaces_=function(){return[]};Go.prototype.getClass=function(){return Go};Go.isAdjacentSegments=function(t,e){return Math.abs(t-e)===1};var qO=function(t){function e(){t.call(this),this.events=new de,this.nOverlaps=null}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.prepareEvents=function(){var n=this;il.sort(this.events);for(var r=0;r<this.events.size();r++){var i=n.events.get(r);i.isDelete()&&i.getInsertEvent().setDeleteEventIndex(r)}},e.prototype.computeIntersections=function(){var n=this;if(arguments.length===1){var r=arguments[0];this.nOverlaps=0,this.prepareEvents();for(var i=0;i<this.events.size();i++){var a=n.events.get(i);if(a.isInsert()&&n.processOverlaps(i,a.getDeleteEventIndex(),a,r),r.isDone())break}}else if(arguments.length===3){if(arguments[2]instanceof Go&&en(arguments[0],Yu)&&en(arguments[1],Yu)){var h=arguments[0],u=arguments[1],_=arguments[2];this.addEdges(h,h),this.addEdges(u,u),this.computeIntersections(_)}else if(typeof arguments[2]=="boolean"&&en(arguments[0],Yu)&&arguments[1]instanceof Go){var w=arguments[0],C=arguments[1],P=arguments[2];P?this.addEdges(w,null):this.addEdges(w),this.computeIntersections(C)}}},e.prototype.addEdge=function(n,r){for(var i=this,a=n.getMonotoneChainEdge(),h=a.getStartIndexes(),u=0;u<h.length-1;u++){var _=new m_(a,u),w=new Sa(r,a.getMinX(u),_);i.events.add(w),i.events.add(new Sa(a.getMaxX(u),w))}},e.prototype.processOverlaps=function(n,r,i,a){for(var h=this,u=i.getObject(),_=n;_<r;_++){var w=h.events.get(_);if(w.isInsert()){var C=w.getObject();i.isSameLabel(w)||(u.computeIntersections(C,a),h.nOverlaps++)}}},e.prototype.addEdges=function(){var n=this;if(arguments.length===1)for(var r=arguments[0],i=r.iterator();i.hasNext();){var a=i.next();n.addEdge(a,a)}else if(arguments.length===2)for(var h=arguments[0],u=arguments[1],_=h.iterator();_.hasNext();){var w=_.next();n.addEdge(w,u)}},e.prototype.interfaces_=function(){return[]},e.prototype.getClass=function(){return e},e}(Kv),Qc=function(){this._min=ln.POSITIVE_INFINITY,this._max=ln.NEGATIVE_INFINITY},xT={NodeComparator:{configurable:!0}};Qc.prototype.getMin=function(){return this._min};Qc.prototype.intersects=function(t,e){return!(this._min>e||this._max<t)};Qc.prototype.getMax=function(){return this._max};Qc.prototype.toString=function(){return el.toLineString(new Lt(this._min,0),new Lt(this._max,0))};Qc.prototype.interfaces_=function(){return[]};Qc.prototype.getClass=function(){return Qc};xT.NodeComparator.get=function(){return y_};Object.defineProperties(Qc,xT);var y_=function(){};y_.prototype.compare=function(t,e){var n=t,r=e,i=(n._min+n._max)/2,a=(r._min+r._max)/2;return i<a?-1:i>a?1:0};y_.prototype.interfaces_=function(){return[pm]};y_.prototype.getClass=function(){return y_};var jO=function(t){function e(){t.call(this),this._item=null;var n=arguments[0],r=arguments[1],i=arguments[2];this._min=n,this._max=r,this._item=i}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.query=function(n,r,i){if(!this.intersects(n,r))return null;i.visitItem(this._item)},e.prototype.interfaces_=function(){return[]},e.prototype.getClass=function(){return e},e}(Qc),XO=function(t){function e(){t.call(this),this._node1=null,this._node2=null;var n=arguments[0],r=arguments[1];this._node1=n,this._node2=r,this.buildExtent(this._node1,this._node2)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.buildExtent=function(n,r){this._min=Math.min(n._min,r._min),this._max=Math.max(n._max,r._max)},e.prototype.query=function(n,r,i){if(!this.intersects(n,r))return null;this._node1!==null&&this._node1.query(n,r,i),this._node2!==null&&this._node2.query(n,r,i)},e.prototype.interfaces_=function(){return[]},e.prototype.getClass=function(){return e},e}(Qc),th=function(){this._leaves=new de,this._root=null,this._level=0};th.prototype.buildTree=function(){var t=this;il.sort(this._leaves,new Qc.NodeComparator);for(var e=this._leaves,n=null,r=new de;;){if(t.buildLevel(e,r),r.size()===1)return r.get(0);n=e,e=r,r=n}};th.prototype.insert=function(t,e,n){if(this._root!==null)throw new Error("Index cannot be added to once it has been queried");this._leaves.add(new jO(t,e,n))};th.prototype.query=function(t,e,n){this.init(),this._root.query(t,e,n)};th.prototype.buildRoot=function(){if(this._root!==null)return null;this._root=this.buildTree()};th.prototype.printNode=function(t){ko.out.println(el.toLineString(new Lt(t._min,this._level),new Lt(t._max,this._level)))};th.prototype.init=function(){if(this._root!==null)return null;this.buildRoot()};th.prototype.buildLevel=function(t,e){this._level++,e.clear();for(var n=0;n<t.size();n+=2){var r=t.get(n),i=n+1<t.size()?t.get(n):null;if(i===null)e.add(r);else{var a=new XO(t.get(n),t.get(n+1));e.add(a)}}};th.prototype.interfaces_=function(){return[]};th.prototype.getClass=function(){return th};var Sm=function(){this._items=new de};Sm.prototype.visitItem=function(t){this._items.add(t)};Sm.prototype.getItems=function(){return this._items};Sm.prototype.interfaces_=function(){return[zp]};Sm.prototype.getClass=function(){return Sm};var Cm=function(){this._index=null;var t=arguments[0];if(!en(t,kp))throw new Yr("Argument must be Polygonal");this._index=new nd(t)},gw={SegmentVisitor:{configurable:!0},IntervalIndexedGeometry:{configurable:!0}};Cm.prototype.locate=function(t){var e=new ql(t),n=new Tm(e);return this._index.query(t.y,t.y,n),e.getLocation()};Cm.prototype.interfaces_=function(){return[Em]};Cm.prototype.getClass=function(){return Cm};gw.SegmentVisitor.get=function(){return Tm};gw.IntervalIndexedGeometry.get=function(){return nd};Object.defineProperties(Cm,gw);var Tm=function(){this._counter=null;var t=arguments[0];this._counter=t};Tm.prototype.visitItem=function(t){var e=t;this._counter.countSegment(e.getCoordinate(0),e.getCoordinate(1))};Tm.prototype.interfaces_=function(){return[zp]};Tm.prototype.getClass=function(){return Tm};var nd=function(){this._index=new th;var t=arguments[0];this.init(t)};nd.prototype.init=function(t){for(var e=this,n=Mo.getLines(t),r=n.iterator();r.hasNext();){var i=r.next(),a=i.getCoordinates();e.addLine(a)}};nd.prototype.addLine=function(t){for(var e=this,n=1;n<t.length;n++){var r=new Ue(t[n-1],t[n]),i=Math.min(r.p0.y,r.p1.y),a=Math.max(r.p0.y,r.p1.y);e._index.insert(i,a,r)}};nd.prototype.query=function(){if(arguments.length===2){var t=arguments[0],e=arguments[1],n=new Sm;return this._index.query(t,e,n),n.getItems()}else if(arguments.length===3){var r=arguments[0],i=arguments[1],a=arguments[2];this._index.query(r,i,a)}};nd.prototype.interfaces_=function(){return[]};nd.prototype.getClass=function(){return nd};var Py=function(t){function e(){if(t.call(this),this._parentGeom=null,this._lineEdgeMap=new rT,this._boundaryNodeRule=null,this._useBoundaryDeterminationRule=!0,this._argIndex=null,this._boundaryNodes=null,this._hasTooFewPoints=!1,this._invalidPoint=null,this._areaPtLocator=null,this._ptLocator=new sl,arguments.length===2){var n=arguments[0],r=arguments[1],i=Iu.OGC_SFS_BOUNDARY_RULE;this._argIndex=n,this._parentGeom=r,this._boundaryNodeRule=i,r!==null&&this.add(r)}else if(arguments.length===3){var a=arguments[0],h=arguments[1],u=arguments[2];this._argIndex=a,this._parentGeom=h,this._boundaryNodeRule=u,h!==null&&this.add(h)}}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.insertBoundaryPoint=function(n,r){var i=this._nodes.addNode(r),a=i.getLabel(),h=1,u=Mt.NONE;u=a.getLocation(n,oe.ON),u===Mt.BOUNDARY&&h++;var _=e.determineBoundary(this._boundaryNodeRule,h);a.setLocation(n,_)},e.prototype.computeSelfNodes=function(){if(arguments.length===2){var n=arguments[0],r=arguments[1];return this.computeSelfNodes(n,r,!1)}else if(arguments.length===3){var i=arguments[0],a=arguments[1],h=arguments[2],u=new Go(i,!0,!1);u.setIsDoneIfProperInt(h);var _=this.createEdgeSetIntersector(),w=this._parentGeom instanceof Yc||this._parentGeom instanceof eo||this._parentGeom instanceof Rc,C=a||!w;return _.computeIntersections(this._edges,u,C),this.addSelfIntersectionNodes(this._argIndex),u}},e.prototype.computeSplitEdges=function(n){for(var r=this._edges.iterator();r.hasNext();){var i=r.next();i.eiList.addSplitEdges(n)}},e.prototype.computeEdgeIntersections=function(n,r,i){var a=new Go(r,i,!0);a.setBoundaryNodes(this.getBoundaryNodes(),n.getBoundaryNodes());var h=this.createEdgeSetIntersector();return h.computeIntersections(this._edges,n._edges,a),a},e.prototype.getGeometry=function(){return this._parentGeom},e.prototype.getBoundaryNodeRule=function(){return this._boundaryNodeRule},e.prototype.hasTooFewPoints=function(){return this._hasTooFewPoints},e.prototype.addPoint=function(){if(arguments[0]instanceof wa){var n=arguments[0],r=n.getCoordinate();this.insertPoint(this._argIndex,r,Mt.INTERIOR)}else if(arguments[0]instanceof Lt){var i=arguments[0];this.insertPoint(this._argIndex,i,Mt.INTERIOR)}},e.prototype.addPolygon=function(n){var r=this;this.addPolygonRing(n.getExteriorRing(),Mt.EXTERIOR,Mt.INTERIOR);for(var i=0;i<n.getNumInteriorRing();i++){var a=n.getInteriorRingN(i);r.addPolygonRing(a,Mt.INTERIOR,Mt.EXTERIOR)}},e.prototype.addEdge=function(n){this.insertEdge(n);var r=n.getCoordinates();this.insertPoint(this._argIndex,r[0],Mt.BOUNDARY),this.insertPoint(this._argIndex,r[r.length-1],Mt.BOUNDARY)},e.prototype.addLineString=function(n){var r=Sn.removeRepeatedPoints(n.getCoordinates());if(r.length<2)return this._hasTooFewPoints=!0,this._invalidPoint=r[0],null;var i=new Jv(r,new fr(this._argIndex,Mt.INTERIOR));this._lineEdgeMap.put(n,i),this.insertEdge(i),dn.isTrue(r.length>=2,"found LineString with single point"),this.insertBoundaryPoint(this._argIndex,r[0]),this.insertBoundaryPoint(this._argIndex,r[r.length-1])},e.prototype.getInvalidPoint=function(){return this._invalidPoint},e.prototype.getBoundaryPoints=function(){for(var n=this.getBoundaryNodes(),r=new Array(n.size()).fill(null),i=0,a=n.iterator();a.hasNext();){var h=a.next();r[i++]=h.getCoordinate().copy()}return r},e.prototype.getBoundaryNodes=function(){return this._boundaryNodes===null&&(this._boundaryNodes=this._nodes.getBoundaryNodes(this._argIndex)),this._boundaryNodes},e.prototype.addSelfIntersectionNode=function(n,r,i){if(this.isBoundaryNode(n,r))return null;i===Mt.BOUNDARY&&this._useBoundaryDeterminationRule?this.insertBoundaryPoint(n,r):this.insertPoint(n,r,i)},e.prototype.addPolygonRing=function(n,r,i){if(n.isEmpty())return null;var a=Sn.removeRepeatedPoints(n.getCoordinates());if(a.length<4)return this._hasTooFewPoints=!0,this._invalidPoint=a[0],null;var h=r,u=i;Ce.isCCW(a)&&(h=i,u=r);var _=new Jv(a,new fr(this._argIndex,Mt.BOUNDARY,h,u));this._lineEdgeMap.put(n,_),this.insertEdge(_),this.insertPoint(this._argIndex,a[0],Mt.BOUNDARY)},e.prototype.insertPoint=function(n,r,i){var a=this._nodes.addNode(r),h=a.getLabel();h===null?a._label=new fr(n,i):h.setLocation(n,i)},e.prototype.createEdgeSetIntersector=function(){return new qO},e.prototype.addSelfIntersectionNodes=function(n){for(var r=this,i=this._edges.iterator();i.hasNext();)for(var a=i.next(),h=a.getLabel().getLocation(n),u=a.eiList.iterator();u.hasNext();){var _=u.next();r.addSelfIntersectionNode(n,_.coord,h)}},e.prototype.add=function(){if(arguments.length===1){var n=arguments[0];if(n.isEmpty())return null;if(n instanceof Rc&&(this._useBoundaryDeterminationRule=!1),n instanceof eo)this.addPolygon(n);else if(n instanceof ai)this.addLineString(n);else if(n instanceof wa)this.addPoint(n);else if(n instanceof vm)this.addCollection(n);else if(n instanceof Hf)this.addCollection(n);else if(n instanceof Rc)this.addCollection(n);else if(n instanceof Ds)this.addCollection(n);else throw new Error(n.getClass().getName())}else return t.prototype.add.apply(this,arguments)},e.prototype.addCollection=function(n){for(var r=this,i=0;i<n.getNumGeometries();i++){var a=n.getGeometryN(i);r.add(a)}},e.prototype.locate=function(n){return en(this._parentGeom,kp)&&this._parentGeom.getNumGeometries()>50?(this._areaPtLocator===null&&(this._areaPtLocator=new Cm(this._parentGeom)),this._areaPtLocator.locate(n)):this._ptLocator.locate(n,this._parentGeom)},e.prototype.findEdge=function(){if(arguments.length===1){var n=arguments[0];return this._lineEdgeMap.get(n)}else return t.prototype.findEdge.apply(this,arguments)},e.prototype.interfaces_=function(){return[]},e.prototype.getClass=function(){return e},e.determineBoundary=function(n,r){return n.isInBoundary(r)?Mt.BOUNDARY:Mt.INTERIOR},e}(ti),Lm=function(){if(this._li=new cd,this._resultPrecisionModel=null,this._arg=null,arguments.length===1){var t=arguments[0];this.setComputationPrecision(t.getPrecisionModel()),this._arg=new Array(1).fill(null),this._arg[0]=new Py(0,t)}else if(arguments.length===2){var e=arguments[0],n=arguments[1],r=Iu.OGC_SFS_BOUNDARY_RULE;e.getPrecisionModel().compareTo(n.getPrecisionModel())>=0?this.setComputationPrecision(e.getPrecisionModel()):this.setComputationPrecision(n.getPrecisionModel()),this._arg=new Array(2).fill(null),this._arg[0]=new Py(0,e,r),this._arg[1]=new Py(1,n,r)}else if(arguments.length===3){var i=arguments[0],a=arguments[1],h=arguments[2];i.getPrecisionModel().compareTo(a.getPrecisionModel())>=0?this.setComputationPrecision(i.getPrecisionModel()):this.setComputationPrecision(a.getPrecisionModel()),this._arg=new Array(2).fill(null),this._arg[0]=new Py(0,i,h),this._arg[1]=new Py(1,a,h)}};Lm.prototype.getArgGeometry=function(t){return this._arg[t].getGeometry()};Lm.prototype.setComputationPrecision=function(t){this._resultPrecisionModel=t,this._li.setPrecisionModel(this._resultPrecisionModel)};Lm.prototype.interfaces_=function(){return[]};Lm.prototype.getClass=function(){return Lm};var Ff=function(){};Ff.prototype.interfaces_=function(){return[]};Ff.prototype.getClass=function(){return Ff};Ff.map=function(){if(arguments[0]instanceof Je&&en(arguments[1],Ff.MapOp)){for(var t=arguments[0],e=arguments[1],n=new de,r=0;r<t.getNumGeometries();r++){var i=e.map(t.getGeometryN(r));i!==null&&n.add(i)}return t.getFactory().buildGeometry(n)}else if(en(arguments[0],Hi)&&en(arguments[1],Ff.MapOp)){for(var a=arguments[0],h=arguments[1],u=new de,_=a.iterator();_.hasNext();){var w=_.next(),C=h.map(w);C!==null&&u.add(C)}return u}};Ff.MapOp=function(){};var pn=function(t){function e(){var n=arguments[0],r=arguments[1];t.call(this,n,r),this._ptLocator=new sl,this._geomFact=null,this._resultGeom=null,this._graph=null,this._edgeList=new ol,this._resultPolyList=new de,this._resultLineList=new de,this._resultPointList=new de,this._graph=new ti(new hT),this._geomFact=n.getFactory()}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.insertUniqueEdge=function(n){var r=this._edgeList.findEqualEdge(n);if(r!==null){var i=r.getLabel(),a=n.getLabel();r.isPointwiseEqual(n)||(a=new fr(n.getLabel()),a.flip());var h=r.getDepth();h.isNull()&&h.add(i),h.add(a),i.merge(a)}else this._edgeList.add(n)},e.prototype.getGraph=function(){return this._graph},e.prototype.cancelDuplicateResultEdges=function(){for(var n=this._graph.getEdgeEnds().iterator();n.hasNext();){var r=n.next(),i=r.getSym();r.isInResult()&&i.isInResult()&&(r.setInResult(!1),i.setInResult(!1))}},e.prototype.isCoveredByLA=function(n){return!!(this.isCovered(n,this._resultLineList)||this.isCovered(n,this._resultPolyList))},e.prototype.computeGeometry=function(n,r,i,a){var h=new de;return h.addAll(n),h.addAll(r),h.addAll(i),h.isEmpty()?e.createEmptyResult(a,this._arg[0].getGeometry(),this._arg[1].getGeometry(),this._geomFact):this._geomFact.buildGeometry(h)},e.prototype.mergeSymLabels=function(){for(var n=this._graph.getNodes().iterator();n.hasNext();){var r=n.next();r.getEdges().mergeSymLabels()}},e.prototype.isCovered=function(n,r){for(var i=this,a=r.iterator();a.hasNext();){var h=a.next(),u=i._ptLocator.locate(n,h);if(u!==Mt.EXTERIOR)return!0}return!1},e.prototype.replaceCollapsedEdges=function(){for(var n=new de,r=this._edgeList.iterator();r.hasNext();){var i=r.next();i.isCollapsed()&&(r.remove(),n.add(i.getCollapsedEdge()))}this._edgeList.addAll(n)},e.prototype.updateNodeLabelling=function(){for(var n=this._graph.getNodes().iterator();n.hasNext();){var r=n.next(),i=r.getEdges().getLabel();r.getLabel().merge(i)}},e.prototype.getResultGeometry=function(n){return this.computeOverlay(n),this._resultGeom},e.prototype.insertUniqueEdges=function(n){for(var r=this,i=n.iterator();i.hasNext();){var a=i.next();r.insertUniqueEdge(a)}},e.prototype.computeOverlay=function(n){this.copyPoints(0),this.copyPoints(1),this._arg[0].computeSelfNodes(this._li,!1),this._arg[1].computeSelfNodes(this._li,!1),this._arg[0].computeEdgeIntersections(this._arg[1],this._li,!0);var r=new de;this._arg[0].computeSplitEdges(r),this._arg[1].computeSplitEdges(r),this.insertUniqueEdges(r),this.computeLabelsFromDepths(),this.replaceCollapsedEdges(),ed.checkValid(this._edgeList.getEdges()),this._graph.addEdges(this._edgeList.getEdges()),this.computeLabelling(),this.labelIncompleteNodes(),this.findResultAreaEdges(n),this.cancelDuplicateResultEdges();var i=new Ea(this._geomFact);i.add(this._graph),this._resultPolyList=i.getPolygons();var a=new hc(this,this._geomFact,this._ptLocator);this._resultLineList=a.build(n);var h=new tg(this,this._geomFact,this._ptLocator);this._resultPointList=h.build(n),this._resultGeom=this.computeGeometry(this._resultPointList,this._resultLineList,this._resultPolyList,n)},e.prototype.labelIncompleteNode=function(n,r){var i=this._ptLocator.locate(n.getCoordinate(),this._arg[r].getGeometry());n.getLabel().setLocation(r,i)},e.prototype.copyPoints=function(n){for(var r=this,i=this._arg[n].getNodeIterator();i.hasNext();){var a=i.next(),h=r._graph.addNode(a.getCoordinate());h.setLabel(n,a.getLabel().getLocation(n))}},e.prototype.findResultAreaEdges=function(n){for(var r=this._graph.getEdgeEnds().iterator();r.hasNext();){var i=r.next(),a=i.getLabel();a.isArea()&&!i.isInteriorAreaEdge()&&e.isResultOfOp(a.getLocation(0,oe.RIGHT),a.getLocation(1,oe.RIGHT),n)&&i.setInResult(!0)}},e.prototype.computeLabelsFromDepths=function(){for(var n=this._edgeList.iterator();n.hasNext();){var r=n.next(),i=r.getLabel(),a=r.getDepth();if(!a.isNull()){a.normalize();for(var h=0;h<2;h++)!i.isNull(h)&&i.isArea()&&!a.isNull(h)&&(a.getDelta(h)===0?i.toLine(h):(dn.isTrue(!a.isNull(h,oe.LEFT),"depth of LEFT side has not been initialized"),i.setLocation(h,oe.LEFT,a.getLocation(h,oe.LEFT)),dn.isTrue(!a.isNull(h,oe.RIGHT),"depth of RIGHT side has not been initialized"),i.setLocation(h,oe.RIGHT,a.getLocation(h,oe.RIGHT))))}}},e.prototype.computeLabelling=function(){for(var n=this,r=this._graph.getNodes().iterator();r.hasNext();){var i=r.next();i.getEdges().computeLabelling(n._arg)}this.mergeSymLabels(),this.updateNodeLabelling()},e.prototype.labelIncompleteNodes=function(){for(var n=this,r=this._graph.getNodes().iterator();r.hasNext();){var i=r.next(),a=i.getLabel();i.isIsolated()&&(a.isNull(0)?n.labelIncompleteNode(i,0):n.labelIncompleteNode(i,1)),i.getEdges().updateLabelling(a)}},e.prototype.isCoveredByA=function(n){return!!this.isCovered(n,this._resultPolyList)},e.prototype.interfaces_=function(){return[]},e.prototype.getClass=function(){return e},e}(Lm);pn.overlayOp=function(t,e,n){var r=new pn(t,e),i=r.getResultGeometry(n);return i};pn.intersection=function(t,e){if(t.isEmpty()||e.isEmpty())return pn.createEmptyResult(pn.INTERSECTION,t,e,t.getFactory());if(t.isGeometryCollection()){var n=e;return Qd.map(t,{interfaces_:function(){return[Ff.MapOp]},map:function(r){return r.intersection(n)}})}return t.checkNotGeometryCollection(t),t.checkNotGeometryCollection(e),Fs.overlayOp(t,e,pn.INTERSECTION)};pn.symDifference=function(t,e){if(t.isEmpty()||e.isEmpty()){if(t.isEmpty()&&e.isEmpty())return pn.createEmptyResult(pn.SYMDIFFERENCE,t,e,t.getFactory());if(t.isEmpty())return e.copy();if(e.isEmpty())return t.copy()}return t.checkNotGeometryCollection(t),t.checkNotGeometryCollection(e),Fs.overlayOp(t,e,pn.SYMDIFFERENCE)};pn.resultDimension=function(t,e,n){var r=e.getDimension(),i=n.getDimension(),a=-1;switch(t){case pn.INTERSECTION:a=Math.min(r,i);break;case pn.UNION:a=Math.max(r,i);break;case pn.DIFFERENCE:a=r;break;case pn.SYMDIFFERENCE:a=Math.max(r,i);break}return a};pn.createEmptyResult=function(t,e,n,r){var i=null;switch(pn.resultDimension(t,e,n)){case-1:i=r.createGeometryCollection(new Array(0).fill(null));break;case 0:i=r.createPoint();break;case 1:i=r.createLineString();break;case 2:i=r.createPolygon();break}return i};pn.difference=function(t,e){return t.isEmpty()?pn.createEmptyResult(pn.DIFFERENCE,t,e,t.getFactory()):e.isEmpty()?t.copy():(t.checkNotGeometryCollection(t),t.checkNotGeometryCollection(e),Fs.overlayOp(t,e,pn.DIFFERENCE))};pn.isResultOfOp=function(){if(arguments.length===2){var t=arguments[0],e=arguments[1],n=t.getLocation(0),r=t.getLocation(1);return pn.isResultOfOp(n,r,e)}else if(arguments.length===3){var i=arguments[0],a=arguments[1],h=arguments[2];switch(i===Mt.BOUNDARY&&(i=Mt.INTERIOR),a===Mt.BOUNDARY&&(a=Mt.INTERIOR),h){case pn.INTERSECTION:return i===Mt.INTERIOR&&a===Mt.INTERIOR;case pn.UNION:return i===Mt.INTERIOR||a===Mt.INTERIOR;case pn.DIFFERENCE:return i===Mt.INTERIOR&&a!==Mt.INTERIOR;case pn.SYMDIFFERENCE:return i===Mt.INTERIOR&&a!==Mt.INTERIOR||i!==Mt.INTERIOR&&a===Mt.INTERIOR}return!1}};pn.INTERSECTION=1;pn.UNION=2;pn.DIFFERENCE=3;pn.SYMDIFFERENCE=4;var Ip=function(){this._g=null,this._boundaryDistanceTolerance=null,this._linework=null,this._ptLocator=new sl,this._seg=new Ue;var t=arguments[0],e=arguments[1];this._g=t,this._boundaryDistanceTolerance=e,this._linework=this.extractLinework(t)};Ip.prototype.isWithinToleranceOfBoundary=function(t){for(var e=this,n=0;n<this._linework.getNumGeometries();n++)for(var r=e._linework.getGeometryN(n),i=r.getCoordinateSequence(),a=0;a<i.size()-1;a++){i.getCoordinate(a,e._seg.p0),i.getCoordinate(a+1,e._seg.p1);var h=e._seg.distance(t);if(h<=e._boundaryDistanceTolerance)return!0}return!1};Ip.prototype.getLocation=function(t){return this.isWithinToleranceOfBoundary(t)?Mt.BOUNDARY:this._ptLocator.locate(t,this._g)};Ip.prototype.extractLinework=function(t){var e=new Nm;t.apply(e);var n=e.getLinework(),r=En.toLineStringArray(n);return t.getFactory().createMultiLineString(r)};Ip.prototype.interfaces_=function(){return[]};Ip.prototype.getClass=function(){return Ip};var Nm=function(){this._linework=null,this._linework=new de};Nm.prototype.getLinework=function(){return this._linework};Nm.prototype.filter=function(t){var e=this;if(t instanceof eo){var n=t;this._linework.add(n.getExteriorRing());for(var r=0;r<n.getNumInteriorRing();r++)e._linework.add(n.getInteriorRingN(r))}};Nm.prototype.interfaces_=function(){return[ic]};Nm.prototype.getClass=function(){return Nm};var rd=function(){this._g=null,this._doLeft=!0,this._doRight=!0;var t=arguments[0];this._g=t};rd.prototype.extractPoints=function(t,e,n){for(var r=this,i=t.getCoordinates(),a=0;a<i.length-1;a++)r.computeOffsetPoints(i[a],i[a+1],e,n)};rd.prototype.setSidesToGenerate=function(t,e){this._doLeft=t,this._doRight=e};rd.prototype.getPoints=function(t){for(var e=this,n=new de,r=Mo.getLines(this._g),i=r.iterator();i.hasNext();){var a=i.next();e.extractPoints(a,t,n)}return n};rd.prototype.computeOffsetPoints=function(t,e,n,r){var i=e.x-t.x,a=e.y-t.y,h=Math.sqrt(i*i+a*a),u=n*i/h,_=n*a/h,w=(e.x+t.x)/2,C=(e.y+t.y)/2;if(this._doLeft){var P=new Lt(w-_,C+u);r.add(P)}if(this._doRight){var D=new Lt(w+_,C-u);r.add(D)}};rd.prototype.interfaces_=function(){return[]};rd.prototype.getClass=function(){return rd};var ru=function t(){this._geom=null,this._locFinder=null,this._location=new Array(3).fill(null),this._invalidLocation=null,this._boundaryDistanceTolerance=t.TOLERANCE,this._testCoords=new de;var e=arguments[0],n=arguments[1],r=arguments[2];this._boundaryDistanceTolerance=t.computeBoundaryDistanceTolerance(e,n),this._geom=[e,n,r],this._locFinder=[new Ip(this._geom[0],this._boundaryDistanceTolerance),new Ip(this._geom[1],this._boundaryDistanceTolerance),new Ip(this._geom[2],this._boundaryDistanceTolerance)]},bT={TOLERANCE:{configurable:!0}};ru.prototype.reportResult=function(t,e,n){ko.out.println("Overlay result invalid - A:"+Mt.toLocationSymbol(e[0])+" B:"+Mt.toLocationSymbol(e[1])+" expected:"+(n?"i":"e")+" actual:"+Mt.toLocationSymbol(e[2]))};ru.prototype.isValid=function(t){this.addTestPts(this._geom[0]),this.addTestPts(this._geom[1]);var e=this.checkValid(t);return e};ru.prototype.checkValid=function(){var t=this;if(arguments.length===1){for(var e=arguments[0],n=0;n<this._testCoords.size();n++){var r=t._testCoords.get(n);if(!t.checkValid(e,r))return t._invalidLocation=r,!1}return!0}else if(arguments.length===2){var i=arguments[0],a=arguments[1];return this._location[0]=this._locFinder[0].getLocation(a),this._location[1]=this._locFinder[1].getLocation(a),this._location[2]=this._locFinder[2].getLocation(a),ru.hasLocation(this._location,Mt.BOUNDARY)?!0:this.isValidResult(i,this._location)}};ru.prototype.addTestPts=function(t){var e=new rd(t);this._testCoords.addAll(e.getPoints(5*this._boundaryDistanceTolerance))};ru.prototype.isValidResult=function(t,e){var n=pn.isResultOfOp(e[0],e[1],t),r=e[2]===Mt.INTERIOR,i=!(n^r);return i||this.reportResult(t,e,n),i};ru.prototype.getInvalidLocation=function(){return this._invalidLocation};ru.prototype.interfaces_=function(){return[]};ru.prototype.getClass=function(){return ru};ru.hasLocation=function(t,e){for(var n=0;n<3;n++)if(t[n]===e)return!0;return!1};ru.computeBoundaryDistanceTolerance=function(t,e){return Math.min(vi.computeSizeBasedSnapTolerance(t),vi.computeSizeBasedSnapTolerance(e))};ru.isValid=function(t,e,n,r){var i=new ru(t,e,r);return i.isValid(n)};bT.TOLERANCE.get=function(){return 1e-6};Object.defineProperties(ru,bT);var Ga=function t(e){this._geomFactory=null,this._skipEmpty=!1,this._inputGeoms=null,this._geomFactory=t.extractFactory(e),this._inputGeoms=e};Ga.prototype.extractElements=function(t,e){var n=this;if(t===null)return null;for(var r=0;r<t.getNumGeometries();r++){var i=t.getGeometryN(r);n._skipEmpty&&i.isEmpty()||e.add(i)}};Ga.prototype.combine=function(){for(var t=this,e=new de,n=this._inputGeoms.iterator();n.hasNext();){var r=n.next();t.extractElements(r,e)}return e.size()===0?this._geomFactory!==null?this._geomFactory.createGeometryCollection(null):null:this._geomFactory.buildGeometry(e)};Ga.prototype.interfaces_=function(){return[]};Ga.prototype.getClass=function(){return Ga};Ga.combine=function(){if(arguments.length===1){var t=arguments[0],e=new Ga(t);return e.combine()}else if(arguments.length===2){var n=arguments[0],r=arguments[1],i=new Ga(Ga.createList(n,r));return i.combine()}else if(arguments.length===3){var a=arguments[0],h=arguments[1],u=arguments[2],_=new Ga(Ga.createList(a,h,u));return _.combine()}};Ga.extractFactory=function(t){return t.isEmpty()?null:t.iterator().next().getFactory()};Ga.createList=function(){if(arguments.length===2){var t=arguments[0],e=arguments[1],n=new de;return n.add(t),n.add(e),n}else if(arguments.length===3){var r=arguments[0],i=arguments[1],a=arguments[2],h=new de;return h.add(r),h.add(i),h.add(a),h}};var Fi=function(){this._inputPolys=null,this._geomFactory=null;var t=arguments[0];this._inputPolys=t,this._inputPolys===null&&(this._inputPolys=new de)},wT={STRTREE_NODE_CAPACITY:{configurable:!0}};Fi.prototype.reduceToGeometries=function(t){for(var e=this,n=new de,r=t.iterator();r.hasNext();){var i=r.next(),a=null;en(i,Yu)?a=e.unionTree(i):i instanceof Je&&(a=i),n.add(a)}return n};Fi.prototype.extractByEnvelope=function(t,e,n){for(var r=new de,i=0;i<e.getNumGeometries();i++){var a=e.getGeometryN(i);a.getEnvelopeInternal().intersects(t)?r.add(a):n.add(a)}return this._geomFactory.buildGeometry(r)};Fi.prototype.unionOptimized=function(t,e){var n=t.getEnvelopeInternal(),r=e.getEnvelopeInternal();if(!n.intersects(r)){var i=Ga.combine(t,e);return i}if(t.getNumGeometries()<=1&&e.getNumGeometries()<=1)return this.unionActual(t,e);var a=n.intersection(r);return this.unionUsingEnvelopeIntersection(t,e,a)};Fi.prototype.union=function(){if(this._inputPolys===null)throw new Error("union() method cannot be called twice");if(this._inputPolys.isEmpty())return null;this._geomFactory=this._inputPolys.iterator().next().getFactory();for(var t=new aT(Fi.STRTREE_NODE_CAPACITY),e=this._inputPolys.iterator();e.hasNext();){var n=e.next();t.insert(n.getEnvelopeInternal(),n)}this._inputPolys=null;var r=t.itemsTree(),i=this.unionTree(r);return i};Fi.prototype.binaryUnion=function(){if(arguments.length===1){var t=arguments[0];return this.binaryUnion(t,0,t.size())}else if(arguments.length===3){var e=arguments[0],n=arguments[1],r=arguments[2];if(r-n<=1){var i=Fi.getGeometry(e,n);return this.unionSafe(i,null)}else{if(r-n===2)return this.unionSafe(Fi.getGeometry(e,n),Fi.getGeometry(e,n+1));var a=Math.trunc((r+n)/2),h=this.binaryUnion(e,n,a),u=this.binaryUnion(e,a,r);return this.unionSafe(h,u)}}};Fi.prototype.repeatedUnion=function(t){for(var e=null,n=t.iterator();n.hasNext();){var r=n.next();e===null?e=r.copy():e=e.union(r)}return e};Fi.prototype.unionSafe=function(t,e){return t===null&&e===null?null:t===null?e.copy():e===null?t.copy():this.unionOptimized(t,e)};Fi.prototype.unionActual=function(t,e){return Fi.restrictToPolygons(t.union(e))};Fi.prototype.unionTree=function(t){var e=this.reduceToGeometries(t),n=this.binaryUnion(e);return n};Fi.prototype.unionUsingEnvelopeIntersection=function(t,e,n){var r=new de,i=this.extractByEnvelope(n,t,r),a=this.extractByEnvelope(n,e,r),h=this.unionActual(i,a);r.add(h);var u=Ga.combine(r);return u};Fi.prototype.bufferUnion=function(){if(arguments.length===1){var t=arguments[0],e=t.get(0).getFactory(),n=e.buildGeometry(t),r=n.buffer(0);return r}else if(arguments.length===2){var i=arguments[0],a=arguments[1],h=i.getFactory(),u=h.createGeometryCollection([i,a]),_=u.buffer(0);return _}};Fi.prototype.interfaces_=function(){return[]};Fi.prototype.getClass=function(){return Fi};Fi.restrictToPolygons=function(t){if(en(t,kp))return t;var e=Nh.getPolygons(t);return e.size()===1?e.get(0):t.getFactory().createMultiPolygon(En.toPolygonArray(e))};Fi.getGeometry=function(t,e){return e>=t.size()?null:t.get(e)};Fi.union=function(t){var e=new Fi(t);return e.union()};wT.STRTREE_NODE_CAPACITY.get=function(){return 4};Object.defineProperties(Fi,wT);var Qv=function(){};Qv.prototype.interfaces_=function(){return[]};Qv.prototype.getClass=function(){return Qv};Qv.union=function(t,e){if(t.isEmpty()||e.isEmpty()){if(t.isEmpty()&&e.isEmpty())return pn.createEmptyResult(pn.UNION,t,e,t.getFactory());if(t.isEmpty())return e.copy();if(e.isEmpty())return t.copy()}return t.checkNotGeometryCollection(t),t.checkNotGeometryCollection(e),Fs.overlayOp(t,e,pn.UNION)};function hd(){return new t0}function t0(){this.reset()}t0.prototype={constructor:t0,reset:function(){this.s=this.t=0},add:function(t){II(xv,t,this.t),II(this,xv.s,this.s),this.s?this.t+=xv.t:this.s=xv.t},valueOf:function(){return this.s}};var xv=new t0;function II(t,e,n){var r=t.s=e+n,i=r-e,a=r-i;t.t=e-a+(n-i)}hd();hd();hd();function ET(t,e){function n(r,i){return r=t(r,i),e(r[0],r[1])}return t.invert&&e.invert&&(n.invert=function(r,i){return r=e.invert(r,i),r&&t.invert(r[0],r[1])}),n}var oi=1e-6,xr=Math.PI,Th=xr/2,SI=xr/4,Vh=xr*2,Pf=180/xr,Fl=xr/180,Ss=Math.abs,YO=Math.atan,Pm=Math.atan2,Wi=Math.cos,Ji=Math.sin,qm=Math.sqrt;function IT(t){return t>1?0:t<-1?xr:Math.acos(t)}function ng(t){return t>1?Th:t<-1?-Th:Math.asin(t)}function db(t,e){return[t>xr?t-Vh:t<-xr?t+Vh:t,e]}db.invert=db;function ZO(t,e,n){return(t%=Vh)?e||n?ET(TI(t),LI(e,n)):TI(t):e||n?LI(e,n):db}function CI(t){return function(e,n){return e+=t,[e>xr?e-Vh:e<-xr?e+Vh:e,n]}}function TI(t){var e=CI(t);return e.invert=CI(-t),e}function LI(t,e){var n=Wi(t),r=Ji(t),i=Wi(e),a=Ji(e);function h(u,_){var w=Wi(_),C=Wi(u)*w,P=Ji(u)*w,D=Ji(_),B=D*n+C*r;return[Pm(P*i-B*a,C*n-D*r),ng(B*i+P*a)]}return h.invert=function(u,_){var w=Wi(_),C=Wi(u)*w,P=Ji(u)*w,D=Ji(_),B=D*i-P*a;return[Pm(P*i+D*a,C*n+B*r),ng(B*n-C*r)]},h}function ST(t,e){return t<e?-1:t>e?1:t>=e?0:NaN}function HO(t){return t.length===1&&(t=WO(t)),{left:function(e,n,r,i){for(r==null&&(r=0),i==null&&(i=e.length);r<i;){var a=r+i>>>1;t(e[a],n)<0?r=a+1:i=a}return r},right:function(e,n,r,i){for(r==null&&(r=0),i==null&&(i=e.length);r<i;){var a=r+i>>>1;t(e[a],n)>0?i=a:r=a+1}return r}}}function WO(t){return function(e,n){return ST(t(e),n)}}HO(ST);function gb(t){return[Pm(t[1],t[0]),ng(t[2])]}function Mm(t){var e=t[0],n=t[1],r=Wi(n);return[r*Wi(e),r*Ji(e),Ji(n)]}function bv(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]}function e0(t,e){return[t[1]*e[2]-t[2]*e[1],t[2]*e[0]-t[0]*e[2],t[0]*e[1]-t[1]*e[0]]}function kx(t,e){t[0]+=e[0],t[1]+=e[1],t[2]+=e[2]}function wv(t,e){return[t[0]*e,t[1]*e,t[2]*e]}function mb(t){var e=qm(t[0]*t[0]+t[1]*t[1]+t[2]*t[2]);t[0]/=e,t[1]/=e,t[2]/=e}var zx=hd();function JO(t,e){var n=e[0],r=e[1],i=[Ji(n),-Wi(n),0],a=0,h=0;zx.reset();for(var u=0,_=t.length;u<_;++u)if(C=(w=t[u]).length)for(var w,C,P=w[C-1],D=P[0],B=P[1]/2+SI,$=Ji(B),Z=Wi(B),W=0;W<C;++W,D=ct,$=gt,Z=Ut,P=rt){var rt=w[W],ct=rt[0],pt=rt[1]/2+SI,gt=Ji(pt),Ut=Wi(pt),zt=ct-D,Ot=zt>=0?1:-1,At=Ot*zt,Rt=At>xr,Yt=$*gt;if(zx.add(Pm(Yt*Ot*Ji(At),Z*Ut+Yt*Wi(At))),a+=Rt?zt+Ot*Vh:zt,Rt^D>=n^ct>=n){var be=e0(Mm(P),Mm(rt));mb(be);var Kt=e0(i,be);mb(Kt);var Ke=(Rt^zt>=0?-1:1)*ng(Kt[2]);(r>Ke||r===Ke&&(be[0]||be[1]))&&(h+=Rt^zt>=0?1:-1)}}return(a<-oi||a<oi&&zx<-oi)^h&1}hd();hd();hd();hd();function CT(t){return function(e){var n=new yb;for(var r in t)n[r]=t[r];return n.stream=e,n}}function yb(){}yb.prototype={constructor:yb,point:function(t,e){this.stream.point(t,e)},sphere:function(){this.stream.sphere()},lineStart:function(){this.stream.lineStart()},lineEnd:function(){this.stream.lineEnd()},polygonStart:function(){this.stream.polygonStart()},polygonEnd:function(){this.stream.polygonEnd()}};function TT(t){return function(e,n){var r=Wi(e),i=Wi(n),a=t(r*i);return[a*i*Ji(e),a*Ji(n)]}}function LT(t){return function(e,n){var r=qm(e*e+n*n),i=t(r),a=Ji(i),h=Wi(i);return[Pm(e*a,r*h),ng(r&&n*a/r)]}}var KO=TT(function(t){return qm(2/(1+t))});KO.invert=LT(function(t){return 2*ng(t/2)});function Dy(){}function NT(){var t=[],e;return{point:function(n,r){e.push([n,r])},lineStart:function(){t.push(e=[])},lineEnd:Dy,rejoin:function(){t.length>1&&t.push(t.pop().concat(t.shift()))},result:function(){var n=t;return t=[],e=null,n}}}function Mv(t,e){return Ss(t[0]-e[0])<oi&&Ss(t[1]-e[1])<oi}function Ev(t,e,n,r){this.x=t,this.z=e,this.o=n,this.e=r,this.v=!1,this.n=this.p=null}function PT(t,e,n,r,i){var a=[],h=[],u,_;if(t.forEach(function($){if(!((Z=$.length-1)<=0)){var Z,W=$[0],rt=$[Z],ct;if(Mv(W,rt)){for(i.lineStart(),u=0;u<Z;++u)i.point((W=$[u])[0],W[1]);i.lineEnd();return}a.push(ct=new Ev(W,$,null,!0)),h.push(ct.o=new Ev(W,null,ct,!1)),a.push(ct=new Ev(rt,$,null,!1)),h.push(ct.o=new Ev(rt,null,ct,!0))}}),!!a.length){for(h.sort(e),NI(a),NI(h),u=0,_=h.length;u<_;++u)h[u].e=n=!n;for(var w=a[0],C,P;;){for(var D=w,B=!0;D.v;)if((D=D.n)===w)return;C=D.z,i.lineStart();do{if(D.v=D.o.v=!0,D.e){if(B)for(u=0,_=C.length;u<_;++u)i.point((P=C[u])[0],P[1]);else r(D.x,D.n.x,1,i);D=D.n}else{if(B)for(C=D.p.z,u=C.length-1;u>=0;--u)i.point((P=C[u])[0],P[1]);else r(D.x,D.p.x,-1,i);D=D.p}D=D.o,C=D.z,B=!B}while(!D.v);i.lineEnd()}}}function NI(t){if(e=t.length){for(var e,n=0,r=t[0],i;++n<e;)r.n=i=t[n],i.p=r,r=i;r.n=i=t[0],i.p=r}}function MT(t){for(var e=t.length,n,r=-1,i=0,a,h;++r<e;)i+=t[r].length;for(a=new Array(i);--e>=0;)for(h=t[e],n=h.length;--n>=0;)a[--i]=h[n];return a}function AT(t,e,n,r){return function(i,a){var h=e(a),u=i.invert(r[0],r[1]),_=NT(),w=e(_),C=!1,P,D,B,$={point:Z,lineStart:rt,lineEnd:ct,polygonStart:function(){$.point=pt,$.lineStart=gt,$.lineEnd=Ut,D=[],P=[]},polygonEnd:function(){$.point=Z,$.lineStart=rt,$.lineEnd=ct,D=MT(D);var zt=JO(P,u);D.length?(C||(a.polygonStart(),C=!0),PT(D,tR,zt,n,a)):zt&&(C||(a.polygonStart(),C=!0),a.lineStart(),n(null,null,1,a),a.lineEnd()),C&&(a.polygonEnd(),C=!1),D=P=null},sphere:function(){a.polygonStart(),a.lineStart(),n(null,null,1,a),a.lineEnd(),a.polygonEnd()}};function Z(zt,Ot){var At=i(zt,Ot);t(zt=At[0],Ot=At[1])&&a.point(zt,Ot)}function W(zt,Ot){var At=i(zt,Ot);h.point(At[0],At[1])}function rt(){$.point=W,h.lineStart()}function ct(){$.point=Z,h.lineEnd()}function pt(zt,Ot){B.push([zt,Ot]);var At=i(zt,Ot);w.point(At[0],At[1])}function gt(){w.lineStart(),B=[]}function Ut(){pt(B[0][0],B[0][1]),w.lineEnd();var zt=w.clean(),Ot=_.result(),At,Rt=Ot.length,Yt,be,Kt;if(B.pop(),P.push(B),B=null,!!Rt){if(zt&1){if(be=Ot[0],(Yt=be.length-1)>0){for(C||(a.polygonStart(),C=!0),a.lineStart(),At=0;At<Yt;++At)a.point((Kt=be[At])[0],Kt[1]);a.lineEnd()}return}Rt>1&&zt&2&&Ot.push(Ot.pop().concat(Ot.shift())),D.push(Ot.filter(QO))}}return $}}function QO(t){return t.length>1}function tR(t,e){return((t=t.x)[0]<0?t[1]-Th-oi:Th-t[1])-((e=e.x)[0]<0?e[1]-Th-oi:Th-e[1])}const PI=AT(function(){return!0},eR,rR,[-xr,-Th]);function eR(t){var e=NaN,n=NaN,r=NaN,i;return{lineStart:function(){t.lineStart(),i=1},point:function(a,h){var u=a>0?xr:-xr,_=Ss(a-e);Ss(_-xr)<oi?(t.point(e,n=(n+h)/2>0?Th:-Th),t.point(r,n),t.lineEnd(),t.lineStart(),t.point(u,n),t.point(a,n),i=0):r!==u&&_>=xr&&(Ss(e-r)<oi&&(e-=r*oi),Ss(a-u)<oi&&(a-=u*oi),n=nR(e,n,a,h),t.point(r,n),t.lineEnd(),t.lineStart(),t.point(u,n),i=0),t.point(e=a,n=h),r=u},lineEnd:function(){t.lineEnd(),e=n=NaN},clean:function(){return 2-i}}}function nR(t,e,n,r){var i,a,h=Ji(t-n);return Ss(h)>oi?YO((Ji(e)*(a=Wi(r))*Ji(n)-Ji(r)*(i=Wi(e))*Ji(t))/(i*a*h)):(e+r)/2}function rR(t,e,n,r){var i;if(t==null)i=n*Th,r.point(-xr,i),r.point(0,i),r.point(xr,i),r.point(xr,0),r.point(xr,-i),r.point(0,-i),r.point(-xr,-i),r.point(-xr,0),r.point(-xr,i);else if(Ss(t[0]-e[0])>oi){var a=t[0]<e[0]?xr:-xr;i=n*a/2,r.point(-a,i),r.point(0,i),r.point(a,i)}else r.point(e[0],e[1])}function iR(t,e,n,r,i,a){if(n){var h=Wi(e),u=Ji(e),_=r*n;i==null?(i=e+r*Vh,a=e-_/2):(i=MI(h,i),a=MI(h,a),(r>0?i<a:i>a)&&(i+=r*Vh));for(var w,C=i;r>0?C>a:C<a;C-=_)w=gb([h,-u*Wi(C),-u*Ji(C)]),t.point(w[0],w[1])}}function MI(t,e){e=Mm(e),e[0]-=t,mb(e);var n=IT(-e[1]);return((-e[2]<0?-n:n)+Vh-oi)%Vh}function oR(t,e){var n=Wi(t),r=n>0,i=Ss(n)>oi;function a(C,P,D,B){iR(B,t,e,D,C,P)}function h(C,P){return Wi(C)*Wi(P)>n}function u(C){var P,D,B,$,Z;return{lineStart:function(){$=B=!1,Z=1},point:function(W,rt){var ct=[W,rt],pt,gt=h(W,rt),Ut=r?gt?0:w(W,rt):gt?w(W+(W<0?xr:-xr),rt):0;if(!P&&($=B=gt)&&C.lineStart(),gt!==B&&(pt=_(P,ct),(!pt||Mv(P,pt)||Mv(ct,pt))&&(ct[0]+=oi,ct[1]+=oi,gt=h(ct[0],ct[1]))),gt!==B)Z=0,gt?(C.lineStart(),pt=_(ct,P),C.point(pt[0],pt[1])):(pt=_(P,ct),C.point(pt[0],pt[1]),C.lineEnd()),P=pt;else if(i&&P&&r^gt){var zt;!(Ut&D)&&(zt=_(ct,P,!0))&&(Z=0,r?(C.lineStart(),C.point(zt[0][0],zt[0][1]),C.point(zt[1][0],zt[1][1]),C.lineEnd()):(C.point(zt[1][0],zt[1][1]),C.lineEnd(),C.lineStart(),C.point(zt[0][0],zt[0][1])))}gt&&(!P||!Mv(P,ct))&&C.point(ct[0],ct[1]),P=ct,B=gt,D=Ut},lineEnd:function(){B&&C.lineEnd(),P=null},clean:function(){return Z|($&&B)<<1}}}function _(C,P,D){var B=Mm(C),$=Mm(P),Z=[1,0,0],W=e0(B,$),rt=bv(W,W),ct=W[0],pt=rt-ct*ct;if(!pt)return!D&&C;var gt=n*rt/pt,Ut=-n*ct/pt,zt=e0(Z,W),Ot=wv(Z,gt),At=wv(W,Ut);kx(Ot,At);var Rt=zt,Yt=bv(Ot,Rt),be=bv(Rt,Rt),Kt=Yt*Yt-be*(bv(Ot,Ot)-1);if(!(Kt<0)){var Ke=qm(Kt),vt=wv(Rt,(-Yt-Ke)/be);if(kx(vt,Ot),vt=gb(vt),!D)return vt;var Qt=C[0],Te=P[0],Ge=C[1],gn=P[1],xn;Te<Qt&&(xn=Qt,Qt=Te,Te=xn);var ei=Te-Qt,jn=Ss(ei-xr)<oi,$n=jn||ei<oi;if(!jn&&gn<Ge&&(xn=Ge,Ge=gn,gn=xn),$n?jn?Ge+gn>0^vt[1]<(Ss(vt[0]-Qt)<oi?Ge:gn):Ge<=vt[1]&&vt[1]<=gn:ei>xr^(Qt<=vt[0]&&vt[0]<=Te)){var Fe=wv(Rt,(-Yt+Ke)/be);return kx(Fe,Ot),[vt,gb(Fe)]}}}function w(C,P){var D=r?t:xr-t,B=0;return C<-D?B|=1:C>D&&(B|=2),P<-D?B|=4:P>D&&(B|=8),B}return AT(h,u,a,r?[0,-t]:[-xr,t-xr])}function sR(t,e,n,r,i,a){var h=t[0],u=t[1],_=e[0],w=e[1],C=0,P=1,D=_-h,B=w-u,$;if($=n-h,!(!D&&$>0)){if($/=D,D<0){if($<C)return;$<P&&(P=$)}else if(D>0){if($>P)return;$>C&&(C=$)}if($=i-h,!(!D&&$<0)){if($/=D,D<0){if($>P)return;$>C&&(C=$)}else if(D>0){if($<C)return;$<P&&(P=$)}if($=r-u,!(!B&&$>0)){if($/=B,B<0){if($<C)return;$<P&&(P=$)}else if(B>0){if($>P)return;$>C&&(C=$)}if($=a-u,!(!B&&$<0)){if($/=B,B<0){if($>P)return;$>C&&(C=$)}else if(B>0){if($<C)return;$<P&&(P=$)}return C>0&&(t[0]=h+C*D,t[1]=u+C*B),P<1&&(e[0]=h+P*D,e[1]=u+P*B),!0}}}}}var Oy=1e9,Iv=-Oy;function aR(t,e,n,r){function i(w,C){return t<=w&&w<=n&&e<=C&&C<=r}function a(w,C,P,D){var B=0,$=0;if(w==null||(B=h(w,P))!==($=h(C,P))||_(w,C)<0^P>0)do D.point(B===0||B===3?t:n,B>1?r:e);while((B=(B+P+4)%4)!==$);else D.point(C[0],C[1])}function h(w,C){return Ss(w[0]-t)<oi?C>0?0:3:Ss(w[0]-n)<oi?C>0?2:1:Ss(w[1]-e)<oi?C>0?1:0:C>0?3:2}function u(w,C){return _(w.x,C.x)}function _(w,C){var P=h(w,1),D=h(C,1);return P!==D?P-D:P===0?C[1]-w[1]:P===1?w[0]-C[0]:P===2?w[1]-C[1]:C[0]-w[0]}return function(w){var C=w,P=NT(),D,B,$,Z,W,rt,ct,pt,gt,Ut,zt,Ot={point:At,lineStart:Kt,lineEnd:Ke,polygonStart:Yt,polygonEnd:be};function At(Qt,Te){i(Qt,Te)&&C.point(Qt,Te)}function Rt(){for(var Qt=0,Te=0,Ge=B.length;Te<Ge;++Te)for(var gn=B[Te],xn=1,ei=gn.length,jn=gn[0],$n,Fe,Vn=jn[0],rr=jn[1];xn<ei;++xn)$n=Vn,Fe=rr,jn=gn[xn],Vn=jn[0],rr=jn[1],Fe<=r?rr>r&&(Vn-$n)*(r-Fe)>(rr-Fe)*(t-$n)&&++Qt:rr<=r&&(Vn-$n)*(r-Fe)<(rr-Fe)*(t-$n)&&--Qt;return Qt}function Yt(){C=P,D=[],B=[],zt=!0}function be(){var Qt=Rt(),Te=zt&&Qt,Ge=(D=MT(D)).length;(Te||Ge)&&(w.polygonStart(),Te&&(w.lineStart(),a(null,null,1,w),w.lineEnd()),Ge&&PT(D,u,Qt,a,w),w.polygonEnd()),C=w,D=B=$=null}function Kt(){Ot.point=vt,B&&B.push($=[]),Ut=!0,gt=!1,ct=pt=NaN}function Ke(){D&&(vt(Z,W),rt&&gt&&P.rejoin(),D.push(P.result())),Ot.point=At,gt&&C.lineEnd()}function vt(Qt,Te){var Ge=i(Qt,Te);if(B&&$.push([Qt,Te]),Ut)Z=Qt,W=Te,rt=Ge,Ut=!1,Ge&&(C.lineStart(),C.point(Qt,Te));else if(Ge&&gt)C.point(Qt,Te);else{var gn=[ct=Math.max(Iv,Math.min(Oy,ct)),pt=Math.max(Iv,Math.min(Oy,pt))],xn=[Qt=Math.max(Iv,Math.min(Oy,Qt)),Te=Math.max(Iv,Math.min(Oy,Te))];sR(gn,xn,t,e,n,r)?(gt||(C.lineStart(),C.point(gn[0],gn[1])),C.point(xn[0],xn[1]),Ge||C.lineEnd(),zt=!1):Ge&&(C.lineStart(),C.point(Qt,Te),zt=!1)}ct=Qt,pt=Te,gt=Ge}return Ot}}function AI(t){return t}function n0(t,e){t&&OI.hasOwnProperty(t.type)&&OI[t.type](t,e)}var DI={Feature:function(t,e){n0(t.geometry,e)},FeatureCollection:function(t,e){for(var n=t.features,r=-1,i=n.length;++r<i;)n0(n[r].geometry,e)}},OI={Sphere:function(t,e){e.sphere()},Point:function(t,e){t=t.coordinates,e.point(t[0],t[1],t[2])},MultiPoint:function(t,e){for(var n=t.coordinates,r=-1,i=n.length;++r<i;)t=n[r],e.point(t[0],t[1],t[2])},LineString:function(t,e){_b(t.coordinates,e,0)},MultiLineString:function(t,e){for(var n=t.coordinates,r=-1,i=n.length;++r<i;)_b(n[r],e,0)},Polygon:function(t,e){RI(t.coordinates,e)},MultiPolygon:function(t,e){for(var n=t.coordinates,r=-1,i=n.length;++r<i;)RI(n[r],e)},GeometryCollection:function(t,e){for(var n=t.geometries,r=-1,i=n.length;++r<i;)n0(n[r],e)}};function _b(t,e,n){var r=-1,i=t.length-n,a;for(e.lineStart();++r<i;)a=t[r],e.point(a[0],a[1],a[2]);e.lineEnd()}function RI(t,e){var n=-1,r=t.length;for(e.polygonStart();++n<r;)_b(t[n],e,1);e.polygonEnd()}function uR(t,e){t&&DI.hasOwnProperty(t.type)?DI[t.type](t,e):n0(t,e)}var Am=1/0,r0=Am,__=-Am,i0=__,FI={point:lR,lineStart:Dy,lineEnd:Dy,polygonStart:Dy,polygonEnd:Dy,result:function(){var t=[[Am,r0],[__,i0]];return __=i0=-(r0=Am=1/0),t}};function lR(t,e){t<Am&&(Am=t),t>__&&(__=t),e<r0&&(r0=e),e>i0&&(i0=e)}function DT(t,e,n){var r=e[1][0]-e[0][0],i=e[1][1]-e[0][1],a=t.clipExtent&&t.clipExtent();t.scale(150).translate([0,0]),a!=null&&t.clipExtent(null),uR(n,t.stream(FI));var h=FI.result(),u=Math.min(r/(h[1][0]-h[0][0]),i/(h[1][1]-h[0][1])),_=+e[0][0]+(r-u*(h[1][0]+h[0][0]))/2,w=+e[0][1]+(i-u*(h[1][1]+h[0][1]))/2;return a!=null&&t.clipExtent(a),t.scale(u*150).translate([_,w])}function cR(t,e,n){return DT(t,[[0,0],e],n)}var kI=16,hR=Wi(30*Fl);function zI(t,e){return+e?fR(t,e):pR(t)}function pR(t){return CT({point:function(e,n){e=t(e,n),this.stream.point(e[0],e[1])}})}function fR(t,e){function n(r,i,a,h,u,_,w,C,P,D,B,$,Z,W){var rt=w-r,ct=C-i,pt=rt*rt+ct*ct;if(pt>4*e&&Z--){var gt=h+D,Ut=u+B,zt=_+$,Ot=qm(gt*gt+Ut*Ut+zt*zt),At=ng(zt/=Ot),Rt=Ss(Ss(zt)-1)<oi||Ss(a-P)<oi?(a+P)/2:Pm(Ut,gt),Yt=t(Rt,At),be=Yt[0],Kt=Yt[1],Ke=be-r,vt=Kt-i,Qt=ct*Ke-rt*vt;(Qt*Qt/pt>e||Ss((rt*Ke+ct*vt)/pt-.5)>.3||h*D+u*B+_*$<hR)&&(n(r,i,a,h,u,_,be,Kt,Rt,gt/=Ot,Ut/=Ot,zt,Z,W),W.point(be,Kt),n(be,Kt,Rt,gt,Ut,zt,w,C,P,D,B,$,Z,W))}}return function(r){var i,a,h,u,_,w,C,P,D,B,$,Z,W={point:rt,lineStart:ct,lineEnd:gt,polygonStart:function(){r.polygonStart(),W.lineStart=Ut},polygonEnd:function(){r.polygonEnd(),W.lineStart=ct}};function rt(At,Rt){At=t(At,Rt),r.point(At[0],At[1])}function ct(){P=NaN,W.point=pt,r.lineStart()}function pt(At,Rt){var Yt=Mm([At,Rt]),be=t(At,Rt);n(P,D,C,B,$,Z,P=be[0],D=be[1],C=At,B=Yt[0],$=Yt[1],Z=Yt[2],kI,r),r.point(P,D)}function gt(){W.point=rt,r.lineEnd()}function Ut(){ct(),W.point=zt,W.lineEnd=Ot}function zt(At,Rt){pt(i=At,Rt),a=P,h=D,u=B,_=$,w=Z,W.point=pt}function Ot(){n(P,D,C,B,$,Z,a,h,i,u,_,w,kI,r),W.lineEnd=gt,gt()}return W}}var dR=CT({point:function(t,e){this.stream.point(t*Fl,e*Fl)}});function gR(t){return mR(function(){return t})()}function mR(t){var e,n=150,r=480,i=250,a,h,u=0,_=0,w=0,C=0,P=0,D,B,$=null,Z=PI,W=null,rt,ct,pt,gt=AI,Ut=.5,zt=zI(be,Ut),Ot,At;function Rt(vt){return vt=B(vt[0]*Fl,vt[1]*Fl),[vt[0]*n+a,h-vt[1]*n]}function Yt(vt){return vt=B.invert((vt[0]-a)/n,(h-vt[1])/n),vt&&[vt[0]*Pf,vt[1]*Pf]}function be(vt,Qt){return vt=e(vt,Qt),[vt[0]*n+a,h-vt[1]*n]}Rt.stream=function(vt){return Ot&&At===vt?Ot:Ot=dR(Z(D,zt(gt(At=vt))))},Rt.clipAngle=function(vt){return arguments.length?(Z=+vt?oR($=vt*Fl,6*Fl):($=null,PI),Ke()):$*Pf},Rt.clipExtent=function(vt){return arguments.length?(gt=vt==null?(W=rt=ct=pt=null,AI):aR(W=+vt[0][0],rt=+vt[0][1],ct=+vt[1][0],pt=+vt[1][1]),Ke()):W==null?null:[[W,rt],[ct,pt]]},Rt.scale=function(vt){return arguments.length?(n=+vt,Kt()):n},Rt.translate=function(vt){return arguments.length?(r=+vt[0],i=+vt[1],Kt()):[r,i]},Rt.center=function(vt){return arguments.length?(u=vt[0]%360*Fl,_=vt[1]%360*Fl,Kt()):[u*Pf,_*Pf]},Rt.rotate=function(vt){return arguments.length?(w=vt[0]%360*Fl,C=vt[1]%360*Fl,P=vt.length>2?vt[2]%360*Fl:0,Kt()):[w*Pf,C*Pf,P*Pf]},Rt.precision=function(vt){return arguments.length?(zt=zI(be,Ut=vt*vt),Ke()):qm(Ut)},Rt.fitExtent=function(vt,Qt){return DT(Rt,vt,Qt)},Rt.fitSize=function(vt,Qt){return cR(Rt,vt,Qt)};function Kt(){B=ET(D=ZO(w,C,P),e);var vt=e(u,_);return a=r-vt[0]*n,h=i+vt[1]*n,Ke()}function Ke(){return Ot=At=null,Rt}return function(){return e=t.apply(this,arguments),Rt.invert=e.invert&&Yt,Kt()}}var OT=TT(function(t){return(t=IT(t))&&t/Ji(t)});OT.invert=LT(function(t){return t});function yR(){return gR(OT).scale(79.4188).clipAngle(180-.001)}function BI(t,e){return[t,e]}BI.invert=BI;function _R(t,e,n){n=n||{};var r=n.units||"kilometers",i=n.steps||8;if(!t)throw new Error("geojson is required");if(typeof n!="object")throw new Error("options must be an object");if(typeof i!="number")throw new Error("steps must be an number");if(e===void 0)throw new Error("radius is required");if(i<=0)throw new Error("steps must be greater than 0");var a=[];switch(t.type){case"GeometryCollection":return ZC(t,function(h){var u=Av(h,e,r,i);u&&a.push(u)}),pb(a);case"FeatureCollection":return _I(t,function(h){var u=Av(h,e,r,i);u&&_I(u,function(_){_&&a.push(_)})}),pb(a)}return Av(t,e,r,i)}function Av(t,e,n,r){var i=t.properties||{},a=t.type==="Feature"?t.geometry:t;if(a.type==="GeometryCollection"){var h=[];return ZC(t,function(Z){var W=Av(Z,e,n,r);W&&h.push(W)}),pb(h)}var u=vR(a),_={type:a.type,coordinates:FT(a.coordinates,u)},w=new aw,C=w.read(_),P=CO(TO(e,n),"meters"),D=Do.bufferOp(C,P,r),B=new oT;if(D=B.write(D),!RT(D.coordinates)){var $={type:D.type,coordinates:kT(D.coordinates,u)};return Qb($,i)}}function RT(t){return Array.isArray(t[0])?RT(t[0]):isNaN(t[0])}function FT(t,e){return typeof t[0]!="object"?e(t):t.map(function(n){return FT(n,e)})}function kT(t,e){return typeof t[0]!="object"?e.invert(t):t.map(function(n){return kT(n,e)})}function vR(t){var e=NO(t).geometry.coordinates,n=[-e[0],-e[1]];return yR().rotate(n).scale($a)}const xR=-90,bR=90,wR=-180,ER=180,IR=(t,e=null)=>{const n=i_(t);if(!zT(n))return null;const r=LO(n);let i;return e?i=_R(r,e,{units:"miles"}):i=r,i_(i)},zT=t=>r_.every(t,r_.isFinite),SR=t=>{let e=!1;if(t){const[n,r]=t;e=n>=xR&&n<=bR&&r>=wR&&r<=ER}return e},CR={getBoundingBox:IR,validateBoundingBox:zT,validateCoordinates:SR},TR=2,LR=t=>{const e=ON(),n=rn.useMemo(()=>r_.isEmpty(t.data)?null:t.data,[t.data]);return rn.useEffect(()=>{if(e&&n&&t.fitBoundingBox){const r=CR.getBoundingBox(n,t.buffer);r&&e.fitBounds(r,t.boundingBoxOptions,t.boundingBoxData)}},[e,t.buffer,t.data,t.boundingBoxData,t.boundingBoxOptions,t.fitBoundingBox]),n?hv.jsxs(hv.Fragment,{children:[t.animate&&hv.jsx(RN,{data:t.data,id:t.layerId}),hv.jsx(FN,{cluster:t.cluster,clusterMaxZoom:t.clusterMaxZoom,clusterMinPoints:t.clusterMinPoints,clusterProperties:t.clusterProperties,clusterRadius:t.clusterRadius,data:t.data,fillStyle:t.fillStyle,id:t.layerId,strokeStyle:t.strokeStyle,pointStyle:t.pointStyle})]}):null};LR.defaultProps={buffer:TR,fillStyle:Cx.fill,fitBoundingBox:!0,pointStyle:Cx.point,strokeStyle:Cx.stroke};o0.constants.classes.CONTROL_BASE="maplibregl-ctrl";o0.constants.classes.CONTROL_PREFIX="maplibregl-ctrl-";o0.constants.classes.CONTROL_GROUP="maplibregl-ctrl-group";export{CR as R,Cx as o,LR as x};
function __vite__mapDeps(indexes) {
  if (!__vite__mapDeps.viteFileDeps) {
    __vite__mapDeps.viteFileDeps = []
  }
  return indexes.map((i) => __vite__mapDeps.viteFileDeps[i])
}
