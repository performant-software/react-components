import{m,d as h,f as E,j as f,k as $}from"./peripleo-maplibre.es26-DiUCIHtK.js";import{r as a}from"./index-C0dDX-lL.js";import{r as R}from"./index-DOYXiIEK.js";const g=10,I=e=>{const t=m(),i=new Set(Array.isArray(e.layerId)?e.layerId:[e.layerId]),s=a.useRef(null),[o,l]=a.useState(),d=r=>{const c=r.target,u=c.queryRenderedFeatures(r.point).filter(({layer:n})=>i.has(n.id));if(u.length>0){const{id:n,type:v,source:b,properties:p,geometry:x}=u[0];p.cluster?c.getSource(b).getClusterLeaves(p.cluster_id,1/0,0,(S,P)=>{if(!S){const w=P.map(y=>({type:y.type,properties:y.properties,geometry:y.geometry}));l({target:{clusterId:n,features:w},event:r.originalEvent})}}):l({target:{type:v,properties:p,geometry:x},event:r.originalEvent})}else l(void 0)};return a.useLayoutEffect(()=>{if(s.current){const{clientX:r,clientY:c}=o.event,u=s.current.style;u.left=`${r+g}px`,u.top=`${c+g}px`}},[o]),a.useEffect(()=>(t.on("mousemove",d),()=>{t.off("mousemove",d)}),[t]),o&&R.createPortal(h.jsx("div",{ref:s,className:"p6o-tooltip-container",children:e.content(o.target,o.event)}),document.body)},L={type:"circle",paint:{"circle-radius":["interpolate",["linear"],["number",["get","point_count"],1],0,4,10,14],"circle-stroke-width":1,"circle-color":["case",["boolean",["feature-state","hover"],!1],"#3b62ff","#ff623b"],"circle-stroke-color":"#8d260c"}},M={type:"fill",paint:{"fill-color":"#ff623b","fill-opacity":.2}},j={type:"line",paint:{"line-color":"#ff623b","line-opacity":.6}},_=e=>{const{id:t,data:i}=e,s=e.visible===void 0?!0:e.visible,o=e.fillStyle||M,l=e.strokeStyle||j,d=e.pointStyle||L,r=E(),[c,u]=a.useState();return a.useEffect(()=>{r&&new Set(r.getStyle().layers.map(n=>n.id)).has(e.id)&&r.setLayoutProperty(e.id,"visibility",s?"visible":"none")},[s,r]),a.useEffect(()=>{if(!r)return;const n=`source-${t}`;return r.addSource(n,{type:"geojson",data:i,...e.cluster&&{cluster:!0},...e.clusterRadius!==void 0&&{clusterRadius:e.clusterRadius},...e.clusterMaxZoom!==void 0&&{clusterMaxZoom:e.clusterMaxZoom},...e.clusterMinPoints!==void 0&&{clusterMinPoints:e.clusterMinPoints},...e.clusterProperties!==void 0&&{clusterProperties:e.clusterProperties}}),r.addLayer({id:`layer-${t}-fill`,...o,source:`source-${t}`,filter:["!=","$type","Point"],metadata:{interactive:e.interactive}}),r.addLayer({id:`layer-${t}-line`,...l,source:`source-${t}`,filter:["!=","$type","Point"]}),r.addLayer({id:`layer-${t}-point`,...d,filter:["==","$type","Point"],source:`source-${t}`,metadata:{interactive:e.interactive}}),u(n),setTimeout(()=>r.moveLayer(`layer-${t}-point`),10),()=>{f(r,`layer-${t}-point`),f(r,`layer-${t}-line`),f(r,`layer-${t}-fill`),$(r,n)}},[r]),a.useEffect(()=>{c&&r.getSource(c).setData(i)},[c,i]),e.tooltip?h.jsx(I,{layerId:[`layer-${t}-point`,`layer-${t}-fill`],content:e.tooltip}):null},A=(e,t,i,s)=>({width:e,height:e,data:new Uint8Array(e*e*4),onAdd:function(){const o=document.createElement("canvas");o.width=this.width,o.height=this.height,this.context=o.getContext("2d",{willReadFrequently:!0})},render:function(){const o=performance.now()%i/i,l=e/2*.2,d=e/2*.7*o+l,r=this.context;return r.clearRect(0,0,this.width,this.height),r.beginPath(),r.arc(this.width/2,this.height/2,d,0,Math.PI*2),r.fillStyle=`rgba(${t[0]}, ${t[1]}, ${t[2]}, ${1.5*(1-o)})`,r.fill(),this.data=r.getImageData(0,0,this.width,this.height).data,s.triggerRepaint(),!0}});let k=(e=21)=>crypto.getRandomValues(new Uint8Array(e)).reduce((t,i)=>(i&=63,i<36?t+=i.toString(36):i<62?t+=(i-26).toString(36).toUpperCase():i>62?t+="-":t+="_",t),"");const C=e=>{const t=m(),i=a.useMemo(()=>`pulse-${k()}`,[]),s=typeof e=="number"?e:e.size,o=typeof e=="number"?[246,112,86]:e.rgb||[246,112,86],l=typeof e=="number"?1e3:e.duration||1e3;return a.useEffect(()=>(t.addImage(i,A(s*2,o,l,t),{pixelRatio:2}),()=>{t.removeImage(i)}),[]),{type:"symbol",layout:{"icon-image":i}}},q=e=>{const{id:t,data:i}=e,s=m(),o=C(e.size||100);return a.useEffect(()=>(s.addSource(`source-${t}-pulse`,{type:"geojson",data:i}),s.addLayer({id:`layer-${t}-pulse`,...o,filter:["==","$type","Point"],source:`source-${t}-pulse`}),()=>{s.removeLayer(`layer-${t}-pulse`),s.removeSource(`source-${t}-pulse`)}),[i]),null};export{q as f,_ as g};
