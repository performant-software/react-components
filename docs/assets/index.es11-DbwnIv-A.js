import{r as Qe,R as Sv}from"./index-C0dDX-lL.js";import{f as x2}from"./peripleo-maplibre.es11-L3SiAA6_.js";import{f as EP,g as SP}from"./MapStyles-Lj7OshH9.js";import{r as b2}from"./index-DOYXiIEK.js";import{_ as w2}from"./iframe-9mjggyHZ.js";var Id=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function E2(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var S2={exports:{}};(function(e,t){(function(r,n){e.exports=n()})(Id,function(){var r=function(T,D){var Y={drag:[],click:[],mousemove:[],mousedown:[],mouseup:[],mouseout:[],keydown:[],keyup:[],touchstart:[],touchmove:[],touchend:[],tap:[]},dt={on:function(Ct,Dt,re){if(Y[Ct]===void 0)throw new Error("Invalid event type: "+Ct);Y[Ct].push({selector:Dt,fn:re})},render:function(Ct){D.store.featureChanged(Ct)}},It=function(Ct,Dt){for(var re=Y[Ct],ae=re.length;ae--;){var we=re[ae];if(we.selector(Dt)){we.fn.call(dt,Dt)||D.store.render(),D.ui.updateMapClasses();break}}};return T.start.call(dt),{render:T.render,stop:function(){T.stop&&T.stop()},trash:function(){T.trash&&(T.trash(),D.store.render())},combineFeatures:function(){T.combineFeatures&&T.combineFeatures()},uncombineFeatures:function(){T.uncombineFeatures&&T.uncombineFeatures()},drag:function(Ct){It("drag",Ct)},click:function(Ct){It("click",Ct)},mousemove:function(Ct){It("mousemove",Ct)},mousedown:function(Ct){It("mousedown",Ct)},mouseup:function(Ct){It("mouseup",Ct)},mouseout:function(Ct){It("mouseout",Ct)},keydown:function(Ct){It("keydown",Ct)},keyup:function(Ct){It("keyup",Ct)},touchstart:function(Ct){It("touchstart",Ct)},touchmove:function(Ct){It("touchmove",Ct)},touchend:function(Ct){It("touchend",Ct)},tap:function(Ct){It("tap",Ct)}}};function n(T){return T&&T.__esModule&&Object.prototype.hasOwnProperty.call(T,"default")?T.default:T}function i(T){if(T.__esModule)return T;var D=T.default;if(typeof D=="function"){var Y=function dt(){if(this instanceof dt){var It=[null];It.push.apply(It,arguments);var Ct=Function.bind.apply(D,It);return new Ct}return D.apply(this,arguments)};Y.prototype=D.prototype}else Y={};return Object.defineProperty(Y,"__esModule",{value:!0}),Object.keys(T).forEach(function(dt){var It=Object.getOwnPropertyDescriptor(T,dt);Object.defineProperty(Y,dt,It.get?It:{enumerable:!0,get:function(){return T[dt]}})}),Y}var l={},h={RADIUS:6378137,FLATTENING:1/298.257223563,POLAR_RADIUS:63567523142e-4},a=h;function g(T){var D=0;if(T&&T.length>0){D+=Math.abs(_(T[0]));for(var Y=1;Y<T.length;Y++)D-=Math.abs(_(T[Y]))}return D}function _(T){var D,Y,dt,It,Ct,Dt,re=0,ae=T.length;if(ae>2){for(Dt=0;Dt<ae;Dt++)Dt===ae-2?(dt=ae-2,It=ae-1,Ct=0):Dt===ae-1?(dt=ae-1,It=0,Ct=1):(dt=Dt,It=Dt+1,Ct=Dt+2),D=T[dt],Y=T[It],re+=(E(T[Ct][0])-E(D[0]))*Math.sin(E(Y[1]));re=re*a.RADIUS*a.RADIUS/2}return re}function E(T){return T*Math.PI/180}l.geometry=function T(D){var Y,dt=0;switch(D.type){case"Polygon":return g(D.coordinates);case"MultiPolygon":for(Y=0;Y<D.coordinates.length;Y++)dt+=g(D.coordinates[Y]);return dt;case"Point":case"MultiPoint":case"LineString":case"MultiLineString":return 0;case"GeometryCollection":for(Y=0;Y<D.geometries.length;Y++)dt+=T(D.geometries[Y]);return dt}},l.ring=_;var S={CONTROL_BASE:"mapboxgl-ctrl",CONTROL_PREFIX:"mapboxgl-ctrl-",CONTROL_BUTTON:"mapbox-gl-draw_ctrl-draw-btn",CONTROL_BUTTON_LINE:"mapbox-gl-draw_line",CONTROL_BUTTON_POLYGON:"mapbox-gl-draw_polygon",CONTROL_BUTTON_POINT:"mapbox-gl-draw_point",CONTROL_BUTTON_TRASH:"mapbox-gl-draw_trash",CONTROL_BUTTON_COMBINE_FEATURES:"mapbox-gl-draw_combine",CONTROL_BUTTON_UNCOMBINE_FEATURES:"mapbox-gl-draw_uncombine",CONTROL_GROUP:"mapboxgl-ctrl-group",ATTRIBUTION:"mapboxgl-ctrl-attrib",ACTIVE_BUTTON:"active",BOX_SELECT:"mapbox-gl-draw_boxselect"},A={HOT:"mapbox-gl-draw-hot",COLD:"mapbox-gl-draw-cold"},O={ADD:"add",MOVE:"move",DRAG:"drag",POINTER:"pointer",NONE:"none"},k={POLYGON:"polygon",LINE:"line_string",POINT:"point"},G={FEATURE:"Feature",POLYGON:"Polygon",LINE_STRING:"LineString",POINT:"Point",FEATURE_COLLECTION:"FeatureCollection",MULTI_PREFIX:"Multi",MULTI_POINT:"MultiPoint",MULTI_LINE_STRING:"MultiLineString",MULTI_POLYGON:"MultiPolygon"},W={DRAW_LINE_STRING:"draw_line_string",DRAW_POLYGON:"draw_polygon",DRAW_POINT:"draw_point",SIMPLE_SELECT:"simple_select",DIRECT_SELECT:"direct_select",STATIC:"static"},U={CREATE:"draw.create",DELETE:"draw.delete",UPDATE:"draw.update",SELECTION_CHANGE:"draw.selectionchange",MODE_CHANGE:"draw.modechange",ACTIONABLE:"draw.actionable",RENDER:"draw.render",COMBINE_FEATURES:"draw.combine",UNCOMBINE_FEATURES:"draw.uncombine"},tt={MOVE:"move",CHANGE_COORDINATES:"change_coordinates"},$={FEATURE:"feature",MIDPOINT:"midpoint",VERTEX:"vertex"},V={ACTIVE:"true",INACTIVE:"false"},it=["scrollZoom","boxZoom","dragRotate","dragPan","keyboard","doubleClickZoom","touchZoomRotate"],vt=-85,ot=Object.freeze({__proto__:null,classes:S,sources:A,cursors:O,types:k,geojsonTypes:G,modes:W,events:U,updateActions:tt,meta:$,activeStates:V,interactions:it,LAT_MIN:-90,LAT_RENDERED_MIN:vt,LAT_MAX:90,LAT_RENDERED_MAX:85,LNG_MIN:-270,LNG_MAX:270}),et={Point:0,LineString:1,MultiLineString:1,Polygon:2};function wt(T,D){var Y=et[T.geometry.type]-et[D.geometry.type];return Y===0&&T.geometry.type===G.POLYGON?T.area-D.area:Y}function J(T){return T.map(function(D){return D.geometry.type===G.POLYGON&&(D.area=l.geometry({type:G.FEATURE,property:{},geometry:D.geometry})),D}).sort(wt).map(function(D){return delete D.area,D})}function xt(T,D){return D===void 0&&(D=0),[[T.point.x-D,T.point.y-D],[T.point.x+D,T.point.y+D]]}function $t(T){if(this._items={},this._nums={},this._length=T?T.length:0,T)for(var D=0,Y=T.length;D<Y;D++)this.add(T[D]),T[D]!==void 0&&(typeof T[D]=="string"?this._items[T[D]]=D:this._nums[T[D]]=D)}$t.prototype.add=function(T){return this.has(T)||(this._length++,typeof T=="string"?this._items[T]=this._length:this._nums[T]=this._length),this},$t.prototype.delete=function(T){return this.has(T)===!1||(this._length--,delete this._items[T],delete this._nums[T]),this},$t.prototype.has=function(T){return(typeof T=="string"||typeof T=="number")&&(this._items[T]!==void 0||this._nums[T]!==void 0)},$t.prototype.values=function(){var T=this,D=[];return Object.keys(this._items).forEach(function(Y){D.push({k:Y,v:T._items[Y]})}),Object.keys(this._nums).forEach(function(Y){D.push({k:JSON.parse(Y),v:T._nums[Y]})}),D.sort(function(Y,dt){return Y.v-dt.v}).map(function(Y){return Y.k})},$t.prototype.clear=function(){return this._length=0,this._items={},this._nums={},this};var Ut=[$.FEATURE,$.MIDPOINT,$.VERTEX],Ot={click:function(T,D,Y){return te(T,D,Y,Y.options.clickBuffer)},touch:function(T,D,Y){return te(T,D,Y,Y.options.touchBuffer)}};function te(T,D,Y,dt){if(Y.map===null)return[];var It=T?xt(T,dt):D,Ct={};Y.options.styles&&(Ct.layers=Y.options.styles.map(function(we){return we.id}).filter(function(we){return Y.map.getLayer(we)!=null}));var Dt=Y.map.queryRenderedFeatures(It,Ct).filter(function(we){return Ut.indexOf(we.properties.meta)!==-1}),re=new $t,ae=[];return Dt.forEach(function(we){var Ee=we.properties.id;re.has(Ee)||(re.add(Ee),ae.push(we))}),J(ae)}function ye(T,D){var Y=Ot.click(T,null,D),dt={mouse:O.NONE};return Y[0]&&(dt.mouse=Y[0].properties.active===V.ACTIVE?O.MOVE:O.POINTER,dt.feature=Y[0].properties.meta),D.events.currentModeName().indexOf("draw")!==-1&&(dt.mouse=O.ADD),D.ui.queueMapClasses(dt),D.ui.updateMapClasses(),Y[0]}function Me(T,D){var Y=T.x-D.x,dt=T.y-D.y;return Math.sqrt(Y*Y+dt*dt)}function ir(T,D,Y){Y===void 0&&(Y={});var dt=Y.fineTolerance!=null?Y.fineTolerance:4,It=Y.grossTolerance!=null?Y.grossTolerance:12,Ct=Y.interval!=null?Y.interval:500;T.point=T.point||D.point,T.time=T.time||D.time;var Dt=Me(T.point,D.point);return Dt<dt||Dt<It&&D.time-T.time<Ct}function xr(T,D,Y){Y===void 0&&(Y={});var dt=Y.tolerance!=null?Y.tolerance:25,It=Y.interval!=null?Y.interval:250;return T.point=T.point||D.point,T.time=T.time||D.time,Me(T.point,D.point)<dt&&D.time-T.time<It}var _r={exports:{}},kr=_r.exports=function(T,D){if(D||(D=16),T===void 0&&(T=128),T<=0)return"0";for(var Y=Math.log(Math.pow(2,T))/Math.log(D),dt=2;Y===1/0;dt*=2)Y=Math.log(Math.pow(2,T/dt))/Math.log(D)*dt;var It=Y-Math.floor(Y),Ct="";for(dt=0;dt<Math.floor(Y);dt++)Ct=Math.floor(Math.random()*D).toString(D)+Ct;if(It){var Dt=Math.pow(D,It);Ct=Math.floor(Math.random()*Dt).toString(D)+Ct}var re=parseInt(Ct,D);return re!==1/0&&re>=Math.pow(2,T)?kr(T,D):Ct};kr.rack=function(T,D,Y){var dt=function(Ct){var Dt=0;do{if(Dt++>10){if(!Y)throw new Error("too many ID collisions, use more bits");T+=Y}var re=kr(T,D)}while(Object.hasOwnProperty.call(It,re));return It[re]=Ct,re},It=dt.hats={};return dt.get=function(Ct){return dt.hats[Ct]},dt.set=function(Ct,Dt){return dt.hats[Ct]=Dt,dt},dt.bits=T||128,dt.base=D||16,dt};var vr=n(_r.exports),ue=function(T,D){this.ctx=T,this.properties=D.properties||{},this.coordinates=D.geometry.coordinates,this.id=D.id||vr(),this.type=D.geometry.type};ue.prototype.changed=function(){this.ctx.store.featureChanged(this.id)},ue.prototype.incomingCoords=function(T){this.setCoordinates(T)},ue.prototype.setCoordinates=function(T){this.coordinates=T,this.changed()},ue.prototype.getCoordinates=function(){return JSON.parse(JSON.stringify(this.coordinates))},ue.prototype.setProperty=function(T,D){this.properties[T]=D},ue.prototype.toGeoJSON=function(){return JSON.parse(JSON.stringify({id:this.id,type:G.FEATURE,properties:this.properties,geometry:{coordinates:this.getCoordinates(),type:this.type}}))},ue.prototype.internal=function(T){var D={id:this.id,meta:$.FEATURE,"meta:type":this.type,active:V.INACTIVE,mode:T};if(this.ctx.options.userProperties)for(var Y in this.properties)D["user_"+Y]=this.properties[Y];return{type:G.FEATURE,properties:D,geometry:{coordinates:this.getCoordinates(),type:this.type}}};var nr=function(T,D){ue.call(this,T,D)};(nr.prototype=Object.create(ue.prototype)).isValid=function(){return typeof this.coordinates[0]=="number"&&typeof this.coordinates[1]=="number"},nr.prototype.updateCoordinate=function(T,D,Y){this.coordinates=arguments.length===3?[D,Y]:[T,D],this.changed()},nr.prototype.getCoordinate=function(){return this.getCoordinates()};var br=function(T,D){ue.call(this,T,D)};(br.prototype=Object.create(ue.prototype)).isValid=function(){return this.coordinates.length>1},br.prototype.addCoordinate=function(T,D,Y){this.changed();var dt=parseInt(T,10);this.coordinates.splice(dt,0,[D,Y])},br.prototype.getCoordinate=function(T){var D=parseInt(T,10);return JSON.parse(JSON.stringify(this.coordinates[D]))},br.prototype.removeCoordinate=function(T){this.changed(),this.coordinates.splice(parseInt(T,10),1)},br.prototype.updateCoordinate=function(T,D,Y){var dt=parseInt(T,10);this.coordinates[dt]=[D,Y],this.changed()};var jr=function(T,D){ue.call(this,T,D),this.coordinates=this.coordinates.map(function(Y){return Y.slice(0,-1)})};(jr.prototype=Object.create(ue.prototype)).isValid=function(){return this.coordinates.length!==0&&this.coordinates.every(function(T){return T.length>2})},jr.prototype.incomingCoords=function(T){this.coordinates=T.map(function(D){return D.slice(0,-1)}),this.changed()},jr.prototype.setCoordinates=function(T){this.coordinates=T,this.changed()},jr.prototype.addCoordinate=function(T,D,Y){this.changed();var dt=T.split(".").map(function(It){return parseInt(It,10)});this.coordinates[dt[0]].splice(dt[1],0,[D,Y])},jr.prototype.removeCoordinate=function(T){this.changed();var D=T.split(".").map(function(dt){return parseInt(dt,10)}),Y=this.coordinates[D[0]];Y&&(Y.splice(D[1],1),Y.length<3&&this.coordinates.splice(D[0],1))},jr.prototype.getCoordinate=function(T){var D=T.split(".").map(function(dt){return parseInt(dt,10)}),Y=this.coordinates[D[0]];return JSON.parse(JSON.stringify(Y[D[1]]))},jr.prototype.getCoordinates=function(){return this.coordinates.map(function(T){return T.concat([T[0]])})},jr.prototype.updateCoordinate=function(T,D,Y){this.changed();var dt=T.split("."),It=parseInt(dt[0],10),Ct=parseInt(dt[1],10);this.coordinates[It]===void 0&&(this.coordinates[It]=[]),this.coordinates[It][Ct]=[D,Y]};var ln={MultiPoint:nr,MultiLineString:br,MultiPolygon:jr},co=function(T,D,Y,dt,It){var Ct=Y.split("."),Dt=parseInt(Ct[0],10),re=Ct[1]?Ct.slice(1).join("."):null;return T[Dt][D](re,dt,It)},hn=function(T,D){if(ue.call(this,T,D),delete this.coordinates,this.model=ln[D.geometry.type],this.model===void 0)throw new TypeError(D.geometry.type+" is not a valid type");this.features=this._coordinatesToFeatures(D.geometry.coordinates)};function Ye(T){this.map=T.map,this.drawConfig=JSON.parse(JSON.stringify(T.options||{})),this._ctx=T}(hn.prototype=Object.create(ue.prototype))._coordinatesToFeatures=function(T){var D=this,Y=this.model.bind(this);return T.map(function(dt){return new Y(D.ctx,{id:vr(),type:G.FEATURE,properties:{},geometry:{coordinates:dt,type:D.type.replace("Multi","")}})})},hn.prototype.isValid=function(){return this.features.every(function(T){return T.isValid()})},hn.prototype.setCoordinates=function(T){this.features=this._coordinatesToFeatures(T),this.changed()},hn.prototype.getCoordinate=function(T){return co(this.features,"getCoordinate",T)},hn.prototype.getCoordinates=function(){return JSON.parse(JSON.stringify(this.features.map(function(T){return T.type===G.POLYGON?T.getCoordinates():T.coordinates})))},hn.prototype.updateCoordinate=function(T,D,Y){co(this.features,"updateCoordinate",T,D,Y),this.changed()},hn.prototype.addCoordinate=function(T,D,Y){co(this.features,"addCoordinate",T,D,Y),this.changed()},hn.prototype.removeCoordinate=function(T){co(this.features,"removeCoordinate",T),this.changed()},hn.prototype.getFeatures=function(){return this.features},Ye.prototype.setSelected=function(T){return this._ctx.store.setSelected(T)},Ye.prototype.setSelectedCoordinates=function(T){var D=this;this._ctx.store.setSelectedCoordinates(T),T.reduce(function(Y,dt){return Y[dt.feature_id]===void 0&&(Y[dt.feature_id]=!0,D._ctx.store.get(dt.feature_id).changed()),Y},{})},Ye.prototype.getSelected=function(){return this._ctx.store.getSelected()},Ye.prototype.getSelectedIds=function(){return this._ctx.store.getSelectedIds()},Ye.prototype.isSelected=function(T){return this._ctx.store.isSelected(T)},Ye.prototype.getFeature=function(T){return this._ctx.store.get(T)},Ye.prototype.select=function(T){return this._ctx.store.select(T)},Ye.prototype.deselect=function(T){return this._ctx.store.deselect(T)},Ye.prototype.deleteFeature=function(T,D){return D===void 0&&(D={}),this._ctx.store.delete(T,D)},Ye.prototype.addFeature=function(T){return this._ctx.store.add(T)},Ye.prototype.clearSelectedFeatures=function(){return this._ctx.store.clearSelected()},Ye.prototype.clearSelectedCoordinates=function(){return this._ctx.store.clearSelectedCoordinates()},Ye.prototype.setActionableState=function(T){T===void 0&&(T={});var D={trash:T.trash||!1,combineFeatures:T.combineFeatures||!1,uncombineFeatures:T.uncombineFeatures||!1};return this._ctx.events.actionable(D)},Ye.prototype.changeMode=function(T,D,Y){return D===void 0&&(D={}),Y===void 0&&(Y={}),this._ctx.events.changeMode(T,D,Y)},Ye.prototype.updateUIClasses=function(T){return this._ctx.ui.queueMapClasses(T)},Ye.prototype.activateUIButton=function(T){return this._ctx.ui.setActiveButton(T)},Ye.prototype.featuresAt=function(T,D,Y){if(Y===void 0&&(Y="click"),Y!=="click"&&Y!=="touch")throw new Error("invalid buffer type");return Ot[Y](T,D,this._ctx)},Ye.prototype.newFeature=function(T){var D=T.geometry.type;return D===G.POINT?new nr(this._ctx,T):D===G.LINE_STRING?new br(this._ctx,T):D===G.POLYGON?new jr(this._ctx,T):new hn(this._ctx,T)},Ye.prototype.isInstanceOf=function(T,D){if(T===G.POINT)return D instanceof nr;if(T===G.LINE_STRING)return D instanceof br;if(T===G.POLYGON)return D instanceof jr;if(T==="MultiFeature")return D instanceof hn;throw new Error("Unknown feature class: "+T)},Ye.prototype.doRender=function(T){return this._ctx.store.featureChanged(T)},Ye.prototype.onSetup=function(){},Ye.prototype.onDrag=function(){},Ye.prototype.onClick=function(){},Ye.prototype.onMouseMove=function(){},Ye.prototype.onMouseDown=function(){},Ye.prototype.onMouseUp=function(){},Ye.prototype.onMouseOut=function(){},Ye.prototype.onKeyUp=function(){},Ye.prototype.onKeyDown=function(){},Ye.prototype.onTouchStart=function(){},Ye.prototype.onTouchMove=function(){},Ye.prototype.onTouchEnd=function(){},Ye.prototype.onTap=function(){},Ye.prototype.onStop=function(){},Ye.prototype.onTrash=function(){},Ye.prototype.onCombineFeature=function(){},Ye.prototype.onUncombineFeature=function(){},Ye.prototype.toDisplayFeatures=function(){throw new Error("You must overwrite toDisplayFeatures")};var na={drag:"onDrag",click:"onClick",mousemove:"onMouseMove",mousedown:"onMouseDown",mouseup:"onMouseUp",mouseout:"onMouseOut",keyup:"onKeyUp",keydown:"onKeyDown",touchstart:"onTouchStart",touchmove:"onTouchMove",touchend:"onTouchEnd",tap:"onTap"},ls=Object.keys(na);function Io(T){var D=Object.keys(T);return function(Y,dt){dt===void 0&&(dt={});var It={},Ct=D.reduce(function(Dt,re){return Dt[re]=T[re],Dt},new Ye(Y));return{start:function(){var Dt=this;It=Ct.onSetup(dt),ls.forEach(function(re){var ae,we=na[re],Ee=function(){return!1};T[we]&&(Ee=function(){return!0}),Dt.on(re,Ee,(ae=we,function(_e){return Ct[ae](It,_e)}))})},stop:function(){Ct.onStop(It)},trash:function(){Ct.onTrash(It)},combineFeatures:function(){Ct.onCombineFeatures(It)},uncombineFeatures:function(){Ct.onUncombineFeatures(It)},render:function(Dt,re){Ct.toDisplayFeatures(It,Dt,re)}}}}function cr(T){return[].concat(T).filter(function(D){return D!==void 0})}function pn(){var T=this;if(!(T.ctx.map&&T.ctx.map.getSource(A.HOT)!==void 0))return ae();var D=T.ctx.events.currentModeName();T.ctx.ui.queueMapClasses({mode:D});var Y=[],dt=[];T.isDirty?dt=T.getAllIds():(Y=T.getChangedIds().filter(function(we){return T.get(we)!==void 0}),dt=T.sources.hot.filter(function(we){return we.properties.id&&Y.indexOf(we.properties.id)===-1&&T.get(we.properties.id)!==void 0}).map(function(we){return we.properties.id})),T.sources.hot=[];var It=T.sources.cold.length;T.sources.cold=T.isDirty?[]:T.sources.cold.filter(function(we){var Ee=we.properties.id||we.properties.parent;return Y.indexOf(Ee)===-1});var Ct=It!==T.sources.cold.length||dt.length>0;function Dt(we,Ee){var _e=T.get(we).internal(D);T.ctx.events.currentModeRender(_e,function(sr){T.sources[Ee].push(sr)})}if(Y.forEach(function(we){return Dt(we,"hot")}),dt.forEach(function(we){return Dt(we,"cold")}),Ct&&T.ctx.map.getSource(A.COLD).setData({type:G.FEATURE_COLLECTION,features:T.sources.cold}),T.ctx.map.getSource(A.HOT).setData({type:G.FEATURE_COLLECTION,features:T.sources.hot}),T._emitSelectionChange&&(T.ctx.map.fire(U.SELECTION_CHANGE,{features:T.getSelected().map(function(we){return we.toGeoJSON()}),points:T.getSelectedCoordinates().map(function(we){return{type:G.FEATURE,properties:{},geometry:{type:G.POINT,coordinates:we.coordinates}}})}),T._emitSelectionChange=!1),T._deletedFeaturesToEmit.length){var re=T._deletedFeaturesToEmit.map(function(we){return we.toGeoJSON()});T._deletedFeaturesToEmit=[],T.ctx.map.fire(U.DELETE,{features:re})}function ae(){T.isDirty=!1,T.clearChangedIds()}ae(),T.ctx.map.fire(U.RENDER,{})}function Re(T){var D,Y=this;this._features={},this._featureIds=new $t,this._selectedFeatureIds=new $t,this._selectedCoordinates=[],this._changedFeatureIds=new $t,this._deletedFeaturesToEmit=[],this._emitSelectionChange=!1,this._mapInitialConfig={},this.ctx=T,this.sources={hot:[],cold:[]},this.render=function(){D||(D=requestAnimationFrame(function(){D=null,pn.call(Y)}))},this.isDirty=!1}function us(T,D){var Y=T._selectedCoordinates.filter(function(dt){return T._selectedFeatureIds.has(dt.feature_id)});T._selectedCoordinates.length===Y.length||D.silent||(T._emitSelectionChange=!0),T._selectedCoordinates=Y}Re.prototype.createRenderBatch=function(){var T=this,D=this.render,Y=0;return this.render=function(){Y++},function(){T.render=D,Y>0&&T.render()}},Re.prototype.setDirty=function(){return this.isDirty=!0,this},Re.prototype.featureChanged=function(T){return this._changedFeatureIds.add(T),this},Re.prototype.getChangedIds=function(){return this._changedFeatureIds.values()},Re.prototype.clearChangedIds=function(){return this._changedFeatureIds.clear(),this},Re.prototype.getAllIds=function(){return this._featureIds.values()},Re.prototype.add=function(T){return this.featureChanged(T.id),this._features[T.id]=T,this._featureIds.add(T.id),this},Re.prototype.delete=function(T,D){var Y=this;return D===void 0&&(D={}),cr(T).forEach(function(dt){Y._featureIds.has(dt)&&(Y._featureIds.delete(dt),Y._selectedFeatureIds.delete(dt),D.silent||Y._deletedFeaturesToEmit.indexOf(Y._features[dt])===-1&&Y._deletedFeaturesToEmit.push(Y._features[dt]),delete Y._features[dt],Y.isDirty=!0)}),us(this,D),this},Re.prototype.get=function(T){return this._features[T]},Re.prototype.getAll=function(){var T=this;return Object.keys(this._features).map(function(D){return T._features[D]})},Re.prototype.select=function(T,D){var Y=this;return D===void 0&&(D={}),cr(T).forEach(function(dt){Y._selectedFeatureIds.has(dt)||(Y._selectedFeatureIds.add(dt),Y._changedFeatureIds.add(dt),D.silent||(Y._emitSelectionChange=!0))}),this},Re.prototype.deselect=function(T,D){var Y=this;return D===void 0&&(D={}),cr(T).forEach(function(dt){Y._selectedFeatureIds.has(dt)&&(Y._selectedFeatureIds.delete(dt),Y._changedFeatureIds.add(dt),D.silent||(Y._emitSelectionChange=!0))}),us(this,D),this},Re.prototype.clearSelected=function(T){return T===void 0&&(T={}),this.deselect(this._selectedFeatureIds.values(),{silent:T.silent}),this},Re.prototype.setSelected=function(T,D){var Y=this;return D===void 0&&(D={}),T=cr(T),this.deselect(this._selectedFeatureIds.values().filter(function(dt){return T.indexOf(dt)===-1}),{silent:D.silent}),this.select(T.filter(function(dt){return!Y._selectedFeatureIds.has(dt)}),{silent:D.silent}),this},Re.prototype.setSelectedCoordinates=function(T){return this._selectedCoordinates=T,this._emitSelectionChange=!0,this},Re.prototype.clearSelectedCoordinates=function(){return this._selectedCoordinates=[],this._emitSelectionChange=!0,this},Re.prototype.getSelectedIds=function(){return this._selectedFeatureIds.values()},Re.prototype.getSelected=function(){var T=this;return this._selectedFeatureIds.values().map(function(D){return T.get(D)})},Re.prototype.getSelectedCoordinates=function(){var T=this;return this._selectedCoordinates.map(function(D){return{coordinates:T.get(D.feature_id).getCoordinate(D.coord_path)}})},Re.prototype.isSelected=function(T){return this._selectedFeatureIds.has(T)},Re.prototype.setFeatureProperty=function(T,D,Y){this.get(T).setProperty(D,Y),this.featureChanged(T)},Re.prototype.storeMapConfig=function(){var T=this;it.forEach(function(D){T.ctx.map[D]&&(T._mapInitialConfig[D]=T.ctx.map[D].isEnabled())})},Re.prototype.restoreMapConfig=function(){var T=this;Object.keys(this._mapInitialConfig).forEach(function(D){T._mapInitialConfig[D]?T.ctx.map[D].enable():T.ctx.map[D].disable()})},Re.prototype.getInitialConfigValue=function(T){return this._mapInitialConfig[T]===void 0||this._mapInitialConfig[T]};var _i=function(){for(var T=arguments,D={},Y=0;Y<arguments.length;Y++){var dt=T[Y];for(var It in dt)Kr.call(dt,It)&&(D[It]=dt[It])}return D},Kr=Object.prototype.hasOwnProperty,Gt=n(_i),vi=["mode","feature","mouse"];function xi(T){var D=null,Y=null,dt={onRemove:function(){return T.map.off("load",dt.connect),clearInterval(Y),dt.removeLayers(),T.store.restoreMapConfig(),T.ui.removeButtons(),T.events.removeEventListeners(),T.ui.clearMapClasses(),T.boxZoomInitial&&T.map.boxZoom.enable(),T.map=null,T.container=null,T.store=null,D&&D.parentNode&&D.parentNode.removeChild(D),D=null,this},connect:function(){T.map.off("load",dt.connect),clearInterval(Y),dt.addLayers(),T.store.storeMapConfig(),T.events.addEventListeners()},onAdd:function(It){var Ct=It.fire;return It.fire=function(Dt,re){var ae=arguments;return Ct.length===1&&arguments.length!==1&&(ae=[Gt({},{type:Dt},re)]),Ct.apply(It,ae)},T.map=It,T.events=function(Dt){var re=Object.keys(Dt.options.modes).reduce(function(Jt,ze){return Jt[ze]=Io(Dt.options.modes[ze]),Jt},{}),ae={},we={},Ee={},_e=null,sr=null;Ee.drag=function(Jt,ze){ze({point:Jt.point,time:new Date().getTime()})?(Dt.ui.queueMapClasses({mouse:O.DRAG}),sr.drag(Jt)):Jt.originalEvent.stopPropagation()},Ee.mousedrag=function(Jt){Ee.drag(Jt,function(ze){return!ir(ae,ze)})},Ee.touchdrag=function(Jt){Ee.drag(Jt,function(ze){return!xr(we,ze)})},Ee.mousemove=function(Jt){if((Jt.originalEvent.buttons!==void 0?Jt.originalEvent.buttons:Jt.originalEvent.which)===1)return Ee.mousedrag(Jt);var ze=ye(Jt,Dt);Jt.featureTarget=ze,sr.mousemove(Jt)},Ee.mousedown=function(Jt){ae={time:new Date().getTime(),point:Jt.point};var ze=ye(Jt,Dt);Jt.featureTarget=ze,sr.mousedown(Jt)},Ee.mouseup=function(Jt){var ze=ye(Jt,Dt);Jt.featureTarget=ze,ir(ae,{point:Jt.point,time:new Date().getTime()})?sr.click(Jt):sr.mouseup(Jt)},Ee.mouseout=function(Jt){sr.mouseout(Jt)},Ee.touchstart=function(Jt){if(Dt.options.touchEnabled){we={time:new Date().getTime(),point:Jt.point};var ze=Ot.touch(Jt,null,Dt)[0];Jt.featureTarget=ze,sr.touchstart(Jt)}},Ee.touchmove=function(Jt){if(Dt.options.touchEnabled)return sr.touchmove(Jt),Ee.touchdrag(Jt)},Ee.touchend=function(Jt){if(Jt.originalEvent.preventDefault(),Dt.options.touchEnabled){var ze=Ot.touch(Jt,null,Dt)[0];Jt.featureTarget=ze,xr(we,{time:new Date().getTime(),point:Jt.point})?sr.tap(Jt):sr.touchend(Jt)}};var Rn=function(Jt){return!(Jt===8||Jt===46||Jt>=48&&Jt<=57)};function ur(Jt,ze,tn){tn===void 0&&(tn={}),sr.stop();var Dn=re[Jt];if(Dn===void 0)throw new Error(Jt+" is not valid");_e=Jt;var Un=Dn(Dt,ze);sr=r(Un,Dt),tn.silent||Dt.map.fire(U.MODE_CHANGE,{mode:Jt}),Dt.store.setDirty(),Dt.store.render()}Ee.keydown=function(Jt){(Jt.srcElement||Jt.target).classList.contains("mapboxgl-canvas")&&(Jt.keyCode!==8&&Jt.keyCode!==46||!Dt.options.controls.trash?Rn(Jt.keyCode)?sr.keydown(Jt):Jt.keyCode===49&&Dt.options.controls.point?ur(W.DRAW_POINT):Jt.keyCode===50&&Dt.options.controls.line_string?ur(W.DRAW_LINE_STRING):Jt.keyCode===51&&Dt.options.controls.polygon&&ur(W.DRAW_POLYGON):(Jt.preventDefault(),sr.trash()))},Ee.keyup=function(Jt){Rn(Jt.keyCode)&&sr.keyup(Jt)},Ee.zoomend=function(){Dt.store.changeZoom()},Ee.data=function(Jt){if(Jt.dataType==="style"){var ze=Dt.setup,tn=Dt.map,Dn=Dt.options,Un=Dt.store;Dn.styles.some(function(Po){return tn.getLayer(Po.id)})||(ze.addLayers(),Un.setDirty(),Un.render())}};var Kn={trash:!1,combineFeatures:!1,uncombineFeatures:!1};return{start:function(){_e=Dt.options.defaultMode,sr=r(re[_e](Dt),Dt)},changeMode:ur,actionable:function(Jt){var ze=!1;Object.keys(Jt).forEach(function(tn){if(Kn[tn]===void 0)throw new Error("Invalid action type");Kn[tn]!==Jt[tn]&&(ze=!0),Kn[tn]=Jt[tn]}),ze&&Dt.map.fire(U.ACTIONABLE,{actions:Kn})},currentModeName:function(){return _e},currentModeRender:function(Jt,ze){return sr.render(Jt,ze)},fire:function(Jt,ze){Ee[Jt]&&Ee[Jt](ze)},addEventListeners:function(){Dt.map.on("mousemove",Ee.mousemove),Dt.map.on("mousedown",Ee.mousedown),Dt.map.on("mouseup",Ee.mouseup),Dt.map.on("data",Ee.data),Dt.map.on("touchmove",Ee.touchmove),Dt.map.on("touchstart",Ee.touchstart),Dt.map.on("touchend",Ee.touchend),Dt.container.addEventListener("mouseout",Ee.mouseout),Dt.options.keybindings&&(Dt.container.addEventListener("keydown",Ee.keydown),Dt.container.addEventListener("keyup",Ee.keyup))},removeEventListeners:function(){Dt.map.off("mousemove",Ee.mousemove),Dt.map.off("mousedown",Ee.mousedown),Dt.map.off("mouseup",Ee.mouseup),Dt.map.off("data",Ee.data),Dt.map.off("touchmove",Ee.touchmove),Dt.map.off("touchstart",Ee.touchstart),Dt.map.off("touchend",Ee.touchend),Dt.container.removeEventListener("mouseout",Ee.mouseout),Dt.options.keybindings&&(Dt.container.removeEventListener("keydown",Ee.keydown),Dt.container.removeEventListener("keyup",Ee.keyup))},trash:function(Jt){sr.trash(Jt)},combineFeatures:function(){sr.combineFeatures()},uncombineFeatures:function(){sr.uncombineFeatures()},getMode:function(){return _e}}}(T),T.ui=function(Dt){var re={},ae=null,we={mode:null,feature:null,mouse:null},Ee={mode:null,feature:null,mouse:null};function _e(Jt){Ee=Gt(Ee,Jt)}function sr(){var Jt,ze;if(Dt.container){var tn=[],Dn=[];vi.forEach(function(Un){Ee[Un]!==we[Un]&&(tn.push(Un+"-"+we[Un]),Ee[Un]!==null&&Dn.push(Un+"-"+Ee[Un]))}),tn.length>0&&(Jt=Dt.container.classList).remove.apply(Jt,tn),Dn.length>0&&(ze=Dt.container.classList).add.apply(ze,Dn),we=Gt(we,Ee)}}function Rn(Jt,ze){ze===void 0&&(ze={});var tn=document.createElement("button");return tn.className=S.CONTROL_BUTTON+" "+ze.className,tn.setAttribute("title",ze.title),ze.container.appendChild(tn),tn.addEventListener("click",function(Dn){if(Dn.preventDefault(),Dn.stopPropagation(),Dn.target===ae)return ur(),void ze.onDeactivate();Kn(Jt),ze.onActivate()},!0),tn}function ur(){ae&&(ae.classList.remove(S.ACTIVE_BUTTON),ae=null)}function Kn(Jt){ur();var ze=re[Jt];ze&&ze&&Jt!=="trash"&&(ze.classList.add(S.ACTIVE_BUTTON),ae=ze)}return{setActiveButton:Kn,queueMapClasses:_e,updateMapClasses:sr,clearMapClasses:function(){_e({mode:null,feature:null,mouse:null}),sr()},addButtons:function(){var Jt=Dt.options.controls,ze=document.createElement("div");return ze.className=S.CONTROL_GROUP+" "+S.CONTROL_BASE,Jt&&(Jt[k.LINE]&&(re[k.LINE]=Rn(k.LINE,{container:ze,className:S.CONTROL_BUTTON_LINE,title:"LineString tool "+(Dt.options.keybindings?"(l)":""),onActivate:function(){return Dt.events.changeMode(W.DRAW_LINE_STRING)},onDeactivate:function(){return Dt.events.trash()}})),Jt[k.POLYGON]&&(re[k.POLYGON]=Rn(k.POLYGON,{container:ze,className:S.CONTROL_BUTTON_POLYGON,title:"Polygon tool "+(Dt.options.keybindings?"(p)":""),onActivate:function(){return Dt.events.changeMode(W.DRAW_POLYGON)},onDeactivate:function(){return Dt.events.trash()}})),Jt[k.POINT]&&(re[k.POINT]=Rn(k.POINT,{container:ze,className:S.CONTROL_BUTTON_POINT,title:"Marker tool "+(Dt.options.keybindings?"(m)":""),onActivate:function(){return Dt.events.changeMode(W.DRAW_POINT)},onDeactivate:function(){return Dt.events.trash()}})),Jt.trash&&(re.trash=Rn("trash",{container:ze,className:S.CONTROL_BUTTON_TRASH,title:"Delete",onActivate:function(){Dt.events.trash()}})),Jt.combine_features&&(re.combine_features=Rn("combineFeatures",{container:ze,className:S.CONTROL_BUTTON_COMBINE_FEATURES,title:"Combine",onActivate:function(){Dt.events.combineFeatures()}})),Jt.uncombine_features&&(re.uncombine_features=Rn("uncombineFeatures",{container:ze,className:S.CONTROL_BUTTON_UNCOMBINE_FEATURES,title:"Uncombine",onActivate:function(){Dt.events.uncombineFeatures()}}))),ze},removeButtons:function(){Object.keys(re).forEach(function(Jt){var ze=re[Jt];ze.parentNode&&ze.parentNode.removeChild(ze),delete re[Jt]})}}}(T),T.container=It.getContainer(),T.store=new Re(T),D=T.ui.addButtons(),T.options.boxSelect&&(T.boxZoomInitial=It.boxZoom.isEnabled(),It.boxZoom.disable(),It.dragPan.disable(),It.dragPan.enable()),It.loaded()?dt.connect():(It.on("load",dt.connect),Y=setInterval(function(){It.loaded()&&dt.connect()},16)),T.events.start(),D},addLayers:function(){T.map.addSource(A.COLD,{data:{type:G.FEATURE_COLLECTION,features:[]},type:"geojson"}),T.map.addSource(A.HOT,{data:{type:G.FEATURE_COLLECTION,features:[]},type:"geojson"}),T.options.styles.forEach(function(It){T.map.addLayer(It)}),T.store.setDirty(!0),T.store.render()},removeLayers:function(){T.options.styles.forEach(function(It){T.map.getLayer(It.id)&&T.map.removeLayer(It.id)}),T.map.getSource(A.COLD)&&T.map.removeSource(A.COLD),T.map.getSource(A.HOT)&&T.map.removeSource(A.HOT)}};return T.setup=dt,dt}var Or=[{id:"gl-draw-polygon-fill-inactive",type:"fill",filter:["all",["==","active","false"],["==","$type","Polygon"],["!=","mode","static"]],paint:{"fill-color":"#3bb2d0","fill-outline-color":"#3bb2d0","fill-opacity":.1}},{id:"gl-draw-polygon-fill-active",type:"fill",filter:["all",["==","active","true"],["==","$type","Polygon"]],paint:{"fill-color":"#fbb03b","fill-outline-color":"#fbb03b","fill-opacity":.1}},{id:"gl-draw-polygon-midpoint",type:"circle",filter:["all",["==","$type","Point"],["==","meta","midpoint"]],paint:{"circle-radius":3,"circle-color":"#fbb03b"}},{id:"gl-draw-polygon-stroke-inactive",type:"line",filter:["all",["==","active","false"],["==","$type","Polygon"],["!=","mode","static"]],layout:{"line-cap":"round","line-join":"round"},paint:{"line-color":"#3bb2d0","line-width":2}},{id:"gl-draw-polygon-stroke-active",type:"line",filter:["all",["==","active","true"],["==","$type","Polygon"]],layout:{"line-cap":"round","line-join":"round"},paint:{"line-color":"#fbb03b","line-dasharray":[.2,2],"line-width":2}},{id:"gl-draw-line-inactive",type:"line",filter:["all",["==","active","false"],["==","$type","LineString"],["!=","mode","static"]],layout:{"line-cap":"round","line-join":"round"},paint:{"line-color":"#3bb2d0","line-width":2}},{id:"gl-draw-line-active",type:"line",filter:["all",["==","$type","LineString"],["==","active","true"]],layout:{"line-cap":"round","line-join":"round"},paint:{"line-color":"#fbb03b","line-dasharray":[.2,2],"line-width":2}},{id:"gl-draw-polygon-and-line-vertex-stroke-inactive",type:"circle",filter:["all",["==","meta","vertex"],["==","$type","Point"],["!=","mode","static"]],paint:{"circle-radius":5,"circle-color":"#fff"}},{id:"gl-draw-polygon-and-line-vertex-inactive",type:"circle",filter:["all",["==","meta","vertex"],["==","$type","Point"],["!=","mode","static"]],paint:{"circle-radius":3,"circle-color":"#fbb03b"}},{id:"gl-draw-point-point-stroke-inactive",type:"circle",filter:["all",["==","active","false"],["==","$type","Point"],["==","meta","feature"],["!=","mode","static"]],paint:{"circle-radius":5,"circle-opacity":1,"circle-color":"#fff"}},{id:"gl-draw-point-inactive",type:"circle",filter:["all",["==","active","false"],["==","$type","Point"],["==","meta","feature"],["!=","mode","static"]],paint:{"circle-radius":3,"circle-color":"#3bb2d0"}},{id:"gl-draw-point-stroke-active",type:"circle",filter:["all",["==","$type","Point"],["==","active","true"],["!=","meta","midpoint"]],paint:{"circle-radius":7,"circle-color":"#fff"}},{id:"gl-draw-point-active",type:"circle",filter:["all",["==","$type","Point"],["!=","meta","midpoint"],["==","active","true"]],paint:{"circle-radius":5,"circle-color":"#fbb03b"}},{id:"gl-draw-polygon-fill-static",type:"fill",filter:["all",["==","mode","static"],["==","$type","Polygon"]],paint:{"fill-color":"#404040","fill-outline-color":"#404040","fill-opacity":.1}},{id:"gl-draw-polygon-stroke-static",type:"line",filter:["all",["==","mode","static"],["==","$type","Polygon"]],layout:{"line-cap":"round","line-join":"round"},paint:{"line-color":"#404040","line-width":2}},{id:"gl-draw-line-static",type:"line",filter:["all",["==","mode","static"],["==","$type","LineString"]],layout:{"line-cap":"round","line-join":"round"},paint:{"line-color":"#404040","line-width":2}},{id:"gl-draw-point-static",type:"circle",filter:["all",["==","mode","static"],["==","$type","Point"]],paint:{"circle-radius":5,"circle-color":"#404040"}}];function yr(T){return function(D){var Y=D.featureTarget;return!!Y&&!!Y.properties&&Y.properties.meta===T}}function ho(T){return!!T.originalEvent&&!!T.originalEvent.shiftKey&&T.originalEvent.button===0}function Co(T){return!!T.featureTarget&&!!T.featureTarget.properties&&T.featureTarget.properties.active===V.ACTIVE&&T.featureTarget.properties.meta===$.FEATURE}function ai(T){return!!T.featureTarget&&!!T.featureTarget.properties&&T.featureTarget.properties.active===V.INACTIVE&&T.featureTarget.properties.meta===$.FEATURE}function ia(T){return T.featureTarget===void 0}function cs(T){return!!T.featureTarget&&!!T.featureTarget.properties&&T.featureTarget.properties.meta===$.FEATURE}function Ji(T){var D=T.featureTarget;return!!D&&!!D.properties&&D.properties.meta===$.VERTEX}function hs(T){return!!T.originalEvent&&T.originalEvent.shiftKey===!0}function oe(T){return T.keyCode===27}function po(T){return T.keyCode===13}var In=Object.freeze({__proto__:null,isOfMetaType:yr,isShiftMousedown:ho,isActiveFeature:Co,isInactiveFeature:ai,noTarget:ia,isFeature:cs,isVertex:Ji,isShiftDown:hs,isEscapeKey:oe,isEnterKey:po,isTrue:function(){return!0}}),Ls=Ri;function Ri(T,D){this.x=T,this.y=D}Ri.prototype={clone:function(){return new Ri(this.x,this.y)},add:function(T){return this.clone()._add(T)},sub:function(T){return this.clone()._sub(T)},multByPoint:function(T){return this.clone()._multByPoint(T)},divByPoint:function(T){return this.clone()._divByPoint(T)},mult:function(T){return this.clone()._mult(T)},div:function(T){return this.clone()._div(T)},rotate:function(T){return this.clone()._rotate(T)},rotateAround:function(T,D){return this.clone()._rotateAround(T,D)},matMult:function(T){return this.clone()._matMult(T)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(T){return this.x===T.x&&this.y===T.y},dist:function(T){return Math.sqrt(this.distSqr(T))},distSqr:function(T){var D=T.x-this.x,Y=T.y-this.y;return D*D+Y*Y},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(T){return Math.atan2(this.y-T.y,this.x-T.x)},angleWith:function(T){return this.angleWithSep(T.x,T.y)},angleWithSep:function(T,D){return Math.atan2(this.x*D-this.y*T,this.x*T+this.y*D)},_matMult:function(T){var D=T[0]*this.x+T[1]*this.y,Y=T[2]*this.x+T[3]*this.y;return this.x=D,this.y=Y,this},_add:function(T){return this.x+=T.x,this.y+=T.y,this},_sub:function(T){return this.x-=T.x,this.y-=T.y,this},_mult:function(T){return this.x*=T,this.y*=T,this},_div:function(T){return this.x/=T,this.y/=T,this},_multByPoint:function(T){return this.x*=T.x,this.y*=T.y,this},_divByPoint:function(T){return this.x/=T.x,this.y/=T.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var T=this.y;return this.y=this.x,this.x=-T,this},_rotate:function(T){var D=Math.cos(T),Y=Math.sin(T),dt=D*this.x-Y*this.y,It=Y*this.x+D*this.y;return this.x=dt,this.y=It,this},_rotateAround:function(T,D){var Y=Math.cos(T),dt=Math.sin(T),It=D.x+Y*(this.x-D.x)-dt*(this.y-D.y),Ct=D.y+dt*(this.x-D.x)+Y*(this.y-D.y);return this.x=It,this.y=Ct,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},Ri.convert=function(T){return T instanceof Ri?T:Array.isArray(T)?new Ri(T[0],T[1]):T};var ce=n(Ls);function ar(T,D){var Y=D.getBoundingClientRect();return new ce(T.clientX-Y.left-(D.clientLeft||0),T.clientY-Y.top-(D.clientTop||0))}function He(T,D,Y,dt){return{type:G.FEATURE,properties:{meta:$.VERTEX,parent:T,coord_path:Y,active:dt?V.ACTIVE:V.INACTIVE},geometry:{type:G.POINT,coordinates:D}}}function Di(T,D,Y){var dt=D.geometry.coordinates,It=Y.geometry.coordinates;if(dt[1]>85||dt[1]<vt||It[1]>85||It[1]<vt)return null;var Ct={lng:(dt[0]+It[0])/2,lat:(dt[1]+It[1])/2};return{type:G.FEATURE,properties:{meta:$.MIDPOINT,parent:T,lng:Ct.lng,lat:Ct.lat,coord_path:Y.properties.coord_path},geometry:{type:G.POINT,coordinates:[Ct.lng,Ct.lat]}}}function fo(T,D,Y){D===void 0&&(D={}),Y===void 0&&(Y=null);var dt,It=T.geometry,Ct=It.type,Dt=It.coordinates,re=T.properties&&T.properties.id,ae=[];function we(_e,sr){var Rn="",ur=null;_e.forEach(function(Kn,Jt){var ze=sr!=null?sr+"."+Jt:String(Jt),tn=He(re,Kn,ze,Ee(ze));if(D.midpoints&&ur){var Dn=Di(re,ur,tn);Dn&&ae.push(Dn)}ur=tn;var Un=JSON.stringify(Kn);Rn!==Un&&ae.push(tn),Jt===0&&(Rn=Un)})}function Ee(_e){return!!D.selectedPaths&&D.selectedPaths.indexOf(_e)!==-1}return Ct===G.POINT?ae.push(He(re,Dt,Y,Ee(Y))):Ct===G.POLYGON?Dt.forEach(function(_e,sr){we(_e,Y!==null?Y+"."+sr:String(sr))}):Ct===G.LINE_STRING?we(Dt,Y):Ct.indexOf(G.MULTI_PREFIX)===0&&(dt=Ct.replace(G.MULTI_PREFIX,""),Dt.forEach(function(_e,sr){var Rn={type:G.FEATURE,properties:T.properties,geometry:{type:dt,coordinates:_e}};ae=ae.concat(fo(Rn,D,sr))})),ae}var Ze={enable:function(T){setTimeout(function(){T.map&&T.map.doubleClickZoom&&T._ctx&&T._ctx.store&&T._ctx.store.getInitialConfigValue&&T._ctx.store.getInitialConfigValue("doubleClickZoom")&&T.map.doubleClickZoom.enable()},0)},disable:function(T){setTimeout(function(){T.map&&T.map.doubleClickZoom&&T.map.doubleClickZoom.disable()},0)}},Mo={exports:{}},ct=function(T){if(!T||!T.type)return null;var D=q[T.type];if(!D)return null;if(D==="geometry")return{type:"FeatureCollection",features:[{type:"Feature",properties:{},geometry:T}]};if(D==="feature")return{type:"FeatureCollection",features:[T]};if(D==="featurecollection")return T},q={Point:"geometry",MultiPoint:"geometry",LineString:"geometry",MultiLineString:"geometry",Polygon:"geometry",MultiPolygon:"geometry",GeometryCollection:"geometry",Feature:"feature",FeatureCollection:"featurecollection"},X=n(ct),nt=Object.freeze({__proto__:null,default:function T(D){switch(D&&D.type||null){case"FeatureCollection":return D.features=D.features.reduce(function(Y,dt){return Y.concat(T(dt))},[]),D;case"Feature":return D.geometry?T(D.geometry).map(function(Y){var dt={type:"Feature",properties:JSON.parse(JSON.stringify(D.properties)),geometry:Y};return D.id!==void 0&&(dt.id=D.id),dt}):[D];case"MultiPoint":return D.coordinates.map(function(Y){return{type:"Point",coordinates:Y}});case"MultiPolygon":return D.coordinates.map(function(Y){return{type:"Polygon",coordinates:Y}});case"MultiLineString":return D.coordinates.map(function(Y){return{type:"LineString",coordinates:Y}});case"GeometryCollection":return D.geometries.map(T).reduce(function(Y,dt){return Y.concat(dt)},[]);case"Point":case"Polygon":case"LineString":return[D]}}}),pt=ct,ft=i(nt),rt=function(T){return function D(Y){return Array.isArray(Y)&&Y.length&&typeof Y[0]=="number"?[Y]:Y.reduce(function(dt,It){return Array.isArray(It)&&Array.isArray(It[0])?dt.concat(D(It)):(dt.push(It),dt)},[])}(T)};ft instanceof Function||(ft=ft.default);var bt={exports:{}},mt=bt.exports=function(T){return new Et(T)};function Et(T){this.value=T}function zt(T,D,Y){var dt=[],It=[],Ct=!0;return function Dt(re){var ae=Y?Zt(re):re,we={},Ee=!0,_e={node:ae,node_:re,path:[].concat(dt),parent:It[It.length-1],parents:It,key:dt.slice(-1)[0],isRoot:dt.length===0,level:dt.length,circular:null,update:function(ur,Kn){_e.isRoot||(_e.parent.node[_e.key]=ur),_e.node=ur,Kn&&(Ee=!1)},delete:function(ur){delete _e.parent.node[_e.key],ur&&(Ee=!1)},remove:function(ur){Xe(_e.parent.node)?_e.parent.node.splice(_e.key,1):delete _e.parent.node[_e.key],ur&&(Ee=!1)},keys:null,before:function(ur){we.before=ur},after:function(ur){we.after=ur},pre:function(ur){we.pre=ur},post:function(ur){we.post=ur},stop:function(){Ct=!1},block:function(){Ee=!1}};if(!Ct)return _e;function sr(){if(typeof _e.node=="object"&&_e.node!==null){_e.keys&&_e.node_===_e.node||(_e.keys=Ht(_e.node)),_e.isLeaf=_e.keys.length==0;for(var ur=0;ur<It.length;ur++)if(It[ur].node_===re){_e.circular=It[ur];break}}else _e.isLeaf=!0,_e.keys=null;_e.notLeaf=!_e.isLeaf,_e.notRoot=!_e.isRoot}sr();var Rn=D.call(_e,_e.node);return Rn!==void 0&&_e.update&&_e.update(Rn),we.before&&we.before.call(_e,_e.node),Ee&&(typeof _e.node!="object"||_e.node===null||_e.circular||(It.push(_e),sr(),Ce(_e.keys,function(ur,Kn){dt.push(ur),we.pre&&we.pre.call(_e,_e.node[ur],ur);var Jt=Dt(_e.node[ur]);Y&&Ue.call(_e.node,ur)&&(_e.node[ur]=Jt.node),Jt.isLast=Kn==_e.keys.length-1,Jt.isFirst=Kn==0,we.post&&we.post.call(_e,Jt),dt.pop()}),It.pop()),we.after&&we.after.call(_e,_e.node)),_e}(T).node}function Zt(T){if(typeof T=="object"&&T!==null){var D;if(Xe(T))D=[];else if(De(T)==="[object Date]")D=new Date(T.getTime?T.getTime():T);else if(function(It){return De(It)==="[object RegExp]"}(T))D=new RegExp(T);else if(function(It){return De(It)==="[object Error]"}(T))D={message:T.message};else if(function(It){return De(It)==="[object Boolean]"}(T))D=new Boolean(T);else if(function(It){return De(It)==="[object Number]"}(T))D=new Number(T);else if(function(It){return De(It)==="[object String]"}(T))D=new String(T);else if(Object.create&&Object.getPrototypeOf)D=Object.create(Object.getPrototypeOf(T));else if(T.constructor===Object)D={};else{var Y=T.constructor&&T.constructor.prototype||T.__proto__||{},dt=function(){};dt.prototype=Y,D=new dt}return Ce(Ht(T),function(It){D[It]=T[It]}),D}return T}Et.prototype.get=function(T){for(var D=this.value,Y=0;Y<T.length;Y++){var dt=T[Y];if(!D||!Ue.call(D,dt)){D=void 0;break}D=D[dt]}return D},Et.prototype.has=function(T){for(var D=this.value,Y=0;Y<T.length;Y++){var dt=T[Y];if(!D||!Ue.call(D,dt))return!1;D=D[dt]}return!0},Et.prototype.set=function(T,D){for(var Y=this.value,dt=0;dt<T.length-1;dt++){var It=T[dt];Ue.call(Y,It)||(Y[It]={}),Y=Y[It]}return Y[T[dt]]=D,D},Et.prototype.map=function(T){return zt(this.value,T,!0)},Et.prototype.forEach=function(T){return this.value=zt(this.value,T,!1),this.value},Et.prototype.reduce=function(T,D){var Y=arguments.length===1,dt=Y?this.value:D;return this.forEach(function(It){this.isRoot&&Y||(dt=T.call(this,dt,It))}),dt},Et.prototype.paths=function(){var T=[];return this.forEach(function(D){T.push(this.path)}),T},Et.prototype.nodes=function(){var T=[];return this.forEach(function(D){T.push(this.node)}),T},Et.prototype.clone=function(){var T=[],D=[];return function Y(dt){for(var It=0;It<T.length;It++)if(T[It]===dt)return D[It];if(typeof dt=="object"&&dt!==null){var Ct=Zt(dt);return T.push(dt),D.push(Ct),Ce(Ht(dt),function(Dt){Ct[Dt]=Y(dt[Dt])}),T.pop(),D.pop(),Ct}return dt}(this.value)};var Ht=Object.keys||function(T){var D=[];for(var Y in T)D.push(Y);return D};function De(T){return Object.prototype.toString.call(T)}var Xe=Array.isArray||function(T){return Object.prototype.toString.call(T)==="[object Array]"},Ce=function(T,D){if(T.forEach)return T.forEach(D);for(var Y=0;Y<T.length;Y++)D(T[Y],Y,T)};Ce(Ht(Et.prototype),function(T){mt[T]=function(D){var Y=[].slice.call(arguments,1),dt=new Et(D);return dt[T].apply(dt,Y)}});var Ue=Object.hasOwnProperty||function(T,D){return D in T},or=bt.exports,Jr=fr;function fr(T){if(!(this instanceof fr))return new fr(T);this._bbox=T||[1/0,1/0,-1/0,-1/0],this._valid=!!T}fr.prototype.include=function(T){return this._valid=!0,this._bbox[0]=Math.min(this._bbox[0],T[0]),this._bbox[1]=Math.min(this._bbox[1],T[1]),this._bbox[2]=Math.max(this._bbox[2],T[0]),this._bbox[3]=Math.max(this._bbox[3],T[1]),this},fr.prototype.equals=function(T){var D;return D=T instanceof fr?T.bbox():T,this._bbox[0]==D[0]&&this._bbox[1]==D[1]&&this._bbox[2]==D[2]&&this._bbox[3]==D[3]},fr.prototype.center=function(T){return this._valid?[(this._bbox[0]+this._bbox[2])/2,(this._bbox[1]+this._bbox[3])/2]:null},fr.prototype.union=function(T){var D;return this._valid=!0,D=T instanceof fr?T.bbox():T,this._bbox[0]=Math.min(this._bbox[0],D[0]),this._bbox[1]=Math.min(this._bbox[1],D[1]),this._bbox[2]=Math.max(this._bbox[2],D[2]),this._bbox[3]=Math.max(this._bbox[3],D[3]),this},fr.prototype.bbox=function(){return this._valid?this._bbox:null},fr.prototype.contains=function(T){if(!T)return this._fastContains();if(!this._valid)return null;var D=T[0],Y=T[1];return this._bbox[0]<=D&&this._bbox[1]<=Y&&this._bbox[2]>=D&&this._bbox[3]>=Y},fr.prototype.intersect=function(T){return this._valid?(D=T instanceof fr?T.bbox():T,!(this._bbox[0]>D[2]||this._bbox[2]<D[0]||this._bbox[3]<D[1]||this._bbox[1]>D[3])):null;var D},fr.prototype._fastContains=function(){if(!this._valid)return new Function("return null;");var T="return "+this._bbox[0]+"<= ll[0] &&"+this._bbox[1]+"<= ll[1] &&"+this._bbox[2]+">= ll[0] &&"+this._bbox[3]+">= ll[1]";return new Function("ll",T)},fr.prototype.polygon=function(){return this._valid?{type:"Polygon",coordinates:[[[this._bbox[0],this._bbox[1]],[this._bbox[2],this._bbox[1]],[this._bbox[2],this._bbox[3]],[this._bbox[0],this._bbox[3]],[this._bbox[0],this._bbox[1]]]]}:null};var Fr=function(T){if(!T)return[];var D=ft(pt(T)),Y=[];return D.features.forEach(function(dt){dt.geometry&&(Y=Y.concat(rt(dt.geometry.coordinates)))}),Y},Lr=or,Qi=Jr,dn={features:["FeatureCollection"],coordinates:["Point","MultiPoint","LineString","MultiLineString","Polygon","MultiPolygon"],geometry:["Feature"],geometries:["GeometryCollection"]},li=Object.keys(dn);function bi(T){for(var D=Qi(),Y=Fr(T),dt=0;dt<Y.length;dt++)D.include(Y[dt]);return D}Mo.exports=function(T){return bi(T).bbox()},Mo.exports.polygon=function(T){return bi(T).polygon()},Mo.exports.bboxify=function(T){return Lr(T).map(function(D){D&&li.some(function(Y){return!!D[Y]&&dn[Y].indexOf(D.type)!==-1})&&(D.bbox=bi(D).bbox(),this.update(D))})};var ps=n(Mo.exports),Ju=-90;function Qa(T,D){var Y=Ju,dt=90,It=Ju,Ct=90,Dt=270,re=-270;T.forEach(function(we){var Ee=ps(we),_e=Ee[1],sr=Ee[3],Rn=Ee[0],ur=Ee[2];_e>Y&&(Y=_e),sr<dt&&(dt=sr),sr>It&&(It=sr),_e<Ct&&(Ct=_e),Rn<Dt&&(Dt=Rn),ur>re&&(re=ur)});var ae=D;return Y+ae.lat>85&&(ae.lat=85-Y),It+ae.lat>90&&(ae.lat=90-It),dt+ae.lat<-85&&(ae.lat=-85-dt),Ct+ae.lat<Ju&&(ae.lat=Ju-Ct),Dt+ae.lng<=-270&&(ae.lng+=360*Math.ceil(Math.abs(ae.lng)/360)),re+ae.lng>=270&&(ae.lng-=360*Math.ceil(Math.abs(ae.lng)/360)),ae}function tl(T,D){var Y=Qa(T.map(function(dt){return dt.toGeoJSON()}),D);T.forEach(function(dt){var It,Ct=dt.getCoordinates(),Dt=function(ae){var we={lng:ae[0]+Y.lng,lat:ae[1]+Y.lat};return[we.lng,we.lat]},re=function(ae){return ae.map(function(we){return Dt(we)})};dt.type===G.POINT?It=Dt(Ct):dt.type===G.LINE_STRING||dt.type===G.MULTI_POINT?It=Ct.map(Dt):dt.type===G.POLYGON||dt.type===G.MULTI_LINE_STRING?It=Ct.map(re):dt.type===G.MULTI_POLYGON&&(It=Ct.map(function(ae){return ae.map(function(we){return re(we)})})),dt.incomingCoords(It)})}var wi={onSetup:function(T){var D=this,Y={dragMoveLocation:null,boxSelectStartLocation:null,boxSelectElement:void 0,boxSelecting:!1,canBoxSelect:!1,dragMoving:!1,canDragMove:!1,initiallySelectedFeatureIds:T.featureIds||[]};return this.setSelected(Y.initiallySelectedFeatureIds.filter(function(dt){return D.getFeature(dt)!==void 0})),this.fireActionable(),this.setActionableState({combineFeatures:!0,uncombineFeatures:!0,trash:!0}),Y},fireUpdate:function(){this.map.fire(U.UPDATE,{action:tt.MOVE,features:this.getSelected().map(function(T){return T.toGeoJSON()})})},fireActionable:function(){var T=this,D=this.getSelected(),Y=D.filter(function(re){return T.isInstanceOf("MultiFeature",re)}),dt=!1;if(D.length>1){dt=!0;var It=D[0].type.replace("Multi","");D.forEach(function(re){re.type.replace("Multi","")!==It&&(dt=!1)})}var Ct=Y.length>0,Dt=D.length>0;this.setActionableState({combineFeatures:dt,uncombineFeatures:Ct,trash:Dt})},getUniqueIds:function(T){return T.length?T.map(function(D){return D.properties.id}).filter(function(D){return D!==void 0}).reduce(function(D,Y){return D.add(Y),D},new $t).values():[]},stopExtendedInteractions:function(T){T.boxSelectElement&&(T.boxSelectElement.parentNode&&T.boxSelectElement.parentNode.removeChild(T.boxSelectElement),T.boxSelectElement=null),this.map.dragPan.enable(),T.boxSelecting=!1,T.canBoxSelect=!1,T.dragMoving=!1,T.canDragMove=!1},onStop:function(){Ze.enable(this)},onMouseMove:function(T,D){return cs(D)&&T.dragMoving&&this.fireUpdate(),this.stopExtendedInteractions(T),!0},onMouseOut:function(T){return!T.dragMoving||this.fireUpdate()}};wi.onTap=wi.onClick=function(T,D){return ia(D)?this.clickAnywhere(T,D):yr($.VERTEX)(D)?this.clickOnVertex(T,D):cs(D)?this.clickOnFeature(T,D):void 0},wi.clickAnywhere=function(T){var D=this,Y=this.getSelectedIds();Y.length&&(this.clearSelectedFeatures(),Y.forEach(function(dt){return D.doRender(dt)})),Ze.enable(this),this.stopExtendedInteractions(T)},wi.clickOnVertex=function(T,D){this.changeMode(W.DIRECT_SELECT,{featureId:D.featureTarget.properties.parent,coordPath:D.featureTarget.properties.coord_path,startPos:D.lngLat}),this.updateUIClasses({mouse:O.MOVE})},wi.startOnActiveFeature=function(T,D){this.stopExtendedInteractions(T),this.map.dragPan.disable(),this.doRender(D.featureTarget.properties.id),T.canDragMove=!0,T.dragMoveLocation=D.lngLat},wi.clickOnFeature=function(T,D){var Y=this;Ze.disable(this),this.stopExtendedInteractions(T);var dt=hs(D),It=this.getSelectedIds(),Ct=D.featureTarget.properties.id,Dt=this.isSelected(Ct);if(!dt&&Dt&&this.getFeature(Ct).type!==G.POINT)return this.changeMode(W.DIRECT_SELECT,{featureId:Ct});Dt&&dt?(this.deselect(Ct),this.updateUIClasses({mouse:O.POINTER}),It.length===1&&Ze.enable(this)):!Dt&&dt?(this.select(Ct),this.updateUIClasses({mouse:O.MOVE})):Dt||dt||(It.forEach(function(re){return Y.doRender(re)}),this.setSelected(Ct),this.updateUIClasses({mouse:O.MOVE})),this.doRender(Ct)},wi.onMouseDown=function(T,D){return Co(D)?this.startOnActiveFeature(T,D):this.drawConfig.boxSelect&&ho(D)?this.startBoxSelect(T,D):void 0},wi.startBoxSelect=function(T,D){this.stopExtendedInteractions(T),this.map.dragPan.disable(),T.boxSelectStartLocation=ar(D.originalEvent,this.map.getContainer()),T.canBoxSelect=!0},wi.onTouchStart=function(T,D){if(Co(D))return this.startOnActiveFeature(T,D)},wi.onDrag=function(T,D){return T.canDragMove?this.dragMove(T,D):this.drawConfig.boxSelect&&T.canBoxSelect?this.whileBoxSelect(T,D):void 0},wi.whileBoxSelect=function(T,D){T.boxSelecting=!0,this.updateUIClasses({mouse:O.ADD}),T.boxSelectElement||(T.boxSelectElement=document.createElement("div"),T.boxSelectElement.classList.add(S.BOX_SELECT),this.map.getContainer().appendChild(T.boxSelectElement));var Y=ar(D.originalEvent,this.map.getContainer()),dt=Math.min(T.boxSelectStartLocation.x,Y.x),It=Math.max(T.boxSelectStartLocation.x,Y.x),Ct=Math.min(T.boxSelectStartLocation.y,Y.y),Dt=Math.max(T.boxSelectStartLocation.y,Y.y),re="translate("+dt+"px, "+Ct+"px)";T.boxSelectElement.style.transform=re,T.boxSelectElement.style.WebkitTransform=re,T.boxSelectElement.style.width=It-dt+"px",T.boxSelectElement.style.height=Dt-Ct+"px"},wi.dragMove=function(T,D){T.dragMoving=!0,D.originalEvent.stopPropagation();var Y={lng:D.lngLat.lng-T.dragMoveLocation.lng,lat:D.lngLat.lat-T.dragMoveLocation.lat};tl(this.getSelected(),Y),T.dragMoveLocation=D.lngLat},wi.onTouchEnd=wi.onMouseUp=function(T,D){var Y=this;if(T.dragMoving)this.fireUpdate();else if(T.boxSelecting){var dt=[T.boxSelectStartLocation,ar(D.originalEvent,this.map.getContainer())],It=this.featuresAt(null,dt,"click"),Ct=this.getUniqueIds(It).filter(function(Dt){return!Y.isSelected(Dt)});Ct.length&&(this.select(Ct),Ct.forEach(function(Dt){return Y.doRender(Dt)}),this.updateUIClasses({mouse:O.MOVE}))}this.stopExtendedInteractions(T)},wi.toDisplayFeatures=function(T,D,Y){D.properties.active=this.isSelected(D.properties.id)?V.ACTIVE:V.INACTIVE,Y(D),this.fireActionable(),D.properties.active===V.ACTIVE&&D.geometry.type!==G.POINT&&fo(D).forEach(Y)},wi.onTrash=function(){this.deleteFeature(this.getSelectedIds()),this.fireActionable()},wi.onCombineFeatures=function(){var T=this.getSelected();if(!(T.length===0||T.length<2)){for(var D=[],Y=[],dt=T[0].type.replace("Multi",""),It=0;It<T.length;It++){var Ct=T[It];if(Ct.type.replace("Multi","")!==dt)return;Ct.type.includes("Multi")?Ct.getCoordinates().forEach(function(re){D.push(re)}):D.push(Ct.getCoordinates()),Y.push(Ct.toGeoJSON())}if(Y.length>1){var Dt=this.newFeature({type:G.FEATURE,properties:Y[0].properties,geometry:{type:"Multi"+dt,coordinates:D}});this.addFeature(Dt),this.deleteFeature(this.getSelectedIds(),{silent:!0}),this.setSelected([Dt.id]),this.map.fire(U.COMBINE_FEATURES,{createdFeatures:[Dt.toGeoJSON()],deletedFeatures:Y})}this.fireActionable()}},wi.onUncombineFeatures=function(){var T=this,D=this.getSelected();if(D.length!==0){for(var Y=[],dt=[],It=function(Dt){var re=D[Dt];T.isInstanceOf("MultiFeature",re)&&(re.getFeatures().forEach(function(ae){T.addFeature(ae),ae.properties=re.properties,Y.push(ae.toGeoJSON()),T.select([ae.id])}),T.deleteFeature(re.id,{silent:!0}),dt.push(re.toGeoJSON()))},Ct=0;Ct<D.length;Ct++)It(Ct);Y.length>1&&this.map.fire(U.UNCOMBINE_FEATURES,{createdFeatures:Y,deletedFeatures:dt}),this.fireActionable()}};var Qr=yr($.VERTEX),th=yr($.MIDPOINT),Rs={fireUpdate:function(){this.map.fire(U.UPDATE,{action:tt.CHANGE_COORDINATES,features:this.getSelected().map(function(T){return T.toGeoJSON()})})},fireActionable:function(T){this.setActionableState({combineFeatures:!1,uncombineFeatures:!1,trash:T.selectedCoordPaths.length>0})},startDragging:function(T,D){this.map.dragPan.disable(),T.canDragMove=!0,T.dragMoveLocation=D.lngLat},stopDragging:function(T){this.map.dragPan.enable(),T.dragMoving=!1,T.canDragMove=!1,T.dragMoveLocation=null},onVertex:function(T,D){this.startDragging(T,D);var Y=D.featureTarget.properties,dt=T.selectedCoordPaths.indexOf(Y.coord_path);hs(D)||dt!==-1?hs(D)&&dt===-1&&T.selectedCoordPaths.push(Y.coord_path):T.selectedCoordPaths=[Y.coord_path];var It=this.pathsToCoordinates(T.featureId,T.selectedCoordPaths);this.setSelectedCoordinates(It)},onMidpoint:function(T,D){this.startDragging(T,D);var Y=D.featureTarget.properties;T.feature.addCoordinate(Y.coord_path,Y.lng,Y.lat),this.fireUpdate(),T.selectedCoordPaths=[Y.coord_path]},pathsToCoordinates:function(T,D){return D.map(function(Y){return{feature_id:T,coord_path:Y}})},onFeature:function(T,D){T.selectedCoordPaths.length===0?this.startDragging(T,D):this.stopDragging(T)},dragFeature:function(T,D,Y){tl(this.getSelected(),Y),T.dragMoveLocation=D.lngLat},dragVertex:function(T,D,Y){for(var dt=T.selectedCoordPaths.map(function(re){return T.feature.getCoordinate(re)}),It=Qa(dt.map(function(re){return{type:G.FEATURE,properties:{},geometry:{type:G.POINT,coordinates:re}}}),Y),Ct=0;Ct<dt.length;Ct++){var Dt=dt[Ct];T.feature.updateCoordinate(T.selectedCoordPaths[Ct],Dt[0]+It.lng,Dt[1]+It.lat)}},clickNoTarget:function(){this.changeMode(W.SIMPLE_SELECT)},clickInactive:function(){this.changeMode(W.SIMPLE_SELECT)},clickActiveFeature:function(T){T.selectedCoordPaths=[],this.clearSelectedCoordinates(),T.feature.changed()},onSetup:function(T){var D=T.featureId,Y=this.getFeature(D);if(!Y)throw new Error("You must provide a featureId to enter direct_select mode");if(Y.type===G.POINT)throw new TypeError("direct_select mode doesn't handle point features");var dt={featureId:D,feature:Y,dragMoveLocation:T.startPos||null,dragMoving:!1,canDragMove:!1,selectedCoordPaths:T.coordPath?[T.coordPath]:[]};return this.setSelectedCoordinates(this.pathsToCoordinates(D,dt.selectedCoordPaths)),this.setSelected(D),Ze.disable(this),this.setActionableState({trash:!0}),dt},onStop:function(){Ze.enable(this),this.clearSelectedCoordinates()},toDisplayFeatures:function(T,D,Y){T.featureId===D.properties.id?(D.properties.active=V.ACTIVE,Y(D),fo(D,{map:this.map,midpoints:!0,selectedPaths:T.selectedCoordPaths}).forEach(Y)):(D.properties.active=V.INACTIVE,Y(D)),this.fireActionable(T)},onTrash:function(T){T.selectedCoordPaths.sort(function(D,Y){return Y.localeCompare(D,"en",{numeric:!0})}).forEach(function(D){return T.feature.removeCoordinate(D)}),this.fireUpdate(),T.selectedCoordPaths=[],this.clearSelectedCoordinates(),this.fireActionable(T),T.feature.isValid()===!1&&(this.deleteFeature([T.featureId]),this.changeMode(W.SIMPLE_SELECT,{}))},onMouseMove:function(T,D){var Y=Co(D),dt=Qr(D),It=th(D),Ct=T.selectedCoordPaths.length===0;return Y&&Ct||dt&&!Ct?this.updateUIClasses({mouse:O.MOVE}):this.updateUIClasses({mouse:O.NONE}),(dt||Y||It)&&T.dragMoving&&this.fireUpdate(),this.stopDragging(T),!0},onMouseOut:function(T){return T.dragMoving&&this.fireUpdate(),!0}};Rs.onTouchStart=Rs.onMouseDown=function(T,D){return Qr(D)?this.onVertex(T,D):Co(D)?this.onFeature(T,D):th(D)?this.onMidpoint(T,D):void 0},Rs.onDrag=function(T,D){if(T.canDragMove===!0){T.dragMoving=!0,D.originalEvent.stopPropagation();var Y={lng:D.lngLat.lng-T.dragMoveLocation.lng,lat:D.lngLat.lat-T.dragMoveLocation.lat};T.selectedCoordPaths.length>0?this.dragVertex(T,D,Y):this.dragFeature(T,D,Y),T.dragMoveLocation=D.lngLat}},Rs.onClick=function(T,D){return ia(D)?this.clickNoTarget(T,D):Co(D)?this.clickActiveFeature(T,D):ai(D)?this.clickInactive(T,D):void this.stopDragging(T)},Rs.onTap=function(T,D){return ia(D)?this.clickNoTarget(T,D):Co(D)?this.clickActiveFeature(T,D):ai(D)?this.clickInactive(T,D):void 0},Rs.onTouchEnd=Rs.onMouseUp=function(T){T.dragMoving&&this.fireUpdate(),this.stopDragging(T)};var Cn={};function to(T,D){return!!T.lngLat&&T.lngLat.lng===D[0]&&T.lngLat.lat===D[1]}Cn.onSetup=function(){var T=this.newFeature({type:G.FEATURE,properties:{},geometry:{type:G.POINT,coordinates:[]}});return this.addFeature(T),this.clearSelectedFeatures(),this.updateUIClasses({mouse:O.ADD}),this.activateUIButton(k.POINT),this.setActionableState({trash:!0}),{point:T}},Cn.stopDrawingAndRemove=function(T){this.deleteFeature([T.point.id],{silent:!0}),this.changeMode(W.SIMPLE_SELECT)},Cn.onTap=Cn.onClick=function(T,D){this.updateUIClasses({mouse:O.MOVE}),T.point.updateCoordinate("",D.lngLat.lng,D.lngLat.lat),this.map.fire(U.CREATE,{features:[T.point.toGeoJSON()]}),this.changeMode(W.SIMPLE_SELECT,{featureIds:[T.point.id]})},Cn.onStop=function(T){this.activateUIButton(),T.point.getCoordinate().length||this.deleteFeature([T.point.id],{silent:!0})},Cn.toDisplayFeatures=function(T,D,Y){var dt=D.properties.id===T.point.id;if(D.properties.active=dt?V.ACTIVE:V.INACTIVE,!dt)return Y(D)},Cn.onTrash=Cn.stopDrawingAndRemove,Cn.onKeyUp=function(T,D){if(oe(D)||po(D))return this.stopDrawingAndRemove(T,D)};var $l={onSetup:function(){var T=this.newFeature({type:G.FEATURE,properties:{},geometry:{type:G.POLYGON,coordinates:[[]]}});return this.addFeature(T),this.clearSelectedFeatures(),Ze.disable(this),this.updateUIClasses({mouse:O.ADD}),this.activateUIButton(k.POLYGON),this.setActionableState({trash:!0}),{polygon:T,currentVertexPosition:0}},clickAnywhere:function(T,D){if(T.currentVertexPosition>0&&to(D,T.polygon.coordinates[0][T.currentVertexPosition-1]))return this.changeMode(W.SIMPLE_SELECT,{featureIds:[T.polygon.id]});this.updateUIClasses({mouse:O.ADD}),T.polygon.updateCoordinate("0."+T.currentVertexPosition,D.lngLat.lng,D.lngLat.lat),T.currentVertexPosition++,T.polygon.updateCoordinate("0."+T.currentVertexPosition,D.lngLat.lng,D.lngLat.lat)},clickOnVertex:function(T){return this.changeMode(W.SIMPLE_SELECT,{featureIds:[T.polygon.id]})},onMouseMove:function(T,D){T.polygon.updateCoordinate("0."+T.currentVertexPosition,D.lngLat.lng,D.lngLat.lat),Ji(D)&&this.updateUIClasses({mouse:O.POINTER})}};$l.onTap=$l.onClick=function(T,D){return Ji(D)?this.clickOnVertex(T,D):this.clickAnywhere(T,D)},$l.onKeyUp=function(T,D){oe(D)?(this.deleteFeature([T.polygon.id],{silent:!0}),this.changeMode(W.SIMPLE_SELECT)):po(D)&&this.changeMode(W.SIMPLE_SELECT,{featureIds:[T.polygon.id]})},$l.onStop=function(T){this.updateUIClasses({mouse:O.NONE}),Ze.enable(this),this.activateUIButton(),this.getFeature(T.polygon.id)!==void 0&&(T.polygon.removeCoordinate("0."+T.currentVertexPosition),T.polygon.isValid()?this.map.fire(U.CREATE,{features:[T.polygon.toGeoJSON()]}):(this.deleteFeature([T.polygon.id],{silent:!0}),this.changeMode(W.SIMPLE_SELECT,{},{silent:!0})))},$l.toDisplayFeatures=function(T,D,Y){var dt=D.properties.id===T.polygon.id;if(D.properties.active=dt?V.ACTIVE:V.INACTIVE,!dt)return Y(D);if(D.geometry.coordinates.length!==0){var It=D.geometry.coordinates[0].length;if(!(It<3)){if(D.properties.meta=$.FEATURE,Y(He(T.polygon.id,D.geometry.coordinates[0][0],"0.0",!1)),It>3){var Ct=D.geometry.coordinates[0].length-3;Y(He(T.polygon.id,D.geometry.coordinates[0][Ct],"0."+Ct,!1))}if(It<=4){var Dt=[[D.geometry.coordinates[0][0][0],D.geometry.coordinates[0][0][1]],[D.geometry.coordinates[0][1][0],D.geometry.coordinates[0][1][1]]];if(Y({type:G.FEATURE,properties:D.properties,geometry:{coordinates:Dt,type:G.LINE_STRING}}),It===3)return}return Y(D)}}},$l.onTrash=function(T){this.deleteFeature([T.polygon.id],{silent:!0}),this.changeMode(W.SIMPLE_SELECT)};var Ni={onSetup:function(T){var D,Y,dt=(T=T||{}).featureId,It="forward";if(dt){if(!(D=this.getFeature(dt)))throw new Error("Could not find a feature with the provided featureId");var Ct=T.from;if(Ct&&Ct.type==="Feature"&&Ct.geometry&&Ct.geometry.type==="Point"&&(Ct=Ct.geometry),Ct&&Ct.type==="Point"&&Ct.coordinates&&Ct.coordinates.length===2&&(Ct=Ct.coordinates),!Ct||!Array.isArray(Ct))throw new Error("Please use the `from` property to indicate which point to continue the line from");var Dt=D.coordinates.length-1;if(D.coordinates[Dt][0]===Ct[0]&&D.coordinates[Dt][1]===Ct[1])Y=Dt+1,D.addCoordinate.apply(D,[Y].concat(D.coordinates[Dt]));else{if(D.coordinates[0][0]!==Ct[0]||D.coordinates[0][1]!==Ct[1])throw new Error("`from` should match the point at either the start or the end of the provided LineString");It="backwards",Y=0,D.addCoordinate.apply(D,[Y].concat(D.coordinates[0]))}}else D=this.newFeature({type:G.FEATURE,properties:{},geometry:{type:G.LINE_STRING,coordinates:[]}}),Y=0,this.addFeature(D);return this.clearSelectedFeatures(),Ze.disable(this),this.updateUIClasses({mouse:O.ADD}),this.activateUIButton(k.LINE),this.setActionableState({trash:!0}),{line:D,currentVertexPosition:Y,direction:It}},clickAnywhere:function(T,D){if(T.currentVertexPosition>0&&to(D,T.line.coordinates[T.currentVertexPosition-1])||T.direction==="backwards"&&to(D,T.line.coordinates[T.currentVertexPosition+1]))return this.changeMode(W.SIMPLE_SELECT,{featureIds:[T.line.id]});this.updateUIClasses({mouse:O.ADD}),T.line.updateCoordinate(T.currentVertexPosition,D.lngLat.lng,D.lngLat.lat),T.direction==="forward"?(T.currentVertexPosition++,T.line.updateCoordinate(T.currentVertexPosition,D.lngLat.lng,D.lngLat.lat)):T.line.addCoordinate(0,D.lngLat.lng,D.lngLat.lat)},clickOnVertex:function(T){return this.changeMode(W.SIMPLE_SELECT,{featureIds:[T.line.id]})},onMouseMove:function(T,D){T.line.updateCoordinate(T.currentVertexPosition,D.lngLat.lng,D.lngLat.lat),Ji(D)&&this.updateUIClasses({mouse:O.POINTER})}};Ni.onTap=Ni.onClick=function(T,D){if(Ji(D))return this.clickOnVertex(T,D);this.clickAnywhere(T,D)},Ni.onKeyUp=function(T,D){po(D)?this.changeMode(W.SIMPLE_SELECT,{featureIds:[T.line.id]}):oe(D)&&(this.deleteFeature([T.line.id],{silent:!0}),this.changeMode(W.SIMPLE_SELECT))},Ni.onStop=function(T){Ze.enable(this),this.activateUIButton(),this.getFeature(T.line.id)!==void 0&&(T.line.removeCoordinate(""+T.currentVertexPosition),T.line.isValid()?this.map.fire(U.CREATE,{features:[T.line.toGeoJSON()]}):(this.deleteFeature([T.line.id],{silent:!0}),this.changeMode(W.SIMPLE_SELECT,{},{silent:!0})))},Ni.onTrash=function(T){this.deleteFeature([T.line.id],{silent:!0}),this.changeMode(W.SIMPLE_SELECT)},Ni.toDisplayFeatures=function(T,D,Y){var dt=D.properties.id===T.line.id;if(D.properties.active=dt?V.ACTIVE:V.INACTIVE,!dt)return Y(D);D.geometry.coordinates.length<2||(D.properties.meta=$.FEATURE,Y(He(T.line.id,D.geometry.coordinates[T.direction==="forward"?D.geometry.coordinates.length-2:1],""+(T.direction==="forward"?D.geometry.coordinates.length-2:1),!1)),Y(D))};var ki={simple_select:wi,direct_select:Rs,draw_point:Cn,draw_polygon:$l,draw_line_string:Ni},eh={defaultMode:W.SIMPLE_SELECT,keybindings:!0,touchEnabled:!0,clickBuffer:2,touchBuffer:25,boxSelect:!0,displayControlsDefault:!0,styles:Or,modes:ki,controls:{},userProperties:!1},vu={point:!0,line_string:!0,polygon:!0,trash:!0,combine_features:!0,uncombine_features:!0},An={point:!1,line_string:!1,polygon:!1,trash:!1,combine_features:!1,uncombine_features:!1};function Vr(T,D){return T.map(function(Y){return Y.source?Y:Gt(Y,{id:Y.id+"."+D,source:D==="hot"?A.HOT:A.COLD})})}var Ma={exports:{}};(function(T,D){var Y="__lodash_hash_undefined__",dt=9007199254740991,It="[object Arguments]",Ct="[object Array]",Dt="[object Boolean]",re="[object Date]",ae="[object Error]",we="[object Function]",Ee="[object Map]",_e="[object Number]",sr="[object Object]",Rn="[object Promise]",ur="[object RegExp]",Kn="[object Set]",Jt="[object String]",ze="[object Symbol]",tn="[object WeakMap]",Dn="[object ArrayBuffer]",Un="[object DataView]",Po=/^\[object .+?Constructor\]$/,rh=/^(?:0|[1-9]\d*)$/,fn={};fn["[object Float32Array]"]=fn["[object Float64Array]"]=fn["[object Int8Array]"]=fn["[object Int16Array]"]=fn["[object Int32Array]"]=fn["[object Uint8Array]"]=fn["[object Uint8ClampedArray]"]=fn["[object Uint16Array]"]=fn["[object Uint32Array]"]=!0,fn[It]=fn[Ct]=fn[Dn]=fn[Dt]=fn[Un]=fn[re]=fn[ae]=fn[we]=fn[Ee]=fn[_e]=fn[sr]=fn[ur]=fn[Kn]=fn[Jt]=fn[tn]=!1;var xu=typeof Id=="object"&&Id&&Id.Object===Object&&Id,nh=typeof self=="object"&&self&&self.Object===Object&&self,Ao=xu||nh||Function("return this")(),Pa=D&&!D.nodeType&&D,Tr=Pa&&T&&!T.nodeType&&T,ec=Tr&&Tr.exports===Pa,mo=ec&&xu.process,Lo=function(){try{return mo&&mo.binding&&mo.binding("util")}catch{}}(),ih=Lo&&Lo.isTypedArray;function oh(Lt,Xt){for(var ge=-1,We=Lt==null?0:Lt.length;++ge<We;)if(Xt(Lt[ge],ge,Lt))return!0;return!1}function sh(Lt){var Xt=-1,ge=Array(Lt.size);return Lt.forEach(function(We,En){ge[++Xt]=[En,We]}),ge}function hp(Lt){var Xt=-1,ge=Array(Lt.size);return Lt.forEach(function(We){ge[++Xt]=We}),ge}var ah,rc,lh,pp=Array.prototype,uh=Function.prototype,nc=Object.prototype,ch=Ao["__core-js_shared__"],Ul=uh.toString,oa=nc.hasOwnProperty,rd=(ah=/[^.]+$/.exec(ch&&ch.keys&&ch.keys.IE_PROTO||""))?"Symbol(src)_1."+ah:"",nd=nc.toString,Ef=RegExp("^"+Ul.call(oa).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),id=ec?Ao.Buffer:void 0,hh=Ao.Symbol,ph=Ao.Uint8Array,ic=nc.propertyIsEnumerable,dp=pp.splice,Aa=hh?hh.toStringTag:void 0,jl=Object.getOwnPropertySymbols,od=id?id.isBuffer:void 0,sd=(rc=Object.keys,lh=Object,function(Lt){return rc(lh(Lt))}),oc=Vl(Ao,"DataView"),Ds=Vl(Ao,"Map"),dh=Vl(Ao,"Promise"),sa=Vl(Ao,"Set"),rl=Vl(Ao,"WeakMap"),bu=Vl(Object,"create"),fp=sl(oc),Gr=sl(Ds),Nn=sl(dh),Sf=sl(sa),Cr=sl(rl),nl=hh?hh.prototype:void 0,wn=nl?nl.valueOf:void 0;function en(Lt){var Xt=-1,ge=Lt==null?0:Lt.length;for(this.clear();++Xt<ge;){var We=Lt[Xt];this.set(We[0],We[1])}}function Ho(Lt){var Xt=-1,ge=Lt==null?0:Lt.length;for(this.clear();++Xt<ge;){var We=Lt[Xt];this.set(We[0],We[1])}}function il(Lt){var Xt=-1,ge=Lt==null?0:Lt.length;for(this.clear();++Xt<ge;){var We=Lt[Xt];this.set(We[0],We[1])}}function wu(Lt){var Xt=-1,ge=Lt==null?0:Lt.length;for(this.__data__=new il;++Xt<ge;)this.add(Lt[Xt])}function Ns(Lt){var Xt=this.__data__=new Ho(Lt);this.size=Xt.size}function fh(Lt,Xt){var ge=Gl(Lt),We=!ge&&vh(Lt),En=!ge&&!We&&xh(Lt),Rr=!ge&&!We&&!En&&Iu(Lt),Zn=ge||We||En||Rr,Jn=Zn?function(rn,Ro){for(var ua=-1,eo=Array(rn);++ua<rn;)eo[ua]=Ro(ua);return eo}(Lt.length,String):[],ui=Jn.length;for(var jn in Lt)!Xt&&!oa.call(Lt,jn)||Zn&&(jn=="length"||En&&(jn=="offset"||jn=="parent")||Rr&&(jn=="buffer"||jn=="byteLength"||jn=="byteOffset")||ld(jn,ui))||Jn.push(jn);return Jn}function Eu(Lt,Xt){for(var ge=Lt.length;ge--;)if(Tu(Lt[ge][0],Xt))return ge;return-1}function ol(Lt){return Lt==null?Lt===void 0?"[object Undefined]":"[object Null]":Aa&&Aa in Object(Lt)?function(Xt){var ge=oa.call(Xt,Aa),We=Xt[Aa];try{Xt[Aa]=void 0;var En=!0}catch{}var Rr=nd.call(Xt);return En&&(ge?Xt[Aa]=We:delete Xt[Aa]),Rr}(Lt):function(Xt){return nd.call(Xt)}(Lt)}function mh(Lt){return la(Lt)&&ol(Lt)==It}function Su(Lt,Xt,ge,We,En){return Lt===Xt||(Lt==null||Xt==null||!la(Lt)&&!la(Xt)?Lt!=Lt&&Xt!=Xt:function(Rr,Zn,Jn,ui,jn,rn){var Ro=Gl(Rr),ua=Gl(Zn),eo=Ro?Ct:aa(Rr),ca=ua?Ct:aa(Zn),Do=(eo=eo==It?sr:eo)==sr,lc=(ca=ca==It?sr:ca)==sr,zi=eo==ca;if(zi&&xh(Rr)){if(!xh(Zn))return!1;Ro=!0,Do=!1}if(zi&&!Do)return rn||(rn=new Ns),Ro||Iu(Rr)?ad(Rr,Zn,Jn,ui,jn,rn):function(yn,nn,cc,ks,ll,ci,be){switch(cc){case Un:if(yn.byteLength!=nn.byteLength||yn.byteOffset!=nn.byteOffset)return!1;yn=yn.buffer,nn=nn.buffer;case Dn:return!(yn.byteLength!=nn.byteLength||!ci(new ph(yn),new ph(nn)));case Dt:case re:case _e:return Tu(+yn,+nn);case ae:return yn.name==nn.name&&yn.message==nn.message;case ur:case Jt:return yn==nn+"";case Ee:var Os=sh;case Kn:var fs=1&ks;if(Os||(Os=hp),yn.size!=nn.size&&!fs)return!1;var Da=be.get(yn);if(Da)return Da==nn;ks|=2,be.set(yn,nn);var ql=ad(Os(yn),Os(nn),ks,ll,ci,be);return be.delete(yn),ql;case ze:if(wn)return wn.call(yn)==wn.call(nn)}return!1}(Rr,Zn,eo,Jn,ui,jn,rn);if(!(1&Jn)){var Yo=Do&&oa.call(Rr,"__wrapped__"),uc=lc&&oa.call(Zn,"__wrapped__");if(Yo||uc){var La=Yo?Rr.value():Rr,Ra=uc?Zn.value():Zn;return rn||(rn=new Ns),jn(La,Ra,Jn,ui,rn)}}return zi?(rn||(rn=new Ns),function(yn,nn,cc,ks,ll,ci){var be=1&cc,Os=gh(yn),fs=Os.length,Da=gh(nn).length;if(fs!=Da&&!be)return!1;for(var ql=fs;ql--;){var pe=Os[ql];if(!(be?pe in nn:oa.call(nn,pe)))return!1}var wh=ci.get(yn);if(wh&&ci.get(nn))return wh==nn;var Cu=!0;ci.set(yn,nn),ci.set(nn,yn);for(var mp=be;++ql<fs;){var Mu=yn[pe=Os[ql]],hc=nn[pe];if(ks)var gp=be?ks(hc,Mu,pe,nn,yn,ci):ks(Mu,hc,pe,yn,nn,ci);if(!(gp===void 0?Mu===hc||ll(Mu,hc,cc,ks,ci):gp)){Cu=!1;break}mp||(mp=pe=="constructor")}if(Cu&&!mp){var pc=yn.constructor,Eh=nn.constructor;pc==Eh||!("constructor"in yn)||!("constructor"in nn)||typeof pc=="function"&&pc instanceof pc&&typeof Eh=="function"&&Eh instanceof Eh||(Cu=!1)}return ci.delete(yn),ci.delete(nn),Cu}(Rr,Zn,Jn,ui,jn,rn)):!1}(Lt,Xt,ge,We,Su,En))}function sc(Lt){return!(!go(Lt)||function(Xt){return!!rd&&rd in Xt}(Lt))&&(kn(Lt)?Ef:Po).test(sl(Lt))}function ac(Lt){if(ge=(Xt=Lt)&&Xt.constructor,We=typeof ge=="function"&&ge.prototype||nc,Xt!==We)return sd(Lt);var Xt,ge,We,En=[];for(var Rr in Object(Lt))oa.call(Lt,Rr)&&Rr!="constructor"&&En.push(Rr);return En}function ad(Lt,Xt,ge,We,En,Rr){var Zn=1&ge,Jn=Lt.length,ui=Xt.length;if(Jn!=ui&&!(Zn&&ui>Jn))return!1;var jn=Rr.get(Lt);if(jn&&Rr.get(Xt))return jn==Xt;var rn=-1,Ro=!0,ua=2&ge?new wu:void 0;for(Rr.set(Lt,Xt),Rr.set(Xt,Lt);++rn<Jn;){var eo=Lt[rn],ca=Xt[rn];if(We)var Do=Zn?We(ca,eo,rn,Xt,Lt,Rr):We(eo,ca,rn,Lt,Xt,Rr);if(Do!==void 0){if(Do)continue;Ro=!1;break}if(ua){if(!oh(Xt,function(lc,zi){if(Yo=zi,!ua.has(Yo)&&(eo===lc||En(eo,lc,ge,We,Rr)))return ua.push(zi);var Yo})){Ro=!1;break}}else if(eo!==ca&&!En(eo,ca,ge,We,Rr)){Ro=!1;break}}return Rr.delete(Lt),Rr.delete(Xt),Ro}function gh(Lt){return function(Xt,ge,We){var En=ge(Xt);return Gl(Xt)?En:function(Rr,Zn){for(var Jn=-1,ui=Zn.length,jn=Rr.length;++Jn<ui;)Rr[jn+Jn]=Zn[Jn];return Rr}(En,We(Xt))}(Lt,bh,_h)}function yh(Lt,Xt){var ge,We,En=Lt.__data__;return((We=typeof(ge=Xt))=="string"||We=="number"||We=="symbol"||We=="boolean"?ge!=="__proto__":ge===null)?En[typeof Xt=="string"?"string":"hash"]:En.map}function Vl(Lt,Xt){var ge=function(We,En){return We==null?void 0:We[En]}(Lt,Xt);return sc(ge)?ge:void 0}en.prototype.clear=function(){this.__data__=bu?bu(null):{},this.size=0},en.prototype.delete=function(Lt){var Xt=this.has(Lt)&&delete this.__data__[Lt];return this.size-=Xt?1:0,Xt},en.prototype.get=function(Lt){var Xt=this.__data__;if(bu){var ge=Xt[Lt];return ge===Y?void 0:ge}return oa.call(Xt,Lt)?Xt[Lt]:void 0},en.prototype.has=function(Lt){var Xt=this.__data__;return bu?Xt[Lt]!==void 0:oa.call(Xt,Lt)},en.prototype.set=function(Lt,Xt){var ge=this.__data__;return this.size+=this.has(Lt)?0:1,ge[Lt]=bu&&Xt===void 0?Y:Xt,this},Ho.prototype.clear=function(){this.__data__=[],this.size=0},Ho.prototype.delete=function(Lt){var Xt=this.__data__,ge=Eu(Xt,Lt);return!(ge<0)&&(ge==Xt.length-1?Xt.pop():dp.call(Xt,ge,1),--this.size,!0)},Ho.prototype.get=function(Lt){var Xt=this.__data__,ge=Eu(Xt,Lt);return ge<0?void 0:Xt[ge][1]},Ho.prototype.has=function(Lt){return Eu(this.__data__,Lt)>-1},Ho.prototype.set=function(Lt,Xt){var ge=this.__data__,We=Eu(ge,Lt);return We<0?(++this.size,ge.push([Lt,Xt])):ge[We][1]=Xt,this},il.prototype.clear=function(){this.size=0,this.__data__={hash:new en,map:new(Ds||Ho),string:new en}},il.prototype.delete=function(Lt){var Xt=yh(this,Lt).delete(Lt);return this.size-=Xt?1:0,Xt},il.prototype.get=function(Lt){return yh(this,Lt).get(Lt)},il.prototype.has=function(Lt){return yh(this,Lt).has(Lt)},il.prototype.set=function(Lt,Xt){var ge=yh(this,Lt),We=ge.size;return ge.set(Lt,Xt),this.size+=ge.size==We?0:1,this},wu.prototype.add=wu.prototype.push=function(Lt){return this.__data__.set(Lt,Y),this},wu.prototype.has=function(Lt){return this.__data__.has(Lt)},Ns.prototype.clear=function(){this.__data__=new Ho,this.size=0},Ns.prototype.delete=function(Lt){var Xt=this.__data__,ge=Xt.delete(Lt);return this.size=Xt.size,ge},Ns.prototype.get=function(Lt){return this.__data__.get(Lt)},Ns.prototype.has=function(Lt){return this.__data__.has(Lt)},Ns.prototype.set=function(Lt,Xt){var ge=this.__data__;if(ge instanceof Ho){var We=ge.__data__;if(!Ds||We.length<199)return We.push([Lt,Xt]),this.size=++ge.size,this;ge=this.__data__=new il(We)}return ge.set(Lt,Xt),this.size=ge.size,this};var _h=jl?function(Lt){return Lt==null?[]:(Lt=Object(Lt),function(Xt,ge){for(var We=-1,En=Xt==null?0:Xt.length,Rr=0,Zn=[];++We<En;){var Jn=Xt[We];ge(Jn,We,Xt)&&(Zn[Rr++]=Jn)}return Zn}(jl(Lt),function(Xt){return ic.call(Lt,Xt)}))}:function(){return[]},aa=ol;function ld(Lt,Xt){return!!(Xt=Xt??dt)&&(typeof Lt=="number"||rh.test(Lt))&&Lt>-1&&Lt%1==0&&Lt<Xt}function sl(Lt){if(Lt!=null){try{return Ul.call(Lt)}catch{}try{return Lt+""}catch{}}return""}function Tu(Lt,Xt){return Lt===Xt||Lt!=Lt&&Xt!=Xt}(oc&&aa(new oc(new ArrayBuffer(1)))!=Un||Ds&&aa(new Ds)!=Ee||dh&&aa(dh.resolve())!=Rn||sa&&aa(new sa)!=Kn||rl&&aa(new rl)!=tn)&&(aa=function(Lt){var Xt=ol(Lt),ge=Xt==sr?Lt.constructor:void 0,We=ge?sl(ge):"";if(We)switch(We){case fp:return Un;case Gr:return Ee;case Nn:return Rn;case Sf:return Kn;case Cr:return tn}return Xt});var vh=mh(function(){return arguments}())?mh:function(Lt){return la(Lt)&&oa.call(Lt,"callee")&&!ic.call(Lt,"callee")},Gl=Array.isArray,xh=od||function(){return!1};function kn(Lt){if(!go(Lt))return!1;var Xt=ol(Lt);return Xt==we||Xt=="[object GeneratorFunction]"||Xt=="[object AsyncFunction]"||Xt=="[object Proxy]"}function al(Lt){return typeof Lt=="number"&&Lt>-1&&Lt%1==0&&Lt<=dt}function go(Lt){var Xt=typeof Lt;return Lt!=null&&(Xt=="object"||Xt=="function")}function la(Lt){return Lt!=null&&typeof Lt=="object"}var Iu=ih?function(Lt){return function(Xt){return Lt(Xt)}}(ih):function(Lt){return la(Lt)&&al(Lt.length)&&!!fn[ol(Lt)]};function bh(Lt){return(Xt=Lt)!=null&&al(Xt.length)&&!kn(Xt)?fh(Lt):ac(Lt);var Xt}T.exports=function(Lt,Xt){return Su(Lt,Xt)}})(Ma,Ma.exports);var Ln=n(Ma.exports);function Qu(T,D){return T.length===D.length&&JSON.stringify(T.map(function(Y){return Y}).sort())===JSON.stringify(D.map(function(Y){return Y}).sort())}var ds={Polygon:jr,LineString:br,Point:nr,MultiPolygon:hn,MultiLineString:hn,MultiPoint:hn},cp=Object.freeze({__proto__:null,CommonSelectors:In,constrainFeatureMovement:Qa,createMidPoint:Di,createSupplementaryPoints:fo,createVertex:He,doubleClickZoom:Ze,euclideanDistance:Me,featuresAt:Ot,getFeatureAtAndSetCursors:ye,isClick:ir,isEventAtCoordinates:to,isTap:xr,mapEventToBoundingBox:xt,ModeHandler:r,moveFeatures:tl,sortFeatures:J,stringSetsAreEqual:Qu,StringSet:$t,theme:Or,toDenseArray:cr}),el=function(T,D){var Y={options:T=function(It){It===void 0&&(It={});var Ct=Gt(It);return It.controls||(Ct.controls={}),It.displayControlsDefault===!1?Ct.controls=Gt(An,It.controls):Ct.controls=Gt(vu,It.controls),(Ct=Gt(eh,Ct)).styles=Vr(Ct.styles,"cold").concat(Vr(Ct.styles,"hot")),Ct}(T)};D=function(It,Ct){return Ct.modes=W,Ct.getFeatureIdsAt=function(Dt){return Ot.click({point:Dt},null,It).map(function(re){return re.properties.id})},Ct.getSelectedIds=function(){return It.store.getSelectedIds()},Ct.getSelected=function(){return{type:G.FEATURE_COLLECTION,features:It.store.getSelectedIds().map(function(Dt){return It.store.get(Dt)}).map(function(Dt){return Dt.toGeoJSON()})}},Ct.getSelectedPoints=function(){return{type:G.FEATURE_COLLECTION,features:It.store.getSelectedCoordinates().map(function(Dt){return{type:G.FEATURE,properties:{},geometry:{type:G.POINT,coordinates:Dt.coordinates}}})}},Ct.set=function(Dt){if(Dt.type===void 0||Dt.type!==G.FEATURE_COLLECTION||!Array.isArray(Dt.features))throw new Error("Invalid FeatureCollection");var re=It.store.createRenderBatch(),ae=It.store.getAllIds().slice(),we=Ct.add(Dt),Ee=new $t(we);return(ae=ae.filter(function(_e){return!Ee.has(_e)})).length&&Ct.delete(ae),re(),we},Ct.add=function(Dt){var re=JSON.parse(JSON.stringify(X(Dt))).features.map(function(ae){if(ae.id=ae.id||vr(),ae.geometry===null)throw new Error("Invalid geometry: null");if(It.store.get(ae.id)===void 0||It.store.get(ae.id).type!==ae.geometry.type){var we=ds[ae.geometry.type];if(we===void 0)throw new Error("Invalid geometry type: "+ae.geometry.type+".");var Ee=new we(It,ae);It.store.add(Ee)}else{var _e=It.store.get(ae.id);_e.properties=ae.properties,Ln(_e.properties,ae.properties)||It.store.featureChanged(_e.id),Ln(_e.getCoordinates(),ae.geometry.coordinates)||_e.incomingCoords(ae.geometry.coordinates)}return ae.id});return It.store.render(),re},Ct.get=function(Dt){var re=It.store.get(Dt);if(re)return re.toGeoJSON()},Ct.getAll=function(){return{type:G.FEATURE_COLLECTION,features:It.store.getAll().map(function(Dt){return Dt.toGeoJSON()})}},Ct.delete=function(Dt){return It.store.delete(Dt,{silent:!0}),Ct.getMode()!==W.DIRECT_SELECT||It.store.getSelectedIds().length?It.store.render():It.events.changeMode(W.SIMPLE_SELECT,void 0,{silent:!0}),Ct},Ct.deleteAll=function(){return It.store.delete(It.store.getAllIds(),{silent:!0}),Ct.getMode()===W.DIRECT_SELECT?It.events.changeMode(W.SIMPLE_SELECT,void 0,{silent:!0}):It.store.render(),Ct},Ct.changeMode=function(Dt,re){return re===void 0&&(re={}),Dt===W.SIMPLE_SELECT&&Ct.getMode()===W.SIMPLE_SELECT?(Qu(re.featureIds||[],It.store.getSelectedIds())||(It.store.setSelected(re.featureIds,{silent:!0}),It.store.render()),Ct):(Dt===W.DIRECT_SELECT&&Ct.getMode()===W.DIRECT_SELECT&&re.featureId===It.store.getSelectedIds()[0]||It.events.changeMode(Dt,re,{silent:!0}),Ct)},Ct.getMode=function(){return It.events.getMode()},Ct.trash=function(){return It.events.trash({silent:!0}),Ct},Ct.combineFeatures=function(){return It.events.combineFeatures({silent:!0}),Ct},Ct.uncombineFeatures=function(){return It.events.uncombineFeatures({silent:!0}),Ct},Ct.setFeatureProperty=function(Dt,re,ae){return It.store.setFeatureProperty(Dt,re,ae),Ct},Ct}(Y,D),Y.api=D;var dt=xi(Y);return D.onAdd=dt.onAdd,D.onRemove=dt.onRemove,D.types=k,D.options=T,D};function tc(T){el(T,this)}return tc.modes=ki,tc.constants=ot,tc.lib=cp,tc})})(S2);var TP=S2.exports;const P_=E2(TP),IP=Qe.createContext(null);function CP(e,t){const r=Array.isArray(e)?e[0]:e?e.x:0,n=Array.isArray(e)?e[1]:e?e.y:0,i=Array.isArray(t)?t[0]:t?t.x:0,l=Array.isArray(t)?t[1]:t?t.y:0;return r===i&&n===l}function Dc(e,t){if(e===t)return!0;if(!e||!t)return!1;if(Array.isArray(e)){if(!Array.isArray(t)||e.length!==t.length)return!1;for(let r=0;r<e.length;r++)if(!Dc(e[r],t[r]))return!1;return!0}else if(Array.isArray(t))return!1;if(typeof e=="object"&&typeof t=="object"){const r=Object.keys(e),n=Object.keys(t);if(r.length!==n.length)return!1;for(const i of r)if(!t.hasOwnProperty(i)||!Dc(e[i],t[i]))return!1;return!0}return!1}function MP(e){const t=e.clone();return t.pixelsToGLUnits=e.pixelsToGLUnits,t}function lw(e,t){if(!e.getProjection)return;const r=e.getProjection(),n=t.getProjection();Dc(r,n)||t.setProjection(r)}function uw(e){return{longitude:e.center.lng,latitude:e.center.lat,zoom:e.zoom,pitch:e.pitch,bearing:e.bearing,padding:e.padding}}function cw(e,t){const r=t.viewState||t;let n=!1;if("longitude"in r&&"latitude"in r){const i=e.center;e.center=new i.constructor(r.longitude,r.latitude),n=n||i!==e.center}if("zoom"in r){const i=e.zoom;e.zoom=r.zoom,n=n||i!==e.zoom}if("bearing"in r){const i=e.bearing;e.bearing=r.bearing,n=n||i!==e.bearing}if("pitch"in r){const i=e.pitch;e.pitch=r.pitch,n=n||i!==e.pitch}return r.padding&&!e.isPaddingEqual(r.padding)&&(n=!0,e.padding=r.padding),n}const PP=["type","source","source-layer","minzoom","maxzoom","filter","layout"];function hw(e){if(!e)return null;if(typeof e=="string"||("toJS"in e&&(e=e.toJS()),!e.layers))return e;const t={};for(const n of e.layers)t[n.id]=n;const r=e.layers.map(n=>{let i=null;"interactive"in n&&(i=Object.assign({},n),delete i.interactive);const l=t[n.ref];if(l){i=i||Object.assign({},n),delete i.ref;for(const h of PP)h in l&&(i[h]=l[h])}return i||n});return{...e,layers:r}}var pw={};const dw={version:8,sources:{},layers:[]},fw={mousedown:"onMouseDown",mouseup:"onMouseUp",mouseover:"onMouseOver",mousemove:"onMouseMove",click:"onClick",dblclick:"onDblClick",mouseenter:"onMouseEnter",mouseleave:"onMouseLeave",mouseout:"onMouseOut",contextmenu:"onContextMenu",touchstart:"onTouchStart",touchend:"onTouchEnd",touchmove:"onTouchMove",touchcancel:"onTouchCancel"},Y0={movestart:"onMoveStart",move:"onMove",moveend:"onMoveEnd",dragstart:"onDragStart",drag:"onDrag",dragend:"onDragEnd",zoomstart:"onZoomStart",zoom:"onZoom",zoomend:"onZoomEnd",rotatestart:"onRotateStart",rotate:"onRotate",rotateend:"onRotateEnd",pitchstart:"onPitchStart",pitch:"onPitch",pitchend:"onPitchEnd"},mw={wheel:"onWheel",boxzoomstart:"onBoxZoomStart",boxzoomend:"onBoxZoomEnd",boxzoomcancel:"onBoxZoomCancel",resize:"onResize",load:"onLoad",render:"onRender",idle:"onIdle",remove:"onRemove",data:"onData",styledata:"onStyleData",sourcedata:"onSourceData",error:"onError"},AP=["minZoom","maxZoom","minPitch","maxPitch","maxBounds","projection","renderWorldCopies"],LP=["scrollZoom","boxZoom","dragRotate","dragPan","keyboard","doubleClickZoom","touchZoomRotate","touchPitch"];let Tv=class Iv{constructor(t,r,n){this._map=null,this._internalUpdate=!1,this._inRender=!1,this._hoveredFeatures=null,this._deferredEvents={move:!1,zoom:!1,pitch:!1,rotate:!1},this._onEvent=i=>{const l=this.props[mw[i.type]];l?l(i):i.type==="error"&&console.error(i.error)},this._onPointerEvent=i=>{(i.type==="mousemove"||i.type==="mouseout")&&this._updateHover(i);const l=this.props[fw[i.type]];l&&(this.props.interactiveLayerIds&&i.type!=="mouseover"&&i.type!=="mouseout"&&(i.features=this._hoveredFeatures||this._queryRenderedFeatures(i.point)),l(i),delete i.features)},this._onCameraEvent=i=>{if(!this._internalUpdate){const l=this.props[Y0[i.type]];l&&l(i)}i.type in this._deferredEvents&&(this._deferredEvents[i.type]=!1)},this._MapClass=t,this.props=r,this._initialize(n)}get map(){return this._map}get transform(){return this._renderTransform}setProps(t){const r=this.props;this.props=t;const n=this._updateSettings(t,r);n&&this._createShadowTransform(this._map);const i=this._updateSize(t),l=this._updateViewState(t,!0);this._updateStyle(t,r),this._updateStyleComponents(t,r),this._updateHandlers(t,r),(n||i||l&&!this._map.isMoving())&&this.redraw()}static reuse(t,r){const n=Iv.savedMaps.pop();if(!n)return null;const i=n.map,l=i.getContainer();for(r.className=l.className;l.childNodes.length>0;)r.appendChild(l.childNodes[0]);i._container=r;const h=i._resizeObserver;h&&(h.disconnect(),h.observe(r)),n.setProps({...t,styleDiffing:!1}),i.resize();const{initialViewState:a}=t;return a&&(a.bounds?i.fitBounds(a.bounds,{...a.fitBoundsOptions,duration:0}):n._updateViewState(a,!1)),i.isStyleLoaded()?i.fire("load"):i.once("styledata",()=>i.fire("load")),i._update(),n}_initialize(t){const{props:r}=this,{mapStyle:n=dw}=r,i={...r,...r.initialViewState,accessToken:r.mapboxAccessToken||RP()||null,container:t,style:hw(n)},l=i.initialViewState||i.viewState||i;if(Object.assign(i,{center:[l.longitude||0,l.latitude||0],zoom:l.zoom||0,pitch:l.pitch||0,bearing:l.bearing||0}),r.gl){const E=HTMLCanvasElement.prototype.getContext;HTMLCanvasElement.prototype.getContext=()=>(HTMLCanvasElement.prototype.getContext=E,r.gl)}const h=new this._MapClass(i);l.padding&&h.setPadding(l.padding),r.cursor&&(h.getCanvas().style.cursor=r.cursor),this._createShadowTransform(h);const a=h._render;h._render=E=>{this._inRender=!0,a.call(h,E),this._inRender=!1};const g=h._renderTaskQueue.run;h._renderTaskQueue.run=E=>{g.call(h._renderTaskQueue,E),this._onBeforeRepaint()},h.on("render",()=>this._onAfterRepaint());const _=h.fire;h.fire=this._fireEvent.bind(this,_),h.on("resize",()=>{this._renderTransform.resize(h.transform.width,h.transform.height)}),h.on("styledata",()=>{this._updateStyleComponents(this.props,{}),lw(h.transform,this._renderTransform)}),h.on("sourcedata",()=>this._updateStyleComponents(this.props,{}));for(const E in fw)h.on(E,this._onPointerEvent);for(const E in Y0)h.on(E,this._onCameraEvent);for(const E in mw)h.on(E,this._onEvent);this._map=h}recycle(){const t=this.map.getContainer().querySelector("[mapboxgl-children]");t==null||t.remove(),Iv.savedMaps.push(this)}destroy(){this._map.remove()}redraw(){const t=this._map;!this._inRender&&t.style&&(t._frame&&(t._frame.cancel(),t._frame=null),t._render())}_createShadowTransform(t){const r=MP(t.transform);t.painter.transform=r,this._renderTransform=r}_updateSize(t){const{viewState:r}=t;if(r){const n=this._map;if(r.width!==n.transform.width||r.height!==n.transform.height)return n.resize(),!0}return!1}_updateViewState(t,r){if(this._internalUpdate)return!1;const n=this._map,i=this._renderTransform,{zoom:l,pitch:h,bearing:a}=i,g=n.isMoving();g&&(i.cameraElevationReference="sea");const _=cw(i,{...uw(n.transform),...t});if(g&&(i.cameraElevationReference="ground"),_&&r){const E=this._deferredEvents;E.move=!0,E.zoom||(E.zoom=l!==i.zoom),E.rotate||(E.rotate=a!==i.bearing),E.pitch||(E.pitch=h!==i.pitch)}return g||cw(n.transform,t),_}_updateSettings(t,r){const n=this._map;let i=!1;for(const l of AP)if(l in t&&!Dc(t[l],r[l])){i=!0;const h=n[`set${l[0].toUpperCase()}${l.slice(1)}`];h==null||h.call(n,t[l])}return i}_updateStyle(t,r){if(t.cursor!==r.cursor&&(this._map.getCanvas().style.cursor=t.cursor||""),t.mapStyle!==r.mapStyle){const{mapStyle:n=dw,styleDiffing:i=!0}=t,l={diff:i};return"localIdeographFontFamily"in t&&(l.localIdeographFontFamily=t.localIdeographFontFamily),this._map.setStyle(hw(n),l),!0}return!1}_updateStyleComponents(t,r){const n=this._map;let i=!1;return n.isStyleLoaded()&&("light"in t&&n.setLight&&!Dc(t.light,r.light)&&(i=!0,n.setLight(t.light)),"fog"in t&&n.setFog&&!Dc(t.fog,r.fog)&&(i=!0,n.setFog(t.fog)),"terrain"in t&&n.setTerrain&&!Dc(t.terrain,r.terrain)&&(!t.terrain||n.getSource(t.terrain.source))&&(i=!0,n.setTerrain(t.terrain))),i}_updateHandlers(t,r){var n,i;const l=this._map;let h=!1;for(const a of LP){const g=(n=t[a])!==null&&n!==void 0?n:!0,_=(i=r[a])!==null&&i!==void 0?i:!0;Dc(g,_)||(h=!0,g?l[a].enable(g):l[a].disable())}return h}_queryRenderedFeatures(t){const r=this._map,n=r.transform,{interactiveLayerIds:i=[]}=this.props;try{return r.transform=this._renderTransform,r.queryRenderedFeatures(t,{layers:i.filter(r.getLayer.bind(r))})}catch{return[]}finally{r.transform=n}}_updateHover(t){var r;const{props:n}=this;if(n.interactiveLayerIds&&(n.onMouseMove||n.onMouseEnter||n.onMouseLeave)){const i=t.type,l=((r=this._hoveredFeatures)===null||r===void 0?void 0:r.length)>0,h=this._queryRenderedFeatures(t.point),a=h.length>0;!a&&l&&(t.type="mouseleave",this._onPointerEvent(t)),this._hoveredFeatures=h,a&&!l&&(t.type="mouseenter",this._onPointerEvent(t)),t.type=i}else this._hoveredFeatures=null}_fireEvent(t,r,n){const i=this._map,l=i.transform,h=typeof r=="string"?r:r.type;return h==="move"&&this._updateViewState(this.props,!1),h in Y0&&(typeof r=="object"&&(r.viewState=uw(l)),this._map.isMoving())?(i.transform=this._renderTransform,t.call(i,r,n),i.transform=l,i):(t.call(i,r,n),i)}_onBeforeRepaint(){const t=this._map;this._internalUpdate=!0;for(const n in this._deferredEvents)this._deferredEvents[n]&&t.fire(n);this._internalUpdate=!1;const r=this._map.transform;t.transform=this._renderTransform,this._onAfterRepaint=()=>{lw(this._renderTransform,r),t.transform=r}}};Tv.savedMaps=[];function RP(){let e=null;if(typeof location<"u"){const t=/access_token=([^&\/]*)/.exec(location.search);e=t&&t[1]}try{e=e||pw.MapboxAccessToken}catch{}try{e=e||pw.REACT_APP_MAPBOX_ACCESS_TOKEN}catch{}return e}const DP=["setMaxBounds","setMinZoom","setMaxZoom","setMinPitch","setMaxPitch","setRenderWorldCopies","setProjection","setStyle","addSource","removeSource","addLayer","removeLayer","setLayerZoomRange","setFilter","setPaintProperty","setLayoutProperty","setLight","setTerrain","setFog","remove"];function NP(e){if(!e)return null;const t=e.map,r={getMap:()=>t,getCenter:()=>e.transform.center,getZoom:()=>e.transform.zoom,getBearing:()=>e.transform.bearing,getPitch:()=>e.transform.pitch,getPadding:()=>e.transform.padding,getBounds:()=>e.transform.getBounds(),project:n=>{const i=t.transform;t.transform=e.transform;const l=t.project(n);return t.transform=i,l},unproject:n=>{const i=t.transform;t.transform=e.transform;const l=t.unproject(n);return t.transform=i,l},queryTerrainElevation:(n,i)=>{const l=t.transform;t.transform=e.transform;const h=t.queryTerrainElevation(n,i);return t.transform=l,h},queryRenderedFeatures:(n,i)=>{const l=t.transform;t.transform=e.transform;const h=t.queryRenderedFeatures(n,i);return t.transform=l,h}};for(const n of kP(t))!(n in r)&&!DP.includes(n)&&(r[n]=t[n].bind(t));return r}function kP(e){const t=new Set;let r=e;for(;r;){for(const n of Object.getOwnPropertyNames(r))n[0]!=="_"&&typeof e[n]=="function"&&n!=="fire"&&n!=="setEventedParent"&&t.add(n);r=Object.getPrototypeOf(r)}return Array.from(t)}const OP=typeof document<"u"?Qe.useLayoutEffect:Qe.useEffect,FP=["baseApiUrl","maxParallelImageRequests","workerClass","workerCount","workerUrl"];function zP(e,t){for(const n of FP)n in t&&(e[n]=t[n]);const{RTLTextPlugin:r="https://api.mapbox.com/mapbox-gl-js/plugins/mapbox-gl-rtl-text/v0.2.3/mapbox-gl-rtl-text.js"}=t;r&&e.getRTLTextPluginStatus&&e.getRTLTextPluginStatus()==="unavailable"&&e.setRTLTextPlugin(r,n=>{n&&console.error(n)},!0)}const A_=Qe.createContext(null);function T2(e,t,r){const n=Qe.useContext(IP),[i,l]=Qe.useState(null),h=Qe.useRef(),{current:a}=Qe.useRef({mapLib:null,map:null});Qe.useEffect(()=>{const E=e.mapLib;let S=!0,A;return Promise.resolve(E||r).then(O=>{if(!S)return;if(!O)throw new Error("Invalid mapLib");const k="Map"in O?O:O.default;if(!k.Map)throw new Error("Invalid mapLib");if(zP(k,e),!k.supported||k.supported(e))e.reuseMaps&&(A=Tv.reuse(e,h.current)),A||(A=new Tv(k.Map,e,h.current)),a.map=NP(A),a.mapLib=k,l(A),n==null||n.onMapMount(a.map,e.id);else throw new Error("Map is not supported by this browser")}).catch(O=>{const{onError:k}=e;k?k({type:"error",target:null,originalEvent:null,error:O}):console.error(O)}),()=>{S=!1,A&&(n==null||n.onMapUnmount(e.id),e.reuseMaps?A.recycle():A.destroy())}},[]),OP(()=>{i&&i.setProps(e)}),Qe.useImperativeHandle(t,()=>a.map,[i]);const g=Qe.useMemo(()=>({position:"relative",width:"100%",height:"100%",...e.style}),[e.style]),_={height:"100%"};return Qe.createElement("div",{id:e.id,ref:h,style:g},i&&Qe.createElement(A_.Provider,{value:a},Qe.createElement("div",{"mapboxgl-children":"",style:_},e.children)))}const BP=/box|flex|grid|column|lineHeight|fontWeight|opacity|order|tabSize|zIndex/;function Zp(e,t){if(!e||!t)return;const r=e.style;for(const n in t){const i=t[n];Number.isFinite(i)&&!BP.test(n)?r[n]=`${i}px`:r[n]=i}}function $P(e,t){const{map:r,mapLib:n}=Qe.useContext(A_),i=Qe.useRef({props:e});i.current.props=e;const l=Qe.useMemo(()=>{let G=!1;Qe.Children.forEach(e.children,tt=>{tt&&(G=!0)});const W={...e,element:G?document.createElement("div"):null},U=new n.Marker(W);return U.setLngLat([e.longitude,e.latitude]),U.getElement().addEventListener("click",tt=>{var $,V;(V=($=i.current.props).onClick)===null||V===void 0||V.call($,{type:"click",target:U,originalEvent:tt})}),U.on("dragstart",tt=>{var $,V;const it=tt;it.lngLat=l.getLngLat(),(V=($=i.current.props).onDragStart)===null||V===void 0||V.call($,it)}),U.on("drag",tt=>{var $,V;const it=tt;it.lngLat=l.getLngLat(),(V=($=i.current.props).onDrag)===null||V===void 0||V.call($,it)}),U.on("dragend",tt=>{var $,V;const it=tt;it.lngLat=l.getLngLat(),(V=($=i.current.props).onDragEnd)===null||V===void 0||V.call($,it)}),U},[]);Qe.useEffect(()=>(l.addTo(r.getMap()),()=>{l.remove()}),[]);const{longitude:h,latitude:a,offset:g,style:_,draggable:E=!1,popup:S=null,rotation:A=0,rotationAlignment:O="auto",pitchAlignment:k="auto"}=e;return Qe.useEffect(()=>{Zp(l.getElement(),_)},[_]),Qe.useImperativeHandle(t,()=>l,[]),(l.getLngLat().lng!==h||l.getLngLat().lat!==a)&&l.setLngLat([h,a]),g&&!CP(l.getOffset(),g)&&l.setOffset(g),l.isDraggable()!==E&&l.setDraggable(E),l.getRotation()!==A&&l.setRotation(A),l.getRotationAlignment()!==O&&l.setRotationAlignment(O),l.getPitchAlignment()!==k&&l.setPitchAlignment(k),l.getPopup()!==S&&l.setPopup(S),b2.createPortal(e.children,l.getElement())}Qe.memo(Qe.forwardRef($P));function gw(e){return new Set(e?e.trim().split(/\s+/):[])}function UP(e,t){const{map:r,mapLib:n}=Qe.useContext(A_),i=Qe.useMemo(()=>document.createElement("div"),[]),l=Qe.useRef({props:e});l.current.props=e;const h=Qe.useMemo(()=>{const a={...e},g=new n.Popup(a);return g.setLngLat([e.longitude,e.latitude]),g.once("open",_=>{var E,S;(S=(E=l.current.props).onOpen)===null||S===void 0||S.call(E,_)}),g},[]);if(Qe.useEffect(()=>{const a=g=>{var _,E;(E=(_=l.current.props).onClose)===null||E===void 0||E.call(_,g)};return h.on("close",a),h.setDOMContent(i).addTo(r.getMap()),()=>{h.off("close",a),h.isOpen()&&h.remove()}},[]),Qe.useEffect(()=>{Zp(h.getElement(),e.style)},[e.style]),Qe.useImperativeHandle(t,()=>h,[]),h.isOpen()&&((h.getLngLat().lng!==e.longitude||h.getLngLat().lat!==e.latitude)&&h.setLngLat([e.longitude,e.latitude]),e.offset&&!Dc(h.options.offset,e.offset)&&h.setOffset(e.offset),(h.options.anchor!==e.anchor||h.options.maxWidth!==e.maxWidth)&&(h.options.anchor=e.anchor,h.setMaxWidth(e.maxWidth)),h.options.className!==e.className)){const a=gw(h.options.className),g=gw(e.className);for(const _ of a)g.has(_)||h.removeClassName(_);for(const _ of g)a.has(_)||h.addClassName(_);h.options.className=e.className}return b2.createPortal(e.children,i)}Qe.memo(Qe.forwardRef(UP));function Wp(e,t,r,n){const i=Qe.useContext(A_),l=Qe.useMemo(()=>e(i),[]);return Qe.useEffect(()=>{const h=n||r||t,a=typeof t=="function"&&typeof r=="function"?t:null,g=typeof r=="function"?r:typeof t=="function"?t:null,{map:_}=i;return _.hasControl(l)||(_.addControl(l,h==null?void 0:h.position),a&&a(i)),()=>{g&&g(i),_.hasControl(l)&&_.removeControl(l)}},[]),l}function jP(e){const t=Wp(({mapLib:r})=>new r.AttributionControl(e),{position:e.position});return Qe.useEffect(()=>{Zp(t._container,e.style)},[e.style]),null}Qe.memo(jP);function VP(e){const t=Wp(({mapLib:r})=>new r.FullscreenControl({container:e.containerId&&document.getElementById(e.containerId)}),{position:e.position});return Qe.useEffect(()=>{Zp(t._controlContainer,e.style)},[e.style]),null}Qe.memo(VP);function GP(e,t){const r=Qe.useRef({props:e}),n=Wp(({mapLib:i})=>{const l=new i.GeolocateControl(e),h=l._setupUI;return l._setupUI=a=>{l._container.hasChildNodes()||h(a)},l.on("geolocate",a=>{var g,_;(_=(g=r.current.props).onGeolocate)===null||_===void 0||_.call(g,a)}),l.on("error",a=>{var g,_;(_=(g=r.current.props).onError)===null||_===void 0||_.call(g,a)}),l.on("outofmaxbounds",a=>{var g,_;(_=(g=r.current.props).onOutOfMaxBounds)===null||_===void 0||_.call(g,a)}),l.on("trackuserlocationstart",a=>{var g,_;(_=(g=r.current.props).onTrackUserLocationStart)===null||_===void 0||_.call(g,a)}),l.on("trackuserlocationend",a=>{var g,_;(_=(g=r.current.props).onTrackUserLocationEnd)===null||_===void 0||_.call(g,a)}),l},{position:e.position});return r.current.props=e,Qe.useImperativeHandle(t,()=>n,[]),Qe.useEffect(()=>{Zp(n._container,e.style)},[e.style]),null}Qe.memo(Qe.forwardRef(GP));function qP(e){const t=Wp(({mapLib:r})=>new r.NavigationControl(e),{position:e.position});return Qe.useEffect(()=>{Zp(t._container,e.style)},[e.style]),null}Qe.memo(qP);function ZP(e){const t=Wp(({mapLib:l})=>new l.ScaleControl(e),{position:e.position}),r=Qe.useRef(e),n=r.current;r.current=e;const{style:i}=e;return e.maxWidth!==void 0&&e.maxWidth!==n.maxWidth&&(t.options.maxWidth=e.maxWidth),e.unit!==void 0&&e.unit!==n.unit&&t.setUnit(e.unit),Qe.useEffect(()=>{Zp(t._container,i)},[i]),null}Qe.memo(ZP);const WP=w2(()=>import("./index.es79-KR_AuFpw.js"),__vite__mapDeps([]),import.meta.url).then(e=>e.i);Qe.forwardRef(function(e,t){return T2(e,t,WP)});Qe.forwardRef((e,t)=>{const r=Wp(()=>new P_(e),({map:n})=>{n.on("draw.create",e.onCreate),n.on("draw.update",e.onUpdate),n.on("draw.delete",e.onDelete)},({map:n})=>{n.off("draw.create",e.onCreate),n.off("draw.update",e.onUpdate),n.off("draw.delete",e.onDelete)},{position:e.position});return Qe.useImperativeHandle(t,()=>r,[r]),null});var I2={exports:{}},im={},yw;function XP(){if(yw)return im;yw=1;/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var e=Sv,t=Symbol.for("react.element"),r=Symbol.for("react.fragment"),n=Object.prototype.hasOwnProperty,i=e.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,l={key:!0,ref:!0,__self:!0,__source:!0};function h(a,g,_){var E,S={},A=null,O=null;_!==void 0&&(A=""+_),g.key!==void 0&&(A=""+g.key),g.ref!==void 0&&(O=g.ref);for(E in g)n.call(g,E)&&!l.hasOwnProperty(E)&&(S[E]=g[E]);if(a&&a.defaultProps)for(E in g=a.defaultProps,g)S[E]===void 0&&(S[E]=g[E]);return{$$typeof:t,type:a,key:A,ref:O,props:S,_owner:i.current}}return im.Fragment=r,im.jsx=h,im.jsxs=h,im}I2.exports=XP();var ny=I2.exports;const HP={type:"circle",paint:{"circle-radius":["interpolate",["linear"],["number",["get","point_count"],1],0,4,10,14],"circle-stroke-width":1,"circle-color":["case",["boolean",["feature-state","hover"],!1],"#3b62ff","#ff623b"],"circle-stroke-color":"#8d260c"}},YP={type:"fill",paint:{"fill-color":"#ff623b","fill-opacity":.2}},KP={type:"line",paint:{"line-color":"#ff623b","line-opacity":.6}},Od={point:HP,fill:YP,stroke:KP};Od.fill.paint,Od.point.paint,Od.stroke.paint;var C2={exports:{}};function JP(e,t){for(var r=0;r<t.length;r++){const n=t[r];if(typeof n!="string"&&!Array.isArray(n)){for(const i in n)if(i!=="default"&&!(i in e)){const l=Object.getOwnPropertyDescriptor(n,i);l&&Object.defineProperty(e,i,l.get?l:{enumerable:!0,get:()=>n[i]})}}}return Object.freeze(Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}))}(function(e,t){(function(r,n){e.exports=n()})(Id,function(){var r,n,i;function l(a,g){if(!r)r=g;else if(!n)n=g;else{var _="var sharedChunk = {}; ("+r+")(sharedChunk); ("+n+")(sharedChunk);",E={};r(E),i=g(E),typeof window<"u"&&(i.workerUrl=window.URL.createObjectURL(new Blob([_],{type:"text/javascript"})))}}l(["exports"],function(a){function g(u,o,c,d){return new(c||(c=Promise))(function(m,b){function w(R){try{P(d.next(R))}catch(F){b(F)}}function I(R){try{P(d.throw(R))}catch(F){b(F)}}function P(R){var F;R.done?m(R.value):(F=R.value,F instanceof c?F:new c(function(j){j(F)})).then(w,I)}P((d=d.apply(u,o||[])).next())})}function _(u){return u&&u.__esModule&&Object.prototype.hasOwnProperty.call(u,"default")?u.default:u}typeof SuppressedError=="function"&&SuppressedError;var E=S;function S(u,o){this.x=u,this.y=o}S.prototype={clone:function(){return new S(this.x,this.y)},add:function(u){return this.clone()._add(u)},sub:function(u){return this.clone()._sub(u)},multByPoint:function(u){return this.clone()._multByPoint(u)},divByPoint:function(u){return this.clone()._divByPoint(u)},mult:function(u){return this.clone()._mult(u)},div:function(u){return this.clone()._div(u)},rotate:function(u){return this.clone()._rotate(u)},rotateAround:function(u,o){return this.clone()._rotateAround(u,o)},matMult:function(u){return this.clone()._matMult(u)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(u){return this.x===u.x&&this.y===u.y},dist:function(u){return Math.sqrt(this.distSqr(u))},distSqr:function(u){var o=u.x-this.x,c=u.y-this.y;return o*o+c*c},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(u){return Math.atan2(this.y-u.y,this.x-u.x)},angleWith:function(u){return this.angleWithSep(u.x,u.y)},angleWithSep:function(u,o){return Math.atan2(this.x*o-this.y*u,this.x*u+this.y*o)},_matMult:function(u){var o=u[2]*this.x+u[3]*this.y;return this.x=u[0]*this.x+u[1]*this.y,this.y=o,this},_add:function(u){return this.x+=u.x,this.y+=u.y,this},_sub:function(u){return this.x-=u.x,this.y-=u.y,this},_mult:function(u){return this.x*=u,this.y*=u,this},_div:function(u){return this.x/=u,this.y/=u,this},_multByPoint:function(u){return this.x*=u.x,this.y*=u.y,this},_divByPoint:function(u){return this.x/=u.x,this.y/=u.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var u=this.y;return this.y=this.x,this.x=-u,this},_rotate:function(u){var o=Math.cos(u),c=Math.sin(u),d=c*this.x+o*this.y;return this.x=o*this.x-c*this.y,this.y=d,this},_rotateAround:function(u,o){var c=Math.cos(u),d=Math.sin(u),m=o.y+d*(this.x-o.x)+c*(this.y-o.y);return this.x=o.x+c*(this.x-o.x)-d*(this.y-o.y),this.y=m,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},S.convert=function(u){return u instanceof S?u:Array.isArray(u)?new S(u[0],u[1]):u};var A=_(E),O=k;function k(u,o,c,d){this.cx=3*u,this.bx=3*(c-u)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*o,this.by=3*(d-o)-this.cy,this.ay=1-this.cy-this.by,this.p1x=u,this.p1y=o,this.p2x=c,this.p2y=d}k.prototype={sampleCurveX:function(u){return((this.ax*u+this.bx)*u+this.cx)*u},sampleCurveY:function(u){return((this.ay*u+this.by)*u+this.cy)*u},sampleCurveDerivativeX:function(u){return(3*this.ax*u+2*this.bx)*u+this.cx},solveCurveX:function(u,o){if(o===void 0&&(o=1e-6),u<0)return 0;if(u>1)return 1;for(var c=u,d=0;d<8;d++){var m=this.sampleCurveX(c)-u;if(Math.abs(m)<o)return c;var b=this.sampleCurveDerivativeX(c);if(Math.abs(b)<1e-6)break;c-=m/b}var w=0,I=1;for(c=u,d=0;d<20&&(m=this.sampleCurveX(c),!(Math.abs(m-u)<o));d++)u>m?w=c:I=c,c=.5*(I-w)+w;return c},solve:function(u,o){return this.sampleCurveY(this.solveCurveX(u,o))}};var G=_(O);let W,U;function tt(){return W==null&&(W=typeof OffscreenCanvas<"u"&&new OffscreenCanvas(1,1).getContext("2d")&&typeof createImageBitmap=="function"),W}function $(){if(U==null&&(U=!1,tt())){const u=new OffscreenCanvas(5,5).getContext("2d",{willReadFrequently:!0});if(u){for(let c=0;c<5*5;c++){const d=4*c;u.fillStyle=`rgb(${d},${d+1},${d+2})`,u.fillRect(c%5,Math.floor(c/5),1,1)}const o=u.getImageData(0,0,5,5).data;for(let c=0;c<5*5*4;c++)if(c%4!=3&&o[c]!==c){U=!0;break}}}return U||!1}function V(u,o,c,d){const m=new G(u,o,c,d);return function(b){return m.solve(b)}}const it=V(.25,.1,.25,1);function vt(u,o,c){return Math.min(c,Math.max(o,u))}function ot(u,o,c){const d=c-o,m=((u-o)%d+d)%d+o;return m===o?c:m}function et(u,...o){for(const c of o)for(const d in c)u[d]=c[d];return u}let wt=1;function J(u,o,c){const d={};for(const m in u)d[m]=o.call(c||this,u[m],m,u);return d}function xt(u,o,c){const d={};for(const m in u)o.call(c||this,u[m],m,u)&&(d[m]=u[m]);return d}function $t(u){return Array.isArray(u)?u.map($t):typeof u=="object"&&u?J(u,$t):u}const Ut={};function Ot(u){Ut[u]||(typeof console<"u"&&console.warn(u),Ut[u]=!0)}function te(u,o,c){return(c.y-u.y)*(o.x-u.x)>(o.y-u.y)*(c.x-u.x)}function ye(u){let o=0;for(let c,d,m=0,b=u.length,w=b-1;m<b;w=m++)c=u[m],d=u[w],o+=(d.x-c.x)*(c.y+d.y);return o}function Me(){return typeof WorkerGlobalScope<"u"&&typeof self<"u"&&self instanceof WorkerGlobalScope}let ir=null;function xr(u){return typeof ImageBitmap<"u"&&u instanceof ImageBitmap}const _r="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";function kr(u,o,c,d,m){return g(this,void 0,void 0,function*(){if(typeof VideoFrame>"u")throw new Error("VideoFrame not supported");const b=new VideoFrame(u,{timestamp:0});try{const w=b==null?void 0:b.format;if(!w||!w.startsWith("BGR")&&!w.startsWith("RGB"))throw new Error(`Unrecognized format ${w}`);const I=w.startsWith("BGR"),P=new Uint8ClampedArray(d*m*4);if(yield b.copyTo(P,function(R,F,j,Z,K){const Q=4*Math.max(-F,0),at=(Math.max(0,j)-j)*Z*4+Q,gt=4*Z,_t=Math.max(0,F),At=Math.max(0,j);return{rect:{x:_t,y:At,width:Math.min(R.width,F+Z)-_t,height:Math.min(R.height,j+K)-At},layout:[{offset:at,stride:gt}]}}(u,o,c,d,m)),I)for(let R=0;R<P.length;R+=4){const F=P[R];P[R]=P[R+2],P[R+2]=F}return P}finally{b.close()}})}let vr,ue,nr,br;const jr={now:typeof performance<"u"&&performance&&performance.now?performance.now.bind(performance):Date.now.bind(Date),frame(u){const o=requestAnimationFrame(u);return{cancel:()=>cancelAnimationFrame(o)}},getImageData(u,o=0){return this.getImageCanvasContext(u).getImageData(-o,-o,u.width+2*o,u.height+2*o)},getImageCanvasContext(u){const o=window.document.createElement("canvas"),c=o.getContext("2d",{willReadFrequently:!0});if(!c)throw new Error("failed to create canvas 2d context");return o.width=u.width,o.height=u.height,c.drawImage(u,0,0,u.width,u.height),c},resolveURL:u=>(nr||(nr=document.createElement("a")),nr.href=u,nr.href),hardwareConcurrency:typeof navigator<"u"&&navigator.hardwareConcurrency||4,get prefersReducedMotion(){return!!matchMedia&&(br==null&&(br=matchMedia("(prefers-reduced-motion: reduce)")),br.matches)}},ln={MAX_PARALLEL_IMAGE_REQUESTS:16,MAX_PARALLEL_IMAGE_REQUESTS_PER_FRAME:8,MAX_TILE_CACHE_ZOOM_LEVELS:5,REGISTERED_PROTOCOLS:{},WORKER_URL:""};class co extends Error{constructor(o,c,d,m){super(`AJAXError: ${c} (${o}): ${d}`),this.status=o,this.statusText=c,this.url=d,this.body=m}}const hn=Me()?()=>self.worker&&self.worker.referrer:()=>(window.location.protocol==="blob:"?window.parent:window).location.href,Ye=u=>ln.REGISTERED_PROTOCOLS[u.substring(0,u.indexOf("://"))];function na(u,o){const c=new AbortController,d=new Request(u.url,{method:u.method||"GET",body:u.body,credentials:u.credentials,headers:u.headers,cache:u.cache,referrer:hn(),signal:c.signal});let m=!1,b=!1;return u.type==="json"&&d.headers.set("Accept","application/json"),b||fetch(d).then(w=>w.ok?(I=>{(u.type==="arrayBuffer"||u.type==="image"?I.arrayBuffer():u.type==="json"?I.json():I.text()).then(P=>{b||(m=!0,o(null,P,I.headers.get("Cache-Control"),I.headers.get("Expires")))}).catch(P=>{b||o(new Error(P.message))})})(w):w.blob().then(I=>o(new co(w.status,w.statusText,u.url,I)))).catch(w=>{w.code!==20&&o(new Error(w.message))}),{cancel:()=>{b=!0,m||c.abort()}}}const ls=function(u,o){if(/:\/\//.test(u.url)&&!/^https?:|^file:/.test(u.url)){if(Me()&&self.worker&&self.worker.actor)return self.worker.actor.send("getResource",u,o);if(!Me())return(Ye(u.url)||na)(u,o)}if(!(/^file:/.test(c=u.url)||/^file:/.test(hn())&&!/^\w+:/.test(c))){if(fetch&&Request&&AbortController&&Object.prototype.hasOwnProperty.call(Request.prototype,"signal"))return na(u,o);if(Me()&&self.worker&&self.worker.actor)return self.worker.actor.send("getResource",u,o,void 0,!0)}var c;return function(d,m){const b=new XMLHttpRequest;b.open(d.method||"GET",d.url,!0),d.type!=="arrayBuffer"&&d.type!=="image"||(b.responseType="arraybuffer");for(const w in d.headers)b.setRequestHeader(w,d.headers[w]);return d.type==="json"&&(b.responseType="text",b.setRequestHeader("Accept","application/json")),b.withCredentials=d.credentials==="include",b.onerror=()=>{m(new Error(b.statusText))},b.onload=()=>{if((b.status>=200&&b.status<300||b.status===0)&&b.response!==null){let w=b.response;if(d.type==="json")try{w=JSON.parse(b.response)}catch(I){return m(I)}m(null,w,b.getResponseHeader("Cache-Control"),b.getResponseHeader("Expires"))}else{const w=new Blob([b.response],{type:b.getResponseHeader("Content-Type")});m(new co(b.status,b.statusText,d.url,w))}},b.send(d.body),{cancel:()=>b.abort()}}(u,o)},Io=function(u,o){return ls(et(u,{type:"arrayBuffer"}),o)};function cr(u){if(!u||u.indexOf("://")<=0||u.indexOf("data:image/")===0||u.indexOf("blob:")===0)return!0;const o=new URL(u),c=window.location;return o.protocol===c.protocol&&o.host===c.host}function pn(u,o,c){c[u]&&c[u].indexOf(o)!==-1||(c[u]=c[u]||[],c[u].push(o))}function Re(u,o,c){if(c&&c[u]){const d=c[u].indexOf(o);d!==-1&&c[u].splice(d,1)}}class us{constructor(o,c={}){et(this,c),this.type=o}}class _i extends us{constructor(o,c={}){super("error",et({error:o},c))}}class Kr{on(o,c){return this._listeners=this._listeners||{},pn(o,c,this._listeners),this}off(o,c){return Re(o,c,this._listeners),Re(o,c,this._oneTimeListeners),this}once(o,c){return c?(this._oneTimeListeners=this._oneTimeListeners||{},pn(o,c,this._oneTimeListeners),this):new Promise(d=>this.once(o,d))}fire(o,c){typeof o=="string"&&(o=new us(o,c||{}));const d=o.type;if(this.listens(d)){o.target=this;const m=this._listeners&&this._listeners[d]?this._listeners[d].slice():[];for(const I of m)I.call(this,o);const b=this._oneTimeListeners&&this._oneTimeListeners[d]?this._oneTimeListeners[d].slice():[];for(const I of b)Re(d,I,this._oneTimeListeners),I.call(this,o);const w=this._eventedParent;w&&(et(o,typeof this._eventedParentData=="function"?this._eventedParentData():this._eventedParentData),w.fire(o))}else o instanceof _i&&console.error(o.error);return this}listens(o){return this._listeners&&this._listeners[o]&&this._listeners[o].length>0||this._oneTimeListeners&&this._oneTimeListeners[o]&&this._oneTimeListeners[o].length>0||this._eventedParent&&this._eventedParent.listens(o)}setEventedParent(o,c){return this._eventedParent=o,this._eventedParentData=c,this}}var Gt={$version:8,$root:{version:{required:!0,type:"enum",values:[8]},name:{type:"string"},metadata:{type:"*"},center:{type:"array",value:"number"},zoom:{type:"number"},bearing:{type:"number",default:0,period:360,units:"degrees"},pitch:{type:"number",default:0,units:"degrees"},light:{type:"light"},terrain:{type:"terrain"},sources:{required:!0,type:"sources"},sprite:{type:"sprite"},glyphs:{type:"string"},transition:{type:"transition"},layers:{required:!0,type:"array",value:"layer"}},sources:{"*":{type:"source"}},source:["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],source_vector:{type:{required:!0,type:"enum",values:{vector:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},attribution:{type:"string"},promoteId:{type:"promoteId"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster:{type:{required:!0,type:"enum",values:{raster:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},attribution:{type:"string"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster_dem:{type:{required:!0,type:"enum",values:{"raster-dem":{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},attribution:{type:"string"},encoding:{type:"enum",values:{terrarium:{},mapbox:{},custom:{}},default:"mapbox"},redFactor:{type:"number",default:1},blueFactor:{type:"number",default:1},greenFactor:{type:"number",default:1},baseShift:{type:"number",default:0},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_geojson:{type:{required:!0,type:"enum",values:{geojson:{}}},data:{required:!0,type:"*"},maxzoom:{type:"number",default:18},attribution:{type:"string"},buffer:{type:"number",default:128,maximum:512,minimum:0},filter:{type:"*"},tolerance:{type:"number",default:.375},cluster:{type:"boolean",default:!1},clusterRadius:{type:"number",default:50,minimum:0},clusterMaxZoom:{type:"number"},clusterMinPoints:{type:"number"},clusterProperties:{type:"*"},lineMetrics:{type:"boolean",default:!1},generateId:{type:"boolean",default:!1},promoteId:{type:"promoteId"}},source_video:{type:{required:!0,type:"enum",values:{video:{}}},urls:{required:!0,type:"array",value:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},source_image:{type:{required:!0,type:"enum",values:{image:{}}},url:{required:!0,type:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},layer:{id:{type:"string",required:!0},type:{type:"enum",values:{fill:{},line:{},symbol:{},circle:{},heatmap:{},"fill-extrusion":{},raster:{},hillshade:{},background:{}},required:!0},metadata:{type:"*"},source:{type:"string"},"source-layer":{type:"string"},minzoom:{type:"number",minimum:0,maximum:24},maxzoom:{type:"number",minimum:0,maximum:24},filter:{type:"filter"},layout:{type:"layout"},paint:{type:"paint"}},layout:["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_background"],layout_background:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_fill:{"fill-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_circle:{"circle-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_heatmap:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},"layout_fill-extrusion":{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_line:{"line-cap":{type:"enum",values:{butt:{},round:{},square:{}},default:"butt",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-join":{type:"enum",values:{bevel:{},round:{},miter:{}},default:"miter",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{type:"number",default:2,requires:[{"line-join":"miter"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-round-limit":{type:"number",default:1.05,requires:[{"line-join":"round"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_symbol:{"symbol-placement":{type:"enum",values:{point:{},line:{},"line-center":{}},default:"point",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-spacing":{type:"number",default:250,minimum:1,units:"pixels",requires:[{"symbol-placement":"line"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{type:"boolean",default:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{type:"enum",values:{auto:{},"viewport-y":{},source:{}},default:"auto",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{type:"boolean",default:!1,requires:["icon-image",{"!":"icon-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{type:"boolean",default:!1,requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-optional":{type:"boolean",default:!1,requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-size":{type:"number",default:1,minimum:0,units:"factor of the original icon size",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{type:"enum",values:{none:{},width:{},height:{},both:{}},default:"none",requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{type:"array",value:"number",length:4,default:[0,0,0,0],units:"pixels",requires:["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-image":{type:"resolvedImage",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{type:"padding",default:[2],units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-keep-upright":{type:"boolean",default:!1,requires:["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-offset":{type:"array",value:"number",length:2,default:[0,0],requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{type:"enum",values:{map:{},viewport:{},"viewport-glyph":{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-field":{type:"formatted",default:"",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-font":{type:"array",value:"string",default:["Open Sans Regular","Arial Unicode MS Regular"],requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-size":{type:"number",default:16,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{type:"number",default:10,minimum:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{type:"number",default:1.2,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-letter-spacing":{type:"number",default:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-justify":{type:"enum",values:{auto:{},left:{},center:{},right:{}},default:"center",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{type:"number",units:"ems",default:0,requires:["text-field"],"property-type":"data-driven",expression:{interpolated:!0,parameters:["zoom","feature"]}},"text-variable-anchor":{type:"array",value:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-variable-anchor-offset":{type:"variableAnchorOffsetCollection",requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["text-field",{"!":"text-variable-anchor"}],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{type:"number",default:45,units:"degrees",requires:["text-field",{"symbol-placement":["line","line-center"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-writing-mode":{type:"array",value:"enum",values:{horizontal:{},vertical:{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-padding":{type:"number",default:2,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-keep-upright":{type:"boolean",default:!0,requires:["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-transform":{type:"enum",values:{none:{},uppercase:{},lowercase:{}},default:"none",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-offset":{type:"array",value:"number",units:"ems",length:2,default:[0,0],requires:["text-field",{"!":"text-radial-offset"}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{type:"boolean",default:!1,requires:["text-field",{"!":"text-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{type:"boolean",default:!1,requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-optional":{type:"boolean",default:!1,requires:["text-field","icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_raster:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_hillshade:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},filter:{type:"array",value:"*"},filter_operator:{type:"enum",values:{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},in:{},"!in":{},all:{},any:{},none:{},has:{},"!has":{},within:{}}},geometry_type:{type:"enum",values:{Point:{},LineString:{},Polygon:{}}},function:{expression:{type:"expression"},stops:{type:"array",value:"function_stop"},base:{type:"number",default:1,minimum:0},property:{type:"string",default:"$zoom"},type:{type:"enum",values:{identity:{},exponential:{},interval:{},categorical:{}},default:"exponential"},colorSpace:{type:"enum",values:{rgb:{},lab:{},hcl:{}},default:"rgb"},default:{type:"*",required:!1}},function_stop:{type:"array",minimum:0,maximum:24,value:["number","color"],length:2},expression:{type:"array",value:"*",minimum:1},light:{anchor:{type:"enum",default:"viewport",values:{map:{},viewport:{}},"property-type":"data-constant",transition:!1,expression:{interpolated:!1,parameters:["zoom"]}},position:{type:"array",default:[1.15,210,30],length:3,value:"number","property-type":"data-constant",transition:!0,expression:{interpolated:!0,parameters:["zoom"]}},color:{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},intensity:{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},terrain:{source:{type:"string",required:!0},exaggeration:{type:"number",minimum:0,default:1}},paint:["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_background"],paint_fill:{"fill-antialias":{type:"boolean",default:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{type:"color",transition:!0,requires:[{"!":"fill-pattern"},{"fill-antialias":!0}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-extrusion-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-extrusion-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"fill-extrusion-height":{type:"number",default:0,minimum:0,units:"meters",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{type:"number",default:0,minimum:0,units:"meters",transition:!0,requires:["fill-extrusion-height"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{type:"boolean",default:!0,transition:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_line:{"line-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"line-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["line-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-width":{type:"number",default:1,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{type:"number",default:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{type:"array",value:"number",minimum:0,transition:!0,units:"line widths",requires:[{"!":"line-pattern"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"line-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-gradient":{type:"color",transition:!1,requires:[{"!":"line-dasharray"},{"!":"line-pattern"},{source:"geojson",has:{lineMetrics:!0}}],expression:{interpolated:!0,parameters:["line-progress"]},"property-type":"color-ramp"}},paint_circle:{"circle-radius":{type:"number",default:5,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{type:"number",default:0,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["circle-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{type:"enum",values:{map:{},viewport:{}},default:"map",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"}},paint_heatmap:{"heatmap-radius":{type:"number",default:30,minimum:1,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{type:"number",default:1,minimum:0,transition:!1,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{type:"number",default:1,minimum:0,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"heatmap-color":{type:"color",default:["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",.1,"royalblue",.3,"cyan",.5,"lime",.7,"yellow",1,"red"],transition:!1,expression:{interpolated:!0,parameters:["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_symbol:{"icon-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{type:"color",default:"#000000",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["icon-image","icon-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{type:"color",default:"#000000",transition:!0,overridable:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["text-field","text-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_raster:{"raster-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{type:"number",default:0,period:360,transition:!0,units:"degrees",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{type:"number",default:0,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-saturation":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-contrast":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-resampling":{type:"enum",values:{linear:{},nearest:{}},default:"linear",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{type:"number",default:300,minimum:0,transition:!1,units:"milliseconds",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_hillshade:{"hillshade-illumination-direction":{type:"number",default:335,minimum:0,maximum:359,transition:!1,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{type:"number",default:.5,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{type:"color",default:"#FFFFFF",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_background:{"background-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"background-pattern"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"background-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"background-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},transition:{duration:{type:"number",default:300,minimum:0,units:"milliseconds"},delay:{type:"number",default:0,minimum:0,units:"milliseconds"}},"property-type":{"data-driven":{type:"property-type"},"cross-faded":{type:"property-type"},"cross-faded-data-driven":{type:"property-type"},"color-ramp":{type:"property-type"},"data-constant":{type:"property-type"},constant:{type:"property-type"}},promoteId:{"*":{type:"string"}}};const vi=["type","source","source-layer","minzoom","maxzoom","filter","layout"];function xi(u,o){const c={};for(const d in u)d!=="ref"&&(c[d]=u[d]);return vi.forEach(d=>{d in o&&(c[d]=o[d])}),c}function Or(u,o){if(Array.isArray(u)){if(!Array.isArray(o)||u.length!==o.length)return!1;for(let c=0;c<u.length;c++)if(!Or(u[c],o[c]))return!1;return!0}if(typeof u=="object"&&u!==null&&o!==null){if(typeof o!="object"||Object.keys(u).length!==Object.keys(o).length)return!1;for(const c in u)if(!Or(u[c],o[c]))return!1;return!0}return u===o}const yr={setStyle:"setStyle",addLayer:"addLayer",removeLayer:"removeLayer",setPaintProperty:"setPaintProperty",setLayoutProperty:"setLayoutProperty",setFilter:"setFilter",addSource:"addSource",removeSource:"removeSource",setGeoJSONSourceData:"setGeoJSONSourceData",setLayerZoomRange:"setLayerZoomRange",setLayerProperty:"setLayerProperty",setCenter:"setCenter",setZoom:"setZoom",setBearing:"setBearing",setPitch:"setPitch",setSprite:"setSprite",setGlyphs:"setGlyphs",setTransition:"setTransition",setLight:"setLight"};function ho(u,o,c){c.push({command:yr.addSource,args:[u,o[u]]})}function Co(u,o,c){o.push({command:yr.removeSource,args:[u]}),c[u]=!0}function ai(u,o,c,d){Co(u,c,d),ho(u,o,c)}function ia(u,o,c){let d;for(d in u[c])if(Object.prototype.hasOwnProperty.call(u[c],d)&&d!=="data"&&!Or(u[c][d],o[c][d]))return!1;for(d in o[c])if(Object.prototype.hasOwnProperty.call(o[c],d)&&d!=="data"&&!Or(u[c][d],o[c][d]))return!1;return!0}function cs(u,o,c,d,m,b){let w;for(w in o=o||{},u=u||{})Object.prototype.hasOwnProperty.call(u,w)&&(Or(u[w],o[w])||c.push({command:b,args:[d,w,o[w],m]}));for(w in o)Object.prototype.hasOwnProperty.call(o,w)&&!Object.prototype.hasOwnProperty.call(u,w)&&(Or(u[w],o[w])||c.push({command:b,args:[d,w,o[w],m]}))}function Ji(u){return u.id}function hs(u,o){return u[o.id]=o,u}class oe{constructor(o,c,d,m){this.message=(o?`${o}: `:"")+d,m&&(this.identifier=m),c!=null&&c.__line__&&(this.line=c.__line__)}}function po(u,...o){for(const c of o)for(const d in c)u[d]=c[d];return u}class In extends Error{constructor(o,c){super(c),this.message=c,this.key=o}}class Ls{constructor(o,c=[]){this.parent=o,this.bindings={};for(const[d,m]of c)this.bindings[d]=m}concat(o){return new Ls(this,o)}get(o){if(this.bindings[o])return this.bindings[o];if(this.parent)return this.parent.get(o);throw new Error(`${o} not found in scope.`)}has(o){return!!this.bindings[o]||!!this.parent&&this.parent.has(o)}}const Ri={kind:"null"},ce={kind:"number"},ar={kind:"string"},He={kind:"boolean"},Di={kind:"color"},fo={kind:"object"},Ze={kind:"value"},Mo={kind:"collator"},ct={kind:"formatted"},q={kind:"padding"},X={kind:"resolvedImage"},nt={kind:"variableAnchorOffsetCollection"};function pt(u,o){return{kind:"array",itemType:u,N:o}}function ft(u){if(u.kind==="array"){const o=ft(u.itemType);return typeof u.N=="number"?`array<${o}, ${u.N}>`:u.itemType.kind==="value"?"array":`array<${o}>`}return u.kind}const rt=[Ri,ce,ar,He,Di,ct,fo,pt(Ze),q,X,nt];function bt(u,o){if(o.kind==="error")return null;if(u.kind==="array"){if(o.kind==="array"&&(o.N===0&&o.itemType.kind==="value"||!bt(u.itemType,o.itemType))&&(typeof u.N!="number"||u.N===o.N))return null}else{if(u.kind===o.kind)return null;if(u.kind==="value"){for(const c of rt)if(!bt(c,o))return null}}return`Expected ${ft(u)} but found ${ft(o)} instead.`}function mt(u,o){return o.some(c=>c.kind===u.kind)}function Et(u,o){return o.some(c=>c==="null"?u===null:c==="array"?Array.isArray(u):c==="object"?u&&!Array.isArray(u)&&typeof u=="object":c===typeof u)}function zt(u,o){return u.kind==="array"&&o.kind==="array"?u.itemType.kind===o.itemType.kind&&typeof u.N=="number":u.kind===o.kind}const Zt=.96422,Ht=.82521,De=4/29,Xe=6/29,Ce=3*Xe*Xe,Ue=Xe*Xe*Xe,or=Math.PI/180,Jr=180/Math.PI;function fr(u){return(u%=360)<0&&(u+=360),u}function Fr([u,o,c,d]){let m,b;const w=Qi((.2225045*(u=Lr(u))+.7168786*(o=Lr(o))+.0606169*(c=Lr(c)))/1);u===o&&o===c?m=b=w:(m=Qi((.4360747*u+.3850649*o+.1430804*c)/Zt),b=Qi((.0139322*u+.0971045*o+.7141733*c)/Ht));const I=116*w-16;return[I<0?0:I,500*(m-w),200*(w-b),d]}function Lr(u){return u<=.04045?u/12.92:Math.pow((u+.055)/1.055,2.4)}function Qi(u){return u>Ue?Math.pow(u,1/3):u/Ce+De}function dn([u,o,c,d]){let m=(u+16)/116,b=isNaN(o)?m:m+o/500,w=isNaN(c)?m:m-c/200;return m=1*bi(m),b=Zt*bi(b),w=Ht*bi(w),[li(3.1338561*b-1.6168667*m-.4906146*w),li(-.9787684*b+1.9161415*m+.033454*w),li(.0719453*b-.2289914*m+1.4052427*w),d]}function li(u){return(u=u<=.00304?12.92*u:1.055*Math.pow(u,1/2.4)-.055)<0?0:u>1?1:u}function bi(u){return u>Xe?u*u*u:Ce*(u-De)}function ps(u){return parseInt(u.padEnd(2,u),16)/255}function Ju(u,o){return Qa(o?u/100:u,0,1)}function Qa(u,o,c){return Math.min(Math.max(o,u),c)}function tl(u){return!u.some(Number.isNaN)}const wi={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]};class Qr{constructor(o,c,d,m=1,b=!0){this.r=o,this.g=c,this.b=d,this.a=m,b||(this.r*=m,this.g*=m,this.b*=m,m||this.overwriteGetter("rgb",[o,c,d,m]))}static parse(o){if(o instanceof Qr)return o;if(typeof o!="string")return;const c=function(d){if((d=d.toLowerCase().trim())==="transparent")return[0,0,0,0];const m=wi[d];if(m){const[w,I,P]=m;return[w/255,I/255,P/255,1]}if(d.startsWith("#")&&/^#(?:[0-9a-f]{3,4}|[0-9a-f]{6}|[0-9a-f]{8})$/.test(d)){const w=d.length<6?1:2;let I=1;return[ps(d.slice(I,I+=w)),ps(d.slice(I,I+=w)),ps(d.slice(I,I+=w)),ps(d.slice(I,I+w)||"ff")]}if(d.startsWith("rgb")){const w=d.match(/^rgba?\(\s*([\de.+-]+)(%)?(?:\s+|\s*(,)\s*)([\de.+-]+)(%)?(?:\s+|\s*(,)\s*)([\de.+-]+)(%)?(?:\s*([,\/])\s*([\de.+-]+)(%)?)?\s*\)$/);if(w){const[I,P,R,F,j,Z,K,Q,at,gt,_t,At]=w,Tt=[F||" ",K||" ",gt].join("");if(Tt==="  "||Tt==="  /"||Tt===",,"||Tt===",,,"){const Rt=[R,Z,at].join(""),jt=Rt==="%%%"?100:Rt===""?255:0;if(jt){const Kt=[Qa(+P/jt,0,1),Qa(+j/jt,0,1),Qa(+Q/jt,0,1),_t?Ju(+_t,At):1];if(tl(Kt))return Kt}}return}}const b=d.match(/^hsla?\(\s*([\de.+-]+)(?:deg)?(?:\s+|\s*(,)\s*)([\de.+-]+)%(?:\s+|\s*(,)\s*)([\de.+-]+)%(?:\s*([,\/])\s*([\de.+-]+)(%)?)?\s*\)$/);if(b){const[w,I,P,R,F,j,Z,K,Q]=b,at=[P||" ",F||" ",Z].join("");if(at==="  "||at==="  /"||at===",,"||at===",,,"){const gt=[+I,Qa(+R,0,100),Qa(+j,0,100),K?Ju(+K,Q):1];if(tl(gt))return function([_t,At,Tt,Rt]){function jt(Kt){const Te=(Kt+_t/30)%12,Oe=At*Math.min(Tt,1-Tt);return Tt-Oe*Math.max(-1,Math.min(Te-3,9-Te,1))}return _t=fr(_t),At/=100,Tt/=100,[jt(0),jt(8),jt(4),Rt]}(gt)}}}(o);return c?new Qr(...c,!1):void 0}get rgb(){const{r:o,g:c,b:d,a:m}=this,b=m||1/0;return this.overwriteGetter("rgb",[o/b,c/b,d/b,m])}get hcl(){return this.overwriteGetter("hcl",function(o){const[c,d,m,b]=Fr(o),w=Math.sqrt(d*d+m*m);return[Math.round(1e4*w)?fr(Math.atan2(m,d)*Jr):NaN,w,c,b]}(this.rgb))}get lab(){return this.overwriteGetter("lab",Fr(this.rgb))}overwriteGetter(o,c){return Object.defineProperty(this,o,{value:c}),c}toString(){const[o,c,d,m]=this.rgb;return`rgba(${[o,c,d].map(b=>Math.round(255*b)).join(",")},${m})`}}Qr.black=new Qr(0,0,0,1),Qr.white=new Qr(1,1,1,1),Qr.transparent=new Qr(0,0,0,0),Qr.red=new Qr(1,0,0,1);class th{constructor(o,c,d){this.sensitivity=o?c?"variant":"case":c?"accent":"base",this.locale=d,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(o,c){return this.collator.compare(o,c)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}class Rs{constructor(o,c,d,m,b){this.text=o,this.image=c,this.scale=d,this.fontStack=m,this.textColor=b}}class Cn{constructor(o){this.sections=o}static fromString(o){return new Cn([new Rs(o,null,null,null,null)])}isEmpty(){return this.sections.length===0||!this.sections.some(o=>o.text.length!==0||o.image&&o.image.name.length!==0)}static factory(o){return o instanceof Cn?o:Cn.fromString(o)}toString(){return this.sections.length===0?"":this.sections.map(o=>o.text).join("")}}class to{constructor(o){this.values=o.slice()}static parse(o){if(o instanceof to)return o;if(typeof o=="number")return new to([o,o,o,o]);if(Array.isArray(o)&&!(o.length<1||o.length>4)){for(const c of o)if(typeof c!="number")return;switch(o.length){case 1:o=[o[0],o[0],o[0],o[0]];break;case 2:o=[o[0],o[1],o[0],o[1]];break;case 3:o=[o[0],o[1],o[2],o[1]]}return new to(o)}}toString(){return JSON.stringify(this.values)}}const $l=new Set(["center","left","right","top","bottom","top-left","top-right","bottom-left","bottom-right"]);class Ni{constructor(o){this.values=o.slice()}static parse(o){if(o instanceof Ni)return o;if(Array.isArray(o)&&!(o.length<1)&&o.length%2==0){for(let c=0;c<o.length;c+=2){const d=o[c],m=o[c+1];if(typeof d!="string"||!$l.has(d)||!Array.isArray(m)||m.length!==2||typeof m[0]!="number"||typeof m[1]!="number")return}return new Ni(o)}}toString(){return JSON.stringify(this.values)}}class ki{constructor(o){this.name=o.name,this.available=o.available}toString(){return this.name}static fromString(o){return o?new ki({name:o,available:!1}):null}}function eh(u,o,c,d){return typeof u=="number"&&u>=0&&u<=255&&typeof o=="number"&&o>=0&&o<=255&&typeof c=="number"&&c>=0&&c<=255?d===void 0||typeof d=="number"&&d>=0&&d<=1?null:`Invalid rgba value [${[u,o,c,d].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${(typeof d=="number"?[u,o,c,d]:[u,o,c]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function vu(u){if(u===null||typeof u=="string"||typeof u=="boolean"||typeof u=="number"||u instanceof Qr||u instanceof th||u instanceof Cn||u instanceof to||u instanceof Ni||u instanceof ki)return!0;if(Array.isArray(u)){for(const o of u)if(!vu(o))return!1;return!0}if(typeof u=="object"){for(const o in u)if(!vu(u[o]))return!1;return!0}return!1}function An(u){if(u===null)return Ri;if(typeof u=="string")return ar;if(typeof u=="boolean")return He;if(typeof u=="number")return ce;if(u instanceof Qr)return Di;if(u instanceof th)return Mo;if(u instanceof Cn)return ct;if(u instanceof to)return q;if(u instanceof Ni)return nt;if(u instanceof ki)return X;if(Array.isArray(u)){const o=u.length;let c;for(const d of u){const m=An(d);if(c){if(c===m)continue;c=Ze;break}c=m}return pt(c||Ze,o)}return fo}function Vr(u){const o=typeof u;return u===null?"":o==="string"||o==="number"||o==="boolean"?String(u):u instanceof Qr||u instanceof Cn||u instanceof to||u instanceof Ni||u instanceof ki?u.toString():JSON.stringify(u)}class Ma{constructor(o,c){this.type=o,this.value=c}static parse(o,c){if(o.length!==2)return c.error(`'literal' expression requires exactly one argument, but found ${o.length-1} instead.`);if(!vu(o[1]))return c.error("invalid value");const d=o[1];let m=An(d);const b=c.expectedType;return m.kind!=="array"||m.N!==0||!b||b.kind!=="array"||typeof b.N=="number"&&b.N!==0||(m=b),new Ma(m,d)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}}class Ln{constructor(o){this.name="ExpressionEvaluationError",this.message=o}toJSON(){return this.message}}const Qu={string:ar,number:ce,boolean:He,object:fo};class ds{constructor(o,c){this.type=o,this.args=c}static parse(o,c){if(o.length<2)return c.error("Expected at least one argument.");let d,m=1;const b=o[0];if(b==="array"){let I,P;if(o.length>2){const R=o[1];if(typeof R!="string"||!(R in Qu)||R==="object")return c.error('The item type argument of "array" must be one of string, number, boolean',1);I=Qu[R],m++}else I=Ze;if(o.length>3){if(o[2]!==null&&(typeof o[2]!="number"||o[2]<0||o[2]!==Math.floor(o[2])))return c.error('The length argument to "array" must be a positive integer literal',2);P=o[2],m++}d=pt(I,P)}else{if(!Qu[b])throw new Error(`Types doesn't contain name = ${b}`);d=Qu[b]}const w=[];for(;m<o.length;m++){const I=c.parse(o[m],m,Ze);if(!I)return null;w.push(I)}return new ds(d,w)}evaluate(o){for(let c=0;c<this.args.length;c++){const d=this.args[c].evaluate(o);if(!bt(this.type,An(d)))return d;if(c===this.args.length-1)throw new Ln(`Expected value to be of type ${ft(this.type)}, but found ${ft(An(d))} instead.`)}throw new Error}eachChild(o){this.args.forEach(o)}outputDefined(){return this.args.every(o=>o.outputDefined())}}const cp={"to-boolean":He,"to-color":Di,"to-number":ce,"to-string":ar};class el{constructor(o,c){this.type=o,this.args=c}static parse(o,c){if(o.length<2)return c.error("Expected at least one argument.");const d=o[0];if(!cp[d])throw new Error(`Can't parse ${d} as it is not part of the known types`);if((d==="to-boolean"||d==="to-string")&&o.length!==2)return c.error("Expected one argument.");const m=cp[d],b=[];for(let w=1;w<o.length;w++){const I=c.parse(o[w],w,Ze);if(!I)return null;b.push(I)}return new el(m,b)}evaluate(o){switch(this.type.kind){case"boolean":return!!this.args[0].evaluate(o);case"color":{let c,d;for(const m of this.args){if(c=m.evaluate(o),d=null,c instanceof Qr)return c;if(typeof c=="string"){const b=o.parseColor(c);if(b)return b}else if(Array.isArray(c)&&(d=c.length<3||c.length>4?`Invalid rbga value ${JSON.stringify(c)}: expected an array containing either three or four numeric values.`:eh(c[0],c[1],c[2],c[3]),!d))return new Qr(c[0]/255,c[1]/255,c[2]/255,c[3])}throw new Ln(d||`Could not parse color from value '${typeof c=="string"?c:JSON.stringify(c)}'`)}case"padding":{let c;for(const d of this.args){c=d.evaluate(o);const m=to.parse(c);if(m)return m}throw new Ln(`Could not parse padding from value '${typeof c=="string"?c:JSON.stringify(c)}'`)}case"variableAnchorOffsetCollection":{let c;for(const d of this.args){c=d.evaluate(o);const m=Ni.parse(c);if(m)return m}throw new Ln(`Could not parse variableAnchorOffsetCollection from value '${typeof c=="string"?c:JSON.stringify(c)}'`)}case"number":{let c=null;for(const d of this.args){if(c=d.evaluate(o),c===null)return 0;const m=Number(c);if(!isNaN(m))return m}throw new Ln(`Could not convert ${JSON.stringify(c)} to number.`)}case"formatted":return Cn.fromString(Vr(this.args[0].evaluate(o)));case"resolvedImage":return ki.fromString(Vr(this.args[0].evaluate(o)));default:return Vr(this.args[0].evaluate(o))}}eachChild(o){this.args.forEach(o)}outputDefined(){return this.args.every(o=>o.outputDefined())}}const tc=["Unknown","Point","LineString","Polygon"];class T{constructor(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null}id(){return this.feature&&"id"in this.feature?this.feature.id:null}geometryType(){return this.feature?typeof this.feature.type=="number"?tc[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}parseColor(o){let c=this._parseColorCache[o];return c||(c=this._parseColorCache[o]=Qr.parse(o)),c}}class D{constructor(o,c,d=[],m,b=new Ls,w=[]){this.registry=o,this.path=d,this.key=d.map(I=>`[${I}]`).join(""),this.scope=b,this.errors=w,this.expectedType=m,this._isConstant=c}parse(o,c,d,m,b={}){return c?this.concat(c,d,m)._parse(o,b):this._parse(o,b)}_parse(o,c){function d(m,b,w){return w==="assert"?new ds(b,[m]):w==="coerce"?new el(b,[m]):m}if(o!==null&&typeof o!="string"&&typeof o!="boolean"&&typeof o!="number"||(o=["literal",o]),Array.isArray(o)){if(o.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const m=o[0];if(typeof m!="string")return this.error(`Expression name must be a string, but found ${typeof m} instead. If you wanted a literal array, use ["literal", [...]].`,0),null;const b=this.registry[m];if(b){let w=b.parse(o,this);if(!w)return null;if(this.expectedType){const I=this.expectedType,P=w.type;if(I.kind!=="string"&&I.kind!=="number"&&I.kind!=="boolean"&&I.kind!=="object"&&I.kind!=="array"||P.kind!=="value")if(I.kind!=="color"&&I.kind!=="formatted"&&I.kind!=="resolvedImage"||P.kind!=="value"&&P.kind!=="string")if(I.kind!=="padding"||P.kind!=="value"&&P.kind!=="number"&&P.kind!=="array")if(I.kind!=="variableAnchorOffsetCollection"||P.kind!=="value"&&P.kind!=="array"){if(this.checkSubtype(I,P))return null}else w=d(w,I,c.typeAnnotation||"coerce");else w=d(w,I,c.typeAnnotation||"coerce");else w=d(w,I,c.typeAnnotation||"coerce");else w=d(w,I,c.typeAnnotation||"assert")}if(!(w instanceof Ma)&&w.type.kind!=="resolvedImage"&&this._isConstant(w)){const I=new T;try{w=new Ma(w.type,w.evaluate(I))}catch(P){return this.error(P.message),null}}return w}return this.error(`Unknown expression "${m}". If you wanted a literal array, use ["literal", [...]].`,0)}return this.error(o===void 0?"'undefined' value invalid. Use null instead.":typeof o=="object"?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof o} instead.`)}concat(o,c,d){const m=typeof o=="number"?this.path.concat(o):this.path,b=d?this.scope.concat(d):this.scope;return new D(this.registry,this._isConstant,m,c||null,b,this.errors)}error(o,...c){const d=`${this.key}${c.map(m=>`[${m}]`).join("")}`;this.errors.push(new In(d,o))}checkSubtype(o,c){const d=bt(o,c);return d&&this.error(d),d}}class Y{constructor(o,c,d){this.type=Mo,this.locale=d,this.caseSensitive=o,this.diacriticSensitive=c}static parse(o,c){if(o.length!==2)return c.error("Expected one argument.");const d=o[1];if(typeof d!="object"||Array.isArray(d))return c.error("Collator options argument must be an object.");const m=c.parse(d["case-sensitive"]!==void 0&&d["case-sensitive"],1,He);if(!m)return null;const b=c.parse(d["diacritic-sensitive"]!==void 0&&d["diacritic-sensitive"],1,He);if(!b)return null;let w=null;return d.locale&&(w=c.parse(d.locale,1,ar),!w)?null:new Y(m,b,w)}evaluate(o){return new th(this.caseSensitive.evaluate(o),this.diacriticSensitive.evaluate(o),this.locale?this.locale.evaluate(o):null)}eachChild(o){o(this.caseSensitive),o(this.diacriticSensitive),this.locale&&o(this.locale)}outputDefined(){return!1}}const dt=8192;function It(u,o){u[0]=Math.min(u[0],o[0]),u[1]=Math.min(u[1],o[1]),u[2]=Math.max(u[2],o[0]),u[3]=Math.max(u[3],o[1])}function Ct(u,o){return!(u[0]<=o[0]||u[2]>=o[2]||u[1]<=o[1]||u[3]>=o[3])}function Dt(u,o){const c=(180+u[0])/360,d=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+u[1]*Math.PI/360)))/360,m=Math.pow(2,o.z);return[Math.round(c*m*dt),Math.round(d*m*dt)]}function re(u,o,c){const d=u[0]-o[0],m=u[1]-o[1],b=u[0]-c[0],w=u[1]-c[1];return d*w-b*m==0&&d*b<=0&&m*w<=0}function ae(u,o){let c=!1;for(let w=0,I=o.length;w<I;w++){const P=o[w];for(let R=0,F=P.length;R<F-1;R++){if(re(u,P[R],P[R+1]))return!1;(m=P[R])[1]>(d=u)[1]!=(b=P[R+1])[1]>d[1]&&d[0]<(b[0]-m[0])*(d[1]-m[1])/(b[1]-m[1])+m[0]&&(c=!c)}}var d,m,b;return c}function we(u,o){for(let c=0;c<o.length;c++)if(ae(u,o[c]))return!0;return!1}function Ee(u,o,c,d){const m=d[0]-c[0],b=d[1]-c[1],w=(u[0]-c[0])*b-m*(u[1]-c[1]),I=(o[0]-c[0])*b-m*(o[1]-c[1]);return w>0&&I<0||w<0&&I>0}function _e(u,o,c){for(const R of c)for(let F=0;F<R.length-1;++F)if((I=[(w=R[F+1])[0]-(b=R[F])[0],w[1]-b[1]])[0]*(P=[(m=o)[0]-(d=u)[0],m[1]-d[1]])[1]-I[1]*P[0]!=0&&Ee(d,m,b,w)&&Ee(b,w,d,m))return!0;var d,m,b,w,I,P;return!1}function sr(u,o){for(let c=0;c<u.length;++c)if(!ae(u[c],o))return!1;for(let c=0;c<u.length-1;++c)if(_e(u[c],u[c+1],o))return!1;return!0}function Rn(u,o){for(let c=0;c<o.length;c++)if(sr(u,o[c]))return!0;return!1}function ur(u,o,c){const d=[];for(let m=0;m<u.length;m++){const b=[];for(let w=0;w<u[m].length;w++){const I=Dt(u[m][w],c);It(o,I),b.push(I)}d.push(b)}return d}function Kn(u,o,c){const d=[];for(let m=0;m<u.length;m++){const b=ur(u[m],o,c);d.push(b)}return d}function Jt(u,o,c,d){if(u[0]<c[0]||u[0]>c[2]){const m=.5*d;let b=u[0]-c[0]>m?-d:c[0]-u[0]>m?d:0;b===0&&(b=u[0]-c[2]>m?-d:c[2]-u[0]>m?d:0),u[0]+=b}It(o,u)}function ze(u,o,c,d){const m=Math.pow(2,d.z)*dt,b=[d.x*dt,d.y*dt],w=[];for(const I of u)for(const P of I){const R=[P.x+b[0],P.y+b[1]];Jt(R,o,c,m),w.push(R)}return w}function tn(u,o,c,d){const m=Math.pow(2,d.z)*dt,b=[d.x*dt,d.y*dt],w=[];for(const P of u){const R=[];for(const F of P){const j=[F.x+b[0],F.y+b[1]];It(o,j),R.push(j)}w.push(R)}if(o[2]-o[0]<=m/2){(I=o)[0]=I[1]=1/0,I[2]=I[3]=-1/0;for(const P of w)for(const R of P)Jt(R,o,c,m)}var I;return w}class Dn{constructor(o,c){this.type=He,this.geojson=o,this.geometries=c}static parse(o,c){if(o.length!==2)return c.error(`'within' expression requires exactly one argument, but found ${o.length-1} instead.`);if(vu(o[1])){const d=o[1];if(d.type==="FeatureCollection")for(let m=0;m<d.features.length;++m){const b=d.features[m].geometry.type;if(b==="Polygon"||b==="MultiPolygon")return new Dn(d,d.features[m].geometry)}else if(d.type==="Feature"){const m=d.geometry.type;if(m==="Polygon"||m==="MultiPolygon")return new Dn(d,d.geometry)}else if(d.type==="Polygon"||d.type==="MultiPolygon")return new Dn(d,d)}return c.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(o){if(o.geometry()!=null&&o.canonicalID()!=null){if(o.geometryType()==="Point")return function(c,d){const m=[1/0,1/0,-1/0,-1/0],b=[1/0,1/0,-1/0,-1/0],w=c.canonicalID();if(d.type==="Polygon"){const I=ur(d.coordinates,b,w),P=ze(c.geometry(),m,b,w);if(!Ct(m,b))return!1;for(const R of P)if(!ae(R,I))return!1}if(d.type==="MultiPolygon"){const I=Kn(d.coordinates,b,w),P=ze(c.geometry(),m,b,w);if(!Ct(m,b))return!1;for(const R of P)if(!we(R,I))return!1}return!0}(o,this.geometries);if(o.geometryType()==="LineString")return function(c,d){const m=[1/0,1/0,-1/0,-1/0],b=[1/0,1/0,-1/0,-1/0],w=c.canonicalID();if(d.type==="Polygon"){const I=ur(d.coordinates,b,w),P=tn(c.geometry(),m,b,w);if(!Ct(m,b))return!1;for(const R of P)if(!sr(R,I))return!1}if(d.type==="MultiPolygon"){const I=Kn(d.coordinates,b,w),P=tn(c.geometry(),m,b,w);if(!Ct(m,b))return!1;for(const R of P)if(!Rn(R,I))return!1}return!0}(o,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}}class Un{constructor(o,c){this.type=c.type,this.name=o,this.boundExpression=c}static parse(o,c){if(o.length!==2||typeof o[1]!="string")return c.error("'var' expression requires exactly one string literal argument.");const d=o[1];return c.scope.has(d)?new Un(d,c.scope.get(d)):c.error(`Unknown variable "${d}". Make sure "${d}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(o){return this.boundExpression.evaluate(o)}eachChild(){}outputDefined(){return!1}}class Po{constructor(o,c,d,m){this.name=o,this.type=c,this._evaluate=d,this.args=m}evaluate(o){return this._evaluate(o,this.args)}eachChild(o){this.args.forEach(o)}outputDefined(){return!1}static parse(o,c){const d=o[0],m=Po.definitions[d];if(!m)return c.error(`Unknown expression "${d}". If you wanted a literal array, use ["literal", [...]].`,0);const b=Array.isArray(m)?m[0]:m.type,w=Array.isArray(m)?[[m[1],m[2]]]:m.overloads,I=w.filter(([R])=>!Array.isArray(R)||R.length===o.length-1);let P=null;for(const[R,F]of I){P=new D(c.registry,rh,c.path,null,c.scope);const j=[];let Z=!1;for(let K=1;K<o.length;K++){const Q=o[K],at=Array.isArray(R)?R[K-1]:R.type,gt=P.parse(Q,1+j.length,at);if(!gt){Z=!0;break}j.push(gt)}if(!Z)if(Array.isArray(R)&&R.length!==j.length)P.error(`Expected ${R.length} arguments, but found ${j.length} instead.`);else{for(let K=0;K<j.length;K++){const Q=Array.isArray(R)?R[K]:R.type,at=j[K];P.concat(K+1).checkSubtype(Q,at.type)}if(P.errors.length===0)return new Po(d,b,F,j)}}if(I.length===1)c.errors.push(...P.errors);else{const R=(I.length?I:w).map(([j])=>{return Z=j,Array.isArray(Z)?`(${Z.map(ft).join(", ")})`:`(${ft(Z.type)}...)`;var Z}).join(" | "),F=[];for(let j=1;j<o.length;j++){const Z=c.parse(o[j],1+F.length);if(!Z)return null;F.push(ft(Z.type))}c.error(`Expected arguments of type ${R}, but found (${F.join(", ")}) instead.`)}return null}static register(o,c){Po.definitions=c;for(const d in c)o[d]=Po}}function rh(u){if(u instanceof Un)return rh(u.boundExpression);if(u instanceof Po&&u.name==="error"||u instanceof Y||u instanceof Dn)return!1;const o=u instanceof el||u instanceof ds;let c=!0;return u.eachChild(d=>{c=o?c&&rh(d):c&&d instanceof Ma}),!!c&&fn(u)&&nh(u,["zoom","heatmap-density","line-progress","accumulated","is-supported-script"])}function fn(u){if(u instanceof Po&&(u.name==="get"&&u.args.length===1||u.name==="feature-state"||u.name==="has"&&u.args.length===1||u.name==="properties"||u.name==="geometry-type"||u.name==="id"||/^filter-/.test(u.name))||u instanceof Dn)return!1;let o=!0;return u.eachChild(c=>{o&&!fn(c)&&(o=!1)}),o}function xu(u){if(u instanceof Po&&u.name==="feature-state")return!1;let o=!0;return u.eachChild(c=>{o&&!xu(c)&&(o=!1)}),o}function nh(u,o){if(u instanceof Po&&o.indexOf(u.name)>=0)return!1;let c=!0;return u.eachChild(d=>{c&&!nh(d,o)&&(c=!1)}),c}function Ao(u,o){const c=u.length-1;let d,m,b=0,w=c,I=0;for(;b<=w;)if(I=Math.floor((b+w)/2),d=u[I],m=u[I+1],d<=o){if(I===c||o<m)return I;b=I+1}else{if(!(d>o))throw new Ln("Input is not a number.");w=I-1}return 0}class Pa{constructor(o,c,d){this.type=o,this.input=c,this.labels=[],this.outputs=[];for(const[m,b]of d)this.labels.push(m),this.outputs.push(b)}static parse(o,c){if(o.length-1<4)return c.error(`Expected at least 4 arguments, but found only ${o.length-1}.`);if((o.length-1)%2!=0)return c.error("Expected an even number of arguments.");const d=c.parse(o[1],1,ce);if(!d)return null;const m=[];let b=null;c.expectedType&&c.expectedType.kind!=="value"&&(b=c.expectedType);for(let w=1;w<o.length;w+=2){const I=w===1?-1/0:o[w],P=o[w+1],R=w,F=w+1;if(typeof I!="number")return c.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',R);if(m.length&&m[m.length-1][0]>=I)return c.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',R);const j=c.parse(P,F,b);if(!j)return null;b=b||j.type,m.push([I,j])}return new Pa(b,d,m)}evaluate(o){const c=this.labels,d=this.outputs;if(c.length===1)return d[0].evaluate(o);const m=this.input.evaluate(o);if(m<=c[0])return d[0].evaluate(o);const b=c.length;return m>=c[b-1]?d[b-1].evaluate(o):d[Ao(c,m)].evaluate(o)}eachChild(o){o(this.input);for(const c of this.outputs)o(c)}outputDefined(){return this.outputs.every(o=>o.outputDefined())}}function Tr(u,o,c){return u+c*(o-u)}function ec(u,o,c){return u.map((d,m)=>Tr(d,o[m],c))}const mo={number:Tr,color:function(u,o,c,d="rgb"){switch(d){case"rgb":{const[m,b,w,I]=ec(u.rgb,o.rgb,c);return new Qr(m,b,w,I,!1)}case"hcl":{const[m,b,w,I]=u.hcl,[P,R,F,j]=o.hcl;let Z,K;if(isNaN(m)||isNaN(P))isNaN(m)?isNaN(P)?Z=NaN:(Z=P,w!==1&&w!==0||(K=R)):(Z=m,F!==1&&F!==0||(K=b));else{let At=P-m;P>m&&At>180?At-=360:P<m&&m-P>180&&(At+=360),Z=m+c*At}const[Q,at,gt,_t]=function([At,Tt,Rt,jt]){return At=isNaN(At)?0:At*or,dn([Rt,Math.cos(At)*Tt,Math.sin(At)*Tt,jt])}([Z,K??Tr(b,R,c),Tr(w,F,c),Tr(I,j,c)]);return new Qr(Q,at,gt,_t,!1)}case"lab":{const[m,b,w,I]=dn(ec(u.lab,o.lab,c));return new Qr(m,b,w,I,!1)}}},array:ec,padding:function(u,o,c){return new to(ec(u.values,o.values,c))},variableAnchorOffsetCollection:function(u,o,c){const d=u.values,m=o.values;if(d.length!==m.length)throw new Ln(`Cannot interpolate values of different length. from: ${u.toString()}, to: ${o.toString()}`);const b=[];for(let w=0;w<d.length;w+=2){if(d[w]!==m[w])throw new Ln(`Cannot interpolate values containing mismatched anchors. from[${w}]: ${d[w]}, to[${w}]: ${m[w]}`);b.push(d[w]);const[I,P]=d[w+1],[R,F]=m[w+1];b.push([Tr(I,R,c),Tr(P,F,c)])}return new Ni(b)}};class Lo{constructor(o,c,d,m,b){this.type=o,this.operator=c,this.interpolation=d,this.input=m,this.labels=[],this.outputs=[];for(const[w,I]of b)this.labels.push(w),this.outputs.push(I)}static interpolationFactor(o,c,d,m){let b=0;if(o.name==="exponential")b=ih(c,o.base,d,m);else if(o.name==="linear")b=ih(c,1,d,m);else if(o.name==="cubic-bezier"){const w=o.controlPoints;b=new G(w[0],w[1],w[2],w[3]).solve(ih(c,1,d,m))}return b}static parse(o,c){let[d,m,b,...w]=o;if(!Array.isArray(m)||m.length===0)return c.error("Expected an interpolation type expression.",1);if(m[0]==="linear")m={name:"linear"};else if(m[0]==="exponential"){const R=m[1];if(typeof R!="number")return c.error("Exponential interpolation requires a numeric base.",1,1);m={name:"exponential",base:R}}else{if(m[0]!=="cubic-bezier")return c.error(`Unknown interpolation type ${String(m[0])}`,1,0);{const R=m.slice(1);if(R.length!==4||R.some(F=>typeof F!="number"||F<0||F>1))return c.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);m={name:"cubic-bezier",controlPoints:R}}}if(o.length-1<4)return c.error(`Expected at least 4 arguments, but found only ${o.length-1}.`);if((o.length-1)%2!=0)return c.error("Expected an even number of arguments.");if(b=c.parse(b,2,ce),!b)return null;const I=[];let P=null;d==="interpolate-hcl"||d==="interpolate-lab"?P=Di:c.expectedType&&c.expectedType.kind!=="value"&&(P=c.expectedType);for(let R=0;R<w.length;R+=2){const F=w[R],j=w[R+1],Z=R+3,K=R+4;if(typeof F!="number")return c.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',Z);if(I.length&&I[I.length-1][0]>=F)return c.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',Z);const Q=c.parse(j,K,P);if(!Q)return null;P=P||Q.type,I.push([F,Q])}return zt(P,ce)||zt(P,Di)||zt(P,q)||zt(P,nt)||zt(P,pt(ce))?new Lo(P,d,m,b,I):c.error(`Type ${ft(P)} is not interpolatable.`)}evaluate(o){const c=this.labels,d=this.outputs;if(c.length===1)return d[0].evaluate(o);const m=this.input.evaluate(o);if(m<=c[0])return d[0].evaluate(o);const b=c.length;if(m>=c[b-1])return d[b-1].evaluate(o);const w=Ao(c,m),I=Lo.interpolationFactor(this.interpolation,m,c[w],c[w+1]),P=d[w].evaluate(o),R=d[w+1].evaluate(o);switch(this.operator){case"interpolate":return mo[this.type.kind](P,R,I);case"interpolate-hcl":return mo.color(P,R,I,"hcl");case"interpolate-lab":return mo.color(P,R,I,"lab")}}eachChild(o){o(this.input);for(const c of this.outputs)o(c)}outputDefined(){return this.outputs.every(o=>o.outputDefined())}}function ih(u,o,c,d){const m=d-c,b=u-c;return m===0?0:o===1?b/m:(Math.pow(o,b)-1)/(Math.pow(o,m)-1)}class oh{constructor(o,c){this.type=o,this.args=c}static parse(o,c){if(o.length<2)return c.error("Expectected at least one argument.");let d=null;const m=c.expectedType;m&&m.kind!=="value"&&(d=m);const b=[];for(const I of o.slice(1)){const P=c.parse(I,1+b.length,d,void 0,{typeAnnotation:"omit"});if(!P)return null;d=d||P.type,b.push(P)}if(!d)throw new Error("No output type");const w=m&&b.some(I=>bt(m,I.type));return new oh(w?Ze:d,b)}evaluate(o){let c,d=null,m=0;for(const b of this.args)if(m++,d=b.evaluate(o),d&&d instanceof ki&&!d.available&&(c||(c=d.name),d=null,m===this.args.length&&(d=c)),d!==null)break;return d}eachChild(o){this.args.forEach(o)}outputDefined(){return this.args.every(o=>o.outputDefined())}}class sh{constructor(o,c){this.type=c.type,this.bindings=[].concat(o),this.result=c}evaluate(o){return this.result.evaluate(o)}eachChild(o){for(const c of this.bindings)o(c[1]);o(this.result)}static parse(o,c){if(o.length<4)return c.error(`Expected at least 3 arguments, but found ${o.length-1} instead.`);const d=[];for(let b=1;b<o.length-1;b+=2){const w=o[b];if(typeof w!="string")return c.error(`Expected string, but found ${typeof w} instead.`,b);if(/[^a-zA-Z0-9_]/.test(w))return c.error("Variable names must contain only alphanumeric characters or '_'.",b);const I=c.parse(o[b+1],b+1);if(!I)return null;d.push([w,I])}const m=c.parse(o[o.length-1],o.length-1,c.expectedType,d);return m?new sh(d,m):null}outputDefined(){return this.result.outputDefined()}}class hp{constructor(o,c,d){this.type=o,this.index=c,this.input=d}static parse(o,c){if(o.length!==3)return c.error(`Expected 2 arguments, but found ${o.length-1} instead.`);const d=c.parse(o[1],1,ce),m=c.parse(o[2],2,pt(c.expectedType||Ze));return d&&m?new hp(m.type.itemType,d,m):null}evaluate(o){const c=this.index.evaluate(o),d=this.input.evaluate(o);if(c<0)throw new Ln(`Array index out of bounds: ${c} < 0.`);if(c>=d.length)throw new Ln(`Array index out of bounds: ${c} > ${d.length-1}.`);if(c!==Math.floor(c))throw new Ln(`Array index must be an integer, but found ${c} instead.`);return d[c]}eachChild(o){o(this.index),o(this.input)}outputDefined(){return!1}}class ah{constructor(o,c){this.type=He,this.needle=o,this.haystack=c}static parse(o,c){if(o.length!==3)return c.error(`Expected 2 arguments, but found ${o.length-1} instead.`);const d=c.parse(o[1],1,Ze),m=c.parse(o[2],2,Ze);return d&&m?mt(d.type,[He,ar,ce,Ri,Ze])?new ah(d,m):c.error(`Expected first argument to be of type boolean, string, number or null, but found ${ft(d.type)} instead`):null}evaluate(o){const c=this.needle.evaluate(o),d=this.haystack.evaluate(o);if(!d)return!1;if(!Et(c,["boolean","string","number","null"]))throw new Ln(`Expected first argument to be of type boolean, string, number or null, but found ${ft(An(c))} instead.`);if(!Et(d,["string","array"]))throw new Ln(`Expected second argument to be of type array or string, but found ${ft(An(d))} instead.`);return d.indexOf(c)>=0}eachChild(o){o(this.needle),o(this.haystack)}outputDefined(){return!0}}class rc{constructor(o,c,d){this.type=ce,this.needle=o,this.haystack=c,this.fromIndex=d}static parse(o,c){if(o.length<=2||o.length>=5)return c.error(`Expected 3 or 4 arguments, but found ${o.length-1} instead.`);const d=c.parse(o[1],1,Ze),m=c.parse(o[2],2,Ze);if(!d||!m)return null;if(!mt(d.type,[He,ar,ce,Ri,Ze]))return c.error(`Expected first argument to be of type boolean, string, number or null, but found ${ft(d.type)} instead`);if(o.length===4){const b=c.parse(o[3],3,ce);return b?new rc(d,m,b):null}return new rc(d,m)}evaluate(o){const c=this.needle.evaluate(o),d=this.haystack.evaluate(o);if(!Et(c,["boolean","string","number","null"]))throw new Ln(`Expected first argument to be of type boolean, string, number or null, but found ${ft(An(c))} instead.`);if(!Et(d,["string","array"]))throw new Ln(`Expected second argument to be of type array or string, but found ${ft(An(d))} instead.`);if(this.fromIndex){const m=this.fromIndex.evaluate(o);return d.indexOf(c,m)}return d.indexOf(c)}eachChild(o){o(this.needle),o(this.haystack),this.fromIndex&&o(this.fromIndex)}outputDefined(){return!1}}class lh{constructor(o,c,d,m,b,w){this.inputType=o,this.type=c,this.input=d,this.cases=m,this.outputs=b,this.otherwise=w}static parse(o,c){if(o.length<5)return c.error(`Expected at least 4 arguments, but found only ${o.length-1}.`);if(o.length%2!=1)return c.error("Expected an even number of arguments.");let d,m;c.expectedType&&c.expectedType.kind!=="value"&&(m=c.expectedType);const b={},w=[];for(let R=2;R<o.length-1;R+=2){let F=o[R];const j=o[R+1];Array.isArray(F)||(F=[F]);const Z=c.concat(R);if(F.length===0)return Z.error("Expected at least one branch label.");for(const Q of F){if(typeof Q!="number"&&typeof Q!="string")return Z.error("Branch labels must be numbers or strings.");if(typeof Q=="number"&&Math.abs(Q)>Number.MAX_SAFE_INTEGER)return Z.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if(typeof Q=="number"&&Math.floor(Q)!==Q)return Z.error("Numeric branch labels must be integer values.");if(d){if(Z.checkSubtype(d,An(Q)))return null}else d=An(Q);if(b[String(Q)]!==void 0)return Z.error("Branch labels must be unique.");b[String(Q)]=w.length}const K=c.parse(j,R,m);if(!K)return null;m=m||K.type,w.push(K)}const I=c.parse(o[1],1,Ze);if(!I)return null;const P=c.parse(o[o.length-1],o.length-1,m);return P?I.type.kind!=="value"&&c.concat(1).checkSubtype(d,I.type)?null:new lh(d,m,I,b,w,P):null}evaluate(o){const c=this.input.evaluate(o);return(An(c)===this.inputType&&this.outputs[this.cases[c]]||this.otherwise).evaluate(o)}eachChild(o){o(this.input),this.outputs.forEach(o),o(this.otherwise)}outputDefined(){return this.outputs.every(o=>o.outputDefined())&&this.otherwise.outputDefined()}}class pp{constructor(o,c,d){this.type=o,this.branches=c,this.otherwise=d}static parse(o,c){if(o.length<4)return c.error(`Expected at least 3 arguments, but found only ${o.length-1}.`);if(o.length%2!=0)return c.error("Expected an odd number of arguments.");let d;c.expectedType&&c.expectedType.kind!=="value"&&(d=c.expectedType);const m=[];for(let w=1;w<o.length-1;w+=2){const I=c.parse(o[w],w,He);if(!I)return null;const P=c.parse(o[w+1],w+1,d);if(!P)return null;m.push([I,P]),d=d||P.type}const b=c.parse(o[o.length-1],o.length-1,d);if(!b)return null;if(!d)throw new Error("Can't infer output type");return new pp(d,m,b)}evaluate(o){for(const[c,d]of this.branches)if(c.evaluate(o))return d.evaluate(o);return this.otherwise.evaluate(o)}eachChild(o){for(const[c,d]of this.branches)o(c),o(d);o(this.otherwise)}outputDefined(){return this.branches.every(([o,c])=>c.outputDefined())&&this.otherwise.outputDefined()}}class uh{constructor(o,c,d,m){this.type=o,this.input=c,this.beginIndex=d,this.endIndex=m}static parse(o,c){if(o.length<=2||o.length>=5)return c.error(`Expected 3 or 4 arguments, but found ${o.length-1} instead.`);const d=c.parse(o[1],1,Ze),m=c.parse(o[2],2,ce);if(!d||!m)return null;if(!mt(d.type,[pt(Ze),ar,Ze]))return c.error(`Expected first argument to be of type array or string, but found ${ft(d.type)} instead`);if(o.length===4){const b=c.parse(o[3],3,ce);return b?new uh(d.type,d,m,b):null}return new uh(d.type,d,m)}evaluate(o){const c=this.input.evaluate(o),d=this.beginIndex.evaluate(o);if(!Et(c,["string","array"]))throw new Ln(`Expected first argument to be of type array or string, but found ${ft(An(c))} instead.`);if(this.endIndex){const m=this.endIndex.evaluate(o);return c.slice(d,m)}return c.slice(d)}eachChild(o){o(this.input),o(this.beginIndex),this.endIndex&&o(this.endIndex)}outputDefined(){return!1}}function nc(u,o){return u==="=="||u==="!="?o.kind==="boolean"||o.kind==="string"||o.kind==="number"||o.kind==="null"||o.kind==="value":o.kind==="string"||o.kind==="number"||o.kind==="value"}function ch(u,o,c,d){return d.compare(o,c)===0}function Ul(u,o,c){const d=u!=="=="&&u!=="!=";return class M2{constructor(b,w,I){this.type=He,this.lhs=b,this.rhs=w,this.collator=I,this.hasUntypedArgument=b.type.kind==="value"||w.type.kind==="value"}static parse(b,w){if(b.length!==3&&b.length!==4)return w.error("Expected two or three arguments.");const I=b[0];let P=w.parse(b[1],1,Ze);if(!P)return null;if(!nc(I,P.type))return w.concat(1).error(`"${I}" comparisons are not supported for type '${ft(P.type)}'.`);let R=w.parse(b[2],2,Ze);if(!R)return null;if(!nc(I,R.type))return w.concat(2).error(`"${I}" comparisons are not supported for type '${ft(R.type)}'.`);if(P.type.kind!==R.type.kind&&P.type.kind!=="value"&&R.type.kind!=="value")return w.error(`Cannot compare types '${ft(P.type)}' and '${ft(R.type)}'.`);d&&(P.type.kind==="value"&&R.type.kind!=="value"?P=new ds(R.type,[P]):P.type.kind!=="value"&&R.type.kind==="value"&&(R=new ds(P.type,[R])));let F=null;if(b.length===4){if(P.type.kind!=="string"&&R.type.kind!=="string"&&P.type.kind!=="value"&&R.type.kind!=="value")return w.error("Cannot use collator to compare non-string types.");if(F=w.parse(b[3],3,Mo),!F)return null}return new M2(P,R,F)}evaluate(b){const w=this.lhs.evaluate(b),I=this.rhs.evaluate(b);if(d&&this.hasUntypedArgument){const P=An(w),R=An(I);if(P.kind!==R.kind||P.kind!=="string"&&P.kind!=="number")throw new Ln(`Expected arguments for "${u}" to be (string, string) or (number, number), but found (${P.kind}, ${R.kind}) instead.`)}if(this.collator&&!d&&this.hasUntypedArgument){const P=An(w),R=An(I);if(P.kind!=="string"||R.kind!=="string")return o(b,w,I)}return this.collator?c(b,w,I,this.collator.evaluate(b)):o(b,w,I)}eachChild(b){b(this.lhs),b(this.rhs),this.collator&&b(this.collator)}outputDefined(){return!0}}}const oa=Ul("==",function(u,o,c){return o===c},ch),rd=Ul("!=",function(u,o,c){return o!==c},function(u,o,c,d){return!ch(0,o,c,d)}),nd=Ul("<",function(u,o,c){return o<c},function(u,o,c,d){return d.compare(o,c)<0}),Ef=Ul(">",function(u,o,c){return o>c},function(u,o,c,d){return d.compare(o,c)>0}),id=Ul("<=",function(u,o,c){return o<=c},function(u,o,c,d){return d.compare(o,c)<=0}),hh=Ul(">=",function(u,o,c){return o>=c},function(u,o,c,d){return d.compare(o,c)>=0});class ph{constructor(o,c,d,m,b){this.type=ar,this.number=o,this.locale=c,this.currency=d,this.minFractionDigits=m,this.maxFractionDigits=b}static parse(o,c){if(o.length!==3)return c.error("Expected two arguments.");const d=c.parse(o[1],1,ce);if(!d)return null;const m=o[2];if(typeof m!="object"||Array.isArray(m))return c.error("NumberFormat options argument must be an object.");let b=null;if(m.locale&&(b=c.parse(m.locale,1,ar),!b))return null;let w=null;if(m.currency&&(w=c.parse(m.currency,1,ar),!w))return null;let I=null;if(m["min-fraction-digits"]&&(I=c.parse(m["min-fraction-digits"],1,ce),!I))return null;let P=null;return m["max-fraction-digits"]&&(P=c.parse(m["max-fraction-digits"],1,ce),!P)?null:new ph(d,b,w,I,P)}evaluate(o){return new Intl.NumberFormat(this.locale?this.locale.evaluate(o):[],{style:this.currency?"currency":"decimal",currency:this.currency?this.currency.evaluate(o):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(o):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(o):void 0}).format(this.number.evaluate(o))}eachChild(o){o(this.number),this.locale&&o(this.locale),this.currency&&o(this.currency),this.minFractionDigits&&o(this.minFractionDigits),this.maxFractionDigits&&o(this.maxFractionDigits)}outputDefined(){return!1}}class ic{constructor(o){this.type=ct,this.sections=o}static parse(o,c){if(o.length<2)return c.error("Expected at least one argument.");const d=o[1];if(!Array.isArray(d)&&typeof d=="object")return c.error("First argument must be an image or text section.");const m=[];let b=!1;for(let w=1;w<=o.length-1;++w){const I=o[w];if(b&&typeof I=="object"&&!Array.isArray(I)){b=!1;let P=null;if(I["font-scale"]&&(P=c.parse(I["font-scale"],1,ce),!P))return null;let R=null;if(I["text-font"]&&(R=c.parse(I["text-font"],1,pt(ar)),!R))return null;let F=null;if(I["text-color"]&&(F=c.parse(I["text-color"],1,Di),!F))return null;const j=m[m.length-1];j.scale=P,j.font=R,j.textColor=F}else{const P=c.parse(o[w],1,Ze);if(!P)return null;const R=P.type.kind;if(R!=="string"&&R!=="value"&&R!=="null"&&R!=="resolvedImage")return c.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");b=!0,m.push({content:P,scale:null,font:null,textColor:null})}}return new ic(m)}evaluate(o){return new Cn(this.sections.map(c=>{const d=c.content.evaluate(o);return An(d)===X?new Rs("",d,null,null,null):new Rs(Vr(d),null,c.scale?c.scale.evaluate(o):null,c.font?c.font.evaluate(o).join(","):null,c.textColor?c.textColor.evaluate(o):null)}))}eachChild(o){for(const c of this.sections)o(c.content),c.scale&&o(c.scale),c.font&&o(c.font),c.textColor&&o(c.textColor)}outputDefined(){return!1}}class dp{constructor(o){this.type=X,this.input=o}static parse(o,c){if(o.length!==2)return c.error("Expected two arguments.");const d=c.parse(o[1],1,ar);return d?new dp(d):c.error("No image name provided.")}evaluate(o){const c=this.input.evaluate(o),d=ki.fromString(c);return d&&o.availableImages&&(d.available=o.availableImages.indexOf(c)>-1),d}eachChild(o){o(this.input)}outputDefined(){return!1}}class Aa{constructor(o){this.type=ce,this.input=o}static parse(o,c){if(o.length!==2)return c.error(`Expected 1 argument, but found ${o.length-1} instead.`);const d=c.parse(o[1],1);return d?d.type.kind!=="array"&&d.type.kind!=="string"&&d.type.kind!=="value"?c.error(`Expected argument of type string or array, but found ${ft(d.type)} instead.`):new Aa(d):null}evaluate(o){const c=this.input.evaluate(o);if(typeof c=="string"||Array.isArray(c))return c.length;throw new Ln(`Expected value to be of type string or array, but found ${ft(An(c))} instead.`)}eachChild(o){o(this.input)}outputDefined(){return!1}}const jl={"==":oa,"!=":rd,">":Ef,"<":nd,">=":hh,"<=":id,array:ds,at:hp,boolean:ds,case:pp,coalesce:oh,collator:Y,format:ic,image:dp,in:ah,"index-of":rc,interpolate:Lo,"interpolate-hcl":Lo,"interpolate-lab":Lo,length:Aa,let:sh,literal:Ma,match:lh,number:ds,"number-format":ph,object:ds,slice:uh,step:Pa,string:ds,"to-boolean":el,"to-color":el,"to-number":el,"to-string":el,var:Un,within:Dn};function od(u,[o,c,d,m]){o=o.evaluate(u),c=c.evaluate(u),d=d.evaluate(u);const b=m?m.evaluate(u):1,w=eh(o,c,d,b);if(w)throw new Ln(w);return new Qr(o/255,c/255,d/255,b,!1)}function sd(u,o){return u in o}function oc(u,o){const c=o[u];return c===void 0?null:c}function Ds(u){return{type:u}}function dh(u){return{result:"success",value:u}}function sa(u){return{result:"error",value:u}}function rl(u){return u["property-type"]==="data-driven"||u["property-type"]==="cross-faded-data-driven"}function bu(u){return!!u.expression&&u.expression.parameters.indexOf("zoom")>-1}function fp(u){return!!u.expression&&u.expression.interpolated}function Gr(u){return u instanceof Number?"number":u instanceof String?"string":u instanceof Boolean?"boolean":Array.isArray(u)?"array":u===null?"null":typeof u}function Nn(u){return typeof u=="object"&&u!==null&&!Array.isArray(u)}function Sf(u){return u}function Cr(u,o){const c=o.type==="color",d=u.stops&&typeof u.stops[0][0]=="object",m=d||!(d||u.property!==void 0),b=u.type||(fp(o)?"exponential":"interval");if(c||o.type==="padding"){const F=c?Qr.parse:to.parse;(u=po({},u)).stops&&(u.stops=u.stops.map(j=>[j[0],F(j[1])])),u.default=F(u.default?u.default:o.default)}if(u.colorSpace&&(w=u.colorSpace)!=="rgb"&&w!=="hcl"&&w!=="lab")throw new Error(`Unknown color space: "${u.colorSpace}"`);var w;let I,P,R;if(b==="exponential")I=Ho;else if(b==="interval")I=en;else if(b==="categorical"){I=wn,P=Object.create(null);for(const F of u.stops)P[F[0]]=F[1];R=typeof u.stops[0][0]}else{if(b!=="identity")throw new Error(`Unknown function type "${b}"`);I=il}if(d){const F={},j=[];for(let Q=0;Q<u.stops.length;Q++){const at=u.stops[Q],gt=at[0].zoom;F[gt]===void 0&&(F[gt]={zoom:gt,type:u.type,property:u.property,default:u.default,stops:[]},j.push(gt)),F[gt].stops.push([at[0].value,at[1]])}const Z=[];for(const Q of j)Z.push([F[Q].zoom,Cr(F[Q],o)]);const K={name:"linear"};return{kind:"composite",interpolationType:K,interpolationFactor:Lo.interpolationFactor.bind(void 0,K),zoomStops:Z.map(Q=>Q[0]),evaluate:({zoom:Q},at)=>Ho({stops:Z,base:u.base},o,Q).evaluate(Q,at)}}if(m){const F=b==="exponential"?{name:"exponential",base:u.base!==void 0?u.base:1}:null;return{kind:"camera",interpolationType:F,interpolationFactor:Lo.interpolationFactor.bind(void 0,F),zoomStops:u.stops.map(j=>j[0]),evaluate:({zoom:j})=>I(u,o,j,P,R)}}return{kind:"source",evaluate(F,j){const Z=j&&j.properties?j.properties[u.property]:void 0;return Z===void 0?nl(u.default,o.default):I(u,o,Z,P,R)}}}function nl(u,o,c){return u!==void 0?u:o!==void 0?o:c!==void 0?c:void 0}function wn(u,o,c,d,m){return nl(typeof c===m?d[c]:void 0,u.default,o.default)}function en(u,o,c){if(Gr(c)!=="number")return nl(u.default,o.default);const d=u.stops.length;if(d===1||c<=u.stops[0][0])return u.stops[0][1];if(c>=u.stops[d-1][0])return u.stops[d-1][1];const m=Ao(u.stops.map(b=>b[0]),c);return u.stops[m][1]}function Ho(u,o,c){const d=u.base!==void 0?u.base:1;if(Gr(c)!=="number")return nl(u.default,o.default);const m=u.stops.length;if(m===1||c<=u.stops[0][0])return u.stops[0][1];if(c>=u.stops[m-1][0])return u.stops[m-1][1];const b=Ao(u.stops.map(F=>F[0]),c),w=function(F,j,Z,K){const Q=K-Z,at=F-Z;return Q===0?0:j===1?at/Q:(Math.pow(j,at)-1)/(Math.pow(j,Q)-1)}(c,d,u.stops[b][0],u.stops[b+1][0]),I=u.stops[b][1],P=u.stops[b+1][1],R=mo[o.type]||Sf;return typeof I.evaluate=="function"?{evaluate(...F){const j=I.evaluate.apply(void 0,F),Z=P.evaluate.apply(void 0,F);if(j!==void 0&&Z!==void 0)return R(j,Z,w,u.colorSpace)}}:R(I,P,w,u.colorSpace)}function il(u,o,c){switch(o.type){case"color":c=Qr.parse(c);break;case"formatted":c=Cn.fromString(c.toString());break;case"resolvedImage":c=ki.fromString(c.toString());break;case"padding":c=to.parse(c);break;default:Gr(c)===o.type||o.type==="enum"&&o.values[c]||(c=void 0)}return nl(c,u.default,o.default)}Po.register(jl,{error:[{kind:"error"},[ar],(u,[o])=>{throw new Ln(o.evaluate(u))}],typeof:[ar,[Ze],(u,[o])=>ft(An(o.evaluate(u)))],"to-rgba":[pt(ce,4),[Di],(u,[o])=>{const[c,d,m,b]=o.evaluate(u).rgb;return[255*c,255*d,255*m,b]}],rgb:[Di,[ce,ce,ce],od],rgba:[Di,[ce,ce,ce,ce],od],has:{type:He,overloads:[[[ar],(u,[o])=>sd(o.evaluate(u),u.properties())],[[ar,fo],(u,[o,c])=>sd(o.evaluate(u),c.evaluate(u))]]},get:{type:Ze,overloads:[[[ar],(u,[o])=>oc(o.evaluate(u),u.properties())],[[ar,fo],(u,[o,c])=>oc(o.evaluate(u),c.evaluate(u))]]},"feature-state":[Ze,[ar],(u,[o])=>oc(o.evaluate(u),u.featureState||{})],properties:[fo,[],u=>u.properties()],"geometry-type":[ar,[],u=>u.geometryType()],id:[Ze,[],u=>u.id()],zoom:[ce,[],u=>u.globals.zoom],"heatmap-density":[ce,[],u=>u.globals.heatmapDensity||0],"line-progress":[ce,[],u=>u.globals.lineProgress||0],accumulated:[Ze,[],u=>u.globals.accumulated===void 0?null:u.globals.accumulated],"+":[ce,Ds(ce),(u,o)=>{let c=0;for(const d of o)c+=d.evaluate(u);return c}],"*":[ce,Ds(ce),(u,o)=>{let c=1;for(const d of o)c*=d.evaluate(u);return c}],"-":{type:ce,overloads:[[[ce,ce],(u,[o,c])=>o.evaluate(u)-c.evaluate(u)],[[ce],(u,[o])=>-o.evaluate(u)]]},"/":[ce,[ce,ce],(u,[o,c])=>o.evaluate(u)/c.evaluate(u)],"%":[ce,[ce,ce],(u,[o,c])=>o.evaluate(u)%c.evaluate(u)],ln2:[ce,[],()=>Math.LN2],pi:[ce,[],()=>Math.PI],e:[ce,[],()=>Math.E],"^":[ce,[ce,ce],(u,[o,c])=>Math.pow(o.evaluate(u),c.evaluate(u))],sqrt:[ce,[ce],(u,[o])=>Math.sqrt(o.evaluate(u))],log10:[ce,[ce],(u,[o])=>Math.log(o.evaluate(u))/Math.LN10],ln:[ce,[ce],(u,[o])=>Math.log(o.evaluate(u))],log2:[ce,[ce],(u,[o])=>Math.log(o.evaluate(u))/Math.LN2],sin:[ce,[ce],(u,[o])=>Math.sin(o.evaluate(u))],cos:[ce,[ce],(u,[o])=>Math.cos(o.evaluate(u))],tan:[ce,[ce],(u,[o])=>Math.tan(o.evaluate(u))],asin:[ce,[ce],(u,[o])=>Math.asin(o.evaluate(u))],acos:[ce,[ce],(u,[o])=>Math.acos(o.evaluate(u))],atan:[ce,[ce],(u,[o])=>Math.atan(o.evaluate(u))],min:[ce,Ds(ce),(u,o)=>Math.min(...o.map(c=>c.evaluate(u)))],max:[ce,Ds(ce),(u,o)=>Math.max(...o.map(c=>c.evaluate(u)))],abs:[ce,[ce],(u,[o])=>Math.abs(o.evaluate(u))],round:[ce,[ce],(u,[o])=>{const c=o.evaluate(u);return c<0?-Math.round(-c):Math.round(c)}],floor:[ce,[ce],(u,[o])=>Math.floor(o.evaluate(u))],ceil:[ce,[ce],(u,[o])=>Math.ceil(o.evaluate(u))],"filter-==":[He,[ar,Ze],(u,[o,c])=>u.properties()[o.value]===c.value],"filter-id-==":[He,[Ze],(u,[o])=>u.id()===o.value],"filter-type-==":[He,[ar],(u,[o])=>u.geometryType()===o.value],"filter-<":[He,[ar,Ze],(u,[o,c])=>{const d=u.properties()[o.value],m=c.value;return typeof d==typeof m&&d<m}],"filter-id-<":[He,[Ze],(u,[o])=>{const c=u.id(),d=o.value;return typeof c==typeof d&&c<d}],"filter->":[He,[ar,Ze],(u,[o,c])=>{const d=u.properties()[o.value],m=c.value;return typeof d==typeof m&&d>m}],"filter-id->":[He,[Ze],(u,[o])=>{const c=u.id(),d=o.value;return typeof c==typeof d&&c>d}],"filter-<=":[He,[ar,Ze],(u,[o,c])=>{const d=u.properties()[o.value],m=c.value;return typeof d==typeof m&&d<=m}],"filter-id-<=":[He,[Ze],(u,[o])=>{const c=u.id(),d=o.value;return typeof c==typeof d&&c<=d}],"filter->=":[He,[ar,Ze],(u,[o,c])=>{const d=u.properties()[o.value],m=c.value;return typeof d==typeof m&&d>=m}],"filter-id->=":[He,[Ze],(u,[o])=>{const c=u.id(),d=o.value;return typeof c==typeof d&&c>=d}],"filter-has":[He,[Ze],(u,[o])=>o.value in u.properties()],"filter-has-id":[He,[],u=>u.id()!==null&&u.id()!==void 0],"filter-type-in":[He,[pt(ar)],(u,[o])=>o.value.indexOf(u.geometryType())>=0],"filter-id-in":[He,[pt(Ze)],(u,[o])=>o.value.indexOf(u.id())>=0],"filter-in-small":[He,[ar,pt(Ze)],(u,[o,c])=>c.value.indexOf(u.properties()[o.value])>=0],"filter-in-large":[He,[ar,pt(Ze)],(u,[o,c])=>function(d,m,b,w){for(;b<=w;){const I=b+w>>1;if(m[I]===d)return!0;m[I]>d?w=I-1:b=I+1}return!1}(u.properties()[o.value],c.value,0,c.value.length-1)],all:{type:He,overloads:[[[He,He],(u,[o,c])=>o.evaluate(u)&&c.evaluate(u)],[Ds(He),(u,o)=>{for(const c of o)if(!c.evaluate(u))return!1;return!0}]]},any:{type:He,overloads:[[[He,He],(u,[o,c])=>o.evaluate(u)||c.evaluate(u)],[Ds(He),(u,o)=>{for(const c of o)if(c.evaluate(u))return!0;return!1}]]},"!":[He,[He],(u,[o])=>!o.evaluate(u)],"is-supported-script":[He,[ar],(u,[o])=>{const c=u.globals&&u.globals.isSupportedScript;return!c||c(o.evaluate(u))}],upcase:[ar,[ar],(u,[o])=>o.evaluate(u).toUpperCase()],downcase:[ar,[ar],(u,[o])=>o.evaluate(u).toLowerCase()],concat:[ar,Ds(Ze),(u,o)=>o.map(c=>Vr(c.evaluate(u))).join("")],"resolved-locale":[ar,[Mo],(u,[o])=>o.evaluate(u).resolvedLocale()]});class wu{constructor(o,c){var d;this.expression=o,this._warningHistory={},this._evaluator=new T,this._defaultValue=c?(d=c).type==="color"&&Nn(d.default)?new Qr(0,0,0,0):d.type==="color"?Qr.parse(d.default)||null:d.type==="padding"?to.parse(d.default)||null:d.type==="variableAnchorOffsetCollection"?Ni.parse(d.default)||null:d.default===void 0?null:d.default:null,this._enumValues=c&&c.type==="enum"?c.values:null}evaluateWithoutErrorHandling(o,c,d,m,b,w){return this._evaluator.globals=o,this._evaluator.feature=c,this._evaluator.featureState=d,this._evaluator.canonical=m,this._evaluator.availableImages=b||null,this._evaluator.formattedSection=w,this.expression.evaluate(this._evaluator)}evaluate(o,c,d,m,b,w){this._evaluator.globals=o,this._evaluator.feature=c||null,this._evaluator.featureState=d||null,this._evaluator.canonical=m,this._evaluator.availableImages=b||null,this._evaluator.formattedSection=w||null;try{const I=this.expression.evaluate(this._evaluator);if(I==null||typeof I=="number"&&I!=I)return this._defaultValue;if(this._enumValues&&!(I in this._enumValues))throw new Ln(`Expected value to be one of ${Object.keys(this._enumValues).map(P=>JSON.stringify(P)).join(", ")}, but found ${JSON.stringify(I)} instead.`);return I}catch(I){return this._warningHistory[I.message]||(this._warningHistory[I.message]=!0,typeof console<"u"&&console.warn(I.message)),this._defaultValue}}}function Ns(u){return Array.isArray(u)&&u.length>0&&typeof u[0]=="string"&&u[0]in jl}function fh(u,o){const c=new D(jl,rh,[],o?function(m){const b={color:Di,string:ar,number:ce,enum:ar,boolean:He,formatted:ct,padding:q,resolvedImage:X,variableAnchorOffsetCollection:nt};return m.type==="array"?pt(b[m.value]||Ze,m.length):b[m.type]}(o):void 0),d=c.parse(u,void 0,void 0,void 0,o&&o.type==="string"?{typeAnnotation:"coerce"}:void 0);return d?dh(new wu(d,o)):sa(c.errors)}class Eu{constructor(o,c){this.kind=o,this._styleExpression=c,this.isStateDependent=o!=="constant"&&!xu(c.expression)}evaluateWithoutErrorHandling(o,c,d,m,b,w){return this._styleExpression.evaluateWithoutErrorHandling(o,c,d,m,b,w)}evaluate(o,c,d,m,b,w){return this._styleExpression.evaluate(o,c,d,m,b,w)}}class ol{constructor(o,c,d,m){this.kind=o,this.zoomStops=d,this._styleExpression=c,this.isStateDependent=o!=="camera"&&!xu(c.expression),this.interpolationType=m}evaluateWithoutErrorHandling(o,c,d,m,b,w){return this._styleExpression.evaluateWithoutErrorHandling(o,c,d,m,b,w)}evaluate(o,c,d,m,b,w){return this._styleExpression.evaluate(o,c,d,m,b,w)}interpolationFactor(o,c,d){return this.interpolationType?Lo.interpolationFactor(this.interpolationType,o,c,d):0}}function mh(u,o){const c=fh(u,o);if(c.result==="error")return c;const d=c.value.expression,m=fn(d);if(!m&&!rl(o))return sa([new In("","data expressions not supported")]);const b=nh(d,["zoom"]);if(!b&&!bu(o))return sa([new In("","zoom expressions not supported")]);const w=sc(d);return w||b?w instanceof In?sa([w]):w instanceof Lo&&!fp(o)?sa([new In("",'"interpolate" expressions cannot be used with this property')]):dh(w?new ol(m?"camera":"composite",c.value,w.labels,w instanceof Lo?w.interpolation:void 0):new Eu(m?"constant":"source",c.value)):sa([new In("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')])}class Su{constructor(o,c){this._parameters=o,this._specification=c,po(this,Cr(this._parameters,this._specification))}static deserialize(o){return new Su(o._parameters,o._specification)}static serialize(o){return{_parameters:o._parameters,_specification:o._specification}}}function sc(u){let o=null;if(u instanceof sh)o=sc(u.result);else if(u instanceof oh){for(const c of u.args)if(o=sc(c),o)break}else(u instanceof Pa||u instanceof Lo)&&u.input instanceof Po&&u.input.name==="zoom"&&(o=u);return o instanceof In||u.eachChild(c=>{const d=sc(c);d instanceof In?o=d:!o&&d?o=new In("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):o&&d&&o!==d&&(o=new In("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),o}function ac(u){if(u===!0||u===!1)return!0;if(!Array.isArray(u)||u.length===0)return!1;switch(u[0]){case"has":return u.length>=2&&u[1]!=="$id"&&u[1]!=="$type";case"in":return u.length>=3&&(typeof u[1]!="string"||Array.isArray(u[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return u.length!==3||Array.isArray(u[1])||Array.isArray(u[2]);case"any":case"all":for(const o of u.slice(1))if(!ac(o)&&typeof o!="boolean")return!1;return!0;default:return!0}}const ad={type:"boolean",default:!1,transition:!1,"property-type":"data-driven",expression:{interpolated:!1,parameters:["zoom","feature"]}};function gh(u){if(u==null)return{filter:()=>!0,needGeometry:!1};ac(u)||(u=_h(u));const o=fh(u,ad);if(o.result==="error")throw new Error(o.value.map(c=>`${c.key}: ${c.message}`).join(", "));return{filter:(c,d,m)=>o.value.evaluate(c,d,{},m),needGeometry:Vl(u)}}function yh(u,o){return u<o?-1:u>o?1:0}function Vl(u){if(!Array.isArray(u))return!1;if(u[0]==="within")return!0;for(let o=1;o<u.length;o++)if(Vl(u[o]))return!0;return!1}function _h(u){if(!u)return!0;const o=u[0];return u.length<=1?o!=="any":o==="=="?aa(u[1],u[2],"=="):o==="!="?Tu(aa(u[1],u[2],"==")):o==="<"||o===">"||o==="<="||o===">="?aa(u[1],u[2],o):o==="any"?(c=u.slice(1),["any"].concat(c.map(_h))):o==="all"?["all"].concat(u.slice(1).map(_h)):o==="none"?["all"].concat(u.slice(1).map(_h).map(Tu)):o==="in"?ld(u[1],u.slice(2)):o==="!in"?Tu(ld(u[1],u.slice(2))):o==="has"?sl(u[1]):o==="!has"?Tu(sl(u[1])):o!=="within"||u;var c}function aa(u,o,c){switch(u){case"$type":return[`filter-type-${c}`,o];case"$id":return[`filter-id-${c}`,o];default:return[`filter-${c}`,u,o]}}function ld(u,o){if(o.length===0)return!1;switch(u){case"$type":return["filter-type-in",["literal",o]];case"$id":return["filter-id-in",["literal",o]];default:return o.length>200&&!o.some(c=>typeof c!=typeof o[0])?["filter-in-large",u,["literal",o.sort(yh)]]:["filter-in-small",u,["literal",o]]}}function sl(u){switch(u){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",u]}}function Tu(u){return["!",u]}function vh(u){const o=typeof u;if(o==="number"||o==="boolean"||o==="string"||u==null)return JSON.stringify(u);if(Array.isArray(u)){let m="[";for(const b of u)m+=`${vh(b)},`;return`${m}]`}const c=Object.keys(u).sort();let d="{";for(let m=0;m<c.length;m++)d+=`${JSON.stringify(c[m])}:${vh(u[c[m]])},`;return`${d}}`}function Gl(u){let o="";for(const c of vi)o+=`/${vh(u[c])}`;return o}function xh(u){const o=u.value;return o?[new oe(u.key,o,"constants have been deprecated as of v8")]:[]}function kn(u){return u instanceof Number||u instanceof String||u instanceof Boolean?u.valueOf():u}function al(u){if(Array.isArray(u))return u.map(al);if(u instanceof Object&&!(u instanceof Number||u instanceof String||u instanceof Boolean)){const o={};for(const c in u)o[c]=al(u[c]);return o}return kn(u)}function go(u){const o=u.key,c=u.value,d=u.valueSpec||{},m=u.objectElementValidators||{},b=u.style,w=u.styleSpec,I=u.validateSpec;let P=[];const R=Gr(c);if(R!=="object")return[new oe(o,c,`object expected, ${R} found`)];for(const F in c){const j=F.split(".")[0],Z=d[j]||d["*"];let K;if(m[j])K=m[j];else if(d[j])K=I;else if(m["*"])K=m["*"];else{if(!d["*"]){P.push(new oe(o,c[F],`unknown property "${F}"`));continue}K=I}P=P.concat(K({key:(o&&`${o}.`)+F,value:c[F],valueSpec:Z,style:b,styleSpec:w,object:c,objectKey:F,validateSpec:I},c))}for(const F in d)m[F]||d[F].required&&d[F].default===void 0&&c[F]===void 0&&P.push(new oe(o,c,`missing required property "${F}"`));return P}function la(u){const o=u.value,c=u.valueSpec,d=u.style,m=u.styleSpec,b=u.key,w=u.arrayElementValidator||u.validateSpec;if(Gr(o)!=="array")return[new oe(b,o,`array expected, ${Gr(o)} found`)];if(c.length&&o.length!==c.length)return[new oe(b,o,`array length ${c.length} expected, length ${o.length} found`)];if(c["min-length"]&&o.length<c["min-length"])return[new oe(b,o,`array length at least ${c["min-length"]} expected, length ${o.length} found`)];let I={type:c.value,values:c.values};m.$version<7&&(I.function=c.function),Gr(c.value)==="object"&&(I=c.value);let P=[];for(let R=0;R<o.length;R++)P=P.concat(w({array:o,arrayIndex:R,value:o[R],valueSpec:I,validateSpec:u.validateSpec,style:d,styleSpec:m,key:`${b}[${R}]`}));return P}function Iu(u){const o=u.key,c=u.value,d=u.valueSpec;let m=Gr(c);return m==="number"&&c!=c&&(m="NaN"),m!=="number"?[new oe(o,c,`number expected, ${m} found`)]:"minimum"in d&&c<d.minimum?[new oe(o,c,`${c} is less than the minimum value ${d.minimum}`)]:"maximum"in d&&c>d.maximum?[new oe(o,c,`${c} is greater than the maximum value ${d.maximum}`)]:[]}function bh(u){const o=u.valueSpec,c=kn(u.value.type);let d,m,b,w={};const I=c!=="categorical"&&u.value.property===void 0,P=!I,R=Gr(u.value.stops)==="array"&&Gr(u.value.stops[0])==="array"&&Gr(u.value.stops[0][0])==="object",F=go({key:u.key,value:u.value,valueSpec:u.styleSpec.function,validateSpec:u.validateSpec,style:u.style,styleSpec:u.styleSpec,objectElementValidators:{stops:function(K){if(c==="identity")return[new oe(K.key,K.value,'identity function may not have a "stops" property')];let Q=[];const at=K.value;return Q=Q.concat(la({key:K.key,value:at,valueSpec:K.valueSpec,validateSpec:K.validateSpec,style:K.style,styleSpec:K.styleSpec,arrayElementValidator:j})),Gr(at)==="array"&&at.length===0&&Q.push(new oe(K.key,at,"array must have at least one stop")),Q},default:function(K){return K.validateSpec({key:K.key,value:K.value,valueSpec:o,validateSpec:K.validateSpec,style:K.style,styleSpec:K.styleSpec})}}});return c==="identity"&&I&&F.push(new oe(u.key,u.value,'missing required property "property"')),c==="identity"||u.value.stops||F.push(new oe(u.key,u.value,'missing required property "stops"')),c==="exponential"&&u.valueSpec.expression&&!fp(u.valueSpec)&&F.push(new oe(u.key,u.value,"exponential functions not supported")),u.styleSpec.$version>=8&&(P&&!rl(u.valueSpec)?F.push(new oe(u.key,u.value,"property functions not supported")):I&&!bu(u.valueSpec)&&F.push(new oe(u.key,u.value,"zoom functions not supported"))),c!=="categorical"&&!R||u.value.property!==void 0||F.push(new oe(u.key,u.value,'"property" property is required')),F;function j(K){let Q=[];const at=K.value,gt=K.key;if(Gr(at)!=="array")return[new oe(gt,at,`array expected, ${Gr(at)} found`)];if(at.length!==2)return[new oe(gt,at,`array length 2 expected, length ${at.length} found`)];if(R){if(Gr(at[0])!=="object")return[new oe(gt,at,`object expected, ${Gr(at[0])} found`)];if(at[0].zoom===void 0)return[new oe(gt,at,"object stop key must have zoom")];if(at[0].value===void 0)return[new oe(gt,at,"object stop key must have value")];if(b&&b>kn(at[0].zoom))return[new oe(gt,at[0].zoom,"stop zoom values must appear in ascending order")];kn(at[0].zoom)!==b&&(b=kn(at[0].zoom),m=void 0,w={}),Q=Q.concat(go({key:`${gt}[0]`,value:at[0],valueSpec:{zoom:{}},validateSpec:K.validateSpec,style:K.style,styleSpec:K.styleSpec,objectElementValidators:{zoom:Iu,value:Z}}))}else Q=Q.concat(Z({key:`${gt}[0]`,value:at[0],valueSpec:{},validateSpec:K.validateSpec,style:K.style,styleSpec:K.styleSpec},at));return Ns(al(at[1]))?Q.concat([new oe(`${gt}[1]`,at[1],"expressions are not allowed in function stops.")]):Q.concat(K.validateSpec({key:`${gt}[1]`,value:at[1],valueSpec:o,validateSpec:K.validateSpec,style:K.style,styleSpec:K.styleSpec}))}function Z(K,Q){const at=Gr(K.value),gt=kn(K.value),_t=K.value!==null?K.value:Q;if(d){if(at!==d)return[new oe(K.key,_t,`${at} stop domain type must match previous stop domain type ${d}`)]}else d=at;if(at!=="number"&&at!=="string"&&at!=="boolean")return[new oe(K.key,_t,"stop domain value must be a number, string, or boolean")];if(at!=="number"&&c!=="categorical"){let At=`number expected, ${at} found`;return rl(o)&&c===void 0&&(At+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new oe(K.key,_t,At)]}return c!=="categorical"||at!=="number"||isFinite(gt)&&Math.floor(gt)===gt?c!=="categorical"&&at==="number"&&m!==void 0&&gt<m?[new oe(K.key,_t,"stop domain values must appear in ascending order")]:(m=gt,c==="categorical"&&gt in w?[new oe(K.key,_t,"stop domain values must be unique")]:(w[gt]=!0,[])):[new oe(K.key,_t,`integer expected, found ${gt}`)]}}function Lt(u){const o=(u.expressionContext==="property"?mh:fh)(al(u.value),u.valueSpec);if(o.result==="error")return o.value.map(d=>new oe(`${u.key}${d.key}`,u.value,d.message));const c=o.value.expression||o.value._styleExpression.expression;if(u.expressionContext==="property"&&u.propertyKey==="text-font"&&!c.outputDefined())return[new oe(u.key,u.value,`Invalid data expression for "${u.propertyKey}". Output values must be contained as literals within the expression.`)];if(u.expressionContext==="property"&&u.propertyType==="layout"&&!xu(c))return[new oe(u.key,u.value,'"feature-state" data expressions are not supported with layout properties.')];if(u.expressionContext==="filter"&&!xu(c))return[new oe(u.key,u.value,'"feature-state" data expressions are not supported with filters.')];if(u.expressionContext&&u.expressionContext.indexOf("cluster")===0){if(!nh(c,["zoom","feature-state"]))return[new oe(u.key,u.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(u.expressionContext==="cluster-initial"&&!fn(c))return[new oe(u.key,u.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function Xt(u){const o=u.key,c=u.value,d=u.valueSpec,m=[];return Array.isArray(d.values)?d.values.indexOf(kn(c))===-1&&m.push(new oe(o,c,`expected one of [${d.values.join(", ")}], ${JSON.stringify(c)} found`)):Object.keys(d.values).indexOf(kn(c))===-1&&m.push(new oe(o,c,`expected one of [${Object.keys(d.values).join(", ")}], ${JSON.stringify(c)} found`)),m}function ge(u){return ac(al(u.value))?Lt(po({},u,{expressionContext:"filter",valueSpec:{value:"boolean"}})):We(u)}function We(u){const o=u.value,c=u.key;if(Gr(o)!=="array")return[new oe(c,o,`array expected, ${Gr(o)} found`)];const d=u.styleSpec;let m,b=[];if(o.length<1)return[new oe(c,o,"filter array must have at least 1 element")];switch(b=b.concat(Xt({key:`${c}[0]`,value:o[0],valueSpec:d.filter_operator,style:u.style,styleSpec:u.styleSpec})),kn(o[0])){case"<":case"<=":case">":case">=":o.length>=2&&kn(o[1])==="$type"&&b.push(new oe(c,o,`"$type" cannot be use with operator "${o[0]}"`));case"==":case"!=":o.length!==3&&b.push(new oe(c,o,`filter array for operator "${o[0]}" must have 3 elements`));case"in":case"!in":o.length>=2&&(m=Gr(o[1]),m!=="string"&&b.push(new oe(`${c}[1]`,o[1],`string expected, ${m} found`)));for(let w=2;w<o.length;w++)m=Gr(o[w]),kn(o[1])==="$type"?b=b.concat(Xt({key:`${c}[${w}]`,value:o[w],valueSpec:d.geometry_type,style:u.style,styleSpec:u.styleSpec})):m!=="string"&&m!=="number"&&m!=="boolean"&&b.push(new oe(`${c}[${w}]`,o[w],`string, number, or boolean expected, ${m} found`));break;case"any":case"all":case"none":for(let w=1;w<o.length;w++)b=b.concat(We({key:`${c}[${w}]`,value:o[w],style:u.style,styleSpec:u.styleSpec}));break;case"has":case"!has":m=Gr(o[1]),o.length!==2?b.push(new oe(c,o,`filter array for "${o[0]}" operator must have 2 elements`)):m!=="string"&&b.push(new oe(`${c}[1]`,o[1],`string expected, ${m} found`));break;case"within":m=Gr(o[1]),o.length!==2?b.push(new oe(c,o,`filter array for "${o[0]}" operator must have 2 elements`)):m!=="object"&&b.push(new oe(`${c}[1]`,o[1],`object expected, ${m} found`))}return b}function En(u,o){const c=u.key,d=u.validateSpec,m=u.style,b=u.styleSpec,w=u.value,I=u.objectKey,P=b[`${o}_${u.layerType}`];if(!P)return[];const R=I.match(/^(.*)-transition$/);if(o==="paint"&&R&&P[R[1]]&&P[R[1]].transition)return d({key:c,value:w,valueSpec:b.transition,style:m,styleSpec:b});const F=u.valueSpec||P[I];if(!F)return[new oe(c,w,`unknown property "${I}"`)];let j;if(Gr(w)==="string"&&rl(F)&&!F.tokens&&(j=/^{([^}]+)}$/.exec(w)))return[new oe(c,w,`"${I}" does not support interpolation syntax
Use an identity property function instead: \`{ "type": "identity", "property": ${JSON.stringify(j[1])} }\`.`)];const Z=[];return u.layerType==="symbol"&&(I==="text-field"&&m&&!m.glyphs&&Z.push(new oe(c,w,'use of "text-field" requires a style "glyphs" property')),I==="text-font"&&Nn(al(w))&&kn(w.type)==="identity"&&Z.push(new oe(c,w,'"text-font" does not support identity functions'))),Z.concat(d({key:u.key,value:w,valueSpec:F,style:m,styleSpec:b,expressionContext:"property",propertyType:o,propertyKey:I}))}function Rr(u){return En(u,"paint")}function Zn(u){return En(u,"layout")}function Jn(u){let o=[];const c=u.value,d=u.key,m=u.style,b=u.styleSpec;c.type||c.ref||o.push(new oe(d,c,'either "type" or "ref" is required'));let w=kn(c.type);const I=kn(c.ref);if(c.id){const P=kn(c.id);for(let R=0;R<u.arrayIndex;R++){const F=m.layers[R];kn(F.id)===P&&o.push(new oe(d,c.id,`duplicate layer id "${c.id}", previously used at line ${F.id.__line__}`))}}if("ref"in c){let P;["type","source","source-layer","filter","layout"].forEach(R=>{R in c&&o.push(new oe(d,c[R],`"${R}" is prohibited for ref layers`))}),m.layers.forEach(R=>{kn(R.id)===I&&(P=R)}),P?P.ref?o.push(new oe(d,c.ref,"ref cannot reference another ref layer")):w=kn(P.type):o.push(new oe(d,c.ref,`ref layer "${I}" not found`))}else if(w!=="background")if(c.source){const P=m.sources&&m.sources[c.source],R=P&&kn(P.type);P?R==="vector"&&w==="raster"?o.push(new oe(d,c.source,`layer "${c.id}" requires a raster source`)):R!=="raster-dem"&&w==="hillshade"?o.push(new oe(d,c.source,`layer "${c.id}" requires a raster-dem source`)):R==="raster"&&w!=="raster"?o.push(new oe(d,c.source,`layer "${c.id}" requires a vector source`)):R!=="vector"||c["source-layer"]?R==="raster-dem"&&w!=="hillshade"?o.push(new oe(d,c.source,"raster-dem source can only be used with layer type 'hillshade'.")):w!=="line"||!c.paint||!c.paint["line-gradient"]||R==="geojson"&&P.lineMetrics||o.push(new oe(d,c,`layer "${c.id}" specifies a line-gradient, which requires a GeoJSON source with \`lineMetrics\` enabled.`)):o.push(new oe(d,c,`layer "${c.id}" must specify a "source-layer"`)):o.push(new oe(d,c.source,`source "${c.source}" not found`))}else o.push(new oe(d,c,'missing required property "source"'));return o=o.concat(go({key:d,value:c,valueSpec:b.layer,style:u.style,styleSpec:u.styleSpec,validateSpec:u.validateSpec,objectElementValidators:{"*":()=>[],type:()=>u.validateSpec({key:`${d}.type`,value:c.type,valueSpec:b.layer.type,style:u.style,styleSpec:u.styleSpec,validateSpec:u.validateSpec,object:c,objectKey:"type"}),filter:ge,layout:P=>go({layer:c,key:P.key,value:P.value,style:P.style,styleSpec:P.styleSpec,validateSpec:P.validateSpec,objectElementValidators:{"*":R=>Zn(po({layerType:w},R))}}),paint:P=>go({layer:c,key:P.key,value:P.value,style:P.style,styleSpec:P.styleSpec,validateSpec:P.validateSpec,objectElementValidators:{"*":R=>Rr(po({layerType:w},R))}})}})),o}function ui(u){const o=u.value,c=u.key,d=Gr(o);return d!=="string"?[new oe(c,o,`string expected, ${d} found`)]:[]}const jn={promoteId:function({key:u,value:o}){if(Gr(o)==="string")return ui({key:u,value:o});{const c=[];for(const d in o)c.push(...ui({key:`${u}.${d}`,value:o[d]}));return c}}};function rn(u){const o=u.value,c=u.key,d=u.styleSpec,m=u.style,b=u.validateSpec;if(!o.type)return[new oe(c,o,'"type" is required')];const w=kn(o.type);let I;switch(w){case"vector":case"raster":return I=go({key:c,value:o,valueSpec:d[`source_${w.replace("-","_")}`],style:u.style,styleSpec:d,objectElementValidators:jn,validateSpec:b}),I;case"raster-dem":return I=function(P){var R;const F=(R=P.sourceName)!==null&&R!==void 0?R:"",j=P.value,Z=P.styleSpec,K=Z.source_raster_dem,Q=P.style;let at=[];const gt=Gr(j);if(j===void 0)return at;if(gt!=="object")return at.push(new oe("source_raster_dem",j,`object expected, ${gt} found`)),at;const _t=kn(j.encoding)==="custom",At=["redFactor","greenFactor","blueFactor","baseShift"],Tt=P.value.encoding?`"${P.value.encoding}"`:"Default";for(const Rt in j)!_t&&At.includes(Rt)?at.push(new oe(Rt,j[Rt],`In "${F}": "${Rt}" is only valid when "encoding" is set to "custom". ${Tt} encoding found`)):K[Rt]?at=at.concat(P.validateSpec({key:Rt,value:j[Rt],valueSpec:K[Rt],validateSpec:P.validateSpec,style:Q,styleSpec:Z})):at.push(new oe(Rt,j[Rt],`unknown property "${Rt}"`));return at}({sourceName:c,value:o,style:u.style,styleSpec:d,validateSpec:b}),I;case"geojson":if(I=go({key:c,value:o,valueSpec:d.source_geojson,style:m,styleSpec:d,validateSpec:b,objectElementValidators:jn}),o.cluster)for(const P in o.clusterProperties){const[R,F]=o.clusterProperties[P],j=typeof R=="string"?[R,["accumulated"],["get",P]]:R;I.push(...Lt({key:`${c}.${P}.map`,value:F,validateSpec:b,expressionContext:"cluster-map"})),I.push(...Lt({key:`${c}.${P}.reduce`,value:j,validateSpec:b,expressionContext:"cluster-reduce"}))}return I;case"video":return go({key:c,value:o,valueSpec:d.source_video,style:m,validateSpec:b,styleSpec:d});case"image":return go({key:c,value:o,valueSpec:d.source_image,style:m,validateSpec:b,styleSpec:d});case"canvas":return[new oe(c,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return Xt({key:`${c}.type`,value:o.type,valueSpec:{values:["vector","raster","raster-dem","geojson","video","image"]},style:m,validateSpec:b,styleSpec:d})}}function Ro(u){const o=u.value,c=u.styleSpec,d=c.light,m=u.style;let b=[];const w=Gr(o);if(o===void 0)return b;if(w!=="object")return b=b.concat([new oe("light",o,`object expected, ${w} found`)]),b;for(const I in o){const P=I.match(/^(.*)-transition$/);b=b.concat(P&&d[P[1]]&&d[P[1]].transition?u.validateSpec({key:I,value:o[I],valueSpec:c.transition,validateSpec:u.validateSpec,style:m,styleSpec:c}):d[I]?u.validateSpec({key:I,value:o[I],valueSpec:d[I],validateSpec:u.validateSpec,style:m,styleSpec:c}):[new oe(I,o[I],`unknown property "${I}"`)])}return b}function ua(u){const o=u.value,c=u.styleSpec,d=c.terrain,m=u.style;let b=[];const w=Gr(o);if(o===void 0)return b;if(w!=="object")return b=b.concat([new oe("terrain",o,`object expected, ${w} found`)]),b;for(const I in o)b=b.concat(d[I]?u.validateSpec({key:I,value:o[I],valueSpec:d[I],validateSpec:u.validateSpec,style:m,styleSpec:c}):[new oe(I,o[I],`unknown property "${I}"`)]);return b}function eo(u){let o=[];const c=u.value,d=u.key;if(Array.isArray(c)){const m=[],b=[];for(const w in c)c[w].id&&m.includes(c[w].id)&&o.push(new oe(d,c,`all the sprites' ids must be unique, but ${c[w].id} is duplicated`)),m.push(c[w].id),c[w].url&&b.includes(c[w].url)&&o.push(new oe(d,c,`all the sprites' URLs must be unique, but ${c[w].url} is duplicated`)),b.push(c[w].url),o=o.concat(go({key:`${d}[${w}]`,value:c[w],valueSpec:{id:{type:"string",required:!0},url:{type:"string",required:!0}},validateSpec:u.validateSpec}));return o}return ui({key:d,value:c})}const ca={"*":()=>[],array:la,boolean:function(u){const o=u.value,c=u.key,d=Gr(o);return d!=="boolean"?[new oe(c,o,`boolean expected, ${d} found`)]:[]},number:Iu,color:function(u){const o=u.key,c=u.value,d=Gr(c);return d!=="string"?[new oe(o,c,`color expected, ${d} found`)]:Qr.parse(String(c))?[]:[new oe(o,c,`color expected, "${c}" found`)]},constants:xh,enum:Xt,filter:ge,function:bh,layer:Jn,object:go,source:rn,light:Ro,terrain:ua,string:ui,formatted:function(u){return ui(u).length===0?[]:Lt(u)},resolvedImage:function(u){return ui(u).length===0?[]:Lt(u)},padding:function(u){const o=u.key,c=u.value;if(Gr(c)==="array"){if(c.length<1||c.length>4)return[new oe(o,c,`padding requires 1 to 4 values; ${c.length} values found`)];const d={type:"number"};let m=[];for(let b=0;b<c.length;b++)m=m.concat(u.validateSpec({key:`${o}[${b}]`,value:c[b],validateSpec:u.validateSpec,valueSpec:d}));return m}return Iu({key:o,value:c,valueSpec:{}})},variableAnchorOffsetCollection:function(u){const o=u.key,c=u.value,d=Gr(c),m=u.styleSpec;if(d!=="array"||c.length<1||c.length%2!=0)return[new oe(o,c,"variableAnchorOffsetCollection requires a non-empty array of even length")];let b=[];for(let w=0;w<c.length;w+=2)b=b.concat(Xt({key:`${o}[${w}]`,value:c[w],valueSpec:m.layout_symbol["text-anchor"]})),b=b.concat(la({key:`${o}[${w+1}]`,value:c[w+1],valueSpec:{length:2,value:"number"},validateSpec:u.validateSpec,style:u.style,styleSpec:m}));return b},sprite:eo};function Do(u){const o=u.value,c=u.valueSpec,d=u.styleSpec;return u.validateSpec=Do,c.expression&&Nn(kn(o))?bh(u):c.expression&&Ns(al(o))?Lt(u):c.type&&ca[c.type]?ca[c.type](u):go(po({},u,{valueSpec:c.type?d[c.type]:c}))}function lc(u){const o=u.value,c=u.key,d=ui(u);return d.length||(o.indexOf("{fontstack}")===-1&&d.push(new oe(c,o,'"glyphs" url must include a "{fontstack}" token')),o.indexOf("{range}")===-1&&d.push(new oe(c,o,'"glyphs" url must include a "{range}" token'))),d}function zi(u,o=Gt){let c=[];return c=c.concat(Do({key:"",value:u,valueSpec:o.$root,styleSpec:o,style:u,validateSpec:Do,objectElementValidators:{glyphs:lc,"*":()=>[]}})),u.constants&&(c=c.concat(xh({key:"constants",value:u.constants,style:u,styleSpec:o,validateSpec:Do}))),uc(c)}function Yo(u){return function(o){return u({...o,validateSpec:Do})}}function uc(u){return[].concat(u).sort((o,c)=>o.line-c.line)}function La(u){return function(...o){return uc(u.apply(this,o))}}zi.source=La(Yo(rn)),zi.sprite=La(Yo(eo)),zi.glyphs=La(Yo(lc)),zi.light=La(Yo(Ro)),zi.terrain=La(Yo(ua)),zi.layer=La(Yo(Jn)),zi.filter=La(Yo(ge)),zi.paintProperty=La(Yo(Rr)),zi.layoutProperty=La(Yo(Zn));const Ra=zi,yn=Ra.light,nn=Ra.paintProperty,cc=Ra.layoutProperty;function ks(u,o){let c=!1;if(o&&o.length)for(const d of o)u.fire(new _i(new Error(d.message))),c=!0;return c}class ll{constructor(o,c,d){const m=this.cells=[];if(o instanceof ArrayBuffer){this.arrayBuffer=o;const w=new Int32Array(this.arrayBuffer);o=w[0],this.d=(c=w[1])+2*(d=w[2]);for(let P=0;P<this.d*this.d;P++){const R=w[3+P],F=w[3+P+1];m.push(R===F?null:w.subarray(R,F))}const I=w[3+m.length+1];this.keys=w.subarray(w[3+m.length],I),this.bboxes=w.subarray(I),this.insert=this._insertReadonly}else{this.d=c+2*d;for(let w=0;w<this.d*this.d;w++)m.push([]);this.keys=[],this.bboxes=[]}this.n=c,this.extent=o,this.padding=d,this.scale=c/o,this.uid=0;const b=d/c*o;this.min=-b,this.max=o+b}insert(o,c,d,m,b){this._forEachCell(c,d,m,b,this._insertCell,this.uid++,void 0,void 0),this.keys.push(o),this.bboxes.push(c),this.bboxes.push(d),this.bboxes.push(m),this.bboxes.push(b)}_insertReadonly(){throw new Error("Cannot insert into a GridIndex created from an ArrayBuffer.")}_insertCell(o,c,d,m,b,w){this.cells[b].push(w)}query(o,c,d,m,b){const w=this.min,I=this.max;if(o<=w&&c<=w&&I<=d&&I<=m&&!b)return Array.prototype.slice.call(this.keys);{const P=[];return this._forEachCell(o,c,d,m,this._queryCell,P,{},b),P}}_queryCell(o,c,d,m,b,w,I,P){const R=this.cells[b];if(R!==null){const F=this.keys,j=this.bboxes;for(let Z=0;Z<R.length;Z++){const K=R[Z];if(I[K]===void 0){const Q=4*K;(P?P(j[Q+0],j[Q+1],j[Q+2],j[Q+3]):o<=j[Q+2]&&c<=j[Q+3]&&d>=j[Q+0]&&m>=j[Q+1])?(I[K]=!0,w.push(F[K])):I[K]=!1}}}}_forEachCell(o,c,d,m,b,w,I,P){const R=this._convertToCellCoord(o),F=this._convertToCellCoord(c),j=this._convertToCellCoord(d),Z=this._convertToCellCoord(m);for(let K=R;K<=j;K++)for(let Q=F;Q<=Z;Q++){const at=this.d*Q+K;if((!P||P(this._convertFromCellCoord(K),this._convertFromCellCoord(Q),this._convertFromCellCoord(K+1),this._convertFromCellCoord(Q+1)))&&b.call(this,o,c,d,m,at,w,I,P))return}}_convertFromCellCoord(o){return(o-this.padding)/this.scale}_convertToCellCoord(o){return Math.max(0,Math.min(this.d-1,Math.floor(o*this.scale)+this.padding))}toArrayBuffer(){if(this.arrayBuffer)return this.arrayBuffer;const o=this.cells,c=3+this.cells.length+1+1;let d=0;for(let w=0;w<this.cells.length;w++)d+=this.cells[w].length;const m=new Int32Array(c+d+this.keys.length+this.bboxes.length);m[0]=this.extent,m[1]=this.n,m[2]=this.padding;let b=c;for(let w=0;w<o.length;w++){const I=o[w];m[3+w]=b,m.set(I,b),b+=I.length}return m[3+o.length]=b,m.set(this.keys,b),b+=this.keys.length,m[3+o.length+1]=b,m.set(this.bboxes,b),b+=this.bboxes.length,m.buffer}static serialize(o,c){const d=o.toArrayBuffer();return c&&c.push(d),{buffer:d}}static deserialize(o){return new ll(o.buffer)}}const ci={};function be(u,o,c={}){if(ci[u])throw new Error(`${u} is already registered.`);Object.defineProperty(o,"_classRegistryKey",{value:u,writeable:!1}),ci[u]={klass:o,omit:c.omit||[],shallow:c.shallow||[]}}be("Object",Object),be("TransferableGridIndex",ll),be("Color",Qr),be("Error",Error),be("AJAXError",co),be("ResolvedImage",ki),be("StylePropertyFunction",Su),be("StyleExpression",wu,{omit:["_evaluator"]}),be("ZoomDependentExpression",ol),be("ZoomConstantExpression",Eu),be("CompoundExpression",Po,{omit:["_evaluate"]});for(const u in jl)jl[u]._classRegistryKey||be(`Expression_${u}`,jl[u]);function Os(u){return u&&typeof ArrayBuffer<"u"&&(u instanceof ArrayBuffer||u.constructor&&u.constructor.name==="ArrayBuffer")}function fs(u,o){if(u==null||typeof u=="boolean"||typeof u=="number"||typeof u=="string"||u instanceof Boolean||u instanceof Number||u instanceof String||u instanceof Date||u instanceof RegExp||u instanceof Blob)return u;if(Os(u)||xr(u))return o&&o.push(u),u;if(ArrayBuffer.isView(u)){const c=u;return o&&o.push(c.buffer),c}if(u instanceof ImageData)return o&&o.push(u.data.buffer),u;if(Array.isArray(u)){const c=[];for(const d of u)c.push(fs(d,o));return c}if(typeof u=="object"){const c=u.constructor,d=c._classRegistryKey;if(!d)throw new Error("can't serialize object of unregistered class");if(!ci[d])throw new Error(`${d} is not registered.`);const m=c.serialize?c.serialize(u,o):{};if(c.serialize){if(o&&m===o[o.length-1])throw new Error("statically serialized object won't survive transfer of $name property")}else{for(const b in u){if(!u.hasOwnProperty(b)||ci[d].omit.indexOf(b)>=0)continue;const w=u[b];m[b]=ci[d].shallow.indexOf(b)>=0?w:fs(w,o)}u instanceof Error&&(m.message=u.message)}if(m.$name)throw new Error("$name property is reserved for worker serialization logic.");return d!=="Object"&&(m.$name=d),m}throw new Error("can't serialize object of type "+typeof u)}function Da(u){if(u==null||typeof u=="boolean"||typeof u=="number"||typeof u=="string"||u instanceof Boolean||u instanceof Number||u instanceof String||u instanceof Date||u instanceof RegExp||u instanceof Blob||Os(u)||xr(u)||ArrayBuffer.isView(u)||u instanceof ImageData)return u;if(Array.isArray(u))return u.map(Da);if(typeof u=="object"){const o=u.$name||"Object";if(!ci[o])throw new Error(`can't deserialize unregistered class ${o}`);const{klass:c}=ci[o];if(!c)throw new Error(`can't deserialize unregistered class ${o}`);if(c.deserialize)return c.deserialize(u);const d=Object.create(c.prototype);for(const m of Object.keys(u)){if(m==="$name")continue;const b=u[m];d[m]=ci[o].shallow.indexOf(m)>=0?b:Da(b)}return d}throw new Error("can't deserialize object of type "+typeof u)}class ql{constructor(){this.first=!0}update(o,c){const d=Math.floor(o);return this.first?(this.first=!1,this.lastIntegerZoom=d,this.lastIntegerZoomTime=0,this.lastZoom=o,this.lastFloorZoom=d,!0):(this.lastFloorZoom>d?(this.lastIntegerZoom=d+1,this.lastIntegerZoomTime=c):this.lastFloorZoom<d&&(this.lastIntegerZoom=d,this.lastIntegerZoomTime=c),o!==this.lastZoom&&(this.lastZoom=o,this.lastFloorZoom=d,!0))}}const pe={"Latin-1 Supplement":u=>u>=128&&u<=255,Arabic:u=>u>=1536&&u<=1791,"Arabic Supplement":u=>u>=1872&&u<=1919,"Arabic Extended-A":u=>u>=2208&&u<=2303,"Hangul Jamo":u=>u>=4352&&u<=4607,"Unified Canadian Aboriginal Syllabics":u=>u>=5120&&u<=5759,Khmer:u=>u>=6016&&u<=6143,"Unified Canadian Aboriginal Syllabics Extended":u=>u>=6320&&u<=6399,"General Punctuation":u=>u>=8192&&u<=8303,"Letterlike Symbols":u=>u>=8448&&u<=8527,"Number Forms":u=>u>=8528&&u<=8591,"Miscellaneous Technical":u=>u>=8960&&u<=9215,"Control Pictures":u=>u>=9216&&u<=9279,"Optical Character Recognition":u=>u>=9280&&u<=9311,"Enclosed Alphanumerics":u=>u>=9312&&u<=9471,"Geometric Shapes":u=>u>=9632&&u<=9727,"Miscellaneous Symbols":u=>u>=9728&&u<=9983,"Miscellaneous Symbols and Arrows":u=>u>=11008&&u<=11263,"CJK Radicals Supplement":u=>u>=11904&&u<=12031,"Kangxi Radicals":u=>u>=12032&&u<=12255,"Ideographic Description Characters":u=>u>=12272&&u<=12287,"CJK Symbols and Punctuation":u=>u>=12288&&u<=12351,Hiragana:u=>u>=12352&&u<=12447,Katakana:u=>u>=12448&&u<=12543,Bopomofo:u=>u>=12544&&u<=12591,"Hangul Compatibility Jamo":u=>u>=12592&&u<=12687,Kanbun:u=>u>=12688&&u<=12703,"Bopomofo Extended":u=>u>=12704&&u<=12735,"CJK Strokes":u=>u>=12736&&u<=12783,"Katakana Phonetic Extensions":u=>u>=12784&&u<=12799,"Enclosed CJK Letters and Months":u=>u>=12800&&u<=13055,"CJK Compatibility":u=>u>=13056&&u<=13311,"CJK Unified Ideographs Extension A":u=>u>=13312&&u<=19903,"Yijing Hexagram Symbols":u=>u>=19904&&u<=19967,"CJK Unified Ideographs":u=>u>=19968&&u<=40959,"Yi Syllables":u=>u>=40960&&u<=42127,"Yi Radicals":u=>u>=42128&&u<=42191,"Hangul Jamo Extended-A":u=>u>=43360&&u<=43391,"Hangul Syllables":u=>u>=44032&&u<=55215,"Hangul Jamo Extended-B":u=>u>=55216&&u<=55295,"Private Use Area":u=>u>=57344&&u<=63743,"CJK Compatibility Ideographs":u=>u>=63744&&u<=64255,"Arabic Presentation Forms-A":u=>u>=64336&&u<=65023,"Vertical Forms":u=>u>=65040&&u<=65055,"CJK Compatibility Forms":u=>u>=65072&&u<=65103,"Small Form Variants":u=>u>=65104&&u<=65135,"Arabic Presentation Forms-B":u=>u>=65136&&u<=65279,"Halfwidth and Fullwidth Forms":u=>u>=65280&&u<=65519};function wh(u){for(const o of u)if(Mu(o.charCodeAt(0)))return!0;return!1}function Cu(u){for(const o of u)if(!mp(o.charCodeAt(0)))return!1;return!0}function mp(u){return!(pe.Arabic(u)||pe["Arabic Supplement"](u)||pe["Arabic Extended-A"](u)||pe["Arabic Presentation Forms-A"](u)||pe["Arabic Presentation Forms-B"](u))}function Mu(u){return!(u!==746&&u!==747&&(u<4352||!(pe["Bopomofo Extended"](u)||pe.Bopomofo(u)||pe["CJK Compatibility Forms"](u)&&!(u>=65097&&u<=65103)||pe["CJK Compatibility Ideographs"](u)||pe["CJK Compatibility"](u)||pe["CJK Radicals Supplement"](u)||pe["CJK Strokes"](u)||!(!pe["CJK Symbols and Punctuation"](u)||u>=12296&&u<=12305||u>=12308&&u<=12319||u===12336)||pe["CJK Unified Ideographs Extension A"](u)||pe["CJK Unified Ideographs"](u)||pe["Enclosed CJK Letters and Months"](u)||pe["Hangul Compatibility Jamo"](u)||pe["Hangul Jamo Extended-A"](u)||pe["Hangul Jamo Extended-B"](u)||pe["Hangul Jamo"](u)||pe["Hangul Syllables"](u)||pe.Hiragana(u)||pe["Ideographic Description Characters"](u)||pe.Kanbun(u)||pe["Kangxi Radicals"](u)||pe["Katakana Phonetic Extensions"](u)||pe.Katakana(u)&&u!==12540||!(!pe["Halfwidth and Fullwidth Forms"](u)||u===65288||u===65289||u===65293||u>=65306&&u<=65310||u===65339||u===65341||u===65343||u>=65371&&u<=65503||u===65507||u>=65512&&u<=65519)||!(!pe["Small Form Variants"](u)||u>=65112&&u<=65118||u>=65123&&u<=65126)||pe["Unified Canadian Aboriginal Syllabics"](u)||pe["Unified Canadian Aboriginal Syllabics Extended"](u)||pe["Vertical Forms"](u)||pe["Yijing Hexagram Symbols"](u)||pe["Yi Syllables"](u)||pe["Yi Radicals"](u))))}function hc(u){return!(Mu(u)||function(o){return!!(pe["Latin-1 Supplement"](o)&&(o===167||o===169||o===174||o===177||o===188||o===189||o===190||o===215||o===247)||pe["General Punctuation"](o)&&(o===8214||o===8224||o===8225||o===8240||o===8241||o===8251||o===8252||o===8258||o===8263||o===8264||o===8265||o===8273)||pe["Letterlike Symbols"](o)||pe["Number Forms"](o)||pe["Miscellaneous Technical"](o)&&(o>=8960&&o<=8967||o>=8972&&o<=8991||o>=8996&&o<=9e3||o===9003||o>=9085&&o<=9114||o>=9150&&o<=9165||o===9167||o>=9169&&o<=9179||o>=9186&&o<=9215)||pe["Control Pictures"](o)&&o!==9251||pe["Optical Character Recognition"](o)||pe["Enclosed Alphanumerics"](o)||pe["Geometric Shapes"](o)||pe["Miscellaneous Symbols"](o)&&!(o>=9754&&o<=9759)||pe["Miscellaneous Symbols and Arrows"](o)&&(o>=11026&&o<=11055||o>=11088&&o<=11097||o>=11192&&o<=11243)||pe["CJK Symbols and Punctuation"](o)||pe.Katakana(o)||pe["Private Use Area"](o)||pe["CJK Compatibility Forms"](o)||pe["Small Form Variants"](o)||pe["Halfwidth and Fullwidth Forms"](o)||o===8734||o===8756||o===8757||o>=9984&&o<=10087||o>=10102&&o<=10131||o===65532||o===65533)}(u))}function gp(u){return u>=1424&&u<=2303||pe["Arabic Presentation Forms-A"](u)||pe["Arabic Presentation Forms-B"](u)}function pc(u,o){return!(!o&&gp(u)||u>=2304&&u<=3583||u>=3840&&u<=4255||pe.Khmer(u))}function Eh(u){for(const o of u)if(gp(o.charCodeAt(0)))return!0;return!1}const Tf="deferred",If="loading",Cf="loaded";let Mf=null,ms="unavailable",Pu=null;const yp=function(u){u&&typeof u=="string"&&u.indexOf("NetworkError")>-1&&(ms="error"),Mf&&Mf(u)};function Pf(){_p.fire(new us("pluginStateChange",{pluginStatus:ms,pluginURL:Pu}))}const _p=new Kr,Af=function(){return ms},Pg=function(){if(ms!==Tf||!Pu)throw new Error("rtl-text-plugin cannot be downloaded unless a pluginURL is specified");ms=If,Pf(),Pu&&Io({url:Pu},u=>{u?yp(u):(ms=Cf,Pf())})},Fs={applyArabicShaping:null,processBidirectionalText:null,processStyledBidirectionalText:null,isLoaded:()=>ms===Cf||Fs.applyArabicShaping!=null,isLoading:()=>ms===If,setState(u){if(!Me())throw new Error("Cannot set the state of the rtl-text-plugin when not in the web-worker context");ms=u.pluginStatus,Pu=u.pluginURL},isParsed(){if(!Me())throw new Error("rtl-text-plugin is only parsed on the worker-threads");return Fs.applyArabicShaping!=null&&Fs.processBidirectionalText!=null&&Fs.processStyledBidirectionalText!=null},getPluginURL(){if(!Me())throw new Error("rtl-text-plugin url can only be queried from the worker threads");return Pu}};class On{constructor(o,c){this.zoom=o,c?(this.now=c.now,this.fadeDuration=c.fadeDuration,this.zoomHistory=c.zoomHistory,this.transition=c.transition):(this.now=0,this.fadeDuration=0,this.zoomHistory=new ql,this.transition={})}isSupportedScript(o){return function(c,d){for(const m of c)if(!pc(m.charCodeAt(0),d))return!1;return!0}(o,Fs.isLoaded())}crossFadingFactor(){return this.fadeDuration===0?1:Math.min((this.now-this.zoomHistory.lastIntegerZoomTime)/this.fadeDuration,1)}getCrossfadeParameters(){const o=this.zoom,c=o-Math.floor(o),d=this.crossFadingFactor();return o>this.zoomHistory.lastIntegerZoom?{fromScale:2,toScale:1,t:c+(1-c)*d}:{fromScale:.5,toScale:1,t:1-(1-d)*c}}}class ud{constructor(o,c){this.property=o,this.value=c,this.expression=function(d,m){if(Nn(d))return new Su(d,m);if(Ns(d)){const b=mh(d,m);if(b.result==="error")throw new Error(b.value.map(w=>`${w.key}: ${w.message}`).join(", "));return b.value}{let b=d;return m.type==="color"&&typeof d=="string"?b=Qr.parse(d):m.type!=="padding"||typeof d!="number"&&!Array.isArray(d)?m.type==="variableAnchorOffsetCollection"&&Array.isArray(d)&&(b=Ni.parse(d)):b=to.parse(d),{kind:"constant",evaluate:()=>b}}}(c===void 0?o.specification.default:c,o.specification)}isDataDriven(){return this.expression.kind==="source"||this.expression.kind==="composite"}possiblyEvaluate(o,c,d){return this.property.possiblyEvaluate(this,o,c,d)}}class Lf{constructor(o){this.property=o,this.value=new ud(o,void 0)}transitioned(o,c){return new Lg(this.property,this.value,c,et({},o.transition,this.transition),o.now)}untransitioned(){return new Lg(this.property,this.value,null,{},0)}}class Ag{constructor(o){this._properties=o,this._values=Object.create(o.defaultTransitionablePropertyValues)}getValue(o){return $t(this._values[o].value.value)}setValue(o,c){Object.prototype.hasOwnProperty.call(this._values,o)||(this._values[o]=new Lf(this._values[o].property)),this._values[o].value=new ud(this._values[o].property,c===null?void 0:$t(c))}getTransition(o){return $t(this._values[o].transition)}setTransition(o,c){Object.prototype.hasOwnProperty.call(this._values,o)||(this._values[o]=new Lf(this._values[o].property)),this._values[o].transition=$t(c)||void 0}serialize(){const o={};for(const c of Object.keys(this._values)){const d=this.getValue(c);d!==void 0&&(o[c]=d);const m=this.getTransition(c);m!==void 0&&(o[`${c}-transition`]=m)}return o}transitioned(o,c){const d=new Rg(this._properties);for(const m of Object.keys(this._values))d._values[m]=this._values[m].transitioned(o,c._values[m]);return d}untransitioned(){const o=new Rg(this._properties);for(const c of Object.keys(this._values))o._values[c]=this._values[c].untransitioned();return o}}class Lg{constructor(o,c,d,m,b){this.property=o,this.value=c,this.begin=b+m.delay||0,this.end=this.begin+m.duration||0,o.specification.transition&&(m.delay||m.duration)&&(this.prior=d)}possiblyEvaluate(o,c,d){const m=o.now||0,b=this.value.possiblyEvaluate(o,c,d),w=this.prior;if(w){if(m>this.end)return this.prior=null,b;if(this.value.isDataDriven())return this.prior=null,b;if(m<this.begin)return w.possiblyEvaluate(o,c,d);{const I=(m-this.begin)/(this.end-this.begin);return this.property.interpolate(w.possiblyEvaluate(o,c,d),b,function(P){if(P<=0)return 0;if(P>=1)return 1;const R=P*P,F=R*P;return 4*(P<.5?F:3*(P-R)+F-.75)}(I))}}return b}}class Rg{constructor(o){this._properties=o,this._values=Object.create(o.defaultTransitioningPropertyValues)}possiblyEvaluate(o,c,d){const m=new cd(this._properties);for(const b of Object.keys(this._values))m._values[b]=this._values[b].possiblyEvaluate(o,c,d);return m}hasTransition(){for(const o of Object.keys(this._values))if(this._values[o].prior)return!0;return!1}}class o0{constructor(o){this._properties=o,this._values=Object.create(o.defaultPropertyValues)}hasValue(o){return this._values[o].value!==void 0}getValue(o){return $t(this._values[o].value)}setValue(o,c){this._values[o]=new ud(this._values[o].property,c===null?void 0:$t(c))}serialize(){const o={};for(const c of Object.keys(this._values)){const d=this.getValue(c);d!==void 0&&(o[c]=d)}return o}possiblyEvaluate(o,c,d){const m=new cd(this._properties);for(const b of Object.keys(this._values))m._values[b]=this._values[b].possiblyEvaluate(o,c,d);return m}}class Ko{constructor(o,c,d){this.property=o,this.value=c,this.parameters=d}isConstant(){return this.value.kind==="constant"}constantOr(o){return this.value.kind==="constant"?this.value.value:o}evaluate(o,c,d,m){return this.property.evaluate(this.value,this.parameters,o,c,d,m)}}class cd{constructor(o){this._properties=o,this._values=Object.create(o.defaultPossiblyEvaluatedValues)}get(o){return this._values[o]}}class je{constructor(o){this.specification=o}possiblyEvaluate(o,c){if(o.isDataDriven())throw new Error("Value should not be data driven");return o.expression.evaluate(c)}interpolate(o,c,d){const m=mo[this.specification.type];return m?m(o,c,d):o}}class Ke{constructor(o,c){this.specification=o,this.overrides=c}possiblyEvaluate(o,c,d,m){return new Ko(this,o.expression.kind==="constant"||o.expression.kind==="camera"?{kind:"constant",value:o.expression.evaluate(c,null,{},d,m)}:o.expression,c)}interpolate(o,c,d){if(o.value.kind!=="constant"||c.value.kind!=="constant")return o;if(o.value.value===void 0||c.value.value===void 0)return new Ko(this,{kind:"constant",value:void 0},o.parameters);const m=mo[this.specification.type];if(m){const b=m(o.value.value,c.value.value,d);return new Ko(this,{kind:"constant",value:b},o.parameters)}return o}evaluate(o,c,d,m,b,w){return o.kind==="constant"?o.value:o.evaluate(c,d,m,b,w)}}class vp extends Ke{possiblyEvaluate(o,c,d,m){if(o.value===void 0)return new Ko(this,{kind:"constant",value:void 0},c);if(o.expression.kind==="constant"){const b=o.expression.evaluate(c,null,{},d,m),w=o.property.specification.type==="resolvedImage"&&typeof b!="string"?b.name:b,I=this._calculate(w,w,w,c);return new Ko(this,{kind:"constant",value:I},c)}if(o.expression.kind==="camera"){const b=this._calculate(o.expression.evaluate({zoom:c.zoom-1}),o.expression.evaluate({zoom:c.zoom}),o.expression.evaluate({zoom:c.zoom+1}),c);return new Ko(this,{kind:"constant",value:b},c)}return new Ko(this,o.expression,c)}evaluate(o,c,d,m,b,w){if(o.kind==="source"){const I=o.evaluate(c,d,m,b,w);return this._calculate(I,I,I,c)}return o.kind==="composite"?this._calculate(o.evaluate({zoom:Math.floor(c.zoom)-1},d,m),o.evaluate({zoom:Math.floor(c.zoom)},d,m),o.evaluate({zoom:Math.floor(c.zoom)+1},d,m),c):o.value}_calculate(o,c,d,m){return m.zoom>m.zoomHistory.lastIntegerZoom?{from:o,to:c}:{from:d,to:c}}interpolate(o){return o}}class Rf{constructor(o){this.specification=o}possiblyEvaluate(o,c,d,m){if(o.value!==void 0){if(o.expression.kind==="constant"){const b=o.expression.evaluate(c,null,{},d,m);return this._calculate(b,b,b,c)}return this._calculate(o.expression.evaluate(new On(Math.floor(c.zoom-1),c)),o.expression.evaluate(new On(Math.floor(c.zoom),c)),o.expression.evaluate(new On(Math.floor(c.zoom+1),c)),c)}}_calculate(o,c,d,m){return m.zoom>m.zoomHistory.lastIntegerZoom?{from:o,to:c}:{from:d,to:c}}interpolate(o){return o}}class Df{constructor(o){this.specification=o}possiblyEvaluate(o,c,d,m){return!!o.expression.evaluate(c,null,{},d,m)}interpolate(){return!1}}class Ei{constructor(o){this.properties=o,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];for(const c in o){const d=o[c];d.specification.overridable&&this.overridableProperties.push(c);const m=this.defaultPropertyValues[c]=new ud(d,void 0),b=this.defaultTransitionablePropertyValues[c]=new Lf(d);this.defaultTransitioningPropertyValues[c]=b.untransitioned(),this.defaultPossiblyEvaluatedValues[c]=m.possiblyEvaluate({})}}}be("DataDrivenProperty",Ke),be("DataConstantProperty",je),be("CrossFadedDataDrivenProperty",vp),be("CrossFadedProperty",Rf),be("ColorRampProperty",Df);const Nf="-transition";class ha extends Kr{constructor(o,c){if(super(),this.id=o.id,this.type=o.type,this._featureFilter={filter:()=>!0,needGeometry:!1},o.type!=="custom"&&(this.metadata=o.metadata,this.minzoom=o.minzoom,this.maxzoom=o.maxzoom,o.type!=="background"&&(this.source=o.source,this.sourceLayer=o["source-layer"],this.filter=o.filter),c.layout&&(this._unevaluatedLayout=new o0(c.layout)),c.paint)){this._transitionablePaint=new Ag(c.paint);for(const d in o.paint)this.setPaintProperty(d,o.paint[d],{validate:!1});for(const d in o.layout)this.setLayoutProperty(d,o.layout[d],{validate:!1});this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new cd(c.paint)}}getCrossfadeParameters(){return this._crossfadeParameters}getLayoutProperty(o){return o==="visibility"?this.visibility:this._unevaluatedLayout.getValue(o)}setLayoutProperty(o,c,d={}){c!=null&&this._validate(cc,`layers.${this.id}.layout.${o}`,o,c,d)||(o!=="visibility"?this._unevaluatedLayout.setValue(o,c):this.visibility=c)}getPaintProperty(o){return o.endsWith(Nf)?this._transitionablePaint.getTransition(o.slice(0,-11)):this._transitionablePaint.getValue(o)}setPaintProperty(o,c,d={}){if(c!=null&&this._validate(nn,`layers.${this.id}.paint.${o}`,o,c,d))return!1;if(o.endsWith(Nf))return this._transitionablePaint.setTransition(o.slice(0,-11),c||void 0),!1;{const m=this._transitionablePaint._values[o],b=m.property.specification["property-type"]==="cross-faded-data-driven",w=m.value.isDataDriven(),I=m.value;this._transitionablePaint.setValue(o,c),this._handleSpecialPaintPropertyUpdate(o);const P=this._transitionablePaint._values[o].value;return P.isDataDriven()||w||b||this._handleOverridablePaintPropertyUpdate(o,I,P)}}_handleSpecialPaintPropertyUpdate(o){}_handleOverridablePaintPropertyUpdate(o,c,d){return!1}isHidden(o){return!!(this.minzoom&&o<this.minzoom)||!!(this.maxzoom&&o>=this.maxzoom)||this.visibility==="none"}updateTransitions(o){this._transitioningPaint=this._transitionablePaint.transitioned(o,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(o,c){o.getCrossfadeParameters&&(this._crossfadeParameters=o.getCrossfadeParameters()),this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(o,void 0,c)),this.paint=this._transitioningPaint.possiblyEvaluate(o,void 0,c)}serialize(){const o={id:this.id,type:this.type,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.visibility&&(o.layout=o.layout||{},o.layout.visibility=this.visibility),xt(o,(c,d)=>!(c===void 0||d==="layout"&&!Object.keys(c).length||d==="paint"&&!Object.keys(c).length))}_validate(o,c,d,m,b={}){return(!b||b.validate!==!1)&&ks(this,o.call(Ra,{key:c,layerType:this.type,objectKey:d,value:m,styleSpec:Gt,style:{glyphs:!0,sprite:!0}}))}is3D(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}resize(){}isStateDependent(){for(const o in this.paint._values){const c=this.paint.get(o);if(c instanceof Ko&&rl(c.property.specification)&&(c.value.kind==="source"||c.value.kind==="composite")&&c.value.isStateDependent)return!0}return!1}}const Dg={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class dc{constructor(o,c){this._structArray=o,this._pos1=c*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class Qn{constructor(){this.isTransferred=!1,this.capacity=-1,this.resize(0)}static serialize(o,c){return o._trim(),c&&(o.isTransferred=!0,c.push(o.arrayBuffer)),{length:o.length,arrayBuffer:o.arrayBuffer}}static deserialize(o){const c=Object.create(this.prototype);return c.arrayBuffer=o.arrayBuffer,c.length=o.length,c.capacity=o.arrayBuffer.byteLength/c.bytesPerElement,c._refreshViews(),c}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(o){this.reserve(o),this.length=o}reserve(o){if(o>this.capacity){this.capacity=Math.max(o,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const c=this.uint8;this._refreshViews(),c&&this.uint8.set(c)}}_refreshViews(){throw new Error("_refreshViews() must be implemented by each concrete StructArray layout")}}function Wn(u,o=1){let c=0,d=0;return{members:u.map(m=>{const b=Dg[m.type].BYTES_PER_ELEMENT,w=c=Sh(c,Math.max(o,b)),I=m.components||1;return d=Math.max(d,b),c+=b*I,{name:m.name,type:m.type,components:I,offset:w}}),size:Sh(c,Math.max(d,o)),alignment:o}}function Sh(u,o){return Math.ceil(u/o)*o}class xp extends Qn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(o,c){const d=this.length;return this.resize(d+1),this.emplace(d,o,c)}emplace(o,c,d){const m=2*o;return this.int16[m+0]=c,this.int16[m+1]=d,o}}xp.prototype.bytesPerElement=4,be("StructArrayLayout2i4",xp);class bp extends Qn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(o,c,d){const m=this.length;return this.resize(m+1),this.emplace(m,o,c,d)}emplace(o,c,d,m){const b=3*o;return this.int16[b+0]=c,this.int16[b+1]=d,this.int16[b+2]=m,o}}bp.prototype.bytesPerElement=6,be("StructArrayLayout3i6",bp);class fc extends Qn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(o,c,d,m){const b=this.length;return this.resize(b+1),this.emplace(b,o,c,d,m)}emplace(o,c,d,m,b){const w=4*o;return this.int16[w+0]=c,this.int16[w+1]=d,this.int16[w+2]=m,this.int16[w+3]=b,o}}fc.prototype.bytesPerElement=8,be("StructArrayLayout4i8",fc);class kf extends Qn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(o,c,d,m,b,w){const I=this.length;return this.resize(I+1),this.emplace(I,o,c,d,m,b,w)}emplace(o,c,d,m,b,w,I){const P=6*o;return this.int16[P+0]=c,this.int16[P+1]=d,this.int16[P+2]=m,this.int16[P+3]=b,this.int16[P+4]=w,this.int16[P+5]=I,o}}kf.prototype.bytesPerElement=12,be("StructArrayLayout2i4i12",kf);class Of extends Qn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(o,c,d,m,b,w){const I=this.length;return this.resize(I+1),this.emplace(I,o,c,d,m,b,w)}emplace(o,c,d,m,b,w,I){const P=4*o,R=8*o;return this.int16[P+0]=c,this.int16[P+1]=d,this.uint8[R+4]=m,this.uint8[R+5]=b,this.uint8[R+6]=w,this.uint8[R+7]=I,o}}Of.prototype.bytesPerElement=8,be("StructArrayLayout2i4ub8",Of);class Th extends Qn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(o,c){const d=this.length;return this.resize(d+1),this.emplace(d,o,c)}emplace(o,c,d){const m=2*o;return this.float32[m+0]=c,this.float32[m+1]=d,o}}Th.prototype.bytesPerElement=8,be("StructArrayLayout2f8",Th);class Ff extends Qn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(o,c,d,m,b,w,I,P,R,F){const j=this.length;return this.resize(j+1),this.emplace(j,o,c,d,m,b,w,I,P,R,F)}emplace(o,c,d,m,b,w,I,P,R,F,j){const Z=10*o;return this.uint16[Z+0]=c,this.uint16[Z+1]=d,this.uint16[Z+2]=m,this.uint16[Z+3]=b,this.uint16[Z+4]=w,this.uint16[Z+5]=I,this.uint16[Z+6]=P,this.uint16[Z+7]=R,this.uint16[Z+8]=F,this.uint16[Z+9]=j,o}}Ff.prototype.bytesPerElement=20,be("StructArrayLayout10ui20",Ff);class zf extends Qn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(o,c,d,m,b,w,I,P,R,F,j,Z){const K=this.length;return this.resize(K+1),this.emplace(K,o,c,d,m,b,w,I,P,R,F,j,Z)}emplace(o,c,d,m,b,w,I,P,R,F,j,Z,K){const Q=12*o;return this.int16[Q+0]=c,this.int16[Q+1]=d,this.int16[Q+2]=m,this.int16[Q+3]=b,this.uint16[Q+4]=w,this.uint16[Q+5]=I,this.uint16[Q+6]=P,this.uint16[Q+7]=R,this.int16[Q+8]=F,this.int16[Q+9]=j,this.int16[Q+10]=Z,this.int16[Q+11]=K,o}}zf.prototype.bytesPerElement=24,be("StructArrayLayout4i4ui4i24",zf);class on extends Qn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(o,c,d){const m=this.length;return this.resize(m+1),this.emplace(m,o,c,d)}emplace(o,c,d,m){const b=3*o;return this.float32[b+0]=c,this.float32[b+1]=d,this.float32[b+2]=m,o}}on.prototype.bytesPerElement=12,be("StructArrayLayout3f12",on);class v extends Qn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(o){const c=this.length;return this.resize(c+1),this.emplace(c,o)}emplace(o,c){return this.uint32[1*o+0]=c,o}}v.prototype.bytesPerElement=4,be("StructArrayLayout1ul4",v);class s extends Qn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(o,c,d,m,b,w,I,P,R){const F=this.length;return this.resize(F+1),this.emplace(F,o,c,d,m,b,w,I,P,R)}emplace(o,c,d,m,b,w,I,P,R,F){const j=10*o,Z=5*o;return this.int16[j+0]=c,this.int16[j+1]=d,this.int16[j+2]=m,this.int16[j+3]=b,this.int16[j+4]=w,this.int16[j+5]=I,this.uint32[Z+3]=P,this.uint16[j+8]=R,this.uint16[j+9]=F,o}}s.prototype.bytesPerElement=20,be("StructArrayLayout6i1ul2ui20",s);class p extends Qn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(o,c,d,m,b,w){const I=this.length;return this.resize(I+1),this.emplace(I,o,c,d,m,b,w)}emplace(o,c,d,m,b,w,I){const P=6*o;return this.int16[P+0]=c,this.int16[P+1]=d,this.int16[P+2]=m,this.int16[P+3]=b,this.int16[P+4]=w,this.int16[P+5]=I,o}}p.prototype.bytesPerElement=12,be("StructArrayLayout2i2i2i12",p);class f extends Qn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(o,c,d,m,b){const w=this.length;return this.resize(w+1),this.emplace(w,o,c,d,m,b)}emplace(o,c,d,m,b,w){const I=4*o,P=8*o;return this.float32[I+0]=c,this.float32[I+1]=d,this.float32[I+2]=m,this.int16[P+6]=b,this.int16[P+7]=w,o}}f.prototype.bytesPerElement=16,be("StructArrayLayout2f1f2i16",f);class y extends Qn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(o,c,d,m){const b=this.length;return this.resize(b+1),this.emplace(b,o,c,d,m)}emplace(o,c,d,m,b){const w=12*o,I=3*o;return this.uint8[w+0]=c,this.uint8[w+1]=d,this.float32[I+1]=m,this.float32[I+2]=b,o}}y.prototype.bytesPerElement=12,be("StructArrayLayout2ub2f12",y);class x extends Qn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(o,c,d){const m=this.length;return this.resize(m+1),this.emplace(m,o,c,d)}emplace(o,c,d,m){const b=3*o;return this.uint16[b+0]=c,this.uint16[b+1]=d,this.uint16[b+2]=m,o}}x.prototype.bytesPerElement=6,be("StructArrayLayout3ui6",x);class C extends Qn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(o,c,d,m,b,w,I,P,R,F,j,Z,K,Q,at,gt,_t){const At=this.length;return this.resize(At+1),this.emplace(At,o,c,d,m,b,w,I,P,R,F,j,Z,K,Q,at,gt,_t)}emplace(o,c,d,m,b,w,I,P,R,F,j,Z,K,Q,at,gt,_t,At){const Tt=24*o,Rt=12*o,jt=48*o;return this.int16[Tt+0]=c,this.int16[Tt+1]=d,this.uint16[Tt+2]=m,this.uint16[Tt+3]=b,this.uint32[Rt+2]=w,this.uint32[Rt+3]=I,this.uint32[Rt+4]=P,this.uint16[Tt+10]=R,this.uint16[Tt+11]=F,this.uint16[Tt+12]=j,this.float32[Rt+7]=Z,this.float32[Rt+8]=K,this.uint8[jt+36]=Q,this.uint8[jt+37]=at,this.uint8[jt+38]=gt,this.uint32[Rt+10]=_t,this.int16[Tt+22]=At,o}}C.prototype.bytesPerElement=48,be("StructArrayLayout2i2ui3ul3ui2f3ub1ul1i48",C);class M extends Qn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(o,c,d,m,b,w,I,P,R,F,j,Z,K,Q,at,gt,_t,At,Tt,Rt,jt,Kt,Te,Oe,Se,xe,he,Ae){const de=this.length;return this.resize(de+1),this.emplace(de,o,c,d,m,b,w,I,P,R,F,j,Z,K,Q,at,gt,_t,At,Tt,Rt,jt,Kt,Te,Oe,Se,xe,he,Ae)}emplace(o,c,d,m,b,w,I,P,R,F,j,Z,K,Q,at,gt,_t,At,Tt,Rt,jt,Kt,Te,Oe,Se,xe,he,Ae,de){const ie=32*o,qe=16*o;return this.int16[ie+0]=c,this.int16[ie+1]=d,this.int16[ie+2]=m,this.int16[ie+3]=b,this.int16[ie+4]=w,this.int16[ie+5]=I,this.int16[ie+6]=P,this.int16[ie+7]=R,this.uint16[ie+8]=F,this.uint16[ie+9]=j,this.uint16[ie+10]=Z,this.uint16[ie+11]=K,this.uint16[ie+12]=Q,this.uint16[ie+13]=at,this.uint16[ie+14]=gt,this.uint16[ie+15]=_t,this.uint16[ie+16]=At,this.uint16[ie+17]=Tt,this.uint16[ie+18]=Rt,this.uint16[ie+19]=jt,this.uint16[ie+20]=Kt,this.uint16[ie+21]=Te,this.uint16[ie+22]=Oe,this.uint32[qe+12]=Se,this.float32[qe+13]=xe,this.float32[qe+14]=he,this.uint16[ie+30]=Ae,this.uint16[ie+31]=de,o}}M.prototype.bytesPerElement=64,be("StructArrayLayout8i15ui1ul2f2ui64",M);class L extends Qn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(o){const c=this.length;return this.resize(c+1),this.emplace(c,o)}emplace(o,c){return this.float32[1*o+0]=c,o}}L.prototype.bytesPerElement=4,be("StructArrayLayout1f4",L);class N extends Qn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(o,c,d){const m=this.length;return this.resize(m+1),this.emplace(m,o,c,d)}emplace(o,c,d,m){const b=3*o;return this.uint16[6*o+0]=c,this.float32[b+1]=d,this.float32[b+2]=m,o}}N.prototype.bytesPerElement=12,be("StructArrayLayout1ui2f12",N);class z extends Qn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(o,c,d){const m=this.length;return this.resize(m+1),this.emplace(m,o,c,d)}emplace(o,c,d,m){const b=4*o;return this.uint32[2*o+0]=c,this.uint16[b+2]=d,this.uint16[b+3]=m,o}}z.prototype.bytesPerElement=8,be("StructArrayLayout1ul2ui8",z);class B extends Qn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(o,c){const d=this.length;return this.resize(d+1),this.emplace(d,o,c)}emplace(o,c,d){const m=2*o;return this.uint16[m+0]=c,this.uint16[m+1]=d,o}}B.prototype.bytesPerElement=4,be("StructArrayLayout2ui4",B);class H extends Qn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(o){const c=this.length;return this.resize(c+1),this.emplace(c,o)}emplace(o,c){return this.uint16[1*o+0]=c,o}}H.prototype.bytesPerElement=2,be("StructArrayLayout1ui2",H);class lt extends Qn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(o,c,d,m){const b=this.length;return this.resize(b+1),this.emplace(b,o,c,d,m)}emplace(o,c,d,m,b){const w=4*o;return this.float32[w+0]=c,this.float32[w+1]=d,this.float32[w+2]=m,this.float32[w+3]=b,o}}lt.prototype.bytesPerElement=16,be("StructArrayLayout4f16",lt);class ut extends dc{get anchorPointX(){return this._structArray.int16[this._pos2+0]}get anchorPointY(){return this._structArray.int16[this._pos2+1]}get x1(){return this._structArray.int16[this._pos2+2]}get y1(){return this._structArray.int16[this._pos2+3]}get x2(){return this._structArray.int16[this._pos2+4]}get y2(){return this._structArray.int16[this._pos2+5]}get featureIndex(){return this._structArray.uint32[this._pos4+3]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+8]}get bucketIndex(){return this._structArray.uint16[this._pos2+9]}get anchorPoint(){return new A(this.anchorPointX,this.anchorPointY)}}ut.prototype.size=20;class ht extends s{get(o){return new ut(this,o)}}be("CollisionBoxArray",ht);class st extends dc{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+2]}get numGlyphs(){return this._structArray.uint16[this._pos2+3]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+2]}get lineStartIndex(){return this._structArray.uint32[this._pos4+3]}get lineLength(){return this._structArray.uint32[this._pos4+4]}get segment(){return this._structArray.uint16[this._pos2+10]}get lowerSize(){return this._structArray.uint16[this._pos2+11]}get upperSize(){return this._structArray.uint16[this._pos2+12]}get lineOffsetX(){return this._structArray.float32[this._pos4+7]}get lineOffsetY(){return this._structArray.float32[this._pos4+8]}get writingMode(){return this._structArray.uint8[this._pos1+36]}get placedOrientation(){return this._structArray.uint8[this._pos1+37]}set placedOrientation(o){this._structArray.uint8[this._pos1+37]=o}get hidden(){return this._structArray.uint8[this._pos1+38]}set hidden(o){this._structArray.uint8[this._pos1+38]=o}get crossTileID(){return this._structArray.uint32[this._pos4+10]}set crossTileID(o){this._structArray.uint32[this._pos4+10]=o}get associatedIconIndex(){return this._structArray.int16[this._pos2+22]}}st.prototype.size=48;class Mt extends C{get(o){return new st(this,o)}}be("PlacedSymbolArray",Mt);class Ft extends dc{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+2]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+3]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+4]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+5]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+6]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+7]}get key(){return this._structArray.uint16[this._pos2+8]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+9]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+10]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+11]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+12]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+13]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+14]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+15]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+16]}get featureIndex(){return this._structArray.uint16[this._pos2+17]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+18]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+19]}get numIconVertices(){return this._structArray.uint16[this._pos2+20]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+21]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+22]}get crossTileID(){return this._structArray.uint32[this._pos4+12]}set crossTileID(o){this._structArray.uint32[this._pos4+12]=o}get textBoxScale(){return this._structArray.float32[this._pos4+13]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+14]}get textAnchorOffsetStartIndex(){return this._structArray.uint16[this._pos2+30]}get textAnchorOffsetEndIndex(){return this._structArray.uint16[this._pos2+31]}}Ft.prototype.size=64;class yt extends M{get(o){return new Ft(this,o)}}be("SymbolInstanceArray",yt);class Pt extends L{getoffsetX(o){return this.float32[1*o+0]}}be("GlyphOffsetArray",Pt);class Vt extends bp{getx(o){return this.int16[3*o+0]}gety(o){return this.int16[3*o+1]}gettileUnitDistanceFromAnchor(o){return this.int16[3*o+2]}}be("SymbolLineVertexArray",Vt);class qt extends dc{get textAnchor(){return this._structArray.uint16[this._pos2+0]}get textOffset0(){return this._structArray.float32[this._pos4+1]}get textOffset1(){return this._structArray.float32[this._pos4+2]}}qt.prototype.size=12;class Yt extends N{get(o){return new qt(this,o)}}be("TextAnchorOffsetArray",Yt);class ne extends dc{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}}ne.prototype.size=8;class Qt extends z{get(o){return new ne(this,o)}}be("FeatureIndexArray",Qt);class le extends xp{}class ke extends xp{}class Mr extends xp{}class ve extends kf{}class Je extends Of{}class Fe extends Th{}class mn extends Ff{}class Ir extends zf{}class mr extends on{}class Pr extends v{}class hi extends p{}class Mn extends y{}class yo extends x{}class Bi extends B{}const Si=Wn([{name:"a_pos",components:2,type:"Int16"}],4),{members:zs}=Si;class Fn{constructor(o=[]){this.segments=o}prepareSegment(o,c,d,m){let b=this.segments[this.segments.length-1];return o>Fn.MAX_VERTEX_ARRAY_LENGTH&&Ot(`Max vertices per segment is ${Fn.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${o}`),(!b||b.vertexLength+o>Fn.MAX_VERTEX_ARRAY_LENGTH||b.sortKey!==m)&&(b={vertexOffset:c.length,primitiveOffset:d.length,vertexLength:0,primitiveLength:0},m!==void 0&&(b.sortKey=m),this.segments.push(b)),b}get(){return this.segments}destroy(){for(const o of this.segments)for(const c in o.vaos)o.vaos[c].destroy()}static simpleSegment(o,c,d,m){return new Fn([{vertexOffset:o,primitiveOffset:c,vertexLength:d,primitiveLength:m,vaos:{},sortKey:0}])}}function ul(u,o){return 256*(u=vt(Math.floor(u),0,255))+vt(Math.floor(o),0,255)}Fn.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,be("SegmentVector",Fn);const cl=Wn([{name:"a_pattern_from",components:4,type:"Uint16"},{name:"a_pattern_to",components:4,type:"Uint16"},{name:"a_pixel_ratio_from",components:1,type:"Uint16"},{name:"a_pixel_ratio_to",components:1,type:"Uint16"}]);var Au={exports:{}},mc={exports:{}};mc.exports=function(u,o){var c,d,m,b,w,I,P,R;for(d=u.length-(c=3&u.length),m=o,w=3432918353,I=461845907,R=0;R<d;)P=255&u.charCodeAt(R)|(255&u.charCodeAt(++R))<<8|(255&u.charCodeAt(++R))<<16|(255&u.charCodeAt(++R))<<24,++R,m=27492+(65535&(b=5*(65535&(m=(m^=P=(65535&(P=(P=(65535&P)*w+(((P>>>16)*w&65535)<<16)&4294967295)<<15|P>>>17))*I+(((P>>>16)*I&65535)<<16)&4294967295)<<13|m>>>19))+((5*(m>>>16)&65535)<<16)&4294967295))+((58964+(b>>>16)&65535)<<16);switch(P=0,c){case 3:P^=(255&u.charCodeAt(R+2))<<16;case 2:P^=(255&u.charCodeAt(R+1))<<8;case 1:m^=P=(65535&(P=(P=(65535&(P^=255&u.charCodeAt(R)))*w+(((P>>>16)*w&65535)<<16)&4294967295)<<15|P>>>17))*I+(((P>>>16)*I&65535)<<16)&4294967295}return m^=u.length,m=2246822507*(65535&(m^=m>>>16))+((2246822507*(m>>>16)&65535)<<16)&4294967295,m=3266489909*(65535&(m^=m>>>13))+((3266489909*(m>>>16)&65535)<<16)&4294967295,(m^=m>>>16)>>>0};var Ih=mc.exports,No={exports:{}};No.exports=function(u,o){for(var c,d=u.length,m=o^d,b=0;d>=4;)c=1540483477*(65535&(c=255&u.charCodeAt(b)|(255&u.charCodeAt(++b))<<8|(255&u.charCodeAt(++b))<<16|(255&u.charCodeAt(++b))<<24))+((1540483477*(c>>>16)&65535)<<16),m=1540483477*(65535&m)+((1540483477*(m>>>16)&65535)<<16)^(c=1540483477*(65535&(c^=c>>>24))+((1540483477*(c>>>16)&65535)<<16)),d-=4,++b;switch(d){case 3:m^=(255&u.charCodeAt(b+2))<<16;case 2:m^=(255&u.charCodeAt(b+1))<<8;case 1:m=1540483477*(65535&(m^=255&u.charCodeAt(b)))+((1540483477*(m>>>16)&65535)<<16)}return m=1540483477*(65535&(m^=m>>>13))+((1540483477*(m>>>16)&65535)<<16),(m^=m>>>15)>>>0};var _o=Ih,Jo=No.exports;Au.exports=_o,Au.exports.murmur3=_o,Au.exports.murmur2=Jo;var gc=_(Au.exports);class pi{constructor(){this.ids=[],this.positions=[],this.indexed=!1}add(o,c,d,m){this.ids.push($i(o)),this.positions.push(c,d,m)}getPositions(o){if(!this.indexed)throw new Error("Trying to get index, but feature positions are not indexed");const c=$i(o);let d=0,m=this.ids.length-1;for(;d<m;){const w=d+m>>1;this.ids[w]>=c?m=w:d=w+1}const b=[];for(;this.ids[d]===c;)b.push({index:this.positions[3*d],start:this.positions[3*d+1],end:this.positions[3*d+2]}),d++;return b}static serialize(o,c){const d=new Float64Array(o.ids),m=new Uint32Array(o.positions);return gs(d,m,0,d.length-1),c&&c.push(d.buffer,m.buffer),{ids:d,positions:m}}static deserialize(o){const c=new pi;return c.ids=o.ids,c.positions=o.positions,c.indexed=!0,c}}function $i(u){const o=+u;return!isNaN(o)&&o<=Number.MAX_SAFE_INTEGER?o:gc(String(u))}function gs(u,o,c,d){for(;c<d;){const m=u[c+d>>1];let b=c-1,w=d+1;for(;;){do b++;while(u[b]<m);do w--;while(u[w]>m);if(b>=w)break;di(u,b,w),di(o,3*b,3*w),di(o,3*b+1,3*w+1),di(o,3*b+2,3*w+2)}w-c<d-w?(gs(u,o,c,w),c=w+1):(gs(u,o,w+1,d),d=w)}}function di(u,o,c){const d=u[o];u[o]=u[c],u[c]=d}be("FeaturePositionMap",pi);class yc{constructor(o,c){this.gl=o.gl,this.location=c}}class hd extends yc{constructor(o,c){super(o,c),this.current=0}set(o){this.current!==o&&(this.current=o,this.gl.uniform1f(this.location,o))}}class Ng extends yc{constructor(o,c){super(o,c),this.current=[0,0,0,0]}set(o){o[0]===this.current[0]&&o[1]===this.current[1]&&o[2]===this.current[2]&&o[3]===this.current[3]||(this.current=o,this.gl.uniform4f(this.location,o[0],o[1],o[2],o[3]))}}class kg extends yc{constructor(o,c){super(o,c),this.current=Qr.transparent}set(o){o.r===this.current.r&&o.g===this.current.g&&o.b===this.current.b&&o.a===this.current.a||(this.current=o,this.gl.uniform4f(this.location,o.r,o.g,o.b,o.a))}}const s0=new Float32Array(16);function Bf(u){return[ul(255*u.r,255*u.g),ul(255*u.b,255*u.a)]}class hl{constructor(o,c,d){this.value=o,this.uniformNames=c.map(m=>`u_${m}`),this.type=d}setUniform(o,c,d){o.set(d.constantOr(this.value))}getBinding(o,c,d){return this.type==="color"?new kg(o,c):new hd(o,c)}}class _c{constructor(o,c){this.uniformNames=c.map(d=>`u_${d}`),this.patternFrom=null,this.patternTo=null,this.pixelRatioFrom=1,this.pixelRatioTo=1}setConstantPatternPositions(o,c){this.pixelRatioFrom=c.pixelRatio,this.pixelRatioTo=o.pixelRatio,this.patternFrom=c.tlbr,this.patternTo=o.tlbr}setUniform(o,c,d,m){const b=m==="u_pattern_to"?this.patternTo:m==="u_pattern_from"?this.patternFrom:m==="u_pixel_ratio_to"?this.pixelRatioTo:m==="u_pixel_ratio_from"?this.pixelRatioFrom:null;b&&o.set(b)}getBinding(o,c,d){return d.substr(0,9)==="u_pattern"?new Ng(o,c):new hd(o,c)}}class pl{constructor(o,c,d,m){this.expression=o,this.type=d,this.maxValue=0,this.paintVertexAttributes=c.map(b=>({name:`a_${b}`,type:"Float32",components:d==="color"?2:1,offset:0})),this.paintVertexArray=new m}populatePaintArray(o,c,d,m,b){const w=this.paintVertexArray.length,I=this.expression.evaluate(new On(0),c,{},m,[],b);this.paintVertexArray.resize(o),this._setPaintValue(w,o,I)}updatePaintArray(o,c,d,m){const b=this.expression.evaluate({zoom:0},d,m);this._setPaintValue(o,c,b)}_setPaintValue(o,c,d){if(this.type==="color"){const m=Bf(d);for(let b=o;b<c;b++)this.paintVertexArray.emplace(b,m[0],m[1])}else{for(let m=o;m<c;m++)this.paintVertexArray.emplace(m,d);this.maxValue=Math.max(this.maxValue,Math.abs(d))}}upload(o){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=o.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class pa{constructor(o,c,d,m,b,w){this.expression=o,this.uniformNames=c.map(I=>`u_${I}_t`),this.type=d,this.useIntegerZoom=m,this.zoom=b,this.maxValue=0,this.paintVertexAttributes=c.map(I=>({name:`a_${I}`,type:"Float32",components:d==="color"?4:2,offset:0})),this.paintVertexArray=new w}populatePaintArray(o,c,d,m,b){const w=this.expression.evaluate(new On(this.zoom),c,{},m,[],b),I=this.expression.evaluate(new On(this.zoom+1),c,{},m,[],b),P=this.paintVertexArray.length;this.paintVertexArray.resize(o),this._setPaintValue(P,o,w,I)}updatePaintArray(o,c,d,m){const b=this.expression.evaluate({zoom:this.zoom},d,m),w=this.expression.evaluate({zoom:this.zoom+1},d,m);this._setPaintValue(o,c,b,w)}_setPaintValue(o,c,d,m){if(this.type==="color"){const b=Bf(d),w=Bf(m);for(let I=o;I<c;I++)this.paintVertexArray.emplace(I,b[0],b[1],w[0],w[1])}else{for(let b=o;b<c;b++)this.paintVertexArray.emplace(b,d,m);this.maxValue=Math.max(this.maxValue,Math.abs(d),Math.abs(m))}}upload(o){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=o.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(o,c){const d=this.useIntegerZoom?Math.floor(c.zoom):c.zoom,m=vt(this.expression.interpolationFactor(d,this.zoom,this.zoom+1),0,1);o.set(m)}getBinding(o,c,d){return new hd(o,c)}}class dl{constructor(o,c,d,m,b,w){this.expression=o,this.type=c,this.useIntegerZoom=d,this.zoom=m,this.layerId=w,this.zoomInPaintVertexArray=new b,this.zoomOutPaintVertexArray=new b}populatePaintArray(o,c,d){const m=this.zoomInPaintVertexArray.length;this.zoomInPaintVertexArray.resize(o),this.zoomOutPaintVertexArray.resize(o),this._setPaintValues(m,o,c.patterns&&c.patterns[this.layerId],d)}updatePaintArray(o,c,d,m,b){this._setPaintValues(o,c,d.patterns&&d.patterns[this.layerId],b)}_setPaintValues(o,c,d,m){if(!m||!d)return;const{min:b,mid:w,max:I}=d,P=m[b],R=m[w],F=m[I];if(P&&R&&F)for(let j=o;j<c;j++)this.zoomInPaintVertexArray.emplace(j,R.tl[0],R.tl[1],R.br[0],R.br[1],P.tl[0],P.tl[1],P.br[0],P.br[1],R.pixelRatio,P.pixelRatio),this.zoomOutPaintVertexArray.emplace(j,R.tl[0],R.tl[1],R.br[0],R.br[1],F.tl[0],F.tl[1],F.br[0],F.br[1],R.pixelRatio,F.pixelRatio)}upload(o){this.zoomInPaintVertexArray&&this.zoomInPaintVertexArray.arrayBuffer&&this.zoomOutPaintVertexArray&&this.zoomOutPaintVertexArray.arrayBuffer&&(this.zoomInPaintVertexBuffer=o.createVertexBuffer(this.zoomInPaintVertexArray,cl.members,this.expression.isStateDependent),this.zoomOutPaintVertexBuffer=o.createVertexBuffer(this.zoomOutPaintVertexArray,cl.members,this.expression.isStateDependent))}destroy(){this.zoomOutPaintVertexBuffer&&this.zoomOutPaintVertexBuffer.destroy(),this.zoomInPaintVertexBuffer&&this.zoomInPaintVertexBuffer.destroy()}}class $f{constructor(o,c,d){this.binders={},this._buffers=[];const m=[];for(const b in o.paint._values){if(!d(b))continue;const w=o.paint.get(b);if(!(w instanceof Ko&&rl(w.property.specification)))continue;const I=MC(b,o.type),P=w.value,R=w.property.specification.type,F=w.property.useIntegerZoom,j=w.property.specification["property-type"],Z=j==="cross-faded"||j==="cross-faded-data-driven";if(P.kind==="constant")this.binders[b]=Z?new _c(P.value,I):new hl(P.value,I,R),m.push(`/u_${b}`);else if(P.kind==="source"||Z){const K=M1(b,R,"source");this.binders[b]=Z?new dl(P,R,F,c,K,o.id):new pl(P,I,R,K),m.push(`/a_${b}`)}else{const K=M1(b,R,"composite");this.binders[b]=new pa(P,I,R,F,c,K),m.push(`/z_${b}`)}}this.cacheKey=m.sort().join("")}getMaxValue(o){const c=this.binders[o];return c instanceof pl||c instanceof pa?c.maxValue:0}populatePaintArrays(o,c,d,m,b){for(const w in this.binders){const I=this.binders[w];(I instanceof pl||I instanceof pa||I instanceof dl)&&I.populatePaintArray(o,c,d,m,b)}}setConstantPatternPositions(o,c){for(const d in this.binders){const m=this.binders[d];m instanceof _c&&m.setConstantPatternPositions(o,c)}}updatePaintArrays(o,c,d,m,b){let w=!1;for(const I in o){const P=c.getPositions(I);for(const R of P){const F=d.feature(R.index);for(const j in this.binders){const Z=this.binders[j];if((Z instanceof pl||Z instanceof pa||Z instanceof dl)&&Z.expression.isStateDependent===!0){const K=m.paint.get(j);Z.expression=K.value,Z.updatePaintArray(R.start,R.end,F,o[I],b),w=!0}}}}return w}defines(){const o=[];for(const c in this.binders){const d=this.binders[c];(d instanceof hl||d instanceof _c)&&o.push(...d.uniformNames.map(m=>`#define HAS_UNIFORM_${m}`))}return o}getBinderAttributes(){const o=[];for(const c in this.binders){const d=this.binders[c];if(d instanceof pl||d instanceof pa)for(let m=0;m<d.paintVertexAttributes.length;m++)o.push(d.paintVertexAttributes[m].name);else if(d instanceof dl)for(let m=0;m<cl.members.length;m++)o.push(cl.members[m].name)}return o}getBinderUniforms(){const o=[];for(const c in this.binders){const d=this.binders[c];if(d instanceof hl||d instanceof _c||d instanceof pa)for(const m of d.uniformNames)o.push(m)}return o}getPaintVertexBuffers(){return this._buffers}getUniforms(o,c){const d=[];for(const m in this.binders){const b=this.binders[m];if(b instanceof hl||b instanceof _c||b instanceof pa){for(const w of b.uniformNames)if(c[w]){const I=b.getBinding(o,c[w],w);d.push({name:w,property:m,binding:I})}}}return d}setUniforms(o,c,d,m){for(const{name:b,property:w,binding:I}of c)this.binders[w].setUniform(I,m,d.get(w),b)}updatePaintBuffers(o){this._buffers=[];for(const c in this.binders){const d=this.binders[c];if(o&&d instanceof dl){const m=o.fromScale===2?d.zoomInPaintVertexBuffer:d.zoomOutPaintVertexBuffer;m&&this._buffers.push(m)}else(d instanceof pl||d instanceof pa)&&d.paintVertexBuffer&&this._buffers.push(d.paintVertexBuffer)}}upload(o){for(const c in this.binders){const d=this.binders[c];(d instanceof pl||d instanceof pa||d instanceof dl)&&d.upload(o)}this.updatePaintBuffers()}destroy(){for(const o in this.binders){const c=this.binders[o];(c instanceof pl||c instanceof pa||c instanceof dl)&&c.destroy()}}}class Zl{constructor(o,c,d=()=>!0){this.programConfigurations={};for(const m of o)this.programConfigurations[m.id]=new $f(m,c,d);this.needsUpload=!1,this._featureMap=new pi,this._bufferOffset=0}populatePaintArrays(o,c,d,m,b,w){for(const I in this.programConfigurations)this.programConfigurations[I].populatePaintArrays(o,c,m,b,w);c.id!==void 0&&this._featureMap.add(c.id,d,this._bufferOffset,o),this._bufferOffset=o,this.needsUpload=!0}updatePaintArrays(o,c,d,m){for(const b of d)this.needsUpload=this.programConfigurations[b.id].updatePaintArrays(o,this._featureMap,c,b,m)||this.needsUpload}get(o){return this.programConfigurations[o]}upload(o){if(this.needsUpload){for(const c in this.programConfigurations)this.programConfigurations[c].upload(o);this.needsUpload=!1}}destroy(){for(const o in this.programConfigurations)this.programConfigurations[o].destroy()}}function MC(u,o){return{"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-extrusion-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"]}[u]||[u.replace(`${o}-`,"").replace(/-/g,"_")]}function M1(u,o,c){const d={color:{source:Th,composite:lt},number:{source:L,composite:Th}},m=function(b){return{"line-pattern":{source:mn,composite:mn},"fill-pattern":{source:mn,composite:mn},"fill-extrusion-pattern":{source:mn,composite:mn}}[b]}(u);return m&&m[c]||d[o][c]}be("ConstantBinder",hl),be("CrossFadedConstantBinder",_c),be("SourceExpressionBinder",pl),be("CrossFadedCompositeBinder",dl),be("CompositeExpressionBinder",pa),be("ProgramConfiguration",$f,{omit:["_buffers"]}),be("ProgramConfigurationSet",Zl);const Oi=8192,a0=Math.pow(2,14)-1,P1=-a0-1;function wp(u){const o=Oi/u.extent,c=u.loadGeometry();for(let d=0;d<c.length;d++){const m=c[d];for(let b=0;b<m.length;b++){const w=m[b],I=Math.round(w.x*o),P=Math.round(w.y*o);w.x=vt(I,P1,a0),w.y=vt(P,P1,a0),(I<w.x||I>w.x+1||P<w.y||P>w.y+1)&&Ot("Geometry exceeds allowed extent, reduce your vector tile buffer size")}}return c}function Ep(u,o){return{type:u.type,id:u.id,properties:u.properties,geometry:o?wp(u):[]}}function Og(u,o,c,d,m){u.emplaceBack(2*o+(d+1)/2,2*c+(m+1)/2)}class l0{constructor(o){this.zoom=o.zoom,this.overscaling=o.overscaling,this.layers=o.layers,this.layerIds=this.layers.map(c=>c.id),this.index=o.index,this.hasPattern=!1,this.layoutVertexArray=new ke,this.indexArray=new yo,this.segments=new Fn,this.programConfigurations=new Zl(o.layers,o.zoom),this.stateDependentLayerIds=this.layers.filter(c=>c.isStateDependent()).map(c=>c.id)}populate(o,c,d){const m=this.layers[0],b=[];let w=null,I=!1;m.type==="circle"&&(w=m.layout.get("circle-sort-key"),I=!w.isConstant());for(const{feature:P,id:R,index:F,sourceLayerIndex:j}of o){const Z=this.layers[0]._featureFilter.needGeometry,K=Ep(P,Z);if(!this.layers[0]._featureFilter.filter(new On(this.zoom),K,d))continue;const Q=I?w.evaluate(K,{},d):void 0,at={id:R,properties:P.properties,type:P.type,sourceLayerIndex:j,index:F,geometry:Z?K.geometry:wp(P),patterns:{},sortKey:Q};b.push(at)}I&&b.sort((P,R)=>P.sortKey-R.sortKey);for(const P of b){const{geometry:R,index:F,sourceLayerIndex:j}=P,Z=o[F].feature;this.addFeature(P,R,F,d),c.featureIndex.insert(Z,R,F,j,this.index)}}update(o,c,d){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(o,c,this.stateDependentLayers,d)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(o){this.uploaded||(this.layoutVertexBuffer=o.createVertexBuffer(this.layoutVertexArray,zs),this.indexBuffer=o.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(o),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(o,c,d,m){for(const b of c)for(const w of b){const I=w.x,P=w.y;if(I<0||I>=Oi||P<0||P>=Oi)continue;const R=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,o.sortKey),F=R.vertexLength;Og(this.layoutVertexArray,I,P,-1,-1),Og(this.layoutVertexArray,I,P,1,-1),Og(this.layoutVertexArray,I,P,1,1),Og(this.layoutVertexArray,I,P,-1,1),this.indexArray.emplaceBack(F,F+1,F+2),this.indexArray.emplaceBack(F,F+3,F+2),R.vertexLength+=4,R.primitiveLength+=2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,o,d,{},m)}}function A1(u,o){for(let c=0;c<u.length;c++)if(pd(o,u[c]))return!0;for(let c=0;c<o.length;c++)if(pd(u,o[c]))return!0;return!!u0(u,o)}function PC(u,o,c){return!!pd(u,o)||!!c0(o,u,c)}function L1(u,o){if(u.length===1)return D1(o,u[0]);for(let c=0;c<o.length;c++){const d=o[c];for(let m=0;m<d.length;m++)if(pd(u,d[m]))return!0}for(let c=0;c<u.length;c++)if(D1(o,u[c]))return!0;for(let c=0;c<o.length;c++)if(u0(u,o[c]))return!0;return!1}function AC(u,o,c){if(u.length>1){if(u0(u,o))return!0;for(let d=0;d<o.length;d++)if(c0(o[d],u,c))return!0}for(let d=0;d<u.length;d++)if(c0(u[d],o,c))return!0;return!1}function u0(u,o){if(u.length===0||o.length===0)return!1;for(let c=0;c<u.length-1;c++){const d=u[c],m=u[c+1];for(let b=0;b<o.length-1;b++)if(LC(d,m,o[b],o[b+1]))return!0}return!1}function LC(u,o,c,d){return te(u,c,d)!==te(o,c,d)&&te(u,o,c)!==te(u,o,d)}function c0(u,o,c){const d=c*c;if(o.length===1)return u.distSqr(o[0])<d;for(let m=1;m<o.length;m++)if(R1(u,o[m-1],o[m])<d)return!0;return!1}function R1(u,o,c){const d=o.distSqr(c);if(d===0)return u.distSqr(o);const m=((u.x-o.x)*(c.x-o.x)+(u.y-o.y)*(c.y-o.y))/d;return u.distSqr(m<0?o:m>1?c:c.sub(o)._mult(m)._add(o))}function D1(u,o){let c,d,m,b=!1;for(let w=0;w<u.length;w++){c=u[w];for(let I=0,P=c.length-1;I<c.length;P=I++)d=c[I],m=c[P],d.y>o.y!=m.y>o.y&&o.x<(m.x-d.x)*(o.y-d.y)/(m.y-d.y)+d.x&&(b=!b)}return b}function pd(u,o){let c=!1;for(let d=0,m=u.length-1;d<u.length;m=d++){const b=u[d],w=u[m];b.y>o.y!=w.y>o.y&&o.x<(w.x-b.x)*(o.y-b.y)/(w.y-b.y)+b.x&&(c=!c)}return c}function RC(u,o,c){const d=c[0],m=c[2];if(u.x<d.x&&o.x<d.x||u.x>m.x&&o.x>m.x||u.y<d.y&&o.y<d.y||u.y>m.y&&o.y>m.y)return!1;const b=te(u,o,c[0]);return b!==te(u,o,c[1])||b!==te(u,o,c[2])||b!==te(u,o,c[3])}function Uf(u,o,c){const d=o.paint.get(u).value;return d.kind==="constant"?d.value:c.programConfigurations.get(o.id).getMaxValue(u)}function Fg(u){return Math.sqrt(u[0]*u[0]+u[1]*u[1])}function zg(u,o,c,d,m){if(!o[0]&&!o[1])return u;const b=A.convert(o)._mult(m);c==="viewport"&&b._rotate(-d);const w=[];for(let I=0;I<u.length;I++)w.push(u[I].sub(b));return w}let N1,k1;be("CircleBucket",l0,{omit:["layers"]});var DC={get paint(){return k1=k1||new Ei({"circle-radius":new Ke(Gt.paint_circle["circle-radius"]),"circle-color":new Ke(Gt.paint_circle["circle-color"]),"circle-blur":new Ke(Gt.paint_circle["circle-blur"]),"circle-opacity":new Ke(Gt.paint_circle["circle-opacity"]),"circle-translate":new je(Gt.paint_circle["circle-translate"]),"circle-translate-anchor":new je(Gt.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new je(Gt.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new je(Gt.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new Ke(Gt.paint_circle["circle-stroke-width"]),"circle-stroke-color":new Ke(Gt.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new Ke(Gt.paint_circle["circle-stroke-opacity"])})},get layout(){return N1=N1||new Ei({"circle-sort-key":new Ke(Gt.layout_circle["circle-sort-key"])})}},ys=1e-6,dd=typeof Float32Array<"u"?Float32Array:Array;function h0(u){return u[0]=1,u[1]=0,u[2]=0,u[3]=0,u[4]=0,u[5]=1,u[6]=0,u[7]=0,u[8]=0,u[9]=0,u[10]=1,u[11]=0,u[12]=0,u[13]=0,u[14]=0,u[15]=1,u}function O1(u,o,c){var d=o[0],m=o[1],b=o[2],w=o[3],I=o[4],P=o[5],R=o[6],F=o[7],j=o[8],Z=o[9],K=o[10],Q=o[11],at=o[12],gt=o[13],_t=o[14],At=o[15],Tt=c[0],Rt=c[1],jt=c[2],Kt=c[3];return u[0]=Tt*d+Rt*I+jt*j+Kt*at,u[1]=Tt*m+Rt*P+jt*Z+Kt*gt,u[2]=Tt*b+Rt*R+jt*K+Kt*_t,u[3]=Tt*w+Rt*F+jt*Q+Kt*At,u[4]=(Tt=c[4])*d+(Rt=c[5])*I+(jt=c[6])*j+(Kt=c[7])*at,u[5]=Tt*m+Rt*P+jt*Z+Kt*gt,u[6]=Tt*b+Rt*R+jt*K+Kt*_t,u[7]=Tt*w+Rt*F+jt*Q+Kt*At,u[8]=(Tt=c[8])*d+(Rt=c[9])*I+(jt=c[10])*j+(Kt=c[11])*at,u[9]=Tt*m+Rt*P+jt*Z+Kt*gt,u[10]=Tt*b+Rt*R+jt*K+Kt*_t,u[11]=Tt*w+Rt*F+jt*Q+Kt*At,u[12]=(Tt=c[12])*d+(Rt=c[13])*I+(jt=c[14])*j+(Kt=c[15])*at,u[13]=Tt*m+Rt*P+jt*Z+Kt*gt,u[14]=Tt*b+Rt*R+jt*K+Kt*_t,u[15]=Tt*w+Rt*F+jt*Q+Kt*At,u}Math.hypot||(Math.hypot=function(){for(var u=0,o=arguments.length;o--;)u+=arguments[o]*arguments[o];return Math.sqrt(u)});var jf,NC=O1;function Bg(u,o,c){var d=o[0],m=o[1],b=o[2],w=o[3];return u[0]=c[0]*d+c[4]*m+c[8]*b+c[12]*w,u[1]=c[1]*d+c[5]*m+c[9]*b+c[13]*w,u[2]=c[2]*d+c[6]*m+c[10]*b+c[14]*w,u[3]=c[3]*d+c[7]*m+c[11]*b+c[15]*w,u}jf=new dd(4),dd!=Float32Array&&(jf[0]=0,jf[1]=0,jf[2]=0,jf[3]=0);class kC extends ha{constructor(o){super(o,DC)}createBucket(o){return new l0(o)}queryRadius(o){const c=o;return Uf("circle-radius",this,c)+Uf("circle-stroke-width",this,c)+Fg(this.paint.get("circle-translate"))}queryIntersectsFeature(o,c,d,m,b,w,I,P){const R=zg(o,this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),w.angle,I),F=this.paint.get("circle-radius").evaluate(c,d)+this.paint.get("circle-stroke-width").evaluate(c,d),j=this.paint.get("circle-pitch-alignment")==="map",Z=j?R:function(Q,at){return Q.map(gt=>F1(gt,at))}(R,P),K=j?F*I:F;for(const Q of m)for(const at of Q){const gt=j?at:F1(at,P);let _t=K;const At=Bg([],[at.x,at.y,0,1],P);if(this.paint.get("circle-pitch-scale")==="viewport"&&this.paint.get("circle-pitch-alignment")==="map"?_t*=At[3]/w.cameraToCenterDistance:this.paint.get("circle-pitch-scale")==="map"&&this.paint.get("circle-pitch-alignment")==="viewport"&&(_t*=w.cameraToCenterDistance/At[3]),PC(Z,gt,_t))return!0}return!1}}function F1(u,o){const c=Bg([],[u.x,u.y,0,1],o);return new A(c[0]/c[3],c[1]/c[3])}class z1 extends l0{}let B1;be("HeatmapBucket",z1,{omit:["layers"]});var OC={get paint(){return B1=B1||new Ei({"heatmap-radius":new Ke(Gt.paint_heatmap["heatmap-radius"]),"heatmap-weight":new Ke(Gt.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new je(Gt.paint_heatmap["heatmap-intensity"]),"heatmap-color":new Df(Gt.paint_heatmap["heatmap-color"]),"heatmap-opacity":new je(Gt.paint_heatmap["heatmap-opacity"])})}};function p0(u,{width:o,height:c},d,m){if(m){if(m instanceof Uint8ClampedArray)m=new Uint8Array(m.buffer);else if(m.length!==o*c*d)throw new RangeError(`mismatched image size. expected: ${m.length} but got: ${o*c*d}`)}else m=new Uint8Array(o*c*d);return u.width=o,u.height=c,u.data=m,u}function $1(u,{width:o,height:c},d){if(o===u.width&&c===u.height)return;const m=p0({},{width:o,height:c},d);d0(u,m,{x:0,y:0},{x:0,y:0},{width:Math.min(u.width,o),height:Math.min(u.height,c)},d),u.width=o,u.height=c,u.data=m.data}function d0(u,o,c,d,m,b){if(m.width===0||m.height===0)return o;if(m.width>u.width||m.height>u.height||c.x>u.width-m.width||c.y>u.height-m.height)throw new RangeError("out of range source coordinates for image copy");if(m.width>o.width||m.height>o.height||d.x>o.width-m.width||d.y>o.height-m.height)throw new RangeError("out of range destination coordinates for image copy");const w=u.data,I=o.data;if(w===I)throw new Error("srcData equals dstData, so image is already copied");for(let P=0;P<m.height;P++){const R=((c.y+P)*u.width+c.x)*b,F=((d.y+P)*o.width+d.x)*b;for(let j=0;j<m.width*b;j++)I[F+j]=w[R+j]}return o}class Vf{constructor(o,c){p0(this,o,1,c)}resize(o){$1(this,o,1)}clone(){return new Vf({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(o,c,d,m,b){d0(o,c,d,m,b,1)}}class Na{constructor(o,c){p0(this,o,4,c)}resize(o){$1(this,o,4)}replace(o,c){c?this.data.set(o):this.data=o instanceof Uint8ClampedArray?new Uint8Array(o.buffer):o}clone(){return new Na({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(o,c,d,m,b){d0(o,c,d,m,b,4)}}function U1(u){const o={},c=u.resolution||256,d=u.clips?u.clips.length:1,m=u.image||new Na({width:c,height:d});if(Math.log(c)/Math.LN2%1!=0)throw new Error(`width is not a power of 2 - ${c}`);const b=(w,I,P)=>{o[u.evaluationKey]=P;const R=u.expression.evaluate(o);m.data[w+I+0]=Math.floor(255*R.r/R.a),m.data[w+I+1]=Math.floor(255*R.g/R.a),m.data[w+I+2]=Math.floor(255*R.b/R.a),m.data[w+I+3]=Math.floor(255*R.a)};if(u.clips)for(let w=0,I=0;w<d;++w,I+=4*c)for(let P=0,R=0;P<c;P++,R+=4){const F=P/(c-1),{start:j,end:Z}=u.clips[w];b(I,R,j*(1-F)+Z*F)}else for(let w=0,I=0;w<c;w++,I+=4)b(0,I,w/(c-1));return m}be("AlphaImage",Vf),be("RGBAImage",Na);class FC extends ha{createBucket(o){return new z1(o)}constructor(o){super(o,OC),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(o){o==="heatmap-color"&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=U1({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)}queryRadius(){return 0}queryIntersectsFeature(){return!1}hasOffscreenPass(){return this.paint.get("heatmap-opacity")!==0&&this.visibility!=="none"}}let j1;var zC={get paint(){return j1=j1||new Ei({"hillshade-illumination-direction":new je(Gt.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new je(Gt.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new je(Gt.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new je(Gt.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new je(Gt.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new je(Gt.paint_hillshade["hillshade-accent-color"])})}};class BC extends ha{constructor(o){super(o,zC)}hasOffscreenPass(){return this.paint.get("hillshade-exaggeration")!==0&&this.visibility!=="none"}}const $C=Wn([{name:"a_pos",components:2,type:"Int16"}],4),{members:UC}=$C;var f0={exports:{}};function $g(u,o,c){c=c||2;var d,m,b,w,I,P,R,F=o&&o.length,j=F?o[0]*c:u.length,Z=V1(u,0,j,c,!0),K=[];if(!Z||Z.next===Z.prev)return K;if(F&&(Z=function(at,gt,_t,At){var Tt,Rt,jt,Kt=[];for(Tt=0,Rt=gt.length;Tt<Rt;Tt++)(jt=V1(at,gt[Tt]*At,Tt<Rt-1?gt[Tt+1]*At:at.length,At,!1))===jt.next&&(jt.steiner=!0),Kt.push(HC(jt));for(Kt.sort(ZC),Tt=0;Tt<Kt.length;Tt++)_t=WC(Kt[Tt],_t);return _t}(u,o,Z,c)),u.length>80*c){d=b=u[0],m=w=u[1];for(var Q=c;Q<j;Q+=c)(I=u[Q])<d&&(d=I),(P=u[Q+1])<m&&(m=P),I>b&&(b=I),P>w&&(w=P);R=(R=Math.max(b-d,w-m))!==0?32767/R:0}return Gf(Z,K,c,d,m,R,0),K}function V1(u,o,c,d,m){var b,w;if(m===y0(u,o,c,d)>0)for(b=o;b<c;b+=d)w=Z1(b,u[b],u[b+1],w);else for(b=c-d;b>=o;b-=d)w=Z1(b,u[b],u[b+1],w);return w&&Ug(w,w.next)&&(Zf(w),w=w.next),w}function Sp(u,o){if(!u)return u;o||(o=u);var c,d=u;do if(c=!1,d.steiner||!Ug(d,d.next)&&Ti(d.prev,d,d.next)!==0)d=d.next;else{if(Zf(d),(d=o=d.prev)===d.next)break;c=!0}while(c||d!==o);return o}function Gf(u,o,c,d,m,b,w){if(u){!w&&b&&function(F,j,Z,K){var Q=F;do Q.z===0&&(Q.z=m0(Q.x,Q.y,j,Z,K)),Q.prevZ=Q.prev,Q.nextZ=Q.next,Q=Q.next;while(Q!==F);Q.prevZ.nextZ=null,Q.prevZ=null,function(at){var gt,_t,At,Tt,Rt,jt,Kt,Te,Oe=1;do{for(_t=at,at=null,Rt=null,jt=0;_t;){for(jt++,At=_t,Kt=0,gt=0;gt<Oe&&(Kt++,At=At.nextZ);gt++);for(Te=Oe;Kt>0||Te>0&&At;)Kt!==0&&(Te===0||!At||_t.z<=At.z)?(Tt=_t,_t=_t.nextZ,Kt--):(Tt=At,At=At.nextZ,Te--),Rt?Rt.nextZ=Tt:at=Tt,Tt.prevZ=Rt,Rt=Tt;_t=At}Rt.nextZ=null,Oe*=2}while(jt>1)}(Q)}(u,d,m,b);for(var I,P,R=u;u.prev!==u.next;)if(I=u.prev,P=u.next,b?VC(u,d,m,b):jC(u))o.push(I.i/c|0),o.push(u.i/c|0),o.push(P.i/c|0),Zf(u),u=P.next,R=P.next;else if((u=P)===R){w?w===1?Gf(u=GC(Sp(u),o,c),o,c,d,m,b,2):w===2&&qC(u,o,c,d,m,b):Gf(Sp(u),o,c,d,m,b,1);break}}}function jC(u){var o=u.prev,c=u,d=u.next;if(Ti(o,c,d)>=0)return!1;for(var m=o.x,b=c.x,w=d.x,I=o.y,P=c.y,R=d.y,F=m<b?m<w?m:w:b<w?b:w,j=I<P?I<R?I:R:P<R?P:R,Z=m>b?m>w?m:w:b>w?b:w,K=I>P?I>R?I:R:P>R?P:R,Q=d.next;Q!==o;){if(Q.x>=F&&Q.x<=Z&&Q.y>=j&&Q.y<=K&&fd(m,I,b,P,w,R,Q.x,Q.y)&&Ti(Q.prev,Q,Q.next)>=0)return!1;Q=Q.next}return!0}function VC(u,o,c,d){var m=u.prev,b=u,w=u.next;if(Ti(m,b,w)>=0)return!1;for(var I=m.x,P=b.x,R=w.x,F=m.y,j=b.y,Z=w.y,K=I<P?I<R?I:R:P<R?P:R,Q=F<j?F<Z?F:Z:j<Z?j:Z,at=I>P?I>R?I:R:P>R?P:R,gt=F>j?F>Z?F:Z:j>Z?j:Z,_t=m0(K,Q,o,c,d),At=m0(at,gt,o,c,d),Tt=u.prevZ,Rt=u.nextZ;Tt&&Tt.z>=_t&&Rt&&Rt.z<=At;){if(Tt.x>=K&&Tt.x<=at&&Tt.y>=Q&&Tt.y<=gt&&Tt!==m&&Tt!==w&&fd(I,F,P,j,R,Z,Tt.x,Tt.y)&&Ti(Tt.prev,Tt,Tt.next)>=0||(Tt=Tt.prevZ,Rt.x>=K&&Rt.x<=at&&Rt.y>=Q&&Rt.y<=gt&&Rt!==m&&Rt!==w&&fd(I,F,P,j,R,Z,Rt.x,Rt.y)&&Ti(Rt.prev,Rt,Rt.next)>=0))return!1;Rt=Rt.nextZ}for(;Tt&&Tt.z>=_t;){if(Tt.x>=K&&Tt.x<=at&&Tt.y>=Q&&Tt.y<=gt&&Tt!==m&&Tt!==w&&fd(I,F,P,j,R,Z,Tt.x,Tt.y)&&Ti(Tt.prev,Tt,Tt.next)>=0)return!1;Tt=Tt.prevZ}for(;Rt&&Rt.z<=At;){if(Rt.x>=K&&Rt.x<=at&&Rt.y>=Q&&Rt.y<=gt&&Rt!==m&&Rt!==w&&fd(I,F,P,j,R,Z,Rt.x,Rt.y)&&Ti(Rt.prev,Rt,Rt.next)>=0)return!1;Rt=Rt.nextZ}return!0}function GC(u,o,c){var d=u;do{var m=d.prev,b=d.next.next;!Ug(m,b)&&G1(m,d,d.next,b)&&qf(m,b)&&qf(b,m)&&(o.push(m.i/c|0),o.push(d.i/c|0),o.push(b.i/c|0),Zf(d),Zf(d.next),d=u=b),d=d.next}while(d!==u);return Sp(d)}function qC(u,o,c,d,m,b){var w=u;do{for(var I=w.next.next;I!==w.prev;){if(w.i!==I.i&&YC(w,I)){var P=q1(w,I);return w=Sp(w,w.next),P=Sp(P,P.next),Gf(w,o,c,d,m,b,0),void Gf(P,o,c,d,m,b,0)}I=I.next}w=w.next}while(w!==u)}function ZC(u,o){return u.x-o.x}function WC(u,o){var c=function(m,b){var w,I=b,P=m.x,R=m.y,F=-1/0;do{if(R<=I.y&&R>=I.next.y&&I.next.y!==I.y){var j=I.x+(R-I.y)*(I.next.x-I.x)/(I.next.y-I.y);if(j<=P&&j>F&&(F=j,w=I.x<I.next.x?I:I.next,j===P))return w}I=I.next}while(I!==b);if(!w)return null;var Z,K=w,Q=w.x,at=w.y,gt=1/0;I=w;do P>=I.x&&I.x>=Q&&P!==I.x&&fd(R<at?P:F,R,Q,at,R<at?F:P,R,I.x,I.y)&&(Z=Math.abs(R-I.y)/(P-I.x),qf(I,m)&&(Z<gt||Z===gt&&(I.x>w.x||I.x===w.x&&XC(w,I)))&&(w=I,gt=Z)),I=I.next;while(I!==K);return w}(u,o);if(!c)return o;var d=q1(c,u);return Sp(d,d.next),Sp(c,c.next)}function XC(u,o){return Ti(u.prev,u,o.prev)<0&&Ti(o.next,u,u.next)<0}function m0(u,o,c,d,m){return(u=1431655765&((u=858993459&((u=252645135&((u=16711935&((u=(u-c)*m|0)|u<<8))|u<<4))|u<<2))|u<<1))|(o=1431655765&((o=858993459&((o=252645135&((o=16711935&((o=(o-d)*m|0)|o<<8))|o<<4))|o<<2))|o<<1))<<1}function HC(u){var o=u,c=u;do(o.x<c.x||o.x===c.x&&o.y<c.y)&&(c=o),o=o.next;while(o!==u);return c}function fd(u,o,c,d,m,b,w,I){return(m-w)*(o-I)>=(u-w)*(b-I)&&(u-w)*(d-I)>=(c-w)*(o-I)&&(c-w)*(b-I)>=(m-w)*(d-I)}function YC(u,o){return u.next.i!==o.i&&u.prev.i!==o.i&&!function(c,d){var m=c;do{if(m.i!==c.i&&m.next.i!==c.i&&m.i!==d.i&&m.next.i!==d.i&&G1(m,m.next,c,d))return!0;m=m.next}while(m!==c);return!1}(u,o)&&(qf(u,o)&&qf(o,u)&&function(c,d){var m=c,b=!1,w=(c.x+d.x)/2,I=(c.y+d.y)/2;do m.y>I!=m.next.y>I&&m.next.y!==m.y&&w<(m.next.x-m.x)*(I-m.y)/(m.next.y-m.y)+m.x&&(b=!b),m=m.next;while(m!==c);return b}(u,o)&&(Ti(u.prev,u,o.prev)||Ti(u,o.prev,o))||Ug(u,o)&&Ti(u.prev,u,u.next)>0&&Ti(o.prev,o,o.next)>0)}function Ti(u,o,c){return(o.y-u.y)*(c.x-o.x)-(o.x-u.x)*(c.y-o.y)}function Ug(u,o){return u.x===o.x&&u.y===o.y}function G1(u,o,c,d){var m=Vg(Ti(u,o,c)),b=Vg(Ti(u,o,d)),w=Vg(Ti(c,d,u)),I=Vg(Ti(c,d,o));return m!==b&&w!==I||!(m!==0||!jg(u,c,o))||!(b!==0||!jg(u,d,o))||!(w!==0||!jg(c,u,d))||!(I!==0||!jg(c,o,d))}function jg(u,o,c){return o.x<=Math.max(u.x,c.x)&&o.x>=Math.min(u.x,c.x)&&o.y<=Math.max(u.y,c.y)&&o.y>=Math.min(u.y,c.y)}function Vg(u){return u>0?1:u<0?-1:0}function qf(u,o){return Ti(u.prev,u,u.next)<0?Ti(u,o,u.next)>=0&&Ti(u,u.prev,o)>=0:Ti(u,o,u.prev)<0||Ti(u,u.next,o)<0}function q1(u,o){var c=new g0(u.i,u.x,u.y),d=new g0(o.i,o.x,o.y),m=u.next,b=o.prev;return u.next=o,o.prev=u,c.next=m,m.prev=c,d.next=c,c.prev=d,b.next=d,d.prev=b,d}function Z1(u,o,c,d){var m=new g0(u,o,c);return d?(m.next=d.next,m.prev=d,d.next.prev=m,d.next=m):(m.prev=m,m.next=m),m}function Zf(u){u.next.prev=u.prev,u.prev.next=u.next,u.prevZ&&(u.prevZ.nextZ=u.nextZ),u.nextZ&&(u.nextZ.prevZ=u.prevZ)}function g0(u,o,c){this.i=u,this.x=o,this.y=c,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}function y0(u,o,c,d){for(var m=0,b=o,w=c-d;b<c;b+=d)m+=(u[w]-u[b])*(u[b+1]+u[w+1]),w=b;return m}f0.exports=$g,f0.exports.default=$g,$g.deviation=function(u,o,c,d){var m=o&&o.length,b=Math.abs(y0(u,0,m?o[0]*c:u.length,c));if(m)for(var w=0,I=o.length;w<I;w++)b-=Math.abs(y0(u,o[w]*c,w<I-1?o[w+1]*c:u.length,c));var P=0;for(w=0;w<d.length;w+=3){var R=d[w]*c,F=d[w+1]*c,j=d[w+2]*c;P+=Math.abs((u[R]-u[j])*(u[F+1]-u[R+1])-(u[R]-u[F])*(u[j+1]-u[R+1]))}return b===0&&P===0?0:Math.abs((P-b)/b)},$g.flatten=function(u){for(var o=u[0][0].length,c={vertices:[],holes:[],dimensions:o},d=0,m=0;m<u.length;m++){for(var b=0;b<u[m].length;b++)for(var w=0;w<o;w++)c.vertices.push(u[m][b][w]);m>0&&c.holes.push(d+=u[m-1].length)}return c};var W1=_(f0.exports);function KC(u,o,c,d,m){X1(u,o,c||0,d||u.length-1,m||JC)}function X1(u,o,c,d,m){for(;d>c;){if(d-c>600){var b=d-c+1,w=o-c+1,I=Math.log(b),P=.5*Math.exp(2*I/3),R=.5*Math.sqrt(I*P*(b-P)/b)*(w-b/2<0?-1:1);X1(u,o,Math.max(c,Math.floor(o-w*P/b+R)),Math.min(d,Math.floor(o+(b-w)*P/b+R)),m)}var F=u[o],j=c,Z=d;for(Wf(u,c,o),m(u[d],F)>0&&Wf(u,c,d);j<Z;){for(Wf(u,j,Z),j++,Z--;m(u[j],F)<0;)j++;for(;m(u[Z],F)>0;)Z--}m(u[c],F)===0?Wf(u,c,Z):Wf(u,++Z,d),Z<=o&&(c=Z+1),o<=Z&&(d=Z-1)}}function Wf(u,o,c){var d=u[o];u[o]=u[c],u[c]=d}function JC(u,o){return u<o?-1:u>o?1:0}function _0(u,o){const c=u.length;if(c<=1)return[u];const d=[];let m,b;for(let w=0;w<c;w++){const I=ye(u[w]);I!==0&&(u[w].area=Math.abs(I),b===void 0&&(b=I<0),b===I<0?(m&&d.push(m),m=[u[w]]):m.push(u[w]))}if(m&&d.push(m),o>1)for(let w=0;w<d.length;w++)d[w].length<=o||(KC(d[w],o,1,d[w].length-1,QC),d[w]=d[w].slice(0,o));return d}function QC(u,o){return o.area-u.area}function v0(u,o,c){const d=c.patternDependencies;let m=!1;for(const b of o){const w=b.paint.get(`${u}-pattern`);w.isConstant()||(m=!0);const I=w.constantOr(null);I&&(m=!0,d[I.to]=!0,d[I.from]=!0)}return m}function x0(u,o,c,d,m){const b=m.patternDependencies;for(const w of o){const I=w.paint.get(`${u}-pattern`).value;if(I.kind!=="constant"){let P=I.evaluate({zoom:d-1},c,{},m.availableImages),R=I.evaluate({zoom:d},c,{},m.availableImages),F=I.evaluate({zoom:d+1},c,{},m.availableImages);P=P&&P.name?P.name:P,R=R&&R.name?R.name:R,F=F&&F.name?F.name:F,b[P]=!0,b[R]=!0,b[F]=!0,c.patterns[w.id]={min:P,mid:R,max:F}}}return c}class b0{constructor(o){this.zoom=o.zoom,this.overscaling=o.overscaling,this.layers=o.layers,this.layerIds=this.layers.map(c=>c.id),this.index=o.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new Mr,this.indexArray=new yo,this.indexArray2=new Bi,this.programConfigurations=new Zl(o.layers,o.zoom),this.segments=new Fn,this.segments2=new Fn,this.stateDependentLayerIds=this.layers.filter(c=>c.isStateDependent()).map(c=>c.id)}populate(o,c,d){this.hasPattern=v0("fill",this.layers,c);const m=this.layers[0].layout.get("fill-sort-key"),b=!m.isConstant(),w=[];for(const{feature:I,id:P,index:R,sourceLayerIndex:F}of o){const j=this.layers[0]._featureFilter.needGeometry,Z=Ep(I,j);if(!this.layers[0]._featureFilter.filter(new On(this.zoom),Z,d))continue;const K=b?m.evaluate(Z,{},d,c.availableImages):void 0,Q={id:P,properties:I.properties,type:I.type,sourceLayerIndex:F,index:R,geometry:j?Z.geometry:wp(I),patterns:{},sortKey:K};w.push(Q)}b&&w.sort((I,P)=>I.sortKey-P.sortKey);for(const I of w){const{geometry:P,index:R,sourceLayerIndex:F}=I;if(this.hasPattern){const j=x0("fill",this.layers,I,this.zoom,c);this.patternFeatures.push(j)}else this.addFeature(I,P,R,d,{});c.featureIndex.insert(o[R].feature,P,R,F,this.index)}}update(o,c,d){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(o,c,this.stateDependentLayers,d)}addFeatures(o,c,d){for(const m of this.patternFeatures)this.addFeature(m,m.geometry,m.index,c,d)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(o){this.uploaded||(this.layoutVertexBuffer=o.createVertexBuffer(this.layoutVertexArray,UC),this.indexBuffer=o.createIndexBuffer(this.indexArray),this.indexBuffer2=o.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(o),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())}addFeature(o,c,d,m,b){for(const w of _0(c,500)){let I=0;for(const K of w)I+=K.length;const P=this.segments.prepareSegment(I,this.layoutVertexArray,this.indexArray),R=P.vertexLength,F=[],j=[];for(const K of w){if(K.length===0)continue;K!==w[0]&&j.push(F.length/2);const Q=this.segments2.prepareSegment(K.length,this.layoutVertexArray,this.indexArray2),at=Q.vertexLength;this.layoutVertexArray.emplaceBack(K[0].x,K[0].y),this.indexArray2.emplaceBack(at+K.length-1,at),F.push(K[0].x),F.push(K[0].y);for(let gt=1;gt<K.length;gt++)this.layoutVertexArray.emplaceBack(K[gt].x,K[gt].y),this.indexArray2.emplaceBack(at+gt-1,at+gt),F.push(K[gt].x),F.push(K[gt].y);Q.vertexLength+=K.length,Q.primitiveLength+=K.length}const Z=W1(F,j);for(let K=0;K<Z.length;K+=3)this.indexArray.emplaceBack(R+Z[K],R+Z[K+1],R+Z[K+2]);P.vertexLength+=I,P.primitiveLength+=Z.length/3}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,o,d,b,m)}}let H1,Y1;be("FillBucket",b0,{omit:["layers","patternFeatures"]});var tM={get paint(){return Y1=Y1||new Ei({"fill-antialias":new je(Gt.paint_fill["fill-antialias"]),"fill-opacity":new Ke(Gt.paint_fill["fill-opacity"]),"fill-color":new Ke(Gt.paint_fill["fill-color"]),"fill-outline-color":new Ke(Gt.paint_fill["fill-outline-color"]),"fill-translate":new je(Gt.paint_fill["fill-translate"]),"fill-translate-anchor":new je(Gt.paint_fill["fill-translate-anchor"]),"fill-pattern":new vp(Gt.paint_fill["fill-pattern"])})},get layout(){return H1=H1||new Ei({"fill-sort-key":new Ke(Gt.layout_fill["fill-sort-key"])})}};class eM extends ha{constructor(o){super(o,tM)}recalculate(o,c){super.recalculate(o,c);const d=this.paint._values["fill-outline-color"];d.value.kind==="constant"&&d.value.value===void 0&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(o){return new b0(o)}queryRadius(){return Fg(this.paint.get("fill-translate"))}queryIntersectsFeature(o,c,d,m,b,w,I){return L1(zg(o,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),w.angle,I),m)}isTileClipped(){return!0}}const rM=Wn([{name:"a_pos",components:2,type:"Int16"},{name:"a_normal_ed",components:4,type:"Int16"}],4),nM=Wn([{name:"a_centroid",components:2,type:"Int16"}],4),{members:iM}=rM;var Ch={},oM=E,K1=md;function md(u,o,c,d,m){this.properties={},this.extent=c,this.type=0,this._pbf=u,this._geometry=-1,this._keys=d,this._values=m,u.readFields(sM,this,o)}function sM(u,o,c){u==1?o.id=c.readVarint():u==2?function(d,m){for(var b=d.readVarint()+d.pos;d.pos<b;){var w=m._keys[d.readVarint()],I=m._values[d.readVarint()];m.properties[w]=I}}(c,o):u==3?o.type=c.readVarint():u==4&&(o._geometry=c.pos)}function aM(u){for(var o,c,d=0,m=0,b=u.length,w=b-1;m<b;w=m++)d+=((c=u[w]).x-(o=u[m]).x)*(o.y+c.y);return d}md.types=["Unknown","Point","LineString","Polygon"],md.prototype.loadGeometry=function(){var u=this._pbf;u.pos=this._geometry;for(var o,c=u.readVarint()+u.pos,d=1,m=0,b=0,w=0,I=[];u.pos<c;){if(m<=0){var P=u.readVarint();d=7&P,m=P>>3}if(m--,d===1||d===2)b+=u.readSVarint(),w+=u.readSVarint(),d===1&&(o&&I.push(o),o=[]),o.push(new oM(b,w));else{if(d!==7)throw new Error("unknown command "+d);o&&o.push(o[0].clone())}}return o&&I.push(o),I},md.prototype.bbox=function(){var u=this._pbf;u.pos=this._geometry;for(var o=u.readVarint()+u.pos,c=1,d=0,m=0,b=0,w=1/0,I=-1/0,P=1/0,R=-1/0;u.pos<o;){if(d<=0){var F=u.readVarint();c=7&F,d=F>>3}if(d--,c===1||c===2)(m+=u.readSVarint())<w&&(w=m),m>I&&(I=m),(b+=u.readSVarint())<P&&(P=b),b>R&&(R=b);else if(c!==7)throw new Error("unknown command "+c)}return[w,P,I,R]},md.prototype.toGeoJSON=function(u,o,c){var d,m,b=this.extent*Math.pow(2,c),w=this.extent*u,I=this.extent*o,P=this.loadGeometry(),R=md.types[this.type];function F(K){for(var Q=0;Q<K.length;Q++){var at=K[Q];K[Q]=[360*(at.x+w)/b-180,360/Math.PI*Math.atan(Math.exp((180-360*(at.y+I)/b)*Math.PI/180))-90]}}switch(this.type){case 1:var j=[];for(d=0;d<P.length;d++)j[d]=P[d][0];F(P=j);break;case 2:for(d=0;d<P.length;d++)F(P[d]);break;case 3:for(P=function(K){var Q=K.length;if(Q<=1)return[K];for(var at,gt,_t=[],At=0;At<Q;At++){var Tt=aM(K[At]);Tt!==0&&(gt===void 0&&(gt=Tt<0),gt===Tt<0?(at&&_t.push(at),at=[K[At]]):at.push(K[At]))}return at&&_t.push(at),_t}(P),d=0;d<P.length;d++)for(m=0;m<P[d].length;m++)F(P[d][m])}P.length===1?P=P[0]:R="Multi"+R;var Z={type:"Feature",geometry:{type:R,coordinates:P},properties:this.properties};return"id"in this&&(Z.id=this.id),Z};var lM=K1,J1=Q1;function Q1(u,o){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=u,this._keys=[],this._values=[],this._features=[],u.readFields(uM,this,o),this.length=this._features.length}function uM(u,o,c){u===15?o.version=c.readVarint():u===1?o.name=c.readString():u===5?o.extent=c.readVarint():u===2?o._features.push(c.pos):u===3?o._keys.push(c.readString()):u===4&&o._values.push(function(d){for(var m=null,b=d.readVarint()+d.pos;d.pos<b;){var w=d.readVarint()>>3;m=w===1?d.readString():w===2?d.readFloat():w===3?d.readDouble():w===4?d.readVarint64():w===5?d.readVarint():w===6?d.readSVarint():w===7?d.readBoolean():null}return m}(c))}Q1.prototype.feature=function(u){if(u<0||u>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[u];var o=this._pbf.readVarint()+this._pbf.pos;return new lM(this._pbf,o,this.extent,this._keys,this._values)};var cM=J1;function hM(u,o,c){if(u===3){var d=new cM(c,c.readVarint()+c.pos);d.length&&(o[d.name]=d)}}Ch.VectorTile=function(u,o){this.layers=u.readFields(hM,{},o)},Ch.VectorTileFeature=K1,Ch.VectorTileLayer=J1;const pM=Ch.VectorTileFeature.types,w0=Math.pow(2,13);function Xf(u,o,c,d,m,b,w,I){u.emplaceBack(o,c,2*Math.floor(d*w0)+w,m*w0*2,b*w0*2,Math.round(I))}class E0{constructor(o){this.zoom=o.zoom,this.overscaling=o.overscaling,this.layers=o.layers,this.layerIds=this.layers.map(c=>c.id),this.index=o.index,this.hasPattern=!1,this.layoutVertexArray=new ve,this.centroidVertexArray=new le,this.indexArray=new yo,this.programConfigurations=new Zl(o.layers,o.zoom),this.segments=new Fn,this.stateDependentLayerIds=this.layers.filter(c=>c.isStateDependent()).map(c=>c.id)}populate(o,c,d){this.features=[],this.hasPattern=v0("fill-extrusion",this.layers,c);for(const{feature:m,id:b,index:w,sourceLayerIndex:I}of o){const P=this.layers[0]._featureFilter.needGeometry,R=Ep(m,P);if(!this.layers[0]._featureFilter.filter(new On(this.zoom),R,d))continue;const F={id:b,sourceLayerIndex:I,index:w,geometry:P?R.geometry:wp(m),properties:m.properties,type:m.type,patterns:{}};this.hasPattern?this.features.push(x0("fill-extrusion",this.layers,F,this.zoom,c)):this.addFeature(F,F.geometry,w,d,{}),c.featureIndex.insert(m,F.geometry,w,I,this.index,!0)}}addFeatures(o,c,d){for(const m of this.features){const{geometry:b}=m;this.addFeature(m,b,m.index,c,d)}}update(o,c,d){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(o,c,this.stateDependentLayers,d)}isEmpty(){return this.layoutVertexArray.length===0&&this.centroidVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(o){this.uploaded||(this.layoutVertexBuffer=o.createVertexBuffer(this.layoutVertexArray,iM),this.centroidVertexBuffer=o.createVertexBuffer(this.centroidVertexArray,nM.members,!0),this.indexBuffer=o.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(o),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.centroidVertexBuffer.destroy())}addFeature(o,c,d,m,b){const w={x:0,y:0,vertexCount:0};for(const I of _0(c,500)){let P=0;for(const Q of I)P+=Q.length;let R=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray);for(const Q of I){if(Q.length===0||fM(Q))continue;let at=0;for(let gt=0;gt<Q.length;gt++){const _t=Q[gt];if(gt>=1){const At=Q[gt-1];if(!dM(_t,At)){R.vertexLength+4>Fn.MAX_VERTEX_ARRAY_LENGTH&&(R=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray));const Tt=_t.sub(At)._perp()._unit(),Rt=At.dist(_t);at+Rt>32768&&(at=0),Xf(this.layoutVertexArray,_t.x,_t.y,Tt.x,Tt.y,0,0,at),Xf(this.layoutVertexArray,_t.x,_t.y,Tt.x,Tt.y,0,1,at),w.x+=2*_t.x,w.y+=2*_t.y,w.vertexCount+=2,at+=Rt,Xf(this.layoutVertexArray,At.x,At.y,Tt.x,Tt.y,0,0,at),Xf(this.layoutVertexArray,At.x,At.y,Tt.x,Tt.y,0,1,at),w.x+=2*At.x,w.y+=2*At.y,w.vertexCount+=2;const jt=R.vertexLength;this.indexArray.emplaceBack(jt,jt+2,jt+1),this.indexArray.emplaceBack(jt+1,jt+2,jt+3),R.vertexLength+=4,R.primitiveLength+=2}}}}if(R.vertexLength+P>Fn.MAX_VERTEX_ARRAY_LENGTH&&(R=this.segments.prepareSegment(P,this.layoutVertexArray,this.indexArray)),pM[o.type]!=="Polygon")continue;const F=[],j=[],Z=R.vertexLength;for(const Q of I)if(Q.length!==0){Q!==I[0]&&j.push(F.length/2);for(let at=0;at<Q.length;at++){const gt=Q[at];Xf(this.layoutVertexArray,gt.x,gt.y,0,0,1,1,0),w.x+=gt.x,w.y+=gt.y,w.vertexCount+=1,F.push(gt.x),F.push(gt.y)}}const K=W1(F,j);for(let Q=0;Q<K.length;Q+=3)this.indexArray.emplaceBack(Z+K[Q],Z+K[Q+2],Z+K[Q+1]);R.primitiveLength+=K.length/3,R.vertexLength+=P}for(let I=0;I<w.vertexCount;I++)this.centroidVertexArray.emplaceBack(Math.floor(w.x/w.vertexCount),Math.floor(w.y/w.vertexCount));this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,o,d,b,m)}}function dM(u,o){return u.x===o.x&&(u.x<0||u.x>Oi)||u.y===o.y&&(u.y<0||u.y>Oi)}function fM(u){return u.every(o=>o.x<0)||u.every(o=>o.x>Oi)||u.every(o=>o.y<0)||u.every(o=>o.y>Oi)}let tb;be("FillExtrusionBucket",E0,{omit:["layers","features"]});var mM={get paint(){return tb=tb||new Ei({"fill-extrusion-opacity":new je(Gt["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new Ke(Gt["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new je(Gt["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new je(Gt["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new vp(Gt["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new Ke(Gt["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new Ke(Gt["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new je(Gt["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"])})}};class gM extends ha{constructor(o){super(o,mM)}createBucket(o){return new E0(o)}queryRadius(){return Fg(this.paint.get("fill-extrusion-translate"))}is3D(){return!0}queryIntersectsFeature(o,c,d,m,b,w,I,P){const R=zg(o,this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),w.angle,I),F=this.paint.get("fill-extrusion-height").evaluate(c,d),j=this.paint.get("fill-extrusion-base").evaluate(c,d),Z=function(Q,at,gt,_t){const At=[];for(const Tt of Q){const Rt=[Tt.x,Tt.y,0,1];Bg(Rt,Rt,at),At.push(new A(Rt[0]/Rt[3],Rt[1]/Rt[3]))}return At}(R,P),K=function(Q,at,gt,_t){const At=[],Tt=[],Rt=_t[8]*at,jt=_t[9]*at,Kt=_t[10]*at,Te=_t[11]*at,Oe=_t[8]*gt,Se=_t[9]*gt,xe=_t[10]*gt,he=_t[11]*gt;for(const Ae of Q){const de=[],ie=[];for(const qe of Ae){const Be=qe.x,wr=qe.y,zn=_t[0]*Be+_t[4]*wr+_t[12],Vn=_t[1]*Be+_t[5]*wr+_t[13],ji=_t[2]*Be+_t[6]*wr+_t[14],da=_t[3]*Be+_t[7]*wr+_t[15],_s=ji+Kt,Fi=da+Te,vo=zn+Oe,Oo=Vn+Se,vs=ji+xe,xs=da+he,Vi=new A((zn+Rt)/Fi,(Vn+jt)/Fi);Vi.z=_s/Fi,de.push(Vi);const Gi=new A(vo/xs,Oo/xs);Gi.z=vs/xs,ie.push(Gi)}At.push(de),Tt.push(ie)}return[At,Tt]}(m,j,F,P);return function(Q,at,gt){let _t=1/0;L1(gt,at)&&(_t=eb(gt,at[0]));for(let At=0;At<at.length;At++){const Tt=at[At],Rt=Q[At];for(let jt=0;jt<Tt.length-1;jt++){const Kt=Tt[jt],Te=[Kt,Tt[jt+1],Rt[jt+1],Rt[jt],Kt];A1(gt,Te)&&(_t=Math.min(_t,eb(gt,Te)))}}return _t!==1/0&&_t}(K[0],K[1],Z)}}function Hf(u,o){return u.x*o.x+u.y*o.y}function eb(u,o){if(u.length===1){let c=0;const d=o[c++];let m;for(;!m||d.equals(m);)if(m=o[c++],!m)return 1/0;for(;c<o.length;c++){const b=o[c],w=u[0],I=m.sub(d),P=b.sub(d),R=w.sub(d),F=Hf(I,I),j=Hf(I,P),Z=Hf(P,P),K=Hf(R,I),Q=Hf(R,P),at=F*Z-j*j,gt=(Z*K-j*Q)/at,_t=(F*Q-j*K)/at,At=d.z*(1-gt-_t)+m.z*gt+b.z*_t;if(isFinite(At))return At}return 1/0}{let c=1/0;for(const d of o)c=Math.min(c,d.z);return c}}const yM=Wn([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"}],4),{members:_M}=yM,vM=Wn([{name:"a_uv_x",components:1,type:"Float32"},{name:"a_split_index",components:1,type:"Float32"}]),{members:xM}=vM,bM=Ch.VectorTileFeature.types,wM=Math.cos(Math.PI/180*37.5),rb=Math.pow(2,14)/.5;class S0{constructor(o){this.zoom=o.zoom,this.overscaling=o.overscaling,this.layers=o.layers,this.layerIds=this.layers.map(c=>c.id),this.index=o.index,this.hasPattern=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(c=>{this.gradients[c.id]={}}),this.layoutVertexArray=new Je,this.layoutVertexArray2=new Fe,this.indexArray=new yo,this.programConfigurations=new Zl(o.layers,o.zoom),this.segments=new Fn,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter(c=>c.isStateDependent()).map(c=>c.id)}populate(o,c,d){this.hasPattern=v0("line",this.layers,c);const m=this.layers[0].layout.get("line-sort-key"),b=!m.isConstant(),w=[];for(const{feature:I,id:P,index:R,sourceLayerIndex:F}of o){const j=this.layers[0]._featureFilter.needGeometry,Z=Ep(I,j);if(!this.layers[0]._featureFilter.filter(new On(this.zoom),Z,d))continue;const K=b?m.evaluate(Z,{},d):void 0,Q={id:P,properties:I.properties,type:I.type,sourceLayerIndex:F,index:R,geometry:j?Z.geometry:wp(I),patterns:{},sortKey:K};w.push(Q)}b&&w.sort((I,P)=>I.sortKey-P.sortKey);for(const I of w){const{geometry:P,index:R,sourceLayerIndex:F}=I;if(this.hasPattern){const j=x0("line",this.layers,I,this.zoom,c);this.patternFeatures.push(j)}else this.addFeature(I,P,R,d,{});c.featureIndex.insert(o[R].feature,P,R,F,this.index)}}update(o,c,d){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(o,c,this.stateDependentLayers,d)}addFeatures(o,c,d){for(const m of this.patternFeatures)this.addFeature(m,m.geometry,m.index,c,d)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(o){this.uploaded||(this.layoutVertexArray2.length!==0&&(this.layoutVertexBuffer2=o.createVertexBuffer(this.layoutVertexArray2,xM)),this.layoutVertexBuffer=o.createVertexBuffer(this.layoutVertexArray,_M),this.indexBuffer=o.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(o),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(o){if(o.properties&&Object.prototype.hasOwnProperty.call(o.properties,"mapbox_clip_start")&&Object.prototype.hasOwnProperty.call(o.properties,"mapbox_clip_end"))return{start:+o.properties.mapbox_clip_start,end:+o.properties.mapbox_clip_end}}addFeature(o,c,d,m,b){const w=this.layers[0].layout,I=w.get("line-join").evaluate(o,{}),P=w.get("line-cap"),R=w.get("line-miter-limit"),F=w.get("line-round-limit");this.lineClips=this.lineFeatureClips(o);for(const j of c)this.addLine(j,o,I,P,R,F);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,o,d,b,m)}addLine(o,c,d,m,b,w){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,this.lineClips){this.lineClipsArray.push(this.lineClips);for(let _t=0;_t<o.length-1;_t++)this.totalDistance+=o[_t].dist(o[_t+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}const I=bM[c.type]==="Polygon";let P=o.length;for(;P>=2&&o[P-1].equals(o[P-2]);)P--;let R=0;for(;R<P-1&&o[R].equals(o[R+1]);)R++;if(P<(I?3:2))return;d==="bevel"&&(b=1.05);const F=this.overscaling<=16?15*Oi/(512*this.overscaling):0,j=this.segments.prepareSegment(10*P,this.layoutVertexArray,this.indexArray);let Z,K,Q,at,gt;this.e1=this.e2=-1,I&&(Z=o[P-2],gt=o[R].sub(Z)._unit()._perp());for(let _t=R;_t<P;_t++){if(Q=_t===P-1?I?o[R+1]:void 0:o[_t+1],Q&&o[_t].equals(Q))continue;gt&&(at=gt),Z&&(K=Z),Z=o[_t],gt=Q?Q.sub(Z)._unit()._perp():at,at=at||gt;let At=at.add(gt);At.x===0&&At.y===0||At._unit();const Tt=at.x*gt.x+at.y*gt.y,Rt=At.x*gt.x+At.y*gt.y,jt=Rt!==0?1/Rt:1/0,Kt=2*Math.sqrt(2-2*Rt),Te=Rt<wM&&K&&Q,Oe=at.x*gt.y-at.y*gt.x>0;if(Te&&_t>R){const he=Z.dist(K);if(he>2*F){const Ae=Z.sub(Z.sub(K)._mult(F/he)._round());this.updateDistance(K,Ae),this.addCurrentVertex(Ae,at,0,0,j),K=Ae}}const Se=K&&Q;let xe=Se?d:I?"butt":m;if(Se&&xe==="round"&&(jt<w?xe="miter":jt<=2&&(xe="fakeround")),xe==="miter"&&jt>b&&(xe="bevel"),xe==="bevel"&&(jt>2&&(xe="flipbevel"),jt<b&&(xe="miter")),K&&this.updateDistance(K,Z),xe==="miter")At._mult(jt),this.addCurrentVertex(Z,At,0,0,j);else if(xe==="flipbevel"){if(jt>100)At=gt.mult(-1);else{const he=jt*at.add(gt).mag()/at.sub(gt).mag();At._perp()._mult(he*(Oe?-1:1))}this.addCurrentVertex(Z,At,0,0,j),this.addCurrentVertex(Z,At.mult(-1),0,0,j)}else if(xe==="bevel"||xe==="fakeround"){const he=-Math.sqrt(jt*jt-1),Ae=Oe?he:0,de=Oe?0:he;if(K&&this.addCurrentVertex(Z,at,Ae,de,j),xe==="fakeround"){const ie=Math.round(180*Kt/Math.PI/20);for(let qe=1;qe<ie;qe++){let Be=qe/ie;if(Be!==.5){const zn=Be-.5;Be+=Be*zn*(Be-1)*((1.0904+Tt*(Tt*(3.55645-1.43519*Tt)-3.2452))*zn*zn+(.848013+Tt*(.215638*Tt-1.06021)))}const wr=gt.sub(at)._mult(Be)._add(at)._unit()._mult(Oe?-1:1);this.addHalfVertex(Z,wr.x,wr.y,!1,Oe,0,j)}}Q&&this.addCurrentVertex(Z,gt,-Ae,-de,j)}else if(xe==="butt")this.addCurrentVertex(Z,At,0,0,j);else if(xe==="square"){const he=K?1:-1;this.addCurrentVertex(Z,At,he,he,j)}else xe==="round"&&(K&&(this.addCurrentVertex(Z,at,0,0,j),this.addCurrentVertex(Z,at,1,1,j,!0)),Q&&(this.addCurrentVertex(Z,gt,-1,-1,j,!0),this.addCurrentVertex(Z,gt,0,0,j)));if(Te&&_t<P-1){const he=Z.dist(Q);if(he>2*F){const Ae=Z.add(Q.sub(Z)._mult(F/he)._round());this.updateDistance(Z,Ae),this.addCurrentVertex(Ae,gt,0,0,j),Z=Ae}}}}addCurrentVertex(o,c,d,m,b,w=!1){const I=c.y*m-c.x,P=-c.y-c.x*m;this.addHalfVertex(o,c.x+c.y*d,c.y-c.x*d,w,!1,d,b),this.addHalfVertex(o,I,P,w,!0,-m,b),this.distance>rb/2&&this.totalDistance===0&&(this.distance=0,this.updateScaledDistance(),this.addCurrentVertex(o,c,d,m,b,w))}addHalfVertex({x:o,y:c},d,m,b,w,I,P){const R=.5*(this.lineClips?this.scaledDistance*(rb-1):this.scaledDistance);this.layoutVertexArray.emplaceBack((o<<1)+(b?1:0),(c<<1)+(w?1:0),Math.round(63*d)+128,Math.round(63*m)+128,1+(I===0?0:I<0?-1:1)|(63&R)<<2,R>>6),this.lineClips&&this.layoutVertexArray2.emplaceBack((this.scaledDistance-this.lineClips.start)/(this.lineClips.end-this.lineClips.start),this.lineClipsArray.length);const F=P.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,F),P.primitiveLength++),w?this.e2=F:this.e1=F}updateScaledDistance(){this.scaledDistance=this.lineClips?this.lineClips.start+(this.lineClips.end-this.lineClips.start)*this.distance/this.totalDistance:this.distance}updateDistance(o,c){this.distance+=o.dist(c),this.updateScaledDistance()}}let nb,ib;be("LineBucket",S0,{omit:["layers","patternFeatures"]});var ob={get paint(){return ib=ib||new Ei({"line-opacity":new Ke(Gt.paint_line["line-opacity"]),"line-color":new Ke(Gt.paint_line["line-color"]),"line-translate":new je(Gt.paint_line["line-translate"]),"line-translate-anchor":new je(Gt.paint_line["line-translate-anchor"]),"line-width":new Ke(Gt.paint_line["line-width"]),"line-gap-width":new Ke(Gt.paint_line["line-gap-width"]),"line-offset":new Ke(Gt.paint_line["line-offset"]),"line-blur":new Ke(Gt.paint_line["line-blur"]),"line-dasharray":new Rf(Gt.paint_line["line-dasharray"]),"line-pattern":new vp(Gt.paint_line["line-pattern"]),"line-gradient":new Df(Gt.paint_line["line-gradient"])})},get layout(){return nb=nb||new Ei({"line-cap":new je(Gt.layout_line["line-cap"]),"line-join":new Ke(Gt.layout_line["line-join"]),"line-miter-limit":new je(Gt.layout_line["line-miter-limit"]),"line-round-limit":new je(Gt.layout_line["line-round-limit"]),"line-sort-key":new Ke(Gt.layout_line["line-sort-key"])})}};class EM extends Ke{possiblyEvaluate(o,c){return c=new On(Math.floor(c.zoom),{now:c.now,fadeDuration:c.fadeDuration,zoomHistory:c.zoomHistory,transition:c.transition}),super.possiblyEvaluate(o,c)}evaluate(o,c,d,m){return c=et({},c,{zoom:Math.floor(c.zoom)}),super.evaluate(o,c,d,m)}}let Gg;class SM extends ha{constructor(o){super(o,ob),this.gradientVersion=0,Gg||(Gg=new EM(ob.paint.properties["line-width"].specification),Gg.useIntegerZoom=!0)}_handleSpecialPaintPropertyUpdate(o){if(o==="line-gradient"){const c=this.gradientExpression();this.stepInterpolant=!!function(d){return d._styleExpression!==void 0}(c)&&c._styleExpression.expression instanceof Pa,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}recalculate(o,c){super.recalculate(o,c),this.paint._values["line-floorwidth"]=Gg.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,o)}createBucket(o){return new S0(o)}queryRadius(o){const c=o,d=sb(Uf("line-width",this,c),Uf("line-gap-width",this,c)),m=Uf("line-offset",this,c);return d/2+Math.abs(m)+Fg(this.paint.get("line-translate"))}queryIntersectsFeature(o,c,d,m,b,w,I){const P=zg(o,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),w.angle,I),R=I/2*sb(this.paint.get("line-width").evaluate(c,d),this.paint.get("line-gap-width").evaluate(c,d)),F=this.paint.get("line-offset").evaluate(c,d);return F&&(m=function(j,Z){const K=[];for(let Q=0;Q<j.length;Q++){const at=j[Q],gt=[];for(let _t=0;_t<at.length;_t++){const At=at[_t-1],Tt=at[_t],Rt=at[_t+1],jt=_t===0?new A(0,0):Tt.sub(At)._unit()._perp(),Kt=_t===at.length-1?new A(0,0):Rt.sub(Tt)._unit()._perp(),Te=jt._add(Kt)._unit(),Oe=Te.x*Kt.x+Te.y*Kt.y;Oe!==0&&Te._mult(1/Oe),gt.push(Te._mult(Z)._add(Tt))}K.push(gt)}return K}(m,F*I)),function(j,Z,K){for(let Q=0;Q<Z.length;Q++){const at=Z[Q];if(j.length>=3){for(let gt=0;gt<at.length;gt++)if(pd(j,at[gt]))return!0}if(AC(j,at,K))return!0}return!1}(P,m,R)}isTileClipped(){return!0}}function sb(u,o){return o>0?o+2*u:u}const TM=Wn([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_data",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),IM=Wn([{name:"a_projected_pos",components:3,type:"Float32"}],4);Wn([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const CM=Wn([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"}]);Wn([{type:"Int16",name:"anchorPointX"},{type:"Int16",name:"anchorPointY"},{type:"Int16",name:"x1"},{type:"Int16",name:"y1"},{type:"Int16",name:"x2"},{type:"Int16",name:"y2"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const ab=Wn([{name:"a_pos",components:2,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),MM=Wn([{name:"a_pos",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);function PM(u,o,c){return u.sections.forEach(d=>{d.text=function(m,b,w){const I=b.layout.get("text-transform").evaluate(w,{});return I==="uppercase"?m=m.toLocaleUpperCase():I==="lowercase"&&(m=m.toLocaleLowerCase()),Fs.applyArabicShaping&&(m=Fs.applyArabicShaping(m)),m}(d.text,o,c)}),u}Wn([{name:"triangle",components:3,type:"Uint16"}]),Wn([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"}]),Wn([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",name:"textBoxScale"},{type:"Float32",name:"collisionCircleDiameter"},{type:"Uint16",name:"textAnchorOffsetStartIndex"},{type:"Uint16",name:"textAnchorOffsetEndIndex"}]),Wn([{type:"Float32",name:"offsetX"}]),Wn([{type:"Int16",name:"x"},{type:"Int16",name:"y"},{type:"Int16",name:"tileUnitDistanceFromAnchor"}]),Wn([{type:"Uint16",name:"textAnchor"},{type:"Float32",components:2,name:"textOffset"}]);const Yf={"!":"","#":"",$:"","%":"","&":"","(":"",")":"","*":"","+":"",",":"","-":"",".":"","/":"",":":"",";":"","<":"","=":"",">":"","?":"","@":"","[":"","\\":"","]":"","^":"",_:"","`":"","{":"","|":"","}":"","~":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":""};var Ui=24,lb=_n,ub=function(u,o,c,d,m){var b,w,I=8*m-d-1,P=(1<<I)-1,R=P>>1,F=-7,j=c?m-1:0,Z=c?-1:1,K=u[o+j];for(j+=Z,b=K&(1<<-F)-1,K>>=-F,F+=I;F>0;b=256*b+u[o+j],j+=Z,F-=8);for(w=b&(1<<-F)-1,b>>=-F,F+=d;F>0;w=256*w+u[o+j],j+=Z,F-=8);if(b===0)b=1-R;else{if(b===P)return w?NaN:1/0*(K?-1:1);w+=Math.pow(2,d),b-=R}return(K?-1:1)*w*Math.pow(2,b-d)},cb=function(u,o,c,d,m,b){var w,I,P,R=8*b-m-1,F=(1<<R)-1,j=F>>1,Z=m===23?Math.pow(2,-24)-Math.pow(2,-77):0,K=d?0:b-1,Q=d?1:-1,at=o<0||o===0&&1/o<0?1:0;for(o=Math.abs(o),isNaN(o)||o===1/0?(I=isNaN(o)?1:0,w=F):(w=Math.floor(Math.log(o)/Math.LN2),o*(P=Math.pow(2,-w))<1&&(w--,P*=2),(o+=w+j>=1?Z/P:Z*Math.pow(2,1-j))*P>=2&&(w++,P/=2),w+j>=F?(I=0,w=F):w+j>=1?(I=(o*P-1)*Math.pow(2,m),w+=j):(I=o*Math.pow(2,j-1)*Math.pow(2,m),w=0));m>=8;u[c+K]=255&I,K+=Q,I/=256,m-=8);for(w=w<<m|I,R+=m;R>0;u[c+K]=255&w,K+=Q,w/=256,R-=8);u[c+K-Q]|=128*at};function _n(u){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(u)?u:new Uint8Array(u||0),this.pos=0,this.type=0,this.length=this.buf.length}_n.Varint=0,_n.Fixed64=1,_n.Bytes=2,_n.Fixed32=5;var T0=4294967296,hb=1/T0,pb=typeof TextDecoder>"u"?null:new TextDecoder("utf8");function vc(u){return u.type===_n.Bytes?u.readVarint()+u.pos:u.pos+1}function AM(u,o,c){return c?4294967296*o+(u>>>0):4294967296*(o>>>0)+(u>>>0)}function db(u,o,c){var d=o<=16383?1:o<=2097151?2:o<=268435455?3:Math.floor(Math.log(o)/(7*Math.LN2));c.realloc(d);for(var m=c.pos-1;m>=u;m--)c.buf[m+d]=c.buf[m]}function LM(u,o){for(var c=0;c<u.length;c++)o.writeVarint(u[c])}function RM(u,o){for(var c=0;c<u.length;c++)o.writeSVarint(u[c])}function DM(u,o){for(var c=0;c<u.length;c++)o.writeFloat(u[c])}function NM(u,o){for(var c=0;c<u.length;c++)o.writeDouble(u[c])}function kM(u,o){for(var c=0;c<u.length;c++)o.writeBoolean(u[c])}function OM(u,o){for(var c=0;c<u.length;c++)o.writeFixed32(u[c])}function FM(u,o){for(var c=0;c<u.length;c++)o.writeSFixed32(u[c])}function zM(u,o){for(var c=0;c<u.length;c++)o.writeFixed64(u[c])}function BM(u,o){for(var c=0;c<u.length;c++)o.writeSFixed64(u[c])}function qg(u,o){return(u[o]|u[o+1]<<8|u[o+2]<<16)+16777216*u[o+3]}function gd(u,o,c){u[c]=o,u[c+1]=o>>>8,u[c+2]=o>>>16,u[c+3]=o>>>24}function fb(u,o){return(u[o]|u[o+1]<<8|u[o+2]<<16)+(u[o+3]<<24)}_n.prototype={destroy:function(){this.buf=null},readFields:function(u,o,c){for(c=c||this.length;this.pos<c;){var d=this.readVarint(),m=d>>3,b=this.pos;this.type=7&d,u(m,o,this),this.pos===b&&this.skip(d)}return o},readMessage:function(u,o){return this.readFields(u,o,this.readVarint()+this.pos)},readFixed32:function(){var u=qg(this.buf,this.pos);return this.pos+=4,u},readSFixed32:function(){var u=fb(this.buf,this.pos);return this.pos+=4,u},readFixed64:function(){var u=qg(this.buf,this.pos)+qg(this.buf,this.pos+4)*T0;return this.pos+=8,u},readSFixed64:function(){var u=qg(this.buf,this.pos)+fb(this.buf,this.pos+4)*T0;return this.pos+=8,u},readFloat:function(){var u=ub(this.buf,this.pos,!0,23,4);return this.pos+=4,u},readDouble:function(){var u=ub(this.buf,this.pos,!0,52,8);return this.pos+=8,u},readVarint:function(u){var o,c,d=this.buf;return o=127&(c=d[this.pos++]),c<128?o:(o|=(127&(c=d[this.pos++]))<<7,c<128?o:(o|=(127&(c=d[this.pos++]))<<14,c<128?o:(o|=(127&(c=d[this.pos++]))<<21,c<128?o:function(m,b,w){var I,P,R=w.buf;if(I=(112&(P=R[w.pos++]))>>4,P<128||(I|=(127&(P=R[w.pos++]))<<3,P<128)||(I|=(127&(P=R[w.pos++]))<<10,P<128)||(I|=(127&(P=R[w.pos++]))<<17,P<128)||(I|=(127&(P=R[w.pos++]))<<24,P<128)||(I|=(1&(P=R[w.pos++]))<<31,P<128))return AM(m,I,b);throw new Error("Expected varint not more than 10 bytes")}(o|=(15&(c=d[this.pos]))<<28,u,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var u=this.readVarint();return u%2==1?(u+1)/-2:u/2},readBoolean:function(){return!!this.readVarint()},readString:function(){var u=this.readVarint()+this.pos,o=this.pos;return this.pos=u,u-o>=12&&pb?function(c,d,m){return pb.decode(c.subarray(d,m))}(this.buf,o,u):function(c,d,m){for(var b="",w=d;w<m;){var I,P,R,F=c[w],j=null,Z=F>239?4:F>223?3:F>191?2:1;if(w+Z>m)break;Z===1?F<128&&(j=F):Z===2?(192&(I=c[w+1]))==128&&(j=(31&F)<<6|63&I)<=127&&(j=null):Z===3?(P=c[w+2],(192&(I=c[w+1]))==128&&(192&P)==128&&((j=(15&F)<<12|(63&I)<<6|63&P)<=2047||j>=55296&&j<=57343)&&(j=null)):Z===4&&(P=c[w+2],R=c[w+3],(192&(I=c[w+1]))==128&&(192&P)==128&&(192&R)==128&&((j=(15&F)<<18|(63&I)<<12|(63&P)<<6|63&R)<=65535||j>=1114112)&&(j=null)),j===null?(j=65533,Z=1):j>65535&&(j-=65536,b+=String.fromCharCode(j>>>10&1023|55296),j=56320|1023&j),b+=String.fromCharCode(j),w+=Z}return b}(this.buf,o,u)},readBytes:function(){var u=this.readVarint()+this.pos,o=this.buf.subarray(this.pos,u);return this.pos=u,o},readPackedVarint:function(u,o){if(this.type!==_n.Bytes)return u.push(this.readVarint(o));var c=vc(this);for(u=u||[];this.pos<c;)u.push(this.readVarint(o));return u},readPackedSVarint:function(u){if(this.type!==_n.Bytes)return u.push(this.readSVarint());var o=vc(this);for(u=u||[];this.pos<o;)u.push(this.readSVarint());return u},readPackedBoolean:function(u){if(this.type!==_n.Bytes)return u.push(this.readBoolean());var o=vc(this);for(u=u||[];this.pos<o;)u.push(this.readBoolean());return u},readPackedFloat:function(u){if(this.type!==_n.Bytes)return u.push(this.readFloat());var o=vc(this);for(u=u||[];this.pos<o;)u.push(this.readFloat());return u},readPackedDouble:function(u){if(this.type!==_n.Bytes)return u.push(this.readDouble());var o=vc(this);for(u=u||[];this.pos<o;)u.push(this.readDouble());return u},readPackedFixed32:function(u){if(this.type!==_n.Bytes)return u.push(this.readFixed32());var o=vc(this);for(u=u||[];this.pos<o;)u.push(this.readFixed32());return u},readPackedSFixed32:function(u){if(this.type!==_n.Bytes)return u.push(this.readSFixed32());var o=vc(this);for(u=u||[];this.pos<o;)u.push(this.readSFixed32());return u},readPackedFixed64:function(u){if(this.type!==_n.Bytes)return u.push(this.readFixed64());var o=vc(this);for(u=u||[];this.pos<o;)u.push(this.readFixed64());return u},readPackedSFixed64:function(u){if(this.type!==_n.Bytes)return u.push(this.readSFixed64());var o=vc(this);for(u=u||[];this.pos<o;)u.push(this.readSFixed64());return u},skip:function(u){var o=7&u;if(o===_n.Varint)for(;this.buf[this.pos++]>127;);else if(o===_n.Bytes)this.pos=this.readVarint()+this.pos;else if(o===_n.Fixed32)this.pos+=4;else{if(o!==_n.Fixed64)throw new Error("Unimplemented type: "+o);this.pos+=8}},writeTag:function(u,o){this.writeVarint(u<<3|o)},realloc:function(u){for(var o=this.length||16;o<this.pos+u;)o*=2;if(o!==this.length){var c=new Uint8Array(o);c.set(this.buf),this.buf=c,this.length=o}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(u){this.realloc(4),gd(this.buf,u,this.pos),this.pos+=4},writeSFixed32:function(u){this.realloc(4),gd(this.buf,u,this.pos),this.pos+=4},writeFixed64:function(u){this.realloc(8),gd(this.buf,-1&u,this.pos),gd(this.buf,Math.floor(u*hb),this.pos+4),this.pos+=8},writeSFixed64:function(u){this.realloc(8),gd(this.buf,-1&u,this.pos),gd(this.buf,Math.floor(u*hb),this.pos+4),this.pos+=8},writeVarint:function(u){(u=+u||0)>268435455||u<0?function(o,c){var d,m;if(o>=0?(d=o%4294967296|0,m=o/4294967296|0):(m=~(-o/4294967296),4294967295^(d=~(-o%4294967296))?d=d+1|0:(d=0,m=m+1|0)),o>=18446744073709552e3||o<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");c.realloc(10),function(b,w,I){I.buf[I.pos++]=127&b|128,b>>>=7,I.buf[I.pos++]=127&b|128,b>>>=7,I.buf[I.pos++]=127&b|128,b>>>=7,I.buf[I.pos++]=127&b|128,I.buf[I.pos]=127&(b>>>=7)}(d,0,c),function(b,w){var I=(7&b)<<4;w.buf[w.pos++]|=I|((b>>>=3)?128:0),b&&(w.buf[w.pos++]=127&b|((b>>>=7)?128:0),b&&(w.buf[w.pos++]=127&b|((b>>>=7)?128:0),b&&(w.buf[w.pos++]=127&b|((b>>>=7)?128:0),b&&(w.buf[w.pos++]=127&b|((b>>>=7)?128:0),b&&(w.buf[w.pos++]=127&b)))))}(m,c)}(u,this):(this.realloc(4),this.buf[this.pos++]=127&u|(u>127?128:0),u<=127||(this.buf[this.pos++]=127&(u>>>=7)|(u>127?128:0),u<=127||(this.buf[this.pos++]=127&(u>>>=7)|(u>127?128:0),u<=127||(this.buf[this.pos++]=u>>>7&127))))},writeSVarint:function(u){this.writeVarint(u<0?2*-u-1:2*u)},writeBoolean:function(u){this.writeVarint(!!u)},writeString:function(u){u=String(u),this.realloc(4*u.length),this.pos++;var o=this.pos;this.pos=function(d,m,b){for(var w,I,P=0;P<m.length;P++){if((w=m.charCodeAt(P))>55295&&w<57344){if(!I){w>56319||P+1===m.length?(d[b++]=239,d[b++]=191,d[b++]=189):I=w;continue}if(w<56320){d[b++]=239,d[b++]=191,d[b++]=189,I=w;continue}w=I-55296<<10|w-56320|65536,I=null}else I&&(d[b++]=239,d[b++]=191,d[b++]=189,I=null);w<128?d[b++]=w:(w<2048?d[b++]=w>>6|192:(w<65536?d[b++]=w>>12|224:(d[b++]=w>>18|240,d[b++]=w>>12&63|128),d[b++]=w>>6&63|128),d[b++]=63&w|128)}return b}(this.buf,u,this.pos);var c=this.pos-o;c>=128&&db(o,c,this),this.pos=o-1,this.writeVarint(c),this.pos+=c},writeFloat:function(u){this.realloc(4),cb(this.buf,u,this.pos,!0,23,4),this.pos+=4},writeDouble:function(u){this.realloc(8),cb(this.buf,u,this.pos,!0,52,8),this.pos+=8},writeBytes:function(u){var o=u.length;this.writeVarint(o),this.realloc(o);for(var c=0;c<o;c++)this.buf[this.pos++]=u[c]},writeRawMessage:function(u,o){this.pos++;var c=this.pos;u(o,this);var d=this.pos-c;d>=128&&db(c,d,this),this.pos=c-1,this.writeVarint(d),this.pos+=d},writeMessage:function(u,o,c){this.writeTag(u,_n.Bytes),this.writeRawMessage(o,c)},writePackedVarint:function(u,o){o.length&&this.writeMessage(u,LM,o)},writePackedSVarint:function(u,o){o.length&&this.writeMessage(u,RM,o)},writePackedBoolean:function(u,o){o.length&&this.writeMessage(u,kM,o)},writePackedFloat:function(u,o){o.length&&this.writeMessage(u,DM,o)},writePackedDouble:function(u,o){o.length&&this.writeMessage(u,NM,o)},writePackedFixed32:function(u,o){o.length&&this.writeMessage(u,OM,o)},writePackedSFixed32:function(u,o){o.length&&this.writeMessage(u,FM,o)},writePackedFixed64:function(u,o){o.length&&this.writeMessage(u,zM,o)},writePackedSFixed64:function(u,o){o.length&&this.writeMessage(u,BM,o)},writeBytesField:function(u,o){this.writeTag(u,_n.Bytes),this.writeBytes(o)},writeFixed32Field:function(u,o){this.writeTag(u,_n.Fixed32),this.writeFixed32(o)},writeSFixed32Field:function(u,o){this.writeTag(u,_n.Fixed32),this.writeSFixed32(o)},writeFixed64Field:function(u,o){this.writeTag(u,_n.Fixed64),this.writeFixed64(o)},writeSFixed64Field:function(u,o){this.writeTag(u,_n.Fixed64),this.writeSFixed64(o)},writeVarintField:function(u,o){this.writeTag(u,_n.Varint),this.writeVarint(o)},writeSVarintField:function(u,o){this.writeTag(u,_n.Varint),this.writeSVarint(o)},writeStringField:function(u,o){this.writeTag(u,_n.Bytes),this.writeString(o)},writeFloatField:function(u,o){this.writeTag(u,_n.Fixed32),this.writeFloat(o)},writeDoubleField:function(u,o){this.writeTag(u,_n.Fixed64),this.writeDouble(o)},writeBooleanField:function(u,o){this.writeVarintField(u,!!o)}};var I0=_(lb);const C0=3;function $M(u,o,c){u===1&&c.readMessage(UM,o)}function UM(u,o,c){if(u===3){const{id:d,bitmap:m,width:b,height:w,left:I,top:P,advance:R}=c.readMessage(jM,{});o.push({id:d,bitmap:new Vf({width:b+2*C0,height:w+2*C0},m),metrics:{width:b,height:w,left:I,top:P,advance:R}})}}function jM(u,o,c){u===1?o.id=c.readVarint():u===2?o.bitmap=c.readBytes():u===3?o.width=c.readVarint():u===4?o.height=c.readVarint():u===5?o.left=c.readSVarint():u===6?o.top=c.readSVarint():u===7&&(o.advance=c.readVarint())}const mb=C0;function gb(u){let o=0,c=0;for(const w of u)o+=w.w*w.h,c=Math.max(c,w.w);u.sort((w,I)=>I.h-w.h);const d=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(o/.95)),c),h:1/0}];let m=0,b=0;for(const w of u)for(let I=d.length-1;I>=0;I--){const P=d[I];if(!(w.w>P.w||w.h>P.h)){if(w.x=P.x,w.y=P.y,b=Math.max(b,w.y+w.h),m=Math.max(m,w.x+w.w),w.w===P.w&&w.h===P.h){const R=d.pop();I<d.length&&(d[I]=R)}else w.h===P.h?(P.x+=w.w,P.w-=w.w):w.w===P.w?(P.y+=w.h,P.h-=w.h):(d.push({x:P.x+w.w,y:P.y,w:P.w-w.w,h:w.h}),P.y+=w.h,P.h-=w.h);break}}return{w:m,h:b,fill:o/(m*b)||0}}const Bs=1;class M0{constructor(o,{pixelRatio:c,version:d,stretchX:m,stretchY:b,content:w}){this.paddedRect=o,this.pixelRatio=c,this.stretchX=m,this.stretchY=b,this.content=w,this.version=d}get tl(){return[this.paddedRect.x+Bs,this.paddedRect.y+Bs]}get br(){return[this.paddedRect.x+this.paddedRect.w-Bs,this.paddedRect.y+this.paddedRect.h-Bs]}get tlbr(){return this.tl.concat(this.br)}get displaySize(){return[(this.paddedRect.w-2*Bs)/this.pixelRatio,(this.paddedRect.h-2*Bs)/this.pixelRatio]}}class yb{constructor(o,c){const d={},m={};this.haveRenderCallbacks=[];const b=[];this.addImages(o,d,b),this.addImages(c,m,b);const{w,h:I}=gb(b),P=new Na({width:w||1,height:I||1});for(const R in o){const F=o[R],j=d[R].paddedRect;Na.copy(F.data,P,{x:0,y:0},{x:j.x+Bs,y:j.y+Bs},F.data)}for(const R in c){const F=c[R],j=m[R].paddedRect,Z=j.x+Bs,K=j.y+Bs,Q=F.data.width,at=F.data.height;Na.copy(F.data,P,{x:0,y:0},{x:Z,y:K},F.data),Na.copy(F.data,P,{x:0,y:at-1},{x:Z,y:K-1},{width:Q,height:1}),Na.copy(F.data,P,{x:0,y:0},{x:Z,y:K+at},{width:Q,height:1}),Na.copy(F.data,P,{x:Q-1,y:0},{x:Z-1,y:K},{width:1,height:at}),Na.copy(F.data,P,{x:0,y:0},{x:Z+Q,y:K},{width:1,height:at})}this.image=P,this.iconPositions=d,this.patternPositions=m}addImages(o,c,d){for(const m in o){const b=o[m],w={x:0,y:0,w:b.data.width+2*Bs,h:b.data.height+2*Bs};d.push(w),c[m]=new M0(w,b),b.hasRenderCallback&&this.haveRenderCallbacks.push(m)}}patchUpdatedImages(o,c){o.dispatchRenderCallbacks(this.haveRenderCallbacks);for(const d in o.updatedImages)this.patchUpdatedImage(this.iconPositions[d],o.getImage(d),c),this.patchUpdatedImage(this.patternPositions[d],o.getImage(d),c)}patchUpdatedImage(o,c,d){if(!o||!c||o.version===c.version)return;o.version=c.version;const[m,b]=o.tl;d.update(c.data,void 0,{x:m,y:b})}}var Mh;be("ImagePosition",M0),be("ImageAtlas",yb),a.ai=void 0,(Mh=a.ai||(a.ai={}))[Mh.none=0]="none",Mh[Mh.horizontal=1]="horizontal",Mh[Mh.vertical=2]="vertical",Mh[Mh.horizontalOnly=3]="horizontalOnly";const Kf=-17;class Jf{constructor(){this.scale=1,this.fontStack="",this.imageName=null}static forText(o,c){const d=new Jf;return d.scale=o||1,d.fontStack=c,d}static forImage(o){const c=new Jf;return c.imageName=o,c}}class yd{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(o,c){const d=new yd;for(let m=0;m<o.sections.length;m++){const b=o.sections[m];b.image?d.addImageSection(b):d.addTextSection(b,c)}return d}length(){return this.text.length}getSection(o){return this.sections[this.sectionIndex[o]]}getSectionIndex(o){return this.sectionIndex[o]}getCharCode(o){return this.text.charCodeAt(o)}verticalizePunctuation(){this.text=function(o){let c="";for(let d=0;d<o.length;d++){const m=o.charCodeAt(d+1)||null,b=o.charCodeAt(d-1)||null;c+=m&&hc(m)&&!Yf[o[d+1]]||b&&hc(b)&&!Yf[o[d-1]]||!Yf[o[d]]?o[d]:Yf[o[d]]}return c}(this.text)}trim(){let o=0;for(let d=0;d<this.text.length&&Wg[this.text.charCodeAt(d)];d++)o++;let c=this.text.length;for(let d=this.text.length-1;d>=0&&d>=o&&Wg[this.text.charCodeAt(d)];d--)c--;this.text=this.text.substring(o,c),this.sectionIndex=this.sectionIndex.slice(o,c)}substring(o,c){const d=new yd;return d.text=this.text.substring(o,c),d.sectionIndex=this.sectionIndex.slice(o,c),d.sections=this.sections,d}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce((o,c)=>Math.max(o,this.sections[c].scale),0)}addTextSection(o,c){this.text+=o.text,this.sections.push(Jf.forText(o.scale,o.fontStack||c));const d=this.sections.length-1;for(let m=0;m<o.text.length;++m)this.sectionIndex.push(d)}addImageSection(o){const c=o.image?o.image.name:"";if(c.length===0)return void Ot("Can't add FormattedSection with an empty image.");const d=this.getNextImageSectionCharCode();d?(this.text+=String.fromCharCode(d),this.sections.push(Jf.forImage(c)),this.sectionIndex.push(this.sections.length-1)):Ot("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function Zg(u,o,c,d,m,b,w,I,P,R,F,j,Z,K,Q,at){const gt=yd.fromFeature(u,m);let _t;j===a.ai.vertical&&gt.verticalizePunctuation();const{processBidirectionalText:At,processStyledBidirectionalText:Tt}=Fs;if(At&&gt.sections.length===1){_t=[];const Kt=At(gt.toString(),P0(gt,R,b,o,d,K,Q));for(const Te of Kt){const Oe=new yd;Oe.text=Te,Oe.sections=gt.sections;for(let Se=0;Se<Te.length;Se++)Oe.sectionIndex.push(0);_t.push(Oe)}}else if(Tt){_t=[];const Kt=Tt(gt.text,gt.sectionIndex,P0(gt,R,b,o,d,K,Q));for(const Te of Kt){const Oe=new yd;Oe.text=Te[0],Oe.sectionIndex=Te[1],Oe.sections=gt.sections,_t.push(Oe)}}else _t=function(Kt,Te){const Oe=[],Se=Kt.text;let xe=0;for(const he of Te)Oe.push(Kt.substring(xe,he)),xe=he;return xe<Se.length&&Oe.push(Kt.substring(xe,Se.length)),Oe}(gt,P0(gt,R,b,o,d,K,Q));const Rt=[],jt={positionedLines:Rt,text:gt.toString(),top:F[1],bottom:F[1],left:F[0],right:F[0],writingMode:j,iconsInText:!1,verticalizable:!1};return function(Kt,Te,Oe,Se,xe,he,Ae,de,ie,qe,Be,wr){let zn=0,Vn=Kf,ji=0,da=0;const _s=de==="right"?1:de==="left"?0:.5;let Fi=0;for(const Vi of xe){Vi.trim();const Gi=Vi.getMaxScale(),Qo=(Gi-1)*Ui,bs={positionedGlyphs:[],lineOffset:0};Kt.positionedLines[Fi]=bs;const ts=bs.positionedGlyphs;let $s=0;if(!Vi.length()){Vn+=he,++Fi;continue}for(let qi=0;qi<Vi.length();qi++){const Dr=Vi.getSection(qi),es=Vi.getSectionIndex(qi),Fo=Vi.getCharCode(qi);let Zi=0,fl=null,Wl=null,Xl=null,xc=Ui;const ml=!(ie===a.ai.horizontal||!Be&&!Mu(Fo)||Be&&(Wg[Fo]||(vo=Fo,pe.Arabic(vo)||pe["Arabic Supplement"](vo)||pe["Arabic Extended-A"](vo)||pe["Arabic Presentation Forms-A"](vo)||pe["Arabic Presentation Forms-B"](vo))));if(Dr.imageName){const Oa=Se[Dr.imageName];if(!Oa)continue;Xl=Dr.imageName,Kt.iconsInText=Kt.iconsInText||!0,Wl=Oa.paddedRect;const js=Oa.displaySize;Dr.scale=Dr.scale*Ui/wr,fl={width:js[0],height:js[1],left:Bs,top:-mb,advance:ml?js[1]:js[0]},Zi=Qo+(Ui-js[1]*Dr.scale),xc=fl.advance;const bc=ml?js[0]*Dr.scale-Ui*Gi:js[1]*Dr.scale-Ui*Gi;bc>0&&bc>$s&&($s=bc)}else{const Oa=Oe[Dr.fontStack],js=Oa&&Oa[Fo];if(js&&js.rect)Wl=js.rect,fl=js.metrics;else{const bc=Te[Dr.fontStack],nm=bc&&bc[Fo];if(!nm)continue;fl=nm.metrics}Zi=(Gi-Dr.scale)*Ui}ml?(Kt.verticalizable=!0,ts.push({glyph:Fo,imageName:Xl,x:zn,y:Vn+Zi,vertical:ml,scale:Dr.scale,fontStack:Dr.fontStack,sectionIndex:es,metrics:fl,rect:Wl}),zn+=xc*Dr.scale+qe):(ts.push({glyph:Fo,imageName:Xl,x:zn,y:Vn+Zi,vertical:ml,scale:Dr.scale,fontStack:Dr.fontStack,sectionIndex:es,metrics:fl,rect:Wl}),zn+=fl.advance*Dr.scale+qe)}ts.length!==0&&(ji=Math.max(zn-qe,ji),qM(ts,0,ts.length-1,_s,$s)),zn=0;const Us=he*Gi+$s;bs.lineOffset=Math.max($s,Qo),Vn+=Us,da=Math.max(Us,da),++Fi}var vo;const Oo=Vn-Kf,{horizontalAlign:vs,verticalAlign:xs}=A0(Ae);(function(Vi,Gi,Qo,bs,ts,$s,Us,qi,Dr){const es=(Gi-Qo)*ts;let Fo=0;Fo=$s!==Us?-qi*bs-Kf:(-bs*Dr+.5)*Us;for(const Zi of Vi)for(const fl of Zi.positionedGlyphs)fl.x+=es,fl.y+=Fo})(Kt.positionedLines,_s,vs,xs,ji,da,he,Oo,xe.length),Kt.top+=-xs*Oo,Kt.bottom=Kt.top+Oo,Kt.left+=-vs*ji,Kt.right=Kt.left+ji}(jt,o,c,d,_t,w,I,P,j,R,Z,at),!function(Kt){for(const Te of Kt)if(Te.positionedGlyphs.length!==0)return!1;return!0}(Rt)&&jt}const Wg={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},VM={10:!0,32:!0,38:!0,40:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0};function _b(u,o,c,d,m,b){if(o.imageName){const w=d[o.imageName];return w?w.displaySize[0]*o.scale*Ui/b+m:0}{const w=c[o.fontStack],I=w&&w[u];return I?I.metrics.advance*o.scale+m:0}}function vb(u,o,c,d){const m=Math.pow(u-o,2);return d?u<o?m/2:2*m:m+Math.abs(c)*c}function GM(u,o,c){let d=0;return u===10&&(d-=1e4),c&&(d+=150),u!==40&&u!==65288||(d+=50),o!==41&&o!==65289||(d+=50),d}function xb(u,o,c,d,m,b){let w=null,I=vb(o,c,m,b);for(const P of d){const R=vb(o-P.x,c,m,b)+P.badness;R<=I&&(w=P,I=R)}return{index:u,x:o,priorBreak:w,badness:I}}function bb(u){return u?bb(u.priorBreak).concat(u.index):[]}function P0(u,o,c,d,m,b,w){if(b!=="point")return[];if(!u)return[];const I=[],P=function(Z,K,Q,at,gt,_t){let At=0;for(let Tt=0;Tt<Z.length();Tt++){const Rt=Z.getSection(Tt);At+=_b(Z.getCharCode(Tt),Rt,at,gt,K,_t)}return At/Math.max(1,Math.ceil(At/Q))}(u,o,c,d,m,w),R=u.text.indexOf("")>=0;let F=0;for(let Z=0;Z<u.length();Z++){const K=u.getSection(Z),Q=u.getCharCode(Z);if(Wg[Q]||(F+=_b(Q,K,d,m,o,w)),Z<u.length()-1){const at=!((j=Q)<11904||!(pe["Bopomofo Extended"](j)||pe.Bopomofo(j)||pe["CJK Compatibility Forms"](j)||pe["CJK Compatibility Ideographs"](j)||pe["CJK Compatibility"](j)||pe["CJK Radicals Supplement"](j)||pe["CJK Strokes"](j)||pe["CJK Symbols and Punctuation"](j)||pe["CJK Unified Ideographs Extension A"](j)||pe["CJK Unified Ideographs"](j)||pe["Enclosed CJK Letters and Months"](j)||pe["Halfwidth and Fullwidth Forms"](j)||pe.Hiragana(j)||pe["Ideographic Description Characters"](j)||pe["Kangxi Radicals"](j)||pe["Katakana Phonetic Extensions"](j)||pe.Katakana(j)||pe["Vertical Forms"](j)||pe["Yi Radicals"](j)||pe["Yi Syllables"](j)));(VM[Q]||at||K.imageName)&&I.push(xb(Z+1,F,P,I,GM(Q,u.getCharCode(Z+1),at&&R),!1))}}var j;return bb(xb(u.length(),F,P,I,0,!0))}function A0(u){let o=.5,c=.5;switch(u){case"right":case"top-right":case"bottom-right":o=1;break;case"left":case"top-left":case"bottom-left":o=0}switch(u){case"bottom":case"bottom-right":case"bottom-left":c=1;break;case"top":case"top-right":case"top-left":c=0}return{horizontalAlign:o,verticalAlign:c}}function qM(u,o,c,d,m){if(!d&&!m)return;const b=u[c],w=(u[c].x+b.metrics.advance*b.scale)*d;for(let I=o;I<=c;I++)u[I].x-=w,u[I].y+=m}function ZM(u,o,c){const{horizontalAlign:d,verticalAlign:m}=A0(c),b=o[0]-u.displaySize[0]*d,w=o[1]-u.displaySize[1]*m;return{image:u,top:w,bottom:w+u.displaySize[1],left:b,right:b+u.displaySize[0]}}function wb(u,o,c,d,m,b){const w=u.image;let I;if(w.content){const gt=w.content,_t=w.pixelRatio||1;I=[gt[0]/_t,gt[1]/_t,w.displaySize[0]-gt[2]/_t,w.displaySize[1]-gt[3]/_t]}const P=o.left*b,R=o.right*b;let F,j,Z,K;c==="width"||c==="both"?(K=m[0]+P-d[3],j=m[0]+R+d[1]):(K=m[0]+(P+R-w.displaySize[0])/2,j=K+w.displaySize[0]);const Q=o.top*b,at=o.bottom*b;return c==="height"||c==="both"?(F=m[1]+Q-d[0],Z=m[1]+at+d[2]):(F=m[1]+(Q+at-w.displaySize[1])/2,Z=F+w.displaySize[1]),{image:w,top:F,right:j,bottom:Z,left:K,collisionPadding:I}}const Qf=255,Lu=128,Ph=Qf*Lu;function Eb(u,o){const{expression:c}=o;if(c.kind==="constant")return{kind:"constant",layoutSize:c.evaluate(new On(u+1))};if(c.kind==="source")return{kind:"source"};{const{zoomStops:d,interpolationType:m}=c;let b=0;for(;b<d.length&&d[b]<=u;)b++;b=Math.max(0,b-1);let w=b;for(;w<d.length&&d[w]<u+1;)w++;w=Math.min(d.length-1,w);const I=d[b],P=d[w];return c.kind==="composite"?{kind:"composite",minZoom:I,maxZoom:P,interpolationType:m}:{kind:"camera",minZoom:I,maxZoom:P,minSize:c.evaluate(new On(I)),maxSize:c.evaluate(new On(P)),interpolationType:m}}}function L0(u,o,c){let d="never";const m=u.get(o);return m?d=m:u.get(c)&&(d="always"),d}const WM=Ch.VectorTileFeature.types,XM=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function Xg(u,o,c,d,m,b,w,I,P,R,F,j,Z){const K=I?Math.min(Ph,Math.round(I[0])):0,Q=I?Math.min(Ph,Math.round(I[1])):0;u.emplaceBack(o,c,Math.round(32*d),Math.round(32*m),b,w,(K<<1)+(P?1:0),Q,16*R,16*F,256*j,256*Z)}function R0(u,o,c){u.emplaceBack(o.x,o.y,c),u.emplaceBack(o.x,o.y,c),u.emplaceBack(o.x,o.y,c),u.emplaceBack(o.x,o.y,c)}function HM(u){for(const o of u.sections)if(Eh(o.text))return!0;return!1}class D0{constructor(o){this.layoutVertexArray=new Ir,this.indexArray=new yo,this.programConfigurations=o,this.segments=new Fn,this.dynamicLayoutVertexArray=new mr,this.opacityVertexArray=new Pr,this.hasVisibleVertices=!1,this.placedSymbolArray=new Mt}isEmpty(){return this.layoutVertexArray.length===0&&this.indexArray.length===0&&this.dynamicLayoutVertexArray.length===0&&this.opacityVertexArray.length===0}upload(o,c,d,m){this.isEmpty()||(d&&(this.layoutVertexBuffer=o.createVertexBuffer(this.layoutVertexArray,TM.members),this.indexBuffer=o.createIndexBuffer(this.indexArray,c),this.dynamicLayoutVertexBuffer=o.createVertexBuffer(this.dynamicLayoutVertexArray,IM.members,!0),this.opacityVertexBuffer=o.createVertexBuffer(this.opacityVertexArray,XM,!0),this.opacityVertexBuffer.itemSize=1),(d||m)&&this.programConfigurations.upload(o))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy())}}be("SymbolBuffers",D0);class N0{constructor(o,c,d){this.layoutVertexArray=new o,this.layoutAttributes=c,this.indexArray=new d,this.segments=new Fn,this.collisionVertexArray=new Mn}upload(o){this.layoutVertexBuffer=o.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=o.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=o.createVertexBuffer(this.collisionVertexArray,CM.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy())}}be("CollisionBuffers",N0);class _d{constructor(o){this.collisionBoxArray=o.collisionBoxArray,this.zoom=o.zoom,this.overscaling=o.overscaling,this.layers=o.layers,this.layerIds=this.layers.map(w=>w.id),this.index=o.index,this.pixelRatio=o.pixelRatio,this.sourceLayerIndex=o.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=h0([]),this.placementViewportMatrix=h0([]);const c=this.layers[0]._unevaluatedLayout._values;this.textSizeData=Eb(this.zoom,c["text-size"]),this.iconSizeData=Eb(this.zoom,c["icon-size"]);const d=this.layers[0].layout,m=d.get("symbol-sort-key"),b=d.get("symbol-z-order");this.canOverlap=L0(d,"text-overlap","text-allow-overlap")!=="never"||L0(d,"icon-overlap","icon-allow-overlap")!=="never"||d.get("text-ignore-placement")||d.get("icon-ignore-placement"),this.sortFeaturesByKey=b!=="viewport-y"&&!m.isConstant(),this.sortFeaturesByY=(b==="viewport-y"||b==="auto"&&!this.sortFeaturesByKey)&&this.canOverlap,d.get("symbol-placement")==="point"&&(this.writingModes=d.get("text-writing-mode").map(w=>a.ai[w])),this.stateDependentLayerIds=this.layers.filter(w=>w.isStateDependent()).map(w=>w.id),this.sourceID=o.sourceID}createArrays(){this.text=new D0(new Zl(this.layers,this.zoom,o=>/^text/.test(o))),this.icon=new D0(new Zl(this.layers,this.zoom,o=>/^icon/.test(o))),this.glyphOffsetArray=new Pt,this.lineVertexArray=new Vt,this.symbolInstances=new yt,this.textAnchorOffsets=new Yt}calculateGlyphDependencies(o,c,d,m,b){for(let w=0;w<o.length;w++)if(c[o.charCodeAt(w)]=!0,(d||m)&&b){const I=Yf[o.charAt(w)];I&&(c[I.charCodeAt(0)]=!0)}}populate(o,c,d){const m=this.layers[0],b=m.layout,w=b.get("text-font"),I=b.get("text-field"),P=b.get("icon-image"),R=(I.value.kind!=="constant"||I.value.value instanceof Cn&&!I.value.value.isEmpty()||I.value.value.toString().length>0)&&(w.value.kind!=="constant"||w.value.value.length>0),F=P.value.kind!=="constant"||!!P.value.value||Object.keys(P.parameters).length>0,j=b.get("symbol-sort-key");if(this.features=[],!R&&!F)return;const Z=c.iconDependencies,K=c.glyphDependencies,Q=c.availableImages,at=new On(this.zoom);for(const{feature:gt,id:_t,index:At,sourceLayerIndex:Tt}of o){const Rt=m._featureFilter.needGeometry,jt=Ep(gt,Rt);if(!m._featureFilter.filter(at,jt,d))continue;let Kt,Te;if(Rt||(jt.geometry=wp(gt)),R){const Se=m.getValueAndResolveTokens("text-field",jt,d,Q),xe=Cn.factory(Se);HM(xe)&&(this.hasRTLText=!0),(!this.hasRTLText||Af()==="unavailable"||this.hasRTLText&&Fs.isParsed())&&(Kt=PM(xe,m,jt))}if(F){const Se=m.getValueAndResolveTokens("icon-image",jt,d,Q);Te=Se instanceof ki?Se:ki.fromString(Se)}if(!Kt&&!Te)continue;const Oe=this.sortFeaturesByKey?j.evaluate(jt,{},d):void 0;if(this.features.push({id:_t,text:Kt,icon:Te,index:At,sourceLayerIndex:Tt,geometry:jt.geometry,properties:gt.properties,type:WM[gt.type],sortKey:Oe}),Te&&(Z[Te.name]=!0),Kt){const Se=w.evaluate(jt,{},d).join(","),xe=b.get("text-rotation-alignment")!=="viewport"&&b.get("symbol-placement")!=="point";this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(a.ai.vertical)>=0;for(const he of Kt.sections)if(he.image)Z[he.image.name]=!0;else{const Ae=wh(Kt.toString()),de=he.fontStack||Se,ie=K[de]=K[de]||{};this.calculateGlyphDependencies(he.text,ie,xe,this.allowVerticalPlacement,Ae)}}}b.get("symbol-placement")==="line"&&(this.features=function(gt){const _t={},At={},Tt=[];let Rt=0;function jt(Se){Tt.push(gt[Se]),Rt++}function Kt(Se,xe,he){const Ae=At[Se];return delete At[Se],At[xe]=Ae,Tt[Ae].geometry[0].pop(),Tt[Ae].geometry[0]=Tt[Ae].geometry[0].concat(he[0]),Ae}function Te(Se,xe,he){const Ae=_t[xe];return delete _t[xe],_t[Se]=Ae,Tt[Ae].geometry[0].shift(),Tt[Ae].geometry[0]=he[0].concat(Tt[Ae].geometry[0]),Ae}function Oe(Se,xe,he){const Ae=he?xe[0][xe[0].length-1]:xe[0][0];return`${Se}:${Ae.x}:${Ae.y}`}for(let Se=0;Se<gt.length;Se++){const xe=gt[Se],he=xe.geometry,Ae=xe.text?xe.text.toString():null;if(!Ae){jt(Se);continue}const de=Oe(Ae,he),ie=Oe(Ae,he,!0);if(de in At&&ie in _t&&At[de]!==_t[ie]){const qe=Te(de,ie,he),Be=Kt(de,ie,Tt[qe].geometry);delete _t[de],delete At[ie],At[Oe(Ae,Tt[Be].geometry,!0)]=Be,Tt[qe].geometry=null}else de in At?Kt(de,ie,he):ie in _t?Te(de,ie,he):(jt(Se),_t[de]=Rt-1,At[ie]=Rt-1)}return Tt.filter(Se=>Se.geometry)}(this.features)),this.sortFeaturesByKey&&this.features.sort((gt,_t)=>gt.sortKey-_t.sortKey)}update(o,c,d){this.stateDependentLayers.length&&(this.text.programConfigurations.updatePaintArrays(o,c,this.layers,d),this.icon.programConfigurations.updatePaintArrays(o,c,this.layers,d))}isEmpty(){return this.symbolInstances.length===0&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(o){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(o),this.iconCollisionBox.upload(o)),this.text.upload(o,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload),this.icon.upload(o,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(o,c){const d=this.lineVertexArray.length;if(o.segment!==void 0){let m=o.dist(c[o.segment+1]),b=o.dist(c[o.segment]);const w={};for(let I=o.segment+1;I<c.length;I++)w[I]={x:c[I].x,y:c[I].y,tileUnitDistanceFromAnchor:m},I<c.length-1&&(m+=c[I+1].dist(c[I]));for(let I=o.segment||0;I>=0;I--)w[I]={x:c[I].x,y:c[I].y,tileUnitDistanceFromAnchor:b},I>0&&(b+=c[I-1].dist(c[I]));for(let I=0;I<c.length;I++){const P=w[I];this.lineVertexArray.emplaceBack(P.x,P.y,P.tileUnitDistanceFromAnchor)}}return{lineStartIndex:d,lineLength:this.lineVertexArray.length-d}}addSymbols(o,c,d,m,b,w,I,P,R,F,j,Z){const K=o.indexArray,Q=o.layoutVertexArray,at=o.segments.prepareSegment(4*c.length,Q,K,this.canOverlap?w.sortKey:void 0),gt=this.glyphOffsetArray.length,_t=at.vertexLength,At=this.allowVerticalPlacement&&I===a.ai.vertical?Math.PI/2:0,Tt=w.text&&w.text.sections;for(let Rt=0;Rt<c.length;Rt++){const{tl:jt,tr:Kt,bl:Te,br:Oe,tex:Se,pixelOffsetTL:xe,pixelOffsetBR:he,minFontScaleX:Ae,minFontScaleY:de,glyphOffset:ie,isSDF:qe,sectionIndex:Be}=c[Rt],wr=at.vertexLength,zn=ie[1];Xg(Q,P.x,P.y,jt.x,zn+jt.y,Se.x,Se.y,d,qe,xe.x,xe.y,Ae,de),Xg(Q,P.x,P.y,Kt.x,zn+Kt.y,Se.x+Se.w,Se.y,d,qe,he.x,xe.y,Ae,de),Xg(Q,P.x,P.y,Te.x,zn+Te.y,Se.x,Se.y+Se.h,d,qe,xe.x,he.y,Ae,de),Xg(Q,P.x,P.y,Oe.x,zn+Oe.y,Se.x+Se.w,Se.y+Se.h,d,qe,he.x,he.y,Ae,de),R0(o.dynamicLayoutVertexArray,P,At),K.emplaceBack(wr,wr+1,wr+2),K.emplaceBack(wr+1,wr+2,wr+3),at.vertexLength+=4,at.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(ie[0]),Rt!==c.length-1&&Be===c[Rt+1].sectionIndex||o.programConfigurations.populatePaintArrays(Q.length,w,w.index,{},Z,Tt&&Tt[Be])}o.placedSymbolArray.emplaceBack(P.x,P.y,gt,this.glyphOffsetArray.length-gt,_t,R,F,P.segment,d?d[0]:0,d?d[1]:0,m[0],m[1],I,0,!1,0,j)}_addCollisionDebugVertex(o,c,d,m,b,w){return c.emplaceBack(0,0),o.emplaceBack(d.x,d.y,m,b,Math.round(w.x),Math.round(w.y))}addCollisionDebugVertices(o,c,d,m,b,w,I){const P=b.segments.prepareSegment(4,b.layoutVertexArray,b.indexArray),R=P.vertexLength,F=b.layoutVertexArray,j=b.collisionVertexArray,Z=I.anchorX,K=I.anchorY;this._addCollisionDebugVertex(F,j,w,Z,K,new A(o,c)),this._addCollisionDebugVertex(F,j,w,Z,K,new A(d,c)),this._addCollisionDebugVertex(F,j,w,Z,K,new A(d,m)),this._addCollisionDebugVertex(F,j,w,Z,K,new A(o,m)),P.vertexLength+=4;const Q=b.indexArray;Q.emplaceBack(R,R+1),Q.emplaceBack(R+1,R+2),Q.emplaceBack(R+2,R+3),Q.emplaceBack(R+3,R),P.primitiveLength+=4}addDebugCollisionBoxes(o,c,d,m){for(let b=o;b<c;b++){const w=this.collisionBoxArray.get(b);this.addCollisionDebugVertices(w.x1,w.y1,w.x2,w.y2,m?this.textCollisionBox:this.iconCollisionBox,w.anchorPoint,d)}}generateCollisionDebugBuffers(){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new N0(hi,ab.members,Bi),this.iconCollisionBox=new N0(hi,ab.members,Bi);for(let o=0;o<this.symbolInstances.length;o++){const c=this.symbolInstances.get(o);this.addDebugCollisionBoxes(c.textBoxStartIndex,c.textBoxEndIndex,c,!0),this.addDebugCollisionBoxes(c.verticalTextBoxStartIndex,c.verticalTextBoxEndIndex,c,!0),this.addDebugCollisionBoxes(c.iconBoxStartIndex,c.iconBoxEndIndex,c,!1),this.addDebugCollisionBoxes(c.verticalIconBoxStartIndex,c.verticalIconBoxEndIndex,c,!1)}}_deserializeCollisionBoxesForSymbol(o,c,d,m,b,w,I,P,R){const F={};for(let j=c;j<d;j++){const Z=o.get(j);F.textBox={x1:Z.x1,y1:Z.y1,x2:Z.x2,y2:Z.y2,anchorPointX:Z.anchorPointX,anchorPointY:Z.anchorPointY},F.textFeatureIndex=Z.featureIndex;break}for(let j=m;j<b;j++){const Z=o.get(j);F.verticalTextBox={x1:Z.x1,y1:Z.y1,x2:Z.x2,y2:Z.y2,anchorPointX:Z.anchorPointX,anchorPointY:Z.anchorPointY},F.verticalTextFeatureIndex=Z.featureIndex;break}for(let j=w;j<I;j++){const Z=o.get(j);F.iconBox={x1:Z.x1,y1:Z.y1,x2:Z.x2,y2:Z.y2,anchorPointX:Z.anchorPointX,anchorPointY:Z.anchorPointY},F.iconFeatureIndex=Z.featureIndex;break}for(let j=P;j<R;j++){const Z=o.get(j);F.verticalIconBox={x1:Z.x1,y1:Z.y1,x2:Z.x2,y2:Z.y2,anchorPointX:Z.anchorPointX,anchorPointY:Z.anchorPointY},F.verticalIconFeatureIndex=Z.featureIndex;break}return F}deserializeCollisionBoxes(o){this.collisionArrays=[];for(let c=0;c<this.symbolInstances.length;c++){const d=this.symbolInstances.get(c);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(o,d.textBoxStartIndex,d.textBoxEndIndex,d.verticalTextBoxStartIndex,d.verticalTextBoxEndIndex,d.iconBoxStartIndex,d.iconBoxEndIndex,d.verticalIconBoxStartIndex,d.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}addIndicesForPlacedSymbol(o,c){const d=o.placedSymbolArray.get(c),m=d.vertexStartIndex+4*d.numGlyphs;for(let b=d.vertexStartIndex;b<m;b+=4)o.indexArray.emplaceBack(b,b+1,b+2),o.indexArray.emplaceBack(b+1,b+2,b+3)}getSortedSymbolIndexes(o){if(this.sortedAngle===o&&this.symbolInstanceIndexes!==void 0)return this.symbolInstanceIndexes;const c=Math.sin(o),d=Math.cos(o),m=[],b=[],w=[];for(let I=0;I<this.symbolInstances.length;++I){w.push(I);const P=this.symbolInstances.get(I);m.push(0|Math.round(c*P.anchorX+d*P.anchorY)),b.push(P.featureIndex)}return w.sort((I,P)=>m[I]-m[P]||b[P]-b[I]),w}addToSortKeyRanges(o,c){const d=this.sortKeyRanges[this.sortKeyRanges.length-1];d&&d.sortKey===c?d.symbolInstanceEnd=o+1:this.sortKeyRanges.push({sortKey:c,symbolInstanceStart:o,symbolInstanceEnd:o+1})}sortFeatures(o){if(this.sortFeaturesByY&&this.sortedAngle!==o&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(o),this.sortedAngle=o,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const c of this.symbolInstanceIndexes){const d=this.symbolInstances.get(c);this.featureSortOrder.push(d.featureIndex),[d.rightJustifiedTextSymbolIndex,d.centerJustifiedTextSymbolIndex,d.leftJustifiedTextSymbolIndex].forEach((m,b,w)=>{m>=0&&w.indexOf(m)===b&&this.addIndicesForPlacedSymbol(this.text,m)}),d.verticalPlacedTextSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.text,d.verticalPlacedTextSymbolIndex),d.placedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,d.placedIconSymbolIndex),d.verticalPlacedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,d.verticalPlacedIconSymbolIndex)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}let Sb,Tb;be("SymbolBucket",_d,{omit:["layers","collisionBoxArray","features","compareText"]}),_d.MAX_GLYPHS=65535,_d.addDynamicAttributes=R0;var k0={get paint(){return Tb=Tb||new Ei({"icon-opacity":new Ke(Gt.paint_symbol["icon-opacity"]),"icon-color":new Ke(Gt.paint_symbol["icon-color"]),"icon-halo-color":new Ke(Gt.paint_symbol["icon-halo-color"]),"icon-halo-width":new Ke(Gt.paint_symbol["icon-halo-width"]),"icon-halo-blur":new Ke(Gt.paint_symbol["icon-halo-blur"]),"icon-translate":new je(Gt.paint_symbol["icon-translate"]),"icon-translate-anchor":new je(Gt.paint_symbol["icon-translate-anchor"]),"text-opacity":new Ke(Gt.paint_symbol["text-opacity"]),"text-color":new Ke(Gt.paint_symbol["text-color"],{runtimeType:Di,getOverride:u=>u.textColor,hasOverride:u=>!!u.textColor}),"text-halo-color":new Ke(Gt.paint_symbol["text-halo-color"]),"text-halo-width":new Ke(Gt.paint_symbol["text-halo-width"]),"text-halo-blur":new Ke(Gt.paint_symbol["text-halo-blur"]),"text-translate":new je(Gt.paint_symbol["text-translate"]),"text-translate-anchor":new je(Gt.paint_symbol["text-translate-anchor"])})},get layout(){return Sb=Sb||new Ei({"symbol-placement":new je(Gt.layout_symbol["symbol-placement"]),"symbol-spacing":new je(Gt.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new je(Gt.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new Ke(Gt.layout_symbol["symbol-sort-key"]),"symbol-z-order":new je(Gt.layout_symbol["symbol-z-order"]),"icon-allow-overlap":new je(Gt.layout_symbol["icon-allow-overlap"]),"icon-overlap":new je(Gt.layout_symbol["icon-overlap"]),"icon-ignore-placement":new je(Gt.layout_symbol["icon-ignore-placement"]),"icon-optional":new je(Gt.layout_symbol["icon-optional"]),"icon-rotation-alignment":new je(Gt.layout_symbol["icon-rotation-alignment"]),"icon-size":new Ke(Gt.layout_symbol["icon-size"]),"icon-text-fit":new je(Gt.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new je(Gt.layout_symbol["icon-text-fit-padding"]),"icon-image":new Ke(Gt.layout_symbol["icon-image"]),"icon-rotate":new Ke(Gt.layout_symbol["icon-rotate"]),"icon-padding":new Ke(Gt.layout_symbol["icon-padding"]),"icon-keep-upright":new je(Gt.layout_symbol["icon-keep-upright"]),"icon-offset":new Ke(Gt.layout_symbol["icon-offset"]),"icon-anchor":new Ke(Gt.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new je(Gt.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new je(Gt.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new je(Gt.layout_symbol["text-rotation-alignment"]),"text-field":new Ke(Gt.layout_symbol["text-field"]),"text-font":new Ke(Gt.layout_symbol["text-font"]),"text-size":new Ke(Gt.layout_symbol["text-size"]),"text-max-width":new Ke(Gt.layout_symbol["text-max-width"]),"text-line-height":new je(Gt.layout_symbol["text-line-height"]),"text-letter-spacing":new Ke(Gt.layout_symbol["text-letter-spacing"]),"text-justify":new Ke(Gt.layout_symbol["text-justify"]),"text-radial-offset":new Ke(Gt.layout_symbol["text-radial-offset"]),"text-variable-anchor":new je(Gt.layout_symbol["text-variable-anchor"]),"text-variable-anchor-offset":new Ke(Gt.layout_symbol["text-variable-anchor-offset"]),"text-anchor":new Ke(Gt.layout_symbol["text-anchor"]),"text-max-angle":new je(Gt.layout_symbol["text-max-angle"]),"text-writing-mode":new je(Gt.layout_symbol["text-writing-mode"]),"text-rotate":new Ke(Gt.layout_symbol["text-rotate"]),"text-padding":new je(Gt.layout_symbol["text-padding"]),"text-keep-upright":new je(Gt.layout_symbol["text-keep-upright"]),"text-transform":new Ke(Gt.layout_symbol["text-transform"]),"text-offset":new Ke(Gt.layout_symbol["text-offset"]),"text-allow-overlap":new je(Gt.layout_symbol["text-allow-overlap"]),"text-overlap":new je(Gt.layout_symbol["text-overlap"]),"text-ignore-placement":new je(Gt.layout_symbol["text-ignore-placement"]),"text-optional":new je(Gt.layout_symbol["text-optional"])})}};class Ib{constructor(o){if(o.property.overrides===void 0)throw new Error("overrides must be provided to instantiate FormatSectionOverride class");this.type=o.property.overrides?o.property.overrides.runtimeType:Ri,this.defaultValue=o}evaluate(o){if(o.formattedSection){const c=this.defaultValue.property.overrides;if(c&&c.hasOverride(o.formattedSection))return c.getOverride(o.formattedSection)}return o.feature&&o.featureState?this.defaultValue.evaluate(o.feature,o.featureState):this.defaultValue.property.specification.default}eachChild(o){this.defaultValue.isConstant()||o(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}be("FormatSectionOverride",Ib,{omit:["defaultValue"]});class Hg extends ha{constructor(o){super(o,k0)}recalculate(o,c){if(super.recalculate(o,c),this.layout.get("icon-rotation-alignment")==="auto"&&(this.layout._values["icon-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-rotation-alignment")==="auto"&&(this.layout._values["text-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-pitch-alignment")==="auto"&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")==="map"?"map":"viewport"),this.layout.get("icon-pitch-alignment")==="auto"&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment")),this.layout.get("symbol-placement")==="point"){const d=this.layout.get("text-writing-mode");if(d){const m=[];for(const b of d)m.indexOf(b)<0&&m.push(b);this.layout._values["text-writing-mode"]=m}else this.layout._values["text-writing-mode"]=["horizontal"]}this._setPaintOverrides()}getValueAndResolveTokens(o,c,d,m){const b=this.layout.get(o).evaluate(c,{},d,m),w=this._unevaluatedLayout._values[o];return w.isDataDriven()||Ns(w.value)||!b?b:function(I,P){return P.replace(/{([^{}]+)}/g,(R,F)=>I&&F in I?String(I[F]):"")}(c.properties,b)}createBucket(o){return new _d(o)}queryRadius(){return 0}queryIntersectsFeature(){throw new Error("Should take a different path in FeatureIndex")}_setPaintOverrides(){for(const o of k0.paint.overridableProperties){if(!Hg.hasPaintOverride(this.layout,o))continue;const c=this.paint.get(o),d=new Ib(c),m=new wu(d,c.property.specification);let b=null;b=c.value.kind==="constant"||c.value.kind==="source"?new Eu("source",m):new ol("composite",m,c.value.zoomStops),this.paint._values[o]=new Ko(c.property,b,c.parameters)}}_handleOverridablePaintPropertyUpdate(o,c,d){return!(!this.layout||c.isDataDriven()||d.isDataDriven())&&Hg.hasPaintOverride(this.layout,o)}static hasPaintOverride(o,c){const d=o.get("text-field"),m=k0.paint.properties[c];let b=!1;const w=I=>{for(const P of I)if(m.overrides&&m.overrides.hasOverride(P))return void(b=!0)};if(d.value.kind==="constant"&&d.value.value instanceof Cn)w(d.value.value.sections);else if(d.value.kind==="source"){const I=R=>{b||(R instanceof Ma&&An(R.value)===ct?w(R.value.sections):R instanceof ic?w(R.sections):R.eachChild(I))},P=d.value;P._styleExpression&&I(P._styleExpression.expression)}return b}}let Cb;var YM={get paint(){return Cb=Cb||new Ei({"background-color":new je(Gt.paint_background["background-color"]),"background-pattern":new Rf(Gt.paint_background["background-pattern"]),"background-opacity":new je(Gt.paint_background["background-opacity"])})}};class KM extends ha{constructor(o){super(o,YM)}}let Mb;var JM={get paint(){return Mb=Mb||new Ei({"raster-opacity":new je(Gt.paint_raster["raster-opacity"]),"raster-hue-rotate":new je(Gt.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new je(Gt.paint_raster["raster-brightness-min"]),"raster-brightness-max":new je(Gt.paint_raster["raster-brightness-max"]),"raster-saturation":new je(Gt.paint_raster["raster-saturation"]),"raster-contrast":new je(Gt.paint_raster["raster-contrast"]),"raster-resampling":new je(Gt.paint_raster["raster-resampling"]),"raster-fade-duration":new je(Gt.paint_raster["raster-fade-duration"])})}};class QM extends ha{constructor(o){super(o,JM)}}class tP extends ha{constructor(o){super(o,{}),this.onAdd=c=>{this.implementation.onAdd&&this.implementation.onAdd(c,c.painter.context.gl)},this.onRemove=c=>{this.implementation.onRemove&&this.implementation.onRemove(c,c.painter.context.gl)},this.implementation=o}is3D(){return this.implementation.renderingMode==="3d"}hasOffscreenPass(){return this.implementation.prerender!==void 0}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){throw new Error("Custom layers cannot be serialized")}}class eP{constructor(o){this._callback=o,this._triggered=!1,typeof MessageChannel<"u"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._callback()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(()=>{this._triggered=!1,this._callback()},0))}remove(){delete this._channel,this._callback=()=>{}}}const O0=63710088e-1;class Ah{constructor(o,c){if(isNaN(o)||isNaN(c))throw new Error(`Invalid LngLat object: (${o}, ${c})`);if(this.lng=+o,this.lat=+c,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new Ah(ot(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(o){const c=Math.PI/180,d=this.lat*c,m=o.lat*c,b=Math.sin(d)*Math.sin(m)+Math.cos(d)*Math.cos(m)*Math.cos((o.lng-this.lng)*c);return O0*Math.acos(Math.min(b,1))}static convert(o){if(o instanceof Ah)return o;if(Array.isArray(o)&&(o.length===2||o.length===3))return new Ah(Number(o[0]),Number(o[1]));if(!Array.isArray(o)&&typeof o=="object"&&o!==null)return new Ah(Number("lng"in o?o.lng:o.lon),Number(o.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}const Pb=2*Math.PI*O0;function Ab(u){return Pb*Math.cos(u*Math.PI/180)}function Lb(u){return(180+u)/360}function Rb(u){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+u*Math.PI/360)))/360}function Db(u,o){return u/Ab(o)}function Nb(u){return 360*u-180}function F0(u){return 360/Math.PI*Math.atan(Math.exp((180-360*u)*Math.PI/180))-90}class Yg{constructor(o,c,d=0){this.x=+o,this.y=+c,this.z=+d}static fromLngLat(o,c=0){const d=Ah.convert(o);return new Yg(Lb(d.lng),Rb(d.lat),Db(c,d.lat))}toLngLat(){return new Ah(Nb(this.x),F0(this.y))}toAltitude(){return this.z*Ab(F0(this.y))}meterInMercatorCoordinateUnits(){return 1/Pb*(o=F0(this.y),1/Math.cos(o*Math.PI/180));var o}}function kb(u,o,c){var d=2*Math.PI*6378137/256/Math.pow(2,c);return[u*d-2*Math.PI*6378137/2,o*d-2*Math.PI*6378137/2]}class z0{constructor(o,c,d){if(o<0||o>25||d<0||d>=Math.pow(2,o)||c<0||c>=Math.pow(2,o))throw new Error(`x=${c}, y=${d}, z=${o} outside of bounds. 0<=x<${Math.pow(2,o)}, 0<=y<${Math.pow(2,o)} 0<=z<=25 `);this.z=o,this.x=c,this.y=d,this.key=tm(0,o,o,c,d)}equals(o){return this.z===o.z&&this.x===o.x&&this.y===o.y}url(o,c,d){const m=(w=this.y,I=this.z,P=kb(256*(b=this.x),256*(w=Math.pow(2,I)-w-1),I),R=kb(256*(b+1),256*(w+1),I),P[0]+","+P[1]+","+R[0]+","+R[1]);var b,w,I,P,R;const F=function(j,Z,K){let Q,at="";for(let gt=j;gt>0;gt--)Q=1<<gt-1,at+=(Z&Q?1:0)+(K&Q?2:0);return at}(this.z,this.x,this.y);return o[(this.x+this.y)%o.length].replace(/{prefix}/g,(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String(d==="tms"?Math.pow(2,this.z)-this.y-1:this.y)).replace(/{ratio}/g,c>1?"@2x":"").replace(/{quadkey}/g,F).replace(/{bbox-epsg-3857}/g,m)}isChildOf(o){const c=this.z-o.z;return c>0&&o.x===this.x>>c&&o.y===this.y>>c}getTilePoint(o){const c=Math.pow(2,this.z);return new A((o.x*c-this.x)*Oi,(o.y*c-this.y)*Oi)}toString(){return`${this.z}/${this.x}/${this.y}`}}class Ob{constructor(o,c){this.wrap=o,this.canonical=c,this.key=tm(o,c.z,c.z,c.x,c.y)}}class ka{constructor(o,c,d,m,b){if(o<d)throw new Error(`overscaledZ should be >= z; overscaledZ = ${o}; z = ${d}`);this.overscaledZ=o,this.wrap=c,this.canonical=new z0(d,+m,+b),this.key=tm(c,o,d,m,b)}clone(){return new ka(this.overscaledZ,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)}equals(o){return this.overscaledZ===o.overscaledZ&&this.wrap===o.wrap&&this.canonical.equals(o.canonical)}scaledTo(o){if(o>this.overscaledZ)throw new Error(`targetZ > this.overscaledZ; targetZ = ${o}; overscaledZ = ${this.overscaledZ}`);const c=this.canonical.z-o;return o>this.canonical.z?new ka(o,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new ka(o,this.wrap,o,this.canonical.x>>c,this.canonical.y>>c)}calculateScaledKey(o,c){if(o>this.overscaledZ)throw new Error(`targetZ > this.overscaledZ; targetZ = ${o}; overscaledZ = ${this.overscaledZ}`);const d=this.canonical.z-o;return o>this.canonical.z?tm(this.wrap*+c,o,this.canonical.z,this.canonical.x,this.canonical.y):tm(this.wrap*+c,o,o,this.canonical.x>>d,this.canonical.y>>d)}isChildOf(o){if(o.wrap!==this.wrap)return!1;const c=this.canonical.z-o.canonical.z;return o.overscaledZ===0||o.overscaledZ<this.overscaledZ&&o.canonical.x===this.canonical.x>>c&&o.canonical.y===this.canonical.y>>c}children(o){if(this.overscaledZ>=o)return[new ka(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];const c=this.canonical.z+1,d=2*this.canonical.x,m=2*this.canonical.y;return[new ka(c,this.wrap,c,d,m),new ka(c,this.wrap,c,d+1,m),new ka(c,this.wrap,c,d,m+1),new ka(c,this.wrap,c,d+1,m+1)]}isLessThan(o){return this.wrap<o.wrap||!(this.wrap>o.wrap)&&(this.overscaledZ<o.overscaledZ||!(this.overscaledZ>o.overscaledZ)&&(this.canonical.x<o.canonical.x||!(this.canonical.x>o.canonical.x)&&this.canonical.y<o.canonical.y))}wrapped(){return new ka(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(o){return new ka(this.overscaledZ,o,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new Ob(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}getTilePoint(o){return this.canonical.getTilePoint(new Yg(o.x-this.wrap,o.y))}}function tm(u,o,c,d,m){(u*=2)<0&&(u=-1*u-1);const b=1<<c;return(b*b*u+b*m+d).toString(36)+c.toString(36)+o.toString(36)}be("CanonicalTileID",z0),be("OverscaledTileID",ka,{omit:["posMatrix"]});class Fb{constructor(o,c,d,m=1,b=1,w=1,I=0){if(this.uid=o,c.height!==c.width)throw new RangeError("DEM tiles must be square");if(d&&!["mapbox","terrarium","custom"].includes(d))return void Ot(`"${d}" is not a valid encoding type. Valid types include "mapbox", "terrarium" and "custom".`);this.stride=c.height;const P=this.dim=c.height-2;switch(this.data=new Uint32Array(c.data.buffer),d){case"terrarium":this.redFactor=256,this.greenFactor=1,this.blueFactor=1/256,this.baseShift=32768;break;case"custom":this.redFactor=m,this.greenFactor=b,this.blueFactor=w,this.baseShift=I;break;default:this.redFactor=6553.6,this.greenFactor=25.6,this.blueFactor=.1,this.baseShift=1e4}for(let R=0;R<P;R++)this.data[this._idx(-1,R)]=this.data[this._idx(0,R)],this.data[this._idx(P,R)]=this.data[this._idx(P-1,R)],this.data[this._idx(R,-1)]=this.data[this._idx(R,0)],this.data[this._idx(R,P)]=this.data[this._idx(R,P-1)];this.data[this._idx(-1,-1)]=this.data[this._idx(0,0)],this.data[this._idx(P,-1)]=this.data[this._idx(P-1,0)],this.data[this._idx(-1,P)]=this.data[this._idx(0,P-1)],this.data[this._idx(P,P)]=this.data[this._idx(P-1,P-1)],this.min=Number.MAX_SAFE_INTEGER,this.max=Number.MIN_SAFE_INTEGER;for(let R=0;R<P;R++)for(let F=0;F<P;F++){const j=this.get(R,F);j>this.max&&(this.max=j),j<this.min&&(this.min=j)}}get(o,c){const d=new Uint8Array(this.data.buffer),m=4*this._idx(o,c);return this.unpack(d[m],d[m+1],d[m+2])}getUnpackVector(){return[this.redFactor,this.greenFactor,this.blueFactor,this.baseShift]}_idx(o,c){if(o<-1||o>=this.dim+1||c<-1||c>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(c+1)*this.stride+(o+1)}unpack(o,c,d){return o*this.redFactor+c*this.greenFactor+d*this.blueFactor-this.baseShift}getPixels(){return new Na({width:this.stride,height:this.stride},new Uint8Array(this.data.buffer))}backfillBorder(o,c,d){if(this.dim!==o.dim)throw new Error("dem dimension mismatch");let m=c*this.dim,b=c*this.dim+this.dim,w=d*this.dim,I=d*this.dim+this.dim;switch(c){case-1:m=b-1;break;case 1:b=m+1}switch(d){case-1:w=I-1;break;case 1:I=w+1}const P=-c*this.dim,R=-d*this.dim;for(let F=w;F<I;F++)for(let j=m;j<b;j++)this.data[this._idx(j,F)]=o.data[this._idx(j+P,F+R)]}}be("DEMData",Fb);class zb{constructor(o){this._stringToNumber={},this._numberToString=[];for(let c=0;c<o.length;c++){const d=o[c];this._stringToNumber[d]=c,this._numberToString[c]=d}}encode(o){return this._stringToNumber[o]}decode(o){if(o>=this._numberToString.length)throw new Error(`Out of bounds. Index requested n=${o} can't be >= this._numberToString.length ${this._numberToString.length}`);return this._numberToString[o]}}class Bb{constructor(o,c,d,m,b){this.type="Feature",this._vectorTileFeature=o,o._z=c,o._x=d,o._y=m,this.properties=o.properties,this.id=b}get geometry(){return this._geometry===void 0&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._vectorTileFeature._x,this._vectorTileFeature._y,this._vectorTileFeature._z).geometry),this._geometry}set geometry(o){this._geometry=o}toJSON(){const o={geometry:this.geometry};for(const c in this)c!=="_geometry"&&c!=="_vectorTileFeature"&&(o[c]=this[c]);return o}}class $b{constructor(o,c){this.tileID=o,this.x=o.canonical.x,this.y=o.canonical.y,this.z=o.canonical.z,this.grid=new ll(Oi,16,0),this.grid3D=new ll(Oi,16,0),this.featureIndexArray=new Qt,this.promoteId=c}insert(o,c,d,m,b,w){const I=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(d,m,b);const P=w?this.grid3D:this.grid;for(let R=0;R<c.length;R++){const F=c[R],j=[1/0,1/0,-1/0,-1/0];for(let Z=0;Z<F.length;Z++){const K=F[Z];j[0]=Math.min(j[0],K.x),j[1]=Math.min(j[1],K.y),j[2]=Math.max(j[2],K.x),j[3]=Math.max(j[3],K.y)}j[0]<Oi&&j[1]<Oi&&j[2]>=0&&j[3]>=0&&P.insert(I,j[0],j[1],j[2],j[3])}}loadVTLayers(){return this.vtLayers||(this.vtLayers=new Ch.VectorTile(new I0(this.rawTileData)).layers,this.sourceLayerCoder=new zb(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"])),this.vtLayers}query(o,c,d,m){this.loadVTLayers();const b=o.params||{},w=Oi/o.tileSize/o.scale,I=gh(b.filter),P=o.queryGeometry,R=o.queryPadding*w,F=jb(P),j=this.grid.query(F.minX-R,F.minY-R,F.maxX+R,F.maxY+R),Z=jb(o.cameraQueryGeometry),K=this.grid3D.query(Z.minX-R,Z.minY-R,Z.maxX+R,Z.maxY+R,(gt,_t,At,Tt)=>function(Rt,jt,Kt,Te,Oe){for(const xe of Rt)if(jt<=xe.x&&Kt<=xe.y&&Te>=xe.x&&Oe>=xe.y)return!0;const Se=[new A(jt,Kt),new A(jt,Oe),new A(Te,Oe),new A(Te,Kt)];if(Rt.length>2){for(const xe of Se)if(pd(Rt,xe))return!0}for(let xe=0;xe<Rt.length-1;xe++)if(RC(Rt[xe],Rt[xe+1],Se))return!0;return!1}(o.cameraQueryGeometry,gt-R,_t-R,At+R,Tt+R));for(const gt of K)j.push(gt);j.sort(rP);const Q={};let at;for(let gt=0;gt<j.length;gt++){const _t=j[gt];if(_t===at)continue;at=_t;const At=this.featureIndexArray.get(_t);let Tt=null;this.loadMatchingFeature(Q,At.bucketIndex,At.sourceLayerIndex,At.featureIndex,I,b.layers,b.availableImages,c,d,m,(Rt,jt,Kt)=>(Tt||(Tt=wp(Rt)),jt.queryIntersectsFeature(P,Rt,Kt,Tt,this.z,o.transform,w,o.pixelPosMatrix)))}return Q}loadMatchingFeature(o,c,d,m,b,w,I,P,R,F,j){const Z=this.bucketLayerIDs[c];if(w&&!function(gt,_t){for(let At=0;At<gt.length;At++)if(_t.indexOf(gt[At])>=0)return!0;return!1}(w,Z))return;const K=this.sourceLayerCoder.decode(d),Q=this.vtLayers[K].feature(m);if(b.needGeometry){const gt=Ep(Q,!0);if(!b.filter(new On(this.tileID.overscaledZ),gt,this.tileID.canonical))return}else if(!b.filter(new On(this.tileID.overscaledZ),Q))return;const at=this.getId(Q,K);for(let gt=0;gt<Z.length;gt++){const _t=Z[gt];if(w&&w.indexOf(_t)<0)continue;const At=P[_t];if(!At)continue;let Tt={};at&&F&&(Tt=F.getState(At.sourceLayer||"_geojsonTileLayer",at));const Rt=et({},R[_t]);Rt.paint=Ub(Rt.paint,At.paint,Q,Tt,I),Rt.layout=Ub(Rt.layout,At.layout,Q,Tt,I);const jt=!j||j(Q,At,Tt);if(!jt)continue;const Kt=new Bb(Q,this.z,this.x,this.y,at);Kt.layer=Rt;let Te=o[_t];Te===void 0&&(Te=o[_t]=[]),Te.push({featureIndex:m,feature:Kt,intersectionZ:jt})}}lookupSymbolFeatures(o,c,d,m,b,w,I,P){const R={};this.loadVTLayers();const F=gh(b);for(const j of o)this.loadMatchingFeature(R,d,m,j,F,w,I,P,c);return R}hasLayer(o){for(const c of this.bucketLayerIDs)for(const d of c)if(o===d)return!0;return!1}getId(o,c){let d=o.id;return this.promoteId&&(d=o.properties[typeof this.promoteId=="string"?this.promoteId:this.promoteId[c]],typeof d=="boolean"&&(d=Number(d))),d}}function Ub(u,o,c,d,m){return J(u,(b,w)=>{const I=o instanceof cd?o.get(w):null;return I&&I.evaluate?I.evaluate(c,d,m):I})}function jb(u){let o=1/0,c=1/0,d=-1/0,m=-1/0;for(const b of u)o=Math.min(o,b.x),c=Math.min(c,b.y),d=Math.max(d,b.x),m=Math.max(m,b.y);return{minX:o,minY:c,maxX:d,maxY:m}}function rP(u,o){return o-u}function Vb(u,o,c,d,m){const b=[];for(let w=0;w<u.length;w++){const I=u[w];let P;for(let R=0;R<I.length-1;R++){let F=I[R],j=I[R+1];F.x<o&&j.x<o||(F.x<o?F=new A(o,F.y+(o-F.x)/(j.x-F.x)*(j.y-F.y))._round():j.x<o&&(j=new A(o,F.y+(o-F.x)/(j.x-F.x)*(j.y-F.y))._round()),F.y<c&&j.y<c||(F.y<c?F=new A(F.x+(c-F.y)/(j.y-F.y)*(j.x-F.x),c)._round():j.y<c&&(j=new A(F.x+(c-F.y)/(j.y-F.y)*(j.x-F.x),c)._round()),F.x>=d&&j.x>=d||(F.x>=d?F=new A(d,F.y+(d-F.x)/(j.x-F.x)*(j.y-F.y))._round():j.x>=d&&(j=new A(d,F.y+(d-F.x)/(j.x-F.x)*(j.y-F.y))._round()),F.y>=m&&j.y>=m||(F.y>=m?F=new A(F.x+(m-F.y)/(j.y-F.y)*(j.x-F.x),m)._round():j.y>=m&&(j=new A(F.x+(m-F.y)/(j.y-F.y)*(j.x-F.x),m)._round()),P&&F.equals(P[P.length-1])||(P=[F],b.push(P)),P.push(j)))))}}return b}be("FeatureIndex",$b,{omit:["rawTileData","sourceLayerCoder"]});class Lh extends A{constructor(o,c,d,m){super(o,c),this.angle=d,m!==void 0&&(this.segment=m)}clone(){return new Lh(this.x,this.y,this.angle,this.segment)}}function Gb(u,o,c,d,m){if(o.segment===void 0||c===0)return!0;let b=o,w=o.segment+1,I=0;for(;I>-c/2;){if(w--,w<0)return!1;I-=u[w].dist(b),b=u[w]}I+=u[w].dist(u[w+1]),w++;const P=[];let R=0;for(;I<c/2;){const F=u[w],j=u[w+1];if(!j)return!1;let Z=u[w-1].angleTo(F)-F.angleTo(j);for(Z=Math.abs((Z+3*Math.PI)%(2*Math.PI)-Math.PI),P.push({distance:I,angleDelta:Z}),R+=Z;I-P[0].distance>d;)R-=P.shift().angleDelta;if(R>m)return!1;w++,I+=F.dist(j)}return!0}function qb(u){let o=0;for(let c=0;c<u.length-1;c++)o+=u[c].dist(u[c+1]);return o}function Zb(u,o,c){return u?.6*o*c:0}function Wb(u,o){return Math.max(u?u.right-u.left:0,o?o.right-o.left:0)}function nP(u,o,c,d,m,b){const w=Zb(c,m,b),I=Wb(c,d)*b;let P=0;const R=qb(u)/2;for(let F=0;F<u.length-1;F++){const j=u[F],Z=u[F+1],K=j.dist(Z);if(P+K>R){const Q=(R-P)/K,at=mo.number(j.x,Z.x,Q),gt=mo.number(j.y,Z.y,Q),_t=new Lh(at,gt,Z.angleTo(j),F);return _t._round(),!w||Gb(u,_t,I,w,o)?_t:void 0}P+=K}}function iP(u,o,c,d,m,b,w,I,P){const R=Zb(d,b,w),F=Wb(d,m),j=F*w,Z=u[0].x===0||u[0].x===P||u[0].y===0||u[0].y===P;return o-j<o/4&&(o=j+o/4),Xb(u,Z?o/2*I%o:(F/2+2*b)*w*I%o,o,R,c,j,Z,!1,P)}function Xb(u,o,c,d,m,b,w,I,P){const R=b/2,F=qb(u);let j=0,Z=o-c,K=[];for(let Q=0;Q<u.length-1;Q++){const at=u[Q],gt=u[Q+1],_t=at.dist(gt),At=gt.angleTo(at);for(;Z+c<j+_t;){Z+=c;const Tt=(Z-j)/_t,Rt=mo.number(at.x,gt.x,Tt),jt=mo.number(at.y,gt.y,Tt);if(Rt>=0&&Rt<P&&jt>=0&&jt<P&&Z-R>=0&&Z+R<=F){const Kt=new Lh(Rt,jt,At,Q);Kt._round(),d&&!Gb(u,Kt,b,d,m)||K.push(Kt)}}j+=_t}return I||K.length||w||(K=Xb(u,j/2,c,d,m,b,w,!0,P)),K}be("Anchor",Lh);const vd=Bs;function Hb(u,o,c,d){const m=[],b=u.image,w=b.pixelRatio,I=b.paddedRect.w-2*vd,P=b.paddedRect.h-2*vd,R=u.right-u.left,F=u.bottom-u.top,j=b.stretchX||[[0,I]],Z=b.stretchY||[[0,P]],K=(he,Ae)=>he+Ae[1]-Ae[0],Q=j.reduce(K,0),at=Z.reduce(K,0),gt=I-Q,_t=P-at;let At=0,Tt=Q,Rt=0,jt=at,Kt=0,Te=gt,Oe=0,Se=_t;if(b.content&&d){const he=b.content;At=Kg(j,0,he[0]),Rt=Kg(Z,0,he[1]),Tt=Kg(j,he[0],he[2]),jt=Kg(Z,he[1],he[3]),Kt=he[0]-At,Oe=he[1]-Rt,Te=he[2]-he[0]-Tt,Se=he[3]-he[1]-jt}const xe=(he,Ae,de,ie)=>{const qe=Jg(he.stretch-At,Tt,R,u.left),Be=Qg(he.fixed-Kt,Te,he.stretch,Q),wr=Jg(Ae.stretch-Rt,jt,F,u.top),zn=Qg(Ae.fixed-Oe,Se,Ae.stretch,at),Vn=Jg(de.stretch-At,Tt,R,u.left),ji=Qg(de.fixed-Kt,Te,de.stretch,Q),da=Jg(ie.stretch-Rt,jt,F,u.top),_s=Qg(ie.fixed-Oe,Se,ie.stretch,at),Fi=new A(qe,wr),vo=new A(Vn,wr),Oo=new A(Vn,da),vs=new A(qe,da),xs=new A(Be/w,zn/w),Vi=new A(ji/w,_s/w),Gi=o*Math.PI/180;if(Gi){const ts=Math.sin(Gi),$s=Math.cos(Gi),Us=[$s,-ts,ts,$s];Fi._matMult(Us),vo._matMult(Us),vs._matMult(Us),Oo._matMult(Us)}const Qo=he.stretch+he.fixed,bs=Ae.stretch+Ae.fixed;return{tl:Fi,tr:vo,bl:vs,br:Oo,tex:{x:b.paddedRect.x+vd+Qo,y:b.paddedRect.y+vd+bs,w:de.stretch+de.fixed-Qo,h:ie.stretch+ie.fixed-bs},writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:xs,pixelOffsetBR:Vi,minFontScaleX:Te/w/R,minFontScaleY:Se/w/F,isSDF:c}};if(d&&(b.stretchX||b.stretchY)){const he=Yb(j,gt,Q),Ae=Yb(Z,_t,at);for(let de=0;de<he.length-1;de++){const ie=he[de],qe=he[de+1];for(let Be=0;Be<Ae.length-1;Be++)m.push(xe(ie,Ae[Be],qe,Ae[Be+1]))}}else m.push(xe({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:I+1},{fixed:0,stretch:P+1}));return m}function Kg(u,o,c){let d=0;for(const m of u)d+=Math.max(o,Math.min(c,m[1]))-Math.max(o,Math.min(c,m[0]));return d}function Yb(u,o,c){const d=[{fixed:-vd,stretch:0}];for(const[m,b]of u){const w=d[d.length-1];d.push({fixed:m-w.stretch,stretch:w.stretch}),d.push({fixed:m-w.stretch,stretch:w.stretch+(b-m)})}return d.push({fixed:o+vd,stretch:c}),d}function Jg(u,o,c,d){return u/o*c+d}function Qg(u,o,c,d){return u-o*c/d}class ty{constructor(o,c,d,m,b,w,I,P,R,F){if(this.boxStartIndex=o.length,R){let j=w.top,Z=w.bottom;const K=w.collisionPadding;K&&(j-=K[1],Z+=K[3]);let Q=Z-j;Q>0&&(Q=Math.max(10,Q),this.circleDiameter=Q)}else{let j=w.top*I-P[0],Z=w.bottom*I+P[2],K=w.left*I-P[3],Q=w.right*I+P[1];const at=w.collisionPadding;if(at&&(K-=at[0]*I,j-=at[1]*I,Q+=at[2]*I,Z+=at[3]*I),F){const gt=new A(K,j),_t=new A(Q,j),At=new A(K,Z),Tt=new A(Q,Z),Rt=F*Math.PI/180;gt._rotate(Rt),_t._rotate(Rt),At._rotate(Rt),Tt._rotate(Rt),K=Math.min(gt.x,_t.x,At.x,Tt.x),Q=Math.max(gt.x,_t.x,At.x,Tt.x),j=Math.min(gt.y,_t.y,At.y,Tt.y),Z=Math.max(gt.y,_t.y,At.y,Tt.y)}o.emplaceBack(c.x,c.y,K,j,Q,Z,d,m,b)}this.boxEndIndex=o.length}}class oP{constructor(o=[],c=sP){if(this.data=o,this.length=this.data.length,this.compare=c,this.length>0)for(let d=(this.length>>1)-1;d>=0;d--)this._down(d)}push(o){this.data.push(o),this.length++,this._up(this.length-1)}pop(){if(this.length===0)return;const o=this.data[0],c=this.data.pop();return this.length--,this.length>0&&(this.data[0]=c,this._down(0)),o}peek(){return this.data[0]}_up(o){const{data:c,compare:d}=this,m=c[o];for(;o>0;){const b=o-1>>1,w=c[b];if(d(m,w)>=0)break;c[o]=w,o=b}c[o]=m}_down(o){const{data:c,compare:d}=this,m=this.length>>1,b=c[o];for(;o<m;){let w=1+(o<<1),I=c[w];const P=w+1;if(P<this.length&&d(c[P],I)<0&&(w=P,I=c[P]),d(I,b)>=0)break;c[o]=I,o=w}c[o]=b}}function sP(u,o){return u<o?-1:u>o?1:0}function aP(u,o=1,c=!1){let d=1/0,m=1/0,b=-1/0,w=-1/0;const I=u[0];for(let K=0;K<I.length;K++){const Q=I[K];(!K||Q.x<d)&&(d=Q.x),(!K||Q.y<m)&&(m=Q.y),(!K||Q.x>b)&&(b=Q.x),(!K||Q.y>w)&&(w=Q.y)}const P=Math.min(b-d,w-m);let R=P/2;const F=new oP([],lP);if(P===0)return new A(d,m);for(let K=d;K<b;K+=P)for(let Q=m;Q<w;Q+=P)F.push(new xd(K+R,Q+R,R,u));let j=function(K){let Q=0,at=0,gt=0;const _t=K[0];for(let At=0,Tt=_t.length,Rt=Tt-1;At<Tt;Rt=At++){const jt=_t[At],Kt=_t[Rt],Te=jt.x*Kt.y-Kt.x*jt.y;at+=(jt.x+Kt.x)*Te,gt+=(jt.y+Kt.y)*Te,Q+=3*Te}return new xd(at/Q,gt/Q,0,K)}(u),Z=F.length;for(;F.length;){const K=F.pop();(K.d>j.d||!j.d)&&(j=K,c&&console.log("found best %d after %d probes",Math.round(1e4*K.d)/1e4,Z)),K.max-j.d<=o||(R=K.h/2,F.push(new xd(K.p.x-R,K.p.y-R,R,u)),F.push(new xd(K.p.x+R,K.p.y-R,R,u)),F.push(new xd(K.p.x-R,K.p.y+R,R,u)),F.push(new xd(K.p.x+R,K.p.y+R,R,u)),Z+=4)}return c&&(console.log(`num probes: ${Z}`),console.log(`best distance: ${j.d}`)),j.p}function lP(u,o){return o.max-u.max}function xd(u,o,c,d){this.p=new A(u,o),this.h=c,this.d=function(m,b){let w=!1,I=1/0;for(let P=0;P<b.length;P++){const R=b[P];for(let F=0,j=R.length,Z=j-1;F<j;Z=F++){const K=R[F],Q=R[Z];K.y>m.y!=Q.y>m.y&&m.x<(Q.x-K.x)*(m.y-K.y)/(Q.y-K.y)+K.x&&(w=!w),I=Math.min(I,R1(m,K,Q))}}return(w?1:-1)*Math.sqrt(I)}(this.p,d),this.max=this.d+this.h*Math.SQRT2}var ko;a.aq=void 0,(ko=a.aq||(a.aq={}))[ko.center=1]="center",ko[ko.left=2]="left",ko[ko.right=3]="right",ko[ko.top=4]="top",ko[ko.bottom=5]="bottom",ko[ko["top-left"]=6]="top-left",ko[ko["top-right"]=7]="top-right",ko[ko["bottom-left"]=8]="bottom-left",ko[ko["bottom-right"]=9]="bottom-right";const Rh=7,B0=Number.POSITIVE_INFINITY;function Kb(u,o){return o[1]!==B0?function(c,d,m){let b=0,w=0;switch(d=Math.abs(d),m=Math.abs(m),c){case"top-right":case"top-left":case"top":w=m-Rh;break;case"bottom-right":case"bottom-left":case"bottom":w=-m+Rh}switch(c){case"top-right":case"bottom-right":case"right":b=-d;break;case"top-left":case"bottom-left":case"left":b=d}return[b,w]}(u,o[0],o[1]):function(c,d){let m=0,b=0;d<0&&(d=0);const w=d/Math.SQRT2;switch(c){case"top-right":case"top-left":b=w-Rh;break;case"bottom-right":case"bottom-left":b=-w+Rh;break;case"bottom":b=-d+Rh;break;case"top":b=d-Rh}switch(c){case"top-right":case"bottom-right":m=-w;break;case"top-left":case"bottom-left":m=w;break;case"left":m=d;break;case"right":m=-d}return[m,b]}(u,o[0])}function Jb(u,o,c){var d;const m=u.layout,b=(d=m.get("text-variable-anchor-offset"))===null||d===void 0?void 0:d.evaluate(o,{},c);if(b){const I=b.values,P=[];for(let R=0;R<I.length;R+=2){const F=P[R]=I[R],j=I[R+1].map(Z=>Z*Ui);F.startsWith("top")?j[1]-=Rh:F.startsWith("bottom")&&(j[1]+=Rh),P[R+1]=j}return new Ni(P)}const w=m.get("text-variable-anchor");if(w){let I;I=u._unevaluatedLayout.getValue("text-radial-offset")!==void 0?[m.get("text-radial-offset").evaluate(o,{},c)*Ui,B0]:m.get("text-offset").evaluate(o,{},c).map(R=>R*Ui);const P=[];for(const R of w)P.push(R,Kb(R,I));return new Ni(P)}return null}function $0(u){switch(u){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function uP(u,o,c,d,m,b,w,I,P,R,F){let j=b.textMaxSize.evaluate(o,{});j===void 0&&(j=w);const Z=u.layers[0].layout,K=Z.get("icon-offset").evaluate(o,{},F),Q=tw(c.horizontal),at=w/24,gt=u.tilePixelRatio*at,_t=u.tilePixelRatio*j/24,At=u.tilePixelRatio*I,Tt=u.tilePixelRatio*Z.get("symbol-spacing"),Rt=Z.get("text-padding")*u.tilePixelRatio,jt=function(ie,qe,Be,wr=1){const zn=ie.get("icon-padding").evaluate(qe,{},Be),Vn=zn&&zn.values;return[Vn[0]*wr,Vn[1]*wr,Vn[2]*wr,Vn[3]*wr]}(Z,o,F,u.tilePixelRatio),Kt=Z.get("text-max-angle")/180*Math.PI,Te=Z.get("text-rotation-alignment")!=="viewport"&&Z.get("symbol-placement")!=="point",Oe=Z.get("icon-rotation-alignment")==="map"&&Z.get("symbol-placement")!=="point",Se=Z.get("symbol-placement"),xe=Tt/2,he=Z.get("icon-text-fit");let Ae;d&&he!=="none"&&(u.allowVerticalPlacement&&c.vertical&&(Ae=wb(d,c.vertical,he,Z.get("icon-text-fit-padding"),K,at)),Q&&(d=wb(d,Q,he,Z.get("icon-text-fit-padding"),K,at)));const de=(ie,qe)=>{qe.x<0||qe.x>=Oi||qe.y<0||qe.y>=Oi||function(Be,wr,zn,Vn,ji,da,_s,Fi,vo,Oo,vs,xs,Vi,Gi,Qo,bs,ts,$s,Us,qi,Dr,es,Fo,Zi,fl){const Wl=Be.addToLineVertexArray(wr,zn);let Xl,xc,ml,Oa,js=0,bc=0,nm=0,iw=0,X0=-1,H0=-1;const wc={};let ow=gc("");if(Be.allowVerticalPlacement&&Vn.vertical){const rs=Fi.layout.get("text-rotate").evaluate(Dr,{},Zi)+90;ml=new ty(vo,wr,Oo,vs,xs,Vn.vertical,Vi,Gi,Qo,rs),_s&&(Oa=new ty(vo,wr,Oo,vs,xs,_s,ts,$s,Qo,rs))}if(ji){const rs=Fi.layout.get("icon-rotate").evaluate(Dr,{}),Fa=Fi.layout.get("icon-text-fit")!=="none",Tp=Hb(ji,rs,Fo,Fa),Yl=_s?Hb(_s,rs,Fo,Fa):void 0;xc=new ty(vo,wr,Oo,vs,xs,ji,ts,$s,!1,rs),js=4*Tp.length;const Ip=Be.iconSizeData;let Ru=null;Ip.kind==="source"?(Ru=[Lu*Fi.layout.get("icon-size").evaluate(Dr,{})],Ru[0]>Ph&&Ot(`${Be.layerIds[0]}: Value for "icon-size" is >= ${Qf}. Reduce your "icon-size".`)):Ip.kind==="composite"&&(Ru=[Lu*es.compositeIconSizes[0].evaluate(Dr,{},Zi),Lu*es.compositeIconSizes[1].evaluate(Dr,{},Zi)],(Ru[0]>Ph||Ru[1]>Ph)&&Ot(`${Be.layerIds[0]}: Value for "icon-size" is >= ${Qf}. Reduce your "icon-size".`)),Be.addSymbols(Be.icon,Tp,Ru,qi,Us,Dr,a.ai.none,wr,Wl.lineStartIndex,Wl.lineLength,-1,Zi),X0=Be.icon.placedSymbolArray.length-1,Yl&&(bc=4*Yl.length,Be.addSymbols(Be.icon,Yl,Ru,qi,Us,Dr,a.ai.vertical,wr,Wl.lineStartIndex,Wl.lineLength,-1,Zi),H0=Be.icon.placedSymbolArray.length-1)}const sw=Object.keys(Vn.horizontal);for(const rs of sw){const Fa=Vn.horizontal[rs];if(!Xl){ow=gc(Fa.text);const Yl=Fi.layout.get("text-rotate").evaluate(Dr,{},Zi);Xl=new ty(vo,wr,Oo,vs,xs,Fa,Vi,Gi,Qo,Yl)}const Tp=Fa.positionedLines.length===1;if(nm+=Qb(Be,wr,Fa,da,Fi,Qo,Dr,bs,Wl,Vn.vertical?a.ai.horizontal:a.ai.horizontalOnly,Tp?sw:[rs],wc,X0,es,Zi),Tp)break}Vn.vertical&&(iw+=Qb(Be,wr,Vn.vertical,da,Fi,Qo,Dr,bs,Wl,a.ai.vertical,["vertical"],wc,H0,es,Zi));const pP=Xl?Xl.boxStartIndex:Be.collisionBoxArray.length,dP=Xl?Xl.boxEndIndex:Be.collisionBoxArray.length,fP=ml?ml.boxStartIndex:Be.collisionBoxArray.length,mP=ml?ml.boxEndIndex:Be.collisionBoxArray.length,gP=xc?xc.boxStartIndex:Be.collisionBoxArray.length,yP=xc?xc.boxEndIndex:Be.collisionBoxArray.length,_P=Oa?Oa.boxStartIndex:Be.collisionBoxArray.length,vP=Oa?Oa.boxEndIndex:Be.collisionBoxArray.length;let Hl=-1;const ry=(rs,Fa)=>rs&&rs.circleDiameter?Math.max(rs.circleDiameter,Fa):Fa;Hl=ry(Xl,Hl),Hl=ry(ml,Hl),Hl=ry(xc,Hl),Hl=ry(Oa,Hl);const aw=Hl>-1?1:0;aw&&(Hl*=fl/Ui),Be.glyphOffsetArray.length>=_d.MAX_GLYPHS&&Ot("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),Dr.sortKey!==void 0&&Be.addToSortKeyRanges(Be.symbolInstances.length,Dr.sortKey);const xP=Jb(Fi,Dr,Zi),[bP,wP]=function(rs,Fa){const Tp=rs.length,Yl=Fa==null?void 0:Fa.values;if((Yl==null?void 0:Yl.length)>0)for(let Ip=0;Ip<Yl.length;Ip+=2){const Ru=Yl[Ip+1];rs.emplaceBack(a.aq[Yl[Ip]],Ru[0],Ru[1])}return[Tp,rs.length]}(Be.textAnchorOffsets,xP);Be.symbolInstances.emplaceBack(wr.x,wr.y,wc.right>=0?wc.right:-1,wc.center>=0?wc.center:-1,wc.left>=0?wc.left:-1,wc.vertical||-1,X0,H0,ow,pP,dP,fP,mP,gP,yP,_P,vP,Oo,nm,iw,js,bc,aw,0,Vi,Hl,bP,wP)}(u,qe,ie,c,d,m,Ae,u.layers[0],u.collisionBoxArray,o.index,o.sourceLayerIndex,u.index,gt,[Rt,Rt,Rt,Rt],Te,P,At,jt,Oe,K,o,b,R,F,w)};if(Se==="line")for(const ie of Vb(o.geometry,0,0,Oi,Oi)){const qe=iP(ie,Tt,Kt,c.vertical||Q,d,24,_t,u.overscaling,Oi);for(const Be of qe)Q&&cP(u,Q.text,xe,Be)||de(ie,Be)}else if(Se==="line-center"){for(const ie of o.geometry)if(ie.length>1){const qe=nP(ie,Kt,c.vertical||Q,d,24,_t);qe&&de(ie,qe)}}else if(o.type==="Polygon")for(const ie of _0(o.geometry,0)){const qe=aP(ie,16);de(ie[0],new Lh(qe.x,qe.y,0))}else if(o.type==="LineString")for(const ie of o.geometry)de(ie,new Lh(ie[0].x,ie[0].y,0));else if(o.type==="Point")for(const ie of o.geometry)for(const qe of ie)de([qe],new Lh(qe.x,qe.y,0))}function Qb(u,o,c,d,m,b,w,I,P,R,F,j,Z,K,Q){const at=function(At,Tt,Rt,jt,Kt,Te,Oe,Se){const xe=jt.layout.get("text-rotate").evaluate(Te,{})*Math.PI/180,he=[];for(const Ae of Tt.positionedLines)for(const de of Ae.positionedGlyphs){if(!de.rect)continue;const ie=de.rect||{};let qe=mb+1,Be=!0,wr=1,zn=0;const Vn=(Kt||Se)&&de.vertical,ji=de.metrics.advance*de.scale/2;if(Se&&Tt.verticalizable&&(zn=Ae.lineOffset/2-(de.imageName?-(Ui-de.metrics.width*de.scale)/2:(de.scale-1)*Ui)),de.imageName){const qi=Oe[de.imageName];Be=qi.sdf,wr=qi.pixelRatio,qe=Bs/wr}const da=Kt?[de.x+ji,de.y]:[0,0];let _s=Kt?[0,0]:[de.x+ji+Rt[0],de.y+Rt[1]-zn],Fi=[0,0];Vn&&(Fi=_s,_s=[0,0]);const vo=de.metrics.isDoubleResolution?2:1,Oo=(de.metrics.left-qe)*de.scale-ji+_s[0],vs=(-de.metrics.top-qe)*de.scale+_s[1],xs=Oo+ie.w/vo*de.scale/wr,Vi=vs+ie.h/vo*de.scale/wr,Gi=new A(Oo,vs),Qo=new A(xs,vs),bs=new A(Oo,Vi),ts=new A(xs,Vi);if(Vn){const qi=new A(-ji,ji-Kf),Dr=-Math.PI/2,es=Ui/2-ji,Fo=new A(5-Kf-es,-(de.imageName?es:0)),Zi=new A(...Fi);Gi._rotateAround(Dr,qi)._add(Fo)._add(Zi),Qo._rotateAround(Dr,qi)._add(Fo)._add(Zi),bs._rotateAround(Dr,qi)._add(Fo)._add(Zi),ts._rotateAround(Dr,qi)._add(Fo)._add(Zi)}if(xe){const qi=Math.sin(xe),Dr=Math.cos(xe),es=[Dr,-qi,qi,Dr];Gi._matMult(es),Qo._matMult(es),bs._matMult(es),ts._matMult(es)}const $s=new A(0,0),Us=new A(0,0);he.push({tl:Gi,tr:Qo,bl:bs,br:ts,tex:ie,writingMode:Tt.writingMode,glyphOffset:da,sectionIndex:de.sectionIndex,isSDF:Be,pixelOffsetTL:$s,pixelOffsetBR:Us,minFontScaleX:0,minFontScaleY:0})}return he}(0,c,I,m,b,w,d,u.allowVerticalPlacement),gt=u.textSizeData;let _t=null;gt.kind==="source"?(_t=[Lu*m.layout.get("text-size").evaluate(w,{})],_t[0]>Ph&&Ot(`${u.layerIds[0]}: Value for "text-size" is >= ${Qf}. Reduce your "text-size".`)):gt.kind==="composite"&&(_t=[Lu*K.compositeTextSizes[0].evaluate(w,{},Q),Lu*K.compositeTextSizes[1].evaluate(w,{},Q)],(_t[0]>Ph||_t[1]>Ph)&&Ot(`${u.layerIds[0]}: Value for "text-size" is >= ${Qf}. Reduce your "text-size".`)),u.addSymbols(u.text,at,_t,I,b,w,R,o,P.lineStartIndex,P.lineLength,Z,Q);for(const At of F)j[At]=u.text.placedSymbolArray.length-1;return 4*at.length}function tw(u){for(const o in u)return u[o];return null}function cP(u,o,c,d){const m=u.compareText;if(o in m){const b=m[o];for(let w=b.length-1;w>=0;w--)if(d.dist(b[w])<c)return!0}else m[o]=[];return m[o].push(d),!1}const ew=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array];class U0{static from(o){if(!(o instanceof ArrayBuffer))throw new Error("Data must be an instance of ArrayBuffer.");const[c,d]=new Uint8Array(o,0,2);if(c!==219)throw new Error("Data does not appear to be in a KDBush format.");const m=d>>4;if(m!==1)throw new Error(`Got v${m} data when expected v1.`);const b=ew[15&d];if(!b)throw new Error("Unrecognized array type.");const[w]=new Uint16Array(o,2,1),[I]=new Uint32Array(o,4,1);return new U0(I,w,b,o)}constructor(o,c=64,d=Float64Array,m){if(isNaN(o)||o<0)throw new Error(`Unpexpected numItems value: ${o}.`);this.numItems=+o,this.nodeSize=Math.min(Math.max(+c,2),65535),this.ArrayType=d,this.IndexArrayType=o<65536?Uint16Array:Uint32Array;const b=ew.indexOf(this.ArrayType),w=2*o*this.ArrayType.BYTES_PER_ELEMENT,I=o*this.IndexArrayType.BYTES_PER_ELEMENT,P=(8-I%8)%8;if(b<0)throw new Error(`Unexpected typed array class: ${d}.`);m&&m instanceof ArrayBuffer?(this.data=m,this.ids=new this.IndexArrayType(this.data,8,o),this.coords=new this.ArrayType(this.data,8+I+P,2*o),this._pos=2*o,this._finished=!0):(this.data=new ArrayBuffer(8+w+I+P),this.ids=new this.IndexArrayType(this.data,8,o),this.coords=new this.ArrayType(this.data,8+I+P,2*o),this._pos=0,this._finished=!1,new Uint8Array(this.data,0,2).set([219,16+b]),new Uint16Array(this.data,2,1)[0]=c,new Uint32Array(this.data,4,1)[0]=o)}add(o,c){const d=this._pos>>1;return this.ids[d]=d,this.coords[this._pos++]=o,this.coords[this._pos++]=c,d}finish(){const o=this._pos>>1;if(o!==this.numItems)throw new Error(`Added ${o} items when expected ${this.numItems}.`);return j0(this.ids,this.coords,this.nodeSize,0,this.numItems-1,0),this._finished=!0,this}range(o,c,d,m){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:b,coords:w,nodeSize:I}=this,P=[0,b.length-1,0],R=[];for(;P.length;){const F=P.pop()||0,j=P.pop()||0,Z=P.pop()||0;if(j-Z<=I){for(let gt=Z;gt<=j;gt++){const _t=w[2*gt],At=w[2*gt+1];_t>=o&&_t<=d&&At>=c&&At<=m&&R.push(b[gt])}continue}const K=Z+j>>1,Q=w[2*K],at=w[2*K+1];Q>=o&&Q<=d&&at>=c&&at<=m&&R.push(b[K]),(F===0?o<=Q:c<=at)&&(P.push(Z),P.push(K-1),P.push(1-F)),(F===0?d>=Q:m>=at)&&(P.push(K+1),P.push(j),P.push(1-F))}return R}within(o,c,d){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:m,coords:b,nodeSize:w}=this,I=[0,m.length-1,0],P=[],R=d*d;for(;I.length;){const F=I.pop()||0,j=I.pop()||0,Z=I.pop()||0;if(j-Z<=w){for(let gt=Z;gt<=j;gt++)nw(b[2*gt],b[2*gt+1],o,c)<=R&&P.push(m[gt]);continue}const K=Z+j>>1,Q=b[2*K],at=b[2*K+1];nw(Q,at,o,c)<=R&&P.push(m[K]),(F===0?o-d<=Q:c-d<=at)&&(I.push(Z),I.push(K-1),I.push(1-F)),(F===0?o+d>=Q:c+d>=at)&&(I.push(K+1),I.push(j),I.push(1-F))}return P}}function j0(u,o,c,d,m,b){if(m-d<=c)return;const w=d+m>>1;rw(u,o,w,d,m,b),j0(u,o,c,d,w-1,1-b),j0(u,o,c,w+1,m,1-b)}function rw(u,o,c,d,m,b){for(;m>d;){if(m-d>600){const R=m-d+1,F=c-d+1,j=Math.log(R),Z=.5*Math.exp(2*j/3),K=.5*Math.sqrt(j*Z*(R-Z)/R)*(F-R/2<0?-1:1);rw(u,o,c,Math.max(d,Math.floor(c-F*Z/R+K)),Math.min(m,Math.floor(c+(R-F)*Z/R+K)),b)}const w=o[2*c+b];let I=d,P=m;for(em(u,o,d,c),o[2*m+b]>w&&em(u,o,d,m);I<P;){for(em(u,o,I,P),I++,P--;o[2*I+b]<w;)I++;for(;o[2*P+b]>w;)P--}o[2*d+b]===w?em(u,o,d,P):(P++,em(u,o,P,m)),P<=c&&(d=P+1),c<=P&&(m=P-1)}}function em(u,o,c,d){V0(u,c,d),V0(o,2*c,2*d),V0(o,2*c+1,2*d+1)}function V0(u,o,c){const d=u[o];u[o]=u[c],u[c]=d}function nw(u,o,c,d){const m=u-c,b=o-d;return m*m+b*b}var G0;a.bh=void 0,(G0=a.bh||(a.bh={})).create="create",G0.load="load",G0.fullLoad="fullLoad";let ey=null,rm=[];const q0=1e3/60,Z0="loadTime",W0="fullLoadTime",hP={mark(u){performance.mark(u)},frame(u){const o=u;ey!=null&&rm.push(o-ey),ey=o},clearMetrics(){ey=null,rm=[],performance.clearMeasures(Z0),performance.clearMeasures(W0);for(const u in a.bh)performance.clearMarks(a.bh[u])},getPerformanceMetrics(){performance.measure(Z0,a.bh.create,a.bh.load),performance.measure(W0,a.bh.create,a.bh.fullLoad);const u=performance.getEntriesByName(Z0)[0].duration,o=performance.getEntriesByName(W0)[0].duration,c=rm.length,d=1/(rm.reduce((b,w)=>b+w,0)/c/1e3),m=rm.filter(b=>b>q0).reduce((b,w)=>b+(w-q0)/q0,0);return{loadTime:u,fullLoadTime:o,fps:d,percentDroppedFrames:m/(c+m)*100,totalFrames:c}}};a.$=function(u,o,c){var d,m,b,w,I,P,R,F,j,Z,K,Q,at=c[0],gt=c[1],_t=c[2];return o===u?(u[12]=o[0]*at+o[4]*gt+o[8]*_t+o[12],u[13]=o[1]*at+o[5]*gt+o[9]*_t+o[13],u[14]=o[2]*at+o[6]*gt+o[10]*_t+o[14],u[15]=o[3]*at+o[7]*gt+o[11]*_t+o[15]):(m=o[1],b=o[2],w=o[3],I=o[4],P=o[5],R=o[6],F=o[7],j=o[8],Z=o[9],K=o[10],Q=o[11],u[0]=d=o[0],u[1]=m,u[2]=b,u[3]=w,u[4]=I,u[5]=P,u[6]=R,u[7]=F,u[8]=j,u[9]=Z,u[10]=K,u[11]=Q,u[12]=d*at+I*gt+j*_t+o[12],u[13]=m*at+P*gt+Z*_t+o[13],u[14]=b*at+R*gt+K*_t+o[14],u[15]=w*at+F*gt+Q*_t+o[15]),u},a.A=dd,a.B=mo,a.C=class{constructor(u,o,c){this.receive=d=>{const m=d.data,b=m.id;if(b&&(!m.targetMapId||this.mapId===m.targetMapId))if(m.type==="<cancel>"){delete this.tasks[b];const w=this.cancelCallbacks[b];delete this.cancelCallbacks[b],w&&w()}else Me()||m.mustQueue?(this.tasks[b]=m,this.taskQueue.push(b),this.invoker.trigger()):this.processTask(b,m)},this.process=()=>{if(!this.taskQueue.length)return;const d=this.taskQueue.shift(),m=this.tasks[d];delete this.tasks[d],this.taskQueue.length&&this.invoker.trigger(),m&&this.processTask(d,m)},this.target=u,this.parent=o,this.mapId=c,this.callbacks={},this.tasks={},this.taskQueue=[],this.cancelCallbacks={},this.invoker=new eP(this.process),this.target.addEventListener("message",this.receive,!1),this.globalScope=Me()?u:window}send(u,o,c,d,m=!1){const b=Math.round(1e18*Math.random()).toString(36).substring(0,10);c&&(this.callbacks[b]=c);const w=[],I={id:b,type:u,hasCallback:!!c,targetMapId:d,mustQueue:m,sourceMapId:this.mapId,data:fs(o,w)};return this.target.postMessage(I,{transfer:w}),{cancel:()=>{c&&delete this.callbacks[b],this.target.postMessage({id:b,type:"<cancel>",targetMapId:d,sourceMapId:this.mapId})}}}processTask(u,o){if(o.type==="<response>"){const c=this.callbacks[u];delete this.callbacks[u],c&&(o.error?c(Da(o.error)):c(null,Da(o.data)))}else{let c=!1;const d=[],m=o.hasCallback?(I,P)=>{c=!0,delete this.cancelCallbacks[u];const R={id:u,type:"<response>",sourceMapId:this.mapId,error:I?fs(I):null,data:fs(P,d)};this.target.postMessage(R,{transfer:d})}:I=>{c=!0};let b=null;const w=Da(o.data);if(this.parent[o.type])b=this.parent[o.type](o.sourceMapId,w,m);else if("getWorkerSource"in this.parent){const I=o.type.split(".");b=this.parent.getWorkerSource(o.sourceMapId,I[0],w.source)[I[1]](w,m)}else m(new Error(`Could not find function ${o.type}`));!c&&b&&b.cancel&&(this.cancelCallbacks[u]=b.cancel)}}remove(){this.invoker.remove(),this.target.removeEventListener("message",this.receive,!1)}},a.D=je,a.E=Kr,a.F=function(u,o){const c={};for(let d=0;d<o.length;d++){const m=o[d];m in u&&(c[m]=u[m])}return c},a.G=Lb,a.H=Rb,a.I=M0,a.J=tt,a.K=$,a.L=Ah,a.M=kr,a.N=Oi,a.O=ka,a.P=A,a.Q=Wn,a.R=Na,a.S=Fn,a.T=Ag,a.U=Yg,a.V=class extends fc{},a.W=z0,a.X=function(u,o){const c=window.document.createElement("video");c.muted=!0,c.onloadstart=function(){o(null,c)};for(let d=0;d<u.length;d++){const m=window.document.createElement("source");cr(u[d])||(c.crossOrigin="Anonymous"),m.src=u[d],c.appendChild(m)}return{cancel:()=>{}}},a.Y=oe,a.Z=function(){var u=new dd(16);return dd!=Float32Array&&(u[1]=0,u[2]=0,u[3]=0,u[4]=0,u[6]=0,u[7]=0,u[8]=0,u[9]=0,u[11]=0,u[12]=0,u[13]=0,u[14]=0),u[0]=1,u[5]=1,u[10]=1,u[15]=1,u},a._=g,a.a=xr,a.a$=class extends H{},a.a0=function(u,o,c){var d=c[0],m=c[1],b=c[2];return u[0]=o[0]*d,u[1]=o[1]*d,u[2]=o[2]*d,u[3]=o[3]*d,u[4]=o[4]*m,u[5]=o[5]*m,u[6]=o[6]*m,u[7]=o[7]*m,u[8]=o[8]*b,u[9]=o[9]*b,u[10]=o[10]*b,u[11]=o[11]*b,u[12]=o[12],u[13]=o[13],u[14]=o[14],u[15]=o[15],u},a.a1=O1,a.a2=function(){return wt++},a.a3=ht,a.a4=_d,a.a5=function(){Fs.isLoading()||Fs.isLoaded()||Af()!=="deferred"||Pg()},a.a6=gh,a.a7=Ep,a.a8=On,a.a9=Bb,a.aA=yp,a.aB=function(u){u=u.slice();const o=Object.create(null);for(let c=0;c<u.length;c++)o[u[c].id]=u[c];for(let c=0;c<u.length;c++)"ref"in u[c]&&(u[c]=xi(u[c],o[u[c].ref]));return u},a.aC=function(u){if(u.type==="custom")return new tP(u);switch(u.type){case"background":return new KM(u);case"circle":return new kC(u);case"fill":return new eM(u);case"fill-extrusion":return new gM(u);case"heatmap":return new FC(u);case"hillshade":return new BC(u);case"line":return new SM(u);case"raster":return new QM(u);case"symbol":return new Hg(u)}},a.aD=$t,a.aE=function(u,o){if(!u)return[{command:yr.setStyle,args:[o]}];let c=[];try{if(!Or(u.version,o.version))return[{command:yr.setStyle,args:[o]}];Or(u.center,o.center)||c.push({command:yr.setCenter,args:[o.center]}),Or(u.zoom,o.zoom)||c.push({command:yr.setZoom,args:[o.zoom]}),Or(u.bearing,o.bearing)||c.push({command:yr.setBearing,args:[o.bearing]}),Or(u.pitch,o.pitch)||c.push({command:yr.setPitch,args:[o.pitch]}),Or(u.sprite,o.sprite)||c.push({command:yr.setSprite,args:[o.sprite]}),Or(u.glyphs,o.glyphs)||c.push({command:yr.setGlyphs,args:[o.glyphs]}),Or(u.transition,o.transition)||c.push({command:yr.setTransition,args:[o.transition]}),Or(u.light,o.light)||c.push({command:yr.setLight,args:[o.light]});const d={},m=[];(function(w,I,P,R){let F;for(F in I=I||{},w=w||{})Object.prototype.hasOwnProperty.call(w,F)&&(Object.prototype.hasOwnProperty.call(I,F)||Co(F,P,R));for(F in I)Object.prototype.hasOwnProperty.call(I,F)&&(Object.prototype.hasOwnProperty.call(w,F)?Or(w[F],I[F])||(w[F].type==="geojson"&&I[F].type==="geojson"&&ia(w,I,F)?P.push({command:yr.setGeoJSONSourceData,args:[F,I[F].data]}):ai(F,I,P,R)):ho(F,I,P))})(u.sources,o.sources,m,d);const b=[];u.layers&&u.layers.forEach(w=>{d[w.source]?c.push({command:yr.removeLayer,args:[w.id]}):b.push(w)}),c=c.concat(m),function(w,I,P){I=I||[];const R=(w=w||[]).map(Ji),F=I.map(Ji),j=w.reduce(hs,{}),Z=I.reduce(hs,{}),K=R.slice(),Q=Object.create(null);let at,gt,_t,At,Tt,Rt,jt;for(at=0,gt=0;at<R.length;at++)_t=R[at],Object.prototype.hasOwnProperty.call(Z,_t)?gt++:(P.push({command:yr.removeLayer,args:[_t]}),K.splice(K.indexOf(_t,gt),1));for(at=0,gt=0;at<F.length;at++)_t=F[F.length-1-at],K[K.length-1-at]!==_t&&(Object.prototype.hasOwnProperty.call(j,_t)?(P.push({command:yr.removeLayer,args:[_t]}),K.splice(K.lastIndexOf(_t,K.length-gt),1)):gt++,Rt=K[K.length-at],P.push({command:yr.addLayer,args:[Z[_t],Rt]}),K.splice(K.length-at,0,_t),Q[_t]=!0);for(at=0;at<F.length;at++)if(_t=F[at],At=j[_t],Tt=Z[_t],!Q[_t]&&!Or(At,Tt))if(Or(At.source,Tt.source)&&Or(At["source-layer"],Tt["source-layer"])&&Or(At.type,Tt.type)){for(jt in cs(At.layout,Tt.layout,P,_t,null,yr.setLayoutProperty),cs(At.paint,Tt.paint,P,_t,null,yr.setPaintProperty),Or(At.filter,Tt.filter)||P.push({command:yr.setFilter,args:[_t,Tt.filter]}),Or(At.minzoom,Tt.minzoom)&&Or(At.maxzoom,Tt.maxzoom)||P.push({command:yr.setLayerZoomRange,args:[_t,Tt.minzoom,Tt.maxzoom]}),At)Object.prototype.hasOwnProperty.call(At,jt)&&jt!=="layout"&&jt!=="paint"&&jt!=="filter"&&jt!=="metadata"&&jt!=="minzoom"&&jt!=="maxzoom"&&(jt.indexOf("paint.")===0?cs(At[jt],Tt[jt],P,_t,jt.slice(6),yr.setPaintProperty):Or(At[jt],Tt[jt])||P.push({command:yr.setLayerProperty,args:[_t,jt,Tt[jt]]}));for(jt in Tt)Object.prototype.hasOwnProperty.call(Tt,jt)&&!Object.prototype.hasOwnProperty.call(At,jt)&&jt!=="layout"&&jt!=="paint"&&jt!=="filter"&&jt!=="metadata"&&jt!=="minzoom"&&jt!=="maxzoom"&&(jt.indexOf("paint.")===0?cs(At[jt],Tt[jt],P,_t,jt.slice(6),yr.setPaintProperty):Or(At[jt],Tt[jt])||P.push({command:yr.setLayerProperty,args:[_t,jt,Tt[jt]]}))}else P.push({command:yr.removeLayer,args:[_t]}),Rt=K[K.lastIndexOf(_t)+1],P.push({command:yr.addLayer,args:[Tt,Rt]})}(b,o.layers,c)}catch(d){console.warn("Unable to compute style diff:",d),c=[{command:yr.setStyle,args:[o]}]}return c},a.aF=function(u){const o=[],c=u.id;return c===void 0&&o.push({message:`layers.${c}: missing required property "id"`}),u.render===void 0&&o.push({message:`layers.${c}: missing required method "render"`}),u.renderingMode&&u.renderingMode!=="2d"&&u.renderingMode!=="3d"&&o.push({message:`layers.${c}: property "renderingMode" must be either "2d" or "3d"`}),o},a.aG=function u(o,c){if(Array.isArray(o)){if(!Array.isArray(c)||o.length!==c.length)return!1;for(let d=0;d<o.length;d++)if(!u(o[d],c[d]))return!1;return!0}if(typeof o=="object"&&o!==null&&c!==null){if(typeof c!="object"||Object.keys(o).length!==Object.keys(c).length)return!1;for(const d in o)if(!u(o[d],c[d]))return!1;return!0}return o===c},a.aH=J,a.aI=xt,a.aJ=_p,a.aK=function(u){return u({pluginStatus:ms,pluginURL:Pu}),_p.on("pluginStateChange",u),u},a.aL=class extends yc{constructor(u,o){super(u,o),this.current=0}set(u){this.current!==u&&(this.current=u,this.gl.uniform1i(this.location,u))}},a.aM=hd,a.aN=class extends yc{constructor(u,o){super(u,o),this.current=s0}set(u){if(u[12]!==this.current[12]||u[0]!==this.current[0])return this.current=u,void this.gl.uniformMatrix4fv(this.location,!1,u);for(let o=1;o<16;o++)if(u[o]!==this.current[o]){this.current=u,this.gl.uniformMatrix4fv(this.location,!1,u);break}}},a.aO=Ng,a.aP=class extends yc{constructor(u,o){super(u,o),this.current=[0,0,0]}set(u){u[0]===this.current[0]&&u[1]===this.current[1]&&u[2]===this.current[2]||(this.current=u,this.gl.uniform3f(this.location,u[0],u[1],u[2]))}},a.aQ=class extends yc{constructor(u,o){super(u,o),this.current=[0,0]}set(u){u[0]===this.current[0]&&u[1]===this.current[1]||(this.current=u,this.gl.uniform2f(this.location,u[0],u[1]))}},a.aR=kg,a.aS=function(u,o,c,d,m,b,w){var I=1/(o-c),P=1/(d-m),R=1/(b-w);return u[0]=-2*I,u[1]=0,u[2]=0,u[3]=0,u[4]=0,u[5]=-2*P,u[6]=0,u[7]=0,u[8]=0,u[9]=0,u[10]=2*R,u[11]=0,u[12]=(o+c)*I,u[13]=(m+d)*P,u[14]=(w+b)*R,u[15]=1,u},a.aT=Qr,a.aU=NC,a.aV=class extends f{},a.aW=MM,a.aX=class extends x{},a.aY=function(u){return u<=1?1:Math.pow(2,Math.ceil(Math.log(u)/Math.LN2))},a.aZ=U1,a.a_=le,a.aa=function(u){const o={};if(u.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,(c,d,m,b)=>{const w=m||b;return o[d]=!w||w.toLowerCase(),""}),o["max-age"]){const c=parseInt(o["max-age"],10);isNaN(c)?delete o["max-age"]:o["max-age"]=c}return o},a.ab=function(u,o){const c=[];for(const d in u)d in o||c.push(d);return c},a.ac=function(u){if(ir==null){const o=u.navigator?u.navigator.userAgent:null;ir=!!u.safari||!(!o||!(/\b(iPad|iPhone|iPod)\b/.test(o)||o.match("Safari")&&!o.match("Chrome")))}return ir},a.ad=vt,a.ae=function(u,o,c){var d=Math.sin(c),m=Math.cos(c),b=o[0],w=o[1],I=o[2],P=o[3],R=o[4],F=o[5],j=o[6],Z=o[7];return o!==u&&(u[8]=o[8],u[9]=o[9],u[10]=o[10],u[11]=o[11],u[12]=o[12],u[13]=o[13],u[14]=o[14],u[15]=o[15]),u[0]=b*m+R*d,u[1]=w*m+F*d,u[2]=I*m+j*d,u[3]=P*m+Z*d,u[4]=R*m-b*d,u[5]=F*m-w*d,u[6]=j*m-I*d,u[7]=Z*m-P*d,u},a.af=function(u){var o=new dd(16);return o[0]=u[0],o[1]=u[1],o[2]=u[2],o[3]=u[3],o[4]=u[4],o[5]=u[5],o[6]=u[6],o[7]=u[7],o[8]=u[8],o[9]=u[9],o[10]=u[10],o[11]=u[11],o[12]=u[12],o[13]=u[13],o[14]=u[14],o[15]=u[15],o},a.ag=Bg,a.ah=function(u,o){let c=0,d=0;if(u.kind==="constant")d=u.layoutSize;else if(u.kind!=="source"){const{interpolationType:m,minZoom:b,maxZoom:w}=u,I=m?vt(Lo.interpolationFactor(m,o,b,w),0,1):0;u.kind==="camera"?d=mo.number(u.minSize,u.maxSize,I):c=I}return{uSizeT:c,uSize:d}},a.aj=function(u,{uSize:o,uSizeT:c},{lowerSize:d,upperSize:m}){return u.kind==="source"?d/Lu:u.kind==="composite"?mo.number(d/Lu,m/Lu,c):o},a.ak=R0,a.al=function(u,o,c,d){const m=o.y-u.y,b=o.x-u.x,w=d.y-c.y,I=d.x-c.x,P=w*b-I*m;if(P===0)return null;const R=(I*(u.y-c.y)-w*(u.x-c.x))/P;return new A(u.x+R*b,u.y+R*m)},a.am=Vb,a.an=A1,a.ao=h0,a.ap=Ui,a.ar=L0,a.as=function(u,o){var c=o[0],d=o[1],m=o[2],b=o[3],w=o[4],I=o[5],P=o[6],R=o[7],F=o[8],j=o[9],Z=o[10],K=o[11],Q=o[12],at=o[13],gt=o[14],_t=o[15],At=c*I-d*w,Tt=c*P-m*w,Rt=c*R-b*w,jt=d*P-m*I,Kt=d*R-b*I,Te=m*R-b*P,Oe=F*at-j*Q,Se=F*gt-Z*Q,xe=F*_t-K*Q,he=j*gt-Z*at,Ae=j*_t-K*at,de=Z*_t-K*gt,ie=At*de-Tt*Ae+Rt*he+jt*xe-Kt*Se+Te*Oe;return ie?(u[0]=(I*de-P*Ae+R*he)*(ie=1/ie),u[1]=(m*Ae-d*de-b*he)*ie,u[2]=(at*Te-gt*Kt+_t*jt)*ie,u[3]=(Z*Kt-j*Te-K*jt)*ie,u[4]=(P*xe-w*de-R*Se)*ie,u[5]=(c*de-m*xe+b*Se)*ie,u[6]=(gt*Rt-Q*Te-_t*Tt)*ie,u[7]=(F*Te-Z*Rt+K*Tt)*ie,u[8]=(w*Ae-I*xe+R*Oe)*ie,u[9]=(d*xe-c*Ae-b*Oe)*ie,u[10]=(Q*Kt-at*Rt+_t*At)*ie,u[11]=(j*Rt-F*Kt-K*At)*ie,u[12]=(I*Se-w*he-P*Oe)*ie,u[13]=(c*he-d*Se+m*Oe)*ie,u[14]=(at*Tt-Q*jt-gt*At)*ie,u[15]=(F*jt-j*Tt+Z*At)*ie,u):null},a.at=$0,a.au=A0,a.av=U0,a.aw=function(){const u={},o=Gt.$version;for(const c in Gt.$root){const d=Gt.$root[c];if(d.required){let m=null;m=c==="version"?o:d.type==="array"?[]:{},m!=null&&(u[c]=m)}}return u},a.ax=yr,a.ay=ql,a.az=hn,a.b=function(u,o){const c=new Blob([new Uint8Array(u)],{type:"image/png"});createImageBitmap(c).then(d=>{o(null,d)}).catch(d=>{o(new Error(`Could not load image because of ${d.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`))})},a.b0=yo,a.b1=function(u,o){var c=u[0],d=u[1],m=u[2],b=u[3],w=u[4],I=u[5],P=u[6],R=u[7],F=u[8],j=u[9],Z=u[10],K=u[11],Q=u[12],at=u[13],gt=u[14],_t=u[15],At=o[0],Tt=o[1],Rt=o[2],jt=o[3],Kt=o[4],Te=o[5],Oe=o[6],Se=o[7],xe=o[8],he=o[9],Ae=o[10],de=o[11],ie=o[12],qe=o[13],Be=o[14],wr=o[15];return Math.abs(c-At)<=ys*Math.max(1,Math.abs(c),Math.abs(At))&&Math.abs(d-Tt)<=ys*Math.max(1,Math.abs(d),Math.abs(Tt))&&Math.abs(m-Rt)<=ys*Math.max(1,Math.abs(m),Math.abs(Rt))&&Math.abs(b-jt)<=ys*Math.max(1,Math.abs(b),Math.abs(jt))&&Math.abs(w-Kt)<=ys*Math.max(1,Math.abs(w),Math.abs(Kt))&&Math.abs(I-Te)<=ys*Math.max(1,Math.abs(I),Math.abs(Te))&&Math.abs(P-Oe)<=ys*Math.max(1,Math.abs(P),Math.abs(Oe))&&Math.abs(R-Se)<=ys*Math.max(1,Math.abs(R),Math.abs(Se))&&Math.abs(F-xe)<=ys*Math.max(1,Math.abs(F),Math.abs(xe))&&Math.abs(j-he)<=ys*Math.max(1,Math.abs(j),Math.abs(he))&&Math.abs(Z-Ae)<=ys*Math.max(1,Math.abs(Z),Math.abs(Ae))&&Math.abs(K-de)<=ys*Math.max(1,Math.abs(K),Math.abs(de))&&Math.abs(Q-ie)<=ys*Math.max(1,Math.abs(Q),Math.abs(ie))&&Math.abs(at-qe)<=ys*Math.max(1,Math.abs(at),Math.abs(qe))&&Math.abs(gt-Be)<=ys*Math.max(1,Math.abs(gt),Math.abs(Be))&&Math.abs(_t-wr)<=ys*Math.max(1,Math.abs(_t),Math.abs(wr))},a.b2=function(u,o){return u[0]=o[0],u[1]=o[1],u[2]=o[2],u[3]=o[3],u[4]=o[4],u[5]=o[5],u[6]=o[6],u[7]=o[7],u[8]=o[8],u[9]=o[9],u[10]=o[10],u[11]=o[11],u[12]=o[12],u[13]=o[13],u[14]=o[14],u[15]=o[15],u},a.b3=function(u,o,c){return u[0]=o[0]*c[0],u[1]=o[1]*c[1],u[2]=o[2]*c[2],u[3]=o[3]*c[3],u},a.b4=function(u,o){return u[0]*o[0]+u[1]*o[1]+u[2]*o[2]+u[3]*o[3]},a.b5=ot,a.b6=Ob,a.b7=Db,a.b8=function(u,o,c,d,m){var b,w=1/Math.tan(o/2);return u[0]=w/c,u[1]=0,u[2]=0,u[3]=0,u[4]=0,u[5]=w,u[6]=0,u[7]=0,u[8]=0,u[9]=0,u[11]=-1,u[12]=0,u[13]=0,u[15]=0,m!=null&&m!==1/0?(u[10]=(m+d)*(b=1/(d-m)),u[14]=2*m*d*b):(u[10]=-1,u[14]=-2*d),u},a.b9=function(u,o,c){var d=Math.sin(c),m=Math.cos(c),b=o[4],w=o[5],I=o[6],P=o[7],R=o[8],F=o[9],j=o[10],Z=o[11];return o!==u&&(u[0]=o[0],u[1]=o[1],u[2]=o[2],u[3]=o[3],u[12]=o[12],u[13]=o[13],u[14]=o[14],u[15]=o[15]),u[4]=b*m+R*d,u[5]=w*m+F*d,u[6]=I*m+j*d,u[7]=P*m+Z*d,u[8]=R*m-b*d,u[9]=F*m-w*d,u[10]=j*m-I*d,u[11]=Z*m-P*d,u},a.bA=E,a.bB=lb,a.bC=fh,a.bD=Fs,a.ba=V,a.bb=it,a.bc=function(u,o){return u[0]=o[0],u[1]=0,u[2]=0,u[3]=0,u[4]=0,u[5]=o[1],u[6]=0,u[7]=0,u[8]=0,u[9]=0,u[10]=o[2],u[11]=0,u[12]=0,u[13]=0,u[14]=0,u[15]=1,u},a.bd=class extends bp{},a.be=O0,a.bf=Nb,a.bg=hP,a.bi=co,a.bj=function(u,o,c=!1){if(ms===Tf||ms===If||ms===Cf)throw new Error("setRTLTextPlugin cannot be called multiple times.");Pu=jr.resolveURL(u),ms=Tf,Mf=o,Pf(),c||Pg()},a.bk=Af,a.bl=function(u,o){const c={};for(let m=0;m<u.length;m++){const b=o&&o[u[m].id]||Gl(u[m]);o&&(o[u[m].id]=b);let w=c[b];w||(w=c[b]=[]),w.push(u[m])}const d=[];for(const m in c)d.push(c[m]);return d},a.bm=be,a.bn=zb,a.bo=$b,a.bp=yb,a.bq=function(u){u.bucket.createArrays(),u.bucket.tilePixelRatio=Oi/(512*u.bucket.overscaling),u.bucket.compareText={},u.bucket.iconsNeedLinear=!1;const o=u.bucket.layers[0],c=o.layout,d=o._unevaluatedLayout._values,m={layoutIconSize:d["icon-size"].possiblyEvaluate(new On(u.bucket.zoom+1),u.canonical),layoutTextSize:d["text-size"].possiblyEvaluate(new On(u.bucket.zoom+1),u.canonical),textMaxSize:d["text-size"].possiblyEvaluate(new On(18))};if(u.bucket.textSizeData.kind==="composite"){const{minZoom:R,maxZoom:F}=u.bucket.textSizeData;m.compositeTextSizes=[d["text-size"].possiblyEvaluate(new On(R),u.canonical),d["text-size"].possiblyEvaluate(new On(F),u.canonical)]}if(u.bucket.iconSizeData.kind==="composite"){const{minZoom:R,maxZoom:F}=u.bucket.iconSizeData;m.compositeIconSizes=[d["icon-size"].possiblyEvaluate(new On(R),u.canonical),d["icon-size"].possiblyEvaluate(new On(F),u.canonical)]}const b=c.get("text-line-height")*Ui,w=c.get("text-rotation-alignment")!=="viewport"&&c.get("symbol-placement")!=="point",I=c.get("text-keep-upright"),P=c.get("text-size");for(const R of u.bucket.features){const F=c.get("text-font").evaluate(R,{},u.canonical).join(","),j=P.evaluate(R,{},u.canonical),Z=m.layoutTextSize.evaluate(R,{},u.canonical),K=m.layoutIconSize.evaluate(R,{},u.canonical),Q={horizontal:{},vertical:void 0},at=R.text;let gt,_t=[0,0];if(at){const Rt=at.toString(),jt=c.get("text-letter-spacing").evaluate(R,{},u.canonical)*Ui,Kt=Cu(Rt)?jt:0,Te=c.get("text-anchor").evaluate(R,{},u.canonical),Oe=Jb(o,R,u.canonical);if(!Oe){const de=c.get("text-radial-offset").evaluate(R,{},u.canonical);_t=de?Kb(Te,[de*Ui,B0]):c.get("text-offset").evaluate(R,{},u.canonical).map(ie=>ie*Ui)}let Se=w?"center":c.get("text-justify").evaluate(R,{},u.canonical);const xe=c.get("symbol-placement"),he=xe==="point"?c.get("text-max-width").evaluate(R,{},u.canonical)*Ui:0,Ae=()=>{u.bucket.allowVerticalPlacement&&wh(Rt)&&(Q.vertical=Zg(at,u.glyphMap,u.glyphPositions,u.imagePositions,F,he,b,Te,"left",Kt,_t,a.ai.vertical,!0,xe,Z,j))};if(!w&&Oe){const de=new Set;if(Se==="auto")for(let qe=0;qe<Oe.values.length;qe+=2)de.add($0(Oe.values[qe]));else de.add(Se);let ie=!1;for(const qe of de)if(!Q.horizontal[qe])if(ie)Q.horizontal[qe]=Q.horizontal[0];else{const Be=Zg(at,u.glyphMap,u.glyphPositions,u.imagePositions,F,he,b,"center",qe,Kt,_t,a.ai.horizontal,!1,xe,Z,j);Be&&(Q.horizontal[qe]=Be,ie=Be.positionedLines.length===1)}Ae()}else{Se==="auto"&&(Se=$0(Te));const de=Zg(at,u.glyphMap,u.glyphPositions,u.imagePositions,F,he,b,Te,Se,Kt,_t,a.ai.horizontal,!1,xe,Z,j);de&&(Q.horizontal[Se]=de),Ae(),wh(Rt)&&w&&I&&(Q.vertical=Zg(at,u.glyphMap,u.glyphPositions,u.imagePositions,F,he,b,Te,Se,Kt,_t,a.ai.vertical,!1,xe,Z,j))}}let At=!1;if(R.icon&&R.icon.name){const Rt=u.imageMap[R.icon.name];Rt&&(gt=ZM(u.imagePositions[R.icon.name],c.get("icon-offset").evaluate(R,{},u.canonical),c.get("icon-anchor").evaluate(R,{},u.canonical)),At=!!Rt.sdf,u.bucket.sdfIcons===void 0?u.bucket.sdfIcons=At:u.bucket.sdfIcons!==At&&Ot("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(Rt.pixelRatio!==u.bucket.pixelRatio||c.get("icon-rotate").constantOr(1)!==0)&&(u.bucket.iconsNeedLinear=!0))}const Tt=tw(Q.horizontal)||Q.vertical;u.bucket.iconsInText=!!Tt&&Tt.iconsInText,(Tt||gt)&&uP(u.bucket,R,Q,gt,u.imageMap,m,Z,K,_t,At,u.canonical)}u.showCollisionBoxes&&u.bucket.generateCollisionDebugBuffers()},a.br=S0,a.bs=b0,a.bt=E0,a.bu=class{constructor(u){this._marks={start:[u.url,"start"].join("#"),end:[u.url,"end"].join("#"),measure:u.url.toString()},performance.mark(this._marks.start)}finish(){performance.mark(this._marks.end);let u=performance.getEntriesByName(this._marks.measure);return u.length===0&&(performance.measure(this._marks.measure,this._marks.start,this._marks.end),u=performance.getEntriesByName(this._marks.measure),performance.clearMarks(this._marks.start),performance.clearMarks(this._marks.end),performance.clearMeasures(this._marks.measure)),u}},a.bv=I0,a.bw=Ch,a.bx=function(u,o,c,d,m){return g(this,void 0,void 0,function*(){if($())try{return yield kr(u,o,c,d,m)}catch{}return function(b,w,I,P,R){const F=b.width,j=b.height;vr&&ue||(vr=new OffscreenCanvas(F,j),ue=vr.getContext("2d",{willReadFrequently:!0})),vr.width=F,vr.height=j,ue.drawImage(b,0,0,F,j);const Z=ue.getImageData(w,I,P,R);return ue.clearRect(0,0,F,j),Z.data}(u,o,c,d,m)})},a.by=Fb,a.bz=_,a.c=ln,a.d=function(u,o){const c=new Image;c.onload=()=>{o(null,c),URL.revokeObjectURL(c.src),c.onload=null,window.requestAnimationFrame(()=>{c.src=_r})},c.onerror=()=>o(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));const d=new Blob([new Uint8Array(u)],{type:"image/png"});c.src=u.byteLength?URL.createObjectURL(d):_r},a.e=et,a.f=function(u,o){return ls(et(u,{type:"json"}),o)},a.g=Ye,a.h=jr,a.i=Me,a.j=_i,a.k=us,a.l=Io,a.m=ls,a.n=function(u){return new I0(u).readFields($M,[])},a.o=function(u,o,c){if(!u.length)return c(null,[]);let d=u.length;const m=new Array(u.length);let b=null;u.forEach((w,I)=>{o(w,(P,R)=>{P&&(b=P),m[I]=R,--d==0&&c(b,m)})})},a.p=gb,a.q=Vf,a.r=Ei,a.s=cr,a.t=yn,a.u=pe,a.v=Gt,a.w=Ot,a.x=ks,a.y=Ra,a.z=function([u,o,c]){return o+=90,o*=Math.PI/180,c*=Math.PI/180,{x:u*Math.cos(o)*Math.sin(c),y:u*Math.sin(o)*Math.sin(c),z:u*Math.cos(c)}}}),l(["./shared"],function(a){class g{constructor(q){this.keyCache={},q&&this.replace(q)}replace(q){this._layerConfigs={},this._layers={},this.update(q,[])}update(q,X){for(const pt of q){this._layerConfigs[pt.id]=pt;const ft=this._layers[pt.id]=a.aC(pt);ft._featureFilter=a.a6(ft.filter),this.keyCache[pt.id]&&delete this.keyCache[pt.id]}for(const pt of X)delete this.keyCache[pt],delete this._layerConfigs[pt],delete this._layers[pt];this.familiesBySource={};const nt=a.bl(Object.values(this._layerConfigs),this.keyCache);for(const pt of nt){const ft=pt.map(Zt=>this._layers[Zt.id]),rt=ft[0];if(rt.visibility==="none")continue;const bt=rt.source||"";let mt=this.familiesBySource[bt];mt||(mt=this.familiesBySource[bt]={});const Et=rt.sourceLayer||"_geojsonTileLayer";let zt=mt[Et];zt||(zt=mt[Et]=[]),zt.push(ft)}}}class _{constructor(q){const X={},nt=[];for(const bt in q){const mt=q[bt],Et=X[bt]={};for(const zt in mt){const Zt=mt[+zt];if(!Zt||Zt.bitmap.width===0||Zt.bitmap.height===0)continue;const Ht={x:0,y:0,w:Zt.bitmap.width+2,h:Zt.bitmap.height+2};nt.push(Ht),Et[zt]={rect:Ht,metrics:Zt.metrics}}}const{w:pt,h:ft}=a.p(nt),rt=new a.q({width:pt||1,height:ft||1});for(const bt in q){const mt=q[bt];for(const Et in mt){const zt=mt[+Et];if(!zt||zt.bitmap.width===0||zt.bitmap.height===0)continue;const Zt=X[bt][Et].rect;a.q.copy(zt.bitmap,rt,{x:0,y:0},{x:Zt.x+1,y:Zt.y+1},zt.bitmap)}}this.image=rt,this.positions=X}}a.bm("GlyphAtlas",_);class E{constructor(q){this.tileID=new a.O(q.tileID.overscaledZ,q.tileID.wrap,q.tileID.canonical.z,q.tileID.canonical.x,q.tileID.canonical.y),this.uid=q.uid,this.zoom=q.zoom,this.pixelRatio=q.pixelRatio,this.tileSize=q.tileSize,this.source=q.source,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=q.showCollisionBoxes,this.collectResourceTiming=!!q.collectResourceTiming,this.returnDependencies=!!q.returnDependencies,this.promoteId=q.promoteId,this.inFlightDependencies=[],this.dependencySentinel=-1}parse(q,X,nt,pt,ft){this.status="parsing",this.data=q,this.collisionBoxArray=new a.a3;const rt=new a.bn(Object.keys(q.layers).sort()),bt=new a.bo(this.tileID,this.promoteId);bt.bucketLayerIDs=[];const mt={},Et={featureIndex:bt,iconDependencies:{},patternDependencies:{},glyphDependencies:{},availableImages:nt},zt=X.familiesBySource[this.source];for(const Fr in zt){const Lr=q.layers[Fr];if(!Lr)continue;Lr.version===1&&a.w(`Vector tile source "${this.source}" layer "${Fr}" does not use vector tile spec v2 and therefore may have some rendering errors.`);const Qi=rt.encode(Fr),dn=[];for(let li=0;li<Lr.length;li++){const bi=Lr.feature(li),ps=bt.getId(bi,Fr);dn.push({feature:bi,id:ps,index:li,sourceLayerIndex:Qi})}for(const li of zt[Fr]){const bi=li[0];bi.source!==this.source&&a.w(`layer.source = ${bi.source} does not equal this.source = ${this.source}`),bi.minzoom&&this.zoom<Math.floor(bi.minzoom)||bi.maxzoom&&this.zoom>=bi.maxzoom||bi.visibility!=="none"&&(S(li,this.zoom,nt),(mt[bi.id]=bi.createBucket({index:bt.bucketLayerIDs.length,layers:li,zoom:this.zoom,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:Qi,sourceID:this.source})).populate(dn,Et,this.tileID.canonical),bt.bucketLayerIDs.push(li.map(ps=>ps.id)))}}let Zt,Ht,De,Xe;const Ce=a.aH(Et.glyphDependencies,Fr=>Object.keys(Fr).map(Number));this.inFlightDependencies.forEach(Fr=>Fr==null?void 0:Fr.cancel()),this.inFlightDependencies=[];const Ue=++this.dependencySentinel;Object.keys(Ce).length?this.inFlightDependencies.push(pt.send("getGlyphs",{uid:this.uid,stacks:Ce,source:this.source,tileID:this.tileID,type:"glyphs"},(Fr,Lr)=>{Ue===this.dependencySentinel&&(Zt||(Zt=Fr,Ht=Lr,fr.call(this)))})):Ht={};const or=Object.keys(Et.iconDependencies);or.length?this.inFlightDependencies.push(pt.send("getImages",{icons:or,source:this.source,tileID:this.tileID,type:"icons"},(Fr,Lr)=>{Ue===this.dependencySentinel&&(Zt||(Zt=Fr,De=Lr,fr.call(this)))})):De={};const Jr=Object.keys(Et.patternDependencies);function fr(){if(Zt)return ft(Zt);if(Ht&&De&&Xe){const Fr=new _(Ht),Lr=new a.bp(De,Xe);for(const Qi in mt){const dn=mt[Qi];dn instanceof a.a4?(S(dn.layers,this.zoom,nt),a.bq({bucket:dn,glyphMap:Ht,glyphPositions:Fr.positions,imageMap:De,imagePositions:Lr.iconPositions,showCollisionBoxes:this.showCollisionBoxes,canonical:this.tileID.canonical})):dn.hasPattern&&(dn instanceof a.br||dn instanceof a.bs||dn instanceof a.bt)&&(S(dn.layers,this.zoom,nt),dn.addFeatures(Et,this.tileID.canonical,Lr.patternPositions))}this.status="done",ft(null,{buckets:Object.values(mt).filter(Qi=>!Qi.isEmpty()),featureIndex:bt,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:Fr.image,imageAtlas:Lr,glyphMap:this.returnDependencies?Ht:null,iconMap:this.returnDependencies?De:null,glyphPositions:this.returnDependencies?Fr.positions:null})}}Jr.length?this.inFlightDependencies.push(pt.send("getImages",{icons:Jr,source:this.source,tileID:this.tileID,type:"patterns"},(Fr,Lr)=>{Ue===this.dependencySentinel&&(Zt||(Zt=Fr,Xe=Lr,fr.call(this)))})):Xe={},fr.call(this)}}function S(ct,q,X){const nt=new a.a8(q);for(const pt of ct)pt.recalculate(nt,X)}function A(ct,q){const X=a.l(ct.request,(nt,pt,ft,rt)=>{if(nt)q(nt);else if(pt)try{const bt=new a.bw.VectorTile(new a.bv(pt));q(null,{vectorTile:bt,rawData:pt,cacheControl:ft,expires:rt})}catch(bt){const mt=new Uint8Array(pt);let Et=`Unable to parse the tile at ${ct.request.url}, `;Et+=mt[0]===31&&mt[1]===139?"please make sure the data is not gzipped and that you have configured the relevant header in the server":`got error: ${bt.messge}`,q(new Error(Et))}});return()=>{X.cancel(),q()}}class O{constructor(q,X,nt,pt){this.actor=q,this.layerIndex=X,this.availableImages=nt,this.loadVectorData=pt||A,this.fetching={},this.loading={},this.loaded={}}loadTile(q,X){const nt=q.uid;this.loading||(this.loading={});const pt=!!(q&&q.request&&q.request.collectResourceTiming)&&new a.bu(q.request),ft=this.loading[nt]=new E(q);ft.abort=this.loadVectorData(q,(rt,bt)=>{if(delete this.loading[nt],rt||!bt)return ft.status="done",this.loaded[nt]=ft,X(rt);const mt=bt.rawData,Et={};bt.expires&&(Et.expires=bt.expires),bt.cacheControl&&(Et.cacheControl=bt.cacheControl);const zt={};if(pt){const Zt=pt.finish();Zt&&(zt.resourceTiming=JSON.parse(JSON.stringify(Zt)))}ft.vectorTile=bt.vectorTile,ft.parse(bt.vectorTile,this.layerIndex,this.availableImages,this.actor,(Zt,Ht)=>{if(delete this.fetching[nt],Zt||!Ht)return X(Zt);X(null,a.e({rawTileData:mt.slice(0)},Ht,Et,zt))}),this.loaded=this.loaded||{},this.loaded[nt]=ft,this.fetching[nt]={rawTileData:mt,cacheControl:Et,resourceTiming:zt}})}reloadTile(q,X){const nt=this.loaded,pt=q.uid;if(nt&&nt[pt]){const ft=nt[pt];ft.showCollisionBoxes=q.showCollisionBoxes,ft.status==="parsing"?ft.parse(ft.vectorTile,this.layerIndex,this.availableImages,this.actor,(rt,bt)=>{if(rt||!bt)return X(rt,bt);let mt;if(this.fetching[pt]){const{rawTileData:Et,cacheControl:zt,resourceTiming:Zt}=this.fetching[pt];delete this.fetching[pt],mt=a.e({rawTileData:Et.slice(0)},bt,zt,Zt)}else mt=bt;X(null,mt)}):ft.status==="done"&&(ft.vectorTile?ft.parse(ft.vectorTile,this.layerIndex,this.availableImages,this.actor,X):X())}}abortTile(q,X){const nt=this.loading,pt=q.uid;nt&&nt[pt]&&nt[pt].abort&&(nt[pt].abort(),delete nt[pt]),X()}removeTile(q,X){const nt=this.loaded,pt=q.uid;nt&&nt[pt]&&delete nt[pt],X()}}class k{constructor(){this.loaded={}}loadTile(q,X){return a._(this,void 0,void 0,function*(){const{uid:nt,encoding:pt,rawImageData:ft,redFactor:rt,greenFactor:bt,blueFactor:mt,baseShift:Et}=q,zt=ft.width+2,Zt=ft.height+2,Ht=a.a(ft)?new a.R({width:zt,height:Zt},yield a.bx(ft,-1,-1,zt,Zt)):ft,De=new a.by(nt,Ht,pt,rt,bt,mt,Et);this.loaded=this.loaded||{},this.loaded[nt]=De,X(null,De)})}removeTile(q){const X=this.loaded,nt=q.uid;X&&X[nt]&&delete X[nt]}}function G(ct,q){if(ct.length!==0){W(ct[0],q);for(var X=1;X<ct.length;X++)W(ct[X],!q)}}function W(ct,q){for(var X=0,nt=0,pt=0,ft=ct.length,rt=ft-1;pt<ft;rt=pt++){var bt=(ct[pt][0]-ct[rt][0])*(ct[rt][1]+ct[pt][1]),mt=X+bt;nt+=Math.abs(X)>=Math.abs(bt)?X-mt+bt:bt-mt+X,X=mt}X+nt>=0!=!!q&&ct.reverse()}var U=a.bz(function ct(q,X){var nt,pt=q&&q.type;if(pt==="FeatureCollection")for(nt=0;nt<q.features.length;nt++)ct(q.features[nt],X);else if(pt==="GeometryCollection")for(nt=0;nt<q.geometries.length;nt++)ct(q.geometries[nt],X);else if(pt==="Feature")ct(q.geometry,X);else if(pt==="Polygon")G(q.coordinates,X);else if(pt==="MultiPolygon")for(nt=0;nt<q.coordinates.length;nt++)G(q.coordinates[nt],X);return q});const tt=a.bw.VectorTileFeature.prototype.toGeoJSON;var $={exports:{}},V=a.bA,it=a.bw.VectorTileFeature,vt=ot;function ot(ct,q){this.options=q||{},this.features=ct,this.length=ct.length}function et(ct,q){this.id=typeof ct.id=="number"?ct.id:void 0,this.type=ct.type,this.rawGeometry=ct.type===1?[ct.geometry]:ct.geometry,this.properties=ct.tags,this.extent=q||4096}ot.prototype.feature=function(ct){return new et(this.features[ct],this.options.extent)},et.prototype.loadGeometry=function(){var ct=this.rawGeometry;this.geometry=[];for(var q=0;q<ct.length;q++){for(var X=ct[q],nt=[],pt=0;pt<X.length;pt++)nt.push(new V(X[pt][0],X[pt][1]));this.geometry.push(nt)}return this.geometry},et.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var ct=this.geometry,q=1/0,X=-1/0,nt=1/0,pt=-1/0,ft=0;ft<ct.length;ft++)for(var rt=ct[ft],bt=0;bt<rt.length;bt++){var mt=rt[bt];q=Math.min(q,mt.x),X=Math.max(X,mt.x),nt=Math.min(nt,mt.y),pt=Math.max(pt,mt.y)}return[q,nt,X,pt]},et.prototype.toGeoJSON=it.prototype.toGeoJSON;var wt=a.bB,J=vt;function xt(ct){var q=new wt;return function(X,nt){for(var pt in X.layers)nt.writeMessage(3,$t,X.layers[pt])}(ct,q),q.finish()}function $t(ct,q){var X;q.writeVarintField(15,ct.version||1),q.writeStringField(1,ct.name||""),q.writeVarintField(5,ct.extent||4096);var nt={keys:[],values:[],keycache:{},valuecache:{}};for(X=0;X<ct.length;X++)nt.feature=ct.feature(X),q.writeMessage(2,Ut,nt);var pt=nt.keys;for(X=0;X<pt.length;X++)q.writeStringField(3,pt[X]);var ft=nt.values;for(X=0;X<ft.length;X++)q.writeMessage(4,ir,ft[X])}function Ut(ct,q){var X=ct.feature;X.id!==void 0&&q.writeVarintField(1,X.id),q.writeMessage(2,Ot,ct),q.writeVarintField(3,X.type),q.writeMessage(4,Me,X)}function Ot(ct,q){var X=ct.feature,nt=ct.keys,pt=ct.values,ft=ct.keycache,rt=ct.valuecache;for(var bt in X.properties){var mt=X.properties[bt],Et=ft[bt];if(mt!==null){Et===void 0&&(nt.push(bt),ft[bt]=Et=nt.length-1),q.writeVarint(Et);var zt=typeof mt;zt!=="string"&&zt!=="boolean"&&zt!=="number"&&(mt=JSON.stringify(mt));var Zt=zt+":"+mt,Ht=rt[Zt];Ht===void 0&&(pt.push(mt),rt[Zt]=Ht=pt.length-1),q.writeVarint(Ht)}}}function te(ct,q){return(q<<3)+(7&ct)}function ye(ct){return ct<<1^ct>>31}function Me(ct,q){for(var X=ct.loadGeometry(),nt=ct.type,pt=0,ft=0,rt=X.length,bt=0;bt<rt;bt++){var mt=X[bt],Et=1;nt===1&&(Et=mt.length),q.writeVarint(te(1,Et));for(var zt=nt===3?mt.length-1:mt.length,Zt=0;Zt<zt;Zt++){Zt===1&&nt!==1&&q.writeVarint(te(2,zt-1));var Ht=mt[Zt].x-pt,De=mt[Zt].y-ft;q.writeVarint(ye(Ht)),q.writeVarint(ye(De)),pt+=Ht,ft+=De}nt===3&&q.writeVarint(te(7,1))}}function ir(ct,q){var X=typeof ct;X==="string"?q.writeStringField(1,ct):X==="boolean"?q.writeBooleanField(7,ct):X==="number"&&(ct%1!=0?q.writeDoubleField(3,ct):ct<0?q.writeSVarintField(6,ct):q.writeVarintField(5,ct))}$.exports=xt,$.exports.fromVectorTileJs=xt,$.exports.fromGeojsonVt=function(ct,q){q=q||{};var X={};for(var nt in ct)X[nt]=new J(ct[nt].features,q),X[nt].name=nt,X[nt].version=q.version,X[nt].extent=q.extent;return xt({layers:X})},$.exports.GeoJSONWrapper=J;var xr=a.bz($.exports);const _r={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:ct=>ct},kr=Math.fround||(vr=new Float32Array(1),ct=>(vr[0]=+ct,vr[0]));var vr;const ue=3,nr=5,br=6;class jr{constructor(q){this.options=Object.assign(Object.create(_r),q),this.trees=new Array(this.options.maxZoom+1),this.stride=this.options.reduce?7:6,this.clusterProps=[]}load(q){const{log:X,minZoom:nt,maxZoom:pt}=this.options;X&&console.time("total time");const ft=`prepare ${q.length} points`;X&&console.time(ft),this.points=q;const rt=[];for(let mt=0;mt<q.length;mt++){const Et=q[mt];if(!Et.geometry)continue;const[zt,Zt]=Et.geometry.coordinates,Ht=kr(hn(zt)),De=kr(Ye(Zt));rt.push(Ht,De,1/0,mt,-1,1),this.options.reduce&&rt.push(0)}let bt=this.trees[pt+1]=this._createTree(rt);X&&console.timeEnd(ft);for(let mt=pt;mt>=nt;mt--){const Et=+Date.now();bt=this.trees[mt]=this._createTree(this._cluster(bt,mt)),X&&console.log("z%d: %d clusters in %dms",mt,bt.numItems,+Date.now()-Et)}return X&&console.timeEnd("total time"),this}getClusters(q,X){let nt=((q[0]+180)%360+360)%360-180;const pt=Math.max(-90,Math.min(90,q[1]));let ft=q[2]===180?180:((q[2]+180)%360+360)%360-180;const rt=Math.max(-90,Math.min(90,q[3]));if(q[2]-q[0]>=360)nt=-180,ft=180;else if(nt>ft){const Zt=this.getClusters([nt,pt,180,rt],X),Ht=this.getClusters([-180,pt,ft,rt],X);return Zt.concat(Ht)}const bt=this.trees[this._limitZoom(X)],mt=bt.range(hn(nt),Ye(rt),hn(ft),Ye(pt)),Et=bt.data,zt=[];for(const Zt of mt){const Ht=this.stride*Zt;zt.push(Et[Ht+nr]>1?ln(Et,Ht,this.clusterProps):this.points[Et[Ht+ue]])}return zt}getChildren(q){const X=this._getOriginId(q),nt=this._getOriginZoom(q),pt="No cluster with the specified id.",ft=this.trees[nt];if(!ft)throw new Error(pt);const rt=ft.data;if(X*this.stride>=rt.length)throw new Error(pt);const bt=this.options.radius/(this.options.extent*Math.pow(2,nt-1)),mt=ft.within(rt[X*this.stride],rt[X*this.stride+1],bt),Et=[];for(const zt of mt){const Zt=zt*this.stride;rt[Zt+4]===q&&Et.push(rt[Zt+nr]>1?ln(rt,Zt,this.clusterProps):this.points[rt[Zt+ue]])}if(Et.length===0)throw new Error(pt);return Et}getLeaves(q,X,nt){const pt=[];return this._appendLeaves(pt,q,X=X||10,nt=nt||0,0),pt}getTile(q,X,nt){const pt=this.trees[this._limitZoom(q)],ft=Math.pow(2,q),{extent:rt,radius:bt}=this.options,mt=bt/rt,Et=(nt-mt)/ft,zt=(nt+1+mt)/ft,Zt={features:[]};return this._addTileFeatures(pt.range((X-mt)/ft,Et,(X+1+mt)/ft,zt),pt.data,X,nt,ft,Zt),X===0&&this._addTileFeatures(pt.range(1-mt/ft,Et,1,zt),pt.data,ft,nt,ft,Zt),X===ft-1&&this._addTileFeatures(pt.range(0,Et,mt/ft,zt),pt.data,-1,nt,ft,Zt),Zt.features.length?Zt:null}getClusterExpansionZoom(q){let X=this._getOriginZoom(q)-1;for(;X<=this.options.maxZoom;){const nt=this.getChildren(q);if(X++,nt.length!==1)break;q=nt[0].properties.cluster_id}return X}_appendLeaves(q,X,nt,pt,ft){const rt=this.getChildren(X);for(const bt of rt){const mt=bt.properties;if(mt&&mt.cluster?ft+mt.point_count<=pt?ft+=mt.point_count:ft=this._appendLeaves(q,mt.cluster_id,nt,pt,ft):ft<pt?ft++:q.push(bt),q.length===nt)break}return ft}_createTree(q){const X=new a.av(q.length/this.stride|0,this.options.nodeSize,Float32Array);for(let nt=0;nt<q.length;nt+=this.stride)X.add(q[nt],q[nt+1]);return X.finish(),X.data=q,X}_addTileFeatures(q,X,nt,pt,ft,rt){for(const bt of q){const mt=bt*this.stride,Et=X[mt+nr]>1;let zt,Zt,Ht;if(Et)zt=co(X,mt,this.clusterProps),Zt=X[mt],Ht=X[mt+1];else{const Ce=this.points[X[mt+ue]];zt=Ce.properties;const[Ue,or]=Ce.geometry.coordinates;Zt=hn(Ue),Ht=Ye(or)}const De={type:1,geometry:[[Math.round(this.options.extent*(Zt*ft-nt)),Math.round(this.options.extent*(Ht*ft-pt))]],tags:zt};let Xe;Xe=Et||this.options.generateId?X[mt+ue]:this.points[X[mt+ue]].id,Xe!==void 0&&(De.id=Xe),rt.features.push(De)}}_limitZoom(q){return Math.max(this.options.minZoom,Math.min(Math.floor(+q),this.options.maxZoom+1))}_cluster(q,X){const{radius:nt,extent:pt,reduce:ft,minPoints:rt}=this.options,bt=nt/(pt*Math.pow(2,X)),mt=q.data,Et=[],zt=this.stride;for(let Zt=0;Zt<mt.length;Zt+=zt){if(mt[Zt+2]<=X)continue;mt[Zt+2]=X;const Ht=mt[Zt],De=mt[Zt+1],Xe=q.within(mt[Zt],mt[Zt+1],bt),Ce=mt[Zt+nr];let Ue=Ce;for(const or of Xe){const Jr=or*zt;mt[Jr+2]>X&&(Ue+=mt[Jr+nr])}if(Ue>Ce&&Ue>=rt){let or,Jr=Ht*Ce,fr=De*Ce,Fr=-1;const Lr=((Zt/zt|0)<<5)+(X+1)+this.points.length;for(const Qi of Xe){const dn=Qi*zt;if(mt[dn+2]<=X)continue;mt[dn+2]=X;const li=mt[dn+nr];Jr+=mt[dn]*li,fr+=mt[dn+1]*li,mt[dn+4]=Lr,ft&&(or||(or=this._map(mt,Zt,!0),Fr=this.clusterProps.length,this.clusterProps.push(or)),ft(or,this._map(mt,dn)))}mt[Zt+4]=Lr,Et.push(Jr/Ue,fr/Ue,1/0,Lr,-1,Ue),ft&&Et.push(Fr)}else{for(let or=0;or<zt;or++)Et.push(mt[Zt+or]);if(Ue>1)for(const or of Xe){const Jr=or*zt;if(!(mt[Jr+2]<=X)){mt[Jr+2]=X;for(let fr=0;fr<zt;fr++)Et.push(mt[Jr+fr])}}}}return Et}_getOriginId(q){return q-this.points.length>>5}_getOriginZoom(q){return(q-this.points.length)%32}_map(q,X,nt){if(q[X+nr]>1){const rt=this.clusterProps[q[X+br]];return nt?Object.assign({},rt):rt}const pt=this.points[q[X+ue]].properties,ft=this.options.map(pt);return nt&&ft===pt?Object.assign({},ft):ft}}function ln(ct,q,X){return{type:"Feature",id:ct[q+ue],properties:co(ct,q,X),geometry:{type:"Point",coordinates:[(nt=ct[q],360*(nt-.5)),na(ct[q+1])]}};var nt}function co(ct,q,X){const nt=ct[q+nr],pt=nt>=1e4?`${Math.round(nt/1e3)}k`:nt>=1e3?Math.round(nt/100)/10+"k":nt,ft=ct[q+br],rt=ft===-1?{}:Object.assign({},X[ft]);return Object.assign(rt,{cluster:!0,cluster_id:ct[q+ue],point_count:nt,point_count_abbreviated:pt})}function hn(ct){return ct/360+.5}function Ye(ct){const q=Math.sin(ct*Math.PI/180),X=.5-.25*Math.log((1+q)/(1-q))/Math.PI;return X<0?0:X>1?1:X}function na(ct){const q=(180-360*ct)*Math.PI/180;return 360*Math.atan(Math.exp(q))/Math.PI-90}function ls(ct,q,X,nt){for(var pt,ft=nt,rt=X-q>>1,bt=X-q,mt=ct[q],Et=ct[q+1],zt=ct[X],Zt=ct[X+1],Ht=q+3;Ht<X;Ht+=3){var De=Io(ct[Ht],ct[Ht+1],mt,Et,zt,Zt);if(De>ft)pt=Ht,ft=De;else if(De===ft){var Xe=Math.abs(Ht-rt);Xe<bt&&(pt=Ht,bt=Xe)}}ft>nt&&(pt-q>3&&ls(ct,q,pt,nt),ct[pt+2]=ft,X-pt>3&&ls(ct,pt,X,nt))}function Io(ct,q,X,nt,pt,ft){var rt=pt-X,bt=ft-nt;if(rt!==0||bt!==0){var mt=((ct-X)*rt+(q-nt)*bt)/(rt*rt+bt*bt);mt>1?(X=pt,nt=ft):mt>0&&(X+=rt*mt,nt+=bt*mt)}return(rt=ct-X)*rt+(bt=q-nt)*bt}function cr(ct,q,X,nt){var pt={id:ct===void 0?null:ct,type:q,geometry:X,tags:nt,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};return function(ft){var rt=ft.geometry,bt=ft.type;if(bt==="Point"||bt==="MultiPoint"||bt==="LineString")pn(ft,rt);else if(bt==="Polygon"||bt==="MultiLineString")for(var mt=0;mt<rt.length;mt++)pn(ft,rt[mt]);else if(bt==="MultiPolygon")for(mt=0;mt<rt.length;mt++)for(var Et=0;Et<rt[mt].length;Et++)pn(ft,rt[mt][Et])}(pt),pt}function pn(ct,q){for(var X=0;X<q.length;X+=3)ct.minX=Math.min(ct.minX,q[X]),ct.minY=Math.min(ct.minY,q[X+1]),ct.maxX=Math.max(ct.maxX,q[X]),ct.maxY=Math.max(ct.maxY,q[X+1])}function Re(ct,q,X,nt){if(q.geometry){var pt=q.geometry.coordinates,ft=q.geometry.type,rt=Math.pow(X.tolerance/((1<<X.maxZoom)*X.extent),2),bt=[],mt=q.id;if(X.promoteId?mt=q.properties[X.promoteId]:X.generateId&&(mt=nt||0),ft==="Point")us(pt,bt);else if(ft==="MultiPoint")for(var Et=0;Et<pt.length;Et++)us(pt[Et],bt);else if(ft==="LineString")_i(pt,bt,rt,!1);else if(ft==="MultiLineString"){if(X.lineMetrics){for(Et=0;Et<pt.length;Et++)_i(pt[Et],bt=[],rt,!1),ct.push(cr(mt,"LineString",bt,q.properties));return}Kr(pt,bt,rt,!1)}else if(ft==="Polygon")Kr(pt,bt,rt,!0);else{if(ft!=="MultiPolygon"){if(ft==="GeometryCollection"){for(Et=0;Et<q.geometry.geometries.length;Et++)Re(ct,{id:mt,geometry:q.geometry.geometries[Et],properties:q.properties},X,nt);return}throw new Error("Input data is not a valid GeoJSON object.")}for(Et=0;Et<pt.length;Et++){var zt=[];Kr(pt[Et],zt,rt,!0),bt.push(zt)}}ct.push(cr(mt,ft,bt,q.properties))}}function us(ct,q){q.push(Gt(ct[0])),q.push(vi(ct[1])),q.push(0)}function _i(ct,q,X,nt){for(var pt,ft,rt=0,bt=0;bt<ct.length;bt++){var mt=Gt(ct[bt][0]),Et=vi(ct[bt][1]);q.push(mt),q.push(Et),q.push(0),bt>0&&(rt+=nt?(pt*Et-mt*ft)/2:Math.sqrt(Math.pow(mt-pt,2)+Math.pow(Et-ft,2))),pt=mt,ft=Et}var zt=q.length-3;q[2]=1,ls(q,0,zt,X),q[zt+2]=1,q.size=Math.abs(rt),q.start=0,q.end=q.size}function Kr(ct,q,X,nt){for(var pt=0;pt<ct.length;pt++){var ft=[];_i(ct[pt],ft,X,nt),q.push(ft)}}function Gt(ct){return ct/360+.5}function vi(ct){var q=Math.sin(ct*Math.PI/180),X=.5-.25*Math.log((1+q)/(1-q))/Math.PI;return X<0?0:X>1?1:X}function xi(ct,q,X,nt,pt,ft,rt,bt){if(nt/=q,ft>=(X/=q)&&rt<nt)return ct;if(rt<X||ft>=nt)return null;for(var mt=[],Et=0;Et<ct.length;Et++){var zt=ct[Et],Zt=zt.geometry,Ht=zt.type,De=pt===0?zt.minX:zt.minY,Xe=pt===0?zt.maxX:zt.maxY;if(De>=X&&Xe<nt)mt.push(zt);else if(!(Xe<X||De>=nt)){var Ce=[];if(Ht==="Point"||Ht==="MultiPoint")Or(Zt,Ce,X,nt,pt);else if(Ht==="LineString")yr(Zt,Ce,X,nt,pt,!1,bt.lineMetrics);else if(Ht==="MultiLineString")Co(Zt,Ce,X,nt,pt,!1);else if(Ht==="Polygon")Co(Zt,Ce,X,nt,pt,!0);else if(Ht==="MultiPolygon")for(var Ue=0;Ue<Zt.length;Ue++){var or=[];Co(Zt[Ue],or,X,nt,pt,!0),or.length&&Ce.push(or)}if(Ce.length){if(bt.lineMetrics&&Ht==="LineString"){for(Ue=0;Ue<Ce.length;Ue++)mt.push(cr(zt.id,Ht,Ce[Ue],zt.tags));continue}Ht!=="LineString"&&Ht!=="MultiLineString"||(Ce.length===1?(Ht="LineString",Ce=Ce[0]):Ht="MultiLineString"),Ht!=="Point"&&Ht!=="MultiPoint"||(Ht=Ce.length===3?"Point":"MultiPoint"),mt.push(cr(zt.id,Ht,Ce,zt.tags))}}}return mt.length?mt:null}function Or(ct,q,X,nt,pt){for(var ft=0;ft<ct.length;ft+=3){var rt=ct[ft+pt];rt>=X&&rt<=nt&&(q.push(ct[ft]),q.push(ct[ft+1]),q.push(ct[ft+2]))}}function yr(ct,q,X,nt,pt,ft,rt){for(var bt,mt,Et=ho(ct),zt=pt===0?ia:cs,Zt=ct.start,Ht=0;Ht<ct.length-3;Ht+=3){var De=ct[Ht],Xe=ct[Ht+1],Ce=ct[Ht+2],Ue=ct[Ht+3],or=ct[Ht+4],Jr=pt===0?De:Xe,fr=pt===0?Ue:or,Fr=!1;rt&&(bt=Math.sqrt(Math.pow(De-Ue,2)+Math.pow(Xe-or,2))),Jr<X?fr>X&&(mt=zt(Et,De,Xe,Ue,or,X),rt&&(Et.start=Zt+bt*mt)):Jr>nt?fr<nt&&(mt=zt(Et,De,Xe,Ue,or,nt),rt&&(Et.start=Zt+bt*mt)):ai(Et,De,Xe,Ce),fr<X&&Jr>=X&&(mt=zt(Et,De,Xe,Ue,or,X),Fr=!0),fr>nt&&Jr<=nt&&(mt=zt(Et,De,Xe,Ue,or,nt),Fr=!0),!ft&&Fr&&(rt&&(Et.end=Zt+bt*mt),q.push(Et),Et=ho(ct)),rt&&(Zt+=bt)}var Lr=ct.length-3;De=ct[Lr],Xe=ct[Lr+1],Ce=ct[Lr+2],(Jr=pt===0?De:Xe)>=X&&Jr<=nt&&ai(Et,De,Xe,Ce),Lr=Et.length-3,ft&&Lr>=3&&(Et[Lr]!==Et[0]||Et[Lr+1]!==Et[1])&&ai(Et,Et[0],Et[1],Et[2]),Et.length&&q.push(Et)}function ho(ct){var q=[];return q.size=ct.size,q.start=ct.start,q.end=ct.end,q}function Co(ct,q,X,nt,pt,ft){for(var rt=0;rt<ct.length;rt++)yr(ct[rt],q,X,nt,pt,ft,!1)}function ai(ct,q,X,nt){ct.push(q),ct.push(X),ct.push(nt)}function ia(ct,q,X,nt,pt,ft){var rt=(ft-q)/(nt-q);return ct.push(ft),ct.push(X+(pt-X)*rt),ct.push(1),rt}function cs(ct,q,X,nt,pt,ft){var rt=(ft-X)/(pt-X);return ct.push(q+(nt-q)*rt),ct.push(ft),ct.push(1),rt}function Ji(ct,q){for(var X=[],nt=0;nt<ct.length;nt++){var pt,ft=ct[nt],rt=ft.type;if(rt==="Point"||rt==="MultiPoint"||rt==="LineString")pt=hs(ft.geometry,q);else if(rt==="MultiLineString"||rt==="Polygon"){pt=[];for(var bt=0;bt<ft.geometry.length;bt++)pt.push(hs(ft.geometry[bt],q))}else if(rt==="MultiPolygon")for(pt=[],bt=0;bt<ft.geometry.length;bt++){for(var mt=[],Et=0;Et<ft.geometry[bt].length;Et++)mt.push(hs(ft.geometry[bt][Et],q));pt.push(mt)}X.push(cr(ft.id,rt,pt,ft.tags))}return X}function hs(ct,q){var X=[];X.size=ct.size,ct.start!==void 0&&(X.start=ct.start,X.end=ct.end);for(var nt=0;nt<ct.length;nt+=3)X.push(ct[nt]+q,ct[nt+1],ct[nt+2]);return X}function oe(ct,q){if(ct.transformed)return ct;var X,nt,pt,ft=1<<ct.z,rt=ct.x,bt=ct.y;for(X=0;X<ct.features.length;X++){var mt=ct.features[X],Et=mt.geometry,zt=mt.type;if(mt.geometry=[],zt===1)for(nt=0;nt<Et.length;nt+=2)mt.geometry.push(po(Et[nt],Et[nt+1],q,ft,rt,bt));else for(nt=0;nt<Et.length;nt++){var Zt=[];for(pt=0;pt<Et[nt].length;pt+=2)Zt.push(po(Et[nt][pt],Et[nt][pt+1],q,ft,rt,bt));mt.geometry.push(Zt)}}return ct.transformed=!0,ct}function po(ct,q,X,nt,pt,ft){return[Math.round(X*(ct*nt-pt)),Math.round(X*(q*nt-ft))]}function In(ct,q,X,nt,pt){for(var ft=q===pt.maxZoom?0:pt.tolerance/((1<<q)*pt.extent),rt={features:[],numPoints:0,numSimplified:0,numFeatures:0,source:null,x:X,y:nt,z:q,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0},bt=0;bt<ct.length;bt++){rt.numFeatures++,Ls(rt,ct[bt],ft,pt);var mt=ct[bt].minX,Et=ct[bt].minY,zt=ct[bt].maxX,Zt=ct[bt].maxY;mt<rt.minX&&(rt.minX=mt),Et<rt.minY&&(rt.minY=Et),zt>rt.maxX&&(rt.maxX=zt),Zt>rt.maxY&&(rt.maxY=Zt)}return rt}function Ls(ct,q,X,nt){var pt=q.geometry,ft=q.type,rt=[];if(ft==="Point"||ft==="MultiPoint")for(var bt=0;bt<pt.length;bt+=3)rt.push(pt[bt]),rt.push(pt[bt+1]),ct.numPoints++,ct.numSimplified++;else if(ft==="LineString")Ri(rt,pt,ct,X,!1,!1);else if(ft==="MultiLineString"||ft==="Polygon")for(bt=0;bt<pt.length;bt++)Ri(rt,pt[bt],ct,X,ft==="Polygon",bt===0);else if(ft==="MultiPolygon")for(var mt=0;mt<pt.length;mt++){var Et=pt[mt];for(bt=0;bt<Et.length;bt++)Ri(rt,Et[bt],ct,X,!0,bt===0)}if(rt.length){var zt=q.tags||null;if(ft==="LineString"&&nt.lineMetrics){for(var Zt in zt={},q.tags)zt[Zt]=q.tags[Zt];zt.mapbox_clip_start=pt.start/pt.size,zt.mapbox_clip_end=pt.end/pt.size}var Ht={geometry:rt,type:ft==="Polygon"||ft==="MultiPolygon"?3:ft==="LineString"||ft==="MultiLineString"?2:1,tags:zt};q.id!==null&&(Ht.id=q.id),ct.features.push(Ht)}}function Ri(ct,q,X,nt,pt,ft){var rt=nt*nt;if(nt>0&&q.size<(pt?rt:nt))X.numPoints+=q.length/3;else{for(var bt=[],mt=0;mt<q.length;mt+=3)(nt===0||q[mt+2]>rt)&&(X.numSimplified++,bt.push(q[mt]),bt.push(q[mt+1])),X.numPoints++;pt&&function(Et,zt){for(var Zt=0,Ht=0,De=Et.length,Xe=De-2;Ht<De;Xe=Ht,Ht+=2)Zt+=(Et[Ht]-Et[Xe])*(Et[Ht+1]+Et[Xe+1]);if(Zt>0===zt)for(Ht=0,De=Et.length;Ht<De/2;Ht+=2){var Ce=Et[Ht],Ue=Et[Ht+1];Et[Ht]=Et[De-2-Ht],Et[Ht+1]=Et[De-1-Ht],Et[De-2-Ht]=Ce,Et[De-1-Ht]=Ue}}(bt,ft),ct.push(bt)}}function ce(ct,q){var X=(q=this.options=function(pt,ft){for(var rt in ft)pt[rt]=ft[rt];return pt}(Object.create(this.options),q)).debug;if(X&&console.time("preprocess data"),q.maxZoom<0||q.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(q.promoteId&&q.generateId)throw new Error("promoteId and generateId cannot be used together.");var nt=function(pt,ft){var rt=[];if(pt.type==="FeatureCollection")for(var bt=0;bt<pt.features.length;bt++)Re(rt,pt.features[bt],ft,bt);else Re(rt,pt.type==="Feature"?pt:{geometry:pt},ft);return rt}(ct,q);this.tiles={},this.tileCoords=[],X&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",q.indexMaxZoom,q.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),nt=function(pt,ft){var rt=ft.buffer/ft.extent,bt=pt,mt=xi(pt,1,-1-rt,rt,0,-1,2,ft),Et=xi(pt,1,1-rt,2+rt,0,-1,2,ft);return(mt||Et)&&(bt=xi(pt,1,-rt,1+rt,0,-1,2,ft)||[],mt&&(bt=Ji(mt,1).concat(bt)),Et&&(bt=bt.concat(Ji(Et,-1)))),bt}(nt,q),nt.length&&this.splitTile(nt,0,0,0),X&&(nt.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}function ar(ct,q,X){return 32*((1<<ct)*X+q)+ct}function He(ct,q){return q?ct.properties[q]:ct.id}function Di(ct,q){if(ct==null)return!0;if(ct.type==="Feature")return He(ct,q)!=null;if(ct.type==="FeatureCollection"){const X=new Set;for(const nt of ct.features){const pt=He(nt,q);if(pt==null||X.has(pt))return!1;X.add(pt)}return!0}return!1}function fo(ct,q){const X=new Map;if(ct!=null)if(ct.type==="Feature")X.set(He(ct,q),ct);else for(const nt of ct.features)X.set(He(nt,q),nt);return X}ce.prototype.options={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0},ce.prototype.splitTile=function(ct,q,X,nt,pt,ft,rt){for(var bt=[ct,q,X,nt],mt=this.options,Et=mt.debug;bt.length;){nt=bt.pop(),X=bt.pop(),q=bt.pop(),ct=bt.pop();var zt=1<<q,Zt=ar(q,X,nt),Ht=this.tiles[Zt];if(!Ht&&(Et>1&&console.time("creation"),Ht=this.tiles[Zt]=In(ct,q,X,nt,mt),this.tileCoords.push({z:q,x:X,y:nt}),Et)){Et>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",q,X,nt,Ht.numFeatures,Ht.numPoints,Ht.numSimplified),console.timeEnd("creation"));var De="z"+q;this.stats[De]=(this.stats[De]||0)+1,this.total++}if(Ht.source=ct,pt){if(q===mt.maxZoom||q===pt)continue;var Xe=1<<pt-q;if(X!==Math.floor(ft/Xe)||nt!==Math.floor(rt/Xe))continue}else if(q===mt.indexMaxZoom||Ht.numPoints<=mt.indexMaxPoints)continue;if(Ht.source=null,ct.length!==0){Et>1&&console.time("clipping");var Ce,Ue,or,Jr,fr,Fr,Lr=.5*mt.buffer/mt.extent,Qi=.5-Lr,dn=.5+Lr,li=1+Lr;Ce=Ue=or=Jr=null,fr=xi(ct,zt,X-Lr,X+dn,0,Ht.minX,Ht.maxX,mt),Fr=xi(ct,zt,X+Qi,X+li,0,Ht.minX,Ht.maxX,mt),ct=null,fr&&(Ce=xi(fr,zt,nt-Lr,nt+dn,1,Ht.minY,Ht.maxY,mt),Ue=xi(fr,zt,nt+Qi,nt+li,1,Ht.minY,Ht.maxY,mt),fr=null),Fr&&(or=xi(Fr,zt,nt-Lr,nt+dn,1,Ht.minY,Ht.maxY,mt),Jr=xi(Fr,zt,nt+Qi,nt+li,1,Ht.minY,Ht.maxY,mt),Fr=null),Et>1&&console.timeEnd("clipping"),bt.push(Ce||[],q+1,2*X,2*nt),bt.push(Ue||[],q+1,2*X,2*nt+1),bt.push(or||[],q+1,2*X+1,2*nt),bt.push(Jr||[],q+1,2*X+1,2*nt+1)}}},ce.prototype.getTile=function(ct,q,X){var nt=this.options,pt=nt.extent,ft=nt.debug;if(ct<0||ct>24)return null;var rt=1<<ct,bt=ar(ct,q=(q%rt+rt)%rt,X);if(this.tiles[bt])return oe(this.tiles[bt],pt);ft>1&&console.log("drilling down to z%d-%d-%d",ct,q,X);for(var mt,Et=ct,zt=q,Zt=X;!mt&&Et>0;)Et--,zt=Math.floor(zt/2),Zt=Math.floor(Zt/2),mt=this.tiles[ar(Et,zt,Zt)];return mt&&mt.source?(ft>1&&console.log("found parent tile z%d-%d-%d",Et,zt,Zt),ft>1&&console.time("drilling down"),this.splitTile(mt.source,Et,zt,Zt,ct,q,X),ft>1&&console.timeEnd("drilling down"),this.tiles[bt]?oe(this.tiles[bt],pt):null):null};class Ze extends O{constructor(q,X,nt,pt){super(q,X,nt),this._dataUpdateable=new Map,this.loadGeoJSON=(ft,rt)=>{const{promoteId:bt}=ft;if(ft.request)return a.f(ft.request,(mt,Et,zt,Zt)=>{this._dataUpdateable=Di(Et,bt)?fo(Et,bt):void 0,rt(mt,Et,zt,Zt)});if(typeof ft.data=="string")try{const mt=JSON.parse(ft.data);this._dataUpdateable=Di(mt,bt)?fo(mt,bt):void 0,rt(null,mt)}catch{rt(new Error(`Input data given to '${ft.source}' is not a valid GeoJSON object.`))}else ft.dataDiff?this._dataUpdateable?(function(mt,Et,zt){var Zt,Ht,De,Xe;if(Et.removeAll&&mt.clear(),Et.remove)for(const Ce of Et.remove)mt.delete(Ce);if(Et.add)for(const Ce of Et.add){const Ue=He(Ce,zt);Ue!=null&&mt.set(Ue,Ce)}if(Et.update)for(const Ce of Et.update){let Ue=mt.get(Ce.id);if(Ue==null)continue;const or=!Ce.removeAllProperties&&(((Zt=Ce.removeProperties)===null||Zt===void 0?void 0:Zt.length)>0||((Ht=Ce.addOrUpdateProperties)===null||Ht===void 0?void 0:Ht.length)>0);if((Ce.newGeometry||Ce.removeAllProperties||or)&&(Ue=Object.assign({},Ue),mt.set(Ce.id,Ue),or&&(Ue.properties=Object.assign({},Ue.properties))),Ce.newGeometry&&(Ue.geometry=Ce.newGeometry),Ce.removeAllProperties)Ue.properties={};else if(((De=Ce.removeProperties)===null||De===void 0?void 0:De.length)>0)for(const Jr of Ce.removeProperties)Object.prototype.hasOwnProperty.call(Ue.properties,Jr)&&delete Ue.properties[Jr];if(((Xe=Ce.addOrUpdateProperties)===null||Xe===void 0?void 0:Xe.length)>0)for(const{key:Jr,value:fr}of Ce.addOrUpdateProperties)Ue.properties[Jr]=fr}}(this._dataUpdateable,ft.dataDiff,bt),rt(null,{type:"FeatureCollection",features:Array.from(this._dataUpdateable.values())})):rt(new Error(`Cannot update existing geojson data in ${ft.source}`)):rt(new Error(`Input data given to '${ft.source}' is not a valid GeoJSON object.`));return{cancel:()=>{}}},this.loadVectorData=this.loadGeoJSONTile,pt&&(this.loadGeoJSON=pt)}loadGeoJSONTile(q,X){const nt=q.tileID.canonical;if(!this._geoJSONIndex)return X(null,null);const pt=this._geoJSONIndex.getTile(nt.z,nt.x,nt.y);if(!pt)return X(null,null);const ft=new class{constructor(bt){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=a.N,this.length=bt.length,this._features=bt}feature(bt){return new class{constructor(mt){this._feature=mt,this.extent=a.N,this.type=mt.type,this.properties=mt.tags,"id"in mt&&!isNaN(mt.id)&&(this.id=parseInt(mt.id,10))}loadGeometry(){if(this._feature.type===1){const mt=[];for(const Et of this._feature.geometry)mt.push([new a.P(Et[0],Et[1])]);return mt}{const mt=[];for(const Et of this._feature.geometry){const zt=[];for(const Zt of Et)zt.push(new a.P(Zt[0],Zt[1]));mt.push(zt)}return mt}}toGeoJSON(mt,Et,zt){return tt.call(this,mt,Et,zt)}}(this._features[bt])}}(pt.features);let rt=xr(ft);rt.byteOffset===0&&rt.byteLength===rt.buffer.byteLength||(rt=new Uint8Array(rt)),X(null,{vectorTile:ft,rawData:rt.buffer})}loadData(q,X){var nt;(nt=this._pendingRequest)===null||nt===void 0||nt.cancel(),this._pendingCallback&&this._pendingCallback(null,{abandoned:!0});const pt=!!(q&&q.request&&q.request.collectResourceTiming)&&new a.bu(q.request);this._pendingCallback=X,this._pendingRequest=this.loadGeoJSON(q,(ft,rt)=>{if(delete this._pendingCallback,delete this._pendingRequest,ft||!rt)return X(ft);if(typeof rt!="object")return X(new Error(`Input data given to '${q.source}' is not a valid GeoJSON object.`));{U(rt,!0);try{if(q.filter){const mt=a.bC(q.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if(mt.result==="error")throw new Error(mt.value.map(Et=>`${Et.key}: ${Et.message}`).join(", "));rt={type:"FeatureCollection",features:rt.features.filter(Et=>mt.value.evaluate({zoom:0},Et))}}this._geoJSONIndex=q.cluster?new jr(function({superclusterOptions:mt,clusterProperties:Et}){if(!Et||!mt)return mt;const zt={},Zt={},Ht={accumulated:null,zoom:0},De={properties:null},Xe=Object.keys(Et);for(const Ce of Xe){const[Ue,or]=Et[Ce],Jr=a.bC(or),fr=a.bC(typeof Ue=="string"?[Ue,["accumulated"],["get",Ce]]:Ue);zt[Ce]=Jr.value,Zt[Ce]=fr.value}return mt.map=Ce=>{De.properties=Ce;const Ue={};for(const or of Xe)Ue[or]=zt[or].evaluate(Ht,De);return Ue},mt.reduce=(Ce,Ue)=>{De.properties=Ue;for(const or of Xe)Ht.accumulated=Ce[or],Ce[or]=Zt[or].evaluate(Ht,De)},mt}(q)).load(rt.features):function(mt,Et){return new ce(mt,Et)}(rt,q.geojsonVtOptions)}catch(mt){return X(mt)}this.loaded={};const bt={};if(pt){const mt=pt.finish();mt&&(bt.resourceTiming={},bt.resourceTiming[q.source]=JSON.parse(JSON.stringify(mt)))}X(null,bt)}})}reloadTile(q,X){const nt=this.loaded;return nt&&nt[q.uid]?super.reloadTile(q,X):this.loadTile(q,X)}removeSource(q,X){this._pendingCallback&&this._pendingCallback(null,{abandoned:!0}),X()}getClusterExpansionZoom(q,X){try{X(null,this._geoJSONIndex.getClusterExpansionZoom(q.clusterId))}catch(nt){X(nt)}}getClusterChildren(q,X){try{X(null,this._geoJSONIndex.getChildren(q.clusterId))}catch(nt){X(nt)}}getClusterLeaves(q,X){try{X(null,this._geoJSONIndex.getLeaves(q.clusterId,q.limit,q.offset))}catch(nt){X(nt)}}}class Mo{constructor(q){this.self=q,this.actor=new a.C(q,this),this.layerIndexes={},this.availableImages={},this.workerSourceTypes={vector:O,geojson:Ze},this.workerSources={},this.demWorkerSources={},this.self.registerWorkerSource=(X,nt)=>{if(this.workerSourceTypes[X])throw new Error(`Worker source with name "${X}" already registered.`);this.workerSourceTypes[X]=nt},this.self.registerRTLTextPlugin=X=>{if(a.bD.isParsed())throw new Error("RTL text plugin already registered.");a.bD.applyArabicShaping=X.applyArabicShaping,a.bD.processBidirectionalText=X.processBidirectionalText,a.bD.processStyledBidirectionalText=X.processStyledBidirectionalText}}setReferrer(q,X){this.referrer=X}setImages(q,X,nt){this.availableImages[q]=X;for(const pt in this.workerSources[q]){const ft=this.workerSources[q][pt];for(const rt in ft)ft[rt].availableImages=X}nt()}setLayers(q,X,nt){this.getLayerIndex(q).replace(X),nt()}updateLayers(q,X,nt){this.getLayerIndex(q).update(X.layers,X.removedIds),nt()}loadTile(q,X,nt){this.getWorkerSource(q,X.type,X.source).loadTile(X,nt)}loadDEMTile(q,X,nt){this.getDEMWorkerSource(q,X.source).loadTile(X,nt)}reloadTile(q,X,nt){this.getWorkerSource(q,X.type,X.source).reloadTile(X,nt)}abortTile(q,X,nt){this.getWorkerSource(q,X.type,X.source).abortTile(X,nt)}removeTile(q,X,nt){this.getWorkerSource(q,X.type,X.source).removeTile(X,nt)}removeDEMTile(q,X){this.getDEMWorkerSource(q,X.source).removeTile(X)}removeSource(q,X,nt){if(!this.workerSources[q]||!this.workerSources[q][X.type]||!this.workerSources[q][X.type][X.source])return;const pt=this.workerSources[q][X.type][X.source];delete this.workerSources[q][X.type][X.source],pt.removeSource!==void 0?pt.removeSource(X,nt):nt()}loadWorkerSource(q,X,nt){try{this.self.importScripts(X.url),nt()}catch(pt){nt(pt.toString())}}syncRTLPluginState(q,X,nt){try{a.bD.setState(X);const pt=a.bD.getPluginURL();if(a.bD.isLoaded()&&!a.bD.isParsed()&&pt!=null){this.self.importScripts(pt);const ft=a.bD.isParsed();nt(ft?void 0:new Error(`RTL Text Plugin failed to import scripts from ${pt}`),ft)}}catch(pt){nt(pt.toString())}}getAvailableImages(q){let X=this.availableImages[q];return X||(X=[]),X}getLayerIndex(q){let X=this.layerIndexes[q];return X||(X=this.layerIndexes[q]=new g),X}getWorkerSource(q,X,nt){return this.workerSources[q]||(this.workerSources[q]={}),this.workerSources[q][X]||(this.workerSources[q][X]={}),this.workerSources[q][X][nt]||(this.workerSources[q][X][nt]=new this.workerSourceTypes[X]({send:(pt,ft,rt)=>{this.actor.send(pt,ft,rt,q)}},this.getLayerIndex(q),this.getAvailableImages(q))),this.workerSources[q][X][nt]}getDEMWorkerSource(q,X){return this.demWorkerSources[q]||(this.demWorkerSources[q]={}),this.demWorkerSources[q][X]||(this.demWorkerSources[q][X]=new k),this.demWorkerSources[q][X]}}return a.i()&&(self.worker=new Mo(self)),Mo}),l(["./shared"],function(a){var g="3.6.2";class _{static testProp(s){if(!_.docStyle)return s[0];for(let p=0;p<s.length;p++)if(s[p]in _.docStyle)return s[p];return s[0]}static create(s,p,f){const y=window.document.createElement(s);return p!==void 0&&(y.className=p),f&&f.appendChild(y),y}static createNS(s,p){return window.document.createElementNS(s,p)}static disableDrag(){_.docStyle&&_.selectProp&&(_.userSelect=_.docStyle[_.selectProp],_.docStyle[_.selectProp]="none")}static enableDrag(){_.docStyle&&_.selectProp&&(_.docStyle[_.selectProp]=_.userSelect)}static setTransform(s,p){s.style[_.transformProp]=p}static addEventListener(s,p,f,y={}){s.addEventListener(p,f,"passive"in y?y:y.capture)}static removeEventListener(s,p,f,y={}){s.removeEventListener(p,f,"passive"in y?y:y.capture)}static suppressClickInternal(s){s.preventDefault(),s.stopPropagation(),window.removeEventListener("click",_.suppressClickInternal,!0)}static suppressClick(){window.addEventListener("click",_.suppressClickInternal,!0),window.setTimeout(()=>{window.removeEventListener("click",_.suppressClickInternal,!0)},0)}static mousePos(s,p){const f=s.getBoundingClientRect();return new a.P(p.clientX-f.left-s.clientLeft,p.clientY-f.top-s.clientTop)}static touchPos(s,p){const f=s.getBoundingClientRect(),y=[];for(let x=0;x<p.length;x++)y.push(new a.P(p[x].clientX-f.left-s.clientLeft,p[x].clientY-f.top-s.clientTop));return y}static mouseButton(s){return s.button}static remove(s){s.parentNode&&s.parentNode.removeChild(s)}}_.docStyle=typeof window<"u"&&window.document&&window.document.documentElement.style,_.selectProp=_.testProp(["userSelect","MozUserSelect","WebkitUserSelect","msUserSelect"]),_.transformProp=_.testProp(["transform","WebkitTransform"]);const E={supported:!1,testSupport:function(v){!O&&A&&(k?G(v):S=v)}};let S,A,O=!1,k=!1;function G(v){const s=v.createTexture();v.bindTexture(v.TEXTURE_2D,s);try{if(v.texImage2D(v.TEXTURE_2D,0,v.RGBA,v.RGBA,v.UNSIGNED_BYTE,A),v.isContextLost())return;E.supported=!0}catch{}v.deleteTexture(s),O=!0}var W,U;typeof document<"u"&&(A=document.createElement("img"),A.onload=function(){S&&G(S),S=null,k=!0},A.onerror=function(){O=!0,S=null},A.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA="),function(v){let s,p,f,y;v.resetRequestQueue=()=>{s=[],p=0,f=0,y={}},v.addThrottleControl=N=>{const z=f++;return y[z]=N,z},v.removeThrottleControl=N=>{delete y[N],M()},v.getImage=(N,z,B=!0)=>{E.supported&&(N.headers||(N.headers={}),N.headers.accept="image/webp,*/*");const H={requestParameters:N,supportImageRefresh:B,callback:z,cancelled:!1,completed:!1,cancel:()=>{H.completed||H.cancelled||(H.cancelled=!0,H.innerRequest&&(H.innerRequest.cancel(),p--),M())}};return s.push(H),M(),H};const x=N=>{const{requestParameters:z,supportImageRefresh:B,callback:H}=N;return a.e(z,{type:"image"}),(B!==!1||a.i()||a.g(z.url)||z.headers&&!Object.keys(z.headers).reduce((lt,ut)=>lt&&ut==="accept",!0)?a.m:L)(z,(lt,ut,ht,st)=>{C(N,H,lt,ut,ht,st)})},C=(N,z,B,H,lt,ut)=>{B?z(B):H instanceof HTMLImageElement||a.a(H)?z(null,H):H&&((ht,st)=>{typeof createImageBitmap=="function"?a.b(ht,st):a.d(ht,st)})(H,(ht,st)=>{ht!=null?z(ht):st!=null&&z(null,st,{cacheControl:lt,expires:ut})}),N.cancelled||(N.completed=!0,p--,M())},M=()=>{const N=(()=>{const z=Object.keys(y);let B=!1;if(z.length>0){for(const H of z)if(B=y[H](),B)break}return B})()?a.c.MAX_PARALLEL_IMAGE_REQUESTS_PER_FRAME:a.c.MAX_PARALLEL_IMAGE_REQUESTS;for(let z=p;z<N&&s.length>0;z++){const B=s.shift();if(B.cancelled){z--;continue}const H=x(B);p++,B.innerRequest=H}},L=(N,z)=>{const B=new Image,H=N.url;let lt=!1;const ut=N.credentials;return ut&&ut==="include"?B.crossOrigin="use-credentials":(ut&&ut==="same-origin"||!a.s(H))&&(B.crossOrigin="anonymous"),B.fetchPriority="high",B.onload=()=>{z(null,B),B.onerror=B.onload=null},B.onerror=()=>{lt||z(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.")),B.onerror=B.onload=null},B.src=H,{cancel:()=>{lt=!0,B.src=""}}}}(W||(W={})),W.resetRequestQueue(),function(v){v.Glyphs="Glyphs",v.Image="Image",v.Source="Source",v.SpriteImage="SpriteImage",v.SpriteJSON="SpriteJSON",v.Style="Style",v.Tile="Tile",v.Unknown="Unknown"}(U||(U={}));class tt{constructor(s){this._transformRequestFn=s}transformRequest(s,p){return this._transformRequestFn&&this._transformRequestFn(s,p)||{url:s}}normalizeSpriteURL(s,p,f){const y=function(x){const C=x.match($);if(!C)throw new Error(`Unable to parse URL "${x}"`);return{protocol:C[1],authority:C[2],path:C[3]||"/",params:C[4]?C[4].split("&"):[]}}(s);return y.path+=`${p}${f}`,function(x){const C=x.params.length?`?${x.params.join("&")}`:"";return`${x.protocol}://${x.authority}${x.path}${C}`}(y)}setTransformRequest(s){this._transformRequestFn=s}}const $=/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;function V(v){var s=new a.A(3);return s[0]=v[0],s[1]=v[1],s[2]=v[2],s}var it,vt=function(v,s,p){return v[0]=s[0]-p[0],v[1]=s[1]-p[1],v[2]=s[2]-p[2],v};it=new a.A(3),a.A!=Float32Array&&(it[0]=0,it[1]=0,it[2]=0);var ot=function(v){var s=v[0],p=v[1];return s*s+p*p};function et(v){const s=[];if(typeof v=="string")s.push({id:"default",url:v});else if(v&&v.length>0){const p=[];for(const{id:f,url:y}of v){const x=`${f}${y}`;p.indexOf(x)===-1&&(p.push(x),s.push({id:f,url:y}))}}return s}function wt(v,s,p,f,y){if(f)return void v(f);if(y!==Object.values(s).length||y!==Object.values(p).length)return;const x={};for(const C in s){x[C]={};const M=a.h.getImageCanvasContext(p[C]),L=s[C];for(const N in L){const{width:z,height:B,x:H,y:lt,sdf:ut,pixelRatio:ht,stretchX:st,stretchY:Mt,content:Ft}=L[N];x[C][N]={data:null,pixelRatio:ht,sdf:ut,stretchX:st,stretchY:Mt,content:Ft,spriteData:{width:z,height:B,x:H,y:lt,context:M}}}}v(null,x)}(function(){var v=new a.A(2);a.A!=Float32Array&&(v[0]=0,v[1]=0)})();class J{constructor(s,p,f,y){this.context=s,this.format=f,this.texture=s.gl.createTexture(),this.update(p,y)}update(s,p,f){const{width:y,height:x}=s,C=!(this.size&&this.size[0]===y&&this.size[1]===x||f),{context:M}=this,{gl:L}=M;if(this.useMipmap=!!(p&&p.useMipmap),L.bindTexture(L.TEXTURE_2D,this.texture),M.pixelStoreUnpackFlipY.set(!1),M.pixelStoreUnpack.set(1),M.pixelStoreUnpackPremultiplyAlpha.set(this.format===L.RGBA&&(!p||p.premultiply!==!1)),C)this.size=[y,x],s instanceof HTMLImageElement||s instanceof HTMLCanvasElement||s instanceof HTMLVideoElement||s instanceof ImageData||a.a(s)?L.texImage2D(L.TEXTURE_2D,0,this.format,this.format,L.UNSIGNED_BYTE,s):L.texImage2D(L.TEXTURE_2D,0,this.format,y,x,0,this.format,L.UNSIGNED_BYTE,s.data);else{const{x:N,y:z}=f||{x:0,y:0};s instanceof HTMLImageElement||s instanceof HTMLCanvasElement||s instanceof HTMLVideoElement||s instanceof ImageData||a.a(s)?L.texSubImage2D(L.TEXTURE_2D,0,N,z,L.RGBA,L.UNSIGNED_BYTE,s):L.texSubImage2D(L.TEXTURE_2D,0,N,z,y,x,L.RGBA,L.UNSIGNED_BYTE,s.data)}this.useMipmap&&this.isSizePowerOfTwo()&&L.generateMipmap(L.TEXTURE_2D)}bind(s,p,f){const{context:y}=this,{gl:x}=y;x.bindTexture(x.TEXTURE_2D,this.texture),f!==x.LINEAR_MIPMAP_NEAREST||this.isSizePowerOfTwo()||(f=x.LINEAR),s!==this.filter&&(x.texParameteri(x.TEXTURE_2D,x.TEXTURE_MAG_FILTER,s),x.texParameteri(x.TEXTURE_2D,x.TEXTURE_MIN_FILTER,f||s),this.filter=s),p!==this.wrap&&(x.texParameteri(x.TEXTURE_2D,x.TEXTURE_WRAP_S,p),x.texParameteri(x.TEXTURE_2D,x.TEXTURE_WRAP_T,p),this.wrap=p)}isSizePowerOfTwo(){return this.size[0]===this.size[1]&&Math.log(this.size[0])/Math.LN2%1==0}destroy(){const{gl:s}=this.context;s.deleteTexture(this.texture),this.texture=null}}function xt(v){const{userImage:s}=v;return!!(s&&s.render&&s.render())&&(v.data.replace(new Uint8Array(s.data.buffer)),!0)}class $t extends a.E{constructor(){super(),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded=!1,this.requestors=[],this.patterns={},this.atlasImage=new a.R({width:1,height:1}),this.dirty=!0}isLoaded(){return this.loaded}setLoaded(s){if(this.loaded!==s&&(this.loaded=s,s)){for(const{ids:p,callback:f}of this.requestors)this._notify(p,f);this.requestors=[]}}getImage(s){const p=this.images[s];if(p&&!p.data&&p.spriteData){const f=p.spriteData;p.data=new a.R({width:f.width,height:f.height},f.context.getImageData(f.x,f.y,f.width,f.height).data),p.spriteData=null}return p}addImage(s,p){if(this.images[s])throw new Error(`Image id ${s} already exist, use updateImage instead`);this._validate(s,p)&&(this.images[s]=p)}_validate(s,p){let f=!0;const y=p.data||p.spriteData;return this._validateStretch(p.stretchX,y&&y.width)||(this.fire(new a.j(new Error(`Image "${s}" has invalid "stretchX" value`))),f=!1),this._validateStretch(p.stretchY,y&&y.height)||(this.fire(new a.j(new Error(`Image "${s}" has invalid "stretchY" value`))),f=!1),this._validateContent(p.content,p)||(this.fire(new a.j(new Error(`Image "${s}" has invalid "content" value`))),f=!1),f}_validateStretch(s,p){if(!s)return!0;let f=0;for(const y of s){if(y[0]<f||y[1]<y[0]||p<y[1])return!1;f=y[1]}return!0}_validateContent(s,p){if(!s)return!0;if(s.length!==4)return!1;const f=p.spriteData,y=f&&f.width||p.data.width,x=f&&f.height||p.data.height;return!(s[0]<0||y<s[0]||s[1]<0||x<s[1]||s[2]<0||y<s[2]||s[3]<0||x<s[3]||s[2]<s[0]||s[3]<s[1])}updateImage(s,p,f=!0){const y=this.getImage(s);if(f&&(y.data.width!==p.data.width||y.data.height!==p.data.height))throw new Error(`size mismatch between old image (${y.data.width}x${y.data.height}) and new image (${p.data.width}x${p.data.height}).`);p.version=y.version+1,this.images[s]=p,this.updatedImages[s]=!0}removeImage(s){const p=this.images[s];delete this.images[s],delete this.patterns[s],p.userImage&&p.userImage.onRemove&&p.userImage.onRemove()}listImages(){return Object.keys(this.images)}getImages(s,p){let f=!0;if(!this.isLoaded())for(const y of s)this.images[y]||(f=!1);this.isLoaded()||f?this._notify(s,p):this.requestors.push({ids:s,callback:p})}_notify(s,p){const f={};for(const y of s){let x=this.getImage(y);x||(this.fire(new a.k("styleimagemissing",{id:y})),x=this.getImage(y)),x?f[y]={data:x.data.clone(),pixelRatio:x.pixelRatio,sdf:x.sdf,version:x.version,stretchX:x.stretchX,stretchY:x.stretchY,content:x.content,hasRenderCallback:!!(x.userImage&&x.userImage.render)}:a.w(`Image "${y}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`)}p(null,f)}getPixelSize(){const{width:s,height:p}=this.atlasImage;return{width:s,height:p}}getPattern(s){const p=this.patterns[s],f=this.getImage(s);if(!f)return null;if(p&&p.position.version===f.version)return p.position;if(p)p.position.version=f.version;else{const y={w:f.data.width+2,h:f.data.height+2,x:0,y:0},x=new a.I(y,f);this.patterns[s]={bin:y,position:x}}return this._updatePatternAtlas(),this.patterns[s].position}bind(s){const p=s.gl;this.atlasTexture?this.dirty&&(this.atlasTexture.update(this.atlasImage),this.dirty=!1):this.atlasTexture=new J(s,this.atlasImage,p.RGBA),this.atlasTexture.bind(p.LINEAR,p.CLAMP_TO_EDGE)}_updatePatternAtlas(){const s=[];for(const x in this.patterns)s.push(this.patterns[x].bin);const{w:p,h:f}=a.p(s),y=this.atlasImage;y.resize({width:p||1,height:f||1});for(const x in this.patterns){const{bin:C}=this.patterns[x],M=C.x+1,L=C.y+1,N=this.getImage(x).data,z=N.width,B=N.height;a.R.copy(N,y,{x:0,y:0},{x:M,y:L},{width:z,height:B}),a.R.copy(N,y,{x:0,y:B-1},{x:M,y:L-1},{width:z,height:1}),a.R.copy(N,y,{x:0,y:0},{x:M,y:L+B},{width:z,height:1}),a.R.copy(N,y,{x:z-1,y:0},{x:M-1,y:L},{width:1,height:B}),a.R.copy(N,y,{x:0,y:0},{x:M+z,y:L},{width:1,height:B})}this.dirty=!0}beginFrame(){this.callbackDispatchedThisFrame={}}dispatchRenderCallbacks(s){for(const p of s){if(this.callbackDispatchedThisFrame[p])continue;this.callbackDispatchedThisFrame[p]=!0;const f=this.getImage(p);f||a.w(`Image with ID: "${p}" was not found`),xt(f)&&this.updateImage(p,f)}}}const Ut=1e20;function Ot(v,s,p,f,y,x,C,M,L){for(let N=s;N<s+f;N++)te(v,p*x+N,x,y,C,M,L);for(let N=p;N<p+y;N++)te(v,N*x+s,1,f,C,M,L)}function te(v,s,p,f,y,x,C){x[0]=0,C[0]=-Ut,C[1]=Ut,y[0]=v[s];for(let M=1,L=0,N=0;M<f;M++){y[M]=v[s+M*p];const z=M*M;do{const B=x[L];N=(y[M]-y[B]+z-B*B)/(M-B)/2}while(N<=C[L]&&--L>-1);L++,x[L]=M,C[L]=N,C[L+1]=Ut}for(let M=0,L=0;M<f;M++){for(;C[L+1]<M;)L++;const N=x[L],z=M-N;v[s+M*p]=y[N]+z*z}}class ye{constructor(s,p){this.requestManager=s,this.localIdeographFontFamily=p,this.entries={}}setURL(s){this.url=s}getGlyphs(s,p){const f=[];for(const y in s)for(const x of s[y])f.push({stack:y,id:x});a.o(f,({stack:y,id:x},C)=>{let M=this.entries[y];M||(M=this.entries[y]={glyphs:{},requests:{},ranges:{}});let L=M.glyphs[x];if(L!==void 0)return void C(null,{stack:y,id:x,glyph:L});if(L=this._tinySDF(M,y,x),L)return M.glyphs[x]=L,void C(null,{stack:y,id:x,glyph:L});const N=Math.floor(x/256);if(256*N>65535)return void C(new Error("glyphs > 65535 not supported"));if(M.ranges[N])return void C(null,{stack:y,id:x,glyph:L});if(!this.url)return void C(new Error("glyphsUrl is not set"));let z=M.requests[N];z||(z=M.requests[N]=[],ye.loadGlyphRange(y,N,this.url,this.requestManager,(B,H)=>{if(H){for(const lt in H)this._doesCharSupportLocalGlyph(+lt)||(M.glyphs[+lt]=H[+lt]);M.ranges[N]=!0}for(const lt of z)lt(B,H);delete M.requests[N]})),z.push((B,H)=>{B?C(B):H&&C(null,{stack:y,id:x,glyph:H[x]||null})})},(y,x)=>{if(y)p(y);else if(x){const C={};for(const{stack:M,id:L,glyph:N}of x)(C[M]||(C[M]={}))[L]=N&&{id:N.id,bitmap:N.bitmap.clone(),metrics:N.metrics};p(null,C)}})}_doesCharSupportLocalGlyph(s){return!!this.localIdeographFontFamily&&(a.u["CJK Unified Ideographs"](s)||a.u["Hangul Syllables"](s)||a.u.Hiragana(s)||a.u.Katakana(s))}_tinySDF(s,p,f){const y=this.localIdeographFontFamily;if(!y||!this._doesCharSupportLocalGlyph(f))return;let x=s.tinySDF;if(!x){let M="400";/bold/i.test(p)?M="900":/medium/i.test(p)?M="500":/light/i.test(p)&&(M="200"),x=s.tinySDF=new ye.TinySDF({fontSize:48,buffer:6,radius:16,cutoff:.25,fontFamily:y,fontWeight:M})}const C=x.draw(String.fromCharCode(f));return{id:f,bitmap:new a.q({width:C.width||60,height:C.height||60},C.data),metrics:{width:C.glyphWidth/2||24,height:C.glyphHeight/2||24,left:C.glyphLeft/2+.5||0,top:C.glyphTop/2-27.5||-8,advance:C.glyphAdvance/2||24,isDoubleResolution:!0}}}}ye.loadGlyphRange=function(v,s,p,f,y){const x=256*s,C=x+255,M=f.transformRequest(p.replace("{fontstack}",v).replace("{range}",`${x}-${C}`),U.Glyphs);a.l(M,(L,N)=>{if(L)y(L);else if(N){const z={};for(const B of a.n(N))z[B.id]=B;y(null,z)}})},ye.TinySDF=class{constructor({fontSize:v=24,buffer:s=3,radius:p=8,cutoff:f=.25,fontFamily:y="sans-serif",fontWeight:x="normal",fontStyle:C="normal"}={}){this.buffer=s,this.cutoff=f,this.radius=p;const M=this.size=v+4*s,L=this._createCanvas(M),N=this.ctx=L.getContext("2d",{willReadFrequently:!0});N.font=`${C} ${x} ${v}px ${y}`,N.textBaseline="alphabetic",N.textAlign="left",N.fillStyle="black",this.gridOuter=new Float64Array(M*M),this.gridInner=new Float64Array(M*M),this.f=new Float64Array(M),this.z=new Float64Array(M+1),this.v=new Uint16Array(M)}_createCanvas(v){const s=document.createElement("canvas");return s.width=s.height=v,s}draw(v){const{width:s,actualBoundingBoxAscent:p,actualBoundingBoxDescent:f,actualBoundingBoxLeft:y,actualBoundingBoxRight:x}=this.ctx.measureText(v),C=Math.ceil(p),M=Math.max(0,Math.min(this.size-this.buffer,Math.ceil(x-y))),L=Math.min(this.size-this.buffer,C+Math.ceil(f)),N=M+2*this.buffer,z=L+2*this.buffer,B=Math.max(N*z,0),H=new Uint8ClampedArray(B),lt={data:H,width:N,height:z,glyphWidth:M,glyphHeight:L,glyphTop:C,glyphLeft:0,glyphAdvance:s};if(M===0||L===0)return lt;const{ctx:ut,buffer:ht,gridInner:st,gridOuter:Mt}=this;ut.clearRect(ht,ht,M,L),ut.fillText(v,ht,ht+C);const Ft=ut.getImageData(ht,ht,M,L);Mt.fill(Ut,0,B),st.fill(0,0,B);for(let yt=0;yt<L;yt++)for(let Pt=0;Pt<M;Pt++){const Vt=Ft.data[4*(yt*M+Pt)+3]/255;if(Vt===0)continue;const qt=(yt+ht)*N+Pt+ht;if(Vt===1)Mt[qt]=0,st[qt]=Ut;else{const Yt=.5-Vt;Mt[qt]=Yt>0?Yt*Yt:0,st[qt]=Yt<0?Yt*Yt:0}}Ot(Mt,0,0,N,z,N,this.f,this.v,this.z),Ot(st,ht,ht,M,L,N,this.f,this.v,this.z);for(let yt=0;yt<B;yt++){const Pt=Math.sqrt(Mt[yt])-Math.sqrt(st[yt]);H[yt]=Math.round(255-255*(Pt/this.radius+this.cutoff))}return lt}};class Me{constructor(){this.specification=a.v.light.position}possiblyEvaluate(s,p){return a.z(s.expression.evaluate(p))}interpolate(s,p,f){return{x:a.B.number(s.x,p.x,f),y:a.B.number(s.y,p.y,f),z:a.B.number(s.z,p.z,f)}}}let ir;class xr extends a.E{constructor(s){super(),ir=ir||new a.r({anchor:new a.D(a.v.light.anchor),position:new Me,color:new a.D(a.v.light.color),intensity:new a.D(a.v.light.intensity)}),this._transitionable=new a.T(ir),this.setLight(s),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(s,p={}){if(!this._validate(a.t,s,p))for(const f in s){const y=s[f];f.endsWith("-transition")?this._transitionable.setTransition(f.slice(0,-11),y):this._transitionable.setValue(f,y)}}updateTransitions(s){this._transitioning=this._transitionable.transitioned(s,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(s){this.properties=this._transitioning.possiblyEvaluate(s)}_validate(s,p,f){return(!f||f.validate!==!1)&&a.x(this,s.call(a.y,a.e({value:p,style:{glyphs:!0,sprite:!0},styleSpec:a.v})))}}class _r{constructor(s,p){this.width=s,this.height=p,this.nextRow=0,this.data=new Uint8Array(this.width*this.height),this.dashEntry={}}getDash(s,p){const f=s.join(",")+String(p);return this.dashEntry[f]||(this.dashEntry[f]=this.addDash(s,p)),this.dashEntry[f]}getDashRanges(s,p,f){const y=[];let x=s.length%2==1?-s[s.length-1]*f:0,C=s[0]*f,M=!0;y.push({left:x,right:C,isDash:M,zeroLength:s[0]===0});let L=s[0];for(let N=1;N<s.length;N++){M=!M;const z=s[N];x=L*f,L+=z,C=L*f,y.push({left:x,right:C,isDash:M,zeroLength:z===0})}return y}addRoundDash(s,p,f){const y=p/2;for(let x=-f;x<=f;x++){const C=this.width*(this.nextRow+f+x);let M=0,L=s[M];for(let N=0;N<this.width;N++){N/L.right>1&&(L=s[++M]);const z=Math.abs(N-L.left),B=Math.abs(N-L.right),H=Math.min(z,B);let lt;const ut=x/f*(y+1);if(L.isDash){const ht=y-Math.abs(ut);lt=Math.sqrt(H*H+ht*ht)}else lt=y-Math.sqrt(H*H+ut*ut);this.data[C+N]=Math.max(0,Math.min(255,lt+128))}}}addRegularDash(s){for(let M=s.length-1;M>=0;--M){const L=s[M],N=s[M+1];L.zeroLength?s.splice(M,1):N&&N.isDash===L.isDash&&(N.left=L.left,s.splice(M,1))}const p=s[0],f=s[s.length-1];p.isDash===f.isDash&&(p.left=f.left-this.width,f.right=p.right+this.width);const y=this.width*this.nextRow;let x=0,C=s[x];for(let M=0;M<this.width;M++){M/C.right>1&&(C=s[++x]);const L=Math.abs(M-C.left),N=Math.abs(M-C.right),z=Math.min(L,N);this.data[y+M]=Math.max(0,Math.min(255,(C.isDash?z:-z)+128))}}addDash(s,p){const f=p?7:0,y=2*f+1;if(this.nextRow+y>this.height)return a.w("LineAtlas out of space"),null;let x=0;for(let M=0;M<s.length;M++)x+=s[M];if(x!==0){const M=this.width/x,L=this.getDashRanges(s,this.width,M);p?this.addRoundDash(L,M,f):this.addRegularDash(L)}const C={y:(this.nextRow+f+.5)/this.height,height:2*f/this.height,width:x};return this.nextRow+=y,this.dirty=!0,C}bind(s){const p=s.gl;this.texture?(p.bindTexture(p.TEXTURE_2D,this.texture),this.dirty&&(this.dirty=!1,p.texSubImage2D(p.TEXTURE_2D,0,0,0,this.width,this.height,p.ALPHA,p.UNSIGNED_BYTE,this.data))):(this.texture=p.createTexture(),p.bindTexture(p.TEXTURE_2D,this.texture),p.texParameteri(p.TEXTURE_2D,p.TEXTURE_WRAP_S,p.REPEAT),p.texParameteri(p.TEXTURE_2D,p.TEXTURE_WRAP_T,p.REPEAT),p.texParameteri(p.TEXTURE_2D,p.TEXTURE_MIN_FILTER,p.LINEAR),p.texParameteri(p.TEXTURE_2D,p.TEXTURE_MAG_FILTER,p.LINEAR),p.texImage2D(p.TEXTURE_2D,0,p.ALPHA,this.width,this.height,0,p.ALPHA,p.UNSIGNED_BYTE,this.data))}}class kr{constructor(s,p,f){this.workerPool=s,this.actors=[],this.currentActor=0,this.id=f;const y=this.workerPool.acquire(f);for(let x=0;x<y.length;x++){const C=new a.C(y[x],p,f);C.name=`Worker ${x}`,this.actors.push(C)}if(!this.actors.length)throw new Error("No actors found")}broadcast(s,p,f){a.o(this.actors,(y,x)=>{y.send(s,p,x)},f=f||function(){})}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(s=!0){this.actors.forEach(p=>{p.remove()}),this.actors=[],s&&this.workerPool.release(this.id)}}function vr(v,s,p){const f=function(y,x){if(y)return p(y);if(x){const C=a.F(a.e(x,v),["tiles","minzoom","maxzoom","attribution","bounds","scheme","tileSize","encoding"]);x.vector_layers&&(C.vectorLayers=x.vector_layers,C.vectorLayerIds=C.vectorLayers.map(M=>M.id)),p(null,C)}};return v.url?a.f(s.transformRequest(v.url,U.Source),f):a.h.frame(()=>f(null,v))}class ue{constructor(s,p){s&&(p?this.setSouthWest(s).setNorthEast(p):Array.isArray(s)&&(s.length===4?this.setSouthWest([s[0],s[1]]).setNorthEast([s[2],s[3]]):this.setSouthWest(s[0]).setNorthEast(s[1])))}setNorthEast(s){return this._ne=s instanceof a.L?new a.L(s.lng,s.lat):a.L.convert(s),this}setSouthWest(s){return this._sw=s instanceof a.L?new a.L(s.lng,s.lat):a.L.convert(s),this}extend(s){const p=this._sw,f=this._ne;let y,x;if(s instanceof a.L)y=s,x=s;else{if(!(s instanceof ue))return Array.isArray(s)?s.length===4||s.every(Array.isArray)?this.extend(ue.convert(s)):this.extend(a.L.convert(s)):s&&("lng"in s||"lon"in s)&&"lat"in s?this.extend(a.L.convert(s)):this;if(y=s._sw,x=s._ne,!y||!x)return this}return p||f?(p.lng=Math.min(y.lng,p.lng),p.lat=Math.min(y.lat,p.lat),f.lng=Math.max(x.lng,f.lng),f.lat=Math.max(x.lat,f.lat)):(this._sw=new a.L(y.lng,y.lat),this._ne=new a.L(x.lng,x.lat)),this}getCenter(){return new a.L((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new a.L(this.getWest(),this.getNorth())}getSouthEast(){return new a.L(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(s){const{lng:p,lat:f}=a.L.convert(s);let y=this._sw.lng<=p&&p<=this._ne.lng;return this._sw.lng>this._ne.lng&&(y=this._sw.lng>=p&&p>=this._ne.lng),this._sw.lat<=f&&f<=this._ne.lat&&y}static convert(s){return s instanceof ue?s:s&&new ue(s)}static fromLngLat(s,p=0){const f=360*p/40075017,y=f/Math.cos(Math.PI/180*s.lat);return new ue(new a.L(s.lng-y,s.lat-f),new a.L(s.lng+y,s.lat+f))}}class nr{constructor(s,p,f){this.bounds=ue.convert(this.validateBounds(s)),this.minzoom=p||0,this.maxzoom=f||24}validateBounds(s){return Array.isArray(s)&&s.length===4?[Math.max(-180,s[0]),Math.max(-90,s[1]),Math.min(180,s[2]),Math.min(90,s[3])]:[-180,-90,180,90]}contains(s){const p=Math.pow(2,s.z),f=Math.floor(a.G(this.bounds.getWest())*p),y=Math.floor(a.H(this.bounds.getNorth())*p),x=Math.ceil(a.G(this.bounds.getEast())*p),C=Math.ceil(a.H(this.bounds.getSouth())*p);return s.x>=f&&s.x<x&&s.y>=y&&s.y<C}}class br extends a.E{constructor(s,p,f,y){if(super(),this.load=()=>{this._loaded=!1,this.fire(new a.k("dataloading",{dataType:"source"})),this._tileJSONRequest=vr(this._options,this.map._requestManager,(x,C)=>{this._tileJSONRequest=null,this._loaded=!0,this.map.style.sourceCaches[this.id].clearTiles(),x?this.fire(new a.j(x)):C&&(a.e(this,C),C.bounds&&(this.tileBounds=new nr(C.bounds,this.minzoom,this.maxzoom)),this.fire(new a.k("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new a.k("data",{dataType:"source",sourceDataType:"content"})))})},this.serialize=()=>a.e({},this._options),this.id=s,this.dispatcher=f,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,a.e(this,a.F(p,["url","scheme","tileSize","promoteId"])),this._options=a.e({type:"vector"},p),this._collectResourceTiming=p.collectResourceTiming,this.tileSize!==512)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(y)}loaded(){return this._loaded}hasTile(s){return!this.tileBounds||this.tileBounds.contains(s.canonical)}onAdd(s){this.map=s,this.load()}setSourceProperty(s){this._tileJSONRequest&&this._tileJSONRequest.cancel(),s(),this.load()}setTiles(s){return this.setSourceProperty(()=>{this._options.tiles=s}),this}setUrl(s){return this.setSourceProperty(()=>{this.url=s,this._options.url=s}),this}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}loadTile(s,p){const f=s.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme),y={request:this.map._requestManager.transformRequest(f,U.Tile),uid:s.uid,tileID:s.tileID,zoom:s.tileID.overscaledZ,tileSize:this.tileSize*s.tileID.overscaleFactor(),type:this.type,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId};function x(C,M){return delete s.request,s.aborted?p(null):C&&C.status!==404?p(C):(M&&M.resourceTiming&&(s.resourceTiming=M.resourceTiming),this.map._refreshExpiredTiles&&M&&s.setExpiryData(M),s.loadVectorData(M,this.map.painter),p(null),void(s.reloadCallback&&(this.loadTile(s,s.reloadCallback),s.reloadCallback=null)))}y.request.collectResourceTiming=this._collectResourceTiming,s.actor&&s.state!=="expired"?s.state==="loading"?s.reloadCallback=p:s.request=s.actor.send("reloadTile",y,x.bind(this)):(s.actor=this.dispatcher.getActor(),s.request=s.actor.send("loadTile",y,x.bind(this)))}abortTile(s){s.request&&(s.request.cancel(),delete s.request),s.actor&&s.actor.send("abortTile",{uid:s.uid,type:this.type,source:this.id},void 0)}unloadTile(s){s.unloadVectorData(),s.actor&&s.actor.send("removeTile",{uid:s.uid,type:this.type,source:this.id},void 0)}hasTransition(){return!1}}class jr extends a.E{constructor(s,p,f,y){super(),this.id=s,this.dispatcher=f,this.setEventedParent(y),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=a.e({type:"raster"},p),a.e(this,a.F(p,["url","scheme","tileSize"]))}load(){this._loaded=!1,this.fire(new a.k("dataloading",{dataType:"source"})),this._tileJSONRequest=vr(this._options,this.map._requestManager,(s,p)=>{this._tileJSONRequest=null,this._loaded=!0,s?this.fire(new a.j(s)):p&&(a.e(this,p),p.bounds&&(this.tileBounds=new nr(p.bounds,this.minzoom,this.maxzoom)),this.fire(new a.k("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new a.k("data",{dataType:"source",sourceDataType:"content"})))})}loaded(){return this._loaded}onAdd(s){this.map=s,this.load()}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}setSourceProperty(s){this._tileJSONRequest&&this._tileJSONRequest.cancel(),s(),this.load()}setTiles(s){return this.setSourceProperty(()=>{this._options.tiles=s}),this}serialize(){return a.e({},this._options)}hasTile(s){return!this.tileBounds||this.tileBounds.contains(s.canonical)}loadTile(s,p){const f=s.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme);s.request=W.getImage(this.map._requestManager.transformRequest(f,U.Tile),(y,x,C)=>{if(delete s.request,s.aborted)s.state="unloaded",p(null);else if(y)s.state="errored",p(y);else if(x){this.map._refreshExpiredTiles&&C&&s.setExpiryData(C);const M=this.map.painter.context,L=M.gl;s.texture=this.map.painter.getTileTexture(x.width),s.texture?s.texture.update(x,{useMipmap:!0}):(s.texture=new J(M,x,L.RGBA,{useMipmap:!0}),s.texture.bind(L.LINEAR,L.CLAMP_TO_EDGE,L.LINEAR_MIPMAP_NEAREST),M.extTextureFilterAnisotropic&&L.texParameterf(L.TEXTURE_2D,M.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,M.extTextureFilterAnisotropicMax)),s.state="loaded",p(null)}},this.map._refreshExpiredTiles)}abortTile(s,p){s.request&&(s.request.cancel(),delete s.request),p()}unloadTile(s,p){s.texture&&this.map.painter.saveTileTexture(s.texture),p()}hasTransition(){return!1}}class ln extends jr{constructor(s,p,f,y){super(s,p,f,y),this.type="raster-dem",this.maxzoom=22,this._options=a.e({type:"raster-dem"},p),this.encoding=p.encoding||"mapbox",this.redFactor=p.redFactor,this.greenFactor=p.greenFactor,this.blueFactor=p.blueFactor,this.baseShift=p.baseShift}loadTile(s,p){const f=s.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme),y=this.map._requestManager.transformRequest(f,U.Tile);function x(C,M){C&&(s.state="errored",p(C)),M&&(s.dem=M,s.needsHillshadePrepare=!0,s.needsTerrainPrepare=!0,s.state="loaded",p(null))}s.neighboringTiles=this._getNeighboringTiles(s.tileID),s.request=W.getImage(y,(C,M,L)=>a._(this,void 0,void 0,function*(){if(delete s.request,s.aborted)s.state="unloaded",p(null);else if(C)s.state="errored",p(C);else if(M){this.map._refreshExpiredTiles&&s.setExpiryData(L);const N=a.a(M)&&a.J()?M:yield function(B){return a._(this,void 0,void 0,function*(){if(typeof VideoFrame<"u"&&a.K()){const H=B.width+2,lt=B.height+2;try{return new a.R({width:H,height:lt},yield a.M(B,-1,-1,H,lt))}catch{}}return a.h.getImageData(B,1)})}(M),z={uid:s.uid,coord:s.tileID,source:this.id,rawImageData:N,encoding:this.encoding,redFactor:this.redFactor,greenFactor:this.greenFactor,blueFactor:this.blueFactor,baseShift:this.baseShift};s.actor&&s.state!=="expired"||(s.actor=this.dispatcher.getActor(),s.actor.send("loadDEMTile",z,x))}}),this.map._refreshExpiredTiles)}_getNeighboringTiles(s){const p=s.canonical,f=Math.pow(2,p.z),y=(p.x-1+f)%f,x=p.x===0?s.wrap-1:s.wrap,C=(p.x+1+f)%f,M=p.x+1===f?s.wrap+1:s.wrap,L={};return L[new a.O(s.overscaledZ,x,p.z,y,p.y).key]={backfilled:!1},L[new a.O(s.overscaledZ,M,p.z,C,p.y).key]={backfilled:!1},p.y>0&&(L[new a.O(s.overscaledZ,x,p.z,y,p.y-1).key]={backfilled:!1},L[new a.O(s.overscaledZ,s.wrap,p.z,p.x,p.y-1).key]={backfilled:!1},L[new a.O(s.overscaledZ,M,p.z,C,p.y-1).key]={backfilled:!1}),p.y+1<f&&(L[new a.O(s.overscaledZ,x,p.z,y,p.y+1).key]={backfilled:!1},L[new a.O(s.overscaledZ,s.wrap,p.z,p.x,p.y+1).key]={backfilled:!1},L[new a.O(s.overscaledZ,M,p.z,C,p.y+1).key]={backfilled:!1}),L}unloadTile(s){s.demTexture&&this.map.painter.saveTileTexture(s.demTexture),s.fbo&&(s.fbo.destroy(),delete s.fbo),s.dem&&delete s.dem,delete s.neighboringTiles,s.state="unloaded",s.actor&&s.actor.send("removeDEMTile",{uid:s.uid,source:this.id})}}class co extends a.E{constructor(s,p,f,y){super(),this.load=()=>{this._updateWorkerData()},this.serialize=()=>a.e({},this._options,{type:this.type,data:this._data}),this.id=s,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._removed=!1,this._pendingLoads=0,this.actor=f.getActor(),this.setEventedParent(y),this._data=p.data,this._options=a.e({},p),this._collectResourceTiming=p.collectResourceTiming,p.maxzoom!==void 0&&(this.maxzoom=p.maxzoom),p.type&&(this.type=p.type),p.attribution&&(this.attribution=p.attribution),this.promoteId=p.promoteId;const x=a.N/this.tileSize;this.workerOptions=a.e({source:this.id,cluster:p.cluster||!1,geojsonVtOptions:{buffer:(p.buffer!==void 0?p.buffer:128)*x,tolerance:(p.tolerance!==void 0?p.tolerance:.375)*x,extent:a.N,maxZoom:this.maxzoom,lineMetrics:p.lineMetrics||!1,generateId:p.generateId||!1},superclusterOptions:{maxZoom:p.clusterMaxZoom!==void 0?p.clusterMaxZoom:this.maxzoom-1,minPoints:Math.max(2,p.clusterMinPoints||2),extent:a.N,radius:(p.clusterRadius||50)*x,log:!1,generateId:p.generateId||!1},clusterProperties:p.clusterProperties,filter:p.filter},p.workerOptions),typeof this.promoteId=="string"&&(this.workerOptions.promoteId=this.promoteId)}onAdd(s){this.map=s,this.load()}setData(s){return this._data=s,this._updateWorkerData(),this}updateData(s){return this._updateWorkerData(s),this}setClusterOptions(s){return this.workerOptions.cluster=s.cluster,s&&(s.clusterRadius!==void 0&&(this.workerOptions.superclusterOptions.radius=s.clusterRadius),s.clusterMaxZoom!==void 0&&(this.workerOptions.superclusterOptions.maxZoom=s.clusterMaxZoom)),this._updateWorkerData(),this}getClusterExpansionZoom(s,p){return this.actor.send("geojson.getClusterExpansionZoom",{clusterId:s,source:this.id},p),this}getClusterChildren(s,p){return this.actor.send("geojson.getClusterChildren",{clusterId:s,source:this.id},p),this}getClusterLeaves(s,p,f,y){return this.actor.send("geojson.getClusterLeaves",{source:this.id,clusterId:s,limit:p,offset:f},y),this}_updateWorkerData(s){const p=a.e({},this.workerOptions);s?p.dataDiff=s:typeof this._data=="string"?(p.request=this.map._requestManager.transformRequest(a.h.resolveURL(this._data),U.Source),p.request.collectResourceTiming=this._collectResourceTiming):p.data=JSON.stringify(this._data),this._pendingLoads++,this.fire(new a.k("dataloading",{dataType:"source"})),this.actor.send(`${this.type}.loadData`,p,(f,y)=>{if(this._pendingLoads--,this._removed||y&&y.abandoned)return void this.fire(new a.k("dataabort",{dataType:"source"}));let x=null;if(y&&y.resourceTiming&&y.resourceTiming[this.id]&&(x=y.resourceTiming[this.id].slice(0)),f)return void this.fire(new a.j(f));const C={dataType:"source"};this._collectResourceTiming&&x&&x.length>0&&a.e(C,{resourceTiming:x}),this.fire(new a.k("data",Object.assign(Object.assign({},C),{sourceDataType:"metadata"}))),this.fire(new a.k("data",Object.assign(Object.assign({},C),{sourceDataType:"content"})))})}loaded(){return this._pendingLoads===0}loadTile(s,p){const f=s.actor?"reloadTile":"loadTile";s.actor=this.actor;const y={type:this.type,uid:s.uid,tileID:s.tileID,zoom:s.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId};s.request=this.actor.send(f,y,(x,C)=>(delete s.request,s.unloadVectorData(),s.aborted?p(null):x?p(x):(s.loadVectorData(C,this.map.painter,f==="reloadTile"),p(null))))}abortTile(s){s.request&&(s.request.cancel(),delete s.request),s.aborted=!0}unloadTile(s){s.unloadVectorData(),this.actor.send("removeTile",{uid:s.uid,type:this.type,source:this.id})}onRemove(){this._removed=!0,this.actor.send("removeSource",{type:this.type,source:this.id})}hasTransition(){return!1}}var hn=a.Q([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);class Ye extends a.E{constructor(s,p,f,y){super(),this.load=(x,C)=>{this._loaded=!1,this.fire(new a.k("dataloading",{dataType:"source"})),this.url=this.options.url,this._request=W.getImage(this.map._requestManager.transformRequest(this.url,U.Image),(M,L)=>{this._request=null,this._loaded=!0,M?this.fire(new a.j(M)):L&&(this.image=L,x&&(this.coordinates=x),C&&C(),this._finishLoading())})},this.prepare=()=>{if(Object.keys(this.tiles).length===0||!this.image)return;const x=this.map.painter.context,C=x.gl;this.boundsBuffer||(this.boundsBuffer=x.createVertexBuffer(this._boundsArray,hn.members)),this.boundsSegments||(this.boundsSegments=a.S.simpleSegment(0,0,4,2)),this.texture||(this.texture=new J(x,this.image,C.RGBA),this.texture.bind(C.LINEAR,C.CLAMP_TO_EDGE));let M=!1;for(const L in this.tiles){const N=this.tiles[L];N.state!=="loaded"&&(N.state="loaded",N.texture=this.texture,M=!0)}M&&this.fire(new a.k("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))},this.serialize=()=>({type:"image",url:this.options.url,coordinates:this.coordinates}),this.id=s,this.dispatcher=f,this.coordinates=p.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.setEventedParent(y),this.options=p}loaded(){return this._loaded}updateImage(s){return s.url?(this._request&&(this._request.cancel(),this._request=null),this.options.url=s.url,this.load(s.coordinates,()=>{this.texture=null}),this):this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new a.k("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(s){this.map=s,this.load()}onRemove(){this._request&&(this._request.cancel(),this._request=null)}setCoordinates(s){this.coordinates=s;const p=s.map(a.U.fromLngLat);this.tileID=function(y){let x=1/0,C=1/0,M=-1/0,L=-1/0;for(const H of y)x=Math.min(x,H.x),C=Math.min(C,H.y),M=Math.max(M,H.x),L=Math.max(L,H.y);const N=Math.max(M-x,L-C),z=Math.max(0,Math.floor(-Math.log(N)/Math.LN2)),B=Math.pow(2,z);return new a.W(z,Math.floor((x+M)/2*B),Math.floor((C+L)/2*B))}(p),this.minzoom=this.maxzoom=this.tileID.z;const f=p.map(y=>this.tileID.getTilePoint(y)._round());return this._boundsArray=new a.V,this._boundsArray.emplaceBack(f[0].x,f[0].y,0,0),this._boundsArray.emplaceBack(f[1].x,f[1].y,a.N,0),this._boundsArray.emplaceBack(f[3].x,f[3].y,0,a.N),this._boundsArray.emplaceBack(f[2].x,f[2].y,a.N,a.N),this.boundsBuffer&&(this.boundsBuffer.destroy(),delete this.boundsBuffer),this.fire(new a.k("data",{dataType:"source",sourceDataType:"content"})),this}loadTile(s,p){this.tileID&&this.tileID.equals(s.tileID.canonical)?(this.tiles[String(s.tileID.wrap)]=s,s.buckets={},p(null)):(s.state="errored",p(null))}hasTransition(){return!1}}class na extends Ye{constructor(s,p,f,y){super(s,p,f,y),this.load=()=>{this._loaded=!1;const x=this.options;this.urls=[];for(const C of x.urls)this.urls.push(this.map._requestManager.transformRequest(C,U.Source).url);a.X(this.urls,(C,M)=>{this._loaded=!0,C?this.fire(new a.j(C)):M&&(this.video=M,this.video.loop=!0,this.video.addEventListener("playing",()=>{this.map.triggerRepaint()}),this.map&&this.video.play(),this._finishLoading())})},this.prepare=()=>{if(Object.keys(this.tiles).length===0||this.video.readyState<2)return;const x=this.map.painter.context,C=x.gl;this.boundsBuffer||(this.boundsBuffer=x.createVertexBuffer(this._boundsArray,hn.members)),this.boundsSegments||(this.boundsSegments=a.S.simpleSegment(0,0,4,2)),this.texture?this.video.paused||(this.texture.bind(C.LINEAR,C.CLAMP_TO_EDGE),C.texSubImage2D(C.TEXTURE_2D,0,0,0,C.RGBA,C.UNSIGNED_BYTE,this.video)):(this.texture=new J(x,this.video,C.RGBA),this.texture.bind(C.LINEAR,C.CLAMP_TO_EDGE));let M=!1;for(const L in this.tiles){const N=this.tiles[L];N.state!=="loaded"&&(N.state="loaded",N.texture=this.texture,M=!0)}M&&this.fire(new a.k("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))},this.serialize=()=>({type:"video",urls:this.urls,coordinates:this.coordinates}),this.roundZoom=!0,this.type="video",this.options=p}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(s){if(this.video){const p=this.video.seekable;s<p.start(0)||s>p.end(0)?this.fire(new a.j(new a.Y(`sources.${this.id}`,null,`Playback for this video can be set only between the ${p.start(0)} and ${p.end(0)}-second mark.`))):this.video.currentTime=s}}getVideo(){return this.video}onAdd(s){this.map||(this.map=s,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}hasTransition(){return this.video&&!this.video.paused}}class ls extends Ye{constructor(s,p,f,y){super(s,p,f,y),this.load=()=>{this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof HTMLCanvasElement?this.options.canvas:document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new a.j(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())},this.prepare=()=>{let x=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,x=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,x=!0),this._hasInvalidDimensions()||Object.keys(this.tiles).length===0)return;const C=this.map.painter.context,M=C.gl;this.boundsBuffer||(this.boundsBuffer=C.createVertexBuffer(this._boundsArray,hn.members)),this.boundsSegments||(this.boundsSegments=a.S.simpleSegment(0,0,4,2)),this.texture?(x||this._playing)&&this.texture.update(this.canvas,{premultiply:!0}):this.texture=new J(C,this.canvas,M.RGBA,{premultiply:!0});let L=!1;for(const N in this.tiles){const z=this.tiles[N];z.state!=="loaded"&&(z.state="loaded",z.texture=this.texture,L=!0)}L&&this.fire(new a.k("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))},this.serialize=()=>({type:"canvas",coordinates:this.coordinates}),p.coordinates?Array.isArray(p.coordinates)&&p.coordinates.length===4&&!p.coordinates.some(x=>!Array.isArray(x)||x.length!==2||x.some(C=>typeof C!="number"))||this.fire(new a.j(new a.Y(`sources.${s}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new a.j(new a.Y(`sources.${s}`,null,'missing required property "coordinates"'))),p.animate&&typeof p.animate!="boolean"&&this.fire(new a.j(new a.Y(`sources.${s}`,null,'optional "animate" property must be a boolean value'))),p.canvas?typeof p.canvas=="string"||p.canvas instanceof HTMLCanvasElement||this.fire(new a.j(new a.Y(`sources.${s}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new a.j(new a.Y(`sources.${s}`,null,'missing required property "canvas"'))),this.options=p,this.animate=p.animate===void 0||p.animate}getCanvas(){return this.canvas}onAdd(s){this.map=s,this.load(),this.canvas&&this.animate&&this.play()}onRemove(){this.pause()}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const s of[this.canvas.width,this.canvas.height])if(isNaN(s)||s<=0)return!0;return!1}}const Io={},cr=v=>{switch(v){case"geojson":return co;case"image":return Ye;case"raster":return jr;case"raster-dem":return ln;case"vector":return br;case"video":return na;case"canvas":return ls}return Io[v]};function pn(v,s){const p=a.Z();return a.$(p,p,[1,1,0]),a.a0(p,p,[.5*v.width,.5*v.height,1]),a.a1(p,p,v.calculatePosMatrix(s.toUnwrapped()))}function Re(v,s,p,f,y,x){const C=function(B,H,lt){if(B)for(const ut of B){const ht=H[ut];if(ht&&ht.source===lt&&ht.type==="fill-extrusion")return!0}else for(const ut in H){const ht=H[ut];if(ht.source===lt&&ht.type==="fill-extrusion")return!0}return!1}(y&&y.layers,s,v.id),M=x.maxPitchScaleFactor(),L=v.tilesIn(f,M,C);L.sort(us);const N=[];for(const B of L)N.push({wrappedTileID:B.tileID.wrapped().key,queryResults:B.tile.queryRenderedFeatures(s,p,v._state,B.queryGeometry,B.cameraQueryGeometry,B.scale,y,x,M,pn(v.transform,B.tileID))});const z=function(B){const H={},lt={};for(const ut of B){const ht=ut.queryResults,st=ut.wrappedTileID,Mt=lt[st]=lt[st]||{};for(const Ft in ht){const yt=ht[Ft],Pt=Mt[Ft]=Mt[Ft]||{},Vt=H[Ft]=H[Ft]||[];for(const qt of yt)Pt[qt.featureIndex]||(Pt[qt.featureIndex]=!0,Vt.push(qt))}}return H}(N);for(const B in z)z[B].forEach(H=>{const lt=H.feature,ut=v.getFeatureState(lt.layer["source-layer"],lt.id);lt.source=lt.layer.source,lt.layer["source-layer"]&&(lt.sourceLayer=lt.layer["source-layer"]),lt.state=ut});return z}function us(v,s){const p=v.tileID,f=s.tileID;return p.overscaledZ-f.overscaledZ||p.canonical.y-f.canonical.y||p.wrap-f.wrap||p.canonical.x-f.canonical.x}class _i{constructor(s,p){this.timeAdded=0,this.fadeEndTime=0,this.tileID=s,this.uid=a.a2(),this.uses=0,this.tileSize=p,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.rtt=[],this.rttCoords={},this.expiredRequestCount=0,this.state="loading"}registerFadeDuration(s){const p=s+this.timeAdded;p<this.fadeEndTime||(this.fadeEndTime=p)}wasRequested(){return this.state==="errored"||this.state==="loaded"||this.state==="reloading"}clearTextures(s){this.demTexture&&s.saveTileTexture(this.demTexture),this.demTexture=null}loadVectorData(s,p,f){if(this.hasData()&&this.unloadVectorData(),this.state="loaded",s){s.featureIndex&&(this.latestFeatureIndex=s.featureIndex,s.rawTileData?(this.latestRawTileData=s.rawTileData,this.latestFeatureIndex.rawTileData=s.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=s.collisionBoxArray,this.buckets=function(y,x){const C={};if(!x)return C;for(const M of y){const L=M.layerIds.map(N=>x.getLayer(N)).filter(Boolean);if(L.length!==0){M.layers=L,M.stateDependentLayerIds&&(M.stateDependentLayers=M.stateDependentLayerIds.map(N=>L.filter(z=>z.id===N)[0]));for(const N of L)C[N.id]=M}}return C}(s.buckets,p.style),this.hasSymbolBuckets=!1;for(const y in this.buckets){const x=this.buckets[y];if(x instanceof a.a4){if(this.hasSymbolBuckets=!0,!f)break;x.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const y in this.buckets){const x=this.buckets[y];if(x instanceof a.a4&&x.hasRTLText){this.hasRTLText=!0,a.a5();break}}this.queryPadding=0;for(const y in this.buckets){const x=this.buckets[y];this.queryPadding=Math.max(this.queryPadding,p.style.getLayer(y).queryRadius(x))}s.imageAtlas&&(this.imageAtlas=s.imageAtlas),s.glyphAtlasImage&&(this.glyphAtlasImage=s.glyphAtlasImage)}else this.collisionBoxArray=new a.a3}unloadVectorData(){for(const s in this.buckets)this.buckets[s].destroy();this.buckets={},this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.imageAtlas&&(this.imageAtlas=null),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.latestFeatureIndex=null,this.state="unloaded"}getBucket(s){return this.buckets[s.id]}upload(s){for(const f in this.buckets){const y=this.buckets[f];y.uploadPending()&&y.upload(s)}const p=s.gl;this.imageAtlas&&!this.imageAtlas.uploaded&&(this.imageAtlasTexture=new J(s,this.imageAtlas.image,p.RGBA),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new J(s,this.glyphAtlasImage,p.ALPHA),this.glyphAtlasImage=null)}prepare(s){this.imageAtlas&&this.imageAtlas.patchUpdatedImages(s,this.imageAtlasTexture)}queryRenderedFeatures(s,p,f,y,x,C,M,L,N,z){return this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData?this.latestFeatureIndex.query({queryGeometry:y,cameraQueryGeometry:x,scale:C,tileSize:this.tileSize,pixelPosMatrix:z,transform:L,params:M,queryPadding:this.queryPadding*N},s,p,f):{}}querySourceFeatures(s,p){const f=this.latestFeatureIndex;if(!f||!f.rawTileData)return;const y=f.loadVTLayers(),x=p&&p.sourceLayer?p.sourceLayer:"",C=y._geojsonTileLayer||y[x];if(!C)return;const M=a.a6(p&&p.filter),{z:L,x:N,y:z}=this.tileID.canonical,B={z:L,x:N,y:z};for(let H=0;H<C.length;H++){const lt=C.feature(H);if(M.needGeometry){const st=a.a7(lt,!0);if(!M.filter(new a.a8(this.tileID.overscaledZ),st,this.tileID.canonical))continue}else if(!M.filter(new a.a8(this.tileID.overscaledZ),lt))continue;const ut=f.getId(lt,x),ht=new a.a9(lt,L,N,z,ut);ht.tile=B,s.push(ht)}}hasData(){return this.state==="loaded"||this.state==="reloading"||this.state==="expired"}patternsLoaded(){return this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length}setExpiryData(s){const p=this.expirationTime;if(s.cacheControl){const f=a.aa(s.cacheControl);f["max-age"]&&(this.expirationTime=Date.now()+1e3*f["max-age"])}else s.expires&&(this.expirationTime=new Date(s.expires).getTime());if(this.expirationTime){const f=Date.now();let y=!1;if(this.expirationTime>f)y=!1;else if(p)if(this.expirationTime<p)y=!0;else{const x=this.expirationTime-p;x?this.expirationTime=f+Math.max(x,3e4):y=!0}else y=!0;y?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-new Date().getTime(),Math.pow(2,31)-1)}setFeatureState(s,p){if(!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData||Object.keys(s).length===0)return;const f=this.latestFeatureIndex.loadVTLayers();for(const y in this.buckets){if(!p.style.hasLayer(y))continue;const x=this.buckets[y],C=x.layers[0].sourceLayer||"_geojsonTileLayer",M=f[C],L=s[C];if(!M||!L||Object.keys(L).length===0)continue;x.update(L,M,this.imageAtlas&&this.imageAtlas.patternPositions||{});const N=p&&p.style&&p.style.getLayer(y);N&&(this.queryPadding=Math.max(this.queryPadding,N.queryRadius(x)))}}holdingForFade(){return this.symbolFadeHoldUntil!==void 0}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<a.h.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(s){this.symbolFadeHoldUntil=a.h.now()+s}setDependencies(s,p){const f={};for(const y of p)f[y]=!0;this.dependencies[s]=f}hasDependency(s,p){for(const f of s){const y=this.dependencies[f];if(y){for(const x of p)if(y[x])return!0}}return!1}}class Kr{constructor(s,p){this.max=s,this.onRemove=p,this.reset()}reset(){for(const s in this.data)for(const p of this.data[s])p.timeout&&clearTimeout(p.timeout),this.onRemove(p.value);return this.data={},this.order=[],this}add(s,p,f){const y=s.wrapped().key;this.data[y]===void 0&&(this.data[y]=[]);const x={value:p,timeout:void 0};if(f!==void 0&&(x.timeout=setTimeout(()=>{this.remove(s,x)},f)),this.data[y].push(x),this.order.push(y),this.order.length>this.max){const C=this._getAndRemoveByKey(this.order[0]);C&&this.onRemove(C)}return this}has(s){return s.wrapped().key in this.data}getAndRemove(s){return this.has(s)?this._getAndRemoveByKey(s.wrapped().key):null}_getAndRemoveByKey(s){const p=this.data[s].shift();return p.timeout&&clearTimeout(p.timeout),this.data[s].length===0&&delete this.data[s],this.order.splice(this.order.indexOf(s),1),p.value}getByKey(s){const p=this.data[s];return p?p[0].value:null}get(s){return this.has(s)?this.data[s.wrapped().key][0].value:null}remove(s,p){if(!this.has(s))return this;const f=s.wrapped().key,y=p===void 0?0:this.data[f].indexOf(p),x=this.data[f][y];return this.data[f].splice(y,1),x.timeout&&clearTimeout(x.timeout),this.data[f].length===0&&delete this.data[f],this.onRemove(x.value),this.order.splice(this.order.indexOf(f),1),this}setMaxSize(s){for(this.max=s;this.order.length>this.max;){const p=this._getAndRemoveByKey(this.order[0]);p&&this.onRemove(p)}return this}filter(s){const p=[];for(const f in this.data)for(const y of this.data[f])s(y.value)||p.push(y);for(const f of p)this.remove(f.value.tileID,f)}}class Gt{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(s,p,f){const y=String(p);if(this.stateChanges[s]=this.stateChanges[s]||{},this.stateChanges[s][y]=this.stateChanges[s][y]||{},a.e(this.stateChanges[s][y],f),this.deletedStates[s]===null){this.deletedStates[s]={};for(const x in this.state[s])x!==y&&(this.deletedStates[s][x]=null)}else if(this.deletedStates[s]&&this.deletedStates[s][y]===null){this.deletedStates[s][y]={};for(const x in this.state[s][y])f[x]||(this.deletedStates[s][y][x]=null)}else for(const x in f)this.deletedStates[s]&&this.deletedStates[s][y]&&this.deletedStates[s][y][x]===null&&delete this.deletedStates[s][y][x]}removeFeatureState(s,p,f){if(this.deletedStates[s]===null)return;const y=String(p);if(this.deletedStates[s]=this.deletedStates[s]||{},f&&p!==void 0)this.deletedStates[s][y]!==null&&(this.deletedStates[s][y]=this.deletedStates[s][y]||{},this.deletedStates[s][y][f]=null);else if(p!==void 0)if(this.stateChanges[s]&&this.stateChanges[s][y])for(f in this.deletedStates[s][y]={},this.stateChanges[s][y])this.deletedStates[s][y][f]=null;else this.deletedStates[s][y]=null;else this.deletedStates[s]=null}getState(s,p){const f=String(p),y=a.e({},(this.state[s]||{})[f],(this.stateChanges[s]||{})[f]);if(this.deletedStates[s]===null)return{};if(this.deletedStates[s]){const x=this.deletedStates[s][p];if(x===null)return{};for(const C in x)delete y[C]}return y}initializeTileState(s,p){s.setFeatureState(this.state,p)}coalesceChanges(s,p){const f={};for(const y in this.stateChanges){this.state[y]=this.state[y]||{};const x={};for(const C in this.stateChanges[y])this.state[y][C]||(this.state[y][C]={}),a.e(this.state[y][C],this.stateChanges[y][C]),x[C]=this.state[y][C];f[y]=x}for(const y in this.deletedStates){this.state[y]=this.state[y]||{};const x={};if(this.deletedStates[y]===null)for(const C in this.state[y])x[C]={},this.state[y][C]={};else for(const C in this.deletedStates[y]){if(this.deletedStates[y][C]===null)this.state[y][C]={};else for(const M of Object.keys(this.deletedStates[y][C]))delete this.state[y][C][M];x[C]=this.state[y][C]}f[y]=f[y]||{},a.e(f[y],x)}if(this.stateChanges={},this.deletedStates={},Object.keys(f).length!==0)for(const y in s)s[y].setFeatureState(f,p)}}class vi extends a.E{constructor(s,p,f){super(),this.id=s,this.dispatcher=f,this.on("data",y=>{y.dataType==="source"&&y.sourceDataType==="metadata"&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&y.dataType==="source"&&y.sourceDataType==="content"&&(this.reload(),this.transform&&this.update(this.transform,this.terrain),this._didEmitContent=!0)}),this.on("dataloading",()=>{this._sourceErrored=!1}),this.on("error",()=>{this._sourceErrored=this._source.loaded()}),this._source=((y,x,C,M)=>{const L=new(cr(x.type))(y,x,C,M);if(L.id!==y)throw new Error(`Expected Source id to be ${y} instead of ${L.id}`);return L})(s,p,f,this),this._tiles={},this._cache=new Kr(0,this._unloadTile.bind(this)),this._timers={},this._cacheTimers={},this._maxTileCacheSize=null,this._maxTileCacheZoomLevels=null,this._loadedParentTiles={},this._coveredTiles={},this._state=new Gt,this._didEmitContent=!1,this._updated=!1}onAdd(s){this.map=s,this._maxTileCacheSize=s?s._maxTileCacheSize:null,this._maxTileCacheZoomLevels=s?s._maxTileCacheZoomLevels:null,this._source&&this._source.onAdd&&this._source.onAdd(s)}onRemove(s){this.clearTiles(),this._source&&this._source.onRemove&&this._source.onRemove(s)}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;if(!(this.used===void 0&&this.usedForTerrain===void 0||this.used||this.usedForTerrain))return!0;if(!this._updated)return!1;for(const s in this._tiles){const p=this._tiles[s];if(p.state!=="loaded"&&p.state!=="errored")return!1}return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;const s=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,s&&this.reload(),this.transform&&this.update(this.transform,this.terrain)}_loadTile(s,p){return this._source.loadTile(s,p)}_unloadTile(s){if(this._source.unloadTile)return this._source.unloadTile(s,()=>{})}_abortTile(s){this._source.abortTile&&this._source.abortTile(s,()=>{}),this._source.fire(new a.k("dataabort",{tile:s,coord:s.tileID,dataType:"source"}))}serialize(){return this._source.serialize()}prepare(s){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null);for(const p in this._tiles){const f=this._tiles[p];f.upload(s),f.prepare(this.map.style.imageManager)}}getIds(){return Object.values(this._tiles).map(s=>s.tileID).sort(xi).map(s=>s.key)}getRenderableIds(s){const p=[];for(const f in this._tiles)this._isIdRenderable(f,s)&&p.push(this._tiles[f]);return s?p.sort((f,y)=>{const x=f.tileID,C=y.tileID,M=new a.P(x.canonical.x,x.canonical.y)._rotate(this.transform.angle),L=new a.P(C.canonical.x,C.canonical.y)._rotate(this.transform.angle);return x.overscaledZ-C.overscaledZ||L.y-M.y||L.x-M.x}).map(f=>f.tileID.key):p.map(f=>f.tileID).sort(xi).map(f=>f.key)}hasRenderableParent(s){const p=this.findLoadedParent(s,0);return!!p&&this._isIdRenderable(p.tileID.key)}_isIdRenderable(s,p){return this._tiles[s]&&this._tiles[s].hasData()&&!this._coveredTiles[s]&&(p||!this._tiles[s].holdingForFade())}reload(){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(const s in this._tiles)this._tiles[s].state!=="errored"&&this._reloadTile(s,"reloading")}}_reloadTile(s,p){const f=this._tiles[s];f&&(f.state!=="loading"&&(f.state=p),this._loadTile(f,this._tileLoaded.bind(this,f,s,p)))}_tileLoaded(s,p,f,y){if(y)return s.state="errored",void(y.status!==404?this._source.fire(new a.j(y,{tile:s})):this.update(this.transform,this.terrain));s.timeAdded=a.h.now(),f==="expired"&&(s.refreshedUponExpiration=!0),this._setTileReloadTimer(p,s),this.getSource().type==="raster-dem"&&s.dem&&this._backfillDEM(s),this._state.initializeTileState(s,this.map?this.map.painter:null),s.aborted||this._source.fire(new a.k("data",{dataType:"source",tile:s,coord:s.tileID}))}_backfillDEM(s){const p=this.getRenderableIds();for(let y=0;y<p.length;y++){const x=p[y];if(s.neighboringTiles&&s.neighboringTiles[x]){const C=this.getTileByID(x);f(s,C),f(C,s)}}function f(y,x){y.needsHillshadePrepare=!0,y.needsTerrainPrepare=!0;let C=x.tileID.canonical.x-y.tileID.canonical.x;const M=x.tileID.canonical.y-y.tileID.canonical.y,L=Math.pow(2,y.tileID.canonical.z),N=x.tileID.key;C===0&&M===0||Math.abs(M)>1||(Math.abs(C)>1&&(Math.abs(C+L)===1?C+=L:Math.abs(C-L)===1&&(C-=L)),x.dem&&y.dem&&(y.dem.backfillBorder(x.dem,C,M),y.neighboringTiles&&y.neighboringTiles[N]&&(y.neighboringTiles[N].backfilled=!0)))}}getTile(s){return this.getTileByID(s.key)}getTileByID(s){return this._tiles[s]}_retainLoadedChildren(s,p,f,y){for(const x in this._tiles){let C=this._tiles[x];if(y[x]||!C.hasData()||C.tileID.overscaledZ<=p||C.tileID.overscaledZ>f)continue;let M=C.tileID;for(;C&&C.tileID.overscaledZ>p+1;){const N=C.tileID.scaledTo(C.tileID.overscaledZ-1);C=this._tiles[N.key],C&&C.hasData()&&(M=N)}let L=M;for(;L.overscaledZ>p;)if(L=L.scaledTo(L.overscaledZ-1),s[L.key]){y[M.key]=M;break}}}findLoadedParent(s,p){if(s.key in this._loadedParentTiles){const f=this._loadedParentTiles[s.key];return f&&f.tileID.overscaledZ>=p?f:null}for(let f=s.overscaledZ-1;f>=p;f--){const y=s.scaledTo(f),x=this._getLoadedTile(y);if(x)return x}}_getLoadedTile(s){const p=this._tiles[s.key];return p&&p.hasData()?p:this._cache.getByKey(s.wrapped().key)}updateCacheSize(s){const p=Math.ceil(s.width/this._source.tileSize)+1,f=Math.ceil(s.height/this._source.tileSize)+1,y=Math.floor(p*f*(this._maxTileCacheZoomLevels===null?a.c.MAX_TILE_CACHE_ZOOM_LEVELS:this._maxTileCacheZoomLevels)),x=typeof this._maxTileCacheSize=="number"?Math.min(this._maxTileCacheSize,y):y;this._cache.setMaxSize(x)}handleWrapJump(s){const p=Math.round((s-(this._prevLng===void 0?s:this._prevLng))/360);if(this._prevLng=s,p){const f={};for(const y in this._tiles){const x=this._tiles[y];x.tileID=x.tileID.unwrapTo(x.tileID.wrap+p),f[x.tileID.key]=x}this._tiles=f;for(const y in this._timers)clearTimeout(this._timers[y]),delete this._timers[y];for(const y in this._tiles)this._setTileReloadTimer(y,this._tiles[y])}}update(s,p){if(this.transform=s,this.terrain=p,!this._sourceLoaded||this._paused)return;let f;this.updateCacheSize(s),this.handleWrapJump(this.transform.center.lng),this._coveredTiles={},this.used||this.usedForTerrain?this._source.tileID?f=s.getVisibleUnwrappedCoordinates(this._source.tileID).map(z=>new a.O(z.canonical.z,z.wrap,z.canonical.z,z.canonical.x,z.canonical.y)):(f=s.coveringTiles({tileSize:this.usedForTerrain?this.tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:!this.usedForTerrain&&this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled,terrain:p}),this._source.hasTile&&(f=f.filter(z=>this._source.hasTile(z)))):f=[];const y=s.coveringZoomLevel(this._source),x=Math.max(y-vi.maxOverzooming,this._source.minzoom),C=Math.max(y+vi.maxUnderzooming,this._source.minzoom);if(this.usedForTerrain){const z={};for(const B of f)if(B.canonical.z>this._source.minzoom){const H=B.scaledTo(B.canonical.z-1);z[H.key]=H;const lt=B.scaledTo(Math.max(this._source.minzoom,Math.min(B.canonical.z,5)));z[lt.key]=lt}f=f.concat(Object.values(z))}const M=f.length===0&&!this._updated&&this._didEmitContent;this._updated=!0,M&&this.fire(new a.k("data",{sourceDataType:"idle",dataType:"source",sourceId:this.id}));const L=this._updateRetainedTiles(f,y);if(Or(this._source.type)){const z={},B={},H=Object.keys(L),lt=a.h.now();for(const ut of H){const ht=L[ut],st=this._tiles[ut];if(!st||st.fadeEndTime!==0&&st.fadeEndTime<=lt)continue;const Mt=this.findLoadedParent(ht,x);Mt&&(this._addTile(Mt.tileID),z[Mt.tileID.key]=Mt.tileID),B[ut]=ht}this._retainLoadedChildren(B,y,C,L);for(const ut in z)L[ut]||(this._coveredTiles[ut]=!0,L[ut]=z[ut]);if(p){const ut={},ht={};for(const st of f)this._tiles[st.key].hasData()?ut[st.key]=st:ht[st.key]=st;for(const st in ht){const Mt=ht[st].children(this._source.maxzoom);this._tiles[Mt[0].key]&&this._tiles[Mt[1].key]&&this._tiles[Mt[2].key]&&this._tiles[Mt[3].key]&&(ut[Mt[0].key]=L[Mt[0].key]=Mt[0],ut[Mt[1].key]=L[Mt[1].key]=Mt[1],ut[Mt[2].key]=L[Mt[2].key]=Mt[2],ut[Mt[3].key]=L[Mt[3].key]=Mt[3],delete ht[st])}for(const st in ht){const Mt=this.findLoadedParent(ht[st],this._source.minzoom);if(Mt){ut[Mt.tileID.key]=L[Mt.tileID.key]=Mt.tileID;for(const Ft in ut)ut[Ft].isChildOf(Mt.tileID)&&delete ut[Ft]}}for(const st in this._tiles)ut[st]||(this._coveredTiles[st]=!0)}}for(const z in L)this._tiles[z].clearFadeHold();const N=a.ab(this._tiles,L);for(const z of N){const B=this._tiles[z];B.hasSymbolBuckets&&!B.holdingForFade()?B.setHoldDuration(this.map._fadeDuration):B.hasSymbolBuckets&&!B.symbolFadeFinished()||this._removeTile(z)}this._updateLoadedParentTileCache()}releaseSymbolFadeTiles(){for(const s in this._tiles)this._tiles[s].holdingForFade()&&this._removeTile(s)}_updateRetainedTiles(s,p){const f={},y={},x=Math.max(p-vi.maxOverzooming,this._source.minzoom),C=Math.max(p+vi.maxUnderzooming,this._source.minzoom),M={};for(const L of s){const N=this._addTile(L);f[L.key]=L,N.hasData()||p<this._source.maxzoom&&(M[L.key]=L)}this._retainLoadedChildren(M,p,C,f);for(const L of s){let N=this._tiles[L.key];if(N.hasData())continue;if(p+1>this._source.maxzoom){const B=L.children(this._source.maxzoom)[0],H=this.getTile(B);if(H&&H.hasData()){f[B.key]=B;continue}}else{const B=L.children(this._source.maxzoom);if(f[B[0].key]&&f[B[1].key]&&f[B[2].key]&&f[B[3].key])continue}let z=N.wasRequested();for(let B=L.overscaledZ-1;B>=x;--B){const H=L.scaledTo(B);if(y[H.key])break;if(y[H.key]=!0,N=this.getTile(H),!N&&z&&(N=this._addTile(H)),N){const lt=N.hasData();if((z||lt)&&(f[H.key]=H),z=N.wasRequested(),lt)break}}}return f}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(const s in this._tiles){const p=[];let f,y=this._tiles[s].tileID;for(;y.overscaledZ>0;){if(y.key in this._loadedParentTiles){f=this._loadedParentTiles[y.key];break}p.push(y.key);const x=y.scaledTo(y.overscaledZ-1);if(f=this._getLoadedTile(x),f)break;y=x}for(const x of p)this._loadedParentTiles[x]=f}}_addTile(s){let p=this._tiles[s.key];if(p)return p;p=this._cache.getAndRemove(s),p&&(this._setTileReloadTimer(s.key,p),p.tileID=s,this._state.initializeTileState(p,this.map?this.map.painter:null),this._cacheTimers[s.key]&&(clearTimeout(this._cacheTimers[s.key]),delete this._cacheTimers[s.key],this._setTileReloadTimer(s.key,p)));const f=p;return p||(p=new _i(s,this._source.tileSize*s.overscaleFactor()),this._loadTile(p,this._tileLoaded.bind(this,p,s.key,p.state))),p.uses++,this._tiles[s.key]=p,f||this._source.fire(new a.k("dataloading",{tile:p,coord:p.tileID,dataType:"source"})),p}_setTileReloadTimer(s,p){s in this._timers&&(clearTimeout(this._timers[s]),delete this._timers[s]);const f=p.getExpiryTimeout();f&&(this._timers[s]=setTimeout(()=>{this._reloadTile(s,"expired"),delete this._timers[s]},f))}_removeTile(s){const p=this._tiles[s];p&&(p.uses--,delete this._tiles[s],this._timers[s]&&(clearTimeout(this._timers[s]),delete this._timers[s]),p.uses>0||(p.hasData()&&p.state!=="reloading"?this._cache.add(p.tileID,p,p.getExpiryTimeout()):(p.aborted=!0,this._abortTile(p),this._unloadTile(p))))}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const s in this._tiles)this._removeTile(s);this._cache.reset()}tilesIn(s,p,f){const y=[],x=this.transform;if(!x)return y;const C=f?x.getCameraQueryGeometry(s):s,M=s.map(ut=>x.pointCoordinate(ut,this.terrain)),L=C.map(ut=>x.pointCoordinate(ut,this.terrain)),N=this.getIds();let z=1/0,B=1/0,H=-1/0,lt=-1/0;for(const ut of L)z=Math.min(z,ut.x),B=Math.min(B,ut.y),H=Math.max(H,ut.x),lt=Math.max(lt,ut.y);for(let ut=0;ut<N.length;ut++){const ht=this._tiles[N[ut]];if(ht.holdingForFade())continue;const st=ht.tileID,Mt=Math.pow(2,x.zoom-ht.tileID.overscaledZ),Ft=p*ht.queryPadding*a.N/ht.tileSize/Mt,yt=[st.getTilePoint(new a.U(z,B)),st.getTilePoint(new a.U(H,lt))];if(yt[0].x-Ft<a.N&&yt[0].y-Ft<a.N&&yt[1].x+Ft>=0&&yt[1].y+Ft>=0){const Pt=M.map(qt=>st.getTilePoint(qt)),Vt=L.map(qt=>st.getTilePoint(qt));y.push({tile:ht,tileID:st,queryGeometry:Pt,cameraQueryGeometry:Vt,scale:Mt})}}return y}getVisibleCoordinates(s){const p=this.getRenderableIds(s).map(f=>this._tiles[f].tileID);for(const f of p)f.posMatrix=this.transform.calculatePosMatrix(f.toUnwrapped());return p}hasTransition(){if(this._source.hasTransition())return!0;if(Or(this._source.type)){const s=a.h.now();for(const p in this._tiles)if(this._tiles[p].fadeEndTime>=s)return!0}return!1}setFeatureState(s,p,f){this._state.updateState(s=s||"_geojsonTileLayer",p,f)}removeFeatureState(s,p,f){this._state.removeFeatureState(s=s||"_geojsonTileLayer",p,f)}getFeatureState(s,p){return this._state.getState(s=s||"_geojsonTileLayer",p)}setDependencies(s,p,f){const y=this._tiles[s];y&&y.setDependencies(p,f)}reloadTilesForDependencies(s,p){for(const f in this._tiles)this._tiles[f].hasDependency(s,p)&&this._reloadTile(f,"reloading");this._cache.filter(f=>!f.hasDependency(s,p))}}function xi(v,s){const p=Math.abs(2*v.wrap)-+(v.wrap<0),f=Math.abs(2*s.wrap)-+(s.wrap<0);return v.overscaledZ-s.overscaledZ||f-p||s.canonical.y-v.canonical.y||s.canonical.x-v.canonical.x}function Or(v){return v==="raster"||v==="image"||v==="video"}vi.maxOverzooming=10,vi.maxUnderzooming=3;const yr="mapboxgl_preloaded_worker_pool";class ho{constructor(){this.active={}}acquire(s){if(!this.workers)for(this.workers=[];this.workers.length<ho.workerCount;)this.workers.push(new Worker(a.c.WORKER_URL));return this.active[s]=!0,this.workers.slice()}release(s){delete this.active[s],this.numActive()===0&&(this.workers.forEach(p=>{p.terminate()}),this.workers=null)}isPreloaded(){return!!this.active[yr]}numActive(){return Object.keys(this.active).length}}const Co=Math.floor(a.h.hardwareConcurrency/2);let ai;function ia(){return ai||(ai=new ho),ai}ho.workerCount=a.ac(globalThis)?Math.max(Math.min(Co,3),1):1;class cs{constructor(s,p){this.reset(s,p)}reset(s,p){this.points=s||[],this._distances=[0];for(let f=1;f<this.points.length;f++)this._distances[f]=this._distances[f-1]+this.points[f].dist(this.points[f-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(p||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(s){if(this.points.length===1)return this.points[0];s=a.ad(s,0,1);let p=1,f=this._distances[p];const y=s*this.paddedLength+this.padding;for(;f<y&&p<this._distances.length;)f=this._distances[++p];const x=p-1,C=this._distances[x],M=f-C,L=M>0?(y-C)/M:0;return this.points[x].mult(1-L).add(this.points[p].mult(L))}}function Ji(v,s){let p=!0;return v==="always"||v!=="never"&&s!=="never"||(p=!1),p}class hs{constructor(s,p,f){const y=this.boxCells=[],x=this.circleCells=[];this.xCellCount=Math.ceil(s/f),this.yCellCount=Math.ceil(p/f);for(let C=0;C<this.xCellCount*this.yCellCount;C++)y.push([]),x.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=s,this.height=p,this.xScale=this.xCellCount/s,this.yScale=this.yCellCount/p,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(s,p,f,y,x){this._forEachCell(p,f,y,x,this._insertBoxCell,this.boxUid++),this.boxKeys.push(s),this.bboxes.push(p),this.bboxes.push(f),this.bboxes.push(y),this.bboxes.push(x)}insertCircle(s,p,f,y){this._forEachCell(p-y,f-y,p+y,f+y,this._insertCircleCell,this.circleUid++),this.circleKeys.push(s),this.circles.push(p),this.circles.push(f),this.circles.push(y)}_insertBoxCell(s,p,f,y,x,C){this.boxCells[x].push(C)}_insertCircleCell(s,p,f,y,x,C){this.circleCells[x].push(C)}_query(s,p,f,y,x,C,M){if(f<0||s>this.width||y<0||p>this.height)return[];const L=[];if(s<=0&&p<=0&&this.width<=f&&this.height<=y){if(x)return[{key:null,x1:s,y1:p,x2:f,y2:y}];for(let N=0;N<this.boxKeys.length;N++)L.push({key:this.boxKeys[N],x1:this.bboxes[4*N],y1:this.bboxes[4*N+1],x2:this.bboxes[4*N+2],y2:this.bboxes[4*N+3]});for(let N=0;N<this.circleKeys.length;N++){const z=this.circles[3*N],B=this.circles[3*N+1],H=this.circles[3*N+2];L.push({key:this.circleKeys[N],x1:z-H,y1:B-H,x2:z+H,y2:B+H})}}else this._forEachCell(s,p,f,y,this._queryCell,L,{hitTest:x,overlapMode:C,seenUids:{box:{},circle:{}}},M);return L}query(s,p,f,y){return this._query(s,p,f,y,!1,null)}hitTest(s,p,f,y,x,C){return this._query(s,p,f,y,!0,x,C).length>0}hitTestCircle(s,p,f,y,x){const C=s-f,M=s+f,L=p-f,N=p+f;if(M<0||C>this.width||N<0||L>this.height)return!1;const z=[];return this._forEachCell(C,L,M,N,this._queryCellCircle,z,{hitTest:!0,overlapMode:y,circle:{x:s,y:p,radius:f},seenUids:{box:{},circle:{}}},x),z.length>0}_queryCell(s,p,f,y,x,C,M,L){const{seenUids:N,hitTest:z,overlapMode:B}=M,H=this.boxCells[x];if(H!==null){const ut=this.bboxes;for(const ht of H)if(!N.box[ht]){N.box[ht]=!0;const st=4*ht,Mt=this.boxKeys[ht];if(s<=ut[st+2]&&p<=ut[st+3]&&f>=ut[st+0]&&y>=ut[st+1]&&(!L||L(Mt))&&(!z||!Ji(B,Mt.overlapMode))&&(C.push({key:Mt,x1:ut[st],y1:ut[st+1],x2:ut[st+2],y2:ut[st+3]}),z))return!0}}const lt=this.circleCells[x];if(lt!==null){const ut=this.circles;for(const ht of lt)if(!N.circle[ht]){N.circle[ht]=!0;const st=3*ht,Mt=this.circleKeys[ht];if(this._circleAndRectCollide(ut[st],ut[st+1],ut[st+2],s,p,f,y)&&(!L||L(Mt))&&(!z||!Ji(B,Mt.overlapMode))){const Ft=ut[st],yt=ut[st+1],Pt=ut[st+2];if(C.push({key:Mt,x1:Ft-Pt,y1:yt-Pt,x2:Ft+Pt,y2:yt+Pt}),z)return!0}}}return!1}_queryCellCircle(s,p,f,y,x,C,M,L){const{circle:N,seenUids:z,overlapMode:B}=M,H=this.boxCells[x];if(H!==null){const ut=this.bboxes;for(const ht of H)if(!z.box[ht]){z.box[ht]=!0;const st=4*ht,Mt=this.boxKeys[ht];if(this._circleAndRectCollide(N.x,N.y,N.radius,ut[st+0],ut[st+1],ut[st+2],ut[st+3])&&(!L||L(Mt))&&!Ji(B,Mt.overlapMode))return C.push(!0),!0}}const lt=this.circleCells[x];if(lt!==null){const ut=this.circles;for(const ht of lt)if(!z.circle[ht]){z.circle[ht]=!0;const st=3*ht,Mt=this.circleKeys[ht];if(this._circlesCollide(ut[st],ut[st+1],ut[st+2],N.x,N.y,N.radius)&&(!L||L(Mt))&&!Ji(B,Mt.overlapMode))return C.push(!0),!0}}}_forEachCell(s,p,f,y,x,C,M,L){const N=this._convertToXCellCoord(s),z=this._convertToYCellCoord(p),B=this._convertToXCellCoord(f),H=this._convertToYCellCoord(y);for(let lt=N;lt<=B;lt++)for(let ut=z;ut<=H;ut++)if(x.call(this,s,p,f,y,this.xCellCount*ut+lt,C,M,L))return}_convertToXCellCoord(s){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(s*this.xScale)))}_convertToYCellCoord(s){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(s*this.yScale)))}_circlesCollide(s,p,f,y,x,C){const M=y-s,L=x-p,N=f+C;return N*N>M*M+L*L}_circleAndRectCollide(s,p,f,y,x,C,M){const L=(C-y)/2,N=Math.abs(s-(y+L));if(N>L+f)return!1;const z=(M-x)/2,B=Math.abs(p-(x+z));if(B>z+f)return!1;if(N<=L||B<=z)return!0;const H=N-L,lt=B-z;return H*H+lt*lt<=f*f}}function oe(v,s,p,f,y){const x=a.Z();return s?(a.a0(x,x,[1/y,1/y,1]),p||a.ae(x,x,f.angle)):a.a1(x,f.labelPlaneMatrix,v),x}function po(v,s,p,f,y){if(s){const x=a.af(v);return a.a0(x,x,[y,y,1]),p||a.ae(x,x,-f.angle),x}return f.glCoordMatrix}function In(v,s,p){let f;p?(f=[v.x,v.y,p(v.x,v.y),1],a.ag(f,f,s)):(f=[v.x,v.y,0,1],pt(f,f,s));const y=f[3];return{point:new a.P(f[0]/y,f[1]/y),signedDistanceFromCamera:y}}function Ls(v,s){return .5+v/s*.5}function Ri(v,s){const p=v[0]/v[3],f=v[1]/v[3];return p>=-s[0]&&p<=s[0]&&f>=-s[1]&&f<=s[1]}function ce(v,s,p,f,y,x,C,M,L,N){const z=f?v.textSizeData:v.iconSizeData,B=a.ah(z,p.transform.zoom),H=[256/p.width*2+1,256/p.height*2+1],lt=f?v.text.dynamicLayoutVertexArray:v.icon.dynamicLayoutVertexArray;lt.clear();const ut=v.lineVertexArray,ht=f?v.text.placedSymbolArray:v.icon.placedSymbolArray,st=p.transform.width/p.transform.height;let Mt=!1;for(let Ft=0;Ft<ht.length;Ft++){const yt=ht.get(Ft);if(yt.hidden||yt.writingMode===a.ai.vertical&&!Mt){nt(yt.numGlyphs,lt);continue}let Pt;if(Mt=!1,N?(Pt=[yt.anchorX,yt.anchorY,N(yt.anchorX,yt.anchorY),1],a.ag(Pt,Pt,s)):(Pt=[yt.anchorX,yt.anchorY,0,1],pt(Pt,Pt,s)),!Ri(Pt,H)){nt(yt.numGlyphs,lt);continue}const Vt=Ls(p.transform.cameraToCenterDistance,Pt[3]),qt=a.aj(z,B,yt),Yt=C?qt/Vt:qt*Vt,ne=new a.P(yt.anchorX,yt.anchorY),Qt=In(ne,y,N).point,le={projections:{},offsets:{}},ke=Di(yt,Yt,!1,M,s,y,x,v.glyphOffsetArray,ut,lt,Qt,ne,le,st,L,N);Mt=ke.useVertical,(ke.notEnoughRoom||Mt||ke.needsFlipping&&Di(yt,Yt,!0,M,s,y,x,v.glyphOffsetArray,ut,lt,Qt,ne,le,st,L,N).notEnoughRoom)&&nt(yt.numGlyphs,lt)}f?v.text.dynamicLayoutVertexBuffer.updateData(lt):v.icon.dynamicLayoutVertexBuffer.updateData(lt)}function ar(v,s,p,f,y,x,C,M,L,N,z,B,H){const lt=M.glyphStartIndex+M.numGlyphs,ut=M.lineStartIndex,ht=M.lineStartIndex+M.lineLength,st=s.getoffsetX(M.glyphStartIndex),Mt=s.getoffsetX(lt-1),Ft=q(v*st,p,f,y,x,C,M.segment,ut,ht,L,N,z,B,H);if(!Ft)return null;const yt=q(v*Mt,p,f,y,x,C,M.segment,ut,ht,L,N,z,B,H);return yt?{first:Ft,last:yt}:null}function He(v,s,p,f){return v===a.ai.horizontal&&Math.abs(p.y-s.y)>Math.abs(p.x-s.x)*f?{useVertical:!0}:(v===a.ai.vertical?s.y<p.y:s.x>p.x)?{needsFlipping:!0}:null}function Di(v,s,p,f,y,x,C,M,L,N,z,B,H,lt,ut,ht){const st=s/24,Mt=v.lineOffsetX*st,Ft=v.lineOffsetY*st;let yt;if(v.numGlyphs>1){const Pt=v.glyphStartIndex+v.numGlyphs,Vt=v.lineStartIndex,qt=v.lineStartIndex+v.lineLength,Yt=ar(st,M,Mt,Ft,p,z,B,v,L,x,H,ut,ht);if(!Yt)return{notEnoughRoom:!0};const ne=In(Yt.first.point,C,ht).point,Qt=In(Yt.last.point,C,ht).point;if(f&&!p){const le=He(v.writingMode,ne,Qt,lt);if(le)return le}yt=[Yt.first];for(let le=v.glyphStartIndex+1;le<Pt-1;le++)yt.push(q(st*M.getoffsetX(le),Mt,Ft,p,z,B,v.segment,Vt,qt,L,x,H,ut,ht));yt.push(Yt.last)}else{if(f&&!p){const Vt=In(B,y,ht).point,qt=v.lineStartIndex+v.segment+1,Yt=new a.P(L.getx(qt),L.gety(qt)),ne=In(Yt,y,ht),Qt=ne.signedDistanceFromCamera>0?ne.point:fo(B,Yt,Vt,1,y,ht),le=He(v.writingMode,Vt,Qt,lt);if(le)return le}const Pt=q(st*M.getoffsetX(v.glyphStartIndex),Mt,Ft,p,z,B,v.segment,v.lineStartIndex,v.lineStartIndex+v.lineLength,L,x,H,ut,ht);if(!Pt)return{notEnoughRoom:!0};yt=[Pt]}for(const Pt of yt)a.ak(N,Pt.point,Pt.angle);return{}}function fo(v,s,p,f,y,x){const C=In(v.add(v.sub(s)._unit()),y,x).point,M=p.sub(C);return p.add(M._mult(f/M.mag()))}function Ze(v,s){const{projectionCache:p,lineVertexArray:f,labelPlaneMatrix:y,tileAnchorPoint:x,distanceFromAnchor:C,getElevation:M,previousVertex:L,direction:N,absOffsetX:z}=s;if(p.projections[v])return p.projections[v];const B=new a.P(f.getx(v),f.gety(v)),H=In(B,y,M);if(H.signedDistanceFromCamera>0)return p.projections[v]=H.point,H.point;const lt=v-N;return fo(C===0?x:new a.P(f.getx(lt),f.gety(lt)),B,L,z-C+1,y,M)}function Mo(v,s,p){return v._unit()._perp()._mult(s*p)}function ct(v,s,p,f,y,x,C,M){const{projectionCache:L,direction:N}=M;if(L.offsets[v])return L.offsets[v];const z=p.add(s);if(v+N<f||v+N>=y)return L.offsets[v]=z,z;const B=Ze(v+N,M),H=Mo(B.sub(p),C,N),lt=p.add(H),ut=B.add(H);return L.offsets[v]=a.al(x,z,lt,ut)||z,L.offsets[v]}function q(v,s,p,f,y,x,C,M,L,N,z,B,H,lt){const ut=f?v-s:v+s;let ht=ut>0?1:-1,st=0;f&&(ht*=-1,st=Math.PI),ht<0&&(st+=Math.PI);let Mt,Ft,yt=ht>0?M+C:M+C+1,Pt=y,Vt=y,qt=0,Yt=0;const ne=Math.abs(ut),Qt=[];let le;for(;qt+Yt<=ne;){if(yt+=ht,yt<M||yt>=L)return null;qt+=Yt,Vt=Pt,Ft=Mt;const ve={projectionCache:B,lineVertexArray:N,labelPlaneMatrix:z,tileAnchorPoint:x,distanceFromAnchor:qt,getElevation:lt,previousVertex:Vt,direction:ht,absOffsetX:ne};if(Pt=Ze(yt,ve),p===0)Qt.push(Vt),le=Pt.sub(Vt);else{let Je;const Fe=Pt.sub(Vt);Je=Fe.mag()===0?Mo(Ze(yt+ht,ve).sub(Pt),p,ht):Mo(Fe,p,ht),Ft||(Ft=Vt.add(Je)),Mt=ct(yt,Je,Pt,M,L,Ft,p,ve),Qt.push(Ft),le=Mt.sub(Ft)}Yt=le.mag()}const ke=le._mult((ne-qt)/Yt)._add(Ft||Vt),Mr=st+Math.atan2(Pt.y-Vt.y,Pt.x-Vt.x);return Qt.push(ke),{point:ke,angle:H?Mr:0,path:Qt}}const X=new Float32Array([-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0]);function nt(v,s){for(let p=0;p<v;p++){const f=s.length;s.resize(f+4),s.float32.set(X,3*f)}}function pt(v,s,p){const f=s[0],y=s[1];return v[0]=p[0]*f+p[4]*y+p[12],v[1]=p[1]*f+p[5]*y+p[13],v[3]=p[3]*f+p[7]*y+p[15],v}const ft=100;class rt{constructor(s,p=new hs(s.width+200,s.height+200,25),f=new hs(s.width+200,s.height+200,25)){this.transform=s,this.grid=p,this.ignoredGrid=f,this.pitchfactor=Math.cos(s._pitch)*s.cameraToCenterDistance,this.screenRightBoundary=s.width+ft,this.screenBottomBoundary=s.height+ft,this.gridRightBoundary=s.width+200,this.gridBottomBoundary=s.height+200,this.perspectiveRatioCutoff=.6}placeCollisionBox(s,p,f,y,x,C){const M=this.projectAndGetPerspectiveRatio(y,s.anchorPointX,s.anchorPointY,C),L=f*M.perspectiveRatio,N=s.x1*L+M.point.x,z=s.y1*L+M.point.y,B=s.x2*L+M.point.x,H=s.y2*L+M.point.y;return!this.isInsideGrid(N,z,B,H)||p!=="always"&&this.grid.hitTest(N,z,B,H,p,x)||M.perspectiveRatio<this.perspectiveRatioCutoff?{box:[],offscreen:!1}:{box:[N,z,B,H],offscreen:this.isOffscreen(N,z,B,H)}}placeCollisionCircles(s,p,f,y,x,C,M,L,N,z,B,H,lt,ut){const ht=[],st=new a.P(p.anchorX,p.anchorY),Mt=In(st,C,ut),Ft=Ls(this.transform.cameraToCenterDistance,Mt.signedDistanceFromCamera),yt=(z?x/Ft:x*Ft)/a.ap,Pt=In(st,M,ut).point,Vt=ar(yt,y,p.lineOffsetX*yt,p.lineOffsetY*yt,!1,Pt,st,p,f,M,{projections:{},offsets:{}},!1,ut);let qt=!1,Yt=!1,ne=!0;if(Vt){const Qt=.5*H*Ft+lt,le=new a.P(-100,-100),ke=new a.P(this.screenRightBoundary,this.screenBottomBoundary),Mr=new cs,ve=Vt.first,Je=Vt.last;let Fe=[];for(let mr=ve.path.length-1;mr>=1;mr--)Fe.push(ve.path[mr]);for(let mr=1;mr<Je.path.length;mr++)Fe.push(Je.path[mr]);const mn=2.5*Qt;if(L){const mr=Fe.map(Pr=>In(Pr,L,ut));Fe=mr.some(Pr=>Pr.signedDistanceFromCamera<=0)?[]:mr.map(Pr=>Pr.point)}let Ir=[];if(Fe.length>0){const mr=Fe[0].clone(),Pr=Fe[0].clone();for(let hi=1;hi<Fe.length;hi++)mr.x=Math.min(mr.x,Fe[hi].x),mr.y=Math.min(mr.y,Fe[hi].y),Pr.x=Math.max(Pr.x,Fe[hi].x),Pr.y=Math.max(Pr.y,Fe[hi].y);Ir=mr.x>=le.x&&Pr.x<=ke.x&&mr.y>=le.y&&Pr.y<=ke.y?[Fe]:Pr.x<le.x||mr.x>ke.x||Pr.y<le.y||mr.y>ke.y?[]:a.am([Fe],le.x,le.y,ke.x,ke.y)}for(const mr of Ir){Mr.reset(mr,.25*Qt);let Pr=0;Pr=Mr.length<=.5*Qt?1:Math.ceil(Mr.paddedLength/mn)+1;for(let hi=0;hi<Pr;hi++){const Mn=hi/Math.max(Pr-1,1),yo=Mr.lerp(Mn),Bi=yo.x+ft,Si=yo.y+ft;ht.push(Bi,Si,Qt,0);const zs=Bi-Qt,Fn=Si-Qt,ul=Bi+Qt,cl=Si+Qt;if(ne=ne&&this.isOffscreen(zs,Fn,ul,cl),Yt=Yt||this.isInsideGrid(zs,Fn,ul,cl),s!=="always"&&this.grid.hitTestCircle(Bi,Si,Qt,s,B)&&(qt=!0,!N))return{circles:[],offscreen:!1,collisionDetected:qt}}}}return{circles:!N&&qt||!Yt||Ft<this.perspectiveRatioCutoff?[]:ht,offscreen:ne,collisionDetected:qt}}queryRenderedSymbols(s){if(s.length===0||this.grid.keysLength()===0&&this.ignoredGrid.keysLength()===0)return{};const p=[];let f=1/0,y=1/0,x=-1/0,C=-1/0;for(const z of s){const B=new a.P(z.x+ft,z.y+ft);f=Math.min(f,B.x),y=Math.min(y,B.y),x=Math.max(x,B.x),C=Math.max(C,B.y),p.push(B)}const M=this.grid.query(f,y,x,C).concat(this.ignoredGrid.query(f,y,x,C)),L={},N={};for(const z of M){const B=z.key;if(L[B.bucketInstanceId]===void 0&&(L[B.bucketInstanceId]={}),L[B.bucketInstanceId][B.featureIndex])continue;const H=[new a.P(z.x1,z.y1),new a.P(z.x2,z.y1),new a.P(z.x2,z.y2),new a.P(z.x1,z.y2)];a.an(p,H)&&(L[B.bucketInstanceId][B.featureIndex]=!0,N[B.bucketInstanceId]===void 0&&(N[B.bucketInstanceId]=[]),N[B.bucketInstanceId].push(B.featureIndex))}return N}insertCollisionBox(s,p,f,y,x,C){(f?this.ignoredGrid:this.grid).insert({bucketInstanceId:y,featureIndex:x,collisionGroupID:C,overlapMode:p},s[0],s[1],s[2],s[3])}insertCollisionCircles(s,p,f,y,x,C){const M=f?this.ignoredGrid:this.grid,L={bucketInstanceId:y,featureIndex:x,collisionGroupID:C,overlapMode:p};for(let N=0;N<s.length;N+=4)M.insertCircle(L,s[N],s[N+1],s[N+2])}projectAndGetPerspectiveRatio(s,p,f,y){let x;return y?(x=[p,f,y(p,f),1],a.ag(x,x,s)):(x=[p,f,0,1],pt(x,x,s)),{point:new a.P((x[0]/x[3]+1)/2*this.transform.width+ft,(-x[1]/x[3]+1)/2*this.transform.height+ft),perspectiveRatio:.5+this.transform.cameraToCenterDistance/x[3]*.5}}isOffscreen(s,p,f,y){return f<ft||s>=this.screenRightBoundary||y<ft||p>this.screenBottomBoundary}isInsideGrid(s,p,f,y){return f>=0&&s<this.gridRightBoundary&&y>=0&&p<this.gridBottomBoundary}getViewportMatrix(){const s=a.ao([]);return a.$(s,s,[-100,-100,0]),s}}function bt(v,s,p){return s*(a.N/(v.tileSize*Math.pow(2,p-v.tileID.overscaledZ)))}class mt{constructor(s,p,f,y){this.opacity=s?Math.max(0,Math.min(1,s.opacity+(s.placed?p:-p))):y&&f?1:0,this.placed=f}isHidden(){return this.opacity===0&&!this.placed}}class Et{constructor(s,p,f,y,x){this.text=new mt(s?s.text:null,p,f,x),this.icon=new mt(s?s.icon:null,p,y,x)}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class zt{constructor(s,p,f){this.text=s,this.icon=p,this.skipFade=f}}class Zt{constructor(){this.invProjMatrix=a.Z(),this.viewportMatrix=a.Z(),this.circles=[]}}class Ht{constructor(s,p,f,y,x){this.bucketInstanceId=s,this.featureIndex=p,this.sourceLayerIndex=f,this.bucketIndex=y,this.tileID=x}}class De{constructor(s){this.crossSourceCollisions=s,this.maxGroupID=0,this.collisionGroups={}}get(s){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[s]){const p=++this.maxGroupID;this.collisionGroups[s]={ID:p,predicate:f=>f.collisionGroupID===p}}return this.collisionGroups[s]}}function Xe(v,s,p,f,y){const{horizontalAlign:x,verticalAlign:C}=a.au(v);return new a.P(-(x-.5)*s+f[0]*y,-(C-.5)*p+f[1]*y)}function Ce(v,s,p,f,y,x){const{x1:C,x2:M,y1:L,y2:N,anchorPointX:z,anchorPointY:B}=v,H=new a.P(s,p);return f&&H._rotate(y?x:-x),{x1:C+H.x,y1:L+H.y,x2:M+H.x,y2:N+H.y,anchorPointX:z,anchorPointY:B}}class Ue{constructor(s,p,f,y,x){this.transform=s.clone(),this.terrain=p,this.collisionIndex=new rt(this.transform),this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=f,this.retainedQueryData={},this.collisionGroups=new De(y),this.collisionCircleArrays={},this.prevPlacement=x,x&&(x.prevPlacement=void 0),this.placedOrientations={}}getBucketParts(s,p,f,y){const x=f.getBucket(p),C=f.latestFeatureIndex;if(!x||!C||p.id!==x.layerIds[0])return;const M=f.collisionBoxArray,L=x.layers[0].layout,N=Math.pow(2,this.transform.zoom-f.tileID.overscaledZ),z=f.tileSize/a.N,B=this.transform.calculatePosMatrix(f.tileID.toUnwrapped()),H=L.get("text-pitch-alignment")==="map",lt=L.get("text-rotation-alignment")==="map",ut=bt(f,1,this.transform.zoom),ht=oe(B,H,lt,this.transform,ut);let st=null;if(H){const Ft=po(B,H,lt,this.transform,ut);st=a.a1([],this.transform.labelPlaneMatrix,Ft)}this.retainedQueryData[x.bucketInstanceId]=new Ht(x.bucketInstanceId,C,x.sourceLayerIndex,x.index,f.tileID);const Mt={bucket:x,layout:L,posMatrix:B,textLabelPlaneMatrix:ht,labelToScreenMatrix:st,scale:N,textPixelRatio:z,holdingForFade:f.holdingForFade(),collisionBoxArray:M,partiallyEvaluatedTextSize:a.ah(x.textSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(x.sourceID)};if(y)for(const Ft of x.sortKeyRanges){const{sortKey:yt,symbolInstanceStart:Pt,symbolInstanceEnd:Vt}=Ft;s.push({sortKey:yt,symbolInstanceStart:Pt,symbolInstanceEnd:Vt,parameters:Mt})}else s.push({symbolInstanceStart:0,symbolInstanceEnd:x.symbolInstances.length,parameters:Mt})}attemptAnchorPlacement(s,p,f,y,x,C,M,L,N,z,B,H,lt,ut,ht,st){const Mt=a.aq[s.textAnchor],Ft=[s.textOffset0,s.textOffset1],yt=Xe(Mt,f,y,Ft,x),Pt=this.collisionIndex.placeCollisionBox(Ce(p,yt.x,yt.y,C,M,this.transform.angle),B,L,N,z.predicate,st);if((!ht||this.collisionIndex.placeCollisionBox(Ce(ht,yt.x,yt.y,C,M,this.transform.angle),B,L,N,z.predicate,st).box.length!==0)&&Pt.box.length>0){let Vt;if(this.prevPlacement&&this.prevPlacement.variableOffsets[H.crossTileID]&&this.prevPlacement.placements[H.crossTileID]&&this.prevPlacement.placements[H.crossTileID].text&&(Vt=this.prevPlacement.variableOffsets[H.crossTileID].anchor),H.crossTileID===0)throw new Error("symbolInstance.crossTileID can't be 0");return this.variableOffsets[H.crossTileID]={textOffset:Ft,width:f,height:y,anchor:Mt,textBoxScale:x,prevAnchor:Vt},this.markUsedJustification(lt,Mt,H,ut),lt.allowVerticalPlacement&&(this.markUsedOrientation(lt,ut,H),this.placedOrientations[H.crossTileID]=ut),{shift:yt,placedGlyphBoxes:Pt}}}placeLayerBucketPart(s,p,f){const{bucket:y,layout:x,posMatrix:C,textLabelPlaneMatrix:M,labelToScreenMatrix:L,textPixelRatio:N,holdingForFade:z,collisionBoxArray:B,partiallyEvaluatedTextSize:H,collisionGroup:lt}=s.parameters,ut=x.get("text-optional"),ht=x.get("icon-optional"),st=a.ar(x,"text-overlap","text-allow-overlap"),Mt=st==="always",Ft=a.ar(x,"icon-overlap","icon-allow-overlap"),yt=Ft==="always",Pt=x.get("text-rotation-alignment")==="map",Vt=x.get("text-pitch-alignment")==="map",qt=x.get("icon-text-fit")!=="none",Yt=x.get("symbol-z-order")==="viewport-y",ne=Mt&&(yt||!y.hasIconData()||ht),Qt=yt&&(Mt||!y.hasTextData()||ut);!y.collisionArrays&&B&&y.deserializeCollisionBoxes(B);const le=this.retainedQueryData[y.bucketInstanceId].tileID,ke=this.terrain?(ve,Je)=>this.terrain.getElevation(le,ve,Je):null,Mr=(ve,Je)=>{var Fe,mn;if(p[ve.crossTileID])return;if(z)return void(this.placements[ve.crossTileID]=new zt(!1,!1,!1));let Ir=!1,mr=!1,Pr=!0,hi=null,Mn={box:null,offscreen:null},yo={box:null,offscreen:null},Bi=null,Si=null,zs=null,Fn=0,ul=0,cl=0;Je.textFeatureIndex?Fn=Je.textFeatureIndex:ve.useRuntimeCollisionCircles&&(Fn=ve.featureIndex),Je.verticalTextFeatureIndex&&(ul=Je.verticalTextFeatureIndex);const Au=Je.textBox;if(Au){const No=pi=>{let $i=a.ai.horizontal;if(y.allowVerticalPlacement&&!pi&&this.prevPlacement){const gs=this.prevPlacement.placedOrientations[ve.crossTileID];gs&&(this.placedOrientations[ve.crossTileID]=gs,$i=gs,this.markUsedOrientation(y,$i,ve))}return $i},_o=(pi,$i)=>{if(y.allowVerticalPlacement&&ve.numVerticalGlyphVertices>0&&Je.verticalTextBox){for(const gs of y.writingModes)if(gs===a.ai.vertical?(Mn=$i(),yo=Mn):Mn=pi(),Mn&&Mn.box&&Mn.box.length)break}else Mn=pi()},Jo=ve.textAnchorOffsetStartIndex,gc=ve.textAnchorOffsetEndIndex;if(gc===Jo){const pi=($i,gs)=>{const di=this.collisionIndex.placeCollisionBox($i,st,N,C,lt.predicate,ke);return di&&di.box&&di.box.length&&(this.markUsedOrientation(y,gs,ve),this.placedOrientations[ve.crossTileID]=gs),di};_o(()=>pi(Au,a.ai.horizontal),()=>{const $i=Je.verticalTextBox;return y.allowVerticalPlacement&&ve.numVerticalGlyphVertices>0&&$i?pi($i,a.ai.vertical):{box:null,offscreen:null}}),No(Mn&&Mn.box&&Mn.box.length)}else{let pi=a.aq[(mn=(Fe=this.prevPlacement)===null||Fe===void 0?void 0:Fe.variableOffsets[ve.crossTileID])===null||mn===void 0?void 0:mn.anchor];const $i=(di,yc,hd)=>{const Ng=di.x2-di.x1,kg=di.y2-di.y1,s0=ve.textBoxScale,Bf=qt&&Ft==="never"?yc:null;let hl={box:[],offscreen:!1},_c=st==="never"?1:2,pl="never";pi&&_c++;for(let pa=0;pa<_c;pa++){for(let dl=Jo;dl<gc;dl++){const $f=y.textAnchorOffsets.get(dl);if(pi&&$f.textAnchor!==pi)continue;const Zl=this.attemptAnchorPlacement($f,di,Ng,kg,s0,Pt,Vt,N,C,lt,pl,ve,y,hd,Bf,ke);if(Zl&&(hl=Zl.placedGlyphBoxes,hl&&hl.box&&hl.box.length))return Ir=!0,hi=Zl.shift,hl}pi?pi=null:pl=st}return hl};_o(()=>$i(Au,Je.iconBox,a.ai.horizontal),()=>{const di=Je.verticalTextBox;return y.allowVerticalPlacement&&!(Mn&&Mn.box&&Mn.box.length)&&ve.numVerticalGlyphVertices>0&&di?$i(di,Je.verticalIconBox,a.ai.vertical):{box:null,offscreen:null}}),Mn&&(Ir=Mn.box,Pr=Mn.offscreen);const gs=No(Mn&&Mn.box);if(!Ir&&this.prevPlacement){const di=this.prevPlacement.variableOffsets[ve.crossTileID];di&&(this.variableOffsets[ve.crossTileID]=di,this.markUsedJustification(y,di.anchor,ve,gs))}}}if(Bi=Mn,Ir=Bi&&Bi.box&&Bi.box.length>0,Pr=Bi&&Bi.offscreen,ve.useRuntimeCollisionCircles){const No=y.text.placedSymbolArray.get(ve.centerJustifiedTextSymbolIndex),_o=a.aj(y.textSizeData,H,No),Jo=x.get("text-padding");Si=this.collisionIndex.placeCollisionCircles(st,No,y.lineVertexArray,y.glyphOffsetArray,_o,C,M,L,f,Vt,lt.predicate,ve.collisionCircleDiameter,Jo,ke),Si.circles.length&&Si.collisionDetected&&!f&&a.w("Collisions detected, but collision boxes are not shown"),Ir=Mt||Si.circles.length>0&&!Si.collisionDetected,Pr=Pr&&Si.offscreen}if(Je.iconFeatureIndex&&(cl=Je.iconFeatureIndex),Je.iconBox){const No=_o=>{const Jo=qt&&hi?Ce(_o,hi.x,hi.y,Pt,Vt,this.transform.angle):_o;return this.collisionIndex.placeCollisionBox(Jo,Ft,N,C,lt.predicate,ke)};yo&&yo.box&&yo.box.length&&Je.verticalIconBox?(zs=No(Je.verticalIconBox),mr=zs.box.length>0):(zs=No(Je.iconBox),mr=zs.box.length>0),Pr=Pr&&zs.offscreen}const mc=ut||ve.numHorizontalGlyphVertices===0&&ve.numVerticalGlyphVertices===0,Ih=ht||ve.numIconVertices===0;if(mc||Ih?Ih?mc||(mr=mr&&Ir):Ir=mr&&Ir:mr=Ir=mr&&Ir,Ir&&Bi&&Bi.box&&this.collisionIndex.insertCollisionBox(Bi.box,st,x.get("text-ignore-placement"),y.bucketInstanceId,yo&&yo.box&&ul?ul:Fn,lt.ID),mr&&zs&&this.collisionIndex.insertCollisionBox(zs.box,Ft,x.get("icon-ignore-placement"),y.bucketInstanceId,cl,lt.ID),Si&&(Ir&&this.collisionIndex.insertCollisionCircles(Si.circles,st,x.get("text-ignore-placement"),y.bucketInstanceId,Fn,lt.ID),f)){const No=y.bucketInstanceId;let _o=this.collisionCircleArrays[No];_o===void 0&&(_o=this.collisionCircleArrays[No]=new Zt);for(let Jo=0;Jo<Si.circles.length;Jo+=4)_o.circles.push(Si.circles[Jo+0]),_o.circles.push(Si.circles[Jo+1]),_o.circles.push(Si.circles[Jo+2]),_o.circles.push(Si.collisionDetected?1:0)}if(ve.crossTileID===0)throw new Error("symbolInstance.crossTileID can't be 0");if(y.bucketInstanceId===0)throw new Error("bucket.bucketInstanceId can't be 0");this.placements[ve.crossTileID]=new zt(Ir||ne,mr||Qt,Pr||y.justReloaded),p[ve.crossTileID]=!0};if(Yt){if(s.symbolInstanceStart!==0)throw new Error("bucket.bucketInstanceId should be 0");const ve=y.getSortedSymbolIndexes(this.transform.angle);for(let Je=ve.length-1;Je>=0;--Je){const Fe=ve[Je];Mr(y.symbolInstances.get(Fe),y.collisionArrays[Fe])}}else for(let ve=s.symbolInstanceStart;ve<s.symbolInstanceEnd;ve++)Mr(y.symbolInstances.get(ve),y.collisionArrays[ve]);if(f&&y.bucketInstanceId in this.collisionCircleArrays){const ve=this.collisionCircleArrays[y.bucketInstanceId];a.as(ve.invProjMatrix,C),ve.viewportMatrix=this.collisionIndex.getViewportMatrix()}y.justReloaded=!1}markUsedJustification(s,p,f,y){let x;x=y===a.ai.vertical?f.verticalPlacedTextSymbolIndex:{left:f.leftJustifiedTextSymbolIndex,center:f.centerJustifiedTextSymbolIndex,right:f.rightJustifiedTextSymbolIndex}[a.at(p)];const C=[f.leftJustifiedTextSymbolIndex,f.centerJustifiedTextSymbolIndex,f.rightJustifiedTextSymbolIndex,f.verticalPlacedTextSymbolIndex];for(const M of C)M>=0&&(s.text.placedSymbolArray.get(M).crossTileID=x>=0&&M!==x?0:f.crossTileID)}markUsedOrientation(s,p,f){const y=p===a.ai.horizontal||p===a.ai.horizontalOnly?p:0,x=p===a.ai.vertical?p:0,C=[f.leftJustifiedTextSymbolIndex,f.centerJustifiedTextSymbolIndex,f.rightJustifiedTextSymbolIndex];for(const M of C)s.text.placedSymbolArray.get(M).placedOrientation=y;f.verticalPlacedTextSymbolIndex&&(s.text.placedSymbolArray.get(f.verticalPlacedTextSymbolIndex).placedOrientation=x)}commit(s){this.commitTime=s,this.zoomAtLastRecencyCheck=this.transform.zoom;const p=this.prevPlacement;let f=!1;this.prevZoomAdjustment=p?p.zoomAdjustment(this.transform.zoom):0;const y=p?p.symbolFadeChange(s):1,x=p?p.opacities:{},C=p?p.variableOffsets:{},M=p?p.placedOrientations:{};for(const L in this.placements){const N=this.placements[L],z=x[L];z?(this.opacities[L]=new Et(z,y,N.text,N.icon),f=f||N.text!==z.text.placed||N.icon!==z.icon.placed):(this.opacities[L]=new Et(null,y,N.text,N.icon,N.skipFade),f=f||N.text||N.icon)}for(const L in x){const N=x[L];if(!this.opacities[L]){const z=new Et(N,y,!1,!1);z.isHidden()||(this.opacities[L]=z,f=f||N.text.placed||N.icon.placed)}}for(const L in C)this.variableOffsets[L]||!this.opacities[L]||this.opacities[L].isHidden()||(this.variableOffsets[L]=C[L]);for(const L in M)this.placedOrientations[L]||!this.opacities[L]||this.opacities[L].isHidden()||(this.placedOrientations[L]=M[L]);if(p&&p.lastPlacementChangeTime===void 0)throw new Error("Last placement time for previous placement is not defined");f?this.lastPlacementChangeTime=s:typeof this.lastPlacementChangeTime!="number"&&(this.lastPlacementChangeTime=p?p.lastPlacementChangeTime:s)}updateLayerOpacities(s,p){const f={};for(const y of p){const x=y.getBucket(s);x&&y.latestFeatureIndex&&s.id===x.layerIds[0]&&this.updateBucketOpacities(x,f,y.collisionBoxArray)}}updateBucketOpacities(s,p,f){s.hasTextData()&&(s.text.opacityVertexArray.clear(),s.text.hasVisibleVertices=!1),s.hasIconData()&&(s.icon.opacityVertexArray.clear(),s.icon.hasVisibleVertices=!1),s.hasIconCollisionBoxData()&&s.iconCollisionBox.collisionVertexArray.clear(),s.hasTextCollisionBoxData()&&s.textCollisionBox.collisionVertexArray.clear();const y=s.layers[0],x=y.layout,C=new Et(null,0,!1,!1,!0),M=x.get("text-allow-overlap"),L=x.get("icon-allow-overlap"),N=y._unevaluatedLayout.hasValue("text-variable-anchor")||y._unevaluatedLayout.hasValue("text-variable-anchor-offset"),z=x.get("text-rotation-alignment")==="map",B=x.get("text-pitch-alignment")==="map",H=x.get("icon-text-fit")!=="none",lt=new Et(null,0,M&&(L||!s.hasIconData()||x.get("icon-optional")),L&&(M||!s.hasTextData()||x.get("text-optional")),!0);!s.collisionArrays&&f&&(s.hasIconCollisionBoxData()||s.hasTextCollisionBoxData())&&s.deserializeCollisionBoxes(f);const ut=(ht,st,Mt)=>{for(let Ft=0;Ft<st/4;Ft++)ht.opacityVertexArray.emplaceBack(Mt);ht.hasVisibleVertices=ht.hasVisibleVertices||Mt!==ps};for(let ht=0;ht<s.symbolInstances.length;ht++){const st=s.symbolInstances.get(ht),{numHorizontalGlyphVertices:Mt,numVerticalGlyphVertices:Ft,crossTileID:yt}=st;let Pt=this.opacities[yt];p[yt]?Pt=C:Pt||(Pt=lt,this.opacities[yt]=Pt),p[yt]=!0;const Vt=st.numIconVertices>0,qt=this.placedOrientations[st.crossTileID],Yt=qt===a.ai.vertical,ne=qt===a.ai.horizontal||qt===a.ai.horizontalOnly;if(Mt>0||Ft>0){const Qt=bi(Pt.text);ut(s.text,Mt,Yt?ps:Qt),ut(s.text,Ft,ne?ps:Qt);const le=Pt.text.isHidden();[st.rightJustifiedTextSymbolIndex,st.centerJustifiedTextSymbolIndex,st.leftJustifiedTextSymbolIndex].forEach(ve=>{ve>=0&&(s.text.placedSymbolArray.get(ve).hidden=le||Yt?1:0)}),st.verticalPlacedTextSymbolIndex>=0&&(s.text.placedSymbolArray.get(st.verticalPlacedTextSymbolIndex).hidden=le||ne?1:0);const ke=this.variableOffsets[st.crossTileID];ke&&this.markUsedJustification(s,ke.anchor,st,qt);const Mr=this.placedOrientations[st.crossTileID];Mr&&(this.markUsedJustification(s,"left",st,Mr),this.markUsedOrientation(s,Mr,st))}if(Vt){const Qt=bi(Pt.icon),le=!(H&&st.verticalPlacedIconSymbolIndex&&Yt);st.placedIconSymbolIndex>=0&&(ut(s.icon,st.numIconVertices,le?Qt:ps),s.icon.placedSymbolArray.get(st.placedIconSymbolIndex).hidden=Pt.icon.isHidden()),st.verticalPlacedIconSymbolIndex>=0&&(ut(s.icon,st.numVerticalIconVertices,le?ps:Qt),s.icon.placedSymbolArray.get(st.verticalPlacedIconSymbolIndex).hidden=Pt.icon.isHidden())}if(s.hasIconCollisionBoxData()||s.hasTextCollisionBoxData()){const Qt=s.collisionArrays[ht];if(Qt){let le=new a.P(0,0);if(Qt.textBox||Qt.verticalTextBox){let Mr=!0;if(N){const ve=this.variableOffsets[yt];ve?(le=Xe(ve.anchor,ve.width,ve.height,ve.textOffset,ve.textBoxScale),z&&le._rotate(B?this.transform.angle:-this.transform.angle)):Mr=!1}Qt.textBox&&or(s.textCollisionBox.collisionVertexArray,Pt.text.placed,!Mr||Yt,le.x,le.y),Qt.verticalTextBox&&or(s.textCollisionBox.collisionVertexArray,Pt.text.placed,!Mr||ne,le.x,le.y)}const ke=!!(!ne&&Qt.verticalIconBox);Qt.iconBox&&or(s.iconCollisionBox.collisionVertexArray,Pt.icon.placed,ke,H?le.x:0,H?le.y:0),Qt.verticalIconBox&&or(s.iconCollisionBox.collisionVertexArray,Pt.icon.placed,!ke,H?le.x:0,H?le.y:0)}}}if(s.sortFeatures(this.transform.angle),this.retainedQueryData[s.bucketInstanceId]&&(this.retainedQueryData[s.bucketInstanceId].featureSortOrder=s.featureSortOrder),s.hasTextData()&&s.text.opacityVertexBuffer&&s.text.opacityVertexBuffer.updateData(s.text.opacityVertexArray),s.hasIconData()&&s.icon.opacityVertexBuffer&&s.icon.opacityVertexBuffer.updateData(s.icon.opacityVertexArray),s.hasIconCollisionBoxData()&&s.iconCollisionBox.collisionVertexBuffer&&s.iconCollisionBox.collisionVertexBuffer.updateData(s.iconCollisionBox.collisionVertexArray),s.hasTextCollisionBoxData()&&s.textCollisionBox.collisionVertexBuffer&&s.textCollisionBox.collisionVertexBuffer.updateData(s.textCollisionBox.collisionVertexArray),s.text.opacityVertexArray.length!==s.text.layoutVertexArray.length/4)throw new Error(`bucket.text.opacityVertexArray.length (= ${s.text.opacityVertexArray.length}) !== bucket.text.layoutVertexArray.length (= ${s.text.layoutVertexArray.length}) / 4`);if(s.icon.opacityVertexArray.length!==s.icon.layoutVertexArray.length/4)throw new Error(`bucket.icon.opacityVertexArray.length (= ${s.icon.opacityVertexArray.length}) !== bucket.icon.layoutVertexArray.length (= ${s.icon.layoutVertexArray.length}) / 4`);if(s.bucketInstanceId in this.collisionCircleArrays){const ht=this.collisionCircleArrays[s.bucketInstanceId];s.placementInvProjMatrix=ht.invProjMatrix,s.placementViewportMatrix=ht.viewportMatrix,s.collisionCircleArray=ht.circles,delete this.collisionCircleArrays[s.bucketInstanceId]}}symbolFadeChange(s){return this.fadeDuration===0?1:(s-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(s){return Math.max(0,(this.transform.zoom-s)/1.5)}hasTransitions(s){return this.stale||s-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(s,p){const f=this.zoomAtLastRecencyCheck===p?1-this.zoomAdjustment(p):1;return this.zoomAtLastRecencyCheck=p,this.commitTime+this.fadeDuration*f>s}setStale(){this.stale=!0}}function or(v,s,p,f,y){v.emplaceBack(s?1:0,p?1:0,f||0,y||0),v.emplaceBack(s?1:0,p?1:0,f||0,y||0),v.emplaceBack(s?1:0,p?1:0,f||0,y||0),v.emplaceBack(s?1:0,p?1:0,f||0,y||0)}const Jr=Math.pow(2,25),fr=Math.pow(2,24),Fr=Math.pow(2,17),Lr=Math.pow(2,16),Qi=Math.pow(2,9),dn=Math.pow(2,8),li=Math.pow(2,1);function bi(v){if(v.opacity===0&&!v.placed)return 0;if(v.opacity===1&&v.placed)return 4294967295;const s=v.placed?1:0,p=Math.floor(127*v.opacity);return p*Jr+s*fr+p*Fr+s*Lr+p*Qi+s*dn+p*li+s}const ps=0;class Ju{constructor(s){this._sortAcrossTiles=s.layout.get("symbol-z-order")!=="viewport-y"&&!s.layout.get("symbol-sort-key").isConstant(),this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs={},this._bucketParts=[]}continuePlacement(s,p,f,y,x){const C=this._bucketParts;for(;this._currentTileIndex<s.length;)if(p.getBucketParts(C,y,s[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,x())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,C.sort((M,L)=>M.sortKey-L.sortKey));this._currentPartIndex<C.length;)if(p.placeLayerBucketPart(C[this._currentPartIndex],this._seenCrossTileIDs,f),this._currentPartIndex++,x())return!0;return!1}}class Qa{constructor(s,p,f,y,x,C,M,L){this.placement=new Ue(s,p,C,M,L),this._currentPlacementIndex=f.length-1,this._forceFullPlacement=y,this._showCollisionBoxes=x,this._done=!1}isDone(){return this._done}continuePlacement(s,p,f){const y=a.h.now(),x=()=>!this._forceFullPlacement&&a.h.now()-y>2;for(;this._currentPlacementIndex>=0;){const C=p[s[this._currentPlacementIndex]],M=this.placement.collisionIndex.transform.zoom;if(C.type==="symbol"&&(!C.minzoom||C.minzoom<=M)&&(!C.maxzoom||C.maxzoom>M)){if(this._inProgressLayer||(this._inProgressLayer=new Ju(C)),this._inProgressLayer.continuePlacement(f[C.source],this.placement,this._showCollisionBoxes,C,x))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(s){return this.placement.commit(s),this.placement}}const tl=512/a.N/2;class wi{constructor(s,p,f){this.tileID=s,this.bucketInstanceId=f,this._symbolsByKey={};const y=new Map;for(let x=0;x<p.length;x++){const C=p.get(x),M=C.key,L=y.get(M);L?L.push(C):y.set(M,[C])}for(const[x,C]of y){const M={positions:C.map(L=>({x:Math.floor(L.anchorX*tl),y:Math.floor(L.anchorY*tl)})),crossTileIDs:C.map(L=>L.crossTileID)};if(M.positions.length>128){const L=new a.av(M.positions.length,16,Uint16Array);for(const{x:N,y:z}of M.positions)L.add(N,z);L.finish(),delete M.positions,M.index=L}this._symbolsByKey[x]=M}}getScaledCoordinates(s,p){const{x:f,y,z:x}=this.tileID.canonical,{x:C,y:M,z:L}=p.canonical,N=tl/Math.pow(2,L-x),z=(M*a.N+s.anchorY)*N,B=y*a.N*tl;return{x:Math.floor((C*a.N+s.anchorX)*N-f*a.N*tl),y:Math.floor(z-B)}}findMatches(s,p,f){const y=this.tileID.canonical.z<p.canonical.z?1:Math.pow(2,this.tileID.canonical.z-p.canonical.z);for(let x=0;x<s.length;x++){const C=s.get(x);if(C.crossTileID)continue;const M=this._symbolsByKey[C.key];if(!M)continue;const L=this.getScaledCoordinates(C,p);if(M.index){const N=M.index.range(L.x-y,L.y-y,L.x+y,L.y+y).sort();for(const z of N){const B=M.crossTileIDs[z];if(!f[B]){f[B]=!0,C.crossTileID=B;break}}}else if(M.positions)for(let N=0;N<M.positions.length;N++){const z=M.positions[N],B=M.crossTileIDs[N];if(Math.abs(z.x-L.x)<=y&&Math.abs(z.y-L.y)<=y&&!f[B]){f[B]=!0,C.crossTileID=B;break}}}}getCrossTileIDsLists(){return Object.values(this._symbolsByKey).map(({crossTileIDs:s})=>s)}}class Qr{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class th{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(s){const p=Math.round((s-this.lng)/360);if(p!==0)for(const f in this.indexes){const y=this.indexes[f],x={};for(const C in y){const M=y[C];M.tileID=M.tileID.unwrapTo(M.tileID.wrap+p),x[M.tileID.key]=M}this.indexes[f]=x}this.lng=s}addBucket(s,p,f){if(this.indexes[s.overscaledZ]&&this.indexes[s.overscaledZ][s.key]){if(this.indexes[s.overscaledZ][s.key].bucketInstanceId===p.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(s.overscaledZ,this.indexes[s.overscaledZ][s.key])}for(let x=0;x<p.symbolInstances.length;x++)p.symbolInstances.get(x).crossTileID=0;this.usedCrossTileIDs[s.overscaledZ]||(this.usedCrossTileIDs[s.overscaledZ]={});const y=this.usedCrossTileIDs[s.overscaledZ];for(const x in this.indexes){const C=this.indexes[x];if(Number(x)>s.overscaledZ)for(const M in C){const L=C[M];L.tileID.isChildOf(s)&&L.findMatches(p.symbolInstances,s,y)}else{const M=C[s.scaledTo(Number(x)).key];M&&M.findMatches(p.symbolInstances,s,y)}}for(let x=0;x<p.symbolInstances.length;x++){const C=p.symbolInstances.get(x);C.crossTileID||(C.crossTileID=f.generate(),y[C.crossTileID]=!0)}return this.indexes[s.overscaledZ]===void 0&&(this.indexes[s.overscaledZ]={}),this.indexes[s.overscaledZ][s.key]=new wi(s,p.symbolInstances,p.bucketInstanceId),!0}removeBucketCrossTileIDs(s,p){for(const f of p.getCrossTileIDsLists())for(const y of f)delete this.usedCrossTileIDs[s][y]}removeStaleBuckets(s){let p=!1;for(const f in this.indexes){const y=this.indexes[f];for(const x in y)s[y[x].bucketInstanceId]||(this.removeBucketCrossTileIDs(f,y[x]),delete y[x],p=!0)}return p}}class Rs{constructor(){this.layerIndexes={},this.crossTileIDs=new Qr,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(s,p,f){let y=this.layerIndexes[s.id];y===void 0&&(y=this.layerIndexes[s.id]=new th);let x=!1;const C={};y.handleWrapJump(f);for(const M of p){const L=M.getBucket(s);L&&s.id===L.layerIds[0]&&(L.bucketInstanceId||(L.bucketInstanceId=++this.maxBucketInstanceId),y.addBucket(M.tileID,L,this.crossTileIDs)&&(x=!0),C[L.bucketInstanceId]=!0)}return y.removeStaleBuckets(C)&&(x=!0),x}pruneUnusedLayers(s){const p={};s.forEach(f=>{p[f]=!0});for(const f in this.layerIndexes)p[f]||delete this.layerIndexes[f]}}const Cn=(v,s)=>a.x(v,s&&s.filter(p=>p.identifier!=="source.canvas")),to=a.F(a.ax,["addLayer","removeLayer","setPaintProperty","setLayoutProperty","setFilter","addSource","removeSource","setLayerZoomRange","setLight","setTransition","setGeoJSONSourceData","setGlyphs","setSprite"]),$l=a.F(a.ax,["setCenter","setZoom","setBearing","setPitch"]),Ni=a.aw();class ki extends a.E{constructor(s,p={}){super(),this.map=s,this.dispatcher=new kr(ia(),this,s._getMapId()),this.imageManager=new $t,this.imageManager.setEventedParent(this),this.glyphManager=new ye(s._requestManager,p.localIdeographFontFamily),this.lineAtlas=new _r(256,512),this.crossTileSymbolIndex=new Rs,this._spritesImagesIds={},this._layers={},this._order=[],this.sourceCaches={},this.zoomHistory=new a.ay,this._loaded=!1,this._availableImages=[],this._resetUpdates(),this.dispatcher.broadcast("setReferrer",a.az());const f=this;this._rtlTextPluginCallback=ki.registerForPluginStateChange(y=>{f.dispatcher.broadcast("syncRTLPluginState",{pluginStatus:y.pluginStatus,pluginURL:y.pluginURL},(x,C)=>{if(a.aA(x),C&&C.every(M=>M))for(const M in f.sourceCaches){const L=f.sourceCaches[M].getSource().type;L!=="vector"&&L!=="geojson"||f.sourceCaches[M].reload()}})}),this.on("data",y=>{if(y.dataType!=="source"||y.sourceDataType!=="metadata")return;const x=this.sourceCaches[y.sourceId];if(!x)return;const C=x.getSource();if(C&&C.vectorLayerIds)for(const M in this._layers){const L=this._layers[M];L.source===C.id&&this._validateLayer(L)}})}loadURL(s,p={},f){this.fire(new a.k("dataloading",{dataType:"style"})),p.validate=typeof p.validate!="boolean"||p.validate;const y=this.map._requestManager.transformRequest(s,U.Style);this._request=a.f(y,(x,C)=>{this._request=null,x?this.fire(new a.j(x)):C&&this._load(C,p,f)})}loadJSON(s,p={},f){this.fire(new a.k("dataloading",{dataType:"style"})),this._request=a.h.frame(()=>{this._request=null,p.validate=p.validate!==!1,this._load(s,p,f)})}loadEmpty(){this.fire(new a.k("dataloading",{dataType:"style"})),this._load(Ni,{validate:!1})}_load(s,p,f){var y;const x=p.transformStyle?p.transformStyle(f,s):s;if(!p.validate||!Cn(this,a.y(x))){this._loaded=!0,this.stylesheet=x;for(const C in x.sources)this.addSource(C,x.sources[C],{validate:!1});x.sprite?this._loadSprite(x.sprite):this.imageManager.setLoaded(!0),this.glyphManager.setURL(x.glyphs),this._createLayers(),this.light=new xr(this.stylesheet.light),this.map.setTerrain((y=this.stylesheet.terrain)!==null&&y!==void 0?y:null),this.fire(new a.k("data",{dataType:"style"})),this.fire(new a.k("style.load"))}}_createLayers(){const s=a.aB(this.stylesheet.layers);this.dispatcher.broadcast("setLayers",s),this._order=s.map(p=>p.id),this._layers={},this._serializedLayers=null;for(const p of s){const f=a.aC(p);f.setEventedParent(this,{layer:{id:p.id}}),this._layers[p.id]=f}}_loadSprite(s,p=!1,f=void 0){this.imageManager.setLoaded(!1),this._spriteRequest=function(y,x,C,M){const L=et(y),N=L.length,z=C>1?"@2x":"",B={},H={},lt={};for(const{id:ut,url:ht}of L){const st=x.transformRequest(x.normalizeSpriteURL(ht,z,".json"),U.SpriteJSON),Mt=`${ut}_${st.url}`;B[Mt]=a.f(st,(Pt,Vt)=>{delete B[Mt],H[ut]=Vt,wt(M,H,lt,Pt,N)});const Ft=x.transformRequest(x.normalizeSpriteURL(ht,z,".png"),U.SpriteImage),yt=`${ut}_${Ft.url}`;B[yt]=W.getImage(Ft,(Pt,Vt)=>{delete B[yt],lt[ut]=Vt,wt(M,H,lt,Pt,N)})}return{cancel(){for(const ut of Object.values(B))ut.cancel()}}}(s,this.map._requestManager,this.map.getPixelRatio(),(y,x)=>{if(this._spriteRequest=null,y)this.fire(new a.j(y));else if(x)for(const C in x){this._spritesImagesIds[C]=[];const M=this._spritesImagesIds[C]?this._spritesImagesIds[C].filter(L=>!(L in x)):[];for(const L of M)this.imageManager.removeImage(L),this._changedImages[L]=!0;for(const L in x[C]){const N=C==="default"?L:`${C}:${L}`;this._spritesImagesIds[C].push(N),N in this.imageManager.images?this.imageManager.updateImage(N,x[C][L],!1):this.imageManager.addImage(N,x[C][L]),p&&(this._changedImages[N]=!0)}}this.imageManager.setLoaded(!0),this._availableImages=this.imageManager.listImages(),p&&(this._changed=!0),this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new a.k("data",{dataType:"style"})),f&&f(y)})}_unloadSprite(){for(const s of Object.values(this._spritesImagesIds).flat())this.imageManager.removeImage(s),this._changedImages[s]=!0;this._spritesImagesIds={},this._availableImages=this.imageManager.listImages(),this._changed=!0,this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new a.k("data",{dataType:"style"}))}_validateLayer(s){const p=this.sourceCaches[s.source];if(!p)return;const f=s.sourceLayer;if(!f)return;const y=p.getSource();(y.type==="geojson"||y.vectorLayerIds&&y.vectorLayerIds.indexOf(f)===-1)&&this.fire(new a.j(new Error(`Source layer "${f}" does not exist on source "${y.id}" as specified by style layer "${s.id}".`)))}loaded(){if(!this._loaded||Object.keys(this._updatedSources).length)return!1;for(const s in this.sourceCaches)if(!this.sourceCaches[s].loaded())return!1;return!!this.imageManager.isLoaded()}_serializeByIds(s){const p=this._serializedAllLayers();if(!s||s.length===0)return Object.values(p);const f=[];for(const y of s)p[y]&&f.push(p[y]);return f}_serializedAllLayers(){let s=this._serializedLayers;if(s)return s;s=this._serializedLayers={};const p=Object.keys(this._layers);for(const f of p){const y=this._layers[f];y.type!=="custom"&&(s[f]=y.serialize())}return s}hasTransitions(){if(this.light&&this.light.hasTransition())return!0;for(const s in this.sourceCaches)if(this.sourceCaches[s].hasTransition())return!0;for(const s in this._layers)if(this._layers[s].hasTransition())return!0;return!1}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading.")}update(s){if(!this._loaded)return;const p=this._changed;if(this._changed){const y=Object.keys(this._updatedLayers),x=Object.keys(this._removedLayers);(y.length||x.length)&&this._updateWorkerLayers(y,x);for(const C in this._updatedSources){const M=this._updatedSources[C];if(M==="reload")this._reloadSource(C);else{if(M!=="clear")throw new Error(`Invalid action ${M}`);this._clearSource(C)}}this._updateTilesForChangedImages(),this._updateTilesForChangedGlyphs();for(const C in this._updatedPaintProps)this._layers[C].updateTransitions(s);this.light.updateTransitions(s),this._resetUpdates()}const f={};for(const y in this.sourceCaches){const x=this.sourceCaches[y];f[y]=x.used,x.used=!1}for(const y of this._order){const x=this._layers[y];x.recalculate(s,this._availableImages),!x.isHidden(s.zoom)&&x.source&&(this.sourceCaches[x.source].used=!0)}for(const y in f){const x=this.sourceCaches[y];f[y]!==x.used&&x.fire(new a.k("data",{sourceDataType:"visibility",dataType:"source",sourceId:y}))}this.light.recalculate(s),this.z=s.zoom,p&&this.fire(new a.k("data",{dataType:"style"}))}_updateTilesForChangedImages(){const s=Object.keys(this._changedImages);if(s.length){for(const p in this.sourceCaches)this.sourceCaches[p].reloadTilesForDependencies(["icons","patterns"],s);this._changedImages={}}}_updateTilesForChangedGlyphs(){if(this._glyphsDidChange){for(const s in this.sourceCaches)this.sourceCaches[s].reloadTilesForDependencies(["glyphs"],[""]);this._glyphsDidChange=!1}}_updateWorkerLayers(s,p){this.dispatcher.broadcast("updateLayers",{layers:this._serializeByIds(s),removedIds:p})}_resetUpdates(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSources={},this._updatedPaintProps={},this._changedImages={},this._glyphsDidChange=!1}setState(s,p={}){this._checkLoaded();const f=this.serialize();if(s=p.transformStyle?p.transformStyle(f,s):s,Cn(this,a.y(s)))return!1;(s=a.aD(s)).layers=a.aB(s.layers);const y=a.aE(f,s).filter(C=>!(C.command in $l));if(y.length===0)return!1;const x=y.filter(C=>!(C.command in to));if(x.length>0)throw new Error(`Unimplemented: ${x.map(C=>C.command).join(", ")}.`);for(const C of y)C.command!=="setTransition"&&this[C.command].apply(this,C.args);return this.stylesheet=s,this._serializedLayers=null,!0}addImage(s,p){if(this.getImage(s))return this.fire(new a.j(new Error(`An image named "${s}" already exists.`)));this.imageManager.addImage(s,p),this._afterImageUpdated(s)}updateImage(s,p){this.imageManager.updateImage(s,p)}getImage(s){return this.imageManager.getImage(s)}removeImage(s){if(!this.getImage(s))return this.fire(new a.j(new Error(`An image named "${s}" does not exist.`)));this.imageManager.removeImage(s),this._afterImageUpdated(s)}_afterImageUpdated(s){this._availableImages=this.imageManager.listImages(),this._changedImages[s]=!0,this._changed=!0,this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new a.k("data",{dataType:"style"}))}listImages(){return this._checkLoaded(),this.imageManager.listImages()}addSource(s,p,f={}){if(this._checkLoaded(),this.sourceCaches[s]!==void 0)throw new Error(`Source "${s}" already exists.`);if(!p.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(p).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(p.type)>=0&&this._validate(a.y.source,`sources.${s}`,p,null,f))return;this.map&&this.map._collectResourceTiming&&(p.collectResourceTiming=!0);const y=this.sourceCaches[s]=new vi(s,p,this.dispatcher);y.style=this,y.setEventedParent(this,()=>({isSourceLoaded:y.loaded(),source:y.serialize(),sourceId:s})),y.onAdd(this.map),this._changed=!0}removeSource(s){if(this._checkLoaded(),this.sourceCaches[s]===void 0)throw new Error("There is no source with this ID");for(const f in this._layers)if(this._layers[f].source===s)return this.fire(new a.j(new Error(`Source "${s}" cannot be removed while layer "${f}" is using it.`)));const p=this.sourceCaches[s];delete this.sourceCaches[s],delete this._updatedSources[s],p.fire(new a.k("data",{sourceDataType:"metadata",dataType:"source",sourceId:s})),p.setEventedParent(null),p.onRemove(this.map),this._changed=!0}setGeoJSONSourceData(s,p){if(this._checkLoaded(),this.sourceCaches[s]===void 0)throw new Error(`There is no source with this ID=${s}`);const f=this.sourceCaches[s].getSource();if(f.type!=="geojson")throw new Error(`geojsonSource.type is ${f.type}, which is !== 'geojson`);f.setData(p),this._changed=!0}getSource(s){return this.sourceCaches[s]&&this.sourceCaches[s].getSource()}addLayer(s,p,f={}){this._checkLoaded();const y=s.id;if(this.getLayer(y))return void this.fire(new a.j(new Error(`Layer "${y}" already exists on this map.`)));let x;if(s.type==="custom"){if(Cn(this,a.aF(s)))return;x=a.aC(s)}else{if("source"in s&&typeof s.source=="object"&&(this.addSource(y,s.source),s=a.aD(s),s=a.e(s,{source:y})),this._validate(a.y.layer,`layers.${y}`,s,{arrayIndex:-1},f))return;x=a.aC(s),this._validateLayer(x),x.setEventedParent(this,{layer:{id:y}})}const C=p?this._order.indexOf(p):this._order.length;if(p&&C===-1)this.fire(new a.j(new Error(`Cannot add layer "${y}" before non-existing layer "${p}".`)));else{if(this._order.splice(C,0,y),this._layerOrderChanged=!0,this._layers[y]=x,this._removedLayers[y]&&x.source&&x.type!=="custom"){const M=this._removedLayers[y];delete this._removedLayers[y],M.type!==x.type?this._updatedSources[x.source]="clear":(this._updatedSources[x.source]="reload",this.sourceCaches[x.source].pause())}this._updateLayer(x),x.onAdd&&x.onAdd(this.map)}}moveLayer(s,p){if(this._checkLoaded(),this._changed=!0,!this._layers[s])return void this.fire(new a.j(new Error(`The layer '${s}' does not exist in the map's style and cannot be moved.`)));if(s===p)return;const f=this._order.indexOf(s);this._order.splice(f,1);const y=p?this._order.indexOf(p):this._order.length;p&&y===-1?this.fire(new a.j(new Error(`Cannot move layer "${s}" before non-existing layer "${p}".`))):(this._order.splice(y,0,s),this._layerOrderChanged=!0)}removeLayer(s){this._checkLoaded();const p=this._layers[s];if(!p)return void this.fire(new a.j(new Error(`Cannot remove non-existing layer "${s}".`)));p.setEventedParent(null);const f=this._order.indexOf(s);this._order.splice(f,1),this._layerOrderChanged=!0,this._changed=!0,this._removedLayers[s]=p,delete this._layers[s],this._serializedLayers&&delete this._serializedLayers[s],delete this._updatedLayers[s],delete this._updatedPaintProps[s],p.onRemove&&p.onRemove(this.map)}getLayer(s){return this._layers[s]}getLayersOrder(){return[...this._order]}hasLayer(s){return s in this._layers}setLayerZoomRange(s,p,f){this._checkLoaded();const y=this.getLayer(s);y?y.minzoom===p&&y.maxzoom===f||(p!=null&&(y.minzoom=p),f!=null&&(y.maxzoom=f),this._updateLayer(y)):this.fire(new a.j(new Error(`Cannot set the zoom range of non-existing layer "${s}".`)))}setFilter(s,p,f={}){this._checkLoaded();const y=this.getLayer(s);if(y){if(!a.aG(y.filter,p))return p==null?(y.filter=void 0,void this._updateLayer(y)):void(this._validate(a.y.filter,`layers.${y.id}.filter`,p,null,f)||(y.filter=a.aD(p),this._updateLayer(y)))}else this.fire(new a.j(new Error(`Cannot filter non-existing layer "${s}".`)))}getFilter(s){return a.aD(this.getLayer(s).filter)}setLayoutProperty(s,p,f,y={}){this._checkLoaded();const x=this.getLayer(s);x?a.aG(x.getLayoutProperty(p),f)||(x.setLayoutProperty(p,f,y),this._updateLayer(x)):this.fire(new a.j(new Error(`Cannot style non-existing layer "${s}".`)))}getLayoutProperty(s,p){const f=this.getLayer(s);if(f)return f.getLayoutProperty(p);this.fire(new a.j(new Error(`Cannot get style of non-existing layer "${s}".`)))}setPaintProperty(s,p,f,y={}){this._checkLoaded();const x=this.getLayer(s);x?a.aG(x.getPaintProperty(p),f)||(x.setPaintProperty(p,f,y)&&this._updateLayer(x),this._changed=!0,this._updatedPaintProps[s]=!0):this.fire(new a.j(new Error(`Cannot style non-existing layer "${s}".`)))}getPaintProperty(s,p){return this.getLayer(s).getPaintProperty(p)}setFeatureState(s,p){this._checkLoaded();const f=s.source,y=s.sourceLayer,x=this.sourceCaches[f];if(x===void 0)return void this.fire(new a.j(new Error(`The source '${f}' does not exist in the map's style.`)));const C=x.getSource().type;C==="geojson"&&y?this.fire(new a.j(new Error("GeoJSON sources cannot have a sourceLayer parameter."))):C!=="vector"||y?(s.id===void 0&&this.fire(new a.j(new Error("The feature id parameter must be provided."))),x.setFeatureState(y,s.id,p)):this.fire(new a.j(new Error("The sourceLayer parameter must be provided for vector source types.")))}removeFeatureState(s,p){this._checkLoaded();const f=s.source,y=this.sourceCaches[f];if(y===void 0)return void this.fire(new a.j(new Error(`The source '${f}' does not exist in the map's style.`)));const x=y.getSource().type,C=x==="vector"?s.sourceLayer:void 0;x!=="vector"||C?p&&typeof s.id!="string"&&typeof s.id!="number"?this.fire(new a.j(new Error("A feature id is required to remove its specific state property."))):y.removeFeatureState(C,s.id,p):this.fire(new a.j(new Error("The sourceLayer parameter must be provided for vector source types.")))}getFeatureState(s){this._checkLoaded();const p=s.source,f=s.sourceLayer,y=this.sourceCaches[p];if(y!==void 0)return y.getSource().type!=="vector"||f?(s.id===void 0&&this.fire(new a.j(new Error("The feature id parameter must be provided."))),y.getFeatureState(f,s.id)):void this.fire(new a.j(new Error("The sourceLayer parameter must be provided for vector source types.")));this.fire(new a.j(new Error(`The source '${p}' does not exist in the map's style.`)))}getTransition(){return a.e({duration:300,delay:0},this.stylesheet&&this.stylesheet.transition)}serialize(){if(!this._loaded)return;const s=a.aH(this.sourceCaches,x=>x.serialize()),p=this._serializeByIds(this._order),f=this.map.getTerrain()||void 0,y=this.stylesheet;return a.aI({version:y.version,name:y.name,metadata:y.metadata,light:y.light,center:y.center,zoom:y.zoom,bearing:y.bearing,pitch:y.pitch,sprite:y.sprite,glyphs:y.glyphs,transition:y.transition,sources:s,layers:p,terrain:f},x=>x!==void 0)}_updateLayer(s){this._updatedLayers[s.id]=!0,s.source&&!this._updatedSources[s.source]&&this.sourceCaches[s.source].getSource().type!=="raster"&&(this._updatedSources[s.source]="reload",this.sourceCaches[s.source].pause()),this._serializedLayers=null,this._changed=!0}_flattenAndSortRenderedFeatures(s){const p=C=>this._layers[C].type==="fill-extrusion",f={},y=[];for(let C=this._order.length-1;C>=0;C--){const M=this._order[C];if(p(M)){f[M]=C;for(const L of s){const N=L[M];if(N)for(const z of N)y.push(z)}}}y.sort((C,M)=>M.intersectionZ-C.intersectionZ);const x=[];for(let C=this._order.length-1;C>=0;C--){const M=this._order[C];if(p(M))for(let L=y.length-1;L>=0;L--){const N=y[L].feature;if(f[N.layer.id]<C)break;x.push(N),y.pop()}else for(const L of s){const N=L[M];if(N)for(const z of N)x.push(z.feature)}}return x}queryRenderedFeatures(s,p,f){p&&p.filter&&this._validate(a.y.filter,"queryRenderedFeatures.filter",p.filter,null,p);const y={};if(p&&p.layers){if(!Array.isArray(p.layers))return this.fire(new a.j(new Error("parameters.layers must be an Array."))),[];for(const M of p.layers){const L=this._layers[M];if(!L)return this.fire(new a.j(new Error(`The layer '${M}' does not exist in the map's style and cannot be queried for features.`))),[];y[L.source]=!0}}const x=[];p.availableImages=this._availableImages;const C=this._serializedAllLayers();for(const M in this.sourceCaches)p.layers&&!y[M]||x.push(Re(this.sourceCaches[M],this._layers,C,s,p,f));return this.placement&&x.push(function(M,L,N,z,B,H,lt){const ut={},ht=H.queryRenderedSymbols(z),st=[];for(const Mt of Object.keys(ht).map(Number))st.push(lt[Mt]);st.sort(us);for(const Mt of st){const Ft=Mt.featureIndex.lookupSymbolFeatures(ht[Mt.bucketInstanceId],L,Mt.bucketIndex,Mt.sourceLayerIndex,B.filter,B.layers,B.availableImages,M);for(const yt in Ft){const Pt=ut[yt]=ut[yt]||[],Vt=Ft[yt];Vt.sort((qt,Yt)=>{const ne=Mt.featureSortOrder;if(ne){const Qt=ne.indexOf(qt.featureIndex);return ne.indexOf(Yt.featureIndex)-Qt}return Yt.featureIndex-qt.featureIndex});for(const qt of Vt)Pt.push(qt)}}for(const Mt in ut)ut[Mt].forEach(Ft=>{const yt=Ft.feature,Pt=N[M[Mt].source].getFeatureState(yt.layer["source-layer"],yt.id);yt.source=yt.layer.source,yt.layer["source-layer"]&&(yt.sourceLayer=yt.layer["source-layer"]),yt.state=Pt});return ut}(this._layers,C,this.sourceCaches,s,p,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(x)}querySourceFeatures(s,p){p&&p.filter&&this._validate(a.y.filter,"querySourceFeatures.filter",p.filter,null,p);const f=this.sourceCaches[s];return f?function(y,x){const C=y.getRenderableIds().map(N=>y.getTileByID(N)),M=[],L={};for(let N=0;N<C.length;N++){const z=C[N],B=z.tileID.canonical.key;L[B]||(L[B]=!0,z.querySourceFeatures(M,x))}return M}(f,p):[]}addSourceType(s,p,f){return cr(s)?f(new Error(`A source type called "${s}" already exists.`)):(((y,x)=>{Io[y]=x})(s,p),p.workerSourceURL?void this.dispatcher.broadcast("loadWorkerSource",{name:s,url:p.workerSourceURL},f):f(null,null))}getLight(){return this.light.getLight()}setLight(s,p={}){this._checkLoaded();const f=this.light.getLight();let y=!1;for(const C in s)if(!a.aG(s[C],f[C])){y=!0;break}if(!y)return;const x={now:a.h.now(),transition:a.e({duration:300,delay:0},this.stylesheet.transition)};this.light.setLight(s,p),this.light.updateTransitions(x)}_validate(s,p,f,y,x={}){return(!x||x.validate!==!1)&&Cn(this,s.call(a.y,a.e({key:p,style:this.serialize(),value:f,styleSpec:a.v},y)))}_remove(s=!0){this._request&&(this._request.cancel(),this._request=null),this._spriteRequest&&(this._spriteRequest.cancel(),this._spriteRequest=null),a.aJ.off("pluginStateChange",this._rtlTextPluginCallback);for(const p in this._layers)this._layers[p].setEventedParent(null);for(const p in this.sourceCaches){const f=this.sourceCaches[p];f.setEventedParent(null),f.onRemove(this.map)}this.imageManager.setEventedParent(null),this.setEventedParent(null),this.dispatcher.remove(s)}_clearSource(s){this.sourceCaches[s].clearTiles()}_reloadSource(s){this.sourceCaches[s].resume(),this.sourceCaches[s].reload()}_updateSources(s){for(const p in this.sourceCaches)this.sourceCaches[p].update(s,this.map.terrain)}_generateCollisionBoxes(){for(const s in this.sourceCaches)this._reloadSource(s)}_updatePlacement(s,p,f,y,x=!1){let C=!1,M=!1;const L={};for(const N of this._order){const z=this._layers[N];if(z.type!=="symbol")continue;if(!L[z.source]){const H=this.sourceCaches[z.source];L[z.source]=H.getRenderableIds(!0).map(lt=>H.getTileByID(lt)).sort((lt,ut)=>ut.tileID.overscaledZ-lt.tileID.overscaledZ||(lt.tileID.isLessThan(ut.tileID)?-1:1))}const B=this.crossTileSymbolIndex.addLayer(z,L[z.source],s.center.lng);C=C||B}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._order),((x=x||this._layerOrderChanged||f===0)||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(a.h.now(),s.zoom))&&(this.pauseablePlacement=new Qa(s,this.map.terrain,this._order,x,p,f,y,this.placement),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._order,this._layers,L),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(a.h.now()),M=!0),C&&this.pauseablePlacement.placement.setStale()),M||C)for(const N of this._order){const z=this._layers[N];z.type==="symbol"&&this.placement.updateLayerOpacities(z,L[z.source])}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(a.h.now())}_releaseSymbolFadeTiles(){for(const s in this.sourceCaches)this.sourceCaches[s].releaseSymbolFadeTiles()}getImages(s,p,f){this.imageManager.getImages(p.icons,f),this._updateTilesForChangedImages();const y=this.sourceCaches[p.source];y&&y.setDependencies(p.tileID.key,p.type,p.icons)}getGlyphs(s,p,f){this.glyphManager.getGlyphs(p.stacks,f);const y=this.sourceCaches[p.source];y&&y.setDependencies(p.tileID.key,p.type,[""])}getResource(s,p,f){return a.m(p,f)}getGlyphsUrl(){return this.stylesheet.glyphs||null}setGlyphs(s,p={}){this._checkLoaded(),s&&this._validate(a.y.glyphs,"glyphs",s,null,p)||(this._glyphsDidChange=!0,this.stylesheet.glyphs=s,this.glyphManager.entries={},this.glyphManager.setURL(s))}addSprite(s,p,f={},y){this._checkLoaded();const x=[{id:s,url:p}],C=[...et(this.stylesheet.sprite),...x];this._validate(a.y.sprite,"sprite",C,null,f)||(this.stylesheet.sprite=C,this._loadSprite(x,!0,y))}removeSprite(s){this._checkLoaded();const p=et(this.stylesheet.sprite);if(p.find(f=>f.id===s)){if(this._spritesImagesIds[s])for(const f of this._spritesImagesIds[s])this.imageManager.removeImage(f),this._changedImages[f]=!0;p.splice(p.findIndex(f=>f.id===s),1),this.stylesheet.sprite=p.length>0?p:void 0,delete this._spritesImagesIds[s],this._availableImages=this.imageManager.listImages(),this._changed=!0,this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new a.k("data",{dataType:"style"}))}else this.fire(new a.j(new Error(`Sprite "${s}" doesn't exists on this map.`)))}getSprite(){return et(this.stylesheet.sprite)}setSprite(s,p={},f){this._checkLoaded(),s&&this._validate(a.y.sprite,"sprite",s,null,p)||(this.stylesheet.sprite=s,s?this._loadSprite(s,!0,f):(this._unloadSprite(),f&&f(null)))}}ki.registerForPluginStateChange=a.aK;var eh=a.Q([{name:"a_pos",type:"Int16",components:2}]),vu="attribute vec3 a_pos3d;uniform mat4 u_matrix;uniform float u_ele_delta;varying vec2 v_texture_pos;varying float v_depth;void main() {float extent=8192.0;float ele_delta=a_pos3d.z==1.0 ? u_ele_delta : 0.0;v_texture_pos=a_pos3d.xy/extent;gl_Position=u_matrix*vec4(a_pos3d.xy,get_elevation(a_pos3d.xy)-ele_delta,1.0);v_depth=gl_Position.z/gl_Position.w;}";const An={prelude:Vr(`#ifdef GL_ES
precision mediump float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif
`,`#ifdef GL_ES
precision highp float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif
vec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0
);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}
#ifdef TERRAIN3D
uniform sampler2D u_terrain;uniform float u_terrain_dim;uniform mat4 u_terrain_matrix;uniform vec4 u_terrain_unpack;uniform float u_terrain_exaggeration;uniform highp sampler2D u_depth;
#endif
const highp vec4 bitSh=vec4(256.*256.*256.,256.*256.,256.,1.);const highp vec4 bitShifts=vec4(1.)/bitSh;highp float unpack(highp vec4 color) {return dot(color,bitShifts);}highp float depthOpacity(vec3 frag) {
#ifdef TERRAIN3D
highp float d=unpack(texture2D(u_depth,frag.xy*0.5+0.5))+0.0001-frag.z;return 1.0-max(0.0,min(1.0,-d*500.0));
#else
return 1.0;
#endif
}float calculate_visibility(vec4 pos) {
#ifdef TERRAIN3D
vec3 frag=pos.xyz/pos.w;highp float d=depthOpacity(frag);if (d > 0.95) return 1.0;return (d+depthOpacity(frag+vec3(0.0,0.01,0.0)))/2.0;
#else
return 1.0;
#endif
}float ele(vec2 pos) {
#ifdef TERRAIN3D
vec4 rgb=(texture2D(u_terrain,pos)*255.0)*u_terrain_unpack;return rgb.r+rgb.g+rgb.b-u_terrain_unpack.a;
#else
return 0.0;
#endif
}float get_elevation(vec2 pos) {
#ifdef TERRAIN3D
vec2 coord=(u_terrain_matrix*vec4(pos,0.0,1.0)).xy*u_terrain_dim+1.0;vec2 f=fract(coord);vec2 c=(floor(coord)+0.5)/(u_terrain_dim+2.0);float d=1.0/(u_terrain_dim+2.0);float tl=ele(c);float tr=ele(c+vec2(d,0.0));float bl=ele(c+vec2(0.0,d));float br=ele(c+vec2(d,d));float elevation=mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);return elevation*u_terrain_exaggeration;
#else
return 0.0;
#endif
}`),background:Vr(`uniform vec4 u_color;uniform float u_opacity;void main() {gl_FragColor=u_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),backgroundPattern:Vr(`uniform vec2 u_pattern_tl_a;uniform vec2 u_pattern_br_a;uniform vec2 u_pattern_tl_b;uniform vec2 u_pattern_br_b;uniform vec2 u_texsize;uniform float u_mix;uniform float u_opacity;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(u_pattern_tl_a/u_texsize,u_pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(u_pattern_tl_b/u_texsize,u_pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);gl_FragColor=mix(color1,color2,u_mix)*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_pattern_size_a;uniform vec2 u_pattern_size_b;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_scale_a;uniform float u_scale_b;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_a*u_pattern_size_a,u_tile_units_to_pixels,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_b*u_pattern_size_b,u_tile_units_to_pixels,a_pos);}"),circle:Vr(`varying vec3 v_data;varying float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=v_data.xy;float extrude_length=length(extrude);lowp float antialiasblur=v_data.z;float antialiased_blur=-max(blur,antialiasblur);float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width));gl_FragColor=v_visibility*opacity_t*mix(color*opacity,stroke_color*stroke_opacity,color_t);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform bool u_scale_with_map;uniform bool u_pitch_with_map;uniform vec2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;attribute vec2 a_pos;varying vec3 v_data;varying float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main(void) {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);float ele=get_elevation(circle_center);v_visibility=calculate_visibility(u_matrix*vec4(circle_center,ele,1.0));if (u_pitch_with_map) {vec2 corner_position=circle_center;if (u_scale_with_map) {corner_position+=extrude*(radius+stroke_width)*u_extrude_scale;} else {vec4 projected_center=u_matrix*vec4(circle_center,0,1);corner_position+=extrude*(radius+stroke_width)*u_extrude_scale*(projected_center.w/u_camera_to_center_distance);}gl_Position=u_matrix*vec4(corner_position,ele,1);} else {gl_Position=u_matrix*vec4(circle_center,ele,1);if (u_scale_with_map) {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*u_camera_to_center_distance;} else {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*gl_Position.w;}}lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);}`),clippingMask:Vr("void main() {gl_FragColor=vec4(1.0);}","attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),heatmap:Vr(`uniform highp float u_intensity;varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
float d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);gl_FragColor=vec4(val,1.0,1.0,1.0);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;attribute vec2 a_pos;varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#pragma mapbox: define mediump float radius
const highp float ZERO=1.0/255.0/16.0;
#define GAUSS_COEF 0.3989422804014327
void main(void) {
#pragma mapbox: initialize highp float weight
#pragma mapbox: initialize mediump float radius
vec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec4 pos=vec4(floor(a_pos*0.5)+extrude,0,1);gl_Position=u_matrix*pos;}`),heatmapTexture:Vr(`uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;varying vec2 v_pos;void main() {float t=texture2D(u_image,v_pos).r;vec4 color=texture2D(u_color_ramp,vec2(t,0.5));gl_FragColor=color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(0.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_world;attribute vec2 a_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos*u_world,0,1);v_pos.x=a_pos.x;v_pos.y=1.0-a_pos.y;}"),collisionBox:Vr("varying float v_placed;varying float v_notUsed;void main() {float alpha=0.5;gl_FragColor=vec4(1.0,0.0,0.0,1.0)*alpha;if (v_placed > 0.5) {gl_FragColor=vec4(0.0,0.0,1.0,0.5)*alpha;}if (v_notUsed > 0.5) {gl_FragColor*=.1;}}","attribute vec2 a_pos;attribute vec2 a_anchor_pos;attribute vec2 a_extrude;attribute vec2 a_placed;attribute vec2 a_shift;uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;varying float v_placed;varying float v_notUsed;void main() {vec4 projectedPoint=u_matrix*vec4(a_anchor_pos,0,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);gl_Position=u_matrix*vec4(a_pos,get_elevation(a_pos),1.0);gl_Position.xy+=(a_extrude+a_shift)*u_extrude_scale*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;}"),collisionCircle:Vr("varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);gl_FragColor=color*alpha*opacity_t;}","attribute vec2 a_pos;attribute float a_radius;attribute vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}"),debug:Vr("uniform highp vec4 u_color;uniform sampler2D u_overlay;varying vec2 v_uv;void main() {vec4 overlay_color=texture2D(u_overlay,v_uv);gl_FragColor=mix(u_color,overlay_color,overlay_color.a);}","attribute vec2 a_pos;varying vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {v_uv=a_pos/8192.0;gl_Position=u_matrix*vec4(a_pos*u_overlay_scale,get_elevation(a_pos),1);}"),fill:Vr(`#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_FragColor=color*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);}`),fillOutline:Vr(`varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);gl_FragColor=outline_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;uniform vec2 u_world;varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;}`),fillOutlinePattern:Vr(`uniform vec2 u_texsize;uniform sampler2D u_image;uniform float u_fade;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);gl_FragColor=mix(color1,color2,u_fade)*alpha*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;gl_Position=u_matrix*vec4(a_pos,0,1);vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,a_pos);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;}`),fillPattern:Vr(`#ifdef GL_ES
precision highp float;
#endif
uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);gl_FragColor=mix(color1,color2,u_fade)*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileZoomRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileZoomRatio,a_pos);}`),fillExtrusion:Vr(`varying vec4 v_color;void main() {gl_FragColor=v_color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;attribute vec2 a_pos;attribute vec4 a_normal_ed;
#ifdef TERRAIN3D
attribute vec2 a_centroid;
#endif
varying vec4 v_color;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
vec3 normal=a_normal_ed.xyz;
#ifdef TERRAIN3D
float height_terrain3d_offset=get_elevation(a_centroid);float base_terrain3d_offset=height_terrain3d_offset-(base > 0.0 ? 0.0 : 10.0);
#else
float height_terrain3d_offset=0.0;float base_terrain3d_offset=0.0;
#endif
base=max(0.0,base)+base_terrain3d_offset;height=max(0.0,height)+height_terrain3d_offset;float t=mod(normal.x,2.0);gl_Position=u_matrix*vec4(a_pos,t > 0.0 ? height : base,1);float colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;v_color=vec4(0.0,0.0,0.0,1.0);vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;float directional=clamp(dot(normal/16384.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_color.r+=clamp(color.r*directional*u_lightcolor.r,mix(0.0,0.3,1.0-u_lightcolor.r),1.0);v_color.g+=clamp(color.g*directional*u_lightcolor.g,mix(0.0,0.3,1.0-u_lightcolor.g),1.0);v_color.b+=clamp(color.b*directional*u_lightcolor.b,mix(0.0,0.3,1.0-u_lightcolor.b),1.0);v_color*=u_opacity;}`),fillExtrusionPattern:Vr(`uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);vec4 mixedColor=mix(color1,color2,u_fade);gl_FragColor=mixedColor*v_lighting;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform vec3 u_scale;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;attribute vec2 a_pos;attribute vec4 a_normal_ed;
#ifdef TERRAIN3D
attribute vec2 a_centroid;
#endif
varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec3 normal=a_normal_ed.xyz;float edgedistance=a_normal_ed.w;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;
#ifdef TERRAIN3D
float height_terrain3d_offset=get_elevation(a_centroid);float base_terrain3d_offset=height_terrain3d_offset-(base > 0.0 ? 0.0 : 10.0);
#else
float height_terrain3d_offset=0.0;float base_terrain3d_offset=0.0;
#endif
base=max(0.0,base)+base_terrain3d_offset;height=max(0.0,height)+height_terrain3d_offset;float t=mod(normal.x,2.0);float z=t > 0.0 ? height : base;gl_Position=u_matrix*vec4(a_pos,z,1);vec2 pos=normal.x==1.0 && normal.y==0.0 && normal.z==16384.0
? a_pos
: vec2(edgedistance,z*u_height_factor);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float directional=clamp(dot(normal/16383.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_lighting.rgb+=clamp(directional*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;}`),hillshadePrepare:Vr(`#ifdef GL_ES
precision highp float;
#endif
uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;uniform vec4 u_unpack;float getElevation(vec2 coord,float bias) {vec4 data=texture2D(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack)/4.0;}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y),0.0);float b=getElevation(v_pos+vec2(0,-epsilon.y),0.0);float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y),0.0);float d=getElevation(v_pos+vec2(-epsilon.x,0),0.0);float e=getElevation(v_pos,0.0);float f=getElevation(v_pos+vec2(epsilon.x,0),0.0);float g=getElevation(v_pos+vec2(-epsilon.x,epsilon.y),0.0);float h=getElevation(v_pos+vec2(0,epsilon.y),0.0);float i=getElevation(v_pos+vec2(epsilon.x,epsilon.y),0.0);float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2((c+f+f+i)-(a+d+d+g),(g+h+h+i)-(a+b+b+c))/pow(2.0,exaggeration+(19.2562-u_zoom));gl_FragColor=clamp(vec4(deriv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_dimension;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:Vr(`uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;
#define PI 3.141592653589793
void main() {vec4 pixel=texture2D(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);gl_FragColor=accent_color*(1.0-shade_color.a)+shade_color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;}"),line:Vr(`uniform lowp float u_device_pixel_ratio;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp float v_linesofar;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;v_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*2.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_width2=vec2(outset,inset);}`),lineGradient:Vr(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;varying highp vec2 v_uv;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);vec4 color=texture2D(u_image,v_uv);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;attribute float a_uv_x;attribute float a_split_index;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_units_to_pixels;uniform float u_image_height;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp vec2 v_uv;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec2(a_uv_x,a_split_index*texel_height-half_texel_height);vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_width2=vec2(outset,inset);}`),linePattern:Vr(`#ifdef GL_ES
precision highp float;
#endif
uniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform float u_fade;uniform mediump vec3 u_scale;uniform sampler2D u_image;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;vec2 pattern_size_a=vec2(display_size_a.x*fromScale/tileZoomRatio,display_size_a.y);vec2 pattern_size_b=vec2(display_size_b.x*toScale/tileZoomRatio,display_size_b.y);float aspect_a=display_size_a.y/v_width;float aspect_b=display_size_b.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float x_a=mod(v_linesofar/pattern_size_a.x*aspect_a,1.0);float x_b=mod(v_linesofar/pattern_size_b.x*aspect_b,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos_a=mix(pattern_tl_a*texel_size-texel_size,pattern_br_a*texel_size+texel_size,vec2(x_a,y));vec2 pos_b=mix(pattern_tl_b*texel_size-texel_size,pattern_br_b*texel_size+texel_size,vec2(x_b,y));vec4 color=mix(texture2D(u_image,pos_a),texture2D(u_image,pos_b),u_fade);gl_FragColor=color*alpha*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform vec2 u_units_to_pixels;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;}`),lineSDF:Vr(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;uniform float u_sdfgamma;uniform float u_mix;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float sdfdist_a=texture2D(u_image,v_tex_a).a;float sdfdist_b=texture2D(u_image,v_tex_b).a;float sdfdist=mix(sdfdist_a,sdfdist_b,u_mix);alpha*=smoothstep(0.5-u_sdfgamma/floorwidth,0.5+u_sdfgamma/floorwidth,sdfdist);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_patternscale_a;uniform float u_tex_y_a;uniform vec2 u_patternscale_b;uniform float u_tex_y_b;uniform vec2 u_units_to_pixels;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_tex_a=vec2(a_linesofar*u_patternscale_a.x/floorwidth,normal.y*u_patternscale_a.y+u_tex_y_a);v_tex_b=vec2(a_linesofar*u_patternscale_b.x/floorwidth,normal.y*u_patternscale_b.y+u_tex_y_b);v_width2=vec2(outset,inset);}`),raster:Vr(`uniform float u_fade_t;uniform float u_opacity;uniform sampler2D u_image0;uniform sampler2D u_image1;varying vec2 v_pos0;varying vec2 v_pos1;uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;void main() {vec4 color0=texture2D(u_image0,v_pos0);vec4 color1=texture2D(u_image1,v_pos1);if (color0.a > 0.0) {color0.rgb=color0.rgb/color0.a;}if (color1.a > 0.0) {color1.rgb=color1.rgb/color1.a;}vec4 color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 rgb=color.rgb;rgb=vec3(dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);gl_FragColor=vec4(mix(u_high_vec,u_low_vec,rgb)*color.a,color.a);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform float u_buffer_scale;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos0;varying vec2 v_pos1;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos0=(((a_texture_pos/8192.0)-0.5)/u_buffer_scale )+0.5;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;}"),symbolIcon:Vr(`uniform sampler2D u_texture;varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
lowp float alpha=opacity*v_fade_opacity;gl_FragColor=texture2D(u_texture,v_tex)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec4 a_pixeloffset;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_minFontScale=a_pixeloffset.zw/256.0;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,ele,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),ele,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,ele,1.0);float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*max(a_minFontScale,fontScale)+a_pxoffset/16.0),z,1.0);v_tex=a_tex/u_texsize;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float visibility=calculate_visibility(projectedPoint);v_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));}`),symbolSDF:Vr(`#define SDF_PX 8.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float inner_edge=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);inner_edge=inner_edge+gamma*gamma_scale;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(inner_edge-gamma_scaled,inner_edge+gamma_scaled,dist);if (u_is_halo) {lowp float halo_edge=(6.0-halo_width/fontScale)/SDF_PX;alpha=min(smoothstep(halo_edge-gamma_scaled,halo_edge+gamma_scaled,dist),1.0-alpha);}gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec4 a_pixeloffset;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,ele,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),ele,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,ele,1.0);float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset),z,1.0);float gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float visibility=calculate_visibility(projectedPoint);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,interpolated_fade_opacity);}`),symbolTextAndIcon:Vr(`#define SDF_PX 8.0
#define SDF 1.0
#define ICON 0.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;gl_FragColor=texture2D(u_texture_icon,tex_icon)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
return;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_texsize_icon;varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,ele,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),ele,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,ele,1.0);float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale),z,1.0);float gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float visibility=calculate_visibility(projectedPoint);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));v_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,interpolated_fade_opacity,is_sdf);}`),terrain:Vr("uniform sampler2D u_texture;varying vec2 v_texture_pos;void main() {gl_FragColor=texture2D(u_texture,v_texture_pos);}",vu),terrainDepth:Vr("varying float v_depth;const highp vec4 bitSh=vec4(256.*256.*256.,256.*256.,256.,1.);const highp vec4 bitMsk=vec4(0.,vec3(1./256.0));highp vec4 pack(highp float value) {highp vec4 comp=fract(value*bitSh);comp-=comp.xxyz*bitMsk;return comp;}void main() {gl_FragColor=pack(v_depth);}",vu),terrainCoords:Vr("precision mediump float;uniform sampler2D u_texture;uniform float u_terrain_coords_id;varying vec2 v_texture_pos;void main() {vec4 rgba=texture2D(u_texture,v_texture_pos);gl_FragColor=vec4(rgba.r,rgba.g,rgba.b,u_terrain_coords_id);}",vu)};function Vr(v,s){const p=/#pragma mapbox: ([\w]+) ([\w]+) ([\w]+) ([\w]+)/g,f=s.match(/attribute ([\w]+) ([\w]+)/g),y=v.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),x=s.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),C=x?x.concat(y):y,M={};return{fragmentSource:v=v.replace(p,(L,N,z,B,H)=>(M[H]=!0,N==="define"?`
#ifndef HAS_UNIFORM_u_${H}
varying ${z} ${B} ${H};
#else
uniform ${z} ${B} u_${H};
#endif
`:`
#ifdef HAS_UNIFORM_u_${H}
    ${z} ${B} ${H} = u_${H};
#endif
`)),vertexSource:s=s.replace(p,(L,N,z,B,H)=>{const lt=B==="float"?"vec2":"vec4",ut=H.match(/color/)?"color":lt;return M[H]?N==="define"?`
#ifndef HAS_UNIFORM_u_${H}
uniform lowp float u_${H}_t;
attribute ${z} ${lt} a_${H};
varying ${z} ${B} ${H};
#else
uniform ${z} ${B} u_${H};
#endif
`:ut==="vec4"?`
#ifndef HAS_UNIFORM_u_${H}
    ${H} = a_${H};
#else
    ${z} ${B} ${H} = u_${H};
#endif
`:`
#ifndef HAS_UNIFORM_u_${H}
    ${H} = unpack_mix_${ut}(a_${H}, u_${H}_t);
#else
    ${z} ${B} ${H} = u_${H};
#endif
`:N==="define"?`
#ifndef HAS_UNIFORM_u_${H}
uniform lowp float u_${H}_t;
attribute ${z} ${lt} a_${H};
#else
uniform ${z} ${B} u_${H};
#endif
`:ut==="vec4"?`
#ifndef HAS_UNIFORM_u_${H}
    ${z} ${B} ${H} = a_${H};
#else
    ${z} ${B} ${H} = u_${H};
#endif
`:`
#ifndef HAS_UNIFORM_u_${H}
    ${z} ${B} ${H} = unpack_mix_${ut}(a_${H}, u_${H}_t);
#else
    ${z} ${B} ${H} = u_${H};
#endif
`}),staticAttributes:f,staticUniforms:C}}class Ma{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffer=null,this.vao=null}bind(s,p,f,y,x,C,M,L,N){this.context=s;let z=this.boundPaintVertexBuffers.length!==y.length;for(let B=0;!z&&B<y.length;B++)this.boundPaintVertexBuffers[B]!==y[B]&&(z=!0);!this.vao||this.boundProgram!==p||this.boundLayoutVertexBuffer!==f||z||this.boundIndexBuffer!==x||this.boundVertexOffset!==C||this.boundDynamicVertexBuffer!==M||this.boundDynamicVertexBuffer2!==L||this.boundDynamicVertexBuffer3!==N?this.freshBind(p,f,y,x,C,M,L,N):(s.bindVertexArray.set(this.vao),M&&M.bind(),x&&x.dynamicDraw&&x.bind(),L&&L.bind(),N&&N.bind())}freshBind(s,p,f,y,x,C,M,L){const N=s.numAttributes,z=this.context,B=z.gl;this.vao&&this.destroy(),this.vao=z.createVertexArray(),z.bindVertexArray.set(this.vao),this.boundProgram=s,this.boundLayoutVertexBuffer=p,this.boundPaintVertexBuffers=f,this.boundIndexBuffer=y,this.boundVertexOffset=x,this.boundDynamicVertexBuffer=C,this.boundDynamicVertexBuffer2=M,this.boundDynamicVertexBuffer3=L,p.enableAttributes(B,s);for(const H of f)H.enableAttributes(B,s);C&&C.enableAttributes(B,s),M&&M.enableAttributes(B,s),L&&L.enableAttributes(B,s),p.bind(),p.setVertexAttribPointers(B,s,x);for(const H of f)H.bind(),H.setVertexAttribPointers(B,s,x);C&&(C.bind(),C.setVertexAttribPointers(B,s,x)),y&&y.bind(),M&&(M.bind(),M.setVertexAttribPointers(B,s,x)),L&&(L.bind(),L.setVertexAttribPointers(B,s,x)),z.currentNumAttributes=N}destroy(){this.vao&&(this.context.deleteVertexArray(this.vao),this.vao=null)}}function Ln(v){const s=[];for(let p=0;p<v.length;p++){if(v[p]===null)continue;const f=v[p].split(" ");s.push(f.pop())}return s}class Qu{constructor(s,p,f,y,x,C){const M=s.gl;this.program=M.createProgram();const L=Ln(p.staticAttributes),N=f?f.getBinderAttributes():[],z=L.concat(N),B=An.prelude.staticUniforms?Ln(An.prelude.staticUniforms):[],H=p.staticUniforms?Ln(p.staticUniforms):[],lt=f?f.getBinderUniforms():[],ut=B.concat(H).concat(lt),ht=[];for(const qt of ut)ht.indexOf(qt)<0&&ht.push(qt);const st=f?f.defines():[];x&&st.push("#define OVERDRAW_INSPECTOR;"),C&&st.push("#define TERRAIN3D;");const Mt=st.concat(An.prelude.fragmentSource,p.fragmentSource).join(`
`),Ft=st.concat(An.prelude.vertexSource,p.vertexSource).join(`
`),yt=M.createShader(M.FRAGMENT_SHADER);if(M.isContextLost())return void(this.failedToCreate=!0);if(M.shaderSource(yt,Mt),M.compileShader(yt),!M.getShaderParameter(yt,M.COMPILE_STATUS))throw new Error(`Could not compile fragment shader: ${M.getShaderInfoLog(yt)}`);M.attachShader(this.program,yt);const Pt=M.createShader(M.VERTEX_SHADER);if(M.isContextLost())return void(this.failedToCreate=!0);if(M.shaderSource(Pt,Ft),M.compileShader(Pt),!M.getShaderParameter(Pt,M.COMPILE_STATUS))throw new Error(`Could not compile vertex shader: ${M.getShaderInfoLog(Pt)}`);M.attachShader(this.program,Pt),this.attributes={};const Vt={};this.numAttributes=z.length;for(let qt=0;qt<this.numAttributes;qt++)z[qt]&&(M.bindAttribLocation(this.program,qt,z[qt]),this.attributes[z[qt]]=qt);if(M.linkProgram(this.program),!M.getProgramParameter(this.program,M.LINK_STATUS))throw new Error(`Program failed to link: ${M.getProgramInfoLog(this.program)}`);M.deleteShader(Pt),M.deleteShader(yt);for(let qt=0;qt<ht.length;qt++){const Yt=ht[qt];if(Yt&&!Vt[Yt]){const ne=M.getUniformLocation(this.program,Yt);ne&&(Vt[Yt]=ne)}}this.fixedUniforms=y(s,Vt),this.terrainUniforms=((qt,Yt)=>({u_depth:new a.aL(qt,Yt.u_depth),u_terrain:new a.aL(qt,Yt.u_terrain),u_terrain_dim:new a.aM(qt,Yt.u_terrain_dim),u_terrain_matrix:new a.aN(qt,Yt.u_terrain_matrix),u_terrain_unpack:new a.aO(qt,Yt.u_terrain_unpack),u_terrain_exaggeration:new a.aM(qt,Yt.u_terrain_exaggeration)}))(s,Vt),this.binderUniforms=f?f.getUniforms(s,Vt):[]}draw(s,p,f,y,x,C,M,L,N,z,B,H,lt,ut,ht,st,Mt,Ft){const yt=s.gl;if(this.failedToCreate)return;if(s.program.set(this.program),s.setDepthMode(f),s.setStencilMode(y),s.setColorMode(x),s.setCullFace(C),L){s.activeTexture.set(yt.TEXTURE2),yt.bindTexture(yt.TEXTURE_2D,L.depthTexture),s.activeTexture.set(yt.TEXTURE3),yt.bindTexture(yt.TEXTURE_2D,L.texture);for(const Vt in this.terrainUniforms)this.terrainUniforms[Vt].set(L[Vt])}for(const Vt in this.fixedUniforms)this.fixedUniforms[Vt].set(M[Vt]);ht&&ht.setUniforms(s,this.binderUniforms,lt,{zoom:ut});let Pt=0;switch(p){case yt.LINES:Pt=2;break;case yt.TRIANGLES:Pt=3;break;case yt.LINE_STRIP:Pt=1}for(const Vt of H.get()){const qt=Vt.vaos||(Vt.vaos={});(qt[N]||(qt[N]=new Ma)).bind(s,this,z,ht?ht.getPaintVertexBuffers():[],B,Vt.vertexOffset,st,Mt,Ft),yt.drawElements(p,Vt.primitiveLength*Pt,yt.UNSIGNED_SHORT,Vt.primitiveOffset*Pt*2)}}}function ds(v,s,p){const f=1/bt(p,1,s.transform.tileZoom),y=Math.pow(2,p.tileID.overscaledZ),x=p.tileSize*Math.pow(2,s.transform.tileZoom)/y,C=x*(p.tileID.canonical.x+p.tileID.wrap*y),M=x*p.tileID.canonical.y;return{u_image:0,u_texsize:p.imageAtlasTexture.size,u_scale:[f,v.fromScale,v.toScale],u_fade:v.t,u_pixel_coord_upper:[C>>16,M>>16],u_pixel_coord_lower:[65535&C,65535&M]}}const cp=(v,s,p,f)=>{const y=s.style.light,x=y.properties.get("position"),C=[x.x,x.y,x.z],M=function(){var N=new a.A(9);return a.A!=Float32Array&&(N[1]=0,N[2]=0,N[3]=0,N[5]=0,N[6]=0,N[7]=0),N[0]=1,N[4]=1,N[8]=1,N}();y.properties.get("anchor")==="viewport"&&function(N,z){var B=Math.sin(z),H=Math.cos(z);N[0]=H,N[1]=B,N[2]=0,N[3]=-B,N[4]=H,N[5]=0,N[6]=0,N[7]=0,N[8]=1}(M,-s.transform.angle),function(N,z,B){var H=z[0],lt=z[1],ut=z[2];N[0]=H*B[0]+lt*B[3]+ut*B[6],N[1]=H*B[1]+lt*B[4]+ut*B[7],N[2]=H*B[2]+lt*B[5]+ut*B[8]}(C,C,M);const L=y.properties.get("color");return{u_matrix:v,u_lightpos:C,u_lightintensity:y.properties.get("intensity"),u_lightcolor:[L.r,L.g,L.b],u_vertical_gradient:+p,u_opacity:f}},el=(v,s,p,f,y,x,C)=>a.e(cp(v,s,p,f),ds(x,s,C),{u_height_factor:-Math.pow(2,y.overscaledZ)/C.tileSize/8}),tc=v=>({u_matrix:v}),T=(v,s,p,f)=>a.e(tc(v),ds(p,s,f)),D=(v,s)=>({u_matrix:v,u_world:s}),Y=(v,s,p,f,y)=>a.e(T(v,s,p,f),{u_world:y}),dt=(v,s,p,f)=>{const y=v.transform;let x,C;if(f.paint.get("circle-pitch-alignment")==="map"){const M=bt(p,1,y.zoom);x=!0,C=[M,M]}else x=!1,C=y.pixelsToGLUnits;return{u_camera_to_center_distance:y.cameraToCenterDistance,u_scale_with_map:+(f.paint.get("circle-pitch-scale")==="map"),u_matrix:v.translatePosMatrix(s.posMatrix,p,f.paint.get("circle-translate"),f.paint.get("circle-translate-anchor")),u_pitch_with_map:+x,u_device_pixel_ratio:v.pixelRatio,u_extrude_scale:C}},It=(v,s,p)=>{const f=bt(p,1,s.zoom),y=Math.pow(2,s.zoom-p.tileID.overscaledZ),x=p.tileID.overscaleFactor();return{u_matrix:v,u_camera_to_center_distance:s.cameraToCenterDistance,u_pixels_to_tile_units:f,u_extrude_scale:[s.pixelsToGLUnits[0]/(f*y),s.pixelsToGLUnits[1]/(f*y)],u_overscale_factor:x}},Ct=(v,s,p=1)=>({u_matrix:v,u_color:s,u_overlay:0,u_overlay_scale:p}),Dt=v=>({u_matrix:v}),re=(v,s,p,f)=>({u_matrix:v,u_extrude_scale:bt(s,1,p),u_intensity:f});function ae(v,s){const p=Math.pow(2,s.canonical.z),f=s.canonical.y;return[new a.U(0,f/p).toLngLat().lat,new a.U(0,(f+1)/p).toLngLat().lat]}const we=(v,s,p,f)=>{const y=v.transform;return{u_matrix:ur(v,s,p,f),u_ratio:1/bt(s,1,y.zoom),u_device_pixel_ratio:v.pixelRatio,u_units_to_pixels:[1/y.pixelsToGLUnits[0],1/y.pixelsToGLUnits[1]]}},Ee=(v,s,p,f,y)=>a.e(we(v,s,p,y),{u_image:0,u_image_height:f}),_e=(v,s,p,f,y)=>{const x=v.transform,C=Rn(s,x);return{u_matrix:ur(v,s,p,y),u_texsize:s.imageAtlasTexture.size,u_ratio:1/bt(s,1,x.zoom),u_device_pixel_ratio:v.pixelRatio,u_image:0,u_scale:[C,f.fromScale,f.toScale],u_fade:f.t,u_units_to_pixels:[1/x.pixelsToGLUnits[0],1/x.pixelsToGLUnits[1]]}},sr=(v,s,p,f,y,x)=>{const C=v.lineAtlas,M=Rn(s,v.transform),L=p.layout.get("line-cap")==="round",N=C.getDash(f.from,L),z=C.getDash(f.to,L),B=N.width*y.fromScale,H=z.width*y.toScale;return a.e(we(v,s,p,x),{u_patternscale_a:[M/B,-N.height/2],u_patternscale_b:[M/H,-z.height/2],u_sdfgamma:C.width/(256*Math.min(B,H)*v.pixelRatio)/2,u_image:0,u_tex_y_a:N.y,u_tex_y_b:z.y,u_mix:y.t})};function Rn(v,s){return 1/bt(v,1,s.tileZoom)}function ur(v,s,p,f){return v.translatePosMatrix(f?f.posMatrix:s.tileID.posMatrix,s,p.paint.get("line-translate"),p.paint.get("line-translate-anchor"))}const Kn=(v,s,p,f,y)=>{return{u_matrix:v,u_tl_parent:s,u_scale_parent:p,u_buffer_scale:1,u_fade_t:f.mix,u_opacity:f.opacity*y.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:y.paint.get("raster-brightness-min"),u_brightness_high:y.paint.get("raster-brightness-max"),u_saturation_factor:(C=y.paint.get("raster-saturation"),C>0?1-1/(1.001-C):-C),u_contrast_factor:(x=y.paint.get("raster-contrast"),x>0?1/(1-x):1+x),u_spin_weights:Jt(y.paint.get("raster-hue-rotate"))};var x,C};function Jt(v){v*=Math.PI/180;const s=Math.sin(v),p=Math.cos(v);return[(2*p+1)/3,(-Math.sqrt(3)*s-p+1)/3,(Math.sqrt(3)*s-p+1)/3]}const ze=(v,s,p,f,y,x,C,M,L,N)=>{const z=y.transform;return{u_is_size_zoom_constant:+(v==="constant"||v==="source"),u_is_size_feature_constant:+(v==="constant"||v==="camera"),u_size_t:s?s.uSizeT:0,u_size:s?s.uSize:0,u_camera_to_center_distance:z.cameraToCenterDistance,u_pitch:z.pitch/360*2*Math.PI,u_rotate_symbol:+p,u_aspect_ratio:z.width/z.height,u_fade_change:y.options.fadeDuration?y.symbolFadeChange:1,u_matrix:x,u_label_plane_matrix:C,u_coord_matrix:M,u_is_text:+L,u_pitch_with_map:+f,u_texsize:N,u_texture:0}},tn=(v,s,p,f,y,x,C,M,L,N,z)=>{const B=y.transform;return a.e(ze(v,s,p,f,y,x,C,M,L,N),{u_gamma_scale:f?Math.cos(B._pitch)*B.cameraToCenterDistance:1,u_device_pixel_ratio:y.pixelRatio,u_is_halo:+z})},Dn=(v,s,p,f,y,x,C,M,L,N)=>a.e(tn(v,s,p,f,y,x,C,M,!0,L,!0),{u_texsize_icon:N,u_texture_icon:1}),Un=(v,s,p)=>({u_matrix:v,u_opacity:s,u_color:p}),Po=(v,s,p,f,y,x)=>a.e(function(C,M,L,N){const z=L.imageManager.getPattern(C.from.toString()),B=L.imageManager.getPattern(C.to.toString()),{width:H,height:lt}=L.imageManager.getPixelSize(),ut=Math.pow(2,N.tileID.overscaledZ),ht=N.tileSize*Math.pow(2,L.transform.tileZoom)/ut,st=ht*(N.tileID.canonical.x+N.tileID.wrap*ut),Mt=ht*N.tileID.canonical.y;return{u_image:0,u_pattern_tl_a:z.tl,u_pattern_br_a:z.br,u_pattern_tl_b:B.tl,u_pattern_br_b:B.br,u_texsize:[H,lt],u_mix:M.t,u_pattern_size_a:z.displaySize,u_pattern_size_b:B.displaySize,u_scale_a:M.fromScale,u_scale_b:M.toScale,u_tile_units_to_pixels:1/bt(N,1,L.transform.tileZoom),u_pixel_coord_upper:[st>>16,Mt>>16],u_pixel_coord_lower:[65535&st,65535&Mt]}}(f,x,p,y),{u_matrix:v,u_opacity:s}),rh={fillExtrusion:(v,s)=>({u_matrix:new a.aN(v,s.u_matrix),u_lightpos:new a.aP(v,s.u_lightpos),u_lightintensity:new a.aM(v,s.u_lightintensity),u_lightcolor:new a.aP(v,s.u_lightcolor),u_vertical_gradient:new a.aM(v,s.u_vertical_gradient),u_opacity:new a.aM(v,s.u_opacity)}),fillExtrusionPattern:(v,s)=>({u_matrix:new a.aN(v,s.u_matrix),u_lightpos:new a.aP(v,s.u_lightpos),u_lightintensity:new a.aM(v,s.u_lightintensity),u_lightcolor:new a.aP(v,s.u_lightcolor),u_vertical_gradient:new a.aM(v,s.u_vertical_gradient),u_height_factor:new a.aM(v,s.u_height_factor),u_image:new a.aL(v,s.u_image),u_texsize:new a.aQ(v,s.u_texsize),u_pixel_coord_upper:new a.aQ(v,s.u_pixel_coord_upper),u_pixel_coord_lower:new a.aQ(v,s.u_pixel_coord_lower),u_scale:new a.aP(v,s.u_scale),u_fade:new a.aM(v,s.u_fade),u_opacity:new a.aM(v,s.u_opacity)}),fill:(v,s)=>({u_matrix:new a.aN(v,s.u_matrix)}),fillPattern:(v,s)=>({u_matrix:new a.aN(v,s.u_matrix),u_image:new a.aL(v,s.u_image),u_texsize:new a.aQ(v,s.u_texsize),u_pixel_coord_upper:new a.aQ(v,s.u_pixel_coord_upper),u_pixel_coord_lower:new a.aQ(v,s.u_pixel_coord_lower),u_scale:new a.aP(v,s.u_scale),u_fade:new a.aM(v,s.u_fade)}),fillOutline:(v,s)=>({u_matrix:new a.aN(v,s.u_matrix),u_world:new a.aQ(v,s.u_world)}),fillOutlinePattern:(v,s)=>({u_matrix:new a.aN(v,s.u_matrix),u_world:new a.aQ(v,s.u_world),u_image:new a.aL(v,s.u_image),u_texsize:new a.aQ(v,s.u_texsize),u_pixel_coord_upper:new a.aQ(v,s.u_pixel_coord_upper),u_pixel_coord_lower:new a.aQ(v,s.u_pixel_coord_lower),u_scale:new a.aP(v,s.u_scale),u_fade:new a.aM(v,s.u_fade)}),circle:(v,s)=>({u_camera_to_center_distance:new a.aM(v,s.u_camera_to_center_distance),u_scale_with_map:new a.aL(v,s.u_scale_with_map),u_pitch_with_map:new a.aL(v,s.u_pitch_with_map),u_extrude_scale:new a.aQ(v,s.u_extrude_scale),u_device_pixel_ratio:new a.aM(v,s.u_device_pixel_ratio),u_matrix:new a.aN(v,s.u_matrix)}),collisionBox:(v,s)=>({u_matrix:new a.aN(v,s.u_matrix),u_camera_to_center_distance:new a.aM(v,s.u_camera_to_center_distance),u_pixels_to_tile_units:new a.aM(v,s.u_pixels_to_tile_units),u_extrude_scale:new a.aQ(v,s.u_extrude_scale),u_overscale_factor:new a.aM(v,s.u_overscale_factor)}),collisionCircle:(v,s)=>({u_matrix:new a.aN(v,s.u_matrix),u_inv_matrix:new a.aN(v,s.u_inv_matrix),u_camera_to_center_distance:new a.aM(v,s.u_camera_to_center_distance),u_viewport_size:new a.aQ(v,s.u_viewport_size)}),debug:(v,s)=>({u_color:new a.aR(v,s.u_color),u_matrix:new a.aN(v,s.u_matrix),u_overlay:new a.aL(v,s.u_overlay),u_overlay_scale:new a.aM(v,s.u_overlay_scale)}),clippingMask:(v,s)=>({u_matrix:new a.aN(v,s.u_matrix)}),heatmap:(v,s)=>({u_extrude_scale:new a.aM(v,s.u_extrude_scale),u_intensity:new a.aM(v,s.u_intensity),u_matrix:new a.aN(v,s.u_matrix)}),heatmapTexture:(v,s)=>({u_matrix:new a.aN(v,s.u_matrix),u_world:new a.aQ(v,s.u_world),u_image:new a.aL(v,s.u_image),u_color_ramp:new a.aL(v,s.u_color_ramp),u_opacity:new a.aM(v,s.u_opacity)}),hillshade:(v,s)=>({u_matrix:new a.aN(v,s.u_matrix),u_image:new a.aL(v,s.u_image),u_latrange:new a.aQ(v,s.u_latrange),u_light:new a.aQ(v,s.u_light),u_shadow:new a.aR(v,s.u_shadow),u_highlight:new a.aR(v,s.u_highlight),u_accent:new a.aR(v,s.u_accent)}),hillshadePrepare:(v,s)=>({u_matrix:new a.aN(v,s.u_matrix),u_image:new a.aL(v,s.u_image),u_dimension:new a.aQ(v,s.u_dimension),u_zoom:new a.aM(v,s.u_zoom),u_unpack:new a.aO(v,s.u_unpack)}),line:(v,s)=>({u_matrix:new a.aN(v,s.u_matrix),u_ratio:new a.aM(v,s.u_ratio),u_device_pixel_ratio:new a.aM(v,s.u_device_pixel_ratio),u_units_to_pixels:new a.aQ(v,s.u_units_to_pixels)}),lineGradient:(v,s)=>({u_matrix:new a.aN(v,s.u_matrix),u_ratio:new a.aM(v,s.u_ratio),u_device_pixel_ratio:new a.aM(v,s.u_device_pixel_ratio),u_units_to_pixels:new a.aQ(v,s.u_units_to_pixels),u_image:new a.aL(v,s.u_image),u_image_height:new a.aM(v,s.u_image_height)}),linePattern:(v,s)=>({u_matrix:new a.aN(v,s.u_matrix),u_texsize:new a.aQ(v,s.u_texsize),u_ratio:new a.aM(v,s.u_ratio),u_device_pixel_ratio:new a.aM(v,s.u_device_pixel_ratio),u_image:new a.aL(v,s.u_image),u_units_to_pixels:new a.aQ(v,s.u_units_to_pixels),u_scale:new a.aP(v,s.u_scale),u_fade:new a.aM(v,s.u_fade)}),lineSDF:(v,s)=>({u_matrix:new a.aN(v,s.u_matrix),u_ratio:new a.aM(v,s.u_ratio),u_device_pixel_ratio:new a.aM(v,s.u_device_pixel_ratio),u_units_to_pixels:new a.aQ(v,s.u_units_to_pixels),u_patternscale_a:new a.aQ(v,s.u_patternscale_a),u_patternscale_b:new a.aQ(v,s.u_patternscale_b),u_sdfgamma:new a.aM(v,s.u_sdfgamma),u_image:new a.aL(v,s.u_image),u_tex_y_a:new a.aM(v,s.u_tex_y_a),u_tex_y_b:new a.aM(v,s.u_tex_y_b),u_mix:new a.aM(v,s.u_mix)}),raster:(v,s)=>({u_matrix:new a.aN(v,s.u_matrix),u_tl_parent:new a.aQ(v,s.u_tl_parent),u_scale_parent:new a.aM(v,s.u_scale_parent),u_buffer_scale:new a.aM(v,s.u_buffer_scale),u_fade_t:new a.aM(v,s.u_fade_t),u_opacity:new a.aM(v,s.u_opacity),u_image0:new a.aL(v,s.u_image0),u_image1:new a.aL(v,s.u_image1),u_brightness_low:new a.aM(v,s.u_brightness_low),u_brightness_high:new a.aM(v,s.u_brightness_high),u_saturation_factor:new a.aM(v,s.u_saturation_factor),u_contrast_factor:new a.aM(v,s.u_contrast_factor),u_spin_weights:new a.aP(v,s.u_spin_weights)}),symbolIcon:(v,s)=>({u_is_size_zoom_constant:new a.aL(v,s.u_is_size_zoom_constant),u_is_size_feature_constant:new a.aL(v,s.u_is_size_feature_constant),u_size_t:new a.aM(v,s.u_size_t),u_size:new a.aM(v,s.u_size),u_camera_to_center_distance:new a.aM(v,s.u_camera_to_center_distance),u_pitch:new a.aM(v,s.u_pitch),u_rotate_symbol:new a.aL(v,s.u_rotate_symbol),u_aspect_ratio:new a.aM(v,s.u_aspect_ratio),u_fade_change:new a.aM(v,s.u_fade_change),u_matrix:new a.aN(v,s.u_matrix),u_label_plane_matrix:new a.aN(v,s.u_label_plane_matrix),u_coord_matrix:new a.aN(v,s.u_coord_matrix),u_is_text:new a.aL(v,s.u_is_text),u_pitch_with_map:new a.aL(v,s.u_pitch_with_map),u_texsize:new a.aQ(v,s.u_texsize),u_texture:new a.aL(v,s.u_texture)}),symbolSDF:(v,s)=>({u_is_size_zoom_constant:new a.aL(v,s.u_is_size_zoom_constant),u_is_size_feature_constant:new a.aL(v,s.u_is_size_feature_constant),u_size_t:new a.aM(v,s.u_size_t),u_size:new a.aM(v,s.u_size),u_camera_to_center_distance:new a.aM(v,s.u_camera_to_center_distance),u_pitch:new a.aM(v,s.u_pitch),u_rotate_symbol:new a.aL(v,s.u_rotate_symbol),u_aspect_ratio:new a.aM(v,s.u_aspect_ratio),u_fade_change:new a.aM(v,s.u_fade_change),u_matrix:new a.aN(v,s.u_matrix),u_label_plane_matrix:new a.aN(v,s.u_label_plane_matrix),u_coord_matrix:new a.aN(v,s.u_coord_matrix),u_is_text:new a.aL(v,s.u_is_text),u_pitch_with_map:new a.aL(v,s.u_pitch_with_map),u_texsize:new a.aQ(v,s.u_texsize),u_texture:new a.aL(v,s.u_texture),u_gamma_scale:new a.aM(v,s.u_gamma_scale),u_device_pixel_ratio:new a.aM(v,s.u_device_pixel_ratio),u_is_halo:new a.aL(v,s.u_is_halo)}),symbolTextAndIcon:(v,s)=>({u_is_size_zoom_constant:new a.aL(v,s.u_is_size_zoom_constant),u_is_size_feature_constant:new a.aL(v,s.u_is_size_feature_constant),u_size_t:new a.aM(v,s.u_size_t),u_size:new a.aM(v,s.u_size),u_camera_to_center_distance:new a.aM(v,s.u_camera_to_center_distance),u_pitch:new a.aM(v,s.u_pitch),u_rotate_symbol:new a.aL(v,s.u_rotate_symbol),u_aspect_ratio:new a.aM(v,s.u_aspect_ratio),u_fade_change:new a.aM(v,s.u_fade_change),u_matrix:new a.aN(v,s.u_matrix),u_label_plane_matrix:new a.aN(v,s.u_label_plane_matrix),u_coord_matrix:new a.aN(v,s.u_coord_matrix),u_is_text:new a.aL(v,s.u_is_text),u_pitch_with_map:new a.aL(v,s.u_pitch_with_map),u_texsize:new a.aQ(v,s.u_texsize),u_texsize_icon:new a.aQ(v,s.u_texsize_icon),u_texture:new a.aL(v,s.u_texture),u_texture_icon:new a.aL(v,s.u_texture_icon),u_gamma_scale:new a.aM(v,s.u_gamma_scale),u_device_pixel_ratio:new a.aM(v,s.u_device_pixel_ratio),u_is_halo:new a.aL(v,s.u_is_halo)}),background:(v,s)=>({u_matrix:new a.aN(v,s.u_matrix),u_opacity:new a.aM(v,s.u_opacity),u_color:new a.aR(v,s.u_color)}),backgroundPattern:(v,s)=>({u_matrix:new a.aN(v,s.u_matrix),u_opacity:new a.aM(v,s.u_opacity),u_image:new a.aL(v,s.u_image),u_pattern_tl_a:new a.aQ(v,s.u_pattern_tl_a),u_pattern_br_a:new a.aQ(v,s.u_pattern_br_a),u_pattern_tl_b:new a.aQ(v,s.u_pattern_tl_b),u_pattern_br_b:new a.aQ(v,s.u_pattern_br_b),u_texsize:new a.aQ(v,s.u_texsize),u_mix:new a.aM(v,s.u_mix),u_pattern_size_a:new a.aQ(v,s.u_pattern_size_a),u_pattern_size_b:new a.aQ(v,s.u_pattern_size_b),u_scale_a:new a.aM(v,s.u_scale_a),u_scale_b:new a.aM(v,s.u_scale_b),u_pixel_coord_upper:new a.aQ(v,s.u_pixel_coord_upper),u_pixel_coord_lower:new a.aQ(v,s.u_pixel_coord_lower),u_tile_units_to_pixels:new a.aM(v,s.u_tile_units_to_pixels)}),terrain:(v,s)=>({u_matrix:new a.aN(v,s.u_matrix),u_texture:new a.aL(v,s.u_texture),u_ele_delta:new a.aM(v,s.u_ele_delta)}),terrainDepth:(v,s)=>({u_matrix:new a.aN(v,s.u_matrix),u_ele_delta:new a.aM(v,s.u_ele_delta)}),terrainCoords:(v,s)=>({u_matrix:new a.aN(v,s.u_matrix),u_texture:new a.aL(v,s.u_texture),u_terrain_coords_id:new a.aM(v,s.u_terrain_coords_id),u_ele_delta:new a.aM(v,s.u_ele_delta)})};class fn{constructor(s,p,f){this.context=s;const y=s.gl;this.buffer=y.createBuffer(),this.dynamicDraw=!!f,this.context.unbindVAO(),s.bindElementBuffer.set(this.buffer),y.bufferData(y.ELEMENT_ARRAY_BUFFER,p.arrayBuffer,this.dynamicDraw?y.DYNAMIC_DRAW:y.STATIC_DRAW),this.dynamicDraw||delete p.arrayBuffer}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(s){const p=this.context.gl;if(!this.dynamicDraw)throw new Error("Attempted to update data while not in dynamic mode.");this.context.unbindVAO(),this.bind(),p.bufferSubData(p.ELEMENT_ARRAY_BUFFER,0,s.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}const xu={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class nh{constructor(s,p,f,y){this.length=p.length,this.attributes=f,this.itemSize=p.bytesPerElement,this.dynamicDraw=y,this.context=s;const x=s.gl;this.buffer=x.createBuffer(),s.bindVertexBuffer.set(this.buffer),x.bufferData(x.ARRAY_BUFFER,p.arrayBuffer,this.dynamicDraw?x.DYNAMIC_DRAW:x.STATIC_DRAW),this.dynamicDraw||delete p.arrayBuffer}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(s){if(s.length!==this.length)throw new Error(`Length of new data is ${s.length}, which doesn't match current length of ${this.length}`);const p=this.context.gl;this.bind(),p.bufferSubData(p.ARRAY_BUFFER,0,s.arrayBuffer)}enableAttributes(s,p){for(let f=0;f<this.attributes.length;f++){const y=p.attributes[this.attributes[f].name];y!==void 0&&s.enableVertexAttribArray(y)}}setVertexAttribPointers(s,p,f){for(let y=0;y<this.attributes.length;y++){const x=this.attributes[y],C=p.attributes[x.name];C!==void 0&&s.vertexAttribPointer(C,x.components,s[xu[x.type]],!1,this.itemSize,x.offset+this.itemSize*(f||0))}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}const Ao=new WeakMap;function Pa(v){var s;if(Ao.has(v))return Ao.get(v);{const p=(s=v.getParameter(v.VERSION))===null||s===void 0?void 0:s.startsWith("WebGL 2.0");return Ao.set(v,p),p}}class Tr{constructor(s){this.gl=s.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(s){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class ec extends Tr{getDefault(){return a.aT.transparent}set(s){const p=this.current;(s.r!==p.r||s.g!==p.g||s.b!==p.b||s.a!==p.a||this.dirty)&&(this.gl.clearColor(s.r,s.g,s.b,s.a),this.current=s,this.dirty=!1)}}class mo extends Tr{getDefault(){return 1}set(s){(s!==this.current||this.dirty)&&(this.gl.clearDepth(s),this.current=s,this.dirty=!1)}}class Lo extends Tr{getDefault(){return 0}set(s){(s!==this.current||this.dirty)&&(this.gl.clearStencil(s),this.current=s,this.dirty=!1)}}class ih extends Tr{getDefault(){return[!0,!0,!0,!0]}set(s){const p=this.current;(s[0]!==p[0]||s[1]!==p[1]||s[2]!==p[2]||s[3]!==p[3]||this.dirty)&&(this.gl.colorMask(s[0],s[1],s[2],s[3]),this.current=s,this.dirty=!1)}}class oh extends Tr{getDefault(){return!0}set(s){(s!==this.current||this.dirty)&&(this.gl.depthMask(s),this.current=s,this.dirty=!1)}}class sh extends Tr{getDefault(){return 255}set(s){(s!==this.current||this.dirty)&&(this.gl.stencilMask(s),this.current=s,this.dirty=!1)}}class hp extends Tr{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(s){const p=this.current;(s.func!==p.func||s.ref!==p.ref||s.mask!==p.mask||this.dirty)&&(this.gl.stencilFunc(s.func,s.ref,s.mask),this.current=s,this.dirty=!1)}}class ah extends Tr{getDefault(){const s=this.gl;return[s.KEEP,s.KEEP,s.KEEP]}set(s){const p=this.current;(s[0]!==p[0]||s[1]!==p[1]||s[2]!==p[2]||this.dirty)&&(this.gl.stencilOp(s[0],s[1],s[2]),this.current=s,this.dirty=!1)}}class rc extends Tr{getDefault(){return!1}set(s){if(s===this.current&&!this.dirty)return;const p=this.gl;s?p.enable(p.STENCIL_TEST):p.disable(p.STENCIL_TEST),this.current=s,this.dirty=!1}}class lh extends Tr{getDefault(){return[0,1]}set(s){const p=this.current;(s[0]!==p[0]||s[1]!==p[1]||this.dirty)&&(this.gl.depthRange(s[0],s[1]),this.current=s,this.dirty=!1)}}class pp extends Tr{getDefault(){return!1}set(s){if(s===this.current&&!this.dirty)return;const p=this.gl;s?p.enable(p.DEPTH_TEST):p.disable(p.DEPTH_TEST),this.current=s,this.dirty=!1}}class uh extends Tr{getDefault(){return this.gl.LESS}set(s){(s!==this.current||this.dirty)&&(this.gl.depthFunc(s),this.current=s,this.dirty=!1)}}class nc extends Tr{getDefault(){return!1}set(s){if(s===this.current&&!this.dirty)return;const p=this.gl;s?p.enable(p.BLEND):p.disable(p.BLEND),this.current=s,this.dirty=!1}}class ch extends Tr{getDefault(){const s=this.gl;return[s.ONE,s.ZERO]}set(s){const p=this.current;(s[0]!==p[0]||s[1]!==p[1]||this.dirty)&&(this.gl.blendFunc(s[0],s[1]),this.current=s,this.dirty=!1)}}class Ul extends Tr{getDefault(){return a.aT.transparent}set(s){const p=this.current;(s.r!==p.r||s.g!==p.g||s.b!==p.b||s.a!==p.a||this.dirty)&&(this.gl.blendColor(s.r,s.g,s.b,s.a),this.current=s,this.dirty=!1)}}class oa extends Tr{getDefault(){return this.gl.FUNC_ADD}set(s){(s!==this.current||this.dirty)&&(this.gl.blendEquation(s),this.current=s,this.dirty=!1)}}class rd extends Tr{getDefault(){return!1}set(s){if(s===this.current&&!this.dirty)return;const p=this.gl;s?p.enable(p.CULL_FACE):p.disable(p.CULL_FACE),this.current=s,this.dirty=!1}}class nd extends Tr{getDefault(){return this.gl.BACK}set(s){(s!==this.current||this.dirty)&&(this.gl.cullFace(s),this.current=s,this.dirty=!1)}}class Ef extends Tr{getDefault(){return this.gl.CCW}set(s){(s!==this.current||this.dirty)&&(this.gl.frontFace(s),this.current=s,this.dirty=!1)}}class id extends Tr{getDefault(){return null}set(s){(s!==this.current||this.dirty)&&(this.gl.useProgram(s),this.current=s,this.dirty=!1)}}class hh extends Tr{getDefault(){return this.gl.TEXTURE0}set(s){(s!==this.current||this.dirty)&&(this.gl.activeTexture(s),this.current=s,this.dirty=!1)}}class ph extends Tr{getDefault(){const s=this.gl;return[0,0,s.drawingBufferWidth,s.drawingBufferHeight]}set(s){const p=this.current;(s[0]!==p[0]||s[1]!==p[1]||s[2]!==p[2]||s[3]!==p[3]||this.dirty)&&(this.gl.viewport(s[0],s[1],s[2],s[3]),this.current=s,this.dirty=!1)}}class ic extends Tr{getDefault(){return null}set(s){if(s===this.current&&!this.dirty)return;const p=this.gl;p.bindFramebuffer(p.FRAMEBUFFER,s),this.current=s,this.dirty=!1}}class dp extends Tr{getDefault(){return null}set(s){if(s===this.current&&!this.dirty)return;const p=this.gl;p.bindRenderbuffer(p.RENDERBUFFER,s),this.current=s,this.dirty=!1}}class Aa extends Tr{getDefault(){return null}set(s){if(s===this.current&&!this.dirty)return;const p=this.gl;p.bindTexture(p.TEXTURE_2D,s),this.current=s,this.dirty=!1}}class jl extends Tr{getDefault(){return null}set(s){if(s===this.current&&!this.dirty)return;const p=this.gl;p.bindBuffer(p.ARRAY_BUFFER,s),this.current=s,this.dirty=!1}}class od extends Tr{getDefault(){return null}set(s){const p=this.gl;p.bindBuffer(p.ELEMENT_ARRAY_BUFFER,s),this.current=s,this.dirty=!1}}class sd extends Tr{getDefault(){return null}set(s){var p;if(s===this.current&&!this.dirty)return;const f=this.gl;Pa(f)?f.bindVertexArray(s):(p=f.getExtension("OES_vertex_array_object"))===null||p===void 0||p.bindVertexArrayOES(s),this.current=s,this.dirty=!1}}class oc extends Tr{getDefault(){return 4}set(s){if(s===this.current&&!this.dirty)return;const p=this.gl;p.pixelStorei(p.UNPACK_ALIGNMENT,s),this.current=s,this.dirty=!1}}class Ds extends Tr{getDefault(){return!1}set(s){if(s===this.current&&!this.dirty)return;const p=this.gl;p.pixelStorei(p.UNPACK_PREMULTIPLY_ALPHA_WEBGL,s),this.current=s,this.dirty=!1}}class dh extends Tr{getDefault(){return!1}set(s){if(s===this.current&&!this.dirty)return;const p=this.gl;p.pixelStorei(p.UNPACK_FLIP_Y_WEBGL,s),this.current=s,this.dirty=!1}}class sa extends Tr{constructor(s,p){super(s),this.context=s,this.parent=p}getDefault(){return null}}class rl extends sa{setDirty(){this.dirty=!0}set(s){if(s===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const p=this.gl;p.framebufferTexture2D(p.FRAMEBUFFER,p.COLOR_ATTACHMENT0,p.TEXTURE_2D,s,0),this.current=s,this.dirty=!1}}class bu extends sa{set(s){if(s===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const p=this.gl;p.framebufferRenderbuffer(p.FRAMEBUFFER,p.DEPTH_ATTACHMENT,p.RENDERBUFFER,s),this.current=s,this.dirty=!1}}class fp extends sa{set(s){if(s===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const p=this.gl;p.framebufferRenderbuffer(p.FRAMEBUFFER,p.DEPTH_STENCIL_ATTACHMENT,p.RENDERBUFFER,s),this.current=s,this.dirty=!1}}class Gr{constructor(s,p,f,y,x){this.context=s,this.width=p,this.height=f;const C=s.gl,M=this.framebuffer=C.createFramebuffer();if(this.colorAttachment=new rl(s,M),y)this.depthAttachment=x?new fp(s,M):new bu(s,M);else if(x)throw new Error("Stencil cannot be setted without depth");if(C.checkFramebufferStatus(C.FRAMEBUFFER)!==C.FRAMEBUFFER_COMPLETE)throw new Error("Framebuffer is not complete")}destroy(){const s=this.context.gl,p=this.colorAttachment.get();if(p&&s.deleteTexture(p),this.depthAttachment){const f=this.depthAttachment.get();f&&s.deleteRenderbuffer(f)}s.deleteFramebuffer(this.framebuffer)}}class Nn{constructor(s,p,f){this.blendFunction=s,this.blendColor=p,this.mask=f}}Nn.Replace=[1,0],Nn.disabled=new Nn(Nn.Replace,a.aT.transparent,[!1,!1,!1,!1]),Nn.unblended=new Nn(Nn.Replace,a.aT.transparent,[!0,!0,!0,!0]),Nn.alphaBlended=new Nn([1,771],a.aT.transparent,[!0,!0,!0,!0]);class Sf{constructor(s){var p,f;if(this.gl=s,this.clearColor=new ec(this),this.clearDepth=new mo(this),this.clearStencil=new Lo(this),this.colorMask=new ih(this),this.depthMask=new oh(this),this.stencilMask=new sh(this),this.stencilFunc=new hp(this),this.stencilOp=new ah(this),this.stencilTest=new rc(this),this.depthRange=new lh(this),this.depthTest=new pp(this),this.depthFunc=new uh(this),this.blend=new nc(this),this.blendFunc=new ch(this),this.blendColor=new Ul(this),this.blendEquation=new oa(this),this.cullFace=new rd(this),this.cullFaceSide=new nd(this),this.frontFace=new Ef(this),this.program=new id(this),this.activeTexture=new hh(this),this.viewport=new ph(this),this.bindFramebuffer=new ic(this),this.bindRenderbuffer=new dp(this),this.bindTexture=new Aa(this),this.bindVertexBuffer=new jl(this),this.bindElementBuffer=new od(this),this.bindVertexArray=new sd(this),this.pixelStoreUnpack=new oc(this),this.pixelStoreUnpackPremultiplyAlpha=new Ds(this),this.pixelStoreUnpackFlipY=new dh(this),this.extTextureFilterAnisotropic=s.getExtension("EXT_texture_filter_anisotropic")||s.getExtension("MOZ_EXT_texture_filter_anisotropic")||s.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=s.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT)),this.maxTextureSize=s.getParameter(s.MAX_TEXTURE_SIZE),Pa(s)){this.HALF_FLOAT=s.HALF_FLOAT;const y=s.getExtension("EXT_color_buffer_half_float");this.RGBA16F=(p=s.RGBA16F)!==null&&p!==void 0?p:y==null?void 0:y.RGBA16F_EXT,this.RGB16F=(f=s.RGB16F)!==null&&f!==void 0?f:y==null?void 0:y.RGB16F_EXT,s.getExtension("EXT_color_buffer_float")}else{s.getExtension("EXT_color_buffer_half_float"),s.getExtension("OES_texture_half_float_linear");const y=s.getExtension("OES_texture_half_float");this.HALF_FLOAT=y==null?void 0:y.HALF_FLOAT_OES}}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.bindVertexArray.dirty=!0,this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(s,p){return new fn(this,s,p)}createVertexBuffer(s,p,f){return new nh(this,s,p,f)}createRenderbuffer(s,p,f){const y=this.gl,x=y.createRenderbuffer();return this.bindRenderbuffer.set(x),y.renderbufferStorage(y.RENDERBUFFER,s,p,f),this.bindRenderbuffer.set(null),x}createFramebuffer(s,p,f,y){return new Gr(this,s,p,f,y)}clear({color:s,depth:p,stencil:f}){const y=this.gl;let x=0;s&&(x|=y.COLOR_BUFFER_BIT,this.clearColor.set(s),this.colorMask.set([!0,!0,!0,!0])),p!==void 0&&(x|=y.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(p),this.depthMask.set(!0)),f!==void 0&&(x|=y.STENCIL_BUFFER_BIT,this.clearStencil.set(f),this.stencilMask.set(255)),y.clear(x)}setCullFace(s){s.enable===!1?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(s.mode),this.frontFace.set(s.frontFace))}setDepthMode(s){s.func!==this.gl.ALWAYS||s.mask?(this.depthTest.set(!0),this.depthFunc.set(s.func),this.depthMask.set(s.mask),this.depthRange.set(s.range)):this.depthTest.set(!1)}setStencilMode(s){s.test.func!==this.gl.ALWAYS||s.mask?(this.stencilTest.set(!0),this.stencilMask.set(s.mask),this.stencilOp.set([s.fail,s.depthFail,s.pass]),this.stencilFunc.set({func:s.test.func,ref:s.ref,mask:s.test.mask})):this.stencilTest.set(!1)}setColorMode(s){a.aG(s.blendFunction,Nn.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(s.blendFunction),this.blendColor.set(s.blendColor)),this.colorMask.set(s.mask)}createVertexArray(){var s;return Pa(this.gl)?this.gl.createVertexArray():(s=this.gl.getExtension("OES_vertex_array_object"))===null||s===void 0?void 0:s.createVertexArrayOES()}deleteVertexArray(s){var p;return Pa(this.gl)?this.gl.deleteVertexArray(s):(p=this.gl.getExtension("OES_vertex_array_object"))===null||p===void 0?void 0:p.deleteVertexArrayOES(s)}unbindVAO(){this.bindVertexArray.set(null)}}class Cr{constructor(s,p,f){this.func=s,this.mask=p,this.range=f}}Cr.ReadOnly=!1,Cr.ReadWrite=!0,Cr.disabled=new Cr(519,Cr.ReadOnly,[0,1]);const nl=7680;class wn{constructor(s,p,f,y,x,C){this.test=s,this.ref=p,this.mask=f,this.fail=y,this.depthFail=x,this.pass=C}}wn.disabled=new wn({func:519,mask:0},0,0,nl,nl,nl);class en{constructor(s,p,f){this.enable=s,this.mode=p,this.frontFace=f}}let Ho;function il(v,s,p,f,y,x,C){const M=v.context,L=M.gl,N=v.useProgram("collisionBox"),z=[];let B=0,H=0;for(let yt=0;yt<f.length;yt++){const Pt=f[yt],Vt=s.getTile(Pt),qt=Vt.getBucket(p);if(!qt)continue;let Yt=Pt.posMatrix;y[0]===0&&y[1]===0||(Yt=v.translatePosMatrix(Pt.posMatrix,Vt,y,x));const ne=C?qt.textCollisionBox:qt.iconCollisionBox,Qt=qt.collisionCircleArray;if(Qt.length>0){const le=a.Z(),ke=Yt;a.aU(le,qt.placementInvProjMatrix,v.transform.glCoordMatrix),a.aU(le,le,qt.placementViewportMatrix),z.push({circleArray:Qt,circleOffset:H,transform:ke,invTransform:le,coord:Pt}),B+=Qt.length/4,H=B}ne&&N.draw(M,L.LINES,Cr.disabled,wn.disabled,v.colorModeForRenderPass(),en.disabled,It(Yt,v.transform,Vt),v.style.map.terrain&&v.style.map.terrain.getTerrainData(Pt),p.id,ne.layoutVertexBuffer,ne.indexBuffer,ne.segments,null,v.transform.zoom,null,null,ne.collisionVertexBuffer)}if(!C||!z.length)return;const lt=v.useProgram("collisionCircle"),ut=new a.aV;ut.resize(4*B),ut._trim();let ht=0;for(const yt of z)for(let Pt=0;Pt<yt.circleArray.length/4;Pt++){const Vt=4*Pt,qt=yt.circleArray[Vt+0],Yt=yt.circleArray[Vt+1],ne=yt.circleArray[Vt+2],Qt=yt.circleArray[Vt+3];ut.emplace(ht++,qt,Yt,ne,Qt,0),ut.emplace(ht++,qt,Yt,ne,Qt,1),ut.emplace(ht++,qt,Yt,ne,Qt,2),ut.emplace(ht++,qt,Yt,ne,Qt,3)}(!Ho||Ho.length<2*B)&&(Ho=function(yt){const Pt=2*yt,Vt=new a.aX;Vt.resize(Pt),Vt._trim();for(let qt=0;qt<Pt;qt++){const Yt=6*qt;Vt.uint16[Yt+0]=4*qt+0,Vt.uint16[Yt+1]=4*qt+1,Vt.uint16[Yt+2]=4*qt+2,Vt.uint16[Yt+3]=4*qt+2,Vt.uint16[Yt+4]=4*qt+3,Vt.uint16[Yt+5]=4*qt+0}return Vt}(B));const st=M.createIndexBuffer(Ho,!0),Mt=M.createVertexBuffer(ut,a.aW.members,!0);for(const yt of z){const Pt={u_matrix:yt.transform,u_inv_matrix:yt.invTransform,u_camera_to_center_distance:(Ft=v.transform).cameraToCenterDistance,u_viewport_size:[Ft.width,Ft.height]};lt.draw(M,L.TRIANGLES,Cr.disabled,wn.disabled,v.colorModeForRenderPass(),en.disabled,Pt,v.style.map.terrain&&v.style.map.terrain.getTerrainData(yt.coord),p.id,Mt,st,a.S.simpleSegment(0,2*yt.circleOffset,yt.circleArray.length,yt.circleArray.length/2),null,v.transform.zoom,null,null,null)}var Ft;Mt.destroy(),st.destroy()}en.disabled=new en(!1,1029,2305),en.backCCW=new en(!0,1029,2305);const wu=a.ao(new Float32Array(16));function Ns(v,s,p,f,y,x){const{horizontalAlign:C,verticalAlign:M}=a.au(v);return new a.P((-(C-.5)*s/y+f[0])*x,(-(M-.5)*p/y+f[1])*x)}function fh(v,s,p,f,y,x,C,M,L,N,z){const B=v.text.placedSymbolArray,H=v.text.dynamicLayoutVertexArray,lt=v.icon.dynamicLayoutVertexArray,ut={};H.clear();for(let ht=0;ht<B.length;ht++){const st=B.get(ht),Mt=st.hidden||!st.crossTileID||v.allowVerticalPlacement&&!st.placedOrientation?null:f[st.crossTileID];if(Mt){const Ft=new a.P(st.anchorX,st.anchorY),yt=In(Ft,p?C:x,z),Pt=Ls(y.cameraToCenterDistance,yt.signedDistanceFromCamera);let Vt=a.aj(v.textSizeData,L,st)*Pt/a.ap;p&&(Vt*=v.tilePixelRatio/M);const{width:qt,height:Yt,anchor:ne,textOffset:Qt,textBoxScale:le}=Mt,ke=Ns(ne,qt,Yt,Qt,le,Vt),Mr=p?In(Ft.add(ke),x,z).point:yt.point.add(s?ke.rotate(-y.angle):ke),ve=v.allowVerticalPlacement&&st.placedOrientation===a.ai.vertical?Math.PI/2:0;for(let Je=0;Je<st.numGlyphs;Je++)a.ak(H,Mr,ve);N&&st.associatedIconIndex>=0&&(ut[st.associatedIconIndex]={shiftedAnchor:Mr,angle:ve})}else nt(st.numGlyphs,H)}if(N){lt.clear();const ht=v.icon.placedSymbolArray;for(let st=0;st<ht.length;st++){const Mt=ht.get(st);if(Mt.hidden)nt(Mt.numGlyphs,lt);else{const Ft=ut[st];if(Ft)for(let yt=0;yt<Mt.numGlyphs;yt++)a.ak(lt,Ft.shiftedAnchor,Ft.angle);else nt(Mt.numGlyphs,lt)}}v.icon.dynamicLayoutVertexBuffer.updateData(lt)}v.text.dynamicLayoutVertexBuffer.updateData(H)}function Eu(v,s,p){return p.iconsInText&&s?"symbolTextAndIcon":v?"symbolSDF":"symbolIcon"}function ol(v,s,p,f,y,x,C,M,L,N,z,B){const H=v.context,lt=H.gl,ut=v.transform,ht=M==="map",st=L==="map",Mt=M!=="viewport"&&p.layout.get("symbol-placement")!=="point",Ft=ht&&!st&&!Mt,yt=!p.layout.get("symbol-sort-key").isConstant();let Pt=!1;const Vt=v.depthModeForSublayer(0,Cr.ReadOnly),qt=p._unevaluatedLayout.hasValue("text-variable-anchor")||p._unevaluatedLayout.hasValue("text-variable-anchor-offset"),Yt=[];for(const ne of f){const Qt=s.getTile(ne),le=Qt.getBucket(p);if(!le)continue;const ke=y?le.text:le.icon;if(!ke||!ke.segments.get().length||!ke.hasVisibleVertices)continue;const Mr=ke.programConfigurations.get(p.id),ve=y||le.sdfIcons,Je=y?le.textSizeData:le.iconSizeData,Fe=st||ut.pitch!==0,mn=v.useProgram(Eu(ve,y,le),Mr),Ir=a.ah(Je,ut.zoom),mr=v.style.map.terrain&&v.style.map.terrain.getTerrainData(ne);let Pr,hi,Mn,yo,Bi=[0,0],Si=null;if(y)hi=Qt.glyphAtlasTexture,Mn=lt.LINEAR,Pr=Qt.glyphAtlasTexture.size,le.iconsInText&&(Bi=Qt.imageAtlasTexture.size,Si=Qt.imageAtlasTexture,yo=Fe||v.options.rotating||v.options.zooming||Je.kind==="composite"||Je.kind==="camera"?lt.LINEAR:lt.NEAREST);else{const pi=p.layout.get("icon-size").constantOr(0)!==1||le.iconsNeedLinear;hi=Qt.imageAtlasTexture,Mn=ve||v.options.rotating||v.options.zooming||pi||Fe?lt.LINEAR:lt.NEAREST,Pr=Qt.imageAtlasTexture.size}const zs=bt(Qt,1,v.transform.zoom),Fn=oe(ne.posMatrix,st,ht,v.transform,zs),ul=po(ne.posMatrix,st,ht,v.transform,zs),cl=qt&&le.hasTextData(),Au=p.layout.get("icon-text-fit")!=="none"&&cl&&le.hasIconData();if(Mt){const pi=v.style.map.terrain?(gs,di)=>v.style.map.terrain.getElevation(ne,gs,di):null,$i=p.layout.get("text-rotation-alignment")==="map";ce(le,ne.posMatrix,v,y,Fn,ul,st,N,$i,pi)}const mc=v.translatePosMatrix(ne.posMatrix,Qt,x,C),Ih=Mt||y&&qt||Au?wu:Fn,No=v.translatePosMatrix(ul,Qt,x,C,!0),_o=ve&&p.paint.get(y?"text-halo-width":"icon-halo-width").constantOr(1)!==0;let Jo;Jo=ve?le.iconsInText?Dn(Je.kind,Ir,Ft,st,v,mc,Ih,No,Pr,Bi):tn(Je.kind,Ir,Ft,st,v,mc,Ih,No,y,Pr,!0):ze(Je.kind,Ir,Ft,st,v,mc,Ih,No,y,Pr);const gc={program:mn,buffers:ke,uniformValues:Jo,atlasTexture:hi,atlasTextureIcon:Si,atlasInterpolation:Mn,atlasInterpolationIcon:yo,isSDF:ve,hasHalo:_o};if(yt&&le.canOverlap){Pt=!0;const pi=ke.segments.get();for(const $i of pi)Yt.push({segments:new a.S([$i]),sortKey:$i.sortKey,state:gc,terrainData:mr})}else Yt.push({segments:ke.segments,sortKey:0,state:gc,terrainData:mr})}Pt&&Yt.sort((ne,Qt)=>ne.sortKey-Qt.sortKey);for(const ne of Yt){const Qt=ne.state;if(H.activeTexture.set(lt.TEXTURE0),Qt.atlasTexture.bind(Qt.atlasInterpolation,lt.CLAMP_TO_EDGE),Qt.atlasTextureIcon&&(H.activeTexture.set(lt.TEXTURE1),Qt.atlasTextureIcon&&Qt.atlasTextureIcon.bind(Qt.atlasInterpolationIcon,lt.CLAMP_TO_EDGE)),Qt.isSDF){const le=Qt.uniformValues;Qt.hasHalo&&(le.u_is_halo=1,mh(Qt.buffers,ne.segments,p,v,Qt.program,Vt,z,B,le,ne.terrainData)),le.u_is_halo=0}mh(Qt.buffers,ne.segments,p,v,Qt.program,Vt,z,B,Qt.uniformValues,ne.terrainData)}}function mh(v,s,p,f,y,x,C,M,L,N){const z=f.context;y.draw(z,z.gl.TRIANGLES,x,C,M,en.disabled,L,N,p.id,v.layoutVertexBuffer,v.indexBuffer,s,p.paint,f.transform.zoom,v.programConfigurations.get(p.id),v.dynamicLayoutVertexBuffer,v.opacityVertexBuffer)}function Su(v,s,p,f,y){if(!p||!f||!f.imageAtlas)return;const x=f.imageAtlas.patternPositions;let C=x[p.to.toString()],M=x[p.from.toString()];if(!C&&M&&(C=M),!M&&C&&(M=C),!C||!M){const L=y.getPaintProperty(s);C=x[L],M=x[L]}C&&M&&v.setConstantPatternPositions(C,M)}function sc(v,s,p,f,y,x,C){const M=v.context.gl,L="fill-pattern",N=p.paint.get(L),z=N&&N.constantOr(1),B=p.getCrossfadeParameters();let H,lt,ut,ht,st;C?(lt=z&&!p.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",H=M.LINES):(lt=z?"fillPattern":"fill",H=M.TRIANGLES);const Mt=N.constantOr(null);for(const Ft of f){const yt=s.getTile(Ft);if(z&&!yt.patternsLoaded())continue;const Pt=yt.getBucket(p);if(!Pt)continue;const Vt=Pt.programConfigurations.get(p.id),qt=v.useProgram(lt,Vt),Yt=v.style.map.terrain&&v.style.map.terrain.getTerrainData(Ft);z&&(v.context.activeTexture.set(M.TEXTURE0),yt.imageAtlasTexture.bind(M.LINEAR,M.CLAMP_TO_EDGE),Vt.updatePaintBuffers(B)),Su(Vt,L,Mt,yt,p);const ne=Yt?Ft:null,Qt=v.translatePosMatrix(ne?ne.posMatrix:Ft.posMatrix,yt,p.paint.get("fill-translate"),p.paint.get("fill-translate-anchor"));if(C){ht=Pt.indexBuffer2,st=Pt.segments2;const le=[M.drawingBufferWidth,M.drawingBufferHeight];ut=lt==="fillOutlinePattern"&&z?Y(Qt,v,B,yt,le):D(Qt,le)}else ht=Pt.indexBuffer,st=Pt.segments,ut=z?T(Qt,v,B,yt):tc(Qt);qt.draw(v.context,H,y,v.stencilModeForClipping(Ft),x,en.disabled,ut,Yt,p.id,Pt.layoutVertexBuffer,ht,st,p.paint,v.transform.zoom,Vt)}}function ac(v,s,p,f,y,x,C){const M=v.context,L=M.gl,N="fill-extrusion-pattern",z=p.paint.get(N),B=z.constantOr(1),H=p.getCrossfadeParameters(),lt=p.paint.get("fill-extrusion-opacity"),ut=z.constantOr(null);for(const ht of f){const st=s.getTile(ht),Mt=st.getBucket(p);if(!Mt)continue;const Ft=v.style.map.terrain&&v.style.map.terrain.getTerrainData(ht),yt=Mt.programConfigurations.get(p.id),Pt=v.useProgram(B?"fillExtrusionPattern":"fillExtrusion",yt);B&&(v.context.activeTexture.set(L.TEXTURE0),st.imageAtlasTexture.bind(L.LINEAR,L.CLAMP_TO_EDGE),yt.updatePaintBuffers(H)),Su(yt,N,ut,st,p);const Vt=v.translatePosMatrix(ht.posMatrix,st,p.paint.get("fill-extrusion-translate"),p.paint.get("fill-extrusion-translate-anchor")),qt=p.paint.get("fill-extrusion-vertical-gradient"),Yt=B?el(Vt,v,qt,lt,ht,H,st):cp(Vt,v,qt,lt);Pt.draw(M,M.gl.TRIANGLES,y,x,C,en.backCCW,Yt,Ft,p.id,Mt.layoutVertexBuffer,Mt.indexBuffer,Mt.segments,p.paint,v.transform.zoom,yt,v.style.map.terrain&&Mt.centroidVertexBuffer)}}function ad(v,s,p,f,y,x,C){const M=v.context,L=M.gl,N=p.fbo;if(!N)return;const z=v.useProgram("hillshade"),B=v.style.map.terrain&&v.style.map.terrain.getTerrainData(s);M.activeTexture.set(L.TEXTURE0),L.bindTexture(L.TEXTURE_2D,N.colorAttachment.get()),z.draw(M,L.TRIANGLES,y,x,C,en.disabled,((H,lt,ut,ht)=>{const st=ut.paint.get("hillshade-shadow-color"),Mt=ut.paint.get("hillshade-highlight-color"),Ft=ut.paint.get("hillshade-accent-color");let yt=ut.paint.get("hillshade-illumination-direction")*(Math.PI/180);ut.paint.get("hillshade-illumination-anchor")==="viewport"&&(yt-=H.transform.angle);const Pt=!H.options.moving;return{u_matrix:ht?ht.posMatrix:H.transform.calculatePosMatrix(lt.tileID.toUnwrapped(),Pt),u_image:0,u_latrange:ae(0,lt.tileID),u_light:[ut.paint.get("hillshade-exaggeration"),yt],u_shadow:st,u_highlight:Mt,u_accent:Ft}})(v,p,f,B?s:null),B,f.id,v.rasterBoundsBuffer,v.quadTriangleIndexBuffer,v.rasterBoundsSegments)}function gh(v,s,p,f,y,x){const C=v.context,M=C.gl,L=s.dem;if(L&&L.data){const N=L.dim,z=L.stride,B=L.getPixels();if(C.activeTexture.set(M.TEXTURE1),C.pixelStoreUnpackPremultiplyAlpha.set(!1),s.demTexture=s.demTexture||v.getTileTexture(z),s.demTexture){const lt=s.demTexture;lt.update(B,{premultiply:!1}),lt.bind(M.NEAREST,M.CLAMP_TO_EDGE)}else s.demTexture=new J(C,B,M.RGBA,{premultiply:!1}),s.demTexture.bind(M.NEAREST,M.CLAMP_TO_EDGE);C.activeTexture.set(M.TEXTURE0);let H=s.fbo;if(!H){const lt=new J(C,{width:N,height:N,data:null},M.RGBA);lt.bind(M.LINEAR,M.CLAMP_TO_EDGE),H=s.fbo=C.createFramebuffer(N,N,!0,!1),H.colorAttachment.set(lt.texture)}C.bindFramebuffer.set(H.framebuffer),C.viewport.set([0,0,N,N]),v.useProgram("hillshadePrepare").draw(C,M.TRIANGLES,f,y,x,en.disabled,((lt,ut)=>{const ht=ut.stride,st=a.Z();return a.aS(st,0,a.N,-a.N,0,0,1),a.$(st,st,[0,-a.N,0]),{u_matrix:st,u_image:1,u_dimension:[ht,ht],u_zoom:lt.overscaledZ,u_unpack:ut.getUnpackVector()}})(s.tileID,L),null,p.id,v.rasterBoundsBuffer,v.quadTriangleIndexBuffer,v.rasterBoundsSegments),s.needsHillshadePrepare=!1}}function yh(v,s,p,f,y,x){const C=f.paint.get("raster-fade-duration");if(!x&&C>0){const M=a.h.now(),L=(M-v.timeAdded)/C,N=s?(M-s.timeAdded)/C:-1,z=p.getSource(),B=y.coveringZoomLevel({tileSize:z.tileSize,roundZoom:z.roundZoom}),H=!s||Math.abs(s.tileID.overscaledZ-B)>Math.abs(v.tileID.overscaledZ-B),lt=H&&v.refreshedUponExpiration?1:a.ad(H?L:1-N,0,1);return v.refreshedUponExpiration&&L>=1&&(v.refreshedUponExpiration=!1),s?{opacity:1,mix:1-lt}:{opacity:lt,mix:0}}return{opacity:1,mix:0}}const Vl=new a.aT(1,0,0,1),_h=new a.aT(0,1,0,1),aa=new a.aT(0,0,1,1),ld=new a.aT(1,0,1,1),sl=new a.aT(0,1,1,1);function Tu(v,s,p,f){Gl(v,0,s+p/2,v.transform.width,p,f)}function vh(v,s,p,f){Gl(v,s-p/2,0,p,v.transform.height,f)}function Gl(v,s,p,f,y,x){const C=v.context,M=C.gl;M.enable(M.SCISSOR_TEST),M.scissor(s*v.pixelRatio,p*v.pixelRatio,f*v.pixelRatio,y*v.pixelRatio),C.clear({color:x}),M.disable(M.SCISSOR_TEST)}function xh(v,s,p){const f=v.context,y=f.gl,x=p.posMatrix,C=v.useProgram("debug"),M=Cr.disabled,L=wn.disabled,N=v.colorModeForRenderPass(),z="$debug",B=v.style.map.terrain&&v.style.map.terrain.getTerrainData(p);f.activeTexture.set(y.TEXTURE0);const H=s.getTileByID(p.key).latestRawTileData,lt=Math.floor((H&&H.byteLength||0)/1024),ut=s.getTile(p).tileSize,ht=512/Math.min(ut,512)*(p.overscaledZ/v.transform.zoom)*.5;let st=p.canonical.toString();p.overscaledZ!==p.canonical.z&&(st+=` => ${p.overscaledZ}`),function(Mt,Ft){Mt.initDebugOverlayCanvas();const yt=Mt.debugOverlayCanvas,Pt=Mt.context.gl,Vt=Mt.debugOverlayCanvas.getContext("2d");Vt.clearRect(0,0,yt.width,yt.height),Vt.shadowColor="white",Vt.shadowBlur=2,Vt.lineWidth=1.5,Vt.strokeStyle="white",Vt.textBaseline="top",Vt.font="bold 36px Open Sans, sans-serif",Vt.fillText(Ft,5,5),Vt.strokeText(Ft,5,5),Mt.debugOverlayTexture.update(yt),Mt.debugOverlayTexture.bind(Pt.LINEAR,Pt.CLAMP_TO_EDGE)}(v,`${st} ${lt}kB`),C.draw(f,y.TRIANGLES,M,L,Nn.alphaBlended,en.disabled,Ct(x,a.aT.transparent,ht),null,z,v.debugBuffer,v.quadTriangleIndexBuffer,v.debugSegments),C.draw(f,y.LINE_STRIP,M,L,N,en.disabled,Ct(x,a.aT.red),B,z,v.debugBuffer,v.tileBorderIndexBuffer,v.debugSegments)}function kn(v,s,p){const f=v.context,y=f.gl,x=v.colorModeForRenderPass(),C=new Cr(y.LEQUAL,Cr.ReadWrite,v.depthRangeFor3D),M=v.useProgram("terrain"),L=s.getTerrainMesh();f.bindFramebuffer.set(null),f.viewport.set([0,0,v.width,v.height]);for(const N of p){const z=v.renderToTexture.getTexture(N),B=s.getTerrainData(N.tileID);f.activeTexture.set(y.TEXTURE0),y.bindTexture(y.TEXTURE_2D,z.texture);const H={u_matrix:v.transform.calculatePosMatrix(N.tileID.toUnwrapped()),u_texture:0,u_ele_delta:s.getMeshFrameDelta(v.transform.zoom)};M.draw(f,y.TRIANGLES,C,wn.disabled,x,en.backCCW,H,B,"terrain",L.vertexBuffer,L.indexBuffer,L.segments)}}class al{constructor(s,p){this.context=new Sf(s),this.transform=p,this._tileTextures={},this.terrainFacilitator={dirty:!0,matrix:a.Z(),renderTime:0},this.setup(),this.numSublayers=vi.maxUnderzooming+vi.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.crossTileSymbolIndex=new Rs}resize(s,p,f){if(this.width=Math.floor(s*f),this.height=Math.floor(p*f),this.pixelRatio=f,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(const y of this.style._order)this.style._layers[y].resize()}setup(){const s=this.context,p=new a.a_;p.emplaceBack(0,0),p.emplaceBack(a.N,0),p.emplaceBack(0,a.N),p.emplaceBack(a.N,a.N),this.tileExtentBuffer=s.createVertexBuffer(p,eh.members),this.tileExtentSegments=a.S.simpleSegment(0,0,4,2);const f=new a.a_;f.emplaceBack(0,0),f.emplaceBack(a.N,0),f.emplaceBack(0,a.N),f.emplaceBack(a.N,a.N),this.debugBuffer=s.createVertexBuffer(f,eh.members),this.debugSegments=a.S.simpleSegment(0,0,4,5);const y=new a.V;y.emplaceBack(0,0,0,0),y.emplaceBack(a.N,0,a.N,0),y.emplaceBack(0,a.N,0,a.N),y.emplaceBack(a.N,a.N,a.N,a.N),this.rasterBoundsBuffer=s.createVertexBuffer(y,hn.members),this.rasterBoundsSegments=a.S.simpleSegment(0,0,4,2);const x=new a.a_;x.emplaceBack(0,0),x.emplaceBack(1,0),x.emplaceBack(0,1),x.emplaceBack(1,1),this.viewportBuffer=s.createVertexBuffer(x,eh.members),this.viewportSegments=a.S.simpleSegment(0,0,4,2);const C=new a.a$;C.emplaceBack(0),C.emplaceBack(1),C.emplaceBack(3),C.emplaceBack(2),C.emplaceBack(0),this.tileBorderIndexBuffer=s.createIndexBuffer(C);const M=new a.b0;M.emplaceBack(0,1,2),M.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=s.createIndexBuffer(M);const L=this.context.gl;this.stencilClearMode=new wn({func:L.ALWAYS,mask:0},0,255,L.ZERO,L.ZERO,L.ZERO)}clearStencil(){const s=this.context,p=s.gl;this.nextStencilID=1,this.currentStencilSource=void 0;const f=a.Z();a.aS(f,0,this.width,this.height,0,0,1),a.a0(f,f,[p.drawingBufferWidth,p.drawingBufferHeight,0]),this.useProgram("clippingMask").draw(s,p.TRIANGLES,Cr.disabled,this.stencilClearMode,Nn.disabled,en.disabled,Dt(f),null,"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}_renderTileClippingMasks(s,p){if(this.currentStencilSource===s.source||!s.isTileClipped()||!p||!p.length)return;this.currentStencilSource=s.source;const f=this.context,y=f.gl;this.nextStencilID+p.length>256&&this.clearStencil(),f.setColorMode(Nn.disabled),f.setDepthMode(Cr.disabled);const x=this.useProgram("clippingMask");this._tileClippingMaskIDs={};for(const C of p){const M=this._tileClippingMaskIDs[C.key]=this.nextStencilID++,L=this.style.map.terrain&&this.style.map.terrain.getTerrainData(C);x.draw(f,y.TRIANGLES,Cr.disabled,new wn({func:y.ALWAYS,mask:0},M,255,y.KEEP,y.KEEP,y.REPLACE),Nn.disabled,en.disabled,Dt(C.posMatrix),L,"$clipping",this.tileExtentBuffer,this.quadTriangleIndexBuffer,this.tileExtentSegments)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();const s=this.nextStencilID++,p=this.context.gl;return new wn({func:p.NOTEQUAL,mask:255},s,255,p.KEEP,p.KEEP,p.REPLACE)}stencilModeForClipping(s){const p=this.context.gl;return new wn({func:p.EQUAL,mask:255},this._tileClippingMaskIDs[s.key],0,p.KEEP,p.KEEP,p.REPLACE)}stencilConfigForOverlap(s){const p=this.context.gl,f=s.sort((C,M)=>M.overscaledZ-C.overscaledZ),y=f[f.length-1].overscaledZ,x=f[0].overscaledZ-y+1;if(x>1){this.currentStencilSource=void 0,this.nextStencilID+x>256&&this.clearStencil();const C={};for(let M=0;M<x;M++)C[M+y]=new wn({func:p.GEQUAL,mask:255},M+this.nextStencilID,255,p.KEEP,p.KEEP,p.REPLACE);return this.nextStencilID+=x,[C,f]}return[{[y]:wn.disabled},f]}colorModeForRenderPass(){const s=this.context.gl;return this._showOverdrawInspector?new Nn([s.CONSTANT_COLOR,s.ONE],new a.aT(.125,.125,.125,0),[!0,!0,!0,!0]):this.renderPass==="opaque"?Nn.unblended:Nn.alphaBlended}depthModeForSublayer(s,p,f){if(!this.opaquePassEnabledForLayer())return Cr.disabled;const y=1-((1+this.currentLayer)*this.numSublayers+s)*this.depthEpsilon;return new Cr(f||this.context.gl.LEQUAL,p,[y,y])}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}render(s,p){this.style=s,this.options=p,this.lineAtlas=s.lineAtlas,this.imageManager=s.imageManager,this.glyphManager=s.glyphManager,this.symbolFadeChange=s.placement.symbolFadeChange(a.h.now()),this.imageManager.beginFrame();const f=this.style._order,y=this.style.sourceCaches,x={},C={},M={};for(const L in y){const N=y[L];N.used&&N.prepare(this.context),x[L]=N.getVisibleCoordinates(),C[L]=x[L].slice().reverse(),M[L]=N.getVisibleCoordinates(!0).reverse()}this.opaquePassCutoff=1/0;for(let L=0;L<f.length;L++)if(this.style._layers[f[L]].is3D()){this.opaquePassCutoff=L;break}if(this.renderToTexture){this.renderToTexture.prepareForRender(this.style,this.transform.zoom),this.opaquePassCutoff=0;const L=this.style.map.terrain.sourceCache.tilesAfterTime(this.terrainFacilitator.renderTime);(this.terrainFacilitator.dirty||!a.b1(this.terrainFacilitator.matrix,this.transform.projMatrix)||L.length)&&(a.b2(this.terrainFacilitator.matrix,this.transform.projMatrix),this.terrainFacilitator.renderTime=Date.now(),this.terrainFacilitator.dirty=!1,function(N,z){const B=N.context,H=B.gl,lt=Nn.unblended,ut=new Cr(H.LEQUAL,Cr.ReadWrite,[0,1]),ht=z.getTerrainMesh(),st=z.sourceCache.getRenderableTiles(),Mt=N.useProgram("terrainDepth");B.bindFramebuffer.set(z.getFramebuffer("depth").framebuffer),B.viewport.set([0,0,N.width/devicePixelRatio,N.height/devicePixelRatio]),B.clear({color:a.aT.transparent,depth:1});for(const Ft of st){const yt=z.getTerrainData(Ft.tileID),Pt={u_matrix:N.transform.calculatePosMatrix(Ft.tileID.toUnwrapped()),u_ele_delta:z.getMeshFrameDelta(N.transform.zoom)};Mt.draw(B,H.TRIANGLES,ut,wn.disabled,lt,en.backCCW,Pt,yt,"terrain",ht.vertexBuffer,ht.indexBuffer,ht.segments)}B.bindFramebuffer.set(null),B.viewport.set([0,0,N.width,N.height])}(this,this.style.map.terrain),function(N,z){const B=N.context,H=B.gl,lt=Nn.unblended,ut=new Cr(H.LEQUAL,Cr.ReadWrite,[0,1]),ht=z.getTerrainMesh(),st=z.getCoordsTexture(),Mt=z.sourceCache.getRenderableTiles(),Ft=N.useProgram("terrainCoords");B.bindFramebuffer.set(z.getFramebuffer("coords").framebuffer),B.viewport.set([0,0,N.width/devicePixelRatio,N.height/devicePixelRatio]),B.clear({color:a.aT.transparent,depth:1}),z.coordsIndex=[];for(const yt of Mt){const Pt=z.getTerrainData(yt.tileID);B.activeTexture.set(H.TEXTURE0),H.bindTexture(H.TEXTURE_2D,st.texture);const Vt={u_matrix:N.transform.calculatePosMatrix(yt.tileID.toUnwrapped()),u_terrain_coords_id:(255-z.coordsIndex.length)/255,u_texture:0,u_ele_delta:z.getMeshFrameDelta(N.transform.zoom)};Ft.draw(B,H.TRIANGLES,ut,wn.disabled,lt,en.backCCW,Vt,Pt,"terrain",ht.vertexBuffer,ht.indexBuffer,ht.segments),z.coordsIndex.push(yt.tileID.key)}B.bindFramebuffer.set(null),B.viewport.set([0,0,N.width,N.height])}(this,this.style.map.terrain))}this.renderPass="offscreen";for(const L of f){const N=this.style._layers[L];if(!N.hasOffscreenPass()||N.isHidden(this.transform.zoom))continue;const z=C[N.source];(N.type==="custom"||z.length)&&this.renderLayer(this,y[N.source],N,z)}if(this.context.bindFramebuffer.set(null),this.context.clear({color:p.showOverdrawInspector?a.aT.black:a.aT.transparent,depth:1}),this.clearStencil(),this._showOverdrawInspector=p.showOverdrawInspector,this.depthRangeFor3D=[0,1-(s._order.length+2)*this.numSublayers*this.depthEpsilon],!this.renderToTexture)for(this.renderPass="opaque",this.currentLayer=f.length-1;this.currentLayer>=0;this.currentLayer--){const L=this.style._layers[f[this.currentLayer]],N=y[L.source],z=x[L.source];this._renderTileClippingMasks(L,z),this.renderLayer(this,N,L,z)}for(this.renderPass="translucent",this.currentLayer=0;this.currentLayer<f.length;this.currentLayer++){const L=this.style._layers[f[this.currentLayer]],N=y[L.source];if(this.renderToTexture&&this.renderToTexture.renderLayer(L))continue;const z=(L.type==="symbol"?M:C)[L.source];this._renderTileClippingMasks(L,x[L.source]),this.renderLayer(this,N,L,z)}if(this.options.showTileBoundaries){const L=function(N,z){let B=null;const H=Object.values(N._layers).flatMap(st=>st.source&&!st.isHidden(z)?[N.sourceCaches[st.source]]:[]),lt=H.filter(st=>st.getSource().type==="vector"),ut=H.filter(st=>st.getSource().type!=="vector"),ht=st=>{(!B||B.getSource().maxzoom<st.getSource().maxzoom)&&(B=st)};return lt.forEach(st=>ht(st)),B||ut.forEach(st=>ht(st)),B}(this.style,this.transform.zoom);L&&function(N,z,B){for(let H=0;H<B.length;H++)xh(N,z,B[H])}(this,L,L.getVisibleCoordinates())}this.options.showPadding&&function(L){const N=L.transform.padding;Tu(L,L.transform.height-(N.top||0),3,Vl),Tu(L,N.bottom||0,3,_h),vh(L,N.left||0,3,aa),vh(L,L.transform.width-(N.right||0),3,ld);const z=L.transform.centerPoint;(function(B,H,lt,ut){Gl(B,H-1,lt-10,2,20,ut),Gl(B,H-10,lt-1,20,2,ut)})(L,z.x,L.transform.height-z.y,sl)}(this),this.context.setDefault()}renderLayer(s,p,f,y){if(!f.isHidden(this.transform.zoom)&&(f.type==="background"||f.type==="custom"||(y||[]).length))switch(this.id=f.id,f.type){case"symbol":(function(x,C,M,L,N){if(x.renderPass!=="translucent")return;const z=wn.disabled,B=x.colorModeForRenderPass();(M._unevaluatedLayout.hasValue("text-variable-anchor")||M._unevaluatedLayout.hasValue("text-variable-anchor-offset"))&&function(H,lt,ut,ht,st,Mt,Ft){const yt=lt.transform,Pt=st==="map",Vt=Mt==="map";for(const qt of H){const Yt=ht.getTile(qt),ne=Yt.getBucket(ut);if(!ne||!ne.text||!ne.text.segments.get().length)continue;const Qt=a.ah(ne.textSizeData,yt.zoom),le=bt(Yt,1,lt.transform.zoom),ke=oe(qt.posMatrix,Vt,Pt,lt.transform,le),Mr=ut.layout.get("icon-text-fit")!=="none"&&ne.hasIconData();if(Qt){const ve=Math.pow(2,yt.zoom-Yt.tileID.overscaledZ);fh(ne,Pt,Vt,Ft,yt,ke,qt.posMatrix,ve,Qt,Mr,lt.style.map.terrain?(Je,Fe)=>lt.style.map.terrain.getElevation(qt,Je,Fe):null)}}}(L,x,M,C,M.layout.get("text-rotation-alignment"),M.layout.get("text-pitch-alignment"),N),M.paint.get("icon-opacity").constantOr(1)!==0&&ol(x,C,M,L,!1,M.paint.get("icon-translate"),M.paint.get("icon-translate-anchor"),M.layout.get("icon-rotation-alignment"),M.layout.get("icon-pitch-alignment"),M.layout.get("icon-keep-upright"),z,B),M.paint.get("text-opacity").constantOr(1)!==0&&ol(x,C,M,L,!0,M.paint.get("text-translate"),M.paint.get("text-translate-anchor"),M.layout.get("text-rotation-alignment"),M.layout.get("text-pitch-alignment"),M.layout.get("text-keep-upright"),z,B),C.map.showCollisionBoxes&&(il(x,C,M,L,M.paint.get("text-translate"),M.paint.get("text-translate-anchor"),!0),il(x,C,M,L,M.paint.get("icon-translate"),M.paint.get("icon-translate-anchor"),!1))})(s,p,f,y,this.style.placement.variableOffsets);break;case"circle":(function(x,C,M,L){if(x.renderPass!=="translucent")return;const N=M.paint.get("circle-opacity"),z=M.paint.get("circle-stroke-width"),B=M.paint.get("circle-stroke-opacity"),H=!M.layout.get("circle-sort-key").isConstant();if(N.constantOr(1)===0&&(z.constantOr(1)===0||B.constantOr(1)===0))return;const lt=x.context,ut=lt.gl,ht=x.depthModeForSublayer(0,Cr.ReadOnly),st=wn.disabled,Mt=x.colorModeForRenderPass(),Ft=[];for(let yt=0;yt<L.length;yt++){const Pt=L[yt],Vt=C.getTile(Pt),qt=Vt.getBucket(M);if(!qt)continue;const Yt=qt.programConfigurations.get(M.id),ne=x.useProgram("circle",Yt),Qt=qt.layoutVertexBuffer,le=qt.indexBuffer,ke=x.style.map.terrain&&x.style.map.terrain.getTerrainData(Pt),Mr={programConfiguration:Yt,program:ne,layoutVertexBuffer:Qt,indexBuffer:le,uniformValues:dt(x,Pt,Vt,M),terrainData:ke};if(H){const ve=qt.segments.get();for(const Je of ve)Ft.push({segments:new a.S([Je]),sortKey:Je.sortKey,state:Mr})}else Ft.push({segments:qt.segments,sortKey:0,state:Mr})}H&&Ft.sort((yt,Pt)=>yt.sortKey-Pt.sortKey);for(const yt of Ft){const{programConfiguration:Pt,program:Vt,layoutVertexBuffer:qt,indexBuffer:Yt,uniformValues:ne,terrainData:Qt}=yt.state;Vt.draw(lt,ut.TRIANGLES,ht,st,Mt,en.disabled,ne,Qt,M.id,qt,Yt,yt.segments,M.paint,x.transform.zoom,Pt)}})(s,p,f,y);break;case"heatmap":(function(x,C,M,L){if(M.paint.get("heatmap-opacity")!==0)if(x.renderPass==="offscreen"){const N=x.context,z=N.gl,B=wn.disabled,H=new Nn([z.ONE,z.ONE],a.aT.transparent,[!0,!0,!0,!0]);(function(lt,ut,ht){const st=lt.gl;lt.activeTexture.set(st.TEXTURE1),lt.viewport.set([0,0,ut.width/4,ut.height/4]);let Mt=ht.heatmapFbo;if(Mt)st.bindTexture(st.TEXTURE_2D,Mt.colorAttachment.get()),lt.bindFramebuffer.set(Mt.framebuffer);else{const Ft=st.createTexture();st.bindTexture(st.TEXTURE_2D,Ft),st.texParameteri(st.TEXTURE_2D,st.TEXTURE_WRAP_S,st.CLAMP_TO_EDGE),st.texParameteri(st.TEXTURE_2D,st.TEXTURE_WRAP_T,st.CLAMP_TO_EDGE),st.texParameteri(st.TEXTURE_2D,st.TEXTURE_MIN_FILTER,st.LINEAR),st.texParameteri(st.TEXTURE_2D,st.TEXTURE_MAG_FILTER,st.LINEAR),Mt=ht.heatmapFbo=lt.createFramebuffer(ut.width/4,ut.height/4,!1,!1),function(yt,Pt,Vt,qt){var Yt,ne;const Qt=yt.gl,le=(Yt=yt.HALF_FLOAT)!==null&&Yt!==void 0?Yt:Qt.UNSIGNED_BYTE,ke=(ne=yt.RGBA16F)!==null&&ne!==void 0?ne:Qt.RGBA;Qt.texImage2D(Qt.TEXTURE_2D,0,ke,Pt.width/4,Pt.height/4,0,Qt.RGBA,le,null),qt.colorAttachment.set(Vt)}(lt,ut,Ft,Mt)}})(N,x,M),N.clear({color:a.aT.transparent});for(let lt=0;lt<L.length;lt++){const ut=L[lt];if(C.hasRenderableParent(ut))continue;const ht=C.getTile(ut),st=ht.getBucket(M);if(!st)continue;const Mt=st.programConfigurations.get(M.id),Ft=x.useProgram("heatmap",Mt),{zoom:yt}=x.transform;Ft.draw(N,z.TRIANGLES,Cr.disabled,B,H,en.disabled,re(ut.posMatrix,ht,yt,M.paint.get("heatmap-intensity")),null,M.id,st.layoutVertexBuffer,st.indexBuffer,st.segments,M.paint,x.transform.zoom,Mt)}N.viewport.set([0,0,x.width,x.height])}else x.renderPass==="translucent"&&(x.context.setColorMode(x.colorModeForRenderPass()),function(N,z){const B=N.context,H=B.gl,lt=z.heatmapFbo;if(!lt)return;B.activeTexture.set(H.TEXTURE0),H.bindTexture(H.TEXTURE_2D,lt.colorAttachment.get()),B.activeTexture.set(H.TEXTURE1);let ut=z.colorRampTexture;ut||(ut=z.colorRampTexture=new J(B,z.colorRamp,H.RGBA)),ut.bind(H.LINEAR,H.CLAMP_TO_EDGE),N.useProgram("heatmapTexture").draw(B,H.TRIANGLES,Cr.disabled,wn.disabled,N.colorModeForRenderPass(),en.disabled,((ht,st,Mt,Ft)=>{const yt=a.Z();a.aS(yt,0,ht.width,ht.height,0,0,1);const Pt=ht.context.gl;return{u_matrix:yt,u_world:[Pt.drawingBufferWidth,Pt.drawingBufferHeight],u_image:0,u_color_ramp:1,u_opacity:st.paint.get("heatmap-opacity")}})(N,z),null,z.id,N.viewportBuffer,N.quadTriangleIndexBuffer,N.viewportSegments,z.paint,N.transform.zoom)}(x,M))})(s,p,f,y);break;case"line":(function(x,C,M,L){if(x.renderPass!=="translucent")return;const N=M.paint.get("line-opacity"),z=M.paint.get("line-width");if(N.constantOr(1)===0||z.constantOr(1)===0)return;const B=x.depthModeForSublayer(0,Cr.ReadOnly),H=x.colorModeForRenderPass(),lt=M.paint.get("line-dasharray"),ut=M.paint.get("line-pattern"),ht=ut.constantOr(1),st=M.paint.get("line-gradient"),Mt=M.getCrossfadeParameters(),Ft=ht?"linePattern":lt?"lineSDF":st?"lineGradient":"line",yt=x.context,Pt=yt.gl;let Vt=!0;for(const qt of L){const Yt=C.getTile(qt);if(ht&&!Yt.patternsLoaded())continue;const ne=Yt.getBucket(M);if(!ne)continue;const Qt=ne.programConfigurations.get(M.id),le=x.context.program.get(),ke=x.useProgram(Ft,Qt),Mr=Vt||ke.program!==le,ve=x.style.map.terrain&&x.style.map.terrain.getTerrainData(qt),Je=ut.constantOr(null);if(Je&&Yt.imageAtlas){const Ir=Yt.imageAtlas,mr=Ir.patternPositions[Je.to.toString()],Pr=Ir.patternPositions[Je.from.toString()];mr&&Pr&&Qt.setConstantPatternPositions(mr,Pr)}const Fe=ve?qt:null,mn=ht?_e(x,Yt,M,Mt,Fe):lt?sr(x,Yt,M,lt,Mt,Fe):st?Ee(x,Yt,M,ne.lineClipsArray.length,Fe):we(x,Yt,M,Fe);if(ht)yt.activeTexture.set(Pt.TEXTURE0),Yt.imageAtlasTexture.bind(Pt.LINEAR,Pt.CLAMP_TO_EDGE),Qt.updatePaintBuffers(Mt);else if(lt&&(Mr||x.lineAtlas.dirty))yt.activeTexture.set(Pt.TEXTURE0),x.lineAtlas.bind(yt);else if(st){const Ir=ne.gradients[M.id];let mr=Ir.texture;if(M.gradientVersion!==Ir.version){let Pr=256;if(M.stepInterpolant){const hi=C.getSource().maxzoom,Mn=qt.canonical.z===hi?Math.ceil(1<<x.transform.maxZoom-qt.canonical.z):1;Pr=a.ad(a.aY(ne.maxLineLength/a.N*1024*Mn),256,yt.maxTextureSize)}Ir.gradient=a.aZ({expression:M.gradientExpression(),evaluationKey:"lineProgress",resolution:Pr,image:Ir.gradient||void 0,clips:ne.lineClipsArray}),Ir.texture?Ir.texture.update(Ir.gradient):Ir.texture=new J(yt,Ir.gradient,Pt.RGBA),Ir.version=M.gradientVersion,mr=Ir.texture}yt.activeTexture.set(Pt.TEXTURE0),mr.bind(M.stepInterpolant?Pt.NEAREST:Pt.LINEAR,Pt.CLAMP_TO_EDGE)}ke.draw(yt,Pt.TRIANGLES,B,x.stencilModeForClipping(qt),H,en.disabled,mn,ve,M.id,ne.layoutVertexBuffer,ne.indexBuffer,ne.segments,M.paint,x.transform.zoom,Qt,ne.layoutVertexBuffer2),Vt=!1}})(s,p,f,y);break;case"fill":(function(x,C,M,L){const N=M.paint.get("fill-color"),z=M.paint.get("fill-opacity");if(z.constantOr(1)===0)return;const B=x.colorModeForRenderPass(),H=M.paint.get("fill-pattern"),lt=x.opaquePassEnabledForLayer()&&!H.constantOr(1)&&N.constantOr(a.aT.transparent).a===1&&z.constantOr(0)===1?"opaque":"translucent";if(x.renderPass===lt){const ut=x.depthModeForSublayer(1,x.renderPass==="opaque"?Cr.ReadWrite:Cr.ReadOnly);sc(x,C,M,L,ut,B,!1)}if(x.renderPass==="translucent"&&M.paint.get("fill-antialias")){const ut=x.depthModeForSublayer(M.getPaintProperty("fill-outline-color")?2:0,Cr.ReadOnly);sc(x,C,M,L,ut,B,!0)}})(s,p,f,y);break;case"fill-extrusion":(function(x,C,M,L){const N=M.paint.get("fill-extrusion-opacity");if(N!==0&&x.renderPass==="translucent"){const z=new Cr(x.context.gl.LEQUAL,Cr.ReadWrite,x.depthRangeFor3D);if(N!==1||M.paint.get("fill-extrusion-pattern").constantOr(1))ac(x,C,M,L,z,wn.disabled,Nn.disabled),ac(x,C,M,L,z,x.stencilModeFor3D(),x.colorModeForRenderPass());else{const B=x.colorModeForRenderPass();ac(x,C,M,L,z,wn.disabled,B)}}})(s,p,f,y);break;case"hillshade":(function(x,C,M,L){if(x.renderPass!=="offscreen"&&x.renderPass!=="translucent")return;const N=x.context,z=x.depthModeForSublayer(0,Cr.ReadOnly),B=x.colorModeForRenderPass(),[H,lt]=x.renderPass==="translucent"?x.stencilConfigForOverlap(L):[{},L];for(const ut of lt){const ht=C.getTile(ut);ht.needsHillshadePrepare!==void 0&&ht.needsHillshadePrepare&&x.renderPass==="offscreen"?gh(x,ht,M,z,wn.disabled,B):x.renderPass==="translucent"&&ad(x,ut,ht,M,z,H[ut.overscaledZ],B)}N.viewport.set([0,0,x.width,x.height])})(s,p,f,y);break;case"raster":(function(x,C,M,L){if(x.renderPass!=="translucent"||M.paint.get("raster-opacity")===0||!L.length)return;const N=x.context,z=N.gl,B=C.getSource(),H=x.useProgram("raster"),lt=x.colorModeForRenderPass(),[ut,ht]=B instanceof Ye?[{},L]:x.stencilConfigForOverlap(L),st=ht[ht.length-1].overscaledZ,Mt=!x.options.moving;for(const Ft of ht){const yt=x.depthModeForSublayer(Ft.overscaledZ-st,M.paint.get("raster-opacity")===1?Cr.ReadWrite:Cr.ReadOnly,z.LESS),Pt=C.getTile(Ft);Pt.registerFadeDuration(M.paint.get("raster-fade-duration"));const Vt=C.findLoadedParent(Ft,0),qt=yh(Pt,Vt,C,M,x.transform,x.style.map.terrain);let Yt,ne;const Qt=M.paint.get("raster-resampling")==="nearest"?z.NEAREST:z.LINEAR;N.activeTexture.set(z.TEXTURE0),Pt.texture.bind(Qt,z.CLAMP_TO_EDGE,z.LINEAR_MIPMAP_NEAREST),N.activeTexture.set(z.TEXTURE1),Vt?(Vt.texture.bind(Qt,z.CLAMP_TO_EDGE,z.LINEAR_MIPMAP_NEAREST),Yt=Math.pow(2,Vt.tileID.overscaledZ-Pt.tileID.overscaledZ),ne=[Pt.tileID.canonical.x*Yt%1,Pt.tileID.canonical.y*Yt%1]):Pt.texture.bind(Qt,z.CLAMP_TO_EDGE,z.LINEAR_MIPMAP_NEAREST);const le=x.style.map.terrain&&x.style.map.terrain.getTerrainData(Ft),ke=le?Ft:null,Mr=ke?ke.posMatrix:x.transform.calculatePosMatrix(Ft.toUnwrapped(),Mt),ve=Kn(Mr,ne||[0,0],Yt||1,qt,M);B instanceof Ye?H.draw(N,z.TRIANGLES,yt,wn.disabled,lt,en.disabled,ve,le,M.id,B.boundsBuffer,x.quadTriangleIndexBuffer,B.boundsSegments):H.draw(N,z.TRIANGLES,yt,ut[Ft.overscaledZ],lt,en.disabled,ve,le,M.id,x.rasterBoundsBuffer,x.quadTriangleIndexBuffer,x.rasterBoundsSegments)}})(s,p,f,y);break;case"background":(function(x,C,M,L){const N=M.paint.get("background-color"),z=M.paint.get("background-opacity");if(z===0)return;const B=x.context,H=B.gl,lt=x.transform,ut=lt.tileSize,ht=M.paint.get("background-pattern");if(x.isPatternMissing(ht))return;const st=!ht&&N.a===1&&z===1&&x.opaquePassEnabledForLayer()?"opaque":"translucent";if(x.renderPass!==st)return;const Mt=wn.disabled,Ft=x.depthModeForSublayer(0,st==="opaque"?Cr.ReadWrite:Cr.ReadOnly),yt=x.colorModeForRenderPass(),Pt=x.useProgram(ht?"backgroundPattern":"background"),Vt=L||lt.coveringTiles({tileSize:ut,terrain:x.style.map.terrain});ht&&(B.activeTexture.set(H.TEXTURE0),x.imageManager.bind(x.context));const qt=M.getCrossfadeParameters();for(const Yt of Vt){const ne=L?Yt.posMatrix:x.transform.calculatePosMatrix(Yt.toUnwrapped()),Qt=ht?Po(ne,z,x,ht,{tileID:Yt,tileSize:ut},qt):Un(ne,z,N),le=x.style.map.terrain&&x.style.map.terrain.getTerrainData(Yt);Pt.draw(B,H.TRIANGLES,Ft,Mt,yt,en.disabled,Qt,le,M.id,x.tileExtentBuffer,x.quadTriangleIndexBuffer,x.tileExtentSegments)}})(s,0,f,y);break;case"custom":(function(x,C,M){const L=x.context,N=M.implementation;if(x.renderPass==="offscreen"){const z=N.prerender;z&&(x.setCustomLayerDefaults(),L.setColorMode(x.colorModeForRenderPass()),z.call(N,L.gl,x.transform.customLayerMatrix()),L.setDirty(),x.setBaseState())}else if(x.renderPass==="translucent"){x.setCustomLayerDefaults(),L.setColorMode(x.colorModeForRenderPass()),L.setStencilMode(wn.disabled);const z=N.renderingMode==="3d"?new Cr(x.context.gl.LEQUAL,Cr.ReadWrite,x.depthRangeFor3D):x.depthModeForSublayer(0,Cr.ReadOnly);L.setDepthMode(z),N.render(L.gl,x.transform.customLayerMatrix()),L.setDirty(),x.setBaseState(),L.bindFramebuffer.set(null)}})(s,0,f)}}translatePosMatrix(s,p,f,y,x){if(!f[0]&&!f[1])return s;const C=x?y==="map"?this.transform.angle:0:y==="viewport"?-this.transform.angle:0;if(C){const N=Math.sin(C),z=Math.cos(C);f=[f[0]*z-f[1]*N,f[0]*N+f[1]*z]}const M=[x?f[0]:bt(p,f[0],this.transform.zoom),x?f[1]:bt(p,f[1],this.transform.zoom),0],L=new Float32Array(16);return a.$(L,s,M),L}saveTileTexture(s){const p=this._tileTextures[s.size[0]];p?p.push(s):this._tileTextures[s.size[0]]=[s]}getTileTexture(s){const p=this._tileTextures[s];return p&&p.length>0?p.pop():null}isPatternMissing(s){if(!s)return!1;if(!s.from||!s.to)return!0;const p=this.imageManager.getPattern(s.from.toString()),f=this.imageManager.getPattern(s.to.toString());return!p||!f}useProgram(s,p){this.cache=this.cache||{};const f=s+(p?p.cacheKey:"")+(this._showOverdrawInspector?"/overdraw":"")+(this.style.map.terrain?"/terrain":"");return this.cache[f]||(this.cache[f]=new Qu(this.context,An[s],p,rh[s],this._showOverdrawInspector,this.style.map.terrain)),this.cache[f]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){const s=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(s.FUNC_ADD)}initDebugOverlayCanvas(){this.debugOverlayCanvas==null&&(this.debugOverlayCanvas=document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new J(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))}destroy(){this.debugOverlayTexture&&this.debugOverlayTexture.destroy()}overLimit(){const{drawingBufferWidth:s,drawingBufferHeight:p}=this.context.gl;return this.width!==s||this.height!==p}}class go{constructor(s,p){this.points=s,this.planes=p}static fromInvProjectionMatrix(s,p,f){const y=Math.pow(2,f),x=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(M=>{const L=1/(M=a.ag([],M,s))[3]/p*y;return a.b3(M,M,[L,L,1/M[3],L])}),C=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map(M=>{const L=function(H,lt){var ut=lt[0],ht=lt[1],st=lt[2],Mt=ut*ut+ht*ht+st*st;return Mt>0&&(Mt=1/Math.sqrt(Mt)),H[0]=lt[0]*Mt,H[1]=lt[1]*Mt,H[2]=lt[2]*Mt,H}([],function(H,lt,ut){var ht=lt[0],st=lt[1],Mt=lt[2],Ft=ut[0],yt=ut[1],Pt=ut[2];return H[0]=st*Pt-Mt*yt,H[1]=Mt*Ft-ht*Pt,H[2]=ht*yt-st*Ft,H}([],vt([],x[M[0]],x[M[1]]),vt([],x[M[2]],x[M[1]]))),N=-((z=L)[0]*(B=x[M[1]])[0]+z[1]*B[1]+z[2]*B[2]);var z,B;return L.concat(N)});return new go(x,C)}}class la{constructor(s,p){this.min=s,this.max=p,this.center=function(f,y,x){return f[0]=.5*y[0],f[1]=.5*y[1],f[2]=.5*y[2],f}([],function(f,y,x){return f[0]=y[0]+x[0],f[1]=y[1]+x[1],f[2]=y[2]+x[2],f}([],this.min,this.max))}quadrant(s){const p=[s%2==0,s<2],f=V(this.min),y=V(this.max);for(let x=0;x<p.length;x++)f[x]=p[x]?this.min[x]:this.center[x],y[x]=p[x]?this.center[x]:this.max[x];return y[2]=this.max[2],new la(f,y)}distanceX(s){return Math.max(Math.min(this.max[0],s[0]),this.min[0])-s[0]}distanceY(s){return Math.max(Math.min(this.max[1],s[1]),this.min[1])-s[1]}intersects(s){const p=[[this.min[0],this.min[1],this.min[2],1],[this.max[0],this.min[1],this.min[2],1],[this.max[0],this.max[1],this.min[2],1],[this.min[0],this.max[1],this.min[2],1],[this.min[0],this.min[1],this.max[2],1],[this.max[0],this.min[1],this.max[2],1],[this.max[0],this.max[1],this.max[2],1],[this.min[0],this.max[1],this.max[2],1]];let f=!0;for(let y=0;y<s.planes.length;y++){const x=s.planes[y];let C=0;for(let M=0;M<p.length;M++)a.b4(x,p[M])>=0&&C++;if(C===0)return 0;C!==p.length&&(f=!1)}if(f)return 2;for(let y=0;y<3;y++){let x=Number.MAX_VALUE,C=-Number.MAX_VALUE;for(let M=0;M<s.points.length;M++){const L=s.points[M][y]-this.min[y];x=Math.min(x,L),C=Math.max(C,L)}if(C<0||x>this.max[y]-this.min[y])return 0}return 1}}class Iu{constructor(s=0,p=0,f=0,y=0){if(isNaN(s)||s<0||isNaN(p)||p<0||isNaN(f)||f<0||isNaN(y)||y<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=s,this.bottom=p,this.left=f,this.right=y}interpolate(s,p,f){return p.top!=null&&s.top!=null&&(this.top=a.B.number(s.top,p.top,f)),p.bottom!=null&&s.bottom!=null&&(this.bottom=a.B.number(s.bottom,p.bottom,f)),p.left!=null&&s.left!=null&&(this.left=a.B.number(s.left,p.left,f)),p.right!=null&&s.right!=null&&(this.right=a.B.number(s.right,p.right,f)),this}getCenter(s,p){const f=a.ad((this.left+s-this.right)/2,0,s),y=a.ad((this.top+p-this.bottom)/2,0,p);return new a.P(f,y)}equals(s){return this.top===s.top&&this.bottom===s.bottom&&this.left===s.left&&this.right===s.right}clone(){return new Iu(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}class bh{constructor(s,p,f,y,x){this.tileSize=512,this.maxValidLatitude=85.051129,this._renderWorldCopies=x===void 0||!!x,this._minZoom=s||0,this._maxZoom=p||22,this._minPitch=f??0,this._maxPitch=y??60,this.setMaxBounds(),this.width=0,this.height=0,this._center=new a.L(0,0),this._elevation=0,this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._unmodified=!0,this._edgeInsets=new Iu,this._posMatrixCache={},this._alignedPosMatrixCache={},this._minEleveationForCurrentTile=0}clone(){const s=new bh(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies);return s.apply(this),s}apply(s){this.tileSize=s.tileSize,this.latRange=s.latRange,this.width=s.width,this.height=s.height,this._center=s._center,this._elevation=s._elevation,this._minEleveationForCurrentTile=s._minEleveationForCurrentTile,this.zoom=s.zoom,this.angle=s.angle,this._fov=s._fov,this._pitch=s._pitch,this._unmodified=s._unmodified,this._edgeInsets=s._edgeInsets.clone(),this._calcMatrices()}get minZoom(){return this._minZoom}set minZoom(s){this._minZoom!==s&&(this._minZoom=s,this.zoom=Math.max(this.zoom,s))}get maxZoom(){return this._maxZoom}set maxZoom(s){this._maxZoom!==s&&(this._maxZoom=s,this.zoom=Math.min(this.zoom,s))}get minPitch(){return this._minPitch}set minPitch(s){this._minPitch!==s&&(this._minPitch=s,this.pitch=Math.max(this.pitch,s))}get maxPitch(){return this._maxPitch}set maxPitch(s){this._maxPitch!==s&&(this._maxPitch=s,this.pitch=Math.min(this.pitch,s))}get renderWorldCopies(){return this._renderWorldCopies}set renderWorldCopies(s){s===void 0?s=!0:s===null&&(s=!1),this._renderWorldCopies=s}get worldSize(){return this.tileSize*this.scale}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new a.P(this.width,this.height)}get bearing(){return-this.angle/Math.PI*180}set bearing(s){const p=-a.b5(s,-180,180)*Math.PI/180;this.angle!==p&&(this._unmodified=!1,this.angle=p,this._calcMatrices(),this.rotationMatrix=function(){var f=new a.A(4);return a.A!=Float32Array&&(f[1]=0,f[2]=0),f[0]=1,f[3]=1,f}(),function(f,y,x){var C=y[0],M=y[1],L=y[2],N=y[3],z=Math.sin(x),B=Math.cos(x);f[0]=C*B+L*z,f[1]=M*B+N*z,f[2]=C*-z+L*B,f[3]=M*-z+N*B}(this.rotationMatrix,this.rotationMatrix,this.angle))}get pitch(){return this._pitch/Math.PI*180}set pitch(s){const p=a.ad(s,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==p&&(this._unmodified=!1,this._pitch=p,this._calcMatrices())}get fov(){return this._fov/Math.PI*180}set fov(s){s=Math.max(.01,Math.min(60,s)),this._fov!==s&&(this._unmodified=!1,this._fov=s/180*Math.PI,this._calcMatrices())}get zoom(){return this._zoom}set zoom(s){const p=Math.min(Math.max(s,this.minZoom),this.maxZoom);this._zoom!==p&&(this._unmodified=!1,this._zoom=p,this.tileZoom=Math.max(0,Math.floor(p)),this.scale=this.zoomScale(p),this._constrain(),this._calcMatrices())}get center(){return this._center}set center(s){s.lat===this._center.lat&&s.lng===this._center.lng||(this._unmodified=!1,this._center=s,this._constrain(),this._calcMatrices())}get elevation(){return this._elevation}set elevation(s){s!==this._elevation&&(this._elevation=s,this._constrain(),this._calcMatrices())}get padding(){return this._edgeInsets.toJSON()}set padding(s){this._edgeInsets.equals(s)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,s,1),this._calcMatrices())}get centerPoint(){return this._edgeInsets.getCenter(this.width,this.height)}isPaddingEqual(s){return this._edgeInsets.equals(s)}interpolatePadding(s,p,f){this._unmodified=!1,this._edgeInsets.interpolate(s,p,f),this._constrain(),this._calcMatrices()}coveringZoomLevel(s){const p=(s.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/s.tileSize));return Math.max(0,p)}getVisibleUnwrappedCoordinates(s){const p=[new a.b6(0,s)];if(this._renderWorldCopies){const f=this.pointCoordinate(new a.P(0,0)),y=this.pointCoordinate(new a.P(this.width,0)),x=this.pointCoordinate(new a.P(this.width,this.height)),C=this.pointCoordinate(new a.P(0,this.height)),M=Math.floor(Math.min(f.x,y.x,x.x,C.x)),L=Math.floor(Math.max(f.x,y.x,x.x,C.x)),N=1;for(let z=M-N;z<=L+N;z++)z!==0&&p.push(new a.b6(z,s))}return p}coveringTiles(s){var p,f;let y=this.coveringZoomLevel(s);const x=y;if(s.minzoom!==void 0&&y<s.minzoom)return[];s.maxzoom!==void 0&&y>s.maxzoom&&(y=s.maxzoom);const C=this.pointCoordinate(this.getCameraPoint()),M=a.U.fromLngLat(this.center),L=Math.pow(2,y),N=[L*C.x,L*C.y,0],z=[L*M.x,L*M.y,0],B=go.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,y);let H=s.minzoom||0;!s.terrain&&this.pitch<=60&&this._edgeInsets.top<.1&&(H=y);const lt=s.terrain?2/Math.min(this.tileSize,s.tileSize)*this.tileSize:3,ut=yt=>({aabb:new la([yt*L,0,0],[(yt+1)*L,L,0]),zoom:0,x:0,y:0,wrap:yt,fullyVisible:!1}),ht=[],st=[],Mt=y,Ft=s.reparseOverscaled?x:y;if(this._renderWorldCopies)for(let yt=1;yt<=3;yt++)ht.push(ut(-yt)),ht.push(ut(yt));for(ht.push(ut(0));ht.length>0;){const yt=ht.pop(),Pt=yt.x,Vt=yt.y;let qt=yt.fullyVisible;if(!qt){const ke=yt.aabb.intersects(B);if(ke===0)continue;qt=ke===2}const Yt=s.terrain?N:z,ne=yt.aabb.distanceX(Yt),Qt=yt.aabb.distanceY(Yt),le=Math.max(Math.abs(ne),Math.abs(Qt));if(yt.zoom===Mt||le>lt+(1<<Mt-yt.zoom)-2&&yt.zoom>=H){const ke=Mt-yt.zoom,Mr=N[0]-.5-(Pt<<ke),ve=N[1]-.5-(Vt<<ke);st.push({tileID:new a.O(yt.zoom===Mt?Ft:yt.zoom,yt.wrap,yt.zoom,Pt,Vt),distanceSq:ot([z[0]-.5-Pt,z[1]-.5-Vt]),tileDistanceToCamera:Math.sqrt(Mr*Mr+ve*ve)})}else for(let ke=0;ke<4;ke++){const Mr=(Pt<<1)+ke%2,ve=(Vt<<1)+(ke>>1),Je=yt.zoom+1;let Fe=yt.aabb.quadrant(ke);if(s.terrain){const mn=new a.O(Je,yt.wrap,Je,Mr,ve),Ir=s.terrain.getMinMaxElevation(mn),mr=(p=Ir.minElevation)!==null&&p!==void 0?p:this.elevation,Pr=(f=Ir.maxElevation)!==null&&f!==void 0?f:this.elevation;Fe=new la([Fe.min[0],Fe.min[1],mr],[Fe.max[0],Fe.max[1],Pr])}ht.push({aabb:Fe,zoom:Je,x:Mr,y:ve,wrap:yt.wrap,fullyVisible:qt})}}return st.sort((yt,Pt)=>yt.distanceSq-Pt.distanceSq).map(yt=>yt.tileID)}resize(s,p){this.width=s,this.height=p,this.pixelsToGLUnits=[2/s,-2/p],this._constrain(),this._calcMatrices()}get unmodified(){return this._unmodified}zoomScale(s){return Math.pow(2,s)}scaleZoom(s){return Math.log(s)/Math.LN2}project(s){const p=a.ad(s.lat,-this.maxValidLatitude,this.maxValidLatitude);return new a.P(a.G(s.lng)*this.worldSize,a.H(p)*this.worldSize)}unproject(s){return new a.U(s.x/this.worldSize,s.y/this.worldSize).toLngLat()}get point(){return this.project(this.center)}getCameraPosition(){return{lngLat:this.pointLocation(this.getCameraPoint()),altitude:Math.cos(this._pitch)*this.cameraToCenterDistance/this._pixelPerMeter+this.elevation}}recalculateZoom(s){const p=this.pointLocation(this.centerPoint,s),f=s.getElevationForLngLatZoom(p,this.tileZoom);if(!(this.elevation-f))return;const y=this.getCameraPosition(),x=a.U.fromLngLat(y.lngLat,y.altitude),C=a.U.fromLngLat(p,f),M=x.x-C.x,L=x.y-C.y,N=x.z-C.z,z=Math.sqrt(M*M+L*L+N*N),B=this.scaleZoom(this.cameraToCenterDistance/z/this.tileSize);this._elevation=f,this._center=p,this.zoom=B}setLocationAtPoint(s,p){const f=this.pointCoordinate(p),y=this.pointCoordinate(this.centerPoint),x=this.locationCoordinate(s),C=new a.U(x.x-(f.x-y.x),x.y-(f.y-y.y));this.center=this.coordinateLocation(C),this._renderWorldCopies&&(this.center=this.center.wrap())}locationPoint(s,p){return p?this.coordinatePoint(this.locationCoordinate(s),p.getElevationForLngLatZoom(s,this.tileZoom),this.pixelMatrix3D):this.coordinatePoint(this.locationCoordinate(s))}pointLocation(s,p){return this.coordinateLocation(this.pointCoordinate(s,p))}locationCoordinate(s){return a.U.fromLngLat(s)}coordinateLocation(s){return s&&s.toLngLat()}pointCoordinate(s,p){if(p){const H=p.pointCoordinate(s);if(H!=null)return H}const f=[s.x,s.y,0,1],y=[s.x,s.y,1,1];a.ag(f,f,this.pixelMatrixInverse),a.ag(y,y,this.pixelMatrixInverse);const x=f[3],C=y[3],M=f[1]/x,L=y[1]/C,N=f[2]/x,z=y[2]/C,B=N===z?0:(0-N)/(z-N);return new a.U(a.B.number(f[0]/x,y[0]/C,B)/this.worldSize,a.B.number(M,L,B)/this.worldSize)}coordinatePoint(s,p=0,f=this.pixelMatrix){const y=[s.x*this.worldSize,s.y*this.worldSize,p,1];return a.ag(y,y,f),new a.P(y[0]/y[3],y[1]/y[3])}getBounds(){const s=Math.max(0,this.height/2-this.getHorizon());return new ue().extend(this.pointLocation(new a.P(0,s))).extend(this.pointLocation(new a.P(this.width,s))).extend(this.pointLocation(new a.P(this.width,this.height))).extend(this.pointLocation(new a.P(0,this.height)))}getMaxBounds(){return this.latRange&&this.latRange.length===2&&this.lngRange&&this.lngRange.length===2?new ue([this.lngRange[0],this.latRange[0]],[this.lngRange[1],this.latRange[1]]):null}getHorizon(){return Math.tan(Math.PI/2-this._pitch)*this.cameraToCenterDistance*.85}setMaxBounds(s){s?(this.lngRange=[s.getWest(),s.getEast()],this.latRange=[s.getSouth(),s.getNorth()],this._constrain()):(this.lngRange=null,this.latRange=[-this.maxValidLatitude,this.maxValidLatitude])}calculatePosMatrix(s,p=!1){const f=s.key,y=p?this._alignedPosMatrixCache:this._posMatrixCache;if(y[f])return y[f];const x=s.canonical,C=this.worldSize/this.zoomScale(x.z),M=x.x+Math.pow(2,x.z)*s.wrap,L=a.ao(new Float64Array(16));return a.$(L,L,[M*C,x.y*C,0]),a.a0(L,L,[C/a.N,C/a.N,1]),a.a1(L,p?this.alignedProjMatrix:this.projMatrix,L),y[f]=new Float32Array(L),y[f]}customLayerMatrix(){return this.mercatorMatrix.slice()}_constrain(){if(!this.center||!this.width||!this.height||this._constraining)return;this._constraining=!0;let s,p,f,y,x=-90,C=90,M=-180,L=180;const N=this.size,z=this._unmodified;if(this.latRange){const lt=this.latRange;x=a.H(lt[1])*this.worldSize,C=a.H(lt[0])*this.worldSize,s=C-x<N.y?N.y/(C-x):0}if(this.lngRange){const lt=this.lngRange;M=a.b5(a.G(lt[0])*this.worldSize,0,this.worldSize),L=a.b5(a.G(lt[1])*this.worldSize,0,this.worldSize),L<M&&(L+=this.worldSize),p=L-M<N.x?N.x/(L-M):0}const B=this.point,H=Math.max(p||0,s||0);if(H)return this.center=this.unproject(new a.P(p?(L+M)/2:B.x,s?(C+x)/2:B.y)),this.zoom+=this.scaleZoom(H),this._unmodified=z,void(this._constraining=!1);if(this.latRange){const lt=B.y,ut=N.y/2;lt-ut<x&&(y=x+ut),lt+ut>C&&(y=C-ut)}if(this.lngRange){const lt=(M+L)/2,ut=a.b5(B.x,lt-this.worldSize/2,lt+this.worldSize/2),ht=N.x/2;ut-ht<M&&(f=M+ht),ut+ht>L&&(f=L-ht)}f===void 0&&y===void 0||(this.center=this.unproject(new a.P(f!==void 0?f:B.x,y!==void 0?y:B.y)).wrap()),this._unmodified=z,this._constraining=!1}_calcMatrices(){if(!this.height)return;const s=this.centerOffset,p=this.point.x,f=this.point.y;this.cameraToCenterDistance=.5/Math.tan(this._fov/2)*this.height,this._pixelPerMeter=a.b7(1,this.center.lat)*this.worldSize;let y=a.ao(new Float64Array(16));a.a0(y,y,[this.width/2,-this.height/2,1]),a.$(y,y,[1,-1,0]),this.labelPlaneMatrix=y,y=a.ao(new Float64Array(16)),a.a0(y,y,[1,-1,1]),a.$(y,y,[-1,-1,0]),a.a0(y,y,[2/this.width,2/this.height,1]),this.glCoordMatrix=y;const x=this.cameraToCenterDistance+this._elevation*this._pixelPerMeter/Math.cos(this._pitch),C=Math.min(this.elevation,this._minEleveationForCurrentTile),M=x-C*this._pixelPerMeter/Math.cos(this._pitch),L=C<0?M:x,N=Math.PI/2+this._pitch,z=this._fov*(.5+s.y/this.height),B=Math.sin(z)*L/Math.sin(a.ad(Math.PI-N-z,.01,Math.PI-.01)),H=this.getHorizon(),lt=2*Math.atan(H/this.cameraToCenterDistance)*(.5+s.y/(2*H)),ut=Math.sin(lt)*L/Math.sin(a.ad(Math.PI-N-lt,.01,Math.PI-.01)),ht=Math.min(B,ut),st=1.01*(Math.cos(Math.PI/2-this._pitch)*ht+L),Mt=this.height/50;y=new Float64Array(16),a.b8(y,this._fov,this.width/this.height,Mt,st),y[8]=2*-s.x/this.width,y[9]=2*s.y/this.height,a.a0(y,y,[1,-1,1]),a.$(y,y,[0,0,-this.cameraToCenterDistance]),a.b9(y,y,this._pitch),a.ae(y,y,this.angle),a.$(y,y,[-p,-f,0]),this.mercatorMatrix=a.a0([],y,[this.worldSize,this.worldSize,this.worldSize]),a.a0(y,y,[1,1,this._pixelPerMeter]),this.pixelMatrix=a.a1(new Float64Array(16),this.labelPlaneMatrix,y),a.$(y,y,[0,0,-this.elevation]),this.projMatrix=y,this.invProjMatrix=a.as([],y),this.pixelMatrix3D=a.a1(new Float64Array(16),this.labelPlaneMatrix,y);const Ft=this.width%2/2,yt=this.height%2/2,Pt=Math.cos(this.angle),Vt=Math.sin(this.angle),qt=p-Math.round(p)+Pt*Ft+Vt*yt,Yt=f-Math.round(f)+Pt*yt+Vt*Ft,ne=new Float64Array(y);if(a.$(ne,ne,[qt>.5?qt-1:qt,Yt>.5?Yt-1:Yt,0]),this.alignedProjMatrix=ne,y=a.as(new Float64Array(16),this.pixelMatrix),!y)throw new Error("failed to invert matrix");this.pixelMatrixInverse=y,this._posMatrixCache={},this._alignedPosMatrixCache={}}maxPitchScaleFactor(){if(!this.pixelMatrixInverse)return 1;const s=this.pointCoordinate(new a.P(0,0)),p=[s.x*this.worldSize,s.y*this.worldSize,0,1];return a.ag(p,p,this.pixelMatrix)[3]/this.cameraToCenterDistance}getCameraPoint(){const s=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new a.P(0,s))}getCameraQueryGeometry(s){const p=this.getCameraPoint();if(s.length===1)return[s[0],p];{let f=p.x,y=p.y,x=p.x,C=p.y;for(const M of s)f=Math.min(f,M.x),y=Math.min(y,M.y),x=Math.max(x,M.x),C=Math.max(C,M.y);return[new a.P(f,y),new a.P(x,y),new a.P(x,C),new a.P(f,C),new a.P(f,y)]}}}function Lt(v,s){let p,f=!1,y=null,x=null;const C=()=>{y=null,f&&(v.apply(x,p),y=setTimeout(C,s),f=!1)};return(...M)=>(f=!0,x=this,p=M,y||C(),y)}class Xt{constructor(s){this._getCurrentHash=()=>{const p=window.location.hash.replace("#","");if(this._hashName){let f;return p.split("&").map(y=>y.split("=")).forEach(y=>{y[0]===this._hashName&&(f=y)}),(f&&f[1]||"").split("/")}return p.split("/")},this._onHashChange=()=>{const p=this._getCurrentHash();if(p.length>=3&&!p.some(f=>isNaN(f))){const f=this._map.dragRotate.isEnabled()&&this._map.touchZoomRotate.isEnabled()?+(p[3]||0):this._map.getBearing();return this._map.jumpTo({center:[+p[2],+p[1]],zoom:+p[0],bearing:f,pitch:+(p[4]||0)}),!0}return!1},this._updateHashUnthrottled=()=>{const p=window.location.href.replace(/(#.+)?$/,this.getHashString());try{window.history.replaceState(window.history.state,null,p)}catch{}},this._updateHash=Lt(this._updateHashUnthrottled,300),this._hashName=s&&encodeURIComponent(s)}addTo(s){return this._map=s,addEventListener("hashchange",this._onHashChange,!1),this._map.on("moveend",this._updateHash),this}remove(){return removeEventListener("hashchange",this._onHashChange,!1),this._map.off("moveend",this._updateHash),clearTimeout(this._updateHash()),delete this._map,this}getHashString(s){const p=this._map.getCenter(),f=Math.round(100*this._map.getZoom())/100,y=Math.ceil((f*Math.LN2+Math.log(512/360/.5))/Math.LN10),x=Math.pow(10,y),C=Math.round(p.lng*x)/x,M=Math.round(p.lat*x)/x,L=this._map.getBearing(),N=this._map.getPitch();let z="";if(z+=s?`/${C}/${M}/${f}`:`${f}/${M}/${C}`,(L||N)&&(z+="/"+Math.round(10*L)/10),N&&(z+=`/${Math.round(N)}`),this._hashName){const B=this._hashName;let H=!1;const lt=window.location.hash.slice(1).split("&").map(ut=>{const ht=ut.split("=")[0];return ht===B?(H=!0,`${ht}=${z}`):ut}).filter(ut=>ut);return H||lt.push(`${B}=${z}`),`#${lt.join("&")}`}return`#${z}`}}const ge={linearity:.3,easing:a.ba(0,0,.3,1)},We=a.e({deceleration:2500,maxSpeed:1400},ge),En=a.e({deceleration:20,maxSpeed:1400},ge),Rr=a.e({deceleration:1e3,maxSpeed:360},ge),Zn=a.e({deceleration:1e3,maxSpeed:90},ge);class Jn{constructor(s){this._map=s,this.clear()}clear(){this._inertiaBuffer=[]}record(s){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:a.h.now(),settings:s})}_drainInertiaBuffer(){const s=this._inertiaBuffer,p=a.h.now();for(;s.length>0&&p-s[0].time>160;)s.shift()}_onMoveEnd(s){if(this._drainInertiaBuffer(),this._inertiaBuffer.length<2)return;const p={zoom:0,bearing:0,pitch:0,pan:new a.P(0,0),pinchAround:void 0,around:void 0};for(const{settings:x}of this._inertiaBuffer)p.zoom+=x.zoomDelta||0,p.bearing+=x.bearingDelta||0,p.pitch+=x.pitchDelta||0,x.panDelta&&p.pan._add(x.panDelta),x.around&&(p.around=x.around),x.pinchAround&&(p.pinchAround=x.pinchAround);const f=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,y={};if(p.pan.mag()){const x=jn(p.pan.mag(),f,a.e({},We,s||{}));y.offset=p.pan.mult(x.amount/p.pan.mag()),y.center=this._map.transform.center,ui(y,x)}if(p.zoom){const x=jn(p.zoom,f,En);y.zoom=this._map.transform.zoom+x.amount,ui(y,x)}if(p.bearing){const x=jn(p.bearing,f,Rr);y.bearing=this._map.transform.bearing+a.ad(x.amount,-179,179),ui(y,x)}if(p.pitch){const x=jn(p.pitch,f,Zn);y.pitch=this._map.transform.pitch+x.amount,ui(y,x)}if(y.zoom||y.bearing){const x=p.pinchAround===void 0?p.around:p.pinchAround;y.around=x?this._map.unproject(x):this._map.getCenter()}return this.clear(),a.e(y,{noMoveStart:!0})}}function ui(v,s){(!v.duration||v.duration<s.duration)&&(v.duration=s.duration,v.easing=s.easing)}function jn(v,s,p){const{maxSpeed:f,linearity:y,deceleration:x}=p,C=a.ad(v*y/(s/1e3),-f,f),M=Math.abs(C)/(x*y);return{easing:p.easing,duration:1e3*M,amount:C*(M/2)}}class rn extends a.k{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(s,p,f,y={}){const x=_.mousePos(p.getCanvasContainer(),f),C=p.unproject(x);super(s,a.e({point:x,lngLat:C,originalEvent:f},y)),this._defaultPrevented=!1,this.target=p}}class Ro extends a.k{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(s,p,f){const y=s==="touchend"?f.changedTouches:f.touches,x=_.touchPos(p.getCanvasContainer(),y),C=x.map(L=>p.unproject(L)),M=x.reduce((L,N,z,B)=>L.add(N.div(B.length)),new a.P(0,0));super(s,{points:x,point:M,lngLats:C,lngLat:p.unproject(M),originalEvent:f}),this._defaultPrevented=!1}}class ua extends a.k{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(s,p,f){super(s,{originalEvent:f}),this._defaultPrevented=!1}}class eo{constructor(s,p){this._map=s,this._clickTolerance=p.clickTolerance}reset(){delete this._mousedownPos}wheel(s){return this._firePreventable(new ua(s.type,this._map,s))}mousedown(s,p){return this._mousedownPos=p,this._firePreventable(new rn(s.type,this._map,s))}mouseup(s){this._map.fire(new rn(s.type,this._map,s))}click(s,p){this._mousedownPos&&this._mousedownPos.dist(p)>=this._clickTolerance||this._map.fire(new rn(s.type,this._map,s))}dblclick(s){return this._firePreventable(new rn(s.type,this._map,s))}mouseover(s){this._map.fire(new rn(s.type,this._map,s))}mouseout(s){this._map.fire(new rn(s.type,this._map,s))}touchstart(s){return this._firePreventable(new Ro(s.type,this._map,s))}touchmove(s){this._map.fire(new Ro(s.type,this._map,s))}touchend(s){this._map.fire(new Ro(s.type,this._map,s))}touchcancel(s){this._map.fire(new Ro(s.type,this._map,s))}_firePreventable(s){if(this._map.fire(s),s.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class ca{constructor(s){this._map=s}reset(){this._delayContextMenu=!1,this._ignoreContextMenu=!0,delete this._contextMenuEvent}mousemove(s){this._map.fire(new rn(s.type,this._map,s))}mousedown(){this._delayContextMenu=!0,this._ignoreContextMenu=!1}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new rn("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(s){this._delayContextMenu?this._contextMenuEvent=s:this._ignoreContextMenu||this._map.fire(new rn(s.type,this._map,s)),this._map.listens("contextmenu")&&s.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Do{constructor(s){this._map=s}get transform(){return this._map._requestedCameraState||this._map.transform}get center(){return{lng:this.transform.center.lng,lat:this.transform.center.lat}}get zoom(){return this.transform.zoom}get pitch(){return this.transform.pitch}get bearing(){return this.transform.bearing}unproject(s){return this.transform.pointLocation(a.P.convert(s),this._map.terrain)}}class lc{constructor(s,p){this._map=s,this._tr=new Do(s),this._el=s.getCanvasContainer(),this._container=s.getContainer(),this._clickTolerance=p.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(s,p){this.isEnabled()&&s.shiftKey&&s.button===0&&(_.disableDrag(),this._startPos=this._lastPos=p,this._active=!0)}mousemoveWindow(s,p){if(!this._active)return;const f=p;if(this._lastPos.equals(f)||!this._box&&f.dist(this._startPos)<this._clickTolerance)return;const y=this._startPos;this._lastPos=f,this._box||(this._box=_.create("div","maplibregl-boxzoom",this._container),this._container.classList.add("maplibregl-crosshair"),this._fireEvent("boxzoomstart",s));const x=Math.min(y.x,f.x),C=Math.max(y.x,f.x),M=Math.min(y.y,f.y),L=Math.max(y.y,f.y);_.setTransform(this._box,`translate(${x}px,${M}px)`),this._box.style.width=C-x+"px",this._box.style.height=L-M+"px"}mouseupWindow(s,p){if(!this._active||s.button!==0)return;const f=this._startPos,y=p;if(this.reset(),_.suppressClick(),f.x!==y.x||f.y!==y.y)return this._map.fire(new a.k("boxzoomend",{originalEvent:s})),{cameraAnimation:x=>x.fitScreenCoordinates(f,y,this._tr.bearing,{linear:!0})};this._fireEvent("boxzoomcancel",s)}keydown(s){this._active&&s.keyCode===27&&(this.reset(),this._fireEvent("boxzoomcancel",s))}reset(){this._active=!1,this._container.classList.remove("maplibregl-crosshair"),this._box&&(_.remove(this._box),this._box=null),_.enableDrag(),delete this._startPos,delete this._lastPos}_fireEvent(s,p){return this._map.fire(new a.k(s,{originalEvent:p}))}}function zi(v,s){if(v.length!==s.length)throw new Error(`The number of touches and points are not equal - touches ${v.length}, points ${s.length}`);const p={};for(let f=0;f<v.length;f++)p[v[f].identifier]=s[f];return p}class Yo{constructor(s){this.reset(),this.numTouches=s.numTouches}reset(){delete this.centroid,delete this.startTime,delete this.touches,this.aborted=!1}touchstart(s,p,f){(this.centroid||f.length>this.numTouches)&&(this.aborted=!0),this.aborted||(this.startTime===void 0&&(this.startTime=s.timeStamp),f.length===this.numTouches&&(this.centroid=function(y){const x=new a.P(0,0);for(const C of y)x._add(C);return x.div(y.length)}(p),this.touches=zi(f,p)))}touchmove(s,p,f){if(this.aborted||!this.centroid)return;const y=zi(f,p);for(const x in this.touches){const C=y[x];(!C||C.dist(this.touches[x])>30)&&(this.aborted=!0)}}touchend(s,p,f){if((!this.centroid||s.timeStamp-this.startTime>500)&&(this.aborted=!0),f.length===0){const y=!this.aborted&&this.centroid;if(this.reset(),y)return y}}}class uc{constructor(s){this.singleTap=new Yo(s),this.numTaps=s.numTaps,this.reset()}reset(){this.lastTime=1/0,delete this.lastTap,this.count=0,this.singleTap.reset()}touchstart(s,p,f){this.singleTap.touchstart(s,p,f)}touchmove(s,p,f){this.singleTap.touchmove(s,p,f)}touchend(s,p,f){const y=this.singleTap.touchend(s,p,f);if(y){const x=s.timeStamp-this.lastTime<500,C=!this.lastTap||this.lastTap.dist(y)<30;if(x&&C||this.reset(),this.count++,this.lastTime=s.timeStamp,this.lastTap=y,this.count===this.numTaps)return this.reset(),y}}}class La{constructor(s){this._tr=new Do(s),this._zoomIn=new uc({numTouches:1,numTaps:2}),this._zoomOut=new uc({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(s,p,f){this._zoomIn.touchstart(s,p,f),this._zoomOut.touchstart(s,p,f)}touchmove(s,p,f){this._zoomIn.touchmove(s,p,f),this._zoomOut.touchmove(s,p,f)}touchend(s,p,f){const y=this._zoomIn.touchend(s,p,f),x=this._zoomOut.touchend(s,p,f),C=this._tr;return y?(this._active=!0,s.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:M=>M.easeTo({duration:300,zoom:C.zoom+1,around:C.unproject(y)},{originalEvent:s})}):x?(this._active=!0,s.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:M=>M.easeTo({duration:300,zoom:C.zoom-1,around:C.unproject(x)},{originalEvent:s})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Ra{constructor(s){this._enabled=!!s.enable,this._moveStateManager=s.moveStateManager,this._clickTolerance=s.clickTolerance||1,this._moveFunction=s.move,this._activateOnStart=!!s.activateOnStart,s.assignEvents(this),this.reset()}reset(s){this._active=!1,this._moved=!1,delete this._lastPoint,this._moveStateManager.endMove(s)}_move(...s){const p=this._moveFunction(...s);if(p.bearingDelta||p.pitchDelta||p.around||p.panDelta)return this._active=!0,p}dragStart(s,p){this.isEnabled()&&!this._lastPoint&&this._moveStateManager.isValidStartEvent(s)&&(this._moveStateManager.startMove(s),this._lastPoint=p.length?p[0]:p,this._activateOnStart&&this._lastPoint&&(this._active=!0))}dragMove(s,p){if(!this.isEnabled())return;const f=this._lastPoint;if(!f)return;if(s.preventDefault(),!this._moveStateManager.isValidMoveEvent(s))return void this.reset(s);const y=p.length?p[0]:p;return!this._moved&&y.dist(f)<this._clickTolerance?void 0:(this._moved=!0,this._lastPoint=y,this._move(f,y))}dragEnd(s){this.isEnabled()&&this._lastPoint&&this._moveStateManager.isValidEndEvent(s)&&(this._moved&&_.suppressClick(),this.reset(s))}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}getClickTolerance(){return this._clickTolerance}}const yn={0:1,2:2};class nn{constructor(s){this._correctEvent=s.checkCorrectEvent}startMove(s){const p=_.mouseButton(s);this._eventButton=p}endMove(s){delete this._eventButton}isValidStartEvent(s){return this._correctEvent(s)}isValidMoveEvent(s){return!function(p,f){const y=yn[f];return p.buttons===void 0||(p.buttons&y)!==y}(s,this._eventButton)}isValidEndEvent(s){return _.mouseButton(s)===this._eventButton}}class cc{constructor(){this._firstTouch=void 0}_isOneFingerTouch(s){return s.targetTouches.length===1}_isSameTouchEvent(s){return s.targetTouches[0].identifier===this._firstTouch}startMove(s){this._firstTouch=s.targetTouches[0].identifier}endMove(s){delete this._firstTouch}isValidStartEvent(s){return this._isOneFingerTouch(s)}isValidMoveEvent(s){return this._isOneFingerTouch(s)&&this._isSameTouchEvent(s)}isValidEndEvent(s){return this._isOneFingerTouch(s)&&this._isSameTouchEvent(s)}}const ks=v=>{v.mousedown=v.dragStart,v.mousemoveWindow=v.dragMove,v.mouseup=v.dragEnd,v.contextmenu=function(s){s.preventDefault()}},ll=({enable:v,clickTolerance:s,bearingDegreesPerPixelMoved:p=.8})=>{const f=new nn({checkCorrectEvent:y=>_.mouseButton(y)===0&&y.ctrlKey||_.mouseButton(y)===2});return new Ra({clickTolerance:s,move:(y,x)=>({bearingDelta:(x.x-y.x)*p}),moveStateManager:f,enable:v,assignEvents:ks})},ci=({enable:v,clickTolerance:s,pitchDegreesPerPixelMoved:p=-.5})=>{const f=new nn({checkCorrectEvent:y=>_.mouseButton(y)===0&&y.ctrlKey||_.mouseButton(y)===2});return new Ra({clickTolerance:s,move:(y,x)=>({pitchDelta:(x.y-y.y)*p}),moveStateManager:f,enable:v,assignEvents:ks})};class be{constructor(s,p){this._minTouches=s.cooperativeGestures?2:1,this._clickTolerance=s.clickTolerance||1,this._map=p,this.reset()}reset(){this._active=!1,this._touches={},this._sum=new a.P(0,0),setTimeout(()=>{this._cancelCooperativeMessage=!1},200)}touchstart(s,p,f){return this._calculateTransform(s,p,f)}touchmove(s,p,f){if(this._map._cooperativeGestures&&(this._minTouches===2&&f.length<2&&!this._cancelCooperativeMessage?this._map._onCooperativeGesture(s,!1,f.length):this._cancelCooperativeMessage||(this._cancelCooperativeMessage=!0)),this._active&&!(f.length<this._minTouches))return s.preventDefault(),this._calculateTransform(s,p,f)}touchend(s,p,f){this._calculateTransform(s,p,f),this._active&&f.length<this._minTouches&&this.reset()}touchcancel(){this.reset()}_calculateTransform(s,p,f){f.length>0&&(this._active=!0);const y=zi(f,p),x=new a.P(0,0),C=new a.P(0,0);let M=0;for(const N in y){const z=y[N],B=this._touches[N];B&&(x._add(z),C._add(z.sub(B)),M++,y[N]=z)}if(this._touches=y,M<this._minTouches||!C.mag())return;const L=C.div(M);return this._sum._add(L),this._sum.mag()<this._clickTolerance?void 0:{around:x.div(M),panDelta:L}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Os{constructor(){this.reset()}reset(){this._active=!1,delete this._firstTwoTouches}touchstart(s,p,f){this._firstTwoTouches||f.length<2||(this._firstTwoTouches=[f[0].identifier,f[1].identifier],this._start([p[0],p[1]]))}touchmove(s,p,f){if(!this._firstTwoTouches)return;s.preventDefault();const[y,x]=this._firstTwoTouches,C=fs(f,p,y),M=fs(f,p,x);if(!C||!M)return;const L=this._aroundCenter?null:C.add(M).div(2);return this._move([C,M],L,s)}touchend(s,p,f){if(!this._firstTwoTouches)return;const[y,x]=this._firstTwoTouches,C=fs(f,p,y),M=fs(f,p,x);C&&M||(this._active&&_.suppressClick(),this.reset())}touchcancel(){this.reset()}enable(s){this._enabled=!0,this._aroundCenter=!!s&&s.around==="center"}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}function fs(v,s,p){for(let f=0;f<v.length;f++)if(v[f].identifier===p)return s[f]}function Da(v,s){return Math.log(v/s)/Math.LN2}class ql extends Os{reset(){super.reset(),delete this._distance,delete this._startDistance}_start(s){this._startDistance=this._distance=s[0].dist(s[1])}_move(s,p){const f=this._distance;if(this._distance=s[0].dist(s[1]),this._active||!(Math.abs(Da(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:Da(this._distance,f),pinchAround:p}}}function pe(v,s){return 180*v.angleWith(s)/Math.PI}class wh extends Os{reset(){super.reset(),delete this._minDiameter,delete this._startVector,delete this._vector}_start(s){this._startVector=this._vector=s[0].sub(s[1]),this._minDiameter=s[0].dist(s[1])}_move(s,p){const f=this._vector;if(this._vector=s[0].sub(s[1]),this._active||!this._isBelowThreshold(this._vector))return this._active=!0,{bearingDelta:pe(this._vector,f),pinchAround:p}}_isBelowThreshold(s){this._minDiameter=Math.min(this._minDiameter,s.mag());const p=25/(Math.PI*this._minDiameter)*360,f=pe(s,this._startVector);return Math.abs(f)<p}}function Cu(v){return Math.abs(v.y)>Math.abs(v.x)}class mp extends Os{constructor(s){super(),this._map=s}reset(){super.reset(),this._valid=void 0,delete this._firstMove,delete this._lastPoints}touchstart(s,p,f){super.touchstart(s,p,f),this._currentTouchCount=f.length}_start(s){this._lastPoints=s,Cu(s[0].sub(s[1]))&&(this._valid=!1)}_move(s,p,f){if(this._map._cooperativeGestures&&this._currentTouchCount<3)return;const y=s[0].sub(this._lastPoints[0]),x=s[1].sub(this._lastPoints[1]);return this._valid=this.gestureBeginsVertically(y,x,f.timeStamp),this._valid?(this._lastPoints=s,this._active=!0,{pitchDelta:(y.y+x.y)/2*-.5}):void 0}gestureBeginsVertically(s,p,f){if(this._valid!==void 0)return this._valid;const y=s.mag()>=2,x=p.mag()>=2;if(!y&&!x)return;if(!y||!x)return this._firstMove===void 0&&(this._firstMove=f),f-this._firstMove<100&&void 0;const C=s.y>0==p.y>0;return Cu(s)&&Cu(p)&&C}}const Mu={panStep:100,bearingStep:15,pitchStep:10};class hc{constructor(s){this._tr=new Do(s);const p=Mu;this._panStep=p.panStep,this._bearingStep=p.bearingStep,this._pitchStep=p.pitchStep,this._rotationDisabled=!1}reset(){this._active=!1}keydown(s){if(s.altKey||s.ctrlKey||s.metaKey)return;let p=0,f=0,y=0,x=0,C=0;switch(s.keyCode){case 61:case 107:case 171:case 187:p=1;break;case 189:case 109:case 173:p=-1;break;case 37:s.shiftKey?f=-1:(s.preventDefault(),x=-1);break;case 39:s.shiftKey?f=1:(s.preventDefault(),x=1);break;case 38:s.shiftKey?y=1:(s.preventDefault(),C=-1);break;case 40:s.shiftKey?y=-1:(s.preventDefault(),C=1);break;default:return}return this._rotationDisabled&&(f=0,y=0),{cameraAnimation:M=>{const L=this._tr;M.easeTo({duration:300,easeId:"keyboardHandler",easing:gp,zoom:p?Math.round(L.zoom)+p*(s.shiftKey?2:1):L.zoom,bearing:L.bearing+f*this._bearingStep,pitch:L.pitch+y*this._pitchStep,offset:[-x*this._panStep,-C*this._panStep],center:L.center},{originalEvent:s})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function gp(v){return v*(2-v)}const pc=4.000244140625;class Eh{constructor(s,p){this._onTimeout=f=>{this._type="wheel",this._delta-=this._lastValue,this._active||this._start(f)},this._map=s,this._tr=new Do(s),this._el=s.getCanvasContainer(),this._triggerRenderFrame=p,this._delta=0,this._defaultZoomRate=.01,this._wheelZoomRate=.0022222222222222222}setZoomRate(s){this._defaultZoomRate=s}setWheelZoomRate(s){this._wheelZoomRate=s}isEnabled(){return!!this._enabled}isActive(){return!!this._active||this._finishTimeout!==void 0}isZooming(){return!!this._zooming}enable(s){this.isEnabled()||(this._enabled=!0,this._aroundCenter=!!s&&s.around==="center")}disable(){this.isEnabled()&&(this._enabled=!1)}wheel(s){if(!this.isEnabled())return;if(this._map._cooperativeGestures){if(!s[this._map._metaKey])return;s.preventDefault()}let p=s.deltaMode===WheelEvent.DOM_DELTA_LINE?40*s.deltaY:s.deltaY;const f=a.h.now(),y=f-(this._lastWheelEventTime||0);this._lastWheelEventTime=f,p!==0&&p%pc==0?this._type="wheel":p!==0&&Math.abs(p)<4?this._type="trackpad":y>400?(this._type=null,this._lastValue=p,this._timeout=setTimeout(this._onTimeout,40,s)):this._type||(this._type=Math.abs(y*p)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,p+=this._lastValue)),s.shiftKey&&p&&(p/=4),this._type&&(this._lastWheelEvent=s,this._delta-=p,this._active||this._start(s)),s.preventDefault()}_start(s){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);const p=_.mousePos(this._el,s),f=this._tr;this._around=a.L.convert(this._aroundCenter?f.center:f.unproject(p)),this._aroundPoint=f.transform.locationPoint(this._around),this._frameId||(this._frameId=!0,this._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;const s=this._tr.transform;if(this._delta!==0){const M=this._type==="wheel"&&Math.abs(this._delta)>pc?this._wheelZoomRate:this._defaultZoomRate;let L=2/(1+Math.exp(-Math.abs(this._delta*M)));this._delta<0&&L!==0&&(L=1/L);const N=typeof this._targetZoom=="number"?s.zoomScale(this._targetZoom):s.scale;this._targetZoom=Math.min(s.maxZoom,Math.max(s.minZoom,s.scaleZoom(N*L))),this._type==="wheel"&&(this._startZoom=s.zoom,this._easing=this._smoothOutEasing(200)),this._delta=0}const p=typeof this._targetZoom=="number"?this._targetZoom:s.zoom,f=this._startZoom,y=this._easing;let x,C=!1;if(this._type==="wheel"&&f&&y){const M=Math.min((a.h.now()-this._lastWheelEventTime)/200,1),L=y(M);x=a.B.number(f,p,L),M<1?this._frameId||(this._frameId=!0):C=!0}else x=p,C=!0;return this._active=!0,C&&(this._active=!1,this._finishTimeout=setTimeout(()=>{this._zooming=!1,this._triggerRenderFrame(),delete this._targetZoom,delete this._finishTimeout},200)),{noInertia:!0,needsRenderFrame:!C,zoomDelta:x-s.zoom,around:this._aroundPoint,originalEvent:this._lastWheelEvent}}_smoothOutEasing(s){let p=a.bb;if(this._prevEase){const f=this._prevEase,y=(a.h.now()-f.start)/f.duration,x=f.easing(y+.01)-f.easing(y),C=.27/Math.sqrt(x*x+1e-4)*.01,M=Math.sqrt(.0729-C*C);p=a.ba(C,M,.25,1)}return this._prevEase={start:a.h.now(),duration:s,easing:p},p}reset(){this._active=!1,this._zooming=!1,delete this._targetZoom,this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout)}}class Tf{constructor(s,p){this._clickZoom=s,this._tapZoom=p}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class If{constructor(s){this._tr=new Do(s),this.reset()}reset(){this._active=!1}dblclick(s,p){return s.preventDefault(),{cameraAnimation:f=>{f.easeTo({duration:300,zoom:this._tr.zoom+(s.shiftKey?-1:1),around:this._tr.unproject(p)},{originalEvent:s})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Cf{constructor(){this._tap=new uc({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,delete this._swipePoint,delete this._swipeTouch,delete this._tapTime,delete this._tapPoint,this._tap.reset()}touchstart(s,p,f){if(!this._swipePoint)if(this._tapTime){const y=p[0],x=s.timeStamp-this._tapTime<500,C=this._tapPoint.dist(y)<30;x&&C?f.length>0&&(this._swipePoint=y,this._swipeTouch=f[0].identifier):this.reset()}else this._tap.touchstart(s,p,f)}touchmove(s,p,f){if(this._tapTime){if(this._swipePoint){if(f[0].identifier!==this._swipeTouch)return;const y=p[0],x=y.y-this._swipePoint.y;return this._swipePoint=y,s.preventDefault(),this._active=!0,{zoomDelta:x/128}}}else this._tap.touchmove(s,p,f)}touchend(s,p,f){if(this._tapTime)this._swipePoint&&f.length===0&&this.reset();else{const y=this._tap.touchend(s,p,f);y&&(this._tapTime=s.timeStamp,this._tapPoint=y)}}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Mf{constructor(s,p,f){this._el=s,this._mousePan=p,this._touchPan=f}enable(s){this._inertiaOptions=s||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("maplibregl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("maplibregl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class ms{constructor(s,p,f){this._pitchWithRotate=s.pitchWithRotate,this._mouseRotate=p,this._mousePitch=f}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()}}class Pu{constructor(s,p,f,y){this._el=s,this._touchZoom=p,this._touchRotate=f,this._tapDragZoom=y,this._rotationDisabled=!1,this._enabled=!0}enable(s){this._touchZoom.enable(s),this._rotationDisabled||this._touchRotate.enable(s),this._tapDragZoom.enable(),this._el.classList.add("maplibregl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("maplibregl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}const yp=v=>v.zoom||v.drag||v.pitch||v.rotate;class Pf extends a.k{}function _p(v){return v.panDelta&&v.panDelta.mag()||v.zoomDelta||v.bearingDelta||v.pitchDelta}class Af{constructor(s,p){this.handleWindowEvent=y=>{this.handleEvent(y,`${y.type}Window`)},this.handleEvent=(y,x)=>{if(y.type==="blur")return void this.stop(!0);this._updatingCamera=!0;const C=y.type==="renderFrame"?void 0:y,M={needsRenderFrame:!1},L={},N={},z=y.touches,B=z?this._getMapTouches(z):void 0,H=B?_.touchPos(this._el,B):_.mousePos(this._el,y);for(const{handlerName:ht,handler:st,allowed:Mt}of this._handlers){if(!st.isEnabled())continue;let Ft;this._blockedByActive(N,Mt,ht)?st.reset():st[x||y.type]&&(Ft=st[x||y.type](y,H,B),this.mergeHandlerResult(M,L,Ft,ht,C),Ft&&Ft.needsRenderFrame&&this._triggerRenderFrame()),(Ft||st.isActive())&&(N[ht]=st)}const lt={};for(const ht in this._previousActiveHandlers)N[ht]||(lt[ht]=C);this._previousActiveHandlers=N,(Object.keys(lt).length||_p(M))&&(this._changes.push([M,L,lt]),this._triggerRenderFrame()),(Object.keys(N).length||_p(M))&&this._map._stop(!0),this._updatingCamera=!1;const{cameraAnimation:ut}=M;ut&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],ut(this._map))},this._map=s,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new Jn(s),this._bearingSnap=p.bearingSnap,this._previousActiveHandlers={},this._eventsInProgress={},this._addDefaultHandlers(p);const f=this._el;this._listeners=[[f,"touchstart",{passive:!0}],[f,"touchmove",{passive:!1}],[f,"touchend",void 0],[f,"touchcancel",void 0],[f,"mousedown",void 0],[f,"mousemove",void 0],[f,"mouseup",void 0],[document,"mousemove",{capture:!0}],[document,"mouseup",void 0],[f,"mouseover",void 0],[f,"mouseout",void 0],[f,"dblclick",void 0],[f,"click",void 0],[f,"keydown",{capture:!1}],[f,"keyup",void 0],[f,"wheel",{passive:!1}],[f,"contextmenu",void 0],[window,"blur",void 0]];for(const[y,x,C]of this._listeners)_.addEventListener(y,x,y===document?this.handleWindowEvent:this.handleEvent,C)}destroy(){for(const[s,p,f]of this._listeners)_.removeEventListener(s,p,s===document?this.handleWindowEvent:this.handleEvent,f)}_addDefaultHandlers(s){const p=this._map,f=p.getCanvasContainer();this._add("mapEvent",new eo(p,s));const y=p.boxZoom=new lc(p,s);this._add("boxZoom",y),s.interactive&&s.boxZoom&&y.enable();const x=new La(p),C=new If(p);p.doubleClickZoom=new Tf(C,x),this._add("tapZoom",x),this._add("clickZoom",C),s.interactive&&s.doubleClickZoom&&p.doubleClickZoom.enable();const M=new Cf;this._add("tapDragZoom",M);const L=p.touchPitch=new mp(p);this._add("touchPitch",L),s.interactive&&s.touchPitch&&p.touchPitch.enable(s.touchPitch);const N=ll(s),z=ci(s);p.dragRotate=new ms(s,N,z),this._add("mouseRotate",N,["mousePitch"]),this._add("mousePitch",z,["mouseRotate"]),s.interactive&&s.dragRotate&&p.dragRotate.enable();const B=(({enable:Mt,clickTolerance:Ft})=>{const yt=new nn({checkCorrectEvent:Pt=>_.mouseButton(Pt)===0&&!Pt.ctrlKey});return new Ra({clickTolerance:Ft,move:(Pt,Vt)=>({around:Vt,panDelta:Vt.sub(Pt)}),activateOnStart:!0,moveStateManager:yt,enable:Mt,assignEvents:ks})})(s),H=new be(s,p);p.dragPan=new Mf(f,B,H),this._add("mousePan",B),this._add("touchPan",H,["touchZoom","touchRotate"]),s.interactive&&s.dragPan&&p.dragPan.enable(s.dragPan);const lt=new wh,ut=new ql;p.touchZoomRotate=new Pu(f,ut,lt,M),this._add("touchRotate",lt,["touchPan","touchZoom"]),this._add("touchZoom",ut,["touchPan","touchRotate"]),s.interactive&&s.touchZoomRotate&&p.touchZoomRotate.enable(s.touchZoomRotate);const ht=p.scrollZoom=new Eh(p,()=>this._triggerRenderFrame());this._add("scrollZoom",ht,["mousePan"]),s.interactive&&s.scrollZoom&&p.scrollZoom.enable(s.scrollZoom);const st=p.keyboard=new hc(p);this._add("keyboard",st),s.interactive&&s.keyboard&&p.keyboard.enable(),this._add("blockableMapEvent",new ca(p))}_add(s,p,f){this._handlers.push({handlerName:s,handler:p,allowed:f}),this._handlersById[s]=p}stop(s){if(!this._updatingCamera){for(const{handler:p}of this._handlers)p.reset();this._inertia.clear(),this._fireEvents({},{},s),this._changes=[]}}isActive(){for(const{handler:s}of this._handlers)if(s.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return!!yp(this._eventsInProgress)||this.isZooming()}_blockedByActive(s,p,f){for(const y in s)if(y!==f&&(!p||p.indexOf(y)<0))return!0;return!1}_getMapTouches(s){const p=[];for(const f of s)this._el.contains(f.target)&&p.push(f);return p}mergeHandlerResult(s,p,f,y,x){if(!f)return;a.e(s,f);const C={handlerName:y,originalEvent:f.originalEvent||x};f.zoomDelta!==void 0&&(p.zoom=C),f.panDelta!==void 0&&(p.drag=C),f.pitchDelta!==void 0&&(p.pitch=C),f.bearingDelta!==void 0&&(p.rotate=C)}_applyChanges(){const s={},p={},f={};for(const[y,x,C]of this._changes)y.panDelta&&(s.panDelta=(s.panDelta||new a.P(0,0))._add(y.panDelta)),y.zoomDelta&&(s.zoomDelta=(s.zoomDelta||0)+y.zoomDelta),y.bearingDelta&&(s.bearingDelta=(s.bearingDelta||0)+y.bearingDelta),y.pitchDelta&&(s.pitchDelta=(s.pitchDelta||0)+y.pitchDelta),y.around!==void 0&&(s.around=y.around),y.pinchAround!==void 0&&(s.pinchAround=y.pinchAround),y.noInertia&&(s.noInertia=y.noInertia),a.e(p,x),a.e(f,C);this._updateMapTransform(s,p,f),this._changes=[]}_updateMapTransform(s,p,f){const y=this._map,x=y._getTransformForUpdate(),C=y.terrain;if(!(_p(s)||C&&this._terrainMovement))return this._fireEvents(p,f,!0);let{panDelta:M,zoomDelta:L,bearingDelta:N,pitchDelta:z,around:B,pinchAround:H}=s;H!==void 0&&(B=H),y._stop(!0),B=B||y.transform.centerPoint;const lt=x.pointLocation(M?B.sub(M):B);N&&(x.bearing+=N),z&&(x.pitch+=z),L&&(x.zoom+=L),C?this._terrainMovement||!p.drag&&!p.zoom?p.drag&&this._terrainMovement?x.center=x.pointLocation(x.centerPoint.sub(M)):x.setLocationAtPoint(lt,B):(this._terrainMovement=!0,this._map._elevationFreeze=!0,x.setLocationAtPoint(lt,B),this._map.once("moveend",()=>{this._map._elevationFreeze=!1,this._terrainMovement=!1,x.recalculateZoom(y.terrain)})):x.setLocationAtPoint(lt,B),y._applyUpdatedTransform(x),this._map._update(),s.noInertia||this._inertia.record(s),this._fireEvents(p,f,!0)}_fireEvents(s,p,f){const y=yp(this._eventsInProgress),x=yp(s),C={};for(const z in s){const{originalEvent:B}=s[z];this._eventsInProgress[z]||(C[`${z}start`]=B),this._eventsInProgress[z]=s[z]}!y&&x&&this._fireEvent("movestart",x.originalEvent);for(const z in C)this._fireEvent(z,C[z]);x&&this._fireEvent("move",x.originalEvent);for(const z in s){const{originalEvent:B}=s[z];this._fireEvent(z,B)}const M={};let L;for(const z in this._eventsInProgress){const{handlerName:B,originalEvent:H}=this._eventsInProgress[z];this._handlersById[B].isActive()||(delete this._eventsInProgress[z],L=p[B]||H,M[`${z}end`]=L)}for(const z in M)this._fireEvent(z,M[z]);const N=yp(this._eventsInProgress);if(f&&(y||x)&&!N){this._updatingCamera=!0;const z=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),B=H=>H!==0&&-this._bearingSnap<H&&H<this._bearingSnap;!z||!z.essential&&a.h.prefersReducedMotion?(this._map.fire(new a.k("moveend",{originalEvent:L})),B(this._map.getBearing())&&this._map.resetNorth()):(B(z.bearing||this._map.getBearing())&&(z.bearing=0),z.freezeElevation=!0,this._map.easeTo(z,{originalEvent:L})),this._updatingCamera=!1}}_fireEvent(s,p){this._map.fire(new a.k(s,p?{originalEvent:p}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add(s=>{delete this._frameId,this.handleEvent(new Pf("renderFrame",{timeStamp:s})),this._applyChanges()})}_triggerRenderFrame(){this._frameId===void 0&&(this._frameId=this._requestFrame())}}class Pg extends a.E{constructor(s,p){super(),this._renderFrameCallback=()=>{const f=Math.min((a.h.now()-this._easeStart)/this._easeOptions.duration,1);this._onEaseFrame(this._easeOptions.easing(f)),f<1&&this._easeFrameId?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()},this._moving=!1,this._zooming=!1,this.transform=s,this._bearingSnap=p.bearingSnap,this.on("moveend",()=>{delete this._requestedCameraState})}getCenter(){return new a.L(this.transform.center.lng,this.transform.center.lat)}setCenter(s,p){return this.jumpTo({center:s},p)}panBy(s,p,f){return s=a.P.convert(s).mult(-1),this.panTo(this.transform.center,a.e({offset:s},p),f)}panTo(s,p,f){return this.easeTo(a.e({center:s},p),f)}getZoom(){return this.transform.zoom}setZoom(s,p){return this.jumpTo({zoom:s},p),this}zoomTo(s,p,f){return this.easeTo(a.e({zoom:s},p),f)}zoomIn(s,p){return this.zoomTo(this.getZoom()+1,s,p),this}zoomOut(s,p){return this.zoomTo(this.getZoom()-1,s,p),this}getBearing(){return this.transform.bearing}setBearing(s,p){return this.jumpTo({bearing:s},p),this}getPadding(){return this.transform.padding}setPadding(s,p){return this.jumpTo({padding:s},p),this}rotateTo(s,p,f){return this.easeTo(a.e({bearing:s},p),f)}resetNorth(s,p){return this.rotateTo(0,a.e({duration:1e3},s),p),this}resetNorthPitch(s,p){return this.easeTo(a.e({bearing:0,pitch:0,duration:1e3},s),p),this}snapToNorth(s,p){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(s,p):this}getPitch(){return this.transform.pitch}setPitch(s,p){return this.jumpTo({pitch:s},p),this}cameraForBounds(s,p){s=ue.convert(s);const f=p&&p.bearing||0;return this._cameraForBoxAndBearing(s.getNorthWest(),s.getSouthEast(),f,p)}_cameraForBoxAndBearing(s,p,f,y){const x={top:0,bottom:0,right:0,left:0};if(typeof(y=a.e({padding:x,offset:[0,0],maxZoom:this.transform.maxZoom},y)).padding=="number"){const Vt=y.padding;y.padding={top:Vt,bottom:Vt,right:Vt,left:Vt}}y.padding=a.e(x,y.padding);const C=this.transform,M=C.padding,L=C.project(a.L.convert(s)),N=C.project(a.L.convert(p)),z=L.rotate(-f*Math.PI/180),B=N.rotate(-f*Math.PI/180),H=new a.P(Math.max(z.x,B.x),Math.max(z.y,B.y)),lt=new a.P(Math.min(z.x,B.x),Math.min(z.y,B.y)),ut=H.sub(lt),ht=(C.width-(M.left+M.right+y.padding.left+y.padding.right))/ut.x,st=(C.height-(M.top+M.bottom+y.padding.top+y.padding.bottom))/ut.y;if(st<0||ht<0)return void a.w("Map cannot fit within canvas with the given bounds, padding, and/or offset.");const Mt=Math.min(C.scaleZoom(C.scale*Math.min(ht,st)),y.maxZoom),Ft=a.P.convert(y.offset),yt=new a.P((y.padding.left-y.padding.right)/2,(y.padding.top-y.padding.bottom)/2).rotate(f*Math.PI/180),Pt=Ft.add(yt).mult(C.scale/C.zoomScale(Mt));return{center:C.unproject(L.add(N).div(2).sub(Pt)),zoom:Mt,bearing:f}}fitBounds(s,p,f){return this._fitInternal(this.cameraForBounds(s,p),p,f)}fitScreenCoordinates(s,p,f,y,x){return this._fitInternal(this._cameraForBoxAndBearing(this.transform.pointLocation(a.P.convert(s)),this.transform.pointLocation(a.P.convert(p)),f,y),y,x)}_fitInternal(s,p,f){return s?(delete(p=a.e(s,p)).padding,p.linear?this.easeTo(p,f):this.flyTo(p,f)):this}jumpTo(s,p){this.stop();const f=this._getTransformForUpdate();let y=!1,x=!1,C=!1;return"zoom"in s&&f.zoom!==+s.zoom&&(y=!0,f.zoom=+s.zoom),s.center!==void 0&&(f.center=a.L.convert(s.center)),"bearing"in s&&f.bearing!==+s.bearing&&(x=!0,f.bearing=+s.bearing),"pitch"in s&&f.pitch!==+s.pitch&&(C=!0,f.pitch=+s.pitch),s.padding==null||f.isPaddingEqual(s.padding)||(f.padding=s.padding),this._applyUpdatedTransform(f),this.fire(new a.k("movestart",p)).fire(new a.k("move",p)),y&&this.fire(new a.k("zoomstart",p)).fire(new a.k("zoom",p)).fire(new a.k("zoomend",p)),x&&this.fire(new a.k("rotatestart",p)).fire(new a.k("rotate",p)).fire(new a.k("rotateend",p)),C&&this.fire(new a.k("pitchstart",p)).fire(new a.k("pitch",p)).fire(new a.k("pitchend",p)),this.fire(new a.k("moveend",p))}calculateCameraOptionsFromTo(s,p,f,y=0){const x=a.U.fromLngLat(s,p),C=a.U.fromLngLat(f,y),M=C.x-x.x,L=C.y-x.y,N=C.z-x.z,z=Math.hypot(M,L,N);if(z===0)throw new Error("Can't calculate camera options with same From and To");const B=Math.hypot(M,L),H=this.transform.scaleZoom(this.transform.cameraToCenterDistance/z/this.transform.tileSize),lt=180*Math.atan2(M,-L)/Math.PI;let ut=180*Math.acos(B/z)/Math.PI;return ut=N<0?90-ut:90+ut,{center:C.toLngLat(),zoom:H,pitch:ut,bearing:lt}}easeTo(s,p){this._stop(!1,s.easeId),((s=a.e({offset:[0,0],duration:500,easing:a.bb},s)).animate===!1||!s.essential&&a.h.prefersReducedMotion)&&(s.duration=0);const f=this._getTransformForUpdate(),y=this.getZoom(),x=this.getBearing(),C=this.getPitch(),M=this.getPadding(),L="zoom"in s?+s.zoom:y,N="bearing"in s?this._normalizeBearing(s.bearing,x):x,z="pitch"in s?+s.pitch:C,B="padding"in s?s.padding:f.padding,H=a.P.convert(s.offset);let lt=f.centerPoint.add(H);const ut=f.pointLocation(lt),ht=a.L.convert(s.center||ut);this._normalizeCenter(ht);const st=f.project(ut),Mt=f.project(ht).sub(st),Ft=f.zoomScale(L-y);let yt,Pt;s.around&&(yt=a.L.convert(s.around),Pt=f.locationPoint(yt));const Vt={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=this._zooming||L!==y,this._rotating=this._rotating||x!==N,this._pitching=this._pitching||z!==C,this._padding=!f.isPaddingEqual(B),this._easeId=s.easeId,this._prepareEase(p,s.noMoveStart,Vt),this.terrain&&this._prepareElevation(ht),this._ease(qt=>{if(this._zooming&&(f.zoom=a.B.number(y,L,qt)),this._rotating&&(f.bearing=a.B.number(x,N,qt)),this._pitching&&(f.pitch=a.B.number(C,z,qt)),this._padding&&(f.interpolatePadding(M,B,qt),lt=f.centerPoint.add(H)),this.terrain&&!s.freezeElevation&&this._updateElevation(qt),yt)f.setLocationAtPoint(yt,Pt);else{const Yt=f.zoomScale(f.zoom-y),ne=L>y?Math.min(2,Ft):Math.max(.5,Ft),Qt=Math.pow(ne,1-qt),le=f.unproject(st.add(Mt.mult(qt*Qt)).mult(Yt));f.setLocationAtPoint(f.renderWorldCopies?le.wrap():le,lt)}this._applyUpdatedTransform(f),this._fireMoveEvents(p)},qt=>{this.terrain&&this._finalizeElevation(),this._afterEase(p,qt)},s),this}_prepareEase(s,p,f={}){this._moving=!0,p||f.moving||this.fire(new a.k("movestart",s)),this._zooming&&!f.zooming&&this.fire(new a.k("zoomstart",s)),this._rotating&&!f.rotating&&this.fire(new a.k("rotatestart",s)),this._pitching&&!f.pitching&&this.fire(new a.k("pitchstart",s))}_prepareElevation(s){this._elevationCenter=s,this._elevationStart=this.transform.elevation,this._elevationTarget=this.terrain.getElevationForLngLatZoom(s,this.transform.tileZoom),this._elevationFreeze=!0}_updateElevation(s){this.transform._minEleveationForCurrentTile=this.terrain.getMinTileElevationForLngLatZoom(this._elevationCenter,this.transform.tileZoom);const p=this.terrain.getElevationForLngLatZoom(this._elevationCenter,this.transform.tileZoom);if(s<1&&p!==this._elevationTarget){const f=this._elevationTarget-this._elevationStart;this._elevationStart+=s*(f-(p-(f*s+this._elevationStart))/(1-s)),this._elevationTarget=p}this.transform.elevation=a.B.number(this._elevationStart,this._elevationTarget,s)}_finalizeElevation(){this._elevationFreeze=!1,this.transform.recalculateZoom(this.terrain)}_getTransformForUpdate(){return this.transformCameraUpdate?(this._requestedCameraState||(this._requestedCameraState=this.transform.clone()),this._requestedCameraState):this.transform}_applyUpdatedTransform(s){if(!this.transformCameraUpdate)return;const p=s.clone(),{center:f,zoom:y,pitch:x,bearing:C,elevation:M}=this.transformCameraUpdate(p);f&&(p.center=f),y!==void 0&&(p.zoom=y),x!==void 0&&(p.pitch=x),C!==void 0&&(p.bearing=C),M!==void 0&&(p.elevation=M),this.transform.apply(p)}_fireMoveEvents(s){this.fire(new a.k("move",s)),this._zooming&&this.fire(new a.k("zoom",s)),this._rotating&&this.fire(new a.k("rotate",s)),this._pitching&&this.fire(new a.k("pitch",s))}_afterEase(s,p){if(this._easeId&&p&&this._easeId===p)return;delete this._easeId;const f=this._zooming,y=this._rotating,x=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,f&&this.fire(new a.k("zoomend",s)),y&&this.fire(new a.k("rotateend",s)),x&&this.fire(new a.k("pitchend",s)),this.fire(new a.k("moveend",s))}flyTo(s,p){if(!s.essential&&a.h.prefersReducedMotion){const Fe=a.F(s,["center","zoom","bearing","pitch","around"]);return this.jumpTo(Fe,p)}this.stop(),s=a.e({offset:[0,0],speed:1.2,curve:1.42,easing:a.bb},s);const f=this._getTransformForUpdate(),y=this.getZoom(),x=this.getBearing(),C=this.getPitch(),M=this.getPadding(),L="zoom"in s?a.ad(+s.zoom,f.minZoom,f.maxZoom):y,N="bearing"in s?this._normalizeBearing(s.bearing,x):x,z="pitch"in s?+s.pitch:C,B="padding"in s?s.padding:f.padding,H=f.zoomScale(L-y),lt=a.P.convert(s.offset);let ut=f.centerPoint.add(lt);const ht=f.pointLocation(ut),st=a.L.convert(s.center||ht);this._normalizeCenter(st);const Mt=f.project(ht),Ft=f.project(st).sub(Mt);let yt=s.curve;const Pt=Math.max(f.width,f.height),Vt=Pt/H,qt=Ft.mag();if("minZoom"in s){const Fe=a.ad(Math.min(s.minZoom,y,L),f.minZoom,f.maxZoom),mn=Pt/f.zoomScale(Fe-y);yt=Math.sqrt(mn/qt*2)}const Yt=yt*yt;function ne(Fe){const mn=(Vt*Vt-Pt*Pt+(Fe?-1:1)*Yt*Yt*qt*qt)/(2*(Fe?Vt:Pt)*Yt*qt);return Math.log(Math.sqrt(mn*mn+1)-mn)}function Qt(Fe){return(Math.exp(Fe)-Math.exp(-Fe))/2}function le(Fe){return(Math.exp(Fe)+Math.exp(-Fe))/2}const ke=ne(!1);let Mr=function(Fe){return le(ke)/le(ke+yt*Fe)},ve=function(Fe){return Pt*((le(ke)*(Qt(mn=ke+yt*Fe)/le(mn))-Qt(ke))/Yt)/qt;var mn},Je=(ne(!0)-ke)/yt;if(Math.abs(qt)<1e-6||!isFinite(Je)){if(Math.abs(Pt-Vt)<1e-6)return this.easeTo(s,p);const Fe=Vt<Pt?-1:1;Je=Math.abs(Math.log(Vt/Pt))/yt,ve=function(){return 0},Mr=function(mn){return Math.exp(Fe*yt*mn)}}return s.duration="duration"in s?+s.duration:1e3*Je/("screenSpeed"in s?+s.screenSpeed/yt:+s.speed),s.maxDuration&&s.duration>s.maxDuration&&(s.duration=0),this._zooming=!0,this._rotating=x!==N,this._pitching=z!==C,this._padding=!f.isPaddingEqual(B),this._prepareEase(p,!1),this.terrain&&this._prepareElevation(st),this._ease(Fe=>{const mn=Fe*Je,Ir=1/Mr(mn);f.zoom=Fe===1?L:y+f.scaleZoom(Ir),this._rotating&&(f.bearing=a.B.number(x,N,Fe)),this._pitching&&(f.pitch=a.B.number(C,z,Fe)),this._padding&&(f.interpolatePadding(M,B,Fe),ut=f.centerPoint.add(lt)),this.terrain&&!s.freezeElevation&&this._updateElevation(Fe);const mr=Fe===1?st:f.unproject(Mt.add(Ft.mult(ve(mn))).mult(Ir));f.setLocationAtPoint(f.renderWorldCopies?mr.wrap():mr,ut),this._applyUpdatedTransform(f),this._fireMoveEvents(p)},()=>{this.terrain&&this._finalizeElevation(),this._afterEase(p)},s),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_stop(s,p){if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),delete this._easeFrameId,delete this._onEaseFrame),this._onEaseEnd){const f=this._onEaseEnd;delete this._onEaseEnd,f.call(this,p)}if(!s){const f=this.handlers;f&&f.stop(!1)}return this}_ease(s,p,f){f.animate===!1||f.duration===0?(s(1),p()):(this._easeStart=a.h.now(),this._easeOptions=f,this._onEaseFrame=s,this._onEaseEnd=p,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_normalizeBearing(s,p){s=a.b5(s,-180,180);const f=Math.abs(s-p);return Math.abs(s-360-p)<f&&(s-=360),Math.abs(s+360-p)<f&&(s+=360),s}_normalizeCenter(s){const p=this.transform;if(!p.renderWorldCopies||p.lngRange)return;const f=s.lng-p.center.lng;s.lng+=f>180?-360:f<-180?360:0}queryTerrainElevation(s){return this.terrain?this.terrain.getElevationForLngLatZoom(a.L.convert(s),this.transform.tileZoom)-this.transform.elevation:null}}class Fs{constructor(s={}){this._toggleAttribution=()=>{this._container.classList.contains("maplibregl-compact")&&(this._container.classList.contains("maplibregl-compact-show")?(this._container.setAttribute("open",""),this._container.classList.remove("maplibregl-compact-show")):(this._container.classList.add("maplibregl-compact-show"),this._container.removeAttribute("open")))},this._updateData=p=>{!p||p.sourceDataType!=="metadata"&&p.sourceDataType!=="visibility"&&p.dataType!=="style"&&p.type!=="terrain"||this._updateAttributions()},this._updateCompact=()=>{this._map.getCanvasContainer().offsetWidth<=640||this._compact?this._compact===!1?this._container.setAttribute("open",""):this._container.classList.contains("maplibregl-compact")||this._container.classList.contains("maplibregl-attrib-empty")||(this._container.setAttribute("open",""),this._container.classList.add("maplibregl-compact","maplibregl-compact-show")):(this._container.setAttribute("open",""),this._container.classList.contains("maplibregl-compact")&&this._container.classList.remove("maplibregl-compact","maplibregl-compact-show"))},this._updateCompactMinimize=()=>{this._container.classList.contains("maplibregl-compact")&&this._container.classList.contains("maplibregl-compact-show")&&this._container.classList.remove("maplibregl-compact-show")},this.options=s}getDefaultPosition(){return"bottom-right"}onAdd(s){return this._map=s,this._compact=this.options&&this.options.compact,this._container=_.create("details","maplibregl-ctrl maplibregl-ctrl-attrib"),this._compactButton=_.create("summary","maplibregl-ctrl-attrib-button",this._container),this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=_.create("div","maplibregl-ctrl-attrib-inner",this._container),this._updateAttributions(),this._updateCompact(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("terrain",this._updateData),this._map.on("resize",this._updateCompact),this._map.on("drag",this._updateCompactMinimize),this._container}onRemove(){_.remove(this._container),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("terrain",this._updateData),this._map.off("resize",this._updateCompact),this._map.off("drag",this._updateCompactMinimize),this._map=void 0,this._compact=void 0,this._attribHTML=void 0}_setElementTitle(s,p){const f=this._map._getUIString(`AttributionControl.${p}`);s.title=f,s.setAttribute("aria-label",f)}_updateAttributions(){if(!this._map.style)return;let s=[];if(this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?s=s.concat(this.options.customAttribution.map(y=>typeof y!="string"?"":y)):typeof this.options.customAttribution=="string"&&s.push(this.options.customAttribution)),this._map.style.stylesheet){const y=this._map.style.stylesheet;this.styleOwner=y.owner,this.styleId=y.id}const p=this._map.style.sourceCaches;for(const y in p){const x=p[y];if(x.used||x.usedForTerrain){const C=x.getSource();C.attribution&&s.indexOf(C.attribution)<0&&s.push(C.attribution)}}s=s.filter(y=>String(y).trim()),s.sort((y,x)=>y.length-x.length),s=s.filter((y,x)=>{for(let C=x+1;C<s.length;C++)if(s[C].indexOf(y)>=0)return!1;return!0});const f=s.join(" | ");f!==this._attribHTML&&(this._attribHTML=f,s.length?(this._innerContainer.innerHTML=f,this._container.classList.remove("maplibregl-attrib-empty")):this._container.classList.add("maplibregl-attrib-empty"),this._updateCompact(),this._editLink=null)}}class On{constructor(s={}){this._updateCompact=()=>{const p=this._container.children;if(p.length){const f=p[0];this._map.getCanvasContainer().offsetWidth<=640||this._compact?this._compact!==!1&&f.classList.add("maplibregl-compact"):f.classList.remove("maplibregl-compact")}},this.options=s}getDefaultPosition(){return"bottom-left"}onAdd(s){this._map=s,this._compact=this.options&&this.options.compact,this._container=_.create("div","maplibregl-ctrl");const p=_.create("a","maplibregl-ctrl-logo");return p.target="_blank",p.rel="noopener nofollow",p.href="https://maplibre.org/",p.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),p.setAttribute("rel","noopener nofollow"),this._container.appendChild(p),this._container.style.display="block",this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){_.remove(this._container),this._map.off("resize",this._updateCompact),this._map=void 0,this._compact=void 0}}class ud{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(s){const p=++this._id;return this._queue.push({callback:s,id:p,cancelled:!1}),p}remove(s){const p=this._currentlyRunning,f=p?this._queue.concat(p):this._queue;for(const y of f)if(y.id===s)return void(y.cancelled=!0)}run(s=0){if(this._currentlyRunning)throw new Error("Attempting to run(), but is already running.");const p=this._currentlyRunning=this._queue;this._queue=[];for(const f of p)if(!f.cancelled&&(f.callback(s),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}const Lf={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"Mapbox logo","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","ScaleControl.Feet":"ft","ScaleControl.Meters":"m","ScaleControl.Kilometers":"km","ScaleControl.Miles":"mi","ScaleControl.NauticalMiles":"nm","TerrainControl.enableTerrain":"Enable terrain","TerrainControl.disableTerrain":"Disable terrain"};var Ag=a.Q([{name:"a_pos3d",type:"Int16",components:3}]);class Lg extends a.E{constructor(s){super(),this.sourceCache=s,this._tiles={},this._renderableTilesKeys=[],this._sourceTileCache={},this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.deltaZoom=1,s.usedForTerrain=!0,s.tileSize=this.tileSize*2**this.deltaZoom}destruct(){this.sourceCache.usedForTerrain=!1,this.sourceCache.tileSize=null}update(s,p){this.sourceCache.update(s,p),this._renderableTilesKeys=[];const f={};for(const y of s.coveringTiles({tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,reparseOverscaled:!1,terrain:p}))f[y.key]=!0,this._renderableTilesKeys.push(y.key),this._tiles[y.key]||(y.posMatrix=new Float64Array(16),a.aS(y.posMatrix,0,a.N,0,a.N,0,1),this._tiles[y.key]=new _i(y,this.tileSize));for(const y in this._tiles)f[y]||delete this._tiles[y]}freeRtt(s){for(const p in this._tiles){const f=this._tiles[p];(!s||f.tileID.equals(s)||f.tileID.isChildOf(s)||s.isChildOf(f.tileID))&&(f.rtt=[])}}getRenderableTiles(){return this._renderableTilesKeys.map(s=>this.getTileByID(s))}getTileByID(s){return this._tiles[s]}getTerrainCoords(s){const p={};for(const f of this._renderableTilesKeys){const y=this._tiles[f].tileID;if(y.canonical.equals(s.canonical)){const x=s.clone();x.posMatrix=new Float64Array(16),a.aS(x.posMatrix,0,a.N,0,a.N,0,1),p[f]=x}else if(y.canonical.isChildOf(s.canonical)){const x=s.clone();x.posMatrix=new Float64Array(16);const C=y.canonical.z-s.canonical.z,M=y.canonical.x-(y.canonical.x>>C<<C),L=y.canonical.y-(y.canonical.y>>C<<C),N=a.N>>C;a.aS(x.posMatrix,0,N,0,N,0,1),a.$(x.posMatrix,x.posMatrix,[-M*N,-L*N,0]),p[f]=x}else if(s.canonical.isChildOf(y.canonical)){const x=s.clone();x.posMatrix=new Float64Array(16);const C=s.canonical.z-y.canonical.z,M=s.canonical.x-(s.canonical.x>>C<<C),L=s.canonical.y-(s.canonical.y>>C<<C),N=a.N>>C;a.aS(x.posMatrix,0,a.N,0,a.N,0,1),a.$(x.posMatrix,x.posMatrix,[M*N,L*N,0]),a.a0(x.posMatrix,x.posMatrix,[1/2**C,1/2**C,0]),p[f]=x}}return p}getSourceTile(s,p){const f=this.sourceCache._source;let y=s.overscaledZ-this.deltaZoom;if(y>f.maxzoom&&(y=f.maxzoom),y<f.minzoom)return null;this._sourceTileCache[s.key]||(this._sourceTileCache[s.key]=s.scaledTo(y).key);let x=this.sourceCache.getTileByID(this._sourceTileCache[s.key]);if((!x||!x.dem)&&p)for(;y>=f.minzoom&&(!x||!x.dem);)x=this.sourceCache.getTileByID(s.scaledTo(y--).key);return x}tilesAfterTime(s=Date.now()){return Object.values(this._tiles).filter(p=>p.timeAdded>=s)}}class Rg{constructor(s,p,f){this.painter=s,this.sourceCache=new Lg(p),this.options=f,this.exaggeration=typeof f.exaggeration=="number"?f.exaggeration:1,this.qualityFactor=2,this.meshSize=128,this._demMatrixCache={},this.coordsIndex=[],this._coordsTextureSize=1024}getDEMElevation(s,p,f,y=a.N){var x;if(!(p>=0&&p<y&&f>=0&&f<y))return 0;const C=this.getTerrainData(s),M=(x=C.tile)===null||x===void 0?void 0:x.dem;if(!M)return 0;const L=function(ut,ht,st){var Mt=ht[0],Ft=ht[1];return ut[0]=st[0]*Mt+st[4]*Ft+st[12],ut[1]=st[1]*Mt+st[5]*Ft+st[13],ut}([],[p/y*a.N,f/y*a.N],C.u_terrain_matrix),N=[L[0]*M.dim,L[1]*M.dim],z=Math.floor(N[0]),B=Math.floor(N[1]),H=N[0]-z,lt=N[1]-B;return M.get(z,B)*(1-H)*(1-lt)+M.get(z+1,B)*H*(1-lt)+M.get(z,B+1)*(1-H)*lt+M.get(z+1,B+1)*H*lt}getElevationForLngLatZoom(s,p){const{tileID:f,mercatorX:y,mercatorY:x}=this._getOverscaledTileIDFromLngLatZoom(s,p);return this.getElevation(f,y%a.N,x%a.N,a.N)}getElevation(s,p,f,y=a.N){return this.getDEMElevation(s,p,f,y)*this.exaggeration}getTerrainData(s){if(!this._emptyDemTexture){const y=this.painter.context,x=new a.R({width:1,height:1},new Uint8Array(4));this._emptyDepthTexture=new J(y,x,y.gl.RGBA,{premultiply:!1}),this._emptyDemUnpack=[0,0,0,0],this._emptyDemTexture=new J(y,new a.R({width:1,height:1}),y.gl.RGBA,{premultiply:!1}),this._emptyDemTexture.bind(y.gl.NEAREST,y.gl.CLAMP_TO_EDGE),this._emptyDemMatrix=a.ao([])}const p=this.sourceCache.getSourceTile(s,!0);if(p&&p.dem&&(!p.demTexture||p.needsTerrainPrepare)){const y=this.painter.context;p.demTexture=this.painter.getTileTexture(p.dem.stride),p.demTexture?p.demTexture.update(p.dem.getPixels(),{premultiply:!1}):p.demTexture=new J(y,p.dem.getPixels(),y.gl.RGBA,{premultiply:!1}),p.demTexture.bind(y.gl.NEAREST,y.gl.CLAMP_TO_EDGE),p.needsTerrainPrepare=!1}const f=p&&p+p.tileID.key+s.key;if(f&&!this._demMatrixCache[f]){const y=this.sourceCache.sourceCache._source.maxzoom;let x=s.canonical.z-p.tileID.canonical.z;s.overscaledZ>s.canonical.z&&(s.canonical.z>=y?x=s.canonical.z-y:a.w("cannot calculate elevation if elevation maxzoom > source.maxzoom"));const C=s.canonical.x-(s.canonical.x>>x<<x),M=s.canonical.y-(s.canonical.y>>x<<x),L=a.bc(new Float64Array(16),[1/(a.N<<x),1/(a.N<<x),0]);a.$(L,L,[C*a.N,M*a.N,0]),this._demMatrixCache[s.key]={matrix:L,coord:s}}return{u_depth:2,u_terrain:3,u_terrain_dim:p&&p.dem&&p.dem.dim||1,u_terrain_matrix:f?this._demMatrixCache[s.key].matrix:this._emptyDemMatrix,u_terrain_unpack:p&&p.dem&&p.dem.getUnpackVector()||this._emptyDemUnpack,u_terrain_exaggeration:this.exaggeration,texture:(p&&p.demTexture||this._emptyDemTexture).texture,depthTexture:(this._fboDepthTexture||this._emptyDepthTexture).texture,tile:p}}getFramebuffer(s){const p=this.painter,f=p.width/devicePixelRatio,y=p.height/devicePixelRatio;return!this._fbo||this._fbo.width===f&&this._fbo.height===y||(this._fbo.destroy(),this._fboCoordsTexture.destroy(),this._fboDepthTexture.destroy(),delete this._fbo,delete this._fboDepthTexture,delete this._fboCoordsTexture),this._fboCoordsTexture||(this._fboCoordsTexture=new J(p.context,{width:f,height:y,data:null},p.context.gl.RGBA,{premultiply:!1}),this._fboCoordsTexture.bind(p.context.gl.NEAREST,p.context.gl.CLAMP_TO_EDGE)),this._fboDepthTexture||(this._fboDepthTexture=new J(p.context,{width:f,height:y,data:null},p.context.gl.RGBA,{premultiply:!1}),this._fboDepthTexture.bind(p.context.gl.NEAREST,p.context.gl.CLAMP_TO_EDGE)),this._fbo||(this._fbo=p.context.createFramebuffer(f,y,!0,!1),this._fbo.depthAttachment.set(p.context.createRenderbuffer(p.context.gl.DEPTH_COMPONENT16,f,y))),this._fbo.colorAttachment.set(s==="coords"?this._fboCoordsTexture.texture:this._fboDepthTexture.texture),this._fbo}getCoordsTexture(){const s=this.painter.context;if(this._coordsTexture)return this._coordsTexture;const p=new Uint8Array(this._coordsTextureSize*this._coordsTextureSize*4);for(let x=0,C=0;x<this._coordsTextureSize;x++)for(let M=0;M<this._coordsTextureSize;M++,C+=4)p[C+0]=255&M,p[C+1]=255&x,p[C+2]=M>>8<<4|x>>8,p[C+3]=0;const f=new a.R({width:this._coordsTextureSize,height:this._coordsTextureSize},new Uint8Array(p.buffer)),y=new J(s,f,s.gl.RGBA,{premultiply:!1});return y.bind(s.gl.NEAREST,s.gl.CLAMP_TO_EDGE),this._coordsTexture=y,y}pointCoordinate(s){const p=new Uint8Array(4),f=this.painter.context,y=f.gl;f.bindFramebuffer.set(this.getFramebuffer("coords").framebuffer),y.readPixels(s.x,this.painter.height/devicePixelRatio-s.y-1,1,1,y.RGBA,y.UNSIGNED_BYTE,p),f.bindFramebuffer.set(null);const x=p[0]+(p[2]>>4<<8),C=p[1]+((15&p[2])<<8),M=this.coordsIndex[255-p[3]],L=M&&this.sourceCache.getTileByID(M);if(!L)return null;const N=this._coordsTextureSize,z=(1<<L.tileID.canonical.z)*N;return new a.U(this._allowMercatorOverflow(s,(L.tileID.canonical.x*N+x)/z),(L.tileID.canonical.y*N+C)/z,this.getElevation(L.tileID,x,C,N))}getTerrainMesh(){if(this._mesh)return this._mesh;const s=this.painter.context,p=new a.bd,f=new a.b0,y=this.meshSize,x=a.N/y,C=y*y;for(let B=0;B<=y;B++)for(let H=0;H<=y;H++)p.emplaceBack(H*x,B*x,0);for(let B=0;B<C;B+=y+1)for(let H=0;H<y;H++)f.emplaceBack(H+B,y+H+B+1,y+H+B+2),f.emplaceBack(H+B,y+H+B+2,H+B+1);const M=p.length,L=M+2*(y+1);for(const B of[0,1])for(let H=0;H<=y;H++)for(const lt of[0,1])p.emplaceBack(H*x,B*a.N,lt);for(let B=0;B<2*y;B+=2)f.emplaceBack(L+B,L+B+1,L+B+3),f.emplaceBack(L+B,L+B+3,L+B+2),f.emplaceBack(M+B,M+B+3,M+B+1),f.emplaceBack(M+B,M+B+2,M+B+3);const N=p.length,z=N+2*(y+1);for(const B of[0,1])for(let H=0;H<=y;H++)for(const lt of[0,1])p.emplaceBack(B*a.N,H*x,lt);for(let B=0;B<2*y;B+=2)f.emplaceBack(N+B,N+B+1,N+B+3),f.emplaceBack(N+B,N+B+3,N+B+2),f.emplaceBack(z+B,z+B+3,z+B+1),f.emplaceBack(z+B,z+B+2,z+B+3);return this._mesh={indexBuffer:s.createIndexBuffer(f),vertexBuffer:s.createVertexBuffer(p,Ag.members),segments:a.S.simpleSegment(0,0,p.length,f.length)},this._mesh}getMeshFrameDelta(s){return 2*Math.PI*a.be/Math.pow(2,s)/5}getMinTileElevationForLngLatZoom(s,p){var f;const{tileID:y}=this._getOverscaledTileIDFromLngLatZoom(s,p);return(f=this.getMinMaxElevation(y).minElevation)!==null&&f!==void 0?f:0}getMinMaxElevation(s){const p=this.getTerrainData(s).tile,f={minElevation:null,maxElevation:null};return p&&p.dem&&(f.minElevation=p.dem.min*this.exaggeration,f.maxElevation=p.dem.max*this.exaggeration),f}_getOverscaledTileIDFromLngLatZoom(s,p){const f=a.U.fromLngLat(s.wrap()),y=(1<<p)*a.N,x=f.x*y,C=f.y*y,M=Math.floor(x/a.N),L=Math.floor(C/a.N);return{tileID:new a.O(p,0,p,M,L),mercatorX:x,mercatorY:C}}_allowMercatorOverflow(s,p){const f=s.x<this.painter.width/2;let y=a.bf(p);const x=this.painter.transform.center.lng;return f&&Math.sign(y)>0&&Math.sign(x)<0||!f&&Math.sign(y)<0&&Math.sign(x)>0?(y=360*Math.sign(x)+y,a.G(y)):p}}class o0{constructor(s,p,f){this._context=s,this._size=p,this._tileSize=f,this._objects=[],this._recentlyUsed=[],this._stamp=0}destruct(){for(const s of this._objects)s.texture.destroy(),s.fbo.destroy()}_createObject(s){const p=this._context.createFramebuffer(this._tileSize,this._tileSize,!0,!0),f=new J(this._context,{width:this._tileSize,height:this._tileSize,data:null},this._context.gl.RGBA);return f.bind(this._context.gl.LINEAR,this._context.gl.CLAMP_TO_EDGE),p.depthAttachment.set(this._context.createRenderbuffer(this._context.gl.DEPTH_STENCIL,this._tileSize,this._tileSize)),p.colorAttachment.set(f.texture),{id:s,fbo:p,texture:f,stamp:-1,inUse:!1}}getObjectForId(s){return this._objects[s]}useObject(s){s.inUse=!0,this._recentlyUsed=this._recentlyUsed.filter(p=>s.id!==p),this._recentlyUsed.push(s.id)}stampObject(s){s.stamp=++this._stamp}getOrCreateFreeObject(){for(const p of this._recentlyUsed)if(!this._objects[p].inUse)return this._objects[p];if(this._objects.length>=this._size)throw new Error("No free RenderPool available, call freeAllObjects() required!");const s=this._createObject(this._objects.length);return this._objects.push(s),s}freeObject(s){s.inUse=!1}freeAllObjects(){for(const s of this._objects)this.freeObject(s)}isFull(){return!(this._objects.length<this._size)&&this._objects.some(s=>!s.inUse)===!1}}const Ko={background:!0,fill:!0,line:!0,raster:!0,hillshade:!0};class cd{constructor(s,p){this.painter=s,this.terrain=p,this.pool=new o0(s.context,30,p.sourceCache.tileSize*p.qualityFactor)}destruct(){this.pool.destruct()}getTexture(s){return this.pool.getObjectForId(s.rtt[this._stacks.length-1].id).texture}prepareForRender(s,p){this._stacks=[],this._prevType=null,this._rttTiles=[],this._renderableTiles=this.terrain.sourceCache.getRenderableTiles(),this._renderableLayerIds=s._order.filter(f=>!s._layers[f].isHidden(p)),this._coordsDescendingInv={};for(const f in s.sourceCaches){this._coordsDescendingInv[f]={};const y=s.sourceCaches[f].getVisibleCoordinates();for(const x of y){const C=this.terrain.sourceCache.getTerrainCoords(x);for(const M in C)this._coordsDescendingInv[f][M]||(this._coordsDescendingInv[f][M]=[]),this._coordsDescendingInv[f][M].push(C[M])}}this._coordsDescendingInvStr={};for(const f of s._order){const y=s._layers[f],x=y.source;if(Ko[y.type]&&!this._coordsDescendingInvStr[x]){this._coordsDescendingInvStr[x]={};for(const C in this._coordsDescendingInv[x])this._coordsDescendingInvStr[x][C]=this._coordsDescendingInv[x][C].map(M=>M.key).sort().join()}}for(const f of this._renderableTiles)for(const y in this._coordsDescendingInvStr){const x=this._coordsDescendingInvStr[y][f.tileID.key];x&&x!==f.rttCoords[y]&&(f.rtt=[])}}renderLayer(s){if(s.isHidden(this.painter.transform.zoom))return!1;const p=s.type,f=this.painter,y=this._renderableLayerIds[this._renderableLayerIds.length-1]===s.id;if(Ko[p]&&(this._prevType&&Ko[this._prevType]||this._stacks.push([]),this._prevType=p,this._stacks[this._stacks.length-1].push(s.id),!y))return!0;if(Ko[this._prevType]||Ko[p]&&y){this._prevType=p;const x=this._stacks.length-1,C=this._stacks[x]||[];for(const M of this._renderableTiles){if(this.pool.isFull()&&(kn(this.painter,this.terrain,this._rttTiles),this._rttTiles=[],this.pool.freeAllObjects()),this._rttTiles.push(M),M.rtt[x]){const N=this.pool.getObjectForId(M.rtt[x].id);if(N.stamp===M.rtt[x].stamp){this.pool.useObject(N);continue}}const L=this.pool.getOrCreateFreeObject();this.pool.useObject(L),this.pool.stampObject(L),M.rtt[x]={id:L.id,stamp:L.stamp},f.context.bindFramebuffer.set(L.fbo.framebuffer),f.context.clear({color:a.aT.transparent,stencil:0}),f.currentStencilSource=void 0;for(let N=0;N<C.length;N++){const z=f.style._layers[C[N]],B=z.source?this._coordsDescendingInv[z.source][M.tileID.key]:[M.tileID];f.context.viewport.set([0,0,L.fbo.width,L.fbo.height]),f._renderTileClippingMasks(z,B),f.renderLayer(f,f.style.sourceCaches[z.source],z,B),z.source&&(M.rttCoords[z.source]=this._coordsDescendingInvStr[z.source][M.tileID.key])}}return kn(this.painter,this.terrain,this._rttTiles),this._rttTiles=[],this.pool.freeAllObjects(),Ko[p]}return!1}}const je=g,Ke={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:60,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:void 0,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,hash:!1,attributionControl:!0,maplibreLogo:!1,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,maxTileCacheSize:null,maxTileCacheZoomLevels:a.c.MAX_TILE_CACHE_ZOOM_LEVELS,localIdeographFontFamily:"sans-serif",transformRequest:null,transformCameraUpdate:null,fadeDuration:300,crossSourceCollisions:!0,validateStyle:!0,maxCanvasSize:[4096,4096]},vp=v=>{v.touchstart=v.dragStart,v.touchmoveWindow=v.dragMove,v.touchend=v.dragEnd},Rf={showCompass:!0,showZoom:!0,visualizePitch:!1};class Df{constructor(s,p,f=!1){this.mousedown=C=>{this.startMouse(a.e({},C,{ctrlKey:!0,preventDefault:()=>C.preventDefault()}),_.mousePos(this.element,C)),_.addEventListener(window,"mousemove",this.mousemove),_.addEventListener(window,"mouseup",this.mouseup)},this.mousemove=C=>{this.moveMouse(C,_.mousePos(this.element,C))},this.mouseup=C=>{this.mouseRotate.dragEnd(C),this.mousePitch&&this.mousePitch.dragEnd(C),this.offTemp()},this.touchstart=C=>{C.targetTouches.length!==1?this.reset():(this._startPos=this._lastPos=_.touchPos(this.element,C.targetTouches)[0],this.startTouch(C,this._startPos),_.addEventListener(window,"touchmove",this.touchmove,{passive:!1}),_.addEventListener(window,"touchend",this.touchend))},this.touchmove=C=>{C.targetTouches.length!==1?this.reset():(this._lastPos=_.touchPos(this.element,C.targetTouches)[0],this.moveTouch(C,this._lastPos))},this.touchend=C=>{C.targetTouches.length===0&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),delete this._startPos,delete this._lastPos,this.offTemp()},this.reset=()=>{this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),this.touchRotate.reset(),this.touchPitch&&this.touchPitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()},this._clickTolerance=10;const y=s.dragRotate._mouseRotate.getClickTolerance(),x=s.dragRotate._mousePitch.getClickTolerance();this.element=p,this.mouseRotate=ll({clickTolerance:y,enable:!0}),this.touchRotate=(({enable:C,clickTolerance:M,bearingDegreesPerPixelMoved:L=.8})=>{const N=new cc;return new Ra({clickTolerance:M,move:(z,B)=>({bearingDelta:(B.x-z.x)*L}),moveStateManager:N,enable:C,assignEvents:vp})})({clickTolerance:y,enable:!0}),this.map=s,f&&(this.mousePitch=ci({clickTolerance:x,enable:!0}),this.touchPitch=(({enable:C,clickTolerance:M,pitchDegreesPerPixelMoved:L=-.5})=>{const N=new cc;return new Ra({clickTolerance:M,move:(z,B)=>({pitchDelta:(B.y-z.y)*L}),moveStateManager:N,enable:C,assignEvents:vp})})({clickTolerance:x,enable:!0})),_.addEventListener(p,"mousedown",this.mousedown),_.addEventListener(p,"touchstart",this.touchstart,{passive:!1}),_.addEventListener(p,"touchcancel",this.reset)}startMouse(s,p){this.mouseRotate.dragStart(s,p),this.mousePitch&&this.mousePitch.dragStart(s,p),_.disableDrag()}startTouch(s,p){this.touchRotate.dragStart(s,p),this.touchPitch&&this.touchPitch.dragStart(s,p),_.disableDrag()}moveMouse(s,p){const f=this.map,{bearingDelta:y}=this.mouseRotate.dragMove(s,p)||{};if(y&&f.setBearing(f.getBearing()+y),this.mousePitch){const{pitchDelta:x}=this.mousePitch.dragMove(s,p)||{};x&&f.setPitch(f.getPitch()+x)}}moveTouch(s,p){const f=this.map,{bearingDelta:y}=this.touchRotate.dragMove(s,p)||{};if(y&&f.setBearing(f.getBearing()+y),this.touchPitch){const{pitchDelta:x}=this.touchPitch.dragMove(s,p)||{};x&&f.setPitch(f.getPitch()+x)}}off(){const s=this.element;_.removeEventListener(s,"mousedown",this.mousedown),_.removeEventListener(s,"touchstart",this.touchstart,{passive:!1}),_.removeEventListener(window,"touchmove",this.touchmove,{passive:!1}),_.removeEventListener(window,"touchend",this.touchend),_.removeEventListener(s,"touchcancel",this.reset),this.offTemp()}offTemp(){_.enableDrag(),_.removeEventListener(window,"mousemove",this.mousemove),_.removeEventListener(window,"mouseup",this.mouseup),_.removeEventListener(window,"touchmove",this.touchmove,{passive:!1}),_.removeEventListener(window,"touchend",this.touchend)}}let Ei;function Nf(v,s,p){if(v=new a.L(v.lng,v.lat),s){const f=new a.L(v.lng-360,v.lat),y=new a.L(v.lng+360,v.lat),x=p.locationPoint(v).distSqr(s);p.locationPoint(f).distSqr(s)<x?v=f:p.locationPoint(y).distSqr(s)<x&&(v=y)}for(;Math.abs(v.lng-p.center.lng)>180;){const f=p.locationPoint(v);if(f.x>=0&&f.y>=0&&f.x<=p.width&&f.y<=p.height)break;v.lng>p.center.lng?v.lng-=360:v.lng+=360}return v}const ha={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};function Dg(v,s,p){const f=v.classList;for(const y in ha)f.remove(`maplibregl-${p}-anchor-${y}`);f.add(`maplibregl-${p}-anchor-${s}`)}class dc extends a.E{constructor(s){if(super(),this._onKeyPress=p=>{const f=p.code,y=p.charCode||p.keyCode;f!=="Space"&&f!=="Enter"&&y!==32&&y!==13||this.togglePopup()},this._onMapClick=p=>{const f=p.originalEvent.target,y=this._element;this._popup&&(f===y||y.contains(f))&&this.togglePopup()},this._update=p=>{if(!this._map)return;const f=this._map.loaded()&&!this._map.isMoving();((p==null?void 0:p.type)==="terrain"||(p==null?void 0:p.type)==="render"&&!f)&&this._map.once("render",this._update),this._map.transform.renderWorldCopies&&(this._lngLat=Nf(this._lngLat,this._pos,this._map.transform)),this._pos=this._map.project(this._lngLat)._add(this._offset);let y="";this._rotationAlignment==="viewport"||this._rotationAlignment==="auto"?y=`rotateZ(${this._rotation}deg)`:this._rotationAlignment==="map"&&(y=`rotateZ(${this._rotation-this._map.getBearing()}deg)`);let x="";this._pitchAlignment==="viewport"||this._pitchAlignment==="auto"?x="rotateX(0deg)":this._pitchAlignment==="map"&&(x=`rotateX(${this._map.getPitch()}deg)`),p&&p.type!=="moveend"||(this._pos=this._pos.round()),_.setTransform(this._element,`${ha[this._anchor]} translate(${this._pos.x}px, ${this._pos.y}px) ${x} ${y}`),this._map.terrain&&!this._opacityTimeout&&(this._opacityTimeout=setTimeout(()=>{const C=this._map.unproject(this._pos),M=40075016686e-3*Math.abs(Math.cos(this._lngLat.lat*Math.PI/180))/Math.pow(2,this._map.transform.tileZoom+8);this._element.style.opacity=C.distanceTo(this._lngLat)>20*M?"0.2":"1.0",this._opacityTimeout=null},100))},this._onMove=p=>{if(!this._isDragging){const f=this._clickTolerance||this._map._clickTolerance;this._isDragging=p.point.dist(this._pointerdownPos)>=f}this._isDragging&&(this._pos=p.point.sub(this._positionDelta),this._lngLat=this._map.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none",this._state==="pending"&&(this._state="active",this.fire(new a.k("dragstart"))),this.fire(new a.k("drag")))},this._onUp=()=>{this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1,this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),this._state==="active"&&this.fire(new a.k("dragend")),this._state="inactive"},this._addDragHandler=p=>{this._element.contains(p.originalEvent.target)&&(p.preventDefault(),this._positionDelta=p.point.sub(this._pos).add(this._offset),this._pointerdownPos=p.point,this._state="pending",this._map.on("mousemove",this._onMove),this._map.on("touchmove",this._onMove),this._map.once("mouseup",this._onUp),this._map.once("touchend",this._onUp))},this._anchor=s&&s.anchor||"center",this._color=s&&s.color||"#3FB1CE",this._scale=s&&s.scale||1,this._draggable=s&&s.draggable||!1,this._clickTolerance=s&&s.clickTolerance||0,this._isDragging=!1,this._state="inactive",this._rotation=s&&s.rotation||0,this._rotationAlignment=s&&s.rotationAlignment||"auto",this._pitchAlignment=s&&s.pitchAlignment&&s.pitchAlignment!=="auto"?s.pitchAlignment:this._rotationAlignment,s&&s.element)this._element=s.element,this._offset=a.P.convert(s&&s.offset||[0,0]);else{this._defaultMarker=!0,this._element=_.create("div"),this._element.setAttribute("aria-label","Map marker");const p=_.createNS("http://www.w3.org/2000/svg","svg"),f=41,y=27;p.setAttributeNS(null,"display","block"),p.setAttributeNS(null,"height",`${f}px`),p.setAttributeNS(null,"width",`${y}px`),p.setAttributeNS(null,"viewBox",`0 0 ${y} ${f}`);const x=_.createNS("http://www.w3.org/2000/svg","g");x.setAttributeNS(null,"stroke","none"),x.setAttributeNS(null,"stroke-width","1"),x.setAttributeNS(null,"fill","none"),x.setAttributeNS(null,"fill-rule","evenodd");const C=_.createNS("http://www.w3.org/2000/svg","g");C.setAttributeNS(null,"fill-rule","nonzero");const M=_.createNS("http://www.w3.org/2000/svg","g");M.setAttributeNS(null,"transform","translate(3.0, 29.0)"),M.setAttributeNS(null,"fill","#000000");const L=[{rx:"10.5",ry:"5.25002273"},{rx:"10.5",ry:"5.25002273"},{rx:"9.5",ry:"4.77275007"},{rx:"8.5",ry:"4.29549936"},{rx:"7.5",ry:"3.81822308"},{rx:"6.5",ry:"3.34094679"},{rx:"5.5",ry:"2.86367051"},{rx:"4.5",ry:"2.38636864"}];for(const Mt of L){const Ft=_.createNS("http://www.w3.org/2000/svg","ellipse");Ft.setAttributeNS(null,"opacity","0.04"),Ft.setAttributeNS(null,"cx","10.5"),Ft.setAttributeNS(null,"cy","5.80029008"),Ft.setAttributeNS(null,"rx",Mt.rx),Ft.setAttributeNS(null,"ry",Mt.ry),M.appendChild(Ft)}const N=_.createNS("http://www.w3.org/2000/svg","g");N.setAttributeNS(null,"fill",this._color);const z=_.createNS("http://www.w3.org/2000/svg","path");z.setAttributeNS(null,"d","M27,13.5 C27,19.074644 20.250001,27.000002 14.75,34.500002 C14.016665,35.500004 12.983335,35.500004 12.25,34.500002 C6.7499993,27.000002 0,19.222562 0,13.5 C0,6.0441559 6.0441559,0 13.5,0 C20.955844,0 27,6.0441559 27,13.5 Z"),N.appendChild(z);const B=_.createNS("http://www.w3.org/2000/svg","g");B.setAttributeNS(null,"opacity","0.25"),B.setAttributeNS(null,"fill","#000000");const H=_.createNS("http://www.w3.org/2000/svg","path");H.setAttributeNS(null,"d","M13.5,0 C6.0441559,0 0,6.0441559 0,13.5 C0,19.222562 6.7499993,27 12.25,34.5 C13,35.522727 14.016664,35.500004 14.75,34.5 C20.250001,27 27,19.074644 27,13.5 C27,6.0441559 20.955844,0 13.5,0 Z M13.5,1 C20.415404,1 26,6.584596 26,13.5 C26,15.898657 24.495584,19.181431 22.220703,22.738281 C19.945823,26.295132 16.705119,30.142167 13.943359,33.908203 C13.743445,34.180814 13.612715,34.322738 13.5,34.441406 C13.387285,34.322738 13.256555,34.180814 13.056641,33.908203 C10.284481,30.127985 7.4148684,26.314159 5.015625,22.773438 C2.6163816,19.232715 1,15.953538 1,13.5 C1,6.584596 6.584596,1 13.5,1 Z"),B.appendChild(H);const lt=_.createNS("http://www.w3.org/2000/svg","g");lt.setAttributeNS(null,"transform","translate(6.0, 7.0)"),lt.setAttributeNS(null,"fill","#FFFFFF");const ut=_.createNS("http://www.w3.org/2000/svg","g");ut.setAttributeNS(null,"transform","translate(8.0, 8.0)");const ht=_.createNS("http://www.w3.org/2000/svg","circle");ht.setAttributeNS(null,"fill","#000000"),ht.setAttributeNS(null,"opacity","0.25"),ht.setAttributeNS(null,"cx","5.5"),ht.setAttributeNS(null,"cy","5.5"),ht.setAttributeNS(null,"r","5.4999962");const st=_.createNS("http://www.w3.org/2000/svg","circle");st.setAttributeNS(null,"fill","#FFFFFF"),st.setAttributeNS(null,"cx","5.5"),st.setAttributeNS(null,"cy","5.5"),st.setAttributeNS(null,"r","5.4999962"),ut.appendChild(ht),ut.appendChild(st),C.appendChild(M),C.appendChild(N),C.appendChild(B),C.appendChild(lt),C.appendChild(ut),p.appendChild(C),p.setAttributeNS(null,"height",f*this._scale+"px"),p.setAttributeNS(null,"width",y*this._scale+"px"),this._element.appendChild(p),this._offset=a.P.convert(s&&s.offset||[0,-14])}if(this._element.classList.add("maplibregl-marker"),this._element.addEventListener("dragstart",p=>{p.preventDefault()}),this._element.addEventListener("mousedown",p=>{p.preventDefault()}),Dg(this._element,this._anchor,"marker"),s&&s.className)for(const p of s.className.split(" "))this._element.classList.add(p);this._popup=null}addTo(s){return this.remove(),this._map=s,s.getCanvasContainer().appendChild(this._element),s.on("move",this._update),s.on("moveend",this._update),s.on("terrain",this._update),this.setDraggable(this._draggable),this._update(),this._map.on("click",this._onMapClick),this}remove(){return this._opacityTimeout&&(clearTimeout(this._opacityTimeout),delete this._opacityTimeout),this._map&&(this._map.off("click",this._onMapClick),this._map.off("move",this._update),this._map.off("moveend",this._update),this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler),this._map.off("mouseup",this._onUp),this._map.off("touchend",this._onUp),this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),delete this._map),_.remove(this._element),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(s){return this._lngLat=a.L.convert(s),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(),this}getElement(){return this._element}setPopup(s){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),s){if(!("offset"in s.options)){const p=Math.abs(13.5)/Math.SQRT2;s.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[p,-1*(38.1-13.5+p)],"bottom-right":[-p,-1*(38.1-13.5+p)],left:[13.5,-1*(38.1-13.5)],right:[-13.5,-1*(38.1-13.5)]}:this._offset}this._popup=s,this._lngLat&&this._popup.setLngLat(this._lngLat),this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress)}return this}getPopup(){return this._popup}togglePopup(){const s=this._popup;return s?(s.isOpen()?s.remove():s.addTo(this._map),this):this}getOffset(){return this._offset}setOffset(s){return this._offset=a.P.convert(s),this._update(),this}addClassName(s){this._element.classList.add(s)}removeClassName(s){this._element.classList.remove(s)}toggleClassName(s){return this._element.classList.toggle(s)}setDraggable(s){return this._draggable=!!s,this._map&&(s?(this._map.on("mousedown",this._addDragHandler),this._map.on("touchstart",this._addDragHandler)):(this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(s){return this._rotation=s||0,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(s){return this._rotationAlignment=s||"auto",this._update(),this}getRotationAlignment(){return this._rotationAlignment}setPitchAlignment(s){return this._pitchAlignment=s&&s!=="auto"?s:this._rotationAlignment,this._update(),this}getPitchAlignment(){return this._pitchAlignment}}const Qn={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0};let Wn=0,Sh=!1;const xp={maxWidth:100,unit:"metric"};function bp(v,s,p){const f=p&&p.maxWidth||100,y=v._container.clientHeight/2,x=v.unproject([0,y]),C=v.unproject([f,y]),M=x.distanceTo(C);if(p&&p.unit==="imperial"){const L=3.2808*M;L>5280?fc(s,f,L/5280,v._getUIString("ScaleControl.Miles")):fc(s,f,L,v._getUIString("ScaleControl.Feet"))}else p&&p.unit==="nautical"?fc(s,f,M/1852,v._getUIString("ScaleControl.NauticalMiles")):M>=1e3?fc(s,f,M/1e3,v._getUIString("ScaleControl.Kilometers")):fc(s,f,M,v._getUIString("ScaleControl.Meters"))}function fc(v,s,p,f){const y=function(x){const C=Math.pow(10,`${Math.floor(x)}`.length-1);let M=x/C;return M=M>=10?10:M>=5?5:M>=3?3:M>=2?2:M>=1?1:function(L){const N=Math.pow(10,Math.ceil(-Math.log(L)/Math.LN10));return Math.round(L*N)/N}(M),C*M}(p);v.style.width=s*(y/p)+"px",v.innerHTML=`${y}&nbsp;${f}`}const kf={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px"},Of=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function Th(v){if(v){if(typeof v=="number"){const s=Math.round(Math.abs(v)/Math.SQRT2);return{center:new a.P(0,0),top:new a.P(0,v),"top-left":new a.P(s,s),"top-right":new a.P(-s,s),bottom:new a.P(0,-v),"bottom-left":new a.P(s,-s),"bottom-right":new a.P(-s,-s),left:new a.P(v,0),right:new a.P(-v,0)}}if(v instanceof a.P||Array.isArray(v)){const s=a.P.convert(v);return{center:s,top:s,"top-left":s,"top-right":s,bottom:s,"bottom-left":s,"bottom-right":s,left:s,right:s}}return{center:a.P.convert(v.center||[0,0]),top:a.P.convert(v.top||[0,0]),"top-left":a.P.convert(v["top-left"]||[0,0]),"top-right":a.P.convert(v["top-right"]||[0,0]),bottom:a.P.convert(v.bottom||[0,0]),"bottom-left":a.P.convert(v["bottom-left"]||[0,0]),"bottom-right":a.P.convert(v["bottom-right"]||[0,0]),left:a.P.convert(v.left||[0,0]),right:a.P.convert(v.right||[0,0])}}return Th(new a.P(0,0))}const Ff={extend:(v,...s)=>a.e(v,...s),run(v){v()},logToElement(v,s=!1,p="log"){const f=window.document.getElementById(p);f&&(s&&(f.innerHTML=""),f.innerHTML+=`<br>${v}`)}},zf=g;class on{static get version(){return zf}static get workerCount(){return ho.workerCount}static set workerCount(s){ho.workerCount=s}static get maxParallelImageRequests(){return a.c.MAX_PARALLEL_IMAGE_REQUESTS}static set maxParallelImageRequests(s){a.c.MAX_PARALLEL_IMAGE_REQUESTS=s}static get workerUrl(){return a.c.WORKER_URL}static set workerUrl(s){a.c.WORKER_URL=s}static addProtocol(s,p){a.c.REGISTERED_PROTOCOLS[s]=p}static removeProtocol(s){delete a.c.REGISTERED_PROTOCOLS[s]}}return on.Map=class extends Pg{constructor(v){if(a.bg.mark(a.bh.create),(v=a.e({},Ke,v)).minZoom!=null&&v.maxZoom!=null&&v.minZoom>v.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(v.minPitch!=null&&v.maxPitch!=null&&v.minPitch>v.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(v.minPitch!=null&&v.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(v.maxPitch!=null&&v.maxPitch>85)throw new Error("maxPitch must be less than or equal to 85");if(super(new bh(v.minZoom,v.maxZoom,v.minPitch,v.maxPitch,v.renderWorldCopies),{bearingSnap:v.bearingSnap}),this._cooperativeGesturesOnWheel=s=>{this._onCooperativeGesture(s,s[this._metaKey],1)},this._contextLost=s=>{s.preventDefault(),this._frame&&(this._frame.cancel(),this._frame=null),this.fire(new a.k("webglcontextlost",{originalEvent:s}))},this._contextRestored=s=>{this._setupPainter(),this.resize(),this._update(),this.fire(new a.k("webglcontextrestored",{originalEvent:s}))},this._onMapScroll=s=>{if(s.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1},this._onWindowOnline=()=>{this._update()},this._interactive=v.interactive,this._cooperativeGestures=v.cooperativeGestures,this._metaKey=navigator.platform.indexOf("Mac")===0?"metaKey":"ctrlKey",this._maxTileCacheSize=v.maxTileCacheSize,this._maxTileCacheZoomLevels=v.maxTileCacheZoomLevels,this._failIfMajorPerformanceCaveat=v.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=v.preserveDrawingBuffer,this._antialias=v.antialias,this._trackResize=v.trackResize,this._bearingSnap=v.bearingSnap,this._refreshExpiredTiles=v.refreshExpiredTiles,this._fadeDuration=v.fadeDuration,this._crossSourceCollisions=v.crossSourceCollisions,this._crossFadingFactor=1,this._collectResourceTiming=v.collectResourceTiming,this._renderTaskQueue=new ud,this._controls=[],this._mapId=a.a2(),this._locale=a.e({},Lf,v.locale),this._clickTolerance=v.clickTolerance,this._overridePixelRatio=v.pixelRatio,this._maxCanvasSize=v.maxCanvasSize,this.transformCameraUpdate=v.transformCameraUpdate,this._imageQueueHandle=W.addThrottleControl(()=>this.isMoving()),this._requestManager=new tt(v.transformRequest),typeof v.container=="string"){if(this._container=document.getElementById(v.container),!this._container)throw new Error(`Container '${v.container}' not found.`)}else{if(!(v.container instanceof HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=v.container}if(v.maxBounds&&this.setMaxBounds(v.maxBounds),this._setupContainer(),this._setupPainter(),this.on("move",()=>this._update(!1)),this.on("moveend",()=>this._update(!1)),this.on("zoom",()=>this._update(!0)),this.on("terrain",()=>{this.painter.terrainFacilitator.dirty=!0,this._update(!0)}),this.once("idle",()=>{this._idleTriggered=!0}),typeof window<"u"){addEventListener("online",this._onWindowOnline,!1);let s=!1;const p=Lt(f=>{this._trackResize&&!this._removed&&this.resize(f)._update()},50);this._resizeObserver=new ResizeObserver(f=>{s?p(f):s=!0}),this._resizeObserver.observe(this._container)}this.handlers=new Af(this,v),this._cooperativeGestures&&this._setupCooperativeGestures(),this._hash=v.hash&&new Xt(typeof v.hash=="string"&&v.hash||void 0).addTo(this),this._hash&&this._hash._onHashChange()||(this.jumpTo({center:v.center,zoom:v.zoom,bearing:v.bearing,pitch:v.pitch}),v.bounds&&(this.resize(),this.fitBounds(v.bounds,a.e({},v.fitBoundsOptions,{duration:0})))),this.resize(),this._localIdeographFontFamily=v.localIdeographFontFamily,this._validateStyle=v.validateStyle,v.style&&this.setStyle(v.style,{localIdeographFontFamily:v.localIdeographFontFamily}),v.attributionControl&&this.addControl(new Fs({customAttribution:v.customAttribution})),v.maplibreLogo&&this.addControl(new On,v.logoPosition),this.on("style.load",()=>{this.transform.unmodified&&this.jumpTo(this.style.stylesheet)}),this.on("data",s=>{this._update(s.dataType==="style"),this.fire(new a.k(`${s.dataType}data`,s))}),this.on("dataloading",s=>{this.fire(new a.k(`${s.dataType}dataloading`,s))}),this.on("dataabort",s=>{this.fire(new a.k("sourcedataabort",s))})}_getMapId(){return this._mapId}addControl(v,s){if(s===void 0&&(s=v.getDefaultPosition?v.getDefaultPosition():"top-right"),!v||!v.onAdd)return this.fire(new a.j(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));const p=v.onAdd(this);this._controls.push(v);const f=this._controlPositions[s];return s.indexOf("bottom")!==-1?f.insertBefore(p,f.firstChild):f.appendChild(p),this}removeControl(v){if(!v||!v.onRemove)return this.fire(new a.j(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));const s=this._controls.indexOf(v);return s>-1&&this._controls.splice(s,1),v.onRemove(this),this}hasControl(v){return this._controls.indexOf(v)>-1}calculateCameraOptionsFromTo(v,s,p,f){return f==null&&this.terrain&&(f=this.terrain.getElevationForLngLatZoom(p,this.transform.tileZoom)),super.calculateCameraOptionsFromTo(v,s,p,f)}resize(v){var s;const p=this._containerDimensions(),f=p[0],y=p[1],x=this._getClampedPixelRatio(f,y);if(this._resizeCanvas(f,y,x),this.painter.resize(f,y,x),this.painter.overLimit()){const M=this.painter.context.gl;this._maxCanvasSize=[M.drawingBufferWidth,M.drawingBufferHeight];const L=this._getClampedPixelRatio(f,y);this._resizeCanvas(f,y,L),this.painter.resize(f,y,L)}this.transform.resize(f,y),(s=this._requestedCameraState)===null||s===void 0||s.resize(f,y);const C=!this._moving;return C&&(this.stop(),this.fire(new a.k("movestart",v)).fire(new a.k("move",v))),this.fire(new a.k("resize",v)),C&&this.fire(new a.k("moveend",v)),this}_getClampedPixelRatio(v,s){const{0:p,1:f}=this._maxCanvasSize,y=this.getPixelRatio(),x=v*y,C=s*y;return Math.min(x>p?p/x:1,C>f?f/C:1)*y}getPixelRatio(){var v;return(v=this._overridePixelRatio)!==null&&v!==void 0?v:devicePixelRatio}setPixelRatio(v){this._overridePixelRatio=v,this.resize()}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()}setMaxBounds(v){return this.transform.setMaxBounds(ue.convert(v)),this._update()}setMinZoom(v){if((v=v??-2)>=-2&&v<=this.transform.maxZoom)return this.transform.minZoom=v,this._update(),this.getZoom()<v&&this.setZoom(v),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(v){if((v=v??22)>=this.transform.minZoom)return this.transform.maxZoom=v,this._update(),this.getZoom()>v&&this.setZoom(v),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(v){if((v=v??0)<0)throw new Error("minPitch must be greater than or equal to 0");if(v>=0&&v<=this.transform.maxPitch)return this.transform.minPitch=v,this._update(),this.getPitch()<v&&this.setPitch(v),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(v){if((v=v??60)>85)throw new Error("maxPitch must be less than or equal to 85");if(v>=this.transform.minPitch)return this.transform.maxPitch=v,this._update(),this.getPitch()>v&&this.setPitch(v),this;throw new Error("maxPitch must be greater than the current minPitch")}getMaxPitch(){return this.transform.maxPitch}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(v){return this.transform.renderWorldCopies=v,this._update()}getCooperativeGestures(){return this._cooperativeGestures}setCooperativeGestures(v){return this._cooperativeGestures=v,this._cooperativeGestures?this._setupCooperativeGestures():this._destroyCooperativeGestures(),this}project(v){return this.transform.locationPoint(a.L.convert(v),this.style&&this.terrain)}unproject(v){return this.transform.pointLocation(a.P.convert(v),this.terrain)}isMoving(){var v;return this._moving||((v=this.handlers)===null||v===void 0?void 0:v.isMoving())}isZooming(){var v;return this._zooming||((v=this.handlers)===null||v===void 0?void 0:v.isZooming())}isRotating(){var v;return this._rotating||((v=this.handlers)===null||v===void 0?void 0:v.isRotating())}_createDelegatedListener(v,s,p){if(v==="mouseenter"||v==="mouseover"){let f=!1;return{layer:s,listener:p,delegates:{mousemove:y=>{const x=this.getLayer(s)?this.queryRenderedFeatures(y.point,{layers:[s]}):[];x.length?f||(f=!0,p.call(this,new rn(v,this,y.originalEvent,{features:x}))):f=!1},mouseout:()=>{f=!1}}}}if(v==="mouseleave"||v==="mouseout"){let f=!1;return{layer:s,listener:p,delegates:{mousemove:y=>{(this.getLayer(s)?this.queryRenderedFeatures(y.point,{layers:[s]}):[]).length?f=!0:f&&(f=!1,p.call(this,new rn(v,this,y.originalEvent)))},mouseout:y=>{f&&(f=!1,p.call(this,new rn(v,this,y.originalEvent)))}}}}{const f=y=>{const x=this.getLayer(s)?this.queryRenderedFeatures(y.point,{layers:[s]}):[];x.length&&(y.features=x,p.call(this,y),delete y.features)};return{layer:s,listener:p,delegates:{[v]:f}}}}on(v,s,p){if(p===void 0)return super.on(v,s);const f=this._createDelegatedListener(v,s,p);this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[v]=this._delegatedListeners[v]||[],this._delegatedListeners[v].push(f);for(const y in f.delegates)this.on(y,f.delegates[y]);return this}once(v,s,p){if(p===void 0)return super.once(v,s);const f=this._createDelegatedListener(v,s,p);for(const y in f.delegates)this.once(y,f.delegates[y]);return this}off(v,s,p){return p===void 0?super.off(v,s):(this._delegatedListeners&&this._delegatedListeners[v]&&(f=>{const y=this._delegatedListeners[v];for(let x=0;x<y.length;x++){const C=y[x];if(C.layer===s&&C.listener===p){for(const M in C.delegates)this.off(M,C.delegates[M]);return y.splice(x,1),this}}})(),this)}queryRenderedFeatures(v,s){if(!this.style)return[];let p;const f=v instanceof a.P||Array.isArray(v),y=f?v:[[0,0],[this.transform.width,this.transform.height]];if(s=s||(f?{}:v)||{},y instanceof a.P||typeof y[0]=="number")p=[a.P.convert(y)];else{const x=a.P.convert(y[0]),C=a.P.convert(y[1]);p=[x,new a.P(C.x,x.y),C,new a.P(x.x,C.y),x]}return this.style.queryRenderedFeatures(p,s,this.transform)}querySourceFeatures(v,s){return this.style.querySourceFeatures(v,s)}setStyle(v,s){return(s=a.e({},{localIdeographFontFamily:this._localIdeographFontFamily,validate:this._validateStyle},s)).diff!==!1&&s.localIdeographFontFamily===this._localIdeographFontFamily&&this.style&&v?(this._diffStyle(v,s),this):(this._localIdeographFontFamily=s.localIdeographFontFamily,this._updateStyle(v,s))}setTransformRequest(v){return this._requestManager.setTransformRequest(v),this}_getUIString(v){const s=this._locale[v];if(s==null)throw new Error(`Missing UI string '${v}'`);return s}_updateStyle(v,s){if(s.transformStyle&&this.style&&!this.style._loaded)return void this.style.once("style.load",()=>this._updateStyle(v,s));const p=this.style&&s.transformStyle?this.style.serialize():void 0;return this.style&&(this.style.setEventedParent(null),this.style._remove(!v)),v?(this.style=new ki(this,s||{}),this.style.setEventedParent(this,{style:this.style}),typeof v=="string"?this.style.loadURL(v,s,p):this.style.loadJSON(v,s,p),this):(delete this.style,this)}_lazyInitEmptyStyle(){this.style||(this.style=new ki(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}_diffStyle(v,s){if(typeof v=="string"){const p=this._requestManager.transformRequest(v,U.Style);a.f(p,(f,y)=>{f?this.fire(new a.j(f)):y&&this._updateDiff(y,s)})}else typeof v=="object"&&this._updateDiff(v,s)}_updateDiff(v,s){try{this.style.setState(v,s)&&this._update(!0)}catch(p){a.w(`Unable to perform style diff: ${p.message||p.error||p}.  Rebuilding the style from scratch.`),this._updateStyle(v,s)}}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():a.w("There is no style added to the map.")}addSource(v,s){return this._lazyInitEmptyStyle(),this.style.addSource(v,s),this._update(!0)}isSourceLoaded(v){const s=this.style&&this.style.sourceCaches[v];if(s!==void 0)return s.loaded();this.fire(new a.j(new Error(`There is no source with ID '${v}'`)))}setTerrain(v){if(this.style._checkLoaded(),this._terrainDataCallback&&this.style.off("data",this._terrainDataCallback),v){const s=this.style.sourceCaches[v.source];if(!s)throw new Error(`cannot load terrain, because there exists no source with ID: ${v.source}`);for(const p in this.style._layers){const f=this.style._layers[p];f.type==="hillshade"&&f.source===v.source&&a.w("You are using the same source for a hillshade layer and for 3D terrain. Please consider using two separate sources to improve rendering quality.")}this.terrain=new Rg(this.painter,s,v),this.painter.renderToTexture=new cd(this.painter,this.terrain),this.transform._minEleveationForCurrentTile=this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom),this.transform.elevation=this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom),this._terrainDataCallback=p=>{p.dataType==="style"?this.terrain.sourceCache.freeRtt():p.dataType==="source"&&p.tile&&(p.sourceId!==v.source||this._elevationFreeze||(this.transform._minEleveationForCurrentTile=this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom),this.transform.elevation=this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom)),this.terrain.sourceCache.freeRtt(p.tile.tileID))},this.style.on("data",this._terrainDataCallback)}else this.terrain&&this.terrain.sourceCache.destruct(),this.terrain=null,this.painter.renderToTexture&&this.painter.renderToTexture.destruct(),this.painter.renderToTexture=null,this.transform._minEleveationForCurrentTile=0,this.transform.elevation=0;return this.fire(new a.k("terrain",{terrain:v})),this}getTerrain(){var v,s;return(s=(v=this.terrain)===null||v===void 0?void 0:v.options)!==null&&s!==void 0?s:null}areTilesLoaded(){const v=this.style&&this.style.sourceCaches;for(const s in v){const p=v[s]._tiles;for(const f in p){const y=p[f];if(y.state!=="loaded"&&y.state!=="errored")return!1}}return!0}addSourceType(v,s,p){return this._lazyInitEmptyStyle(),this.style.addSourceType(v,s,p)}removeSource(v){return this.style.removeSource(v),this._update(!0)}getSource(v){return this.style.getSource(v)}addImage(v,s,p={}){const{pixelRatio:f=1,sdf:y=!1,stretchX:x,stretchY:C,content:M}=p;if(this._lazyInitEmptyStyle(),!(s instanceof HTMLImageElement||a.a(s))){if(s.width===void 0||s.height===void 0)return this.fire(new a.j(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));{const{width:L,height:N,data:z}=s,B=s;return this.style.addImage(v,{data:new a.R({width:L,height:N},new Uint8Array(z)),pixelRatio:f,stretchX:x,stretchY:C,content:M,sdf:y,version:0,userImage:B}),B.onAdd&&B.onAdd(this,v),this}}{const{width:L,height:N,data:z}=a.h.getImageData(s);this.style.addImage(v,{data:new a.R({width:L,height:N},z),pixelRatio:f,stretchX:x,stretchY:C,content:M,sdf:y,version:0})}}updateImage(v,s){const p=this.style.getImage(v);if(!p)return this.fire(new a.j(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));const f=s instanceof HTMLImageElement||a.a(s)?a.h.getImageData(s):s,{width:y,height:x,data:C}=f;if(y===void 0||x===void 0)return this.fire(new a.j(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));if(y!==p.data.width||x!==p.data.height)return this.fire(new a.j(new Error("The width and height of the updated image must be that same as the previous version of the image")));const M=!(s instanceof HTMLImageElement||a.a(s));return p.data.replace(C,M),this.style.updateImage(v,p),this}getImage(v){return this.style.getImage(v)}hasImage(v){return v?!!this.style.getImage(v):(this.fire(new a.j(new Error("Missing required image id"))),!1)}removeImage(v){this.style.removeImage(v)}loadImage(v,s){W.getImage(this._requestManager.transformRequest(v,U.Image),s)}listImages(){return this.style.listImages()}addLayer(v,s){return this._lazyInitEmptyStyle(),this.style.addLayer(v,s),this._update(!0)}moveLayer(v,s){return this.style.moveLayer(v,s),this._update(!0)}removeLayer(v){return this.style.removeLayer(v),this._update(!0)}getLayer(v){return this.style.getLayer(v)}getLayersOrder(){return this.style.getLayersOrder()}setLayerZoomRange(v,s,p){return this.style.setLayerZoomRange(v,s,p),this._update(!0)}setFilter(v,s,p={}){return this.style.setFilter(v,s,p),this._update(!0)}getFilter(v){return this.style.getFilter(v)}setPaintProperty(v,s,p,f={}){return this.style.setPaintProperty(v,s,p,f),this._update(!0)}getPaintProperty(v,s){return this.style.getPaintProperty(v,s)}setLayoutProperty(v,s,p,f={}){return this.style.setLayoutProperty(v,s,p,f),this._update(!0)}getLayoutProperty(v,s){return this.style.getLayoutProperty(v,s)}setGlyphs(v,s={}){return this._lazyInitEmptyStyle(),this.style.setGlyphs(v,s),this._update(!0)}getGlyphs(){return this.style.getGlyphsUrl()}addSprite(v,s,p={}){return this._lazyInitEmptyStyle(),this.style.addSprite(v,s,p,f=>{f||this._update(!0)}),this}removeSprite(v){return this._lazyInitEmptyStyle(),this.style.removeSprite(v),this._update(!0)}getSprite(){return this.style.getSprite()}setSprite(v,s={}){return this._lazyInitEmptyStyle(),this.style.setSprite(v,s,p=>{p||this._update(!0)}),this}setLight(v,s={}){return this._lazyInitEmptyStyle(),this.style.setLight(v,s),this._update(!0)}getLight(){return this.style.getLight()}setFeatureState(v,s){return this.style.setFeatureState(v,s),this._update()}removeFeatureState(v,s){return this.style.removeFeatureState(v,s),this._update()}getFeatureState(v){return this.style.getFeatureState(v)}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}_containerDimensions(){let v=0,s=0;return this._container&&(v=this._container.clientWidth||400,s=this._container.clientHeight||300),[v,s]}_setupContainer(){const v=this._container;v.classList.add("maplibregl-map");const s=this._canvasContainer=_.create("div","maplibregl-canvas-container",v);this._interactive&&s.classList.add("maplibregl-interactive"),this._canvas=_.create("canvas","maplibregl-canvas",s),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("tabindex","0"),this._canvas.setAttribute("aria-label","Map"),this._canvas.setAttribute("role","region");const p=this._containerDimensions(),f=this._getClampedPixelRatio(p[0],p[1]);this._resizeCanvas(p[0],p[1],f);const y=this._controlContainer=_.create("div","maplibregl-control-container",v),x=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach(C=>{x[C]=_.create("div",`maplibregl-ctrl-${C} `,y)}),this._container.addEventListener("scroll",this._onMapScroll,!1)}_setupCooperativeGestures(){this._cooperativeGesturesScreen=_.create("div","maplibregl-cooperative-gesture-screen",this._container);let v=typeof this._cooperativeGestures!="boolean"&&this._cooperativeGestures.windowsHelpText?this._cooperativeGestures.windowsHelpText:"Use Ctrl + scroll to zoom the map";navigator.platform.indexOf("Mac")===0&&(v=typeof this._cooperativeGestures!="boolean"&&this._cooperativeGestures.macHelpText?this._cooperativeGestures.macHelpText:"Use  + scroll to zoom the map"),this._cooperativeGesturesScreen.innerHTML=`
            <div class="maplibregl-desktop-message">${v}</div>
            <div class="maplibregl-mobile-message">${typeof this._cooperativeGestures!="boolean"&&this._cooperativeGestures.mobileHelpText?this._cooperativeGestures.mobileHelpText:"Use two fingers to move the map"}</div>
        `,this._cooperativeGesturesScreen.setAttribute("aria-hidden","true"),this._canvasContainer.addEventListener("wheel",this._cooperativeGesturesOnWheel,!1),this._canvasContainer.classList.add("maplibregl-cooperative-gestures")}_destroyCooperativeGestures(){_.remove(this._cooperativeGesturesScreen),this._canvasContainer.removeEventListener("wheel",this._cooperativeGesturesOnWheel,!1),this._canvasContainer.classList.remove("maplibregl-cooperative-gestures")}_resizeCanvas(v,s,p){this._canvas.width=Math.floor(p*v),this._canvas.height=Math.floor(p*s),this._canvas.style.width=`${v}px`,this._canvas.style.height=`${s}px`}_setupPainter(){const v={alpha:!0,stencil:!0,depth:!0,failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1};let s=null;this._canvas.addEventListener("webglcontextcreationerror",f=>{s={requestedAttributes:v},f&&(s.statusMessage=f.statusMessage,s.type=f.type)},{once:!0});const p=this._canvas.getContext("webgl2",v)||this._canvas.getContext("webgl",v);if(!p){const f="Failed to initialize WebGL";throw s?(s.message=f,new Error(JSON.stringify(s))):new Error(f)}this.painter=new al(p,this.transform),E.testSupport(p)}_onCooperativeGesture(v,s,p){return!s&&p<2&&(this._cooperativeGesturesScreen.classList.add("maplibregl-show"),setTimeout(()=>{this._cooperativeGesturesScreen.classList.remove("maplibregl-show")},100)),!1}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}_update(v){return this.style&&this.style._loaded?(this._styleDirty=this._styleDirty||v,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(v){return this._update(),this._renderTaskQueue.add(v)}_cancelRenderFrame(v){this._renderTaskQueue.remove(v)}_render(v){const s=this._idleTriggered?this._fadeDuration:0;if(this.painter.context.setDirty(),this.painter.setBaseState(),this._renderTaskQueue.run(v),this._removed)return;let p=!1;if(this.style&&this._styleDirty){this._styleDirty=!1;const y=this.transform.zoom,x=a.h.now();this.style.zoomHistory.update(y,x);const C=new a.a8(y,{now:x,fadeDuration:s,zoomHistory:this.style.zoomHistory,transition:this.style.getTransition()}),M=C.crossFadingFactor();M===1&&M===this._crossFadingFactor||(p=!0,this._crossFadingFactor=M),this.style.update(C)}this.style&&this._sourcesDirty&&(this._sourcesDirty=!1,this.style._updateSources(this.transform)),this.terrain?(this.terrain.sourceCache.update(this.transform,this.terrain),this.transform._minEleveationForCurrentTile=this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom),this._elevationFreeze||(this.transform.elevation=this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom))):(this.transform._minEleveationForCurrentTile=0,this.transform.elevation=0),this._placementDirty=this.style&&this.style._updatePlacement(this.painter.transform,this.showCollisionBoxes,s,this._crossSourceCollisions),this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showOverdrawInspector:this._showOverdrawInspector,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:s,showPadding:this.showPadding}),this.fire(new a.k("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,a.bg.mark(a.bh.load),this.fire(new a.k("load"))),this.style&&(this.style.hasTransitions()||p)&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles();const f=this._sourcesDirty||this._styleDirty||this._placementDirty;return f||this._repaint?this.triggerRepaint():!this.isMoving()&&this.loaded()&&this.fire(new a.k("idle")),!this._loaded||this._fullyLoaded||f||(this._fullyLoaded=!0,a.bg.mark(a.bh.fullLoad)),this}redraw(){return this.style&&(this._frame&&(this._frame.cancel(),this._frame=null),this._render(0)),this}remove(){var v;this._hash&&this._hash.remove();for(const p of this._controls)p.onRemove(this);this._controls=[],this._frame&&(this._frame.cancel(),this._frame=null),this._renderTaskQueue.clear(),this.painter.destroy(),this.handlers.destroy(),delete this.handlers,this.setStyle(null),typeof window<"u"&&removeEventListener("online",this._onWindowOnline,!1),W.removeThrottleControl(this._imageQueueHandle),(v=this._resizeObserver)===null||v===void 0||v.disconnect();const s=this.painter.context.gl.getExtension("WEBGL_lose_context");s&&s.loseContext(),this._canvas.removeEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.removeEventListener("webglcontextlost",this._contextLost,!1),_.remove(this._canvasContainer),_.remove(this._controlContainer),this._cooperativeGestures&&this._destroyCooperativeGestures(),this._container.classList.remove("maplibregl-map"),a.bg.clearMetrics(),this._removed=!0,this.fire(new a.k("remove"))}triggerRepaint(){this.style&&!this._frame&&(this._frame=a.h.frame(v=>{a.bg.frame(v),this._frame=null,this._render(v)}))}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(v){this._showTileBoundaries!==v&&(this._showTileBoundaries=v,this._update())}get showPadding(){return!!this._showPadding}set showPadding(v){this._showPadding!==v&&(this._showPadding=v,this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(v){this._showCollisionBoxes!==v&&(this._showCollisionBoxes=v,v?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(v){this._showOverdrawInspector!==v&&(this._showOverdrawInspector=v,this._update())}get repaint(){return!!this._repaint}set repaint(v){this._repaint!==v&&(this._repaint=v,this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(v){this._vertices=v,this._update()}get version(){return je}getCameraTargetElevation(){return this.transform.elevation}},on.NavigationControl=class{constructor(v){this._updateZoomButtons=()=>{const s=this._map.getZoom(),p=s===this._map.getMaxZoom(),f=s===this._map.getMinZoom();this._zoomInButton.disabled=p,this._zoomOutButton.disabled=f,this._zoomInButton.setAttribute("aria-disabled",p.toString()),this._zoomOutButton.setAttribute("aria-disabled",f.toString())},this._rotateCompassArrow=()=>{const s=this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(this._map.transform.pitch*(Math.PI/180)),.5)}) rotateX(${this._map.transform.pitch}deg) rotateZ(${this._map.transform.angle*(180/Math.PI)}deg)`:`rotate(${this._map.transform.angle*(180/Math.PI)}deg)`;this._compassIcon.style.transform=s},this._setButtonTitle=(s,p)=>{const f=this._map._getUIString(`NavigationControl.${p}`);s.title=f,s.setAttribute("aria-label",f)},this.options=a.e({},Rf,v),this._container=_.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._container.addEventListener("contextmenu",s=>s.preventDefault()),this.options.showZoom&&(this._zoomInButton=this._createButton("maplibregl-ctrl-zoom-in",s=>this._map.zoomIn({},{originalEvent:s})),_.create("span","maplibregl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("maplibregl-ctrl-zoom-out",s=>this._map.zoomOut({},{originalEvent:s})),_.create("span","maplibregl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(this._compass=this._createButton("maplibregl-ctrl-compass",s=>{this.options.visualizePitch?this._map.resetNorthPitch({},{originalEvent:s}):this._map.resetNorth({},{originalEvent:s})}),this._compassIcon=_.create("span","maplibregl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}onAdd(v){return this._map=v,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),this._map.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&this._map.on("pitch",this._rotateCompassArrow),this._map.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new Df(this._map,this._compass,this.options.visualizePitch)),this._container}onRemove(){_.remove(this._container),this.options.showZoom&&this._map.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&this._map.off("pitch",this._rotateCompassArrow),this._map.off("rotate",this._rotateCompassArrow),this._handler.off(),delete this._handler),delete this._map}_createButton(v,s){const p=_.create("button",v,this._container);return p.type="button",p.addEventListener("click",s),p}},on.GeolocateControl=class extends a.E{constructor(v){super(),this._onSuccess=s=>{if(this._map){if(this._isOutOfMapMaxBounds(s))return this._setErrorState(),this.fire(new a.k("outofmaxbounds",s)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=s,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background");break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}this.options.showUserLocation&&this._watchState!=="OFF"&&this._updateMarker(s),this.options.trackUserLocation&&this._watchState!=="ACTIVE_LOCK"||this._updateCamera(s),this.options.showUserLocation&&this._dotElement.classList.remove("maplibregl-user-location-dot-stale"),this.fire(new a.k("geolocate",s)),this._finish()}},this._updateCamera=s=>{const p=new a.L(s.coords.longitude,s.coords.latitude),f=s.coords.accuracy,y=this._map.getBearing(),x=a.e({bearing:y},this.options.fitBoundsOptions),C=ue.fromLngLat(p,f);this._map.fitBounds(C,x,{geolocateSource:!0})},this._updateMarker=s=>{if(s){const p=new a.L(s.coords.longitude,s.coords.latitude);this._accuracyCircleMarker.setLngLat(p).addTo(this._map),this._userLocationDotMarker.setLngLat(p).addTo(this._map),this._accuracy=s.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()},this._onZoom=()=>{this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()},this._onError=s=>{if(this._map){if(this.options.trackUserLocation)if(s.code===1){this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;const p=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.title=p,this._geolocateButton.setAttribute("aria-label",p),this._geolocationWatchID!==void 0&&this._clearWatch()}else{if(s.code===3&&Sh)return;this._setErrorState()}this._watchState!=="OFF"&&this.options.showUserLocation&&this._dotElement.classList.add("maplibregl-user-location-dot-stale"),this.fire(new a.k("error",s)),this._finish()}},this._finish=()=>{this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0},this._setupUI=s=>{if(this._map){if(this._container.addEventListener("contextmenu",p=>p.preventDefault()),this._geolocateButton=_.create("button","maplibregl-ctrl-geolocate",this._container),_.create("span","maplibregl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",s===!1){a.w("Geolocation support is not available so the GeolocateControl will be disabled.");const p=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.title=p,this._geolocateButton.setAttribute("aria-label",p)}else{const p=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.title=p,this._geolocateButton.setAttribute("aria-label",p)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=_.create("div","maplibregl-user-location-dot"),this._userLocationDotMarker=new dc({element:this._dotElement}),this._circleElement=_.create("div","maplibregl-user-location-accuracy-circle"),this._accuracyCircleMarker=new dc({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",this.trigger.bind(this)),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",p=>{p.geolocateSource||this._watchState!=="ACTIVE_LOCK"||p.originalEvent&&p.originalEvent.type==="resize"||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this.fire(new a.k("trackuserlocationend")))})}},this.options=a.e({},Qn,v)}onAdd(v){return this._map=v,this._container=_.create("div","maplibregl-ctrl maplibregl-ctrl-group"),function(s,p=!1){Ei===void 0||p?window.navigator.permissions!==void 0?window.navigator.permissions.query({name:"geolocation"}).then(f=>{Ei=f.state!=="denied",s(Ei)}).catch(()=>{Ei=!!window.navigator.geolocation,s(Ei)}):(Ei=!!window.navigator.geolocation,s(Ei)):s(Ei)}(this._setupUI),this._container}onRemove(){this._geolocationWatchID!==void 0&&(window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),_.remove(this._container),this._map.off("zoom",this._onZoom),this._map=void 0,Wn=0,Sh=!1}_isOutOfMapMaxBounds(v){const s=this._map.getMaxBounds(),p=v.coords;return s&&(p.longitude<s.getWest()||p.longitude>s.getEast()||p.latitude<s.getSouth()||p.latitude>s.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting");break;case"ACTIVE_ERROR":break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}}_updateCircleRadius(){const v=this._map.getBounds(),s=v.getSouthEast(),p=v.getNorthEast(),f=s.distanceTo(p),y=Math.ceil(this._accuracy/(f/this._map._container.clientHeight)*2);this._circleElement.style.width=`${y}px`,this._circleElement.style.height=`${y}px`}trigger(){if(!this._setup)return a.w("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new a.k("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":Wn--,Sh=!1,this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this.fire(new a.k("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new a.k("trackuserlocationstart"));break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"OFF":break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}if(this._watchState==="OFF"&&this._geolocationWatchID!==void 0)this._clearWatch();else if(this._geolocationWatchID===void 0){let v;this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),Wn++,Wn>1?(v={maximumAge:6e5,timeout:0},Sh=!0):(v=this.options.positionOptions,Sh=!1),this._geolocationWatchID=window.navigator.geolocation.watchPosition(this._onSuccess,this._onError,v)}}else window.navigator.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0}_clearWatch(){window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},on.AttributionControl=Fs,on.LogoControl=On,on.ScaleControl=class{constructor(v){this._onMove=()=>{bp(this._map,this._container,this.options)},this.setUnit=s=>{this.options.unit=s,bp(this._map,this._container,this.options)},this.options=a.e({},xp,v)}getDefaultPosition(){return"bottom-left"}onAdd(v){return this._map=v,this._container=_.create("div","maplibregl-ctrl maplibregl-ctrl-scale",v.getContainer()),this._map.on("move",this._onMove),this._onMove(),this._container}onRemove(){_.remove(this._container),this._map.off("move",this._onMove),this._map=void 0}},on.FullscreenControl=class extends a.E{constructor(v={}){super(),this._onFullscreenChange=()=>{(window.document.fullscreenElement||window.document.mozFullScreenElement||window.document.webkitFullscreenElement||window.document.msFullscreenElement)===this._container!==this._fullscreen&&this._handleFullscreenChange()},this._onClickFullscreen=()=>{this._isFullscreen()?this._exitFullscreen():this._requestFullscreen()},this._fullscreen=!1,v&&v.container&&(v.container instanceof HTMLElement?this._container=v.container:a.w("Full screen control 'container' must be a DOM element.")),"onfullscreenchange"in document?this._fullscreenchange="fullscreenchange":"onmozfullscreenchange"in document?this._fullscreenchange="mozfullscreenchange":"onwebkitfullscreenchange"in document?this._fullscreenchange="webkitfullscreenchange":"onmsfullscreenchange"in document&&(this._fullscreenchange="MSFullscreenChange")}onAdd(v){return this._map=v,this._container||(this._container=this._map.getContainer()),this._controlContainer=_.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._setupUI(),this._controlContainer}onRemove(){_.remove(this._controlContainer),this._map=null,window.document.removeEventListener(this._fullscreenchange,this._onFullscreenChange)}_setupUI(){const v=this._fullscreenButton=_.create("button","maplibregl-ctrl-fullscreen",this._controlContainer);_.create("span","maplibregl-ctrl-icon",v).setAttribute("aria-hidden","true"),v.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),window.document.addEventListener(this._fullscreenchange,this._onFullscreenChange)}_updateTitle(){const v=this._getTitle();this._fullscreenButton.setAttribute("aria-label",v),this._fullscreenButton.title=v}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_handleFullscreenChange(){this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("maplibregl-ctrl-shrink"),this._fullscreenButton.classList.toggle("maplibregl-ctrl-fullscreen"),this._updateTitle(),this._fullscreen?(this.fire(new a.k("fullscreenstart")),this._map._cooperativeGestures&&(this._prevCooperativeGestures=this._map._cooperativeGestures,this._map.setCooperativeGestures())):(this.fire(new a.k("fullscreenend")),this._prevCooperativeGestures&&(this._map.setCooperativeGestures(this._prevCooperativeGestures),delete this._prevCooperativeGestures))}_exitFullscreen(){window.document.exitFullscreen?window.document.exitFullscreen():window.document.mozCancelFullScreen?window.document.mozCancelFullScreen():window.document.msExitFullscreen?window.document.msExitFullscreen():window.document.webkitCancelFullScreen?window.document.webkitCancelFullScreen():this._togglePseudoFullScreen()}_requestFullscreen(){this._container.requestFullscreen?this._container.requestFullscreen():this._container.mozRequestFullScreen?this._container.mozRequestFullScreen():this._container.msRequestFullscreen?this._container.msRequestFullscreen():this._container.webkitRequestFullscreen?this._container.webkitRequestFullscreen():this._togglePseudoFullScreen()}_togglePseudoFullScreen(){this._container.classList.toggle("maplibregl-pseudo-fullscreen"),this._handleFullscreenChange(),this._map.resize()}},on.TerrainControl=class{constructor(v){this._toggleTerrain=()=>{this._map.getTerrain()?this._map.setTerrain(null):this._map.setTerrain(this.options),this._updateTerrainIcon()},this._updateTerrainIcon=()=>{this._terrainButton.classList.remove("maplibregl-ctrl-terrain"),this._terrainButton.classList.remove("maplibregl-ctrl-terrain-enabled"),this._map.terrain?(this._terrainButton.classList.add("maplibregl-ctrl-terrain-enabled"),this._terrainButton.title=this._map._getUIString("TerrainControl.disableTerrain")):(this._terrainButton.classList.add("maplibregl-ctrl-terrain"),this._terrainButton.title=this._map._getUIString("TerrainControl.enableTerrain"))},this.options=v}onAdd(v){return this._map=v,this._container=_.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._terrainButton=_.create("button","maplibregl-ctrl-terrain",this._container),_.create("span","maplibregl-ctrl-icon",this._terrainButton).setAttribute("aria-hidden","true"),this._terrainButton.type="button",this._terrainButton.addEventListener("click",this._toggleTerrain),this._updateTerrainIcon(),this._map.on("terrain",this._updateTerrainIcon),this._container}onRemove(){_.remove(this._container),this._map.off("terrain",this._updateTerrainIcon),this._map=void 0}},on.Popup=class extends a.E{constructor(v){super(),this.remove=()=>(this._content&&_.remove(this._content),this._container&&(_.remove(this._container),delete this._container),this._map&&(this._map.off("move",this._update),this._map.off("move",this._onClose),this._map.off("click",this._onClose),this._map.off("remove",this.remove),this._map.off("mousemove",this._onMouseMove),this._map.off("mouseup",this._onMouseUp),this._map.off("drag",this._onDrag),delete this._map),this.fire(new a.k("close")),this),this._onMouseUp=s=>{this._update(s.point)},this._onMouseMove=s=>{this._update(s.point)},this._onDrag=s=>{this._update(s.point)},this._update=s=>{if(!this._map||!this._lngLat&&!this._trackPointer||!this._content)return;if(!this._container){if(this._container=_.create("div","maplibregl-popup",this._map.getContainer()),this._tip=_.create("div","maplibregl-popup-tip",this._container),this._container.appendChild(this._content),this.options.className)for(const C of this.options.className.split(" "))this._container.classList.add(C);this._trackPointer&&this._container.classList.add("maplibregl-popup-track-pointer")}if(this.options.maxWidth&&this._container.style.maxWidth!==this.options.maxWidth&&(this._container.style.maxWidth=this.options.maxWidth),this._map.transform.renderWorldCopies&&!this._trackPointer&&(this._lngLat=Nf(this._lngLat,this._pos,this._map.transform)),this._trackPointer&&!s)return;const p=this._pos=this._trackPointer&&s?s:this._map.project(this._lngLat);let f=this.options.anchor;const y=Th(this.options.offset);if(!f){const C=this._container.offsetWidth,M=this._container.offsetHeight;let L;L=p.y+y.bottom.y<M?["top"]:p.y>this._map.transform.height-M?["bottom"]:[],p.x<C/2?L.push("left"):p.x>this._map.transform.width-C/2&&L.push("right"),f=L.length===0?"bottom":L.join("-")}const x=p.add(y[f]).round();_.setTransform(this._container,`${ha[f]} translate(${x.x}px,${x.y}px)`),Dg(this._container,f,"popup")},this._onClose=()=>{this.remove()},this.options=a.e(Object.create(kf),v)}addTo(v){return this._map&&this.remove(),this._map=v,this.options.closeOnClick&&this._map.on("click",this._onClose),this.options.closeOnMove&&this._map.on("move",this._onClose),this._map.on("remove",this.remove),this._update(),this._focusFirstElement(),this._trackPointer?(this._map.on("mousemove",this._onMouseMove),this._map.on("mouseup",this._onMouseUp),this._container&&this._container.classList.add("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer")):this._map.on("move",this._update),this.fire(new a.k("open")),this}isOpen(){return!!this._map}getLngLat(){return this._lngLat}setLngLat(v){return this._lngLat=a.L.convert(v),this._pos=null,this._trackPointer=!1,this._update(),this._map&&(this._map.on("move",this._update),this._map.off("mousemove",this._onMouseMove),this._container&&this._container.classList.remove("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.remove("maplibregl-track-pointer")),this}trackPointer(){return this._trackPointer=!0,this._pos=null,this._update(),this._map&&(this._map.off("move",this._update),this._map.on("mousemove",this._onMouseMove),this._map.on("drag",this._onDrag),this._container&&this._container.classList.add("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer")),this}getElement(){return this._container}setText(v){return this.setDOMContent(document.createTextNode(v))}setHTML(v){const s=document.createDocumentFragment(),p=document.createElement("body");let f;for(p.innerHTML=v;f=p.firstChild,f;)s.appendChild(f);return this.setDOMContent(s)}getMaxWidth(){var v;return(v=this._container)===null||v===void 0?void 0:v.style.maxWidth}setMaxWidth(v){return this.options.maxWidth=v,this._update(),this}setDOMContent(v){if(this._content)for(;this._content.hasChildNodes();)this._content.firstChild&&this._content.removeChild(this._content.firstChild);else this._content=_.create("div","maplibregl-popup-content",this._container);return this._content.appendChild(v),this._createCloseButton(),this._update(),this._focusFirstElement(),this}addClassName(v){this._container&&this._container.classList.add(v)}removeClassName(v){this._container&&this._container.classList.remove(v)}setOffset(v){return this.options.offset=v,this._update(),this}toggleClassName(v){if(this._container)return this._container.classList.toggle(v)}_createCloseButton(){this.options.closeButton&&(this._closeButton=_.create("button","maplibregl-popup-close-button",this._content),this._closeButton.type="button",this._closeButton.setAttribute("aria-label","Close popup"),this._closeButton.innerHTML="&#215;",this._closeButton.addEventListener("click",this._onClose))}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;const v=this._container.querySelector(Of);v&&v.focus()}},on.Marker=dc,on.Style=ki,on.LngLat=a.L,on.LngLatBounds=ue,on.Point=a.P,on.MercatorCoordinate=a.U,on.Evented=a.E,on.AJAXError=a.bi,on.config=a.c,on.CanvasSource=ls,on.GeoJSONSource=co,on.ImageSource=Ye,on.RasterDEMTileSource=ln,on.RasterTileSource=jr,on.VectorTileSource=br,on.VideoSource=na,on.setRTLTextPlugin=a.bj,on.getRTLTextPluginStatus=a.bk,on.prewarm=function(){ia().acquire(yr)},on.clearPrewarmedResources=function(){const v=ai;v&&(v.isPreloaded()&&v.numActive()===1?(v.release(yr),ai=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},Ff.extend(on,{isSafari:a.ac,getPerformanceMetrics:a.bg.getPerformanceMetrics}),on});var h=i;return h})})(C2);var P2=C2.exports;const yx=E2(P2),QP=JP({__proto__:null,default:yx},[P2]),A2=Object.freeze(Object.defineProperty({__proto__:null,default:yx,o:QP},Symbol.toStringTag,{value:"Module"}));var L2={},tA=Object.defineProperty,R2=e=>{throw TypeError(e)},eA=(e,t,r)=>t in e?tA(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,_w=(e,t,r)=>eA(e,typeof t!="symbol"?t+"":t,r),D2=(e,t,r)=>t.has(e)||R2("Cannot "+r),Kl=(e,t,r)=>(D2(e,t,"read from private field"),r?r.call(e):t.get(e)),vw=(e,t,r)=>t.has(e)?R2("Cannot add the same private member more than once"):t instanceof WeakSet?t.add(e):t.set(e,r),K0=(e,t,r,n)=>(D2(e,t,"write to private field"),n?n.call(e,r):t.set(e,r),r);function ni(){}function rA(e,t){for(const r in t)e[r]=t[r];return e}function N2(e){return e()}function xw(){return Object.create(null)}function Jc(e){e.forEach(N2)}function k2(e){return typeof e=="function"}function ip(e,t){return e!=e?t==t:e!==t||e&&typeof e=="object"||typeof e=="function"}let iy;function Ts(e,t){return e===t?!0:(iy||(iy=document.createElement("a")),iy.href=t,e===iy.href)}function nA(e){return Object.keys(e).length===0}function iA(e,t,r,n){if(e){const i=O2(e,t,r,n);return e[0](i)}}function O2(e,t,r,n){return e[1]&&n?rA(r.ctx.slice(),e[1](n(t))):r.ctx}function oA(e,t,r,n){if(e[2]&&n){const i=e[2](n(r));if(t.dirty===void 0)return i;if(typeof i=="object"){const l=[],h=Math.max(t.dirty.length,i.length);for(let a=0;a<h;a+=1)l[a]=t.dirty[a]|i[a];return l}return t.dirty|i}return t.dirty}function sA(e,t,r,n,i,l){if(i){const h=O2(t,r,n,l);e.p(h,i)}}function aA(e){if(e.ctx.length>32){const t=[],r=e.ctx.length/32;for(let n=0;n<r;n++)t[n]=-1;return t}return-1}function bw(e){return e??""}function sn(e,t){e.appendChild(t)}function gi(e,t,r){e.insertBefore(t,r||null)}function oi(e){e.parentNode&&e.parentNode.removeChild(e)}function Bn(e){return document.createElement(e)}function iu(e){return document.createElementNS("http://www.w3.org/2000/svg",e)}function Uh(e){return document.createTextNode(e)}function za(){return Uh(" ")}function lA(){return Uh("")}function Zs(e,t,r,n){return e.addEventListener(t,r,n),()=>e.removeEventListener(t,r,n)}function uA(e){return function(t){return t.preventDefault(),e.call(this,t)}}function ee(e,t,r){r==null?e.removeAttribute(t):e.getAttribute(t)!==r&&e.setAttribute(t,r)}function cA(e){return Array.from(e.childNodes)}function Tm(e,t){t=""+t,e.data!==t&&(e.data=t)}function ww(e,t){e.value=t??""}function Sl(e,t,r){e.classList.toggle(t,!!r)}function hA(e,t,{bubbles:r=!1,cancelable:n=!1}={}){return new CustomEvent(e,{detail:t,bubbles:r,cancelable:n})}let Im;function Em(e){Im=e}function F2(){if(!Im)throw new Error("Function called outside component initialization");return Im}function pA(e){F2().$$.on_destroy.push(e)}function dA(){const e=F2();return(t,r,{cancelable:n=!1}={})=>{const i=e.$$.callbacks[t];if(i){const l=hA(t,r,{cancelable:n});return i.slice().forEach(h=>{h.call(e,l)}),!l.defaultPrevented}return!0}}function Ew(e,t){const r=e.$$.callbacks[t.type];r&&r.slice().forEach(n=>n.call(this,t))}const Cd=[],Cv=[];let Fd=[];const Sw=[],fA=Promise.resolve();let Mv=!1;function mA(){Mv||(Mv=!0,fA.then(z2))}function Pv(e){Fd.push(e)}const J0=new Set;let bd=0;function z2(){if(bd!==0)return;const e=Im;do{try{for(;bd<Cd.length;){const t=Cd[bd];bd++,Em(t),gA(t.$$)}}catch(t){throw Cd.length=0,bd=0,t}for(Em(null),Cd.length=0,bd=0;Cv.length;)Cv.pop()();for(let t=0;t<Fd.length;t+=1){const r=Fd[t];J0.has(r)||(J0.add(r),r())}Fd.length=0}while(Cd.length);for(;Sw.length;)Sw.pop()();Mv=!1,J0.clear(),Em(e)}function gA(e){if(e.fragment!==null){e.update(),Jc(e.before_update);const t=e.dirty;e.dirty=[-1],e.fragment&&e.fragment.p(e.ctx,t),e.after_update.forEach(Pv)}}function yA(e){const t=[],r=[];Fd.forEach(n=>e.indexOf(n)===-1?t.push(n):r.push(n)),r.forEach(n=>n()),Fd=t}const Ry=new Set;let Cp;function Dy(){Cp={r:0,c:[],p:Cp}}function Ny(){Cp.r||Jc(Cp.c),Cp=Cp.p}function Wi(e,t){e&&e.i&&(Ry.delete(e),e.i(t))}function zo(e,t,r,n){if(e&&e.o){if(Ry.has(e))return;Ry.add(e),Cp.c.push(()=>{Ry.delete(e),n&&(r&&e.d(1),n())}),e.o(t)}else n&&n()}function Tw(e){return(e==null?void 0:e.length)!==void 0?e:Array.from(e)}function _A(e,t){zo(e,1,1,()=>{t.delete(e.key)})}function vA(e,t,r,n,i,l,h,a,g,_,E,S){let A=e.length,O=l.length,k=A;const G={};for(;k--;)G[e[k].key]=k;const W=[],U=new Map,tt=new Map,$=[];for(k=O;k--;){const ot=S(i,l,k),et=r(ot);let wt=h.get(et);wt?$.push(()=>wt.p(ot,t)):(wt=_(et,ot),wt.c()),U.set(et,W[k]=wt),et in G&&tt.set(et,Math.abs(k-G[et]))}const V=new Set,it=new Set;function vt(ot){Wi(ot,1),ot.m(a,E),h.set(ot.key,ot),E=ot.first,O--}for(;A&&O;){const ot=W[O-1],et=e[A-1],wt=ot.key,J=et.key;ot===et?(E=ot.first,A--,O--):U.has(J)?!h.has(wt)||V.has(wt)?vt(ot):it.has(J)?A--:tt.get(wt)>tt.get(J)?(it.add(wt),vt(ot)):(V.add(J),A--):(g(et,h),A--)}for(;A--;){const ot=e[A];U.has(ot.key)||g(ot,h)}for(;O;)vt(W[O-1]);return Jc($),W}function jh(e){e&&e.c()}function Bc(e,t,r){const{fragment:n,after_update:i}=e.$$;n&&n.m(t,r),Pv(()=>{const l=e.$$.on_mount.map(N2).filter(k2);e.$$.on_destroy?e.$$.on_destroy.push(...l):Jc(l),e.$$.on_mount=[]}),i.forEach(Pv)}function $c(e,t){const r=e.$$;r.fragment!==null&&(yA(r.after_update),Jc(r.on_destroy),r.fragment&&r.fragment.d(t),r.on_destroy=r.fragment=null,r.ctx=[])}function xA(e,t){e.$$.dirty[0]===-1&&(Cd.push(e),mA(),e.$$.dirty.fill(0)),e.$$.dirty[t/31|0]|=1<<t%31}function op(e,t,r,n,i,l,h=null,a=[-1]){const g=Im;Em(e);const _=e.$$={fragment:null,ctx:[],props:l,update:ni,not_equal:i,bound:xw(),on_mount:[],on_destroy:[],on_disconnect:[],before_update:[],after_update:[],context:new Map(t.context||(g?g.$$.context:[])),callbacks:xw(),dirty:a,skip_bound:!1,root:t.target||g.$$.root};h&&h(_.root);let E=!1;if(_.ctx=r?r(e,t.props||{},(S,A,...O)=>{const k=O.length?O[0]:A;return _.ctx&&i(_.ctx[S],_.ctx[S]=k)&&(!_.skip_bound&&_.bound[S]&&_.bound[S](k),E&&xA(e,S)),A}):[],_.update(),E=!0,Jc(_.before_update),_.fragment=n?n(_.ctx):!1,t.target){if(t.hydrate){const S=cA(t.target);_.fragment&&_.fragment.l(S),S.forEach(oi)}else _.fragment&&_.fragment.c();t.intro&&Wi(e.$$.fragment),Bc(e,t.target,t.anchor),z2()}Em(g)}let sp=class{constructor(){_w(this,"$$"),_w(this,"$$set")}$destroy(){$c(this,1),this.$destroy=ni}$on(t,r){if(!k2(r))return ni;const n=this.$$.callbacks[t]||(this.$$.callbacks[t]=[]);return n.push(r),()=>{const i=n.indexOf(r);i!==-1&&n.splice(i,1)}}$set(t){this.$$set&&!nA(t)&&(this.$$.skip_bound=!0,this.$$set(t),this.$$.skip_bound=!1)}};const bA="4";typeof window<"u"&&(window.__svelte||(window.__svelte={v:new Set})).v.add(bA);function wA(e){let t,r;return{c(){t=iu("svg"),r=iu("path"),ee(r,"d","M13.12.706a.982.982 0 0 0-1.391 0L6.907 5.517 2.087.696a.982.982 0 1 0-1.391 1.39l4.821 4.821L.696 11.73a.982.982 0 1 0 1.39 1.39l4.821-4.821 4.822 4.821a.982.982 0 1 0 1.39-1.39L8.298 6.908l4.821-4.822a.988.988 0 0 0 0-1.38Z"),ee(t,"viewBox","0 0 14 14"),ee(t,"width","13"),ee(t,"height","13"),ee(t,"class","svelte-en2qvf")},m(n,i){gi(n,t,i),sn(t,r)},p:ni,i:ni,o:ni,d(n){n&&oi(t)}}}let B2=class extends sp{constructor(t){super(),op(this,t,null,wA,ip,{})}};function EA(e){let t,r;return{c(){t=iu("svg"),r=iu("path"),ee(r,"d","M15 0C6.705 0 0 6.705 0 15C0 23.295 6.705 30 15 30C23.295 30 30 23.295 30 15C30 6.705 23.295 0 15 0ZM22.5 20.385L20.385 22.5L15 17.115L9.615 22.5L7.5 20.385L12.885 15L7.5 9.615L9.615 7.5L15 12.885L20.385 7.5L22.5 9.615L17.115 15L22.5 20.385Z"),ee(t,"viewBox","0 0 30 30"),ee(t,"fill","none"),ee(t,"xmlns","http://www.w3.org/2000/svg"),ee(t,"class","svelte-d2loi5")},m(n,i){gi(n,t,i),sn(t,r)},p:ni,i:ni,o:ni,d(n){n&&oi(t)}}}let $2=class extends sp{constructor(t){super(),op(this,t,null,EA,ip,{})}};function SA(e){let t,r;return{c(){t=Bn("img"),Ts(t.src,r=e[3]+"area.svg")||ee(t,"src",r),ee(t,"alt",e[6]),ee(t,"class","svelte-ltkwvy")},m(n,i){gi(n,t,i)},p(n,i){i&8&&!Ts(t.src,r=n[3]+"area.svg")&&ee(t,"src",r),i&64&&ee(t,"alt",n[6])},d(n){n&&oi(t)}}}function TA(e){let t,r;return{c(){t=Bn("img"),Ts(t.src,r=e[3]+"reverse.svg")||ee(t,"src",r),ee(t,"alt",e[6]),ee(t,"class","svelte-ltkwvy")},m(n,i){gi(n,t,i)},p(n,i){i&8&&!Ts(t.src,r=n[3]+"reverse.svg")&&ee(t,"src",r),i&64&&ee(t,"alt",n[6])},d(n){n&&oi(t)}}}function IA(e){let t,r;return{c(){t=Bn("img"),Ts(t.src,r=e[3]+"poi.svg")||ee(t,"src",r),ee(t,"alt",e[6]),ee(t,"class","svelte-ltkwvy")},m(n,i){gi(n,t,i)},p(n,i){i&8&&!Ts(t.src,r=n[3]+"poi.svg")&&ee(t,"src",r),i&64&&ee(t,"alt",n[6])},d(n){n&&oi(t)}}}function CA(e){let t,r;return{c(){t=Bn("img"),Ts(t.src,r=e[3]+"postal_code.svg")||ee(t,"src",r),ee(t,"alt",e[6]),ee(t,"class","svelte-ltkwvy")},m(n,i){gi(n,t,i)},p(n,i){i&8&&!Ts(t.src,r=n[3]+"postal_code.svg")&&ee(t,"src",r),i&64&&ee(t,"alt",n[6])},d(n){n&&oi(t)}}}function MA(e){let t,r;return{c(){t=Bn("img"),Ts(t.src,r=e[3]+"street.svg")||ee(t,"src",r),ee(t,"alt",e[6]),ee(t,"class","svelte-ltkwvy")},m(n,i){gi(n,t,i)},p(n,i){i&8&&!Ts(t.src,r=n[3]+"street.svg")&&ee(t,"src",r),i&64&&ee(t,"alt",n[6])},d(n){n&&oi(t)}}}function PA(e){let t,r;return{c(){t=Bn("img"),Ts(t.src,r=e[3]+"road.svg")||ee(t,"src",r),ee(t,"alt",e[6]),ee(t,"class","svelte-ltkwvy")},m(n,i){gi(n,t,i)},p(n,i){i&8&&!Ts(t.src,r=n[3]+"road.svg")&&ee(t,"src",r),i&64&&ee(t,"alt",n[6])},d(n){n&&oi(t)}}}function AA(e){let t,r;return{c(){t=Bn("img"),Ts(t.src,r=e[3]+"housenumber.svg")||ee(t,"src",r),ee(t,"alt",e[6]),ee(t,"class","svelte-ltkwvy")},m(n,i){gi(n,t,i)},p(n,i){i&8&&!Ts(t.src,r=n[3]+"housenumber.svg")&&ee(t,"src",r),i&64&&ee(t,"alt",n[6])},d(n){n&&oi(t)}}}function LA(e){let t,r,n,i;return{c(){t=Bn("img"),Ts(t.src,r=e[5])||ee(t,"src",r),ee(t,"alt",e[4]),ee(t,"class","svelte-ltkwvy")},m(l,h){gi(l,t,h),n||(i=Zs(t,"error",e[14]),n=!0)},p(l,h){h&32&&!Ts(t.src,r=l[5])&&ee(t,"src",r),h&16&&ee(t,"alt",l[4])},d(l){l&&oi(t),n=!1,i()}}}function Iw(e){let t,r;return{c(){t=Bn("span"),r=Uh(e[6]),ee(t,"class","secondary svelte-ltkwvy")},m(n,i){gi(n,t,i),sn(t,r)},p(n,i){i&64&&Tm(r,n[6])},d(n){n&&oi(t)}}}function RA(e){let t,r,n,i,l,h,a,g,_,E=(e[7]?e[0].place_name:e[0].place_name.replace(/,.*/,""))+"",S,A,O=e[2]==="always"||e[2]&&!e[0].address&&!e[0].id.startsWith("road.")&&!e[0].id.startsWith("address.")&&!e[0].id.startsWith("postal_code.")&&(!e[0].id.startsWith("poi.")||!e[5])&&!e[7],k,G,W=(e[7]?"":e[0].place_name.replace(/[^,]*,?\s*/,""))+"",U,tt,$;function V(et,wt){return wt&1&&(r=null),wt&1&&(n=null),wt&1&&(i=null),wt&1&&(l=null),et[5]?LA:et[0].address?AA:(r==null&&(r=!!et[0].id.startsWith("road.")),r?PA:(n==null&&(n=!!et[0].id.startsWith("address.")),n?MA:(i==null&&(i=!!et[0].id.startsWith("postal_code.")),i?CA:(l==null&&(l=!!et[0].id.startsWith("poi.")),l?IA:et[7]?TA:SA))))}let it=V(e,-1),vt=it(e),ot=O&&Iw(e);return{c(){t=Bn("li"),vt.c(),h=za(),a=Bn("span"),g=Bn("span"),_=Bn("span"),S=Uh(E),A=za(),ot&&ot.c(),k=za(),G=Bn("span"),U=Uh(W),ee(_,"class","primary svelte-ltkwvy"),ee(g,"class","svelte-ltkwvy"),ee(G,"class","line2 svelte-ltkwvy"),ee(a,"class","texts svelte-ltkwvy"),ee(t,"tabindex","0"),ee(t,"data-selected",e[1]),ee(t,"class","svelte-ltkwvy"),Sl(t,"selected",e[1])},m(et,wt){gi(et,t,wt),vt.m(t,null),sn(t,h),sn(t,a),sn(a,g),sn(g,_),sn(_,S),sn(g,A),ot&&ot.m(g,null),sn(a,k),sn(a,G),sn(G,U),tt||($=[Zs(t,"mouseenter",e[12]),Zs(t,"focus",e[13])],tt=!0)},p(et,[wt]){it===(it=V(et,wt))&&vt?vt.p(et,wt):(vt.d(1),vt=it(et),vt&&(vt.c(),vt.m(t,h))),wt&1&&E!==(E=(et[7]?et[0].place_name:et[0].place_name.replace(/,.*/,""))+"")&&Tm(S,E),wt&37&&(O=et[2]==="always"||et[2]&&!et[0].address&&!et[0].id.startsWith("road.")&&!et[0].id.startsWith("address.")&&!et[0].id.startsWith("postal_code.")&&(!et[0].id.startsWith("poi.")||!et[5])&&!et[7]),O?ot?ot.p(et,wt):(ot=Iw(et),ot.c(),ot.m(g,null)):ot&&(ot.d(1),ot=null),wt&1&&W!==(W=(et[7]?"":et[0].place_name.replace(/[^,]*,?\s*/,""))+"")&&Tm(U,W),wt&2&&ee(t,"data-selected",et[1]),wt&2&&Sl(t,"selected",et[1])},i:ni,o:ni,d(et){et&&oi(t),vt.d(),ot&&ot.d(),tt=!1,Jc($)}}}function DA(e,t,r){var n;let i,l,{feature:h}=t,{selected:a=!1}=t,{showPlaceType:g}=t,{missingIconsCache:_}=t,{iconsBaseUrl:E}=t;const S=(n=h.properties)==null?void 0:n.categories;let A,O,k=0,G=h.place_type[0]==="reverse";function W(){O&&_.add(O),r(10,k++,k)}function U(V){Ew.call(this,e,V)}function tt(V){Ew.call(this,e,V)}const $=()=>W();return e.$$set=V=>{"feature"in V&&r(0,h=V.feature),"selected"in V&&r(1,a=V.selected),"showPlaceType"in V&&r(2,g=V.showPlaceType),"missingIconsCache"in V&&r(9,_=V.missingIconsCache),"iconsBaseUrl"in V&&r(3,E=V.iconsBaseUrl)},e.$$.update=()=>{var V,it,vt,ot;if(e.$$.dirty&3640)do r(11,i--,i),r(4,A=S==null?void 0:S[i]),r(5,O=A?E+A.replace(/ /g,"_")+".svg":void 0);while(i>-1&&(!O||_.has(O)));e.$$.dirty&1&&r(6,l=((it=(V=h.properties)==null?void 0:V.categories)==null?void 0:it.join(", "))??((ot=(vt=h.properties)==null?void 0:vt.place_type_name)==null?void 0:ot[0])??h.place_type[0])},r(11,i=(S==null?void 0:S.length)??0),[h,a,g,E,A,O,l,G,W,_,k,i,U,tt,$]}let NA=class extends sp{constructor(t){super(),op(this,t,DA,RA,ip,{feature:0,selected:1,showPlaceType:2,missingIconsCache:9,iconsBaseUrl:3})}};function kA(e){let t;return{c(){t=Bn("div"),t.innerHTML='<svg viewBox="0 0 18 18" width="24" height="24" class="svelte-7cmwmc"><path fill="#333" d="M4.4 4.4l.8.8c2.1-2.1 5.5-2.1 7.6 0l.8-.8c-2.5-2.5-6.7-2.5-9.2 0z"></path><path opacity=".1" d="M12.8 12.9c-2.1 2.1-5.5 2.1-7.6 0-2.1-2.1-2.1-5.5 0-7.7l-.8-.8c-2.5 2.5-2.5 6.7 0 9.2s6.6 2.5 9.2 0 2.5-6.6 0-9.2l-.8.8c2.2 2.1 2.2 5.6 0 7.7z"></path></svg>',ee(t,"class","svelte-7cmwmc")},m(r,n){gi(r,t,n)},p:ni,i:ni,o:ni,d(r){r&&oi(t)}}}let OA=class extends sp{constructor(t){super(),op(this,t,null,kA,ip,{})}};function FA(e){let t,r,n;return{c(){t=iu("svg"),r=iu("path"),ee(r,"stroke-width","4"),ee(r,"d","M 5,33.103579 C 5,17.607779 18.457,5 35,5 C 51.543,5 65,17.607779 65,33.103579 C 65,56.388679 40.4668,76.048179 36.6112,79.137779 C 36.3714,79.329879 36.2116,79.457979 36.1427,79.518879 C 35.8203,79.800879 35.4102,79.942779 35,79.942779 C 34.5899,79.942779 34.1797,79.800879 33.8575,79.518879 C 33.7886,79.457979 33.6289,79.330079 33.3893,79.138079 C 29.5346,76.049279 5,56.389379 5,33.103579 Z M 35.0001,49.386379 C 43.1917,49.386379 49.8323,42.646079 49.8323,34.331379 C 49.8323,26.016779 43.1917,19.276479 35.0001,19.276479 C 26.8085,19.276479 20.1679,26.016779 20.1679,34.331379 C 20.1679,42.646079 26.8085,49.386379 35.0001,49.386379 Z"),ee(r,"class","svelte-gzo3ar"),ee(t,"width",n=e[0]==="list"?20:void 0),ee(t,"viewBox","0 0 70 85"),ee(t,"fill","none"),ee(t,"class","svelte-gzo3ar"),Sl(t,"in-map",e[0]!=="list"),Sl(t,"list-icon",e[0]==="list")},m(i,l){gi(i,t,l),sn(t,r)},p(i,[l]){l&1&&n!==(n=i[0]==="list"?20:void 0)&&ee(t,"width",n),l&1&&Sl(t,"in-map",i[0]!=="list"),l&1&&Sl(t,"list-icon",i[0]==="list")},i:ni,o:ni,d(i){i&&oi(t)}}}function zA(e,t,r){let{displayIn:n}=t;return e.$$set=i=>{"displayIn"in i&&r(0,n=i.displayIn)},[n]}let BA=class extends sp{constructor(t){super(),op(this,t,zA,FA,ip,{displayIn:0})}};function $A(e){let t,r;return{c(){t=iu("svg"),r=iu("path"),ee(r,"d","M30.003-26.765C13.46-26.765 0-14.158 0 1.337c0 23.286 24.535 42.952 28.39 46.04.24.192.402.316.471.376.323.282.732.424 1.142.424.41 0 .82-.142 1.142-.424.068-.06.231-.183.471-.376 3.856-3.09 28.39-22.754 28.39-46.04 0-15.495-13.46-28.102-30.003-28.102Zm1.757 12.469c4.38 0 7.858 1.052 10.431 3.158 2.595 2.105 3.89 4.913 3.89 8.422 0 2.34-.53 4.362-1.593 6.063-1.063 1.702-3.086 3.616-6.063 5.742-2.042 1.51-3.337 2.659-3.89 3.446-.532.787-.8 1.82-.8 3.096v1.914h-8.449V15.18c0-2.041.434-3.815 1.306-5.325.872-1.51 2.467-3.118 4.785-4.82 2.233-1.594 3.7-2.89 4.402-3.889a5.582 5.582 0 0 0 1.087-3.35c0-1.382-.51-2.435-1.531-3.158-1.02-.723-2.45-1.087-4.28-1.087-3.19 0-6.826 1.047-10.91 3.131l-3.472-6.986c4.742-2.659 9.77-3.992 15.087-3.992Zm-1.88 37.324c1.765 0 3.124.472 4.08 1.408.98.936 1.47 2.276 1.47 4.02 0 1.68-.49 3.007-1.47 3.985-.977.957-2.336 1.435-4.08 1.435-1.787 0-3.171-.465-4.15-1.4-.978-.958-1.47-2.298-1.47-4.02 0-1.787.48-3.14 1.436-4.054.957-.915 2.355-1.374 4.184-1.374Z"),ee(t,"viewBox","0 0 60.006 21.412"),ee(t,"width","14"),ee(t,"height","20"),ee(t,"class","svelte-en2qvf")},m(n,i){gi(n,t,i),sn(t,r)},p:ni,i:ni,o:ni,d(n){n&&oi(t)}}}let UA=class extends sp{constructor(t){super(),op(this,t,null,$A,ip,{})}};function jA(e){let t,r,n;return{c(){t=iu("svg"),r=iu("circle"),n=iu("path"),ee(r,"cx","4.789"),ee(r,"cy","4.787"),ee(r,"r","3.85"),ee(r,"class","svelte-1aq105l"),ee(n,"d","M12.063 12.063 7.635 7.635"),ee(n,"class","svelte-1aq105l"),ee(t,"xmlns","http://www.w3.org/2000/svg"),ee(t,"width","13"),ee(t,"height","13"),ee(t,"viewBox","0 0 13 13"),ee(t,"class","svelte-1aq105l")},m(i,l){gi(i,t,l),sn(t,r),sn(t,n)},p:ni,i:ni,o:ni,d(i){i&&oi(t)}}}let VA=class extends sp{constructor(t){super(),op(this,t,null,jA,ip,{})}};function GA(e,t,r){const n=t[1],i=t[0],l=n-i;return e===n&&r?e:((e-i)%l+l)%l+i}function Zy(e){const t=[...e];return t[2]<t[0]&&(Math.abs((t[0]+t[2]+360)/2)>Math.abs((t[0]-360+t[2])/2)?t[0]-=360:t[2]+=360),t}let om;async function qA(e,t,r){const n=e==null?void 0:e.getCenterAndZoom();for(const i of t??[])if(!(n&&(i.minZoom!=null&&i.minZoom>n[0]||i.maxZoom!=null&&i.maxZoom<n[0]))){if(i.type==="fixed")return i.coordinates.join(",");t:if(i.type==="client-geolocation"){if(om&&i.cachedLocationExpiry&&om.time+i.cachedLocationExpiry>Date.now()){if(!om.coords)break t;return om.coords}let l;try{return l=await new Promise((h,a)=>{r.signal.addEventListener("abort",()=>{a(Error("aborted"))}),navigator.geolocation.getCurrentPosition(g=>{h([g.coords.longitude,g.coords.latitude].map(_=>_.toFixed(6)).join(","))},g=>{a(g)},i)}),l}catch{}finally{i.cachedLocationExpiry&&(om={time:Date.now(),coords:l})}if(r.signal.aborted)return}if(i.type==="server-geolocation")return"ip";if(n&&i.type==="map-center")return n[1].toFixed(6)+","+n[2].toFixed(6)}}const ZA=/^(NORTH|SOUTH|[NS])?\s*([+-]?[0-8]?[0-9])\s*([\.:]|D(?:EG)?(?:REES)?)?\s*,?([6-9][0-9])\s*(['\.:]|M(?:IN)?(?:UTES)?)?\s*(NORTH|SOUTH|[NS])?(?:\s*[,/;]\s*|\s*)(EAST|WEST|[EW])?\s*([+-]?[0-1]?[0-9]?[0-9])\s*([\.:]|D(?:EG)?(?:REES)?)?\s*,?([6-9][0-9])\s*(['\.:]|M(?:IN)?(?:UTES)?)?\s*(EAST|WEST|[EW])?$/i,Cw=/^([+-]?[0-8]?[0-9])\s+([0-5]?[0-9]\.\d{3,})[\s,]{1,}([+-]?[0-1]?[0-9]?[0-9])\s+([0-5]?[0-9]\.\d{3,})$/,Mw=/^(NORTH|SOUTH|[NS])?[\s]*([+-]?[0-8]?[0-9](?:[\.,]\d{3,}))[\s]*([]?)[\s]*(NORTH|SOUTH|[NS])?[\s]*[,/;]?[\s]*(EAST|WEST|[EW])?[\s]*([+-]?[0-1]?[0-9]?[0-9](?:[\.,]\d{3,}))[\s]*([]?)[\s]*(EAST|WEST|[EW])?$/i,Pw=/^(NORTH|SOUTH|[NS])?\s*([+-]?[0-8]?[0-9])\s*(\.)\s*([0-5]?[0-9])\s*(\.)\s*((?:[0-5]?[0-9])(?:[\.,]\d{1,3})?)?\s*(NORTH|SOUTH|[NS])?(?:\s*[,/;]\s*|\s*)(EAST|WEST|[EW])?\s*([+-]?[0-1]?[0-9]?[0-9])\s*(\.)\s*([0-5]?[0-9])\s*(\.)\s*((?:[0-5]?[0-9])(?:[\.,]\d{1,3})?)?\s*(EAST|WEST|[EW])?$/i,Aw=/^(NORTH|SOUTH|[NS])?\s*([+-]?[0-8]?[0-9])\s*(D(?:EG)?(?:REES)?)\s*([0-5]?[0-9])\s*(M(?:IN)?(?:UTES)?)\s*((?:[0-5]?[0-9])(?:[\.,]\d{1,3})?)?\s*(S(?:EC)?(?:ONDS)?)?\s*(NORTH|SOUTH|[NS])?(?:\s*[,/;]\s*|\s*)(EAST|WEST|[EW])?\s*([+-]?[0-1]?[0-9]?[0-9])\s*(D(?:EG)?(?:REES)?)\s*([0-5]?[0-9])\s*(M(?:IN)?(?:UTES)?)\s*((?:[0-5]?[0-9])(?:[\.,]\d{1,3})?)?\s*(S(?:EC)?(?:ONDS)?)\s*(EAST|WEST|[EW])?$/i,Lw=/^(NORTH|SOUTH|[NS])?\s*([+-]?[0-8]?[0-9])\s*([\.:]|D(?:EG)?(?:REES)?)?\s*,?([0-5]?[0-9](?:[\.,]\d{1,})?)?\s*(['\.:]|M(?:IN)?(?:UTES)?)?\s*,?((?:[0-5]?[0-9])(?:[\.,]\d{1,3})?)?\s*(''||||["\.])?\s*(NORTH|SOUTH|[NS])?(?:\s*[,/;]\s*|\s*)(EAST|WEST|[EW])?\s*([+-]?[0-1]?[0-9]?[0-9])\s*([\.:]|D(?:EG)?(?:REES)?)?\s*,?([0-5]?[0-9](?:[\.,]\d{1,})?)?\s*(['\.:]|M(?:IN)?(?:UTES)?)?\s*,?((?:[0-5]?[0-9])(?:[\.,]\d{1,3})?)?\s*(''||||["\.])?\s*(EAST|WEST|[EW])?$/i;function WA(e){if(!["DMS","DM","DD"].includes(e))throw new Error("invalid format specified");if(this.decimalCoordinates&&this.decimalCoordinates.trim()){const t=this.decimalCoordinates.split(",").map(O=>Number(O.trim())),r=Number(t[0]),n=Number(t[1]),i=Math.abs(r),l=Math.abs(n),h=r>0?"N":"S",a=n>0?"E":"W";let g;e=="DD"&&(g=`${i} ${h}, ${l} ${a}`);const _=Math.floor(i),E=Math.floor(l),S=(i-_)*60,A=(l-E)*60;if(e=="DM"){let O=Rw(S,3).toFixed(3).padStart(6,"0"),k=Rw(A,3).toFixed(3).padStart(6,"0");O.endsWith(".000")&&k.endsWith(".000")&&(O=O.replace(/\.000$/,""),k=k.replace(/\.000$/,"")),g=`${_} ${O}' ${h}, ${E} ${k}' ${a}`}if(e=="DMS"){const O=Math.floor(S),k=Math.floor(A);let G=((S-O)*60).toFixed(1).padStart(4,"0"),W=((A-k)*60).toFixed(1).padStart(4,"0");const U=O.toString().padStart(2,"0"),tt=k.toString().padStart(2,"0");G.endsWith(".0")&&W.endsWith(".0")&&(G=G.replace(/\.0$/,""),W=W.replace(/\.0$/,"")),g=`${_} ${U}' ${G}" ${h}, ${E} ${tt}' ${W}" ${a}`}return g}else throw new Error("no decimal coordinates to convert")}function Rw(e,t){const r=Math.pow(10,t);return Math.round((e+Number.EPSILON)*r)/r}function _x(e,t){t||(t=5),e=e.replace(/\s+/g," ").trim();let r=null,n=null,i="",l="",h=null,a=[],g=!1;if(ZA.test(e))throw new Error("invalid coordinate value");if(Cw.test(e))if(a=Cw.exec(e),g=sm(a),g)r=Math.abs(a[1])+a[2]/60,Number(a[1])<0&&(r*=-1),n=Math.abs(a[3])+a[4]/60,Number(a[3])<0&&(n*=-1),h="DM";else throw new Error("invalid coordinate format");else if(Mw.test(e))if(a=Mw.exec(e),g=sm(a),g){if(r=a[2],n=a[6],r.includes(",")&&(r=r.replace(",",".")),n.includes(",")&&(n=n.replace(",",".")),h="DD",Number(Math.round(r))==Number(r))throw new Error("integer only coordinate provided");if(Number(Math.round(n))==Number(n))throw new Error("integer only coordinate provided");a[1]?(i=a[1],l=a[5]):a[4]&&(i=a[4],l=a[8])}else throw new Error("invalid decimal coordinate format");else if(Pw.test(e))if(a=Pw.exec(e),g=sm(a),g)r=Math.abs(parseInt(a[2])),a[4]&&(r+=a[4]/60,h="DM"),a[6]&&(r+=a[6].replace(",",".")/3600,h="DMS"),parseInt(a[2])<0&&(r=-1*r),n=Math.abs(parseInt(a[9])),a[11]&&(n+=a[11]/60),a[13]&&(n+=a[13].replace(",",".")/3600),parseInt(a[9])<0&&(n=-1*n),a[1]?(i=a[1],l=a[8]):a[7]&&(i=a[7],l=a[14]);else throw new Error("invalid DMS coordinates format");else if(Aw.test(e))if(a=Aw.exec(e),g=sm(a),g)r=Math.abs(parseInt(a[2])),a[4]&&(r+=a[4]/60,h="DM"),a[6]&&(r+=a[6]/3600,h="DMS"),parseInt(a[2])<0&&(r=-1*r),n=Math.abs(parseInt(a[10])),a[12]&&(n+=a[12]/60),a[14]&&(n+=a[14]/3600),parseInt(a[10])<0&&(n=-1*n),a[1]?(i=a[1],l=a[9]):a[8]&&(i=a[8],l=a[16]);else throw new Error("invalid DMS coordinates format");else if(Lw.test(e)){if(a=Lw.exec(e),g=sm(a),a.filter(_=>_).length<=5)throw new Error("invalid coordinates format");if(g)r=Math.abs(parseInt(a[2])),a[4]&&(r+=a[4].replace(",",".")/60,h="DM"),a[6]&&(r+=a[6].replace(",",".")/3600,h="DMS"),parseInt(a[2])<0&&(r=-1*r),n=Math.abs(parseInt(a[10])),a[12]&&(n+=a[12].replace(",",".")/60),a[14]&&(n+=a[14].replace(",",".")/3600),parseInt(a[10])<0&&(n=-1*n),a[1]?(i=a[1],l=a[9]):a[8]&&(i=a[8],l=a[16]);else throw new Error("invalid coordinates format")}if(g){if(Math.abs(n)>=180)throw new Error("invalid longitude value");if(Math.abs(r)>=90)throw new Error("invalid latitude value");if(i&&!l||!i&&l)throw new Error("invalid coordinates value");if(i&&i==l)throw new Error("invalid coordinates format");r.toString().includes(",")&&(r=r.replace(",",".")),n.toString().includes(",")&&(n=n.replace(",","."));let _=/S|SOUTH/i;_.test(i)&&r>0&&(r=-1*r),_=/W|WEST/i,_.test(l)&&n>0&&(n=-1*n);const E=a[0].trim();let S,A;const O=/[,/;\u0020]/g,k=E.match(O);if(k==null){const U=Math.floor(e.length/2);S=E.substring(0,U).trim(),A=E.substring(U).trim()}else{let U;k.length%2==1?U=Math.floor(k.length/2):U=k.length/2-1;let tt=0;if(U==0)tt=E.indexOf(k[0]),S=E.substring(0,tt).trim(),A=E.substring(tt+1).trim();else{let $=0,V=0;for(;$<=U;)tt=E.indexOf(k[$],V),V=tt+1,$++;S=E.substring(0,tt).trim(),A=E.substring(tt+1).trim()}}const G=S.split(".");if(G.length==2&&G[1]==0&&G[1].length!=2)throw new Error("invalid coordinates format");const W=A.split(".");if(W.length==2&&W[1]==0&&W[1].length!=2)throw new Error("invalid coordinates format");if(/^\d+$/.test(S)||/^\d+$/.test(A))throw new Error("degree only coordinate/s provided");return r=Number(Number(r).toFixed(t)),n=Number(Number(n).toFixed(t)),Object.freeze({verbatimCoordinates:E,verbatimLatitude:S,verbatimLongitude:A,decimalLatitude:r,decimalLongitude:n,decimalCoordinates:`${r},${n}`,originalFormat:h,closeEnough:XA,toCoordinateFormat:WA})}else throw new Error("coordinates pattern match failed")}function sm(e){if(!isNaN(e[0]))return!1;const t=[...e];if(t.shift(),t.length%2>0)return!1;const r=/^[-+]?\d+([\.,]\d+)?$/,n=/[eastsouthnorthwest]+/i,i=t.length/2;for(let l=0;l<i;l++){const h=t[l],a=t[l+i],g=r.test(h)&&r.test(a),_=n.test(h)&&n.test(a),E=h==a;if(!(h==null&&a==null)){if(h==null||a==null)return!1;if(g||_||E)continue;return!1}}return!0}function Dw(e,t){const r=Math.abs(e-t);return Number(r.toFixed(6))<=1e-5}function XA(e){if(!e)throw new Error("coords must be provided");if(e.includes(",")){const t=e.split(",");if(Number(t[0])==NaN||Number(t[1])==NaN)throw new Error("coords are not valid decimals");return Dw(this.decimalLatitude,Number(t[0]))&&Dw(this.decimalLongitude,t[1])}else throw new Error("coords being tested must be separated by a comma")}const HA=Object.freeze({DMS:"DMS",DM:"DM",DD:"DD"});_x.to=HA;const YA=[{verbatimCoordinates:"40.123, -74.123",verbatimLatitude:"40.123",verbatimLongitude:"-74.123"},{verbatimCoordinates:"40.123 N 74.123 W",verbatimLatitude:"40.123 N",verbatimLongitude:"74.123 W"},{verbatimCoordinates:"40.123 N 74.123 W",verbatimLatitude:"40.123 N",verbatimLongitude:"74.123 W"},{verbatimCoordinates:'40 7 22.8" N 74 7 22.8" W',verbatimLatitude:'40 7 22.8" N',verbatimLongitude:'74 7 22.8" W'},{verbatimCoordinates:"40 7.38 , -74 7.38",verbatimLatitude:"40 7.38",verbatimLongitude:"-74 7.38"},{verbatimCoordinates:"N40722.8, W74722.8",verbatimLatitude:"N40722.8",verbatimLongitude:"W74722.8"},{verbatimCoordinates:'40722.8"N, 74722.8"W',verbatimLatitude:'40722.8"N',verbatimLongitude:'74722.8"W'},{verbatimCoordinates:`407'22.8"N, 747'22.8"W`,verbatimLatitude:`407'22.8"N`,verbatimLongitude:`747'22.8"W`},{verbatimCoordinates:"40 7 22.8, -74 7 22.8",verbatimLatitude:"40 7 22.8",verbatimLongitude:"-74 7 22.8"},{verbatimCoordinates:"40.123 -74.123",verbatimLatitude:"40.123",verbatimLongitude:"-74.123"},{verbatimCoordinates:"40.123,-74.123",verbatimLatitude:"40.123",verbatimLongitude:"-74.123"},{verbatimCoordinates:"40.123N74.123W",verbatimLatitude:"40.123N",verbatimLongitude:"74.123W"},{verbatimCoordinates:"4007.38N7407.38W",verbatimLatitude:"4007.38N",verbatimLongitude:"7407.38W"},{verbatimCoordinates:'40722.8"N, 74722.8"W',verbatimLatitude:'40722.8"N',verbatimLongitude:'74722.8"W'},{verbatimCoordinates:"400722.8N740722.8W",verbatimLatitude:"400722.8N",verbatimLongitude:"740722.8W"},{verbatimCoordinates:"N 40 7.38 W 74 7.38",verbatimLatitude:"N 40 7.38",verbatimLongitude:"W 74 7.38"},{verbatimCoordinates:"40:7:22.8N 74:7:22.8W",verbatimLatitude:"40:7:22.8N",verbatimLongitude:"74:7:22.8W"},{verbatimCoordinates:"40:7:23N,74:7:23W",verbatimLatitude:"40:7:23N",verbatimLongitude:"74:7:23W",decimalLatitude:40.1230555555,decimalLongitude:-74.1230555555},{verbatimCoordinates:'40723"N 74723"W',verbatimLatitude:'40723"N',verbatimLongitude:'74723"W',decimalLatitude:40.1230555555,decimalLongitude:-74.12305555555555},{verbatimCoordinates:'40723"S 74723"E',verbatimLatitude:'40723"S',verbatimLongitude:'74723"E',decimalLatitude:-40.1230555555,decimalLongitude:74.12305555555555},{verbatimCoordinates:'40723" -74723"',verbatimLatitude:'40723"',verbatimLongitude:'-74723"',decimalLatitude:40.1230555555,decimalLongitude:-74.123055555},{verbatimCoordinates:'40d 7 23" N 74d 7 23" W',verbatimLatitude:'40d 7 23" N',verbatimLongitude:'74d 7 23" W',decimalLatitude:40.1230555555,decimalLongitude:-74.123055555},{verbatimCoordinates:"40.123N 74.123W",verbatimLatitude:"40.123N",verbatimLongitude:"74.123W"},{verbatimCoordinates:"40 7.38, -74 7.38",verbatimLatitude:"40 7.38",verbatimLongitude:"-74 7.38"},{verbatimCoordinates:"40 7.38, -74 7.38",verbatimLatitude:"40 7.38",verbatimLongitude:"-74 7.38"},{verbatimCoordinates:"40 7 22.8; -74 7 22.8",verbatimLatitude:"40 7 22.8",verbatimLongitude:"-74 7 22.8"}],KA={decimalLatitude:40.123,decimalLongitude:-74.123},JA=[{verbatimCoordinates:`504'17.698"south, 1424'2.826"east`,verbatimLatitude:`504'17.698"south`,verbatimLongitude:`1424'2.826"east`,decimalLatitude:-50.07158277777778,decimalLongitude:14.400785},{verbatimCoordinates:"50d4m17.698S 14d24m2.826E",verbatimLatitude:"50d4m17.698S",verbatimLongitude:"14d24m2.826E",decimalLatitude:-50.07158277777778,decimalLongitude:14.400785},{verbatimCoordinates:"40:26:46N,79:56:55W",verbatimLatitude:"40:26:46N",verbatimLongitude:"79:56:55W",decimalLatitude:40.44611111111111,decimalLongitude:-79.9486111111111},{verbatimCoordinates:"40:26:46.302N 79:56:55.903W",verbatimLatitude:"40:26:46.302N",verbatimLongitude:"79:56:55.903W",decimalLatitude:40.446195,decimalLongitude:-79.94886194444445},{verbatimCoordinates:"402647N 795836W",verbatimLatitude:"402647N",verbatimLongitude:"795836W",decimalLatitude:40.44638888888889,decimalLongitude:-79.97666666666667},{verbatimCoordinates:"40d 26 47 N 79d 58 36 W",verbatimLatitude:"40d 26 47 N",verbatimLongitude:"79d 58 36 W",decimalLatitude:40.44638888888889,decimalLongitude:-79.97666666666667},{verbatimCoordinates:"40.446195N 79.948862W",verbatimLatitude:"40.446195N",verbatimLongitude:"79.948862W",decimalLatitude:40.446195,decimalLongitude:-79.948862},{verbatimCoordinates:"40,446195 79,948862",verbatimLatitude:"40,446195",verbatimLongitude:"79,948862",decimalLatitude:40.446195,decimalLongitude:79.948862},{verbatimCoordinates:"40 26.7717, -79 56.93172",verbatimLatitude:"40 26.7717",verbatimLongitude:"-79 56.93172",decimalLatitude:40.446195,decimalLongitude:-79.948862},{verbatimCoordinates:"40.446195, -79.948862",verbatimLatitude:"40.446195",verbatimLongitude:"-79.948862",decimalLatitude:40.446195,decimalLongitude:-79.948862},{verbatimCoordinates:"40.123256; -74.123256",verbatimLatitude:"40.123256",verbatimLongitude:"-74.123256",decimalLatitude:40.123256,decimalLongitude:-74.123256},{verbatimCoordinates:"1824S 2245E",verbatimLatitude:"1824S",verbatimLongitude:"2245E",decimalLatitude:-18.4,decimalLongitude:22.75}],QA=[{verbatimCoordinates:"10.432342S 10.6345345E",verbatimLatitude:"10.432342S",verbatimLongitude:"10.6345345E",decimalLatitude:-10.432342,decimalLongitude:10.6345345},{verbatimCoordinates:"10.00S 10.00E",verbatimLatitude:"10.00S",verbatimLongitude:"10.00E",decimalLatitude:-10,decimalLongitude:10},{verbatimCoordinates:"00.00S 01.00E",verbatimLatitude:"00.00S",verbatimLongitude:"01.00E",decimalLatitude:0,decimalLongitude:1},{verbatimCoordinates:"18.24S 22.45E",verbatimLatitude:"18.24S",verbatimLongitude:"22.45E",decimalLatitude:-18.4,decimalLongitude:22.75},{verbatimCoordinates:"27deg 15min 45.2sec S 18deg 32min 53.7sec E",verbatimLatitude:"27deg 15min 45.2sec S",verbatimLongitude:"18deg 32min 53.7sec E",decimalLatitude:-27.262555555555554,decimalLongitude:18.54825},{verbatimCoordinates:"-23.3245 S / 28.2344 E",verbatimLatitude:"-23.3245 S",verbatimLongitude:"28.2344 E",decimalLatitude:-23.3245,decimalLongitude:28.2344},{verbatimCoordinates:"40 26.7717 -79 56.93172",verbatimLatitude:"40 26.7717",verbatimLongitude:"-79 56.93172",decimalLatitude:40.446195,decimalLongitude:-79.948862},{verbatimCoordinates:"27.15.45S 18.32.53E",verbatimLatitude:"27.15.45S",verbatimLongitude:"18.32.53E",decimalLatitude:-27.2625,decimalLongitude:18.548055},{verbatimCoordinates:"-27.15.45 18.32.53",verbatimLatitude:"-27.15.45",verbatimLongitude:"18.32.53",decimalLatitude:-27.2625,decimalLongitude:18.548055},{verbatimCoordinates:"27.15.45.2S 18.32.53.4E",verbatimLatitude:"27.15.45.2S",verbatimLongitude:"18.32.53.4E",decimalLatitude:-27.262556,decimalLongitude:18.548167},{verbatimCoordinates:"27.15.45,2S 18.32.53,4E",verbatimLatitude:"27.15.45,2S",verbatimLongitude:"18.32.53,4E",decimalLatitude:-27.262556,decimalLongitude:18.548167},{verbatimCoordinates:"S23.43563   E22.45634 ",verbatimLatitude:"S23.43563 ",verbatimLongitude:"E22.45634 ",decimalLatitude:-23.43563,decimalLongitude:22.45634},{verbatimCoordinates:"27,71372 S 23,07771 E",verbatimLatitude:"27,71372 S",verbatimLongitude:"23,07771 E",decimalLatitude:-27.71372,decimalLongitude:23.07771},{verbatimCoordinates:"27.45.34 S 23.23.23 E",verbatimLatitude:"27.45.34 S",verbatimLongitude:"23.23.23 E",decimalLatitude:-27.759444,decimalLongitude:23.38972222},{verbatimCoordinates:"S 27.45.34 E 23.23.23",verbatimLatitude:"S 27.45.34",verbatimLongitude:"E 23.23.23",decimalLatitude:-27.759444,decimalLongitude:23.38972222},{verbatimCoordinates:"53 16.3863,4 52.8171",verbatimLatitude:"53 16.3863",verbatimLongitude:"4 52.8171",decimalLatitude:53.273105,decimalLongitude:4.88029},{verbatimCoordinates:"50 8.2914,-5 2.4447",verbatimLatitude:"50 8.2914",verbatimLongitude:"-5 2.4447",decimalLatitude:50.13819,decimalLongitude:-5.040745},{verbatimCoordinates:"N 48 30,6410', E 18 57,4583'",verbatimLatitude:"N 48 30,6410'",verbatimLongitude:"E 18 57,4583'",decimalLatitude:48.51068,decimalLongitude:18.95764},{verbatimCoordinates:"1.23456, 18.33453",verbatimLatitude:"1.23456",verbatimLongitude:"18.33453",decimalLatitude:1.23456,decimalLongitude:18.33453}];function tL(){const e=[];return YA.forEach(t=>{t.decimalLatitude?e.push(t):e.push({...t,...KA})}),[...e,...JA,...QA]}const eL=tL();_x.formats=eL.map(e=>e.verbatimCoordinates);const rL=_x;function Nw(e,t,r){const n=e.slice();return n[83]=t[r],n[85]=r,n}function kw(e){let t,r;return t=new OA({}),{c(){jh(t.$$.fragment)},m(n,i){Bc(t,n,i),r=!0},i(n){r||(Wi(t.$$.fragment,n),r=!0)},o(n){zo(t.$$.fragment,n),r=!1},d(n){$c(t,n)}}}function Ow(e){let t,r,n,i,l;return r=new UA({}),{c(){t=Bn("button"),jh(r.$$.fragment),ee(t,"type","button"),ee(t,"title",e[9]),ee(t,"class","svelte-qnu791"),Sl(t,"active",e[0])},m(h,a){gi(h,t,a),Bc(r,t,null),n=!0,i||(l=Zs(t,"click",e[68]),i=!0)},p(h,a){(!n||a[0]&512)&&ee(t,"title",h[9]),(!n||a[0]&1)&&Sl(t,"active",h[0])},i(h){n||(Wi(r.$$.fragment,h),n=!0)},o(h){zo(r.$$.fragment,h),n=!1},d(h){h&&oi(t),$c(r),i=!1,l()}}}function nL(e){let t,r=[],n=new Map,i,l,h,a=Tw(e[14]);const g=_=>_[83].id+(_[83].address?","+_[83].address:"");for(let _=0;_<a.length;_+=1){let E=Nw(e,a,_),S=g(E);n.set(S,r[_]=Fw(S,E))}return{c(){t=Bn("ul");for(let _=0;_<r.length;_+=1)r[_].c();ee(t,"class","svelte-qnu791")},m(_,E){gi(_,t,E);for(let S=0;S<r.length;S+=1)r[S]&&r[S].m(t,null);i=!0,l||(h=[Zs(t,"mouseleave",e[72]),Zs(t,"blur",e[73])],l=!0)},p(_,E){E[0]&17880064&&(a=Tw(_[14]),Dy(),r=vA(r,E,g,1,_,a,n,t,_A,Fw,null,Nw),Ny())},i(_){if(!i){for(let E=0;E<a.length;E+=1)Wi(r[E]);i=!0}},o(_){for(let E=0;E<r.length;E+=1)zo(r[E]);i=!1},d(_){_&&oi(t);for(let E=0;E<r.length;E+=1)r[E].d();l=!1,Jc(h)}}}function iL(e){let t,r,n,i,l,h;return r=new $2({}),{c(){t=Bn("div"),jh(r.$$.fragment),n=za(),i=Bn("div"),l=Uh(e[7]),ee(i,"class","svelte-qnu791"),ee(t,"class","no-results svelte-qnu791")},m(a,g){gi(a,t,g),Bc(r,t,null),sn(t,n),sn(t,i),sn(i,l),h=!0},p(a,g){(!h||g[0]&128)&&Tm(l,a[7])},i(a){h||(Wi(r.$$.fragment,a),h=!0)},o(a){zo(r.$$.fragment,a),h=!1},d(a){a&&oi(t),$c(r)}}}function oL(e){let t="",r;return{c(){r=Uh(t)},m(n,i){gi(n,r,i)},p:ni,i:ni,o:ni,d(n){n&&oi(r)}}}function sL(e){let t,r,n,i,l,h,a,g,_,E,S;return r=new $2({}),g=new B2({}),{c(){t=Bn("div"),jh(r.$$.fragment),n=za(),i=Bn("div"),l=Uh(e[6]),h=za(),a=Bn("button"),jh(g.$$.fragment),ee(i,"class","svelte-qnu791"),ee(a,"class","svelte-qnu791"),ee(t,"class","error svelte-qnu791")},m(A,O){gi(A,t,O),Bc(r,t,null),sn(t,n),sn(t,i),sn(i,l),sn(t,h),sn(t,a),Bc(g,a,null),_=!0,E||(S=Zs(a,"click",e[69]),E=!0)},p(A,O){(!_||O[0]&64)&&Tm(l,A[6])},i(A){_||(Wi(r.$$.fragment,A),Wi(g.$$.fragment,A),_=!0)},o(A){zo(r.$$.fragment,A),zo(g.$$.fragment,A),_=!1},d(A){A&&oi(t),$c(r),$c(g),E=!1,S()}}}function Fw(e,t){let r,n,i;function l(){return t[70](t[85])}function h(){return t[71](t[83])}return n=new NA({props:{feature:t[83],showPlaceType:t[10],selected:t[15]===t[85],missingIconsCache:t[20],iconsBaseUrl:t[12]}}),n.$on("mouseenter",l),n.$on("focus",h),{key:e,first:null,c(){r=lA(),jh(n.$$.fragment),this.first=r},m(a,g){gi(a,r,g),Bc(n,a,g),i=!0},p(a,g){t=a;const _={};g[0]&16384&&(_.feature=t[83]),g[0]&1024&&(_.showPlaceType=t[10]),g[0]&49152&&(_.selected=t[15]===t[85]),g[0]&4096&&(_.iconsBaseUrl=t[12]),n.$set(_)},i(a){i||(Wi(n.$$.fragment,a),i=!0)},o(a){zo(n.$$.fragment,a),i=!1},d(a){a&&oi(r),$c(n,a)}}}function aL(e){let t,r,n,i,l,h,a,g,_,E,S,A,O,k,G,W,U,tt,$,V,it,vt=!1;l=new VA({}),S=new B2({});let ot=e[19]&&kw(),et=e[5]===!0&&Ow(e);const wt=e[60].default,J=iA(wt,e,e[59],null),xt=[sL,oL,iL,nL],$t=[];function Ut(Ot,te){var ye,Me;return Ot[18]?0:Ot[16]?((ye=Ot[14])==null?void 0:ye.length)===0?2:Ot[16]&&(Me=Ot[14])!=null&&Me.length?3:-1:1}return~(W=Ut(e))&&(U=$t[W]=xt[W](e)),{c(){t=za(),r=Bn("form"),n=Bn("div"),i=Bn("button"),jh(l.$$.fragment),h=za(),a=Bn("input"),g=za(),_=Bn("div"),E=Bn("button"),jh(S.$$.fragment),A=za(),ot&&ot.c(),O=za(),et&&et.c(),k=za(),J&&J.c(),G=za(),U&&U.c(),ee(i,"class","search-button svelte-qnu791"),ee(i,"type","button"),ee(a,"placeholder",e[8]),ee(a,"aria-label",e[8]),ee(a,"class","svelte-qnu791"),ee(E,"type","button"),ee(E,"title",e[3]),ee(E,"class","svelte-qnu791"),ee(_,"class","clear-button-container svelte-qnu791"),Sl(_,"displayable",e[1]!==""),ee(n,"class","input-group svelte-qnu791"),ee(r,"tabindex","0"),ee(r,"class",tt=bw(e[2])+" svelte-qnu791"),Sl(r,"can-collapse",e[4]&&e[1]==="")},m(Ot,te){gi(Ot,t,te),gi(Ot,r,te),sn(r,n),sn(n,i),Bc(l,i,null),sn(n,h),sn(n,a),e[62](a),ww(a,e[1]),sn(n,g),sn(n,_),sn(_,E),Bc(S,E,null),sn(_,A),ot&&ot.m(_,null),sn(n,O),et&&et.m(n,null),sn(n,k),J&&J.m(n,null),sn(r,G),~W&&$t[W].m(r,null),$=!0,V||(it=[Zs(i,"click",e[61]),Zs(a,"input",e[63]),Zs(a,"focus",e[64]),Zs(a,"blur",e[65]),Zs(a,"keydown",e[22]),Zs(a,"input",e[66]),Zs(E,"click",e[67]),Zs(r,"submit",uA(e[21]))],V=!0)},p(Ot,te){(!$||te[0]&256)&&ee(a,"placeholder",Ot[8]),(!$||te[0]&256)&&ee(a,"aria-label",Ot[8]),te[0]&2&&a.value!==Ot[1]&&ww(a,Ot[1]),(!$||te[0]&8)&&ee(E,"title",Ot[3]),Ot[19]?ot?te[0]&524288&&Wi(ot,1):(ot=kw(),ot.c(),Wi(ot,1),ot.m(_,null)):ot&&(Dy(),zo(ot,1,1,()=>{ot=null}),Ny()),(!$||te[0]&2)&&Sl(_,"displayable",Ot[1]!==""),Ot[5]===!0?et?(et.p(Ot,te),te[0]&32&&Wi(et,1)):(et=Ow(Ot),et.c(),Wi(et,1),et.m(n,k)):et&&(Dy(),zo(et,1,1,()=>{et=null}),Ny()),J&&J.p&&(!$||te[1]&268435456)&&sA(J,wt,Ot,Ot[59],$?oA(wt,Ot[59],te,null):aA(Ot[59]),null);let ye=W;W=Ut(Ot),W===ye?~W&&$t[W].p(Ot,te):(U&&(Dy(),zo($t[ye],1,1,()=>{$t[ye]=null}),Ny()),~W?(U=$t[W],U?U.p(Ot,te):(U=$t[W]=xt[W](Ot),U.c()),Wi(U,1),U.m(r,null)):U=null),(!$||te[0]&4&&tt!==(tt=bw(Ot[2])+" svelte-qnu791"))&&ee(r,"class",tt),(!$||te[0]&22)&&Sl(r,"can-collapse",Ot[4]&&Ot[1]==="")},i(Ot){$||(Wi(vt),Wi(l.$$.fragment,Ot),Wi(S.$$.fragment,Ot),Wi(ot),Wi(et),Wi(J,Ot),Wi(U),$=!0)},o(Ot){zo(vt),zo(l.$$.fragment,Ot),zo(S.$$.fragment,Ot),zo(ot),zo(et),zo(J,Ot),zo(U),$=!1},d(Ot){Ot&&(oi(t),oi(r)),$c(l),e[62](null),$c(S),ot&&ot.d(),et&&et.d(),J&&J.d(Ot),~W&&$t[W].d(),V=!1,Jc(it)}}}function lL(e,t,r){let n,{$$slots:i={},$$scope:l}=t;const h={continental_marine:4,country:4,major_landform:8,region:5,subregion:6,county:7,joint_municipality:8,joint_submunicipality:9,municipality:10,municipal_district:11,locality:12,neighbourhood:13,place:14,postal_code:14,road:16,poi:17,address:18,"poi.peak":15,"poi.shop":18,"poi.cafe":18,"poi.restaurant":18,"poi.aerodrome":13};let{class:a=void 0}=t,{apiKey:g}=t,{bbox:_=void 0}=t,{clearButtonTitle:E="clear"}=t,{clearOnBlur:S=!1}=t,{collapsed:A=!1}=t,{country:O=void 0}=t,{debounceSearch:k=200}=t,{enableReverse:G=!1}=t,{errorMessage:W="Something went wrong"}=t,{filter:U=()=>!0}=t,{flyTo:tt=!0}=t,{fuzzyMatch:$=!0}=t,{language:V=void 0}=t,{limit:it=void 0}=t,{mapController:vt=void 0}=t,{minLength:ot=2}=t,{noResultsMessage:et="Oops! Looks like you're trying to predict something that's not quite right. We can't seem to find what you're looking for. Maybe try double-checking your spelling or try a different search term. Keep on typing - we'll do our best to get you where you need to go!"}=t,{placeholder:wt="Search"}=t,{proximity:J=[{type:"server-geolocation"}]}=t,{reverseActive:xt=G==="always"}=t,{reverseButtonTitle:$t="toggle reverse geocoding"}=t,{searchValue:Ut=""}=t,{showFullGeometry:Ot=!0}=t,{showPlaceType:te="ifNeeded"}=t,{showResultsWhileTyping:ye=!0}=t,{selectFirst:Me=!0}=t,{flyToSelected:ir=!1}=t,{markerOnSelected:xr=!0}=t,{types:_r=void 0}=t,{excludeTypes:kr=!1}=t,{zoom:vr=h}=t,{maxZoom:ue=void 0}=t,{apiUrl:nr="https://api.maptiler.com/geocoding"}=t,{fetchParameters:br={}}=t,{iconsBaseUrl:jr="https://cdn.maptiler.com/maptiler-geocoding-control/v1.4.1/icons/"}=t,{adjustUrlQuery:ln=()=>{}}=t;function co(){_i.focus()}function hn(){_i.blur()}function Ye(rt,bt=!0,mt=!1){r(1,Ut=rt),bt?(r(15,Kr=-1),ia()):(Ls(!mt,mt),setTimeout(()=>{_i.focus(),_i.select()}))}function na(){r(14,cr=void 0),r(56,Re=void 0),r(15,Kr=-1)}function ls(){r(55,pn=[]),r(56,Re=void 0)}let Io=!1,cr,pn,Re,us="",_i,Kr=-1,Gt,vi=[],xi,Or,yr,ho;const Co=new Set,ai=dA();pA(()=>{vt&&(vt.setEventHandler(void 0),vt.indicateReverse(!1),vt.setSelectedMarker(-1),vt.setMarkers(void 0,void 0))});function ia(rt){if(Or&&(clearTimeout(Or),Or=void 0),Kr>-1&&cr)r(56,Re=cr[Kr]),r(1,Ut=Re.place_type[0]==="reverse"?Re.place_name:Re.place_name.replace(/,.*/,"")),r(18,Gt=void 0),r(55,pn=void 0),r(15,Kr=-1);else if(Ut){const bt=rt||!cs(Ut);Ji(Ut,{exact:!0}).then(()=>{r(55,pn=cr),r(56,Re=void 0),bt&&hs()}).catch(mt=>r(18,Gt=mt))}}function cs(rt){try{return rL(rt,6)}catch{return!1}}async function Ji(rt,{byId:bt=!1,exact:mt=!1}={}){r(18,Gt=void 0),xi==null||xi.abort();const Et=new AbortController;r(19,xi=Et);try{const zt=cs(rt),Zt=new URLSearchParams;if(V!==void 0&&Zt.set("language",Array.isArray(V)?V.join(","):V??""),_r&&Zt.set("types",_r.join(",")),kr&&Zt.set("excludeTypes",String(kr)),_&&Zt.set("bbox",_.map(Ce=>Ce.toFixed(6)).join(",")),O&&Zt.set("country",Array.isArray(O)?O.join(","):O),!bt&&!zt){const Ce=await qA(vt,J,Et);Ce&&Zt.set("proximity",Ce),(mt||!ye)&&Zt.set("autocomplete","false"),Zt.set("fuzzyMatch",String($))}it!==void 0&&(!zt||(_r==null?void 0:_r.length)===1)&&Zt.set("limit",String(it)),Zt.set("key",g),ln(Zt);const Ht=nr+"/"+encodeURIComponent(zt?zt.decimalLongitude+","+zt.decimalLatitude:rt)+".json?"+Zt.toString();if(Ht===us){bt?(r(14,cr=void 0),r(56,Re=vi[0])):r(14,cr=vi);return}us=Ht;const De=await fetch(Ht,{signal:Et.signal,...br});if(!De.ok)throw new Error(await De.text());const Xe=await De.json();ai("response",{url:Ht,featureCollection:Xe}),bt?(r(14,cr=void 0),r(56,Re=Xe.features[0]),vi=[Re]):(r(14,cr=Xe.features.filter(U)),zt&&cr.unshift({type:"Feature",properties:{},id:"reverse_"+zt.decimalLongitude+"_"+zt.decimalLatitude,text:zt.decimalLatitude+", "+zt.decimalLongitude,place_name:zt.decimalLatitude+", "+zt.decimalLongitude,place_type:["reverse"],center:[zt.decimalLongitude,zt.decimalLatitude],bbox:[zt.decimalLongitude,zt.decimalLatitude,zt.decimalLongitude,zt.decimalLatitude],geometry:{type:"Point",coordinates:[zt.decimalLongitude,zt.decimalLatitude]}}),vi=cr,zt&&_i.focus())}catch(zt){if(zt&&typeof zt=="object"&&"name"in zt&&zt.name==="AbortError")return;throw zt}finally{Et===xi&&r(19,xi=void 0)}}function hs(){var rt;if(!(pn!=null&&pn.length)||!tt)return;const bt=[180,90,-180,-90],mt=!pn.some(zt=>!zt.matching_text);let Et;for(const zt of pn){const Zt=oe(zt);if(Et=ue??(Et===void 0?Zt:Zt===void 0?Et:Math.max(Et,Zt)),mt||!zt.matching_text)for(const Ht of[0,1,2,3])bt[Ht]=Math[Ht<2?"min":"max"](bt[Ht],((rt=zt.bbox)==null?void 0:rt[Ht])??zt.center[Ht%2])}vt&&pn.length>0&&(Re&&bt[0]===bt[2]&&bt[1]===bt[3]?vt.flyTo(Re.center,oe(Re)):vt.fitBounds(Zy(bt),50,Et))}function oe(rt){var bt;if(!rt.bbox||rt.bbox[0]!==rt.bbox[2]&&rt.bbox[1]!==rt.bbox[3])return;if(typeof vr=="number")return rt.id.startsWith("poi.")||rt.id.startsWith("address.")?ue:vr;const mt=rt.id.replace(/\..*/,"");return(Array.isArray((bt=rt.properties)==null?void 0:bt.categories)?rt.properties.categories.reduce((Et,zt)=>{const Zt=vr[mt+"."+zt];return Et===void 0?Zt:Zt===void 0?Et:Math.max(Et,Zt)},void 0):void 0)??vr[mt]}function po(rt){r(0,xt=G==="always"),r(14,cr=void 0),r(56,Re=void 0),r(15,Kr=-1),Ye(rt[1].toFixed(6)+", "+GA(rt[0],[-180,180],!0).toFixed(6),!1,!0)}function In(rt){if(!cr)return;let bt=rt.key==="ArrowDown"?1:rt.key==="ArrowUp"?-1:0;bt&&(Kr===(Me?0:-1)&&bt===-1&&r(15,Kr=cr.length),r(15,Kr+=bt),Kr>=cr.length&&r(15,Kr=-1),Kr<0&&Me&&r(15,Kr=0),rt.preventDefault())}function Ls(rt=!0,bt=!1){if(r(18,Gt=void 0),ye||bt){if(Or&&clearTimeout(Or),Ut.length<ot)return;const mt=Ut;Or=window.setTimeout(()=>{Ji(mt).catch(Et=>r(18,Gt=Et))},rt?k:0)}else r(14,cr=void 0),r(18,Gt=void 0)}function Ri(rt){r(56,Re=rt),r(1,Ut=rt.place_name),r(15,Kr=-1)}const ce=()=>_i.focus();function ar(rt){Cv[rt?"unshift":"push"](()=>{_i=rt,r(17,_i)})}function He(){Ut=this.value,r(1,Ut),r(13,Io),r(28,S)}const Di=()=>r(13,Io=!0),fo=()=>r(13,Io=!1),Ze=()=>Ls(),Mo=()=>{r(1,Ut=""),_i.focus()},ct=()=>r(0,xt=!xt),q=()=>r(18,Gt=void 0),X=rt=>r(15,Kr=rt),nt=rt=>Ri(rt),pt=()=>{Me||r(15,Kr=-1)},ft=()=>{};return e.$$set=rt=>{"class"in rt&&r(2,a=rt.class),"apiKey"in rt&&r(26,g=rt.apiKey),"bbox"in rt&&r(27,_=rt.bbox),"clearButtonTitle"in rt&&r(3,E=rt.clearButtonTitle),"clearOnBlur"in rt&&r(28,S=rt.clearOnBlur),"collapsed"in rt&&r(4,A=rt.collapsed),"country"in rt&&r(29,O=rt.country),"debounceSearch"in rt&&r(30,k=rt.debounceSearch),"enableReverse"in rt&&r(5,G=rt.enableReverse),"errorMessage"in rt&&r(6,W=rt.errorMessage),"filter"in rt&&r(31,U=rt.filter),"flyTo"in rt&&r(32,tt=rt.flyTo),"fuzzyMatch"in rt&&r(33,$=rt.fuzzyMatch),"language"in rt&&r(34,V=rt.language),"limit"in rt&&r(35,it=rt.limit),"mapController"in rt&&r(36,vt=rt.mapController),"minLength"in rt&&r(37,ot=rt.minLength),"noResultsMessage"in rt&&r(7,et=rt.noResultsMessage),"placeholder"in rt&&r(8,wt=rt.placeholder),"proximity"in rt&&r(38,J=rt.proximity),"reverseActive"in rt&&r(0,xt=rt.reverseActive),"reverseButtonTitle"in rt&&r(9,$t=rt.reverseButtonTitle),"searchValue"in rt&&r(1,Ut=rt.searchValue),"showFullGeometry"in rt&&r(39,Ot=rt.showFullGeometry),"showPlaceType"in rt&&r(10,te=rt.showPlaceType),"showResultsWhileTyping"in rt&&r(40,ye=rt.showResultsWhileTyping),"selectFirst"in rt&&r(11,Me=rt.selectFirst),"flyToSelected"in rt&&r(41,ir=rt.flyToSelected),"markerOnSelected"in rt&&r(42,xr=rt.markerOnSelected),"types"in rt&&r(43,_r=rt.types),"excludeTypes"in rt&&r(44,kr=rt.excludeTypes),"zoom"in rt&&r(45,vr=rt.zoom),"maxZoom"in rt&&r(46,ue=rt.maxZoom),"apiUrl"in rt&&r(47,nr=rt.apiUrl),"fetchParameters"in rt&&r(48,br=rt.fetchParameters),"iconsBaseUrl"in rt&&r(12,jr=rt.iconsBaseUrl),"adjustUrlQuery"in rt&&r(49,ln=rt.adjustUrlQuery),"$$scope"in rt&&r(59,l=rt.$$scope)},e.$$.update=()=>{if(e.$$.dirty[0]&32&&r(0,xt=G==="always"),e.$$.dirty[0]&268443648&&setTimeout(()=>{r(16,yr=Io),S&&!Io&&r(1,Ut="")}),e.$$.dirty[0]&16386|e.$$.dirty[1]&64&&Ut.length<ot&&(r(56,Re=void 0),r(14,cr=void 0),r(18,Gt=void 0),r(55,pn=cr)),e.$$.dirty[1]&33554688&&Ot&&Re&&!Re.address&&Re.geometry.type==="Point"&&Re.place_type[0]!=="reverse"&&Ji(Re.id,{byId:!0}).catch(rt=>r(18,Gt=rt)),e.$$.dirty[1]&100663330&&(vt&&Re&&Re.id!==ho&&tt&&(!Re.bbox||Re.bbox[0]===Re.bbox[2]&&Re.bbox[1]===Re.bbox[3]?vt.flyTo(Re.center,oe(Re)):vt.fitBounds(Zy(Re.bbox),50,oe(Re)),r(14,cr=void 0),r(55,pn=void 0),r(15,Kr=-1)),r(57,ho=Re==null?void 0:Re.id)),e.$$.dirty[0]&18432&&Me&&cr!=null&&cr.length&&r(15,Kr=0),e.$$.dirty[0]&2050&&(Me||r(15,Kr=-1)),e.$$.dirty[0]&16384|e.$$.dirty[1]&16777216&&pn!==cr&&r(55,pn=void 0),e.$$.dirty[0]&81921|e.$$.dirty[1]&16777248&&vt&&vt.setEventHandler(rt=>{switch(rt.type){case"mapClick":xt&&po(rt.coordinates);break;case"markerClick":{const bt=cr==null?void 0:cr.find(mt=>mt.id===rt.id);bt&&Ri(bt)}break;case"markerMouseEnter":pn&&r(15,Kr=yr?(cr==null?void 0:cr.findIndex(bt=>bt.id===rt.id))??-1:-1);break;case"markerMouseLeave":pn&&r(15,Kr=-1);break}}),e.$$.dirty[0]&49152&&r(58,n=cr==null?void 0:cr[Kr]),e.$$.dirty[1]&134218786&&vt&&n&&tt&&ir&&vt.flyTo(n.center,oe(n)),e.$$.dirty[1]&2080&&(xr||vt==null||vt.setMarkers(void 0,void 0)),e.$$.dirty[1]&150997024&&vt&&xr&&!pn&&(vt.setMarkers(n?[n]:void 0,void 0),vt.setSelectedMarker(n?0:-1)),e.$$.dirty[1]&50331680&&vt&&vt.setMarkers(pn,Re),e.$$.dirty[0]&32768|e.$$.dirty[1]&16777248&&pn&&vt&&vt.setSelectedMarker(Kr),e.$$.dirty[0]&2|e.$$.dirty[1]&32&&vt){const rt=cs(Ut);vt.setReverseMarker(rt?[rt.decimalLongitude,rt.decimalLatitude]:void 0)}e.$$.dirty[1]&134217728&&ai("select",n),e.$$.dirty[1]&33554432&&ai("pick",Re),e.$$.dirty[0]&81920&&ai("optionsVisibilityChange",yr&&!!cr),e.$$.dirty[0]&16384&&ai("featuresListed",cr),e.$$.dirty[1]&16777216&&ai("featuresMarked",pn),e.$$.dirty[0]&1&&ai("reverseToggle",xt),e.$$.dirty[0]&2&&ai("queryChange",Ut),e.$$.dirty[0]&1|e.$$.dirty[1]&32&&vt&&vt.indicateReverse(xt)},[xt,Ut,a,E,A,G,W,et,wt,$t,te,Me,jr,Io,cr,Kr,yr,_i,Gt,xi,Co,ia,In,Ls,Ri,h,g,_,S,O,k,U,tt,$,V,it,vt,ot,J,Ot,ye,ir,xr,_r,kr,vr,ue,nr,br,ln,co,hn,Ye,na,ls,pn,Re,ho,n,l,i,ce,ar,He,Di,fo,Ze,Mo,ct,q,X,nt,pt,ft]}let uL=class extends sp{constructor(t){super(),op(this,t,lL,aL,ip,{ZOOM_DEFAULTS:25,class:2,apiKey:26,bbox:27,clearButtonTitle:3,clearOnBlur:28,collapsed:4,country:29,debounceSearch:30,enableReverse:5,errorMessage:6,filter:31,flyTo:32,fuzzyMatch:33,language:34,limit:35,mapController:36,minLength:37,noResultsMessage:7,placeholder:8,proximity:38,reverseActive:0,reverseButtonTitle:9,searchValue:1,showFullGeometry:39,showPlaceType:10,showResultsWhileTyping:40,selectFirst:11,flyToSelected:41,markerOnSelected:42,types:43,excludeTypes:44,zoom:45,maxZoom:46,apiUrl:47,fetchParameters:48,iconsBaseUrl:12,adjustUrlQuery:49,focus:50,blur:51,setQuery:52,clearList:53,clearMap:54},null,[-1,-1,-1])}get ZOOM_DEFAULTS(){return this.$$.ctx[25]}get focus(){return this.$$.ctx[50]}get blur(){return this.$$.ctx[51]}get setQuery(){return this.$$.ctx[52]}get clearList(){return this.$$.ctx[53]}get clearMap(){return this.$$.ctx[54]}};function Cm(e,t,r={}){const n={type:"Feature"};return(r.id===0||r.id)&&(n.id=r.id),r.bbox&&(n.bbox=r.bbox),n.properties=t||{},n.geometry=e,n}function vx(e,t,r={}){for(const n of e){if(n.length<4)throw new Error("Each LinearRing of a Polygon must have 4 or more Positions.");if(n[n.length-1].length!==n[0].length)throw new Error("First and last Position are not equivalent.");for(let i=0;i<n[n.length-1].length;i++)if(n[n.length-1][i]!==n[0][i])throw new Error("First and last Position are not equivalent.")}return Cm({type:"Polygon",coordinates:e},t,r)}function Mm(e,t={}){const r={type:"FeatureCollection"};return t.id&&(r.id=t.id),t.bbox&&(r.bbox=t.bbox),r.features=e,r}function U2(e,t,r={}){return Cm({type:"MultiPolygon",coordinates:e},t,r)}/**
 * splaytree v3.1.2
 * Fast Splay tree for Node and browser
 *
 * @author Alexander Milevski <info@w8r.name>
 * @license MIT
 * @preserve
 *//*! *****************************************************************************
Copyright (c) Microsoft Corporation. All rights reserved.
Licensed under the Apache License, Version 2.0 (the "License"); you may not use
this file except in compliance with the License. You may obtain a copy of the
License at http://www.apache.org/licenses/LICENSE-2.0

THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
MERCHANTABLITY OR NON-INFRINGEMENT.

See the Apache Version 2.0 License for specific language governing permissions
and limitations under the License.
***************************************************************************** */function cL(e,t){var r={label:0,sent:function(){if(l[0]&1)throw l[1];return l[1]},trys:[],ops:[]},n,i,l,h;return h={next:a(0),throw:a(1),return:a(2)},typeof Symbol=="function"&&(h[Symbol.iterator]=function(){return this}),h;function a(_){return function(E){return g([_,E])}}function g(_){if(n)throw new TypeError("Generator is already executing.");for(;r;)try{if(n=1,i&&(l=_[0]&2?i.return:_[0]?i.throw||((l=i.return)&&l.call(i),0):i.next)&&!(l=l.call(i,_[1])).done)return l;switch(i=0,l&&(_=[_[0]&2,l.value]),_[0]){case 0:case 1:l=_;break;case 4:return r.label++,{value:_[1],done:!1};case 5:r.label++,i=_[1],_=[0];continue;case 7:_=r.ops.pop(),r.trys.pop();continue;default:if(l=r.trys,!(l=l.length>0&&l[l.length-1])&&(_[0]===6||_[0]===2)){r=0;continue}if(_[0]===3&&(!l||_[1]>l[0]&&_[1]<l[3])){r.label=_[1];break}if(_[0]===6&&r.label<l[1]){r.label=l[1],l=_;break}if(l&&r.label<l[2]){r.label=l[2],r.ops.push(_);break}l[2]&&r.ops.pop(),r.trys.pop();continue}_=t.call(e,r)}catch(E){_=[6,E],i=0}finally{n=l=0}if(_[0]&5)throw _[1];return{value:_[0]?_[1]:void 0,done:!0}}}var Vh=function(){function e(t,r){this.next=null,this.key=t,this.data=r,this.left=null,this.right=null}return e}();function hL(e,t){return e>t?1:e<t?-1:0}function Oh(e,t,r){for(var n=new Vh(null,null),i=n,l=n;;){var h=r(e,t.key);if(h<0){if(t.left===null)break;if(r(e,t.left.key)<0){var a=t.left;if(t.left=a.right,a.right=t,t=a,t.left===null)break}l.left=t,l=t,t=t.left}else if(h>0){if(t.right===null)break;if(r(e,t.right.key)>0){var a=t.right;if(t.right=a.left,a.left=t,t=a,t.right===null)break}i.right=t,i=t,t=t.right}else break}return i.right=t.left,l.left=t.right,t.left=n.right,t.right=n.left,t}function Q0(e,t,r,n){var i=new Vh(e,t);if(r===null)return i.left=i.right=null,i;r=Oh(e,r,n);var l=n(e,r.key);return l<0?(i.left=r.left,i.right=r,r.left=null):l>=0&&(i.right=r.right,i.left=r,r.right=null),i}function zw(e,t,r){var n=null,i=null;if(t){t=Oh(e,t,r);var l=r(t.key,e);l===0?(n=t.left,i=t.right):l<0?(i=t.right,t.right=null,n=t):(n=t.left,t.left=null,i=t)}return{left:n,right:i}}function pL(e,t,r){return t===null?e:(e===null||(t=Oh(e.key,t,r),t.left=e),t)}function Av(e,t,r,n,i){if(e){n(""+t+(r?" ":" ")+i(e)+`
`);var l=t+(r?"    ":"   ");e.left&&Av(e.left,l,!1,n,i),e.right&&Av(e.right,l,!0,n,i)}}var xx=function(){function e(t){t===void 0&&(t=hL),this._root=null,this._size=0,this._comparator=t}return e.prototype.insert=function(t,r){return this._size++,this._root=Q0(t,r,this._root,this._comparator)},e.prototype.add=function(t,r){var n=new Vh(t,r);this._root===null&&(n.left=n.right=null,this._size++,this._root=n);var i=this._comparator,l=Oh(t,this._root,i),h=i(t,l.key);return h===0?this._root=l:(h<0?(n.left=l.left,n.right=l,l.left=null):h>0&&(n.right=l.right,n.left=l,l.right=null),this._size++,this._root=n),this._root},e.prototype.remove=function(t){this._root=this._remove(t,this._root,this._comparator)},e.prototype._remove=function(t,r,n){var i;if(r===null)return null;r=Oh(t,r,n);var l=n(t,r.key);return l===0?(r.left===null?i=r.right:(i=Oh(t,r.left,n),i.right=r.right),this._size--,i):r},e.prototype.pop=function(){var t=this._root;if(t){for(;t.left;)t=t.left;return this._root=Oh(t.key,this._root,this._comparator),this._root=this._remove(t.key,this._root,this._comparator),{key:t.key,data:t.data}}return null},e.prototype.findStatic=function(t){for(var r=this._root,n=this._comparator;r;){var i=n(t,r.key);if(i===0)return r;i<0?r=r.left:r=r.right}return null},e.prototype.find=function(t){return this._root&&(this._root=Oh(t,this._root,this._comparator),this._comparator(t,this._root.key)!==0)?null:this._root},e.prototype.contains=function(t){for(var r=this._root,n=this._comparator;r;){var i=n(t,r.key);if(i===0)return!0;i<0?r=r.left:r=r.right}return!1},e.prototype.forEach=function(t,r){for(var n=this._root,i=[],l=!1;!l;)n!==null?(i.push(n),n=n.left):i.length!==0?(n=i.pop(),t.call(r,n),n=n.right):l=!0;return this},e.prototype.range=function(t,r,n,i){for(var l=[],h=this._comparator,a=this._root,g;l.length!==0||a;)if(a)l.push(a),a=a.left;else{if(a=l.pop(),g=h(a.key,r),g>0)break;if(h(a.key,t)>=0&&n.call(i,a))return this;a=a.right}return this},e.prototype.keys=function(){var t=[];return this.forEach(function(r){var n=r.key;return t.push(n)}),t},e.prototype.values=function(){var t=[];return this.forEach(function(r){var n=r.data;return t.push(n)}),t},e.prototype.min=function(){return this._root?this.minNode(this._root).key:null},e.prototype.max=function(){return this._root?this.maxNode(this._root).key:null},e.prototype.minNode=function(t){if(t===void 0&&(t=this._root),t)for(;t.left;)t=t.left;return t},e.prototype.maxNode=function(t){if(t===void 0&&(t=this._root),t)for(;t.right;)t=t.right;return t},e.prototype.at=function(t){for(var r=this._root,n=!1,i=0,l=[];!n;)if(r)l.push(r),r=r.left;else if(l.length>0){if(r=l.pop(),i===t)return r;i++,r=r.right}else n=!0;return null},e.prototype.next=function(t){var r=this._root,n=null;if(t.right){for(n=t.right;n.left;)n=n.left;return n}for(var i=this._comparator;r;){var l=i(t.key,r.key);if(l===0)break;l<0?(n=r,r=r.left):r=r.right}return n},e.prototype.prev=function(t){var r=this._root,n=null;if(t.left!==null){for(n=t.left;n.right;)n=n.right;return n}for(var i=this._comparator;r;){var l=i(t.key,r.key);if(l===0)break;l<0?r=r.left:(n=r,r=r.right)}return n},e.prototype.clear=function(){return this._root=null,this._size=0,this},e.prototype.toList=function(){return fL(this._root)},e.prototype.load=function(t,r,n){r===void 0&&(r=[]),n===void 0&&(n=!1);var i=t.length,l=this._comparator;if(n&&Dv(t,r,0,i-1,l),this._root===null)this._root=Lv(t,r,0,i),this._size=i;else{var h=mL(this.toList(),dL(t,r),l);i=this._size+i,this._root=Rv({head:h},0,i)}return this},e.prototype.isEmpty=function(){return this._root===null},Object.defineProperty(e.prototype,"size",{get:function(){return this._size},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"root",{get:function(){return this._root},enumerable:!0,configurable:!0}),e.prototype.toString=function(t){t===void 0&&(t=function(n){return String(n.key)});var r=[];return Av(this._root,"",!0,function(n){return r.push(n)},t),r.join("")},e.prototype.update=function(t,r,n){var i=this._comparator,l=zw(t,this._root,i),h=l.left,a=l.right;i(t,r)<0?a=Q0(r,n,a,i):h=Q0(r,n,h,i),this._root=pL(h,a,i)},e.prototype.split=function(t){return zw(t,this._root,this._comparator)},e.prototype[Symbol.iterator]=function(){var t,r,n;return cL(this,function(i){switch(i.label){case 0:t=this._root,r=[],n=!1,i.label=1;case 1:return n?[3,6]:t===null?[3,2]:(r.push(t),t=t.left,[3,5]);case 2:return r.length===0?[3,4]:(t=r.pop(),[4,t]);case 3:return i.sent(),t=t.right,[3,5];case 4:n=!0,i.label=5;case 5:return[3,1];case 6:return[2]}})},e}();function Lv(e,t,r,n){var i=n-r;if(i>0){var l=r+Math.floor(i/2),h=e[l],a=t[l],g=new Vh(h,a);return g.left=Lv(e,t,r,l),g.right=Lv(e,t,l+1,n),g}return null}function dL(e,t){for(var r=new Vh(null,null),n=r,i=0;i<e.length;i++)n=n.next=new Vh(e[i],t[i]);return n.next=null,r.next}function fL(e){for(var t=e,r=[],n=!1,i=new Vh(null,null),l=i;!n;)t?(r.push(t),t=t.left):r.length>0?(t=l=l.next=r.pop(),t=t.right):n=!0;return l.next=null,i.next}function Rv(e,t,r){var n=r-t;if(n>0){var i=t+Math.floor(n/2),l=Rv(e,t,i),h=e.head;return h.left=l,e.head=e.head.next,h.right=Rv(e,i+1,r),h}return null}function mL(e,t,r){for(var n=new Vh(null,null),i=n,l=e,h=t;l!==null&&h!==null;)r(l.key,h.key)<0?(i.next=l,l=l.next):(i.next=h,h=h.next),i=i.next;return l!==null?i.next=l:h!==null&&(i.next=h),n.next}function Dv(e,t,r,n,i){if(!(r>=n)){for(var l=e[r+n>>1],h=r-1,a=n+1;;){do h++;while(i(e[h],l)<0);do a--;while(i(e[a],l)>0);if(h>=a)break;var g=e[h];e[h]=e[a],e[a]=g,g=t[h],t[h]=t[a],t[a]=g}Dv(e,t,r,a,i),Dv(e,t,a+1,n,i)}}const kc=11102230246251565e-32,ws=134217729,gL=(3+8*kc)*kc;function tv(e,t,r,n,i){let l,h,a,g,_=t[0],E=n[0],S=0,A=0;E>_==E>-_?(l=_,_=t[++S]):(l=E,E=n[++A]);let O=0;if(S<e&&A<r)for(E>_==E>-_?(h=_+l,a=l-(h-_),_=t[++S]):(h=E+l,a=l-(h-E),E=n[++A]),l=h,a!==0&&(i[O++]=a);S<e&&A<r;)E>_==E>-_?(h=l+_,g=h-l,a=l-(h-g)+(_-g),_=t[++S]):(h=l+E,g=h-l,a=l-(h-g)+(E-g),E=n[++A]),l=h,a!==0&&(i[O++]=a);for(;S<e;)h=l+_,g=h-l,a=l-(h-g)+(_-g),_=t[++S],l=h,a!==0&&(i[O++]=a);for(;A<r;)h=l+E,g=h-l,a=l-(h-g)+(E-g),E=n[++A],l=h,a!==0&&(i[O++]=a);return(l!==0||O===0)&&(i[O++]=l),O}function yL(e,t){let r=t[0];for(let n=1;n<e;n++)r+=t[n];return r}function dg(e){return new Float64Array(e)}const _L=(3+16*kc)*kc,vL=(2+12*kc)*kc,xL=(9+64*kc)*kc*kc,wd=dg(4),Bw=dg(8),$w=dg(12),Uw=dg(16),Vs=dg(4);function bL(e,t,r,n,i,l,h){let a,g,_,E,S,A,O,k,G,W,U,tt,$,V,it,vt,ot,et;const wt=e-i,J=r-i,xt=t-l,$t=n-l;V=wt*$t,A=ws*wt,O=A-(A-wt),k=wt-O,A=ws*$t,G=A-(A-$t),W=$t-G,it=k*W-(V-O*G-k*G-O*W),vt=xt*J,A=ws*xt,O=A-(A-xt),k=xt-O,A=ws*J,G=A-(A-J),W=J-G,ot=k*W-(vt-O*G-k*G-O*W),U=it-ot,S=it-U,wd[0]=it-(U+S)+(S-ot),tt=V+U,S=tt-V,$=V-(tt-S)+(U-S),U=$-vt,S=$-U,wd[1]=$-(U+S)+(S-vt),et=tt+U,S=et-tt,wd[2]=tt-(et-S)+(U-S),wd[3]=et;let Ut=yL(4,wd),Ot=vL*h;if(Ut>=Ot||-Ut>=Ot||(S=e-wt,a=e-(wt+S)+(S-i),S=r-J,_=r-(J+S)+(S-i),S=t-xt,g=t-(xt+S)+(S-l),S=n-$t,E=n-($t+S)+(S-l),a===0&&g===0&&_===0&&E===0)||(Ot=xL*h+gL*Math.abs(Ut),Ut+=wt*E+$t*a-(xt*_+J*g),Ut>=Ot||-Ut>=Ot))return Ut;V=a*$t,A=ws*a,O=A-(A-a),k=a-O,A=ws*$t,G=A-(A-$t),W=$t-G,it=k*W-(V-O*G-k*G-O*W),vt=g*J,A=ws*g,O=A-(A-g),k=g-O,A=ws*J,G=A-(A-J),W=J-G,ot=k*W-(vt-O*G-k*G-O*W),U=it-ot,S=it-U,Vs[0]=it-(U+S)+(S-ot),tt=V+U,S=tt-V,$=V-(tt-S)+(U-S),U=$-vt,S=$-U,Vs[1]=$-(U+S)+(S-vt),et=tt+U,S=et-tt,Vs[2]=tt-(et-S)+(U-S),Vs[3]=et;const te=tv(4,wd,4,Vs,Bw);V=wt*E,A=ws*wt,O=A-(A-wt),k=wt-O,A=ws*E,G=A-(A-E),W=E-G,it=k*W-(V-O*G-k*G-O*W),vt=xt*_,A=ws*xt,O=A-(A-xt),k=xt-O,A=ws*_,G=A-(A-_),W=_-G,ot=k*W-(vt-O*G-k*G-O*W),U=it-ot,S=it-U,Vs[0]=it-(U+S)+(S-ot),tt=V+U,S=tt-V,$=V-(tt-S)+(U-S),U=$-vt,S=$-U,Vs[1]=$-(U+S)+(S-vt),et=tt+U,S=et-tt,Vs[2]=tt-(et-S)+(U-S),Vs[3]=et;const ye=tv(te,Bw,4,Vs,$w);V=a*E,A=ws*a,O=A-(A-a),k=a-O,A=ws*E,G=A-(A-E),W=E-G,it=k*W-(V-O*G-k*G-O*W),vt=g*_,A=ws*g,O=A-(A-g),k=g-O,A=ws*_,G=A-(A-_),W=_-G,ot=k*W-(vt-O*G-k*G-O*W),U=it-ot,S=it-U,Vs[0]=it-(U+S)+(S-ot),tt=V+U,S=tt-V,$=V-(tt-S)+(U-S),U=$-vt,S=$-U,Vs[1]=$-(U+S)+(S-vt),et=tt+U,S=et-tt,Vs[2]=tt-(et-S)+(U-S),Vs[3]=et;const Me=tv(ye,$w,4,Vs,Uw);return Uw[Me-1]}function wL(e,t,r,n,i,l){const h=(t-l)*(r-i),a=(e-i)*(n-l),g=h-a,_=Math.abs(h+a);return Math.abs(g)>=_L*_?g:-bL(e,t,r,n,i,l,_)}const am=(e,t)=>e.ll.x<=t.x&&t.x<=e.ur.x&&e.ll.y<=t.y&&t.y<=e.ur.y,Nv=(e,t)=>{if(t.ur.x<e.ll.x||e.ur.x<t.ll.x||t.ur.y<e.ll.y||e.ur.y<t.ll.y)return null;const r=e.ll.x<t.ll.x?t.ll.x:e.ll.x,n=e.ur.x<t.ur.x?e.ur.x:t.ur.x,i=e.ll.y<t.ll.y?t.ll.y:e.ll.y,l=e.ur.y<t.ur.y?e.ur.y:t.ur.y;return{ll:{x:r,y:i},ur:{x:n,y:l}}};let zh=Number.EPSILON;zh===void 0&&(zh=Math.pow(2,-52));const EL=zh*zh,jw=(e,t)=>{if(-zh<e&&e<zh&&-zh<t&&t<zh)return 0;const r=e-t;return r*r<EL*e*t?0:e<t?-1:1};let SL=class{constructor(){this.reset()}reset(){this.xRounder=new Vw,this.yRounder=new Vw}round(t,r){return{x:this.xRounder.round(t),y:this.yRounder.round(r)}}},Vw=class{constructor(){this.tree=new xx,this.round(0)}round(t){const r=this.tree.add(t),n=this.tree.prev(r);if(n!==null&&jw(r.key,n.key)===0)return this.tree.remove(t),n.key;const i=this.tree.next(r);return i!==null&&jw(r.key,i.key)===0?(this.tree.remove(t),i.key):t}};const Pm=new SL,ky=(e,t)=>e.x*t.y-e.y*t.x,j2=(e,t)=>e.x*t.x+e.y*t.y,Gw=(e,t,r)=>{const n=wL(e.x,e.y,t.x,t.y,r.x,r.y);return n>0?-1:n<0?1:0},Wy=e=>Math.sqrt(j2(e,e)),TL=(e,t,r)=>{const n={x:t.x-e.x,y:t.y-e.y},i={x:r.x-e.x,y:r.y-e.y};return ky(i,n)/Wy(i)/Wy(n)},IL=(e,t,r)=>{const n={x:t.x-e.x,y:t.y-e.y},i={x:r.x-e.x,y:r.y-e.y};return j2(i,n)/Wy(i)/Wy(n)},qw=(e,t,r)=>t.y===0?null:{x:e.x+t.x/t.y*(r-e.y),y:r},Zw=(e,t,r)=>t.x===0?null:{x:r,y:e.y+t.y/t.x*(r-e.x)},CL=(e,t,r,n)=>{if(t.x===0)return Zw(r,n,e.x);if(n.x===0)return Zw(e,t,r.x);if(t.y===0)return qw(r,n,e.y);if(n.y===0)return qw(e,t,r.y);const i=ky(t,n);if(i==0)return null;const l={x:r.x-e.x,y:r.y-e.y},h=ky(l,t)/i,a=ky(l,n)/i,g=e.x+a*t.x,_=r.x+h*n.x,E=e.y+a*t.y,S=r.y+h*n.y,A=(g+_)/2,O=(E+S)/2;return{x:A,y:O}};let Fu=class V2{static compare(t,r){const n=V2.comparePoints(t.point,r.point);return n!==0?n:(t.point!==r.point&&t.link(r),t.isLeft!==r.isLeft?t.isLeft?1:-1:Xy.compare(t.segment,r.segment))}static comparePoints(t,r){return t.x<r.x?-1:t.x>r.x?1:t.y<r.y?-1:t.y>r.y?1:0}constructor(t,r){t.events===void 0?t.events=[this]:t.events.push(this),this.point=t,this.isLeft=r}link(t){if(t.point===this.point)throw new Error("Tried to link already linked events");const r=t.point.events;for(let n=0,i=r.length;n<i;n++){const l=r[n];this.point.events.push(l),l.point=this.point}this.checkForConsuming()}checkForConsuming(){const t=this.point.events.length;for(let r=0;r<t;r++){const n=this.point.events[r];if(n.segment.consumedBy===void 0)for(let i=r+1;i<t;i++){const l=this.point.events[i];l.consumedBy===void 0&&n.otherSE.point.events===l.otherSE.point.events&&n.segment.consume(l.segment)}}}getAvailableLinkedEvents(){const t=[];for(let r=0,n=this.point.events.length;r<n;r++){const i=this.point.events[r];i!==this&&!i.segment.ringOut&&i.segment.isInResult()&&t.push(i)}return t}getLeftmostComparator(t){const r=new Map,n=i=>{const l=i.otherSE;r.set(i,{sine:TL(this.point,t.point,l.point),cosine:IL(this.point,t.point,l.point)})};return(i,l)=>{r.has(i)||n(i),r.has(l)||n(l);const{sine:h,cosine:a}=r.get(i),{sine:g,cosine:_}=r.get(l);return h>=0&&g>=0?a<_?1:a>_?-1:0:h<0&&g<0?a<_?-1:a>_?1:0:g<h?-1:g>h?1:0}}},ML=0,Xy=class Oy{static compare(t,r){const n=t.leftSE.point.x,i=r.leftSE.point.x,l=t.rightSE.point.x,h=r.rightSE.point.x;if(h<n)return 1;if(l<i)return-1;const a=t.leftSE.point.y,g=r.leftSE.point.y,_=t.rightSE.point.y,E=r.rightSE.point.y;if(n<i){if(g<a&&g<_)return 1;if(g>a&&g>_)return-1;const S=t.comparePoint(r.leftSE.point);if(S<0)return 1;if(S>0)return-1;const A=r.comparePoint(t.rightSE.point);return A!==0?A:-1}if(n>i){if(a<g&&a<E)return-1;if(a>g&&a>E)return 1;const S=r.comparePoint(t.leftSE.point);if(S!==0)return S;const A=t.comparePoint(r.rightSE.point);return A<0?1:A>0?-1:1}if(a<g)return-1;if(a>g)return 1;if(l<h){const S=r.comparePoint(t.rightSE.point);if(S!==0)return S}if(l>h){const S=t.comparePoint(r.rightSE.point);if(S<0)return 1;if(S>0)return-1}if(l!==h){const S=_-a,A=l-n,O=E-g,k=h-i;if(S>A&&O<k)return 1;if(S<A&&O>k)return-1}return l>h?1:l<h||_<E?-1:_>E?1:t.id<r.id?-1:t.id>r.id?1:0}constructor(t,r,n,i){this.id=++ML,this.leftSE=t,t.segment=this,t.otherSE=r,this.rightSE=r,r.segment=this,r.otherSE=t,this.rings=n,this.windings=i}static fromRing(t,r,n){let i,l,h;const a=Fu.comparePoints(t,r);if(a<0)i=t,l=r,h=1;else if(a>0)i=r,l=t,h=-1;else throw new Error(`Tried to create degenerate segment at [${t.x}, ${t.y}]`);const g=new Fu(i,!0),_=new Fu(l,!1);return new Oy(g,_,[n],[h])}replaceRightSE(t){this.rightSE=t,this.rightSE.segment=this,this.rightSE.otherSE=this.leftSE,this.leftSE.otherSE=this.rightSE}bbox(){const t=this.leftSE.point.y,r=this.rightSE.point.y;return{ll:{x:this.leftSE.point.x,y:t<r?t:r},ur:{x:this.rightSE.point.x,y:t>r?t:r}}}vector(){return{x:this.rightSE.point.x-this.leftSE.point.x,y:this.rightSE.point.y-this.leftSE.point.y}}isAnEndpoint(t){return t.x===this.leftSE.point.x&&t.y===this.leftSE.point.y||t.x===this.rightSE.point.x&&t.y===this.rightSE.point.y}comparePoint(t){if(this.isAnEndpoint(t))return 0;const r=this.leftSE.point,n=this.rightSE.point,i=this.vector();if(r.x===n.x)return t.x===r.x?0:t.x<r.x?1:-1;const l=(t.y-r.y)/i.y,h=r.x+l*i.x;if(t.x===h)return 0;const a=(t.x-r.x)/i.x,g=r.y+a*i.y;return t.y===g?0:t.y<g?-1:1}getIntersection(t){const r=this.bbox(),n=t.bbox(),i=Nv(r,n);if(i===null)return null;const l=this.leftSE.point,h=this.rightSE.point,a=t.leftSE.point,g=t.rightSE.point,_=am(r,a)&&this.comparePoint(a)===0,E=am(n,l)&&t.comparePoint(l)===0,S=am(r,g)&&this.comparePoint(g)===0,A=am(n,h)&&t.comparePoint(h)===0;if(E&&_)return A&&!S?h:!A&&S?g:null;if(E)return S&&l.x===g.x&&l.y===g.y?null:l;if(_)return A&&h.x===a.x&&h.y===a.y?null:a;if(A&&S)return null;if(A)return h;if(S)return g;const O=CL(l,this.vector(),a,t.vector());return O===null||!am(i,O)?null:Pm.round(O.x,O.y)}split(t){const r=[],n=t.events!==void 0,i=new Fu(t,!0),l=new Fu(t,!1),h=this.rightSE;this.replaceRightSE(l),r.push(l),r.push(i);const a=new Oy(i,h,this.rings.slice(),this.windings.slice());return Fu.comparePoints(a.leftSE.point,a.rightSE.point)>0&&a.swapEvents(),Fu.comparePoints(this.leftSE.point,this.rightSE.point)>0&&this.swapEvents(),n&&(i.checkForConsuming(),l.checkForConsuming()),r}swapEvents(){const t=this.rightSE;this.rightSE=this.leftSE,this.leftSE=t,this.leftSE.isLeft=!0,this.rightSE.isLeft=!1;for(let r=0,n=this.windings.length;r<n;r++)this.windings[r]*=-1}consume(t){let r=this,n=t;for(;r.consumedBy;)r=r.consumedBy;for(;n.consumedBy;)n=n.consumedBy;const i=Oy.compare(r,n);if(i!==0){if(i>0){const l=r;r=n,n=l}if(r.prev===n){const l=r;r=n,n=l}for(let l=0,h=n.rings.length;l<h;l++){const a=n.rings[l],g=n.windings[l],_=r.rings.indexOf(a);_===-1?(r.rings.push(a),r.windings.push(g)):r.windings[_]+=g}n.rings=null,n.windings=null,n.consumedBy=r,n.leftSE.consumedBy=r.leftSE,n.rightSE.consumedBy=r.rightSE}}prevInResult(){return this._prevInResult!==void 0?this._prevInResult:(this.prev?this.prev.isInResult()?this._prevInResult=this.prev:this._prevInResult=this.prev.prevInResult():this._prevInResult=null,this._prevInResult)}beforeState(){if(this._beforeState!==void 0)return this._beforeState;if(!this.prev)this._beforeState={rings:[],windings:[],multiPolys:[]};else{const t=this.prev.consumedBy||this.prev;this._beforeState=t.afterState()}return this._beforeState}afterState(){if(this._afterState!==void 0)return this._afterState;const t=this.beforeState();this._afterState={rings:t.rings.slice(0),windings:t.windings.slice(0),multiPolys:[]};const r=this._afterState.rings,n=this._afterState.windings,i=this._afterState.multiPolys;for(let a=0,g=this.rings.length;a<g;a++){const _=this.rings[a],E=this.windings[a],S=r.indexOf(_);S===-1?(r.push(_),n.push(E)):n[S]+=E}const l=[],h=[];for(let a=0,g=r.length;a<g;a++){if(n[a]===0)continue;const _=r[a],E=_.poly;if(h.indexOf(E)===-1)if(_.isExterior)l.push(E);else{h.indexOf(E)===-1&&h.push(E);const S=l.indexOf(_.poly);S!==-1&&l.splice(S,1)}}for(let a=0,g=l.length;a<g;a++){const _=l[a].multiPoly;i.indexOf(_)===-1&&i.push(_)}return this._afterState}isInResult(){if(this.consumedBy)return!1;if(this._isInResult!==void 0)return this._isInResult;const t=this.beforeState().multiPolys,r=this.afterState().multiPolys;switch(ru.type){case"union":{const n=t.length===0,i=r.length===0;this._isInResult=n!==i;break}case"intersection":{let n,i;t.length<r.length?(n=t.length,i=r.length):(n=r.length,i=t.length),this._isInResult=i===ru.numMultiPolys&&n<i;break}case"xor":{const n=Math.abs(t.length-r.length);this._isInResult=n%2===1;break}case"difference":{const n=i=>i.length===1&&i[0].isSubject;this._isInResult=n(t)!==n(r);break}default:throw new Error(`Unrecognized operation type found ${ru.type}`)}return this._isInResult}},Ww=class{constructor(t,r,n){if(!Array.isArray(t)||t.length===0)throw new Error("Input geometry is not a valid Polygon or MultiPolygon");if(this.poly=r,this.isExterior=n,this.segments=[],typeof t[0][0]!="number"||typeof t[0][1]!="number")throw new Error("Input geometry is not a valid Polygon or MultiPolygon");const i=Pm.round(t[0][0],t[0][1]);this.bbox={ll:{x:i.x,y:i.y},ur:{x:i.x,y:i.y}};let l=i;for(let h=1,a=t.length;h<a;h++){if(typeof t[h][0]!="number"||typeof t[h][1]!="number")throw new Error("Input geometry is not a valid Polygon or MultiPolygon");let g=Pm.round(t[h][0],t[h][1]);g.x===l.x&&g.y===l.y||(this.segments.push(Xy.fromRing(l,g,this)),g.x<this.bbox.ll.x&&(this.bbox.ll.x=g.x),g.y<this.bbox.ll.y&&(this.bbox.ll.y=g.y),g.x>this.bbox.ur.x&&(this.bbox.ur.x=g.x),g.y>this.bbox.ur.y&&(this.bbox.ur.y=g.y),l=g)}(i.x!==l.x||i.y!==l.y)&&this.segments.push(Xy.fromRing(l,i,this))}getSweepEvents(){const t=[];for(let r=0,n=this.segments.length;r<n;r++){const i=this.segments[r];t.push(i.leftSE),t.push(i.rightSE)}return t}},PL=class{constructor(t,r){if(!Array.isArray(t))throw new Error("Input geometry is not a valid Polygon or MultiPolygon");this.exteriorRing=new Ww(t[0],this,!0),this.bbox={ll:{x:this.exteriorRing.bbox.ll.x,y:this.exteriorRing.bbox.ll.y},ur:{x:this.exteriorRing.bbox.ur.x,y:this.exteriorRing.bbox.ur.y}},this.interiorRings=[];for(let n=1,i=t.length;n<i;n++){const l=new Ww(t[n],this,!1);l.bbox.ll.x<this.bbox.ll.x&&(this.bbox.ll.x=l.bbox.ll.x),l.bbox.ll.y<this.bbox.ll.y&&(this.bbox.ll.y=l.bbox.ll.y),l.bbox.ur.x>this.bbox.ur.x&&(this.bbox.ur.x=l.bbox.ur.x),l.bbox.ur.y>this.bbox.ur.y&&(this.bbox.ur.y=l.bbox.ur.y),this.interiorRings.push(l)}this.multiPoly=r}getSweepEvents(){const t=this.exteriorRing.getSweepEvents();for(let r=0,n=this.interiorRings.length;r<n;r++){const i=this.interiorRings[r].getSweepEvents();for(let l=0,h=i.length;l<h;l++)t.push(i[l])}return t}},Xw=class{constructor(t,r){if(!Array.isArray(t))throw new Error("Input geometry is not a valid Polygon or MultiPolygon");try{typeof t[0][0][0]=="number"&&(t=[t])}catch{}this.polys=[],this.bbox={ll:{x:Number.POSITIVE_INFINITY,y:Number.POSITIVE_INFINITY},ur:{x:Number.NEGATIVE_INFINITY,y:Number.NEGATIVE_INFINITY}};for(let n=0,i=t.length;n<i;n++){const l=new PL(t[n],this);l.bbox.ll.x<this.bbox.ll.x&&(this.bbox.ll.x=l.bbox.ll.x),l.bbox.ll.y<this.bbox.ll.y&&(this.bbox.ll.y=l.bbox.ll.y),l.bbox.ur.x>this.bbox.ur.x&&(this.bbox.ur.x=l.bbox.ur.x),l.bbox.ur.y>this.bbox.ur.y&&(this.bbox.ur.y=l.bbox.ur.y),this.polys.push(l)}this.isSubject=r}getSweepEvents(){const t=[];for(let r=0,n=this.polys.length;r<n;r++){const i=this.polys[r].getSweepEvents();for(let l=0,h=i.length;l<h;l++)t.push(i[l])}return t}},AL=class kv{static factory(t){const r=[];for(let n=0,i=t.length;n<i;n++){const l=t[n];if(!l.isInResult()||l.ringOut)continue;let h=null,a=l.leftSE,g=l.rightSE;const _=[a],E=a.point,S=[];for(;h=a,a=g,_.push(a),a.point!==E;)for(;;){const A=a.getAvailableLinkedEvents();if(A.length===0){const G=_[0].point,W=_[_.length-1].point;throw new Error(`Unable to complete output ring starting at [${G.x}, ${G.y}]. Last matching segment found ends at [${W.x}, ${W.y}].`)}if(A.length===1){g=A[0].otherSE;break}let O=null;for(let G=0,W=S.length;G<W;G++)if(S[G].point===a.point){O=G;break}if(O!==null){const G=S.splice(O)[0],W=_.splice(G.index);W.unshift(W[0].otherSE),r.push(new kv(W.reverse()));continue}S.push({index:_.length,point:a.point});const k=a.getLeftmostComparator(h);g=A.sort(k)[0].otherSE;break}r.push(new kv(_))}return r}constructor(t){this.events=t;for(let r=0,n=t.length;r<n;r++)t[r].segment.ringOut=this;this.poly=null}getGeom(){let t=this.events[0].point;const r=[t];for(let _=1,E=this.events.length-1;_<E;_++){const S=this.events[_].point,A=this.events[_+1].point;Gw(S,t,A)!==0&&(r.push(S),t=S)}if(r.length===1)return null;const n=r[0],i=r[1];Gw(n,t,i)===0&&r.shift(),r.push(r[0]);const l=this.isExteriorRing()?1:-1,h=this.isExteriorRing()?0:r.length-1,a=this.isExteriorRing()?r.length:-1,g=[];for(let _=h;_!=a;_+=l)g.push([r[_].x,r[_].y]);return g}isExteriorRing(){if(this._isExteriorRing===void 0){const t=this.enclosingRing();this._isExteriorRing=t?!t.isExteriorRing():!0}return this._isExteriorRing}enclosingRing(){return this._enclosingRing===void 0&&(this._enclosingRing=this._calcEnclosingRing()),this._enclosingRing}_calcEnclosingRing(){let t=this.events[0];for(let i=1,l=this.events.length;i<l;i++){const h=this.events[i];Fu.compare(t,h)>0&&(t=h)}let r=t.segment.prevInResult(),n=r?r.prevInResult():null;for(;;){if(!r)return null;if(!n)return r.ringOut;if(n.ringOut!==r.ringOut)return n.ringOut.enclosingRing()!==r.ringOut?r.ringOut:r.ringOut.enclosingRing();r=n.prevInResult(),n=r?r.prevInResult():null}}},Hw=class{constructor(t){this.exteriorRing=t,t.poly=this,this.interiorRings=[]}addInterior(t){this.interiorRings.push(t),t.poly=this}getGeom(){const t=[this.exteriorRing.getGeom()];if(t[0]===null)return null;for(let r=0,n=this.interiorRings.length;r<n;r++){const i=this.interiorRings[r].getGeom();i!==null&&t.push(i)}return t}},LL=class{constructor(t){this.rings=t,this.polys=this._composePolys(t)}getGeom(){const t=[];for(let r=0,n=this.polys.length;r<n;r++){const i=this.polys[r].getGeom();i!==null&&t.push(i)}return t}_composePolys(t){const r=[];for(let n=0,i=t.length;n<i;n++){const l=t[n];if(!l.poly)if(l.isExteriorRing())r.push(new Hw(l));else{const h=l.enclosingRing();h.poly||r.push(new Hw(h)),h.poly.addInterior(l)}}return r}},RL=class{constructor(t){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:Xy.compare;this.queue=t,this.tree=new xx(r),this.segments=[]}process(t){const r=t.segment,n=[];if(t.consumedBy)return t.isLeft?this.queue.remove(t.otherSE):this.tree.remove(r),n;const i=t.isLeft?this.tree.add(r):this.tree.find(r);if(!i)throw new Error(`Unable to find segment #${r.id} [${r.leftSE.point.x}, ${r.leftSE.point.y}] -> [${r.rightSE.point.x}, ${r.rightSE.point.y}] in SweepLine tree.`);let l=i,h=i,a,g;for(;a===void 0;)l=this.tree.prev(l),l===null?a=null:l.key.consumedBy===void 0&&(a=l.key);for(;g===void 0;)h=this.tree.next(h),h===null?g=null:h.key.consumedBy===void 0&&(g=h.key);if(t.isLeft){let _=null;if(a){const S=a.getIntersection(r);if(S!==null&&(r.isAnEndpoint(S)||(_=S),!a.isAnEndpoint(S))){const A=this._splitSafely(a,S);for(let O=0,k=A.length;O<k;O++)n.push(A[O])}}let E=null;if(g){const S=g.getIntersection(r);if(S!==null&&(r.isAnEndpoint(S)||(E=S),!g.isAnEndpoint(S))){const A=this._splitSafely(g,S);for(let O=0,k=A.length;O<k;O++)n.push(A[O])}}if(_!==null||E!==null){let S=null;_===null?S=E:E===null?S=_:S=Fu.comparePoints(_,E)<=0?_:E,this.queue.remove(r.rightSE),n.push(r.rightSE);const A=r.split(S);for(let O=0,k=A.length;O<k;O++)n.push(A[O])}n.length>0?(this.tree.remove(r),n.push(t)):(this.segments.push(r),r.prev=a)}else{if(a&&g){const _=a.getIntersection(g);if(_!==null){if(!a.isAnEndpoint(_)){const E=this._splitSafely(a,_);for(let S=0,A=E.length;S<A;S++)n.push(E[S])}if(!g.isAnEndpoint(_)){const E=this._splitSafely(g,_);for(let S=0,A=E.length;S<A;S++)n.push(E[S])}}}this.tree.remove(r)}return n}_splitSafely(t,r){this.tree.remove(t);const n=t.rightSE;this.queue.remove(n);const i=t.split(r);return i.push(n),t.consumedBy===void 0&&this.tree.add(t),i}};const Yw=typeof process<"u"&&L2.POLYGON_CLIPPING_MAX_QUEUE_SIZE||1e6,DL=typeof process<"u"&&L2.POLYGON_CLIPPING_MAX_SWEEPLINE_SEGMENTS||1e6;let NL=class{run(t,r,n){ru.type=t,Pm.reset();const i=[new Xw(r,!0)];for(let E=0,S=n.length;E<S;E++)i.push(new Xw(n[E],!1));if(ru.numMultiPolys=i.length,ru.type==="difference"){const E=i[0];let S=1;for(;S<i.length;)Nv(i[S].bbox,E.bbox)!==null?S++:i.splice(S,1)}if(ru.type==="intersection")for(let E=0,S=i.length;E<S;E++){const A=i[E];for(let O=E+1,k=i.length;O<k;O++)if(Nv(A.bbox,i[O].bbox)===null)return[]}const l=new xx(Fu.compare);for(let E=0,S=i.length;E<S;E++){const A=i[E].getSweepEvents();for(let O=0,k=A.length;O<k;O++)if(l.insert(A[O]),l.size>Yw)throw new Error("Infinite loop when putting segment endpoints in a priority queue (queue size too big).")}const h=new RL(l);let a=l.size,g=l.pop();for(;g;){const E=g.key;if(l.size===a){const A=E.segment;throw new Error(`Unable to pop() ${E.isLeft?"left":"right"} SweepEvent [${E.point.x}, ${E.point.y}] from segment #${A.id} [${A.leftSE.point.x}, ${A.leftSE.point.y}] -> [${A.rightSE.point.x}, ${A.rightSE.point.y}] from queue.`)}if(l.size>Yw)throw new Error("Infinite loop when passing sweep line over endpoints (queue size too big).");if(h.segments.length>DL)throw new Error("Infinite loop when passing sweep line over endpoints (too many sweep line segments).");const S=h.process(E);for(let A=0,O=S.length;A<O;A++){const k=S[A];k.consumedBy===void 0&&l.insert(k)}a=l.size,g=l.pop()}Pm.reset();const _=AL.factory(h.segments);return new LL(_).getGeom()}};const ru=new NL,kL=function(e){for(var t=arguments.length,r=new Array(t>1?t-1:0),n=1;n<t;n++)r[n-1]=arguments[n];return ru.run("union",e,r)},OL=function(e){for(var t=arguments.length,r=new Array(t>1?t-1:0),n=1;n<t;n++)r[n-1]=arguments[n];return ru.run("intersection",e,r)},FL=function(e){for(var t=arguments.length,r=new Array(t>1?t-1:0),n=1;n<t;n++)r[n-1]=arguments[n];return ru.run("xor",e,r)},zL=function(e){for(var t=arguments.length,r=new Array(t>1?t-1:0),n=1;n<t;n++)r[n-1]=arguments[n];return ru.run("difference",e,r)};var G2={union:kL,intersection:OL,xor:FL,difference:zL};function q2(e,t,r){if(e!==null)for(var n,i,l,h,a,g,_,E=0,S=0,A,O=e.type,k=O==="FeatureCollection",G=O==="Feature",W=k?e.features.length:1,U=0;U<W;U++){_=k?e.features[U].geometry:G?e.geometry:e,A=_?_.type==="GeometryCollection":!1,a=A?_.geometries.length:1;for(var tt=0;tt<a;tt++){var $=0,V=0;if(h=A?_.geometries[tt]:_,h!==null){g=h.coordinates;var it=h.type;switch(E=0,it){case null:break;case"Point":if(t(g,S,U,$,V)===!1)return!1;S++,$++;break;case"LineString":case"MultiPoint":for(n=0;n<g.length;n++){if(t(g[n],S,U,$,V)===!1)return!1;S++,it==="MultiPoint"&&$++}it==="LineString"&&$++;break;case"Polygon":case"MultiLineString":for(n=0;n<g.length;n++){for(i=0;i<g[n].length-E;i++){if(t(g[n][i],S,U,$,V)===!1)return!1;S++}it==="MultiLineString"&&$++,it==="Polygon"&&V++}it==="Polygon"&&$++;break;case"MultiPolygon":for(n=0;n<g.length;n++){for(V=0,i=0;i<g[n].length;i++){for(l=0;l<g[n][i].length-E;l++){if(t(g[n][i][l],S,U,$,V)===!1)return!1;S++}V++}$++}break;case"GeometryCollection":for(n=0;n<h.geometries.length;n++)if(q2(h.geometries[n],t)===!1)return!1;break;default:throw new Error("Unknown Geometry Type")}}}}}function bx(e,t){var r,n,i,l,h,a,g,_,E,S,A=0,O=e.type==="FeatureCollection",k=e.type==="Feature",G=O?e.features.length:1;for(r=0;r<G;r++){for(a=O?e.features[r].geometry:k?e.geometry:e,_=O?e.features[r].properties:k?e.properties:{},E=O?e.features[r].bbox:k?e.bbox:void 0,S=O?e.features[r].id:k?e.id:void 0,g=a?a.type==="GeometryCollection":!1,h=g?a.geometries.length:1,i=0;i<h;i++){if(l=g?a.geometries[i]:a,l===null){if(t(null,A,_,E,S)===!1)return!1;continue}switch(l.type){case"Point":case"LineString":case"MultiPoint":case"Polygon":case"MultiLineString":case"MultiPolygon":{if(t(l,A,_,E,S)===!1)return!1;break}case"GeometryCollection":{for(n=0;n<l.geometries.length;n++)if(t(l.geometries[n],A,_,E,S)===!1)return!1;break}default:throw new Error("Unknown Geometry Type")}}A++}}function BL(e,t){bx(e,function(r,n,i,l,h){var a=r===null?null:r.type;switch(a){case null:case"Point":case"LineString":case"Polygon":return t(Cm(r,i,{bbox:l,id:h}),n,0)===!1?!1:void 0}var g;switch(a){case"MultiPoint":g="Point";break;case"MultiLineString":g="LineString";break;case"MultiPolygon":g="Polygon";break}for(var _=0;_<r.coordinates.length;_++){var E=r.coordinates[_],S={type:g,coordinates:E};if(t(Cm(S,i),n,_)===!1)return!1}})}function $L(e,t={}){const r=[];if(bx(e,i=>{r.push(i.coordinates)}),r.length<2)throw new Error("Must have at least 2 geometries");const n=G2.union(r[0],...r.slice(1));return n.length===0?null:n.length===1?vx(n[0],t.properties):U2(n,t.properties)}var Z2=$L;function UL(e,t={}){if(e.bbox!=null&&t.recompute!==!0)return e.bbox;const r=[1/0,1/0,-1/0,-1/0];return q2(e,n=>{r[0]>n[0]&&(r[0]=n[0]),r[1]>n[1]&&(r[1]=n[1]),r[2]<n[0]&&(r[2]=n[0]),r[3]<n[1]&&(r[3]=n[1])}),r}var Kw=UL;function jL(e){const t=[];if(bx(e,i=>{t.push(i.coordinates)}),t.length<2)throw new Error("Must have at least two features");const r=e.features[0].properties||{},n=G2.difference(t[0],...t.slice(1));return n.length===0?null:n.length===1?vx(n[0],r):U2(n,r)}var VL=jL;function GL(e){if(!e)throw new Error("geojson is required");var t=[];return BL(e,function(r){t.push(r)}),Mm(t)}var qL=GL;function Jw(e,t){const r=VL(Mm([vx([[[180,90],[-180,90],[-180,-90],[180,-90],[180,90]]]),e]));if(!r)return;r.properties={isMask:!0};const n=Zy(Kw(e)),i=(n[2]-n[0])/360/1e3,l=n[0]<-180,h=n[2]>180,a=qL(e);if(a.features.length>1&&(l||h))for(const g of a.features){const _=Zy(Kw(g));if(h&&_[0]<-180+i)for(const E of g.geometry.coordinates)for(const S of E)S[0]+=360-i;if(l&&_[2]>180-i)for(const E of g.geometry.coordinates)for(const S of E)S[0]-=360-i}t(Mm([a.features.length<2?e:Z2(a)??e,r]))}const Qw=Mm([]);function ZL(e,t,r=!0,n=!0,i={},l={},h={fill:{paint:{"fill-color":"#000","fill-opacity":.1},filter:["all",["==",["geometry-type"],"Polygon"],["has","isMask"]]},line:{layout:{"line-cap":"square"},paint:{"line-width":["case",["==",["geometry-type"],"Polygon"],2,3],"line-dasharray":[1,1],"line-color":"#3170fe"},filter:["!",["has","isMask"]]}}){let a;const g=[];let _,E,S;function A(){!e.getSource("full-geom")&&(h!=null&&h.fill||h!=null&&h.line)&&e.addSource("full-geom",{type:"geojson",data:Qw}),!e.getLayer("full-geom-fill")&&h!=null&&h.fill&&e.addLayer({...h==null?void 0:h.fill,id:"full-geom-fill",type:"fill",source:"full-geom"}),!e.getLayer("full-geom-line")&&h!=null&&h.line&&e.addLayer({...h==null?void 0:h.line,id:"full-geom-line",type:"line",source:"full-geom"}),S&&G(S)}e.loaded()?A():e.once("load",()=>{A()}),e.on("styledata",()=>{A()});const O=W=>{a==null||a({type:"mapClick",coordinates:[W.lngLat.lng,W.lngLat.lat]})};function k(W=!1){if(!t)throw new Error;const U=document.createElement("div");return W&&U.classList.add("marker-interactive"),new BA({props:{displayIn:"maplibre"},target:U}),new t.Marker({element:U,offset:[1,-13]})}function G(W){var U;S=W,W&&((U=e.getSource("full-geom"))==null||U.setData(W))}return{setEventHandler(W){W?(a=W,e.on("click",O)):(a=void 0,e.off("click",O))},flyTo(W,U){e.flyTo({center:W,...U?{zoom:U}:{},...i})},fitBounds(W,U,tt){e.fitBounds([[W[0],W[1]],[W[2],W[3]]],{padding:U,...tt?{maxZoom:tt}:{},...l})},indicateReverse(W){e.getCanvasContainer().style.cursor=W?"crosshair":""},setReverseMarker(W){!t||!r||(E?W?E.setLngLat(W):(E.remove(),E=void 0):W&&(E=(typeof r=="object"?new t.Marker(r):k()).setLngLat(W).addTo(e),E.getElement().classList.add("marker-reverse")))},setMarkers(W,U){if(r){for(const tt of g)tt.remove();if(g.length=0,G(Qw),!!t){if(U){let tt=!1;if(U.geometry.type==="GeometryCollection"){const $=U.geometry.geometries.filter(V=>V.type==="Polygon"||V.type==="MultiPolygon");t:if($.length>0){const V=Z2(Mm($.map(it=>Cm(it))));if(!V)break t;Jw({...U,geometry:V.geometry},G),tt=!0}else{const V=U.geometry.geometries.filter(it=>it.type==="LineString"||it.type==="MultiLineString");V.length>0&&(G({...U,geometry:{type:"GeometryCollection",geometries:V}}),tt=!0)}}if(!tt){if(U.geometry.type==="Polygon"||U.geometry.type==="MultiPolygon")Jw(U,G);else if(U.geometry.type==="LineString"||U.geometry.type==="MultiLineString"){G(U);return}}r&&g.push((typeof r=="object"?new t.Marker(r):k()).setLngLat(U.center).addTo(e))}if(n)for(const tt of W??[]){if(tt===U)continue;const $=(typeof n=="object"?new t.Marker(n):k(!0)).setLngLat(tt.center).setPopup(new t.Popup({offset:[1,-27],closeButton:!1,closeOnMove:!0,className:"maptiler-gc-popup"}).setText(tt.place_type[0]==="reverse"?tt.place_name:tt.place_name.replace(/,.*/,""))).addTo(e),V=$.getElement();V.addEventListener("click",it=>{it.stopPropagation(),a==null||a({type:"markerClick",id:tt.id})}),V.addEventListener("mouseenter",()=>{a==null||a({type:"markerMouseEnter",id:tt.id}),$.togglePopup()}),V.addEventListener("mouseleave",()=>{a==null||a({type:"markerMouseLeave",id:tt.id}),$.togglePopup()}),g.push($)}}}},setSelectedMarker(W){_&&_.getElement().classList.toggle("marker-selected",!1),_=W>-1?g[W]:void 0,_==null||_.getElement().classList.toggle("marker-selected",!0)},getCenterAndZoom(){const W=e.getCenter();return[e.getZoom(),W.lng,W.lat]}}}var gl,Md;class WL extends EventTarget{constructor(t={}){super(),vw(this,gl),vw(this,Md),K0(this,Md,t)}onAddInt(t){const r=document.createElement("div");r.className="mapboxgl-ctrl-geocoder mapboxgl-ctrl maplibregl-ctrl-geocoder maplibregl-ctrl mapboxgl-ctrl-group";const{marker:n,showResultMarkers:i,flyTo:l,fullGeometryStyle:h,...a}=Kl(this,Md),g=typeof l=="boolean"?{}:l,_=this.getExtraProps(t,r),E={mapController:ZL(t,this.getMapLibreGl(),n,i,g,g,h),flyTo:l===void 0?!0:!!l,apiKey:"",..._,...a};if(!E.apiKey)throw new Error("no apiKey provided");K0(this,gl,new uL({target:r,props:E}));for(const S of["select","pick","featuresListed","featuresMarked","response","optionsVisibilityChange","reverseToggle","queryChange"])Kl(this,gl).$on(S,A=>this.dispatchEvent(A));return r}setOptions(t){var r;K0(this,Md,t);const{marker:n,showResultMarkers:i,flyTo:l,fullGeometryStyle:h,...a}=Kl(this,Md);(r=Kl(this,gl))==null||r.$set(a)}setQuery(t,r=!0){var n;(n=Kl(this,gl))==null||n.setQuery(t,r)}clearMap(){var t;(t=Kl(this,gl))==null||t.clearMap()}clearList(){var t;(t=Kl(this,gl))==null||t.clearList()}setReverseMode(t){var r;(r=Kl(this,gl))==null||r.$set({reverseActive:t})}focus(){var t;(t=Kl(this,gl))==null||t.focus()}blur(){var t;(t=Kl(this,gl))==null||t.blur()}onRemove(){var t;(t=Kl(this,gl))==null||t.$destroy()}}gl=new WeakMap,Md=new WeakMap;class XL extends WL{getMapLibreGl(){return A2}onAdd(t){return super.onAddInt(t)}getExtraProps(){return{}}}Qe.forwardRef(({position:e,...t},r)=>{const n=Wp(()=>{const i=new XL({...t,maplibregl:yx});return i.addEventListener("pick",t.onSelection),i},{position:e});return Qe.useImperativeHandle(r,()=>n,[n]),null});var HL={color:void 0,size:void 0,className:void 0,style:void 0,attr:void 0};Sv.createContext;var W2="1.13.6",tE=typeof self=="object"&&self.self===self&&self||typeof global=="object"&&global.global===global&&global||Function("return this")()||{},L_=Array.prototype,wx=Object.prototype,eE=typeof Symbol<"u"?Symbol.prototype:null,YL=L_.push,fg=L_.slice,Am=wx.toString,KL=wx.hasOwnProperty,X2=typeof ArrayBuffer<"u",JL=typeof DataView<"u",QL=Array.isArray,rE=Object.keys,nE=Object.create,iE=X2&&ArrayBuffer.isView,tR=isNaN,eR=isFinite,H2=!{toString:null}.propertyIsEnumerable("toString"),oE=["valueOf","isPrototypeOf","toString","propertyIsEnumerable","hasOwnProperty","toLocaleString"],rR=Math.pow(2,53)-1;function va(e,t){return t=t==null?e.length-1:+t,function(){for(var r=Math.max(arguments.length-t,0),n=Array(r),i=0;i<r;i++)n[i]=arguments[i+t];switch(t){case 0:return e.call(this,n);case 1:return e.call(this,arguments[0],n);case 2:return e.call(this,arguments[0],arguments[1],n)}var l=Array(t+1);for(i=0;i<t;i++)l[i]=arguments[i];return l[t]=n,e.apply(this,l)}}function Xp(e){var t=typeof e;return t==="function"||t==="object"&&!!e}function nR(e){return e===null}function Y2(e){return e===void 0}function K2(e){return e===!0||e===!1||Am.call(e)==="[object Boolean]"}function iR(e){return!!(e&&e.nodeType===1)}function As(e){var t="[object "+e+"]";return function(r){return Am.call(r)===t}}const Ex=As("String"),J2=As("Number"),oR=As("Date"),sR=As("RegExp"),aR=As("Error"),Q2=As("Symbol"),tS=As("ArrayBuffer");var eS=As("Function"),lR=tE.document&&tE.document.childNodes;typeof/./!="function"&&typeof Int8Array!="object"&&typeof lR!="function"&&(eS=function(e){return typeof e=="function"||!1});const Ys=eS,rS=As("Object");var nS=JL&&rS(new DataView(new ArrayBuffer(8))),Sx=typeof Map<"u"&&rS(new Map),uR=As("DataView");function cR(e){return e!=null&&Ys(e.getInt8)&&tS(e.buffer)}const Hy=nS?cR:uR,Hp=QL||As("Array");function ap(e,t){return e!=null&&KL.call(e,t)}var Ov=As("Arguments");(function(){Ov(arguments)||(Ov=function(e){return ap(e,"callee")})})();const Tx=Ov;function hR(e){return!Q2(e)&&eR(e)&&!isNaN(parseFloat(e))}function iS(e){return J2(e)&&tR(e)}function oS(e){return function(){return e}}function sS(e){return function(t){var r=e(t);return typeof r=="number"&&r>=0&&r<=rR}}function aS(e){return function(t){return t==null?void 0:t[e]}}const Yy=aS("byteLength"),pR=sS(Yy);var dR=/\[object ((I|Ui)nt(8|16|32)|Float(32|64)|Uint8Clamped|Big(I|Ui)nt64)Array\]/;function fR(e){return iE?iE(e)&&!Hy(e):pR(e)&&dR.test(Am.call(e))}const lS=X2?fR:oS(!1),xa=aS("length");function mR(e){for(var t={},r=e.length,n=0;n<r;++n)t[e[n]]=!0;return{contains:function(i){return t[i]===!0},push:function(i){return t[i]=!0,e.push(i)}}}function uS(e,t){t=mR(t);var r=oE.length,n=e.constructor,i=Ys(n)&&n.prototype||wx,l="constructor";for(ap(e,l)&&!t.contains(l)&&t.push(l);r--;)l=oE[r],l in e&&e[l]!==i[l]&&!t.contains(l)&&t.push(l)}function Go(e){if(!Xp(e))return[];if(rE)return rE(e);var t=[];for(var r in e)ap(e,r)&&t.push(r);return H2&&uS(e,t),t}function gR(e){if(e==null)return!0;var t=xa(e);return typeof t=="number"&&(Hp(e)||Ex(e)||Tx(e))?t===0:xa(Go(e))===0}function cS(e,t){var r=Go(t),n=r.length;if(e==null)return!n;for(var i=Object(e),l=0;l<n;l++){var h=r[l];if(t[h]!==i[h]||!(h in i))return!1}return!0}function Sn(e){if(e instanceof Sn)return e;if(!(this instanceof Sn))return new Sn(e);this._wrapped=e}Sn.VERSION=W2;Sn.prototype.value=function(){return this._wrapped};Sn.prototype.valueOf=Sn.prototype.toJSON=Sn.prototype.value;Sn.prototype.toString=function(){return String(this._wrapped)};function sE(e){return new Uint8Array(e.buffer||e,e.byteOffset||0,Yy(e))}var aE="[object DataView]";function Fv(e,t,r,n){if(e===t)return e!==0||1/e===1/t;if(e==null||t==null)return!1;if(e!==e)return t!==t;var i=typeof e;return i!=="function"&&i!=="object"&&typeof t!="object"?!1:hS(e,t,r,n)}function hS(e,t,r,n){e instanceof Sn&&(e=e._wrapped),t instanceof Sn&&(t=t._wrapped);var i=Am.call(e);if(i!==Am.call(t))return!1;if(nS&&i=="[object Object]"&&Hy(e)){if(!Hy(t))return!1;i=aE}switch(i){case"[object RegExp]":case"[object String]":return""+e==""+t;case"[object Number]":return+e!=+e?+t!=+t:+e==0?1/+e===1/t:+e==+t;case"[object Date]":case"[object Boolean]":return+e==+t;case"[object Symbol]":return eE.valueOf.call(e)===eE.valueOf.call(t);case"[object ArrayBuffer]":case aE:return hS(sE(e),sE(t),r,n)}var l=i==="[object Array]";if(!l&&lS(e)){var h=Yy(e);if(h!==Yy(t))return!1;if(e.buffer===t.buffer&&e.byteOffset===t.byteOffset)return!0;l=!0}if(!l){if(typeof e!="object"||typeof t!="object")return!1;var a=e.constructor,g=t.constructor;if(a!==g&&!(Ys(a)&&a instanceof a&&Ys(g)&&g instanceof g)&&"constructor"in e&&"constructor"in t)return!1}r=r||[],n=n||[];for(var _=r.length;_--;)if(r[_]===e)return n[_]===t;if(r.push(e),n.push(t),l){if(_=e.length,_!==t.length)return!1;for(;_--;)if(!Fv(e[_],t[_],r,n))return!1}else{var E=Go(e),S;if(_=E.length,Go(t).length!==_)return!1;for(;_--;)if(S=E[_],!(ap(t,S)&&Fv(e[S],t[S],r,n)))return!1}return r.pop(),n.pop(),!0}function yR(e,t){return Fv(e,t)}function mg(e){if(!Xp(e))return[];var t=[];for(var r in e)t.push(r);return H2&&uS(e,t),t}function Ix(e){var t=xa(e);return function(r){if(r==null)return!1;var n=mg(r);if(xa(n))return!1;for(var i=0;i<t;i++)if(!Ys(r[e[i]]))return!1;return e!==fS||!Ys(r[Cx])}}var Cx="forEach",pS="has",Mx=["clear","delete"],dS=["get",pS,"set"],_R=Mx.concat(Cx,dS),fS=Mx.concat(dS),vR=["add"].concat(Mx,Cx,pS);const xR=Sx?Ix(_R):As("Map"),bR=Sx?Ix(fS):As("WeakMap"),wR=Sx?Ix(vR):As("Set"),ER=As("WeakSet");function ff(e){for(var t=Go(e),r=t.length,n=Array(r),i=0;i<r;i++)n[i]=e[t[i]];return n}function SR(e){for(var t=Go(e),r=t.length,n=Array(r),i=0;i<r;i++)n[i]=[t[i],e[t[i]]];return n}function mS(e){for(var t={},r=Go(e),n=0,i=r.length;n<i;n++)t[e[r[n]]]=r[n];return t}function zv(e){var t=[];for(var r in e)Ys(e[r])&&t.push(r);return t.sort()}function Px(e,t){return function(r){var n=arguments.length;if(t&&(r=Object(r)),n<2||r==null)return r;for(var i=1;i<n;i++)for(var l=arguments[i],h=e(l),a=h.length,g=0;g<a;g++){var _=h[g];(!t||r[_]===void 0)&&(r[_]=l[_])}return r}}const gS=Px(mg),Ky=Px(Go),yS=Px(mg,!0);function TR(){return function(){}}function _S(e){if(!Xp(e))return{};if(nE)return nE(e);var t=TR();t.prototype=e;var r=new t;return t.prototype=null,r}function IR(e,t){var r=_S(e);return t&&Ky(r,t),r}function CR(e){return Xp(e)?Hp(e)?e.slice():gS({},e):e}function MR(e,t){return t(e),e}function vS(e){return Hp(e)?e:[e]}Sn.toPath=vS;function gg(e){return Sn.toPath(e)}function Ax(e,t){for(var r=t.length,n=0;n<r;n++){if(e==null)return;e=e[t[n]]}return r?e:void 0}function xS(e,t,r){var n=Ax(e,gg(t));return Y2(n)?r:n}function PR(e,t){t=gg(t);for(var r=t.length,n=0;n<r;n++){var i=t[n];if(!ap(e,i))return!1;e=e[i]}return!!r}function Lx(e){return e}function Lm(e){return e=Ky({},e),function(t){return cS(t,e)}}function Rx(e){return e=gg(e),function(t){return Ax(t,e)}}function yg(e,t,r){if(t===void 0)return e;switch(r??3){case 1:return function(n){return e.call(t,n)};case 3:return function(n,i,l){return e.call(t,n,i,l)};case 4:return function(n,i,l,h){return e.call(t,n,i,l,h)}}return function(){return e.apply(t,arguments)}}function bS(e,t,r){return e==null?Lx:Ys(e)?yg(e,t,r):Xp(e)&&!Hp(e)?Lm(e):Rx(e)}function Dx(e,t){return bS(e,t,1/0)}Sn.iteratee=Dx;function Ta(e,t,r){return Sn.iteratee!==Dx?Sn.iteratee(e,t):bS(e,t,r)}function AR(e,t,r){t=Ta(t,r);for(var n=Go(e),i=n.length,l={},h=0;h<i;h++){var a=n[h];l[a]=t(e[a],a,e)}return l}function wS(){}function LR(e){return e==null?wS:function(t){return xS(e,t)}}function RR(e,t,r){var n=Array(Math.max(0,e));t=yg(t,r,1);for(var i=0;i<e;i++)n[i]=t(i);return n}function Bv(e,t){return t==null&&(t=e,e=0),e+Math.floor(Math.random()*(t-e+1))}const Rm=Date.now||function(){return new Date().getTime()};function ES(e){var t=function(l){return e[l]},r="(?:"+Go(e).join("|")+")",n=RegExp(r),i=RegExp(r,"g");return function(l){return l=l==null?"":""+l,n.test(l)?l.replace(i,t):l}}const SS={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;","`":"&#x60;"},DR=ES(SS),NR=mS(SS),kR=ES(NR),OR=Sn.templateSettings={evaluate:/<%([\s\S]+?)%>/g,interpolate:/<%=([\s\S]+?)%>/g,escape:/<%-([\s\S]+?)%>/g};var ev=/(.)^/,FR={"'":"'","\\":"\\","\r":"r","\n":"n","\u2028":"u2028","\u2029":"u2029"},zR=/\\|'|\r|\n|\u2028|\u2029/g;function BR(e){return"\\"+FR[e]}var $R=/^\s*(\w|\$)+\s*$/;function UR(e,t,r){!t&&r&&(t=r),t=yS({},t,Sn.templateSettings);var n=RegExp([(t.escape||ev).source,(t.interpolate||ev).source,(t.evaluate||ev).source].join("|")+"|$","g"),i=0,l="__p+='";e.replace(n,function(_,E,S,A,O){return l+=e.slice(i,O).replace(zR,BR),i=O+_.length,E?l+=`'+
((__t=(`+E+`))==null?'':_.escape(__t))+
'`:S?l+=`'+
((__t=(`+S+`))==null?'':__t)+
'`:A&&(l+=`';
`+A+`
__p+='`),_}),l+=`';
`;var h=t.variable;if(h){if(!$R.test(h))throw new Error("variable is not a bare identifier: "+h)}else l=`with(obj||{}){
`+l+`}
`,h="obj";l=`var __t,__p='',__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,'');};
`+l+`return __p;
`;var a;try{a=new Function(h,"_",l)}catch(_){throw _.source=l,_}var g=function(_){return a.call(this,_,Sn)};return g.source="function("+h+`){
`+l+"}",g}function jR(e,t,r){t=gg(t);var n=t.length;if(!n)return Ys(r)?r.call(e):r;for(var i=0;i<n;i++){var l=e==null?void 0:e[t[i]];l===void 0&&(l=r,i=n),e=Ys(l)?l.call(e):l}return e}var VR=0;function GR(e){var t=++VR+"";return e?e+t:t}function qR(e){var t=Sn(e);return t._chain=!0,t}function TS(e,t,r,n,i){if(!(n instanceof t))return e.apply(r,i);var l=_S(e.prototype),h=e.apply(l,i);return Xp(h)?h:l}var mf=va(function(e,t){var r=mf.placeholder,n=function(){for(var i=0,l=t.length,h=Array(l),a=0;a<l;a++)h[a]=t[a]===r?arguments[i++]:t[a];for(;i<arguments.length;)h.push(arguments[i++]);return TS(e,n,this,this,h)};return n});mf.placeholder=Sn;const IS=va(function(e,t,r){if(!Ys(e))throw new TypeError("Bind must be called on a function");var n=va(function(i){return TS(e,n,t,this,r.concat(i))});return n}),Ya=sS(xa);function Yp(e,t,r,n){if(n=n||[],!t&&t!==0)t=1/0;else if(t<=0)return n.concat(e);for(var i=n.length,l=0,h=xa(e);l<h;l++){var a=e[l];if(Ya(a)&&(Hp(a)||Tx(a)))if(t>1)Yp(a,t-1,r,n),i=n.length;else for(var g=0,_=a.length;g<_;)n[i++]=a[g++];else r||(n[i++]=a)}return n}const ZR=va(function(e,t){t=Yp(t,!1,!1);var r=t.length;if(r<1)throw new Error("bindAll must be passed function names");for(;r--;){var n=t[r];e[n]=IS(e[n],e)}return e});function WR(e,t){var r=function(n){var i=r.cache,l=""+(t?t.apply(this,arguments):n);return ap(i,l)||(i[l]=e.apply(this,arguments)),i[l]};return r.cache={},r}const CS=va(function(e,t,r){return setTimeout(function(){return e.apply(null,r)},t)}),XR=mf(CS,Sn,1);function HR(e,t,r){var n,i,l,h,a=0;r||(r={});var g=function(){a=r.leading===!1?0:Rm(),n=null,h=e.apply(i,l),n||(i=l=null)},_=function(){var E=Rm();!a&&r.leading===!1&&(a=E);var S=t-(E-a);return i=this,l=arguments,S<=0||S>t?(n&&(clearTimeout(n),n=null),a=E,h=e.apply(i,l),n||(i=l=null)):!n&&r.trailing!==!1&&(n=setTimeout(g,S)),h};return _.cancel=function(){clearTimeout(n),a=0,n=i=l=null},_}function YR(e,t,r){var n,i,l,h,a,g=function(){var E=Rm()-i;t>E?n=setTimeout(g,t-E):(n=null,r||(h=e.apply(a,l)),n||(l=a=null))},_=va(function(E){return a=this,l=E,i=Rm(),n||(n=setTimeout(g,t),r&&(h=e.apply(a,l))),h});return _.cancel=function(){clearTimeout(n),n=l=a=null},_}function KR(e,t){return mf(t,e)}function Nx(e){return function(){return!e.apply(this,arguments)}}function JR(){var e=arguments,t=e.length-1;return function(){for(var r=t,n=e[t].apply(this,arguments);r--;)n=e[r].call(this,n);return n}}function QR(e,t){return function(){if(--e<1)return t.apply(this,arguments)}}function MS(e,t){var r;return function(){return--e>0&&(r=t.apply(this,arguments)),e<=1&&(t=null),r}}const tD=mf(MS,2);function PS(e,t,r){t=Ta(t,r);for(var n=Go(e),i,l=0,h=n.length;l<h;l++)if(i=n[l],t(e[i],i,e))return i}function AS(e){return function(t,r,n){r=Ta(r,n);for(var i=xa(t),l=e>0?0:i-1;l>=0&&l<i;l+=e)if(r(t[l],l,t))return l;return-1}}const kx=AS(1),LS=AS(-1);function RS(e,t,r,n){r=Ta(r,n,1);for(var i=r(t),l=0,h=xa(e);l<h;){var a=Math.floor((l+h)/2);r(e[a])<i?l=a+1:h=a}return l}function DS(e,t,r){return function(n,i,l){var h=0,a=xa(n);if(typeof l=="number")e>0?h=l>=0?l:Math.max(l+a,h):a=l>=0?Math.min(l+1,a):l+a+1;else if(r&&l&&a)return l=r(n,i),n[l]===i?l:-1;if(i!==i)return l=t(fg.call(n,h,a),iS),l>=0?l+h:-1;for(l=e>0?h:a-1;l>=0&&l<a;l+=e)if(n[l]===i)return l;return-1}}const NS=DS(1,kx,RS),eD=DS(-1,LS);function $v(e,t,r){var n=Ya(e)?kx:PS,i=n(e,t,r);if(i!==void 0&&i!==-1)return e[i]}function rD(e,t){return $v(e,Lm(t))}function Uc(e,t,r){t=yg(t,r);var n,i;if(Ya(e))for(n=0,i=e.length;n<i;n++)t(e[n],n,e);else{var l=Go(e);for(n=0,i=l.length;n<i;n++)t(e[l[n]],l[n],e)}return e}function Pp(e,t,r){t=Ta(t,r);for(var n=!Ya(e)&&Go(e),i=(n||e).length,l=Array(i),h=0;h<i;h++){var a=n?n[h]:h;l[h]=t(e[a],a,e)}return l}function kS(e){var t=function(r,n,i,l){var h=!Ya(r)&&Go(r),a=(h||r).length,g=e>0?0:a-1;for(l||(i=r[h?h[g]:g],g+=e);g>=0&&g<a;g+=e){var _=h?h[g]:g;i=n(i,r[_],_,r)}return i};return function(r,n,i,l){var h=arguments.length>=3;return t(r,yg(n,l,4),i,h)}}const rv=kS(1),lE=kS(-1);function zd(e,t,r){var n=[];return t=Ta(t,r),Uc(e,function(i,l,h){t(i,l,h)&&n.push(i)}),n}function nD(e,t,r){return zd(e,Nx(Ta(t)),r)}function uE(e,t,r){t=Ta(t,r);for(var n=!Ya(e)&&Go(e),i=(n||e).length,l=0;l<i;l++){var h=n?n[l]:l;if(!t(e[h],h,e))return!1}return!0}function cE(e,t,r){t=Ta(t,r);for(var n=!Ya(e)&&Go(e),i=(n||e).length,l=0;l<i;l++){var h=n?n[l]:l;if(t(e[h],h,e))return!0}return!1}function Oc(e,t,r,n){return Ya(e)||(e=ff(e)),(typeof r!="number"||n)&&(r=0),NS(e,t,r)>=0}const iD=va(function(e,t,r){var n,i;return Ys(t)?i=t:(t=gg(t),n=t.slice(0,-1),t=t[t.length-1]),Pp(e,function(l){var h=i;if(!h){if(n&&n.length&&(l=Ax(l,n)),l==null)return;h=l[t]}return h==null?h:h.apply(l,r)})});function Ox(e,t){return Pp(e,Rx(t))}function oD(e,t){return zd(e,Lm(t))}function OS(e,t,r){var n=-1/0,i=-1/0,l,h;if(t==null||typeof t=="number"&&typeof e[0]!="object"&&e!=null){e=Ya(e)?e:ff(e);for(var a=0,g=e.length;a<g;a++)l=e[a],l!=null&&l>n&&(n=l)}else t=Ta(t,r),Uc(e,function(_,E,S){h=t(_,E,S),(h>i||h===-1/0&&n===-1/0)&&(n=_,i=h)});return n}function sD(e,t,r){var n=1/0,i=1/0,l,h;if(t==null||typeof t=="number"&&typeof e[0]!="object"&&e!=null){e=Ya(e)?e:ff(e);for(var a=0,g=e.length;a<g;a++)l=e[a],l!=null&&l<n&&(n=l)}else t=Ta(t,r),Uc(e,function(_,E,S){h=t(_,E,S),(h<i||h===1/0&&n===1/0)&&(n=_,i=h)});return n}var aD=/[^\ud800-\udfff]|[\ud800-\udbff][\udc00-\udfff]|[\ud800-\udfff]/g;function FS(e){return e?Hp(e)?fg.call(e):Ex(e)?e.match(aD):Ya(e)?Pp(e,Lx):ff(e):[]}function zS(e,t,r){if(t==null||r)return Ya(e)||(e=ff(e)),e[Bv(e.length-1)];var n=FS(e),i=xa(n);t=Math.max(Math.min(t,i),0);for(var l=i-1,h=0;h<t;h++){var a=Bv(h,l),g=n[h];n[h]=n[a],n[a]=g}return n.slice(0,t)}function lD(e){return zS(e,1/0)}function uD(e,t,r){var n=0;return t=Ta(t,r),Ox(Pp(e,function(i,l,h){return{value:i,index:n++,criteria:t(i,l,h)}}).sort(function(i,l){var h=i.criteria,a=l.criteria;if(h!==a){if(h>a||h===void 0)return 1;if(h<a||a===void 0)return-1}return i.index-l.index}),"value")}function R_(e,t){return function(r,n,i){var l=t?[[],[]]:{};return n=Ta(n,i),Uc(r,function(h,a){var g=n(h,a,r);e(l,h,g)}),l}}const cD=R_(function(e,t,r){ap(e,r)?e[r].push(t):e[r]=[t]}),hD=R_(function(e,t,r){e[r]=t}),pD=R_(function(e,t,r){ap(e,r)?e[r]++:e[r]=1}),dD=R_(function(e,t,r){e[r?0:1].push(t)},!0);function fD(e){return e==null?0:Ya(e)?e.length:Go(e).length}function mD(e,t,r){return t in r}const BS=va(function(e,t){var r={},n=t[0];if(e==null)return r;Ys(n)?(t.length>1&&(n=yg(n,t[1])),t=mg(e)):(n=mD,t=Yp(t,!1,!1),e=Object(e));for(var i=0,l=t.length;i<l;i++){var h=t[i],a=e[h];n(a,h,e)&&(r[h]=a)}return r}),gD=va(function(e,t){var r=t[0],n;return Ys(r)?(r=Nx(r),t.length>1&&(n=t[1])):(t=Pp(Yp(t,!1,!1),String),r=function(i,l){return!Oc(t,l)}),BS(e,r,n)});function $S(e,t,r){return fg.call(e,0,Math.max(0,e.length-(t==null||r?1:t)))}function nv(e,t,r){return e==null||e.length<1?t==null||r?void 0:[]:t==null||r?e[0]:$S(e,e.length-t)}function Fy(e,t,r){return fg.call(e,t==null||r?1:t)}function yD(e,t,r){return e==null||e.length<1?t==null||r?void 0:[]:t==null||r?e[e.length-1]:Fy(e,Math.max(0,e.length-t))}function _D(e){return zd(e,Boolean)}function vD(e,t){return Yp(e,t,!1)}const US=va(function(e,t){return t=Yp(t,!0,!0),zd(e,function(r){return!Oc(t,r)})}),xD=va(function(e,t){return US(e,t)});function Uv(e,t,r,n){K2(t)||(n=r,r=t,t=!1),r!=null&&(r=Ta(r,n));for(var i=[],l=[],h=0,a=xa(e);h<a;h++){var g=e[h],_=r?r(g,h,e):g;t&&!r?((!h||l!==_)&&i.push(g),l=_):r?Oc(l,_)||(l.push(_),i.push(g)):Oc(i,g)||i.push(g)}return i}const bD=va(function(e){return Uv(Yp(e,!0,!0))});function wD(e){for(var t=[],r=arguments.length,n=0,i=xa(e);n<i;n++){var l=e[n];if(!Oc(t,l)){var h;for(h=1;h<r&&Oc(arguments[h],l);h++);h===r&&t.push(l)}}return t}function jv(e){for(var t=e&&OS(e,xa).length||0,r=Array(t),n=0;n<t;n++)r[n]=Ox(e,n);return r}const ED=va(jv);function SD(e,t){for(var r={},n=0,i=xa(e);n<i;n++)t?r[e[n]]=t[n]:r[e[n][0]]=e[n][1];return r}function TD(e,t,r){t==null&&(t=e||0,e=0),r||(r=t<e?-1:1);for(var n=Math.max(Math.ceil((t-e)/r),0),i=Array(n),l=0;l<n;l++,e+=r)i[l]=e;return i}function ID(e,t){if(t==null||t<1)return[];for(var r=[],n=0,i=e.length;n<i;)r.push(fg.call(e,n,n+=t));return r}function Fx(e,t){return e._chain?Sn(t).chain():t}function jS(e){return Uc(zv(e),function(t){var r=Sn[t]=e[t];Sn.prototype[t]=function(){var n=[this._wrapped];return YL.apply(n,arguments),Fx(this,r.apply(Sn,n))}}),Sn}Uc(["pop","push","reverse","shift","sort","splice","unshift"],function(e){var t=L_[e];Sn.prototype[e]=function(){var r=this._wrapped;return r!=null&&(t.apply(r,arguments),(e==="shift"||e==="splice")&&r.length===0&&delete r[0]),Fx(this,r)}});Uc(["concat","join","slice"],function(e){var t=L_[e];Sn.prototype[e]=function(){var r=this._wrapped;return r!=null&&(r=t.apply(r,arguments)),Fx(this,r)}});const CD=Object.freeze(Object.defineProperty({__proto__:null,VERSION:W2,after:QR,all:uE,allKeys:mg,any:cE,assign:Ky,before:MS,bind:IS,bindAll:ZR,chain:qR,chunk:ID,clone:CR,collect:Pp,compact:_D,compose:JR,constant:oS,contains:Oc,countBy:pD,create:IR,debounce:YR,default:Sn,defaults:yS,defer:XR,delay:CS,detect:$v,difference:US,drop:Fy,each:Uc,escape:DR,every:uE,extend:gS,extendOwn:Ky,filter:zd,find:$v,findIndex:kx,findKey:PS,findLastIndex:LS,findWhere:rD,first:nv,flatten:vD,foldl:rv,foldr:lE,forEach:Uc,functions:zv,get:xS,groupBy:cD,has:PR,head:nv,identity:Lx,include:Oc,includes:Oc,indexBy:hD,indexOf:NS,initial:$S,inject:rv,intersection:wD,invert:mS,invoke:iD,isArguments:Tx,isArray:Hp,isArrayBuffer:tS,isBoolean:K2,isDataView:Hy,isDate:oR,isElement:iR,isEmpty:gR,isEqual:yR,isError:aR,isFinite:hR,isFunction:Ys,isMap:xR,isMatch:cS,isNaN:iS,isNull:nR,isNumber:J2,isObject:Xp,isRegExp:sR,isSet:wR,isString:Ex,isSymbol:Q2,isTypedArray:lS,isUndefined:Y2,isWeakMap:bR,isWeakSet:ER,iteratee:Dx,keys:Go,last:yD,lastIndexOf:eD,map:Pp,mapObject:AR,matcher:Lm,matches:Lm,max:OS,memoize:WR,methods:zv,min:sD,mixin:jS,negate:Nx,noop:wS,now:Rm,object:SD,omit:gD,once:tD,pairs:SR,partial:mf,partition:dD,pick:BS,pluck:Ox,property:Rx,propertyOf:LR,random:Bv,range:TD,reduce:rv,reduceRight:lE,reject:nD,rest:Fy,restArguments:va,result:jR,sample:zS,select:zd,shuffle:lD,size:fD,some:cE,sortBy:uD,sortedIndex:RS,tail:Fy,take:nv,tap:MR,template:UR,templateSettings:OR,throttle:HR,times:RR,toArray:FS,toPath:vS,transpose:jv,unescape:kR,union:bD,uniq:Uv,unique:Uv,uniqueId:GR,unzip:jv,values:ff,where:oD,without:xD,wrap:KR,zip:ED},Symbol.toStringTag,{value:"Module"}));var Dm=jS(CD);Dm._=Dm;var MD=Object.defineProperty,PD=(e,t,r)=>t in e?MD(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,Nt=(e,t,r)=>(PD(e,typeof t!="symbol"?t+"":t,r),r),zx=(e,t,r)=>{if(!t.has(e))throw TypeError("Cannot "+r)},Du=(e,t,r)=>(zx(e,t,"read from private field"),r?r.call(e):t.get(e)),VS=(e,t,r)=>{if(t.has(e))throw TypeError("Cannot add the same private member more than once");t instanceof WeakSet?t.add(e):t.set(e,r)},iv=(e,t,r,n)=>(zx(e,t,"write to private field"),n?n.call(e,r):t.set(e,r),r),hE=(e,t,r)=>(zx(e,t,"access private method"),r);function Nd(e,t){const r=t[0],n=t[1];return[e[0]*r+e[2]*n+e[4],e[1]*r+e[3]*n+e[5]]}function AD(){return[1,0,0,1,0,0]}function LD(e,t){const r=e[0],n=e[1],i=e[2],l=e[3],h=e[4],a=e[5],g=t[0],_=t[1],E=t[2],S=t[3],A=t[4],O=t[5];return[r*g+i*_,n*g+l*_,r*E+i*S,n*E+l*S,r*A+i*O+h,n*A+l*O+a]}function pE(e,t,r,n,i,l,h){const a=Math.sin(i),g=Math.cos(i);return[r*g,n*a,-r*a,n*g,l*r*g-h*r*a+e,l*n*a+h*n*g+t]}function RD(e){const t=DD(e),r=e[0],n=e[1],i=e[2],l=e[3],h=e[4],a=e[5];return[l/t,-n/t,-i/t,r/t,(i*a-l*h)/t,-(r*a-n*h)/t]}function DD(e){return e[0]*e[3]-e[1]*e[2]}function ND(e){const t=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1];return t[0]=e[0],t[1]=e[1],t[4]=e[2],t[5]=e[3],t[12]=e[4],t[13]=e[5],t}async function GS(e,t,r){let n;if(typeof r=="function"?n=await r(e,t):n=await fetch(e,t),!n.ok)throw new Error(n.statusText);return n}async function kD(e,t,r){return await(await GS(e,t,r)).json()}async function OD(e,t,r){return await kD(`${e}/info.json`,t,r)}function qS(e,t=!1){switch(e.type){case"Polygon":return e.coordinates?{...e,coordinates:dE(e.coordinates,t)}:e;case"MultiPolygon":return e.coordinates?{...e,coordinates:e.coordinates.map(r=>dE(r,t))}:e;case"GeometryCollection":return{...e,geometries:e.geometries.map(r=>qS(r,t))};default:return e}}function dE(e,t){if(e.length===0)return e;const r=[];for(let n=0;n<e.length;n++)r.push(FD(e[n],n===0?t:!t));return r}function FD(e,t){let r=0,n=0;for(let i=0,l=e.length,h=l-1;i<l;h=i++){const a=(e[i][0]-e[h][0])*(e[h][1]+e[i][1]),g=r+a;n+=Math.abs(r)>=Math.abs(a)?r-g+a:a-g+r,r=g}return r+n>=0!=!!t?e.slice().reverse():e}function Ws(e){return Array.isArray(e)&&e.length===2&&typeof e[0]=="number"&&typeof e[1]=="number"}function Ql(e){return Array.isArray(e)&&e.every(Ws)}function zD(e){return Array.isArray(e)&&e.every(Ws)}function tu(e){return Array.isArray(e)&&e.every(zD)}function Ec(e){return Array.isArray(e)&&e.every(Ws)}function Sc(e){return Array.isArray(e)&&e.every(Ql)}function Tc(e){return Array.isArray(e)&&e.every(tu)}function D_(e){if(e=e.filter(function(t,r,n){return r===0||!$x(t,n[r-1])}),e.length<2)throw new Error("LineString should contain at least 2 points");return e}function Bx(e){if(e=e.filter(function(t,r,n){return r===0||!$x(t,n[r-1])}),UD(e)&&e.splice(-1),e.length<3)throw new Error("Ring should contain at least 3 points");return e}function ZS(e){return e.map(t=>Bx(t))}function BD(e){return e.map(t=>D_(t))}function $D(e){return e.map(t=>ZS(t))}function oy(e){return{type:"Point",coordinates:e}}function sy(e){return{type:"LineString",coordinates:e}}function ay(e,t=!0){const r={type:"Polygon",coordinates:t?e.map(n=>[...n,n[0]]):e};return qS(r)}function UD(e){return Array.isArray(e)&&e.length>=2&&$x(e[0],e[e.length-1])}function $x(e,t){return e===t?!0:e===null||t===null?!1:e[0]===t[0]&&e[1]===t[1]}function jD(e){return[e[0],-e[1]]}function Jy(e,t){return[(t[0]-e[0])/2+e[0],(t[1]-e[1])/2+e[1]]}function VD(e,t,r){return e*r+t*(1-r)}function GD(e,t,r){return[e[0]*r+t[0]*(1-r),e[1]*r+t[1]*(1-r)]}function Ba(e,t){if(Ql(e)&&e.length===2)return Ba(e[0],e[1]);if(Ws(e)&&Ws(t))return Math.sqrt((t[0]-e[0])**2+(t[1]-e[1])**2);throw new Error("Input type not supported")}function qD(e){return e*(Math.PI/180)}function Ic(e){return typeof e=="object"&&e!==null&&e.type==="Point"&&Ws(e.coordinates)}function Cc(e){return typeof e=="object"&&e!==null&&e.type==="LineString"&&Ql(e.coordinates)}function Mc(e){return typeof e=="object"&&e!==null&&e.type==="Polygon"&&Array.isArray(e.coordinates)&&tu(e.coordinates)}function Pc(e){return typeof e=="object"&&e!==null&&e.type==="MultiPoint"&&Ec(e.coordinates)}function Ac(e){return typeof e=="object"&&e!==null&&e.type==="MultiLineString"&&Sc(e.coordinates)}function Lc(e){return typeof e=="object"&&e!==null&&e.type==="MultiPolygon"&&Array.isArray(e.coordinates)&&Tc(e.coordinates)}function ZD(e){const t=typeof e=="object"&&e!==null,r=t&&"type"in e&&typeof e.type=="string"&&(e.type==="Point"||e.type==="LineString"||e.type==="Polygon"||e.type==="MultiPoint"||e.type==="MultiLineString"||e.type==="MultiPolygon"),n=t&&"coordinates"in e&&Array.isArray(e.coordinates);return r&&n}function dm(e){return e.coordinates}function fm(e){return D_(e.coordinates)}function mm(e,t=!1){let r=e.coordinates;return r=ZS(r),t?r.map(n=>[...n,n[0]]):r}function WD(e){return e.coordinates}function XD(e){return BD(e.coordinates)}function HD(e,t=!1){let r=e.coordinates;return r=$D(r),t?r.map(n=>n.map(i=>[...i,i[0]])):r}function YD(e){if(Ic(e))return dm(e);if(Cc(e))return fm(e);if(Mc(e))return mm(e);if(Pc(e))return WD(e);if(Ac(e))return XD(e);if(Lc(e))return HD(e);throw new Error("Geometry type not supported")}function ly(e){return e.coordinates.map(t=>({type:"Point",coordinates:t}))}function uy(e){return e.coordinates.map(t=>({type:"LineString",coordinates:t}))}function cy(e){return e.coordinates.map(t=>({type:"Polygon",coordinates:t}))}function hy(e){return{type:"MultiPoint",coordinates:e.map(t=>t.coordinates)}}function py(e){return{type:"MultiLineString",coordinates:e.map(t=>t.coordinates)}}function dy(e){return{type:"MultiPolygon",coordinates:e.map(t=>t.coordinates)}}function KD(e,t){return{type:"Feature",properties:t||{},geometry:e}}function JD(e,t){return{type:"FeatureCollection",features:e.map((r,n)=>KD(r))}}function QD(e){return e.geometry}function tN(e){return e.features.map(QD)}function fE(e){let t=Number.POSITIVE_INFINITY,r=Number.NEGATIVE_INFINITY;for(const n of e)t===void 0?n>=n&&(t=r=n):(t>n&&(t=n),r<n&&(r=n));return[t,r]}function Es(e){if(Ws(e)&&(e=[e]),tu(e)&&(e=e.flat()),ZD(e))return Es(YD(e));const t=[],r=[];for(const a of e)t.push(a[0]),r.push(a[1]);const[n,i]=fE(t),[l,h]=fE(r);return[n,l,i,h]}function mE(e,t){return[Math.min(e[0],t[0]),Math.min(e[1],t[1]),Math.max(e[2],t[2]),Math.max(e[3],t[3])]}function eN(e,t){const r=e[2]>=t[0]&&t[2]>=e[0],n=e[3]>=t[1]&&t[3]>=e[1];return r&&n}function Qy(e){return[[e[0],e[1]],[e[2],e[1]],[e[2],e[3]],[e[0],e[3]]]}function WS(e){return[[e[0],e[1]],[e[2],e[3]]]}function rN(e){return Ba(WS(e))}function nN(e){return Ba(WS(Es(e)))}function Bd(e){return[(e[0]+e[2])/2,(e[1]+e[3])/2]}function ov(e){return[e[2]-e[0],e[3]-e[1]]}function Vv(e){return[.5*(Ba(e[0],e[1])+Ba(e[2],e[3])),.5*(Ba(e[1],e[2])+Ba(e[3],e[0]))]}function t_(e,t,r){return r?r==="contain"?t[0]>=t[1]?e[0]/t[0]:e[1]/t[1]:t[0]>=t[1]?e[1]/t[1]:e[0]/t[0]:Math.sqrt(e[0]*e[1]/(t[0]*t[1]))}function gE(e,t){return t_(Vv(e),Vv(t))}function zy(e,t,r,n=!0){if(e.has(t)&&n)return e.get(t);{const i=r();return e.set(t,i),i}}function sv(e,t,r,n,i=!0){var l,h,a;if((l=e.get(t))!=null&&l.has(r)&&i)return(h=e.get(t))==null?void 0:h.get(r);{const g=n();return e.get(t)||e.set(t,new Map),(a=e.get(t))==null||a.set(r,g),g}}function iN(e){const t=parseInt(e.replace(/^#/,""),16),r=t>>16&255,n=t>>8&255,i=t&255;return[r,n,i]}function fy(e){return iN(e).map(t=>t/255)}function oN(e,t){return!e||!t||e.size!==t.size?!1:[...e].every(r=>t.has(r))}function yE(e,t){if(e!==void 0&&t!==void 0)return Math.max(e,t);if(e!==void 0)return e;if(t!==void 0)return t}function sN(e,t){t===void 0&&(t={});var r=t.offsetLine||0,n=t.offsetColumn||0,i=e.split(`
`),l=0,h=i.map(function(S,A){var O=l+S.length+1,k={start:l,end:O,line:A};return l=O,k}),a=0;function g(S,A){return S.start<=A&&A<S.end}function _(S,A){return{line:r+S.line,column:n+A-S.start,character:A}}function E(S,A){typeof S=="string"&&(S=e.indexOf(S,A||0));for(var O=h[a],k=S>=O.end?1:-1;O;){if(g(O,S))return _(O,S);a+=k,O=h[a]}}return E}function aN(e,t,r){return sN(e,r)(t,r)}var _E=/[a-zA-Z0-9:_-]/,vE=/[\s\t\r\n]/,lN=/['"]/;function uN(e,t){for(var r="";t--;)r+=e;return r}function cN(e){var t="",r=[],n=a,i=null,l=null;function h(V){var it=aN(e,$),vt=it.line,ot=it.column,et=e.slice(0,$),wt=/(^|\n).*$/.exec(et)[0].replace(/\t/g,"  "),J=e.slice($),xt=/.*(\n|$)/.exec(J)[0],$t=""+wt+xt+`
`+uN(" ",wt.length)+"^";throw new Error(V+" ("+vt+":"+ot+`). If this is valid SVG, it's probably a bug in svg-parser. Please raise an issue at https://github.com/Rich-Harris/svg-parser/issues  thanks!

`+$t)}function a(){for(;$<e.length&&e[$]!=="<"||!_E.test(e[$+1]);)t+=e[$++];return g()}function g(){for(var V="";$<e.length&&e[$]!=="<";)V+=e[$++];return/\S/.test(V)&&i.children.push({type:"text",value:V}),e[$]==="<"?_:g}function _(){var V=e[$];if(V==="?")return g;if(V==="!"){if(e.slice($+1,$+3)==="--")return E;if(e.slice($+1,$+8)==="[CDATA[")return S;if(/doctype/i.test(e.slice($+1,$+8)))return g}if(V==="/")return A;var it=O(),vt={type:"element",tagName:it,properties:{},children:[]};i?i.children.push(vt):l=vt;for(var ot;$<e.length&&(ot=k());)vt.properties[ot.name]=ot.value;var et=!1;return e[$]==="/"&&($+=1,et=!0),e[$]!==">"&&h("Expected >"),et||(i=vt,r.push(vt)),g}function E(){var V=e.indexOf("-->",$);return~V||h("expected -->"),$=V+2,g}function S(){var V=e.indexOf("]]>",$);return~V||h("expected ]]>"),i.children.push(e.slice($+7,V)),$=V+2,g}function A(){var V=O();return V||h("Expected tag name"),V!==i.tagName&&h("Expected closing tag </"+V+"> to match opening tag <"+i.tagName+">"),tt(),e[$]!==">"&&h("Expected >"),r.pop(),i=r[r.length-1],g}function O(){for(var V="";$<e.length&&_E.test(e[$]);)V+=e[$++];return V}function k(){if(!vE.test(e[$]))return null;tt();var V=O();if(!V)return null;var it=!0;return tt(),e[$]==="="&&($+=1,tt(),it=G(),!isNaN(it)&&it.trim()!==""&&(it=+it)),{name:V,value:it}}function G(){return lN.test(e[$])?U():W()}function W(){var V="";do{var it=e[$];if(it===" "||it===">"||it==="/")return V;V+=it,$+=1}while($<e.length);return V}function U(){for(var V=e[$++],it="",vt=!1;$<e.length;){var ot=e[$++];if(ot===V&&!vt)return it;ot==="\\"&&!vt&&(vt=!0),it+=vt?"\\"+ot:ot,vt=!1}}function tt(){for(;$<e.length&&vE.test(e[$]);)$+=1}for(var $=a.length;$<e.length;)n||h("Unexpected character"),n=n(),$+=1;return n!==g&&h("Unexpected end of input"),l.tagName==="svg"&&(l.metadata=t),{type:"root",children:[l]}}function*hN(e){function*t(n){if("children"in n)for(const i of n.children)typeof i!="string"&&(yield*t(i));yield n}const r=cN(e);for(const n of t(r))if("tagName"in n&&n.tagName!=="svg"&&n.tagName!=="g"){const i=pN(n);i&&(yield i)}}function pN(e){var t;const r=(t=e==null?void 0:e.tagName)==null?void 0:t.toLowerCase();if(r==="circle")return{type:"circle",coordinates:[ro(e,"cx"),ro(e,"cy")]};if(r==="line")return{type:"line",coordinates:[[ro(e,"x1"),ro(e,"y1")],[ro(e,"x2"),ro(e,"y2")]]};if(r==="polyline")return{type:"polyline",coordinates:xE(e)};if(r==="polygon")return{type:"polygon",coordinates:xE(e)};if(r==="rect")return{type:"rect",coordinates:[[ro(e,"x"),ro(e,"y")],[ro(e,"x")+ro(e,"width"),ro(e,"y")],[ro(e,"x")+ro(e,"width"),ro(e,"y")+ro(e,"height")],[ro(e,"x"),ro(e,"y")+ro(e,"height")],[ro(e,"x"),ro(e,"y")]]};throw new Error(`Unsupported SVG element: ${r}`)}function ro(e,t){var r;const n=(r=e==null?void 0:e.properties)==null?void 0:r[t];return Number(n)||0}function xE(e){var t;const r=(t=e==null?void 0:e.properties)==null?void 0:t.points;return r?String(r).trim().split(/\s+/).map(n=>{const i=n.split(",").map(l=>Number(l));return[i[0],i[1]]}):[]}function bE(e){return e.map(t=>t.join(",")).join(" ")}function dN(e){return`<svg xmlns="http://www.w3.org/2000/svg">
  ${e.map(fN).join(`
`)}
</svg>`}function fN(e){if(e.type==="circle")return lm("circle",{...e.attributes,cx:e.coordinates[0],cy:e.coordinates[1]});if(e.type==="line")return lm("line",{...e.attributes,x1:e.coordinates[0][0],y1:e.coordinates[0][1],x2:e.coordinates[1][0],y2:e.coordinates[1][1]});if(e.type==="polyline")return lm("polyline",{...e.attributes,points:bE(e.coordinates)});if(e.type==="polygon")return lm("polygon",{...e.attributes,points:bE(e.coordinates)});if(e.type==="rect")return lm("rect",{...e.attributes,x:e.coordinates[0][0],y:e.coordinates[0][1],width:e.coordinates[1][0]-e.coordinates[0][0],height:e.coordinates[2][1]-e.coordinates[0][1]});throw new Error("Unknown SVG element")}function lm(e,t){const r=Object.entries(t).map(([n,i])=>`${n}="${i}"`);return`<${e} ${r.join(" ")} />`}function Pd([e,t]){const r=6378137*qD(e),n=r/e,i=180/Math.PI*Math.log(Math.tan(Math.PI/4+t*(Math.PI/180)/2))*n;return[r,i]}function wE([e,t]){const r=Math.PI*6378137,n=e/r*180;let i=t/r*180;return i=180/Math.PI*(2*Math.atan(Math.exp(i*Math.PI/180))-Math.PI/2),[n,i]}let mN=class Gv{constructor(t,r,n,i,l=1){Nt(this,"geoCenter"),Nt(this,"geoRectangle"),Nt(this,"geoSize"),Nt(this,"geoRectangleBbox"),Nt(this,"projectedGeoCenter"),Nt(this,"projectedGeoRectangle"),Nt(this,"projectedGeoSize"),Nt(this,"projectedGeoRectangleBbox"),Nt(this,"rotation"),Nt(this,"projectedGeoPerViewportScale"),Nt(this,"viewportCenter"),Nt(this,"viewportRectangle"),Nt(this,"viewportSize"),Nt(this,"viewportBbox"),Nt(this,"devicePixelRatio"),Nt(this,"canvasCenter"),Nt(this,"canvasRectangle"),Nt(this,"canvasSize"),Nt(this,"canvasBbox"),Nt(this,"projectedGeoPerCanvasScale"),Nt(this,"projectedGeoToViewportTransform",[1,0,0,1,0,0]),Nt(this,"projectedGeoToClipTransform",[1,0,0,1,0,0]),this.projectedGeoCenter=r,this.projectedGeoPerViewportScale=n,this.rotation=i,this.viewportSize=t,this.devicePixelRatio=l,this.projectedGeoRectangle=this.computeProjectedGeoRectangle(this.projectedGeoCenter,this.projectedGeoPerViewportScale,this.rotation,this.viewportSize),this.projectedGeoRectangleBbox=Es(this.projectedGeoRectangle),this.projectedGeoSize=[this.viewportSize[0]*n,this.viewportSize[1]*n],this.geoCenter=wE(this.projectedGeoCenter),this.geoRectangle=this.projectedGeoRectangle.map(h=>wE(h)),this.geoRectangleBbox=Es(this.geoRectangle),this.geoSize=ov(this.geoRectangleBbox),this.viewportCenter=[this.viewportSize[0]/2,this.viewportSize[1]/2],this.viewportBbox=[0,0,...this.viewportSize],this.viewportRectangle=Qy(this.viewportBbox),this.canvasCenter=[this.viewportCenter[0]*this.devicePixelRatio,this.viewportSize[1]*this.devicePixelRatio],this.canvasSize=[this.viewportSize[0]*this.devicePixelRatio,this.viewportSize[1]*this.devicePixelRatio],this.canvasBbox=[0,0,...this.canvasSize],this.canvasRectangle=Qy(this.canvasBbox),this.projectedGeoPerCanvasScale=this.projectedGeoPerViewportScale/this.devicePixelRatio,this.projectedGeoToViewportTransform=this.composeProjectedGeoToViewportTransform(),this.projectedGeoToClipTransform=this.composeProjectedGeoToClipTransform()}static fromWarpedMapList(t,r,n,i="contain",l=1){const h=r.getProjectedCenter(),a=r.getProjectedBbox();if(!h||!a)throw new Error("WarpedMapList has no projected center or bbox");const g=ov(a),_=t_(g,t,i)*(1/l);return new Gv(t,h,_,0,n)}static fromProjectedGeoBbox(t,r,n,i="contain"){const l=Bd(r),h=ov(r),a=t_(h,t,i);return new Gv(t,l,a,0,n)}composeProjectedGeoToViewportTransform(){return pE(this.viewportSize[0]/2,this.viewportSize[1]/2,1/this.projectedGeoPerViewportScale,-1/this.projectedGeoPerViewportScale,-this.rotation,-this.projectedGeoCenter[0],-this.projectedGeoCenter[1])}composeProjectedGeoToClipTransform(){return pE(0,0,2/(this.projectedGeoPerViewportScale*this.viewportSize[0]),2/(this.projectedGeoPerViewportScale*this.viewportSize[1]),-this.rotation,-this.projectedGeoCenter[0],-this.projectedGeoCenter[1])}computeProjectedGeoRectangle(t,r,n,i){const l=r*i[0]/2,h=r*i[1]/2,a=Math.cos(n),g=Math.sin(n),_=l*a,E=l*g,S=h*a,A=h*g,O=t[0],k=t[1];return[[O-_+A,k-E-S],[O-_-A,k-E+S],[O+_-A,k+E+S],[O+_+A,k+E-S]]}};function qv(e){return Array.isArray(e)?`[${e.map(t=>qv(t)).join(",")}]`:typeof e=="number"?`${e}`:typeof e=="string"?`"${e}"`:typeof e=="object"&&e!==null?Object.keys(e).sort().map(t=>`${t}:${qv(e[t])}`).join("|"):String(e)}async function gN(e){const t=await crypto.subtle.digest("SHA-1",new TextEncoder().encode(e));return Array.from(new Uint8Array(t)).map(r=>r.toString(16).padStart(2,"0")).join("")}async function XS(e,t=16){return(await gN(String(e))).slice(0,t)}async function yN(e,t){return await XS(qv(e),t)}var un;(function(e){e.assertEqual=i=>i;function t(i){}e.assertIs=t;function r(i){throw new Error}e.assertNever=r,e.arrayToEnum=i=>{const l={};for(const h of i)l[h]=h;return l},e.getValidEnumValues=i=>{const l=e.objectKeys(i).filter(a=>typeof i[i[a]]!="number"),h={};for(const a of l)h[a]=i[a];return e.objectValues(h)},e.objectValues=i=>e.objectKeys(i).map(function(l){return i[l]}),e.objectKeys=typeof Object.keys=="function"?i=>Object.keys(i):i=>{const l=[];for(const h in i)Object.prototype.hasOwnProperty.call(i,h)&&l.push(h);return l},e.find=(i,l)=>{for(const h of i)if(l(h))return h},e.isInteger=typeof Number.isInteger=="function"?i=>Number.isInteger(i):i=>typeof i=="number"&&isFinite(i)&&Math.floor(i)===i;function n(i,l=" | "){return i.map(h=>typeof h=="string"?`'${h}'`:h).join(l)}e.joinValues=n,e.jsonStringifyReplacer=(i,l)=>typeof l=="bigint"?l.toString():l})(un||(un={}));var Zv;(function(e){e.mergeShapes=(t,r)=>({...t,...r})})(Zv||(Zv={}));const $e=un.arrayToEnum(["string","nan","number","integer","float","boolean","date","bigint","symbol","function","undefined","null","array","object","unknown","promise","void","never","map","set"]),Fh=e=>{switch(typeof e){case"undefined":return $e.undefined;case"string":return $e.string;case"number":return isNaN(e)?$e.nan:$e.number;case"boolean":return $e.boolean;case"function":return $e.function;case"bigint":return $e.bigint;case"symbol":return $e.symbol;case"object":return Array.isArray(e)?$e.array:e===null?$e.null:e.then&&typeof e.then=="function"&&e.catch&&typeof e.catch=="function"?$e.promise:typeof Map<"u"&&e instanceof Map?$e.map:typeof Set<"u"&&e instanceof Set?$e.set:typeof Date<"u"&&e instanceof Date?$e.date:$e.object;default:return $e.unknown}},fe=un.arrayToEnum(["invalid_type","invalid_literal","custom","invalid_union","invalid_union_discriminator","invalid_enum_value","unrecognized_keys","invalid_arguments","invalid_return_type","invalid_date","invalid_string","too_small","too_big","invalid_intersection_types","not_multiple_of","not_finite"]),_N=e=>JSON.stringify(e,null,2).replace(/"([^"]+)":/g,"$1:");let ou=class HS extends Error{constructor(t){super(),this.issues=[],this.addIssue=n=>{this.issues=[...this.issues,n]},this.addIssues=(n=[])=>{this.issues=[...this.issues,...n]};const r=new.target.prototype;Object.setPrototypeOf?Object.setPrototypeOf(this,r):this.__proto__=r,this.name="ZodError",this.issues=t}get errors(){return this.issues}format(t){const r=t||function(l){return l.message},n={_errors:[]},i=l=>{for(const h of l.issues)if(h.code==="invalid_union")h.unionErrors.map(i);else if(h.code==="invalid_return_type")i(h.returnTypeError);else if(h.code==="invalid_arguments")i(h.argumentsError);else if(h.path.length===0)n._errors.push(r(h));else{let a=n,g=0;for(;g<h.path.length;){const _=h.path[g];g===h.path.length-1?(a[_]=a[_]||{_errors:[]},a[_]._errors.push(r(h))):a[_]=a[_]||{_errors:[]},a=a[_],g++}}};return i(this),n}static assert(t){if(!(t instanceof HS))throw new Error(`Not a ZodError: ${t}`)}toString(){return this.message}get message(){return JSON.stringify(this.issues,un.jsonStringifyReplacer,2)}get isEmpty(){return this.issues.length===0}flatten(t=r=>r.message){const r={},n=[];for(const i of this.issues)i.path.length>0?(r[i.path[0]]=r[i.path[0]]||[],r[i.path[0]].push(t(i))):n.push(t(i));return{formErrors:n,fieldErrors:r}}get formErrors(){return this.flatten()}};ou.create=e=>new ou(e);const $d=(e,t)=>{let r;switch(e.code){case fe.invalid_type:e.received===$e.undefined?r="Required":r=`Expected ${e.expected}, received ${e.received}`;break;case fe.invalid_literal:r=`Invalid literal value, expected ${JSON.stringify(e.expected,un.jsonStringifyReplacer)}`;break;case fe.unrecognized_keys:r=`Unrecognized key(s) in object: ${un.joinValues(e.keys,", ")}`;break;case fe.invalid_union:r="Invalid input";break;case fe.invalid_union_discriminator:r=`Invalid discriminator value. Expected ${un.joinValues(e.options)}`;break;case fe.invalid_enum_value:r=`Invalid enum value. Expected ${un.joinValues(e.options)}, received '${e.received}'`;break;case fe.invalid_arguments:r="Invalid function arguments";break;case fe.invalid_return_type:r="Invalid function return type";break;case fe.invalid_date:r="Invalid date";break;case fe.invalid_string:typeof e.validation=="object"?"includes"in e.validation?(r=`Invalid input: must include "${e.validation.includes}"`,typeof e.validation.position=="number"&&(r=`${r} at one or more positions greater than or equal to ${e.validation.position}`)):"startsWith"in e.validation?r=`Invalid input: must start with "${e.validation.startsWith}"`:"endsWith"in e.validation?r=`Invalid input: must end with "${e.validation.endsWith}"`:un.assertNever(e.validation):e.validation!=="regex"?r=`Invalid ${e.validation}`:r="Invalid";break;case fe.too_small:e.type==="array"?r=`Array must contain ${e.exact?"exactly":e.inclusive?"at least":"more than"} ${e.minimum} element(s)`:e.type==="string"?r=`String must contain ${e.exact?"exactly":e.inclusive?"at least":"over"} ${e.minimum} character(s)`:e.type==="number"?r=`Number must be ${e.exact?"exactly equal to ":e.inclusive?"greater than or equal to ":"greater than "}${e.minimum}`:e.type==="date"?r=`Date must be ${e.exact?"exactly equal to ":e.inclusive?"greater than or equal to ":"greater than "}${new Date(Number(e.minimum))}`:r="Invalid input";break;case fe.too_big:e.type==="array"?r=`Array must contain ${e.exact?"exactly":e.inclusive?"at most":"less than"} ${e.maximum} element(s)`:e.type==="string"?r=`String must contain ${e.exact?"exactly":e.inclusive?"at most":"under"} ${e.maximum} character(s)`:e.type==="number"?r=`Number must be ${e.exact?"exactly":e.inclusive?"less than or equal to":"less than"} ${e.maximum}`:e.type==="bigint"?r=`BigInt must be ${e.exact?"exactly":e.inclusive?"less than or equal to":"less than"} ${e.maximum}`:e.type==="date"?r=`Date must be ${e.exact?"exactly":e.inclusive?"smaller than or equal to":"smaller than"} ${new Date(Number(e.maximum))}`:r="Invalid input";break;case fe.custom:r="Invalid input";break;case fe.invalid_intersection_types:r="Intersection results could not be merged";break;case fe.not_multiple_of:r=`Number must be a multiple of ${e.multipleOf}`;break;case fe.not_finite:r="Number must be finite";break;default:r=t.defaultError,un.assertNever(e)}return{message:r}};let YS=$d;function vN(e){YS=e}function e_(){return YS}const r_=e=>{const{data:t,path:r,errorMaps:n,issueData:i}=e,l=[...r,...i.path||[]],h={...i,path:l};if(i.message!==void 0)return{...i,path:l,message:i.message};let a="";const g=n.filter(_=>!!_).slice().reverse();for(const _ of g)a=_(h,{data:t,defaultError:a}).message;return{...i,path:l,message:a}},xN=[];function Ne(e,t){const r=e_(),n=r_({issueData:t,data:e.data,path:e.path,errorMaps:[e.common.contextualErrorMap,e.schemaErrorMap,r,r===$d?void 0:$d].filter(i=>!!i)});e.common.issues.push(n)}let ba=class KS{constructor(){this.value="valid"}dirty(){this.value==="valid"&&(this.value="dirty")}abort(){this.value!=="aborted"&&(this.value="aborted")}static mergeArray(t,r){const n=[];for(const i of r){if(i.status==="aborted")return gr;i.status==="dirty"&&t.dirty(),n.push(i.value)}return{status:t.value,value:n}}static async mergeObjectAsync(t,r){const n=[];for(const i of r){const l=await i.key,h=await i.value;n.push({key:l,value:h})}return KS.mergeObjectSync(t,n)}static mergeObjectSync(t,r){const n={};for(const i of r){const{key:l,value:h}=i;if(l.status==="aborted"||h.status==="aborted")return gr;l.status==="dirty"&&t.dirty(),h.status==="dirty"&&t.dirty(),l.value!=="__proto__"&&(typeof h.value<"u"||i.alwaysSet)&&(n[l.value]=h.value)}return{status:t.value,value:n}}};const gr=Object.freeze({status:"aborted"}),n_=e=>({status:"dirty",value:e}),Ks=e=>({status:"valid",value:e}),Wv=e=>e.status==="aborted",Xv=e=>e.status==="dirty",Nm=e=>e.status==="valid",km=e=>typeof Promise<"u"&&e instanceof Promise;function i_(e,t,r,n){if(typeof t=="function"?e!==t||!n:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return t.get(e)}function JS(e,t,r,n,i){if(typeof t=="function"?e!==t||!i:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return t.set(e,r),r}var er;(function(e){e.errToObj=t=>typeof t=="string"?{message:t}:t||{},e.toString=t=>typeof t=="string"?t:t==null?void 0:t.message})(er||(er={}));var gm,ym;let ju=class{constructor(t,r,n,i){this._cachedPath=[],this.parent=t,this.data=r,this._path=n,this._key=i}get path(){return this._cachedPath.length||(this._key instanceof Array?this._cachedPath.push(...this._path,...this._key):this._cachedPath.push(...this._path,this._key)),this._cachedPath}};const EE=(e,t)=>{if(Nm(t))return{success:!0,data:t.value};if(!e.common.issues.length)throw new Error("Validation failed but no issues detected.");return{success:!1,get error(){if(this._error)return this._error;const r=new ou(e.common.issues);return this._error=r,this._error}}};function Ar(e){if(!e)return{};const{errorMap:t,invalid_type_error:r,required_error:n,description:i}=e;if(t&&(r||n))throw new Error(`Can't use "invalid_type_error" or "required_error" in conjunction with custom error map.`);return t?{errorMap:t,description:i}:{errorMap:(l,h)=>{var a,g;const{message:_}=e;return l.code==="invalid_enum_value"?{message:_??h.defaultError}:typeof h.data>"u"?{message:(a=_??n)!==null&&a!==void 0?a:h.defaultError}:l.code!=="invalid_type"?{message:h.defaultError}:{message:(g=_??r)!==null&&g!==void 0?g:h.defaultError}},description:i}}let $r=class{constructor(t){this.spa=this.safeParseAsync,this._def=t,this.parse=this.parse.bind(this),this.safeParse=this.safeParse.bind(this),this.parseAsync=this.parseAsync.bind(this),this.safeParseAsync=this.safeParseAsync.bind(this),this.spa=this.spa.bind(this),this.refine=this.refine.bind(this),this.refinement=this.refinement.bind(this),this.superRefine=this.superRefine.bind(this),this.optional=this.optional.bind(this),this.nullable=this.nullable.bind(this),this.nullish=this.nullish.bind(this),this.array=this.array.bind(this),this.promise=this.promise.bind(this),this.or=this.or.bind(this),this.and=this.and.bind(this),this.transform=this.transform.bind(this),this.brand=this.brand.bind(this),this.default=this.default.bind(this),this.catch=this.catch.bind(this),this.describe=this.describe.bind(this),this.pipe=this.pipe.bind(this),this.readonly=this.readonly.bind(this),this.isNullable=this.isNullable.bind(this),this.isOptional=this.isOptional.bind(this)}get description(){return this._def.description}_getType(t){return Fh(t.data)}_getOrReturnCtx(t,r){return r||{common:t.parent.common,data:t.data,parsedType:Fh(t.data),schemaErrorMap:this._def.errorMap,path:t.path,parent:t.parent}}_processInputParams(t){return{status:new ba,ctx:{common:t.parent.common,data:t.data,parsedType:Fh(t.data),schemaErrorMap:this._def.errorMap,path:t.path,parent:t.parent}}}_parseSync(t){const r=this._parse(t);if(km(r))throw new Error("Synchronous parse encountered promise.");return r}_parseAsync(t){const r=this._parse(t);return Promise.resolve(r)}parse(t,r){const n=this.safeParse(t,r);if(n.success)return n.data;throw n.error}safeParse(t,r){var n;const i={common:{issues:[],async:(n=r==null?void 0:r.async)!==null&&n!==void 0?n:!1,contextualErrorMap:r==null?void 0:r.errorMap},path:(r==null?void 0:r.path)||[],schemaErrorMap:this._def.errorMap,parent:null,data:t,parsedType:Fh(t)},l=this._parseSync({data:t,path:i.path,parent:i});return EE(i,l)}async parseAsync(t,r){const n=await this.safeParseAsync(t,r);if(n.success)return n.data;throw n.error}async safeParseAsync(t,r){const n={common:{issues:[],contextualErrorMap:r==null?void 0:r.errorMap,async:!0},path:(r==null?void 0:r.path)||[],schemaErrorMap:this._def.errorMap,parent:null,data:t,parsedType:Fh(t)},i=this._parse({data:t,path:n.path,parent:n}),l=await(km(i)?i:Promise.resolve(i));return EE(n,l)}refine(t,r){const n=i=>typeof r=="string"||typeof r>"u"?{message:r}:typeof r=="function"?r(i):r;return this._refinement((i,l)=>{const h=t(i),a=()=>l.addIssue({code:fe.custom,...n(i)});return typeof Promise<"u"&&h instanceof Promise?h.then(g=>g?!0:(a(),!1)):h?!0:(a(),!1)})}refinement(t,r){return this._refinement((n,i)=>t(n)?!0:(i.addIssue(typeof r=="function"?r(n,i):r),!1))}_refinement(t){return new lu({schema:this,typeName:pr.ZodEffects,effect:{type:"refinement",refinement:t}})}superRefine(t){return this._refinement(t)}optional(){return $u.create(this,this._def)}nullable(){return Zh.create(this,this._def)}nullish(){return this.nullable().optional()}array(){return Ap.create(this,this._def)}promise(){return Vd.create(this,this._def)}or(t){return jm.create([this,t],this._def)}and(t){return Vm.create(this,t,this._def)}transform(t){return new lu({...Ar(this._def),schema:this,typeName:pr.ZodEffects,effect:{type:"transform",transform:t}})}default(t){const r=typeof t=="function"?t:()=>t;return new Wm({...Ar(this._def),innerType:this,defaultValue:r,typeName:pr.ZodDefault})}brand(){return new Ux({typeName:pr.ZodBranded,type:this,...Ar(this._def)})}catch(t){const r=typeof t=="function"?t:()=>t;return new Xm({...Ar(this._def),innerType:this,catchValue:r,typeName:pr.ZodCatch})}describe(t){const r=this.constructor;return new r({...this._def,description:t})}pipe(t){return jx.create(this,t)}readonly(){return Hm.create(this)}isOptional(){return this.safeParse(void 0).success}isNullable(){return this.safeParse(null).success}};const bN=/^c[^\s-]{8,}$/i,wN=/^[0-9a-z]+$/,EN=/^[0-9A-HJKMNP-TV-Z]{26}$/,SN=/^[0-9a-fA-F]{8}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{12}$/i,TN=/^[a-z0-9_-]{21}$/i,IN=/^[-+]?P(?!$)(?:(?:[-+]?\d+Y)|(?:[-+]?\d+[.,]\d+Y$))?(?:(?:[-+]?\d+M)|(?:[-+]?\d+[.,]\d+M$))?(?:(?:[-+]?\d+W)|(?:[-+]?\d+[.,]\d+W$))?(?:(?:[-+]?\d+D)|(?:[-+]?\d+[.,]\d+D$))?(?:T(?=[\d+-])(?:(?:[-+]?\d+H)|(?:[-+]?\d+[.,]\d+H$))?(?:(?:[-+]?\d+M)|(?:[-+]?\d+[.,]\d+M$))?(?:[-+]?\d+(?:[.,]\d+)?S)?)??$/,CN=/^(?!\.)(?!.*\.\.)([A-Z0-9_'+\-\.]*)[A-Z0-9_+-]@([A-Z0-9][A-Z0-9\-]*\.)+[A-Z]{2,}$/i,MN="^(\\p{Extended_Pictographic}|\\p{Emoji_Component})+$";let av;const PN=/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])$/,AN=/^(([a-f0-9]{1,4}:){7}|::([a-f0-9]{1,4}:){0,6}|([a-f0-9]{1,4}:){1}:([a-f0-9]{1,4}:){0,5}|([a-f0-9]{1,4}:){2}:([a-f0-9]{1,4}:){0,4}|([a-f0-9]{1,4}:){3}:([a-f0-9]{1,4}:){0,3}|([a-f0-9]{1,4}:){4}:([a-f0-9]{1,4}:){0,2}|([a-f0-9]{1,4}:){5}:([a-f0-9]{1,4}:){0,1})([a-f0-9]{1,4}|(((25[0-5])|(2[0-4][0-9])|(1[0-9]{2})|([0-9]{1,2}))\.){3}((25[0-5])|(2[0-4][0-9])|(1[0-9]{2})|([0-9]{1,2})))$/,LN=/^([0-9a-zA-Z+/]{4})*(([0-9a-zA-Z+/]{2}==)|([0-9a-zA-Z+/]{3}=))?$/,QS="((\\d\\d[2468][048]|\\d\\d[13579][26]|\\d\\d0[48]|[02468][048]00|[13579][26]00)-02-29|\\d{4}-((0[13578]|1[02])-(0[1-9]|[12]\\d|3[01])|(0[469]|11)-(0[1-9]|[12]\\d|30)|(02)-(0[1-9]|1\\d|2[0-8])))",RN=new RegExp(`^${QS}$`);function tT(e){let t="([01]\\d|2[0-3]):[0-5]\\d:[0-5]\\d";return e.precision?t=`${t}\\.\\d{${e.precision}}`:e.precision==null&&(t=`${t}(\\.\\d+)?`),t}function DN(e){return new RegExp(`^${tT(e)}$`)}function eT(e){let t=`${QS}T${tT(e)}`;const r=[];return r.push(e.local?"Z?":"Z"),e.offset&&r.push("([+-]\\d{2}:?\\d{2})"),t=`${t}(${r.join("|")})`,new RegExp(`^${t}$`)}function NN(e,t){return!!((t==="v4"||!t)&&PN.test(e)||(t==="v6"||!t)&&AN.test(e))}let Ud=class _m extends $r{_parse(t){if(this._def.coerce&&(t.data=String(t.data)),this._getType(t)!==$e.string){const i=this._getOrReturnCtx(t);return Ne(i,{code:fe.invalid_type,expected:$e.string,received:i.parsedType}),gr}const r=new ba;let n;for(const i of this._def.checks)if(i.kind==="min")t.data.length<i.value&&(n=this._getOrReturnCtx(t,n),Ne(n,{code:fe.too_small,minimum:i.value,type:"string",inclusive:!0,exact:!1,message:i.message}),r.dirty());else if(i.kind==="max")t.data.length>i.value&&(n=this._getOrReturnCtx(t,n),Ne(n,{code:fe.too_big,maximum:i.value,type:"string",inclusive:!0,exact:!1,message:i.message}),r.dirty());else if(i.kind==="length"){const l=t.data.length>i.value,h=t.data.length<i.value;(l||h)&&(n=this._getOrReturnCtx(t,n),l?Ne(n,{code:fe.too_big,maximum:i.value,type:"string",inclusive:!0,exact:!0,message:i.message}):h&&Ne(n,{code:fe.too_small,minimum:i.value,type:"string",inclusive:!0,exact:!0,message:i.message}),r.dirty())}else if(i.kind==="email")CN.test(t.data)||(n=this._getOrReturnCtx(t,n),Ne(n,{validation:"email",code:fe.invalid_string,message:i.message}),r.dirty());else if(i.kind==="emoji")av||(av=new RegExp(MN,"u")),av.test(t.data)||(n=this._getOrReturnCtx(t,n),Ne(n,{validation:"emoji",code:fe.invalid_string,message:i.message}),r.dirty());else if(i.kind==="uuid")SN.test(t.data)||(n=this._getOrReturnCtx(t,n),Ne(n,{validation:"uuid",code:fe.invalid_string,message:i.message}),r.dirty());else if(i.kind==="nanoid")TN.test(t.data)||(n=this._getOrReturnCtx(t,n),Ne(n,{validation:"nanoid",code:fe.invalid_string,message:i.message}),r.dirty());else if(i.kind==="cuid")bN.test(t.data)||(n=this._getOrReturnCtx(t,n),Ne(n,{validation:"cuid",code:fe.invalid_string,message:i.message}),r.dirty());else if(i.kind==="cuid2")wN.test(t.data)||(n=this._getOrReturnCtx(t,n),Ne(n,{validation:"cuid2",code:fe.invalid_string,message:i.message}),r.dirty());else if(i.kind==="ulid")EN.test(t.data)||(n=this._getOrReturnCtx(t,n),Ne(n,{validation:"ulid",code:fe.invalid_string,message:i.message}),r.dirty());else if(i.kind==="url")try{new URL(t.data)}catch{n=this._getOrReturnCtx(t,n),Ne(n,{validation:"url",code:fe.invalid_string,message:i.message}),r.dirty()}else i.kind==="regex"?(i.regex.lastIndex=0,i.regex.test(t.data)||(n=this._getOrReturnCtx(t,n),Ne(n,{validation:"regex",code:fe.invalid_string,message:i.message}),r.dirty())):i.kind==="trim"?t.data=t.data.trim():i.kind==="includes"?t.data.includes(i.value,i.position)||(n=this._getOrReturnCtx(t,n),Ne(n,{code:fe.invalid_string,validation:{includes:i.value,position:i.position},message:i.message}),r.dirty()):i.kind==="toLowerCase"?t.data=t.data.toLowerCase():i.kind==="toUpperCase"?t.data=t.data.toUpperCase():i.kind==="startsWith"?t.data.startsWith(i.value)||(n=this._getOrReturnCtx(t,n),Ne(n,{code:fe.invalid_string,validation:{startsWith:i.value},message:i.message}),r.dirty()):i.kind==="endsWith"?t.data.endsWith(i.value)||(n=this._getOrReturnCtx(t,n),Ne(n,{code:fe.invalid_string,validation:{endsWith:i.value},message:i.message}),r.dirty()):i.kind==="datetime"?eT(i).test(t.data)||(n=this._getOrReturnCtx(t,n),Ne(n,{code:fe.invalid_string,validation:"datetime",message:i.message}),r.dirty()):i.kind==="date"?RN.test(t.data)||(n=this._getOrReturnCtx(t,n),Ne(n,{code:fe.invalid_string,validation:"date",message:i.message}),r.dirty()):i.kind==="time"?DN(i).test(t.data)||(n=this._getOrReturnCtx(t,n),Ne(n,{code:fe.invalid_string,validation:"time",message:i.message}),r.dirty()):i.kind==="duration"?IN.test(t.data)||(n=this._getOrReturnCtx(t,n),Ne(n,{validation:"duration",code:fe.invalid_string,message:i.message}),r.dirty()):i.kind==="ip"?NN(t.data,i.version)||(n=this._getOrReturnCtx(t,n),Ne(n,{validation:"ip",code:fe.invalid_string,message:i.message}),r.dirty()):i.kind==="base64"?LN.test(t.data)||(n=this._getOrReturnCtx(t,n),Ne(n,{validation:"base64",code:fe.invalid_string,message:i.message}),r.dirty()):un.assertNever(i);return{status:r.value,value:t.data}}_regex(t,r,n){return this.refinement(i=>t.test(i),{validation:r,code:fe.invalid_string,...er.errToObj(n)})}_addCheck(t){return new _m({...this._def,checks:[...this._def.checks,t]})}email(t){return this._addCheck({kind:"email",...er.errToObj(t)})}url(t){return this._addCheck({kind:"url",...er.errToObj(t)})}emoji(t){return this._addCheck({kind:"emoji",...er.errToObj(t)})}uuid(t){return this._addCheck({kind:"uuid",...er.errToObj(t)})}nanoid(t){return this._addCheck({kind:"nanoid",...er.errToObj(t)})}cuid(t){return this._addCheck({kind:"cuid",...er.errToObj(t)})}cuid2(t){return this._addCheck({kind:"cuid2",...er.errToObj(t)})}ulid(t){return this._addCheck({kind:"ulid",...er.errToObj(t)})}base64(t){return this._addCheck({kind:"base64",...er.errToObj(t)})}ip(t){return this._addCheck({kind:"ip",...er.errToObj(t)})}datetime(t){var r,n;return typeof t=="string"?this._addCheck({kind:"datetime",precision:null,offset:!1,local:!1,message:t}):this._addCheck({kind:"datetime",precision:typeof(t==null?void 0:t.precision)>"u"?null:t==null?void 0:t.precision,offset:(r=t==null?void 0:t.offset)!==null&&r!==void 0?r:!1,local:(n=t==null?void 0:t.local)!==null&&n!==void 0?n:!1,...er.errToObj(t==null?void 0:t.message)})}date(t){return this._addCheck({kind:"date",message:t})}time(t){return typeof t=="string"?this._addCheck({kind:"time",precision:null,message:t}):this._addCheck({kind:"time",precision:typeof(t==null?void 0:t.precision)>"u"?null:t==null?void 0:t.precision,...er.errToObj(t==null?void 0:t.message)})}duration(t){return this._addCheck({kind:"duration",...er.errToObj(t)})}regex(t,r){return this._addCheck({kind:"regex",regex:t,...er.errToObj(r)})}includes(t,r){return this._addCheck({kind:"includes",value:t,position:r==null?void 0:r.position,...er.errToObj(r==null?void 0:r.message)})}startsWith(t,r){return this._addCheck({kind:"startsWith",value:t,...er.errToObj(r)})}endsWith(t,r){return this._addCheck({kind:"endsWith",value:t,...er.errToObj(r)})}min(t,r){return this._addCheck({kind:"min",value:t,...er.errToObj(r)})}max(t,r){return this._addCheck({kind:"max",value:t,...er.errToObj(r)})}length(t,r){return this._addCheck({kind:"length",value:t,...er.errToObj(r)})}nonempty(t){return this.min(1,er.errToObj(t))}trim(){return new _m({...this._def,checks:[...this._def.checks,{kind:"trim"}]})}toLowerCase(){return new _m({...this._def,checks:[...this._def.checks,{kind:"toLowerCase"}]})}toUpperCase(){return new _m({...this._def,checks:[...this._def.checks,{kind:"toUpperCase"}]})}get isDatetime(){return!!this._def.checks.find(t=>t.kind==="datetime")}get isDate(){return!!this._def.checks.find(t=>t.kind==="date")}get isTime(){return!!this._def.checks.find(t=>t.kind==="time")}get isDuration(){return!!this._def.checks.find(t=>t.kind==="duration")}get isEmail(){return!!this._def.checks.find(t=>t.kind==="email")}get isURL(){return!!this._def.checks.find(t=>t.kind==="url")}get isEmoji(){return!!this._def.checks.find(t=>t.kind==="emoji")}get isUUID(){return!!this._def.checks.find(t=>t.kind==="uuid")}get isNANOID(){return!!this._def.checks.find(t=>t.kind==="nanoid")}get isCUID(){return!!this._def.checks.find(t=>t.kind==="cuid")}get isCUID2(){return!!this._def.checks.find(t=>t.kind==="cuid2")}get isULID(){return!!this._def.checks.find(t=>t.kind==="ulid")}get isIP(){return!!this._def.checks.find(t=>t.kind==="ip")}get isBase64(){return!!this._def.checks.find(t=>t.kind==="base64")}get minLength(){let t=null;for(const r of this._def.checks)r.kind==="min"&&(t===null||r.value>t)&&(t=r.value);return t}get maxLength(){let t=null;for(const r of this._def.checks)r.kind==="max"&&(t===null||r.value<t)&&(t=r.value);return t}};Ud.create=e=>{var t;return new Ud({checks:[],typeName:pr.ZodString,coerce:(t=e==null?void 0:e.coerce)!==null&&t!==void 0?t:!1,...Ar(e)})};function kN(e,t){const r=(e.toString().split(".")[1]||"").length,n=(t.toString().split(".")[1]||"").length,i=r>n?r:n,l=parseInt(e.toFixed(i).replace(".","")),h=parseInt(t.toFixed(i).replace(".",""));return l%h/Math.pow(10,i)}let Om=class Hv extends $r{constructor(){super(...arguments),this.min=this.gte,this.max=this.lte,this.step=this.multipleOf}_parse(t){if(this._def.coerce&&(t.data=Number(t.data)),this._getType(t)!==$e.number){const i=this._getOrReturnCtx(t);return Ne(i,{code:fe.invalid_type,expected:$e.number,received:i.parsedType}),gr}let r;const n=new ba;for(const i of this._def.checks)i.kind==="int"?un.isInteger(t.data)||(r=this._getOrReturnCtx(t,r),Ne(r,{code:fe.invalid_type,expected:"integer",received:"float",message:i.message}),n.dirty()):i.kind==="min"?(i.inclusive?t.data<i.value:t.data<=i.value)&&(r=this._getOrReturnCtx(t,r),Ne(r,{code:fe.too_small,minimum:i.value,type:"number",inclusive:i.inclusive,exact:!1,message:i.message}),n.dirty()):i.kind==="max"?(i.inclusive?t.data>i.value:t.data>=i.value)&&(r=this._getOrReturnCtx(t,r),Ne(r,{code:fe.too_big,maximum:i.value,type:"number",inclusive:i.inclusive,exact:!1,message:i.message}),n.dirty()):i.kind==="multipleOf"?kN(t.data,i.value)!==0&&(r=this._getOrReturnCtx(t,r),Ne(r,{code:fe.not_multiple_of,multipleOf:i.value,message:i.message}),n.dirty()):i.kind==="finite"?Number.isFinite(t.data)||(r=this._getOrReturnCtx(t,r),Ne(r,{code:fe.not_finite,message:i.message}),n.dirty()):un.assertNever(i);return{status:n.value,value:t.data}}gte(t,r){return this.setLimit("min",t,!0,er.toString(r))}gt(t,r){return this.setLimit("min",t,!1,er.toString(r))}lte(t,r){return this.setLimit("max",t,!0,er.toString(r))}lt(t,r){return this.setLimit("max",t,!1,er.toString(r))}setLimit(t,r,n,i){return new Hv({...this._def,checks:[...this._def.checks,{kind:t,value:r,inclusive:n,message:er.toString(i)}]})}_addCheck(t){return new Hv({...this._def,checks:[...this._def.checks,t]})}int(t){return this._addCheck({kind:"int",message:er.toString(t)})}positive(t){return this._addCheck({kind:"min",value:0,inclusive:!1,message:er.toString(t)})}negative(t){return this._addCheck({kind:"max",value:0,inclusive:!1,message:er.toString(t)})}nonpositive(t){return this._addCheck({kind:"max",value:0,inclusive:!0,message:er.toString(t)})}nonnegative(t){return this._addCheck({kind:"min",value:0,inclusive:!0,message:er.toString(t)})}multipleOf(t,r){return this._addCheck({kind:"multipleOf",value:t,message:er.toString(r)})}finite(t){return this._addCheck({kind:"finite",message:er.toString(t)})}safe(t){return this._addCheck({kind:"min",inclusive:!0,value:Number.MIN_SAFE_INTEGER,message:er.toString(t)})._addCheck({kind:"max",inclusive:!0,value:Number.MAX_SAFE_INTEGER,message:er.toString(t)})}get minValue(){let t=null;for(const r of this._def.checks)r.kind==="min"&&(t===null||r.value>t)&&(t=r.value);return t}get maxValue(){let t=null;for(const r of this._def.checks)r.kind==="max"&&(t===null||r.value<t)&&(t=r.value);return t}get isInt(){return!!this._def.checks.find(t=>t.kind==="int"||t.kind==="multipleOf"&&un.isInteger(t.value))}get isFinite(){let t=null,r=null;for(const n of this._def.checks){if(n.kind==="finite"||n.kind==="int"||n.kind==="multipleOf")return!0;n.kind==="min"?(r===null||n.value>r)&&(r=n.value):n.kind==="max"&&(t===null||n.value<t)&&(t=n.value)}return Number.isFinite(r)&&Number.isFinite(t)}};Om.create=e=>new Om({checks:[],typeName:pr.ZodNumber,coerce:(e==null?void 0:e.coerce)||!1,...Ar(e)});let Fm=class Yv extends $r{constructor(){super(...arguments),this.min=this.gte,this.max=this.lte}_parse(t){if(this._def.coerce&&(t.data=BigInt(t.data)),this._getType(t)!==$e.bigint){const i=this._getOrReturnCtx(t);return Ne(i,{code:fe.invalid_type,expected:$e.bigint,received:i.parsedType}),gr}let r;const n=new ba;for(const i of this._def.checks)i.kind==="min"?(i.inclusive?t.data<i.value:t.data<=i.value)&&(r=this._getOrReturnCtx(t,r),Ne(r,{code:fe.too_small,type:"bigint",minimum:i.value,inclusive:i.inclusive,message:i.message}),n.dirty()):i.kind==="max"?(i.inclusive?t.data>i.value:t.data>=i.value)&&(r=this._getOrReturnCtx(t,r),Ne(r,{code:fe.too_big,type:"bigint",maximum:i.value,inclusive:i.inclusive,message:i.message}),n.dirty()):i.kind==="multipleOf"?t.data%i.value!==BigInt(0)&&(r=this._getOrReturnCtx(t,r),Ne(r,{code:fe.not_multiple_of,multipleOf:i.value,message:i.message}),n.dirty()):un.assertNever(i);return{status:n.value,value:t.data}}gte(t,r){return this.setLimit("min",t,!0,er.toString(r))}gt(t,r){return this.setLimit("min",t,!1,er.toString(r))}lte(t,r){return this.setLimit("max",t,!0,er.toString(r))}lt(t,r){return this.setLimit("max",t,!1,er.toString(r))}setLimit(t,r,n,i){return new Yv({...this._def,checks:[...this._def.checks,{kind:t,value:r,inclusive:n,message:er.toString(i)}]})}_addCheck(t){return new Yv({...this._def,checks:[...this._def.checks,t]})}positive(t){return this._addCheck({kind:"min",value:BigInt(0),inclusive:!1,message:er.toString(t)})}negative(t){return this._addCheck({kind:"max",value:BigInt(0),inclusive:!1,message:er.toString(t)})}nonpositive(t){return this._addCheck({kind:"max",value:BigInt(0),inclusive:!0,message:er.toString(t)})}nonnegative(t){return this._addCheck({kind:"min",value:BigInt(0),inclusive:!0,message:er.toString(t)})}multipleOf(t,r){return this._addCheck({kind:"multipleOf",value:t,message:er.toString(r)})}get minValue(){let t=null;for(const r of this._def.checks)r.kind==="min"&&(t===null||r.value>t)&&(t=r.value);return t}get maxValue(){let t=null;for(const r of this._def.checks)r.kind==="max"&&(t===null||r.value<t)&&(t=r.value);return t}};Fm.create=e=>{var t;return new Fm({checks:[],typeName:pr.ZodBigInt,coerce:(t=e==null?void 0:e.coerce)!==null&&t!==void 0?t:!1,...Ar(e)})};let zm=class extends $r{_parse(t){if(this._def.coerce&&(t.data=!!t.data),this._getType(t)!==$e.boolean){const r=this._getOrReturnCtx(t);return Ne(r,{code:fe.invalid_type,expected:$e.boolean,received:r.parsedType}),gr}return Ks(t.data)}};zm.create=e=>new zm({typeName:pr.ZodBoolean,coerce:(e==null?void 0:e.coerce)||!1,...Ar(e)});let Bm=class rT extends $r{_parse(t){if(this._def.coerce&&(t.data=new Date(t.data)),this._getType(t)!==$e.date){const i=this._getOrReturnCtx(t);return Ne(i,{code:fe.invalid_type,expected:$e.date,received:i.parsedType}),gr}if(isNaN(t.data.getTime())){const i=this._getOrReturnCtx(t);return Ne(i,{code:fe.invalid_date}),gr}const r=new ba;let n;for(const i of this._def.checks)i.kind==="min"?t.data.getTime()<i.value&&(n=this._getOrReturnCtx(t,n),Ne(n,{code:fe.too_small,message:i.message,inclusive:!0,exact:!1,minimum:i.value,type:"date"}),r.dirty()):i.kind==="max"?t.data.getTime()>i.value&&(n=this._getOrReturnCtx(t,n),Ne(n,{code:fe.too_big,message:i.message,inclusive:!0,exact:!1,maximum:i.value,type:"date"}),r.dirty()):un.assertNever(i);return{status:r.value,value:new Date(t.data.getTime())}}_addCheck(t){return new rT({...this._def,checks:[...this._def.checks,t]})}min(t,r){return this._addCheck({kind:"min",value:t.getTime(),message:er.toString(r)})}max(t,r){return this._addCheck({kind:"max",value:t.getTime(),message:er.toString(r)})}get minDate(){let t=null;for(const r of this._def.checks)r.kind==="min"&&(t===null||r.value>t)&&(t=r.value);return t!=null?new Date(t):null}get maxDate(){let t=null;for(const r of this._def.checks)r.kind==="max"&&(t===null||r.value<t)&&(t=r.value);return t!=null?new Date(t):null}};Bm.create=e=>new Bm({checks:[],coerce:(e==null?void 0:e.coerce)||!1,typeName:pr.ZodDate,...Ar(e)});let o_=class extends $r{_parse(t){if(this._getType(t)!==$e.symbol){const r=this._getOrReturnCtx(t);return Ne(r,{code:fe.invalid_type,expected:$e.symbol,received:r.parsedType}),gr}return Ks(t.data)}};o_.create=e=>new o_({typeName:pr.ZodSymbol,...Ar(e)});let $m=class extends $r{_parse(t){if(this._getType(t)!==$e.undefined){const r=this._getOrReturnCtx(t);return Ne(r,{code:fe.invalid_type,expected:$e.undefined,received:r.parsedType}),gr}return Ks(t.data)}};$m.create=e=>new $m({typeName:pr.ZodUndefined,...Ar(e)});let Um=class extends $r{_parse(t){if(this._getType(t)!==$e.null){const r=this._getOrReturnCtx(t);return Ne(r,{code:fe.invalid_type,expected:$e.null,received:r.parsedType}),gr}return Ks(t.data)}};Um.create=e=>new Um({typeName:pr.ZodNull,...Ar(e)});let jd=class extends $r{constructor(){super(...arguments),this._any=!0}_parse(t){return Ks(t.data)}};jd.create=e=>new jd({typeName:pr.ZodAny,...Ar(e)});let Mp=class extends $r{constructor(){super(...arguments),this._unknown=!0}_parse(t){return Ks(t.data)}};Mp.create=e=>new Mp({typeName:pr.ZodUnknown,...Ar(e)});let jc=class extends $r{_parse(t){const r=this._getOrReturnCtx(t);return Ne(r,{code:fe.invalid_type,expected:$e.never,received:r.parsedType}),gr}};jc.create=e=>new jc({typeName:pr.ZodNever,...Ar(e)});let s_=class extends $r{_parse(t){if(this._getType(t)!==$e.undefined){const r=this._getOrReturnCtx(t);return Ne(r,{code:fe.invalid_type,expected:$e.void,received:r.parsedType}),gr}return Ks(t.data)}};s_.create=e=>new s_({typeName:pr.ZodVoid,...Ar(e)});let Ap=class By extends $r{_parse(t){const{ctx:r,status:n}=this._processInputParams(t),i=this._def;if(r.parsedType!==$e.array)return Ne(r,{code:fe.invalid_type,expected:$e.array,received:r.parsedType}),gr;if(i.exactLength!==null){const h=r.data.length>i.exactLength.value,a=r.data.length<i.exactLength.value;(h||a)&&(Ne(r,{code:h?fe.too_big:fe.too_small,minimum:a?i.exactLength.value:void 0,maximum:h?i.exactLength.value:void 0,type:"array",inclusive:!0,exact:!0,message:i.exactLength.message}),n.dirty())}if(i.minLength!==null&&r.data.length<i.minLength.value&&(Ne(r,{code:fe.too_small,minimum:i.minLength.value,type:"array",inclusive:!0,exact:!1,message:i.minLength.message}),n.dirty()),i.maxLength!==null&&r.data.length>i.maxLength.value&&(Ne(r,{code:fe.too_big,maximum:i.maxLength.value,type:"array",inclusive:!0,exact:!1,message:i.maxLength.message}),n.dirty()),r.common.async)return Promise.all([...r.data].map((h,a)=>i.type._parseAsync(new ju(r,h,r.path,a)))).then(h=>ba.mergeArray(n,h));const l=[...r.data].map((h,a)=>i.type._parseSync(new ju(r,h,r.path,a)));return ba.mergeArray(n,l)}get element(){return this._def.type}min(t,r){return new By({...this._def,minLength:{value:t,message:er.toString(r)}})}max(t,r){return new By({...this._def,maxLength:{value:t,message:er.toString(r)}})}length(t,r){return new By({...this._def,exactLength:{value:t,message:er.toString(r)}})}nonempty(t){return this.min(1,t)}};Ap.create=(e,t)=>new Ap({type:e,minLength:null,maxLength:null,exactLength:null,typeName:pr.ZodArray,...Ar(t)});function Ad(e){if(e instanceof Cl){const t={};for(const r in e.shape){const n=e.shape[r];t[r]=$u.create(Ad(n))}return new Cl({...e._def,shape:()=>t})}else return e instanceof Ap?new Ap({...e._def,type:Ad(e.element)}):e instanceof $u?$u.create(Ad(e.unwrap())):e instanceof Zh?Zh.create(Ad(e.unwrap())):e instanceof Gh?Gh.create(e.items.map(t=>Ad(t))):e}let Cl=class Jl extends $r{constructor(){super(...arguments),this._cached=null,this.nonstrict=this.passthrough,this.augment=this.extend}_getCached(){if(this._cached!==null)return this._cached;const t=this._def.shape(),r=un.objectKeys(t);return this._cached={shape:t,keys:r}}_parse(t){if(this._getType(t)!==$e.object){const g=this._getOrReturnCtx(t);return Ne(g,{code:fe.invalid_type,expected:$e.object,received:g.parsedType}),gr}const{status:r,ctx:n}=this._processInputParams(t),{shape:i,keys:l}=this._getCached(),h=[];if(!(this._def.catchall instanceof jc&&this._def.unknownKeys==="strip"))for(const g in n.data)l.includes(g)||h.push(g);const a=[];for(const g of l){const _=i[g],E=n.data[g];a.push({key:{status:"valid",value:g},value:_._parse(new ju(n,E,n.path,g)),alwaysSet:g in n.data})}if(this._def.catchall instanceof jc){const g=this._def.unknownKeys;if(g==="passthrough")for(const _ of h)a.push({key:{status:"valid",value:_},value:{status:"valid",value:n.data[_]}});else if(g==="strict")h.length>0&&(Ne(n,{code:fe.unrecognized_keys,keys:h}),r.dirty());else if(g!=="strip")throw new Error("Internal ZodObject error: invalid unknownKeys value.")}else{const g=this._def.catchall;for(const _ of h){const E=n.data[_];a.push({key:{status:"valid",value:_},value:g._parse(new ju(n,E,n.path,_)),alwaysSet:_ in n.data})}}return n.common.async?Promise.resolve().then(async()=>{const g=[];for(const _ of a){const E=await _.key,S=await _.value;g.push({key:E,value:S,alwaysSet:_.alwaysSet})}return g}).then(g=>ba.mergeObjectSync(r,g)):ba.mergeObjectSync(r,a)}get shape(){return this._def.shape()}strict(t){return er.errToObj,new Jl({...this._def,unknownKeys:"strict",...t!==void 0?{errorMap:(r,n)=>{var i,l,h,a;const g=(h=(l=(i=this._def).errorMap)===null||l===void 0?void 0:l.call(i,r,n).message)!==null&&h!==void 0?h:n.defaultError;return r.code==="unrecognized_keys"?{message:(a=er.errToObj(t).message)!==null&&a!==void 0?a:g}:{message:g}}}:{}})}strip(){return new Jl({...this._def,unknownKeys:"strip"})}passthrough(){return new Jl({...this._def,unknownKeys:"passthrough"})}extend(t){return new Jl({...this._def,shape:()=>({...this._def.shape(),...t})})}merge(t){return new Jl({unknownKeys:t._def.unknownKeys,catchall:t._def.catchall,shape:()=>({...this._def.shape(),...t._def.shape()}),typeName:pr.ZodObject})}setKey(t,r){return this.augment({[t]:r})}catchall(t){return new Jl({...this._def,catchall:t})}pick(t){const r={};return un.objectKeys(t).forEach(n=>{t[n]&&this.shape[n]&&(r[n]=this.shape[n])}),new Jl({...this._def,shape:()=>r})}omit(t){const r={};return un.objectKeys(this.shape).forEach(n=>{t[n]||(r[n]=this.shape[n])}),new Jl({...this._def,shape:()=>r})}deepPartial(){return Ad(this)}partial(t){const r={};return un.objectKeys(this.shape).forEach(n=>{const i=this.shape[n];t&&!t[n]?r[n]=i:r[n]=i.optional()}),new Jl({...this._def,shape:()=>r})}required(t){const r={};return un.objectKeys(this.shape).forEach(n=>{if(t&&!t[n])r[n]=this.shape[n];else{let i=this.shape[n];for(;i instanceof $u;)i=i._def.innerType;r[n]=i}}),new Jl({...this._def,shape:()=>r})}keyof(){return lT(un.objectKeys(this.shape))}};Cl.create=(e,t)=>new Cl({shape:()=>e,unknownKeys:"strip",catchall:jc.create(),typeName:pr.ZodObject,...Ar(t)});Cl.strictCreate=(e,t)=>new Cl({shape:()=>e,unknownKeys:"strict",catchall:jc.create(),typeName:pr.ZodObject,...Ar(t)});Cl.lazycreate=(e,t)=>new Cl({shape:e,unknownKeys:"strip",catchall:jc.create(),typeName:pr.ZodObject,...Ar(t)});let jm=class extends $r{_parse(t){const{ctx:r}=this._processInputParams(t),n=this._def.options;function i(l){for(const a of l)if(a.result.status==="valid")return a.result;for(const a of l)if(a.result.status==="dirty")return r.common.issues.push(...a.ctx.common.issues),a.result;const h=l.map(a=>new ou(a.ctx.common.issues));return Ne(r,{code:fe.invalid_union,unionErrors:h}),gr}if(r.common.async)return Promise.all(n.map(async l=>{const h={...r,common:{...r.common,issues:[]},parent:null};return{result:await l._parseAsync({data:r.data,path:r.path,parent:h}),ctx:h}})).then(i);{let l;const h=[];for(const g of n){const _={...r,common:{...r.common,issues:[]},parent:null},E=g._parseSync({data:r.data,path:r.path,parent:_});if(E.status==="valid")return E;E.status==="dirty"&&!l&&(l={result:E,ctx:_}),_.common.issues.length&&h.push(_.common.issues)}if(l)return r.common.issues.push(...l.ctx.common.issues),l.result;const a=h.map(g=>new ou(g));return Ne(r,{code:fe.invalid_union,unionErrors:a}),gr}}get options(){return this._def.options}};jm.create=(e,t)=>new jm({options:e,typeName:pr.ZodUnion,...Ar(t)});const kh=e=>e instanceof Gm?kh(e.schema):e instanceof lu?kh(e.innerType()):e instanceof qm?[e.value]:e instanceof qh?e.options:e instanceof Zm?un.objectValues(e.enum):e instanceof Wm?kh(e._def.innerType):e instanceof $m?[void 0]:e instanceof Um?[null]:e instanceof $u?[void 0,...kh(e.unwrap())]:e instanceof Zh?[null,...kh(e.unwrap())]:e instanceof Ux||e instanceof Hm?kh(e.unwrap()):e instanceof Xm?kh(e._def.innerType):[];let nT=class iT extends $r{_parse(t){const{ctx:r}=this._processInputParams(t);if(r.parsedType!==$e.object)return Ne(r,{code:fe.invalid_type,expected:$e.object,received:r.parsedType}),gr;const n=this.discriminator,i=r.data[n],l=this.optionsMap.get(i);return l?r.common.async?l._parseAsync({data:r.data,path:r.path,parent:r}):l._parseSync({data:r.data,path:r.path,parent:r}):(Ne(r,{code:fe.invalid_union_discriminator,options:Array.from(this.optionsMap.keys()),path:[n]}),gr)}get discriminator(){return this._def.discriminator}get options(){return this._def.options}get optionsMap(){return this._def.optionsMap}static create(t,r,n){const i=new Map;for(const l of r){const h=kh(l.shape[t]);if(!h.length)throw new Error(`A discriminator value for key \`${t}\` could not be extracted from all schema options`);for(const a of h){if(i.has(a))throw new Error(`Discriminator property ${String(t)} has duplicate value ${String(a)}`);i.set(a,l)}}return new iT({typeName:pr.ZodDiscriminatedUnion,discriminator:t,options:r,optionsMap:i,...Ar(n)})}};function Kv(e,t){const r=Fh(e),n=Fh(t);if(e===t)return{valid:!0,data:e};if(r===$e.object&&n===$e.object){const i=un.objectKeys(t),l=un.objectKeys(e).filter(a=>i.indexOf(a)!==-1),h={...e,...t};for(const a of l){const g=Kv(e[a],t[a]);if(!g.valid)return{valid:!1};h[a]=g.data}return{valid:!0,data:h}}else if(r===$e.array&&n===$e.array){if(e.length!==t.length)return{valid:!1};const i=[];for(let l=0;l<e.length;l++){const h=e[l],a=t[l],g=Kv(h,a);if(!g.valid)return{valid:!1};i.push(g.data)}return{valid:!0,data:i}}else return r===$e.date&&n===$e.date&&+e==+t?{valid:!0,data:e}:{valid:!1}}let Vm=class extends $r{_parse(t){const{status:r,ctx:n}=this._processInputParams(t),i=(l,h)=>{if(Wv(l)||Wv(h))return gr;const a=Kv(l.value,h.value);return a.valid?((Xv(l)||Xv(h))&&r.dirty(),{status:r.value,value:a.data}):(Ne(n,{code:fe.invalid_intersection_types}),gr)};return n.common.async?Promise.all([this._def.left._parseAsync({data:n.data,path:n.path,parent:n}),this._def.right._parseAsync({data:n.data,path:n.path,parent:n})]).then(([l,h])=>i(l,h)):i(this._def.left._parseSync({data:n.data,path:n.path,parent:n}),this._def.right._parseSync({data:n.data,path:n.path,parent:n}))}};Vm.create=(e,t,r)=>new Vm({left:e,right:t,typeName:pr.ZodIntersection,...Ar(r)});let Gh=class oT extends $r{_parse(t){const{status:r,ctx:n}=this._processInputParams(t);if(n.parsedType!==$e.array)return Ne(n,{code:fe.invalid_type,expected:$e.array,received:n.parsedType}),gr;if(n.data.length<this._def.items.length)return Ne(n,{code:fe.too_small,minimum:this._def.items.length,inclusive:!0,exact:!1,type:"array"}),gr;!this._def.rest&&n.data.length>this._def.items.length&&(Ne(n,{code:fe.too_big,maximum:this._def.items.length,inclusive:!0,exact:!1,type:"array"}),r.dirty());const i=[...n.data].map((l,h)=>{const a=this._def.items[h]||this._def.rest;return a?a._parse(new ju(n,l,n.path,h)):null}).filter(l=>!!l);return n.common.async?Promise.all(i).then(l=>ba.mergeArray(r,l)):ba.mergeArray(r,i)}get items(){return this._def.items}rest(t){return new oT({...this._def,rest:t})}};Gh.create=(e,t)=>{if(!Array.isArray(e))throw new Error("You must pass an array of schemas to z.tuple([ ... ])");return new Gh({items:e,typeName:pr.ZodTuple,rest:null,...Ar(t)})};let sT=class Jv extends $r{get keySchema(){return this._def.keyType}get valueSchema(){return this._def.valueType}_parse(t){const{status:r,ctx:n}=this._processInputParams(t);if(n.parsedType!==$e.object)return Ne(n,{code:fe.invalid_type,expected:$e.object,received:n.parsedType}),gr;const i=[],l=this._def.keyType,h=this._def.valueType;for(const a in n.data)i.push({key:l._parse(new ju(n,a,n.path,a)),value:h._parse(new ju(n,n.data[a],n.path,a)),alwaysSet:a in n.data});return n.common.async?ba.mergeObjectAsync(r,i):ba.mergeObjectSync(r,i)}get element(){return this._def.valueType}static create(t,r,n){return r instanceof $r?new Jv({keyType:t,valueType:r,typeName:pr.ZodRecord,...Ar(n)}):new Jv({keyType:Ud.create(),valueType:t,typeName:pr.ZodRecord,...Ar(r)})}},a_=class extends $r{get keySchema(){return this._def.keyType}get valueSchema(){return this._def.valueType}_parse(t){const{status:r,ctx:n}=this._processInputParams(t);if(n.parsedType!==$e.map)return Ne(n,{code:fe.invalid_type,expected:$e.map,received:n.parsedType}),gr;const i=this._def.keyType,l=this._def.valueType,h=[...n.data.entries()].map(([a,g],_)=>({key:i._parse(new ju(n,a,n.path,[_,"key"])),value:l._parse(new ju(n,g,n.path,[_,"value"]))}));if(n.common.async){const a=new Map;return Promise.resolve().then(async()=>{for(const g of h){const _=await g.key,E=await g.value;if(_.status==="aborted"||E.status==="aborted")return gr;(_.status==="dirty"||E.status==="dirty")&&r.dirty(),a.set(_.value,E.value)}return{status:r.value,value:a}})}else{const a=new Map;for(const g of h){const _=g.key,E=g.value;if(_.status==="aborted"||E.status==="aborted")return gr;(_.status==="dirty"||E.status==="dirty")&&r.dirty(),a.set(_.value,E.value)}return{status:r.value,value:a}}}};a_.create=(e,t,r)=>new a_({valueType:t,keyType:e,typeName:pr.ZodMap,...Ar(r)});let l_=class Qv extends $r{_parse(t){const{status:r,ctx:n}=this._processInputParams(t);if(n.parsedType!==$e.set)return Ne(n,{code:fe.invalid_type,expected:$e.set,received:n.parsedType}),gr;const i=this._def;i.minSize!==null&&n.data.size<i.minSize.value&&(Ne(n,{code:fe.too_small,minimum:i.minSize.value,type:"set",inclusive:!0,exact:!1,message:i.minSize.message}),r.dirty()),i.maxSize!==null&&n.data.size>i.maxSize.value&&(Ne(n,{code:fe.too_big,maximum:i.maxSize.value,type:"set",inclusive:!0,exact:!1,message:i.maxSize.message}),r.dirty());const l=this._def.valueType;function h(g){const _=new Set;for(const E of g){if(E.status==="aborted")return gr;E.status==="dirty"&&r.dirty(),_.add(E.value)}return{status:r.value,value:_}}const a=[...n.data.values()].map((g,_)=>l._parse(new ju(n,g,n.path,_)));return n.common.async?Promise.all(a).then(g=>h(g)):h(a)}min(t,r){return new Qv({...this._def,minSize:{value:t,message:er.toString(r)}})}max(t,r){return new Qv({...this._def,maxSize:{value:t,message:er.toString(r)}})}size(t,r){return this.min(t,r).max(t,r)}nonempty(t){return this.min(1,t)}};l_.create=(e,t)=>new l_({valueType:e,minSize:null,maxSize:null,typeName:pr.ZodSet,...Ar(t)});let aT=class $y extends $r{constructor(){super(...arguments),this.validate=this.implement}_parse(t){const{ctx:r}=this._processInputParams(t);if(r.parsedType!==$e.function)return Ne(r,{code:fe.invalid_type,expected:$e.function,received:r.parsedType}),gr;function n(a,g){return r_({data:a,path:r.path,errorMaps:[r.common.contextualErrorMap,r.schemaErrorMap,e_(),$d].filter(_=>!!_),issueData:{code:fe.invalid_arguments,argumentsError:g}})}function i(a,g){return r_({data:a,path:r.path,errorMaps:[r.common.contextualErrorMap,r.schemaErrorMap,e_(),$d].filter(_=>!!_),issueData:{code:fe.invalid_return_type,returnTypeError:g}})}const l={errorMap:r.common.contextualErrorMap},h=r.data;if(this._def.returns instanceof Vd){const a=this;return Ks(async function(...g){const _=new ou([]),E=await a._def.args.parseAsync(g,l).catch(A=>{throw _.addIssue(n(g,A)),_}),S=await Reflect.apply(h,this,E);return await a._def.returns._def.type.parseAsync(S,l).catch(A=>{throw _.addIssue(i(S,A)),_})})}else{const a=this;return Ks(function(...g){const _=a._def.args.safeParse(g,l);if(!_.success)throw new ou([n(g,_.error)]);const E=Reflect.apply(h,this,_.data),S=a._def.returns.safeParse(E,l);if(!S.success)throw new ou([i(E,S.error)]);return S.data})}}parameters(){return this._def.args}returnType(){return this._def.returns}args(...t){return new $y({...this._def,args:Gh.create(t).rest(Mp.create())})}returns(t){return new $y({...this._def,returns:t})}implement(t){return this.parse(t)}strictImplement(t){return this.parse(t)}static create(t,r,n){return new $y({args:t||Gh.create([]).rest(Mp.create()),returns:r||Mp.create(),typeName:pr.ZodFunction,...Ar(n)})}},Gm=class extends $r{get schema(){return this._def.getter()}_parse(t){const{ctx:r}=this._processInputParams(t);return this._def.getter()._parse({data:r.data,path:r.path,parent:r})}};Gm.create=(e,t)=>new Gm({getter:e,typeName:pr.ZodLazy,...Ar(t)});let qm=class extends $r{_parse(t){if(t.data!==this._def.value){const r=this._getOrReturnCtx(t);return Ne(r,{received:r.data,code:fe.invalid_literal,expected:this._def.value}),gr}return{status:"valid",value:t.data}}get value(){return this._def.value}};qm.create=(e,t)=>new qm({value:e,typeName:pr.ZodLiteral,...Ar(t)});function lT(e,t){return new qh({values:e,typeName:pr.ZodEnum,...Ar(t)})}class qh extends $r{constructor(){super(...arguments),gm.set(this,void 0)}_parse(t){if(typeof t.data!="string"){const r=this._getOrReturnCtx(t),n=this._def.values;return Ne(r,{expected:un.joinValues(n),received:r.parsedType,code:fe.invalid_type}),gr}if(i_(this,gm)||JS(this,gm,new Set(this._def.values)),!i_(this,gm).has(t.data)){const r=this._getOrReturnCtx(t),n=this._def.values;return Ne(r,{received:r.data,code:fe.invalid_enum_value,options:n}),gr}return Ks(t.data)}get options(){return this._def.values}get enum(){const t={};for(const r of this._def.values)t[r]=r;return t}get Values(){const t={};for(const r of this._def.values)t[r]=r;return t}get Enum(){const t={};for(const r of this._def.values)t[r]=r;return t}extract(t,r=this._def){return qh.create(t,{...this._def,...r})}exclude(t,r=this._def){return qh.create(this.options.filter(n=>!t.includes(n)),{...this._def,...r})}}gm=new WeakMap;qh.create=lT;let Zm=class extends $r{constructor(){super(...arguments),ym.set(this,void 0)}_parse(t){const r=un.getValidEnumValues(this._def.values),n=this._getOrReturnCtx(t);if(n.parsedType!==$e.string&&n.parsedType!==$e.number){const i=un.objectValues(r);return Ne(n,{expected:un.joinValues(i),received:n.parsedType,code:fe.invalid_type}),gr}if(i_(this,ym)||JS(this,ym,new Set(un.getValidEnumValues(this._def.values))),!i_(this,ym).has(t.data)){const i=un.objectValues(r);return Ne(n,{received:n.data,code:fe.invalid_enum_value,options:i}),gr}return Ks(t.data)}get enum(){return this._def.values}};ym=new WeakMap;Zm.create=(e,t)=>new Zm({values:e,typeName:pr.ZodNativeEnum,...Ar(t)});let Vd=class extends $r{unwrap(){return this._def.type}_parse(t){const{ctx:r}=this._processInputParams(t);if(r.parsedType!==$e.promise&&r.common.async===!1)return Ne(r,{code:fe.invalid_type,expected:$e.promise,received:r.parsedType}),gr;const n=r.parsedType===$e.promise?r.data:Promise.resolve(r.data);return Ks(n.then(i=>this._def.type.parseAsync(i,{path:r.path,errorMap:r.common.contextualErrorMap})))}};Vd.create=(e,t)=>new Vd({type:e,typeName:pr.ZodPromise,...Ar(t)});let lu=class extends $r{innerType(){return this._def.schema}sourceType(){return this._def.schema._def.typeName===pr.ZodEffects?this._def.schema.sourceType():this._def.schema}_parse(t){const{status:r,ctx:n}=this._processInputParams(t),i=this._def.effect||null,l={addIssue:h=>{Ne(n,h),h.fatal?r.abort():r.dirty()},get path(){return n.path}};if(l.addIssue=l.addIssue.bind(l),i.type==="preprocess"){const h=i.transform(n.data,l);if(n.common.async)return Promise.resolve(h).then(async a=>{if(r.value==="aborted")return gr;const g=await this._def.schema._parseAsync({data:a,path:n.path,parent:n});return g.status==="aborted"?gr:g.status==="dirty"||r.value==="dirty"?n_(g.value):g});{if(r.value==="aborted")return gr;const a=this._def.schema._parseSync({data:h,path:n.path,parent:n});return a.status==="aborted"?gr:a.status==="dirty"||r.value==="dirty"?n_(a.value):a}}if(i.type==="refinement"){const h=a=>{const g=i.refinement(a,l);if(n.common.async)return Promise.resolve(g);if(g instanceof Promise)throw new Error("Async refinement encountered during synchronous parse operation. Use .parseAsync instead.");return a};if(n.common.async===!1){const a=this._def.schema._parseSync({data:n.data,path:n.path,parent:n});return a.status==="aborted"?gr:(a.status==="dirty"&&r.dirty(),h(a.value),{status:r.value,value:a.value})}else return this._def.schema._parseAsync({data:n.data,path:n.path,parent:n}).then(a=>a.status==="aborted"?gr:(a.status==="dirty"&&r.dirty(),h(a.value).then(()=>({status:r.value,value:a.value}))))}if(i.type==="transform")if(n.common.async===!1){const h=this._def.schema._parseSync({data:n.data,path:n.path,parent:n});if(!Nm(h))return h;const a=i.transform(h.value,l);if(a instanceof Promise)throw new Error("Asynchronous transform encountered during synchronous parse operation. Use .parseAsync instead.");return{status:r.value,value:a}}else return this._def.schema._parseAsync({data:n.data,path:n.path,parent:n}).then(h=>Nm(h)?Promise.resolve(i.transform(h.value,l)).then(a=>({status:r.value,value:a})):h);un.assertNever(i)}};lu.create=(e,t,r)=>new lu({schema:e,typeName:pr.ZodEffects,effect:t,...Ar(r)});lu.createWithPreprocess=(e,t,r)=>new lu({schema:t,effect:{type:"preprocess",transform:e},typeName:pr.ZodEffects,...Ar(r)});let $u=class extends $r{_parse(t){return this._getType(t)===$e.undefined?Ks(void 0):this._def.innerType._parse(t)}unwrap(){return this._def.innerType}};$u.create=(e,t)=>new $u({innerType:e,typeName:pr.ZodOptional,...Ar(t)});let Zh=class extends $r{_parse(t){return this._getType(t)===$e.null?Ks(null):this._def.innerType._parse(t)}unwrap(){return this._def.innerType}};Zh.create=(e,t)=>new Zh({innerType:e,typeName:pr.ZodNullable,...Ar(t)});let Wm=class extends $r{_parse(t){const{ctx:r}=this._processInputParams(t);let n=r.data;return r.parsedType===$e.undefined&&(n=this._def.defaultValue()),this._def.innerType._parse({data:n,path:r.path,parent:r})}removeDefault(){return this._def.innerType}};Wm.create=(e,t)=>new Wm({innerType:e,typeName:pr.ZodDefault,defaultValue:typeof t.default=="function"?t.default:()=>t.default,...Ar(t)});let Xm=class extends $r{_parse(t){const{ctx:r}=this._processInputParams(t),n={...r,common:{...r.common,issues:[]}},i=this._def.innerType._parse({data:n.data,path:n.path,parent:{...n}});return km(i)?i.then(l=>({status:"valid",value:l.status==="valid"?l.value:this._def.catchValue({get error(){return new ou(n.common.issues)},input:n.data})})):{status:"valid",value:i.status==="valid"?i.value:this._def.catchValue({get error(){return new ou(n.common.issues)},input:n.data})}}removeCatch(){return this._def.innerType}};Xm.create=(e,t)=>new Xm({innerType:e,typeName:pr.ZodCatch,catchValue:typeof t.catch=="function"?t.catch:()=>t.catch,...Ar(t)});let u_=class extends $r{_parse(t){if(this._getType(t)!==$e.nan){const r=this._getOrReturnCtx(t);return Ne(r,{code:fe.invalid_type,expected:$e.nan,received:r.parsedType}),gr}return{status:"valid",value:t.data}}};u_.create=e=>new u_({typeName:pr.ZodNaN,...Ar(e)});const ON=Symbol("zod_brand");class Ux extends $r{_parse(t){const{ctx:r}=this._processInputParams(t),n=r.data;return this._def.type._parse({data:n,path:r.path,parent:r})}unwrap(){return this._def.type}}let jx=class uT extends $r{_parse(t){const{status:r,ctx:n}=this._processInputParams(t);if(n.common.async)return(async()=>{const i=await this._def.in._parseAsync({data:n.data,path:n.path,parent:n});return i.status==="aborted"?gr:i.status==="dirty"?(r.dirty(),n_(i.value)):this._def.out._parseAsync({data:i.value,path:n.path,parent:n})})();{const i=this._def.in._parseSync({data:n.data,path:n.path,parent:n});return i.status==="aborted"?gr:i.status==="dirty"?(r.dirty(),{status:"dirty",value:i.value}):this._def.out._parseSync({data:i.value,path:n.path,parent:n})}}static create(t,r){return new uT({in:t,out:r,typeName:pr.ZodPipeline})}},Hm=class extends $r{_parse(t){const r=this._def.innerType._parse(t),n=i=>(Nm(i)&&(i.value=Object.freeze(i.value)),i);return km(r)?r.then(i=>n(i)):n(r)}unwrap(){return this._def.innerType}};Hm.create=(e,t)=>new Hm({innerType:e,typeName:pr.ZodReadonly,...Ar(t)});function cT(e,t={},r){return e?jd.create().superRefine((n,i)=>{var l,h;if(!e(n)){const a=typeof t=="function"?t(n):typeof t=="string"?{message:t}:t,g=(h=(l=a.fatal)!==null&&l!==void 0?l:r)!==null&&h!==void 0?h:!0,_=typeof a=="string"?{message:a}:a;i.addIssue({code:"custom",..._,fatal:g})}}):jd.create()}const FN={object:Cl.lazycreate};var pr;(function(e){e.ZodString="ZodString",e.ZodNumber="ZodNumber",e.ZodNaN="ZodNaN",e.ZodBigInt="ZodBigInt",e.ZodBoolean="ZodBoolean",e.ZodDate="ZodDate",e.ZodSymbol="ZodSymbol",e.ZodUndefined="ZodUndefined",e.ZodNull="ZodNull",e.ZodAny="ZodAny",e.ZodUnknown="ZodUnknown",e.ZodNever="ZodNever",e.ZodVoid="ZodVoid",e.ZodArray="ZodArray",e.ZodObject="ZodObject",e.ZodUnion="ZodUnion",e.ZodDiscriminatedUnion="ZodDiscriminatedUnion",e.ZodIntersection="ZodIntersection",e.ZodTuple="ZodTuple",e.ZodRecord="ZodRecord",e.ZodMap="ZodMap",e.ZodSet="ZodSet",e.ZodFunction="ZodFunction",e.ZodLazy="ZodLazy",e.ZodLiteral="ZodLiteral",e.ZodEnum="ZodEnum",e.ZodEffects="ZodEffects",e.ZodNativeEnum="ZodNativeEnum",e.ZodOptional="ZodOptional",e.ZodNullable="ZodNullable",e.ZodDefault="ZodDefault",e.ZodCatch="ZodCatch",e.ZodPromise="ZodPromise",e.ZodBranded="ZodBranded",e.ZodPipeline="ZodPipeline",e.ZodReadonly="ZodReadonly"})(pr||(pr={}));const zN=(e,t={message:`Input not instance of ${e.name}`})=>cT(r=>r instanceof e,t),hT=Ud.create,pT=Om.create,BN=u_.create,$N=Fm.create,dT=zm.create,UN=Bm.create,jN=o_.create,VN=$m.create,GN=Um.create,qN=jd.create,ZN=Mp.create,WN=jc.create,XN=s_.create,HN=Ap.create,YN=Cl.create,KN=Cl.strictCreate,JN=jm.create,QN=nT.create,tk=Vm.create,ek=Gh.create,rk=sT.create,nk=a_.create,ik=l_.create,ok=aT.create,sk=Gm.create,ak=qm.create,lk=qh.create,uk=Zm.create,ck=Vd.create,SE=lu.create,hk=$u.create,pk=Zh.create,dk=lu.createWithPreprocess,fk=jx.create,mk=()=>hT().optional(),gk=()=>pT().optional(),yk=()=>dT().optional(),_k={string:e=>Ud.create({...e,coerce:!0}),number:e=>Om.create({...e,coerce:!0}),boolean:e=>zm.create({...e,coerce:!0}),bigint:e=>Fm.create({...e,coerce:!0}),date:e=>Bm.create({...e,coerce:!0})},vk=gr;var St=Object.freeze({__proto__:null,defaultErrorMap:$d,setErrorMap:vN,getErrorMap:e_,makeIssue:r_,EMPTY_PATH:xN,addIssueToContext:Ne,ParseStatus:ba,INVALID:gr,DIRTY:n_,OK:Ks,isAborted:Wv,isDirty:Xv,isValid:Nm,isAsync:km,get util(){return un},get objectUtil(){return Zv},ZodParsedType:$e,getParsedType:Fh,ZodType:$r,datetimeRegex:eT,ZodString:Ud,ZodNumber:Om,ZodBigInt:Fm,ZodBoolean:zm,ZodDate:Bm,ZodSymbol:o_,ZodUndefined:$m,ZodNull:Um,ZodAny:jd,ZodUnknown:Mp,ZodNever:jc,ZodVoid:s_,ZodArray:Ap,ZodObject:Cl,ZodUnion:jm,ZodDiscriminatedUnion:nT,ZodIntersection:Vm,ZodTuple:Gh,ZodRecord:sT,ZodMap:a_,ZodSet:l_,ZodFunction:aT,ZodLazy:Gm,ZodLiteral:qm,ZodEnum:qh,ZodNativeEnum:Zm,ZodPromise:Vd,ZodEffects:lu,ZodTransformer:lu,ZodOptional:$u,ZodNullable:Zh,ZodDefault:Wm,ZodCatch:Xm,ZodNaN:u_,BRAND:ON,ZodBranded:Ux,ZodPipeline:jx,ZodReadonly:Hm,custom:cT,Schema:$r,ZodSchema:$r,late:FN,get ZodFirstPartyTypeKind(){return pr},coerce:_k,any:qN,array:HN,bigint:$N,boolean:dT,date:UN,discriminatedUnion:QN,effect:SE,enum:lk,function:ok,instanceof:zN,intersection:tk,lazy:sk,literal:ak,map:nk,nan:BN,nativeEnum:uk,never:WN,null:GN,nullable:pk,number:pT,object:YN,oboolean:yk,onumber:gk,optional:hk,ostring:mk,pipeline:fk,preprocess:dk,promise:ck,record:rk,set:ik,strictObject:KN,string:hT,symbol:jN,transformer:SE,tuple:ek,undefined:VN,union:JN,unknown:ZN,void:XN,NEVER:vk,ZodIssueCode:fe,quotelessJson:_N,ZodError:ou});const N_=/^https?:\/\/library.stanford.edu\/iiif\/image-api\/1.1\/compliance.html#level(?<level>[012])$/,fT=St.string().regex(N_),xk=fT,c_="http://library.stanford.edu/iiif/image-api/1.1/context.json",mT="http://iiif.io/api/image/1/context.json",gT=St.literal(c_),yT=St.object({"@context":gT,"@id":St.string().url(),profile:fT.optional(),width:St.number().int(),height:St.number().int(),scale_factors:St.number().array().optional(),tile_width:St.number().optional(),tile_height:St.number().optional()}),_T=St.object({width:St.number().int(),height:St.number().int()}),vT=St.object({width:St.number().int(),height:St.number().int().optional(),scaleFactors:St.array(St.number().int())}),bk=["ImageService1","ImageService2","ImageService3"],xT=St.enum(bk),k_=/^https?:\/\/iiif.io\/api\/image\/2.*level(?<level>[012])(.json)?$/,TE=St.string().regex(k_),wk=St.object({formats:St.string().array().optional(),maxArea:St.number().int().optional(),maxHeight:St.number().int().optional(),maxWidth:St.number().int().optional(),qualities:St.string().array().optional(),supports:St.string().array().optional()}),h_=TE.or(St.array(St.union([TE,wk,St.any()]))),p_="http://iiif.io/api/image/2/context.json",bT=St.literal(p_).or(St.literal("https://iiif.io/api/image/2/context.json")),Vx=St.object({"@id":St.string().url(),"@type":St.literal("iiif:Image").optional(),"@context":bT,protocol:St.literal("http://iiif.io/api/image"),width:St.number().int(),height:St.number().int(),profile:h_,sizes:_T.array().optional(),tiles:vT.array().optional()}),Ek=["level0","level1","level2"],wT=St.enum(Ek),Gx=St.object({id:St.string().url(),type:St.literal("ImageService3"),protocol:St.literal("http://iiif.io/api/image"),profile:wT,width:St.number().int(),height:St.number().int(),maxWidth:St.number().int().optional(),maxHeight:St.number().int().optional(),maxArea:St.number().int().optional(),sizes:_T.array().optional(),tiles:vT.array().optional(),extraFeatures:St.string().array().optional()}),Sk=St.object({"@id":St.string().url(),"@type":xT.optional(),profile:xk.or(h_).or(wT),width:St.number().int().optional(),height:St.number().int().optional(),"@context":gT.or(St.literal("http://iiif.io/api/image/1/context.json")).or(bT).optional()}),Tk=["level0","level1","level2"],Ik=St.object({id:St.string().url(),type:St.literal("ImageService2"),profile:h_}).or(St.object({"@id":St.string().url(),"@type":St.literal("ImageService2"),profile:h_})),Ck=St.object({id:St.string().url(),type:xT,profile:St.enum(Tk)}),Mk=St.union([Ik,Ck]),ET=Sk.or(Mk),IE=St.string().or(St.number()).or(St.boolean()),ST=IE.or(IE.array()),CE=St.object({"@language":St.string().optional(),"@value":ST}),Lp=ST.or(CE).or(CE.array()),Pk=St.union([St.any(),St.object({label:Lp.optional(),value:Lp.optional()})]).transform(e=>{if(e&&typeof e=="object"&&"label"in e&&"value"in e)return e}),TT=Pk.array(),Ak=St.object({width:St.number().int().optional(),height:St.number().int().optional(),service:ET}),Lk=St.object({resource:Ak}),IT=St.object({"@id":St.string().url(),"@type":St.literal("sc:Canvas"),width:St.number().int(),height:St.number().int(),images:Lk.array().length(1),label:Lp.optional(),metadata:TT.optional()}),Rk=St.object({canvases:IT.array().nonempty()}),CT=St.object({"@id":St.string().url(),"@type":St.literal("sc:Manifest"),sequences:Rk.array().length(1),label:Lp.optional(),description:Lp.optional(),metadata:TT.optional()}),ME=St.lazy(()=>St.object({"@id":St.string().url(),"@type":St.literal("sc:Manifest"),label:Lp.optional()})),tx=St.lazy(()=>St.object({"@id":St.string().url(),"@type":St.literal("sc:Collection"),label:Lp.optional(),manifests:ME.array().optional(),collections:tx.array().optional(),members:ME.or(tx).array().optional()})),Dk=St.string().or(St.number()).or(St.boolean()),Rp=St.record(St.string(),Dk.array()),Nk=St.union([St.any(),St.object({label:Rp.optional(),value:Rp.optional()})]).transform(e=>{if(e&&typeof e=="object"&&"label"in e&&"value"in e)return e}),MT=Nk.array(),PE=St.object({type:St.literal("Image"),width:St.number().int().optional(),height:St.number().int().optional(),service:ET.array()}),kk=St.object({type:St.literal("Annotation"),body:PE.or(PE.array().length(1))}),Ok=St.object({type:St.literal("AnnotationPage"),items:kk.array().length(1)}),PT=St.object({id:St.string().url(),type:St.literal("Canvas"),width:St.number().int(),height:St.number().int(),items:Ok.array().length(1),label:Rp.optional(),metadata:MT.optional()}),AT=St.object({id:St.string().url(),type:St.literal("Manifest"),items:PT.array().nonempty(),label:Rp.optional(),description:Rp.optional(),metadata:MT.optional()}),Fk=St.lazy(()=>St.object({id:St.string().url(),type:St.literal("Manifest"),label:Rp.optional()})),LT=St.lazy(()=>St.object({id:St.string().url(),type:St.literal("Collection"),label:Rp.optional(),items:Fk.or(LT).array()})),RT=yT.or(Vx).or(Gx);IT.or(PT);const zk=CT.or(AT);tx.or(LT);CT.or(Vx);AT.or(Gx);zk.or(RT);function DT({width:e,height:t},r,n,i){const l=n*r.originalWidth,h=i*r.originalHeight,a=n*r.originalWidth+r.width*r.scaleFactor>e?e-n*r.originalWidth:r.width*r.scaleFactor,g=i*r.originalHeight+r.height*r.scaleFactor>t?t-i*r.originalHeight:r.height*r.scaleFactor;let _=r.width,E=r.height;return l+r.width*r.scaleFactor>e&&(_=Math.floor((e-l+r.scaleFactor-1)/r.scaleFactor)),h+r.height*r.scaleFactor>t&&(E=Math.floor((t-h+r.scaleFactor-1)/r.scaleFactor)),{region:{x:l,y:h,width:a,height:g},size:{width:_,height:E}}}function Bk({width:e,height:t},r=768){const n=Math.max(e,t)/r,i=Math.ceil(Math.log(n)/Math.log(2));return{scaleFactors:Array.from({length:i},(l,h)=>2**h),width:r}}function $k({width:e,height:t},r,n){const i=r.height||r.width,l=r.width*n,h=i*n;return{scaleFactor:n,width:r.width,height:i,originalWidth:l,originalHeight:h,columns:Math.ceil(e/l),rows:Math.ceil(t/h)}}function Uk(e,t){return t.map(r=>r.scaleFactors.map(n=>$k(e,r,n))).flat()}function jk(e){return!!e.some(t=>t.width&&t.scaleFactors&&t.scaleFactors.length)}function Vk(e,t,r){if(!t||!jk(t))if(r)t=[Bk(e)];else throw new Error("Image does not support tiles or custom regions and sizes.");return Uk(e,t)}function Gk(e,t,r="cover"){if(r==="cover"||r==="contain"){const n=t.width/e.width,i=t.height/e.height,l=r==="cover"?Math.max(n,i):Math.min(n,i),h=e.width*l,a=e.height*l;return{width:h,height:a}}else throw new Error('Mode must be either "cover" or "contain"')}const qk=.8,Zk=1.5;function NT(e,t,r="cover",{sizes:n,tileZoomLevels:i,supportsAnyRegionAndSize:l,maxWidth:h,maxHeight:a,maxArea:g}){let{width:_,height:E}=Gk(e,t,r);if(h&&_>h&&(E=E/_*h,_=h),a&&E>a&&(_=_/E*a,E=a),g&&_*E>g){const A=E/_,O=Math.floor(Math.sqrt(g/A))*A;_=Math.floor(O)/A,E=_*A}const S=e.width/e.height;if(_=Math.floor(_),E=Math.round(_/S),n){let A;for(const O of n){const k=O.width/_;if(k>=qk&&k<=Zk){A=O;break}}if(A)return{size:A}}if(l)return{size:{width:Math.round(_),height:Math.round(E)}};if(i){const A=e.width/_,O=i.map(({scaleFactor:tt},$)=>({index:$,scaleFactor:tt,diff:Math.abs(tt-A)})).sort((tt,$)=>tt.diff-$.diff),k=i[O[0].index],G=Math.ceil(e.width/(k.scaleFactor*i[0].width)),W=Math.ceil(e.height/(k.scaleFactor*i[0].height)),U=[];for(let tt=0;tt<W;tt++){const $=[];for(let V=0;V<G;V++){const it=DT(e,k,V,tt);$.push(it)}U.push($)}return U}throw new Error("Unable to create thumbnail")}const kT=["regionByPx","sizeByWh"];function Wk(e){const t=e.match(N_);if(t&&t.groups)return parseInt(t.groups.level)}function AE(e){const t=e.match(k_);if(t&&t.groups)return parseInt(t.groups.level)}function Xk(e){return{maxWidth:e==null?void 0:e.maxWidth,maxHeight:e==null?void 0:e.maxHeight,maxArea:e==null?void 0:e.maxArea,supportsAnyRegionAndSize:kT.every(t=>{var r;return(e==null?void 0:e.supports)&&((r=e==null?void 0:e.supports)==null?void 0:r.includes(t))})}}function Hk(e){if("type"in e&&e.type==="ImageService3")return 3;if("type"in e&&e.type==="ImageService2"||"@type"in e&&e["@type"]==="ImageService2"||"@context"in e&&e["@context"]===p_)return 2;if("@context"in e&&(e["@context"]===c_||e["@context"]===mT))return 1;if("profile"in e){let t;return Array.isArray(e.profile)?t=e.profile[0]:t=e.profile,t.match(N_)?1:t.match(k_)?2:3}else throw new Error("Unsupported IIIF Image Service")}function ex(e){if("type"in e||"@type"in e){const t=e.profile;let r=!1;return t==="level0"||typeof t=="string"&&t.endsWith("level0.json")?"extraFeatures"in e&&(r=kT.every(n=>e.extraFeatures&&e.extraFeatures.includes(n))):r=!0,{maxWidth:"maxWidth"in e?e.maxWidth:void 0,maxHeight:"maxHeight"in e?e.maxHeight:void 0,maxArea:"maxArea"in e?e.maxArea:void 0,supportsAnyRegionAndSize:r}}else if(Array.isArray(e.profile)){let t=!1,r=Number.NEGATIVE_INFINITY,n=Number.NEGATIVE_INFINITY,i=Number.NEGATIVE_INFINITY;return e.profile.forEach(l=>{if(typeof l=="string"){const h=AE(l);h&&(t=t||h>=1)}else{const{maxWidth:h,maxHeight:a,maxArea:g,supportsAnyRegionAndSize:_}=Xk(l);h!==void 0&&(n=Math.max(h,n)),a!==void 0&&(r=Math.max(a,r)),g!==void 0&&(i=Math.max(g,i)),t=t||_}}),{maxWidth:n>=0?n:void 0,maxHeight:r>=0?r:void 0,maxArea:i>=0?i:void 0,supportsAnyRegionAndSize:t}}else if("profile"in e&&e.profile){const t=Wk(e.profile),r=AE(e.profile);return t?{supportsAnyRegionAndSize:t>=1}:r?{supportsAnyRegionAndSize:r>=1}:{supportsAnyRegionAndSize:!1}}else throw new Error("Invalid Image")}const Yk="image";class Kk{constructor(t,r){if(Nt(this,"embedded",!0),Nt(this,"uri"),Nt(this,"type",Yk),Nt(this,"maxWidth"),Nt(this,"maxHeight"),Nt(this,"maxArea"),Nt(this,"supportsAnyRegionAndSize"),Nt(this,"width"),Nt(this,"height"),Nt(this,"majorVersion"),r){const n=t;let i,l;if(Array.isArray(n.service)?n.service.forEach(h=>{try{const a=Hk(h);(!l||a>l)&&(l=a,i=h)}catch{}}):i=n.service,!i)throw new Error("Unsupported IIIF Image Service");if("@id"in i)this.uri=i["@id"];else if("id"in i)this.uri=i.id;else throw new Error("Unsupported IIIF Image Service");if("type"in i&&i.type==="ImageService3")this.majorVersion=3;else if("type"in i&&i.type==="ImageService2"||"@type"in i&&i["@type"]==="ImageService2"||"@context"in i&&i["@context"]===p_)this.majorVersion=2;else if("@context"in i&&(i["@context"]===c_||i["@context"]===mT))this.majorVersion=1;else if("profile"in i){let h;Array.isArray(i.profile)?h=i.profile[0]:h=i.profile,h.match(N_)?this.majorVersion=1:h.match(k_)?this.majorVersion=2:this.majorVersion=3}else throw new Error("Unsupported IIIF Image Service");if("profile"in i){const h=ex(i);this.supportsAnyRegionAndSize=h.supportsAnyRegionAndSize,this.maxWidth=h.maxWidth,this.maxHeight=h.maxHeight,this.maxArea=h.maxArea}else this.supportsAnyRegionAndSize=!1}else{if("@id"in t)this.uri=t["@id"];else if("id"in t)this.uri=t.id;else throw new Error("Unsupported IIIF Image");if("type"in t&&t.type==="ImageService3")this.majorVersion=3;else if("@type"in t&&t["@type"]==="iiif:Image"||"@context"in t&&t["@context"]===p_)this.majorVersion=2;else if("@context"in t&&t["@context"]===c_)this.majorVersion=1;else throw new Error("Unsupported IIIF Image");if("profile"in t){const n=ex(t);this.supportsAnyRegionAndSize=n.supportsAnyRegionAndSize,this.maxWidth=n.maxWidth,this.maxHeight=n.maxHeight,this.maxArea=n.maxArea}else this.supportsAnyRegionAndSize=!1}if(t.width!==void 0)this.width=t.width;else if(r)this.width=r.width;else throw new Error("Width not present on either Canvas or Image Resource");if(t.height!==void 0)this.height=t.height;else if(r)this.height=r.height;else throw new Error("Height not present on either Canvas or Image Resource")}getImageUrl(t){const{region:r,size:n}=t;let i,l,h,a,g;r?(g=`${r.x},${r.y},${r.width},${r.height}`,h=r.height,a=r.width):(g="full",h=this.height,a=this.width);let _;if(n){i=Math.round(n.width),l=Math.round(n.height);const A=String(i);let O=String(l);const k=a/h,G=l*k/k;l===Math.round(G)&&(O=""),_=`${A},${O}`}else i=this.width,l=this.height,_=this.majorVersion===2?"full":"max";const E=i*l;if(this.maxWidth!==void 0&&i>this.maxWidth)throw new Error(`Width of requested image is too large: ${i} > ${this.maxWidth}`);if(this.maxHeight!==void 0&&l>this.maxHeight)throw new Error(`Height of requested image is too large: ${l} > ${this.maxHeight}`);if(this.maxArea!==void 0&&E>this.maxArea)throw new Error(`Area of requested image is too large: ${E} > ${this.maxArea}`);const S=this.majorVersion===1?"native":"default";return`${this.uri}/${g}/${_}/0/${S}.jpg`}getThumbnail(t,r="cover"){return NT({width:this.width,height:this.height},t,r,{supportsAnyRegionAndSize:this.supportsAnyRegionAndSize,maxWidth:this.maxWidth,maxHeight:this.maxHeight,maxArea:this.maxArea})}}let Jk=class OT extends Kk{constructor(t){super(t),Nt(this,"tileZoomLevels"),Nt(this,"sizes"),Nt(this,"embedded",!1);const r=ex(t);let n;"tiles"in t&&(n=t.tiles),this.tileZoomLevels=Vk({width:this.width,height:this.height},n,r.supportsAnyRegionAndSize),"sizes"in t&&(this.sizes=t.sizes)}static parse(t,r=null){let n;return r===1?n=yT.parse(t):r===2?n=Vx.parse(t):r===3?n=Gx.parse(t):n=RT.parse(t),new OT(n)}getIiifTile(t,r,n){return DT({width:this.width,height:this.height},t,r,n)}getThumbnail(t,r="cover"){return NT({width:this.width,height:this.height},t,r,{supportsAnyRegionAndSize:this.supportsAnyRegionAndSize,sizes:this.sizes,tileZoomLevels:this.tileZoomLevels,maxWidth:this.maxWidth,maxHeight:this.maxHeight,maxArea:this.maxArea})}};const LE=St.record(St.string(),St.string().array());St.object({label:LE.optional(),value:LE.optional()});var fa=63710088e-1,FT={centimeters:fa*100,centimetres:fa*100,degrees:fa/111325,feet:fa*3.28084,inches:fa*39.37,kilometers:fa/1e3,kilometres:fa/1e3,meters:fa,metres:fa,miles:fa/1609.344,millimeters:fa*1e3,millimetres:fa*1e3,nauticalmiles:fa/1852,radians:1,yards:fa*1.0936};function Qk(e,t,r){r===void 0&&(r={});var n={type:"Feature"};return(r.id===0||r.id)&&(n.id=r.id),r.bbox&&(n.bbox=r.bbox),n.properties=t||{},n.geometry=e,n}function tO(e,t,r){if(r===void 0&&(r={}),!e)throw new Error("coordinates is required");if(!Array.isArray(e))throw new Error("coordinates must be an Array");if(e.length<2)throw new Error("coordinates must be at least 2 numbers long");if(!RE(e[0])||!RE(e[1]))throw new Error("coordinates must contain numbers");var n={type:"Point",coordinates:e};return Qk(n,t,r)}function eO(e,t){t===void 0&&(t="kilometers");var r=FT[t];if(!r)throw new Error(t+" units is invalid");return e*r}function rO(e,t){t===void 0&&(t="kilometers");var r=FT[t];if(!r)throw new Error(t+" units is invalid");return e/r}function rx(e){var t=e%(2*Math.PI);return t*180/Math.PI}function nu(e){var t=e%360;return t*Math.PI/180}function RE(e){return!isNaN(e)&&e!==null&&!Array.isArray(e)}function Gd(e){if(!e)throw new Error("coord is required");if(!Array.isArray(e)){if(e.type==="Feature"&&e.geometry!==null&&e.geometry.type==="Point")return e.geometry.coordinates;if(e.type==="Point")return e.coordinates}if(Array.isArray(e)&&e.length>=2&&!Array.isArray(e[0])&&!Array.isArray(e[1]))return e;throw new Error("coord must be GeoJSON Point or an Array of numbers")}function nO(e){return e.type==="Feature"?e.geometry:e}function zT(e,t,r){if(r===void 0&&(r={}),r.final===!0)return iO(e,t);var n=Gd(e),i=Gd(t),l=nu(n[0]),h=nu(i[0]),a=nu(n[1]),g=nu(i[1]),_=Math.sin(h-l)*Math.cos(g),E=Math.cos(a)*Math.sin(g)-Math.sin(a)*Math.cos(g)*Math.cos(h-l);return rx(Math.atan2(_,E))}function iO(e,t){var r=zT(t,e);return r=(r+180)%360,r}function oO(e,t,r,n){n===void 0&&(n={});var i=Gd(e),l=nu(i[0]),h=nu(i[1]),a=nu(r),g=rO(t,n.units),_=Math.asin(Math.sin(h)*Math.cos(g)+Math.cos(h)*Math.sin(g)*Math.cos(a)),E=l+Math.atan2(Math.sin(a)*Math.sin(g)*Math.cos(h),Math.cos(g)-Math.sin(h)*Math.sin(_)),S=rx(E),A=rx(_);return tO([S,A],n.properties)}function qx(e,t,r){r===void 0&&(r={});var n=Gd(e),i=Gd(t),l=nu(i[1]-n[1]),h=nu(i[0]-n[0]),a=nu(n[1]),g=nu(i[1]),_=Math.pow(Math.sin(l/2),2)+Math.pow(Math.sin(h/2),2)*Math.cos(a)*Math.cos(g);return eO(2*Math.atan2(Math.sqrt(_),Math.sqrt(1-_)),r.units)}function d_(e,t){var r=qx(e,t),n=zT(e,t),i=oO(e,r/2,n);return i}function BT(e){if(e.__esModule)return e;var t=e.default;if(typeof t=="function"){var r=function n(){return this instanceof n?Reflect.construct(t,arguments,this.constructor):t.apply(this,arguments)};r.prototype=t.prototype}else r={};return Object.defineProperty(r,"__esModule",{value:!0}),Object.keys(e).forEach(function(n){var i=Object.getOwnPropertyDescriptor(e,n);Object.defineProperty(r,n,i.get?i:{enumerable:!0,get:function(){return e[n]}})}),r}var Yr={};const sO=Object.prototype.toString;function Ym(e){const t=sO.call(e);return t.endsWith("Array]")&&!t.includes("Big")}const aO=Object.freeze(Object.defineProperty({__proto__:null,isAnyArray:Ym},Symbol.toStringTag,{value:"Module"})),lO=BT(aO);function uO(e){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(!Ym(e))throw new TypeError("input must be an array");if(e.length===0)throw new TypeError("input must not be empty");var r=t.fromIndex,n=r===void 0?0:r,i=t.toIndex,l=i===void 0?e.length:i;if(n<0||n>=e.length||!Number.isInteger(n))throw new Error("fromIndex must be a positive integer smaller than length");if(l<=n||l>e.length||!Number.isInteger(l))throw new Error("toIndex must be an integer greater than fromIndex and at most equal to length");for(var h=e[n],a=n+1;a<l;a++)e[a]>h&&(h=e[a]);return h}function cO(e){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(!Ym(e))throw new TypeError("input must be an array");if(e.length===0)throw new TypeError("input must not be empty");var r=t.fromIndex,n=r===void 0?0:r,i=t.toIndex,l=i===void 0?e.length:i;if(n<0||n>=e.length||!Number.isInteger(n))throw new Error("fromIndex must be a positive integer smaller than length");if(l<=n||l>e.length||!Number.isInteger(l))throw new Error("toIndex must be an integer greater than fromIndex and at most equal to length");for(var h=e[n],a=n+1;a<l;a++)e[a]<h&&(h=e[a]);return h}function hO(e){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(Ym(e)){if(e.length===0)throw new TypeError("input must not be empty")}else throw new TypeError("input must be an array");var r;if(t.output!==void 0){if(!Ym(t.output))throw new TypeError("output option must be an array if specified");r=t.output}else r=new Array(e.length);var n=cO(e),i=uO(e);if(n===i)throw new RangeError("minimum and maximum input values are equal. Cannot rescale a constant array");var l=t.min,h=l===void 0?t.autoMinMax?n:0:l,a=t.max,g=a===void 0?t.autoMinMax?i:1:a;if(h>=g)throw new RangeError("min option must be smaller than max option");for(var _=(g-h)/(i-n),E=0;E<e.length;E++)r[E]=(e[E]-n)*_+h;return r}const pO=Object.freeze(Object.defineProperty({__proto__:null,default:hO},Symbol.toStringTag,{value:"Module"})),dO=BT(pO);Object.defineProperty(Yr,"__esModule",{value:!0});var ma=lO,DE=dO;const my=" ".repeat(2),$T=" ".repeat(4);function fO(){return UT(this)}function UT(e,t={}){const{maxRows:r=15,maxColumns:n=10,maxNumSize:i=8,padMinus:l="auto"}=t;return`${e.constructor.name} {
${my}[
${$T}${mO(e,r,n,i,l)}
${my}]
${my}rows: ${e.rows}
${my}columns: ${e.columns}
}`}function mO(e,t,r,n,i){const{rows:l,columns:h}=e,a=Math.min(l,t),g=Math.min(h,r),_=[];if(i==="auto"){i=!1;t:for(let E=0;E<a;E++)for(let S=0;S<g;S++)if(e.get(E,S)<0){i=!0;break t}}for(let E=0;E<a;E++){let S=[];for(let A=0;A<g;A++)S.push(gO(e.get(E,A),n,i));_.push(`${S.join(" ")}`)}return g!==h&&(_[_.length-1]+=` ... ${h-r} more columns`),a!==l&&_.push(`... ${l-t} more rows`),_.join(`
${$T}`)}function gO(e,t,r){return(e>=0&&r?` ${NE(e,t-1)}`:NE(e,t)).padEnd(t)}function NE(e,t){let r=e.toString();if(r.length<=t)return r;let n=e.toFixed(t);if(n.length>t&&(n=e.toFixed(Math.max(0,t-(n.length-t)))),n.length<=t&&!n.startsWith("0.000")&&!n.startsWith("-0.000"))return n;let i=e.toExponential(t);return i.length>t&&(i=e.toExponential(Math.max(0,t-(i.length-t)))),i.slice(0)}function yO(e,t){e.prototype.add=function(r){return typeof r=="number"?this.addS(r):this.addM(r)},e.prototype.addS=function(r){for(let n=0;n<this.rows;n++)for(let i=0;i<this.columns;i++)this.set(n,i,this.get(n,i)+r);return this},e.prototype.addM=function(r){if(r=t.checkMatrix(r),this.rows!==r.rows||this.columns!==r.columns)throw new RangeError("Matrices dimensions must be equal");for(let n=0;n<this.rows;n++)for(let i=0;i<this.columns;i++)this.set(n,i,this.get(n,i)+r.get(n,i));return this},e.add=function(r,n){return new t(r).add(n)},e.prototype.sub=function(r){return typeof r=="number"?this.subS(r):this.subM(r)},e.prototype.subS=function(r){for(let n=0;n<this.rows;n++)for(let i=0;i<this.columns;i++)this.set(n,i,this.get(n,i)-r);return this},e.prototype.subM=function(r){if(r=t.checkMatrix(r),this.rows!==r.rows||this.columns!==r.columns)throw new RangeError("Matrices dimensions must be equal");for(let n=0;n<this.rows;n++)for(let i=0;i<this.columns;i++)this.set(n,i,this.get(n,i)-r.get(n,i));return this},e.sub=function(r,n){return new t(r).sub(n)},e.prototype.subtract=e.prototype.sub,e.prototype.subtractS=e.prototype.subS,e.prototype.subtractM=e.prototype.subM,e.subtract=e.sub,e.prototype.mul=function(r){return typeof r=="number"?this.mulS(r):this.mulM(r)},e.prototype.mulS=function(r){for(let n=0;n<this.rows;n++)for(let i=0;i<this.columns;i++)this.set(n,i,this.get(n,i)*r);return this},e.prototype.mulM=function(r){if(r=t.checkMatrix(r),this.rows!==r.rows||this.columns!==r.columns)throw new RangeError("Matrices dimensions must be equal");for(let n=0;n<this.rows;n++)for(let i=0;i<this.columns;i++)this.set(n,i,this.get(n,i)*r.get(n,i));return this},e.mul=function(r,n){return new t(r).mul(n)},e.prototype.multiply=e.prototype.mul,e.prototype.multiplyS=e.prototype.mulS,e.prototype.multiplyM=e.prototype.mulM,e.multiply=e.mul,e.prototype.div=function(r){return typeof r=="number"?this.divS(r):this.divM(r)},e.prototype.divS=function(r){for(let n=0;n<this.rows;n++)for(let i=0;i<this.columns;i++)this.set(n,i,this.get(n,i)/r);return this},e.prototype.divM=function(r){if(r=t.checkMatrix(r),this.rows!==r.rows||this.columns!==r.columns)throw new RangeError("Matrices dimensions must be equal");for(let n=0;n<this.rows;n++)for(let i=0;i<this.columns;i++)this.set(n,i,this.get(n,i)/r.get(n,i));return this},e.div=function(r,n){return new t(r).div(n)},e.prototype.divide=e.prototype.div,e.prototype.divideS=e.prototype.divS,e.prototype.divideM=e.prototype.divM,e.divide=e.div,e.prototype.mod=function(r){return typeof r=="number"?this.modS(r):this.modM(r)},e.prototype.modS=function(r){for(let n=0;n<this.rows;n++)for(let i=0;i<this.columns;i++)this.set(n,i,this.get(n,i)%r);return this},e.prototype.modM=function(r){if(r=t.checkMatrix(r),this.rows!==r.rows||this.columns!==r.columns)throw new RangeError("Matrices dimensions must be equal");for(let n=0;n<this.rows;n++)for(let i=0;i<this.columns;i++)this.set(n,i,this.get(n,i)%r.get(n,i));return this},e.mod=function(r,n){return new t(r).mod(n)},e.prototype.modulus=e.prototype.mod,e.prototype.modulusS=e.prototype.modS,e.prototype.modulusM=e.prototype.modM,e.modulus=e.mod,e.prototype.and=function(r){return typeof r=="number"?this.andS(r):this.andM(r)},e.prototype.andS=function(r){for(let n=0;n<this.rows;n++)for(let i=0;i<this.columns;i++)this.set(n,i,this.get(n,i)&r);return this},e.prototype.andM=function(r){if(r=t.checkMatrix(r),this.rows!==r.rows||this.columns!==r.columns)throw new RangeError("Matrices dimensions must be equal");for(let n=0;n<this.rows;n++)for(let i=0;i<this.columns;i++)this.set(n,i,this.get(n,i)&r.get(n,i));return this},e.and=function(r,n){return new t(r).and(n)},e.prototype.or=function(r){return typeof r=="number"?this.orS(r):this.orM(r)},e.prototype.orS=function(r){for(let n=0;n<this.rows;n++)for(let i=0;i<this.columns;i++)this.set(n,i,this.get(n,i)|r);return this},e.prototype.orM=function(r){if(r=t.checkMatrix(r),this.rows!==r.rows||this.columns!==r.columns)throw new RangeError("Matrices dimensions must be equal");for(let n=0;n<this.rows;n++)for(let i=0;i<this.columns;i++)this.set(n,i,this.get(n,i)|r.get(n,i));return this},e.or=function(r,n){return new t(r).or(n)},e.prototype.xor=function(r){return typeof r=="number"?this.xorS(r):this.xorM(r)},e.prototype.xorS=function(r){for(let n=0;n<this.rows;n++)for(let i=0;i<this.columns;i++)this.set(n,i,this.get(n,i)^r);return this},e.prototype.xorM=function(r){if(r=t.checkMatrix(r),this.rows!==r.rows||this.columns!==r.columns)throw new RangeError("Matrices dimensions must be equal");for(let n=0;n<this.rows;n++)for(let i=0;i<this.columns;i++)this.set(n,i,this.get(n,i)^r.get(n,i));return this},e.xor=function(r,n){return new t(r).xor(n)},e.prototype.leftShift=function(r){return typeof r=="number"?this.leftShiftS(r):this.leftShiftM(r)},e.prototype.leftShiftS=function(r){for(let n=0;n<this.rows;n++)for(let i=0;i<this.columns;i++)this.set(n,i,this.get(n,i)<<r);return this},e.prototype.leftShiftM=function(r){if(r=t.checkMatrix(r),this.rows!==r.rows||this.columns!==r.columns)throw new RangeError("Matrices dimensions must be equal");for(let n=0;n<this.rows;n++)for(let i=0;i<this.columns;i++)this.set(n,i,this.get(n,i)<<r.get(n,i));return this},e.leftShift=function(r,n){return new t(r).leftShift(n)},e.prototype.signPropagatingRightShift=function(r){return typeof r=="number"?this.signPropagatingRightShiftS(r):this.signPropagatingRightShiftM(r)},e.prototype.signPropagatingRightShiftS=function(r){for(let n=0;n<this.rows;n++)for(let i=0;i<this.columns;i++)this.set(n,i,this.get(n,i)>>r);return this},e.prototype.signPropagatingRightShiftM=function(r){if(r=t.checkMatrix(r),this.rows!==r.rows||this.columns!==r.columns)throw new RangeError("Matrices dimensions must be equal");for(let n=0;n<this.rows;n++)for(let i=0;i<this.columns;i++)this.set(n,i,this.get(n,i)>>r.get(n,i));return this},e.signPropagatingRightShift=function(r,n){return new t(r).signPropagatingRightShift(n)},e.prototype.rightShift=function(r){return typeof r=="number"?this.rightShiftS(r):this.rightShiftM(r)},e.prototype.rightShiftS=function(r){for(let n=0;n<this.rows;n++)for(let i=0;i<this.columns;i++)this.set(n,i,this.get(n,i)>>>r);return this},e.prototype.rightShiftM=function(r){if(r=t.checkMatrix(r),this.rows!==r.rows||this.columns!==r.columns)throw new RangeError("Matrices dimensions must be equal");for(let n=0;n<this.rows;n++)for(let i=0;i<this.columns;i++)this.set(n,i,this.get(n,i)>>>r.get(n,i));return this},e.rightShift=function(r,n){return new t(r).rightShift(n)},e.prototype.zeroFillRightShift=e.prototype.rightShift,e.prototype.zeroFillRightShiftS=e.prototype.rightShiftS,e.prototype.zeroFillRightShiftM=e.prototype.rightShiftM,e.zeroFillRightShift=e.rightShift,e.prototype.not=function(){for(let r=0;r<this.rows;r++)for(let n=0;n<this.columns;n++)this.set(r,n,~this.get(r,n));return this},e.not=function(r){return new t(r).not()},e.prototype.abs=function(){for(let r=0;r<this.rows;r++)for(let n=0;n<this.columns;n++)this.set(r,n,Math.abs(this.get(r,n)));return this},e.abs=function(r){return new t(r).abs()},e.prototype.acos=function(){for(let r=0;r<this.rows;r++)for(let n=0;n<this.columns;n++)this.set(r,n,Math.acos(this.get(r,n)));return this},e.acos=function(r){return new t(r).acos()},e.prototype.acosh=function(){for(let r=0;r<this.rows;r++)for(let n=0;n<this.columns;n++)this.set(r,n,Math.acosh(this.get(r,n)));return this},e.acosh=function(r){return new t(r).acosh()},e.prototype.asin=function(){for(let r=0;r<this.rows;r++)for(let n=0;n<this.columns;n++)this.set(r,n,Math.asin(this.get(r,n)));return this},e.asin=function(r){return new t(r).asin()},e.prototype.asinh=function(){for(let r=0;r<this.rows;r++)for(let n=0;n<this.columns;n++)this.set(r,n,Math.asinh(this.get(r,n)));return this},e.asinh=function(r){return new t(r).asinh()},e.prototype.atan=function(){for(let r=0;r<this.rows;r++)for(let n=0;n<this.columns;n++)this.set(r,n,Math.atan(this.get(r,n)));return this},e.atan=function(r){return new t(r).atan()},e.prototype.atanh=function(){for(let r=0;r<this.rows;r++)for(let n=0;n<this.columns;n++)this.set(r,n,Math.atanh(this.get(r,n)));return this},e.atanh=function(r){return new t(r).atanh()},e.prototype.cbrt=function(){for(let r=0;r<this.rows;r++)for(let n=0;n<this.columns;n++)this.set(r,n,Math.cbrt(this.get(r,n)));return this},e.cbrt=function(r){return new t(r).cbrt()},e.prototype.ceil=function(){for(let r=0;r<this.rows;r++)for(let n=0;n<this.columns;n++)this.set(r,n,Math.ceil(this.get(r,n)));return this},e.ceil=function(r){return new t(r).ceil()},e.prototype.clz32=function(){for(let r=0;r<this.rows;r++)for(let n=0;n<this.columns;n++)this.set(r,n,Math.clz32(this.get(r,n)));return this},e.clz32=function(r){return new t(r).clz32()},e.prototype.cos=function(){for(let r=0;r<this.rows;r++)for(let n=0;n<this.columns;n++)this.set(r,n,Math.cos(this.get(r,n)));return this},e.cos=function(r){return new t(r).cos()},e.prototype.cosh=function(){for(let r=0;r<this.rows;r++)for(let n=0;n<this.columns;n++)this.set(r,n,Math.cosh(this.get(r,n)));return this},e.cosh=function(r){return new t(r).cosh()},e.prototype.exp=function(){for(let r=0;r<this.rows;r++)for(let n=0;n<this.columns;n++)this.set(r,n,Math.exp(this.get(r,n)));return this},e.exp=function(r){return new t(r).exp()},e.prototype.expm1=function(){for(let r=0;r<this.rows;r++)for(let n=0;n<this.columns;n++)this.set(r,n,Math.expm1(this.get(r,n)));return this},e.expm1=function(r){return new t(r).expm1()},e.prototype.floor=function(){for(let r=0;r<this.rows;r++)for(let n=0;n<this.columns;n++)this.set(r,n,Math.floor(this.get(r,n)));return this},e.floor=function(r){return new t(r).floor()},e.prototype.fround=function(){for(let r=0;r<this.rows;r++)for(let n=0;n<this.columns;n++)this.set(r,n,Math.fround(this.get(r,n)));return this},e.fround=function(r){return new t(r).fround()},e.prototype.log=function(){for(let r=0;r<this.rows;r++)for(let n=0;n<this.columns;n++)this.set(r,n,Math.log(this.get(r,n)));return this},e.log=function(r){return new t(r).log()},e.prototype.log1p=function(){for(let r=0;r<this.rows;r++)for(let n=0;n<this.columns;n++)this.set(r,n,Math.log1p(this.get(r,n)));return this},e.log1p=function(r){return new t(r).log1p()},e.prototype.log10=function(){for(let r=0;r<this.rows;r++)for(let n=0;n<this.columns;n++)this.set(r,n,Math.log10(this.get(r,n)));return this},e.log10=function(r){return new t(r).log10()},e.prototype.log2=function(){for(let r=0;r<this.rows;r++)for(let n=0;n<this.columns;n++)this.set(r,n,Math.log2(this.get(r,n)));return this},e.log2=function(r){return new t(r).log2()},e.prototype.round=function(){for(let r=0;r<this.rows;r++)for(let n=0;n<this.columns;n++)this.set(r,n,Math.round(this.get(r,n)));return this},e.round=function(r){return new t(r).round()},e.prototype.sign=function(){for(let r=0;r<this.rows;r++)for(let n=0;n<this.columns;n++)this.set(r,n,Math.sign(this.get(r,n)));return this},e.sign=function(r){return new t(r).sign()},e.prototype.sin=function(){for(let r=0;r<this.rows;r++)for(let n=0;n<this.columns;n++)this.set(r,n,Math.sin(this.get(r,n)));return this},e.sin=function(r){return new t(r).sin()},e.prototype.sinh=function(){for(let r=0;r<this.rows;r++)for(let n=0;n<this.columns;n++)this.set(r,n,Math.sinh(this.get(r,n)));return this},e.sinh=function(r){return new t(r).sinh()},e.prototype.sqrt=function(){for(let r=0;r<this.rows;r++)for(let n=0;n<this.columns;n++)this.set(r,n,Math.sqrt(this.get(r,n)));return this},e.sqrt=function(r){return new t(r).sqrt()},e.prototype.tan=function(){for(let r=0;r<this.rows;r++)for(let n=0;n<this.columns;n++)this.set(r,n,Math.tan(this.get(r,n)));return this},e.tan=function(r){return new t(r).tan()},e.prototype.tanh=function(){for(let r=0;r<this.rows;r++)for(let n=0;n<this.columns;n++)this.set(r,n,Math.tanh(this.get(r,n)));return this},e.tanh=function(r){return new t(r).tanh()},e.prototype.trunc=function(){for(let r=0;r<this.rows;r++)for(let n=0;n<this.columns;n++)this.set(r,n,Math.trunc(this.get(r,n)));return this},e.trunc=function(r){return new t(r).trunc()},e.pow=function(r,n){return new t(r).pow(n)},e.prototype.pow=function(r){return typeof r=="number"?this.powS(r):this.powM(r)},e.prototype.powS=function(r){for(let n=0;n<this.rows;n++)for(let i=0;i<this.columns;i++)this.set(n,i,Math.pow(this.get(n,i),r));return this},e.prototype.powM=function(r){if(r=t.checkMatrix(r),this.rows!==r.rows||this.columns!==r.columns)throw new RangeError("Matrices dimensions must be equal");for(let n=0;n<this.rows;n++)for(let i=0;i<this.columns;i++)this.set(n,i,Math.pow(this.get(n,i),r.get(n,i)));return this}}function _l(e,t,r){let n=r?e.rows:e.rows-1;if(t<0||t>n)throw new RangeError("Row index out of range")}function vl(e,t,r){let n=r?e.columns:e.columns-1;if(t<0||t>n)throw new RangeError("Column index out of range")}function Ld(e,t){if(t.to1DArray&&(t=t.to1DArray()),t.length!==e.columns)throw new RangeError("vector size must be the same as the number of columns");return t}function Rd(e,t){if(t.to1DArray&&(t=t.to1DArray()),t.length!==e.rows)throw new RangeError("vector size must be the same as the number of rows");return t}function Zx(e,t){if(!ma.isAnyArray(t))throw new TypeError("row indices must be an array");for(let r=0;r<t.length;r++)if(t[r]<0||t[r]>=e.rows)throw new RangeError("row indices are out of range")}function Wx(e,t){if(!ma.isAnyArray(t))throw new TypeError("column indices must be an array");for(let r=0;r<t.length;r++)if(t[r]<0||t[r]>=e.columns)throw new RangeError("column indices are out of range")}function nx(e,t,r,n,i){if(arguments.length!==5)throw new RangeError("expected 4 arguments");if(gy("startRow",t),gy("endRow",r),gy("startColumn",n),gy("endColumn",i),t>r||n>i||t<0||t>=e.rows||r<0||r>=e.rows||n<0||n>=e.columns||i<0||i>=e.columns)throw new RangeError("Submatrix indices are out of range")}function O_(e,t=0){let r=[];for(let n=0;n<e;n++)r.push(t);return r}function gy(e,t){if(typeof t!="number")throw new TypeError(`${e} must be a number`)}function Ed(e){if(e.isEmpty())throw new Error("Empty matrix has no elements to index")}function _O(e){let t=O_(e.rows);for(let r=0;r<e.rows;++r)for(let n=0;n<e.columns;++n)t[r]+=e.get(r,n);return t}function vO(e){let t=O_(e.columns);for(let r=0;r<e.rows;++r)for(let n=0;n<e.columns;++n)t[n]+=e.get(r,n);return t}function xO(e){let t=0;for(let r=0;r<e.rows;r++)for(let n=0;n<e.columns;n++)t+=e.get(r,n);return t}function bO(e){let t=O_(e.rows,1);for(let r=0;r<e.rows;++r)for(let n=0;n<e.columns;++n)t[r]*=e.get(r,n);return t}function wO(e){let t=O_(e.columns,1);for(let r=0;r<e.rows;++r)for(let n=0;n<e.columns;++n)t[n]*=e.get(r,n);return t}function EO(e){let t=1;for(let r=0;r<e.rows;r++)for(let n=0;n<e.columns;n++)t*=e.get(r,n);return t}function SO(e,t,r){const n=e.rows,i=e.columns,l=[];for(let h=0;h<n;h++){let a=0,g=0,_=0;for(let E=0;E<i;E++)_=e.get(h,E)-r[h],a+=_,g+=_*_;t?l.push((g-a*a/i)/(i-1)):l.push((g-a*a/i)/i)}return l}function TO(e,t,r){const n=e.rows,i=e.columns,l=[];for(let h=0;h<i;h++){let a=0,g=0,_=0;for(let E=0;E<n;E++)_=e.get(E,h)-r[h],a+=_,g+=_*_;t?l.push((g-a*a/n)/(n-1)):l.push((g-a*a/n)/n)}return l}function IO(e,t,r){const n=e.rows,i=e.columns,l=n*i;let h=0,a=0,g=0;for(let _=0;_<n;_++)for(let E=0;E<i;E++)g=e.get(_,E)-r,h+=g,a+=g*g;return t?(a-h*h/l)/(l-1):(a-h*h/l)/l}function CO(e,t){for(let r=0;r<e.rows;r++)for(let n=0;n<e.columns;n++)e.set(r,n,e.get(r,n)-t[r])}function MO(e,t){for(let r=0;r<e.rows;r++)for(let n=0;n<e.columns;n++)e.set(r,n,e.get(r,n)-t[n])}function PO(e,t){for(let r=0;r<e.rows;r++)for(let n=0;n<e.columns;n++)e.set(r,n,e.get(r,n)-t)}function AO(e){const t=[];for(let r=0;r<e.rows;r++){let n=0;for(let i=0;i<e.columns;i++)n+=Math.pow(e.get(r,i),2)/(e.columns-1);t.push(Math.sqrt(n))}return t}function LO(e,t){for(let r=0;r<e.rows;r++)for(let n=0;n<e.columns;n++)e.set(r,n,e.get(r,n)/t[r])}function RO(e){const t=[];for(let r=0;r<e.columns;r++){let n=0;for(let i=0;i<e.rows;i++)n+=Math.pow(e.get(i,r),2)/(e.rows-1);t.push(Math.sqrt(n))}return t}function DO(e,t){for(let r=0;r<e.rows;r++)for(let n=0;n<e.columns;n++)e.set(r,n,e.get(r,n)/t[n])}function NO(e){const t=e.size-1;let r=0;for(let n=0;n<e.columns;n++)for(let i=0;i<e.rows;i++)r+=Math.pow(e.get(i,n),2)/t;return Math.sqrt(r)}function kO(e,t){for(let r=0;r<e.rows;r++)for(let n=0;n<e.columns;n++)e.set(r,n,e.get(r,n)/t)}let Ai=class xo{static from1DArray(t,r,n){if(t*r!==n.length)throw new RangeError("data length does not match given dimensions");let i=new Le(t,r);for(let l=0;l<t;l++)for(let h=0;h<r;h++)i.set(l,h,n[l*r+h]);return i}static rowVector(t){let r=new Le(1,t.length);for(let n=0;n<t.length;n++)r.set(0,n,t[n]);return r}static columnVector(t){let r=new Le(t.length,1);for(let n=0;n<t.length;n++)r.set(n,0,t[n]);return r}static zeros(t,r){return new Le(t,r)}static ones(t,r){return new Le(t,r).fill(1)}static rand(t,r,n={}){if(typeof n!="object")throw new TypeError("options must be an object");const{random:i=Math.random}=n;let l=new Le(t,r);for(let h=0;h<t;h++)for(let a=0;a<r;a++)l.set(h,a,i());return l}static randInt(t,r,n={}){if(typeof n!="object")throw new TypeError("options must be an object");const{min:i=0,max:l=1e3,random:h=Math.random}=n;if(!Number.isInteger(i))throw new TypeError("min must be an integer");if(!Number.isInteger(l))throw new TypeError("max must be an integer");if(i>=l)throw new RangeError("min must be smaller than max");let a=l-i,g=new Le(t,r);for(let _=0;_<t;_++)for(let E=0;E<r;E++){let S=i+Math.round(h()*a);g.set(_,E,S)}return g}static eye(t,r,n){r===void 0&&(r=t),n===void 0&&(n=1);let i=Math.min(t,r),l=this.zeros(t,r);for(let h=0;h<i;h++)l.set(h,h,n);return l}static diag(t,r,n){let i=t.length;r===void 0&&(r=i),n===void 0&&(n=r);let l=Math.min(i,r,n),h=this.zeros(r,n);for(let a=0;a<l;a++)h.set(a,a,t[a]);return h}static min(t,r){t=this.checkMatrix(t),r=this.checkMatrix(r);let n=t.rows,i=t.columns,l=new Le(n,i);for(let h=0;h<n;h++)for(let a=0;a<i;a++)l.set(h,a,Math.min(t.get(h,a),r.get(h,a)));return l}static max(t,r){t=this.checkMatrix(t),r=this.checkMatrix(r);let n=t.rows,i=t.columns,l=new this(n,i);for(let h=0;h<n;h++)for(let a=0;a<i;a++)l.set(h,a,Math.max(t.get(h,a),r.get(h,a)));return l}static checkMatrix(t){return xo.isMatrix(t)?t:new Le(t)}static isMatrix(t){return t!=null&&t.klass==="Matrix"}get size(){return this.rows*this.columns}apply(t){if(typeof t!="function")throw new TypeError("callback must be a function");for(let r=0;r<this.rows;r++)for(let n=0;n<this.columns;n++)t.call(this,r,n);return this}to1DArray(){let t=[];for(let r=0;r<this.rows;r++)for(let n=0;n<this.columns;n++)t.push(this.get(r,n));return t}to2DArray(){let t=[];for(let r=0;r<this.rows;r++){t.push([]);for(let n=0;n<this.columns;n++)t[r].push(this.get(r,n))}return t}toJSON(){return this.to2DArray()}isRowVector(){return this.rows===1}isColumnVector(){return this.columns===1}isVector(){return this.rows===1||this.columns===1}isSquare(){return this.rows===this.columns}isEmpty(){return this.rows===0||this.columns===0}isSymmetric(){if(this.isSquare()){for(let t=0;t<this.rows;t++)for(let r=0;r<=t;r++)if(this.get(t,r)!==this.get(r,t))return!1;return!0}return!1}isDistance(){if(!this.isSymmetric())return!1;for(let t=0;t<this.rows;t++)if(this.get(t,t)!==0)return!1;return!0}isEchelonForm(){let t=0,r=0,n=-1,i=!0,l=!1;for(;t<this.rows&&i;){for(r=0,l=!1;r<this.columns&&l===!1;)this.get(t,r)===0?r++:this.get(t,r)===1&&r>n?(l=!0,n=r):(i=!1,l=!0);t++}return i}isReducedEchelonForm(){let t=0,r=0,n=-1,i=!0,l=!1;for(;t<this.rows&&i;){for(r=0,l=!1;r<this.columns&&l===!1;)this.get(t,r)===0?r++:this.get(t,r)===1&&r>n?(l=!0,n=r):(i=!1,l=!0);for(let h=r+1;h<this.rows;h++)this.get(t,h)!==0&&(i=!1);t++}return i}echelonForm(){let t=this.clone(),r=0,n=0;for(;r<t.rows&&n<t.columns;){let i=r;for(let l=r;l<t.rows;l++)t.get(l,n)>t.get(i,n)&&(i=l);if(t.get(i,n)===0)n++;else{t.swapRows(r,i);let l=t.get(r,n);for(let h=n;h<t.columns;h++)t.set(r,h,t.get(r,h)/l);for(let h=r+1;h<t.rows;h++){let a=t.get(h,n)/t.get(r,n);t.set(h,n,0);for(let g=n+1;g<t.columns;g++)t.set(h,g,t.get(h,g)-t.get(r,g)*a)}r++,n++}}return t}reducedEchelonForm(){let t=this.echelonForm(),r=t.columns,n=t.rows,i=n-1;for(;i>=0;)if(t.maxRow(i)===0)i--;else{let l=0,h=!1;for(;l<n&&h===!1;)t.get(i,l)===1?h=!0:l++;for(let a=0;a<i;a++){let g=t.get(a,l);for(let _=l;_<r;_++){let E=t.get(a,_)-g*t.get(i,_);t.set(a,_,E)}}i--}return t}set(){throw new Error("set method is unimplemented")}get(){throw new Error("get method is unimplemented")}repeat(t={}){if(typeof t!="object")throw new TypeError("options must be an object");const{rows:r=1,columns:n=1}=t;if(!Number.isInteger(r)||r<=0)throw new TypeError("rows must be a positive integer");if(!Number.isInteger(n)||n<=0)throw new TypeError("columns must be a positive integer");let i=new Le(this.rows*r,this.columns*n);for(let l=0;l<r;l++)for(let h=0;h<n;h++)i.setSubMatrix(this,this.rows*l,this.columns*h);return i}fill(t){for(let r=0;r<this.rows;r++)for(let n=0;n<this.columns;n++)this.set(r,n,t);return this}neg(){return this.mulS(-1)}getRow(t){_l(this,t);let r=[];for(let n=0;n<this.columns;n++)r.push(this.get(t,n));return r}getRowVector(t){return Le.rowVector(this.getRow(t))}setRow(t,r){_l(this,t),r=Ld(this,r);for(let n=0;n<this.columns;n++)this.set(t,n,r[n]);return this}swapRows(t,r){_l(this,t),_l(this,r);for(let n=0;n<this.columns;n++){let i=this.get(t,n);this.set(t,n,this.get(r,n)),this.set(r,n,i)}return this}getColumn(t){vl(this,t);let r=[];for(let n=0;n<this.rows;n++)r.push(this.get(n,t));return r}getColumnVector(t){return Le.columnVector(this.getColumn(t))}setColumn(t,r){vl(this,t),r=Rd(this,r);for(let n=0;n<this.rows;n++)this.set(n,t,r[n]);return this}swapColumns(t,r){vl(this,t),vl(this,r);for(let n=0;n<this.rows;n++){let i=this.get(n,t);this.set(n,t,this.get(n,r)),this.set(n,r,i)}return this}addRowVector(t){t=Ld(this,t);for(let r=0;r<this.rows;r++)for(let n=0;n<this.columns;n++)this.set(r,n,this.get(r,n)+t[n]);return this}subRowVector(t){t=Ld(this,t);for(let r=0;r<this.rows;r++)for(let n=0;n<this.columns;n++)this.set(r,n,this.get(r,n)-t[n]);return this}mulRowVector(t){t=Ld(this,t);for(let r=0;r<this.rows;r++)for(let n=0;n<this.columns;n++)this.set(r,n,this.get(r,n)*t[n]);return this}divRowVector(t){t=Ld(this,t);for(let r=0;r<this.rows;r++)for(let n=0;n<this.columns;n++)this.set(r,n,this.get(r,n)/t[n]);return this}addColumnVector(t){t=Rd(this,t);for(let r=0;r<this.rows;r++)for(let n=0;n<this.columns;n++)this.set(r,n,this.get(r,n)+t[r]);return this}subColumnVector(t){t=Rd(this,t);for(let r=0;r<this.rows;r++)for(let n=0;n<this.columns;n++)this.set(r,n,this.get(r,n)-t[r]);return this}mulColumnVector(t){t=Rd(this,t);for(let r=0;r<this.rows;r++)for(let n=0;n<this.columns;n++)this.set(r,n,this.get(r,n)*t[r]);return this}divColumnVector(t){t=Rd(this,t);for(let r=0;r<this.rows;r++)for(let n=0;n<this.columns;n++)this.set(r,n,this.get(r,n)/t[r]);return this}mulRow(t,r){_l(this,t);for(let n=0;n<this.columns;n++)this.set(t,n,this.get(t,n)*r);return this}mulColumn(t,r){vl(this,t);for(let n=0;n<this.rows;n++)this.set(n,t,this.get(n,t)*r);return this}max(t){if(this.isEmpty())return NaN;switch(t){case"row":{const r=new Array(this.rows).fill(Number.NEGATIVE_INFINITY);for(let n=0;n<this.rows;n++)for(let i=0;i<this.columns;i++)this.get(n,i)>r[n]&&(r[n]=this.get(n,i));return r}case"column":{const r=new Array(this.columns).fill(Number.NEGATIVE_INFINITY);for(let n=0;n<this.rows;n++)for(let i=0;i<this.columns;i++)this.get(n,i)>r[i]&&(r[i]=this.get(n,i));return r}case void 0:{let r=this.get(0,0);for(let n=0;n<this.rows;n++)for(let i=0;i<this.columns;i++)this.get(n,i)>r&&(r=this.get(n,i));return r}default:throw new Error(`invalid option: ${t}`)}}maxIndex(){Ed(this);let t=this.get(0,0),r=[0,0];for(let n=0;n<this.rows;n++)for(let i=0;i<this.columns;i++)this.get(n,i)>t&&(t=this.get(n,i),r[0]=n,r[1]=i);return r}min(t){if(this.isEmpty())return NaN;switch(t){case"row":{const r=new Array(this.rows).fill(Number.POSITIVE_INFINITY);for(let n=0;n<this.rows;n++)for(let i=0;i<this.columns;i++)this.get(n,i)<r[n]&&(r[n]=this.get(n,i));return r}case"column":{const r=new Array(this.columns).fill(Number.POSITIVE_INFINITY);for(let n=0;n<this.rows;n++)for(let i=0;i<this.columns;i++)this.get(n,i)<r[i]&&(r[i]=this.get(n,i));return r}case void 0:{let r=this.get(0,0);for(let n=0;n<this.rows;n++)for(let i=0;i<this.columns;i++)this.get(n,i)<r&&(r=this.get(n,i));return r}default:throw new Error(`invalid option: ${t}`)}}minIndex(){Ed(this);let t=this.get(0,0),r=[0,0];for(let n=0;n<this.rows;n++)for(let i=0;i<this.columns;i++)this.get(n,i)<t&&(t=this.get(n,i),r[0]=n,r[1]=i);return r}maxRow(t){if(_l(this,t),this.isEmpty())return NaN;let r=this.get(t,0);for(let n=1;n<this.columns;n++)this.get(t,n)>r&&(r=this.get(t,n));return r}maxRowIndex(t){_l(this,t),Ed(this);let r=this.get(t,0),n=[t,0];for(let i=1;i<this.columns;i++)this.get(t,i)>r&&(r=this.get(t,i),n[1]=i);return n}minRow(t){if(_l(this,t),this.isEmpty())return NaN;let r=this.get(t,0);for(let n=1;n<this.columns;n++)this.get(t,n)<r&&(r=this.get(t,n));return r}minRowIndex(t){_l(this,t),Ed(this);let r=this.get(t,0),n=[t,0];for(let i=1;i<this.columns;i++)this.get(t,i)<r&&(r=this.get(t,i),n[1]=i);return n}maxColumn(t){if(vl(this,t),this.isEmpty())return NaN;let r=this.get(0,t);for(let n=1;n<this.rows;n++)this.get(n,t)>r&&(r=this.get(n,t));return r}maxColumnIndex(t){vl(this,t),Ed(this);let r=this.get(0,t),n=[0,t];for(let i=1;i<this.rows;i++)this.get(i,t)>r&&(r=this.get(i,t),n[0]=i);return n}minColumn(t){if(vl(this,t),this.isEmpty())return NaN;let r=this.get(0,t);for(let n=1;n<this.rows;n++)this.get(n,t)<r&&(r=this.get(n,t));return r}minColumnIndex(t){vl(this,t),Ed(this);let r=this.get(0,t),n=[0,t];for(let i=1;i<this.rows;i++)this.get(i,t)<r&&(r=this.get(i,t),n[0]=i);return n}diag(){let t=Math.min(this.rows,this.columns),r=[];for(let n=0;n<t;n++)r.push(this.get(n,n));return r}norm(t="frobenius"){switch(t){case"max":return this.max();case"frobenius":return Math.sqrt(this.dot(this));default:throw new RangeError(`unknown norm type: ${t}`)}}cumulativeSum(){let t=0;for(let r=0;r<this.rows;r++)for(let n=0;n<this.columns;n++)t+=this.get(r,n),this.set(r,n,t);return this}dot(t){xo.isMatrix(t)&&(t=t.to1DArray());let r=this.to1DArray();if(r.length!==t.length)throw new RangeError("vectors do not have the same size");let n=0;for(let i=0;i<r.length;i++)n+=r[i]*t[i];return n}mmul(t){t=Le.checkMatrix(t);let r=this.rows,n=this.columns,i=t.columns,l=new Le(r,i),h=new Float64Array(n);for(let a=0;a<i;a++){for(let g=0;g<n;g++)h[g]=t.get(g,a);for(let g=0;g<r;g++){let _=0;for(let E=0;E<n;E++)_+=this.get(g,E)*h[E];l.set(g,a,_)}}return l}strassen2x2(t){t=Le.checkMatrix(t);let r=new Le(2,2);const n=this.get(0,0),i=t.get(0,0),l=this.get(0,1),h=t.get(0,1),a=this.get(1,0),g=t.get(1,0),_=this.get(1,1),E=t.get(1,1),S=(n+_)*(i+E),A=(a+_)*i,O=n*(h-E),k=_*(g-i),G=(n+l)*E,W=(a-n)*(i+h),U=(l-_)*(g+E),tt=S+k-G+U,$=O+G,V=A+k,it=S-A+O+W;return r.set(0,0,tt),r.set(0,1,$),r.set(1,0,V),r.set(1,1,it),r}strassen3x3(t){t=Le.checkMatrix(t);let r=new Le(3,3);const n=this.get(0,0),i=this.get(0,1),l=this.get(0,2),h=this.get(1,0),a=this.get(1,1),g=this.get(1,2),_=this.get(2,0),E=this.get(2,1),S=this.get(2,2),A=t.get(0,0),O=t.get(0,1),k=t.get(0,2),G=t.get(1,0),W=t.get(1,1),U=t.get(1,2),tt=t.get(2,0),$=t.get(2,1),V=t.get(2,2),it=(n+i+l-h-a-E-S)*W,vt=(n-h)*(-O+W),ot=a*(-A+O+G-W-U-tt+V),et=(-n+h+a)*(A-O+W),wt=(h+a)*(-A+O),J=n*A,xt=(-n+_+E)*(A-k+U),$t=(-n+_)*(k-U),Ut=(_+E)*(-A+k),Ot=(n+i+l-a-g-_-E)*U,te=E*(-A+k+G-W-U-tt+$),ye=(-l+E+S)*(W+tt-$),Me=(l-S)*(W-$),ir=l*tt,xr=(E+S)*(-tt+$),_r=(-l+a+g)*(U+tt-V),kr=(l-g)*(U-V),vr=(a+g)*(-tt+V),ue=i*G,nr=g*$,br=h*k,jr=_*O,ln=S*V,co=J+ir+ue,hn=it+et+wt+J+ye+ir+xr,Ye=J+xt+Ut+Ot+ir+_r+vr,na=vt+ot+et+J+ir+_r+kr,ls=vt+et+wt+J+nr,Io=ir+_r+kr+vr+br,cr=J+xt+$t+te+ye+Me+ir,pn=ye+Me+ir+xr+jr,Re=J+xt+$t+Ut+ln;return r.set(0,0,co),r.set(0,1,hn),r.set(0,2,Ye),r.set(1,0,na),r.set(1,1,ls),r.set(1,2,Io),r.set(2,0,cr),r.set(2,1,pn),r.set(2,2,Re),r}mmulStrassen(t){t=Le.checkMatrix(t);let r=this.clone(),n=r.rows,i=r.columns,l=t.rows,h=t.columns;i!==l&&console.warn(`Multiplying ${n} x ${i} and ${l} x ${h} matrix: dimensions do not match.`);function a(S,A,O){let k=S.rows,G=S.columns;if(k===A&&G===O)return S;{let W=xo.zeros(A,O);return W=W.setSubMatrix(S,0,0),W}}let g=Math.max(n,l),_=Math.max(i,h);r=a(r,g,_),t=a(t,g,_);function E(S,A,O,k){if(O<=512||k<=512)return S.mmul(A);O%2===1&&k%2===1?(S=a(S,O+1,k+1),A=a(A,O+1,k+1)):O%2===1?(S=a(S,O+1,k),A=a(A,O+1,k)):k%2===1&&(S=a(S,O,k+1),A=a(A,O,k+1));let G=parseInt(S.rows/2,10),W=parseInt(S.columns/2,10),U=S.subMatrix(0,G-1,0,W-1),tt=A.subMatrix(0,G-1,0,W-1),$=S.subMatrix(0,G-1,W,S.columns-1),V=A.subMatrix(0,G-1,W,A.columns-1),it=S.subMatrix(G,S.rows-1,0,W-1),vt=A.subMatrix(G,A.rows-1,0,W-1),ot=S.subMatrix(G,S.rows-1,W,S.columns-1),et=A.subMatrix(G,A.rows-1,W,A.columns-1),wt=E(xo.add(U,ot),xo.add(tt,et),G,W),J=E(xo.add(it,ot),tt,G,W),xt=E(U,xo.sub(V,et),G,W),$t=E(ot,xo.sub(vt,tt),G,W),Ut=E(xo.add(U,$),et,G,W),Ot=E(xo.sub(it,U),xo.add(tt,V),G,W),te=E(xo.sub($,ot),xo.add(vt,et),G,W),ye=xo.add(wt,$t);ye.sub(Ut),ye.add(te);let Me=xo.add(xt,Ut),ir=xo.add(J,$t),xr=xo.sub(wt,J);xr.add(xt),xr.add(Ot);let _r=xo.zeros(2*ye.rows,2*ye.columns);return _r=_r.setSubMatrix(ye,0,0),_r=_r.setSubMatrix(Me,ye.rows,0),_r=_r.setSubMatrix(ir,0,ye.columns),_r=_r.setSubMatrix(xr,ye.rows,ye.columns),_r.subMatrix(0,O-1,0,k-1)}return E(r,t,g,_)}scaleRows(t={}){if(typeof t!="object")throw new TypeError("options must be an object");const{min:r=0,max:n=1}=t;if(!Number.isFinite(r))throw new TypeError("min must be a number");if(!Number.isFinite(n))throw new TypeError("max must be a number");if(r>=n)throw new RangeError("min must be smaller than max");let i=new Le(this.rows,this.columns);for(let l=0;l<this.rows;l++){const h=this.getRow(l);h.length>0&&DE(h,{min:r,max:n,output:h}),i.setRow(l,h)}return i}scaleColumns(t={}){if(typeof t!="object")throw new TypeError("options must be an object");const{min:r=0,max:n=1}=t;if(!Number.isFinite(r))throw new TypeError("min must be a number");if(!Number.isFinite(n))throw new TypeError("max must be a number");if(r>=n)throw new RangeError("min must be smaller than max");let i=new Le(this.rows,this.columns);for(let l=0;l<this.columns;l++){const h=this.getColumn(l);h.length&&DE(h,{min:r,max:n,output:h}),i.setColumn(l,h)}return i}flipRows(){const t=Math.ceil(this.columns/2);for(let r=0;r<this.rows;r++)for(let n=0;n<t;n++){let i=this.get(r,n),l=this.get(r,this.columns-1-n);this.set(r,n,l),this.set(r,this.columns-1-n,i)}return this}flipColumns(){const t=Math.ceil(this.rows/2);for(let r=0;r<this.columns;r++)for(let n=0;n<t;n++){let i=this.get(n,r),l=this.get(this.rows-1-n,r);this.set(n,r,l),this.set(this.rows-1-n,r,i)}return this}kroneckerProduct(t){t=Le.checkMatrix(t);let r=this.rows,n=this.columns,i=t.rows,l=t.columns,h=new Le(r*i,n*l);for(let a=0;a<r;a++)for(let g=0;g<n;g++)for(let _=0;_<i;_++)for(let E=0;E<l;E++)h.set(i*a+_,l*g+E,this.get(a,g)*t.get(_,E));return h}kroneckerSum(t){if(t=Le.checkMatrix(t),!this.isSquare()||!t.isSquare())throw new Error("Kronecker Sum needs two Square Matrices");let r=this.rows,n=t.rows,i=this.kroneckerProduct(Le.eye(n,n)),l=Le.eye(r,r).kroneckerProduct(t);return i.add(l)}transpose(){let t=new Le(this.columns,this.rows);for(let r=0;r<this.rows;r++)for(let n=0;n<this.columns;n++)t.set(n,r,this.get(r,n));return t}sortRows(t=kE){for(let r=0;r<this.rows;r++)this.setRow(r,this.getRow(r).sort(t));return this}sortColumns(t=kE){for(let r=0;r<this.columns;r++)this.setColumn(r,this.getColumn(r).sort(t));return this}subMatrix(t,r,n,i){nx(this,t,r,n,i);let l=new Le(r-t+1,i-n+1);for(let h=t;h<=r;h++)for(let a=n;a<=i;a++)l.set(h-t,a-n,this.get(h,a));return l}subMatrixRow(t,r,n){if(r===void 0&&(r=0),n===void 0&&(n=this.columns-1),r>n||r<0||r>=this.columns||n<0||n>=this.columns)throw new RangeError("Argument out of range");let i=new Le(t.length,n-r+1);for(let l=0;l<t.length;l++)for(let h=r;h<=n;h++){if(t[l]<0||t[l]>=this.rows)throw new RangeError(`Row index out of range: ${t[l]}`);i.set(l,h-r,this.get(t[l],h))}return i}subMatrixColumn(t,r,n){if(r===void 0&&(r=0),n===void 0&&(n=this.rows-1),r>n||r<0||r>=this.rows||n<0||n>=this.rows)throw new RangeError("Argument out of range");let i=new Le(n-r+1,t.length);for(let l=0;l<t.length;l++)for(let h=r;h<=n;h++){if(t[l]<0||t[l]>=this.columns)throw new RangeError(`Column index out of range: ${t[l]}`);i.set(h-r,l,this.get(h,t[l]))}return i}setSubMatrix(t,r,n){if(t=Le.checkMatrix(t),t.isEmpty())return this;let i=r+t.rows-1,l=n+t.columns-1;nx(this,r,i,n,l);for(let h=0;h<t.rows;h++)for(let a=0;a<t.columns;a++)this.set(r+h,n+a,t.get(h,a));return this}selection(t,r){Zx(this,t),Wx(this,r);let n=new Le(t.length,r.length);for(let i=0;i<t.length;i++){let l=t[i];for(let h=0;h<r.length;h++){let a=r[h];n.set(i,h,this.get(l,a))}}return n}trace(){let t=Math.min(this.rows,this.columns),r=0;for(let n=0;n<t;n++)r+=this.get(n,n);return r}clone(){return this.constructor.copy(this,new Le(this.rows,this.columns))}static copy(t,r){for(const[n,i,l]of t.entries())r.set(n,i,l);return r}sum(t){switch(t){case"row":return _O(this);case"column":return vO(this);case void 0:return xO(this);default:throw new Error(`invalid option: ${t}`)}}product(t){switch(t){case"row":return bO(this);case"column":return wO(this);case void 0:return EO(this);default:throw new Error(`invalid option: ${t}`)}}mean(t){const r=this.sum(t);switch(t){case"row":{for(let n=0;n<this.rows;n++)r[n]/=this.columns;return r}case"column":{for(let n=0;n<this.columns;n++)r[n]/=this.rows;return r}case void 0:return r/this.size;default:throw new Error(`invalid option: ${t}`)}}variance(t,r={}){if(typeof t=="object"&&(r=t,t=void 0),typeof r!="object")throw new TypeError("options must be an object");const{unbiased:n=!0,mean:i=this.mean(t)}=r;if(typeof n!="boolean")throw new TypeError("unbiased must be a boolean");switch(t){case"row":{if(!ma.isAnyArray(i))throw new TypeError("mean must be an array");return SO(this,n,i)}case"column":{if(!ma.isAnyArray(i))throw new TypeError("mean must be an array");return TO(this,n,i)}case void 0:{if(typeof i!="number")throw new TypeError("mean must be a number");return IO(this,n,i)}default:throw new Error(`invalid option: ${t}`)}}standardDeviation(t,r){typeof t=="object"&&(r=t,t=void 0);const n=this.variance(t,r);if(t===void 0)return Math.sqrt(n);for(let i=0;i<n.length;i++)n[i]=Math.sqrt(n[i]);return n}center(t,r={}){if(typeof t=="object"&&(r=t,t=void 0),typeof r!="object")throw new TypeError("options must be an object");const{center:n=this.mean(t)}=r;switch(t){case"row":{if(!ma.isAnyArray(n))throw new TypeError("center must be an array");return CO(this,n),this}case"column":{if(!ma.isAnyArray(n))throw new TypeError("center must be an array");return MO(this,n),this}case void 0:{if(typeof n!="number")throw new TypeError("center must be a number");return PO(this,n),this}default:throw new Error(`invalid option: ${t}`)}}scale(t,r={}){if(typeof t=="object"&&(r=t,t=void 0),typeof r!="object")throw new TypeError("options must be an object");let n=r.scale;switch(t){case"row":{if(n===void 0)n=AO(this);else if(!ma.isAnyArray(n))throw new TypeError("scale must be an array");return LO(this,n),this}case"column":{if(n===void 0)n=RO(this);else if(!ma.isAnyArray(n))throw new TypeError("scale must be an array");return DO(this,n),this}case void 0:{if(n===void 0)n=NO(this);else if(typeof n!="number")throw new TypeError("scale must be a number");return kO(this,n),this}default:throw new Error(`invalid option: ${t}`)}}toString(t){return UT(this,t)}[Symbol.iterator](){return this.entries()}*entries(){for(let t=0;t<this.rows;t++)for(let r=0;r<this.columns;r++)yield[t,r,this.get(t,r)]}*values(){for(let t=0;t<this.rows;t++)for(let r=0;r<this.columns;r++)yield this.get(t,r)}};Ai.prototype.klass="Matrix";typeof Symbol<"u"&&(Ai.prototype[Symbol.for("nodejs.util.inspect.custom")]=fO);function kE(e,t){return e-t}function OO(e){return e.every(t=>typeof t=="number")}Ai.random=Ai.rand;Ai.randomInt=Ai.randInt;Ai.diagonal=Ai.diag;Ai.prototype.diagonal=Ai.prototype.diag;Ai.identity=Ai.eye;Ai.prototype.negate=Ai.prototype.neg;Ai.prototype.tensorProduct=Ai.prototype.kroneckerProduct;var yy,lv,_y;let Le=(_y=class extends Ai{constructor(e,t){if(super(),VS(this,yy),Nt(this,"data"),_y.isMatrix(e))hE(this,yy,lv).call(this,e.rows,e.columns),_y.copy(e,this);else if(Number.isInteger(e)&&e>=0)hE(this,yy,lv).call(this,e,t);else if(ma.isAnyArray(e)){const r=e;if(e=r.length,t=e?r[0].length:0,typeof t!="number")throw new TypeError("Data must be a 2D array with at least one element");this.data=[];for(let n=0;n<e;n++){if(r[n].length!==t)throw new RangeError("Inconsistent array dimensions");if(!OO(r[n]))throw new TypeError("Input data contains non-numeric values");this.data.push(Float64Array.from(r[n]))}this.rows=e,this.columns=t}else throw new TypeError("First argument must be a positive number or an array")}set(e,t,r){return this.data[e][t]=r,this}get(e,t){return this.data[e][t]}removeRow(e){return _l(this,e),this.data.splice(e,1),this.rows-=1,this}addRow(e,t){return t===void 0&&(t=e,e=this.rows),_l(this,e,!0),t=Float64Array.from(Ld(this,t)),this.data.splice(e,0,t),this.rows+=1,this}removeColumn(e){vl(this,e);for(let t=0;t<this.rows;t++){const r=new Float64Array(this.columns-1);for(let n=0;n<e;n++)r[n]=this.data[t][n];for(let n=e+1;n<this.columns;n++)r[n-1]=this.data[t][n];this.data[t]=r}return this.columns-=1,this}addColumn(e,t){typeof t>"u"&&(t=e,e=this.columns),vl(this,e,!0),t=Rd(this,t);for(let r=0;r<this.rows;r++){const n=new Float64Array(this.columns+1);let i=0;for(;i<e;i++)n[i]=this.data[r][i];for(n[i++]=t[r];i<this.columns+1;i++)n[i]=this.data[r][i-1];this.data[r]=n}return this.columns+=1,this}},yy=new WeakSet,lv=function(e,t){if(this.data=[],Number.isInteger(t)&&t>=0)for(let r=0;r<e;r++)this.data.push(new Float64Array(t));else throw new TypeError("nColumns must be a positive integer");this.rows=e,this.columns=t},_y);yO(Ai,Le);var Gs;const FO=class ix extends Ai{constructor(t){if(super(),VS(this,Gs,void 0),Le.isMatrix(t)){if(!t.isSymmetric())throw new TypeError("not symmetric data");iv(this,Gs,Le.copy(t,new Le(t.rows,t.rows)))}else if(Number.isInteger(t)&&t>=0)iv(this,Gs,new Le(t,t));else if(iv(this,Gs,new Le(t)),!this.isSymmetric())throw new TypeError("not symmetric data")}get size(){return Du(this,Gs).size}get rows(){return Du(this,Gs).rows}get columns(){return Du(this,Gs).columns}get diagonalSize(){return this.rows}static isSymmetricMatrix(t){return Le.isMatrix(t)&&t.klassType==="SymmetricMatrix"}static zeros(t){return new this(t)}static ones(t){return new this(t).fill(1)}clone(){const t=new ix(this.diagonalSize);for(const[r,n,i]of this.upperRightEntries())t.set(r,n,i);return t}toMatrix(){return new Le(this)}get(t,r){return Du(this,Gs).get(t,r)}set(t,r,n){return Du(this,Gs).set(t,r,n),Du(this,Gs).set(r,t,n),this}removeCross(t){return Du(this,Gs).removeRow(t),Du(this,Gs).removeColumn(t),this}addCross(t,r){r===void 0&&(r=t,t=this.diagonalSize);const n=r.slice();return n.splice(t,1),Du(this,Gs).addRow(t,n),Du(this,Gs).addColumn(t,r),this}applyMask(t){if(t.length!==this.diagonalSize)throw new RangeError("Mask size do not match with matrix size");const r=[];for(const[n,i]of t.entries())i||r.push(n);r.reverse();for(const n of r)this.removeCross(n);return this}toCompact(){const{diagonalSize:t}=this,r=new Array(t*(t+1)/2);for(let n=0,i=0,l=0;l<r.length;l++)r[l]=this.get(i,n),++n>=t&&(n=++i);return r}static fromCompact(t){const r=t.length,n=(Math.sqrt(8*r+1)-1)/2;if(!Number.isInteger(n))throw new TypeError(`This array is not a compact representation of a Symmetric Matrix, ${JSON.stringify(t)}`);const i=new ix(n);for(let l=0,h=0,a=0;a<r;a++)i.set(l,h,t[a]),++l>=n&&(l=++h);return i}*upperRightEntries(){for(let t=0,r=0;t<this.diagonalSize;void 0){const n=this.get(t,r);yield[t,r,n],++r>=this.diagonalSize&&(r=++t)}}*upperRightValues(){for(let t=0,r=0;t<this.diagonalSize;void 0)yield this.get(t,r),++r>=this.diagonalSize&&(r=++t)}};Gs=new WeakMap;let Sm=FO;Sm.prototype.klassType="SymmetricMatrix";let jT=class VT extends Sm{static isDistanceMatrix(t){return Sm.isSymmetricMatrix(t)&&t.klassSubType==="DistanceMatrix"}constructor(t){if(super(t),!this.isDistance())throw new TypeError("Provided arguments do no produce a distance matrix")}set(t,r,n){return t===r&&(n=0),super.set(t,r,n)}addCross(t,r){return r===void 0&&(r=t,t=this.diagonalSize),r=r.slice(),r[t]=0,super.addCross(t,r)}toSymmetricMatrix(){return new Sm(this)}clone(){const t=new VT(this.diagonalSize);for(const[r,n,i]of this.upperRightEntries())r!==n&&t.set(r,n,i);return t}toCompact(){const{diagonalSize:t}=this,r=(t-1)*t/2,n=new Array(r);for(let i=1,l=0,h=0;h<n.length;h++)n[h]=this.get(l,i),++i>=t&&(i=++l+1);return n}static fromCompact(t){const r=t.length,n=(Math.sqrt(8*r+1)+1)/2;if(!Number.isInteger(n))throw new TypeError(`This array is not a compact representation of a DistanceMatrix, ${JSON.stringify(t)}`);const i=new this(n);for(let l=1,h=0,a=0;a<r;a++)i.set(l,h,t[a]),++l>=n&&(l=++h+1);return i}};jT.prototype.klassSubType="DistanceMatrix";let Qc=class extends Ai{constructor(t,r,n){super(),this.matrix=t,this.rows=r,this.columns=n}};class zO extends Qc{constructor(t,r){vl(t,r),super(t,t.rows,1),this.column=r}set(t,r,n){return this.matrix.set(t,this.column,n),this}get(t){return this.matrix.get(t,this.column)}}class BO extends Qc{constructor(t,r){Wx(t,r),super(t,t.rows,r.length),this.columnIndices=r}set(t,r,n){return this.matrix.set(t,this.columnIndices[r],n),this}get(t,r){return this.matrix.get(t,this.columnIndices[r])}}class $O extends Qc{constructor(t){super(t,t.rows,t.columns)}set(t,r,n){return this.matrix.set(t,this.columns-r-1,n),this}get(t,r){return this.matrix.get(t,this.columns-r-1)}}class UO extends Qc{constructor(t){super(t,t.rows,t.columns)}set(t,r,n){return this.matrix.set(this.rows-t-1,r,n),this}get(t,r){return this.matrix.get(this.rows-t-1,r)}}class jO extends Qc{constructor(t,r){_l(t,r),super(t,1,t.columns),this.row=r}set(t,r,n){return this.matrix.set(this.row,r,n),this}get(t,r){return this.matrix.get(this.row,r)}}class VO extends Qc{constructor(t,r){Zx(t,r),super(t,r.length,t.columns),this.rowIndices=r}set(t,r,n){return this.matrix.set(this.rowIndices[t],r,n),this}get(t,r){return this.matrix.get(this.rowIndices[t],r)}}let Uy=class extends Qc{constructor(t,r,n){Zx(t,r),Wx(t,n),super(t,r.length,n.length),this.rowIndices=r,this.columnIndices=n}set(t,r,n){return this.matrix.set(this.rowIndices[t],this.columnIndices[r],n),this}get(t,r){return this.matrix.get(this.rowIndices[t],this.columnIndices[r])}};class GO extends Qc{constructor(t,r,n,i,l){nx(t,r,n,i,l),super(t,n-r+1,l-i+1),this.startRow=r,this.startColumn=i}set(t,r,n){return this.matrix.set(this.startRow+t,this.startColumn+r,n),this}get(t,r){return this.matrix.get(this.startRow+t,this.startColumn+r)}}class qO extends Qc{constructor(t){super(t,t.columns,t.rows)}set(t,r,n){return this.matrix.set(r,t,n),this}get(t,r){return this.matrix.get(r,t)}}let GT=class extends Ai{constructor(t,r={}){const{rows:n=1}=r;if(t.length%n!==0)throw new Error("the data length is not divisible by the number of rows");super(),this.rows=n,this.columns=t.length/n,this.data=t}set(t,r,n){let i=this._calculateIndex(t,r);return this.data[i]=n,this}get(t,r){let n=this._calculateIndex(t,r);return this.data[n]}_calculateIndex(t,r){return t*this.columns+r}},ja=class extends Ai{constructor(e){super(),this.data=e,this.rows=e.length,this.columns=e[0].length}set(e,t,r){return this.data[e][t]=r,this}get(e,t){return this.data[e][t]}};function ZO(e,t){if(ma.isAnyArray(e))return e[0]&&ma.isAnyArray(e[0])?new ja(e):new GT(e,t);throw new Error("the argument is not an array")}let F_=class{constructor(t){t=ja.checkMatrix(t);let r=t.clone(),n=r.rows,i=r.columns,l=new Float64Array(n),h=1,a,g,_,E,S,A,O,k,G;for(a=0;a<n;a++)l[a]=a;for(k=new Float64Array(n),g=0;g<i;g++){for(a=0;a<n;a++)k[a]=r.get(a,g);for(a=0;a<n;a++){for(G=Math.min(a,g),S=0,_=0;_<G;_++)S+=r.get(a,_)*k[_];k[a]-=S,r.set(a,g,k[a])}for(E=g,a=g+1;a<n;a++)Math.abs(k[a])>Math.abs(k[E])&&(E=a);if(E!==g){for(_=0;_<i;_++)A=r.get(E,_),r.set(E,_,r.get(g,_)),r.set(g,_,A);O=l[E],l[E]=l[g],l[g]=O,h=-h}if(g<n&&r.get(g,g)!==0)for(a=g+1;a<n;a++)r.set(a,g,r.get(a,g)/r.get(g,g))}this.LU=r,this.pivotVector=l,this.pivotSign=h}isSingular(){let t=this.LU,r=t.columns;for(let n=0;n<r;n++)if(t.get(n,n)===0)return!0;return!1}solve(t){t=Le.checkMatrix(t);let r=this.LU;if(r.rows!==t.rows)throw new Error("Invalid matrix dimensions");if(this.isSingular())throw new Error("LU matrix is singular");let n=t.columns,i=t.subMatrixRow(this.pivotVector,0,n-1),l=r.columns,h,a,g;for(g=0;g<l;g++)for(h=g+1;h<l;h++)for(a=0;a<n;a++)i.set(h,a,i.get(h,a)-i.get(g,a)*r.get(h,g));for(g=l-1;g>=0;g--){for(a=0;a<n;a++)i.set(g,a,i.get(g,a)/r.get(g,g));for(h=0;h<g;h++)for(a=0;a<n;a++)i.set(h,a,i.get(h,a)-i.get(g,a)*r.get(h,g))}return i}get determinant(){let t=this.LU;if(!t.isSquare())throw new Error("Matrix must be square");let r=this.pivotSign,n=t.columns;for(let i=0;i<n;i++)r*=t.get(i,i);return r}get lowerTriangularMatrix(){let t=this.LU,r=t.rows,n=t.columns,i=new Le(r,n);for(let l=0;l<r;l++)for(let h=0;h<n;h++)l>h?i.set(l,h,t.get(l,h)):l===h?i.set(l,h,1):i.set(l,h,0);return i}get upperTriangularMatrix(){let t=this.LU,r=t.rows,n=t.columns,i=new Le(r,n);for(let l=0;l<r;l++)for(let h=0;h<n;h++)l<=h?i.set(l,h,t.get(l,h)):i.set(l,h,0);return i}get pivotPermutationVector(){return Array.from(this.pivotVector)}};function Rc(e,t){let r=0;return Math.abs(e)>Math.abs(t)?(r=t/e,Math.abs(e)*Math.sqrt(1+r*r)):t!==0?(r=e/t,Math.abs(t)*Math.sqrt(1+r*r)):0}let Xx=class{constructor(t){t=ja.checkMatrix(t);let r=t.clone(),n=t.rows,i=t.columns,l=new Float64Array(i),h,a,g,_;for(g=0;g<i;g++){let E=0;for(h=g;h<n;h++)E=Rc(E,r.get(h,g));if(E!==0){for(r.get(g,g)<0&&(E=-E),h=g;h<n;h++)r.set(h,g,r.get(h,g)/E);for(r.set(g,g,r.get(g,g)+1),a=g+1;a<i;a++){for(_=0,h=g;h<n;h++)_+=r.get(h,g)*r.get(h,a);for(_=-_/r.get(g,g),h=g;h<n;h++)r.set(h,a,r.get(h,a)+_*r.get(h,g))}}l[g]=-E}this.QR=r,this.Rdiag=l}solve(t){t=Le.checkMatrix(t);let r=this.QR,n=r.rows;if(t.rows!==n)throw new Error("Matrix row dimensions must agree");if(!this.isFullRank())throw new Error("Matrix is rank deficient");let i=t.columns,l=t.clone(),h=r.columns,a,g,_,E;for(_=0;_<h;_++)for(g=0;g<i;g++){for(E=0,a=_;a<n;a++)E+=r.get(a,_)*l.get(a,g);for(E=-E/r.get(_,_),a=_;a<n;a++)l.set(a,g,l.get(a,g)+E*r.get(a,_))}for(_=h-1;_>=0;_--){for(g=0;g<i;g++)l.set(_,g,l.get(_,g)/this.Rdiag[_]);for(a=0;a<_;a++)for(g=0;g<i;g++)l.set(a,g,l.get(a,g)-l.get(_,g)*r.get(a,_))}return l.subMatrix(0,h-1,0,i-1)}isFullRank(){let t=this.QR.columns;for(let r=0;r<t;r++)if(this.Rdiag[r]===0)return!1;return!0}get upperTriangularMatrix(){let t=this.QR,r=t.columns,n=new Le(r,r),i,l;for(i=0;i<r;i++)for(l=0;l<r;l++)i<l?n.set(i,l,t.get(i,l)):i===l?n.set(i,l,this.Rdiag[i]):n.set(i,l,0);return n}get orthogonalMatrix(){let t=this.QR,r=t.rows,n=t.columns,i=new Le(r,n),l,h,a,g;for(a=n-1;a>=0;a--){for(l=0;l<r;l++)i.set(l,a,0);for(i.set(a,a,1),h=a;h<n;h++)if(t.get(a,a)!==0){for(g=0,l=a;l<r;l++)g+=t.get(l,a)*i.get(l,h);for(g=-g/t.get(a,a),l=a;l<r;l++)i.set(l,h,i.get(l,h)+g*t.get(l,a))}}return i}},gf=class{constructor(t,r={}){if(t=ja.checkMatrix(t),t.isEmpty())throw new Error("Matrix must be non-empty");let n=t.rows,i=t.columns;const{computeLeftSingularVectors:l=!0,computeRightSingularVectors:h=!0,autoTranspose:a=!1}=r;let g=!!l,_=!!h,E=!1,S;if(n<i)if(!a)S=t.clone(),console.warn("Computing SVD on a matrix with more columns than rows. Consider enabling autoTranspose");else{S=t.transpose(),n=S.rows,i=S.columns,E=!0;let J=g;g=_,_=J}else S=t.clone();let A=Math.min(n,i),O=Math.min(n+1,i),k=new Float64Array(O),G=new Le(n,A),W=new Le(i,i),U=new Float64Array(i),tt=new Float64Array(n),$=new Float64Array(O);for(let J=0;J<O;J++)$[J]=J;let V=Math.min(n-1,i),it=Math.max(0,Math.min(i-2,n)),vt=Math.max(V,it);for(let J=0;J<vt;J++){if(J<V){k[J]=0;for(let xt=J;xt<n;xt++)k[J]=Rc(k[J],S.get(xt,J));if(k[J]!==0){S.get(J,J)<0&&(k[J]=-k[J]);for(let xt=J;xt<n;xt++)S.set(xt,J,S.get(xt,J)/k[J]);S.set(J,J,S.get(J,J)+1)}k[J]=-k[J]}for(let xt=J+1;xt<i;xt++){if(J<V&&k[J]!==0){let $t=0;for(let Ut=J;Ut<n;Ut++)$t+=S.get(Ut,J)*S.get(Ut,xt);$t=-$t/S.get(J,J);for(let Ut=J;Ut<n;Ut++)S.set(Ut,xt,S.get(Ut,xt)+$t*S.get(Ut,J))}U[xt]=S.get(J,xt)}if(g&&J<V)for(let xt=J;xt<n;xt++)G.set(xt,J,S.get(xt,J));if(J<it){U[J]=0;for(let xt=J+1;xt<i;xt++)U[J]=Rc(U[J],U[xt]);if(U[J]!==0){U[J+1]<0&&(U[J]=0-U[J]);for(let xt=J+1;xt<i;xt++)U[xt]/=U[J];U[J+1]+=1}if(U[J]=-U[J],J+1<n&&U[J]!==0){for(let xt=J+1;xt<n;xt++)tt[xt]=0;for(let xt=J+1;xt<n;xt++)for(let $t=J+1;$t<i;$t++)tt[xt]+=U[$t]*S.get(xt,$t);for(let xt=J+1;xt<i;xt++){let $t=-U[xt]/U[J+1];for(let Ut=J+1;Ut<n;Ut++)S.set(Ut,xt,S.get(Ut,xt)+$t*tt[Ut])}}if(_)for(let xt=J+1;xt<i;xt++)W.set(xt,J,U[xt])}}let ot=Math.min(i,n+1);if(V<i&&(k[V]=S.get(V,V)),n<ot&&(k[ot-1]=0),it+1<ot&&(U[it]=S.get(it,ot-1)),U[ot-1]=0,g){for(let J=V;J<A;J++){for(let xt=0;xt<n;xt++)G.set(xt,J,0);G.set(J,J,1)}for(let J=V-1;J>=0;J--)if(k[J]!==0){for(let xt=J+1;xt<A;xt++){let $t=0;for(let Ut=J;Ut<n;Ut++)$t+=G.get(Ut,J)*G.get(Ut,xt);$t=-$t/G.get(J,J);for(let Ut=J;Ut<n;Ut++)G.set(Ut,xt,G.get(Ut,xt)+$t*G.get(Ut,J))}for(let xt=J;xt<n;xt++)G.set(xt,J,-G.get(xt,J));G.set(J,J,1+G.get(J,J));for(let xt=0;xt<J-1;xt++)G.set(xt,J,0)}else{for(let xt=0;xt<n;xt++)G.set(xt,J,0);G.set(J,J,1)}}if(_)for(let J=i-1;J>=0;J--){if(J<it&&U[J]!==0)for(let xt=J+1;xt<i;xt++){let $t=0;for(let Ut=J+1;Ut<i;Ut++)$t+=W.get(Ut,J)*W.get(Ut,xt);$t=-$t/W.get(J+1,J);for(let Ut=J+1;Ut<i;Ut++)W.set(Ut,xt,W.get(Ut,xt)+$t*W.get(Ut,J))}for(let xt=0;xt<i;xt++)W.set(xt,J,0);W.set(J,J,1)}let et=ot-1,wt=Number.EPSILON;for(;ot>0;){let J,xt;for(J=ot-2;J>=-1&&J!==-1;J--){const $t=Number.MIN_VALUE+wt*Math.abs(k[J]+Math.abs(k[J+1]));if(Math.abs(U[J])<=$t||Number.isNaN(U[J])){U[J]=0;break}}if(J===ot-2)xt=4;else{let $t;for($t=ot-1;$t>=J&&$t!==J;$t--){let Ut=($t!==ot?Math.abs(U[$t]):0)+($t!==J+1?Math.abs(U[$t-1]):0);if(Math.abs(k[$t])<=wt*Ut){k[$t]=0;break}}$t===J?xt=3:$t===ot-1?xt=1:(xt=2,J=$t)}switch(J++,xt){case 1:{let $t=U[ot-2];U[ot-2]=0;for(let Ut=ot-2;Ut>=J;Ut--){let Ot=Rc(k[Ut],$t),te=k[Ut]/Ot,ye=$t/Ot;if(k[Ut]=Ot,Ut!==J&&($t=-ye*U[Ut-1],U[Ut-1]=te*U[Ut-1]),_)for(let Me=0;Me<i;Me++)Ot=te*W.get(Me,Ut)+ye*W.get(Me,ot-1),W.set(Me,ot-1,-ye*W.get(Me,Ut)+te*W.get(Me,ot-1)),W.set(Me,Ut,Ot)}break}case 2:{let $t=U[J-1];U[J-1]=0;for(let Ut=J;Ut<ot;Ut++){let Ot=Rc(k[Ut],$t),te=k[Ut]/Ot,ye=$t/Ot;if(k[Ut]=Ot,$t=-ye*U[Ut],U[Ut]=te*U[Ut],g)for(let Me=0;Me<n;Me++)Ot=te*G.get(Me,Ut)+ye*G.get(Me,J-1),G.set(Me,J-1,-ye*G.get(Me,Ut)+te*G.get(Me,J-1)),G.set(Me,Ut,Ot)}break}case 3:{const $t=Math.max(Math.abs(k[ot-1]),Math.abs(k[ot-2]),Math.abs(U[ot-2]),Math.abs(k[J]),Math.abs(U[J])),Ut=k[ot-1]/$t,Ot=k[ot-2]/$t,te=U[ot-2]/$t,ye=k[J]/$t,Me=U[J]/$t,ir=((Ot+Ut)*(Ot-Ut)+te*te)/2,xr=Ut*te*(Ut*te);let _r=0;(ir!==0||xr!==0)&&(ir<0?_r=0-Math.sqrt(ir*ir+xr):_r=Math.sqrt(ir*ir+xr),_r=xr/(ir+_r));let kr=(ye+Ut)*(ye-Ut)+_r,vr=ye*Me;for(let ue=J;ue<ot-1;ue++){let nr=Rc(kr,vr);nr===0&&(nr=Number.MIN_VALUE);let br=kr/nr,jr=vr/nr;if(ue!==J&&(U[ue-1]=nr),kr=br*k[ue]+jr*U[ue],U[ue]=br*U[ue]-jr*k[ue],vr=jr*k[ue+1],k[ue+1]=br*k[ue+1],_)for(let ln=0;ln<i;ln++)nr=br*W.get(ln,ue)+jr*W.get(ln,ue+1),W.set(ln,ue+1,-jr*W.get(ln,ue)+br*W.get(ln,ue+1)),W.set(ln,ue,nr);if(nr=Rc(kr,vr),nr===0&&(nr=Number.MIN_VALUE),br=kr/nr,jr=vr/nr,k[ue]=nr,kr=br*U[ue]+jr*k[ue+1],k[ue+1]=-jr*U[ue]+br*k[ue+1],vr=jr*U[ue+1],U[ue+1]=br*U[ue+1],g&&ue<n-1)for(let ln=0;ln<n;ln++)nr=br*G.get(ln,ue)+jr*G.get(ln,ue+1),G.set(ln,ue+1,-jr*G.get(ln,ue)+br*G.get(ln,ue+1)),G.set(ln,ue,nr)}U[ot-2]=kr;break}case 4:{if(k[J]<=0&&(k[J]=k[J]<0?-k[J]:0,_))for(let $t=0;$t<=et;$t++)W.set($t,J,-W.get($t,J));for(;J<et&&!(k[J]>=k[J+1]);){let $t=k[J];if(k[J]=k[J+1],k[J+1]=$t,_&&J<i-1)for(let Ut=0;Ut<i;Ut++)$t=W.get(Ut,J+1),W.set(Ut,J+1,W.get(Ut,J)),W.set(Ut,J,$t);if(g&&J<n-1)for(let Ut=0;Ut<n;Ut++)$t=G.get(Ut,J+1),G.set(Ut,J+1,G.get(Ut,J)),G.set(Ut,J,$t);J++}ot--;break}}}if(E){let J=W;W=G,G=J}this.m=n,this.n=i,this.s=k,this.U=G,this.V=W}solve(t){let r=t,n=this.threshold,i=this.s.length,l=Le.zeros(i,i);for(let A=0;A<i;A++)Math.abs(this.s[A])<=n?l.set(A,A,0):l.set(A,A,1/this.s[A]);let h=this.U,a=this.rightSingularVectors,g=a.mmul(l),_=a.rows,E=h.rows,S=Le.zeros(_,E);for(let A=0;A<_;A++)for(let O=0;O<E;O++){let k=0;for(let G=0;G<i;G++)k+=g.get(A,G)*h.get(O,G);S.set(A,O,k)}return S.mmul(r)}solveForDiagonal(t){return this.solve(Le.diag(t))}inverse(){let t=this.V,r=this.threshold,n=t.rows,i=t.columns,l=new Le(n,this.s.length);for(let E=0;E<n;E++)for(let S=0;S<i;S++)Math.abs(this.s[S])>r&&l.set(E,S,t.get(E,S)/this.s[S]);let h=this.U,a=h.rows,g=h.columns,_=new Le(n,a);for(let E=0;E<n;E++)for(let S=0;S<a;S++){let A=0;for(let O=0;O<g;O++)A+=l.get(E,O)*h.get(S,O);_.set(E,S,A)}return _}get condition(){return this.s[0]/this.s[Math.min(this.m,this.n)-1]}get norm2(){return this.s[0]}get rank(){let t=Math.max(this.m,this.n)*this.s[0]*Number.EPSILON,r=0,n=this.s;for(let i=0,l=n.length;i<l;i++)n[i]>t&&r++;return r}get diagonal(){return Array.from(this.s)}get threshold(){return Number.EPSILON/2*Math.max(this.m,this.n)*this.s[0]}get leftSingularVectors(){return this.U}get rightSingularVectors(){return this.V}get diagonalMatrix(){return Le.diag(this.s)}};function WO(e,t=!1){return e=ja.checkMatrix(e),t?new gf(e).inverse():qT(e,Le.eye(e.rows))}function qT(e,t,r=!1){return e=ja.checkMatrix(e),t=ja.checkMatrix(t),r?new gf(e).solve(t):e.isSquare()?new F_(e).solve(t):new Xx(e).solve(t)}function jy(e){if(e=Le.checkMatrix(e),e.isSquare()){if(e.columns===0)return 1;let t,r,n,i;if(e.columns===2)return t=e.get(0,0),r=e.get(0,1),n=e.get(1,0),i=e.get(1,1),t*i-r*n;if(e.columns===3){let l,h,a;return l=new Uy(e,[1,2],[1,2]),h=new Uy(e,[1,2],[0,2]),a=new Uy(e,[1,2],[0,1]),t=e.get(0,0),r=e.get(0,1),n=e.get(0,2),t*jy(l)-r*jy(h)+n*jy(a)}else return new F_(e).determinant}else throw Error("determinant can only be calculated for a square matrix")}function XO(e,t){let r=[];for(let n=0;n<e;n++)n!==t&&r.push(n);return r}function HO(e,t,r,n=1e-9,i=1e-9){if(e>i)return new Array(t.rows+1).fill(0);{let l=t.addRow(r,[0]);for(let h=0;h<l.rows;h++)Math.abs(l.get(h,0))<n&&l.set(h,0,0);return l.to1DArray()}}function YO(e,t={}){const{thresholdValue:r=1e-9,thresholdError:n=1e-9}=t;e=Le.checkMatrix(e);let i=e.rows,l=new Le(i,i);for(let h=0;h<i;h++){let a=Le.columnVector(e.getRow(h)),g=e.subMatrixRow(XO(i,h)).transpose(),_=new gf(g).solve(a),E=Le.sub(a,g.mmul(_)).abs().max();l.setRow(h,HO(E,_,h,r,n))}return l}function KO(e,t=Number.EPSILON){if(e=Le.checkMatrix(e),e.isEmpty())return e.transpose();let r=new gf(e,{autoTranspose:!0}),n=r.leftSingularVectors,i=r.rightSingularVectors,l=r.diagonal;for(let h=0;h<l.length;h++)Math.abs(l[h])>t?l[h]=1/l[h]:l[h]=0;return i.mmul(Le.diag(l).mmul(n.transpose()))}function JO(e,t=e,r={}){e=new Le(e);let n=!1;if(typeof t=="object"&&!Le.isMatrix(t)&&!ma.isAnyArray(t)?(r=t,t=e,n=!0):t=new Le(t),e.rows!==t.rows)throw new TypeError("Both matrices must have the same number of rows");const{center:i=!0}=r;i&&(e=e.center("column"),n||(t=t.center("column")));const l=e.transpose().mmul(t);for(let h=0;h<l.rows;h++)for(let a=0;a<l.columns;a++)l.set(h,a,l.get(h,a)*(1/(e.rows-1)));return l}function QO(e,t=e,r={}){e=new Le(e);let n=!1;if(typeof t=="object"&&!Le.isMatrix(t)&&!ma.isAnyArray(t)?(r=t,t=e,n=!0):t=new Le(t),e.rows!==t.rows)throw new TypeError("Both matrices must have the same number of rows");const{center:i=!0,scale:l=!0}=r;i&&(e.center("column"),n||t.center("column")),l&&(e.scale("column"),n||t.scale("column"));const h=e.standardDeviation("column",{unbiased:!0}),a=n?h:t.standardDeviation("column",{unbiased:!0}),g=e.transpose().mmul(t);for(let _=0;_<g.rows;_++)for(let E=0;E<g.columns;E++)g.set(_,E,g.get(_,E)*(1/(h[_]*a[E]))*(1/(e.rows-1)));return g}class ZT{constructor(t,r={}){const{assumeSymmetric:n=!1}=r;if(t=ja.checkMatrix(t),!t.isSquare())throw new Error("Matrix is not a square matrix");if(t.isEmpty())throw new Error("Matrix must be non-empty");let i=t.columns,l=new Le(i,i),h=new Float64Array(i),a=new Float64Array(i),g=t,_,E,S=!1;if(n?S=!0:S=t.isSymmetric(),S){for(_=0;_<i;_++)for(E=0;E<i;E++)l.set(_,E,g.get(_,E));t3(i,a,h,l),e3(i,a,h,l)}else{let A=new Le(i,i),O=new Float64Array(i);for(E=0;E<i;E++)for(_=0;_<i;_++)A.set(_,E,g.get(_,E));r3(i,A,O,l),n3(i,a,h,l,A)}this.n=i,this.e=a,this.d=h,this.V=l}get realEigenvalues(){return Array.from(this.d)}get imaginaryEigenvalues(){return Array.from(this.e)}get eigenvectorMatrix(){return this.V}get diagonalMatrix(){let t=this.n,r=this.e,n=this.d,i=new Le(t,t),l,h;for(l=0;l<t;l++){for(h=0;h<t;h++)i.set(l,h,0);i.set(l,l,n[l]),r[l]>0?i.set(l,l+1,r[l]):r[l]<0&&i.set(l,l-1,r[l])}return i}}function t3(e,t,r,n){let i,l,h,a,g,_,E,S;for(g=0;g<e;g++)r[g]=n.get(e-1,g);for(a=e-1;a>0;a--){for(S=0,h=0,_=0;_<a;_++)S=S+Math.abs(r[_]);if(S===0)for(t[a]=r[a-1],g=0;g<a;g++)r[g]=n.get(a-1,g),n.set(a,g,0),n.set(g,a,0);else{for(_=0;_<a;_++)r[_]/=S,h+=r[_]*r[_];for(i=r[a-1],l=Math.sqrt(h),i>0&&(l=-l),t[a]=S*l,h=h-i*l,r[a-1]=i-l,g=0;g<a;g++)t[g]=0;for(g=0;g<a;g++){for(i=r[g],n.set(g,a,i),l=t[g]+n.get(g,g)*i,_=g+1;_<=a-1;_++)l+=n.get(_,g)*r[_],t[_]+=n.get(_,g)*i;t[g]=l}for(i=0,g=0;g<a;g++)t[g]/=h,i+=t[g]*r[g];for(E=i/(h+h),g=0;g<a;g++)t[g]-=E*r[g];for(g=0;g<a;g++){for(i=r[g],l=t[g],_=g;_<=a-1;_++)n.set(_,g,n.get(_,g)-(i*t[_]+l*r[_]));r[g]=n.get(a-1,g),n.set(a,g,0)}}r[a]=h}for(a=0;a<e-1;a++){if(n.set(e-1,a,n.get(a,a)),n.set(a,a,1),h=r[a+1],h!==0){for(_=0;_<=a;_++)r[_]=n.get(_,a+1)/h;for(g=0;g<=a;g++){for(l=0,_=0;_<=a;_++)l+=n.get(_,a+1)*n.get(_,g);for(_=0;_<=a;_++)n.set(_,g,n.get(_,g)-l*r[_])}}for(_=0;_<=a;_++)n.set(_,a+1,0)}for(g=0;g<e;g++)r[g]=n.get(e-1,g),n.set(e-1,g,0);n.set(e-1,e-1,1),t[0]=0}function e3(e,t,r,n){let i,l,h,a,g,_,E,S,A,O,k,G,W,U,tt,$;for(h=1;h<e;h++)t[h-1]=t[h];t[e-1]=0;let V=0,it=0,vt=Number.EPSILON;for(_=0;_<e;_++){for(it=Math.max(it,Math.abs(r[_])+Math.abs(t[_])),E=_;E<e&&!(Math.abs(t[E])<=vt*it);)E++;if(E>_)do{for(i=r[_],S=(r[_+1]-i)/(2*t[_]),A=Rc(S,1),S<0&&(A=-A),r[_]=t[_]/(S+A),r[_+1]=t[_]*(S+A),O=r[_+1],l=i-r[_],h=_+2;h<e;h++)r[h]-=l;for(V=V+l,S=r[E],k=1,G=k,W=k,U=t[_+1],tt=0,$=0,h=E-1;h>=_;h--)for(W=G,G=k,$=tt,i=k*t[h],l=k*S,A=Rc(S,t[h]),t[h+1]=tt*A,tt=t[h]/A,k=S/A,S=k*r[h]-tt*i,r[h+1]=l+tt*(k*i+tt*r[h]),g=0;g<e;g++)l=n.get(g,h+1),n.set(g,h+1,tt*n.get(g,h)+k*l),n.set(g,h,k*n.get(g,h)-tt*l);S=-tt*$*W*U*t[_]/O,t[_]=tt*S,r[_]=k*S}while(Math.abs(t[_])>vt*it);r[_]=r[_]+V,t[_]=0}for(h=0;h<e-1;h++){for(g=h,S=r[h],a=h+1;a<e;a++)r[a]<S&&(g=a,S=r[a]);if(g!==h)for(r[g]=r[h],r[h]=S,a=0;a<e;a++)S=n.get(a,h),n.set(a,h,n.get(a,g)),n.set(a,g,S)}}function r3(e,t,r,n){let i=0,l=e-1,h,a,g,_,E,S,A;for(S=i+1;S<=l-1;S++){for(A=0,_=S;_<=l;_++)A=A+Math.abs(t.get(_,S-1));if(A!==0){for(g=0,_=l;_>=S;_--)r[_]=t.get(_,S-1)/A,g+=r[_]*r[_];for(a=Math.sqrt(g),r[S]>0&&(a=-a),g=g-r[S]*a,r[S]=r[S]-a,E=S;E<e;E++){for(h=0,_=l;_>=S;_--)h+=r[_]*t.get(_,E);for(h=h/g,_=S;_<=l;_++)t.set(_,E,t.get(_,E)-h*r[_])}for(_=0;_<=l;_++){for(h=0,E=l;E>=S;E--)h+=r[E]*t.get(_,E);for(h=h/g,E=S;E<=l;E++)t.set(_,E,t.get(_,E)-h*r[E])}r[S]=A*r[S],t.set(S,S-1,A*a)}}for(_=0;_<e;_++)for(E=0;E<e;E++)n.set(_,E,_===E?1:0);for(S=l-1;S>=i+1;S--)if(t.get(S,S-1)!==0){for(_=S+1;_<=l;_++)r[_]=t.get(_,S-1);for(E=S;E<=l;E++){for(a=0,_=S;_<=l;_++)a+=r[_]*n.get(_,E);for(a=a/r[S]/t.get(S,S-1),_=S;_<=l;_++)n.set(_,E,n.get(_,E)+a*r[_])}}}function n3(e,t,r,n,i){let l=e-1,h=0,a=e-1,g=Number.EPSILON,_=0,E=0,S=0,A=0,O=0,k=0,G=0,W=0,U,tt,$,V,it,vt,ot,et,wt,J,xt,$t,Ut,Ot,te;for(U=0;U<e;U++)for((U<h||U>a)&&(r[U]=i.get(U,U),t[U]=0),tt=Math.max(U-1,0);tt<e;tt++)E=E+Math.abs(i.get(U,tt));for(;l>=h;){for(V=l;V>h&&(k=Math.abs(i.get(V-1,V-1))+Math.abs(i.get(V,V)),k===0&&(k=E),!(Math.abs(i.get(V,V-1))<g*k));)V--;if(V===l)i.set(l,l,i.get(l,l)+_),r[l]=i.get(l,l),t[l]=0,l--,W=0;else if(V===l-1){if(ot=i.get(l,l-1)*i.get(l-1,l),S=(i.get(l-1,l-1)-i.get(l,l))/2,A=S*S+ot,G=Math.sqrt(Math.abs(A)),i.set(l,l,i.get(l,l)+_),i.set(l-1,l-1,i.get(l-1,l-1)+_),et=i.get(l,l),A>=0){for(G=S>=0?S+G:S-G,r[l-1]=et+G,r[l]=r[l-1],G!==0&&(r[l]=et-ot/G),t[l-1]=0,t[l]=0,et=i.get(l,l-1),k=Math.abs(et)+Math.abs(G),S=et/k,A=G/k,O=Math.sqrt(S*S+A*A),S=S/O,A=A/O,tt=l-1;tt<e;tt++)G=i.get(l-1,tt),i.set(l-1,tt,A*G+S*i.get(l,tt)),i.set(l,tt,A*i.get(l,tt)-S*G);for(U=0;U<=l;U++)G=i.get(U,l-1),i.set(U,l-1,A*G+S*i.get(U,l)),i.set(U,l,A*i.get(U,l)-S*G);for(U=h;U<=a;U++)G=n.get(U,l-1),n.set(U,l-1,A*G+S*n.get(U,l)),n.set(U,l,A*n.get(U,l)-S*G)}else r[l-1]=et+S,r[l]=et+S,t[l-1]=G,t[l]=-G;l=l-2,W=0}else{if(et=i.get(l,l),wt=0,ot=0,V<l&&(wt=i.get(l-1,l-1),ot=i.get(l,l-1)*i.get(l-1,l)),W===10){for(_+=et,U=h;U<=l;U++)i.set(U,U,i.get(U,U)-et);k=Math.abs(i.get(l,l-1))+Math.abs(i.get(l-1,l-2)),et=wt=.75*k,ot=-.4375*k*k}if(W===30&&(k=(wt-et)/2,k=k*k+ot,k>0)){for(k=Math.sqrt(k),wt<et&&(k=-k),k=et-ot/((wt-et)/2+k),U=h;U<=l;U++)i.set(U,U,i.get(U,U)-k);_+=k,et=wt=ot=.964}for(W=W+1,it=l-2;it>=V&&(G=i.get(it,it),O=et-G,k=wt-G,S=(O*k-ot)/i.get(it+1,it)+i.get(it,it+1),A=i.get(it+1,it+1)-G-O-k,O=i.get(it+2,it+1),k=Math.abs(S)+Math.abs(A)+Math.abs(O),S=S/k,A=A/k,O=O/k,!(it===V||Math.abs(i.get(it,it-1))*(Math.abs(A)+Math.abs(O))<g*(Math.abs(S)*(Math.abs(i.get(it-1,it-1))+Math.abs(G)+Math.abs(i.get(it+1,it+1))))));)it--;for(U=it+2;U<=l;U++)i.set(U,U-2,0),U>it+2&&i.set(U,U-3,0);for($=it;$<=l-1&&(Ot=$!==l-1,$!==it&&(S=i.get($,$-1),A=i.get($+1,$-1),O=Ot?i.get($+2,$-1):0,et=Math.abs(S)+Math.abs(A)+Math.abs(O),et!==0&&(S=S/et,A=A/et,O=O/et)),et!==0);$++)if(k=Math.sqrt(S*S+A*A+O*O),S<0&&(k=-k),k!==0){for($!==it?i.set($,$-1,-k*et):V!==it&&i.set($,$-1,-i.get($,$-1)),S=S+k,et=S/k,wt=A/k,G=O/k,A=A/S,O=O/S,tt=$;tt<e;tt++)S=i.get($,tt)+A*i.get($+1,tt),Ot&&(S=S+O*i.get($+2,tt),i.set($+2,tt,i.get($+2,tt)-S*G)),i.set($,tt,i.get($,tt)-S*et),i.set($+1,tt,i.get($+1,tt)-S*wt);for(U=0;U<=Math.min(l,$+3);U++)S=et*i.get(U,$)+wt*i.get(U,$+1),Ot&&(S=S+G*i.get(U,$+2),i.set(U,$+2,i.get(U,$+2)-S*O)),i.set(U,$,i.get(U,$)-S),i.set(U,$+1,i.get(U,$+1)-S*A);for(U=h;U<=a;U++)S=et*n.get(U,$)+wt*n.get(U,$+1),Ot&&(S=S+G*n.get(U,$+2),n.set(U,$+2,n.get(U,$+2)-S*O)),n.set(U,$,n.get(U,$)-S),n.set(U,$+1,n.get(U,$+1)-S*A)}}}if(E!==0){for(l=e-1;l>=0;l--)if(S=r[l],A=t[l],A===0)for(V=l,i.set(l,l,1),U=l-1;U>=0;U--){for(ot=i.get(U,U)-S,O=0,tt=V;tt<=l;tt++)O=O+i.get(U,tt)*i.get(tt,l);if(t[U]<0)G=ot,k=O;else if(V=U,t[U]===0?i.set(U,l,ot!==0?-O/ot:-O/(g*E)):(et=i.get(U,U+1),wt=i.get(U+1,U),A=(r[U]-S)*(r[U]-S)+t[U]*t[U],vt=(et*k-G*O)/A,i.set(U,l,vt),i.set(U+1,l,Math.abs(et)>Math.abs(G)?(-O-ot*vt)/et:(-k-wt*vt)/G)),vt=Math.abs(i.get(U,l)),g*vt*vt>1)for(tt=U;tt<=l;tt++)i.set(tt,l,i.get(tt,l)/vt)}else if(A<0)for(V=l-1,Math.abs(i.get(l,l-1))>Math.abs(i.get(l-1,l))?(i.set(l-1,l-1,A/i.get(l,l-1)),i.set(l-1,l,-(i.get(l,l)-S)/i.get(l,l-1))):(te=vy(0,-i.get(l-1,l),i.get(l-1,l-1)-S,A),i.set(l-1,l-1,te[0]),i.set(l-1,l,te[1])),i.set(l,l-1,0),i.set(l,l,1),U=l-2;U>=0;U--){for(J=0,xt=0,tt=V;tt<=l;tt++)J=J+i.get(U,tt)*i.get(tt,l-1),xt=xt+i.get(U,tt)*i.get(tt,l);if(ot=i.get(U,U)-S,t[U]<0)G=ot,O=J,k=xt;else if(V=U,t[U]===0?(te=vy(-J,-xt,ot,A),i.set(U,l-1,te[0]),i.set(U,l,te[1])):(et=i.get(U,U+1),wt=i.get(U+1,U),$t=(r[U]-S)*(r[U]-S)+t[U]*t[U]-A*A,Ut=(r[U]-S)*2*A,$t===0&&Ut===0&&($t=g*E*(Math.abs(ot)+Math.abs(A)+Math.abs(et)+Math.abs(wt)+Math.abs(G))),te=vy(et*O-G*J+A*xt,et*k-G*xt-A*J,$t,Ut),i.set(U,l-1,te[0]),i.set(U,l,te[1]),Math.abs(et)>Math.abs(G)+Math.abs(A)?(i.set(U+1,l-1,(-J-ot*i.get(U,l-1)+A*i.get(U,l))/et),i.set(U+1,l,(-xt-ot*i.get(U,l)-A*i.get(U,l-1))/et)):(te=vy(-O-wt*i.get(U,l-1),-k-wt*i.get(U,l),G,A),i.set(U+1,l-1,te[0]),i.set(U+1,l,te[1]))),vt=Math.max(Math.abs(i.get(U,l-1)),Math.abs(i.get(U,l))),g*vt*vt>1)for(tt=U;tt<=l;tt++)i.set(tt,l-1,i.get(tt,l-1)/vt),i.set(tt,l,i.get(tt,l)/vt)}for(U=0;U<e;U++)if(U<h||U>a)for(tt=U;tt<e;tt++)n.set(U,tt,i.get(U,tt));for(tt=e-1;tt>=h;tt--)for(U=h;U<=a;U++){for(G=0,$=h;$<=Math.min(tt,a);$++)G=G+n.get(U,$)*i.get($,tt);n.set(U,tt,G)}}}function vy(e,t,r,n){let i,l;return Math.abs(r)>Math.abs(n)?(i=n/r,l=r+i*n,[(e+i*t)/l,(t-i*e)/l]):(i=r/n,l=n+i*r,[(i*e+t)/l,(i*t-e)/l])}class WT{constructor(t){if(t=ja.checkMatrix(t),!t.isSymmetric())throw new Error("Matrix is not symmetric");let r=t,n=r.rows,i=new Le(n,n),l=!0,h,a,g;for(a=0;a<n;a++){let _=0;for(g=0;g<a;g++){let E=0;for(h=0;h<g;h++)E+=i.get(g,h)*i.get(a,h);E=(r.get(a,g)-E)/i.get(g,g),i.set(a,g,E),_=_+E*E}for(_=r.get(a,a)-_,l&=_>0,i.set(a,a,Math.sqrt(Math.max(_,0))),g=a+1;g<n;g++)i.set(a,g,0)}this.L=i,this.positiveDefinite=!!l}isPositiveDefinite(){return this.positiveDefinite}solve(t){t=ja.checkMatrix(t);let r=this.L,n=r.rows;if(t.rows!==n)throw new Error("Matrix dimensions do not match");if(this.isPositiveDefinite()===!1)throw new Error("Matrix is not positive definite");let i=t.columns,l=t.clone(),h,a,g;for(g=0;g<n;g++)for(a=0;a<i;a++){for(h=0;h<g;h++)l.set(g,a,l.get(g,a)-l.get(h,a)*r.get(g,h));l.set(g,a,l.get(g,a)/r.get(g,g))}for(g=n-1;g>=0;g--)for(a=0;a<i;a++){for(h=g+1;h<n;h++)l.set(g,a,l.get(g,a)-l.get(h,a)*r.get(h,g));l.set(g,a,l.get(g,a)/r.get(g,g))}return l}get lowerTriangularMatrix(){return this.L}}class XT{constructor(t,r={}){t=ja.checkMatrix(t);let{Y:n}=r;const{scaleScores:i=!1,maxIterations:l=1e3,terminationCriteria:h=1e-10}=r;let a;if(n){if(ma.isAnyArray(n)&&typeof n[0]=="number"?n=Le.columnVector(n):n=ja.checkMatrix(n),n.rows!==t.rows)throw new Error("Y should have the same number of rows as X");a=n.getColumnVector(0)}else a=t.getColumnVector(0);let g=1,_,E,S,A;for(let O=0;O<l&&g>h;O++)S=t.transpose().mmul(a).div(a.transpose().mmul(a).get(0,0)),S=S.div(S.norm()),_=t.mmul(S).div(S.transpose().mmul(S).get(0,0)),O>0&&(g=_.clone().sub(A).pow(2).sum()),A=_.clone(),n?(E=n.transpose().mmul(_).div(_.transpose().mmul(_).get(0,0)),E=E.div(E.norm()),a=n.mmul(E).div(E.transpose().mmul(E).get(0,0))):a=_;if(n){let O=t.transpose().mmul(_).div(_.transpose().mmul(_).get(0,0));O=O.div(O.norm());let k=t.clone().sub(_.clone().mmul(O.transpose())),G=a.transpose().mmul(_).div(_.transpose().mmul(_).get(0,0)),W=n.clone().sub(_.clone().mulS(G.get(0,0)).mmul(E.transpose()));this.t=_,this.p=O.transpose(),this.w=S.transpose(),this.q=E,this.u=a,this.s=_.transpose().mmul(_),this.xResidual=k,this.yResidual=W,this.betas=G}else this.w=S.transpose(),this.s=_.transpose().mmul(_).sqrt(),i?this.t=_.clone().div(this.s.get(0,0)):this.t=_,this.xResidual=t.sub(_.mmul(S.transpose()))}}Yr.AbstractMatrix=Ai;Yr.CHO=WT;Yr.CholeskyDecomposition=WT;Yr.DistanceMatrix=jT;Yr.EVD=ZT;Yr.EigenvalueDecomposition=ZT;Yr.LU=F_;Yr.LuDecomposition=F_;var i3=Yr.Matrix=Le;Yr.MatrixColumnSelectionView=BO;Yr.MatrixColumnView=zO;Yr.MatrixFlipColumnView=$O;Yr.MatrixFlipRowView=UO;Yr.MatrixRowSelectionView=VO;Yr.MatrixRowView=jO;Yr.MatrixSelectionView=Uy;Yr.MatrixSubView=GO;Yr.MatrixTransposeView=qO;Yr.NIPALS=XT;Yr.Nipals=XT;Yr.QR=Xx;Yr.QrDecomposition=Xx;Yr.SVD=gf;var o3=Yr.SingularValueDecomposition=gf;Yr.SymmetricMatrix=Sm;Yr.WrapperMatrix1D=GT;Yr.WrapperMatrix2D=ja;Yr.correlation=QO;Yr.covariance=JO;var OE=Yr.default=Le;Yr.determinant=jy;var s3=Yr.inverse=WO;Yr.linearDependencies=YO;var a3=Yr.pseudoInverse=KO;Yr.solve=qT;Yr.wrap=ZO;const El=i3,l3=o3;OE.Matrix&&OE.Matrix;const u3=s3,HT=a3;let _g=class{constructor(t,r,n,i){if(Nt(this,"sourcePoints"),Nt(this,"destinationPoints"),Nt(this,"pointCount"),Nt(this,"pointCountMinimum"),Nt(this,"type"),this.sourcePoints=t,this.destinationPoints=r,this.pointCount=this.sourcePoints.length,this.type=n,this.pointCountMinimum=i,this.pointCount<this.pointCountMinimum)throw new Error("Not enough control points. A "+this.type+" transformation requires a minimum of "+this.pointCountMinimum+" points, but "+this.pointCount+" are given.")}evaluate(t,r="function"){if(r=="function")return this.evaluateFunction(t);if(r=="partialDerivativeX")return this.evaluatePartialDerivativeX(t);if(r=="partialDerivativeY")return this.evaluatePartialDerivativeY(t);throw new Error("Evaluation of type "+r+" not supported")}};class YT extends _g{constructor(t,r){super(t,r,"helmert",2),Nt(this,"helmertParametersMatrix"),Nt(this,"helmertParameters"),Nt(this,"scale"),Nt(this,"rotation"),Nt(this,"translation");const n=El.columnVector(r.flat()),i=El.zeros(2*this.pointCount,4);for(let h=0;h<this.pointCount;h++)i.set(2*h,0,1),i.set(2*h,1,0),i.set(2*h,2,this.sourcePoints[h][0]),i.set(2*h,3,-this.sourcePoints[h][1]),i.set(2*h+1,0,0),i.set(2*h+1,1,1),i.set(2*h+1,2,this.sourcePoints[h][1]),i.set(2*h+1,3,this.sourcePoints[h][0]);const l=HT(i);this.helmertParametersMatrix=l.mmul(n),this.helmertParameters=this.helmertParametersMatrix.to1DArray(),this.scale=Math.sqrt(this.helmertParameters[2]**2+this.helmertParameters[3]**2),this.rotation=Math.atan2(this.helmertParameters[3],this.helmertParameters[2]),this.translation=[this.helmertParameters[0],this.helmertParameters[1]]}evaluateFunction(t){if(!this.helmertParameters)throw new Error("Helmert parameters not computed");return[this.helmertParameters[0]+this.helmertParameters[2]*t[0]-this.helmertParameters[3]*t[1],this.helmertParameters[1]+this.helmertParameters[2]*t[1]+this.helmertParameters[3]*t[0]]}evaluatePartialDerivativeX(t){if(!this.helmertParameters)throw new Error("Helmert parameters not computed");return[this.helmertParameters[2],this.helmertParameters[3]]}evaluatePartialDerivativeY(t){if(!this.helmertParameters)throw new Error("Helmert parameters not computed");return[-this.helmertParameters[3],this.helmertParameters[2]]}}class c3 extends _g{constructor(t,r){super(t,r,"straight",2),Nt(this,"scale"),Nt(this,"sourcePointsCenter"),Nt(this,"destinationPointsCenter"),Nt(this,"translation");const n=new YT(this.sourcePoints,this.destinationPoints);if(this.scale=n.scale,!this.scale)throw new Error("Scale could not be computed");this.sourcePointsCenter=this.sourcePoints.reduce((l,h)=>[l[0]+h[0],l[1]+h[1]]).map(l=>l/this.pointCount),this.destinationPointsCenter=this.destinationPoints.reduce((l,h)=>[l[0]+h[0],l[1]+h[1]]).map(l=>l/this.pointCount);const i=this.scale;this.translation=this.destinationPointsCenter.map((l,h)=>l-this.sourcePointsCenter[h]*i)}evaluateFunction(t){if(!this.scale||!this.translation)throw new Error("Straight parameters not computed");return[this.translation[0]+this.scale*t[0],this.translation[1]+this.scale*t[1]]}evaluatePartialDerivativeX(t){if(!this.scale||!this.translation)throw new Error("Straight parameters not computed");return[this.scale,0]}evaluatePartialDerivativeY(t){if(!this.scale||!this.translation)throw new Error("Straight parameters not computed");return[0,this.scale]}}let uv=class extends _g{constructor(t,r,n){n=n||1;const i=(n+1)*(n+2)/2;if(super(t,r,"polynomial"+n,i),Nt(this,"polynomialParametersMatrices"),Nt(this,"polynomialParameters"),Nt(this,"order"),Nt(this,"pointCountMinimum"),this.order=n,this.pointCountMinimum=i,this.order<1||this.order>3)throw new Error("Only polynomial transformations of order 1, 2 or 3 are supported");const l=[El.columnVector(this.destinationPoints.map(g=>g[0])),El.columnVector(this.destinationPoints.map(g=>g[1]))],h=El.zeros(this.pointCount,this.pointCountMinimum);for(let g=0;g<this.pointCount;g++)switch(this.order){case 1:h.set(g,0,1),h.set(g,1,this.sourcePoints[g][0]),h.set(g,2,this.sourcePoints[g][1]);break;case 2:h.set(g,0,1),h.set(g,1,this.sourcePoints[g][0]),h.set(g,2,this.sourcePoints[g][1]),h.set(g,3,this.sourcePoints[g][0]**2),h.set(g,4,this.sourcePoints[g][1]**2),h.set(g,5,this.sourcePoints[g][0]*this.sourcePoints[g][1]);break;case 3:h.set(g,0,1),h.set(g,1,this.sourcePoints[g][0]),h.set(g,2,this.sourcePoints[g][1]),h.set(g,3,this.sourcePoints[g][0]**2),h.set(g,4,this.sourcePoints[g][1]**2),h.set(g,5,this.sourcePoints[g][0]*this.sourcePoints[g][1]),h.set(g,6,this.sourcePoints[g][0]**3),h.set(g,7,this.sourcePoints[g][1]**3),h.set(g,8,this.sourcePoints[g][0]**2*this.sourcePoints[g][1]),h.set(g,9,this.sourcePoints[g][0]*this.sourcePoints[g][1]**2);break}const a=HT(h);this.polynomialParametersMatrices=[a.mmul(l[0]),a.mmul(l[1])],this.polynomialParameters=this.polynomialParametersMatrices.map(g=>g.to1DArray())}evaluateFunction(t){if(!this.polynomialParameters)throw new Error("Polynomial parameters not computed");const r=[0,0];for(let n=0;n<2;n++)switch(this.order){case 1:r[n]+=this.polynomialParameters[n][0]+this.polynomialParameters[n][1]*t[0]+this.polynomialParameters[n][2]*t[1];break;case 2:r[n]+=this.polynomialParameters[n][0]+this.polynomialParameters[n][1]*t[0]+this.polynomialParameters[n][2]*t[1]+this.polynomialParameters[n][3]*t[0]**2+this.polynomialParameters[n][4]*t[1]**2+this.polynomialParameters[n][5]*t[0]*t[1];break;case 3:r[n]+=this.polynomialParameters[n][0]+this.polynomialParameters[n][1]*t[0]+this.polynomialParameters[n][2]*t[1]+this.polynomialParameters[n][3]*t[0]**2+this.polynomialParameters[n][4]*t[1]**2+this.polynomialParameters[n][5]*t[0]*t[1]+this.polynomialParameters[n][6]*t[0]**3+this.polynomialParameters[n][7]*t[1]**3+this.polynomialParameters[n][8]*t[0]**2*t[1]+this.polynomialParameters[n][9]*t[0]*t[1]**2;break}return r}evaluatePartialDerivativeX(t){if(!this.polynomialParameters)throw new Error("Polynomial parameters not computed");const r=[0,0];for(let n=0;n<2;n++)switch(this.order){case 1:r[n]+=this.polynomialParameters[n][1];break;case 2:r[n]+=this.polynomialParameters[n][1]+2*this.polynomialParameters[n][3]*t[0]+this.polynomialParameters[n][5]*t[1];break;case 3:r[n]+=this.polynomialParameters[n][1]+2*this.polynomialParameters[n][3]*t[0]+this.polynomialParameters[n][5]*t[1]+3*this.polynomialParameters[n][6]*t[0]**2+2*this.polynomialParameters[n][8]*t[0]*t[1]+this.polynomialParameters[n][9]*t[1]**2;break}return r}evaluatePartialDerivativeY(t){if(!this.polynomialParameters)throw new Error("Polynomial parameters not computed");const r=[0,0];for(let n=0;n<2;n++)switch(this.order){case 1:r[n]+=this.polynomialParameters[n][2];break;case 2:r[n]+=this.polynomialParameters[n][2]+2*this.polynomialParameters[n][4]*t[1]+this.polynomialParameters[n][5]*t[0];break;case 3:r[n]+=this.polynomialParameters[n][2]+2*this.polynomialParameters[n][4]*t[1]+this.polynomialParameters[n][5]*t[0]+3*this.polynomialParameters[n][7]*t[1]**2+this.polynomialParameters[n][8]*t[0]**2+2*this.polynomialParameters[n][9]*t[0]*t[1];break}return r}};class h3 extends _g{constructor(t,r){super(t,r,"projective",4),Nt(this,"projectiveParametersMatrix"),Nt(this,"projectiveParameters");const n=El.zeros(2*this.pointCount,9);for(let l=0;l<this.pointCount;l++)n.set(2*l,0,-t[l][0]),n.set(2*l,1,-t[l][1]),n.set(2*l,2,-1),n.set(2*l,3,0),n.set(2*l,4,0),n.set(2*l,5,0),n.set(2*l,6,r[l][0]*t[l][0]),n.set(2*l,7,r[l][0]*t[l][1]),n.set(2*l,8,r[l][0]),n.set(2*l+1,0,0),n.set(2*l+1,1,0),n.set(2*l+1,2,0),n.set(2*l+1,3,-t[l][0]),n.set(2*l+1,4,-t[l][1]),n.set(2*l+1,5,-1),n.set(2*l+1,6,r[l][1]*t[l][0]),n.set(2*l+1,7,r[l][1]*t[l][1]),n.set(2*l+1,8,r[l][1]);const i=new l3(n);this.projectiveParametersMatrix=El.from1DArray(3,3,i.rightSingularVectors.getColumn(8)).transpose(),this.projectiveParameters=this.projectiveParametersMatrix.to2DArray()}evaluateFunction(t){if(!this.projectiveParameters)throw new Error("projective parameters not computed");const r=this.projectiveParameters[0][2]*t[0]+this.projectiveParameters[1][2]*t[1]+this.projectiveParameters[2][2],n=this.projectiveParameters[0][0]*t[0]+this.projectiveParameters[1][0]*t[1]+this.projectiveParameters[2][0],i=this.projectiveParameters[0][1]*t[0]+this.projectiveParameters[1][1]*t[1]+this.projectiveParameters[2][1];return[n/r,i/r]}evaluatePartialDerivativeX(t){if(!this.projectiveParameters)throw new Error("projective parameters not computed");const r=this.projectiveParameters[0][2]*t[0]+this.projectiveParameters[1][2]*t[1]+this.projectiveParameters[2][2],n=this.projectiveParameters[0][0]*t[0]+this.projectiveParameters[1][0]*t[1]+this.projectiveParameters[2][0],i=this.projectiveParameters[0][1]*t[0]+this.projectiveParameters[1][1]*t[1]+this.projectiveParameters[2][1];return[(r*this.projectiveParameters[0][0]-this.projectiveParameters[0][2]*n)/r**2,(r*this.projectiveParameters[0][1]-this.projectiveParameters[0][2]*i)/r**2]}evaluatePartialDerivativeY(t){if(!this.projectiveParameters)throw new Error("projective parameters not computed");const r=this.projectiveParameters[0][2]*t[0]+this.projectiveParameters[1][2]*t[1]+this.projectiveParameters[2][2],n=this.projectiveParameters[0][0]*t[0]+this.projectiveParameters[1][0]*t[1]+this.projectiveParameters[2][0],i=this.projectiveParameters[0][1]*t[0]+this.projectiveParameters[1][1]*t[1]+this.projectiveParameters[2][1];return[(r*this.projectiveParameters[1][0]-this.projectiveParameters[1][2]*n)/r**2,(r*this.projectiveParameters[1][1]-this.projectiveParameters[1][2]*i)/r**2]}}class p3 extends _g{constructor(t,r,n,i,l){super(t,r,"thinPlateSpline",3),Nt(this,"kernelFunction"),Nt(this,"normFunction"),Nt(this,"weightsMatrices"),Nt(this,"rbfWeights"),Nt(this,"affineWeights"),Nt(this,"epsilon"),this.kernelFunction=n,this.normFunction=i;const h=[El.columnVector([...this.destinationPoints,[0,0],[0,0],[0,0]].map(S=>S[0])),El.columnVector([...this.destinationPoints,[0,0],[0,0],[0,0]].map(S=>S[1]))],a=El.zeros(this.pointCount,this.pointCount);for(let S=0;S<this.pointCount;S++)for(let A=0;A<this.pointCount;A++)a.set(S,A,i(this.sourcePoints[S],this.sourcePoints[A]));l===void 0&&(l=a.sum()/(Math.pow(this.pointCount,2)-this.pointCount)),this.epsilon=l;for(let S=0;S<this.pointCount;S++)for(let A=0;A<this.pointCount;A++)a.set(S,A,n(a.get(S,A),{epsilon:l}));const g=El.zeros(this.pointCount,3),_=El.zeros(this.pointCount+3,this.pointCount+3);for(let S=0;S<this.pointCount;S++)g.set(S,0,1),g.set(S,1,this.sourcePoints[S][0]),g.set(S,2,this.sourcePoints[S][1]);for(let S=0;S<this.pointCount+3;S++)for(let A=0;A<this.pointCount+3;A++)S<this.pointCount&&A<this.pointCount?_.set(S,A,a.get(S,A)):S>=this.pointCount&&A<this.pointCount?_.set(S,A,g.transpose().get(S-this.pointCount,A)):S<this.pointCount&&A>=this.pointCount&&_.set(S,A,g.get(S,A-this.pointCount));const E=u3(_);this.weightsMatrices=[E.mmul(h[0]),E.mmul(h[1])],this.rbfWeights=this.weightsMatrices.map(S=>S.selection([...Array(this.pointCount).keys()],[0]).to1DArray()),this.affineWeights=this.weightsMatrices.map(S=>S.selection([0,1,2].map(A=>A+this.pointCount),[0]).to1DArray())}evaluateFunction(t){if(!this.rbfWeights||!this.affineWeights)throw new Error("Weights not computed");const r=this.sourcePoints.map(i=>this.normFunction(t,i)),n=[0,0];for(let i=0;i<2;i++)n[i]=r.reduce((l,h,a)=>l+this.kernelFunction(h,{epsilon:this.epsilon})*this.rbfWeights[i][a],0),n[i]+=this.affineWeights[i][0]+this.affineWeights[i][1]*t[0]+this.affineWeights[i][2]*t[1];return n}evaluatePartialDerivativeX(t){if(!this.rbfWeights||!this.affineWeights)throw new Error("Weights not computed");const r=this.sourcePoints.map(i=>this.normFunction(t,i)),n=[0,0];for(let i=0;i<2;i++)n[i]=r.reduce((l,h,a)=>l+(h==0?0:this.kernelFunction(h,{derivative:1,epsilon:this.epsilon})*((t[0]-this.sourcePoints[a][0])/h)*this.rbfWeights[i][a]),0),n[i]+=this.affineWeights[i][1];return n}evaluatePartialDerivativeY(t){if(!this.rbfWeights||!this.affineWeights)throw new Error("Weights not computed");const r=this.sourcePoints.map(i=>this.normFunction(t,i)),n=[0,0];for(let i=0;i<2;i++)n[i]=r.reduce((l,h,a)=>l+(h==0?0:this.kernelFunction(h,{derivative:1,epsilon:this.epsilon})*((t[1]-this.sourcePoints[a][1])/h)*this.rbfWeights[i][a]),0),n[i]+=this.affineWeights[i][2];return n}}function d3(e,t){if(t.derivative){if(t.derivative==1)return e===0?0:e+2*e*Math.log(e);throw new Error("Derivate of order "+t.derivative+" not implemented")}else return e===0?0:Math.pow(e,2)*Math.log(e)}function f3(e,t){const r=[t[0]-e[0],t[1]-e[1]];return Math.sqrt(r[0]**2+r[1]**2)}function ti(e,t,r){return{maxOffsetRatio:0,maxDepth:0,destinationIsGeographic:!1,sourceIsGeographic:!1,inputIsMultiGeometry:!1,differentHandedness:!1,evaluationType:"function",...r,...t,...e}}function xy(e,t,r){t=D_(t);const n=t.map(h=>({source:h,destination:e.transformForward(h)})),i=z_(n,!1),l=KT(e,i,r);return B_(l,!0).map(h=>h.destination)}function by(e,t,r){t=D_(t);const n=t.map(h=>({source:e.transformBackward(h),destination:h})),i=z_(n,!1),l=JT(e,i,r);return B_(l,!0).map(h=>h.source)}function m3(e,t,r){t=Bx(t);const n=t.map(h=>({source:h,destination:e.transformForward(h)})),i=z_(n,!0),l=KT(e,i,r);return B_(l,!1).map(h=>h.destination)}function g3(e,t,r){t=Bx(t);const n=t.map(h=>({source:e.transformBackward(h),destination:h})),i=z_(n,!0),l=JT(e,i,r);return B_(l,!1).map(h=>h.source)}function wy(e,t,r){return t.map(n=>m3(e,n,r))}function Ey(e,t,r){return t.map(n=>g3(e,n,r))}function z_(e,t=!1){const r=e.length-(t?0:1),n=[];for(let i=0;i<r;i++)n.push({from:e[i],to:e[(i+1)%e.length]});return n}function B_(e,t=!1){const r=e.map(n=>n.from);return t&&r.push(e[e.length-1].to),r}function KT(e,t,r){return r.maxDepth<=0?t:t.map(n=>ox(e,n,r,0)).flat(1)}function JT(e,t,r){return r.maxDepth<=0?t:t.map(n=>sx(e,n,r,0)).flat(1)}function ox(e,t,r,n){if(n>=r.maxDepth)return t;const i=(r.sourceIsGeographic?(_,E)=>d_(_,E).geometry.coordinates:Jy)(t.from.source,t.to.source),l=(r.destinationIsGeographic?(_,E)=>d_(_,E).geometry.coordinates:Jy)(t.from.destination,t.to.destination),h=e.transformForward(i),a=r.destinationIsGeographic?qx:Ba,g=a(t.from.destination,t.to.destination);if(a(l,h)/g>r.maxOffsetRatio&&g>0){const _={source:i,destination:h};return[ox(e,{from:t.from,to:_},r,n+1),ox(e,{from:_,to:t.to},r,n+1)].flat(1)}else return t}function sx(e,t,r,n){if(n>=r.maxDepth)return t;const i=(r.destinationIsGeographic?(_,E)=>d_(_,E).geometry.coordinates:Jy)(t.from.destination,t.to.destination),l=(r.sourceIsGeographic?(_,E)=>d_(_,E).geometry.coordinates:Jy)(t.from.source,t.to.source),h=e.transformBackward(i),a=r.sourceIsGeographic?qx:Ba,g=a(t.from.source,t.to.source);if(a(l,h)/g>r.maxOffsetRatio&&g>0){const _={source:h,destination:i};return[sx(e,{from:t.from,to:_},r,n+1),sx(e,{from:_,to:t.to},r,n+1)].flat(1)}else return t}let cv=class{constructor(t,r="polynomial",n){if(Nt(this,"gcps"),Nt(this,"sourcePoints"),Nt(this,"destinationPoints"),Nt(this,"type"),Nt(this,"options"),Nt(this,"forwardTransformation"),Nt(this,"backwardTransformation"),n&&(this.options=n),t.length===0)throw new Error("No control points");this.gcps=t.map(i=>{if("resource"in i&&"geo"in i)return{source:i.resource,destination:i.geo};if("source"in i&&"destination"in i)return i;throw new Error("Unsupported GCP type")}),this.sourcePoints=this.gcps.map(i=>i.source),this.destinationPoints=this.gcps.map(i=>i.destination),this.type=r}createForwardTransformation(){this.forwardTransformation=this.computeTransformation(this.sourcePoints.map(t=>this.assureEqualHandedness(t)),this.destinationPoints)}createBackwardTransformation(){this.backwardTransformation=this.computeTransformation(this.destinationPoints,this.sourcePoints.map(t=>this.assureEqualHandedness(t)))}transformForward(t,r){if(!ti(r,this.options).inputIsMultiGeometry){if(Ws(t))return this.forwardTransformation||this.createForwardTransformation(),this.forwardTransformation.evaluate(this.assureEqualHandedness(t),ti(r,this.options).evaluationType);if(Ic(t))return this.transformForward(dm(t),r);if(Ql(t))return xy(this,t,ti(r,this.options));if(Cc(t))return xy(this,fm(t),ti(r,this.options,{sourceIsGeographic:!0}));if(tu(t))return wy(this,t,ti(r,this.options));if(Mc(t))return wy(this,mm(t),ti(r,this.options,{sourceIsGeographic:!0}))}if(r&&(r.inputIsMultiGeometry=!1),Ec(t))return t.map(n=>this.transformForward(n,r));if(Pc(t))return ly(t).map(n=>this.transformForward(n,r));if(Sc(t))return t.map(n=>this.transformForward(n,r));if(Ac(t))return uy(t).map(n=>this.transformForward(n,r));if(Tc(t))return t.map(n=>this.transformForward(n,r));if(Lc(t))return cy(t).map(n=>this.transformForward(n,r));throw new Error("Input type not supported")}transformForwardAsGeojson(t,r){if(!ti(r,this.options).inputIsMultiGeometry){if(Ws(t))return oy(this.transformForward(t));if(Ic(t))return oy(this.transformForward(dm(t)));if(Ql(t))return sy(xy(this,t,ti(r,this.options,{destinationIsGeographic:!0})));if(Cc(t))return sy(xy(this,fm(t),ti(r,this.options,{sourceIsGeographic:!0,destinationIsGeographic:!0})));if(tu(t))return ay(wy(this,t,ti(r,this.options,{destinationIsGeographic:!0})));if(Mc(t))return ay(wy(this,mm(t),ti(r,this.options,{sourceIsGeographic:!0,destinationIsGeographic:!0})))}if(r&&(r.inputIsMultiGeometry=!1),Ec(t))return hy(t.map(n=>this.transformForwardAsGeojson(n,r)));if(Pc(t))return hy(ly(t).map(n=>this.transformForwardAsGeojson(n,r)));if(Sc(t))return py(t.map(n=>this.transformForwardAsGeojson(n,r)));if(Ac(t))return py(uy(t).map(n=>this.transformForwardAsGeojson(n,r)));if(Tc(t))return dy(t.map(n=>this.transformForwardAsGeojson(n,r)));if(Lc(t))return dy(cy(t).map(n=>this.transformForwardAsGeojson(n,r)));throw new Error("Input type not supported")}transformBackward(t,r){if(!ti(r,this.options).inputIsMultiGeometry){if(Ws(t))return this.backwardTransformation||this.createBackwardTransformation(),this.assureEqualHandedness(this.backwardTransformation.evaluate(t));if(Ic(t))return this.transformBackward(dm(t));if(Ql(t))return by(this,t,ti(r,this.options));if(Cc(t))return by(this,fm(t),ti(r,this.options,{destinationIsGeographic:!0}));if(tu(t))return Ey(this,t,ti(r,this.options));if(Mc(t))return Ey(this,mm(t),ti(r,this.options,{destinationIsGeographic:!0}))}if(r&&(r.inputIsMultiGeometry=!1),Ec(t))return t.map(n=>this.transformBackward(n,r));if(Pc(t))return ly(t).map(n=>this.transformBackward(n,r));if(Sc(t))return t.map(n=>this.transformBackward(n,r));if(Ac(t))return uy(t).map(n=>this.transformBackward(n,r));if(Tc(t))return t.map(n=>this.transformBackward(n,r));if(Lc(t))return cy(t).map(n=>this.transformBackward(n,r));throw new Error("Input type not supported")}transformBackwardAsGeojson(t,r){if(!ti(r,this.options).inputIsMultiGeometry){if(Ws(t))return oy(this.transformBackward(t));if(Ic(t))return oy(this.transformBackward(dm(t)));if(Ql(t))return sy(by(this,t,ti(r,this.options,{sourceIsGeographic:!0})));if(Cc(t))return sy(by(this,fm(t),ti(r,this.options,{sourceIsGeographic:!0,destinationIsGeographic:!0})));if(tu(t))return ay(Ey(this,t,ti(r,this.options,{sourceIsGeographic:!0})));if(Mc(t))return ay(Ey(this,mm(t),ti(r,this.options,{sourceIsGeographic:!0,destinationIsGeographic:!0})))}if(r&&(r.inputIsMultiGeometry=!1),Ec(t))return hy(t.map(n=>this.transformBackwardAsGeojson(n,r)));if(Pc(t))return hy(ly(t).map(n=>this.transformBackwardAsGeojson(n,r)));if(Sc(t))return py(t.map(n=>this.transformBackwardAsGeojson(n,r)));if(Ac(t))return py(uy(t).map(n=>this.transformBackwardAsGeojson(n,r)));if(Tc(t))return dy(t.map(n=>this.transformBackwardAsGeojson(n,r)));if(Lc(t))return dy(cy(t).map(n=>this.transformBackwardAsGeojson(n,r)));throw new Error("Input type not supported")}transformToGeo(t,r){if(!ti(r,this.options).inputIsMultiGeometry){if(Ws(t))return this.transformForward(t,r);if(Ic(t))return this.transformForward(t,r);if(Ql(t))return this.transformForward(t,r);if(Cc(t))return this.transformForward(t,r);if(tu(t))return this.transformForward(t,r);if(Mc(t))return this.transformForward(t,r)}if(r&&(r.inputIsMultiGeometry=!1),Ec(t))return this.transformForward(t,r);if(Pc(t))return this.transformForward(t,r);if(Sc(t))return this.transformForward(t,r);if(Ac(t))return this.transformForward(t,r);if(Tc(t))return this.transformForward(t,r);if(Lc(t))return this.transformForward(t,r);throw new Error("Input type not supported")}transformToGeoAsGeojson(t,r){if(!ti(r,this.options).inputIsMultiGeometry){if(Ws(t))return this.transformForwardAsGeojson(t,r);if(Ic(t))return this.transformForwardAsGeojson(t,r);if(Ql(t))return this.transformForwardAsGeojson(t,r);if(Cc(t))return this.transformForwardAsGeojson(t,r);if(tu(t))return this.transformForwardAsGeojson(t,r);if(Mc(t))return this.transformForwardAsGeojson(t,r)}if(r&&(r.inputIsMultiGeometry=!1),Ec(t))return this.transformForwardAsGeojson(t,r);if(Pc(t))return this.transformForwardAsGeojson(t,r);if(Sc(t))return this.transformForwardAsGeojson(t,r);if(Ac(t))return this.transformForwardAsGeojson(t,r);if(Tc(t))return this.transformForwardAsGeojson(t,r);if(Lc(t))return this.transformForwardAsGeojson(t,r);throw new Error("Input type not supported")}transformToResource(t,r){if(!ti(r,this.options).inputIsMultiGeometry){if(Ws(t))return this.transformBackward(t,r);if(Ic(t))return this.transformBackward(t,r);if(Ql(t))return this.transformBackward(t,r);if(Cc(t))return this.transformBackward(t,r);if(tu(t))return this.transformBackward(t,r);if(Mc(t))return this.transformBackward(t,r)}if(r&&(r.inputIsMultiGeometry=!1),Ec(t))return this.transformBackward(t,r);if(Pc(t))return this.transformBackward(t,r);if(Sc(t))return this.transformBackward(t,r);if(Ac(t))return this.transformBackward(t,r);if(Tc(t))return this.transformBackward(t,r);if(Lc(t))return this.transformBackward(t,r);throw new Error("Input type not supported")}transformToResourceAsGeojson(t,r){if(!ti(r,this.options).inputIsMultiGeometry){if(Ws(t))return this.transformBackwardAsGeojson(t,r);if(Ic(t))return this.transformBackwardAsGeojson(t,r);if(Ql(t))return this.transformBackwardAsGeojson(t,r);if(Cc(t))return this.transformBackwardAsGeojson(t,r);if(tu(t))return this.transformBackwardAsGeojson(t,r);if(Mc(t))return this.transformBackwardAsGeojson(t,r)}if(r&&(r.inputIsMultiGeometry=!1),Ec(t))return this.transformBackwardAsGeojson(t,r);if(Pc(t))return this.transformBackwardAsGeojson(t,r);if(Sc(t))return this.transformBackwardAsGeojson(t,r);if(Ac(t))return this.transformBackwardAsGeojson(t,r);if(Tc(t))return this.transformBackwardAsGeojson(t,r);if(Lc(t))return this.transformBackwardAsGeojson(t,r);throw new Error("Input type not supported")}transformSvgToGeojson(t,r){if(t.type==="circle")return this.transformForwardAsGeojson(t.coordinates);if(t.type==="line")return this.transformForwardAsGeojson(t.coordinates,r);if(t.type==="polyline")return this.transformForwardAsGeojson(t.coordinates,r);if(t.type==="rect")return this.transformForwardAsGeojson([t.coordinates],r);if(t.type==="polygon")return this.transformForwardAsGeojson([t.coordinates],r);throw new Error("Unsupported SVG geometry")}transformSvgStringToGeojsonFeatureCollection(t,r){const n=[];for(const i of hN(t)){const l=this.transformSvgToGeojson(i,r);n.push(l)}return JD(n)}transformGeojsonToSvg(t,r){if(t.type==="Point")return{type:"circle",coordinates:this.transformBackward(t)};if(t.type==="LineString")return{type:"polyline",coordinates:this.transformBackward(t,r)};if(t.type==="Polygon")return{type:"polygon",coordinates:this.transformBackward(t,r)[0]};throw new Error("Unsupported GeoJSON geometry")}transformGeojsonFeatureCollectionToSvgString(t,r){const n=[];for(const i of tN(t)){const l=this.transformGeojsonToSvg(i,r);n.push(l)}return dN(n)}assureEqualHandedness(t){var r;return(r=this.options)!=null&&r.differentHandedness?jD(t):t}computeTransformation(t,r){if(this.type==="straight")return new c3(t,r);if(this.type==="helmert")return new YT(t,r);if(this.type==="polynomial1"||this.type==="polynomial")return new uv(t,r);if(this.type==="polynomial2")return new uv(t,r,2);if(this.type==="polynomial3")return new uv(t,r,3);if(this.type==="projective")return new h3(t,r);if(this.type==="thinPlateSpline")return new p3(t,r,d3,f3);throw new Error(`Unsupported transformation type: ${this.type}`)}};const QT=["log2sigma","twoOmega","airyKavr","signDetJ","thetaa"];function y3(e,t,r,n=1){if(!r)return 0;const i=e[0]**2+e[1]**2,l=t[0]**2+t[1]**2,h=e[0]*t[0]+e[1]*t[1],a=Math.sqrt(.5*(i+l+Math.sqrt((i-l)**2+4*h**2))),g=Math.sqrt(.5*(i+l-Math.sqrt((i-l)**2+4*h**2))),_=Math.atan(e[1]/e[0]),E=Math.sign(-h)*Math.asin(Math.sqrt((1-a**2/i)/(1-(a/g)**2)));switch(QT.indexOf(r)){case 0:return(Math.log(a*g)-2*Math.log(n))/Math.log(2);case 1:return 2*Math.asin((a-g)/(a+g));case 2:return .5*(Math.log(a/n)**2+Math.log(g/n)**2);case 3:return Math.sign(e[0]*t[1]-e[1]*t[0]);case 4:return _-E;default:throw new Error("Distortion "+r+" not supported")}}var Pe=(e=>(e.GEOREFERENCEANNOTATIONADDED="georeferenceannotationadded",e.GEOREFERENCEANNOTATIONREMOVED="georeferenceannotationremoved",e.WARPEDMAPADDED="warpedmapadded",e.WARPEDMAPREMOVED="warpedmapremoved",e.WARPEDMAPENTER="warpedmapenter",e.WARPEDMAPLEAVE="warpedmapleave",e.IMAGEINFOLOADED="imageinfoloaded",e.TILEFETCHED="tilefetched",e.TILEFETCHERROR="tilefetcherror",e.MAPTILELOADED="maptileloaded",e.MAPTILEREMOVED="maptileremoved",e.FIRSTMAPTILELOADED="firstmaptileloaded",e.ALLREQUESTEDTILESLOADED="allrequestedtilesloaded",e.TEXTURESUPDATED="texturesupdated",e.ZINDICESCHANGES="zindiceschanged",e.RESOURCEMASKUPDATED="resourcemaskupdated",e.VISIBILITYCHANGED="visibilitychanged",e.TRANSFORMATIONCHANGED="transformationchanged",e.DISTORTIONCHANGED="distortionchanged",e.CHANGED="changed",e.CLEARED="cleared",e))(Pe||{});let Ur=class extends Event{constructor(t,r){super(t),Nt(this,"data"),this.data=r}};const hv={maxOffsetRatio:.05,maxDepth:2,differentHandedness:!0},tI=!0;function _3(){return{visible:tI}}class v3 extends EventTarget{constructor(t,r,n){var i,l;super(),Nt(this,"mapId"),Nt(this,"georeferencedMap"),Nt(this,"gcps"),Nt(this,"projectedGcps"),Nt(this,"resourceMask"),Nt(this,"resourceMaskBbox"),Nt(this,"resourceMaskRectangle"),Nt(this,"resourceFullMask"),Nt(this,"resourceFullMaskBbox"),Nt(this,"resourceFullMaskRectangle"),Nt(this,"imageInformations"),Nt(this,"imageId"),Nt(this,"parsedImage"),Nt(this,"loadingImageInfo"),Nt(this,"fetchFn"),Nt(this,"visible"),Nt(this,"transformationType"),Nt(this,"transformer"),Nt(this,"projectedTransformer"),Nt(this,"transformerByTransformationType",new Map),Nt(this,"projectedTransformerByTransformationType",new Map),Nt(this,"geoMask"),Nt(this,"geoMaskBbox"),Nt(this,"geoMaskRectangle"),Nt(this,"geoFullMask"),Nt(this,"geoFullMaskBbox"),Nt(this,"geoFullMaskRectangle"),Nt(this,"projectedGeoMask"),Nt(this,"projectedGeoMaskBbox"),Nt(this,"projectedGeoMaskRectangle"),Nt(this,"projectedGeoFullMask"),Nt(this,"projectedGeoFullMaskBbox"),Nt(this,"projectedGeoFullMaskRectangle"),Nt(this,"resourceToProjectedGeoScale"),Nt(this,"distortionMeasure"),Nt(this,"bestScaleFactor"),Nt(this,"resourceViewportRing",[]),Nt(this,"resourceViewportRingBbox"),n={..._3(),...n},this.mapId=t,this.georeferencedMap=r,this.gcps=this.georeferencedMap.gcps,this.projectedGcps=this.gcps.map(({resource:h,geo:a})=>({resource:h,geo:Pd(a)})),this.resourceMask=this.georeferencedMap.resourceMask,this.updateResourceMaskProperties(),this.resourceFullMask=[[0,0],[this.georeferencedMap.resource.width,0],[this.georeferencedMap.resource.width,this.georeferencedMap.resource.height],[0,this.georeferencedMap.resource.height]],this.resourceFullMaskBbox=Es(this.resourceFullMask),this.resourceFullMaskRectangle=Qy(this.resourceFullMaskBbox),this.imageInformations=n.imageInformations,this.loadingImageInfo=!1,this.visible=n.visible||tI,this.fetchFn=n.fetchFn,this.transformationType=((i=n.transformation)==null?void 0:i.type)||((l=this.georeferencedMap.transformation)==null?void 0:l.type)||"polynomial",this.updateTransformerProperties()}getViewportMask(t){return this.projectedGeoMask.map(r=>Nd(t.projectedGeoToViewportTransform,r))}getViewportMaskBbox(t){return Es(this.getViewportMask(t))}getViewportMaskRectangle(t){return this.projectedGeoMaskRectangle.map(r=>Nd(t.projectedGeoToViewportTransform,r))}getViewportFullMask(t){return this.projectedGeoFullMask.map(r=>Nd(t.projectedGeoToViewportTransform,r))}getViewportFullMaskBbox(t){return Es(this.getViewportFullMask(t))}getViewportFullMaskRectangle(t){return this.projectedGeoFullMaskRectangle.map(r=>Nd(t.projectedGeoToViewportTransform,r))}getResourceToViewportScale(t){return gE(this.resourceMaskRectangle,this.getViewportMaskRectangle(t))}getResourceToCanvasScale(t){return this.getResourceToViewportScale(t)/t.devicePixelRatio}getReferenceScale(){const t=zy(this.projectedTransformerByTransformationType,"helmert",()=>new cv(this.projectedGcps,"helmert",hv));return t.forwardTransformation||t.createForwardTransformation(),t.forwardTransformation.scale}setResourceViewportRing(t){this.resourceViewportRing=t,this.resourceViewportRingBbox=Es(t)}setResourceMask(t){this.resourceMask=t,this.updateResourceMaskProperties(),this.updateGeoMask(),this.updateProjectedGeoMask(),this.updateResourceToProjectedGeoScale()}setTransformationType(t){this.transformationType=t,this.updateTransformerProperties()}setDistortionMeasure(t){this.distortionMeasure=t}setGcps(t){this.gcps=t,this.updateTransformerProperties(!1)}setBestScaleFactor(t){const r=this.bestScaleFactor!=t;return r&&(this.bestScaleFactor=t),r}hasImageInfo(){return this.imageId!==void 0&&this.parsedImage!==void 0}async loadImageInfo(){var t,r;try{this.loadingImageInfo=!0;const n=this.georeferencedMap.resource.id;let i;(t=this.imageInformations)!=null&&t.get(n)?i=this.imageInformations.get(n):(i=await OD(n,void 0,this.fetchFn),(r=this.imageInformations)==null||r.set(n,i)),this.parsedImage=Jk.parse(i),this.imageId=await XS(n),this.dispatchEvent(new Ur(Pe.IMAGEINFOLOADED))}catch(n){throw this.loadingImageInfo=!1,n}finally{this.loadingImageInfo=!1}}dispose(){}updateResourceMaskProperties(){this.resourceMaskBbox=Es(this.resourceMask),this.resourceMaskRectangle=Qy(this.resourceMaskBbox)}updateTransformerProperties(t=!0){this.updateTransformer(t),this.updateProjectedTransformer(t),this.updateGeoMask(),this.updateFullGeoMask(),this.updateProjectedGeoMask(),this.updateProjectedFullGeoMask(),this.updateResourceToProjectedGeoScale()}updateTransformer(t=!0){this.transformer=zy(this.transformerByTransformationType,this.transformationType,()=>new cv(this.gcps,this.transformationType,hv),t)}updateProjectedTransformer(t=!0){this.projectedTransformer=zy(this.projectedTransformerByTransformationType,this.transformationType,()=>new cv(this.projectedGcps,this.transformationType,hv),t)}updateGeoMask(){this.geoMask=this.transformer.transformForwardAsGeojson([this.resourceMask]),this.geoMaskBbox=Es(this.geoMask),this.geoMaskRectangle=this.transformer.transformForward([this.resourceMaskRectangle],{maxDepth:0})[0]}updateFullGeoMask(){this.geoFullMask=this.transformer.transformForwardAsGeojson([this.resourceFullMask]),this.geoFullMaskBbox=Es(this.geoFullMask),this.geoFullMaskRectangle=this.transformer.transformForward([this.resourceFullMaskRectangle],{maxDepth:0})[0]}updateProjectedGeoMask(){this.projectedGeoMask=this.projectedTransformer.transformForward([this.resourceMask])[0],this.projectedGeoMaskBbox=Es(this.projectedGeoMask),this.projectedGeoMaskRectangle=this.projectedTransformer.transformForward([this.resourceMaskRectangle],{maxDepth:0})[0]}updateProjectedFullGeoMask(){this.projectedGeoFullMask=this.projectedTransformer.transformForward([this.resourceFullMask])[0],this.projectedGeoFullMaskBbox=Es(this.projectedGeoFullMask),this.projectedGeoFullMaskRectangle=this.projectedTransformer.transformForward([this.resourceFullMaskRectangle],{maxDepth:0})[0]}updateResourceToProjectedGeoScale(){this.resourceToProjectedGeoScale=gE(this.resourceMaskRectangle,this.projectedGeoMaskRectangle)}}function x3(e){return Math.sqrt(Math.pow(e[1][0]-e[0][0],2)+Math.pow(e[1][1]-e[0][1],2))}function b3(e){return Math.atan2(e[1][1]-e[0][1],e[1][0]-e[0][0])}function w3(e,t,r){return[e[0]+Math.cos(r)*t,e[1]+Math.sin(r)*t]}function E3(e,t){let r=e[0];const n=[r];for(;x3([r,e[1]])>t;){const i=w3(r,t,b3(e));n.push(i),r=i}return n}function S3(e,t){e=[...e,e[0]];let r=[];for(let n=0;n<e.length-1;n++)r=r.concat(E3([e[n],e[n+1]],t));return r}function T3(e,t){const r=[],n=Es(e);for(let i=n[0]+t,l=0;i<=n[2];l++,i+=t)for(let h=n[1]+t,a=0;h<=n[3];a++,h+=t)r.push([i,h]);return r}function I3(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var eI={exports:{}},rI=C3,FE=+(Math.pow(2,27)+1);function C3(e,t,r){var n=e*t,i=FE*e,l=i-e,h=i-l,a=e-h,g=FE*t,_=g-t,E=g-_,S=t-E,A=n-h*E,O=A-a*E,k=O-h*S,G=a*S-k;return r?(r[0]=G,r[1]=n,r):[G,n]}var M3=A3;function P3(e,t){var r=e+t,n=r-e,i=r-n,l=t-n,h=e-i,a=h+l;return a?[a,r]:[r]}function A3(e,t){var r=e.length|0,n=t.length|0;if(r===1&&n===1)return P3(e[0],t[0]);var i=r+n,l=new Array(i),h=0,a=0,g=0,_=Math.abs,E=e[a],S=_(E),A=t[g],O=_(A),k,G;S<O?(G=E,a+=1,a<r&&(E=e[a],S=_(E))):(G=A,g+=1,g<n&&(A=t[g],O=_(A))),a<r&&S<O||g>=n?(k=E,a+=1,a<r&&(E=e[a],S=_(E))):(k=A,g+=1,g<n&&(A=t[g],O=_(A)));for(var W=k+G,U=W-k,tt=G-U,$=tt,V=W,it,vt,ot,et,wt;a<r&&g<n;)S<O?(k=E,a+=1,a<r&&(E=e[a],S=_(E))):(k=A,g+=1,g<n&&(A=t[g],O=_(A))),G=$,W=k+G,U=W-k,tt=G-U,tt&&(l[h++]=tt),it=V+W,vt=it-V,ot=it-vt,et=W-vt,wt=V-ot,$=wt+et,V=it;for(;a<r;)k=E,G=$,W=k+G,U=W-k,tt=G-U,tt&&(l[h++]=tt),it=V+W,vt=it-V,ot=it-vt,et=W-vt,wt=V-ot,$=wt+et,V=it,a+=1,a<r&&(E=e[a]);for(;g<n;)k=A,G=$,W=k+G,U=W-k,tt=G-U,tt&&(l[h++]=tt),it=V+W,vt=it-V,ot=it-vt,et=W-vt,wt=V-ot,$=wt+et,V=it,g+=1,g<n&&(A=t[g]);return $&&(l[h++]=$),V&&(l[h++]=V),h||(l[h++]=0),l.length=h,l}var L3=R3;function R3(e,t,r){var n=e+t,i=n-e,l=n-i,h=t-i,a=e-l;return r?(r[0]=a+h,r[1]=n,r):[a+h,n]}var pv=rI,D3=L3,N3=k3;function k3(e,t){var r=e.length;if(r===1){var n=pv(e[0],t);return n[0]?n:[n[1]]}var i=new Array(2*r),l=[.1,.1],h=[.1,.1],a=0;pv(e[0],t,l),l[0]&&(i[a++]=l[0]);for(var g=1;g<r;++g){pv(e[g],t,h);var _=l[1];D3(_,h[0],l),l[0]&&(i[a++]=l[0]);var E=h[1],S=l[1],A=E+S,O=A-E,k=S-O;l[1]=A,k&&(i[a++]=k)}return l[1]&&(i[a++]=l[1]),a===0&&(i[a++]=0),i.length=a,i}var O3=z3;function F3(e,t){var r=e+t,n=r-e,i=r-n,l=t-n,h=e-i,a=h+l;return a?[a,r]:[r]}function z3(e,t){var r=e.length|0,n=t.length|0;if(r===1&&n===1)return F3(e[0],-t[0]);var i=r+n,l=new Array(i),h=0,a=0,g=0,_=Math.abs,E=e[a],S=_(E),A=-t[g],O=_(A),k,G;S<O?(G=E,a+=1,a<r&&(E=e[a],S=_(E))):(G=A,g+=1,g<n&&(A=-t[g],O=_(A))),a<r&&S<O||g>=n?(k=E,a+=1,a<r&&(E=e[a],S=_(E))):(k=A,g+=1,g<n&&(A=-t[g],O=_(A)));for(var W=k+G,U=W-k,tt=G-U,$=tt,V=W,it,vt,ot,et,wt;a<r&&g<n;)S<O?(k=E,a+=1,a<r&&(E=e[a],S=_(E))):(k=A,g+=1,g<n&&(A=-t[g],O=_(A))),G=$,W=k+G,U=W-k,tt=G-U,tt&&(l[h++]=tt),it=V+W,vt=it-V,ot=it-vt,et=W-vt,wt=V-ot,$=wt+et,V=it;for(;a<r;)k=E,G=$,W=k+G,U=W-k,tt=G-U,tt&&(l[h++]=tt),it=V+W,vt=it-V,ot=it-vt,et=W-vt,wt=V-ot,$=wt+et,V=it,a+=1,a<r&&(E=e[a]);for(;g<n;)k=A,G=$,W=k+G,U=W-k,tt=G-U,tt&&(l[h++]=tt),it=V+W,vt=it-V,ot=it-vt,et=W-vt,wt=V-ot,$=wt+et,V=it,g+=1,g<n&&(A=-t[g]);return $&&(l[h++]=$),V&&(l[h++]=V),h||(l[h++]=0),l.length=h,l}(function(e){var t=rI,r=M3,n=N3,i=O3,l=5,h=11102230246251565e-32,a=(3+16*h)*h,g=(7+56*h)*h;function _($,V,it,vt){return function(ot,et,wt){var J=$($(V(et[1],wt[0]),V(-wt[1],et[0])),$(V(ot[1],et[0]),V(-et[1],ot[0]))),xt=$(V(ot[1],wt[0]),V(-wt[1],ot[0])),$t=vt(J,xt);return $t[$t.length-1]}}function E($,V,it,vt){return function(ot,et,wt,J){var xt=$($(it($(V(wt[1],J[0]),V(-J[1],wt[0])),et[2]),$(it($(V(et[1],J[0]),V(-J[1],et[0])),-wt[2]),it($(V(et[1],wt[0]),V(-wt[1],et[0])),J[2]))),$(it($(V(et[1],J[0]),V(-J[1],et[0])),ot[2]),$(it($(V(ot[1],J[0]),V(-J[1],ot[0])),-et[2]),it($(V(ot[1],et[0]),V(-et[1],ot[0])),J[2])))),$t=$($(it($(V(wt[1],J[0]),V(-J[1],wt[0])),ot[2]),$(it($(V(ot[1],J[0]),V(-J[1],ot[0])),-wt[2]),it($(V(ot[1],wt[0]),V(-wt[1],ot[0])),J[2]))),$(it($(V(et[1],wt[0]),V(-wt[1],et[0])),ot[2]),$(it($(V(ot[1],wt[0]),V(-wt[1],ot[0])),-et[2]),it($(V(ot[1],et[0]),V(-et[1],ot[0])),wt[2])))),Ut=vt(xt,$t);return Ut[Ut.length-1]}}function S($,V,it,vt){return function(ot,et,wt,J,xt){var $t=$($($(it($(it($(V(J[1],xt[0]),V(-xt[1],J[0])),wt[2]),$(it($(V(wt[1],xt[0]),V(-xt[1],wt[0])),-J[2]),it($(V(wt[1],J[0]),V(-J[1],wt[0])),xt[2]))),et[3]),$(it($(it($(V(J[1],xt[0]),V(-xt[1],J[0])),et[2]),$(it($(V(et[1],xt[0]),V(-xt[1],et[0])),-J[2]),it($(V(et[1],J[0]),V(-J[1],et[0])),xt[2]))),-wt[3]),it($(it($(V(wt[1],xt[0]),V(-xt[1],wt[0])),et[2]),$(it($(V(et[1],xt[0]),V(-xt[1],et[0])),-wt[2]),it($(V(et[1],wt[0]),V(-wt[1],et[0])),xt[2]))),J[3]))),$(it($(it($(V(wt[1],J[0]),V(-J[1],wt[0])),et[2]),$(it($(V(et[1],J[0]),V(-J[1],et[0])),-wt[2]),it($(V(et[1],wt[0]),V(-wt[1],et[0])),J[2]))),-xt[3]),$(it($(it($(V(J[1],xt[0]),V(-xt[1],J[0])),et[2]),$(it($(V(et[1],xt[0]),V(-xt[1],et[0])),-J[2]),it($(V(et[1],J[0]),V(-J[1],et[0])),xt[2]))),ot[3]),it($(it($(V(J[1],xt[0]),V(-xt[1],J[0])),ot[2]),$(it($(V(ot[1],xt[0]),V(-xt[1],ot[0])),-J[2]),it($(V(ot[1],J[0]),V(-J[1],ot[0])),xt[2]))),-et[3])))),$($(it($(it($(V(et[1],xt[0]),V(-xt[1],et[0])),ot[2]),$(it($(V(ot[1],xt[0]),V(-xt[1],ot[0])),-et[2]),it($(V(ot[1],et[0]),V(-et[1],ot[0])),xt[2]))),J[3]),$(it($(it($(V(et[1],J[0]),V(-J[1],et[0])),ot[2]),$(it($(V(ot[1],J[0]),V(-J[1],ot[0])),-et[2]),it($(V(ot[1],et[0]),V(-et[1],ot[0])),J[2]))),-xt[3]),it($(it($(V(wt[1],J[0]),V(-J[1],wt[0])),et[2]),$(it($(V(et[1],J[0]),V(-J[1],et[0])),-wt[2]),it($(V(et[1],wt[0]),V(-wt[1],et[0])),J[2]))),ot[3]))),$(it($(it($(V(wt[1],J[0]),V(-J[1],wt[0])),ot[2]),$(it($(V(ot[1],J[0]),V(-J[1],ot[0])),-wt[2]),it($(V(ot[1],wt[0]),V(-wt[1],ot[0])),J[2]))),-et[3]),$(it($(it($(V(et[1],J[0]),V(-J[1],et[0])),ot[2]),$(it($(V(ot[1],J[0]),V(-J[1],ot[0])),-et[2]),it($(V(ot[1],et[0]),V(-et[1],ot[0])),J[2]))),wt[3]),it($(it($(V(et[1],wt[0]),V(-wt[1],et[0])),ot[2]),$(it($(V(ot[1],wt[0]),V(-wt[1],ot[0])),-et[2]),it($(V(ot[1],et[0]),V(-et[1],ot[0])),wt[2]))),-J[3]))))),Ut=$($($(it($(it($(V(J[1],xt[0]),V(-xt[1],J[0])),wt[2]),$(it($(V(wt[1],xt[0]),V(-xt[1],wt[0])),-J[2]),it($(V(wt[1],J[0]),V(-J[1],wt[0])),xt[2]))),ot[3]),it($(it($(V(J[1],xt[0]),V(-xt[1],J[0])),ot[2]),$(it($(V(ot[1],xt[0]),V(-xt[1],ot[0])),-J[2]),it($(V(ot[1],J[0]),V(-J[1],ot[0])),xt[2]))),-wt[3])),$(it($(it($(V(wt[1],xt[0]),V(-xt[1],wt[0])),ot[2]),$(it($(V(ot[1],xt[0]),V(-xt[1],ot[0])),-wt[2]),it($(V(ot[1],wt[0]),V(-wt[1],ot[0])),xt[2]))),J[3]),it($(it($(V(wt[1],J[0]),V(-J[1],wt[0])),ot[2]),$(it($(V(ot[1],J[0]),V(-J[1],ot[0])),-wt[2]),it($(V(ot[1],wt[0]),V(-wt[1],ot[0])),J[2]))),-xt[3]))),$($(it($(it($(V(wt[1],xt[0]),V(-xt[1],wt[0])),et[2]),$(it($(V(et[1],xt[0]),V(-xt[1],et[0])),-wt[2]),it($(V(et[1],wt[0]),V(-wt[1],et[0])),xt[2]))),ot[3]),it($(it($(V(wt[1],xt[0]),V(-xt[1],wt[0])),ot[2]),$(it($(V(ot[1],xt[0]),V(-xt[1],ot[0])),-wt[2]),it($(V(ot[1],wt[0]),V(-wt[1],ot[0])),xt[2]))),-et[3])),$(it($(it($(V(et[1],xt[0]),V(-xt[1],et[0])),ot[2]),$(it($(V(ot[1],xt[0]),V(-xt[1],ot[0])),-et[2]),it($(V(ot[1],et[0]),V(-et[1],ot[0])),xt[2]))),wt[3]),it($(it($(V(et[1],wt[0]),V(-wt[1],et[0])),ot[2]),$(it($(V(ot[1],wt[0]),V(-wt[1],ot[0])),-et[2]),it($(V(ot[1],et[0]),V(-et[1],ot[0])),wt[2]))),-xt[3])))),Ot=vt($t,Ut);return Ot[Ot.length-1]}}function A($){var V=$===3?_:$===4?E:S;return V(r,t,n,i)}var O=A(3),k=A(4),G=[function(){return 0},function(){return 0},function($,V){return V[0]-$[0]},function($,V,it){var vt=($[1]-it[1])*(V[0]-it[0]),ot=($[0]-it[0])*(V[1]-it[1]),et=vt-ot,wt;if(vt>0){if(ot<=0)return et;wt=vt+ot}else if(vt<0){if(ot>=0)return et;wt=-(vt+ot)}else return et;var J=a*wt;return et>=J||et<=-J?et:O($,V,it)},function($,V,it,vt){var ot=$[0]-vt[0],et=V[0]-vt[0],wt=it[0]-vt[0],J=$[1]-vt[1],xt=V[1]-vt[1],$t=it[1]-vt[1],Ut=$[2]-vt[2],Ot=V[2]-vt[2],te=it[2]-vt[2],ye=et*$t,Me=wt*xt,ir=wt*J,xr=ot*$t,_r=ot*xt,kr=et*J,vr=Ut*(ye-Me)+Ot*(ir-xr)+te*(_r-kr),ue=(Math.abs(ye)+Math.abs(Me))*Math.abs(Ut)+(Math.abs(ir)+Math.abs(xr))*Math.abs(Ot)+(Math.abs(_r)+Math.abs(kr))*Math.abs(te),nr=g*ue;return vr>nr||-vr>nr?vr:k($,V,it,vt)}];function W($){var V=G[$.length];return V||(V=G[$.length]=A($.length)),V.apply(void 0,$)}function U($,V,it,vt,ot,et,wt){return function(J,xt,$t,Ut,Ot){switch(arguments.length){case 0:case 1:return 0;case 2:return vt(J,xt);case 3:return ot(J,xt,$t);case 4:return et(J,xt,$t,Ut);case 5:return wt(J,xt,$t,Ut,Ot)}for(var te=new Array(arguments.length),ye=0;ye<arguments.length;++ye)te[ye]=arguments[ye];return $(te)}}function tt(){for(;G.length<=l;)G.push(A(G.length));e.exports=U.apply(void 0,[W].concat(G));for(var $=0;$<=l;++$)e.exports[$]=G[$]}tt()})(eI);var B3=eI.exports,$3=U3,Sy=B3;function U3(e,t){for(var r=t[0],n=t[1],i=e.length,l=1,h=i,a=0,g=i-1;a<h;g=a++){var _=e[a],E=e[g],S=_[1],A=E[1];if(A<S){if(A<n&&n<S){var O=Sy(_,E,t);if(O===0)return 0;l^=0<O|0}else if(n===S){var k=e[(a+1)%i],G=k[1];if(S<G){var O=Sy(_,E,t);if(O===0)return 0;l^=0<O|0}}}else if(S<A){if(S<n&&n<A){var O=Sy(_,E,t);if(O===0)return 0;l^=O<0|0}else if(n===S){var k=e[(a+1)%i],G=k[1];if(G<S){var O=Sy(_,E,t);if(O===0)return 0;l^=O<0|0}}}else if(n===S){var W=Math.min(_[0],E[0]),U=Math.max(_[0],E[0]);if(a===0){for(;g>0;){var tt=(g+i-1)%i,$=e[tt];if($[1]!==n)break;var V=$[0];W=Math.min(W,V),U=Math.max(U,V),g=tt}if(g===0)return W<=r&&r<=U?0:1;h=g+1}for(var it=e[(g+i-1)%i][1];a+1<h;){var $=e[a+1];if($[1]!==n)break;var V=$[0];W=Math.min(W,V),U=Math.max(U,V),a+=1}if(W<=r&&r<=U)return 0;var vt=e[(a+1)%i][1];r<W&&it<n!=vt<n&&(l^=1)}}return 2*l-1}const j3=I3($3);var nI={};const V3="1.5.0",G3={version:V3};function iI(e){return"("+e.x+";"+e.y+")"}function q3(e){var t=e.toString();return t==="[object Object]"?iI(e):t}function Z3(e,t){return e.y===t.y?e.x-t.x:e.y-t.y}function W3(e,t){return e.x===t.x&&e.y===t.y}var Hx={toString:q3,toStringBase:iI,compare:Z3,equals:W3},X3=Hx,f_=function(e,t){this.name="PointError",this.points=t=t||[],this.message=e||"Invalid Points!";for(var r=0;r<t.length;r++)this.message+=" "+X3.toString(t[r])};f_.prototype=new Error;f_.prototype.constructor=f_;var Yx=f_,vg=Hx,Tn=function(e,t){this.x=+e||0,this.y=+t||0,this._p2t_edge_list=null};Tn.prototype.toString=function(){return vg.toStringBase(this)};Tn.prototype.toJSON=function(){return{x:this.x,y:this.y}};Tn.prototype.clone=function(){return new Tn(this.x,this.y)};Tn.prototype.set_zero=function(){return this.x=0,this.y=0,this};Tn.prototype.set=function(e,t){return this.x=+e||0,this.y=+t||0,this};Tn.prototype.negate=function(){return this.x=-this.x,this.y=-this.y,this};Tn.prototype.add=function(e){return this.x+=e.x,this.y+=e.y,this};Tn.prototype.sub=function(e){return this.x-=e.x,this.y-=e.y,this};Tn.prototype.mul=function(e){return this.x*=e,this.y*=e,this};Tn.prototype.length=function(){return Math.sqrt(this.x*this.x+this.y*this.y)};Tn.prototype.normalize=function(){var e=this.length();return this.x/=e,this.y/=e,e};Tn.prototype.equals=function(e){return this.x===e.x&&this.y===e.y};Tn.negate=function(e){return new Tn(-e.x,-e.y)};Tn.add=function(e,t){return new Tn(e.x+t.x,e.y+t.y)};Tn.sub=function(e,t){return new Tn(e.x-t.x,e.y-t.y)};Tn.mul=function(e,t){return new Tn(e*t.x,e*t.y)};Tn.cross=function(e,t){return typeof e=="number"?typeof t=="number"?e*t:new Tn(-e*t.y,e*t.x):typeof t=="number"?new Tn(t*e.y,-t*e.x):e.x*t.y-e.y*t.x};Tn.toString=vg.toString;Tn.compare=vg.compare;Tn.cmp=vg.compare;Tn.equals=vg.equals;Tn.dot=function(e,t){return e.x*t.x+e.y*t.y};var oI=Tn,H3=Hx,Hr=function(e,t,r){this.points_=[e,t,r],this.neighbors_=[null,null,null],this.interior_=!1,this.constrained_edge=[!1,!1,!1],this.delaunay_edge=[!1,!1,!1]},dv=H3.toString;Hr.prototype.toString=function(){return"["+dv(this.points_[0])+dv(this.points_[1])+dv(this.points_[2])+"]"};Hr.prototype.getPoint=function(e){return this.points_[e]};Hr.prototype.GetPoint=Hr.prototype.getPoint;Hr.prototype.getPoints=function(){return this.points_};Hr.prototype.getNeighbor=function(e){return this.neighbors_[e]};Hr.prototype.containsPoint=function(e){var t=this.points_;return e===t[0]||e===t[1]||e===t[2]};Hr.prototype.containsEdge=function(e){return this.containsPoint(e.p)&&this.containsPoint(e.q)};Hr.prototype.containsPoints=function(e,t){return this.containsPoint(e)&&this.containsPoint(t)};Hr.prototype.isInterior=function(){return this.interior_};Hr.prototype.setInterior=function(e){return this.interior_=e,this};Hr.prototype.markNeighborPointers=function(e,t,r){var n=this.points_;if(e===n[2]&&t===n[1]||e===n[1]&&t===n[2])this.neighbors_[0]=r;else if(e===n[0]&&t===n[2]||e===n[2]&&t===n[0])this.neighbors_[1]=r;else if(e===n[0]&&t===n[1]||e===n[1]&&t===n[0])this.neighbors_[2]=r;else throw new Error("poly2tri Invalid Triangle.markNeighborPointers() call")};Hr.prototype.markNeighbor=function(e){var t=this.points_;e.containsPoints(t[1],t[2])?(this.neighbors_[0]=e,e.markNeighborPointers(t[1],t[2],this)):e.containsPoints(t[0],t[2])?(this.neighbors_[1]=e,e.markNeighborPointers(t[0],t[2],this)):e.containsPoints(t[0],t[1])&&(this.neighbors_[2]=e,e.markNeighborPointers(t[0],t[1],this))};Hr.prototype.clearNeighbors=function(){this.neighbors_[0]=null,this.neighbors_[1]=null,this.neighbors_[2]=null};Hr.prototype.clearDelaunayEdges=function(){this.delaunay_edge[0]=!1,this.delaunay_edge[1]=!1,this.delaunay_edge[2]=!1};Hr.prototype.pointCW=function(e){var t=this.points_;return e===t[0]?t[2]:e===t[1]?t[0]:e===t[2]?t[1]:null};Hr.prototype.pointCCW=function(e){var t=this.points_;return e===t[0]?t[1]:e===t[1]?t[2]:e===t[2]?t[0]:null};Hr.prototype.neighborCW=function(e){return e===this.points_[0]?this.neighbors_[1]:e===this.points_[1]?this.neighbors_[2]:this.neighbors_[0]};Hr.prototype.neighborCCW=function(e){return e===this.points_[0]?this.neighbors_[2]:e===this.points_[1]?this.neighbors_[0]:this.neighbors_[1]};Hr.prototype.getConstrainedEdgeCW=function(e){return e===this.points_[0]?this.constrained_edge[1]:e===this.points_[1]?this.constrained_edge[2]:this.constrained_edge[0]};Hr.prototype.getConstrainedEdgeCCW=function(e){return e===this.points_[0]?this.constrained_edge[2]:e===this.points_[1]?this.constrained_edge[0]:this.constrained_edge[1]};Hr.prototype.getConstrainedEdgeAcross=function(e){return e===this.points_[0]?this.constrained_edge[0]:e===this.points_[1]?this.constrained_edge[1]:this.constrained_edge[2]};Hr.prototype.setConstrainedEdgeCW=function(e,t){e===this.points_[0]?this.constrained_edge[1]=t:e===this.points_[1]?this.constrained_edge[2]=t:this.constrained_edge[0]=t};Hr.prototype.setConstrainedEdgeCCW=function(e,t){e===this.points_[0]?this.constrained_edge[2]=t:e===this.points_[1]?this.constrained_edge[0]=t:this.constrained_edge[1]=t};Hr.prototype.getDelaunayEdgeCW=function(e){return e===this.points_[0]?this.delaunay_edge[1]:e===this.points_[1]?this.delaunay_edge[2]:this.delaunay_edge[0]};Hr.prototype.getDelaunayEdgeCCW=function(e){return e===this.points_[0]?this.delaunay_edge[2]:e===this.points_[1]?this.delaunay_edge[0]:this.delaunay_edge[1]};Hr.prototype.setDelaunayEdgeCW=function(e,t){e===this.points_[0]?this.delaunay_edge[1]=t:e===this.points_[1]?this.delaunay_edge[2]=t:this.delaunay_edge[0]=t};Hr.prototype.setDelaunayEdgeCCW=function(e,t){e===this.points_[0]?this.delaunay_edge[2]=t:e===this.points_[1]?this.delaunay_edge[0]=t:this.delaunay_edge[1]=t};Hr.prototype.neighborAcross=function(e){return e===this.points_[0]?this.neighbors_[0]:e===this.points_[1]?this.neighbors_[1]:this.neighbors_[2]};Hr.prototype.oppositePoint=function(e,t){var r=e.pointCW(t);return this.pointCW(r)};Hr.prototype.legalize=function(e,t){var r=this.points_;if(e===r[0])r[1]=r[0],r[0]=r[2],r[2]=t;else if(e===r[1])r[2]=r[1],r[1]=r[0],r[0]=t;else if(e===r[2])r[0]=r[2],r[2]=r[1],r[1]=t;else throw new Error("poly2tri Invalid Triangle.legalize() call")};Hr.prototype.index=function(e){var t=this.points_;if(e===t[0])return 0;if(e===t[1])return 1;if(e===t[2])return 2;throw new Error("poly2tri Invalid Triangle.index() call")};Hr.prototype.edgeIndex=function(e,t){var r=this.points_;if(e===r[0]){if(t===r[1])return 2;if(t===r[2])return 1}else if(e===r[1]){if(t===r[2])return 0;if(t===r[0])return 2}else if(e===r[2]){if(t===r[0])return 1;if(t===r[1])return 0}return-1};Hr.prototype.markConstrainedEdgeByIndex=function(e){this.constrained_edge[e]=!0};Hr.prototype.markConstrainedEdgeByEdge=function(e){this.markConstrainedEdgeByPoints(e.p,e.q)};Hr.prototype.markConstrainedEdgeByPoints=function(e,t){var r=this.points_;t===r[0]&&e===r[1]||t===r[1]&&e===r[0]?this.constrained_edge[2]=!0:t===r[0]&&e===r[2]||t===r[2]&&e===r[0]?this.constrained_edge[1]=!0:(t===r[1]&&e===r[2]||t===r[2]&&e===r[1])&&(this.constrained_edge[0]=!0)};var Kx=Hr,Jx={};function Y3(e,t){if(!e)throw new Error(t||"Assert Failed")}var K3=Y3,Qx={exports:{}},J3=function(e,t){this.point=e,this.triangle=t||null,this.next=null,this.prev=null,this.value=e.x},Hu=function(e,t){this.head_=e,this.tail_=t,this.search_node_=e};Hu.prototype.head=function(){return this.head_};Hu.prototype.setHead=function(e){this.head_=e};Hu.prototype.tail=function(){return this.tail_};Hu.prototype.setTail=function(e){this.tail_=e};Hu.prototype.search=function(){return this.search_node_};Hu.prototype.setSearch=function(e){this.search_node_=e};Hu.prototype.findSearchNode=function(){return this.search_node_};Hu.prototype.locateNode=function(e){var t=this.search_node_;if(e<t.value){for(;t=t.prev;)if(e>=t.value)return this.search_node_=t,t}else for(;t=t.next;)if(e<t.value)return this.search_node_=t.prev,t.prev;return null};Hu.prototype.locatePoint=function(e){var t=e.x,r=this.findSearchNode(t),n=r.point.x;if(t===n){if(e!==r.point)if(e===r.prev.point)r=r.prev;else if(e===r.next.point)r=r.next;else throw new Error("poly2tri Invalid AdvancingFront.locatePoint() call")}else if(t<n)for(;(r=r.prev)&&e!==r.point;);else for(;(r=r.next)&&e!==r.point;);return r&&(this.search_node_=r),r};Qx.exports=Hu;Qx.exports.Node=J3;var sI=Qx.exports,yf={},Km=1e-12;yf.EPSILON=Km;var Vy={CW:1,CCW:-1,COLLINEAR:0};yf.Orientation=Vy;function Q3(e,t,r){var n=(e.x-r.x)*(t.y-r.y),i=(e.y-r.y)*(t.x-r.x),l=n-i;return l>-Km&&l<Km?Vy.COLLINEAR:l>0?Vy.CCW:Vy.CW}yf.orient2d=Q3;function tF(e,t,r,n){var i=(e.x-t.x)*(n.y-t.y)-(n.x-t.x)*(e.y-t.y);if(i>=-Km)return!1;var l=(e.x-r.x)*(n.y-r.y)-(n.x-r.x)*(e.y-r.y);return!(l<=Km)}yf.inScanArea=tF;function eF(e,t,r){var n=t.x-e.x,i=t.y-e.y,l=r.x-e.x,h=r.y-e.y;return n*l+i*h<0}yf.isAngleObtuse=eF;var t1=K3,m_=Yx,aI=Kx,rF=sI.Node,xg=yf,nF=xg.EPSILON,Xi=xg.Orientation,wo=xg.orient2d,lI=xg.inScanArea,zE=xg.isAngleObtuse;function iF(e){e.initTriangulation(),e.createAdvancingFront(),oF(e),sF(e)}function oF(e){var t,r=e.pointCount();for(t=1;t<r;++t)for(var n=e.getPoint(t),i=aF(e,n),l=n._p2t_edge_list,h=0;l&&h<l.length;++h)lF(e,l[h],i)}function sF(e){for(var t=e.front().head().next.triangle,r=e.front().head().next.point;!t.getConstrainedEdgeCW(r);)t=t.neighborCCW(r);e.meshClean(t)}function aF(e,t){var r=e.locateNode(t),n=uF(e,t,r);return t.x<=r.point.x+nF&&qd(e,r),cF(e,n),n}function lF(e,t,r){e.edge_event.constrained_edge=t,e.edge_event.right=t.p.x>t.q.x,!uI(r.triangle,t.p,t.q)&&(mF(e,t,r),e1(e,t.p,t.q,r.triangle,t.q))}function e1(e,t,r,n,i){if(!uI(n,t,r)){var l=n.pointCCW(i),h=wo(r,l,t);if(h===Xi.COLLINEAR)throw new m_("poly2tri EdgeEvent: Collinear not supported!",[r,l,t]);var a=n.pointCW(i),g=wo(r,a,t);if(g===Xi.COLLINEAR)throw new m_("poly2tri EdgeEvent: Collinear not supported!",[r,a,t]);h===g?(h===Xi.CW?n=n.neighborCCW(i):n=n.neighborCW(i),e1(e,t,r,n,i)):i1(e,t,r,n,i)}}function uI(e,t,r){var n=e.edgeIndex(t,r);if(n!==-1){e.markConstrainedEdgeByIndex(n);var i=e.getNeighbor(n);return i&&i.markConstrainedEdgeByPoints(t,r),!0}return!1}function uF(e,t,r){var n=new aI(t,r.point,r.next.point);n.markNeighbor(r.triangle),e.addToMap(n);var i=new rF(t);return i.next=r.next,i.prev=r,r.next.prev=i,r.next=i,Wh(e,n)||e.mapTriangleToNodes(n),i}function qd(e,t){var r=new aI(t.prev.point,t.point,t.next.point);r.markNeighbor(t.prev.triangle),r.markNeighbor(t.triangle),e.addToMap(r),t.prev.next=t.next,t.next.prev=t.prev,Wh(e,r)||e.mapTriangleToNodes(r)}function cF(e,t){for(var r=t.next;r.next&&!zE(r.point,r.next.point,r.prev.point);)qd(e,r),r=r.next;for(r=t.prev;r.prev&&!zE(r.point,r.next.point,r.prev.point);)qd(e,r),r=r.prev;t.next&&t.next.next&&hF(t)&&dF(e,t)}function hF(e){var t=e.point.x-e.next.next.point.x,r=e.point.y-e.next.next.point.y;return t1(r>=0,"unordered y"),t>=0||Math.abs(t)<r}function Wh(e,t){for(var r=0;r<3;++r)if(!t.delaunay_edge[r]){var n=t.getNeighbor(r);if(n){var i=t.getPoint(r),l=n.oppositePoint(t,i),h=n.index(l);if(n.constrained_edge[h]||n.delaunay_edge[h]){t.constrained_edge[r]=n.constrained_edge[h];continue}var a=pF(i,t.pointCCW(i),t.pointCW(i),l);if(a){t.delaunay_edge[r]=!0,n.delaunay_edge[h]=!0,cI(t,i,n,l);var g=!Wh(e,t);return g&&e.mapTriangleToNodes(t),g=!Wh(e,n),g&&e.mapTriangleToNodes(n),t.delaunay_edge[r]=!1,n.delaunay_edge[h]=!1,!0}}}return!1}function pF(e,t,r,n){var i=e.x-n.x,l=e.y-n.y,h=t.x-n.x,a=t.y-n.y,g=i*a,_=h*l,E=g-_;if(E<=0)return!1;var S=r.x-n.x,A=r.y-n.y,O=S*l,k=i*A,G=O-k;if(G<=0)return!1;var W=h*A,U=S*a,tt=i*i+l*l,$=h*h+a*a,V=S*S+A*A,it=tt*(W-U)+$*G+V*E;return it>0}function cI(e,t,r,n){var i,l,h,a;i=e.neighborCCW(t),l=e.neighborCW(t),h=r.neighborCCW(n),a=r.neighborCW(n);var g,_,E,S;g=e.getConstrainedEdgeCCW(t),_=e.getConstrainedEdgeCW(t),E=r.getConstrainedEdgeCCW(n),S=r.getConstrainedEdgeCW(n);var A,O,k,G;A=e.getDelaunayEdgeCCW(t),O=e.getDelaunayEdgeCW(t),k=r.getDelaunayEdgeCCW(n),G=r.getDelaunayEdgeCW(n),e.legalize(t,n),r.legalize(n,t),r.setDelaunayEdgeCCW(t,A),e.setDelaunayEdgeCW(t,O),e.setDelaunayEdgeCCW(n,k),r.setDelaunayEdgeCW(n,G),r.setConstrainedEdgeCCW(t,g),e.setConstrainedEdgeCW(t,_),e.setConstrainedEdgeCCW(n,E),r.setConstrainedEdgeCW(n,S),e.clearNeighbors(),r.clearNeighbors(),i&&r.markNeighbor(i),l&&e.markNeighbor(l),h&&e.markNeighbor(h),a&&r.markNeighbor(a),e.markNeighbor(r)}function dF(e,t){for(wo(t.point,t.next.point,t.next.next.point)===Xi.CCW?e.basin.left_node=t.next.next:e.basin.left_node=t.next,e.basin.bottom_node=e.basin.left_node;e.basin.bottom_node.next&&e.basin.bottom_node.point.y>=e.basin.bottom_node.next.point.y;)e.basin.bottom_node=e.basin.bottom_node.next;if(e.basin.bottom_node!==e.basin.left_node){for(e.basin.right_node=e.basin.bottom_node;e.basin.right_node.next&&e.basin.right_node.point.y<e.basin.right_node.next.point.y;)e.basin.right_node=e.basin.right_node.next;e.basin.right_node!==e.basin.bottom_node&&(e.basin.width=e.basin.right_node.point.x-e.basin.left_node.point.x,e.basin.left_highest=e.basin.left_node.point.y>e.basin.right_node.point.y,hI(e,e.basin.bottom_node))}}function hI(e,t){if(!fF(e,t)){qd(e,t);var r;if(!(t.prev===e.basin.left_node&&t.next===e.basin.right_node)){if(t.prev===e.basin.left_node){if(r=wo(t.point,t.next.point,t.next.next.point),r===Xi.CW)return;t=t.next}else if(t.next===e.basin.right_node){if(r=wo(t.point,t.prev.point,t.prev.prev.point),r===Xi.CCW)return;t=t.prev}else t.prev.point.y<t.next.point.y?t=t.prev:t=t.next;hI(e,t)}}}function fF(e,t){var r;return e.basin.left_highest?r=e.basin.left_node.point.y-t.point.y:r=e.basin.right_node.point.y-t.point.y,e.basin.width>r}function mF(e,t,r){e.edge_event.right?gF(e,t,r):yF(e,t,r)}function gF(e,t,r){for(;r.next.point.x<t.p.x;)wo(t.q,r.next.point,t.p)===Xi.CCW?pI(e,t,r):r=r.next}function pI(e,t,r){r.point.x<t.p.x&&(wo(r.point,r.next.point,r.next.next.point)===Xi.CCW?r1(e,t,r):(dI(e,t,r),pI(e,t,r)))}function r1(e,t,r){qd(e,r.next),r.next.point!==t.p&&wo(t.q,r.next.point,t.p)===Xi.CCW&&wo(r.point,r.next.point,r.next.next.point)===Xi.CCW&&r1(e,t,r)}function dI(e,t,r){wo(r.next.point,r.next.next.point,r.next.next.next.point)===Xi.CCW?r1(e,t,r.next):wo(t.q,r.next.next.point,t.p)===Xi.CCW&&dI(e,t,r.next)}function yF(e,t,r){for(;r.prev.point.x>t.p.x;)wo(t.q,r.prev.point,t.p)===Xi.CW?fI(e,t,r):r=r.prev}function fI(e,t,r){r.point.x>t.p.x&&(wo(r.point,r.prev.point,r.prev.prev.point)===Xi.CW?n1(e,t,r):(mI(e,t,r),fI(e,t,r)))}function mI(e,t,r){wo(r.prev.point,r.prev.prev.point,r.prev.prev.prev.point)===Xi.CW?n1(e,t,r.prev):wo(t.q,r.prev.prev.point,t.p)===Xi.CW&&mI(e,t,r.prev)}function n1(e,t,r){qd(e,r.prev),r.prev.point!==t.p&&wo(t.q,r.prev.point,t.p)===Xi.CW&&wo(r.point,r.prev.point,r.prev.prev.point)===Xi.CW&&n1(e,t,r)}function i1(e,t,r,n,i){var l=n.neighborAcross(i);t1(l,"FLIP failed due to missing triangle!");var h=l.oppositePoint(n,i);if(n.getConstrainedEdgeAcross(i)){var a=n.index(i);throw new m_("poly2tri Intersecting Constraints",[i,h,n.getPoint((a+1)%3),n.getPoint((a+2)%3)])}if(lI(i,n.pointCCW(i),n.pointCW(i),h))if(cI(n,i,l,h),e.mapTriangleToNodes(n),e.mapTriangleToNodes(l),i===r&&h===t)r===e.edge_event.constrained_edge.q&&t===e.edge_event.constrained_edge.p&&(n.markConstrainedEdgeByPoints(t,r),l.markConstrainedEdgeByPoints(t,r),Wh(e,n),Wh(e,l));else{var g=wo(r,h,t);n=_F(e,g,n,l,i,h),i1(e,t,r,n,i)}else{var _=gI(t,r,l,h);yI(e,t,r,n,l,_),e1(e,t,r,n,i)}}function _F(e,t,r,n,i,l){var h;return t===Xi.CCW?(h=n.edgeIndex(i,l),n.delaunay_edge[h]=!0,Wh(e,n),n.clearDelaunayEdges(),r):(h=r.edgeIndex(i,l),r.delaunay_edge[h]=!0,Wh(e,r),r.clearDelaunayEdges(),n)}function gI(e,t,r,n){var i=wo(t,n,e);if(i===Xi.CW)return r.pointCCW(n);if(i===Xi.CCW)return r.pointCW(n);throw new m_("poly2tri [Unsupported] nextFlipPoint: opposing point on constrained edge!",[t,n,e])}function yI(e,t,r,n,i,l){var h=i.neighborAcross(l);t1(h,"FLIP failed due to missing triangle");var a=h.oppositePoint(i,l);if(lI(r,n.pointCCW(r),n.pointCW(r),a))i1(e,r,a,h,a);else{var g=gI(t,r,h,a);yI(e,t,r,n,h,g)}}Jx.triangulate=iF;var vF=Yx,um=oI,xF=Kx,bF=Jx,_I=sI,fv=_I.Node,BE=.3,wF=function(e,t){if(this.p=e,this.q=t,e.y>t.y)this.q=e,this.p=t;else if(e.y===t.y){if(e.x>t.x)this.q=e,this.p=t;else if(e.x===t.x)throw new vF("poly2tri Invalid Edge constructor: repeated points!",[e])}this.q._p2t_edge_list||(this.q._p2t_edge_list=[]),this.q._p2t_edge_list.push(this)},vI=function(){this.left_node=null,this.bottom_node=null,this.right_node=null,this.width=0,this.left_highest=!1};vI.prototype.clear=function(){this.left_node=null,this.bottom_node=null,this.right_node=null,this.width=0,this.left_highest=!1};var EF=function(){this.constrained_edge=null,this.right=!1},bn=function(e,t){t=t||{},this.triangles_=[],this.map_=[],this.points_=t.cloneArrays?e.slice(0):e,this.edge_list=[],this.pmin_=this.pmax_=null,this.front_=null,this.head_=null,this.tail_=null,this.af_head_=null,this.af_middle_=null,this.af_tail_=null,this.basin=new vI,this.edge_event=new EF,this.initEdges(this.points_)};bn.prototype.addHole=function(e){this.initEdges(e);var t,r=e.length;for(t=0;t<r;t++)this.points_.push(e[t]);return this};bn.prototype.AddHole=bn.prototype.addHole;bn.prototype.addHoles=function(e){var t,r=e.length;for(t=0;t<r;t++)this.initEdges(e[t]);return this.points_=this.points_.concat.apply(this.points_,e),this};bn.prototype.addPoint=function(e){return this.points_.push(e),this};bn.prototype.AddPoint=bn.prototype.addPoint;bn.prototype.addPoints=function(e){return this.points_=this.points_.concat(e),this};bn.prototype.triangulate=function(){return bF.triangulate(this),this};bn.prototype.getBoundingBox=function(){return{min:this.pmin_,max:this.pmax_}};bn.prototype.getTriangles=function(){return this.triangles_};bn.prototype.GetTriangles=bn.prototype.getTriangles;bn.prototype.front=function(){return this.front_};bn.prototype.pointCount=function(){return this.points_.length};bn.prototype.head=function(){return this.head_};bn.prototype.setHead=function(e){this.head_=e};bn.prototype.tail=function(){return this.tail_};bn.prototype.setTail=function(e){this.tail_=e};bn.prototype.getMap=function(){return this.map_};bn.prototype.initTriangulation=function(){var e=this.points_[0].x,t=this.points_[0].x,r=this.points_[0].y,n=this.points_[0].y,i,l=this.points_.length;for(i=1;i<l;i++){var h=this.points_[i];h.x>e&&(e=h.x),h.x<t&&(t=h.x),h.y>r&&(r=h.y),h.y<n&&(n=h.y)}this.pmin_=new um(t,n),this.pmax_=new um(e,r);var a=BE*(e-t),g=BE*(r-n);this.head_=new um(e+a,n-g),this.tail_=new um(t-a,n-g),this.points_.sort(um.compare)};bn.prototype.initEdges=function(e){var t,r=e.length;for(t=0;t<r;++t)this.edge_list.push(new wF(e[t],e[(t+1)%r]))};bn.prototype.getPoint=function(e){return this.points_[e]};bn.prototype.addToMap=function(e){this.map_.push(e)};bn.prototype.locateNode=function(e){return this.front_.locateNode(e.x)};bn.prototype.createAdvancingFront=function(){var e,t,r,n=new xF(this.points_[0],this.tail_,this.head_);this.map_.push(n),e=new fv(n.getPoint(1),n),t=new fv(n.getPoint(0),n),r=new fv(n.getPoint(2)),this.front_=new _I(e,r),e.next=t,t.next=r,t.prev=e,r.prev=t};bn.prototype.removeNode=function(e){};bn.prototype.mapTriangleToNodes=function(e){for(var t=0;t<3;++t)if(!e.getNeighbor(t)){var r=this.front_.locatePoint(e.pointCW(e.getPoint(t)));r&&(r.triangle=e)}};bn.prototype.removeFromMap=function(e){var t,r=this.map_,n=r.length;for(t=0;t<n;t++)if(r[t]===e){r.splice(t,1);break}};bn.prototype.meshClean=function(e){for(var t=[e],r,n;r=t.pop();)if(!r.isInterior())for(r.setInterior(!0),this.triangles_.push(r),n=0;n<3;n++)r.constrained_edge[n]||t.push(r.getNeighbor(n))};var SF=bn;(function(e){var t=globalThis.poly2tri;e.noConflict=function(){return globalThis.poly2tri=t,e},e.VERSION=G3.version,e.PointError=Yx,e.Point=oI,e.Triangle=Kx,e.SweepContext=SF;var r=Jx;e.triangulate=r.triangulate,e.sweep={Triangulate:r.triangulate}})(nI);function TF(e,t){let r=0;const n=new nI.SweepContext(S3(e,t).map(i=>({x:i[0],y:i[1],type:"p",item:r++})));n.addPoints(T3(e,t).filter(i=>j3(e,i)===-1).map(i=>({x:i[0],y:i[1],type:"g",item:r++})));try{n.triangulate()}catch{throw new Error("A Point Error occured during resource mask triangulation. This is typically because the resource mask contains duplicate or collinear points, or is self-intersecting.")}return n.getTriangles()}function IF(e,t){const r=TF(e,t).map(i=>i.getPoints().map(l=>l)),n=[...new Map(r.flat().map(i=>[i.item,i])).values()].sort((i,l)=>i.item-l.item).map(i=>[i.x,i.y]);return{uniquePointsIndexTriangles:r.map(i=>i.map(l=>l.item)),uniquePoints:n}}const CF=80,MF=10;function PF(){return{}}class AF extends v3{constructor(t,r,n){n={...PF(),...n},super(t,r,n),Nt(this,"resourceTrianglePoints",[]),Nt(this,"resourceUniquePoints",[]),Nt(this,"trianglePointsUniquePointsIndex",[]),Nt(this,"triangulationByBestScaleFactor",new Map),Nt(this,"triangulateErrorCount",0),Nt(this,"projectedGeoPreviousTrianglePoints",[]),Nt(this,"projectedGeoTrianglePoints",[]),Nt(this,"projectedGeoUniquePoints",[]),Nt(this,"projectedGeoUniquePointsByBestScaleFactorAndTransformationType",new Map),Nt(this,"projectedGeoUniquePointsPartialDerivativeX",[]),Nt(this,"projectedGeoUniquePointsPartialDerivativeY",[]),Nt(this,"projectedGeoUniquePointsPartialDerivativeXByBestScaleFactorAndTransformationType",new Map),Nt(this,"projectedGeoUniquePointsPartialDerivativeYByBestScaleFactorAndTransformationType",new Map),Nt(this,"previousTrianglePointsDistortion",[]),Nt(this,"trianglePointsDistortion",[]),Nt(this,"uniquePointsDistortion",[])}setResourceMask(t){super.setResourceMask(t),this.triangulationByBestScaleFactor=new Map,this.projectedGeoUniquePointsByBestScaleFactorAndTransformationType=new Map,this.projectedGeoUniquePointsPartialDerivativeXByBestScaleFactorAndTransformationType=new Map,this.projectedGeoUniquePointsPartialDerivativeYByBestScaleFactorAndTransformationType=new Map,this.updateTriangulation()}setBestScaleFactor(t){const r=super.setBestScaleFactor(t);return r&&this.updateTriangulation(!0),r}updateTriangulation(t=!1){const{trianglePointsUniquePointsIndex:r,resourceUniquePoints:n}=zy(this.triangulationByBestScaleFactor,this.bestScaleFactor,()=>{var i;const l=nN(this.resourceMask)*this.bestScaleFactor/CF;try{const{uniquePointsIndexTriangles:h,uniquePoints:a}=IF(this.resourceMask,l);return{trianglePointsUniquePointsIndex:h.flat(),resourceUniquePoints:a}}catch(h){return this.triangulateErrorCount++,this.triangulateErrorCount<=MF&&(console.error(`Error computing triangulation for map ${this.mapId}.`,`Fix this map with Allmaps Editor: https://editor.allmaps.org/#/collection?url=${(i=this.parsedImage)==null?void 0:i.uri}/info.json`),this.triangulateErrorCount===1&&console.error(h)),{trianglePointsUniquePointsIndex:this.trianglePointsUniquePointsIndex,resourceUniquePoints:this.resourceUniquePoints}}});this.resourceTrianglePoints=r.map(i=>n[i]),this.resourceUniquePoints=n,this.trianglePointsUniquePointsIndex=r,this.updateProjectedGeoTrianglePoints(t)}updateProjectedGeoTrianglePoints(t=!1){this.projectedGeoUniquePoints=sv(this.projectedGeoUniquePointsByBestScaleFactorAndTransformationType,this.bestScaleFactor,this.transformationType,()=>this.resourceUniquePoints.map(r=>this.projectedTransformer.transformToGeo(r))),this.projectedGeoTrianglePoints=this.trianglePointsUniquePointsIndex.map(r=>this.projectedGeoUniquePoints[r]),(t||!this.projectedGeoPreviousTrianglePoints.length)&&(this.projectedGeoPreviousTrianglePoints=this.projectedGeoTrianglePoints),this.updateTrianglePointsDistortion(t)}updateTrianglePointsDistortion(t=!1){this.distortionMeasure&&(this.projectedGeoUniquePointsPartialDerivativeX=sv(this.projectedGeoUniquePointsPartialDerivativeXByBestScaleFactorAndTransformationType,this.bestScaleFactor,this.transformationType,()=>this.resourceUniquePoints.map(r=>this.projectedTransformer.transformToGeo(r,{evaluationType:"partialDerivativeX"}))),this.projectedGeoUniquePointsPartialDerivativeY=sv(this.projectedGeoUniquePointsPartialDerivativeYByBestScaleFactorAndTransformationType,this.bestScaleFactor,this.transformationType,()=>this.resourceUniquePoints.map(r=>this.projectedTransformer.transformToGeo(r,{evaluationType:"partialDerivativeY"})))),this.uniquePointsDistortion=this.projectedGeoUniquePoints.map((r,n)=>y3(this.projectedGeoUniquePointsPartialDerivativeX[n],this.projectedGeoUniquePointsPartialDerivativeY[n],this.distortionMeasure,this.getReferenceScale())),this.trianglePointsDistortion=this.trianglePointsUniquePointsIndex.map(r=>this.uniquePointsDistortion[r]),(t||!this.previousTrianglePointsDistortion.length)&&(this.previousTrianglePointsDistortion=this.trianglePointsDistortion)}resetTrianglePoints(){this.projectedGeoPreviousTrianglePoints=this.projectedGeoTrianglePoints,this.previousTrianglePointsDistortion=this.trianglePointsDistortion}mixTrianglePoints(t){this.projectedGeoPreviousTrianglePoints=this.projectedGeoTrianglePoints.map((r,n)=>GD(r,this.projectedGeoPreviousTrianglePoints[n],t)),this.previousTrianglePointsDistortion=this.trianglePointsDistortion.map((r,n)=>VD(r,this.previousTrianglePointsDistortion[n],t))}}function LF(e){let t=0,r=0;for(const h of e)t+=h.w*h.h,r=Math.max(r,h.w);e.sort((h,a)=>a.h-h.h);const n=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(t/.95)),r),h:1/0}];let i=0,l=0;for(const h of e)for(let a=n.length-1;a>=0;a--){const g=n[a];if(!(h.w>g.w||h.h>g.h)){if(h.x=g.x,h.y=g.y,l=Math.max(l,h.y+h.h),i=Math.max(i,h.x+h.w),h.w===g.w&&h.h===g.h){const _=n.pop();a<n.length&&(n[a]=_)}else h.h===g.h?(g.x+=h.w,g.w-=h.w):h.w===g.w?(g.y+=h.h,g.h-=h.h):(n.push({x:g.x+h.w,y:g.y,w:g.w-h.w,h:h.h}),g.y+=h.h,g.h-=h.h);break}}return{w:i,h:l,fill:t/(i*l)||0}}var RF=typeof globalThis=="object"&&globalThis&&globalThis.Object===Object&&globalThis,DF=typeof self=="object"&&self&&self.Object===Object&&self,xI=RF||DF||Function("return this")(),g_=xI.Symbol,bI=Object.prototype,NF=bI.hasOwnProperty,kF=bI.toString,cm=g_?g_.toStringTag:void 0;function OF(e){var t=NF.call(e,cm),r=e[cm];try{e[cm]=void 0;var n=!0}catch{}var i=kF.call(e);return n&&(t?e[cm]=r:delete e[cm]),i}var FF=Object.prototype,zF=FF.toString;function BF(e){return zF.call(e)}var $F="[object Null]",UF="[object Undefined]",$E=g_?g_.toStringTag:void 0;function jF(e){return e==null?e===void 0?UF:$F:$E&&$E in Object(e)?OF(e):BF(e)}function VF(e){return e!=null&&typeof e=="object"}var GF="[object Symbol]";function qF(e){return typeof e=="symbol"||VF(e)&&jF(e)==GF}var ZF=/\s/;function WF(e){for(var t=e.length;t--&&ZF.test(e.charAt(t)););return t}var XF=/^\s+/;function HF(e){return e&&e.slice(0,WF(e)+1).replace(XF,"")}function y_(e){var t=typeof e;return e!=null&&(t=="object"||t=="function")}var UE=NaN,YF=/^[-+]0x[0-9a-f]+$/i,KF=/^0b[01]+$/i,JF=/^0o[0-7]+$/i,QF=parseInt;function jE(e){if(typeof e=="number")return e;if(qF(e))return UE;if(y_(e)){var t=typeof e.valueOf=="function"?e.valueOf():e;e=y_(t)?t+"":t}if(typeof e!="string")return e===0?e:+e;e=HF(e);var r=KF.test(e);return r||JF.test(e)?QF(e.slice(2),r?2:8):YF.test(e)?UE:+e}var mv=function(){return xI.Date.now()},tz="Expected a function",ez=Math.max,rz=Math.min;function nz(e,t,r){var n,i,l,h,a,g,_=0,E=!1,S=!1,A=!0;if(typeof e!="function")throw new TypeError(tz);t=jE(t)||0,y_(r)&&(E=!!r.leading,S="maxWait"in r,l=S?ez(jE(r.maxWait)||0,t):l,A="trailing"in r?!!r.trailing:A);function O(vt){var ot=n,et=i;return n=i=void 0,_=vt,h=e.apply(et,ot),h}function k(vt){return _=vt,a=setTimeout(U,t),E?O(vt):h}function G(vt){var ot=vt-g,et=vt-_,wt=t-ot;return S?rz(wt,l-et):wt}function W(vt){var ot=vt-g,et=vt-_;return g===void 0||ot>=t||ot<0||S&&et>=l}function U(){var vt=mv();if(W(vt))return tt(vt);a=setTimeout(U,G(vt))}function tt(vt){return a=void 0,A&&n?O(vt):(n=i=void 0,h)}function $(){a!==void 0&&clearTimeout(a),_=0,n=g=i=a=void 0}function V(){return a===void 0?h:tt(mv())}function it(){var vt=mv(),ot=W(vt);if(n=arguments,i=this,g=vt,ot){if(a===void 0)return k(g);if(S)return clearTimeout(a),a=setTimeout(U,t),O(g)}return a===void 0&&(a=setTimeout(U,t)),h}return it.cancel=$,it.flush=V,it}var iz="Expected a function";function ax(e,t,r){var n=!0,i=!0;if(typeof e!="function")throw new TypeError(iz);return y_(r)&&(n="leading"in r?!!r.leading:n,i="trailing"in r?!!r.trailing:i),nz(e,t,{leading:n,maxWait:t,trailing:i})}const oz=.5;function wI(e,t){return`${e}:${t}`}function EI(e){return wI(e.mapId,e.tileUrl)}function gv(e){return new Set(e.map(t=>EI(t)))}function sz(e,t,r=oz){let n=Number.POSITIVE_INFINITY,i=e.tileZoomLevels.at(-1);for(const l of e.tileZoomLevels){const h=Math.abs(Math.log(l.scaleFactor)-Math.log(t+r));h<n&&(n=h,i=l)}return i}function az(e,t,r){const n=lz(e,t),i=uz(n),l=hz(i,r,t),h=Bd(Es(e));return l.sort((a,g)=>VE(a,h)-VE(g,h)),l}function lz(e,t){return e.map(r=>[r[0]/t.originalWidth,r[1]/t.originalHeight])}function uz(e){const t={};for(let r=0;r<e.length;r++){const n=[e[r],e[(r+1)%e.length]];cz(n).forEach(([i,l])=>{t[i]||(t[i]=[Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY]),l<t[i][0]&&(t[i][0]=l),l>t[i][1]&&(t[i][1]=l)})}return t}function cz([e,t]){let r=Math.floor(e[0]),n=Math.floor(e[1]);const i=Math.floor(t[0]),l=Math.floor(t[1]),h=[[r,n]];if(r===i&&n===l)return h;const a=Math.sign(t[0]-e[0]),g=Math.sign(t[1]-e[1]),_=Math.abs(e[0]-r-Math.max(0,a)),E=Math.abs(e[1]-n-Math.max(0,g)),S=Math.abs(e[0]-t[0]),A=Math.abs(e[1]-t[1]);let O=_/S,k=E/A;const G=1/S,W=1/A;for(;!(r===i&&n===l);)O<k?(O=O+G,r=r+a):(k=k+W,n=n+g),h.push([r,n]);return h}function hz(e,t,r){const n=[];for(const i in e){const l=parseInt(i);if(l<0||l>=r.columns)break;const h=Math.max(e[l][0],0),a=Math.min(e[l][1],r.rows-1);for(let g=h;g<=a;g++)n.push({column:l,row:g,tileZoomLevel:r,imageSize:[t.width,t.height]})}return n}function pz(e){var t,r;return(((t=e.imageRequest.size)==null?void 0:t.height)||0)*(((r=e.imageRequest.size)==null?void 0:r.width)||0)*3}function VE(e,t){return Ba(dz(e),t)}function dz(e){const t=SI(e);return[(t[2]-t[0])/2+t[0],(t[3]-t[1])/2+t[1]]}function fz(e){const t=e.column*e.tileZoomLevel.originalWidth,r=e.row*e.tileZoomLevel.originalHeight;return[t,r]}function SI(e){const t=fz(e),r=Math.min(t[0]+e.tileZoomLevel.originalWidth,e.imageSize[0]),n=Math.min(t[1]+e.tileZoomLevel.originalHeight,e.imageSize[1]);return[t[0],t[1],r,n]}function GE(e,t,r){const n=e.createShader(t);if(n){if(e.shaderSource(n,r),e.compileShader(n),e.getShaderParameter(n,e.COMPILE_STATUS))return n;{const i=e.getShaderInfoLog(n);throw e.deleteShader(n),new Error("Failed to compile shader: "+i)}}else throw new Error("Failed to create shader")}function mz(e,t,r){const n=e.createProgram();if(n){if(e.attachShader(n,t),e.attachShader(n,r),e.linkProgram(n),e.getProgramParameter(n,e.LINK_STATUS))return n;{const i=e.getProgramInfoLog(n);throw e.deleteProgram(n),new Error("Failed to link program: "+i)}}else throw new Error("Failed to create program")}function Sd(e,t,r,n,i){const l=e.createBuffer();e.bindBuffer(e.ARRAY_BUFFER,l),e.bufferData(e.ARRAY_BUFFER,r,e.STATIC_DRAW);const h=e.FLOAT,a=!1,g=0,_=0,E=e.getAttribLocation(t,i);e.vertexAttribPointer(E,n,h,a,g,_),e.enableVertexAttribArray(E)}const gz=100,yz={leading:!0,trailing:!0},_z=1,vz=1;function xz(e,t){return(r,n,i)=>new bz(r,n,e,t,i)}let bz=class extends AF{constructor(e,t,r,n,i){super(e,t,i),Nt(this,"gl"),Nt(this,"program"),Nt(this,"vao"),Nt(this,"CachedTilesByTileUrl",new Map),Nt(this,"opacity",_z),Nt(this,"saturation",vz),Nt(this,"renderOptions",{}),Nt(this,"packedTilesTexture"),Nt(this,"packedTilesPositionsTexture"),Nt(this,"packedTilesResourcePositionsAndDimensionsTexture"),Nt(this,"packedTilesScaleFactorsTexture"),Nt(this,"projectedGeoToClipTransform"),Nt(this,"throttledUpdateTextures"),this.gl=r,this.program=n,this.vao=r.createVertexArray(),this.packedTilesTexture=r.createTexture(),this.packedTilesScaleFactorsTexture=r.createTexture(),this.packedTilesPositionsTexture=r.createTexture(),this.packedTilesResourcePositionsAndDimensionsTexture=r.createTexture(),this.throttledUpdateTextures=ax(this.updateTextures.bind(this),gz,yz)}updateVertexBuffers(e){this.projectedGeoToClipTransform=e,this.updateVertexBuffersInternal()}addCachedTileAndUpdateTextures(e){this.CachedTilesByTileUrl.set(e.tileUrl,e),this.throttledUpdateTextures()}removeCachedTileAndUpdateTextures(e){this.CachedTilesByTileUrl.delete(e),this.throttledUpdateTextures()}dispose(){this.gl.deleteVertexArray(this.vao),this.gl.deleteTexture(this.packedTilesTexture),this.gl.deleteTexture(this.packedTilesScaleFactorsTexture),this.gl.deleteTexture(this.packedTilesPositionsTexture),this.gl.deleteTexture(this.packedTilesResourcePositionsAndDimensionsTexture)}updateVertexBuffersInternal(){if(!this.vao||!this.projectedGeoToClipTransform)return;this.gl.bindVertexArray(this.vao);const e=this.resourceTrianglePoints;Sd(this.gl,this.program,new Float32Array(e.flat()),2,"a_resourceTrianglePoint");const t=this.projectedGeoPreviousTrianglePoints.map(h=>Nd(this.projectedGeoToClipTransform,h));Sd(this.gl,this.program,new Float32Array(t.flat()),2,"a_clipPreviousTrianglePoint");const r=this.projectedGeoTrianglePoints.map(h=>Nd(this.projectedGeoToClipTransform,h));Sd(this.gl,this.program,new Float32Array(r.flat()),2,"a_clipTrianglePoint");const n=this.previousTrianglePointsDistortion;Sd(this.gl,this.program,new Float32Array(n),1,"a_previousTrianglePointDistortion");const i=this.trianglePointsDistortion;Sd(this.gl,this.program,new Float32Array(i),1,"a_trianglePointDistortion");const l=new Float32Array(this.resourceTrianglePoints.length).map((h,a)=>Math.round((a-1)/3));Sd(this.gl,this.program,l,1,"a_triangleIndex")}async updateTextures(){const e=this.gl;if(this.CachedTilesByTileUrl.size===0)return;let t=[...this.CachedTilesByTileUrl.values()];t=t.filter(_=>this.resourceViewportRingBbox?eN(SI(_.tile),this.resourceViewportRingBbox):!0);const r=t.length,n=t.map((_,E)=>({w:_.data.width,h:_.data.height,x:0,y:0,index:E})),{w:i,h:l}=LF(n);e.pixelStorei(e.UNPACK_ALIGNMENT,4),e.bindTexture(e.TEXTURE_2D,this.packedTilesTexture),e.texImage2D(e.TEXTURE_2D,0,e.RGBA,i,l,0,e.RGBA,e.UNSIGNED_BYTE,null);for(const _ of n){const E=t[_.index].data;e.texSubImage2D(e.TEXTURE_2D,0,_.x,_.y,E.width,E.height,e.RGBA,e.UNSIGNED_BYTE,E)}e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.LINEAR),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.LINEAR),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE);const h=n.map(_=>[_.x,_.y]);e.bindTexture(e.TEXTURE_2D,this.packedTilesPositionsTexture),e.texImage2D(e.TEXTURE_2D,0,e.RG32I,1,r,0,e.RG_INTEGER,e.INT,new Int32Array(h.flat())),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.NEAREST),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.NEAREST),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE);const a=n.map(_=>{const E=t[_.index];if(E&&E.imageRequest&&E.imageRequest.region)return[E.imageRequest.region.x,E.imageRequest.region.y,E.imageRequest.region.width,E.imageRequest.region.height]});e.bindTexture(e.TEXTURE_2D,this.packedTilesResourcePositionsAndDimensionsTexture),e.texImage2D(e.TEXTURE_2D,0,e.RGBA32I,1,r,0,e.RGBA_INTEGER,e.INT,new Int32Array(a.flat())),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.NEAREST),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.NEAREST),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE);const g=n.map(({index:_})=>t[_].tile.tileZoomLevel.scaleFactor);e.bindTexture(e.TEXTURE_2D,this.packedTilesScaleFactorsTexture),e.texImage2D(e.TEXTURE_2D,0,e.R32I,1,r,0,e.RED_INTEGER,e.INT,new Int32Array(g)),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.NEAREST),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.NEAREST),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),this.dispatchEvent(new Ur(Pe.TEXTURESUPDATED))}};const wz=St.string().or(St.number()).or(St.boolean()),Ez=St.record(St.string(),wz.array()),Xh=St.tuple([St.number(),St.number()]),TI=St.object({type:St.literal("Point"),coordinates:Xh}),II=Xh.array().min(3),bg=St.enum(["ImageService1","ImageService2","ImageService3"]),Sz=St.object({id:St.string().url(),type:St.string(),label:Ez.optional()}),$_=Sz.extend({partOf:St.lazy(()=>$_.array()).optional()}),U_=St.union([St.any(),St.object({type:St.string(),options:St.object({}).optional()})]).transform(e=>{if(e&&typeof e=="object"&&"type"in e)return e}),j_=St.union([St.string().url().array(),St.string().url()]),Tz=/^<svg\s+width="\d+"\s+height="\d+"\s*>\s*<polygon\s+points="\s*(-?\d+(\.\d+)?,-?\d+(\.\d+)?\s+){2,}-?\d+(\.\d+)?,-?\d+(\.\d+)?\s*"\s*\/>\s*<\/svg>$/,Iz=St.object({type:St.literal("SvgSelector"),value:St.string().regex(Tz)}),Cz=St.object({source:St.string().url(),service:St.array(St.object({"@id":St.string().url(),type:bg})).length(1),selector:Iz}),CI=St.object({pixelCoords:Xh}),Mz=St.object({type:St.literal("FeatureCollection"),transformation:U_.optional(),features:St.array(St.object({type:St.literal("Feature"),properties:CI,geometry:TI}))}),o1=St.object({id:St.string().optional(),type:St.literal("Annotation"),"@context":j_.optional(),motivation:St.string().default("georeferencing").optional(),target:Cz,body:Mz}),MI=St.object({id:St.string().optional(),type:St.literal("AnnotationPage"),"@context":j_.optional(),items:St.array(o1)}),s1=/<polygon\s+points="\s*(-?\d+(\.\d+)?,-?\d+(\.\d+)?\s+){2,}-?\d+(\.\d+)?,-?\d+(\.\d+)?\s*"\s*\/>/,Pz=new RegExp(`^<svg\\s+width="\\d+"\\s+height="\\d+"\\s*>\\s*${s1.source}\\s*</svg>$`),Az=new RegExp(`^<svg\\s+height="\\d+"\\s+width="\\d+"\\s*>\\s*${s1.source}\\s*</svg>$`),Lz=new RegExp(`^<svg\\s*>\\s*${s1.source}\\s*</svg>$`),Rz=St.string().regex(Lz),Dz=St.string().regex(Pz),Nz=St.string().regex(Az),kz=St.object({type:St.literal("SvgSelector"),value:Rz.or(Dz).or(Nz)}),Oz=St.object({"@id":St.string().url(),type:bg,height:St.number().positive(),width:St.number().positive(),partOf:$_.array().optional()}),Fz=St.object({id:St.string().url(),type:bg,height:St.number().positive(),width:St.number().positive(),partOf:$_.array().optional()}),zz=St.object({type:St.literal("SpecificResource"),source:Oz.or(Fz),selector:kz}),PI=St.object({resourceCoords:Xh}),Bz=St.object({type:St.literal("FeatureCollection"),transformation:U_.optional(),features:St.array(St.object({type:St.literal("Feature"),properties:PI,geometry:TI}))}),a1=St.object({id:St.string().optional(),type:St.literal("Annotation"),"@context":j_.optional(),motivation:St.string().default("georeferencing").optional(),created:St.string().datetime().optional(),modified:St.string().datetime().optional(),target:zz,body:Bz}),AI=St.object({id:St.string().optional(),type:St.literal("AnnotationPage"),"@context":j_.optional(),items:St.array(a1)});o1.or(a1);MI.or(AI);CI.or(PI);function LI(e){return Array.isArray(e)}function $z(e){return!!(e&&typeof e=="object"&&"type"in e&&e.type==="AnnotationPage")}function __(e){return!!(e&&typeof e=="object"&&"type"in e&&e.type==="GeoreferencedMap")}function qE(e){return!!(e&&typeof e=="object"&&"target"in e&&e.target&&typeof e.target=="object"&&"source"in e.target&&typeof e.target.source=="string")}function V_(e){return"type"in e&&e.type==="GeoreferencedMap"}function G_(e){return"source"in e.target&&typeof e.target.source=="object"}function Uz(e){return{id:jz(e),...Xz(e),type:Vz(e),partOf:Gz(e)}}function jz(e){if(G_(e)){const t=e.target.source;return"id"in t?t.id:t["@id"]}else return e.target.service[0]["@id"]}function Vz(e){return"service"in e.target?e.target.service[0].type:e.target.source.type}function Gz(e){if(G_(e))return e.target.source.partOf}function qz(e){return"pixelCoords"in e?e.pixelCoords:e.resourceCoords}function Zz(e){return e.body.features.map(t=>({resource:qz(t.properties),geo:t.geometry.coordinates}))}function Wz(e){if(G_(e))return{created:e.created,modified:e.modified}}function Xz(e){var t,r;if(G_(e))return{width:e.target.source.width,height:e.target.source.height};const n=e.target.selector.value,i=/width="(?<width>\d+)"/.exec(n),l=/height="(?<height>\d+)"/.exec(n),h=(t=i==null?void 0:i.groups)==null?void 0:t.width,a=(r=l==null?void 0:l.groups)==null?void 0:r.height;if(!h||!a)throw new Error("Could not parse image dimensions");return{width:parseInt(h),height:parseInt(a)}}function Hz(e){var t;const r=e.target.selector.value,n=(t=/points="(?<points>.+)"/.exec(r))==null?void 0:t.groups;if(n&&n.points){const i=n.points.trim().split(/\s+/);if(i[0]===i[i.length-1]&&i.splice(-1),i.length>=3)return i.map(l=>{const h=l.split(",");if(h.length===2)return[parseFloat(h[0]),parseFloat(h[1])];throw new Error("Could not parse resource mask")});throw new Error("Could not parse resource mask")}else throw new Error("Could not parse resource mask")}function ZE(e){return{"@context":"https://schemas.allmaps.org/map/2/context.json",type:"GeoreferencedMap",id:e.id,...Wz(e),resource:Uz(e),gcps:Zz(e),resourceMask:Hz(e),transformation:e.body.transformation}}function lx(e){if($z(e)){let t;return"items"in e&&Array.isArray(e.items)&&qE(e.items[0])?t=MI.parse(e):t=AI.parse(e),t.items.map(r=>ZE(r))}else{let t;return qE(e)?t=o1.parse(e):t=a1.parse(e),[ZE(t)]}}const RI=St.object({image:Xh,world:Xh}),Yz=St.object({uri:St.string().url(),width:St.number(),height:St.number(),type:bg}),q_=St.object({id:St.string().optional(),version:St.number().min(1).max(1).default(1),image:Yz,gcps:RI.array(),pixelMask:II,transformation:U_.optional()}),l1=St.array(q_),DI=St.object({resource:Xh,geo:Xh}),Kz=St.object({id:St.string().url(),width:St.number(),height:St.number(),type:bg,partOf:$_.array().optional()}),Z_=St.object({"@context":St.literal("https://schemas.allmaps.org/map/2/context.json").optional(),type:St.literal("GeoreferencedMap"),id:St.string().optional(),created:St.string().datetime().optional(),modified:St.string().datetime().optional(),resource:Kz,gcps:DI.array(),resourceMask:II,transformation:U_.optional()}),u1=St.array(Z_);q_.or(Z_);l1.or(u1);RI.or(DI);function Jz(e){let t,r,n;return V_(e)?(t=e.resource.width,r=e.resource.height,n=e.resourceMask):(t=e.image.width,r=e.image.height,n=e.pixelMask),{type:"SvgSelector",value:`<svg width="${t}" height="${r}"><polygon points="${n.map(i=>i.join(",")).join(" ")}" /></svg>`}}function Qz(e){let t,r,n,i,l;return V_(e)?(t=e.resource.id,r=e.resource.type,n=e.resource.width,i=e.resource.height,l=e.resource.partOf):(t=e.image.uri,r=e.image.type,n=e.image.width,i=e.image.height),{id:t,type:r,height:i,width:n,partOf:l}}function t4(e){if(V_(e))return{created:e.created,modified:e.modified}}function e4(){return["http://iiif.io/api/extension/georef/1/context.json","http://iiif.io/api/presentation/3/context.json"]}function r4(e){let t,r;return"resource"in e?(t=e.resource,r=e.geo):(t=e.image,r=e.world),{type:"Feature",properties:{resourceCoords:t},geometry:{type:"Point",coordinates:r}}}function WE(e){const t={type:"SpecificResource",source:Qz(e),selector:Jz(e)},r={type:"FeatureCollection",transformation:e.transformation,features:e.gcps.map(n=>r4(n))};return{id:e.id,type:"Annotation","@context":e4(),...t4(e),motivation:"georeferencing",target:t,body:r}}function n4(e){if(LI(e)){let t;return __(e[0])?t=u1.parse(e):t=l1.parse(e),{type:"AnnotationPage","@context":"http://www.w3.org/ns/anno.jsonld",items:t.map(r=>WE(r))}}else{let t;return __(e)?t=Z_.parse(e):t=q_.parse(e),WE(t)}}function NI(e){return V_(e)?e:lx(n4(e))[0]}function i4(e){return e.map(NI)}function XE(e){if(LI(e)){let t;return __(e[0])?t=u1.parse(e):t=l1.parse(e),i4(t)}else{let t;return __(e)?t=Z_.parse(e):t=q_.parse(e),NI(t)}}function o4(e,t,r,n,i){kI(e,t,r||0,n||e.length-1,i||s4)}function kI(e,t,r,n,i){for(;n>r;){if(n-r>600){var l=n-r+1,h=t-r+1,a=Math.log(l),g=.5*Math.exp(2*a/3),_=.5*Math.sqrt(a*g*(l-g)/l)*(h-l/2<0?-1:1),E=Math.max(r,Math.floor(t-h*g/l+_)),S=Math.min(n,Math.floor(t+(l-h)*g/l+_));kI(e,t,E,S,i)}var A=e[t],O=r,k=n;for(hm(e,r,t),i(e[n],A)>0&&hm(e,r,n);O<k;){for(hm(e,O,k),O++,k--;i(e[O],A)<0;)O++;for(;i(e[k],A)>0;)k--}i(e[r],A)===0?hm(e,r,k):(k++,hm(e,k,n)),k<=t&&(r=k+1),t<=k&&(n=k-1)}}function hm(e,t,r){var n=e[t];e[t]=e[r],e[r]=n}function s4(e,t){return e<t?-1:e>t?1:0}class a4{constructor(t=9){this._maxEntries=Math.max(4,t),this._minEntries=Math.max(2,Math.ceil(this._maxEntries*.4)),this.clear()}all(){return this._all(this.data,[])}search(t){let r=this.data;const n=[];if(!Iy(t,r))return n;const i=this.toBBox,l=[];for(;r;){for(let h=0;h<r.children.length;h++){const a=r.children[h],g=r.leaf?i(a):a;Iy(t,g)&&(r.leaf?n.push(a):_v(t,g)?this._all(a,n):l.push(a))}r=l.pop()}return n}collides(t){let r=this.data;if(!Iy(t,r))return!1;const n=[];for(;r;){for(let i=0;i<r.children.length;i++){const l=r.children[i],h=r.leaf?this.toBBox(l):l;if(Iy(t,h)){if(r.leaf||_v(t,h))return!0;n.push(l)}}r=n.pop()}return!1}load(t){if(!(t&&t.length))return this;if(t.length<this._minEntries){for(let n=0;n<t.length;n++)this.insert(t[n]);return this}let r=this._build(t.slice(),0,t.length-1,0);if(!this.data.children.length)this.data=r;else if(this.data.height===r.height)this._splitRoot(this.data,r);else{if(this.data.height<r.height){const n=this.data;this.data=r,r=n}this._insert(r,this.data.height-r.height-1,!0)}return this}insert(t){return t&&this._insert(t,this.data.height-1),this}clear(){return this.data=Dd([]),this}remove(t,r){if(!t)return this;let n=this.data;const i=this.toBBox(t),l=[],h=[];let a,g,_;for(;n||l.length;){if(n||(n=l.pop(),g=l[l.length-1],a=h.pop(),_=!0),n.leaf){const E=l4(t,n.children,r);if(E!==-1)return n.children.splice(E,1),l.push(n),this._condense(l),this}!_&&!n.leaf&&_v(n,i)?(l.push(n),h.push(a),a=0,g=n,n=n.children[0]):g?(a++,n=g.children[a],_=!1):n=null}return this}toBBox(t){return t}compareMinX(t,r){return t.minX-r.minX}compareMinY(t,r){return t.minY-r.minY}toJSON(){return this.data}fromJSON(t){return this.data=t,this}_all(t,r){const n=[];for(;t;)t.leaf?r.push(...t.children):n.push(...t.children),t=n.pop();return r}_build(t,r,n,i){const l=n-r+1;let h=this._maxEntries,a;if(l<=h)return a=Dd(t.slice(r,n+1)),Td(a,this.toBBox),a;i||(i=Math.ceil(Math.log(l)/Math.log(h)),h=Math.ceil(l/Math.pow(h,i-1))),a=Dd([]),a.leaf=!1,a.height=i;const g=Math.ceil(l/h),_=g*Math.ceil(Math.sqrt(h));HE(t,r,n,_,this.compareMinX);for(let E=r;E<=n;E+=_){const S=Math.min(E+_-1,n);HE(t,E,S,g,this.compareMinY);for(let A=E;A<=S;A+=g){const O=Math.min(A+g-1,S);a.children.push(this._build(t,A,O,i-1))}}return Td(a,this.toBBox),a}_chooseSubtree(t,r,n,i){for(;i.push(r),!(r.leaf||i.length-1===n);){let l=1/0,h=1/0,a;for(let g=0;g<r.children.length;g++){const _=r.children[g],E=yv(_),S=h4(t,_)-E;S<h?(h=S,l=E<l?E:l,a=_):S===h&&E<l&&(l=E,a=_)}r=a||r.children[0]}return r}_insert(t,r,n){const i=n?t:this.toBBox(t),l=[],h=this._chooseSubtree(i,this.data,r,l);for(h.children.push(t),xm(h,i);r>=0&&l[r].children.length>this._maxEntries;)this._split(l,r),r--;this._adjustParentBBoxes(i,l,r)}_split(t,r){const n=t[r],i=n.children.length,l=this._minEntries;this._chooseSplitAxis(n,l,i);const h=this._chooseSplitIndex(n,l,i),a=Dd(n.children.splice(h,n.children.length-h));a.height=n.height,a.leaf=n.leaf,Td(n,this.toBBox),Td(a,this.toBBox),r?t[r-1].children.push(a):this._splitRoot(n,a)}_splitRoot(t,r){this.data=Dd([t,r]),this.data.height=t.height+1,this.data.leaf=!1,Td(this.data,this.toBBox)}_chooseSplitIndex(t,r,n){let i,l=1/0,h=1/0;for(let a=r;a<=n-r;a++){const g=vm(t,0,a,this.toBBox),_=vm(t,a,n,this.toBBox),E=p4(g,_),S=yv(g)+yv(_);E<l?(l=E,i=a,h=S<h?S:h):E===l&&S<h&&(h=S,i=a)}return i||n-r}_chooseSplitAxis(t,r,n){const i=t.leaf?this.compareMinX:u4,l=t.leaf?this.compareMinY:c4,h=this._allDistMargin(t,r,n,i),a=this._allDistMargin(t,r,n,l);h<a&&t.children.sort(i)}_allDistMargin(t,r,n,i){t.children.sort(i);const l=this.toBBox,h=vm(t,0,r,l),a=vm(t,n-r,n,l);let g=Ty(h)+Ty(a);for(let _=r;_<n-r;_++){const E=t.children[_];xm(h,t.leaf?l(E):E),g+=Ty(h)}for(let _=n-r-1;_>=r;_--){const E=t.children[_];xm(a,t.leaf?l(E):E),g+=Ty(a)}return g}_adjustParentBBoxes(t,r,n){for(let i=n;i>=0;i--)xm(r[i],t)}_condense(t){for(let r=t.length-1,n;r>=0;r--)t[r].children.length===0?r>0?(n=t[r-1].children,n.splice(n.indexOf(t[r]),1)):this.clear():Td(t[r],this.toBBox)}}function l4(e,t,r){if(!r)return t.indexOf(e);for(let n=0;n<t.length;n++)if(r(e,t[n]))return n;return-1}function Td(e,t){vm(e,0,e.children.length,t,e)}function vm(e,t,r,n,i){i||(i=Dd(null)),i.minX=1/0,i.minY=1/0,i.maxX=-1/0,i.maxY=-1/0;for(let l=t;l<r;l++){const h=e.children[l];xm(i,e.leaf?n(h):h)}return i}function xm(e,t){return e.minX=Math.min(e.minX,t.minX),e.minY=Math.min(e.minY,t.minY),e.maxX=Math.max(e.maxX,t.maxX),e.maxY=Math.max(e.maxY,t.maxY),e}function u4(e,t){return e.minX-t.minX}function c4(e,t){return e.minY-t.minY}function yv(e){return(e.maxX-e.minX)*(e.maxY-e.minY)}function Ty(e){return e.maxX-e.minX+(e.maxY-e.minY)}function h4(e,t){return(Math.max(t.maxX,e.maxX)-Math.min(t.minX,e.minX))*(Math.max(t.maxY,e.maxY)-Math.min(t.minY,e.minY))}function p4(e,t){const r=Math.max(e.minX,t.minX),n=Math.max(e.minY,t.minY),i=Math.min(e.maxX,t.maxX),l=Math.min(e.maxY,t.maxY);return Math.max(0,i-r)*Math.max(0,l-n)}function _v(e,t){return e.minX<=t.minX&&e.minY<=t.minY&&t.maxX<=e.maxX&&t.maxY<=e.maxY}function Iy(e,t){return t.minX<=e.maxX&&t.minY<=e.maxY&&t.maxX>=e.minX&&t.maxY>=e.minY}function Dd(e){return{children:e,height:1,leaf:!0,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0}}function HE(e,t,r,n,i){const l=[t,r];for(;l.length;){if(r=l.pop(),t=l.pop(),r-t<=n)continue;const h=t+Math.ceil((r-t)/n/2)*n;o4(e,h,t,r,i),l.push(t,h,h,r)}}function d4(e,t,r){if(r===void 0&&(r={}),!e)throw new Error("point is required");if(!t)throw new Error("polygon is required");var n=Gd(e),i=nO(t),l=i.type,h=t.bbox,a=i.coordinates;if(h&&f4(n,h)===!1)return!1;l==="Polygon"&&(a=[a]);for(var g=!1,_=0;_<a.length&&!g;_++)if(YE(n,a[_][0],r.ignoreBoundary)){for(var E=!1,S=1;S<a[_].length&&!E;)YE(n,a[_][S],!r.ignoreBoundary)&&(E=!0),S++;E||(g=!0)}return g}function YE(e,t,r){var n=!1;t[0][0]===t[t.length-1][0]&&t[0][1]===t[t.length-1][1]&&(t=t.slice(0,t.length-1));for(var i=0,l=t.length-1;i<t.length;l=i++){var h=t[i][0],a=t[i][1],g=t[l][0],_=t[l][1],E=e[1]*(h-g)+a*(g-e[0])+_*(e[0]-h)===0&&(h-e[0])*(g-e[0])<=0&&(a-e[1])*(_-e[1])<=0;if(E)return!r;var S=a>e[1]!=_>e[1]&&e[0]<(g-h)*(e[1]-a)/(_-a)+h;S&&(n=!n)}return n}function f4(e,t){return t[0]<=e[0]&&t[1]<=e[1]&&t[2]>=e[0]&&t[3]>=e[1]}const m4=!0;let g4=class{constructor(){Nt(this,"rbush",new a4),Nt(this,"polygonsById",new Map),Nt(this,"bboxesById",new Map),Nt(this,"itemsById",new Map)}addItem(e,t){this.removeItem(e);const r=Es(t),n={minX:r[0],minY:r[1],maxX:r[2],maxY:r[3],id:e};this.polygonsById.set(e,t),this.bboxesById.set(e,r),this.itemsById.set(e,n),this.rbush.insert(n)}removeItem(e){const t=this.itemsById.get(e);t&&(this.rbush.remove(t),this.polygonsById.delete(e),this.bboxesById.delete(e),this.itemsById.delete(e))}clear(){this.polygonsById.clear(),this.bboxesById.clear(),this.itemsById.clear(),this.rbush.clear()}search(e,t,r,n){return this.rbush.search({minX:e,minY:t,maxX:r,maxY:n})}getBbox(e){return this.bboxesById.get(e)}getPolygon(e){return this.polygonsById.get(e)}searchFromBbox(e){const[t,r,n,i]=e;return this.search(t,r,n,i).map(l=>l.id)}searchFromPoint(e,t=m4){const[r,n,i,l]=[e[0],e[1],e[0],e[1]],h=this.search(r,n,i,l);return t?h.filter(a=>{const g=this.polygonsById.get(a.id);return g?d4(e,g):!1}).map(a=>a.id):h.map(a=>a.id)}};function y4(){return{createRTree:!0,imageInformations:new Map}}let _4=class extends EventTarget{constructor(e,t){super(),Nt(this,"warpedMapFactory"),Nt(this,"warpedMapsById",new Map),Nt(this,"zIndices",new Map),Nt(this,"rtree"),Nt(this,"imageInformations"),Nt(this,"transformation"),Nt(this,"fetchFn"),this.warpedMapFactory=e,t={...y4(),...t},this.fetchFn=t==null?void 0:t.fetchFn,this.imageInformations=t.imageInformations,this.transformation=t.transformation,t.createRTree&&(this.rtree=new g4)}getMapIds(){return this.warpedMapsById.keys()}getWarpedMaps(e){if(e===void 0)return this.warpedMapsById.values();{const t=[];for(const r of e){const n=this.warpedMapsById.get(r);n&&t.push(n)}return t}}getWarpedMap(e){return this.warpedMapsById.get(e)}getMapZIndex(e){return this.zIndices.get(e)}getCenter(){const e=this.getBbox();if(e)return Bd(e)}getProjectedCenter(){const e=this.getProjectedBbox();if(e)return Bd(e)}getBbox(){let e;for(const t of this.getWarpedMaps())t.visible&&(e?e=mE(e,t.geoMaskBbox):e=t.geoMaskBbox);return e}getProjectedBbox(){let e;for(const t of this.getWarpedMaps())t.visible&&(e?e=mE(e,t.projectedGeoMaskBbox):e=t.projectedGeoMaskBbox);return e}getMapsByGeoBbox(e){return this.rtree?this.rtree.searchFromBbox(e):Array.from(this.warpedMapsById.keys())}setImageInformations(e){this.imageInformations=e}setMapResourceMask(e,t){const r=this.warpedMapsById.get(e);r&&(r.setResourceMask(t),this.addToOrUpdateRtree(r),this.dispatchEvent(new Ur(Pe.RESOURCEMASKUPDATED,e)))}setMapsTransformationType(e,t){const r=[];for(const n of e){const i=this.warpedMapsById.get(n);i&&i.transformationType!=t&&(i.setTransformationType(t),this.addToOrUpdateRtree(i),r.push(n))}r.length>0&&this.dispatchEvent(new Ur(Pe.TRANSFORMATIONCHANGED,r))}setMapsDistortionMeasure(e,t){const r=[];for(const n of e){const i=this.warpedMapsById.get(n);i&&i.distortionMeasure!=t&&(i.setDistortionMeasure(t),r.push(n))}r.length>0&&this.dispatchEvent(new Ur(Pe.DISTORTIONCHANGED,r))}bringMapsToFront(e){let t=this.warpedMapsById.size;for(const r of e)this.zIndices.has(r)&&(this.zIndices.set(r,t),t++);this.removeZIndexHoles(),this.dispatchEvent(new Ur(Pe.ZINDICESCHANGES))}sendMapsToBack(e){let t=-Array.from(e).length;for(const r of e)this.zIndices.has(r)&&(this.zIndices.set(r,t),t++);this.removeZIndexHoles(),this.dispatchEvent(new Ur(Pe.ZINDICESCHANGES))}bringMapsForward(e){for(const[t,r]of this.zIndices.entries())this.zIndices.set(t,r*2);for(const t of e){const r=this.zIndices.get(t);r!==void 0&&this.zIndices.set(t,r+3)}this.removeZIndexHoles(),this.dispatchEvent(new Ur(Pe.ZINDICESCHANGES))}sendMapsBackward(e){for(const[t,r]of this.zIndices.entries())this.zIndices.set(t,r*2);for(const t of e){const r=this.zIndices.get(t);r!==void 0&&this.zIndices.set(t,r-3)}this.removeZIndexHoles(),this.dispatchEvent(new Ur(Pe.ZINDICESCHANGES))}showMaps(e){for(const t of e){const r=this.warpedMapsById.get(t);r&&(r.visible=!0)}this.dispatchEvent(new Ur(Pe.VISIBILITYCHANGED,e))}hideMaps(e){for(const t of e){const r=this.warpedMapsById.get(t);r&&(r.visible=!1)}this.dispatchEvent(new Ur(Pe.VISIBILITYCHANGED,e))}async addGeoreferencedMap(e){const t=XE(e),r=Array.isArray(t)?t[0]:t;return this.addGeoreferencedMapInternal(r)}async removeGeoreferencedMap(e){const t=XE(e),r=Array.isArray(t)?t[0]:t;return this.removeGeoreferencedMapInternal(r)}async addGeoreferenceAnnotation(e){const t=[],r=lx(e),n=await Promise.allSettled(r.map(i=>this.addGeoreferencedMapInternal(i)));for(const i of n)i.status==="fulfilled"?t.push(i.value):t.push(i.reason);return this.dispatchEvent(new Ur(Pe.GEOREFERENCEANNOTATIONADDED)),this.dispatchEvent(new Ur(Pe.ZINDICESCHANGES)),t}async removeGeoreferenceAnnotation(e){const t=[],r=lx(e);for(const n of r){const i=await this.removeGeoreferencedMapInternal(n);t.push(i)}return this.dispatchEvent(new Ur(Pe.GEOREFERENCEANNOTATIONREMOVED)),t}clear(){var e;this.warpedMapsById=new Map,this.zIndices=new Map,(e=this.rtree)==null||e.clear(),this.dispatchEvent(new Ur(Pe.CLEARED))}dispose(){for(const e of this.getWarpedMaps())this.removeEventListenersFromWarpedMap(e),e.dispose()}async addGeoreferencedMapInternal(e){const t=await this.getOrComputeMapId(e),r=this.warpedMapFactory(t,e,{imageInformations:this.imageInformations,fetchFn:this.fetchFn,transformation:this.transformation});return this.warpedMapsById.set(t,r),this.zIndices.set(t,this.warpedMapsById.size-1),this.addToOrUpdateRtree(r),this.addEventListenersToWarpedMap(r),this.dispatchEvent(new Ur(Pe.WARPEDMAPADDED,t)),t}async removeGeoreferencedMapInternal(e){const t=await this.getOrComputeMapId(e),r=this.warpedMapsById.get(t);if(r)this.warpedMapsById.delete(t),this.zIndices.delete(t),this.removeFromRtree(r),this.dispatchEvent(new Ur(Pe.WARPEDMAPREMOVED,t)),this.removeZIndexHoles(),this.dispatchEvent(new Ur(Pe.ZINDICESCHANGES));else throw new Error(`No map found with ID ${t}`);return t}async getOrComputeMapId(e){return e.id||await yN(e)}addToOrUpdateRtree(e){this.rtree&&(this.rtree.removeItem(e.mapId),this.rtree.addItem(e.mapId,e.geoMask))}removeFromRtree(e){this.rtree&&this.rtree.removeItem(e.mapId)}removeZIndexHoles(){const e=[...this.zIndices.entries()].sort((r,n)=>r[1]-n[1]);let t=0;for(const r of e){const n=r[0];this.zIndices.set(n,t),t++}}imageInfoLoaded(){this.dispatchEvent(new Ur(Pe.IMAGEINFOLOADED))}addEventListenersToWarpedMap(e){e.addEventListener(Pe.IMAGEINFOLOADED,this.imageInfoLoaded.bind(this))}removeEventListenersFromWarpedMap(e){e.removeEventListener(Pe.IMAGEINFOLOADED,this.imageInfoLoaded.bind(this))}};class v4 extends EventTarget{constructor(t,r){super(),Nt(this,"tile"),Nt(this,"imageRequest"),Nt(this,"tileUrl"),Nt(this,"fetchFn"),Nt(this,"abortController"),Nt(this,"data"),this.tile=t.tile,this.imageRequest=t.imageRequest,this.tileUrl=t.tileUrl,this.fetchFn=r,this.abortController=new AbortController}isCachedTile(){return this.data!==void 0}abort(){this.abortController.signal.aborted||this.abortController.abort()}}class x4{constructor(t,r){Nt(this,"mapId"),Nt(this,"tile"),Nt(this,"imageRequest"),Nt(this,"tileUrl"),this.mapId=r.mapId,this.tile=t;const n=r.parsedImage.getIiifTile(t.tileZoomLevel,t.column,t.row);this.imageRequest=n,this.tileUrl=r.parsedImage.getImageUrl(n)}}class c1 extends v4{async fetch(){try{const t=await(await GS(this.tileUrl,{signal:this.abortController.signal},this.fetchFn)).blob();this.data=await createImageBitmap(t),this.dispatchEvent(new Ur(Pe.TILEFETCHED,this.tileUrl))}catch(t){t instanceof Error&&t.name==="AbortError"||this.dispatchEvent(new Ur(Pe.TILEFETCHERROR,this.tileUrl))}return this.data}static createFactory(){return(t,r)=>new c1(t,r)}}const b4=0,w4=32*1e3*1e3;class E4 extends EventTarget{constructor(t,r){super(),Nt(this,"cachableTileFactory"),Nt(this,"fetchFn"),Nt(this,"tilesByTileUrl",new Map),Nt(this,"mapIdsByTileUrl",new Map),Nt(this,"tileUrlsByMapId",new Map),Nt(this,"tilesFetchingCount",0),Nt(this,"previousRequestedTiles",[]),Nt(this,"outgoingTilesHistory",[]),this.cachableTileFactory=t,this.fetchFn=r==null?void 0:r.fetchFn}getCacheableTile(t){return this.tilesByTileUrl.get(t)}getCachedTile(t){const r=this.tilesByTileUrl.get(t);if(r&&r.isCachedTile())return r}getCacheableTiles(){return this.tilesByTileUrl.values()}getCachedTiles(){const t=[];for(const r of this.tilesByTileUrl.values())r.isCachedTile()&&t.push(r);return t}getCachedTilesForMapId(t){var r;const n=[];for(const i of this.tilesByTileUrl.values())i.isCachedTile()&&(r=this.tileUrlsByMapId.get(t))!=null&&r.has(i.tileUrl)&&n.push(i);return n}getTileUrls(){return this.tilesByTileUrl.keys()}requestFetchableTiles(t){const r=gv(this.previousRequestedTiles),n=gv(t);if(oN(r,n))return;const i=[];for(const a of this.previousRequestedTiles)n.has(EI(a))||i.push(a);this.updateOutgoingTilesHistory(i,t.length);const l=gv(this.outgoingTilesHistory),h=new Set([...n,...l]);for(const[a,g]of this.mapIdsByTileUrl)for(const _ of g)h.has(wI(_,a))||this.removeMapTile(_,a);for(const a of t)this.addMapTile(a);this.previousRequestedTiles=t}async allRequestedTilesLoaded(){return new Promise(t=>{if(this.finished)t();else{const r=()=>{this.removeEventListener(Pe.ALLREQUESTEDTILESLOADED,r),t()};this.addEventListener(Pe.ALLREQUESTEDTILESLOADED,r)}})}getTileUrlsForMapId(t){return this.tileUrlsByMapId.get(t)||new Set}clear(){this.tilesByTileUrl=new Map,this.mapIdsByTileUrl=new Map,this.tileUrlsByMapId=new Map,this.tilesFetchingCount=0,this.outgoingTilesHistory=[]}dispose(){for(const t of this.getCacheableTiles())this.removeEventListenersFromTile(t)}addMapTile(t){const r=t.mapId,n=t.tileUrl;if(this.tilesByTileUrl.has(n))this.dispatchEvent(new Ur(Pe.MAPTILELOADED,{mapId:r,tileUrl:n}));else{const i=this.cachableTileFactory(t,this.fetchFn);this.addEventListenersToTile(i),this.tilesByTileUrl.set(n,i),this.updateTilesFetchingCount(1),i.fetch()}this.addTileUrlForMapId(r,n),this.addMapIdForTileUrl(r,n)}removeMapTile(t,r){const n=this.tilesByTileUrl.get(r);if(!n)return;const i=this.removeMapIdForTileUrl(t,r);this.removeTileUrlForMapId(t,r),i.size||(n.isCachedTile()||(n.abort(),this.updateTilesFetchingCount(-1)),this.tilesByTileUrl.delete(r)),this.dispatchEvent(new Ur(Pe.MAPTILEREMOVED,{mapId:t,tileUrl:r}))}updateOutgoingTilesHistory(t,r){for(let h=t.length-1;h>=0;h--){const a=t[h];this.outgoingTilesHistory.unshift(a)}this.outgoingTilesHistory=Array.from(new Set(this.outgoingTilesHistory));let n=0,i=0,l=0;for(const h of this.outgoingTilesHistory){if(n+=1,l=pz(h),i+=l,n+r>b4){n-=1,i-=l;break}if(i>w4){n-=1,i-=l;break}}this.outgoingTilesHistory=this.outgoingTilesHistory.slice(0,n)}tileFetched(t){var r;if(t instanceof Ur){const n=t.data;this.updateTilesFetchingCount(-1);for(const i of this.mapIdsByTileUrl.get(n)||[])this.dispatchEvent(new Ur(Pe.MAPTILELOADED,{mapId:i,tileUrl:n})),((r=this.tileUrlsByMapId.get(i))==null?void 0:r.values().next().value)===n&&this.dispatchEvent(new Ur(Pe.FIRSTMAPTILELOADED,{mapId:i,tileUrl:n}))}}tileFetchError(t){if(t instanceof Ur){const r=t.data;this.tilesByTileUrl.has(r)||this.updateTilesFetchingCount(-1)}}addMapIdForTileUrl(t,r){let n=this.mapIdsByTileUrl.get(r);return n?n.add(t):n=new Set([t]),this.mapIdsByTileUrl.set(r,n),n}removeMapIdForTileUrl(t,r){const n=this.mapIdsByTileUrl.get(r);if(n)n.delete(t);else return new Set;return n.size?this.mapIdsByTileUrl.set(r,n):this.mapIdsByTileUrl.delete(r),n}addTileUrlForMapId(t,r){let n=this.tileUrlsByMapId.get(t);return n?n.add(r):n=new Set([r]),this.tileUrlsByMapId.set(t,n),n}removeTileUrlForMapId(t,r){const n=this.tileUrlsByMapId.get(t);return n?(n.delete(r),n.size?this.tileUrlsByMapId.set(t,n):this.tileUrlsByMapId.delete(t),n):new Set}get finished(){return this.tilesFetchingCount===0}updateTilesFetchingCount(t){this.tilesFetchingCount+=t,this.tilesFetchingCount===0&&this.dispatchEvent(new Ur(Pe.ALLREQUESTEDTILESLOADED))}addEventListenersToTile(t){t.addEventListener(Pe.TILEFETCHED,this.tileFetched.bind(this)),t.addEventListener(Pe.TILEFETCHERROR,this.tileFetchError.bind(this))}removeEventListenersFromTile(t){t.removeEventListener(Pe.TILEFETCHED,this.tileFetched.bind(this)),t.removeEventListener(Pe.TILEFETCHERROR,this.tileFetchError.bind(this))}}const S4=5;class T4 extends EventTarget{constructor(t,r,n){super(),Nt(this,"warpedMapList"),Nt(this,"tileCache"),Nt(this,"mapsInViewport",new Set),Nt(this,"viewport"),this.tileCache=new E4(t,n),this.warpedMapList=new _4(r,n)}async addGeoreferenceAnnotation(t){return this.warpedMapList.addGeoreferenceAnnotation(t)}async addGeoreferencedMap(t){return this.warpedMapList.addGeoreferencedMap(t)}loadMissingImageInfosInViewport(){return this.viewport?Array.from(this.warpedMapList.getMapsByGeoBbox(this.viewport.geoRectangleBbox)).map(t=>this.warpedMapList.getWarpedMap(t)).filter(t=>!t.hasImageInfo()&&!t.loadingImageInfo).map(t=>t.loadImageInfo()):[]}someImageInfosInViewport(){return this.viewport?Array.from(this.warpedMapList.getMapsByGeoBbox(this.viewport.geoRectangleBbox)).map(t=>this.warpedMapList.getWarpedMap(t)).map(t=>t.hasImageInfo()).some(t=>t===!0):!1}shouldUpdateRequestedTiles(){return!0}updateRequestedTiles(){if(!this.viewport)return;const t=this.viewport;if(!this.shouldUpdateRequestedTiles())return;const r=Array.from(this.warpedMapList.getMapsByGeoBbox(this.viewport.geoRectangleBbox)).sort((i,l)=>{const h=this.warpedMapList.getWarpedMap(i),a=this.warpedMapList.getWarpedMap(l);return h&&a?Ba(Bd(h.geoMaskBbox),t.geoCenter)-Ba(Bd(a.geoMaskBbox),t.geoCenter):0}),n=[];for(const i of r){const l=this.warpedMapList.getWarpedMap(i);if(!l||!l.visible||!l.hasImageInfo()||rN(l.getViewportMaskBbox(t))<S4)continue;const h=sz(l.parsedImage,l.getResourceToCanvasScale(t));l.setBestScaleFactor(h.scaleFactor);const a={maxDepth:0,sourceIsGeographic:!1,destinationIsGeographic:!0},g=l.transformer.transformBackward([t.geoRectangle],a)[0];l.setResourceViewportRing(g);const _=az(g,h,l.parsedImage);for(const E of _)n.push(new x4(E,l))}this.tileCache.requestFetchableTiles(n),this.updateMapsInViewport(n)}updateMapsInViewport(t){const r=Array.from(this.mapsInViewport),n=t.map(h=>h.mapId).filter((h,a,g)=>g.indexOf(h)===a);this.mapsInViewport=new Set(n.sort((h,a)=>{const g=this.warpedMapList.getMapZIndex(h),_=this.warpedMapList.getMapZIndex(a);return g!==void 0&&_!==void 0?g-_:0}));const i=n.filter(h=>!r.includes(h)),l=r.filter(h=>!n.includes(h));for(const h in i)this.dispatchEvent(new Ur(Pe.WARPEDMAPENTER,h));for(const h in l)this.dispatchEvent(new Ur(Pe.WARPEDMAPLEAVE,h))}mapTileLoaded(t){}mapTileRemoved(t){}imageInfoLoaded(t){}warpedMapAdded(t){}warpedMapRemoved(t){}transformationChanged(t){}distortionChanged(t){}addEventListeners(){this.tileCache.addEventListener(Pe.MAPTILELOADED,this.mapTileLoaded.bind(this)),this.tileCache.addEventListener(Pe.MAPTILEREMOVED,this.mapTileRemoved.bind(this)),this.warpedMapList.addEventListener(Pe.IMAGEINFOLOADED,this.imageInfoLoaded.bind(this)),this.warpedMapList.addEventListener(Pe.WARPEDMAPADDED,this.warpedMapAdded.bind(this)),this.warpedMapList.addEventListener(Pe.WARPEDMAPREMOVED,this.warpedMapRemoved.bind(this)),this.warpedMapList.addEventListener(Pe.TRANSFORMATIONCHANGED,this.transformationChanged.bind(this)),this.warpedMapList.addEventListener(Pe.DISTORTIONCHANGED,this.distortionChanged.bind(this))}removeEventListeners(){this.tileCache.removeEventListener(Pe.MAPTILELOADED,this.mapTileLoaded.bind(this)),this.tileCache.removeEventListener(Pe.MAPTILEREMOVED,this.mapTileRemoved.bind(this)),this.warpedMapList.removeEventListener(Pe.IMAGEINFOLOADED,this.imageInfoLoaded.bind(this)),this.warpedMapList.removeEventListener(Pe.WARPEDMAPADDED,this.warpedMapAdded.bind(this)),this.warpedMapList.removeEventListener(Pe.WARPEDMAPREMOVED,this.warpedMapRemoved.bind(this)),this.warpedMapList.removeEventListener(Pe.TRANSFORMATIONCHANGED,this.transformationChanged.bind(this)),this.warpedMapList.removeEventListener(Pe.DISTORTIONCHANGED,this.distortionChanged.bind(this))}}var I4=`#version 300 es

precision highp float;

uniform mat4 u_renderTransform;

uniform float u_animationProgress;

in vec2 a_resourceTrianglePoint;
in vec2 a_clipPreviousTrianglePoint;
in vec2 a_clipTrianglePoint;
in float a_previousTrianglePointDistortion;
in float a_trianglePointDistortion;
in float a_triangleIndex;

out vec2 v_resourceTrianglePoint;
out float v_trianglePointDistortion;
out float v_triangleIndex;

float cubicInOut(float t) {
  return t < 0.5f ? 4.0f * t * t * t : 0.5f * pow(2.0f * t - 2.0f, 3.0f) + 1.0f;
}

void main() {
  
  vec2 clipTrianglePoint = mix(a_clipPreviousTrianglePoint, a_clipTrianglePoint, cubicInOut(u_animationProgress));
  float trianglePointDistortion = mix(a_previousTrianglePointDistortion, a_trianglePointDistortion, cubicInOut(u_animationProgress));

  
  
  

  gl_Position = u_renderTransform * vec4(clipTrianglePoint, 0.0f, 1.0f);

  
  v_resourceTrianglePoint = a_resourceTrianglePoint;
  v_trianglePointDistortion = trianglePointDistortion;
  v_triangleIndex = a_triangleIndex;
}`,C4=`#version 300 es

precision highp float;
precision highp isampler2D;

#ifndef SPECTRAL
#define SPECTRAL

const int SPECTRAL_SIZE = 38;
const float SPECTRAL_GAMMA = 2.4;
const float SPECTRAL_EPSILON = 0.0001;

float spectral_uncompand(float x) {
  return (x < 0.04045) ? x / 12.92 : pow((x + 0.055) / 1.055, SPECTRAL_GAMMA);
}

float spectral_compand(float x) {
  return (x < 0.0031308) ? x * 12.92 : 1.055 * pow(x, 1.0 / SPECTRAL_GAMMA) - 0.055;
}

vec3 spectral_srgb_to_linear(vec3 srgb) {
    return vec3(spectral_uncompand(srgb[0]), spectral_uncompand(srgb[1]), spectral_uncompand(srgb[2]));
}

vec3 spectral_linear_to_srgb(vec3 lrgb) {
    return clamp(vec3(spectral_compand(lrgb[0]), spectral_compand(lrgb[1]), spectral_compand(lrgb[2])), 0.0, 1.0);
}

void spectral_upsampling(vec3 lrgb, out float w, out float c, out float m, out float y, out float r, out float g, out float b) {
    w = min(lrgb.r, min(lrgb.g, lrgb.b));

    lrgb -= w;

    c = min(lrgb.g, lrgb.b);
    m = min(lrgb.r, lrgb.b);
    y = min(lrgb.r, lrgb.g);
    r = min(max(0., lrgb.r - lrgb.b), max(0., lrgb.r - lrgb.g));
    g = min(max(0., lrgb.g - lrgb.b), max(0., lrgb.g - lrgb.r));
    b = min(max(0., lrgb.b - lrgb.g), max(0., lrgb.b - lrgb.r));
}

void spectral_linear_to_reflectance(vec3 lrgb, inout float R[SPECTRAL_SIZE]) {
    float w, c, m, y, r, g, b;

    spectral_upsampling(lrgb, w, c, m, y, r, g, b);

     R[0] = max(SPECTRAL_EPSILON, w + c * 0.96853629 + m * 0.51567122 + y * 0.02055257 + r * 0.03147571 + g * 0.49108579 + b * 0.97901834);
     R[1] = max(SPECTRAL_EPSILON, w + c * 0.96855103 + m * 0.54015520 + y * 0.02059936 + r * 0.03146636 + g * 0.46944057 + b * 0.97901649);
     R[2] = max(SPECTRAL_EPSILON, w + c * 0.96859338 + m * 0.62645502 + y * 0.02062723 + r * 0.03140624 + g * 0.40165780 + b * 0.97901118);
     R[3] = max(SPECTRAL_EPSILON, w + c * 0.96877345 + m * 0.75595012 + y * 0.02073387 + r * 0.03119611 + g * 0.24490420 + b * 0.97892146);
     R[4] = max(SPECTRAL_EPSILON, w + c * 0.96942204 + m * 0.92826996 + y * 0.02114202 + r * 0.03053888 + g * 0.06826880 + b * 0.97858555);
     R[5] = max(SPECTRAL_EPSILON, w + c * 0.97143709 + m * 0.97223624 + y * 0.02233154 + r * 0.02856855 + g * 0.02732883 + b * 0.97743705);
     R[6] = max(SPECTRAL_EPSILON, w + c * 0.97541862 + m * 0.98616174 + y * 0.02556857 + r * 0.02459485 + g * 0.01360600 + b * 0.97428075);
     R[7] = max(SPECTRAL_EPSILON, w + c * 0.98074186 + m * 0.98955255 + y * 0.03330189 + r * 0.01929520 + g * 0.01000187 + b * 0.96663223);
     R[8] = max(SPECTRAL_EPSILON, w + c * 0.98580992 + m * 0.98676237 + y * 0.05185294 + r * 0.01423112 + g * 0.01284127 + b * 0.94822893);
     R[9] = max(SPECTRAL_EPSILON, w + c * 0.98971194 + m * 0.97312575 + y * 0.10087639 + r * 0.01033111 + g * 0.02636635 + b * 0.89937713);
    R[10] = max(SPECTRAL_EPSILON, w + c * 0.99238027 + m * 0.91944277 + y * 0.24000413 + r * 0.00765876 + g * 0.07058713 + b * 0.76070164);
    R[11] = max(SPECTRAL_EPSILON, w + c * 0.99409844 + m * 0.32564851 + y * 0.53589066 + r * 0.00593693 + g * 0.70421692 + b * 0.46420440);
    R[12] = max(SPECTRAL_EPSILON, w + c * 0.99517200 + m * 0.13820628 + y * 0.79874659 + r * 0.00485616 + g * 0.85473994 + b * 0.20123039);
    R[13] = max(SPECTRAL_EPSILON, w + c * 0.99576545 + m * 0.05015143 + y * 0.91186529 + r * 0.00426186 + g * 0.95081565 + b * 0.08808402);
    R[14] = max(SPECTRAL_EPSILON, w + c * 0.99593552 + m * 0.02912336 + y * 0.95399623 + r * 0.00409039 + g * 0.97170370 + b * 0.04592894);
    R[15] = max(SPECTRAL_EPSILON, w + c * 0.99564041 + m * 0.02421691 + y * 0.97137099 + r * 0.00438375 + g * 0.97651888 + b * 0.02860373);
    R[16] = max(SPECTRAL_EPSILON, w + c * 0.99464769 + m * 0.02660696 + y * 0.97939505 + r * 0.00537525 + g * 0.97429245 + b * 0.02060067);
    R[17] = max(SPECTRAL_EPSILON, w + c * 0.99229579 + m * 0.03407586 + y * 0.98345207 + r * 0.00772962 + g * 0.97012917 + b * 0.01656701);
    R[18] = max(SPECTRAL_EPSILON, w + c * 0.98638762 + m * 0.04835936 + y * 0.98553736 + r * 0.01366120 + g * 0.94258630 + b * 0.01451549);
    R[19] = max(SPECTRAL_EPSILON, w + c * 0.96829712 + m * 0.00011720 + y * 0.98648905 + r * 0.03181352 + g * 0.99989207 + b * 0.01357964);
    R[20] = max(SPECTRAL_EPSILON, w + c * 0.89228016 + m * 0.00008554 + y * 0.98674535 + r * 0.10791525 + g * 0.99989891 + b * 0.01331243);
    R[21] = max(SPECTRAL_EPSILON, w + c * 0.53740239 + m * 0.85267882 + y * 0.98657555 + r * 0.46249516 + g * 0.13823139 + b * 0.01347661);
    R[22] = max(SPECTRAL_EPSILON, w + c * 0.15360445 + m * 0.93188793 + y * 0.98611877 + r * 0.84604333 + g * 0.06968113 + b * 0.01387181);
    R[23] = max(SPECTRAL_EPSILON, w + c * 0.05705719 + m * 0.94810268 + y * 0.98559942 + r * 0.94275572 + g * 0.05628787 + b * 0.01435472);
    R[24] = max(SPECTRAL_EPSILON, w + c * 0.03126539 + m * 0.94200977 + y * 0.98507063 + r * 0.96860996 + g * 0.06111561 + b * 0.01479836);
    R[25] = max(SPECTRAL_EPSILON, w + c * 0.02205445 + m * 0.91478045 + y * 0.98460039 + r * 0.97783966 + g * 0.08987709 + b * 0.01515250);
    R[26] = max(SPECTRAL_EPSILON, w + c * 0.01802271 + m * 0.87065445 + y * 0.98425301 + r * 0.98187757 + g * 0.13656016 + b * 0.01540513);
    R[27] = max(SPECTRAL_EPSILON, w + c * 0.01613460 + m * 0.78827548 + y * 0.98403909 + r * 0.98377315 + g * 0.22169624 + b * 0.01557233);
    R[28] = max(SPECTRAL_EPSILON, w + c * 0.01520947 + m * 0.65738359 + y * 0.98388535 + r * 0.98470202 + g * 0.32176956 + b * 0.01565710);
    R[29] = max(SPECTRAL_EPSILON, w + c * 0.01475977 + m * 0.59909403 + y * 0.98376116 + r * 0.98515481 + g * 0.36157329 + b * 0.01571025);
    R[30] = max(SPECTRAL_EPSILON, w + c * 0.01454263 + m * 0.56817268 + y * 0.98368246 + r * 0.98537114 + g * 0.48361920 + b * 0.01571916);
    R[31] = max(SPECTRAL_EPSILON, w + c * 0.01444459 + m * 0.54031997 + y * 0.98365023 + r * 0.98546685 + g * 0.46488579 + b * 0.01572133);
    R[32] = max(SPECTRAL_EPSILON, w + c * 0.01439897 + m * 0.52110241 + y * 0.98361309 + r * 0.98550011 + g * 0.47440306 + b * 0.01572502);
    R[33] = max(SPECTRAL_EPSILON, w + c * 0.01437620 + m * 0.51041094 + y * 0.98357259 + r * 0.98551031 + g * 0.48576990 + b * 0.01571717);
    R[34] = max(SPECTRAL_EPSILON, w + c * 0.01436343 + m * 0.50526577 + y * 0.98353856 + r * 0.98550741 + g * 0.49267971 + b * 0.01571905);
    R[35] = max(SPECTRAL_EPSILON, w + c * 0.01435687 + m * 0.50255080 + y * 0.98351247 + r * 0.98551323 + g * 0.49625685 + b * 0.01571059);
    R[36] = max(SPECTRAL_EPSILON, w + c * 0.01435370 + m * 0.50126452 + y * 0.98350101 + r * 0.98551563 + g * 0.49807754 + b * 0.01569728);
    R[37] = max(SPECTRAL_EPSILON, w + c * 0.01435408 + m * 0.50083021 + y * 0.98350852 + r * 0.98551547 + g * 0.49889859 + b * 0.01570020);
}

vec3 spectral_xyz_to_srgb(vec3 xyz) {
    mat3 XYZ_RGB;

    XYZ_RGB[0] = vec3( 3.24306333, -1.53837619, -0.49893282);
    XYZ_RGB[1] = vec3(-0.96896309,  1.87542451,  0.04154303);
    XYZ_RGB[2] = vec3( 0.05568392, -0.20417438,  1.05799454);

    float r = dot(XYZ_RGB[0], xyz);
    float g = dot(XYZ_RGB[1], xyz);
    float b = dot(XYZ_RGB[2], xyz);

    return spectral_linear_to_srgb(vec3(r, g, b));
}

vec3 spectral_reflectance_to_xyz(float R[SPECTRAL_SIZE]) {
    vec3 xyz = vec3(0.0);

    xyz +=  R[0] * vec3(0.00006469, 0.00000184, 0.00030502);
    xyz +=  R[1] * vec3(0.00021941, 0.00000621, 0.00103681);
    xyz +=  R[2] * vec3(0.00112057, 0.00003101, 0.00531314);
    xyz +=  R[3] * vec3(0.00376661, 0.00010475, 0.01795439);
    xyz +=  R[4] * vec3(0.01188055, 0.00035364, 0.05707758);
    xyz +=  R[5] * vec3(0.02328644, 0.00095147, 0.11365162);
    xyz +=  R[6] * vec3(0.03455942, 0.00228226, 0.17335873);
    xyz +=  R[7] * vec3(0.03722379, 0.00420733, 0.19620658);
    xyz +=  R[8] * vec3(0.03241838, 0.00668880, 0.18608237);
    xyz +=  R[9] * vec3(0.02123321, 0.00988840, 0.13995048);
    xyz += R[10] * vec3(0.01049099, 0.01524945, 0.08917453);
    xyz += R[11] * vec3(0.00329584, 0.02141831, 0.04789621);
    xyz += R[12] * vec3(0.00050704, 0.03342293, 0.02814563);
    xyz += R[13] * vec3(0.00094867, 0.05131001, 0.01613766);
    xyz += R[14] * vec3(0.00627372, 0.07040208, 0.00775910);
    xyz += R[15] * vec3(0.01686462, 0.08783871, 0.00429615);
    xyz += R[16] * vec3(0.02868965, 0.09424905, 0.00200551);
    xyz += R[17] * vec3(0.04267481, 0.09795667, 0.00086147);
    xyz += R[18] * vec3(0.05625475, 0.09415219, 0.00036904);
    xyz += R[19] * vec3(0.06947040, 0.08678102, 0.00019143);
    xyz += R[20] * vec3(0.08305315, 0.07885653, 0.00014956);
    xyz += R[21] * vec3(0.08612610, 0.06352670, 0.00009231);
    xyz += R[22] * vec3(0.09046614, 0.05374142, 0.00006813);
    xyz += R[23] * vec3(0.08500387, 0.04264606, 0.00002883);
    xyz += R[24] * vec3(0.07090667, 0.03161735, 0.00001577);
    xyz += R[25] * vec3(0.05062889, 0.02088521, 0.00000394);
    xyz += R[26] * vec3(0.03547396, 0.01386011, 0.00000158);
    xyz += R[27] * vec3(0.02146821, 0.00810264, 0.00000000);
    xyz += R[28] * vec3(0.01251646, 0.00463010, 0.00000000);
    xyz += R[29] * vec3(0.00680458, 0.00249138, 0.00000000);
    xyz += R[30] * vec3(0.00346457, 0.00125930, 0.00000000);
    xyz += R[31] * vec3(0.00149761, 0.00054165, 0.00000000);
    xyz += R[32] * vec3(0.00076970, 0.00027795, 0.00000000);
    xyz += R[33] * vec3(0.00040737, 0.00014711, 0.00000000);
    xyz += R[34] * vec3(0.00016901, 0.00006103, 0.00000000);
    xyz += R[35] * vec3(0.00009522, 0.00003439, 0.00000000);
    xyz += R[36] * vec3(0.00004903, 0.00001771, 0.00000000);
    xyz += R[37] * vec3(0.00002000, 0.00000722, 0.00000000);

    return xyz;
}

float spectral_linear_to_concentration(float l1, float l2, float t) {
    float t1 = l1 * pow(1.0 - t, 2.0);
    float t2 = l2 * pow(t, 2.0);

    return t2 / (t1 + t2);
}

vec3 spectral_mix(vec3 color1, vec3 color2, float t) {
    vec3 lrgb1 = spectral_srgb_to_linear(color1);
    vec3 lrgb2 = spectral_srgb_to_linear(color2);

    float R1[SPECTRAL_SIZE];
    float R2[SPECTRAL_SIZE];

    spectral_linear_to_reflectance(lrgb1, R1);
    spectral_linear_to_reflectance(lrgb2, R2);

    float l1 = spectral_reflectance_to_xyz(R1)[1];
    float l2 = spectral_reflectance_to_xyz(R2)[1];

    t = spectral_linear_to_concentration(l1, l2, t);

    float R[SPECTRAL_SIZE];

    for (int i = 0; i < SPECTRAL_SIZE; i++) {
      float KS = (1.0 - t) * (pow(1.0 - R1[i], 2.0) / (2.0 * R1[i])) + t * (pow(1.0 - R2[i], 2.0) / (2.0 * R2[i]));
      float KM = 1.0 + KS - sqrt(pow(KS, 2.0) + 2.0 * KS);

      
      

      R[i] = KM;
    }

    return spectral_xyz_to_srgb(spectral_reflectance_to_xyz(R));
}

vec4 spectral_mix(vec4 color1, vec4 color2, float t) {
    return vec4(spectral_mix(color1.rgb, color2.rgb, t), mix(color1.a, color2.a, t));
}

#endif

uniform bool u_removeColor;
uniform vec3 u_removeColorOptionsColor;
uniform float u_removeColorOptionsThreshold;
uniform float u_removeColorOptionsHardness;

uniform bool u_colorize;
uniform vec3 u_colorizeOptionsColor;

uniform bool u_grid;

uniform float u_opacity;
uniform float u_saturation;

uniform bool u_distortion;
uniform int u_distortionOptionsdistortionMeasure;

uniform int u_bestScaleFactor;

uniform sampler2D u_packedTilesTexture;
uniform isampler2D u_packedTilesPositionsTexture;
uniform isampler2D u_packedTilesResourcePositionsAndDimensionsTexture;
uniform isampler2D u_packedTilesScaleFactorsTexture;

in vec2 v_resourceTrianglePoint;
in float v_triangleIndex;
in float v_trianglePointDistortion;

out vec4 color;

vec4 rgbToVec4(int r, int g, int b) {
  return vec4(float(r) / 255.0f, float(g) / 255.0f, float(b) / 255.0f, 1.0f);
}

void main() {
  
  
  
  vec4 colorTransparent = vec4(0.0f, 0.0f, 0.0f, 0.0f);
  vec4 colorWhite = vec4(1.0f, 1.0f, 1.0f, 1.0f);
  vec4 colorBlack = vec4(0.0f, 0.0f, 0.0f, 1.0f);

  vec4 colorGreen300 = vec4(0.5254f, 0.9372f, 0.6745f, 1.0f);
  vec4 colorPurple300 = vec4(0.8470f, 0.7058f, 0.9960f, 1.0f);
  vec4 colorRed300 = vec4(0.9882f, 0.6470f, 0.6470f, 1.0f);
  vec4 colorYellow300 = vec4(0.9921f, 0.8784f, 0.2784f, 1.0f);
  vec4 colorOrange300 = vec4(0.9921f, 0.7294f, 0.4549f, 1.0f);
  vec4 colorPink300 = vec4(0.9764f, 0.6588f, 0.8313f, 1.0f);
  vec4 colorBlue300 = vec4(0.5764f, 0.7725f, 0.9921f, 1.0f);
  vec4 colorGrey300 = vec4(0.8196f, 0.8352f, 0.8588f, 1.0f);

  vec4 colorGreen500 = vec4(0.1333f, 0.7725f, 0.3686f, 1.0f);
  vec4 colorPurple500 = vec4(0.6588f, 0.3333f, 0.9686f, 1.0f);
  vec4 colorRed500 = vec4(0.9372f, 0.2666f, 0.2666f, 1.0f);
  vec4 colorYellow500 = vec4(0.9176f, 0.7019f, 0.0313f, 1.0f);
  vec4 colorOrange500 = vec4(0.9764f, 0.4509f, 0.0862f, 1.0f);
  vec4 colorPink500 = vec4(0.9254f, 0.2823f, 0.6f, 1.0f);
  vec4 colorBlue500 = vec4(0.2313f, 0.5098f, 0.9647f, 1.0f);
  vec4 colorGrey500 = vec4(0.4196f, 0.4470f, 0.5019f, 1.0f);

  float resourceTrianglePointX = v_resourceTrianglePoint.x;
  float resourceTrianglePointY = v_resourceTrianglePoint.y;

  
  int packedTilesCount = textureSize(u_packedTilesPositionsTexture, 0).y;
  ivec2 packedTilesTextureSize = textureSize(u_packedTilesTexture, 0);

  
  int smallestScaleFactorDiff = 256 * 256; 
  int bestScaleFactor = 0;

  
  vec2 packedTilesTexturePoint = vec2(0.0f, 0.0f);

  
  color = colorTransparent;
  bool found = false;

  
  for(int index = 0; index < packedTilesCount; index += 1) {

    
    ivec2 packedTilePosition = texelFetch(u_packedTilesPositionsTexture, ivec2(0, index), 0).rg;
    ivec4 packedTileResourcePositionAndDimension = texelFetch(u_packedTilesResourcePositionsAndDimensionsTexture, ivec2(0, index), 0);
    int packedTileScaleFactor = texelFetch(u_packedTilesScaleFactorsTexture, ivec2(0, index), 0).r;

    float packedTilePositionX = float(packedTilePosition.r);
    float packedTilePositionY = float(packedTilePosition.g);

    float packedTileResourcePositionX = float(packedTileResourcePositionAndDimension.r);
    float packedTileResourcePositionY = float(packedTileResourcePositionAndDimension.g);

    float packedTileDimensionWidth = float(packedTileResourcePositionAndDimension.b);
    float packedTileDimensionHeight = float(packedTileResourcePositionAndDimension.a);

    
    
    
    
    if(resourceTrianglePointX >= packedTileResourcePositionX &&
      resourceTrianglePointX < packedTileResourcePositionX + packedTileDimensionWidth &&
      resourceTrianglePointY >= packedTileResourcePositionY &&
      resourceTrianglePointY < packedTileResourcePositionY + packedTileDimensionHeight) {
      found = true;

      int scaleFactorDiff = abs(u_bestScaleFactor - packedTileScaleFactor);

      if(scaleFactorDiff < smallestScaleFactorDiff || bestScaleFactor == 0) {

        smallestScaleFactorDiff = scaleFactorDiff;
        bestScaleFactor = packedTileScaleFactor;

        float packedTilePointX = (resourceTrianglePointX - packedTileResourcePositionX) / float(bestScaleFactor);
        float packedTilePointY = (resourceTrianglePointY - packedTileResourcePositionY) / float(bestScaleFactor);

        float packedTilesPointX = packedTilePositionX + packedTilePointX;
        float packedTilesPointY = packedTilePositionY + packedTilePointY;

        float packedTilesTexturePointX = packedTilesPointX / float(packedTilesTextureSize.x);
        float packedTilesTexturePointY = packedTilesPointY / float(packedTilesTextureSize.y);

        packedTilesTexturePoint = vec2(packedTilesTexturePointX, packedTilesTexturePointY);
      }
    }
  }

  if(found == true) {
    
    color = texture(u_packedTilesTexture, packedTilesTexturePoint);

    
    if(u_removeColorOptionsThreshold > 0.0f) {
      vec3 backgroundColorDiff = color.rgb - u_removeColorOptionsColor.rgb;
      float backgroundColorDistance = length(backgroundColorDiff);
      if(u_removeColor && backgroundColorDistance < u_removeColorOptionsThreshold) {
        float amount = smoothstep(u_removeColorOptionsThreshold - u_removeColorOptionsThreshold * (1.0f - u_removeColorOptionsHardness), u_removeColorOptionsThreshold, backgroundColorDistance);
        color = vec4(color.rgb * amount, amount);
      }
    }

    
    float gray = 0.21f * color.r + 0.71f * color.g + 0.07f * color.b;
    color = vec4(color.rgb * (u_saturation) + (gray * (1.0f - u_saturation)), color.a);

    
    if(u_colorize) {
      color = vec4((u_colorizeOptionsColor + color.rgb) * color.a, color.a);
    }

    
    color = vec4(color.rgb * u_opacity, color.a * u_opacity);

    
    
    if(u_distortion) {
      
      

      float trianglePointDistortion = v_trianglePointDistortion;

      
      trianglePointDistortion = floor(trianglePointDistortion * 10.0f) / 10.0f;

      switch(u_distortionOptionsdistortionMeasure) {
        case 0:
          if(trianglePointDistortion > 0.0f) {
            color = spectral_mix(color, colorRed500, trianglePointDistortion);
          } else {
            color = spectral_mix(color, colorBlue500, abs(trianglePointDistortion));
          }
          break;
        case 1:
          color = spectral_mix(color, colorGreen500, trianglePointDistortion);
          break;
        case 2:
          color = spectral_mix(color, colorYellow500, trianglePointDistortion);
          break;
        case 3:
          color = trianglePointDistortion == -1.0f ? colorRed300 : color;
          break;
        default:
          color = color;
      }
    }

    
    
    if(false) {
      color = vec4(abs(sin(v_triangleIndex)), abs(sin(v_triangleIndex + 1.0f)), abs(sin(v_triangleIndex + 2.0f)), 1);
    }

    
    if(u_grid) {
      float gridSize = 20.0f * float(u_bestScaleFactor);
      float gridWidth = 2.0f * float(u_bestScaleFactor);
      if(mod(float(resourceTrianglePointX) + gridWidth / 2.0f, gridSize) < gridWidth || mod(float(resourceTrianglePointY) + gridWidth / 2.0f, gridSize) < gridWidth) {
        color = colorBlack;
      }
    }
  }
}`;const M4=500,P4={leading:!0,trailing:!0},A4=50,L4={leading:!0,trailing:!0},vv=1,xv=1,R4=0,D4=.7,N4=5,KE=750;class k4 extends T4{constructor(t,r){const n=GE(t,t.VERTEX_SHADER,I4),i=GE(t,t.FRAGMENT_SHADER,C4),l=mz(t,n,i);super(c1.createFactory(),xz(t,l),r),Nt(this,"gl"),Nt(this,"program"),Nt(this,"previousSignificantViewport"),Nt(this,"opacity",vv),Nt(this,"saturation",xv),Nt(this,"renderOptions",{}),Nt(this,"invertedRenderTransform"),Nt(this,"lastAnimationFrameRequestId"),Nt(this,"animating",!1),Nt(this,"transformationTransitionStart"),Nt(this,"animationProgress",1),Nt(this,"throttledPrepareRenderInternal"),Nt(this,"throttledChanged"),this.gl=t,this.program=l,t.deleteShader(n),t.deleteShader(i),t.disable(t.DEPTH_TEST),this.invertedRenderTransform=AD(),this.addEventListeners(),this.throttledPrepareRenderInternal=ax(this.prepareRenderInternal.bind(this),M4,P4),this.throttledChanged=ax(this.changed.bind(this),A4,L4)}getOpacity(){return this.opacity}setOpacity(t){this.opacity=t}resetOpacity(){this.opacity=vv}getMapOpacity(t){const r=this.warpedMapList.getWarpedMap(t);if(r)return r.opacity}setMapOpacity(t,r){const n=this.warpedMapList.getWarpedMap(t);n&&(n.opacity=Math.min(Math.max(r,0),1))}resetMapOpacity(t){const r=this.warpedMapList.getWarpedMap(t);r&&(r.opacity=vv)}getRemoveColorOptions(){return this.renderOptions.removeColorOptions}setRemoveColorOptions(t){this.renderOptions.removeColorOptions=t}resetRemoveColorOptions(){this.renderOptions.removeColorOptions=void 0}getMapRemoveColorOptions(t){const r=this.warpedMapList.getWarpedMap(t);if(r)return r.renderOptions.removeColorOptions}setMapRemoveColorOptions(t,r){const n=this.warpedMapList.getWarpedMap(t);n&&(n.renderOptions.removeColorOptions=r)}resetMapRemoveColorOptions(t){const r=this.warpedMapList.getWarpedMap(t);r&&(r.renderOptions.removeColorOptions=void 0)}getColorizeOptions(){return this.renderOptions.colorizeOptions}setColorizeOptions(t){this.renderOptions.colorizeOptions=t}resetColorizeOptions(){this.renderOptions.colorizeOptions=void 0}getMapColorizeOptions(t){const r=this.warpedMapList.getWarpedMap(t);if(r)return r.renderOptions.colorizeOptions}setMapColorizeOptions(t,r){const n=this.warpedMapList.getWarpedMap(t);n&&(n.renderOptions.colorizeOptions=r)}resetMapColorizeOptions(t){const r=this.warpedMapList.getWarpedMap(t);r&&(r.renderOptions.colorizeOptions=void 0)}getGridOptions(){return this.renderOptions.gridOptions}setGridOptions(t){this.renderOptions.gridOptions=t}resetGridOptions(){this.renderOptions.gridOptions=void 0}getMapGridOptions(t){const r=this.warpedMapList.getWarpedMap(t);if(r)return r.renderOptions.gridOptions}setMapGridOptions(t,r){const n=this.warpedMapList.getWarpedMap(t);n&&(n.renderOptions.gridOptions=r)}resetMapGridOptions(t){const r=this.warpedMapList.getWarpedMap(t);r&&(r.renderOptions.gridOptions=void 0)}getSaturation(){return this.saturation}setSaturation(t){this.saturation=t}resetSaturation(){this.saturation=xv}getMapSaturation(t){const r=this.warpedMapList.getWarpedMap(t);if(r)return r.saturation}setMapSaturation(t,r){const n=this.warpedMapList.getWarpedMap(t);n&&(n.saturation=r)}resetMapSaturation(t){const r=this.warpedMapList.getWarpedMap(t);r&&(r.saturation=xv)}render(t){this.viewport=t,this.loadMissingImageInfosInViewport(),this.someImageInfosInViewport()&&this.throttledPrepareRenderInternal(),this.renderInternal()}clear(){this.warpedMapList.clear(),this.mapsInViewport=new Set,this.gl.clear(this.gl.DEPTH_BUFFER_BIT|this.gl.COLOR_BUFFER_BIT),this.tileCache.clear()}dispose(){for(const t of this.warpedMapList.getWarpedMaps())this.removeEventListenersFromWebGL2WarpedMap(t),t.dispose();this.tileCache.clear(),this.tileCache.dispose(),this.removeEventListeners(),this.gl.deleteProgram(this.program)}prepareRenderInternal(){this.updateRequestedTiles(),this.updateVertexBuffers()}shouldUpdateRequestedTiles(){if(!this.viewport||this.animating)return!1;if(this.previousSignificantViewport){const t=[];for(let n=0;n<4;n++)t.push(Ba(this.previousSignificantViewport.projectedGeoRectangle[n],this.viewport.projectedGeoRectangle[n])/this.viewport.projectedGeoPerViewportScale);const r=Math.max(...t);return r===0?!0:r>N4?(this.previousSignificantViewport=this.viewport,!0):!1}else return this.previousSignificantViewport=this.viewport,!0}updateVertexBuffers(){if(this.viewport){this.invertedRenderTransform=RD(this.viewport.projectedGeoToClipTransform);for(const t of this.mapsInViewport){const r=this.warpedMapList.getWarpedMap(t);if(!r)break;r.updateVertexBuffers(this.viewport.projectedGeoToClipTransform)}}}renderInternal(){if(!this.viewport)return;const t=LD(this.viewport.projectedGeoToClipTransform,this.invertedRenderTransform),r=this.gl;r.viewport(0,0,r.canvas.width,r.canvas.height),r.enable(r.BLEND),r.blendFunc(r.ONE,r.ONE_MINUS_SRC_ALPHA),r.useProgram(this.program);const n=r.getUniformLocation(this.program,"u_renderTransform");r.uniformMatrix4fv(n,!1,ND(t));const i=r.getUniformLocation(this.program,"u_animationProgress");r.uniform1f(i,this.animationProgress);for(const l of this.mapsInViewport){const h=this.warpedMapList.getWarpedMap(l);if(!h)continue;this.setRenderOptionsUniforms(this.renderOptions,h.renderOptions);const a=r.getUniformLocation(this.program,"u_opacity");r.uniform1f(a,this.opacity*h.opacity);const g=r.getUniformLocation(this.program,"u_saturation");r.uniform1f(g,this.saturation*h.saturation);const _=r.getUniformLocation(this.program,"u_distortion");if(r.uniform1f(_,h.distortionMeasure?1:0),h.distortionMeasure){const $=r.getUniformLocation(this.program,"u_distortionOptionsdistortionMeasure");r.uniform1i($,QT.indexOf(h.distortionMeasure))}const E=r.getUniformLocation(this.program,"u_bestScaleFactor"),S=h.bestScaleFactor;r.uniform1i(E,S);const A=r.getUniformLocation(this.program,"u_packedTilesTexture");r.uniform1i(A,0),r.activeTexture(r.TEXTURE0),r.bindTexture(r.TEXTURE_2D,h.packedTilesTexture);const O=r.getUniformLocation(this.program,"u_packedTilesPositionsTexture");r.uniform1i(O,1),r.activeTexture(r.TEXTURE1),r.bindTexture(r.TEXTURE_2D,h.packedTilesPositionsTexture);const k=r.getUniformLocation(this.program,"u_packedTilesResourcePositionsAndDimensionsTexture");r.uniform1i(k,2),r.activeTexture(r.TEXTURE2),r.bindTexture(r.TEXTURE_2D,h.packedTilesResourcePositionsAndDimensionsTexture);const G=r.getUniformLocation(this.program,"u_packedTilesScaleFactorsTexture");r.uniform1i(G,3),r.activeTexture(r.TEXTURE3),r.bindTexture(r.TEXTURE_2D,h.packedTilesScaleFactorsTexture);const W=h.vao,U=h.resourceTrianglePoints.length,tt=this.gl.TRIANGLES;r.bindVertexArray(W),r.drawArrays(tt,0,U)}}setRenderOptionsUniforms(t,r){var n,i,l,h,a,g,_,E,S,A,O;const k=this.gl,G={removeColorOptions:{color:((n=r.removeColorOptions)==null?void 0:n.color)||((i=t.removeColorOptions)==null?void 0:i.color),hardness:yE((l=r.removeColorOptions)==null?void 0:l.hardness,(h=t.removeColorOptions)==null?void 0:h.hardness),threshold:yE((a=r.removeColorOptions)==null?void 0:a.threshold,(g=t.removeColorOptions)==null?void 0:g.threshold)},colorizeOptions:{...t.colorizeOptions,...r.colorizeOptions},gridOptions:{...t.gridOptions,...r.gridOptions}},W=(_=G.removeColorOptions)==null?void 0:_.color,U=k.getUniformLocation(this.program,"u_removeColor");if(k.uniform1f(U,W?1:0),W){const vt=k.getUniformLocation(this.program,"u_removeColorOptionsColor");k.uniform3fv(vt,W);const ot=k.getUniformLocation(this.program,"u_removeColorOptionsThreshold");k.uniform1f(ot,((E=G.removeColorOptions)==null?void 0:E.threshold)||R4);const et=k.getUniformLocation(this.program,"u_removeColorOptionsHardness");k.uniform1f(et,((S=G.removeColorOptions)==null?void 0:S.hardness)||D4)}const tt=(A=G.colorizeOptions)==null?void 0:A.color,$=k.getUniformLocation(this.program,"u_colorize");if(k.uniform1f($,tt?1:0),tt){const vt=k.getUniformLocation(this.program,"u_colorizeOptionsColor");k.uniform3fv(vt,tt)}const V=(O=G.gridOptions)==null?void 0:O.enabled,it=k.getUniformLocation(this.program,"u_grid");k.uniform1f(it,V?1:0)}startTransformationTransition(){this.lastAnimationFrameRequestId!==void 0&&cancelAnimationFrame(this.lastAnimationFrameRequestId),this.animating=!0,this.transformationTransitionStart=void 0,this.lastAnimationFrameRequestId=requestAnimationFrame(this.transformationTransitionFrame.bind(this))}transformationTransitionFrame(t){if(this.transformationTransitionStart||(this.transformationTransitionStart=t),t-this.transformationTransitionStart<KE)this.animationProgress=(t-this.transformationTransitionStart)/KE,this.renderInternal(),this.lastAnimationFrameRequestId=requestAnimationFrame(this.transformationTransitionFrame.bind(this));else{for(const r of this.warpedMapList.getWarpedMaps())r.resetTrianglePoints();this.updateVertexBuffers(),this.animating=!1,this.animationProgress=0,this.transformationTransitionStart=void 0}}changed(){this.dispatchEvent(new Ur(Pe.CHANGED))}imageInfoLoaded(t){t instanceof Ur&&this.dispatchEvent(new Ur(Pe.IMAGEINFOLOADED))}mapTileLoaded(t){if(t instanceof Ur){const{mapId:r,tileUrl:n}=t.data,i=this.tileCache.getCacheableTile(n);if(!i||!i.isCachedTile())return;const l=this.warpedMapList.getWarpedMap(r);if(!l)return;l.addCachedTileAndUpdateTextures(i)}}mapTileRemoved(t){if(t instanceof Ur){const{mapId:r,tileUrl:n}=t.data,i=this.warpedMapList.getWarpedMap(r);if(!i)return;i.removeCachedTileAndUpdateTextures(n)}}warpedMapAdded(t){if(t instanceof Ur){const r=t.data,n=this.warpedMapList.getWarpedMap(r);n&&this.addEventListenersToWebGL2WarpedMap(n)}}transformationChanged(t){if(t instanceof Ur){const r=t.data;for(const n of this.warpedMapList.getWarpedMaps(r))this.animating&&n.mixTrianglePoints(this.animationProgress),n.updateProjectedGeoTrianglePoints(!1);this.updateVertexBuffers(),this.startTransformationTransition()}}distortionChanged(t){if(t instanceof Ur){const r=t.data;for(const n of this.warpedMapList.getWarpedMaps(r))this.animating&&n.mixTrianglePoints(this.animationProgress),n.updateTrianglePointsDistortion(!1);this.updateVertexBuffers(),this.startTransformationTransition()}}addEventListenersToWebGL2WarpedMap(t){t.addEventListener(Pe.TEXTURESUPDATED,this.throttledChanged.bind(this))}removeEventListenersFromWebGL2WarpedMap(t){t.removeEventListener(Pe.TEXTURESUPDATED,this.throttledChanged.bind(this))}}const O4="Renderer not defined. Add the layer to a map before calling this function.";function zr(e){if(!e)throw new Error(O4)}class F4{constructor(t,r){Nt(this,"id","warped-map-layer"),Nt(this,"type","custom"),Nt(this,"renderingMode","2d"),Nt(this,"map"),Nt(this,"renderer"),Nt(this,"options"),t&&(this.id=t),this.options=r}onAdd(t,r){this.map=t,this.renderer=new k4(r,this.options),this.addEventListeners()}onRemove(){this.renderer&&(this.renderer.dispose(),this.removeEventListeners())}async addGeoreferenceAnnotation(t){var r;zr(this.renderer);const n=await this.renderer.warpedMapList.addGeoreferenceAnnotation(t);return(r=this.map)==null||r.triggerRepaint(),n}async removeGeoreferenceAnnotation(t){var r;zr(this.renderer);const n=await this.renderer.warpedMapList.removeGeoreferenceAnnotation(t);return(r=this.map)==null||r.triggerRepaint(),n}async addGeoreferenceAnnotationByUrl(t){const r=await fetch(t).then(n=>n.json());return this.addGeoreferenceAnnotation(r)}async removeGeoreferenceAnnotationByUrl(t){const r=await fetch(t).then(n=>n.json());return this.removeGeoreferenceAnnotation(r)}async addGeoreferencedMap(t){var r;zr(this.renderer);const n=this.renderer.warpedMapList.addGeoreferencedMap(t);return(r=this.map)==null||r.triggerRepaint(),n}async removeGeoreferencedMap(t){var r;zr(this.renderer);const n=this.renderer.warpedMapList.removeGeoreferencedMap(t);return(r=this.map)==null||r.triggerRepaint(),n}getWarpedMapList(){return zr(this.renderer),this.renderer.warpedMapList}getWarpedMap(t){return zr(this.renderer),this.renderer.warpedMapList.getWarpedMap(t)}showMap(t){var r;zr(this.renderer),this.renderer.warpedMapList.showMaps([t]),(r=this.map)==null||r.triggerRepaint()}showMaps(t){var r;zr(this.renderer),this.renderer.warpedMapList.showMaps(t),(r=this.map)==null||r.triggerRepaint()}hideMap(t){var r;zr(this.renderer),this.renderer.warpedMapList.hideMaps([t]),(r=this.map)==null||r.triggerRepaint()}hideMaps(t){var r;zr(this.renderer),this.renderer.warpedMapList.hideMaps(t),(r=this.map)==null||r.triggerRepaint()}isMapVisible(t){var r;return zr(this.renderer),(r=this.renderer.warpedMapList.getWarpedMap(t))==null?void 0:r.visible}setMapResourceMask(t,r){var n;zr(this.renderer),this.renderer.warpedMapList.setMapResourceMask(t,r),(n=this.map)==null||n.triggerRepaint()}setMapsTransformationType(t,r){var n;zr(this.renderer),this.renderer.warpedMapList.setMapsTransformationType(t,r),(n=this.map)==null||n.triggerRepaint()}setMapsDistortionMeasure(t,r){var n;zr(this.renderer),this.renderer.warpedMapList.setMapsDistortionMeasure(t,r),(n=this.map)==null||n.triggerRepaint()}getBounds(){zr(this.renderer);const t=this.renderer.warpedMapList.getBbox();if(t)return[[t[0],t[1]],[t[2],t[3]]]}bringMapsToFront(t){var r;zr(this.renderer),this.renderer.warpedMapList.bringMapsToFront(t),(r=this.map)==null||r.triggerRepaint()}sendMapsToBack(t){var r;zr(this.renderer),this.renderer.warpedMapList.sendMapsToBack(t),(r=this.map)==null||r.triggerRepaint()}bringMapsForward(t){var r;zr(this.renderer),this.renderer.warpedMapList.bringMapsForward(t),(r=this.map)==null||r.triggerRepaint()}sendMapsBackward(t){var r;zr(this.renderer),this.renderer.warpedMapList.sendMapsBackward(t),(r=this.map)==null||r.triggerRepaint()}getMapZIndex(t){return zr(this.renderer),this.renderer.warpedMapList.getMapZIndex(t)}setImageInformations(t){zr(this.renderer),this.renderer.warpedMapList.setImageInformations(t)}getOpacity(){return zr(this.renderer),this.renderer.getOpacity()}setOpacity(t){var r;zr(this.renderer),this.renderer.setOpacity(t),(r=this.map)==null||r.triggerRepaint()}resetOpacity(){var t;zr(this.renderer),this.renderer.resetOpacity(),(t=this.map)==null||t.triggerRepaint()}getMapOpacity(t){return zr(this.renderer),this.renderer.getMapOpacity(t)}setMapOpacity(t,r){var n;zr(this.renderer),this.renderer.setMapOpacity(t,r),(n=this.map)==null||n.triggerRepaint()}resetMapOpacity(t){var r;zr(this.renderer),this.renderer.resetMapOpacity(t),(r=this.map)==null||r.triggerRepaint()}setSaturation(t){var r;zr(this.renderer),this.renderer.setSaturation(t),(r=this.map)==null||r.triggerRepaint()}resetSaturation(){var t;zr(this.renderer),this.renderer.resetSaturation(),(t=this.map)==null||t.triggerRepaint()}setMapSaturation(t,r){var n;zr(this.renderer),this.renderer.setMapSaturation(t,r),(n=this.map)==null||n.triggerRepaint()}resetMapSaturation(t){var r;zr(this.renderer),this.renderer.resetMapSaturation(t),(r=this.map)==null||r.triggerRepaint()}setRemoveColor(t){var r;zr(this.renderer);const n=t.hexColor?fy(t.hexColor):void 0;this.renderer.setRemoveColorOptions({color:n,threshold:t.threshold,hardness:t.hardness}),(r=this.map)==null||r.triggerRepaint()}resetRemoveColor(){var t;zr(this.renderer),this.renderer.resetRemoveColorOptions(),(t=this.map)==null||t.triggerRepaint()}setMapRemoveColor(t,r){var n;zr(this.renderer);const i=r.hexColor?fy(r.hexColor):void 0;this.renderer.setMapRemoveColorOptions(t,{color:i,threshold:r.threshold,hardness:r.hardness}),(n=this.map)==null||n.triggerRepaint()}resetMapRemoveColor(t){zr(this.renderer),this.renderer.resetMapRemoveColorOptions(t)}setColorize(t){var r;zr(this.renderer);const n=fy(t);n&&(this.renderer.setColorizeOptions({color:n}),(r=this.map)==null||r.triggerRepaint())}resetColorize(){var t;zr(this.renderer),this.renderer.resetColorizeOptions(),(t=this.map)==null||t.triggerRepaint()}setMapColorize(t,r){var n;zr(this.renderer);const i=fy(r);i&&(this.renderer.setMapColorizeOptions(t,{color:i}),(n=this.map)==null||n.triggerRepaint())}resetMapColorize(t){var r;zr(this.renderer),this.renderer.resetMapColorizeOptions(t),(r=this.map)==null||r.triggerRepaint()}clear(){var t;zr(this.renderer),this.renderer.clear(),(t=this.map)==null||t.triggerRepaint()}preparerender(){}render(){if(!this.map||!this.renderer)return;const t=this.map.getCanvas(),r=[t.width/window.devicePixelRatio,t.height/window.devicePixelRatio],n=this.map.getCenter(),i=Pd([n.lng,n.lat]),l=this.map.unproject([0,r[1]]),h=this.map.unproject([r[0],r[1]]),a=this.map.unproject([r[0],0]),g=this.map.unproject([0,0]),_=Pd([l.lng,l.lat]),E=Pd([h.lng,h.lat]),S=Pd([a.lng,a.lat]),A=Pd([g.lng,g.lat]),O=Vv([_,E,S,A]),k=t_(O,r),G=-(this.map.getBearing()/180)*Math.PI,W=new mN(r,i,k,G,window.devicePixelRatio);this.renderer.render(W)}addEventListeners(){this.renderer&&(this.renderer.addEventListener(Pe.CHANGED,this.render.bind(this)),this.renderer.addEventListener(Pe.IMAGEINFOLOADED,this.render.bind(this)),this.renderer.addEventListener(Pe.WARPEDMAPENTER,this.passWarpedMapEvent.bind(this)),this.renderer.addEventListener(Pe.WARPEDMAPLEAVE,this.passWarpedMapEvent.bind(this)),this.renderer.tileCache.addEventListener(Pe.FIRSTMAPTILELOADED,this.passWarpedMapEvent.bind(this)),this.renderer.tileCache.addEventListener(Pe.ALLREQUESTEDTILESLOADED,this.passWarpedMapEvent.bind(this)),this.renderer.warpedMapList.addEventListener(Pe.GEOREFERENCEANNOTATIONADDED,this.passWarpedMapEvent.bind(this)),this.renderer.warpedMapList.addEventListener(Pe.WARPEDMAPADDED,this.passWarpedMapEvent.bind(this)),this.renderer.warpedMapList.addEventListener(Pe.WARPEDMAPREMOVED,this.passWarpedMapEvent.bind(this)),this.renderer.warpedMapList.addEventListener(Pe.VISIBILITYCHANGED,this.render.bind(this)),this.renderer.warpedMapList.addEventListener(Pe.CLEARED,this.render.bind(this)))}removeEventListeners(){this.renderer&&(this.renderer.removeEventListener(Pe.CHANGED,this.render.bind(this)),this.renderer.removeEventListener(Pe.IMAGEINFOLOADED,this.render.bind(this)),this.renderer.removeEventListener(Pe.WARPEDMAPENTER,this.passWarpedMapEvent.bind(this)),this.renderer.removeEventListener(Pe.WARPEDMAPLEAVE,this.passWarpedMapEvent.bind(this)),this.renderer.tileCache.removeEventListener(Pe.FIRSTMAPTILELOADED,this.passWarpedMapEvent.bind(this)),this.renderer.tileCache.removeEventListener(Pe.ALLREQUESTEDTILESLOADED,this.passWarpedMapEvent.bind(this)),this.renderer.warpedMapList.removeEventListener(Pe.GEOREFERENCEANNOTATIONADDED,this.passWarpedMapEvent.bind(this)),this.renderer.warpedMapList.removeEventListener(Pe.WARPEDMAPADDED,this.passWarpedMapEvent.bind(this)),this.renderer.warpedMapList.removeEventListener(Pe.WARPEDMAPREMOVED,this.passWarpedMapEvent.bind(this)),this.renderer.warpedMapList.removeEventListener(Pe.VISIBILITYCHANGED,this.render.bind(this)),this.renderer.warpedMapList.removeEventListener(Pe.CLEARED,this.render.bind(this)))}passWarpedMapEvent(t){t instanceof Ur&&this.map&&this.map.fire(t.type,t.data)}}function OI(e,t,r){if(e!==null)for(var n,i,l,h,a,g,_,E=0,S=0,A,O=e.type,k=O==="FeatureCollection",G=O==="Feature",W=k?e.features.length:1,U=0;U<W;U++){_=k?e.features[U].geometry:G?e.geometry:e,A=_?_.type==="GeometryCollection":!1,a=A?_.geometries.length:1;for(var tt=0;tt<a;tt++){var $=0,V=0;if(h=A?_.geometries[tt]:_,h!==null){g=h.coordinates;var it=h.type;switch(E=r&&(it==="Polygon"||it==="MultiPolygon")?1:0,it){case null:break;case"Point":if(t(g,S,U,$,V)===!1)return!1;S++,$++;break;case"LineString":case"MultiPoint":for(n=0;n<g.length;n++){if(t(g[n],S,U,$,V)===!1)return!1;S++,it==="MultiPoint"&&$++}it==="LineString"&&$++;break;case"Polygon":case"MultiLineString":for(n=0;n<g.length;n++){for(i=0;i<g[n].length-E;i++){if(t(g[n][i],S,U,$,V)===!1)return!1;S++}it==="MultiLineString"&&$++,it==="Polygon"&&V++}it==="Polygon"&&$++;break;case"MultiPolygon":for(n=0;n<g.length;n++){for(V=0,i=0;i<g[n].length;i++){for(l=0;l<g[n][i].length-E;l++){if(t(g[n][i][l],S,U,$,V)===!1)return!1;S++}V++}$++}break;case"GeometryCollection":for(n=0;n<h.geometries.length;n++)if(OI(h.geometries[n],t,r)===!1)return!1;break;default:throw new Error("Unknown Geometry Type")}}}}}function JE(e,t){if(e.type==="Feature")t(e,0);else if(e.type==="FeatureCollection")for(var r=0;r<e.features.length&&t(e.features[r],r)!==!1;r++);}function FI(e,t){var r,n,i,l,h,a,g,_,E,S,A=0,O=e.type==="FeatureCollection",k=e.type==="Feature",G=O?e.features.length:1;for(r=0;r<G;r++){for(a=O?e.features[r].geometry:k?e.geometry:e,_=O?e.features[r].properties:k?e.properties:{},E=O?e.features[r].bbox:k?e.bbox:void 0,S=O?e.features[r].id:k?e.id:void 0,g=a?a.type==="GeometryCollection":!1,h=g?a.geometries.length:1,i=0;i<h;i++){if(l=g?a.geometries[i]:a,l===null){if(t(null,A,_,E,S)===!1)return!1;continue}switch(l.type){case"Point":case"LineString":case"MultiPoint":case"Polygon":case"MultiLineString":case"MultiPolygon":{if(t(l,A,_,E,S)===!1)return!1;break}case"GeometryCollection":{for(n=0;n<l.geometries.length;n++)if(t(l.geometries[n],A,_,E,S)===!1)return!1;break}default:throw new Error("Unknown Geometry Type")}}A++}}function Jm(e){var t=[1/0,1/0,-1/0,-1/0];return OI(e,function(r){t[0]>r[0]&&(t[0]=r[0]),t[1]>r[1]&&(t[1]=r[1]),t[2]<r[0]&&(t[2]=r[0]),t[3]<r[1]&&(t[3]=r[1])}),t}Jm.default=Jm;var qs=63710088e-1,zI={centimeters:qs*100,centimetres:qs*100,degrees:qs/111325,feet:qs*3.28084,inches:qs*39.37,kilometers:qs/1e3,kilometres:qs/1e3,meters:qs,metres:qs,miles:qs/1609.344,millimeters:qs*1e3,millimetres:qs*1e3,nauticalmiles:qs/1852,radians:1,yards:qs*1.0936};function h1(e,t,r){r===void 0&&(r={});var n={type:"Feature"};return(r.id===0||r.id)&&(n.id=r.id),r.bbox&&(n.bbox=r.bbox),n.properties=t||{},n.geometry=e,n}function z4(e,t,r){if(r===void 0&&(r={}),!e)throw new Error("coordinates is required");if(!Array.isArray(e))throw new Error("coordinates must be an Array");if(e.length<2)throw new Error("coordinates must be at least 2 numbers long");if(!QE(e[0])||!QE(e[1]))throw new Error("coordinates must contain numbers");var n={type:"Point",coordinates:e};return h1(n,t,r)}function B4(e,t,r){r===void 0&&(r={});for(var n=0,i=e;n<i.length;n++){var l=i[n];if(l.length<4)throw new Error("Each LinearRing of a Polygon must have 4 or more Positions.");for(var h=0;h<l[l.length-1].length;h++)if(l[l.length-1][h]!==l[0][h])throw new Error("First and last Position are not equivalent.")}var a={type:"Polygon",coordinates:e};return h1(a,t,r)}function ux(e,t){t===void 0&&(t={});var r={type:"FeatureCollection"};return t.id&&(r.id=t.id),t.bbox&&(r.bbox=t.bbox),r.features=e,r}function $4(e,t){t===void 0&&(t="kilometers");var r=zI[t];if(!r)throw new Error(t+" units is invalid");return e*r}function U4(e,t){t===void 0&&(t="kilometers");var r=zI[t];if(!r)throw new Error(t+" units is invalid");return e/r}function QE(e){return!isNaN(e)&&e!==null&&!Array.isArray(e)}function j4(e,t){t===void 0&&(t={});var r=Number(e[0]),n=Number(e[1]),i=Number(e[2]),l=Number(e[3]);if(e.length===6)throw new Error("@turf/bbox-polygon does not support BBox with 6 positions");var h=[r,n],a=[r,l],g=[i,l],_=[i,n];return B4([[h,_,g,a,h]],t.properties,{bbox:e,id:t.id})}function V4(e,t){t===void 0&&(t={});var r=Jm(e),n=(r[0]+r[2])/2,i=(r[1]+r[3])/2;return z4([n,i],t.properties,t)}"fill"in Array.prototype||Object.defineProperty(Array.prototype,"fill",{configurable:!0,value:function(e){if(this===void 0||this===null)throw new TypeError(this+" is not an object");var t=Object(this),r=Math.max(Math.min(t.length,9007199254740991),0)||0,n=1 in arguments&&parseInt(Number(arguments[1]),10)||0;n=n<0?Math.max(r+n,0):Math.min(n,r);var i=2 in arguments&&arguments[2]!==void 0?parseInt(Number(arguments[2]),10)||0:r;for(i=i<0?Math.max(r+arguments[2],0):Math.min(i,r);n<i;)t[n]=e,++n;return t},writable:!0});Number.isFinite=Number.isFinite||function(e){return typeof e=="number"&&isFinite(e)};Number.isInteger=Number.isInteger||function(e){return typeof e=="number"&&isFinite(e)&&Math.floor(e)===e};Number.parseFloat=Number.parseFloat||parseFloat;Number.isNaN=Number.isNaN||function(e){return e!==e};Math.trunc=Math.trunc||function(e){return e<0?Math.ceil(e):Math.floor(e)};var Dp=function(){};Dp.prototype.interfaces_=function(){return[]};Dp.prototype.getClass=function(){return Dp};Dp.prototype.equalsWithTolerance=function(e,t,r){return Math.abs(e-t)<=r};var $n=function(e){function t(r){e.call(this,r),this.name="IllegalArgumentException",this.message=r,this.stack=new e().stack}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t}(Error),lr=function(){},BI={MAX_VALUE:{configurable:!0}};lr.isNaN=function(e){return Number.isNaN(e)};lr.doubleToLongBits=function(e){return e};lr.longBitsToDouble=function(e){return e};lr.isInfinite=function(e){return!Number.isFinite(e)};BI.MAX_VALUE.get=function(){return Number.MAX_VALUE};Object.defineProperties(lr,BI);var Ia=function(){},W_=function(){},Zd=function(){};function Ca(){}var kt=function e(){if(this.x=null,this.y=null,this.z=null,arguments.length===0)this.x=0,this.y=0,this.z=e.NULL_ORDINATE;else if(arguments.length===1){var t=arguments[0];this.x=t.x,this.y=t.y,this.z=t.z}else arguments.length===2?(this.x=arguments[0],this.y=arguments[1],this.z=e.NULL_ORDINATE):arguments.length===3&&(this.x=arguments[0],this.y=arguments[1],this.z=arguments[2])},Kp={DimensionalComparator:{configurable:!0},serialVersionUID:{configurable:!0},NULL_ORDINATE:{configurable:!0},X:{configurable:!0},Y:{configurable:!0},Z:{configurable:!0}};kt.prototype.setOrdinate=function(e,t){switch(e){case kt.X:this.x=t;break;case kt.Y:this.y=t;break;case kt.Z:this.z=t;break;default:throw new $n("Invalid ordinate index: "+e)}};kt.prototype.equals2D=function(){if(arguments.length===1){var e=arguments[0];return!(this.x!==e.x||this.y!==e.y)}else if(arguments.length===2){var t=arguments[0],r=arguments[1];return!(!Dp.equalsWithTolerance(this.x,t.x,r)||!Dp.equalsWithTolerance(this.y,t.y,r))}};kt.prototype.getOrdinate=function(e){switch(e){case kt.X:return this.x;case kt.Y:return this.y;case kt.Z:return this.z}throw new $n("Invalid ordinate index: "+e)};kt.prototype.equals3D=function(e){return this.x===e.x&&this.y===e.y&&(this.z===e.z||lr.isNaN(this.z))&&lr.isNaN(e.z)};kt.prototype.equals=function(e){return e instanceof kt?this.equals2D(e):!1};kt.prototype.equalInZ=function(e,t){return Dp.equalsWithTolerance(this.z,e.z,t)};kt.prototype.compareTo=function(e){var t=e;return this.x<t.x?-1:this.x>t.x?1:this.y<t.y?-1:this.y>t.y?1:0};kt.prototype.clone=function(){};kt.prototype.copy=function(){return new kt(this)};kt.prototype.toString=function(){return"("+this.x+", "+this.y+", "+this.z+")"};kt.prototype.distance3D=function(e){var t=this.x-e.x,r=this.y-e.y,n=this.z-e.z;return Math.sqrt(t*t+r*r+n*n)};kt.prototype.distance=function(e){var t=this.x-e.x,r=this.y-e.y;return Math.sqrt(t*t+r*r)};kt.prototype.hashCode=function(){var e=17;return e=37*e+kt.hashCode(this.x),e=37*e+kt.hashCode(this.y),e};kt.prototype.setCoordinate=function(e){this.x=e.x,this.y=e.y,this.z=e.z};kt.prototype.interfaces_=function(){return[Ia,W_,Ca]};kt.prototype.getClass=function(){return kt};kt.hashCode=function(){if(arguments.length===1){var e=arguments[0],t=lr.doubleToLongBits(e);return Math.trunc((t^t)>>>32)}};Kp.DimensionalComparator.get=function(){return Nc};Kp.serialVersionUID.get=function(){return 6683108902428367e3};Kp.NULL_ORDINATE.get=function(){return lr.NaN};Kp.X.get=function(){return 0};Kp.Y.get=function(){return 1};Kp.Z.get=function(){return 2};Object.defineProperties(kt,Kp);var Nc=function(e){if(this._dimensionsToTest=2,arguments.length!==0&&arguments.length===1){var t=arguments[0];if(t!==2&&t!==3)throw new $n("only 2 or 3 dimensions may be specified");this._dimensionsToTest=t}};Nc.prototype.compare=function(e,t){var r=e,n=t,i=Nc.compare(r.x,n.x);if(i!==0)return i;var l=Nc.compare(r.y,n.y);if(l!==0)return l;if(this._dimensionsToTest<=2)return 0;var h=Nc.compare(r.z,n.z);return h};Nc.prototype.interfaces_=function(){return[Zd]};Nc.prototype.getClass=function(){return Nc};Nc.compare=function(e,t){return e<t?-1:e>t?1:lr.isNaN(e)?lr.isNaN(t)?0:-1:lr.isNaN(t)?1:0};var Wd=function(){};Wd.prototype.create=function(){};Wd.prototype.interfaces_=function(){return[]};Wd.prototype.getClass=function(){return Wd};var Bt=function(){},wg={INTERIOR:{configurable:!0},BOUNDARY:{configurable:!0},EXTERIOR:{configurable:!0},NONE:{configurable:!0}};Bt.prototype.interfaces_=function(){return[]};Bt.prototype.getClass=function(){return Bt};Bt.toLocationSymbol=function(e){switch(e){case Bt.EXTERIOR:return"e";case Bt.BOUNDARY:return"b";case Bt.INTERIOR:return"i";case Bt.NONE:return"-"}throw new $n("Unknown location value: "+e)};wg.INTERIOR.get=function(){return 0};wg.BOUNDARY.get=function(){return 1};wg.EXTERIOR.get=function(){return 2};wg.NONE.get=function(){return-1};Object.defineProperties(Bt,wg);var rr=function(e,t){return e.interfaces_&&e.interfaces_().indexOf(t)>-1},Js=function(){},$I={LOG_10:{configurable:!0}};Js.prototype.interfaces_=function(){return[]};Js.prototype.getClass=function(){return Js};Js.log10=function(e){var t=Math.log(e);return lr.isInfinite(t)||lr.isNaN(t)?t:t/Js.LOG_10};Js.min=function(e,t,r,n){var i=e;return t<i&&(i=t),r<i&&(i=r),n<i&&(i=n),i};Js.clamp=function(){if(typeof arguments[2]=="number"&&typeof arguments[0]=="number"&&typeof arguments[1]=="number"){var e=arguments[0],t=arguments[1],r=arguments[2];return e<t?t:e>r?r:e}else if(Number.isInteger(arguments[2])&&Number.isInteger(arguments[0])&&Number.isInteger(arguments[1])){var n=arguments[0],i=arguments[1],l=arguments[2];return n<i?i:n>l?l:n}};Js.wrap=function(e,t){return e<0?t- -e%t:e%t};Js.max=function(){if(arguments.length===3){var e=arguments[0],t=arguments[1],r=arguments[2],n=e;return t>n&&(n=t),r>n&&(n=r),n}else if(arguments.length===4){var i=arguments[0],l=arguments[1],h=arguments[2],a=arguments[3],g=i;return l>g&&(g=l),h>g&&(g=h),a>g&&(g=a),g}};Js.average=function(e,t){return(e+t)/2};$I.LOG_10.get=function(){return Math.log(10)};Object.defineProperties(Js,$I);var zl=function(e){this.str=e};zl.prototype.append=function(e){this.str+=e};zl.prototype.setCharAt=function(e,t){this.str=this.str.substr(0,e)+t+this.str.substr(e+1)};zl.prototype.toString=function(e){return this.str};var Ml=function(e){this.value=e};Ml.prototype.intValue=function(){return this.value};Ml.prototype.compareTo=function(e){return this.value<e?-1:this.value>e?1:0};Ml.isNaN=function(e){return Number.isNaN(e)};var Qm=function(){};Qm.isWhitespace=function(e){return e<=32&&e>=0||e===127};Qm.toUpperCase=function(e){return e.toUpperCase()};var Wt=function e(){if(this._hi=0,this._lo=0,arguments.length===0)this.init(0);else if(arguments.length===1){if(typeof arguments[0]=="number"){var t=arguments[0];this.init(t)}else if(arguments[0]instanceof e){var r=arguments[0];this.init(r)}else if(typeof arguments[0]=="string"){var n=arguments[0];e.call(this,e.parse(n))}}else if(arguments.length===2){var i=arguments[0],l=arguments[1];this.init(i,l)}},Ka={PI:{configurable:!0},TWO_PI:{configurable:!0},PI_2:{configurable:!0},E:{configurable:!0},NaN:{configurable:!0},EPS:{configurable:!0},SPLIT:{configurable:!0},MAX_PRINT_DIGITS:{configurable:!0},TEN:{configurable:!0},ONE:{configurable:!0},SCI_NOT_EXPONENT_CHAR:{configurable:!0},SCI_NOT_ZERO:{configurable:!0}};Wt.prototype.le=function(e){return(this._hi<e._hi||this._hi===e._hi)&&this._lo<=e._lo};Wt.prototype.extractSignificantDigits=function(e,t){var r=this.abs(),n=Wt.magnitude(r._hi),i=Wt.TEN.pow(n);r=r.divide(i),r.gt(Wt.TEN)?(r=r.divide(Wt.TEN),n+=1):r.lt(Wt.ONE)&&(r=r.multiply(Wt.TEN),n-=1);for(var l=n+1,h=new zl,a=Wt.MAX_PRINT_DIGITS-1,g=0;g<=a;g++){e&&g===l&&h.append(".");var _=Math.trunc(r._hi);if(_<0)break;var E=!1,S=0;_>9?(E=!0,S="9"):S="0"+_,h.append(S),r=r.subtract(Wt.valueOf(_)).multiply(Wt.TEN),E&&r.selfAdd(Wt.TEN);var A=!0,O=Wt.magnitude(r._hi);if(O<0&&Math.abs(O)>=a-g&&(A=!1),!A)break}return t[0]=n,h.toString()};Wt.prototype.sqr=function(){return this.multiply(this)};Wt.prototype.doubleValue=function(){return this._hi+this._lo};Wt.prototype.subtract=function(){if(arguments[0]instanceof Wt){var e=arguments[0];return this.add(e.negate())}else if(typeof arguments[0]=="number"){var t=arguments[0];return this.add(-t)}};Wt.prototype.equals=function(){if(arguments.length===1){var e=arguments[0];return this._hi===e._hi&&this._lo===e._lo}};Wt.prototype.isZero=function(){return this._hi===0&&this._lo===0};Wt.prototype.selfSubtract=function(){if(arguments[0]instanceof Wt){var e=arguments[0];return this.isNaN()?this:this.selfAdd(-e._hi,-e._lo)}else if(typeof arguments[0]=="number"){var t=arguments[0];return this.isNaN()?this:this.selfAdd(-t,0)}};Wt.prototype.getSpecialNumberString=function(){return this.isZero()?"0.0":this.isNaN()?"NaN ":null};Wt.prototype.min=function(e){return this.le(e)?this:e};Wt.prototype.selfDivide=function(){if(arguments.length===1){if(arguments[0]instanceof Wt){var e=arguments[0];return this.selfDivide(e._hi,e._lo)}else if(typeof arguments[0]=="number"){var t=arguments[0];return this.selfDivide(t,0)}}else if(arguments.length===2){var r=arguments[0],n=arguments[1],i=null,l=null,h=null,a=null,g=null,_=null,E=null,S=null;return g=this._hi/r,_=Wt.SPLIT*g,i=_-g,S=Wt.SPLIT*r,i=_-i,l=g-i,h=S-r,E=g*r,h=S-h,a=r-h,S=i*h-E+i*a+l*h+l*a,_=(this._hi-E-S+this._lo-g*n)/r,S=g+_,this._hi=S,this._lo=g-S+_,this}};Wt.prototype.dump=function(){return"DD<"+this._hi+", "+this._lo+">"};Wt.prototype.divide=function(){if(arguments[0]instanceof Wt){var e=arguments[0],t=null,r=null,n=null,i=null,l=null,h=null,a=null,g=null;l=this._hi/e._hi,h=Wt.SPLIT*l,t=h-l,g=Wt.SPLIT*e._hi,t=h-t,r=l-t,n=g-e._hi,a=l*e._hi,n=g-n,i=e._hi-n,g=t*n-a+t*i+r*n+r*i,h=(this._hi-a-g+this._lo-l*e._lo)/e._hi,g=l+h;var _=g,E=l-g+h;return new Wt(_,E)}else if(typeof arguments[0]=="number"){var S=arguments[0];return lr.isNaN(S)?Wt.createNaN():Wt.copy(this).selfDivide(S,0)}};Wt.prototype.ge=function(e){return(this._hi>e._hi||this._hi===e._hi)&&this._lo>=e._lo};Wt.prototype.pow=function(e){if(e===0)return Wt.valueOf(1);var t=new Wt(this),r=Wt.valueOf(1),n=Math.abs(e);if(n>1)for(;n>0;)n%2===1&&r.selfMultiply(t),n/=2,n>0&&(t=t.sqr());else r=t;return e<0?r.reciprocal():r};Wt.prototype.ceil=function(){if(this.isNaN())return Wt.NaN;var e=Math.ceil(this._hi),t=0;return e===this._hi&&(t=Math.ceil(this._lo)),new Wt(e,t)};Wt.prototype.compareTo=function(e){var t=e;return this._hi<t._hi?-1:this._hi>t._hi?1:this._lo<t._lo?-1:this._lo>t._lo?1:0};Wt.prototype.rint=function(){if(this.isNaN())return this;var e=this.add(.5);return e.floor()};Wt.prototype.setValue=function(){if(arguments[0]instanceof Wt){var e=arguments[0];return this.init(e),this}else if(typeof arguments[0]=="number"){var t=arguments[0];return this.init(t),this}};Wt.prototype.max=function(e){return this.ge(e)?this:e};Wt.prototype.sqrt=function(){if(this.isZero())return Wt.valueOf(0);if(this.isNegative())return Wt.NaN;var e=1/Math.sqrt(this._hi),t=this._hi*e,r=Wt.valueOf(t),n=this.subtract(r.sqr()),i=n._hi*(e*.5);return r.add(i)};Wt.prototype.selfAdd=function(){if(arguments.length===1){if(arguments[0]instanceof Wt){var e=arguments[0];return this.selfAdd(e._hi,e._lo)}else if(typeof arguments[0]=="number"){var t=arguments[0],r=null,n=null,i=null,l=null,h=null,a=null;return i=this._hi+t,h=i-this._hi,l=i-h,l=t-h+(this._hi-l),a=l+this._lo,r=i+a,n=a+(i-r),this._hi=r+n,this._lo=n+(r-this._hi),this}}else if(arguments.length===2){var g=arguments[0],_=arguments[1],E=null,S=null,A=null,O=null,k=null,G=null,W=null,U=null;k=this._hi+g,A=this._lo+_,W=k-this._hi,U=A-this._lo,G=k-W,O=A-U,G=g-W+(this._hi-G),O=_-U+(this._lo-O),W=G+A,E=k+W,S=W+(k-E),W=O+S;var tt=E+W,$=W+(E-tt);return this._hi=tt,this._lo=$,this}};Wt.prototype.selfMultiply=function(){if(arguments.length===1){if(arguments[0]instanceof Wt){var e=arguments[0];return this.selfMultiply(e._hi,e._lo)}else if(typeof arguments[0]=="number"){var t=arguments[0];return this.selfMultiply(t,0)}}else if(arguments.length===2){var r=arguments[0],n=arguments[1],i=null,l=null,h=null,a=null,g=null,_=null;g=Wt.SPLIT*this._hi,i=g-this._hi,_=Wt.SPLIT*r,i=g-i,l=this._hi-i,h=_-r,g=this._hi*r,h=_-h,a=r-h,_=i*h-g+i*a+l*h+l*a+(this._hi*n+this._lo*r);var E=g+_;i=g-E;var S=_+i;return this._hi=E,this._lo=S,this}};Wt.prototype.selfSqr=function(){return this.selfMultiply(this)};Wt.prototype.floor=function(){if(this.isNaN())return Wt.NaN;var e=Math.floor(this._hi),t=0;return e===this._hi&&(t=Math.floor(this._lo)),new Wt(e,t)};Wt.prototype.negate=function(){return this.isNaN()?this:new Wt(-this._hi,-this._lo)};Wt.prototype.clone=function(){};Wt.prototype.multiply=function(){if(arguments[0]instanceof Wt){var e=arguments[0];return e.isNaN()?Wt.createNaN():Wt.copy(this).selfMultiply(e)}else if(typeof arguments[0]=="number"){var t=arguments[0];return lr.isNaN(t)?Wt.createNaN():Wt.copy(this).selfMultiply(t,0)}};Wt.prototype.isNaN=function(){return lr.isNaN(this._hi)};Wt.prototype.intValue=function(){return Math.trunc(this._hi)};Wt.prototype.toString=function(){var e=Wt.magnitude(this._hi);return e>=-3&&e<=20?this.toStandardNotation():this.toSciNotation()};Wt.prototype.toStandardNotation=function(){var e=this.getSpecialNumberString();if(e!==null)return e;var t=new Array(1).fill(null),r=this.extractSignificantDigits(!0,t),n=t[0]+1,i=r;if(r.charAt(0)===".")i="0"+r;else if(n<0)i="0."+Wt.stringOfChar("0",-n)+r;else if(r.indexOf(".")===-1){var l=n-r.length,h=Wt.stringOfChar("0",l);i=r+h+".0"}return this.isNegative()?"-"+i:i};Wt.prototype.reciprocal=function(){var e=null,t=null,r=null,n=null,i=null,l=null,h=null,a=null;i=1/this._hi,l=Wt.SPLIT*i,e=l-i,a=Wt.SPLIT*this._hi,e=l-e,t=i-e,r=a-this._hi,h=i*this._hi,r=a-r,n=this._hi-r,a=e*r-h+e*n+t*r+t*n,l=(1-h-a-i*this._lo)/this._hi;var g=i+l,_=i-g+l;return new Wt(g,_)};Wt.prototype.toSciNotation=function(){if(this.isZero())return Wt.SCI_NOT_ZERO;var e=this.getSpecialNumberString();if(e!==null)return e;var t=new Array(1).fill(null),r=this.extractSignificantDigits(!1,t),n=Wt.SCI_NOT_EXPONENT_CHAR+t[0];if(r.charAt(0)==="0")throw new Error("Found leading zero: "+r);var i="";r.length>1&&(i=r.substring(1));var l=r.charAt(0)+"."+i;return this.isNegative()?"-"+l+n:l+n};Wt.prototype.abs=function(){return this.isNaN()?Wt.NaN:this.isNegative()?this.negate():new Wt(this)};Wt.prototype.isPositive=function(){return(this._hi>0||this._hi===0)&&this._lo>0};Wt.prototype.lt=function(e){return(this._hi<e._hi||this._hi===e._hi)&&this._lo<e._lo};Wt.prototype.add=function(){if(arguments[0]instanceof Wt){var e=arguments[0];return Wt.copy(this).selfAdd(e)}else if(typeof arguments[0]=="number"){var t=arguments[0];return Wt.copy(this).selfAdd(t)}};Wt.prototype.init=function(){if(arguments.length===1){if(typeof arguments[0]=="number"){var e=arguments[0];this._hi=e,this._lo=0}else if(arguments[0]instanceof Wt){var t=arguments[0];this._hi=t._hi,this._lo=t._lo}}else if(arguments.length===2){var r=arguments[0],n=arguments[1];this._hi=r,this._lo=n}};Wt.prototype.gt=function(e){return(this._hi>e._hi||this._hi===e._hi)&&this._lo>e._lo};Wt.prototype.isNegative=function(){return(this._hi<0||this._hi===0)&&this._lo<0};Wt.prototype.trunc=function(){return this.isNaN()?Wt.NaN:this.isPositive()?this.floor():this.ceil()};Wt.prototype.signum=function(){return this._hi>0?1:this._hi<0?-1:this._lo>0?1:this._lo<0?-1:0};Wt.prototype.interfaces_=function(){return[Ca,Ia,W_]};Wt.prototype.getClass=function(){return Wt};Wt.sqr=function(e){return Wt.valueOf(e).selfMultiply(e)};Wt.valueOf=function(){if(typeof arguments[0]=="string"){var e=arguments[0];return Wt.parse(e)}else if(typeof arguments[0]=="number"){var t=arguments[0];return new Wt(t)}};Wt.sqrt=function(e){return Wt.valueOf(e).sqrt()};Wt.parse=function(e){for(var t=0,r=e.length;Qm.isWhitespace(e.charAt(t));)t++;var n=!1;if(t<r){var i=e.charAt(t);(i==="-"||i==="+")&&(t++,i==="-"&&(n=!0))}for(var l=new Wt,h=0,a=0,g=0;!(t>=r);){var _=e.charAt(t);if(t++,Qm.isDigit(_)){var E=_-"0";l.selfMultiply(Wt.TEN),l.selfAdd(E),h++;continue}if(_==="."){a=h;continue}if(_==="e"||_==="E"){var S=e.substring(t);try{g=Ml.parseInt(S)}catch(W){throw W instanceof Error?new Error("Invalid exponent "+S+" in string "+e):W}finally{}break}throw new Error("Unexpected character '"+_+"' at position "+t+" in string "+e)}var A=l,O=h-a-g;if(O===0)A=l;else if(O>0){var k=Wt.TEN.pow(O);A=l.divide(k)}else if(O<0){var G=Wt.TEN.pow(-O);A=l.multiply(G)}return n?A.negate():A};Wt.createNaN=function(){return new Wt(lr.NaN,lr.NaN)};Wt.copy=function(e){return new Wt(e)};Wt.magnitude=function(e){var t=Math.abs(e),r=Math.log(t)/Math.log(10),n=Math.trunc(Math.floor(r)),i=Math.pow(10,n);return i*10<=t&&(n+=1),n};Wt.stringOfChar=function(e,t){for(var r=new zl,n=0;n<t;n++)r.append(e);return r.toString()};Ka.PI.get=function(){return new Wt(3.141592653589793,12246467991473532e-32)};Ka.TWO_PI.get=function(){return new Wt(6.283185307179586,24492935982947064e-32)};Ka.PI_2.get=function(){return new Wt(1.5707963267948966,6123233995736766e-32)};Ka.E.get=function(){return new Wt(2.718281828459045,14456468917292502e-32)};Ka.NaN.get=function(){return new Wt(lr.NaN,lr.NaN)};Ka.EPS.get=function(){return 123259516440783e-46};Ka.SPLIT.get=function(){return 134217729};Ka.MAX_PRINT_DIGITS.get=function(){return 32};Ka.TEN.get=function(){return Wt.valueOf(10)};Ka.ONE.get=function(){return Wt.valueOf(1)};Ka.SCI_NOT_EXPONENT_CHAR.get=function(){return"E"};Ka.SCI_NOT_ZERO.get=function(){return"0.0E0"};Object.defineProperties(Wt,Ka);var is=function(){},UI={DP_SAFE_EPSILON:{configurable:!0}};is.prototype.interfaces_=function(){return[]};is.prototype.getClass=function(){return is};is.orientationIndex=function(e,t,r){var n=is.orientationIndexFilter(e,t,r);if(n<=1)return n;var i=Wt.valueOf(t.x).selfAdd(-e.x),l=Wt.valueOf(t.y).selfAdd(-e.y),h=Wt.valueOf(r.x).selfAdd(-t.x),a=Wt.valueOf(r.y).selfAdd(-t.y);return i.selfMultiply(a).selfSubtract(l.selfMultiply(h)).signum()};is.signOfDet2x2=function(e,t,r,n){var i=e.multiply(n).selfSubtract(t.multiply(r));return i.signum()};is.intersection=function(e,t,r,n){var i=Wt.valueOf(n.y).selfSubtract(r.y).selfMultiply(Wt.valueOf(t.x).selfSubtract(e.x)),l=Wt.valueOf(n.x).selfSubtract(r.x).selfMultiply(Wt.valueOf(t.y).selfSubtract(e.y)),h=i.subtract(l),a=Wt.valueOf(n.x).selfSubtract(r.x).selfMultiply(Wt.valueOf(e.y).selfSubtract(r.y)),g=Wt.valueOf(n.y).selfSubtract(r.y).selfMultiply(Wt.valueOf(e.x).selfSubtract(r.x)),_=a.subtract(g),E=_.selfDivide(h).doubleValue(),S=Wt.valueOf(e.x).selfAdd(Wt.valueOf(t.x).selfSubtract(e.x).selfMultiply(E)).doubleValue(),A=Wt.valueOf(t.x).selfSubtract(e.x).selfMultiply(Wt.valueOf(e.y).selfSubtract(r.y)),O=Wt.valueOf(t.y).selfSubtract(e.y).selfMultiply(Wt.valueOf(e.x).selfSubtract(r.x)),k=A.subtract(O),G=k.selfDivide(h).doubleValue(),W=Wt.valueOf(r.y).selfAdd(Wt.valueOf(n.y).selfSubtract(r.y).selfMultiply(G)).doubleValue();return new kt(S,W)};is.orientationIndexFilter=function(e,t,r){var n=null,i=(e.x-r.x)*(t.y-r.y),l=(e.y-r.y)*(t.x-r.x),h=i-l;if(i>0){if(l<=0)return is.signum(h);n=i+l}else if(i<0){if(l>=0)return is.signum(h);n=-i-l}else return is.signum(h);var a=is.DP_SAFE_EPSILON*n;return h>=a||-h>=a?is.signum(h):2};is.signum=function(e){return e>0?1:e<0?-1:0};UI.DP_SAFE_EPSILON.get=function(){return 1e-15};Object.defineProperties(is,UI);var Br=function(){},Eg={X:{configurable:!0},Y:{configurable:!0},Z:{configurable:!0},M:{configurable:!0}};Eg.X.get=function(){return 0};Eg.Y.get=function(){return 1};Eg.Z.get=function(){return 2};Eg.M.get=function(){return 3};Br.prototype.setOrdinate=function(e,t,r){};Br.prototype.size=function(){};Br.prototype.getOrdinate=function(e,t){};Br.prototype.getCoordinate=function(){};Br.prototype.getCoordinateCopy=function(e){};Br.prototype.getDimension=function(){};Br.prototype.getX=function(e){};Br.prototype.clone=function(){};Br.prototype.expandEnvelope=function(e){};Br.prototype.copy=function(){};Br.prototype.getY=function(e){};Br.prototype.toCoordinateArray=function(){};Br.prototype.interfaces_=function(){return[W_]};Br.prototype.getClass=function(){return Br};Object.defineProperties(Br,Eg);var jI=function(){},_f=function(e){function t(){e.call(this,"Projective point not representable on the Cartesian plane.")}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.interfaces_=function(){return[]},t.prototype.getClass=function(){return t},t}(jI),so=function(){};so.arraycopy=function(e,t,r,n,i){for(var l=0,h=t;h<t+i;h++)r[n+l]=e[h],l++};so.getProperty=function(e){return{"line.separator":`
`}[e]};var $a=function e(){if(this.x=null,this.y=null,this.w=null,arguments.length===0)this.x=0,this.y=0,this.w=1;else if(arguments.length===1){var t=arguments[0];this.x=t.x,this.y=t.y,this.w=1}else if(arguments.length===2){if(typeof arguments[0]=="number"&&typeof arguments[1]=="number"){var r=arguments[0],n=arguments[1];this.x=r,this.y=n,this.w=1}else if(arguments[0]instanceof e&&arguments[1]instanceof e){var i=arguments[0],l=arguments[1];this.x=i.y*l.w-l.y*i.w,this.y=l.x*i.w-i.x*l.w,this.w=i.x*l.y-l.x*i.y}else if(arguments[0]instanceof kt&&arguments[1]instanceof kt){var h=arguments[0],a=arguments[1];this.x=h.y-a.y,this.y=a.x-h.x,this.w=h.x*a.y-a.x*h.y}}else if(arguments.length===3){var g=arguments[0],_=arguments[1],E=arguments[2];this.x=g,this.y=_,this.w=E}else if(arguments.length===4){var S=arguments[0],A=arguments[1],O=arguments[2],k=arguments[3],G=S.y-A.y,W=A.x-S.x,U=S.x*A.y-A.x*S.y,tt=O.y-k.y,$=k.x-O.x,V=O.x*k.y-k.x*O.y;this.x=W*V-$*U,this.y=tt*U-G*V,this.w=G*$-tt*W}};$a.prototype.getY=function(){var e=this.y/this.w;if(lr.isNaN(e)||lr.isInfinite(e))throw new _f;return e};$a.prototype.getX=function(){var e=this.x/this.w;if(lr.isNaN(e)||lr.isInfinite(e))throw new _f;return e};$a.prototype.getCoordinate=function(){var e=new kt;return e.x=this.getX(),e.y=this.getY(),e};$a.prototype.interfaces_=function(){return[]};$a.prototype.getClass=function(){return $a};$a.intersection=function(e,t,r,n){var i=e.y-t.y,l=t.x-e.x,h=e.x*t.y-t.x*e.y,a=r.y-n.y,g=n.x-r.x,_=r.x*n.y-n.x*r.y,E=l*_-g*h,S=a*h-i*_,A=i*g-a*l,O=E/A,k=S/A;if(lr.isNaN(O)||lr.isInfinite(O)||lr.isNaN(k)||lr.isInfinite(k))throw new _f;return new kt(O,k)};var Ve=function e(){if(this._minx=null,this._maxx=null,this._miny=null,this._maxy=null,arguments.length===0)this.init();else if(arguments.length===1){if(arguments[0]instanceof kt){var t=arguments[0];this.init(t.x,t.x,t.y,t.y)}else if(arguments[0]instanceof e){var r=arguments[0];this.init(r)}}else if(arguments.length===2){var n=arguments[0],i=arguments[1];this.init(n.x,i.x,n.y,i.y)}else if(arguments.length===4){var l=arguments[0],h=arguments[1],a=arguments[2],g=arguments[3];this.init(l,h,a,g)}},VI={serialVersionUID:{configurable:!0}};Ve.prototype.getArea=function(){return this.getWidth()*this.getHeight()};Ve.prototype.equals=function(e){if(!(e instanceof Ve))return!1;var t=e;return this.isNull()?t.isNull():this._maxx===t.getMaxX()&&this._maxy===t.getMaxY()&&this._minx===t.getMinX()&&this._miny===t.getMinY()};Ve.prototype.intersection=function(e){if(this.isNull()||e.isNull()||!this.intersects(e))return new Ve;var t=this._minx>e._minx?this._minx:e._minx,r=this._miny>e._miny?this._miny:e._miny,n=this._maxx<e._maxx?this._maxx:e._maxx,i=this._maxy<e._maxy?this._maxy:e._maxy;return new Ve(t,n,r,i)};Ve.prototype.isNull=function(){return this._maxx<this._minx};Ve.prototype.getMaxX=function(){return this._maxx};Ve.prototype.covers=function(){if(arguments.length===1){if(arguments[0]instanceof kt){var e=arguments[0];return this.covers(e.x,e.y)}else if(arguments[0]instanceof Ve){var t=arguments[0];return this.isNull()||t.isNull()?!1:t.getMinX()>=this._minx&&t.getMaxX()<=this._maxx&&t.getMinY()>=this._miny&&t.getMaxY()<=this._maxy}}else if(arguments.length===2){var r=arguments[0],n=arguments[1];return this.isNull()?!1:r>=this._minx&&r<=this._maxx&&n>=this._miny&&n<=this._maxy}};Ve.prototype.intersects=function(){if(arguments.length===1){if(arguments[0]instanceof Ve){var e=arguments[0];return this.isNull()||e.isNull()?!1:!(e._minx>this._maxx||e._maxx<this._minx||e._miny>this._maxy||e._maxy<this._miny)}else if(arguments[0]instanceof kt){var t=arguments[0];return this.intersects(t.x,t.y)}}else if(arguments.length===2){var r=arguments[0],n=arguments[1];return this.isNull()?!1:!(r>this._maxx||r<this._minx||n>this._maxy||n<this._miny)}};Ve.prototype.getMinY=function(){return this._miny};Ve.prototype.getMinX=function(){return this._minx};Ve.prototype.expandToInclude=function(){if(arguments.length===1){if(arguments[0]instanceof kt){var e=arguments[0];this.expandToInclude(e.x,e.y)}else if(arguments[0]instanceof Ve){var t=arguments[0];if(t.isNull())return null;this.isNull()?(this._minx=t.getMinX(),this._maxx=t.getMaxX(),this._miny=t.getMinY(),this._maxy=t.getMaxY()):(t._minx<this._minx&&(this._minx=t._minx),t._maxx>this._maxx&&(this._maxx=t._maxx),t._miny<this._miny&&(this._miny=t._miny),t._maxy>this._maxy&&(this._maxy=t._maxy))}}else if(arguments.length===2){var r=arguments[0],n=arguments[1];this.isNull()?(this._minx=r,this._maxx=r,this._miny=n,this._maxy=n):(r<this._minx&&(this._minx=r),r>this._maxx&&(this._maxx=r),n<this._miny&&(this._miny=n),n>this._maxy&&(this._maxy=n))}};Ve.prototype.minExtent=function(){if(this.isNull())return 0;var e=this.getWidth(),t=this.getHeight();return e<t?e:t};Ve.prototype.getWidth=function(){return this.isNull()?0:this._maxx-this._minx};Ve.prototype.compareTo=function(e){var t=e;return this.isNull()?t.isNull()?0:-1:t.isNull()?1:this._minx<t._minx?-1:this._minx>t._minx?1:this._miny<t._miny?-1:this._miny>t._miny?1:this._maxx<t._maxx?-1:this._maxx>t._maxx?1:this._maxy<t._maxy?-1:this._maxy>t._maxy?1:0};Ve.prototype.translate=function(e,t){if(this.isNull())return null;this.init(this.getMinX()+e,this.getMaxX()+e,this.getMinY()+t,this.getMaxY()+t)};Ve.prototype.toString=function(){return"Env["+this._minx+" : "+this._maxx+", "+this._miny+" : "+this._maxy+"]"};Ve.prototype.setToNull=function(){this._minx=0,this._maxx=-1,this._miny=0,this._maxy=-1};Ve.prototype.getHeight=function(){return this.isNull()?0:this._maxy-this._miny};Ve.prototype.maxExtent=function(){if(this.isNull())return 0;var e=this.getWidth(),t=this.getHeight();return e>t?e:t};Ve.prototype.expandBy=function(){if(arguments.length===1){var e=arguments[0];this.expandBy(e,e)}else if(arguments.length===2){var t=arguments[0],r=arguments[1];if(this.isNull())return null;this._minx-=t,this._maxx+=t,this._miny-=r,this._maxy+=r,(this._minx>this._maxx||this._miny>this._maxy)&&this.setToNull()}};Ve.prototype.contains=function(){if(arguments.length===1){if(arguments[0]instanceof Ve){var e=arguments[0];return this.covers(e)}else if(arguments[0]instanceof kt){var t=arguments[0];return this.covers(t)}}else if(arguments.length===2){var r=arguments[0],n=arguments[1];return this.covers(r,n)}};Ve.prototype.centre=function(){return this.isNull()?null:new kt((this.getMinX()+this.getMaxX())/2,(this.getMinY()+this.getMaxY())/2)};Ve.prototype.init=function(){if(arguments.length===0)this.setToNull();else if(arguments.length===1){if(arguments[0]instanceof kt){var e=arguments[0];this.init(e.x,e.x,e.y,e.y)}else if(arguments[0]instanceof Ve){var t=arguments[0];this._minx=t._minx,this._maxx=t._maxx,this._miny=t._miny,this._maxy=t._maxy}}else if(arguments.length===2){var r=arguments[0],n=arguments[1];this.init(r.x,n.x,r.y,n.y)}else if(arguments.length===4){var i=arguments[0],l=arguments[1],h=arguments[2],a=arguments[3];i<l?(this._minx=i,this._maxx=l):(this._minx=l,this._maxx=i),h<a?(this._miny=h,this._maxy=a):(this._miny=a,this._maxy=h)}};Ve.prototype.getMaxY=function(){return this._maxy};Ve.prototype.distance=function(e){if(this.intersects(e))return 0;var t=0;this._maxx<e._minx?t=e._minx-this._maxx:this._minx>e._maxx&&(t=this._minx-e._maxx);var r=0;return this._maxy<e._miny?r=e._miny-this._maxy:this._miny>e._maxy&&(r=this._miny-e._maxy),t===0?r:r===0?t:Math.sqrt(t*t+r*r)};Ve.prototype.hashCode=function(){var e=17;return e=37*e+kt.hashCode(this._minx),e=37*e+kt.hashCode(this._maxx),e=37*e+kt.hashCode(this._miny),e=37*e+kt.hashCode(this._maxy),e};Ve.prototype.interfaces_=function(){return[Ia,Ca]};Ve.prototype.getClass=function(){return Ve};Ve.intersects=function(){if(arguments.length===3){var e=arguments[0],t=arguments[1],r=arguments[2];return r.x>=(e.x<t.x?e.x:t.x)&&r.x<=(e.x>t.x?e.x:t.x)&&r.y>=(e.y<t.y?e.y:t.y)&&r.y<=(e.y>t.y?e.y:t.y)}else if(arguments.length===4){var n=arguments[0],i=arguments[1],l=arguments[2],h=arguments[3],a=Math.min(l.x,h.x),g=Math.max(l.x,h.x),_=Math.min(n.x,i.x),E=Math.max(n.x,i.x);return!(_>g||E<a||(a=Math.min(l.y,h.y),g=Math.max(l.y,h.y),_=Math.min(n.y,i.y),E=Math.max(n.y,i.y),_>g)||E<a)}};VI.serialVersionUID.get=function(){return 5873921885273102e3};Object.defineProperties(Ve,VI);var yl={typeStr:/^\s*(\w+)\s*\(\s*(.*)\s*\)\s*$/,emptyTypeStr:/^\s*(\w+)\s*EMPTY\s*$/,spaces:/\s+/,parenComma:/\)\s*,\s*\(/,doubleParenComma:/\)\s*\)\s*,\s*\(\s*\(/,trimParens:/^\s*\(?(.*?)\)?\s*$/},X_=function(e){this.geometryFactory=e||new Er};X_.prototype.read=function(e){var t,r,n;e=e.replace(/[\n\r]/g," ");var i=yl.typeStr.exec(e);if(e.search("EMPTY")!==-1&&(i=yl.emptyTypeStr.exec(e),i[2]=void 0),i&&(r=i[1].toLowerCase(),n=i[2],kd[r]&&(t=kd[r].apply(this,[n]))),t===void 0)throw new Error("Could not parse WKT "+e);return t};X_.prototype.write=function(e){return this.extractGeometry(e)};X_.prototype.extractGeometry=function(e){var t=e.getGeometryType().toLowerCase();if(!ku[t])return null;var r=t.toUpperCase(),n;return e.isEmpty()?n=r+" EMPTY":n=r+"("+ku[t].apply(this,[e])+")",n};var ku={coordinate:function(e){return e.x+" "+e.y},point:function(e){return ku.coordinate.call(this,e._coordinates._coordinates[0])},multipoint:function(e){for(var t=this,r=[],n=0,i=e._geometries.length;n<i;++n)r.push("("+ku.point.apply(t,[e._geometries[n]])+")");return r.join(",")},linestring:function(e){for(var t=this,r=[],n=0,i=e._points._coordinates.length;n<i;++n)r.push(ku.coordinate.apply(t,[e._points._coordinates[n]]));return r.join(",")},linearring:function(e){for(var t=this,r=[],n=0,i=e._points._coordinates.length;n<i;++n)r.push(ku.coordinate.apply(t,[e._points._coordinates[n]]));return r.join(",")},multilinestring:function(e){for(var t=this,r=[],n=0,i=e._geometries.length;n<i;++n)r.push("("+ku.linestring.apply(t,[e._geometries[n]])+")");return r.join(",")},polygon:function(e){var t=this,r=[];r.push("("+ku.linestring.apply(this,[e._shell])+")");for(var n=0,i=e._holes.length;n<i;++n)r.push("("+ku.linestring.apply(t,[e._holes[n]])+")");return r.join(",")},multipolygon:function(e){for(var t=this,r=[],n=0,i=e._geometries.length;n<i;++n)r.push("("+ku.polygon.apply(t,[e._geometries[n]])+")");return r.join(",")},geometrycollection:function(e){for(var t=this,r=[],n=0,i=e._geometries.length;n<i;++n)r.push(t.extractGeometry(e._geometries[n]));return r.join(",")}},kd={point:function(e){if(e===void 0)return this.geometryFactory.createPoint();var t=e.trim().split(yl.spaces);return this.geometryFactory.createPoint(new kt(Number.parseFloat(t[0]),Number.parseFloat(t[1])))},multipoint:function(e){var t=this;if(e===void 0)return this.geometryFactory.createMultiPoint();for(var r,n=e.trim().split(","),i=[],l=0,h=n.length;l<h;++l)r=n[l].replace(yl.trimParens,"$1"),i.push(kd.point.apply(t,[r]));return this.geometryFactory.createMultiPoint(i)},linestring:function(e){if(e===void 0)return this.geometryFactory.createLineString();for(var t=e.trim().split(","),r=[],n,i=0,l=t.length;i<l;++i)n=t[i].trim().split(yl.spaces),r.push(new kt(Number.parseFloat(n[0]),Number.parseFloat(n[1])));return this.geometryFactory.createLineString(r)},linearring:function(e){if(e===void 0)return this.geometryFactory.createLinearRing();for(var t=e.trim().split(","),r=[],n,i=0,l=t.length;i<l;++i)n=t[i].trim().split(yl.spaces),r.push(new kt(Number.parseFloat(n[0]),Number.parseFloat(n[1])));return this.geometryFactory.createLinearRing(r)},multilinestring:function(e){var t=this;if(e===void 0)return this.geometryFactory.createMultiLineString();for(var r,n=e.trim().split(yl.parenComma),i=[],l=0,h=n.length;l<h;++l)r=n[l].replace(yl.trimParens,"$1"),i.push(kd.linestring.apply(t,[r]));return this.geometryFactory.createMultiLineString(i)},polygon:function(e){var t=this;if(e===void 0)return this.geometryFactory.createPolygon();for(var r,n,i,l=e.trim().split(yl.parenComma),h,a=[],g=0,_=l.length;g<_;++g)r=l[g].replace(yl.trimParens,"$1"),n=kd.linestring.apply(t,[r]),i=t.geometryFactory.createLinearRing(n._points),g===0?h=i:a.push(i);return this.geometryFactory.createPolygon(h,a)},multipolygon:function(e){var t=this;if(e===void 0)return this.geometryFactory.createMultiPolygon();for(var r,n=e.trim().split(yl.doubleParenComma),i=[],l=0,h=n.length;l<h;++l)r=n[l].replace(yl.trimParens,"$1"),i.push(kd.polygon.apply(t,[r]));return this.geometryFactory.createMultiPolygon(i)},geometrycollection:function(e){var t=this;if(e===void 0)return this.geometryFactory.createGeometryCollection();e=e.replace(/,\s*([A-Za-z])/g,"|$1");for(var r=e.trim().split("|"),n=[],i=0,l=r.length;i<l;++i)n.push(t.read(r[i]));return this.geometryFactory.createGeometryCollection(n)}},Va=function(e){this.parser=new X_(e)};Va.prototype.write=function(e){return this.parser.write(e)};Va.toLineString=function(e,t){if(arguments.length!==2)throw new Error("Not implemented");return"LINESTRING ( "+e.x+" "+e.y+", "+t.x+" "+t.y+" )"};var Vu=function(e){function t(r){e.call(this,r),this.name="RuntimeException",this.message=r,this.stack=new e().stack}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t}(Error),v_=function(e){function t(){if(e.call(this),arguments.length===0)e.call(this);else if(arguments.length===1){var r=arguments[0];e.call(this,r)}}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.interfaces_=function(){return[]},t.prototype.getClass=function(){return t},t}(Vu),dr=function(){};dr.prototype.interfaces_=function(){return[]};dr.prototype.getClass=function(){return dr};dr.shouldNeverReachHere=function(){if(arguments.length===0)dr.shouldNeverReachHere(null);else if(arguments.length===1){var e=arguments[0];throw new v_("Should never reach here"+(e!==null?": "+e:""))}};dr.isTrue=function(){var e,t;if(arguments.length===1)e=arguments[0],dr.isTrue(e,null);else if(arguments.length===2&&(e=arguments[0],t=arguments[1],!e))throw t===null?new v_:new v_(t)};dr.equals=function(){var e,t,r;if(arguments.length===2)e=arguments[0],t=arguments[1],dr.equals(e,t,null);else if(arguments.length===3&&(e=arguments[0],t=arguments[1],r=arguments[2],!t.equals(e)))throw new v_("Expected "+e+" but encountered "+t+(r!==null?": "+r:""))};var Gn=function(){this._result=null,this._inputLines=Array(2).fill().map(function(){return Array(2)}),this._intPt=new Array(2).fill(null),this._intLineIndex=null,this._isProper=null,this._pa=null,this._pb=null,this._precisionModel=null,this._intPt[0]=new kt,this._intPt[1]=new kt,this._pa=this._intPt[0],this._pb=this._intPt[1],this._result=0},Jp={DONT_INTERSECT:{configurable:!0},DO_INTERSECT:{configurable:!0},COLLINEAR:{configurable:!0},NO_INTERSECTION:{configurable:!0},POINT_INTERSECTION:{configurable:!0},COLLINEAR_INTERSECTION:{configurable:!0}};Gn.prototype.getIndexAlongSegment=function(e,t){return this.computeIntLineIndex(),this._intLineIndex[e][t]};Gn.prototype.getTopologySummary=function(){var e=new zl;return this.isEndPoint()&&e.append(" endpoint"),this._isProper&&e.append(" proper"),this.isCollinear()&&e.append(" collinear"),e.toString()};Gn.prototype.computeIntersection=function(e,t,r,n){this._inputLines[0][0]=e,this._inputLines[0][1]=t,this._inputLines[1][0]=r,this._inputLines[1][1]=n,this._result=this.computeIntersect(e,t,r,n)};Gn.prototype.getIntersectionNum=function(){return this._result};Gn.prototype.computeIntLineIndex=function(){if(arguments.length===0)this._intLineIndex===null&&(this._intLineIndex=Array(2).fill().map(function(){return Array(2)}),this.computeIntLineIndex(0),this.computeIntLineIndex(1));else if(arguments.length===1){var e=arguments[0],t=this.getEdgeDistance(e,0),r=this.getEdgeDistance(e,1);t>r?(this._intLineIndex[e][0]=0,this._intLineIndex[e][1]=1):(this._intLineIndex[e][0]=1,this._intLineIndex[e][1]=0)}};Gn.prototype.isProper=function(){return this.hasIntersection()&&this._isProper};Gn.prototype.setPrecisionModel=function(e){this._precisionModel=e};Gn.prototype.isInteriorIntersection=function(){var e=this;if(arguments.length===0)return!!(this.isInteriorIntersection(0)||this.isInteriorIntersection(1));if(arguments.length===1){for(var t=arguments[0],r=0;r<this._result;r++)if(!(e._intPt[r].equals2D(e._inputLines[t][0])||e._intPt[r].equals2D(e._inputLines[t][1])))return!0;return!1}};Gn.prototype.getIntersection=function(e){return this._intPt[e]};Gn.prototype.isEndPoint=function(){return this.hasIntersection()&&!this._isProper};Gn.prototype.hasIntersection=function(){return this._result!==Gn.NO_INTERSECTION};Gn.prototype.getEdgeDistance=function(e,t){var r=Gn.computeEdgeDistance(this._intPt[t],this._inputLines[e][0],this._inputLines[e][1]);return r};Gn.prototype.isCollinear=function(){return this._result===Gn.COLLINEAR_INTERSECTION};Gn.prototype.toString=function(){return Va.toLineString(this._inputLines[0][0],this._inputLines[0][1])+" - "+Va.toLineString(this._inputLines[1][0],this._inputLines[1][1])+this.getTopologySummary()};Gn.prototype.getEndpoint=function(e,t){return this._inputLines[e][t]};Gn.prototype.isIntersection=function(e){for(var t=this,r=0;r<this._result;r++)if(t._intPt[r].equals2D(e))return!0;return!1};Gn.prototype.getIntersectionAlongSegment=function(e,t){return this.computeIntLineIndex(),this._intPt[this._intLineIndex[e][t]]};Gn.prototype.interfaces_=function(){return[]};Gn.prototype.getClass=function(){return Gn};Gn.computeEdgeDistance=function(e,t,r){var n=Math.abs(r.x-t.x),i=Math.abs(r.y-t.y),l=-1;if(e.equals(t))l=0;else if(e.equals(r))n>i?l=n:l=i;else{var h=Math.abs(e.x-t.x),a=Math.abs(e.y-t.y);n>i?l=h:l=a,l===0&&!e.equals(t)&&(l=Math.max(h,a))}return dr.isTrue(!(l===0&&!e.equals(t)),"Bad distance calculation"),l};Gn.nonRobustComputeEdgeDistance=function(e,t,r){var n=e.x-t.x,i=e.y-t.y,l=Math.sqrt(n*n+i*i);return dr.isTrue(!(l===0&&!e.equals(t)),"Invalid distance calculation"),l};Jp.DONT_INTERSECT.get=function(){return 0};Jp.DO_INTERSECT.get=function(){return 1};Jp.COLLINEAR.get=function(){return 2};Jp.NO_INTERSECTION.get=function(){return 0};Jp.POINT_INTERSECTION.get=function(){return 1};Jp.COLLINEAR_INTERSECTION.get=function(){return 2};Object.defineProperties(Gn,Jp);var lp=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.isInSegmentEnvelopes=function(r){var n=new Ve(this._inputLines[0][0],this._inputLines[0][1]),i=new Ve(this._inputLines[1][0],this._inputLines[1][1]);return n.contains(r)&&i.contains(r)},t.prototype.computeIntersection=function(){if(arguments.length===3){var r=arguments[0],n=arguments[1],i=arguments[2];if(this._isProper=!1,Ve.intersects(n,i,r)&&Ie.orientationIndex(n,i,r)===0&&Ie.orientationIndex(i,n,r)===0)return this._isProper=!0,(r.equals(n)||r.equals(i))&&(this._isProper=!1),this._result=e.POINT_INTERSECTION,null;this._result=e.NO_INTERSECTION}else return e.prototype.computeIntersection.apply(this,arguments)},t.prototype.normalizeToMinimum=function(r,n,i,l,h){h.x=this.smallestInAbsValue(r.x,n.x,i.x,l.x),h.y=this.smallestInAbsValue(r.y,n.y,i.y,l.y),r.x-=h.x,r.y-=h.y,n.x-=h.x,n.y-=h.y,i.x-=h.x,i.y-=h.y,l.x-=h.x,l.y-=h.y},t.prototype.safeHCoordinateIntersection=function(r,n,i,l){var h=null;try{h=$a.intersection(r,n,i,l)}catch(a){if(a instanceof _f)h=t.nearestEndpoint(r,n,i,l);else throw a}finally{}return h},t.prototype.intersection=function(r,n,i,l){var h=this.intersectionWithNormalization(r,n,i,l);return this.isInSegmentEnvelopes(h)||(h=new kt(t.nearestEndpoint(r,n,i,l))),this._precisionModel!==null&&this._precisionModel.makePrecise(h),h},t.prototype.smallestInAbsValue=function(r,n,i,l){var h=r,a=Math.abs(h);return Math.abs(n)<a&&(h=n,a=Math.abs(n)),Math.abs(i)<a&&(h=i,a=Math.abs(i)),Math.abs(l)<a&&(h=l),h},t.prototype.checkDD=function(r,n,i,l,h){var a=is.intersection(r,n,i,l),g=this.isInSegmentEnvelopes(a);so.out.println("DD in env = "+g+"  --------------------- "+a),h.distance(a)>1e-4&&so.out.println("Distance = "+h.distance(a))},t.prototype.intersectionWithNormalization=function(r,n,i,l){var h=new kt(r),a=new kt(n),g=new kt(i),_=new kt(l),E=new kt;this.normalizeToEnvCentre(h,a,g,_,E);var S=this.safeHCoordinateIntersection(h,a,g,_);return S.x+=E.x,S.y+=E.y,S},t.prototype.computeCollinearIntersection=function(r,n,i,l){var h=Ve.intersects(r,n,i),a=Ve.intersects(r,n,l),g=Ve.intersects(i,l,r),_=Ve.intersects(i,l,n);return h&&a?(this._intPt[0]=i,this._intPt[1]=l,e.COLLINEAR_INTERSECTION):g&&_?(this._intPt[0]=r,this._intPt[1]=n,e.COLLINEAR_INTERSECTION):h&&g?(this._intPt[0]=i,this._intPt[1]=r,i.equals(r)&&!a&&!_?e.POINT_INTERSECTION:e.COLLINEAR_INTERSECTION):h&&_?(this._intPt[0]=i,this._intPt[1]=n,i.equals(n)&&!a&&!g?e.POINT_INTERSECTION:e.COLLINEAR_INTERSECTION):a&&g?(this._intPt[0]=l,this._intPt[1]=r,l.equals(r)&&!h&&!_?e.POINT_INTERSECTION:e.COLLINEAR_INTERSECTION):a&&_?(this._intPt[0]=l,this._intPt[1]=n,l.equals(n)&&!h&&!g?e.POINT_INTERSECTION:e.COLLINEAR_INTERSECTION):e.NO_INTERSECTION},t.prototype.normalizeToEnvCentre=function(r,n,i,l,h){var a=r.x<n.x?r.x:n.x,g=r.y<n.y?r.y:n.y,_=r.x>n.x?r.x:n.x,E=r.y>n.y?r.y:n.y,S=i.x<l.x?i.x:l.x,A=i.y<l.y?i.y:l.y,O=i.x>l.x?i.x:l.x,k=i.y>l.y?i.y:l.y,G=a>S?a:S,W=_<O?_:O,U=g>A?g:A,tt=E<k?E:k,$=(G+W)/2,V=(U+tt)/2;h.x=$,h.y=V,r.x-=h.x,r.y-=h.y,n.x-=h.x,n.y-=h.y,i.x-=h.x,i.y-=h.y,l.x-=h.x,l.y-=h.y},t.prototype.computeIntersect=function(r,n,i,l){if(this._isProper=!1,!Ve.intersects(r,n,i,l))return e.NO_INTERSECTION;var h=Ie.orientationIndex(r,n,i),a=Ie.orientationIndex(r,n,l);if(h>0&&a>0||h<0&&a<0)return e.NO_INTERSECTION;var g=Ie.orientationIndex(i,l,r),_=Ie.orientationIndex(i,l,n);if(g>0&&_>0||g<0&&_<0)return e.NO_INTERSECTION;var E=h===0&&a===0&&g===0&&_===0;return E?this.computeCollinearIntersection(r,n,i,l):(h===0||a===0||g===0||_===0?(this._isProper=!1,r.equals2D(i)||r.equals2D(l)?this._intPt[0]=r:n.equals2D(i)||n.equals2D(l)?this._intPt[0]=n:h===0?this._intPt[0]=new kt(i):a===0?this._intPt[0]=new kt(l):g===0?this._intPt[0]=new kt(r):_===0&&(this._intPt[0]=new kt(n))):(this._isProper=!0,this._intPt[0]=this.intersection(r,n,i,l)),e.POINT_INTERSECTION)},t.prototype.interfaces_=function(){return[]},t.prototype.getClass=function(){return t},t.nearestEndpoint=function(r,n,i,l){var h=r,a=Ie.distancePointLine(r,i,l),g=Ie.distancePointLine(n,i,l);return g<a&&(a=g,h=n),g=Ie.distancePointLine(i,r,n),g<a&&(a=g,h=i),g=Ie.distancePointLine(l,r,n),g<a&&(a=g,h=l),h},t}(Gn),Np=function(){};Np.prototype.interfaces_=function(){return[]};Np.prototype.getClass=function(){return Np};Np.orientationIndex=function(e,t,r){var n=t.x-e.x,i=t.y-e.y,l=r.x-t.x,h=r.y-t.y;return Np.signOfDet2x2(n,i,l,h)};Np.signOfDet2x2=function(e,t,r,n){var i=null,l=null,h=null;if(i=1,e===0||n===0)return t===0||r===0?0:t>0?r>0?-i:i:r>0?i:-i;if(t===0||r===0)return n>0?e>0?i:-i:e>0?-i:i;if(t>0?n>0?t<=n||(i=-i,l=e,e=r,r=l,l=t,t=n,n=l):t<=-n?(i=-i,r=-r,n=-n):(l=e,e=-r,r=l,l=t,t=-n,n=l):n>0?-t<=n?(i=-i,e=-e,t=-t):(l=-e,e=r,r=l,l=-t,t=n,n=l):t>=n?(e=-e,t=-t,r=-r,n=-n):(i=-i,l=-e,e=-r,r=l,l=-t,t=-n,n=l),e>0)if(r>0){if(!(e<=r))return i}else return i;else{if(r>0)return-i;if(e>=r)i=-i,e=-e,r=-r;else return-i}for(;;){if(h=Math.floor(r/e),r=r-h*e,n=n-h*t,n<0)return-i;if(n>t)return i;if(e>r+r){if(t<n+n)return i}else{if(t>n+n)return-i;r=e-r,n=t-n,i=-i}if(n===0)return r===0?0:-i;if(r===0||(h=Math.floor(e/r),e=e-h*r,t=t-h*n,t<0))return i;if(t>n)return-i;if(r>e+e){if(n<t+t)return-i}else{if(n>t+t)return i;e=r-e,t=n-t,i=-i}if(t===0)return e===0?0:i;if(e===0)return-i}};var Tl=function(){this._p=null,this._crossingCount=0,this._isPointOnSegment=!1;var e=arguments[0];this._p=e};Tl.prototype.countSegment=function(e,t){if(e.x<this._p.x&&t.x<this._p.x)return null;if(this._p.x===t.x&&this._p.y===t.y)return this._isPointOnSegment=!0,null;if(e.y===this._p.y&&t.y===this._p.y){var r=e.x,n=t.x;return r>n&&(r=t.x,n=e.x),this._p.x>=r&&this._p.x<=n&&(this._isPointOnSegment=!0),null}if(e.y>this._p.y&&t.y<=this._p.y||t.y>this._p.y&&e.y<=this._p.y){var i=e.x-this._p.x,l=e.y-this._p.y,h=t.x-this._p.x,a=t.y-this._p.y,g=Np.signOfDet2x2(i,l,h,a);if(g===0)return this._isPointOnSegment=!0,null;a<l&&(g=-g),g>0&&this._crossingCount++}};Tl.prototype.isPointInPolygon=function(){return this.getLocation()!==Bt.EXTERIOR};Tl.prototype.getLocation=function(){return this._isPointOnSegment?Bt.BOUNDARY:this._crossingCount%2===1?Bt.INTERIOR:Bt.EXTERIOR};Tl.prototype.isOnSegment=function(){return this._isPointOnSegment};Tl.prototype.interfaces_=function(){return[]};Tl.prototype.getClass=function(){return Tl};Tl.locatePointInRing=function(){if(arguments[0]instanceof kt&&rr(arguments[1],Br)){for(var e=arguments[0],t=arguments[1],r=new Tl(e),n=new kt,i=new kt,l=1;l<t.size();l++)if(t.getCoordinate(l,n),t.getCoordinate(l-1,i),r.countSegment(n,i),r.isOnSegment())return r.getLocation();return r.getLocation()}else if(arguments[0]instanceof kt&&arguments[1]instanceof Array){for(var h=arguments[0],a=arguments[1],g=new Tl(h),_=1;_<a.length;_++){var E=a[_],S=a[_-1];if(g.countSegment(E,S),g.isOnSegment())return g.getLocation()}return g.getLocation()}};var Ie=function(){},Qp={CLOCKWISE:{configurable:!0},RIGHT:{configurable:!0},COUNTERCLOCKWISE:{configurable:!0},LEFT:{configurable:!0},COLLINEAR:{configurable:!0},STRAIGHT:{configurable:!0}};Ie.prototype.interfaces_=function(){return[]};Ie.prototype.getClass=function(){return Ie};Ie.orientationIndex=function(e,t,r){return is.orientationIndex(e,t,r)};Ie.signedArea=function(){if(arguments[0]instanceof Array){var e=arguments[0];if(e.length<3)return 0;for(var t=0,r=e[0].x,n=1;n<e.length-1;n++){var i=e[n].x-r,l=e[n+1].y,h=e[n-1].y;t+=i*(h-l)}return t/2}else if(rr(arguments[0],Br)){var a=arguments[0],g=a.size();if(g<3)return 0;var _=new kt,E=new kt,S=new kt;a.getCoordinate(0,E),a.getCoordinate(1,S);var A=E.x;S.x-=A;for(var O=0,k=1;k<g-1;k++)_.y=E.y,E.x=S.x,E.y=S.y,a.getCoordinate(k+1,S),S.x-=A,O+=E.x*(_.y-S.y);return O/2}};Ie.distanceLineLine=function(e,t,r,n){if(e.equals(t))return Ie.distancePointLine(e,r,n);if(r.equals(n))return Ie.distancePointLine(n,e,t);var i=!1;if(!Ve.intersects(e,t,r,n))i=!0;else{var l=(t.x-e.x)*(n.y-r.y)-(t.y-e.y)*(n.x-r.x);if(l===0)i=!0;else{var h=(e.y-r.y)*(n.x-r.x)-(e.x-r.x)*(n.y-r.y),a=(e.y-r.y)*(t.x-e.x)-(e.x-r.x)*(t.y-e.y),g=a/l,_=h/l;(_<0||_>1||g<0||g>1)&&(i=!0)}}return i?Js.min(Ie.distancePointLine(e,r,n),Ie.distancePointLine(t,r,n),Ie.distancePointLine(r,e,t),Ie.distancePointLine(n,e,t)):0};Ie.isPointInRing=function(e,t){return Ie.locatePointInRing(e,t)!==Bt.EXTERIOR};Ie.computeLength=function(e){var t=e.size();if(t<=1)return 0;var r=0,n=new kt;e.getCoordinate(0,n);for(var i=n.x,l=n.y,h=1;h<t;h++){e.getCoordinate(h,n);var a=n.x,g=n.y,_=a-i,E=g-l;r+=Math.sqrt(_*_+E*E),i=a,l=g}return r};Ie.isCCW=function(e){var t=e.length-1;if(t<3)throw new $n("Ring has fewer than 4 points, so orientation cannot be determined");for(var r=e[0],n=0,i=1;i<=t;i++){var l=e[i];l.y>r.y&&(r=l,n=i)}var h=n;do h=h-1,h<0&&(h=t);while(e[h].equals2D(r)&&h!==n);var a=n;do a=(a+1)%t;while(e[a].equals2D(r)&&a!==n);var g=e[h],_=e[a];if(g.equals2D(r)||_.equals2D(r)||g.equals2D(_))return!1;var E=Ie.computeOrientation(g,r,_),S=!1;return E===0?S=g.x>_.x:S=E>0,S};Ie.locatePointInRing=function(e,t){return Tl.locatePointInRing(e,t)};Ie.distancePointLinePerpendicular=function(e,t,r){var n=(r.x-t.x)*(r.x-t.x)+(r.y-t.y)*(r.y-t.y),i=((t.y-e.y)*(r.x-t.x)-(t.x-e.x)*(r.y-t.y))/n;return Math.abs(i)*Math.sqrt(n)};Ie.computeOrientation=function(e,t,r){return Ie.orientationIndex(e,t,r)};Ie.distancePointLine=function(){if(arguments.length===2){var e=arguments[0],t=arguments[1];if(t.length===0)throw new $n("Line array must contain at least one vertex");for(var r=e.distance(t[0]),n=0;n<t.length-1;n++){var i=Ie.distancePointLine(e,t[n],t[n+1]);i<r&&(r=i)}return r}else if(arguments.length===3){var l=arguments[0],h=arguments[1],a=arguments[2];if(h.x===a.x&&h.y===a.y)return l.distance(h);var g=(a.x-h.x)*(a.x-h.x)+(a.y-h.y)*(a.y-h.y),_=((l.x-h.x)*(a.x-h.x)+(l.y-h.y)*(a.y-h.y))/g;if(_<=0)return l.distance(h);if(_>=1)return l.distance(a);var E=((h.y-l.y)*(a.x-h.x)-(h.x-l.x)*(a.y-h.y))/g;return Math.abs(E)*Math.sqrt(g)}};Ie.isOnLine=function(e,t){for(var r=new lp,n=1;n<t.length;n++){var i=t[n-1],l=t[n];if(r.computeIntersection(e,i,l),r.hasIntersection())return!0}return!1};Qp.CLOCKWISE.get=function(){return-1};Qp.RIGHT.get=function(){return Ie.CLOCKWISE};Qp.COUNTERCLOCKWISE.get=function(){return 1};Qp.LEFT.get=function(){return Ie.COUNTERCLOCKWISE};Qp.COLLINEAR.get=function(){return 0};Qp.STRAIGHT.get=function(){return Ie.COLLINEAR};Object.defineProperties(Ie,Qp);var Gu=function(){};Gu.prototype.filter=function(e){};Gu.prototype.interfaces_=function(){return[]};Gu.prototype.getClass=function(){return Gu};var tr=function(){var e=arguments[0];this._envelope=null,this._factory=null,this._SRID=null,this._userData=null,this._factory=e,this._SRID=e.getSRID()},_u={serialVersionUID:{configurable:!0},SORTINDEX_POINT:{configurable:!0},SORTINDEX_MULTIPOINT:{configurable:!0},SORTINDEX_LINESTRING:{configurable:!0},SORTINDEX_LINEARRING:{configurable:!0},SORTINDEX_MULTILINESTRING:{configurable:!0},SORTINDEX_POLYGON:{configurable:!0},SORTINDEX_MULTIPOLYGON:{configurable:!0},SORTINDEX_GEOMETRYCOLLECTION:{configurable:!0},geometryChangedFilter:{configurable:!0}};tr.prototype.isGeometryCollection=function(){return this.getSortIndex()===tr.SORTINDEX_GEOMETRYCOLLECTION};tr.prototype.getFactory=function(){return this._factory};tr.prototype.getGeometryN=function(e){return this};tr.prototype.getArea=function(){return 0};tr.prototype.isRectangle=function(){return!1};tr.prototype.equals=function(){if(arguments[0]instanceof tr){var e=arguments[0];return e===null?!1:this.equalsTopo(e)}else if(arguments[0]instanceof Object){var t=arguments[0];if(!(t instanceof tr))return!1;var r=t;return this.equalsExact(r)}};tr.prototype.equalsExact=function(e){return this===e||this.equalsExact(e,0)};tr.prototype.geometryChanged=function(){this.apply(tr.geometryChangedFilter)};tr.prototype.geometryChangedAction=function(){this._envelope=null};tr.prototype.equalsNorm=function(e){return e===null?!1:this.norm().equalsExact(e.norm())};tr.prototype.getLength=function(){return 0};tr.prototype.getNumGeometries=function(){return 1};tr.prototype.compareTo=function(){if(arguments.length===1){var e=arguments[0],t=e;return this.getSortIndex()!==t.getSortIndex()?this.getSortIndex()-t.getSortIndex():this.isEmpty()&&t.isEmpty()?0:this.isEmpty()?-1:t.isEmpty()?1:this.compareToSameClass(e)}else if(arguments.length===2){var r=arguments[0],n=arguments[1];return this.getSortIndex()!==r.getSortIndex()?this.getSortIndex()-r.getSortIndex():this.isEmpty()&&r.isEmpty()?0:this.isEmpty()?-1:r.isEmpty()?1:this.compareToSameClass(r,n)}};tr.prototype.getUserData=function(){return this._userData};tr.prototype.getSRID=function(){return this._SRID};tr.prototype.getEnvelope=function(){return this.getFactory().toGeometry(this.getEnvelopeInternal())};tr.prototype.checkNotGeometryCollection=function(e){if(e.getSortIndex()===tr.SORTINDEX_GEOMETRYCOLLECTION)throw new $n("This method does not support GeometryCollection arguments")};tr.prototype.equal=function(e,t,r){return r===0?e.equals(t):e.distance(t)<=r};tr.prototype.norm=function(){var e=this.copy();return e.normalize(),e};tr.prototype.getPrecisionModel=function(){return this._factory.getPrecisionModel()};tr.prototype.getEnvelopeInternal=function(){return this._envelope===null&&(this._envelope=this.computeEnvelopeInternal()),new Ve(this._envelope)};tr.prototype.setSRID=function(e){this._SRID=e};tr.prototype.setUserData=function(e){this._userData=e};tr.prototype.compare=function(e,t){for(var r=e.iterator(),n=t.iterator();r.hasNext()&&n.hasNext();){var i=r.next(),l=n.next(),h=i.compareTo(l);if(h!==0)return h}return r.hasNext()?1:n.hasNext()?-1:0};tr.prototype.hashCode=function(){return this.getEnvelopeInternal().hashCode()};tr.prototype.isGeometryCollectionOrDerived=function(){return this.getSortIndex()===tr.SORTINDEX_GEOMETRYCOLLECTION||this.getSortIndex()===tr.SORTINDEX_MULTIPOINT||this.getSortIndex()===tr.SORTINDEX_MULTILINESTRING||this.getSortIndex()===tr.SORTINDEX_MULTIPOLYGON};tr.prototype.interfaces_=function(){return[W_,Ia,Ca]};tr.prototype.getClass=function(){return tr};tr.hasNonEmptyElements=function(e){for(var t=0;t<e.length;t++)if(!e[t].isEmpty())return!0;return!1};tr.hasNullElements=function(e){for(var t=0;t<e.length;t++)if(e[t]===null)return!0;return!1};_u.serialVersionUID.get=function(){return 8763622679187377e3};_u.SORTINDEX_POINT.get=function(){return 0};_u.SORTINDEX_MULTIPOINT.get=function(){return 1};_u.SORTINDEX_LINESTRING.get=function(){return 2};_u.SORTINDEX_LINEARRING.get=function(){return 3};_u.SORTINDEX_MULTILINESTRING.get=function(){return 4};_u.SORTINDEX_POLYGON.get=function(){return 5};_u.SORTINDEX_MULTIPOLYGON.get=function(){return 6};_u.SORTINDEX_GEOMETRYCOLLECTION.get=function(){return 7};_u.geometryChangedFilter.get=function(){return p1};Object.defineProperties(tr,_u);var p1=function(){};p1.interfaces_=function(){return[Gu]};p1.filter=function(e){e.geometryChangedAction()};var uu=function(){};uu.prototype.filter=function(e){};uu.prototype.interfaces_=function(){return[]};uu.prototype.getClass=function(){return uu};var wa=function(){},Yu={Mod2BoundaryNodeRule:{configurable:!0},EndPointBoundaryNodeRule:{configurable:!0},MultiValentEndPointBoundaryNodeRule:{configurable:!0},MonoValentEndPointBoundaryNodeRule:{configurable:!0},MOD2_BOUNDARY_RULE:{configurable:!0},ENDPOINT_BOUNDARY_RULE:{configurable:!0},MULTIVALENT_ENDPOINT_BOUNDARY_RULE:{configurable:!0},MONOVALENT_ENDPOINT_BOUNDARY_RULE:{configurable:!0},OGC_SFS_BOUNDARY_RULE:{configurable:!0}};wa.prototype.isInBoundary=function(e){};wa.prototype.interfaces_=function(){return[]};wa.prototype.getClass=function(){return wa};Yu.Mod2BoundaryNodeRule.get=function(){return Xd};Yu.EndPointBoundaryNodeRule.get=function(){return Hd};Yu.MultiValentEndPointBoundaryNodeRule.get=function(){return Yd};Yu.MonoValentEndPointBoundaryNodeRule.get=function(){return Kd};Yu.MOD2_BOUNDARY_RULE.get=function(){return new Xd};Yu.ENDPOINT_BOUNDARY_RULE.get=function(){return new Hd};Yu.MULTIVALENT_ENDPOINT_BOUNDARY_RULE.get=function(){return new Yd};Yu.MONOVALENT_ENDPOINT_BOUNDARY_RULE.get=function(){return new Kd};Yu.OGC_SFS_BOUNDARY_RULE.get=function(){return wa.MOD2_BOUNDARY_RULE};Object.defineProperties(wa,Yu);var Xd=function(){};Xd.prototype.isInBoundary=function(e){return e%2===1};Xd.prototype.interfaces_=function(){return[wa]};Xd.prototype.getClass=function(){return Xd};var Hd=function(){};Hd.prototype.isInBoundary=function(e){return e>0};Hd.prototype.interfaces_=function(){return[wa]};Hd.prototype.getClass=function(){return Hd};var Yd=function(){};Yd.prototype.isInBoundary=function(e){return e>1};Yd.prototype.interfaces_=function(){return[wa]};Yd.prototype.getClass=function(){return Yd};var Kd=function(){};Kd.prototype.isInBoundary=function(e){return e===1};Kd.prototype.interfaces_=function(){return[wa]};Kd.prototype.getClass=function(){return Kd};var Ii=function(){};Ii.prototype.add=function(){};Ii.prototype.addAll=function(){};Ii.prototype.isEmpty=function(){};Ii.prototype.iterator=function(){};Ii.prototype.size=function(){};Ii.prototype.toArray=function(){};Ii.prototype.remove=function(){};function d1(e){this.message=e||""}d1.prototype=new Error;d1.prototype.name="IndexOutOfBoundsException";var vf=function(){};vf.prototype.hasNext=function(){};vf.prototype.next=function(){};vf.prototype.remove=function(){};var Ua=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.get=function(){},t.prototype.set=function(){},t.prototype.isEmpty=function(){},t}(Ii);function xf(e){this.message=e||""}xf.prototype=new Error;xf.prototype.name="NoSuchElementException";var me=function(e){function t(){e.call(this),this.array_=[],arguments[0]instanceof Ii&&this.addAll(arguments[0])}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.ensureCapacity=function(){},t.prototype.interfaces_=function(){return[e,Ii]},t.prototype.add=function(r){return arguments.length===1?this.array_.push(r):this.array_.splice(arguments[0],arguments[1]),!0},t.prototype.clear=function(){this.array_=[]},t.prototype.addAll=function(r){for(var n=this,i=r.iterator();i.hasNext();)n.add(i.next());return!0},t.prototype.set=function(r,n){var i=this.array_[r];return this.array_[r]=n,i},t.prototype.iterator=function(){return new G4(this)},t.prototype.get=function(r){if(r<0||r>=this.size())throw new d1;return this.array_[r]},t.prototype.isEmpty=function(){return this.array_.length===0},t.prototype.size=function(){return this.array_.length},t.prototype.toArray=function(){for(var r=this,n=[],i=0,l=this.array_.length;i<l;i++)n.push(r.array_[i]);return n},t.prototype.remove=function(r){for(var n=this,i=!1,l=0,h=this.array_.length;l<h;l++)if(n.array_[l]===r){n.array_.splice(l,1),i=!0;break}return i},t}(Ua),G4=function(e){function t(r){e.call(this),this.arrayList_=r,this.position_=0}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.next=function(){if(this.position_===this.arrayList_.size())throw new xf;return this.arrayList_.get(this.position_++)},t.prototype.hasNext=function(){return this.position_<this.arrayList_.size()},t.prototype.set=function(r){return this.arrayList_.set(this.position_-1,r)},t.prototype.remove=function(){this.arrayList_.remove(this.arrayList_.get(this.position_))},t}(vf),Sg=function(e){function t(){if(e.call(this),arguments.length!==0){if(arguments.length===1){var n=arguments[0];this.ensureCapacity(n.length),this.add(n,!0)}else if(arguments.length===2){var i=arguments[0],l=arguments[1];this.ensureCapacity(i.length),this.add(i,l)}}}e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t;var r={coordArrayType:{configurable:!0}};return r.coordArrayType.get=function(){return new Array(0).fill(null)},t.prototype.getCoordinate=function(n){return this.get(n)},t.prototype.addAll=function(){var n=this;if(arguments.length===2){for(var i=arguments[0],l=arguments[1],h=!1,a=i.iterator();a.hasNext();)n.add(a.next(),l),h=!0;return h}else return e.prototype.addAll.apply(this,arguments)},t.prototype.clone=function(){for(var n=this,i=e.prototype.clone.call(this),l=0;l<this.size();l++)i.add(l,n.get(l).copy());return i},t.prototype.toCoordinateArray=function(){return this.toArray(t.coordArrayType)},t.prototype.add=function(){var n=this;if(arguments.length===1){var i=arguments[0];e.prototype.add.call(this,i)}else if(arguments.length===2){if(arguments[0]instanceof Array&&typeof arguments[1]=="boolean"){var l=arguments[0],h=arguments[1];return this.add(l,h,!0),!0}else if(arguments[0]instanceof kt&&typeof arguments[1]=="boolean"){var a=arguments[0],g=arguments[1];if(!g&&this.size()>=1){var _=this.get(this.size()-1);if(_.equals2D(a))return null}e.prototype.add.call(this,a)}else if(arguments[0]instanceof Object&&typeof arguments[1]=="boolean"){var E=arguments[0],S=arguments[1];return this.add(E,S),!0}}else if(arguments.length===3){if(typeof arguments[2]=="boolean"&&arguments[0]instanceof Array&&typeof arguments[1]=="boolean"){var A=arguments[0],O=arguments[1],k=arguments[2];if(k)for(var G=0;G<A.length;G++)n.add(A[G],O);else for(var W=A.length-1;W>=0;W--)n.add(A[W],O);return!0}else if(typeof arguments[2]=="boolean"&&Number.isInteger(arguments[0])&&arguments[1]instanceof kt){var U=arguments[0],tt=arguments[1],$=arguments[2];if(!$){var V=this.size();if(V>0){if(U>0){var it=this.get(U-1);if(it.equals2D(tt))return null}if(U<V){var vt=this.get(U);if(vt.equals2D(tt))return null}}}e.prototype.add.call(this,U,tt)}}else if(arguments.length===4){var ot=arguments[0],et=arguments[1],wt=arguments[2],J=arguments[3],xt=1;wt>J&&(xt=-1);for(var $t=wt;$t!==J;$t+=xt)n.add(ot[$t],et);return!0}},t.prototype.closeRing=function(){this.size()>0&&this.add(new kt(this.get(0)),!1)},t.prototype.interfaces_=function(){return[]},t.prototype.getClass=function(){return t},Object.defineProperties(t,r),t}(me),Sr=function(){},H_={ForwardComparator:{configurable:!0},BidirectionalComparator:{configurable:!0},coordArrayType:{configurable:!0}};H_.ForwardComparator.get=function(){return tg};H_.BidirectionalComparator.get=function(){return Jd};H_.coordArrayType.get=function(){return new Array(0).fill(null)};Sr.prototype.interfaces_=function(){return[]};Sr.prototype.getClass=function(){return Sr};Sr.isRing=function(e){return!(e.length<4||!e[0].equals2D(e[e.length-1]))};Sr.ptNotInList=function(e,t){for(var r=0;r<e.length;r++){var n=e[r];if(Sr.indexOf(n,t)<0)return n}return null};Sr.scroll=function(e,t){var r=Sr.indexOf(t,e);if(r<0)return null;var n=new Array(e.length).fill(null);so.arraycopy(e,r,n,0,e.length-r),so.arraycopy(e,0,n,e.length-r,r),so.arraycopy(n,0,e,0,e.length)};Sr.equals=function(){if(arguments.length===2){var e=arguments[0],t=arguments[1];if(e===t)return!0;if(e===null||t===null||e.length!==t.length)return!1;for(var r=0;r<e.length;r++)if(!e[r].equals(t[r]))return!1;return!0}else if(arguments.length===3){var n=arguments[0],i=arguments[1],l=arguments[2];if(n===i)return!0;if(n===null||i===null||n.length!==i.length)return!1;for(var h=0;h<n.length;h++)if(l.compare(n[h],i[h])!==0)return!1;return!0}};Sr.intersection=function(e,t){for(var r=new Sg,n=0;n<e.length;n++)t.intersects(e[n])&&r.add(e[n],!0);return r.toCoordinateArray()};Sr.hasRepeatedPoints=function(e){for(var t=1;t<e.length;t++)if(e[t-1].equals(e[t]))return!0;return!1};Sr.removeRepeatedPoints=function(e){if(!Sr.hasRepeatedPoints(e))return e;var t=new Sg(e,!1);return t.toCoordinateArray()};Sr.reverse=function(e){for(var t=e.length-1,r=Math.trunc(t/2),n=0;n<=r;n++){var i=e[n];e[n]=e[t-n],e[t-n]=i}};Sr.removeNull=function(e){for(var t=0,r=0;r<e.length;r++)e[r]!==null&&t++;var n=new Array(t).fill(null);if(t===0)return n;for(var i=0,l=0;l<e.length;l++)e[l]!==null&&(n[i++]=e[l]);return n};Sr.copyDeep=function(){if(arguments.length===1){for(var e=arguments[0],t=new Array(e.length).fill(null),r=0;r<e.length;r++)t[r]=new kt(e[r]);return t}else if(arguments.length===5)for(var n=arguments[0],i=arguments[1],l=arguments[2],h=arguments[3],a=arguments[4],g=0;g<a;g++)l[h+g]=new kt(n[i+g])};Sr.isEqualReversed=function(e,t){for(var r=0;r<e.length;r++){var n=e[r],i=t[e.length-r-1];if(n.compareTo(i)!==0)return!1}return!0};Sr.envelope=function(e){for(var t=new Ve,r=0;r<e.length;r++)t.expandToInclude(e[r]);return t};Sr.toCoordinateArray=function(e){return e.toArray(Sr.coordArrayType)};Sr.atLeastNCoordinatesOrNothing=function(e,t){return t.length>=e?t:[]};Sr.indexOf=function(e,t){for(var r=0;r<t.length;r++)if(e.equals(t[r]))return r;return-1};Sr.increasingDirection=function(e){for(var t=0;t<Math.trunc(e.length/2);t++){var r=e.length-1-t,n=e[t].compareTo(e[r]);if(n!==0)return n}return 1};Sr.compare=function(e,t){for(var r=0;r<e.length&&r<t.length;){var n=e[r].compareTo(t[r]);if(n!==0)return n;r++}return r<t.length?-1:r<e.length?1:0};Sr.minCoordinate=function(e){for(var t=null,r=0;r<e.length;r++)(t===null||t.compareTo(e[r])>0)&&(t=e[r]);return t};Sr.extract=function(e,t,r){t=Js.clamp(t,0,e.length),r=Js.clamp(r,-1,e.length);var n=r-t+1;r<0&&(n=0),t>=e.length&&(n=0),r<t&&(n=0);var i=new Array(n).fill(null);if(n===0)return i;for(var l=0,h=t;h<=r;h++)i[l++]=e[h];return i};Object.defineProperties(Sr,H_);var tg=function(){};tg.prototype.compare=function(e,t){var r=e,n=t;return Sr.compare(r,n)};tg.prototype.interfaces_=function(){return[Zd]};tg.prototype.getClass=function(){return tg};var Jd=function(){};Jd.prototype.compare=function(e,t){var r=e,n=t;if(r.length<n.length)return-1;if(r.length>n.length)return 1;if(r.length===0)return 0;var i=Sr.compare(r,n),l=Sr.isEqualReversed(r,n);return l?0:i};Jd.prototype.OLDcompare=function(e,t){var r=e,n=t;if(r.length<n.length)return-1;if(r.length>n.length)return 1;if(r.length===0)return 0;for(var i=Sr.increasingDirection(r),l=Sr.increasingDirection(n),h=i>0?0:r.length-1,a=l>0?0:r.length-1,g=0;g<r.length;g++){var _=r[h].compareTo(n[a]);if(_!==0)return _;h+=i,a+=l}return 0};Jd.prototype.interfaces_=function(){return[Zd]};Jd.prototype.getClass=function(){return Jd};var td=function(){};td.prototype.get=function(){};td.prototype.put=function(){};td.prototype.size=function(){};td.prototype.values=function(){};td.prototype.entrySet=function(){};var q4=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t}(td);function Tg(e){this.message=e||""}Tg.prototype=new Error;Tg.prototype.name="OperationNotSupported";function Y_(){}Y_.prototype=new Ii;Y_.prototype.contains=function(){};var f1=function(e){function t(){e.call(this),this.array_=[],arguments[0]instanceof Ii&&this.addAll(arguments[0])}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.contains=function(r){for(var n=this,i=0,l=this.array_.length;i<l;i++){var h=n.array_[i];if(h===r)return!0}return!1},t.prototype.add=function(r){return this.contains(r)?!1:(this.array_.push(r),!0)},t.prototype.addAll=function(r){for(var n=this,i=r.iterator();i.hasNext();)n.add(i.next());return!0},t.prototype.remove=function(r){throw new Error},t.prototype.size=function(){return this.array_.length},t.prototype.isEmpty=function(){return this.array_.length===0},t.prototype.toArray=function(){for(var r=this,n=[],i=0,l=this.array_.length;i<l;i++)n.push(r.array_[i]);return n},t.prototype.iterator=function(){return new Z4(this)},t}(Y_),Z4=function(e){function t(r){e.call(this),this.hashSet_=r,this.position_=0}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.next=function(){if(this.position_===this.hashSet_.size())throw new xf;return this.hashSet_.array_[this.position_++]},t.prototype.hasNext=function(){return this.position_<this.hashSet_.size()},t.prototype.remove=function(){throw new Tg},t}(vf),zu=0,Dh=1;function t2(e){return e===null?zu:e.color}function vn(e){return e===null?null:e.parent}function Nu(e,t){e!==null&&(e.color=t)}function bv(e){return e===null?null:e.left}function e2(e){return e===null?null:e.right}function Eo(){this.root_=null,this.size_=0}Eo.prototype=new q4;Eo.prototype.get=function(e){for(var t=this.root_;t!==null;){var r=e.compareTo(t.key);if(r<0)t=t.left;else if(r>0)t=t.right;else return t.value}return null};Eo.prototype.put=function(e,t){if(this.root_===null)return this.root_={key:e,value:t,left:null,right:null,parent:null,color:zu,getValue:function(){return this.value},getKey:function(){return this.key}},this.size_=1,null;var r=this.root_,n,i;do if(n=r,i=e.compareTo(r.key),i<0)r=r.left;else if(i>0)r=r.right;else{var l=r.value;return r.value=t,l}while(r!==null);var h={key:e,left:null,right:null,value:t,parent:n,color:zu,getValue:function(){return this.value},getKey:function(){return this.key}};return i<0?n.left=h:n.right=h,this.fixAfterInsertion(h),this.size_++,null};Eo.prototype.fixAfterInsertion=function(e){var t=this;for(e.color=Dh;e!=null&&e!==this.root_&&e.parent.color===Dh;)if(vn(e)===bv(vn(vn(e)))){var r=e2(vn(vn(e)));t2(r)===Dh?(Nu(vn(e),zu),Nu(r,zu),Nu(vn(vn(e)),Dh),e=vn(vn(e))):(e===e2(vn(e))&&(e=vn(e),t.rotateLeft(e)),Nu(vn(e),zu),Nu(vn(vn(e)),Dh),t.rotateRight(vn(vn(e))))}else{var n=bv(vn(vn(e)));t2(n)===Dh?(Nu(vn(e),zu),Nu(n,zu),Nu(vn(vn(e)),Dh),e=vn(vn(e))):(e===bv(vn(e))&&(e=vn(e),t.rotateRight(e)),Nu(vn(e),zu),Nu(vn(vn(e)),Dh),t.rotateLeft(vn(vn(e))))}this.root_.color=zu};Eo.prototype.values=function(){var e=new me,t=this.getFirstEntry();if(t!==null)for(e.add(t.value);(t=Eo.successor(t))!==null;)e.add(t.value);return e};Eo.prototype.entrySet=function(){var e=new f1,t=this.getFirstEntry();if(t!==null)for(e.add(t);(t=Eo.successor(t))!==null;)e.add(t);return e};Eo.prototype.rotateLeft=function(e){if(e!=null){var t=e.right;e.right=t.left,t.left!=null&&(t.left.parent=e),t.parent=e.parent,e.parent===null?this.root_=t:e.parent.left===e?e.parent.left=t:e.parent.right=t,t.left=e,e.parent=t}};Eo.prototype.rotateRight=function(e){if(e!=null){var t=e.left;e.left=t.right,t.right!=null&&(t.right.parent=e),t.parent=e.parent,e.parent===null?this.root_=t:e.parent.right===e?e.parent.right=t:e.parent.left=t,t.right=e,e.parent=t}};Eo.prototype.getFirstEntry=function(){var e=this.root_;if(e!=null)for(;e.left!=null;)e=e.left;return e};Eo.successor=function(e){if(e===null)return null;if(e.right!==null){for(var t=e.right;t.left!==null;)t=t.left;return t}else{for(var r=e.parent,n=e;r!==null&&n===r.right;)n=r,r=r.parent;return r}};Eo.prototype.size=function(){return this.size_};var eg=function(){};eg.prototype.interfaces_=function(){return[]};eg.prototype.getClass=function(){return eg};function GI(){}GI.prototype=new Y_;function Pl(){this.array_=[],arguments[0]instanceof Ii&&this.addAll(arguments[0])}Pl.prototype=new GI;Pl.prototype.contains=function(e){for(var t=this,r=0,n=this.array_.length;r<n;r++){var i=t.array_[r];if(i.compareTo(e)===0)return!0}return!1};Pl.prototype.add=function(e){var t=this;if(this.contains(e))return!1;for(var r=0,n=this.array_.length;r<n;r++){var i=t.array_[r];if(i.compareTo(e)===1)return t.array_.splice(r,0,e),!0}return this.array_.push(e),!0};Pl.prototype.addAll=function(e){for(var t=this,r=e.iterator();r.hasNext();)t.add(r.next());return!0};Pl.prototype.remove=function(e){throw new Tg};Pl.prototype.size=function(){return this.array_.length};Pl.prototype.isEmpty=function(){return this.array_.length===0};Pl.prototype.toArray=function(){for(var e=this,t=[],r=0,n=this.array_.length;r<n;r++)t.push(e.array_[r]);return t};Pl.prototype.iterator=function(){return new K_(this)};var K_=function(e){this.treeSet_=e,this.position_=0};K_.prototype.next=function(){if(this.position_===this.treeSet_.size())throw new xf;return this.treeSet_.array_[this.position_++]};K_.prototype.hasNext=function(){return this.position_<this.treeSet_.size()};K_.prototype.remove=function(){throw new Tg};var Bh=function(){};Bh.sort=function(){var e=arguments[0],t,r,n,i;if(arguments.length===1)i=function(h,a){return h.compareTo(a)},e.sort(i);else if(arguments.length===2)n=arguments[1],i=function(h,a){return n.compare(h,a)},e.sort(i);else if(arguments.length===3){r=e.slice(arguments[1],arguments[2]),r.sort();var l=e.slice(0,arguments[1]).concat(r,e.slice(arguments[2],e.length));for(e.splice(0,e.length),t=0;t<l.length;t++)e.push(l[t])}else if(arguments.length===4)for(r=e.slice(arguments[1],arguments[2]),n=arguments[3],i=function(h,a){return n.compare(h,a)},r.sort(i),l=e.slice(0,arguments[1]).concat(r,e.slice(arguments[2],e.length)),e.splice(0,e.length),t=0;t<l.length;t++)e.push(l[t])};Bh.asList=function(e){for(var t=new me,r=0,n=e.length;r<n;r++)t.add(e[r]);return t};var qr=function(){},Ja={P:{configurable:!0},L:{configurable:!0},A:{configurable:!0},FALSE:{configurable:!0},TRUE:{configurable:!0},DONTCARE:{configurable:!0},SYM_FALSE:{configurable:!0},SYM_TRUE:{configurable:!0},SYM_DONTCARE:{configurable:!0},SYM_P:{configurable:!0},SYM_L:{configurable:!0},SYM_A:{configurable:!0}};Ja.P.get=function(){return 0};Ja.L.get=function(){return 1};Ja.A.get=function(){return 2};Ja.FALSE.get=function(){return-1};Ja.TRUE.get=function(){return-2};Ja.DONTCARE.get=function(){return-3};Ja.SYM_FALSE.get=function(){return"F"};Ja.SYM_TRUE.get=function(){return"T"};Ja.SYM_DONTCARE.get=function(){return"*"};Ja.SYM_P.get=function(){return"0"};Ja.SYM_L.get=function(){return"1"};Ja.SYM_A.get=function(){return"2"};qr.prototype.interfaces_=function(){return[]};qr.prototype.getClass=function(){return qr};qr.toDimensionSymbol=function(e){switch(e){case qr.FALSE:return qr.SYM_FALSE;case qr.TRUE:return qr.SYM_TRUE;case qr.DONTCARE:return qr.SYM_DONTCARE;case qr.P:return qr.SYM_P;case qr.L:return qr.SYM_L;case qr.A:return qr.SYM_A}throw new $n("Unknown dimension value: "+e)};qr.toDimensionValue=function(e){switch(Qm.toUpperCase(e)){case qr.SYM_FALSE:return qr.FALSE;case qr.SYM_TRUE:return qr.TRUE;case qr.SYM_DONTCARE:return qr.DONTCARE;case qr.SYM_P:return qr.P;case qr.SYM_L:return qr.L;case qr.SYM_A:return qr.A}throw new $n("Unknown dimension symbol: "+e)};Object.defineProperties(qr,Ja);var Al=function(){};Al.prototype.filter=function(e){};Al.prototype.interfaces_=function(){return[]};Al.prototype.getClass=function(){return Al};var Ga=function(){};Ga.prototype.filter=function(e,t){};Ga.prototype.isDone=function(){};Ga.prototype.isGeometryChanged=function(){};Ga.prototype.interfaces_=function(){return[]};Ga.prototype.getClass=function(){return Ga};var qo=function(e){function t(n,i){if(e.call(this,i),this._geometries=n||[],e.hasNullElements(this._geometries))throw new $n("geometries must not contain null elements")}e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t;var r={serialVersionUID:{configurable:!0}};return t.prototype.computeEnvelopeInternal=function(){for(var n=this,i=new Ve,l=0;l<this._geometries.length;l++)i.expandToInclude(n._geometries[l].getEnvelopeInternal());return i},t.prototype.getGeometryN=function(n){return this._geometries[n]},t.prototype.getSortIndex=function(){return e.SORTINDEX_GEOMETRYCOLLECTION},t.prototype.getCoordinates=function(){for(var n=this,i=new Array(this.getNumPoints()).fill(null),l=-1,h=0;h<this._geometries.length;h++)for(var a=n._geometries[h].getCoordinates(),g=0;g<a.length;g++)l++,i[l]=a[g];return i},t.prototype.getArea=function(){for(var n=this,i=0,l=0;l<this._geometries.length;l++)i+=n._geometries[l].getArea();return i},t.prototype.equalsExact=function(){var n=this;if(arguments.length===2){var i=arguments[0],l=arguments[1];if(!this.isEquivalentClass(i))return!1;var h=i;if(this._geometries.length!==h._geometries.length)return!1;for(var a=0;a<this._geometries.length;a++)if(!n._geometries[a].equalsExact(h._geometries[a],l))return!1;return!0}else return e.prototype.equalsExact.apply(this,arguments)},t.prototype.normalize=function(){for(var n=this,i=0;i<this._geometries.length;i++)n._geometries[i].normalize();Bh.sort(this._geometries)},t.prototype.getCoordinate=function(){return this.isEmpty()?null:this._geometries[0].getCoordinate()},t.prototype.getBoundaryDimension=function(){for(var n=this,i=qr.FALSE,l=0;l<this._geometries.length;l++)i=Math.max(i,n._geometries[l].getBoundaryDimension());return i},t.prototype.getDimension=function(){for(var n=this,i=qr.FALSE,l=0;l<this._geometries.length;l++)i=Math.max(i,n._geometries[l].getDimension());return i},t.prototype.getLength=function(){for(var n=this,i=0,l=0;l<this._geometries.length;l++)i+=n._geometries[l].getLength();return i},t.prototype.getNumPoints=function(){for(var n=this,i=0,l=0;l<this._geometries.length;l++)i+=n._geometries[l].getNumPoints();return i},t.prototype.getNumGeometries=function(){return this._geometries.length},t.prototype.reverse=function(){for(var n=this,i=this._geometries.length,l=new Array(i).fill(null),h=0;h<this._geometries.length;h++)l[h]=n._geometries[h].reverse();return this.getFactory().createGeometryCollection(l)},t.prototype.compareToSameClass=function(){var n=this;if(arguments.length===1){var i=arguments[0],l=new Pl(Bh.asList(this._geometries)),h=new Pl(Bh.asList(i._geometries));return this.compare(l,h)}else if(arguments.length===2){for(var a=arguments[0],g=arguments[1],_=a,E=this.getNumGeometries(),S=_.getNumGeometries(),A=0;A<E&&A<S;){var O=n.getGeometryN(A),k=_.getGeometryN(A),G=O.compareToSameClass(k,g);if(G!==0)return G;A++}return A<E?1:A<S?-1:0}},t.prototype.apply=function(){var n=this;if(rr(arguments[0],uu))for(var i=arguments[0],l=0;l<this._geometries.length;l++)n._geometries[l].apply(i);else if(rr(arguments[0],Ga)){var h=arguments[0];if(this._geometries.length===0)return null;for(var a=0;a<this._geometries.length&&(n._geometries[a].apply(h),!h.isDone());a++);h.isGeometryChanged()&&this.geometryChanged()}else if(rr(arguments[0],Al)){var g=arguments[0];g.filter(this);for(var _=0;_<this._geometries.length;_++)n._geometries[_].apply(g)}else if(rr(arguments[0],Gu)){var E=arguments[0];E.filter(this);for(var S=0;S<this._geometries.length;S++)n._geometries[S].apply(E)}},t.prototype.getBoundary=function(){return this.checkNotGeometryCollection(this),dr.shouldNeverReachHere(),null},t.prototype.clone=function(){var n=this,i=e.prototype.clone.call(this);i._geometries=new Array(this._geometries.length).fill(null);for(var l=0;l<this._geometries.length;l++)i._geometries[l]=n._geometries[l].clone();return i},t.prototype.getGeometryType=function(){return"GeometryCollection"},t.prototype.copy=function(){for(var n=this,i=new Array(this._geometries.length).fill(null),l=0;l<i.length;l++)i[l]=n._geometries[l].copy();return new t(i,this._factory)},t.prototype.isEmpty=function(){for(var n=this,i=0;i<this._geometries.length;i++)if(!n._geometries[i].isEmpty())return!1;return!0},t.prototype.interfaces_=function(){return[]},t.prototype.getClass=function(){return t},r.serialVersionUID.get=function(){return-5694727726395021e3},Object.defineProperties(t,r),t}(tr),Hh=function(e){function t(){e.apply(this,arguments)}e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t;var r={serialVersionUID:{configurable:!0}};return t.prototype.getSortIndex=function(){return tr.SORTINDEX_MULTILINESTRING},t.prototype.equalsExact=function(){if(arguments.length===2){var n=arguments[0],i=arguments[1];return this.isEquivalentClass(n)?e.prototype.equalsExact.call(this,n,i):!1}else return e.prototype.equalsExact.apply(this,arguments)},t.prototype.getBoundaryDimension=function(){return this.isClosed()?qr.FALSE:0},t.prototype.isClosed=function(){var n=this;if(this.isEmpty())return!1;for(var i=0;i<this._geometries.length;i++)if(!n._geometries[i].isClosed())return!1;return!0},t.prototype.getDimension=function(){return 1},t.prototype.reverse=function(){for(var n=this,i=this._geometries.length,l=new Array(i).fill(null),h=0;h<this._geometries.length;h++)l[i-1-h]=n._geometries[h].reverse();return this.getFactory().createMultiLineString(l)},t.prototype.getBoundary=function(){return new ga(this).getBoundary()},t.prototype.getGeometryType=function(){return"MultiLineString"},t.prototype.copy=function(){for(var n=this,i=new Array(this._geometries.length).fill(null),l=0;l<i.length;l++)i[l]=n._geometries[l].copy();return new t(i,this._factory)},t.prototype.interfaces_=function(){return[eg]},t.prototype.getClass=function(){return t},r.serialVersionUID.get=function(){return 8166665132445434e3},Object.defineProperties(t,r),t}(qo),ga=function(){if(this._geom=null,this._geomFact=null,this._bnRule=null,this._endpointMap=null,arguments.length===1){var e=arguments[0],t=wa.MOD2_BOUNDARY_RULE;this._geom=e,this._geomFact=e.getFactory(),this._bnRule=t}else if(arguments.length===2){var r=arguments[0],n=arguments[1];this._geom=r,this._geomFact=r.getFactory(),this._bnRule=n}};ga.prototype.boundaryMultiLineString=function(e){if(this._geom.isEmpty())return this.getEmptyMultiPoint();var t=this.computeBoundaryCoordinates(e);return t.length===1?this._geomFact.createPoint(t[0]):this._geomFact.createMultiPointFromCoords(t)};ga.prototype.getBoundary=function(){return this._geom instanceof Hn?this.boundaryLineString(this._geom):this._geom instanceof Hh?this.boundaryMultiLineString(this._geom):this._geom.getBoundary()};ga.prototype.boundaryLineString=function(e){if(this._geom.isEmpty())return this.getEmptyMultiPoint();if(e.isClosed()){var t=this._bnRule.isInBoundary(2);return t?e.getStartPoint():this._geomFact.createMultiPoint()}return this._geomFact.createMultiPoint([e.getStartPoint(),e.getEndPoint()])};ga.prototype.getEmptyMultiPoint=function(){return this._geomFact.createMultiPoint()};ga.prototype.computeBoundaryCoordinates=function(e){var t=this,r=new me;this._endpointMap=new Eo;for(var n=0;n<e.getNumGeometries();n++){var i=e.getGeometryN(n);i.getNumPoints()!==0&&(t.addEndpoint(i.getCoordinateN(0)),t.addEndpoint(i.getCoordinateN(i.getNumPoints()-1)))}for(var l=this._endpointMap.entrySet().iterator();l.hasNext();){var h=l.next(),a=h.getValue(),g=a.count;t._bnRule.isInBoundary(g)&&r.add(h.getKey())}return Sr.toCoordinateArray(r)};ga.prototype.addEndpoint=function(e){var t=this._endpointMap.get(e);t===null&&(t=new x_,this._endpointMap.put(e,t)),t.count++};ga.prototype.interfaces_=function(){return[]};ga.prototype.getClass=function(){return ga};ga.getBoundary=function(){if(arguments.length===1){var e=arguments[0],t=new ga(e);return t.getBoundary()}else if(arguments.length===2){var r=arguments[0],n=arguments[1],i=new ga(r,n);return i.getBoundary()}};var x_=function(){this.count=null};x_.prototype.interfaces_=function(){return[]};x_.prototype.getClass=function(){return x_};function W4(){}function X4(){}var H4=function(){};function Y4(){}function K4(){}function J4(){}var ya=function(){},m1={NEWLINE:{configurable:!0},SIMPLE_ORDINATE_FORMAT:{configurable:!0}};ya.prototype.interfaces_=function(){return[]};ya.prototype.getClass=function(){return ya};ya.chars=function(e,t){for(var r=new Array(t).fill(null),n=0;n<t;n++)r[n]=e;return String(r)};ya.getStackTrace=function(){if(arguments.length===1){var e=arguments[0],t=new Y4,r=new W4;return e.printStackTrace(r),t.toString()}else if(arguments.length===2){var n=arguments[0],i=arguments[1],l="";new X4(ya.getStackTrace(n));for(var h=new J4,a=0;a<i;a++)try{l+=h.readLine()+ya.NEWLINE}catch(g){if(g instanceof K4)dr.shouldNeverReachHere();else throw g}finally{}return l}};ya.split=function(e,t){for(var r=t.length,n=new me,i=""+e,l=i.indexOf(t);l>=0;){var h=i.substring(0,l);n.add(h),i=i.substring(l+r),l=i.indexOf(t)}i.length>0&&n.add(i);for(var a=new Array(n.size()).fill(null),g=0;g<a.length;g++)a[g]=n.get(g);return a};ya.toString=function(){if(arguments.length===1){var e=arguments[0];return ya.SIMPLE_ORDINATE_FORMAT.format(e)}};ya.spaces=function(e){return ya.chars(" ",e)};m1.NEWLINE.get=function(){return so.getProperty("line.separator")};m1.SIMPLE_ORDINATE_FORMAT.get=function(){return new H4};Object.defineProperties(ya,m1);var ii=function(){};ii.prototype.interfaces_=function(){return[]};ii.prototype.getClass=function(){return ii};ii.copyCoord=function(e,t,r,n){for(var i=Math.min(e.getDimension(),r.getDimension()),l=0;l<i;l++)r.setOrdinate(n,l,e.getOrdinate(t,l))};ii.isRing=function(e){var t=e.size();return t===0?!0:t<=3?!1:e.getOrdinate(0,Br.X)===e.getOrdinate(t-1,Br.X)&&e.getOrdinate(0,Br.Y)===e.getOrdinate(t-1,Br.Y)};ii.isEqual=function(e,t){var r=e.size(),n=t.size();if(r!==n)return!1;for(var i=Math.min(e.getDimension(),t.getDimension()),l=0;l<r;l++)for(var h=0;h<i;h++){var a=e.getOrdinate(l,h),g=t.getOrdinate(l,h);if(e.getOrdinate(l,h)!==t.getOrdinate(l,h)&&!(lr.isNaN(a)&&lr.isNaN(g)))return!1}return!0};ii.extend=function(e,t,r){var n=e.create(r,t.getDimension()),i=t.size();if(ii.copy(t,0,n,0,i),i>0)for(var l=i;l<r;l++)ii.copy(t,i-1,n,l,1);return n};ii.reverse=function(e){for(var t=e.size()-1,r=Math.trunc(t/2),n=0;n<=r;n++)ii.swap(e,n,t-n)};ii.swap=function(e,t,r){if(t===r)return null;for(var n=0;n<e.getDimension();n++){var i=e.getOrdinate(t,n);e.setOrdinate(t,n,e.getOrdinate(r,n)),e.setOrdinate(r,n,i)}};ii.copy=function(e,t,r,n,i){for(var l=0;l<i;l++)ii.copyCoord(e,t+l,r,n+l)};ii.toString=function(){if(arguments.length===1){var e=arguments[0],t=e.size();if(t===0)return"()";var r=e.getDimension(),n=new zl;n.append("(");for(var i=0;i<t;i++){i>0&&n.append(" ");for(var l=0;l<r;l++)l>0&&n.append(","),n.append(ya.toString(e.getOrdinate(i,l)))}return n.append(")"),n.toString()}};ii.ensureValidRing=function(e,t){var r=t.size();if(r===0)return t;if(r<=3)return ii.createClosedRing(e,t,4);var n=t.getOrdinate(0,Br.X)===t.getOrdinate(r-1,Br.X)&&t.getOrdinate(0,Br.Y)===t.getOrdinate(r-1,Br.Y);return n?t:ii.createClosedRing(e,t,r+1)};ii.createClosedRing=function(e,t,r){var n=e.create(r,t.getDimension()),i=t.size();ii.copy(t,0,n,0,i);for(var l=i;l<r;l++)ii.copy(t,0,n,l,1);return n};var Hn=function(e){function t(n,i){e.call(this,i),this._points=null,this.init(n)}e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t;var r={serialVersionUID:{configurable:!0}};return t.prototype.computeEnvelopeInternal=function(){return this.isEmpty()?new Ve:this._points.expandEnvelope(new Ve)},t.prototype.isRing=function(){return this.isClosed()&&this.isSimple()},t.prototype.getSortIndex=function(){return e.SORTINDEX_LINESTRING},t.prototype.getCoordinates=function(){return this._points.toCoordinateArray()},t.prototype.equalsExact=function(){var n=this;if(arguments.length===2){var i=arguments[0],l=arguments[1];if(!this.isEquivalentClass(i))return!1;var h=i;if(this._points.size()!==h._points.size())return!1;for(var a=0;a<this._points.size();a++)if(!n.equal(n._points.getCoordinate(a),h._points.getCoordinate(a),l))return!1;return!0}else return e.prototype.equalsExact.apply(this,arguments)},t.prototype.normalize=function(){for(var n=this,i=0;i<Math.trunc(this._points.size()/2);i++){var l=n._points.size()-1-i;if(!n._points.getCoordinate(i).equals(n._points.getCoordinate(l)))return n._points.getCoordinate(i).compareTo(n._points.getCoordinate(l))>0&&ii.reverse(n._points),null}},t.prototype.getCoordinate=function(){return this.isEmpty()?null:this._points.getCoordinate(0)},t.prototype.getBoundaryDimension=function(){return this.isClosed()?qr.FALSE:0},t.prototype.isClosed=function(){return this.isEmpty()?!1:this.getCoordinateN(0).equals2D(this.getCoordinateN(this.getNumPoints()-1))},t.prototype.getEndPoint=function(){return this.isEmpty()?null:this.getPointN(this.getNumPoints()-1)},t.prototype.getDimension=function(){return 1},t.prototype.getLength=function(){return Ie.computeLength(this._points)},t.prototype.getNumPoints=function(){return this._points.size()},t.prototype.reverse=function(){var n=this._points.copy();ii.reverse(n);var i=this.getFactory().createLineString(n);return i},t.prototype.compareToSameClass=function(){var n=this;if(arguments.length===1){for(var i=arguments[0],l=i,h=0,a=0;h<this._points.size()&&a<l._points.size();){var g=n._points.getCoordinate(h).compareTo(l._points.getCoordinate(a));if(g!==0)return g;h++,a++}return h<this._points.size()?1:a<l._points.size()?-1:0}else if(arguments.length===2){var _=arguments[0],E=arguments[1],S=_;return E.compare(this._points,S._points)}},t.prototype.apply=function(){var n=this;if(rr(arguments[0],uu))for(var i=arguments[0],l=0;l<this._points.size();l++)i.filter(n._points.getCoordinate(l));else if(rr(arguments[0],Ga)){var h=arguments[0];if(this._points.size()===0)return null;for(var a=0;a<this._points.size()&&(h.filter(n._points,a),!h.isDone());a++);h.isGeometryChanged()&&this.geometryChanged()}else if(rr(arguments[0],Al)){var g=arguments[0];g.filter(this)}else if(rr(arguments[0],Gu)){var _=arguments[0];_.filter(this)}},t.prototype.getBoundary=function(){return new ga(this).getBoundary()},t.prototype.isEquivalentClass=function(n){return n instanceof t},t.prototype.clone=function(){var n=e.prototype.clone.call(this);return n._points=this._points.clone(),n},t.prototype.getCoordinateN=function(n){return this._points.getCoordinate(n)},t.prototype.getGeometryType=function(){return"LineString"},t.prototype.copy=function(){return new t(this._points.copy(),this._factory)},t.prototype.getCoordinateSequence=function(){return this._points},t.prototype.isEmpty=function(){return this._points.size()===0},t.prototype.init=function(n){if(n===null&&(n=this.getFactory().getCoordinateSequenceFactory().create([])),n.size()===1)throw new $n("Invalid number of points in LineString (found "+n.size()+" - must be 0 or >= 2)");this._points=n},t.prototype.isCoordinate=function(n){for(var i=this,l=0;l<this._points.size();l++)if(i._points.getCoordinate(l).equals(n))return!0;return!1},t.prototype.getStartPoint=function(){return this.isEmpty()?null:this.getPointN(0)},t.prototype.getPointN=function(n){return this.getFactory().createPoint(this._points.getCoordinate(n))},t.prototype.interfaces_=function(){return[eg]},t.prototype.getClass=function(){return t},r.serialVersionUID.get=function(){return 0x2b2b51ba435c8e00},Object.defineProperties(t,r),t}(tr),rg=function(){};rg.prototype.interfaces_=function(){return[]};rg.prototype.getClass=function(){return rg};var Is=function(e){function t(n,i){e.call(this,i),this._coordinates=n||null,this.init(this._coordinates)}e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t;var r={serialVersionUID:{configurable:!0}};return t.prototype.computeEnvelopeInternal=function(){if(this.isEmpty())return new Ve;var n=new Ve;return n.expandToInclude(this._coordinates.getX(0),this._coordinates.getY(0)),n},t.prototype.getSortIndex=function(){return e.SORTINDEX_POINT},t.prototype.getCoordinates=function(){return this.isEmpty()?[]:[this.getCoordinate()]},t.prototype.equalsExact=function(){if(arguments.length===2){var n=arguments[0],i=arguments[1];return this.isEquivalentClass(n)?this.isEmpty()&&n.isEmpty()?!0:this.isEmpty()!==n.isEmpty()?!1:this.equal(n.getCoordinate(),this.getCoordinate(),i):!1}else return e.prototype.equalsExact.apply(this,arguments)},t.prototype.normalize=function(){},t.prototype.getCoordinate=function(){return this._coordinates.size()!==0?this._coordinates.getCoordinate(0):null},t.prototype.getBoundaryDimension=function(){return qr.FALSE},t.prototype.getDimension=function(){return 0},t.prototype.getNumPoints=function(){return this.isEmpty()?0:1},t.prototype.reverse=function(){return this.copy()},t.prototype.getX=function(){if(this.getCoordinate()===null)throw new Error("getX called on empty Point");return this.getCoordinate().x},t.prototype.compareToSameClass=function(){if(arguments.length===1){var n=arguments[0],i=n;return this.getCoordinate().compareTo(i.getCoordinate())}else if(arguments.length===2){var l=arguments[0],h=arguments[1],a=l;return h.compare(this._coordinates,a._coordinates)}},t.prototype.apply=function(){if(rr(arguments[0],uu)){var n=arguments[0];if(this.isEmpty())return null;n.filter(this.getCoordinate())}else if(rr(arguments[0],Ga)){var i=arguments[0];if(this.isEmpty())return null;i.filter(this._coordinates,0),i.isGeometryChanged()&&this.geometryChanged()}else if(rr(arguments[0],Al)){var l=arguments[0];l.filter(this)}else if(rr(arguments[0],Gu)){var h=arguments[0];h.filter(this)}},t.prototype.getBoundary=function(){return this.getFactory().createGeometryCollection(null)},t.prototype.clone=function(){var n=e.prototype.clone.call(this);return n._coordinates=this._coordinates.clone(),n},t.prototype.getGeometryType=function(){return"Point"},t.prototype.copy=function(){return new t(this._coordinates.copy(),this._factory)},t.prototype.getCoordinateSequence=function(){return this._coordinates},t.prototype.getY=function(){if(this.getCoordinate()===null)throw new Error("getY called on empty Point");return this.getCoordinate().y},t.prototype.isEmpty=function(){return this._coordinates.size()===0},t.prototype.init=function(n){n===null&&(n=this.getFactory().getCoordinateSequenceFactory().create([])),dr.isTrue(n.size()<=1),this._coordinates=n},t.prototype.isSimple=function(){return!0},t.prototype.interfaces_=function(){return[rg]},t.prototype.getClass=function(){return t},r.serialVersionUID.get=function(){return 4902022702746615e3},Object.defineProperties(t,r),t}(tr),Vc=function(){};Vc.prototype.interfaces_=function(){return[]};Vc.prototype.getClass=function(){return Vc};var Li=function(e){function t(n,i,l){if(e.call(this,l),this._shell=null,this._holes=null,n===null&&(n=this.getFactory().createLinearRing()),i===null&&(i=[]),e.hasNullElements(i))throw new $n("holes must not contain null elements");if(n.isEmpty()&&e.hasNonEmptyElements(i))throw new $n("shell is empty but holes are not");this._shell=n,this._holes=i}e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t;var r={serialVersionUID:{configurable:!0}};return t.prototype.computeEnvelopeInternal=function(){return this._shell.getEnvelopeInternal()},t.prototype.getSortIndex=function(){return e.SORTINDEX_POLYGON},t.prototype.getCoordinates=function(){var n=this;if(this.isEmpty())return[];for(var i=new Array(this.getNumPoints()).fill(null),l=-1,h=this._shell.getCoordinates(),a=0;a<h.length;a++)l++,i[l]=h[a];for(var g=0;g<this._holes.length;g++)for(var _=n._holes[g].getCoordinates(),E=0;E<_.length;E++)l++,i[l]=_[E];return i},t.prototype.getArea=function(){var n=this,i=0;i+=Math.abs(Ie.signedArea(this._shell.getCoordinateSequence()));for(var l=0;l<this._holes.length;l++)i-=Math.abs(Ie.signedArea(n._holes[l].getCoordinateSequence()));return i},t.prototype.isRectangle=function(){if(this.getNumInteriorRing()!==0||this._shell===null||this._shell.getNumPoints()!==5)return!1;for(var n=this._shell.getCoordinateSequence(),i=this.getEnvelopeInternal(),l=0;l<5;l++){var h=n.getX(l);if(!(h===i.getMinX()||h===i.getMaxX()))return!1;var a=n.getY(l);if(!(a===i.getMinY()||a===i.getMaxY()))return!1}for(var g=n.getX(0),_=n.getY(0),E=1;E<=4;E++){var S=n.getX(E),A=n.getY(E),O=S!==g,k=A!==_;if(O===k)return!1;g=S,_=A}return!0},t.prototype.equalsExact=function(){var n=this;if(arguments.length===2){var i=arguments[0],l=arguments[1];if(!this.isEquivalentClass(i))return!1;var h=i,a=this._shell,g=h._shell;if(!a.equalsExact(g,l)||this._holes.length!==h._holes.length)return!1;for(var _=0;_<this._holes.length;_++)if(!n._holes[_].equalsExact(h._holes[_],l))return!1;return!0}else return e.prototype.equalsExact.apply(this,arguments)},t.prototype.normalize=function(){var n=this;if(arguments.length===0){this.normalize(this._shell,!0);for(var i=0;i<this._holes.length;i++)n.normalize(n._holes[i],!1);Bh.sort(this._holes)}else if(arguments.length===2){var l=arguments[0],h=arguments[1];if(l.isEmpty())return null;var a=new Array(l.getCoordinates().length-1).fill(null);so.arraycopy(l.getCoordinates(),0,a,0,a.length);var g=Sr.minCoordinate(l.getCoordinates());Sr.scroll(a,g),so.arraycopy(a,0,l.getCoordinates(),0,a.length),l.getCoordinates()[a.length]=a[0],Ie.isCCW(l.getCoordinates())===h&&Sr.reverse(l.getCoordinates())}},t.prototype.getCoordinate=function(){return this._shell.getCoordinate()},t.prototype.getNumInteriorRing=function(){return this._holes.length},t.prototype.getBoundaryDimension=function(){return 1},t.prototype.getDimension=function(){return 2},t.prototype.getLength=function(){var n=this,i=0;i+=this._shell.getLength();for(var l=0;l<this._holes.length;l++)i+=n._holes[l].getLength();return i},t.prototype.getNumPoints=function(){for(var n=this,i=this._shell.getNumPoints(),l=0;l<this._holes.length;l++)i+=n._holes[l].getNumPoints();return i},t.prototype.reverse=function(){var n=this,i=this.copy();i._shell=this._shell.copy().reverse(),i._holes=new Array(this._holes.length).fill(null);for(var l=0;l<this._holes.length;l++)i._holes[l]=n._holes[l].copy().reverse();return i},t.prototype.convexHull=function(){return this.getExteriorRing().convexHull()},t.prototype.compareToSameClass=function(){var n=this;if(arguments.length===1){var i=arguments[0],l=this._shell,h=i._shell;return l.compareToSameClass(h)}else if(arguments.length===2){var a=arguments[0],g=arguments[1],_=a,E=this._shell,S=_._shell,A=E.compareToSameClass(S,g);if(A!==0)return A;for(var O=this.getNumInteriorRing(),k=_.getNumInteriorRing(),G=0;G<O&&G<k;){var W=n.getInteriorRingN(G),U=_.getInteriorRingN(G),tt=W.compareToSameClass(U,g);if(tt!==0)return tt;G++}return G<O?1:G<k?-1:0}},t.prototype.apply=function(n){var i=this;if(rr(n,uu)){this._shell.apply(n);for(var l=0;l<this._holes.length;l++)i._holes[l].apply(n)}else if(rr(n,Ga)){if(this._shell.apply(n),!n.isDone())for(var h=0;h<this._holes.length&&(i._holes[h].apply(n),!n.isDone());h++);n.isGeometryChanged()&&this.geometryChanged()}else if(rr(n,Al))n.filter(this);else if(rr(n,Gu)){n.filter(this),this._shell.apply(n);for(var a=0;a<this._holes.length;a++)i._holes[a].apply(n)}},t.prototype.getBoundary=function(){var n=this;if(this.isEmpty())return this.getFactory().createMultiLineString();var i=new Array(this._holes.length+1).fill(null);i[0]=this._shell;for(var l=0;l<this._holes.length;l++)i[l+1]=n._holes[l];return i.length<=1?this.getFactory().createLinearRing(i[0].getCoordinateSequence()):this.getFactory().createMultiLineString(i)},t.prototype.clone=function(){var n=this,i=e.prototype.clone.call(this);i._shell=this._shell.clone(),i._holes=new Array(this._holes.length).fill(null);for(var l=0;l<this._holes.length;l++)i._holes[l]=n._holes[l].clone();return i},t.prototype.getGeometryType=function(){return"Polygon"},t.prototype.copy=function(){for(var n=this,i=this._shell.copy(),l=new Array(this._holes.length).fill(null),h=0;h<l.length;h++)l[h]=n._holes[h].copy();return new t(i,l,this._factory)},t.prototype.getExteriorRing=function(){return this._shell},t.prototype.isEmpty=function(){return this._shell.isEmpty()},t.prototype.getInteriorRingN=function(n){return this._holes[n]},t.prototype.interfaces_=function(){return[Vc]},t.prototype.getClass=function(){return t},r.serialVersionUID.get=function(){return-0x307ffefd8dc97200},Object.defineProperties(t,r),t}(tr),Qd=function(e){function t(){e.apply(this,arguments)}e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t;var r={serialVersionUID:{configurable:!0}};return t.prototype.getSortIndex=function(){return tr.SORTINDEX_MULTIPOINT},t.prototype.isValid=function(){return!0},t.prototype.equalsExact=function(){if(arguments.length===2){var n=arguments[0],i=arguments[1];return this.isEquivalentClass(n)?e.prototype.equalsExact.call(this,n,i):!1}else return e.prototype.equalsExact.apply(this,arguments)},t.prototype.getCoordinate=function(){if(arguments.length===1){var n=arguments[0];return this._geometries[n].getCoordinate()}else return e.prototype.getCoordinate.apply(this,arguments)},t.prototype.getBoundaryDimension=function(){return qr.FALSE},t.prototype.getDimension=function(){return 0},t.prototype.getBoundary=function(){return this.getFactory().createGeometryCollection(null)},t.prototype.getGeometryType=function(){return"MultiPoint"},t.prototype.copy=function(){for(var n=this,i=new Array(this._geometries.length).fill(null),l=0;l<i.length;l++)i[l]=n._geometries[l].copy();return new t(i,this._factory)},t.prototype.interfaces_=function(){return[rg]},t.prototype.getClass=function(){return t},r.serialVersionUID.get=function(){return-8048474874175356e3},Object.defineProperties(t,r),t}(qo),cu=function(e){function t(n,i){n instanceof kt&&i instanceof Er&&(n=i.getCoordinateSequenceFactory().create(n)),e.call(this,n,i),this.validateConstruction()}e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t;var r={MINIMUM_VALID_SIZE:{configurable:!0},serialVersionUID:{configurable:!0}};return t.prototype.getSortIndex=function(){return tr.SORTINDEX_LINEARRING},t.prototype.getBoundaryDimension=function(){return qr.FALSE},t.prototype.isClosed=function(){return this.isEmpty()?!0:e.prototype.isClosed.call(this)},t.prototype.reverse=function(){var n=this._points.copy();ii.reverse(n);var i=this.getFactory().createLinearRing(n);return i},t.prototype.validateConstruction=function(){if(!this.isEmpty()&&!e.prototype.isClosed.call(this))throw new $n("Points of LinearRing do not form a closed linestring");if(this.getCoordinateSequence().size()>=1&&this.getCoordinateSequence().size()<t.MINIMUM_VALID_SIZE)throw new $n("Invalid number of points in LinearRing (found "+this.getCoordinateSequence().size()+" - must be 0 or >= 4)")},t.prototype.getGeometryType=function(){return"LinearRing"},t.prototype.copy=function(){return new t(this._points.copy(),this._factory)},t.prototype.interfaces_=function(){return[]},t.prototype.getClass=function(){return t},r.MINIMUM_VALID_SIZE.get=function(){return 4},r.serialVersionUID.get=function(){return-0x3b229e262367a600},Object.defineProperties(t,r),t}(Hn),su=function(e){function t(){e.apply(this,arguments)}e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t;var r={serialVersionUID:{configurable:!0}};return t.prototype.getSortIndex=function(){return tr.SORTINDEX_MULTIPOLYGON},t.prototype.equalsExact=function(){if(arguments.length===2){var n=arguments[0],i=arguments[1];return this.isEquivalentClass(n)?e.prototype.equalsExact.call(this,n,i):!1}else return e.prototype.equalsExact.apply(this,arguments)},t.prototype.getBoundaryDimension=function(){return 1},t.prototype.getDimension=function(){return 2},t.prototype.reverse=function(){for(var n=this,i=this._geometries.length,l=new Array(i).fill(null),h=0;h<this._geometries.length;h++)l[h]=n._geometries[h].reverse();return this.getFactory().createMultiPolygon(l)},t.prototype.getBoundary=function(){var n=this;if(this.isEmpty())return this.getFactory().createMultiLineString();for(var i=new me,l=0;l<this._geometries.length;l++)for(var h=n._geometries[l],a=h.getBoundary(),g=0;g<a.getNumGeometries();g++)i.add(a.getGeometryN(g));var _=new Array(i.size()).fill(null);return this.getFactory().createMultiLineString(i.toArray(_))},t.prototype.getGeometryType=function(){return"MultiPolygon"},t.prototype.copy=function(){for(var n=this,i=new Array(this._geometries.length).fill(null),l=0;l<i.length;l++)i[l]=n._geometries[l].copy();return new t(i,this._factory)},t.prototype.interfaces_=function(){return[Vc]},t.prototype.getClass=function(){return t},r.serialVersionUID.get=function(){return-0x7a5aa1369171980},Object.defineProperties(t,r),t}(qo),Ea=function(e){this._factory=e||null,this._isUserDataCopied=!1},J_={NoOpGeometryOperation:{configurable:!0},CoordinateOperation:{configurable:!0},CoordinateSequenceOperation:{configurable:!0}};Ea.prototype.setCopyUserData=function(e){this._isUserDataCopied=e};Ea.prototype.edit=function(e,t){if(e===null)return null;var r=this.editInternal(e,t);return this._isUserDataCopied&&r.setUserData(e.getUserData()),r};Ea.prototype.editInternal=function(e,t){return this._factory===null&&(this._factory=e.getFactory()),e instanceof qo?this.editGeometryCollection(e,t):e instanceof Li?this.editPolygon(e,t):e instanceof Is?t.edit(e,this._factory):e instanceof Hn?t.edit(e,this._factory):(dr.shouldNeverReachHere("Unsupported Geometry class: "+e.getClass().getName()),null)};Ea.prototype.editGeometryCollection=function(e,t){for(var r=this,n=t.edit(e,this._factory),i=new me,l=0;l<n.getNumGeometries();l++){var h=r.edit(n.getGeometryN(l),t);h===null||h.isEmpty()||i.add(h)}return n.getClass()===Qd?this._factory.createMultiPoint(i.toArray([])):n.getClass()===Hh?this._factory.createMultiLineString(i.toArray([])):n.getClass()===su?this._factory.createMultiPolygon(i.toArray([])):this._factory.createGeometryCollection(i.toArray([]))};Ea.prototype.editPolygon=function(e,t){var r=this,n=t.edit(e,this._factory);if(n===null&&(n=this._factory.createPolygon(null)),n.isEmpty())return n;var i=this.edit(n.getExteriorRing(),t);if(i===null||i.isEmpty())return this._factory.createPolygon();for(var l=new me,h=0;h<n.getNumInteriorRing();h++){var a=r.edit(n.getInteriorRingN(h),t);a===null||a.isEmpty()||l.add(a)}return this._factory.createPolygon(i,l.toArray([]))};Ea.prototype.interfaces_=function(){return[]};Ea.prototype.getClass=function(){return Ea};Ea.GeometryEditorOperation=function(){};J_.NoOpGeometryOperation.get=function(){return ng};J_.CoordinateOperation.get=function(){return ig};J_.CoordinateSequenceOperation.get=function(){return og};Object.defineProperties(Ea,J_);var ng=function(){};ng.prototype.edit=function(e,t){return e};ng.prototype.interfaces_=function(){return[Ea.GeometryEditorOperation]};ng.prototype.getClass=function(){return ng};var ig=function(){};ig.prototype.edit=function(e,t){var r=this.editCoordinates(e.getCoordinates(),e);return r===null?e:e instanceof cu?t.createLinearRing(r):e instanceof Hn?t.createLineString(r):e instanceof Is?r.length>0?t.createPoint(r[0]):t.createPoint():e};ig.prototype.interfaces_=function(){return[Ea.GeometryEditorOperation]};ig.prototype.getClass=function(){return ig};var og=function(){};og.prototype.edit=function(e,t){return e instanceof cu?t.createLinearRing(this.edit(e.getCoordinateSequence(),e)):e instanceof Hn?t.createLineString(this.edit(e.getCoordinateSequence(),e)):e instanceof Is?t.createPoint(this.edit(e.getCoordinateSequence(),e)):e};og.prototype.interfaces_=function(){return[Ea.GeometryEditorOperation]};og.prototype.getClass=function(){return og};var ei=function(){var e=this;if(this._dimension=3,this._coordinates=null,arguments.length===1){if(arguments[0]instanceof Array)this._coordinates=arguments[0],this._dimension=3;else if(Number.isInteger(arguments[0])){var t=arguments[0];this._coordinates=new Array(t).fill(null);for(var r=0;r<t;r++)e._coordinates[r]=new kt}else if(rr(arguments[0],Br)){var n=arguments[0];if(n===null)return this._coordinates=new Array(0).fill(null),null;this._dimension=n.getDimension(),this._coordinates=new Array(n.size()).fill(null);for(var i=0;i<this._coordinates.length;i++)e._coordinates[i]=n.getCoordinateCopy(i)}}else if(arguments.length===2){if(arguments[0]instanceof Array&&Number.isInteger(arguments[1])){var l=arguments[0],h=arguments[1];this._coordinates=l,this._dimension=h,l===null&&(this._coordinates=new Array(0).fill(null))}else if(Number.isInteger(arguments[0])&&Number.isInteger(arguments[1])){var a=arguments[0],g=arguments[1];this._coordinates=new Array(a).fill(null),this._dimension=g;for(var _=0;_<a;_++)e._coordinates[_]=new kt}}},qI={serialVersionUID:{configurable:!0}};ei.prototype.setOrdinate=function(e,t,r){switch(t){case Br.X:this._coordinates[e].x=r;break;case Br.Y:this._coordinates[e].y=r;break;case Br.Z:this._coordinates[e].z=r;break;default:throw new $n("invalid ordinateIndex")}};ei.prototype.size=function(){return this._coordinates.length};ei.prototype.getOrdinate=function(e,t){switch(t){case Br.X:return this._coordinates[e].x;case Br.Y:return this._coordinates[e].y;case Br.Z:return this._coordinates[e].z}return lr.NaN};ei.prototype.getCoordinate=function(){if(arguments.length===1){var e=arguments[0];return this._coordinates[e]}else if(arguments.length===2){var t=arguments[0],r=arguments[1];r.x=this._coordinates[t].x,r.y=this._coordinates[t].y,r.z=this._coordinates[t].z}};ei.prototype.getCoordinateCopy=function(e){return new kt(this._coordinates[e])};ei.prototype.getDimension=function(){return this._dimension};ei.prototype.getX=function(e){return this._coordinates[e].x};ei.prototype.clone=function(){for(var e=this,t=new Array(this.size()).fill(null),r=0;r<this._coordinates.length;r++)t[r]=e._coordinates[r].clone();return new ei(t,this._dimension)};ei.prototype.expandEnvelope=function(e){for(var t=this,r=0;r<this._coordinates.length;r++)e.expandToInclude(t._coordinates[r]);return e};ei.prototype.copy=function(){for(var e=this,t=new Array(this.size()).fill(null),r=0;r<this._coordinates.length;r++)t[r]=e._coordinates[r].copy();return new ei(t,this._dimension)};ei.prototype.toString=function(){var e=this;if(this._coordinates.length>0){var t=new zl(17*this._coordinates.length);t.append("("),t.append(this._coordinates[0]);for(var r=1;r<this._coordinates.length;r++)t.append(", "),t.append(e._coordinates[r]);return t.append(")"),t.toString()}else return"()"};ei.prototype.getY=function(e){return this._coordinates[e].y};ei.prototype.toCoordinateArray=function(){return this._coordinates};ei.prototype.interfaces_=function(){return[Br,Ca]};ei.prototype.getClass=function(){return ei};qI.serialVersionUID.get=function(){return-0xcb44a778db18e00};Object.defineProperties(ei,qI);var hu=function(){},g1={serialVersionUID:{configurable:!0},instanceObject:{configurable:!0}};hu.prototype.readResolve=function(){return hu.instance()};hu.prototype.create=function(){if(arguments.length===1){if(arguments[0]instanceof Array){var e=arguments[0];return new ei(e)}else if(rr(arguments[0],Br)){var t=arguments[0];return new ei(t)}}else if(arguments.length===2){var r=arguments[0],n=arguments[1];return n>3&&(n=3),n<2?new ei(r):new ei(r,n)}};hu.prototype.interfaces_=function(){return[Wd,Ca]};hu.prototype.getClass=function(){return hu};hu.instance=function(){return hu.instanceObject};g1.serialVersionUID.get=function(){return-0x38e49fa6cf6f2e00};g1.instanceObject.get=function(){return new hu};Object.defineProperties(hu,g1);var ZI=function(e){function t(){e.call(this),this.map_=new Map}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.get=function(r){return this.map_.get(r)||null},t.prototype.put=function(r,n){return this.map_.set(r,n),n},t.prototype.values=function(){for(var r=new me,n=this.map_.values(),i=n.next();!i.done;)r.add(i.value),i=n.next();return r},t.prototype.entrySet=function(){var r=new f1;return this.map_.entries().forEach(function(n){return r.add(n)}),r},t.prototype.size=function(){return this.map_.size()},t}(td),Wr=function e(){if(this._modelType=null,this._scale=null,arguments.length===0)this._modelType=e.FLOATING;else if(arguments.length===1){if(arguments[0]instanceof Ll){var t=arguments[0];this._modelType=t,t===e.FIXED&&this.setScale(1)}else if(typeof arguments[0]=="number"){var r=arguments[0];this._modelType=e.FIXED,this.setScale(r)}else if(arguments[0]instanceof e){var n=arguments[0];this._modelType=n._modelType,this._scale=n._scale}}},y1={serialVersionUID:{configurable:!0},maximumPreciseValue:{configurable:!0}};Wr.prototype.equals=function(e){if(!(e instanceof Wr))return!1;var t=e;return this._modelType===t._modelType&&this._scale===t._scale};Wr.prototype.compareTo=function(e){var t=e,r=this.getMaximumSignificantDigits(),n=t.getMaximumSignificantDigits();return new Ml(r).compareTo(new Ml(n))};Wr.prototype.getScale=function(){return this._scale};Wr.prototype.isFloating=function(){return this._modelType===Wr.FLOATING||this._modelType===Wr.FLOATING_SINGLE};Wr.prototype.getType=function(){return this._modelType};Wr.prototype.toString=function(){var e="UNKNOWN";return this._modelType===Wr.FLOATING?e="Floating":this._modelType===Wr.FLOATING_SINGLE?e="Floating-Single":this._modelType===Wr.FIXED&&(e="Fixed (Scale="+this.getScale()+")"),e};Wr.prototype.makePrecise=function(){if(typeof arguments[0]=="number"){var e=arguments[0];if(lr.isNaN(e))return e;if(this._modelType===Wr.FLOATING_SINGLE){var t=e;return t}return this._modelType===Wr.FIXED?Math.round(e*this._scale)/this._scale:e}else if(arguments[0]instanceof kt){var r=arguments[0];if(this._modelType===Wr.FLOATING)return null;r.x=this.makePrecise(r.x),r.y=this.makePrecise(r.y)}};Wr.prototype.getMaximumSignificantDigits=function(){var e=16;return this._modelType===Wr.FLOATING?e=16:this._modelType===Wr.FLOATING_SINGLE?e=6:this._modelType===Wr.FIXED&&(e=1+Math.trunc(Math.ceil(Math.log(this.getScale())/Math.log(10)))),e};Wr.prototype.setScale=function(e){this._scale=Math.abs(e)};Wr.prototype.interfaces_=function(){return[Ca,Ia]};Wr.prototype.getClass=function(){return Wr};Wr.mostPrecise=function(e,t){return e.compareTo(t)>=0?e:t};y1.serialVersionUID.get=function(){return 7777263578777804e3};y1.maximumPreciseValue.get=function(){return 9007199254740992};Object.defineProperties(Wr,y1);var Ll=function e(t){this._name=t||null,e.nameToTypeMap.put(t,this)},_1={serialVersionUID:{configurable:!0},nameToTypeMap:{configurable:!0}};Ll.prototype.readResolve=function(){return Ll.nameToTypeMap.get(this._name)};Ll.prototype.toString=function(){return this._name};Ll.prototype.interfaces_=function(){return[Ca]};Ll.prototype.getClass=function(){return Ll};_1.serialVersionUID.get=function(){return-552860263173159e4};_1.nameToTypeMap.get=function(){return new ZI};Object.defineProperties(Ll,_1);Wr.Type=Ll;Wr.FIXED=new Ll("FIXED");Wr.FLOATING=new Ll("FLOATING");Wr.FLOATING_SINGLE=new Ll("FLOATING SINGLE");var Er=function e(){this._precisionModel=new Wr,this._SRID=0,this._coordinateSequenceFactory=e.getDefaultCoordinateSequenceFactory(),arguments.length===0||(arguments.length===1?rr(arguments[0],Wd)?this._coordinateSequenceFactory=arguments[0]:arguments[0]instanceof Wr&&(this._precisionModel=arguments[0]):arguments.length===2?(this._precisionModel=arguments[0],this._SRID=arguments[1]):arguments.length===3&&(this._precisionModel=arguments[0],this._SRID=arguments[1],this._coordinateSequenceFactory=arguments[2]))},WI={serialVersionUID:{configurable:!0}};Er.prototype.toGeometry=function(e){return e.isNull()?this.createPoint(null):e.getMinX()===e.getMaxX()&&e.getMinY()===e.getMaxY()?this.createPoint(new kt(e.getMinX(),e.getMinY())):e.getMinX()===e.getMaxX()||e.getMinY()===e.getMaxY()?this.createLineString([new kt(e.getMinX(),e.getMinY()),new kt(e.getMaxX(),e.getMaxY())]):this.createPolygon(this.createLinearRing([new kt(e.getMinX(),e.getMinY()),new kt(e.getMinX(),e.getMaxY()),new kt(e.getMaxX(),e.getMaxY()),new kt(e.getMaxX(),e.getMinY()),new kt(e.getMinX(),e.getMinY())]),null)};Er.prototype.createLineString=function(e){if(e){if(e instanceof Array)return new Hn(this.getCoordinateSequenceFactory().create(e),this);if(rr(e,Br))return new Hn(e,this)}else return new Hn(this.getCoordinateSequenceFactory().create([]),this)};Er.prototype.createMultiLineString=function(){if(arguments.length===0)return new Hh(null,this);if(arguments.length===1){var e=arguments[0];return new Hh(e,this)}};Er.prototype.buildGeometry=function(e){for(var t=null,r=!1,n=!1,i=e.iterator();i.hasNext();){var l=i.next(),h=l.getClass();t===null&&(t=h),h!==t&&(r=!0),l.isGeometryCollectionOrDerived()&&(n=!0)}if(t===null)return this.createGeometryCollection();if(r||n)return this.createGeometryCollection(Er.toGeometryArray(e));var a=e.iterator().next(),g=e.size()>1;if(g){if(a instanceof Li)return this.createMultiPolygon(Er.toPolygonArray(e));if(a instanceof Hn)return this.createMultiLineString(Er.toLineStringArray(e));if(a instanceof Is)return this.createMultiPoint(Er.toPointArray(e));dr.shouldNeverReachHere("Unhandled class: "+a.getClass().getName())}return a};Er.prototype.createMultiPointFromCoords=function(e){return this.createMultiPoint(e!==null?this.getCoordinateSequenceFactory().create(e):null)};Er.prototype.createPoint=function(){if(arguments.length===0)return this.createPoint(this.getCoordinateSequenceFactory().create([]));if(arguments.length===1){if(arguments[0]instanceof kt){var e=arguments[0];return this.createPoint(e!==null?this.getCoordinateSequenceFactory().create([e]):null)}else if(rr(arguments[0],Br)){var t=arguments[0];return new Is(t,this)}}};Er.prototype.getCoordinateSequenceFactory=function(){return this._coordinateSequenceFactory};Er.prototype.createPolygon=function(){if(arguments.length===0)return new Li(null,null,this);if(arguments.length===1){if(rr(arguments[0],Br)){var e=arguments[0];return this.createPolygon(this.createLinearRing(e))}else if(arguments[0]instanceof Array){var t=arguments[0];return this.createPolygon(this.createLinearRing(t))}else if(arguments[0]instanceof cu){var r=arguments[0];return this.createPolygon(r,null)}}else if(arguments.length===2){var n=arguments[0],i=arguments[1];return new Li(n,i,this)}};Er.prototype.getSRID=function(){return this._SRID};Er.prototype.createGeometryCollection=function(){if(arguments.length===0)return new qo(null,this);if(arguments.length===1){var e=arguments[0];return new qo(e,this)}};Er.prototype.createGeometry=function(e){var t=new Ea(this);return t.edit(e,{edit:function(){if(arguments.length===2){var r=arguments[0];return this._coordinateSequenceFactory.create(r)}}})};Er.prototype.getPrecisionModel=function(){return this._precisionModel};Er.prototype.createLinearRing=function(){if(arguments.length===0)return this.createLinearRing(this.getCoordinateSequenceFactory().create([]));if(arguments.length===1){if(arguments[0]instanceof Array){var e=arguments[0];return this.createLinearRing(e!==null?this.getCoordinateSequenceFactory().create(e):null)}else if(rr(arguments[0],Br)){var t=arguments[0];return new cu(t,this)}}};Er.prototype.createMultiPolygon=function(){if(arguments.length===0)return new su(null,this);if(arguments.length===1){var e=arguments[0];return new su(e,this)}};Er.prototype.createMultiPoint=function(){var e=this;if(arguments.length===0)return new Qd(null,this);if(arguments.length===1){if(arguments[0]instanceof Array){var t=arguments[0];return new Qd(t,this)}else if(arguments[0]instanceof Array){var r=arguments[0];return this.createMultiPoint(r!==null?this.getCoordinateSequenceFactory().create(r):null)}else if(rr(arguments[0],Br)){var n=arguments[0];if(n===null)return this.createMultiPoint(new Array(0).fill(null));for(var i=new Array(n.size()).fill(null),l=0;l<n.size();l++){var h=e.getCoordinateSequenceFactory().create(1,n.getDimension());ii.copy(n,l,h,0,1),i[l]=e.createPoint(h)}return this.createMultiPoint(i)}}};Er.prototype.interfaces_=function(){return[Ca]};Er.prototype.getClass=function(){return Er};Er.toMultiPolygonArray=function(e){var t=new Array(e.size()).fill(null);return e.toArray(t)};Er.toGeometryArray=function(e){if(e===null)return null;var t=new Array(e.size()).fill(null);return e.toArray(t)};Er.getDefaultCoordinateSequenceFactory=function(){return hu.instance()};Er.toMultiLineStringArray=function(e){var t=new Array(e.size()).fill(null);return e.toArray(t)};Er.toLineStringArray=function(e){var t=new Array(e.size()).fill(null);return e.toArray(t)};Er.toMultiPointArray=function(e){var t=new Array(e.size()).fill(null);return e.toArray(t)};Er.toLinearRingArray=function(e){var t=new Array(e.size()).fill(null);return e.toArray(t)};Er.toPointArray=function(e){var t=new Array(e.size()).fill(null);return e.toArray(t)};Er.toPolygonArray=function(e){var t=new Array(e.size()).fill(null);return e.toArray(t)};Er.createPointFromInternalCoord=function(e,t){return t.getPrecisionModel().makePrecise(e),t.getFactory().createPoint(e)};WI.serialVersionUID.get=function(){return-6820524753094096e3};Object.defineProperties(Er,WI);var Q4=["Point","MultiPoint","LineString","MultiLineString","Polygon","MultiPolygon"],Q_=function(e){this.geometryFactory=e||new Er};Q_.prototype.read=function(e){var t;typeof e=="string"?t=JSON.parse(e):t=e;var r=t.type;if(!bl[r])throw new Error("Unknown GeoJSON type: "+t.type);return Q4.indexOf(r)!==-1?bl[r].apply(this,[t.coordinates]):r==="GeometryCollection"?bl[r].apply(this,[t.geometries]):bl[r].apply(this,[t])};Q_.prototype.write=function(e){var t=e.getGeometryType();if(!Ou[t])throw new Error("Geometry is not supported");return Ou[t].apply(this,[e])};var bl={Feature:function(e){var t={};for(var r in e)t[r]=e[r];if(e.geometry){var n=e.geometry.type;if(!bl[n])throw new Error("Unknown GeoJSON type: "+e.type);t.geometry=this.read(e.geometry)}return e.bbox&&(t.bbox=bl.bbox.apply(this,[e.bbox])),t},FeatureCollection:function(e){var t=this,r={};if(e.features){r.features=[];for(var n=0;n<e.features.length;++n)r.features.push(t.read(e.features[n]))}return e.bbox&&(r.bbox=this.parse.bbox.apply(this,[e.bbox])),r},coordinates:function(e){for(var t=[],r=0;r<e.length;++r){var n=e[r];t.push(new kt(n[0],n[1]))}return t},bbox:function(e){return this.geometryFactory.createLinearRing([new kt(e[0],e[1]),new kt(e[2],e[1]),new kt(e[2],e[3]),new kt(e[0],e[3]),new kt(e[0],e[1])])},Point:function(e){var t=new kt(e[0],e[1]);return this.geometryFactory.createPoint(t)},MultiPoint:function(e){for(var t=this,r=[],n=0;n<e.length;++n)r.push(bl.Point.apply(t,[e[n]]));return this.geometryFactory.createMultiPoint(r)},LineString:function(e){var t=bl.coordinates.apply(this,[e]);return this.geometryFactory.createLineString(t)},MultiLineString:function(e){for(var t=this,r=[],n=0;n<e.length;++n)r.push(bl.LineString.apply(t,[e[n]]));return this.geometryFactory.createMultiLineString(r)},Polygon:function(e){for(var t=this,r=bl.coordinates.apply(this,[e[0]]),n=this.geometryFactory.createLinearRing(r),i=[],l=1;l<e.length;++l){var h=e[l],a=bl.coordinates.apply(t,[h]),g=t.geometryFactory.createLinearRing(a);i.push(g)}return this.geometryFactory.createPolygon(n,i)},MultiPolygon:function(e){for(var t=this,r=[],n=0;n<e.length;++n){var i=e[n];r.push(bl.Polygon.apply(t,[i]))}return this.geometryFactory.createMultiPolygon(r)},GeometryCollection:function(e){for(var t=this,r=[],n=0;n<e.length;++n){var i=e[n];r.push(t.read(i))}return this.geometryFactory.createGeometryCollection(r)}},Ou={coordinate:function(e){return[e.x,e.y]},Point:function(e){var t=Ou.coordinate.apply(this,[e.getCoordinate()]);return{type:"Point",coordinates:t}},MultiPoint:function(e){for(var t=this,r=[],n=0;n<e._geometries.length;++n){var i=e._geometries[n],l=Ou.Point.apply(t,[i]);r.push(l.coordinates)}return{type:"MultiPoint",coordinates:r}},LineString:function(e){for(var t=this,r=[],n=e.getCoordinates(),i=0;i<n.length;++i){var l=n[i];r.push(Ou.coordinate.apply(t,[l]))}return{type:"LineString",coordinates:r}},MultiLineString:function(e){for(var t=this,r=[],n=0;n<e._geometries.length;++n){var i=e._geometries[n],l=Ou.LineString.apply(t,[i]);r.push(l.coordinates)}return{type:"MultiLineString",coordinates:r}},Polygon:function(e){var t=this,r=[],n=Ou.LineString.apply(this,[e._shell]);r.push(n.coordinates);for(var i=0;i<e._holes.length;++i){var l=e._holes[i],h=Ou.LineString.apply(t,[l]);r.push(h.coordinates)}return{type:"Polygon",coordinates:r}},MultiPolygon:function(e){for(var t=this,r=[],n=0;n<e._geometries.length;++n){var i=e._geometries[n],l=Ou.Polygon.apply(t,[i]);r.push(l.coordinates)}return{type:"MultiPolygon",coordinates:r}},GeometryCollection:function(e){for(var t=this,r=[],n=0;n<e._geometries.length;++n){var i=e._geometries[n],l=i.getGeometryType();r.push(Ou[l].apply(t,[i]))}return{type:"GeometryCollection",geometries:r}}},v1=function(e){this.geometryFactory=e||new Er,this.precisionModel=this.geometryFactory.getPrecisionModel(),this.parser=new Q_(this.geometryFactory)};v1.prototype.read=function(e){var t=this.parser.read(e);return this.precisionModel.getType()===Wr.FIXED&&this.reducePrecision(t),t};v1.prototype.reducePrecision=function(e){var t=this,r,n;if(e.coordinate)this.precisionModel.makePrecise(e.coordinate);else if(e.points)for(r=0,n=e.points.length;r<n;r++)t.precisionModel.makePrecise(e.points[r]);else if(e.geometries)for(r=0,n=e.geometries.length;r<n;r++)t.reducePrecision(e.geometries[r])};var XI=function(){this.parser=new Q_(this.geometryFactory)};XI.prototype.write=function(e){return this.parser.write(e)};var se=function(){},t0={ON:{configurable:!0},LEFT:{configurable:!0},RIGHT:{configurable:!0}};se.prototype.interfaces_=function(){return[]};se.prototype.getClass=function(){return se};se.opposite=function(e){return e===se.LEFT?se.RIGHT:e===se.RIGHT?se.LEFT:e};t0.ON.get=function(){return 0};t0.LEFT.get=function(){return 1};t0.RIGHT.get=function(){return 2};Object.defineProperties(se,t0);function e0(e){this.message=e||""}e0.prototype=new Error;e0.prototype.name="EmptyStackException";function Bl(){this.array_=[]}Bl.prototype=new Ua;Bl.prototype.add=function(e){return this.array_.push(e),!0};Bl.prototype.get=function(e){if(e<0||e>=this.size())throw new Error;return this.array_[e]};Bl.prototype.push=function(e){return this.array_.push(e),e};Bl.prototype.pop=function(e){if(this.array_.length===0)throw new e0;return this.array_.pop()};Bl.prototype.peek=function(){if(this.array_.length===0)throw new e0;return this.array_[this.array_.length-1]};Bl.prototype.empty=function(){return this.array_.length===0};Bl.prototype.isEmpty=function(){return this.empty()};Bl.prototype.search=function(e){return this.array_.indexOf(e)};Bl.prototype.size=function(){return this.array_.length};Bl.prototype.toArray=function(){for(var e=this,t=[],r=0,n=this.array_.length;r<n;r++)t.push(e.array_[r]);return t};var Rl=function(){this._minIndex=-1,this._minCoord=null,this._minDe=null,this._orientedDe=null};Rl.prototype.getCoordinate=function(){return this._minCoord};Rl.prototype.getRightmostSide=function(e,t){var r=this.getRightmostSideOfSegment(e,t);return r<0&&(r=this.getRightmostSideOfSegment(e,t-1)),r<0&&(this._minCoord=null,this.checkForRightmostCoordinate(e)),r};Rl.prototype.findRightmostEdgeAtVertex=function(){var e=this._minDe.getEdge().getCoordinates();dr.isTrue(this._minIndex>0&&this._minIndex<e.length,"rightmost point expected to be interior vertex of edge");var t=e[this._minIndex-1],r=e[this._minIndex+1],n=Ie.computeOrientation(this._minCoord,r,t),i=!1;(t.y<this._minCoord.y&&r.y<this._minCoord.y&&n===Ie.COUNTERCLOCKWISE||t.y>this._minCoord.y&&r.y>this._minCoord.y&&n===Ie.CLOCKWISE)&&(i=!0),i&&(this._minIndex=this._minIndex-1)};Rl.prototype.getRightmostSideOfSegment=function(e,t){var r=e.getEdge(),n=r.getCoordinates();if(t<0||t+1>=n.length||n[t].y===n[t+1].y)return-1;var i=se.LEFT;return n[t].y<n[t+1].y&&(i=se.RIGHT),i};Rl.prototype.getEdge=function(){return this._orientedDe};Rl.prototype.checkForRightmostCoordinate=function(e){for(var t=this,r=e.getEdge().getCoordinates(),n=0;n<r.length-1;n++)(t._minCoord===null||r[n].x>t._minCoord.x)&&(t._minDe=e,t._minIndex=n,t._minCoord=r[n])};Rl.prototype.findRightmostEdgeAtNode=function(){var e=this._minDe.getNode(),t=e.getEdges();this._minDe=t.getRightmostEdge(),this._minDe.isForward()||(this._minDe=this._minDe.getSym(),this._minIndex=this._minDe.getEdge().getCoordinates().length-1)};Rl.prototype.findEdge=function(e){for(var t=this,r=e.iterator();r.hasNext();){var n=r.next();n.isForward()&&t.checkForRightmostCoordinate(n)}dr.isTrue(this._minIndex!==0||this._minCoord.equals(this._minDe.getCoordinate()),"inconsistency in rightmost processing"),this._minIndex===0?this.findRightmostEdgeAtNode():this.findRightmostEdgeAtVertex(),this._orientedDe=this._minDe;var i=this.getRightmostSide(this._minDe,this._minIndex);i===se.LEFT&&(this._orientedDe=this._minDe.getSym())};Rl.prototype.interfaces_=function(){return[]};Rl.prototype.getClass=function(){return Rl};var qu=function(e){function t(r,n){e.call(this,t.msgWithCoord(r,n)),this.pt=n?new kt(n):null,this.name="TopologyException"}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.getCoordinate=function(){return this.pt},t.prototype.interfaces_=function(){return[]},t.prototype.getClass=function(){return t},t.msgWithCoord=function(r,n){return n?r:r+" [ "+n+" ]"},t}(Vu),r0=function(){this.array_=[]};r0.prototype.addLast=function(e){this.array_.push(e)};r0.prototype.removeFirst=function(){return this.array_.shift()};r0.prototype.isEmpty=function(){return this.array_.length===0};var Zo=function(){this._finder=null,this._dirEdgeList=new me,this._nodes=new me,this._rightMostCoord=null,this._env=null,this._finder=new Rl};Zo.prototype.clearVisitedEdges=function(){for(var e=this._dirEdgeList.iterator();e.hasNext();){var t=e.next();t.setVisited(!1)}};Zo.prototype.getRightmostCoordinate=function(){return this._rightMostCoord};Zo.prototype.computeNodeDepth=function(e){for(var t=this,r=null,n=e.getEdges().iterator();n.hasNext();){var i=n.next();if(i.isVisited()||i.getSym().isVisited()){r=i;break}}if(r===null)throw new qu("unable to find edge to compute depths at "+e.getCoordinate());e.getEdges().computeDepths(r);for(var l=e.getEdges().iterator();l.hasNext();){var h=l.next();h.setVisited(!0),t.copySymDepths(h)}};Zo.prototype.computeDepth=function(e){this.clearVisitedEdges();var t=this._finder.getEdge();t.setEdgeDepths(se.RIGHT,e),this.copySymDepths(t),this.computeDepths(t)};Zo.prototype.create=function(e){this.addReachable(e),this._finder.findEdge(this._dirEdgeList),this._rightMostCoord=this._finder.getCoordinate()};Zo.prototype.findResultEdges=function(){for(var e=this._dirEdgeList.iterator();e.hasNext();){var t=e.next();t.getDepth(se.RIGHT)>=1&&t.getDepth(se.LEFT)<=0&&!t.isInteriorAreaEdge()&&t.setInResult(!0)}};Zo.prototype.computeDepths=function(e){var t=this,r=new f1,n=new r0,i=e.getNode();for(n.addLast(i),r.add(i),e.setVisited(!0);!n.isEmpty();){var l=n.removeFirst();r.add(l),t.computeNodeDepth(l);for(var h=l.getEdges().iterator();h.hasNext();){var a=h.next(),g=a.getSym();if(!g.isVisited()){var _=g.getNode();r.contains(_)||(n.addLast(_),r.add(_))}}}};Zo.prototype.compareTo=function(e){var t=e;return this._rightMostCoord.x<t._rightMostCoord.x?-1:this._rightMostCoord.x>t._rightMostCoord.x?1:0};Zo.prototype.getEnvelope=function(){if(this._env===null){for(var e=new Ve,t=this._dirEdgeList.iterator();t.hasNext();)for(var r=t.next(),n=r.getEdge().getCoordinates(),i=0;i<n.length-1;i++)e.expandToInclude(n[i]);this._env=e}return this._env};Zo.prototype.addReachable=function(e){var t=this,r=new Bl;for(r.add(e);!r.empty();){var n=r.pop();t.add(n,r)}};Zo.prototype.copySymDepths=function(e){var t=e.getSym();t.setDepth(se.LEFT,e.getDepth(se.RIGHT)),t.setDepth(se.RIGHT,e.getDepth(se.LEFT))};Zo.prototype.add=function(e,t){var r=this;e.setVisited(!0),this._nodes.add(e);for(var n=e.getEdges().iterator();n.hasNext();){var i=n.next();r._dirEdgeList.add(i);var l=i.getSym(),h=l.getNode();h.isVisited()||t.push(h)}};Zo.prototype.getNodes=function(){return this._nodes};Zo.prototype.getDirectedEdges=function(){return this._dirEdgeList};Zo.prototype.interfaces_=function(){return[Ia]};Zo.prototype.getClass=function(){return Zo};var xn=function e(){var t=this;if(this.location=null,arguments.length===1){if(arguments[0]instanceof Array){var r=arguments[0];this.init(r.length)}else if(Number.isInteger(arguments[0])){var n=arguments[0];this.init(1),this.location[se.ON]=n}else if(arguments[0]instanceof e){var i=arguments[0];if(this.init(i.location.length),i!==null)for(var l=0;l<this.location.length;l++)t.location[l]=i.location[l]}}else if(arguments.length===3){var h=arguments[0],a=arguments[1],g=arguments[2];this.init(3),this.location[se.ON]=h,this.location[se.LEFT]=a,this.location[se.RIGHT]=g}};xn.prototype.setAllLocations=function(e){for(var t=this,r=0;r<this.location.length;r++)t.location[r]=e};xn.prototype.isNull=function(){for(var e=this,t=0;t<this.location.length;t++)if(e.location[t]!==Bt.NONE)return!1;return!0};xn.prototype.setAllLocationsIfNull=function(e){for(var t=this,r=0;r<this.location.length;r++)t.location[r]===Bt.NONE&&(t.location[r]=e)};xn.prototype.isLine=function(){return this.location.length===1};xn.prototype.merge=function(e){var t=this;if(e.location.length>this.location.length){var r=new Array(3).fill(null);r[se.ON]=this.location[se.ON],r[se.LEFT]=Bt.NONE,r[se.RIGHT]=Bt.NONE,this.location=r}for(var n=0;n<this.location.length;n++)t.location[n]===Bt.NONE&&n<e.location.length&&(t.location[n]=e.location[n])};xn.prototype.getLocations=function(){return this.location};xn.prototype.flip=function(){if(this.location.length<=1)return null;var e=this.location[se.LEFT];this.location[se.LEFT]=this.location[se.RIGHT],this.location[se.RIGHT]=e};xn.prototype.toString=function(){var e=new zl;return this.location.length>1&&e.append(Bt.toLocationSymbol(this.location[se.LEFT])),e.append(Bt.toLocationSymbol(this.location[se.ON])),this.location.length>1&&e.append(Bt.toLocationSymbol(this.location[se.RIGHT])),e.toString()};xn.prototype.setLocations=function(e,t,r){this.location[se.ON]=e,this.location[se.LEFT]=t,this.location[se.RIGHT]=r};xn.prototype.get=function(e){return e<this.location.length?this.location[e]:Bt.NONE};xn.prototype.isArea=function(){return this.location.length>1};xn.prototype.isAnyNull=function(){for(var e=this,t=0;t<this.location.length;t++)if(e.location[t]===Bt.NONE)return!0;return!1};xn.prototype.setLocation=function(){if(arguments.length===1){var e=arguments[0];this.setLocation(se.ON,e)}else if(arguments.length===2){var t=arguments[0],r=arguments[1];this.location[t]=r}};xn.prototype.init=function(e){this.location=new Array(e).fill(null),this.setAllLocations(Bt.NONE)};xn.prototype.isEqualOnSide=function(e,t){return this.location[t]===e.location[t]};xn.prototype.allPositionsEqual=function(e){for(var t=this,r=0;r<this.location.length;r++)if(t.location[r]!==e)return!1;return!0};xn.prototype.interfaces_=function(){return[]};xn.prototype.getClass=function(){return xn};var an=function e(){if(this.elt=new Array(2).fill(null),arguments.length===1){if(Number.isInteger(arguments[0])){var t=arguments[0];this.elt[0]=new xn(t),this.elt[1]=new xn(t)}else if(arguments[0]instanceof e){var r=arguments[0];this.elt[0]=new xn(r.elt[0]),this.elt[1]=new xn(r.elt[1])}}else if(arguments.length===2){var n=arguments[0],i=arguments[1];this.elt[0]=new xn(Bt.NONE),this.elt[1]=new xn(Bt.NONE),this.elt[n].setLocation(i)}else if(arguments.length===3){var l=arguments[0],h=arguments[1],a=arguments[2];this.elt[0]=new xn(l,h,a),this.elt[1]=new xn(l,h,a)}else if(arguments.length===4){var g=arguments[0],_=arguments[1],E=arguments[2],S=arguments[3];this.elt[0]=new xn(Bt.NONE,Bt.NONE,Bt.NONE),this.elt[1]=new xn(Bt.NONE,Bt.NONE,Bt.NONE),this.elt[g].setLocations(_,E,S)}};an.prototype.getGeometryCount=function(){var e=0;return this.elt[0].isNull()||e++,this.elt[1].isNull()||e++,e};an.prototype.setAllLocations=function(e,t){this.elt[e].setAllLocations(t)};an.prototype.isNull=function(e){return this.elt[e].isNull()};an.prototype.setAllLocationsIfNull=function(){if(arguments.length===1){var e=arguments[0];this.setAllLocationsIfNull(0,e),this.setAllLocationsIfNull(1,e)}else if(arguments.length===2){var t=arguments[0],r=arguments[1];this.elt[t].setAllLocationsIfNull(r)}};an.prototype.isLine=function(e){return this.elt[e].isLine()};an.prototype.merge=function(e){for(var t=this,r=0;r<2;r++)t.elt[r]===null&&e.elt[r]!==null?t.elt[r]=new xn(e.elt[r]):t.elt[r].merge(e.elt[r])};an.prototype.flip=function(){this.elt[0].flip(),this.elt[1].flip()};an.prototype.getLocation=function(){if(arguments.length===1){var e=arguments[0];return this.elt[e].get(se.ON)}else if(arguments.length===2){var t=arguments[0],r=arguments[1];return this.elt[t].get(r)}};an.prototype.toString=function(){var e=new zl;return this.elt[0]!==null&&(e.append("A:"),e.append(this.elt[0].toString())),this.elt[1]!==null&&(e.append(" B:"),e.append(this.elt[1].toString())),e.toString()};an.prototype.isArea=function(){if(arguments.length===0)return this.elt[0].isArea()||this.elt[1].isArea();if(arguments.length===1){var e=arguments[0];return this.elt[e].isArea()}};an.prototype.isAnyNull=function(e){return this.elt[e].isAnyNull()};an.prototype.setLocation=function(){if(arguments.length===2){var e=arguments[0],t=arguments[1];this.elt[e].setLocation(se.ON,t)}else if(arguments.length===3){var r=arguments[0],n=arguments[1],i=arguments[2];this.elt[r].setLocation(n,i)}};an.prototype.isEqualOnSide=function(e,t){return this.elt[0].isEqualOnSide(e.elt[0],t)&&this.elt[1].isEqualOnSide(e.elt[1],t)};an.prototype.allPositionsEqual=function(e,t){return this.elt[e].allPositionsEqual(t)};an.prototype.toLine=function(e){this.elt[e].isArea()&&(this.elt[e]=new xn(this.elt[e].location[0]))};an.prototype.interfaces_=function(){return[]};an.prototype.getClass=function(){return an};an.toLineLabel=function(e){for(var t=new an(Bt.NONE),r=0;r<2;r++)t.setLocation(r,e.getLocation(r));return t};var yi=function(){this._startDe=null,this._maxNodeDegree=-1,this._edges=new me,this._pts=new me,this._label=new an(Bt.NONE),this._ring=null,this._isHole=null,this._shell=null,this._holes=new me,this._geometryFactory=null;var e=arguments[0],t=arguments[1];this._geometryFactory=t,this.computePoints(e),this.computeRing()};yi.prototype.computeRing=function(){var e=this;if(this._ring!==null)return null;for(var t=new Array(this._pts.size()).fill(null),r=0;r<this._pts.size();r++)t[r]=e._pts.get(r);this._ring=this._geometryFactory.createLinearRing(t),this._isHole=Ie.isCCW(this._ring.getCoordinates())};yi.prototype.isIsolated=function(){return this._label.getGeometryCount()===1};yi.prototype.computePoints=function(e){var t=this;this._startDe=e;var r=e,n=!0;do{if(r===null)throw new qu("Found null DirectedEdge");if(r.getEdgeRing()===t)throw new qu("Directed Edge visited twice during ring-building at "+r.getCoordinate());t._edges.add(r);var i=r.getLabel();dr.isTrue(i.isArea()),t.mergeLabel(i),t.addPoints(r.getEdge(),r.isForward(),n),n=!1,t.setEdgeRing(r,t),r=t.getNext(r)}while(r!==this._startDe)};yi.prototype.getLinearRing=function(){return this._ring};yi.prototype.getCoordinate=function(e){return this._pts.get(e)};yi.prototype.computeMaxNodeDegree=function(){var e=this;this._maxNodeDegree=0;var t=this._startDe;do{var r=t.getNode(),n=r.getEdges().getOutgoingDegree(e);n>e._maxNodeDegree&&(e._maxNodeDegree=n),t=e.getNext(t)}while(t!==this._startDe);this._maxNodeDegree*=2};yi.prototype.addPoints=function(e,t,r){var n=this,i=e.getCoordinates();if(t){var l=1;r&&(l=0);for(var h=l;h<i.length;h++)n._pts.add(i[h])}else{var a=i.length-2;r&&(a=i.length-1);for(var g=a;g>=0;g--)n._pts.add(i[g])}};yi.prototype.isHole=function(){return this._isHole};yi.prototype.setInResult=function(){var e=this._startDe;do e.getEdge().setInResult(!0),e=e.getNext();while(e!==this._startDe)};yi.prototype.containsPoint=function(e){var t=this.getLinearRing(),r=t.getEnvelopeInternal();if(!r.contains(e)||!Ie.isPointInRing(e,t.getCoordinates()))return!1;for(var n=this._holes.iterator();n.hasNext();){var i=n.next();if(i.containsPoint(e))return!1}return!0};yi.prototype.addHole=function(e){this._holes.add(e)};yi.prototype.isShell=function(){return this._shell===null};yi.prototype.getLabel=function(){return this._label};yi.prototype.getEdges=function(){return this._edges};yi.prototype.getMaxNodeDegree=function(){return this._maxNodeDegree<0&&this.computeMaxNodeDegree(),this._maxNodeDegree};yi.prototype.getShell=function(){return this._shell};yi.prototype.mergeLabel=function(){if(arguments.length===1){var e=arguments[0];this.mergeLabel(e,0),this.mergeLabel(e,1)}else if(arguments.length===2){var t=arguments[0],r=arguments[1],n=t.getLocation(r,se.RIGHT);if(n===Bt.NONE)return null;if(this._label.getLocation(r)===Bt.NONE)return this._label.setLocation(r,n),null}};yi.prototype.setShell=function(e){this._shell=e,e!==null&&e.addHole(this)};yi.prototype.toPolygon=function(e){for(var t=this,r=new Array(this._holes.size()).fill(null),n=0;n<this._holes.size();n++)r[n]=t._holes.get(n).getLinearRing();var i=e.createPolygon(this.getLinearRing(),r);return i};yi.prototype.interfaces_=function(){return[]};yi.prototype.getClass=function(){return yi};var t5=function(e){function t(){var r=arguments[0],n=arguments[1];e.call(this,r,n)}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.setEdgeRing=function(r,n){r.setMinEdgeRing(n)},t.prototype.getNext=function(r){return r.getNextMin()},t.prototype.interfaces_=function(){return[]},t.prototype.getClass=function(){return t},t}(yi),e5=function(e){function t(){var r=arguments[0],n=arguments[1];e.call(this,r,n)}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.buildMinimalRings=function(){var r=this,n=new me,i=this._startDe;do{if(i.getMinEdgeRing()===null){var l=new t5(i,r._geometryFactory);n.add(l)}i=i.getNext()}while(i!==this._startDe);return n},t.prototype.setEdgeRing=function(r,n){r.setEdgeRing(n)},t.prototype.linkDirectedEdgesForMinimalEdgeRings=function(){var r=this,n=this._startDe;do{var i=n.getNode();i.getEdges().linkMinimalDirectedEdges(r),n=n.getNext()}while(n!==this._startDe)},t.prototype.getNext=function(r){return r.getNext()},t.prototype.interfaces_=function(){return[]},t.prototype.getClass=function(){return t},t}(yi),Qs=function(){if(this._label=null,this._isInResult=!1,this._isCovered=!1,this._isCoveredSet=!1,this._isVisited=!1,arguments.length!==0&&arguments.length===1){var e=arguments[0];this._label=e}};Qs.prototype.setVisited=function(e){this._isVisited=e};Qs.prototype.setInResult=function(e){this._isInResult=e};Qs.prototype.isCovered=function(){return this._isCovered};Qs.prototype.isCoveredSet=function(){return this._isCoveredSet};Qs.prototype.setLabel=function(e){this._label=e};Qs.prototype.getLabel=function(){return this._label};Qs.prototype.setCovered=function(e){this._isCovered=e,this._isCoveredSet=!0};Qs.prototype.updateIM=function(e){dr.isTrue(this._label.getGeometryCount()>=2,"found partial label"),this.computeIM(e)};Qs.prototype.isInResult=function(){return this._isInResult};Qs.prototype.isVisited=function(){return this._isVisited};Qs.prototype.interfaces_=function(){return[]};Qs.prototype.getClass=function(){return Qs};var n0=function(e){function t(){e.call(this),this._coord=null,this._edges=null;var r=arguments[0],n=arguments[1];this._coord=r,this._edges=n,this._label=new an(0,Bt.NONE)}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.isIncidentEdgeInResult=function(){for(var r=this.getEdges().getEdges().iterator();r.hasNext();){var n=r.next();if(n.getEdge().isInResult())return!0}return!1},t.prototype.isIsolated=function(){return this._label.getGeometryCount()===1},t.prototype.getCoordinate=function(){return this._coord},t.prototype.print=function(r){r.println("node "+this._coord+" lbl: "+this._label)},t.prototype.computeIM=function(r){},t.prototype.computeMergedLocation=function(r,n){var i=Bt.NONE;if(i=this._label.getLocation(n),!r.isNull(n)){var l=r.getLocation(n);i!==Bt.BOUNDARY&&(i=l)}return i},t.prototype.setLabel=function(){if(arguments.length===2){var r=arguments[0],n=arguments[1];this._label===null?this._label=new an(r,n):this._label.setLocation(r,n)}else return e.prototype.setLabel.apply(this,arguments)},t.prototype.getEdges=function(){return this._edges},t.prototype.mergeLabel=function(){var r=this;if(arguments[0]instanceof t){var n=arguments[0];this.mergeLabel(n._label)}else if(arguments[0]instanceof an)for(var i=arguments[0],l=0;l<2;l++){var h=r.computeMergedLocation(i,l),a=r._label.getLocation(l);a===Bt.NONE&&r._label.setLocation(l,h)}},t.prototype.add=function(r){this._edges.insert(r),r.setNode(this)},t.prototype.setLabelBoundary=function(r){if(this._label===null)return null;var n=Bt.NONE;this._label!==null&&(n=this._label.getLocation(r));var i=null;switch(n){case Bt.BOUNDARY:i=Bt.INTERIOR;break;case Bt.INTERIOR:i=Bt.BOUNDARY;break;default:i=Bt.BOUNDARY;break}this._label.setLocation(r,i)},t.prototype.interfaces_=function(){return[]},t.prototype.getClass=function(){return t},t}(Qs),Dl=function(){this.nodeMap=new Eo,this.nodeFact=null;var e=arguments[0];this.nodeFact=e};Dl.prototype.find=function(e){return this.nodeMap.get(e)};Dl.prototype.addNode=function(){if(arguments[0]instanceof kt){var e=arguments[0],t=this.nodeMap.get(e);return t===null&&(t=this.nodeFact.createNode(e),this.nodeMap.put(e,t)),t}else if(arguments[0]instanceof n0){var r=arguments[0],n=this.nodeMap.get(r.getCoordinate());return n===null?(this.nodeMap.put(r.getCoordinate(),r),r):(n.mergeLabel(r),n)}};Dl.prototype.print=function(e){for(var t=this.iterator();t.hasNext();){var r=t.next();r.print(e)}};Dl.prototype.iterator=function(){return this.nodeMap.values().iterator()};Dl.prototype.values=function(){return this.nodeMap.values()};Dl.prototype.getBoundaryNodes=function(e){for(var t=new me,r=this.iterator();r.hasNext();){var n=r.next();n.getLabel().getLocation(e)===Bt.BOUNDARY&&t.add(n)}return t};Dl.prototype.add=function(e){var t=e.getCoordinate(),r=this.addNode(t);r.add(e)};Dl.prototype.interfaces_=function(){return[]};Dl.prototype.getClass=function(){return Dl};var cn=function(){},Ig={NE:{configurable:!0},NW:{configurable:!0},SW:{configurable:!0},SE:{configurable:!0}};cn.prototype.interfaces_=function(){return[]};cn.prototype.getClass=function(){return cn};cn.isNorthern=function(e){return e===cn.NE||e===cn.NW};cn.isOpposite=function(e,t){if(e===t)return!1;var r=(e-t+4)%4;return r===2};cn.commonHalfPlane=function(e,t){if(e===t)return e;var r=(e-t+4)%4;if(r===2)return-1;var n=e<t?e:t,i=e>t?e:t;return n===0&&i===3?3:n};cn.isInHalfPlane=function(e,t){return t===cn.SE?e===cn.SE||e===cn.SW:e===t||e===t+1};cn.quadrant=function(){if(typeof arguments[0]=="number"&&typeof arguments[1]=="number"){var e=arguments[0],t=arguments[1];if(e===0&&t===0)throw new $n("Cannot compute the quadrant for point ( "+e+", "+t+" )");return e>=0?t>=0?cn.NE:cn.SE:t>=0?cn.NW:cn.SW}else if(arguments[0]instanceof kt&&arguments[1]instanceof kt){var r=arguments[0],n=arguments[1];if(n.x===r.x&&n.y===r.y)throw new $n("Cannot compute the quadrant for two identical points "+r);return n.x>=r.x?n.y>=r.y?cn.NE:cn.SE:n.y>=r.y?cn.NW:cn.SW}};Ig.NE.get=function(){return 0};Ig.NW.get=function(){return 1};Ig.SW.get=function(){return 2};Ig.SE.get=function(){return 3};Object.defineProperties(cn,Ig);var So=function(){if(this._edge=null,this._label=null,this._node=null,this._p0=null,this._p1=null,this._dx=null,this._dy=null,this._quadrant=null,arguments.length===1){var e=arguments[0];this._edge=e}else if(arguments.length===3){var t=arguments[0],r=arguments[1],n=arguments[2],i=null;this._edge=t,this.init(r,n),this._label=i}else if(arguments.length===4){var l=arguments[0],h=arguments[1],a=arguments[2],g=arguments[3];this._edge=l,this.init(h,a),this._label=g}};So.prototype.compareDirection=function(e){return this._dx===e._dx&&this._dy===e._dy?0:this._quadrant>e._quadrant?1:this._quadrant<e._quadrant?-1:Ie.computeOrientation(e._p0,e._p1,this._p1)};So.prototype.getDy=function(){return this._dy};So.prototype.getCoordinate=function(){return this._p0};So.prototype.setNode=function(e){this._node=e};So.prototype.print=function(e){var t=Math.atan2(this._dy,this._dx),r=this.getClass().getName(),n=r.lastIndexOf("."),i=r.substring(n+1);e.print("  "+i+": "+this._p0+" - "+this._p1+" "+this._quadrant+":"+t+"   "+this._label)};So.prototype.compareTo=function(e){var t=e;return this.compareDirection(t)};So.prototype.getDirectedCoordinate=function(){return this._p1};So.prototype.getDx=function(){return this._dx};So.prototype.getLabel=function(){return this._label};So.prototype.getEdge=function(){return this._edge};So.prototype.getQuadrant=function(){return this._quadrant};So.prototype.getNode=function(){return this._node};So.prototype.toString=function(){var e=Math.atan2(this._dy,this._dx),t=this.getClass().getName(),r=t.lastIndexOf("."),n=t.substring(r+1);return"  "+n+": "+this._p0+" - "+this._p1+" "+this._quadrant+":"+e+"   "+this._label};So.prototype.computeLabel=function(e){};So.prototype.init=function(e,t){this._p0=e,this._p1=t,this._dx=t.x-e.x,this._dy=t.y-e.y,this._quadrant=cn.quadrant(this._dx,this._dy),dr.isTrue(!(this._dx===0&&this._dy===0),"EdgeEnd with identical endpoints found")};So.prototype.interfaces_=function(){return[Ia]};So.prototype.getClass=function(){return So};var cx=function(e){function t(){var r=arguments[0],n=arguments[1];if(e.call(this,r),this._isForward=null,this._isInResult=!1,this._isVisited=!1,this._sym=null,this._next=null,this._nextMin=null,this._edgeRing=null,this._minEdgeRing=null,this._depth=[0,-999,-999],this._isForward=n,n)this.init(r.getCoordinate(0),r.getCoordinate(1));else{var i=r.getNumPoints()-1;this.init(r.getCoordinate(i),r.getCoordinate(i-1))}this.computeDirectedLabel()}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.getNextMin=function(){return this._nextMin},t.prototype.getDepth=function(r){return this._depth[r]},t.prototype.setVisited=function(r){this._isVisited=r},t.prototype.computeDirectedLabel=function(){this._label=new an(this._edge.getLabel()),this._isForward||this._label.flip()},t.prototype.getNext=function(){return this._next},t.prototype.setDepth=function(r,n){if(this._depth[r]!==-999&&this._depth[r]!==n)throw new qu("assigned depths do not match",this.getCoordinate());this._depth[r]=n},t.prototype.isInteriorAreaEdge=function(){for(var r=this,n=!0,i=0;i<2;i++)r._label.isArea(i)&&r._label.getLocation(i,se.LEFT)===Bt.INTERIOR&&r._label.getLocation(i,se.RIGHT)===Bt.INTERIOR||(n=!1);return n},t.prototype.setNextMin=function(r){this._nextMin=r},t.prototype.print=function(r){e.prototype.print.call(this,r),r.print(" "+this._depth[se.LEFT]+"/"+this._depth[se.RIGHT]),r.print(" ("+this.getDepthDelta()+")"),this._isInResult&&r.print(" inResult")},t.prototype.setMinEdgeRing=function(r){this._minEdgeRing=r},t.prototype.isLineEdge=function(){var r=this._label.isLine(0)||this._label.isLine(1),n=!this._label.isArea(0)||this._label.allPositionsEqual(0,Bt.EXTERIOR),i=!this._label.isArea(1)||this._label.allPositionsEqual(1,Bt.EXTERIOR);return r&&n&&i},t.prototype.setEdgeRing=function(r){this._edgeRing=r},t.prototype.getMinEdgeRing=function(){return this._minEdgeRing},t.prototype.getDepthDelta=function(){var r=this._edge.getDepthDelta();return this._isForward||(r=-r),r},t.prototype.setInResult=function(r){this._isInResult=r},t.prototype.getSym=function(){return this._sym},t.prototype.isForward=function(){return this._isForward},t.prototype.getEdge=function(){return this._edge},t.prototype.printEdge=function(r){this.print(r),r.print(" "),this._isForward?this._edge.print(r):this._edge.printReverse(r)},t.prototype.setSym=function(r){this._sym=r},t.prototype.setVisitedEdge=function(r){this.setVisited(r),this._sym.setVisited(r)},t.prototype.setEdgeDepths=function(r,n){var i=this.getEdge().getDepthDelta();this._isForward||(i=-i);var l=1;r===se.LEFT&&(l=-1);var h=se.opposite(r),a=i*l,g=n+a;this.setDepth(r,n),this.setDepth(h,g)},t.prototype.getEdgeRing=function(){return this._edgeRing},t.prototype.isInResult=function(){return this._isInResult},t.prototype.setNext=function(r){this._next=r},t.prototype.isVisited=function(){return this._isVisited},t.prototype.interfaces_=function(){return[]},t.prototype.getClass=function(){return t},t.depthFactor=function(r,n){return r===Bt.EXTERIOR&&n===Bt.INTERIOR?1:r===Bt.INTERIOR&&n===Bt.EXTERIOR?-1:0},t}(So),tf=function(){};tf.prototype.createNode=function(e){return new n0(e,null)};tf.prototype.interfaces_=function(){return[]};tf.prototype.getClass=function(){return tf};var qn=function(){if(this._edges=new me,this._nodes=null,this._edgeEndList=new me,arguments.length===0)this._nodes=new Dl(new tf);else if(arguments.length===1){var e=arguments[0];this._nodes=new Dl(e)}};qn.prototype.printEdges=function(e){var t=this;e.println("Edges:");for(var r=0;r<this._edges.size();r++){e.println("edge "+r+":");var n=t._edges.get(r);n.print(e),n.eiList.print(e)}};qn.prototype.find=function(e){return this._nodes.find(e)};qn.prototype.addNode=function(){if(arguments[0]instanceof n0){var e=arguments[0];return this._nodes.addNode(e)}else if(arguments[0]instanceof kt){var t=arguments[0];return this._nodes.addNode(t)}};qn.prototype.getNodeIterator=function(){return this._nodes.iterator()};qn.prototype.linkResultDirectedEdges=function(){for(var e=this._nodes.iterator();e.hasNext();){var t=e.next();t.getEdges().linkResultDirectedEdges()}};qn.prototype.debugPrintln=function(e){so.out.println(e)};qn.prototype.isBoundaryNode=function(e,t){var r=this._nodes.find(t);if(r===null)return!1;var n=r.getLabel();return n!==null&&n.getLocation(e)===Bt.BOUNDARY};qn.prototype.linkAllDirectedEdges=function(){for(var e=this._nodes.iterator();e.hasNext();){var t=e.next();t.getEdges().linkAllDirectedEdges()}};qn.prototype.matchInSameDirection=function(e,t,r,n){return e.equals(r)?Ie.computeOrientation(e,t,n)===Ie.COLLINEAR&&cn.quadrant(e,t)===cn.quadrant(r,n):!1};qn.prototype.getEdgeEnds=function(){return this._edgeEndList};qn.prototype.debugPrint=function(e){so.out.print(e)};qn.prototype.getEdgeIterator=function(){return this._edges.iterator()};qn.prototype.findEdgeInSameDirection=function(e,t){for(var r=this,n=0;n<this._edges.size();n++){var i=r._edges.get(n),l=i.getCoordinates();if(r.matchInSameDirection(e,t,l[0],l[1])||r.matchInSameDirection(e,t,l[l.length-1],l[l.length-2]))return i}return null};qn.prototype.insertEdge=function(e){this._edges.add(e)};qn.prototype.findEdgeEnd=function(e){for(var t=this.getEdgeEnds().iterator();t.hasNext();){var r=t.next();if(r.getEdge()===e)return r}return null};qn.prototype.addEdges=function(e){for(var t=this,r=e.iterator();r.hasNext();){var n=r.next();t._edges.add(n);var i=new cx(n,!0),l=new cx(n,!1);i.setSym(l),l.setSym(i),t.add(i),t.add(l)}};qn.prototype.add=function(e){this._nodes.add(e),this._edgeEndList.add(e)};qn.prototype.getNodes=function(){return this._nodes.values()};qn.prototype.findEdge=function(e,t){for(var r=this,n=0;n<this._edges.size();n++){var i=r._edges.get(n),l=i.getCoordinates();if(e.equals(l[0])&&t.equals(l[1]))return i}return null};qn.prototype.interfaces_=function(){return[]};qn.prototype.getClass=function(){return qn};qn.linkResultDirectedEdges=function(e){for(var t=e.iterator();t.hasNext();){var r=t.next();r.getEdges().linkResultDirectedEdges()}};var Cs=function(){this._geometryFactory=null,this._shellList=new me;var e=arguments[0];this._geometryFactory=e};Cs.prototype.sortShellsAndHoles=function(e,t,r){for(var n=e.iterator();n.hasNext();){var i=n.next();i.isHole()?r.add(i):t.add(i)}};Cs.prototype.computePolygons=function(e){for(var t=this,r=new me,n=e.iterator();n.hasNext();){var i=n.next(),l=i.toPolygon(t._geometryFactory);r.add(l)}return r};Cs.prototype.placeFreeHoles=function(e,t){for(var r=this,n=t.iterator();n.hasNext();){var i=n.next();if(i.getShell()===null){var l=r.findEdgeRingContaining(i,e);if(l===null)throw new qu("unable to assign hole to a shell",i.getCoordinate(0));i.setShell(l)}}};Cs.prototype.buildMinimalEdgeRings=function(e,t,r){for(var n=this,i=new me,l=e.iterator();l.hasNext();){var h=l.next();if(h.getMaxNodeDegree()>2){h.linkDirectedEdgesForMinimalEdgeRings();var a=h.buildMinimalRings(),g=n.findShell(a);g!==null?(n.placePolygonHoles(g,a),t.add(g)):r.addAll(a)}else i.add(h)}return i};Cs.prototype.containsPoint=function(e){for(var t=this._shellList.iterator();t.hasNext();){var r=t.next();if(r.containsPoint(e))return!0}return!1};Cs.prototype.buildMaximalEdgeRings=function(e){for(var t=this,r=new me,n=e.iterator();n.hasNext();){var i=n.next();if(i.isInResult()&&i.getLabel().isArea()&&i.getEdgeRing()===null){var l=new e5(i,t._geometryFactory);r.add(l),l.setInResult()}}return r};Cs.prototype.placePolygonHoles=function(e,t){for(var r=t.iterator();r.hasNext();){var n=r.next();n.isHole()&&n.setShell(e)}};Cs.prototype.getPolygons=function(){var e=this.computePolygons(this._shellList);return e};Cs.prototype.findEdgeRingContaining=function(e,t){for(var r=e.getLinearRing(),n=r.getEnvelopeInternal(),i=r.getCoordinateN(0),l=null,h=null,a=t.iterator();a.hasNext();){var g=a.next(),_=g.getLinearRing(),E=_.getEnvelopeInternal();l!==null&&(h=l.getLinearRing().getEnvelopeInternal());var S=!1;E.contains(n)&&Ie.isPointInRing(i,_.getCoordinates())&&(S=!0),S&&(l===null||h.contains(E))&&(l=g)}return l};Cs.prototype.findShell=function(e){for(var t=0,r=null,n=e.iterator();n.hasNext();){var i=n.next();i.isHole()||(r=i,t++)}return dr.isTrue(t<=1,"found two shells in MinimalEdgeRing list"),r};Cs.prototype.add=function(){if(arguments.length===1){var e=arguments[0];this.add(e.getEdgeEnds(),e.getNodes())}else if(arguments.length===2){var t=arguments[0],r=arguments[1];qn.linkResultDirectedEdges(r);var n=this.buildMaximalEdgeRings(t),i=new me,l=this.buildMinimalEdgeRings(n,this._shellList,i);this.sortShellsAndHoles(l,this._shellList,i),this.placeFreeHoles(this._shellList,i)}};Cs.prototype.interfaces_=function(){return[]};Cs.prototype.getClass=function(){return Cs};var ef=function(){};ef.prototype.getBounds=function(){};ef.prototype.interfaces_=function(){return[]};ef.prototype.getClass=function(){return ef};var qa=function(){this._bounds=null,this._item=null;var e=arguments[0],t=arguments[1];this._bounds=e,this._item=t};qa.prototype.getItem=function(){return this._item};qa.prototype.getBounds=function(){return this._bounds};qa.prototype.interfaces_=function(){return[ef,Ca]};qa.prototype.getClass=function(){return qa};var Zu=function(){this._size=null,this._items=null,this._size=0,this._items=new me,this._items.add(null)};Zu.prototype.poll=function(){if(this.isEmpty())return null;var e=this._items.get(1);return this._items.set(1,this._items.get(this._size)),this._size-=1,this.reorder(1),e};Zu.prototype.size=function(){return this._size};Zu.prototype.reorder=function(e){for(var t=this,r=null,n=this._items.get(e);e*2<=this._size&&(r=e*2,r!==t._size&&t._items.get(r+1).compareTo(t._items.get(r))<0&&r++,t._items.get(r).compareTo(n)<0);e=r)t._items.set(e,t._items.get(r));this._items.set(e,n)};Zu.prototype.clear=function(){this._size=0,this._items.clear()};Zu.prototype.isEmpty=function(){return this._size===0};Zu.prototype.add=function(e){var t=this;this._items.add(null),this._size+=1;var r=this._size;for(this._items.set(0,e);e.compareTo(this._items.get(Math.trunc(r/2)))<0;r/=2)t._items.set(r,t._items.get(Math.trunc(r/2)));this._items.set(r,e)};Zu.prototype.interfaces_=function(){return[]};Zu.prototype.getClass=function(){return Zu};var Gc=function(){};Gc.prototype.visitItem=function(e){};Gc.prototype.interfaces_=function(){return[]};Gc.prototype.getClass=function(){return Gc};var kp=function(){};kp.prototype.insert=function(e,t){};kp.prototype.remove=function(e,t){};kp.prototype.query=function(){};kp.prototype.interfaces_=function(){return[]};kp.prototype.getClass=function(){return kp};var Pi=function(){if(this._childBoundables=new me,this._bounds=null,this._level=null,arguments.length!==0&&arguments.length===1){var e=arguments[0];this._level=e}},HI={serialVersionUID:{configurable:!0}};Pi.prototype.getLevel=function(){return this._level};Pi.prototype.size=function(){return this._childBoundables.size()};Pi.prototype.getChildBoundables=function(){return this._childBoundables};Pi.prototype.addChildBoundable=function(e){dr.isTrue(this._bounds===null),this._childBoundables.add(e)};Pi.prototype.isEmpty=function(){return this._childBoundables.isEmpty()};Pi.prototype.getBounds=function(){return this._bounds===null&&(this._bounds=this.computeBounds()),this._bounds};Pi.prototype.interfaces_=function(){return[ef,Ca]};Pi.prototype.getClass=function(){return Pi};HI.serialVersionUID.get=function(){return 6493722185909574e3};Object.defineProperties(Pi,HI);var Za=function(){};Za.reverseOrder=function(){return{compare:function(e,t){return t.compareTo(e)}}};Za.min=function(e){return Za.sort(e),e.get(0)};Za.sort=function(e,t){var r=e.toArray();t?Bh.sort(r,t):Bh.sort(r);for(var n=e.iterator(),i=0,l=r.length;i<l;i++)n.next(),n.set(r[i])};Za.singletonList=function(e){var t=new me;return t.add(e),t};var fi=function(){this._boundable1=null,this._boundable2=null,this._distance=null,this._itemDistance=null;var e=arguments[0],t=arguments[1],r=arguments[2];this._boundable1=e,this._boundable2=t,this._itemDistance=r,this._distance=this.distance()};fi.prototype.expandToQueue=function(e,t){var r=fi.isComposite(this._boundable1),n=fi.isComposite(this._boundable2);if(r&&n)return fi.area(this._boundable1)>fi.area(this._boundable2)?(this.expand(this._boundable1,this._boundable2,e,t),null):(this.expand(this._boundable2,this._boundable1,e,t),null);if(r)return this.expand(this._boundable1,this._boundable2,e,t),null;if(n)return this.expand(this._boundable2,this._boundable1,e,t),null;throw new $n("neither boundable is composite")};fi.prototype.isLeaves=function(){return!(fi.isComposite(this._boundable1)||fi.isComposite(this._boundable2))};fi.prototype.compareTo=function(e){var t=e;return this._distance<t._distance?-1:this._distance>t._distance?1:0};fi.prototype.expand=function(e,t,r,n){for(var i=this,l=e.getChildBoundables(),h=l.iterator();h.hasNext();){var a=h.next(),g=new fi(a,t,i._itemDistance);g.getDistance()<n&&r.add(g)}};fi.prototype.getBoundable=function(e){return e===0?this._boundable1:this._boundable2};fi.prototype.getDistance=function(){return this._distance};fi.prototype.distance=function(){return this.isLeaves()?this._itemDistance.distance(this._boundable1,this._boundable2):this._boundable1.getBounds().distance(this._boundable2.getBounds())};fi.prototype.interfaces_=function(){return[Ia]};fi.prototype.getClass=function(){return fi};fi.area=function(e){return e.getBounds().getArea()};fi.isComposite=function(e){return e instanceof Pi};var Hi=function e(){if(this._root=null,this._built=!1,this._itemBoundables=new me,this._nodeCapacity=null,arguments.length===0){var t=e.DEFAULT_NODE_CAPACITY;this._nodeCapacity=t}else if(arguments.length===1){var r=arguments[0];dr.isTrue(r>1,"Node capacity must be greater than 1"),this._nodeCapacity=r}},i0={IntersectsOp:{configurable:!0},serialVersionUID:{configurable:!0},DEFAULT_NODE_CAPACITY:{configurable:!0}};Hi.prototype.getNodeCapacity=function(){return this._nodeCapacity};Hi.prototype.lastNode=function(e){return e.get(e.size()-1)};Hi.prototype.size=function(){var e=this;if(arguments.length===0)return this.isEmpty()?0:(this.build(),this.size(this._root));if(arguments.length===1){for(var t=arguments[0],r=0,n=t.getChildBoundables().iterator();n.hasNext();){var i=n.next();i instanceof Pi?r+=e.size(i):i instanceof qa&&(r+=1)}return r}};Hi.prototype.removeItem=function(e,t){for(var r=null,n=e.getChildBoundables().iterator();n.hasNext();){var i=n.next();i instanceof qa&&i.getItem()===t&&(r=i)}return r!==null?(e.getChildBoundables().remove(r),!0):!1};Hi.prototype.itemsTree=function(){var e=this;if(arguments.length===0){this.build();var t=this.itemsTree(this._root);return t===null?new me:t}else if(arguments.length===1){for(var r=arguments[0],n=new me,i=r.getChildBoundables().iterator();i.hasNext();){var l=i.next();if(l instanceof Pi){var h=e.itemsTree(l);h!==null&&n.add(h)}else l instanceof qa?n.add(l.getItem()):dr.shouldNeverReachHere()}return n.size()<=0?null:n}};Hi.prototype.insert=function(e,t){dr.isTrue(!this._built,"Cannot insert items into an STR packed R-tree after it has been built."),this._itemBoundables.add(new qa(e,t))};Hi.prototype.boundablesAtLevel=function(){var e=this;if(arguments.length===1){var t=arguments[0],r=new me;return this.boundablesAtLevel(t,this._root,r),r}else if(arguments.length===3){var n=arguments[0],i=arguments[1],l=arguments[2];if(dr.isTrue(n>-2),i.getLevel()===n)return l.add(i),null;for(var h=i.getChildBoundables().iterator();h.hasNext();){var a=h.next();a instanceof Pi?e.boundablesAtLevel(n,a,l):(dr.isTrue(a instanceof qa),n===-1&&l.add(a))}return null}};Hi.prototype.query=function(){var e=this;if(arguments.length===1){var t=arguments[0];this.build();var r=new me;return this.isEmpty()||this.getIntersectsOp().intersects(this._root.getBounds(),t)&&this.query(t,this._root,r),r}else if(arguments.length===2){var n=arguments[0],i=arguments[1];if(this.build(),this.isEmpty())return null;this.getIntersectsOp().intersects(this._root.getBounds(),n)&&this.query(n,this._root,i)}else if(arguments.length===3){if(rr(arguments[2],Gc)&&arguments[0]instanceof Object&&arguments[1]instanceof Pi)for(var l=arguments[0],h=arguments[1],a=arguments[2],g=h.getChildBoundables(),_=0;_<g.size();_++){var E=g.get(_);e.getIntersectsOp().intersects(E.getBounds(),l)&&(E instanceof Pi?e.query(l,E,a):E instanceof qa?a.visitItem(E.getItem()):dr.shouldNeverReachHere())}else if(rr(arguments[2],Ua)&&arguments[0]instanceof Object&&arguments[1]instanceof Pi)for(var S=arguments[0],A=arguments[1],O=arguments[2],k=A.getChildBoundables(),G=0;G<k.size();G++){var W=k.get(G);e.getIntersectsOp().intersects(W.getBounds(),S)&&(W instanceof Pi?e.query(S,W,O):W instanceof qa?O.add(W.getItem()):dr.shouldNeverReachHere())}}};Hi.prototype.build=function(){if(this._built)return null;this._root=this._itemBoundables.isEmpty()?this.createNode(0):this.createHigherLevels(this._itemBoundables,-1),this._itemBoundables=null,this._built=!0};Hi.prototype.getRoot=function(){return this.build(),this._root};Hi.prototype.remove=function(){var e=this;if(arguments.length===2){var t=arguments[0],r=arguments[1];return this.build(),this.getIntersectsOp().intersects(this._root.getBounds(),t)?this.remove(t,this._root,r):!1}else if(arguments.length===3){var n=arguments[0],i=arguments[1],l=arguments[2],h=this.removeItem(i,l);if(h)return!0;for(var a=null,g=i.getChildBoundables().iterator();g.hasNext();){var _=g.next();if(e.getIntersectsOp().intersects(_.getBounds(),n)&&_ instanceof Pi&&(h=e.remove(n,_,l),h)){a=_;break}}return a!==null&&a.getChildBoundables().isEmpty()&&i.getChildBoundables().remove(a),h}};Hi.prototype.createHigherLevels=function(e,t){dr.isTrue(!e.isEmpty());var r=this.createParentBoundables(e,t+1);return r.size()===1?r.get(0):this.createHigherLevels(r,t+1)};Hi.prototype.depth=function(){var e=this;if(arguments.length===0)return this.isEmpty()?0:(this.build(),this.depth(this._root));if(arguments.length===1){for(var t=arguments[0],r=0,n=t.getChildBoundables().iterator();n.hasNext();){var i=n.next();if(i instanceof Pi){var l=e.depth(i);l>r&&(r=l)}}return r+1}};Hi.prototype.createParentBoundables=function(e,t){var r=this;dr.isTrue(!e.isEmpty());var n=new me;n.add(this.createNode(t));var i=new me(e);Za.sort(i,this.getComparator());for(var l=i.iterator();l.hasNext();){var h=l.next();r.lastNode(n).getChildBoundables().size()===r.getNodeCapacity()&&n.add(r.createNode(t)),r.lastNode(n).addChildBoundable(h)}return n};Hi.prototype.isEmpty=function(){return this._built?this._root.isEmpty():this._itemBoundables.isEmpty()};Hi.prototype.interfaces_=function(){return[Ca]};Hi.prototype.getClass=function(){return Hi};Hi.compareDoubles=function(e,t){return e>t?1:e<t?-1:0};i0.IntersectsOp.get=function(){return r5};i0.serialVersionUID.get=function(){return-3886435814360241e3};i0.DEFAULT_NODE_CAPACITY.get=function(){return 10};Object.defineProperties(Hi,i0);var r5=function(){},rf=function(){};rf.prototype.distance=function(e,t){};rf.prototype.interfaces_=function(){return[]};rf.prototype.getClass=function(){return rf};var YI=function(e){function t(n){n=n||t.DEFAULT_NODE_CAPACITY,e.call(this,n)}e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t;var r={STRtreeNode:{configurable:!0},serialVersionUID:{configurable:!0},xComparator:{configurable:!0},yComparator:{configurable:!0},intersectsOp:{configurable:!0},DEFAULT_NODE_CAPACITY:{configurable:!0}};return t.prototype.createParentBoundablesFromVerticalSlices=function(n,i){var l=this;dr.isTrue(n.length>0);for(var h=new me,a=0;a<n.length;a++)h.addAll(l.createParentBoundablesFromVerticalSlice(n[a],i));return h},t.prototype.createNode=function(n){return new r2(n)},t.prototype.size=function(){return arguments.length===0?e.prototype.size.call(this):e.prototype.size.apply(this,arguments)},t.prototype.insert=function(){if(arguments.length===2){var n=arguments[0],i=arguments[1];if(n.isNull())return null;e.prototype.insert.call(this,n,i)}else return e.prototype.insert.apply(this,arguments)},t.prototype.getIntersectsOp=function(){return t.intersectsOp},t.prototype.verticalSlices=function(n,i){for(var l=Math.trunc(Math.ceil(n.size()/i)),h=new Array(i).fill(null),a=n.iterator(),g=0;g<i;g++){h[g]=new me;for(var _=0;a.hasNext()&&_<l;){var E=a.next();h[g].add(E),_++}}return h},t.prototype.query=function(){if(arguments.length===1){var n=arguments[0];return e.prototype.query.call(this,n)}else if(arguments.length===2){var i=arguments[0],l=arguments[1];e.prototype.query.call(this,i,l)}else if(arguments.length===3){if(rr(arguments[2],Gc)&&arguments[0]instanceof Object&&arguments[1]instanceof Pi){var h=arguments[0],a=arguments[1],g=arguments[2];e.prototype.query.call(this,h,a,g)}else if(rr(arguments[2],Ua)&&arguments[0]instanceof Object&&arguments[1]instanceof Pi){var _=arguments[0],E=arguments[1],S=arguments[2];e.prototype.query.call(this,_,E,S)}}},t.prototype.getComparator=function(){return t.yComparator},t.prototype.createParentBoundablesFromVerticalSlice=function(n,i){return e.prototype.createParentBoundables.call(this,n,i)},t.prototype.remove=function(){if(arguments.length===2){var n=arguments[0],i=arguments[1];return e.prototype.remove.call(this,n,i)}else return e.prototype.remove.apply(this,arguments)},t.prototype.depth=function(){return arguments.length===0?e.prototype.depth.call(this):e.prototype.depth.apply(this,arguments)},t.prototype.createParentBoundables=function(n,i){dr.isTrue(!n.isEmpty());var l=Math.trunc(Math.ceil(n.size()/this.getNodeCapacity())),h=new me(n);Za.sort(h,t.xComparator);var a=this.verticalSlices(h,Math.trunc(Math.ceil(Math.sqrt(l))));return this.createParentBoundablesFromVerticalSlices(a,i)},t.prototype.nearestNeighbour=function(){if(arguments.length===1){if(rr(arguments[0],rf)){var n=arguments[0],i=new fi(this.getRoot(),this.getRoot(),n);return this.nearestNeighbour(i)}else if(arguments[0]instanceof fi){var l=arguments[0];return this.nearestNeighbour(l,lr.POSITIVE_INFINITY)}}else if(arguments.length===2){if(arguments[0]instanceof t&&rr(arguments[1],rf)){var h=arguments[0],a=arguments[1],g=new fi(this.getRoot(),h.getRoot(),a);return this.nearestNeighbour(g)}else if(arguments[0]instanceof fi&&typeof arguments[1]=="number"){var _=arguments[0],E=arguments[1],S=E,A=null,O=new Zu;for(O.add(_);!O.isEmpty()&&S>0;){var k=O.poll(),G=k.getDistance();if(G>=S)break;k.isLeaves()?(S=G,A=k):k.expandToQueue(O,S)}return[A.getBoundable(0).getItem(),A.getBoundable(1).getItem()]}}else if(arguments.length===3){var W=arguments[0],U=arguments[1],tt=arguments[2],$=new qa(W,U),V=new fi(this.getRoot(),$,tt);return this.nearestNeighbour(V)[0]}},t.prototype.interfaces_=function(){return[kp,Ca]},t.prototype.getClass=function(){return t},t.centreX=function(n){return t.avg(n.getMinX(),n.getMaxX())},t.avg=function(n,i){return(n+i)/2},t.centreY=function(n){return t.avg(n.getMinY(),n.getMaxY())},r.STRtreeNode.get=function(){return r2},r.serialVersionUID.get=function(){return 0x39920f7d5f261e0},r.xComparator.get=function(){return{interfaces_:function(){return[Zd]},compare:function(n,i){return e.compareDoubles(t.centreX(n.getBounds()),t.centreX(i.getBounds()))}}},r.yComparator.get=function(){return{interfaces_:function(){return[Zd]},compare:function(n,i){return e.compareDoubles(t.centreY(n.getBounds()),t.centreY(i.getBounds()))}}},r.intersectsOp.get=function(){return{interfaces_:function(){return[e.IntersectsOp]},intersects:function(n,i){return n.intersects(i)}}},r.DEFAULT_NODE_CAPACITY.get=function(){return 10},Object.defineProperties(t,r),t}(Hi),r2=function(e){function t(){var r=arguments[0];e.call(this,r)}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.computeBounds=function(){for(var r=null,n=this.getChildBoundables().iterator();n.hasNext();){var i=n.next();r===null?r=new Ve(i.getBounds()):r.expandToInclude(i.getBounds())}return r},t.prototype.interfaces_=function(){return[]},t.prototype.getClass=function(){return t},t}(Pi),ns=function(){};ns.prototype.interfaces_=function(){return[]};ns.prototype.getClass=function(){return ns};ns.relativeSign=function(e,t){return e<t?-1:e>t?1:0};ns.compare=function(e,t,r){if(t.equals2D(r))return 0;var n=ns.relativeSign(t.x,r.x),i=ns.relativeSign(t.y,r.y);switch(e){case 0:return ns.compareValue(n,i);case 1:return ns.compareValue(i,n);case 2:return ns.compareValue(i,-n);case 3:return ns.compareValue(-n,i);case 4:return ns.compareValue(-n,-i);case 5:return ns.compareValue(-i,-n);case 6:return ns.compareValue(-i,n);case 7:return ns.compareValue(n,-i)}return dr.shouldNeverReachHere("invalid octant value"),0};ns.compareValue=function(e,t){return e<0?-1:e>0?1:t<0?-1:t>0?1:0};var qc=function(){this._segString=null,this.coord=null,this.segmentIndex=null,this._segmentOctant=null,this._isInterior=null;var e=arguments[0],t=arguments[1],r=arguments[2],n=arguments[3];this._segString=e,this.coord=new kt(t),this.segmentIndex=r,this._segmentOctant=n,this._isInterior=!t.equals2D(e.getCoordinate(r))};qc.prototype.getCoordinate=function(){return this.coord};qc.prototype.print=function(e){e.print(this.coord),e.print(" seg # = "+this.segmentIndex)};qc.prototype.compareTo=function(e){var t=e;return this.segmentIndex<t.segmentIndex?-1:this.segmentIndex>t.segmentIndex?1:this.coord.equals2D(t.coord)?0:ns.compare(this._segmentOctant,this.coord,t.coord)};qc.prototype.isEndPoint=function(e){return this.segmentIndex===0&&!this._isInterior||this.segmentIndex===e};qc.prototype.isInterior=function(){return this._isInterior};qc.prototype.interfaces_=function(){return[Ia]};qc.prototype.getClass=function(){return qc};var Wo=function(){this._nodeMap=new Eo,this._edge=null;var e=arguments[0];this._edge=e};Wo.prototype.getSplitCoordinates=function(){var e=this,t=new Sg;this.addEndpoints();for(var r=this.iterator(),n=r.next();r.hasNext();){var i=r.next();e.addEdgeCoordinates(n,i,t),n=i}return t.toCoordinateArray()};Wo.prototype.addCollapsedNodes=function(){var e=this,t=new me;this.findCollapsesFromInsertedNodes(t),this.findCollapsesFromExistingVertices(t);for(var r=t.iterator();r.hasNext();){var n=r.next().intValue();e.add(e._edge.getCoordinate(n),n)}};Wo.prototype.print=function(e){e.println("Intersections:");for(var t=this.iterator();t.hasNext();){var r=t.next();r.print(e)}};Wo.prototype.findCollapsesFromExistingVertices=function(e){for(var t=this,r=0;r<this._edge.size()-2;r++){var n=t._edge.getCoordinate(r),i=t._edge.getCoordinate(r+2);n.equals2D(i)&&e.add(new Ml(r+1))}};Wo.prototype.addEdgeCoordinates=function(e,t,r){var n=this,i=this._edge.getCoordinate(t.segmentIndex),l=t.isInterior()||!t.coord.equals2D(i);r.add(new kt(e.coord),!1);for(var h=e.segmentIndex+1;h<=t.segmentIndex;h++)r.add(n._edge.getCoordinate(h));l&&r.add(new kt(t.coord))};Wo.prototype.iterator=function(){return this._nodeMap.values().iterator()};Wo.prototype.addSplitEdges=function(e){var t=this;this.addEndpoints(),this.addCollapsedNodes();for(var r=this.iterator(),n=r.next();r.hasNext();){var i=r.next(),l=t.createSplitEdge(n,i);e.add(l),n=i}};Wo.prototype.findCollapseIndex=function(e,t,r){if(!e.coord.equals2D(t.coord))return!1;var n=t.segmentIndex-e.segmentIndex;return t.isInterior()||n--,n===1?(r[0]=e.segmentIndex+1,!0):!1};Wo.prototype.findCollapsesFromInsertedNodes=function(e){for(var t=this,r=new Array(1).fill(null),n=this.iterator(),i=n.next();n.hasNext();){var l=n.next(),h=t.findCollapseIndex(i,l,r);h&&e.add(new Ml(r[0])),i=l}};Wo.prototype.getEdge=function(){return this._edge};Wo.prototype.addEndpoints=function(){var e=this._edge.size()-1;this.add(this._edge.getCoordinate(0),0),this.add(this._edge.getCoordinate(e),e)};Wo.prototype.createSplitEdge=function(e,t){var r=this,n=t.segmentIndex-e.segmentIndex+2,i=this._edge.getCoordinate(t.segmentIndex),l=t.isInterior()||!t.coord.equals2D(i);l||n--;var h=new Array(n).fill(null),a=0;h[a++]=new kt(e.coord);for(var g=e.segmentIndex+1;g<=t.segmentIndex;g++)h[a++]=r._edge.getCoordinate(g);return l&&(h[a]=new kt(t.coord)),new si(h,this._edge.getData())};Wo.prototype.add=function(e,t){var r=new qc(this._edge,e,t,this._edge.getSegmentOctant(t)),n=this._nodeMap.get(r);return n!==null?(dr.isTrue(n.coord.equals2D(e),"Found equal nodes with different coordinates"),n):(this._nodeMap.put(r,r),r)};Wo.prototype.checkSplitEdgesCorrectness=function(e){var t=this._edge.getCoordinates(),r=e.get(0),n=r.getCoordinate(0);if(!n.equals2D(t[0]))throw new Vu("bad split edge start point at "+n);var i=e.get(e.size()-1),l=i.getCoordinates(),h=l[l.length-1];if(!h.equals2D(t[t.length-1]))throw new Vu("bad split edge end point at "+h)};Wo.prototype.interfaces_=function(){return[]};Wo.prototype.getClass=function(){return Wo};var Op=function(){};Op.prototype.interfaces_=function(){return[]};Op.prototype.getClass=function(){return Op};Op.octant=function(){if(typeof arguments[0]=="number"&&typeof arguments[1]=="number"){var e=arguments[0],t=arguments[1];if(e===0&&t===0)throw new $n("Cannot compute the octant for point ( "+e+", "+t+" )");var r=Math.abs(e),n=Math.abs(t);return e>=0?t>=0?r>=n?0:1:r>=n?7:6:t>=0?r>=n?3:2:r>=n?4:5}else if(arguments[0]instanceof kt&&arguments[1]instanceof kt){var i=arguments[0],l=arguments[1],h=l.x-i.x,a=l.y-i.y;if(h===0&&a===0)throw new $n("Cannot compute the octant for two identical points "+i);return Op.octant(h,a)}};var pu=function(){};pu.prototype.getCoordinates=function(){};pu.prototype.size=function(){};pu.prototype.getCoordinate=function(e){};pu.prototype.isClosed=function(){};pu.prototype.setData=function(e){};pu.prototype.getData=function(){};pu.prototype.interfaces_=function(){return[]};pu.prototype.getClass=function(){return pu};var sg=function(){};sg.prototype.addIntersection=function(e,t){};sg.prototype.interfaces_=function(){return[pu]};sg.prototype.getClass=function(){return sg};var si=function(){this._nodeList=new Wo(this),this._pts=null,this._data=null;var e=arguments[0],t=arguments[1];this._pts=e,this._data=t};si.prototype.getCoordinates=function(){return this._pts};si.prototype.size=function(){return this._pts.length};si.prototype.getCoordinate=function(e){return this._pts[e]};si.prototype.isClosed=function(){return this._pts[0].equals(this._pts[this._pts.length-1])};si.prototype.getSegmentOctant=function(e){return e===this._pts.length-1?-1:this.safeOctant(this.getCoordinate(e),this.getCoordinate(e+1))};si.prototype.setData=function(e){this._data=e};si.prototype.safeOctant=function(e,t){return e.equals2D(t)?0:Op.octant(e,t)};si.prototype.getData=function(){return this._data};si.prototype.addIntersection=function(){if(arguments.length===2){var e=arguments[0],t=arguments[1];this.addIntersectionNode(e,t)}else if(arguments.length===4){var r=arguments[0],n=arguments[1],i=arguments[3],l=new kt(r.getIntersection(i));this.addIntersection(l,n)}};si.prototype.toString=function(){return Va.toLineString(new ei(this._pts))};si.prototype.getNodeList=function(){return this._nodeList};si.prototype.addIntersectionNode=function(e,t){var r=t,n=r+1;if(n<this._pts.length){var i=this._pts[n];e.equals2D(i)&&(r=n)}var l=this._nodeList.add(e,r);return l};si.prototype.addIntersections=function(e,t,r){for(var n=this,i=0;i<e.getIntersectionNum();i++)n.addIntersection(e,t,r,i)};si.prototype.interfaces_=function(){return[sg]};si.prototype.getClass=function(){return si};si.getNodedSubstrings=function(){if(arguments.length===1){var e=arguments[0],t=new me;return si.getNodedSubstrings(e,t),t}else if(arguments.length===2)for(var r=arguments[0],n=arguments[1],i=r.iterator();i.hasNext();){var l=i.next();l.getNodeList().addSplitEdges(n)}};var Ge=function(){if(this.p0=null,this.p1=null,arguments.length===0)this.p0=new kt,this.p1=new kt;else if(arguments.length===1){var e=arguments[0];this.p0=new kt(e.p0),this.p1=new kt(e.p1)}else if(arguments.length===2)this.p0=arguments[0],this.p1=arguments[1];else if(arguments.length===4){var t=arguments[0],r=arguments[1],n=arguments[2],i=arguments[3];this.p0=new kt(t,r),this.p1=new kt(n,i)}},KI={serialVersionUID:{configurable:!0}};Ge.prototype.minX=function(){return Math.min(this.p0.x,this.p1.x)};Ge.prototype.orientationIndex=function(){if(arguments[0]instanceof Ge){var e=arguments[0],t=Ie.orientationIndex(this.p0,this.p1,e.p0),r=Ie.orientationIndex(this.p0,this.p1,e.p1);return t>=0&&r>=0||t<=0&&r<=0?Math.max(t,r):0}else if(arguments[0]instanceof kt){var n=arguments[0];return Ie.orientationIndex(this.p0,this.p1,n)}};Ge.prototype.toGeometry=function(e){return e.createLineString([this.p0,this.p1])};Ge.prototype.isVertical=function(){return this.p0.x===this.p1.x};Ge.prototype.equals=function(e){if(!(e instanceof Ge))return!1;var t=e;return this.p0.equals(t.p0)&&this.p1.equals(t.p1)};Ge.prototype.intersection=function(e){var t=new lp;return t.computeIntersection(this.p0,this.p1,e.p0,e.p1),t.hasIntersection()?t.getIntersection(0):null};Ge.prototype.project=function(){if(arguments[0]instanceof kt){var e=arguments[0];if(e.equals(this.p0)||e.equals(this.p1))return new kt(e);var t=this.projectionFactor(e),r=new kt;return r.x=this.p0.x+t*(this.p1.x-this.p0.x),r.y=this.p0.y+t*(this.p1.y-this.p0.y),r}else if(arguments[0]instanceof Ge){var n=arguments[0],i=this.projectionFactor(n.p0),l=this.projectionFactor(n.p1);if(i>=1&&l>=1||i<=0&&l<=0)return null;var h=this.project(n.p0);i<0&&(h=this.p0),i>1&&(h=this.p1);var a=this.project(n.p1);return l<0&&(a=this.p0),l>1&&(a=this.p1),new Ge(h,a)}};Ge.prototype.normalize=function(){this.p1.compareTo(this.p0)<0&&this.reverse()};Ge.prototype.angle=function(){return Math.atan2(this.p1.y-this.p0.y,this.p1.x-this.p0.x)};Ge.prototype.getCoordinate=function(e){return e===0?this.p0:this.p1};Ge.prototype.distancePerpendicular=function(e){return Ie.distancePointLinePerpendicular(e,this.p0,this.p1)};Ge.prototype.minY=function(){return Math.min(this.p0.y,this.p1.y)};Ge.prototype.midPoint=function(){return Ge.midPoint(this.p0,this.p1)};Ge.prototype.projectionFactor=function(e){if(e.equals(this.p0))return 0;if(e.equals(this.p1))return 1;var t=this.p1.x-this.p0.x,r=this.p1.y-this.p0.y,n=t*t+r*r;if(n<=0)return lr.NaN;var i=((e.x-this.p0.x)*t+(e.y-this.p0.y)*r)/n;return i};Ge.prototype.closestPoints=function(e){var t=this.intersection(e);if(t!==null)return[t,t];var r=new Array(2).fill(null),n=lr.MAX_VALUE,i=null,l=this.closestPoint(e.p0);n=l.distance(e.p0),r[0]=l,r[1]=e.p0;var h=this.closestPoint(e.p1);i=h.distance(e.p1),i<n&&(n=i,r[0]=h,r[1]=e.p1);var a=e.closestPoint(this.p0);i=a.distance(this.p0),i<n&&(n=i,r[0]=this.p0,r[1]=a);var g=e.closestPoint(this.p1);return i=g.distance(this.p1),i<n&&(n=i,r[0]=this.p1,r[1]=g),r};Ge.prototype.closestPoint=function(e){var t=this.projectionFactor(e);if(t>0&&t<1)return this.project(e);var r=this.p0.distance(e),n=this.p1.distance(e);return r<n?this.p0:this.p1};Ge.prototype.maxX=function(){return Math.max(this.p0.x,this.p1.x)};Ge.prototype.getLength=function(){return this.p0.distance(this.p1)};Ge.prototype.compareTo=function(e){var t=e,r=this.p0.compareTo(t.p0);return r!==0?r:this.p1.compareTo(t.p1)};Ge.prototype.reverse=function(){var e=this.p0;this.p0=this.p1,this.p1=e};Ge.prototype.equalsTopo=function(e){return this.p0.equals(e.p0)&&(this.p1.equals(e.p1)||this.p0.equals(e.p1))&&this.p1.equals(e.p0)};Ge.prototype.lineIntersection=function(e){try{var t=$a.intersection(this.p0,this.p1,e.p0,e.p1);return t}catch(r){if(!(r instanceof _f))throw r}finally{}return null};Ge.prototype.maxY=function(){return Math.max(this.p0.y,this.p1.y)};Ge.prototype.pointAlongOffset=function(e,t){var r=this.p0.x+e*(this.p1.x-this.p0.x),n=this.p0.y+e*(this.p1.y-this.p0.y),i=this.p1.x-this.p0.x,l=this.p1.y-this.p0.y,h=Math.sqrt(i*i+l*l),a=0,g=0;if(t!==0){if(h<=0)throw new Error("Cannot compute offset from zero-length line segment");a=t*i/h,g=t*l/h}var _=r-g,E=n+a,S=new kt(_,E);return S};Ge.prototype.setCoordinates=function(){if(arguments.length===1){var e=arguments[0];this.setCoordinates(e.p0,e.p1)}else if(arguments.length===2){var t=arguments[0],r=arguments[1];this.p0.x=t.x,this.p0.y=t.y,this.p1.x=r.x,this.p1.y=r.y}};Ge.prototype.segmentFraction=function(e){var t=this.projectionFactor(e);return t<0?t=0:(t>1||lr.isNaN(t))&&(t=1),t};Ge.prototype.toString=function(){return"LINESTRING( "+this.p0.x+" "+this.p0.y+", "+this.p1.x+" "+this.p1.y+")"};Ge.prototype.isHorizontal=function(){return this.p0.y===this.p1.y};Ge.prototype.distance=function(){if(arguments[0]instanceof Ge){var e=arguments[0];return Ie.distanceLineLine(this.p0,this.p1,e.p0,e.p1)}else if(arguments[0]instanceof kt){var t=arguments[0];return Ie.distancePointLine(t,this.p0,this.p1)}};Ge.prototype.pointAlong=function(e){var t=new kt;return t.x=this.p0.x+e*(this.p1.x-this.p0.x),t.y=this.p0.y+e*(this.p1.y-this.p0.y),t};Ge.prototype.hashCode=function(){var e=lr.doubleToLongBits(this.p0.x);e^=lr.doubleToLongBits(this.p0.y)*31;var t=Math.trunc(e)^Math.trunc(e>>32),r=lr.doubleToLongBits(this.p1.x);r^=lr.doubleToLongBits(this.p1.y)*31;var n=Math.trunc(r)^Math.trunc(r>>32);return t^n};Ge.prototype.interfaces_=function(){return[Ia,Ca]};Ge.prototype.getClass=function(){return Ge};Ge.midPoint=function(e,t){return new kt((e.x+t.x)/2,(e.y+t.y)/2)};KI.serialVersionUID.get=function(){return 0x2d2172135f411c00};Object.defineProperties(Ge,KI);var ag=function(){this.tempEnv1=new Ve,this.tempEnv2=new Ve,this._overlapSeg1=new Ge,this._overlapSeg2=new Ge};ag.prototype.overlap=function(){if(arguments.length!==2&&arguments.length===4){var e=arguments[0],t=arguments[1],r=arguments[2],n=arguments[3];e.getLineSegment(t,this._overlapSeg1),r.getLineSegment(n,this._overlapSeg2),this.overlap(this._overlapSeg1,this._overlapSeg2)}};ag.prototype.interfaces_=function(){return[]};ag.prototype.getClass=function(){return ag};var Ms=function(){this._pts=null,this._start=null,this._end=null,this._env=null,this._context=null,this._id=null;var e=arguments[0],t=arguments[1],r=arguments[2],n=arguments[3];this._pts=e,this._start=t,this._end=r,this._context=n};Ms.prototype.getLineSegment=function(e,t){t.p0=this._pts[e],t.p1=this._pts[e+1]};Ms.prototype.computeSelect=function(e,t,r,n){var i=this._pts[t],l=this._pts[r];if(n.tempEnv1.init(i,l),r-t===1)return n.select(this,t),null;if(!e.intersects(n.tempEnv1))return null;var h=Math.trunc((t+r)/2);t<h&&this.computeSelect(e,t,h,n),h<r&&this.computeSelect(e,h,r,n)};Ms.prototype.getCoordinates=function(){for(var e=this,t=new Array(this._end-this._start+1).fill(null),r=0,n=this._start;n<=this._end;n++)t[r++]=e._pts[n];return t};Ms.prototype.computeOverlaps=function(e,t){this.computeOverlapsInternal(this._start,this._end,e,e._start,e._end,t)};Ms.prototype.setId=function(e){this._id=e};Ms.prototype.select=function(e,t){this.computeSelect(e,this._start,this._end,t)};Ms.prototype.getEnvelope=function(){if(this._env===null){var e=this._pts[this._start],t=this._pts[this._end];this._env=new Ve(e,t)}return this._env};Ms.prototype.getEndIndex=function(){return this._end};Ms.prototype.getStartIndex=function(){return this._start};Ms.prototype.getContext=function(){return this._context};Ms.prototype.getId=function(){return this._id};Ms.prototype.computeOverlapsInternal=function(e,t,r,n,i,l){var h=this._pts[e],a=this._pts[t],g=r._pts[n],_=r._pts[i];if(t-e===1&&i-n===1)return l.overlap(this,e,r,n),null;if(l.tempEnv1.init(h,a),l.tempEnv2.init(g,_),!l.tempEnv1.intersects(l.tempEnv2))return null;var E=Math.trunc((e+t)/2),S=Math.trunc((n+i)/2);e<E&&(n<S&&this.computeOverlapsInternal(e,E,r,n,S,l),S<i&&this.computeOverlapsInternal(e,E,r,S,i,l)),E<t&&(n<S&&this.computeOverlapsInternal(E,t,r,n,S,l),S<i&&this.computeOverlapsInternal(E,t,r,S,i,l))};Ms.prototype.interfaces_=function(){return[]};Ms.prototype.getClass=function(){return Ms};var Il=function(){};Il.prototype.interfaces_=function(){return[]};Il.prototype.getClass=function(){return Il};Il.getChainStartIndices=function(e){var t=0,r=new me;r.add(new Ml(t));do{var n=Il.findChainEnd(e,t);r.add(new Ml(n)),t=n}while(t<e.length-1);var i=Il.toIntArray(r);return i};Il.findChainEnd=function(e,t){for(var r=t;r<e.length-1&&e[r].equals2D(e[r+1]);)r++;if(r>=e.length-1)return e.length-1;for(var n=cn.quadrant(e[r],e[r+1]),i=t+1;i<e.length;){if(!e[i-1].equals2D(e[i])){var l=cn.quadrant(e[i-1],e[i]);if(l!==n)break}i++}return i-1};Il.getChains=function(){if(arguments.length===1){var e=arguments[0];return Il.getChains(e,null)}else if(arguments.length===2){for(var t=arguments[0],r=arguments[1],n=new me,i=Il.getChainStartIndices(t),l=0;l<i.length-1;l++){var h=new Ms(t,i[l],i[l+1],r);n.add(h)}return n}};Il.toIntArray=function(e){for(var t=new Array(e.size()).fill(null),r=0;r<t.length;r++)t[r]=e.get(r).intValue();return t};var Yh=function(){};Yh.prototype.computeNodes=function(e){};Yh.prototype.getNodedSubstrings=function(){};Yh.prototype.interfaces_=function(){return[]};Yh.prototype.getClass=function(){return Yh};var lg=function(){if(this._segInt=null,arguments.length!==0&&arguments.length===1){var e=arguments[0];this.setSegmentIntersector(e)}};lg.prototype.setSegmentIntersector=function(e){this._segInt=e};lg.prototype.interfaces_=function(){return[Yh]};lg.prototype.getClass=function(){return lg};var x1=function(e){function t(n){n?e.call(this,n):e.call(this),this._monoChains=new me,this._index=new YI,this._idCounter=0,this._nodedSegStrings=null,this._nOverlaps=0}e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t;var r={SegmentOverlapAction:{configurable:!0}};return t.prototype.getMonotoneChains=function(){return this._monoChains},t.prototype.getNodedSubstrings=function(){return si.getNodedSubstrings(this._nodedSegStrings)},t.prototype.getIndex=function(){return this._index},t.prototype.add=function(n){for(var i=this,l=Il.getChains(n.getCoordinates(),n),h=l.iterator();h.hasNext();){var a=h.next();a.setId(i._idCounter++),i._index.insert(a.getEnvelope(),a),i._monoChains.add(a)}},t.prototype.computeNodes=function(n){var i=this;this._nodedSegStrings=n;for(var l=n.iterator();l.hasNext();)i.add(l.next());this.intersectChains()},t.prototype.intersectChains=function(){for(var n=this,i=new n2(this._segInt),l=this._monoChains.iterator();l.hasNext();)for(var h=l.next(),a=n._index.query(h.getEnvelope()),g=a.iterator();g.hasNext();){var _=g.next();if(_.getId()>h.getId()&&(h.computeOverlaps(_,i),n._nOverlaps++),n._segInt.isDone())return null}},t.prototype.interfaces_=function(){return[]},t.prototype.getClass=function(){return t},r.SegmentOverlapAction.get=function(){return n2},Object.defineProperties(t,r),t}(lg),n2=function(e){function t(){e.call(this),this._si=null;var r=arguments[0];this._si=r}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.overlap=function(){if(arguments.length===4){var r=arguments[0],n=arguments[1],i=arguments[2],l=arguments[3],h=r.getContext(),a=i.getContext();this._si.processIntersections(h,n,a,l)}else return e.prototype.overlap.apply(this,arguments)},t.prototype.interfaces_=function(){return[]},t.prototype.getClass=function(){return t},t}(ag),Zr=function e(){if(this._quadrantSegments=e.DEFAULT_QUADRANT_SEGMENTS,this._endCapStyle=e.CAP_ROUND,this._joinStyle=e.JOIN_ROUND,this._mitreLimit=e.DEFAULT_MITRE_LIMIT,this._isSingleSided=!1,this._simplifyFactor=e.DEFAULT_SIMPLIFY_FACTOR,arguments.length!==0){if(arguments.length===1){var t=arguments[0];this.setQuadrantSegments(t)}else if(arguments.length===2){var r=arguments[0],n=arguments[1];this.setQuadrantSegments(r),this.setEndCapStyle(n)}else if(arguments.length===4){var i=arguments[0],l=arguments[1],h=arguments[2],a=arguments[3];this.setQuadrantSegments(i),this.setEndCapStyle(l),this.setJoinStyle(h),this.setMitreLimit(a)}}},Ku={CAP_ROUND:{configurable:!0},CAP_FLAT:{configurable:!0},CAP_SQUARE:{configurable:!0},JOIN_ROUND:{configurable:!0},JOIN_MITRE:{configurable:!0},JOIN_BEVEL:{configurable:!0},DEFAULT_QUADRANT_SEGMENTS:{configurable:!0},DEFAULT_MITRE_LIMIT:{configurable:!0},DEFAULT_SIMPLIFY_FACTOR:{configurable:!0}};Zr.prototype.getEndCapStyle=function(){return this._endCapStyle};Zr.prototype.isSingleSided=function(){return this._isSingleSided};Zr.prototype.setQuadrantSegments=function(e){this._quadrantSegments=e,this._quadrantSegments===0&&(this._joinStyle=Zr.JOIN_BEVEL),this._quadrantSegments<0&&(this._joinStyle=Zr.JOIN_MITRE,this._mitreLimit=Math.abs(this._quadrantSegments)),e<=0&&(this._quadrantSegments=1),this._joinStyle!==Zr.JOIN_ROUND&&(this._quadrantSegments=Zr.DEFAULT_QUADRANT_SEGMENTS)};Zr.prototype.getJoinStyle=function(){return this._joinStyle};Zr.prototype.setJoinStyle=function(e){this._joinStyle=e};Zr.prototype.setSimplifyFactor=function(e){this._simplifyFactor=e<0?0:e};Zr.prototype.getSimplifyFactor=function(){return this._simplifyFactor};Zr.prototype.getQuadrantSegments=function(){return this._quadrantSegments};Zr.prototype.setEndCapStyle=function(e){this._endCapStyle=e};Zr.prototype.getMitreLimit=function(){return this._mitreLimit};Zr.prototype.setMitreLimit=function(e){this._mitreLimit=e};Zr.prototype.setSingleSided=function(e){this._isSingleSided=e};Zr.prototype.interfaces_=function(){return[]};Zr.prototype.getClass=function(){return Zr};Zr.bufferDistanceError=function(e){var t=Math.PI/2/e;return 1-Math.cos(t/2)};Ku.CAP_ROUND.get=function(){return 1};Ku.CAP_FLAT.get=function(){return 2};Ku.CAP_SQUARE.get=function(){return 3};Ku.JOIN_ROUND.get=function(){return 1};Ku.JOIN_MITRE.get=function(){return 2};Ku.JOIN_BEVEL.get=function(){return 3};Ku.DEFAULT_QUADRANT_SEGMENTS.get=function(){return 8};Ku.DEFAULT_MITRE_LIMIT.get=function(){return 5};Ku.DEFAULT_SIMPLIFY_FACTOR.get=function(){return .01};Object.defineProperties(Zr,Ku);var Yn=function(e){this._distanceTol=null,this._isDeleted=null,this._angleOrientation=Ie.COUNTERCLOCKWISE,this._inputLine=e||null},Cg={INIT:{configurable:!0},DELETE:{configurable:!0},KEEP:{configurable:!0},NUM_PTS_TO_CHECK:{configurable:!0}};Yn.prototype.isDeletable=function(e,t,r,n){var i=this._inputLine[e],l=this._inputLine[t],h=this._inputLine[r];return!this.isConcave(i,l,h)||!this.isShallow(i,l,h,n)?!1:this.isShallowSampled(i,l,e,r,n)};Yn.prototype.deleteShallowConcavities=function(){for(var e=this,t=1,r=this.findNextNonDeletedIndex(t),n=this.findNextNonDeletedIndex(r),i=!1;n<this._inputLine.length;){var l=!1;e.isDeletable(t,r,n,e._distanceTol)&&(e._isDeleted[r]=Yn.DELETE,l=!0,i=!0),l?t=n:t=r,r=e.findNextNonDeletedIndex(t),n=e.findNextNonDeletedIndex(r)}return i};Yn.prototype.isShallowConcavity=function(e,t,r,n){var i=Ie.computeOrientation(e,t,r),l=i===this._angleOrientation;if(!l)return!1;var h=Ie.distancePointLine(t,e,r);return h<n};Yn.prototype.isShallowSampled=function(e,t,r,n,i){var l=this,h=Math.trunc((n-r)/Yn.NUM_PTS_TO_CHECK);h<=0&&(h=1);for(var a=r;a<n;a+=h)if(!l.isShallow(e,t,l._inputLine[a],i))return!1;return!0};Yn.prototype.isConcave=function(e,t,r){var n=Ie.computeOrientation(e,t,r),i=n===this._angleOrientation;return i};Yn.prototype.simplify=function(e){var t=this;this._distanceTol=Math.abs(e),e<0&&(this._angleOrientation=Ie.CLOCKWISE),this._isDeleted=new Array(this._inputLine.length).fill(null);var r=!1;do r=t.deleteShallowConcavities();while(r);return this.collapseLine()};Yn.prototype.findNextNonDeletedIndex=function(e){for(var t=e+1;t<this._inputLine.length&&this._isDeleted[t]===Yn.DELETE;)t++;return t};Yn.prototype.isShallow=function(e,t,r,n){var i=Ie.distancePointLine(t,e,r);return i<n};Yn.prototype.collapseLine=function(){for(var e=this,t=new Sg,r=0;r<this._inputLine.length;r++)e._isDeleted[r]!==Yn.DELETE&&t.add(e._inputLine[r]);return t.toCoordinateArray()};Yn.prototype.interfaces_=function(){return[]};Yn.prototype.getClass=function(){return Yn};Yn.simplify=function(e,t){var r=new Yn(e);return r.simplify(t)};Cg.INIT.get=function(){return 0};Cg.DELETE.get=function(){return 1};Cg.KEEP.get=function(){return 1};Cg.NUM_PTS_TO_CHECK.get=function(){return 10};Object.defineProperties(Yn,Cg);var ta=function(){this._ptList=null,this._precisionModel=null,this._minimimVertexDistance=0,this._ptList=new me},JI={COORDINATE_ARRAY_TYPE:{configurable:!0}};ta.prototype.getCoordinates=function(){var e=this._ptList.toArray(ta.COORDINATE_ARRAY_TYPE);return e};ta.prototype.setPrecisionModel=function(e){this._precisionModel=e};ta.prototype.addPt=function(e){var t=new kt(e);if(this._precisionModel.makePrecise(t),this.isRedundant(t))return null;this._ptList.add(t)};ta.prototype.revere=function(){};ta.prototype.addPts=function(e,t){var r=this;if(t)for(var n=0;n<e.length;n++)r.addPt(e[n]);else for(var i=e.length-1;i>=0;i--)r.addPt(e[i])};ta.prototype.isRedundant=function(e){if(this._ptList.size()<1)return!1;var t=this._ptList.get(this._ptList.size()-1),r=e.distance(t);return r<this._minimimVertexDistance};ta.prototype.toString=function(){var e=new Er,t=e.createLineString(this.getCoordinates());return t.toString()};ta.prototype.closeRing=function(){if(this._ptList.size()<1)return null;var e=new kt(this._ptList.get(0)),t=this._ptList.get(this._ptList.size()-1);if(e.equals(t))return null;this._ptList.add(e)};ta.prototype.setMinimumVertexDistance=function(e){this._minimimVertexDistance=e};ta.prototype.interfaces_=function(){return[]};ta.prototype.getClass=function(){return ta};JI.COORDINATE_ARRAY_TYPE.get=function(){return new Array(0).fill(null)};Object.defineProperties(ta,JI);var Nr=function(){},ed={PI_TIMES_2:{configurable:!0},PI_OVER_2:{configurable:!0},PI_OVER_4:{configurable:!0},COUNTERCLOCKWISE:{configurable:!0},CLOCKWISE:{configurable:!0},NONE:{configurable:!0}};Nr.prototype.interfaces_=function(){return[]};Nr.prototype.getClass=function(){return Nr};Nr.toDegrees=function(e){return e*180/Math.PI};Nr.normalize=function(e){for(;e>Math.PI;)e-=Nr.PI_TIMES_2;for(;e<=-Math.PI;)e+=Nr.PI_TIMES_2;return e};Nr.angle=function(){if(arguments.length===1){var e=arguments[0];return Math.atan2(e.y,e.x)}else if(arguments.length===2){var t=arguments[0],r=arguments[1],n=r.x-t.x,i=r.y-t.y;return Math.atan2(i,n)}};Nr.isAcute=function(e,t,r){var n=e.x-t.x,i=e.y-t.y,l=r.x-t.x,h=r.y-t.y,a=n*l+i*h;return a>0};Nr.isObtuse=function(e,t,r){var n=e.x-t.x,i=e.y-t.y,l=r.x-t.x,h=r.y-t.y,a=n*l+i*h;return a<0};Nr.interiorAngle=function(e,t,r){var n=Nr.angle(t,e),i=Nr.angle(t,r);return Math.abs(i-n)};Nr.normalizePositive=function(e){if(e<0){for(;e<0;)e+=Nr.PI_TIMES_2;e>=Nr.PI_TIMES_2&&(e=0)}else{for(;e>=Nr.PI_TIMES_2;)e-=Nr.PI_TIMES_2;e<0&&(e=0)}return e};Nr.angleBetween=function(e,t,r){var n=Nr.angle(t,e),i=Nr.angle(t,r);return Nr.diff(n,i)};Nr.diff=function(e,t){var r=null;return e<t?r=t-e:r=e-t,r>Math.PI&&(r=2*Math.PI-r),r};Nr.toRadians=function(e){return e*Math.PI/180};Nr.getTurn=function(e,t){var r=Math.sin(t-e);return r>0?Nr.COUNTERCLOCKWISE:r<0?Nr.CLOCKWISE:Nr.NONE};Nr.angleBetweenOriented=function(e,t,r){var n=Nr.angle(t,e),i=Nr.angle(t,r),l=i-n;return l<=-Math.PI?l+Nr.PI_TIMES_2:l>Math.PI?l-Nr.PI_TIMES_2:l};ed.PI_TIMES_2.get=function(){return 2*Math.PI};ed.PI_OVER_2.get=function(){return Math.PI/2};ed.PI_OVER_4.get=function(){return Math.PI/4};ed.COUNTERCLOCKWISE.get=function(){return Ie.COUNTERCLOCKWISE};ed.CLOCKWISE.get=function(){return Ie.CLOCKWISE};ed.NONE.get=function(){return Ie.COLLINEAR};Object.defineProperties(Nr,ed);var Pn=function e(){this._maxCurveSegmentError=0,this._filletAngleQuantum=null,this._closingSegLengthFactor=1,this._segList=null,this._distance=0,this._precisionModel=null,this._bufParams=null,this._li=null,this._s0=null,this._s1=null,this._s2=null,this._seg0=new Ge,this._seg1=new Ge,this._offset0=new Ge,this._offset1=new Ge,this._side=0,this._hasNarrowConcaveAngle=!1;var t=arguments[0],r=arguments[1],n=arguments[2];this._precisionModel=t,this._bufParams=r,this._li=new lp,this._filletAngleQuantum=Math.PI/2/r.getQuadrantSegments(),r.getQuadrantSegments()>=8&&r.getJoinStyle()===Zr.JOIN_ROUND&&(this._closingSegLengthFactor=e.MAX_CLOSING_SEG_LEN_FACTOR),this.init(n)},Mg={OFFSET_SEGMENT_SEPARATION_FACTOR:{configurable:!0},INSIDE_TURN_VERTEX_SNAP_DISTANCE_FACTOR:{configurable:!0},CURVE_VERTEX_SNAP_DISTANCE_FACTOR:{configurable:!0},MAX_CLOSING_SEG_LEN_FACTOR:{configurable:!0}};Pn.prototype.addNextSegment=function(e,t){if(this._s0=this._s1,this._s1=this._s2,this._s2=e,this._seg0.setCoordinates(this._s0,this._s1),this.computeOffsetSegment(this._seg0,this._side,this._distance,this._offset0),this._seg1.setCoordinates(this._s1,this._s2),this.computeOffsetSegment(this._seg1,this._side,this._distance,this._offset1),this._s1.equals(this._s2))return null;var r=Ie.computeOrientation(this._s0,this._s1,this._s2),n=r===Ie.CLOCKWISE&&this._side===se.LEFT||r===Ie.COUNTERCLOCKWISE&&this._side===se.RIGHT;r===0?this.addCollinear(t):n?this.addOutsideTurn(r,t):this.addInsideTurn(r,t)};Pn.prototype.addLineEndCap=function(e,t){var r=new Ge(e,t),n=new Ge;this.computeOffsetSegment(r,se.LEFT,this._distance,n);var i=new Ge;this.computeOffsetSegment(r,se.RIGHT,this._distance,i);var l=t.x-e.x,h=t.y-e.y,a=Math.atan2(h,l);switch(this._bufParams.getEndCapStyle()){case Zr.CAP_ROUND:this._segList.addPt(n.p1),this.addFilletArc(t,a+Math.PI/2,a-Math.PI/2,Ie.CLOCKWISE,this._distance),this._segList.addPt(i.p1);break;case Zr.CAP_FLAT:this._segList.addPt(n.p1),this._segList.addPt(i.p1);break;case Zr.CAP_SQUARE:var g=new kt;g.x=Math.abs(this._distance)*Math.cos(a),g.y=Math.abs(this._distance)*Math.sin(a);var _=new kt(n.p1.x+g.x,n.p1.y+g.y),E=new kt(i.p1.x+g.x,i.p1.y+g.y);this._segList.addPt(_),this._segList.addPt(E);break}};Pn.prototype.getCoordinates=function(){var e=this._segList.getCoordinates();return e};Pn.prototype.addMitreJoin=function(e,t,r,n){var i=!0,l=null;try{l=$a.intersection(t.p0,t.p1,r.p0,r.p1);var h=n<=0?1:l.distance(e)/Math.abs(n);h>this._bufParams.getMitreLimit()&&(i=!1)}catch(a){if(a instanceof _f)l=new kt(0,0),i=!1;else throw a}finally{}i?this._segList.addPt(l):this.addLimitedMitreJoin(t,r,n,this._bufParams.getMitreLimit())};Pn.prototype.addFilletCorner=function(e,t,r,n,i){var l=t.x-e.x,h=t.y-e.y,a=Math.atan2(h,l),g=r.x-e.x,_=r.y-e.y,E=Math.atan2(_,g);n===Ie.CLOCKWISE?a<=E&&(a+=2*Math.PI):a>=E&&(a-=2*Math.PI),this._segList.addPt(t),this.addFilletArc(e,a,E,n,i),this._segList.addPt(r)};Pn.prototype.addOutsideTurn=function(e,t){if(this._offset0.p1.distance(this._offset1.p0)<this._distance*Pn.OFFSET_SEGMENT_SEPARATION_FACTOR)return this._segList.addPt(this._offset0.p1),null;this._bufParams.getJoinStyle()===Zr.JOIN_MITRE?this.addMitreJoin(this._s1,this._offset0,this._offset1,this._distance):this._bufParams.getJoinStyle()===Zr.JOIN_BEVEL?this.addBevelJoin(this._offset0,this._offset1):(t&&this._segList.addPt(this._offset0.p1),this.addFilletCorner(this._s1,this._offset0.p1,this._offset1.p0,e,this._distance),this._segList.addPt(this._offset1.p0))};Pn.prototype.createSquare=function(e){this._segList.addPt(new kt(e.x+this._distance,e.y+this._distance)),this._segList.addPt(new kt(e.x+this._distance,e.y-this._distance)),this._segList.addPt(new kt(e.x-this._distance,e.y-this._distance)),this._segList.addPt(new kt(e.x-this._distance,e.y+this._distance)),this._segList.closeRing()};Pn.prototype.addSegments=function(e,t){this._segList.addPts(e,t)};Pn.prototype.addFirstSegment=function(){this._segList.addPt(this._offset1.p0)};Pn.prototype.addLastSegment=function(){this._segList.addPt(this._offset1.p1)};Pn.prototype.initSideSegments=function(e,t,r){this._s1=e,this._s2=t,this._side=r,this._seg1.setCoordinates(e,t),this.computeOffsetSegment(this._seg1,r,this._distance,this._offset1)};Pn.prototype.addLimitedMitreJoin=function(e,t,r,n){var i=this._seg0.p1,l=Nr.angle(i,this._seg0.p0),h=Nr.angleBetweenOriented(this._seg0.p0,i,this._seg1.p1),a=h/2,g=Nr.normalize(l+a),_=Nr.normalize(g+Math.PI),E=n*r,S=E*Math.abs(Math.sin(a)),A=r-S,O=i.x+E*Math.cos(_),k=i.y+E*Math.sin(_),G=new kt(O,k),W=new Ge(i,G),U=W.pointAlongOffset(1,A),tt=W.pointAlongOffset(1,-A);this._side===se.LEFT?(this._segList.addPt(U),this._segList.addPt(tt)):(this._segList.addPt(tt),this._segList.addPt(U))};Pn.prototype.computeOffsetSegment=function(e,t,r,n){var i=t===se.LEFT?1:-1,l=e.p1.x-e.p0.x,h=e.p1.y-e.p0.y,a=Math.sqrt(l*l+h*h),g=i*r*l/a,_=i*r*h/a;n.p0.x=e.p0.x-_,n.p0.y=e.p0.y+g,n.p1.x=e.p1.x-_,n.p1.y=e.p1.y+g};Pn.prototype.addFilletArc=function(e,t,r,n,i){var l=this,h=n===Ie.CLOCKWISE?-1:1,a=Math.abs(t-r),g=Math.trunc(a/this._filletAngleQuantum+.5);if(g<1)return null;for(var _=0,E=a/g,S=_,A=new kt;S<a;){var O=t+h*S;A.x=e.x+i*Math.cos(O),A.y=e.y+i*Math.sin(O),l._segList.addPt(A),S+=E}};Pn.prototype.addInsideTurn=function(e,t){if(this._li.computeIntersection(this._offset0.p0,this._offset0.p1,this._offset1.p0,this._offset1.p1),this._li.hasIntersection())this._segList.addPt(this._li.getIntersection(0));else if(this._hasNarrowConcaveAngle=!0,this._offset0.p1.distance(this._offset1.p0)<this._distance*Pn.INSIDE_TURN_VERTEX_SNAP_DISTANCE_FACTOR)this._segList.addPt(this._offset0.p1);else{if(this._segList.addPt(this._offset0.p1),this._closingSegLengthFactor>0){var r=new kt((this._closingSegLengthFactor*this._offset0.p1.x+this._s1.x)/(this._closingSegLengthFactor+1),(this._closingSegLengthFactor*this._offset0.p1.y+this._s1.y)/(this._closingSegLengthFactor+1));this._segList.addPt(r);var n=new kt((this._closingSegLengthFactor*this._offset1.p0.x+this._s1.x)/(this._closingSegLengthFactor+1),(this._closingSegLengthFactor*this._offset1.p0.y+this._s1.y)/(this._closingSegLengthFactor+1));this._segList.addPt(n)}else this._segList.addPt(this._s1);this._segList.addPt(this._offset1.p0)}};Pn.prototype.createCircle=function(e){var t=new kt(e.x+this._distance,e.y);this._segList.addPt(t),this.addFilletArc(e,0,2*Math.PI,-1,this._distance),this._segList.closeRing()};Pn.prototype.addBevelJoin=function(e,t){this._segList.addPt(e.p1),this._segList.addPt(t.p0)};Pn.prototype.init=function(e){this._distance=e,this._maxCurveSegmentError=e*(1-Math.cos(this._filletAngleQuantum/2)),this._segList=new ta,this._segList.setPrecisionModel(this._precisionModel),this._segList.setMinimumVertexDistance(e*Pn.CURVE_VERTEX_SNAP_DISTANCE_FACTOR)};Pn.prototype.addCollinear=function(e){this._li.computeIntersection(this._s0,this._s1,this._s1,this._s2);var t=this._li.getIntersectionNum();t>=2&&(this._bufParams.getJoinStyle()===Zr.JOIN_BEVEL||this._bufParams.getJoinStyle()===Zr.JOIN_MITRE?(e&&this._segList.addPt(this._offset0.p1),this._segList.addPt(this._offset1.p0)):this.addFilletCorner(this._s1,this._offset0.p1,this._offset1.p0,Ie.CLOCKWISE,this._distance))};Pn.prototype.closeRing=function(){this._segList.closeRing()};Pn.prototype.hasNarrowConcaveAngle=function(){return this._hasNarrowConcaveAngle};Pn.prototype.interfaces_=function(){return[]};Pn.prototype.getClass=function(){return Pn};Mg.OFFSET_SEGMENT_SEPARATION_FACTOR.get=function(){return .001};Mg.INSIDE_TURN_VERTEX_SNAP_DISTANCE_FACTOR.get=function(){return .001};Mg.CURVE_VERTEX_SNAP_DISTANCE_FACTOR.get=function(){return 1e-6};Mg.MAX_CLOSING_SEG_LEN_FACTOR.get=function(){return 80};Object.defineProperties(Pn,Mg);var os=function(){this._distance=0,this._precisionModel=null,this._bufParams=null;var e=arguments[0],t=arguments[1];this._precisionModel=e,this._bufParams=t};os.prototype.getOffsetCurve=function(e,t){if(this._distance=t,t===0)return null;var r=t<0,n=Math.abs(t),i=this.getSegGen(n);e.length<=1?this.computePointCurve(e[0],i):this.computeOffsetCurve(e,r,i);var l=i.getCoordinates();return r&&Sr.reverse(l),l};os.prototype.computeSingleSidedBufferCurve=function(e,t,r){var n=this.simplifyTolerance(this._distance);if(t){r.addSegments(e,!0);var i=Yn.simplify(e,-n),l=i.length-1;r.initSideSegments(i[l],i[l-1],se.LEFT),r.addFirstSegment();for(var h=l-2;h>=0;h--)r.addNextSegment(i[h],!0)}else{r.addSegments(e,!1);var a=Yn.simplify(e,n),g=a.length-1;r.initSideSegments(a[0],a[1],se.LEFT),r.addFirstSegment();for(var _=2;_<=g;_++)r.addNextSegment(a[_],!0)}r.addLastSegment(),r.closeRing()};os.prototype.computeRingBufferCurve=function(e,t,r){var n=this.simplifyTolerance(this._distance);t===se.RIGHT&&(n=-n);var i=Yn.simplify(e,n),l=i.length-1;r.initSideSegments(i[l-1],i[0],t);for(var h=1;h<=l;h++){var a=h!==1;r.addNextSegment(i[h],a)}r.closeRing()};os.prototype.computeLineBufferCurve=function(e,t){var r=this.simplifyTolerance(this._distance),n=Yn.simplify(e,r),i=n.length-1;t.initSideSegments(n[0],n[1],se.LEFT);for(var l=2;l<=i;l++)t.addNextSegment(n[l],!0);t.addLastSegment(),t.addLineEndCap(n[i-1],n[i]);var h=Yn.simplify(e,-r),a=h.length-1;t.initSideSegments(h[a],h[a-1],se.LEFT);for(var g=a-2;g>=0;g--)t.addNextSegment(h[g],!0);t.addLastSegment(),t.addLineEndCap(h[1],h[0]),t.closeRing()};os.prototype.computePointCurve=function(e,t){switch(this._bufParams.getEndCapStyle()){case Zr.CAP_ROUND:t.createCircle(e);break;case Zr.CAP_SQUARE:t.createSquare(e);break}};os.prototype.getLineCurve=function(e,t){if(this._distance=t,t<0&&!this._bufParams.isSingleSided()||t===0)return null;var r=Math.abs(t),n=this.getSegGen(r);if(e.length<=1)this.computePointCurve(e[0],n);else if(this._bufParams.isSingleSided()){var i=t<0;this.computeSingleSidedBufferCurve(e,i,n)}else this.computeLineBufferCurve(e,n);var l=n.getCoordinates();return l};os.prototype.getBufferParameters=function(){return this._bufParams};os.prototype.simplifyTolerance=function(e){return e*this._bufParams.getSimplifyFactor()};os.prototype.getRingCurve=function(e,t,r){if(this._distance=r,e.length<=2)return this.getLineCurve(e,r);if(r===0)return os.copyCoordinates(e);var n=this.getSegGen(r);return this.computeRingBufferCurve(e,t,n),n.getCoordinates()};os.prototype.computeOffsetCurve=function(e,t,r){var n=this.simplifyTolerance(this._distance);if(t){var i=Yn.simplify(e,-n),l=i.length-1;r.initSideSegments(i[l],i[l-1],se.LEFT),r.addFirstSegment();for(var h=l-2;h>=0;h--)r.addNextSegment(i[h],!0)}else{var a=Yn.simplify(e,n),g=a.length-1;r.initSideSegments(a[0],a[1],se.LEFT),r.addFirstSegment();for(var _=2;_<=g;_++)r.addNextSegment(a[_],!0)}r.addLastSegment()};os.prototype.getSegGen=function(e){return new Pn(this._precisionModel,this._bufParams,e)};os.prototype.interfaces_=function(){return[]};os.prototype.getClass=function(){return os};os.copyCoordinates=function(e){for(var t=new Array(e.length).fill(null),r=0;r<t.length;r++)t[r]=new kt(e[r]);return t};var Fp=function(){this._subgraphs=null,this._seg=new Ge,this._cga=new Ie;var e=arguments[0];this._subgraphs=e},QI={DepthSegment:{configurable:!0}};Fp.prototype.findStabbedSegments=function(){var e=this;if(arguments.length===1){for(var t=arguments[0],r=new me,n=this._subgraphs.iterator();n.hasNext();){var i=n.next(),l=i.getEnvelope();t.y<l.getMinY()||t.y>l.getMaxY()||e.findStabbedSegments(t,i.getDirectedEdges(),r)}return r}else if(arguments.length===3){if(rr(arguments[2],Ua)&&arguments[0]instanceof kt&&arguments[1]instanceof cx)for(var h=arguments[0],a=arguments[1],g=arguments[2],_=a.getEdge().getCoordinates(),E=0;E<_.length-1;E++){e._seg.p0=_[E],e._seg.p1=_[E+1],e._seg.p0.y>e._seg.p1.y&&e._seg.reverse();var S=Math.max(e._seg.p0.x,e._seg.p1.x);if(!(S<h.x)&&!e._seg.isHorizontal()&&!(h.y<e._seg.p0.y||h.y>e._seg.p1.y)&&Ie.computeOrientation(e._seg.p0,e._seg.p1,h)!==Ie.RIGHT){var A=a.getDepth(se.LEFT);e._seg.p0.equals(_[E])||(A=a.getDepth(se.RIGHT));var O=new Kh(e._seg,A);g.add(O)}}else if(rr(arguments[2],Ua)&&arguments[0]instanceof kt&&rr(arguments[1],Ua))for(var k=arguments[0],G=arguments[1],W=arguments[2],U=G.iterator();U.hasNext();){var tt=U.next();tt.isForward()&&e.findStabbedSegments(k,tt,W)}}};Fp.prototype.getDepth=function(e){var t=this.findStabbedSegments(e);if(t.size()===0)return 0;var r=Za.min(t);return r._leftDepth};Fp.prototype.interfaces_=function(){return[]};Fp.prototype.getClass=function(){return Fp};QI.DepthSegment.get=function(){return Kh};Object.defineProperties(Fp,QI);var Kh=function(){this._upwardSeg=null,this._leftDepth=null;var e=arguments[0],t=arguments[1];this._upwardSeg=new Ge(e),this._leftDepth=t};Kh.prototype.compareTo=function(e){var t=e;if(this._upwardSeg.minX()>=t._upwardSeg.maxX())return 1;if(this._upwardSeg.maxX()<=t._upwardSeg.minX())return-1;var r=this._upwardSeg.orientationIndex(t._upwardSeg);return r!==0||(r=-1*t._upwardSeg.orientationIndex(this._upwardSeg),r!==0)?r:this._upwardSeg.compareTo(t._upwardSeg)};Kh.prototype.compareX=function(e,t){var r=e.p0.compareTo(t.p0);return r!==0?r:e.p1.compareTo(t.p1)};Kh.prototype.toString=function(){return this._upwardSeg.toString()};Kh.prototype.interfaces_=function(){return[Ia]};Kh.prototype.getClass=function(){return Kh};var Xr=function(e,t,r){this.p0=e||null,this.p1=t||null,this.p2=r||null};Xr.prototype.area=function(){return Xr.area(this.p0,this.p1,this.p2)};Xr.prototype.signedArea=function(){return Xr.signedArea(this.p0,this.p1,this.p2)};Xr.prototype.interpolateZ=function(e){if(e===null)throw new $n("Supplied point is null.");return Xr.interpolateZ(e,this.p0,this.p1,this.p2)};Xr.prototype.longestSideLength=function(){return Xr.longestSideLength(this.p0,this.p1,this.p2)};Xr.prototype.isAcute=function(){return Xr.isAcute(this.p0,this.p1,this.p2)};Xr.prototype.circumcentre=function(){return Xr.circumcentre(this.p0,this.p1,this.p2)};Xr.prototype.area3D=function(){return Xr.area3D(this.p0,this.p1,this.p2)};Xr.prototype.centroid=function(){return Xr.centroid(this.p0,this.p1,this.p2)};Xr.prototype.inCentre=function(){return Xr.inCentre(this.p0,this.p1,this.p2)};Xr.prototype.interfaces_=function(){return[]};Xr.prototype.getClass=function(){return Xr};Xr.area=function(e,t,r){return Math.abs(((r.x-e.x)*(t.y-e.y)-(t.x-e.x)*(r.y-e.y))/2)};Xr.signedArea=function(e,t,r){return((r.x-e.x)*(t.y-e.y)-(t.x-e.x)*(r.y-e.y))/2};Xr.det=function(e,t,r,n){return e*n-t*r};Xr.interpolateZ=function(e,t,r,n){var i=t.x,l=t.y,h=r.x-i,a=n.x-i,g=r.y-l,_=n.y-l,E=h*_-a*g,S=e.x-i,A=e.y-l,O=(_*S-a*A)/E,k=(-g*S+h*A)/E,G=t.z+O*(r.z-t.z)+k*(n.z-t.z);return G};Xr.longestSideLength=function(e,t,r){var n=e.distance(t),i=t.distance(r),l=r.distance(e),h=n;return i>h&&(h=i),l>h&&(h=l),h};Xr.isAcute=function(e,t,r){return!(!Nr.isAcute(e,t,r)||!Nr.isAcute(t,r,e)||!Nr.isAcute(r,e,t))};Xr.circumcentre=function(e,t,r){var n=r.x,i=r.y,l=e.x-n,h=e.y-i,a=t.x-n,g=t.y-i,_=2*Xr.det(l,h,a,g),E=Xr.det(h,l*l+h*h,g,a*a+g*g),S=Xr.det(l,l*l+h*h,a,a*a+g*g),A=n-E/_,O=i+S/_;return new kt(A,O)};Xr.perpendicularBisector=function(e,t){var r=t.x-e.x,n=t.y-e.y,i=new $a(e.x+r/2,e.y+n/2,1),l=new $a(e.x-n+r/2,e.y+r+n/2,1);return new $a(i,l)};Xr.angleBisector=function(e,t,r){var n=t.distance(e),i=t.distance(r),l=n/(n+i),h=r.x-e.x,a=r.y-e.y,g=new kt(e.x+l*h,e.y+l*a);return g};Xr.area3D=function(e,t,r){var n=t.x-e.x,i=t.y-e.y,l=t.z-e.z,h=r.x-e.x,a=r.y-e.y,g=r.z-e.z,_=i*g-l*a,E=l*h-n*g,S=n*a-i*h,A=_*_+E*E+S*S,O=Math.sqrt(A)/2;return O};Xr.centroid=function(e,t,r){var n=(e.x+t.x+r.x)/3,i=(e.y+t.y+r.y)/3;return new kt(n,i)};Xr.inCentre=function(e,t,r){var n=t.distance(r),i=e.distance(r),l=e.distance(t),h=n+i+l,a=(n*e.x+i*t.x+l*r.x)/h,g=(n*e.y+i*t.y+l*r.y)/h;return new kt(a,g)};var Sa=function(){this._inputGeom=null,this._distance=null,this._curveBuilder=null,this._curveList=new me;var e=arguments[0],t=arguments[1],r=arguments[2];this._inputGeom=e,this._distance=t,this._curveBuilder=r};Sa.prototype.addPoint=function(e){if(this._distance<=0)return null;var t=e.getCoordinates(),r=this._curveBuilder.getLineCurve(t,this._distance);this.addCurve(r,Bt.EXTERIOR,Bt.INTERIOR)};Sa.prototype.addPolygon=function(e){var t=this,r=this._distance,n=se.LEFT;this._distance<0&&(r=-this._distance,n=se.RIGHT);var i=e.getExteriorRing(),l=Sr.removeRepeatedPoints(i.getCoordinates());if(this._distance<0&&this.isErodedCompletely(i,this._distance)||this._distance<=0&&l.length<3)return null;this.addPolygonRing(l,r,n,Bt.EXTERIOR,Bt.INTERIOR);for(var h=0;h<e.getNumInteriorRing();h++){var a=e.getInteriorRingN(h),g=Sr.removeRepeatedPoints(a.getCoordinates());t._distance>0&&t.isErodedCompletely(a,-t._distance)||t.addPolygonRing(g,r,se.opposite(n),Bt.INTERIOR,Bt.EXTERIOR)}};Sa.prototype.isTriangleErodedCompletely=function(e,t){var r=new Xr(e[0],e[1],e[2]),n=r.inCentre(),i=Ie.distancePointLine(n,r.p0,r.p1);return i<Math.abs(t)};Sa.prototype.addLineString=function(e){if(this._distance<=0&&!this._curveBuilder.getBufferParameters().isSingleSided())return null;var t=Sr.removeRepeatedPoints(e.getCoordinates()),r=this._curveBuilder.getLineCurve(t,this._distance);this.addCurve(r,Bt.EXTERIOR,Bt.INTERIOR)};Sa.prototype.addCurve=function(e,t,r){if(e===null||e.length<2)return null;var n=new si(e,new an(0,Bt.BOUNDARY,t,r));this._curveList.add(n)};Sa.prototype.getCurves=function(){return this.add(this._inputGeom),this._curveList};Sa.prototype.addPolygonRing=function(e,t,r,n,i){if(t===0&&e.length<cu.MINIMUM_VALID_SIZE)return null;var l=n,h=i;e.length>=cu.MINIMUM_VALID_SIZE&&Ie.isCCW(e)&&(l=i,h=n,r=se.opposite(r));var a=this._curveBuilder.getRingCurve(e,r,t);this.addCurve(a,l,h)};Sa.prototype.add=function(e){if(e.isEmpty())return null;e instanceof Li?this.addPolygon(e):e instanceof Hn?this.addLineString(e):e instanceof Is?this.addPoint(e):e instanceof Qd?this.addCollection(e):e instanceof Hh?this.addCollection(e):e instanceof su?this.addCollection(e):e instanceof qo&&this.addCollection(e)};Sa.prototype.isErodedCompletely=function(e,t){var r=e.getCoordinates();if(r.length<4)return t<0;if(r.length===4)return this.isTriangleErodedCompletely(r,t);var n=e.getEnvelopeInternal(),i=Math.min(n.getHeight(),n.getWidth());return t<0&&2*Math.abs(t)>i};Sa.prototype.addCollection=function(e){for(var t=this,r=0;r<e.getNumGeometries();r++){var n=e.getGeometryN(r);t.add(n)}};Sa.prototype.interfaces_=function(){return[]};Sa.prototype.getClass=function(){return Sa};var nf=function(){};nf.prototype.locate=function(e){};nf.prototype.interfaces_=function(){return[]};nf.prototype.getClass=function(){return nf};var au=function(){this._parent=null,this._atStart=null,this._max=null,this._index=null,this._subcollectionIterator=null;var e=arguments[0];this._parent=e,this._atStart=!0,this._index=0,this._max=e.getNumGeometries()};au.prototype.next=function(){if(this._atStart)return this._atStart=!1,au.isAtomic(this._parent)&&this._index++,this._parent;if(this._subcollectionIterator!==null){if(this._subcollectionIterator.hasNext())return this._subcollectionIterator.next();this._subcollectionIterator=null}if(this._index>=this._max)throw new xf;var e=this._parent.getGeometryN(this._index++);return e instanceof qo?(this._subcollectionIterator=new au(e),this._subcollectionIterator.next()):e};au.prototype.remove=function(){throw new Error(this.getClass().getName())};au.prototype.hasNext=function(){if(this._atStart)return!0;if(this._subcollectionIterator!==null){if(this._subcollectionIterator.hasNext())return!0;this._subcollectionIterator=null}return!(this._index>=this._max)};au.prototype.interfaces_=function(){return[vf]};au.prototype.getClass=function(){return au};au.isAtomic=function(e){return!(e instanceof qo)};var Hs=function(){this._geom=null;var e=arguments[0];this._geom=e};Hs.prototype.locate=function(e){return Hs.locate(e,this._geom)};Hs.prototype.interfaces_=function(){return[nf]};Hs.prototype.getClass=function(){return Hs};Hs.isPointInRing=function(e,t){return t.getEnvelopeInternal().intersects(e)?Ie.isPointInRing(e,t.getCoordinates()):!1};Hs.containsPointInPolygon=function(e,t){if(t.isEmpty())return!1;var r=t.getExteriorRing();if(!Hs.isPointInRing(e,r))return!1;for(var n=0;n<t.getNumInteriorRing();n++){var i=t.getInteriorRingN(n);if(Hs.isPointInRing(e,i))return!1}return!0};Hs.containsPoint=function(e,t){if(t instanceof Li)return Hs.containsPointInPolygon(e,t);if(t instanceof qo)for(var r=new au(t);r.hasNext();){var n=r.next();if(n!==t&&Hs.containsPoint(e,n))return!0}return!1};Hs.locate=function(e,t){return t.isEmpty()?Bt.EXTERIOR:Hs.containsPoint(e,t)?Bt.INTERIOR:Bt.EXTERIOR};var To=function(){this._edgeMap=new Eo,this._edgeList=null,this._ptInAreaLocation=[Bt.NONE,Bt.NONE]};To.prototype.getNextCW=function(e){this.getEdges();var t=this._edgeList.indexOf(e),r=t-1;return t===0&&(r=this._edgeList.size()-1),this._edgeList.get(r)};To.prototype.propagateSideLabels=function(e){for(var t=Bt.NONE,r=this.iterator();r.hasNext();){var n=r.next(),i=n.getLabel();i.isArea(e)&&i.getLocation(e,se.LEFT)!==Bt.NONE&&(t=i.getLocation(e,se.LEFT))}if(t===Bt.NONE)return null;for(var l=t,h=this.iterator();h.hasNext();){var a=h.next(),g=a.getLabel();if(g.getLocation(e,se.ON)===Bt.NONE&&g.setLocation(e,se.ON,l),g.isArea(e)){var _=g.getLocation(e,se.LEFT),E=g.getLocation(e,se.RIGHT);if(E!==Bt.NONE){if(E!==l)throw new qu("side location conflict",a.getCoordinate());_===Bt.NONE&&dr.shouldNeverReachHere("found single null side (at "+a.getCoordinate()+")"),l=_}else dr.isTrue(g.getLocation(e,se.LEFT)===Bt.NONE,"found single null side"),g.setLocation(e,se.RIGHT,l),g.setLocation(e,se.LEFT,l)}}};To.prototype.getCoordinate=function(){var e=this.iterator();if(!e.hasNext())return null;var t=e.next();return t.getCoordinate()};To.prototype.print=function(e){so.out.println("EdgeEndStar:   "+this.getCoordinate());for(var t=this.iterator();t.hasNext();){var r=t.next();r.print(e)}};To.prototype.isAreaLabelsConsistent=function(e){return this.computeEdgeEndLabels(e.getBoundaryNodeRule()),this.checkAreaLabelsConsistent(0)};To.prototype.checkAreaLabelsConsistent=function(e){var t=this.getEdges();if(t.size()<=0)return!0;var r=t.size()-1,n=t.get(r).getLabel(),i=n.getLocation(e,se.LEFT);dr.isTrue(i!==Bt.NONE,"Found unlabelled area edge");for(var l=i,h=this.iterator();h.hasNext();){var a=h.next(),g=a.getLabel();dr.isTrue(g.isArea(e),"Found non-area edge");var _=g.getLocation(e,se.LEFT),E=g.getLocation(e,se.RIGHT);if(_===E||E!==l)return!1;l=_}return!0};To.prototype.findIndex=function(e){var t=this;this.iterator();for(var r=0;r<this._edgeList.size();r++){var n=t._edgeList.get(r);if(n===e)return r}return-1};To.prototype.iterator=function(){return this.getEdges().iterator()};To.prototype.getEdges=function(){return this._edgeList===null&&(this._edgeList=new me(this._edgeMap.values())),this._edgeList};To.prototype.getLocation=function(e,t,r){return this._ptInAreaLocation[e]===Bt.NONE&&(this._ptInAreaLocation[e]=Hs.locate(t,r[e].getGeometry())),this._ptInAreaLocation[e]};To.prototype.toString=function(){var e=new zl;e.append("EdgeEndStar:   "+this.getCoordinate()),e.append(`
`);for(var t=this.iterator();t.hasNext();){var r=t.next();e.append(r),e.append(`
`)}return e.toString()};To.prototype.computeEdgeEndLabels=function(e){for(var t=this.iterator();t.hasNext();){var r=t.next();r.computeLabel(e)}};To.prototype.computeLabelling=function(e){var t=this;this.computeEdgeEndLabels(e[0].getBoundaryNodeRule()),this.propagateSideLabels(0),this.propagateSideLabels(1);for(var r=[!1,!1],n=this.iterator();n.hasNext();)for(var i=n.next(),l=i.getLabel(),h=0;h<2;h++)l.isLine(h)&&l.getLocation(h)===Bt.BOUNDARY&&(r[h]=!0);for(var a=this.iterator();a.hasNext();)for(var g=a.next(),_=g.getLabel(),E=0;E<2;E++)if(_.isAnyNull(E)){var S=Bt.NONE;if(r[E])S=Bt.EXTERIOR;else{var A=g.getCoordinate();S=t.getLocation(E,A,e)}_.setAllLocationsIfNull(E,S)}};To.prototype.getDegree=function(){return this._edgeMap.size()};To.prototype.insertEdgeEnd=function(e,t){this._edgeMap.put(e,t),this._edgeList=null};To.prototype.interfaces_=function(){return[]};To.prototype.getClass=function(){return To};var n5=function(e){function t(){e.call(this),this._resultAreaEdgeList=null,this._label=null,this._SCANNING_FOR_INCOMING=1,this._LINKING_TO_OUTGOING=2}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.linkResultDirectedEdges=function(){var r=this;this.getResultAreaEdges();for(var n=null,i=null,l=this._SCANNING_FOR_INCOMING,h=0;h<this._resultAreaEdgeList.size();h++){var a=r._resultAreaEdgeList.get(h),g=a.getSym();if(a.getLabel().isArea())switch(n===null&&a.isInResult()&&(n=a),l){case r._SCANNING_FOR_INCOMING:if(!g.isInResult())continue;i=g,l=r._LINKING_TO_OUTGOING;break;case r._LINKING_TO_OUTGOING:if(!a.isInResult())continue;i.setNext(a),l=r._SCANNING_FOR_INCOMING;break}}if(l===this._LINKING_TO_OUTGOING){if(n===null)throw new qu("no outgoing dirEdge found",this.getCoordinate());dr.isTrue(n.isInResult(),"unable to link last incoming dirEdge"),i.setNext(n)}},t.prototype.insert=function(r){var n=r;this.insertEdgeEnd(n,n)},t.prototype.getRightmostEdge=function(){var r=this.getEdges(),n=r.size();if(n<1)return null;var i=r.get(0);if(n===1)return i;var l=r.get(n-1),h=i.getQuadrant(),a=l.getQuadrant();return cn.isNorthern(h)&&cn.isNorthern(a)?i:!cn.isNorthern(h)&&!cn.isNorthern(a)?l:i.getDy()!==0?i:l.getDy()!==0?l:(dr.shouldNeverReachHere("found two horizontal edges incident on node"),null)},t.prototype.print=function(r){so.out.println("DirectedEdgeStar: "+this.getCoordinate());for(var n=this.iterator();n.hasNext();){var i=n.next();r.print("out "),i.print(r),r.println(),r.print("in "),i.getSym().print(r),r.println()}},t.prototype.getResultAreaEdges=function(){var r=this;if(this._resultAreaEdgeList!==null)return this._resultAreaEdgeList;this._resultAreaEdgeList=new me;for(var n=this.iterator();n.hasNext();){var i=n.next();(i.isInResult()||i.getSym().isInResult())&&r._resultAreaEdgeList.add(i)}return this._resultAreaEdgeList},t.prototype.updateLabelling=function(r){for(var n=this.iterator();n.hasNext();){var i=n.next(),l=i.getLabel();l.setAllLocationsIfNull(0,r.getLocation(0)),l.setAllLocationsIfNull(1,r.getLocation(1))}},t.prototype.linkAllDirectedEdges=function(){var r=this;this.getEdges();for(var n=null,i=null,l=this._edgeList.size()-1;l>=0;l--){var h=r._edgeList.get(l),a=h.getSym();i===null&&(i=a),n!==null&&a.setNext(n),n=h}i.setNext(n)},t.prototype.computeDepths=function(){var r=this;if(arguments.length===1){var n=arguments[0],i=this.findIndex(n),l=n.getDepth(se.LEFT),h=n.getDepth(se.RIGHT),a=this.computeDepths(i+1,this._edgeList.size(),l),g=this.computeDepths(0,i,a);if(g!==h)throw new qu("depth mismatch at "+n.getCoordinate())}else if(arguments.length===3){for(var _=arguments[0],E=arguments[1],S=arguments[2],A=S,O=_;O<E;O++){var k=r._edgeList.get(O);k.setEdgeDepths(se.RIGHT,A),A=k.getDepth(se.LEFT)}return A}},t.prototype.mergeSymLabels=function(){for(var r=this.iterator();r.hasNext();){var n=r.next(),i=n.getLabel();i.merge(n.getSym().getLabel())}},t.prototype.linkMinimalDirectedEdges=function(r){for(var n=this,i=null,l=null,h=this._SCANNING_FOR_INCOMING,a=this._resultAreaEdgeList.size()-1;a>=0;a--){var g=n._resultAreaEdgeList.get(a),_=g.getSym();switch(i===null&&g.getEdgeRing()===r&&(i=g),h){case n._SCANNING_FOR_INCOMING:if(_.getEdgeRing()!==r)continue;l=_,h=n._LINKING_TO_OUTGOING;break;case n._LINKING_TO_OUTGOING:if(g.getEdgeRing()!==r)continue;l.setNextMin(g),h=n._SCANNING_FOR_INCOMING;break}}h===this._LINKING_TO_OUTGOING&&(dr.isTrue(i!==null,"found null for first outgoing dirEdge"),dr.isTrue(i.getEdgeRing()===r,"unable to link last incoming dirEdge"),l.setNextMin(i))},t.prototype.getOutgoingDegree=function(){if(arguments.length===0){for(var r=0,n=this.iterator();n.hasNext();){var i=n.next();i.isInResult()&&r++}return r}else if(arguments.length===1){for(var l=arguments[0],h=0,a=this.iterator();a.hasNext();){var g=a.next();g.getEdgeRing()===l&&h++}return h}},t.prototype.getLabel=function(){return this._label},t.prototype.findCoveredLineEdges=function(){for(var r=Bt.NONE,n=this.iterator();n.hasNext();){var i=n.next(),l=i.getSym();if(!i.isLineEdge()){if(i.isInResult()){r=Bt.INTERIOR;break}if(l.isInResult()){r=Bt.EXTERIOR;break}}}if(r===Bt.NONE)return null;for(var h=r,a=this.iterator();a.hasNext();){var g=a.next(),_=g.getSym();g.isLineEdge()?g.getEdge().setCovered(h===Bt.INTERIOR):(g.isInResult()&&(h=Bt.EXTERIOR),_.isInResult()&&(h=Bt.INTERIOR))}},t.prototype.computeLabelling=function(r){var n=this;e.prototype.computeLabelling.call(this,r),this._label=new an(Bt.NONE);for(var i=this.iterator();i.hasNext();)for(var l=i.next(),h=l.getEdge(),a=h.getLabel(),g=0;g<2;g++){var _=a.getLocation(g);(_===Bt.INTERIOR||_===Bt.BOUNDARY)&&n._label.setLocation(g,Bt.INTERIOR)}},t.prototype.interfaces_=function(){return[]},t.prototype.getClass=function(){return t},t}(To),tC=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.createNode=function(r){return new n0(r,new n5)},t.prototype.interfaces_=function(){return[]},t.prototype.getClass=function(){return t},t}(tf),Zc=function e(){this._pts=null,this._orientation=null;var t=arguments[0];this._pts=t,this._orientation=e.orientation(t)};Zc.prototype.compareTo=function(e){var t=e,r=Zc.compareOriented(this._pts,this._orientation,t._pts,t._orientation);return r};Zc.prototype.interfaces_=function(){return[Ia]};Zc.prototype.getClass=function(){return Zc};Zc.orientation=function(e){return Sr.increasingDirection(e)===1};Zc.compareOriented=function(e,t,r,n){for(var i=t?1:-1,l=n?1:-1,h=t?e.length:-1,a=n?r.length:-1,g=t?0:e.length-1,_=n?0:r.length-1;;){var E=e[g].compareTo(r[_]);if(E!==0)return E;g+=i,_+=l;var S=g===h,A=_===a;if(S&&!A)return-1;if(!S&&A)return 1;if(S&&A)return 0}};var Wa=function(){this._edges=new me,this._ocaMap=new Eo};Wa.prototype.print=function(e){var t=this;e.print("MULTILINESTRING ( ");for(var r=0;r<this._edges.size();r++){var n=t._edges.get(r);r>0&&e.print(","),e.print("(");for(var i=n.getCoordinates(),l=0;l<i.length;l++)l>0&&e.print(","),e.print(i[l].x+" "+i[l].y);e.println(")")}e.print(")  ")};Wa.prototype.addAll=function(e){for(var t=this,r=e.iterator();r.hasNext();)t.add(r.next())};Wa.prototype.findEdgeIndex=function(e){for(var t=this,r=0;r<this._edges.size();r++)if(t._edges.get(r).equals(e))return r;return-1};Wa.prototype.iterator=function(){return this._edges.iterator()};Wa.prototype.getEdges=function(){return this._edges};Wa.prototype.get=function(e){return this._edges.get(e)};Wa.prototype.findEqualEdge=function(e){var t=new Zc(e.getCoordinates()),r=this._ocaMap.get(t);return r};Wa.prototype.add=function(e){this._edges.add(e);var t=new Zc(e.getCoordinates());this._ocaMap.put(t,e)};Wa.prototype.interfaces_=function(){return[]};Wa.prototype.getClass=function(){return Wa};var Jh=function(){};Jh.prototype.processIntersections=function(e,t,r,n){};Jh.prototype.isDone=function(){};Jh.prototype.interfaces_=function(){return[]};Jh.prototype.getClass=function(){return Jh};var ea=function(){this._hasIntersection=!1,this._hasProper=!1,this._hasProperInterior=!1,this._hasInterior=!1,this._properIntersectionPoint=null,this._li=null,this._isSelfIntersection=null,this.numIntersections=0,this.numInteriorIntersections=0,this.numProperIntersections=0,this.numTests=0;var e=arguments[0];this._li=e};ea.prototype.isTrivialIntersection=function(e,t,r,n){if(e===r&&this._li.getIntersectionNum()===1){if(ea.isAdjacentSegments(t,n))return!0;if(e.isClosed()){var i=e.size()-1;if(t===0&&n===i||n===0&&t===i)return!0}}return!1};ea.prototype.getProperIntersectionPoint=function(){return this._properIntersectionPoint};ea.prototype.hasProperInteriorIntersection=function(){return this._hasProperInterior};ea.prototype.getLineIntersector=function(){return this._li};ea.prototype.hasProperIntersection=function(){return this._hasProper};ea.prototype.processIntersections=function(e,t,r,n){if(e===r&&t===n)return null;this.numTests++;var i=e.getCoordinates()[t],l=e.getCoordinates()[t+1],h=r.getCoordinates()[n],a=r.getCoordinates()[n+1];this._li.computeIntersection(i,l,h,a),this._li.hasIntersection()&&(this.numIntersections++,this._li.isInteriorIntersection()&&(this.numInteriorIntersections++,this._hasInterior=!0),this.isTrivialIntersection(e,t,r,n)||(this._hasIntersection=!0,e.addIntersections(this._li,t,0),r.addIntersections(this._li,n,1),this._li.isProper()&&(this.numProperIntersections++,this._hasProper=!0,this._hasProperInterior=!0)))};ea.prototype.hasIntersection=function(){return this._hasIntersection};ea.prototype.isDone=function(){return!1};ea.prototype.hasInteriorIntersection=function(){return this._hasInterior};ea.prototype.interfaces_=function(){return[Jh]};ea.prototype.getClass=function(){return ea};ea.isAdjacentSegments=function(e,t){return Math.abs(e-t)===1};var Nl=function(){this.coord=null,this.segmentIndex=null,this.dist=null;var e=arguments[0],t=arguments[1],r=arguments[2];this.coord=new kt(e),this.segmentIndex=t,this.dist=r};Nl.prototype.getSegmentIndex=function(){return this.segmentIndex};Nl.prototype.getCoordinate=function(){return this.coord};Nl.prototype.print=function(e){e.print(this.coord),e.print(" seg # = "+this.segmentIndex),e.println(" dist = "+this.dist)};Nl.prototype.compareTo=function(e){var t=e;return this.compare(t.segmentIndex,t.dist)};Nl.prototype.isEndPoint=function(e){return this.segmentIndex===0&&this.dist===0||this.segmentIndex===e};Nl.prototype.toString=function(){return this.coord+" seg # = "+this.segmentIndex+" dist = "+this.dist};Nl.prototype.getDistance=function(){return this.dist};Nl.prototype.compare=function(e,t){return this.segmentIndex<e?-1:this.segmentIndex>e?1:this.dist<t?-1:this.dist>t?1:0};Nl.prototype.interfaces_=function(){return[Ia]};Nl.prototype.getClass=function(){return Nl};var du=function(){this._nodeMap=new Eo,this.edge=null;var e=arguments[0];this.edge=e};du.prototype.print=function(e){e.println("Intersections:");for(var t=this.iterator();t.hasNext();){var r=t.next();r.print(e)}};du.prototype.iterator=function(){return this._nodeMap.values().iterator()};du.prototype.addSplitEdges=function(e){var t=this;this.addEndpoints();for(var r=this.iterator(),n=r.next();r.hasNext();){var i=r.next(),l=t.createSplitEdge(n,i);e.add(l),n=i}};du.prototype.addEndpoints=function(){var e=this.edge.pts.length-1;this.add(this.edge.pts[0],0,0),this.add(this.edge.pts[e],e,0)};du.prototype.createSplitEdge=function(e,t){var r=this,n=t.segmentIndex-e.segmentIndex+2,i=this.edge.pts[t.segmentIndex],l=t.dist>0||!t.coord.equals2D(i);l||n--;var h=new Array(n).fill(null),a=0;h[a++]=new kt(e.coord);for(var g=e.segmentIndex+1;g<=t.segmentIndex;g++)h[a++]=r.edge.pts[g];return l&&(h[a]=t.coord),new b_(h,new an(this.edge._label))};du.prototype.add=function(e,t,r){var n=new Nl(e,t,r),i=this._nodeMap.get(n);return i!==null?i:(this._nodeMap.put(n,n),n)};du.prototype.isIntersection=function(e){for(var t=this.iterator();t.hasNext();){var r=t.next();if(r.coord.equals(e))return!0}return!1};du.prototype.interfaces_=function(){return[]};du.prototype.getClass=function(){return du};var Qh=function(){};Qh.prototype.getChainStartIndices=function(e){var t=this,r=0,n=new me;n.add(new Ml(r));do{var i=t.findChainEnd(e,r);n.add(new Ml(i)),r=i}while(r<e.length-1);var l=Qh.toIntArray(n);return l};Qh.prototype.findChainEnd=function(e,t){for(var r=cn.quadrant(e[t],e[t+1]),n=t+1;n<e.length;){var i=cn.quadrant(e[n-1],e[n]);if(i!==r)break;n++}return n-1};Qh.prototype.interfaces_=function(){return[]};Qh.prototype.getClass=function(){return Qh};Qh.toIntArray=function(e){for(var t=new Array(e.size()).fill(null),r=0;r<t.length;r++)t[r]=e.get(r).intValue();return t};var Wu=function(){this.e=null,this.pts=null,this.startIndex=null,this.env1=new Ve,this.env2=new Ve;var e=arguments[0];this.e=e,this.pts=e.getCoordinates();var t=new Qh;this.startIndex=t.getChainStartIndices(this.pts)};Wu.prototype.getCoordinates=function(){return this.pts};Wu.prototype.getMaxX=function(e){var t=this.pts[this.startIndex[e]].x,r=this.pts[this.startIndex[e+1]].x;return t>r?t:r};Wu.prototype.getMinX=function(e){var t=this.pts[this.startIndex[e]].x,r=this.pts[this.startIndex[e+1]].x;return t<r?t:r};Wu.prototype.computeIntersectsForChain=function(){if(arguments.length===4){var e=arguments[0],t=arguments[1],r=arguments[2],n=arguments[3];this.computeIntersectsForChain(this.startIndex[e],this.startIndex[e+1],t,t.startIndex[r],t.startIndex[r+1],n)}else if(arguments.length===6){var i=arguments[0],l=arguments[1],h=arguments[2],a=arguments[3],g=arguments[4],_=arguments[5],E=this.pts[i],S=this.pts[l],A=h.pts[a],O=h.pts[g];if(l-i===1&&g-a===1)return _.addIntersections(this.e,i,h.e,a),null;if(this.env1.init(E,S),this.env2.init(A,O),!this.env1.intersects(this.env2))return null;var k=Math.trunc((i+l)/2),G=Math.trunc((a+g)/2);i<k&&(a<G&&this.computeIntersectsForChain(i,k,h,a,G,_),G<g&&this.computeIntersectsForChain(i,k,h,G,g,_)),k<l&&(a<G&&this.computeIntersectsForChain(k,l,h,a,G,_),G<g&&this.computeIntersectsForChain(k,l,h,G,g,_))}};Wu.prototype.getStartIndexes=function(){return this.startIndex};Wu.prototype.computeIntersects=function(e,t){for(var r=this,n=0;n<this.startIndex.length-1;n++)for(var i=0;i<e.startIndex.length-1;i++)r.computeIntersectsForChain(n,e,i,t)};Wu.prototype.interfaces_=function(){return[]};Wu.prototype.getClass=function(){return Wu};var oo=function e(){var t=this;this._depth=Array(2).fill().map(function(){return Array(3)});for(var r=0;r<2;r++)for(var n=0;n<3;n++)t._depth[r][n]=e.NULL_VALUE},eC={NULL_VALUE:{configurable:!0}};oo.prototype.getDepth=function(e,t){return this._depth[e][t]};oo.prototype.setDepth=function(e,t,r){this._depth[e][t]=r};oo.prototype.isNull=function(){var e=this;if(arguments.length===0){for(var t=0;t<2;t++)for(var r=0;r<3;r++)if(e._depth[t][r]!==oo.NULL_VALUE)return!1;return!0}else if(arguments.length===1){var n=arguments[0];return this._depth[n][1]===oo.NULL_VALUE}else if(arguments.length===2){var i=arguments[0],l=arguments[1];return this._depth[i][l]===oo.NULL_VALUE}};oo.prototype.normalize=function(){for(var e=this,t=0;t<2;t++)if(!e.isNull(t)){var r=e._depth[t][1];e._depth[t][2]<r&&(r=e._depth[t][2]),r<0&&(r=0);for(var n=1;n<3;n++){var i=0;e._depth[t][n]>r&&(i=1),e._depth[t][n]=i}}};oo.prototype.getDelta=function(e){return this._depth[e][se.RIGHT]-this._depth[e][se.LEFT]};oo.prototype.getLocation=function(e,t){return this._depth[e][t]<=0?Bt.EXTERIOR:Bt.INTERIOR};oo.prototype.toString=function(){return"A: "+this._depth[0][1]+","+this._depth[0][2]+" B: "+this._depth[1][1]+","+this._depth[1][2]};oo.prototype.add=function(){var e=this;if(arguments.length===1)for(var t=arguments[0],r=0;r<2;r++)for(var n=1;n<3;n++){var i=t.getLocation(r,n);(i===Bt.EXTERIOR||i===Bt.INTERIOR)&&(e.isNull(r,n)?e._depth[r][n]=oo.depthAtLocation(i):e._depth[r][n]+=oo.depthAtLocation(i))}else if(arguments.length===3){var l=arguments[0],h=arguments[1],a=arguments[2];a===Bt.INTERIOR&&this._depth[l][h]++}};oo.prototype.interfaces_=function(){return[]};oo.prototype.getClass=function(){return oo};oo.depthAtLocation=function(e){return e===Bt.EXTERIOR?0:e===Bt.INTERIOR?1:oo.NULL_VALUE};eC.NULL_VALUE.get=function(){return-1};Object.defineProperties(oo,eC);var b_=function(e){function t(){if(e.call(this),this.pts=null,this._env=null,this.eiList=new du(this),this._name=null,this._mce=null,this._isIsolated=!0,this._depth=new oo,this._depthDelta=0,arguments.length===1){var r=arguments[0];t.call(this,r,null)}else if(arguments.length===2){var n=arguments[0],i=arguments[1];this.pts=n,this._label=i}}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.getDepth=function(){return this._depth},t.prototype.getCollapsedEdge=function(){var r=new Array(2).fill(null);r[0]=this.pts[0],r[1]=this.pts[1];var n=new t(r,an.toLineLabel(this._label));return n},t.prototype.isIsolated=function(){return this._isIsolated},t.prototype.getCoordinates=function(){return this.pts},t.prototype.setIsolated=function(r){this._isIsolated=r},t.prototype.setName=function(r){this._name=r},t.prototype.equals=function(r){var n=this;if(!(r instanceof t))return!1;var i=r;if(this.pts.length!==i.pts.length)return!1;for(var l=!0,h=!0,a=this.pts.length,g=0;g<this.pts.length;g++)if(n.pts[g].equals2D(i.pts[g])||(l=!1),n.pts[g].equals2D(i.pts[--a])||(h=!1),!l&&!h)return!1;return!0},t.prototype.getCoordinate=function(){if(arguments.length===0)return this.pts.length>0?this.pts[0]:null;if(arguments.length===1){var r=arguments[0];return this.pts[r]}},t.prototype.print=function(r){var n=this;r.print("edge "+this._name+": "),r.print("LINESTRING (");for(var i=0;i<this.pts.length;i++)i>0&&r.print(","),r.print(n.pts[i].x+" "+n.pts[i].y);r.print(")  "+this._label+" "+this._depthDelta)},t.prototype.computeIM=function(r){t.updateIM(this._label,r)},t.prototype.isCollapsed=function(){return!this._label.isArea()||this.pts.length!==3?!1:!!this.pts[0].equals(this.pts[2])},t.prototype.isClosed=function(){return this.pts[0].equals(this.pts[this.pts.length-1])},t.prototype.getMaximumSegmentIndex=function(){return this.pts.length-1},t.prototype.getDepthDelta=function(){return this._depthDelta},t.prototype.getNumPoints=function(){return this.pts.length},t.prototype.printReverse=function(r){var n=this;r.print("edge "+this._name+": ");for(var i=this.pts.length-1;i>=0;i--)r.print(n.pts[i]+" ");r.println("")},t.prototype.getMonotoneChainEdge=function(){return this._mce===null&&(this._mce=new Wu(this)),this._mce},t.prototype.getEnvelope=function(){var r=this;if(this._env===null){this._env=new Ve;for(var n=0;n<this.pts.length;n++)r._env.expandToInclude(r.pts[n])}return this._env},t.prototype.addIntersection=function(r,n,i,l){var h=new kt(r.getIntersection(l)),a=n,g=r.getEdgeDistance(i,l),_=a+1;if(_<this.pts.length){var E=this.pts[_];h.equals2D(E)&&(a=_,g=0)}this.eiList.add(h,a,g)},t.prototype.toString=function(){var r=this,n=new zl;n.append("edge "+this._name+": "),n.append("LINESTRING (");for(var i=0;i<this.pts.length;i++)i>0&&n.append(","),n.append(r.pts[i].x+" "+r.pts[i].y);return n.append(")  "+this._label+" "+this._depthDelta),n.toString()},t.prototype.isPointwiseEqual=function(r){var n=this;if(this.pts.length!==r.pts.length)return!1;for(var i=0;i<this.pts.length;i++)if(!n.pts[i].equals2D(r.pts[i]))return!1;return!0},t.prototype.setDepthDelta=function(r){this._depthDelta=r},t.prototype.getEdgeIntersectionList=function(){return this.eiList},t.prototype.addIntersections=function(r,n,i){for(var l=this,h=0;h<r.getIntersectionNum();h++)l.addIntersection(r,n,i,h)},t.prototype.interfaces_=function(){return[]},t.prototype.getClass=function(){return t},t.updateIM=function(){if(arguments.length===2){var r=arguments[0],n=arguments[1];n.setAtLeastIfValid(r.getLocation(0,se.ON),r.getLocation(1,se.ON),1),r.isArea()&&(n.setAtLeastIfValid(r.getLocation(0,se.LEFT),r.getLocation(1,se.LEFT),2),n.setAtLeastIfValid(r.getLocation(0,se.RIGHT),r.getLocation(1,se.RIGHT),2))}else return e.prototype.updateIM.apply(this,arguments)},t}(Qs),Vo=function(e){this._workingPrecisionModel=null,this._workingNoder=null,this._geomFact=null,this._graph=null,this._edgeList=new Wa,this._bufParams=e||null};Vo.prototype.setWorkingPrecisionModel=function(e){this._workingPrecisionModel=e};Vo.prototype.insertUniqueEdge=function(e){var t=this._edgeList.findEqualEdge(e);if(t!==null){var r=t.getLabel(),n=e.getLabel();t.isPointwiseEqual(e)||(n=new an(e.getLabel()),n.flip()),r.merge(n);var i=Vo.depthDelta(n),l=t.getDepthDelta(),h=l+i;t.setDepthDelta(h)}else this._edgeList.add(e),e.setDepthDelta(Vo.depthDelta(e.getLabel()))};Vo.prototype.buildSubgraphs=function(e,t){for(var r=new me,n=e.iterator();n.hasNext();){var i=n.next(),l=i.getRightmostCoordinate(),h=new Fp(r),a=h.getDepth(l);i.computeDepth(a),i.findResultEdges(),r.add(i),t.add(i.getDirectedEdges(),i.getNodes())}};Vo.prototype.createSubgraphs=function(e){for(var t=new me,r=e.getNodes().iterator();r.hasNext();){var n=r.next();if(!n.isVisited()){var i=new Zo;i.create(n),t.add(i)}}return Za.sort(t,Za.reverseOrder()),t};Vo.prototype.createEmptyResultGeometry=function(){var e=this._geomFact.createPolygon();return e};Vo.prototype.getNoder=function(e){if(this._workingNoder!==null)return this._workingNoder;var t=new x1,r=new lp;return r.setPrecisionModel(e),t.setSegmentIntersector(new ea(r)),t};Vo.prototype.buffer=function(e,t){var r=this._workingPrecisionModel;r===null&&(r=e.getPrecisionModel()),this._geomFact=e.getFactory();var n=new os(r,this._bufParams),i=new Sa(e,t,n),l=i.getCurves();if(l.size()<=0)return this.createEmptyResultGeometry();this.computeNodedEdges(l,r),this._graph=new qn(new tC),this._graph.addEdges(this._edgeList.getEdges());var h=this.createSubgraphs(this._graph),a=new Cs(this._geomFact);this.buildSubgraphs(h,a);var g=a.getPolygons();if(g.size()<=0)return this.createEmptyResultGeometry();var _=this._geomFact.buildGeometry(g);return _};Vo.prototype.computeNodedEdges=function(e,t){var r=this,n=this.getNoder(t);n.computeNodes(e);for(var i=n.getNodedSubstrings(),l=i.iterator();l.hasNext();){var h=l.next(),a=h.getCoordinates();if(!(a.length===2&&a[0].equals2D(a[1]))){var g=h.getData(),_=new b_(h.getCoordinates(),new an(g));r.insertUniqueEdge(_)}}};Vo.prototype.setNoder=function(e){this._workingNoder=e};Vo.prototype.interfaces_=function(){return[]};Vo.prototype.getClass=function(){return Vo};Vo.depthDelta=function(e){var t=e.getLocation(0,se.LEFT),r=e.getLocation(0,se.RIGHT);return t===Bt.INTERIOR&&r===Bt.EXTERIOR?1:t===Bt.EXTERIOR&&r===Bt.INTERIOR?-1:0};Vo.convertSegStrings=function(e){for(var t=new Er,r=new me;e.hasNext();){var n=e.next(),i=t.createLineString(n.getCoordinates());r.add(i)}return t.buildGeometry(r)};var Wc=function(){if(this._noder=null,this._scaleFactor=null,this._offsetX=null,this._offsetY=null,this._isScaled=!1,arguments.length===2){var e=arguments[0],t=arguments[1];this._noder=e,this._scaleFactor=t,this._offsetX=0,this._offsetY=0,this._isScaled=!this.isIntegerPrecision()}else if(arguments.length===4){var r=arguments[0],n=arguments[1],i=arguments[2],l=arguments[3];this._noder=r,this._scaleFactor=n,this._offsetX=i,this._offsetY=l,this._isScaled=!this.isIntegerPrecision()}};Wc.prototype.rescale=function(){var e=this;if(rr(arguments[0],Ii))for(var t=arguments[0],r=t.iterator();r.hasNext();){var n=r.next();e.rescale(n.getCoordinates())}else if(arguments[0]instanceof Array){for(var i=arguments[0],l=0;l<i.length;l++)i[l].x=i[l].x/e._scaleFactor+e._offsetX,i[l].y=i[l].y/e._scaleFactor+e._offsetY;i.length===2&&i[0].equals2D(i[1])&&so.out.println(i)}};Wc.prototype.scale=function(){var e=this;if(rr(arguments[0],Ii)){for(var t=arguments[0],r=new me,n=t.iterator();n.hasNext();){var i=n.next();r.add(new si(e.scale(i.getCoordinates()),i.getData()))}return r}else if(arguments[0]instanceof Array){for(var l=arguments[0],h=new Array(l.length).fill(null),a=0;a<l.length;a++)h[a]=new kt(Math.round((l[a].x-e._offsetX)*e._scaleFactor),Math.round((l[a].y-e._offsetY)*e._scaleFactor),l[a].z);var g=Sr.removeRepeatedPoints(h);return g}};Wc.prototype.isIntegerPrecision=function(){return this._scaleFactor===1};Wc.prototype.getNodedSubstrings=function(){var e=this._noder.getNodedSubstrings();return this._isScaled&&this.rescale(e),e};Wc.prototype.computeNodes=function(e){var t=e;this._isScaled&&(t=this.scale(e)),this._noder.computeNodes(t)};Wc.prototype.interfaces_=function(){return[Yh]};Wc.prototype.getClass=function(){return Wc};var kl=function(){this._li=new lp,this._segStrings=null;var e=arguments[0];this._segStrings=e},rC={fact:{configurable:!0}};kl.prototype.checkEndPtVertexIntersections=function(){var e=this;if(arguments.length===0)for(var t=this._segStrings.iterator();t.hasNext();){var r=t.next(),n=r.getCoordinates();e.checkEndPtVertexIntersections(n[0],e._segStrings),e.checkEndPtVertexIntersections(n[n.length-1],e._segStrings)}else if(arguments.length===2){for(var i=arguments[0],l=arguments[1],h=l.iterator();h.hasNext();)for(var a=h.next(),g=a.getCoordinates(),_=1;_<g.length-1;_++)if(g[_].equals(i))throw new Vu("found endpt/interior pt intersection at index "+_+" :pt "+i)}};kl.prototype.checkInteriorIntersections=function(){var e=this;if(arguments.length===0)for(var t=this._segStrings.iterator();t.hasNext();)for(var r=t.next(),n=this._segStrings.iterator();n.hasNext();){var i=n.next();e.checkInteriorIntersections(r,i)}else if(arguments.length===2)for(var l=arguments[0],h=arguments[1],a=l.getCoordinates(),g=h.getCoordinates(),_=0;_<a.length-1;_++)for(var E=0;E<g.length-1;E++)e.checkInteriorIntersections(l,_,h,E);else if(arguments.length===4){var S=arguments[0],A=arguments[1],O=arguments[2],k=arguments[3];if(S===O&&A===k)return null;var G=S.getCoordinates()[A],W=S.getCoordinates()[A+1],U=O.getCoordinates()[k],tt=O.getCoordinates()[k+1];if(this._li.computeIntersection(G,W,U,tt),this._li.hasIntersection()&&(this._li.isProper()||this.hasInteriorIntersection(this._li,G,W)||this.hasInteriorIntersection(this._li,U,tt)))throw new Vu("found non-noded intersection at "+G+"-"+W+" and "+U+"-"+tt)}};kl.prototype.checkValid=function(){this.checkEndPtVertexIntersections(),this.checkInteriorIntersections(),this.checkCollapses()};kl.prototype.checkCollapses=function(){var e=this;if(arguments.length===0)for(var t=this._segStrings.iterator();t.hasNext();){var r=t.next();e.checkCollapses(r)}else if(arguments.length===1)for(var n=arguments[0],i=n.getCoordinates(),l=0;l<i.length-2;l++)e.checkCollapse(i[l],i[l+1],i[l+2])};kl.prototype.hasInteriorIntersection=function(e,t,r){for(var n=0;n<e.getIntersectionNum();n++){var i=e.getIntersection(n);if(!(i.equals(t)||i.equals(r)))return!0}return!1};kl.prototype.checkCollapse=function(e,t,r){if(e.equals(r))throw new Vu("found non-noded collapse at "+kl.fact.createLineString([e,t,r]))};kl.prototype.interfaces_=function(){return[]};kl.prototype.getClass=function(){return kl};rC.fact.get=function(){return new Er};Object.defineProperties(kl,rC);var ss=function(){this._li=null,this._pt=null,this._originalPt=null,this._ptScaled=null,this._p0Scaled=null,this._p1Scaled=null,this._scaleFactor=null,this._minx=null,this._maxx=null,this._miny=null,this._maxy=null,this._corner=new Array(4).fill(null),this._safeEnv=null;var e=arguments[0],t=arguments[1],r=arguments[2];if(this._originalPt=e,this._pt=e,this._scaleFactor=t,this._li=r,t<=0)throw new $n("Scale factor must be non-zero");t!==1&&(this._pt=new kt(this.scale(e.x),this.scale(e.y)),this._p0Scaled=new kt,this._p1Scaled=new kt),this.initCorners(this._pt)},nC={SAFE_ENV_EXPANSION_FACTOR:{configurable:!0}};ss.prototype.intersectsScaled=function(e,t){var r=Math.min(e.x,t.x),n=Math.max(e.x,t.x),i=Math.min(e.y,t.y),l=Math.max(e.y,t.y),h=this._maxx<r||this._minx>n||this._maxy<i||this._miny>l;if(h)return!1;var a=this.intersectsToleranceSquare(e,t);return dr.isTrue(!(h&&a),"Found bad envelope test"),a};ss.prototype.initCorners=function(e){var t=.5;this._minx=e.x-t,this._maxx=e.x+t,this._miny=e.y-t,this._maxy=e.y+t,this._corner[0]=new kt(this._maxx,this._maxy),this._corner[1]=new kt(this._minx,this._maxy),this._corner[2]=new kt(this._minx,this._miny),this._corner[3]=new kt(this._maxx,this._miny)};ss.prototype.intersects=function(e,t){return this._scaleFactor===1?this.intersectsScaled(e,t):(this.copyScaled(e,this._p0Scaled),this.copyScaled(t,this._p1Scaled),this.intersectsScaled(this._p0Scaled,this._p1Scaled))};ss.prototype.scale=function(e){return Math.round(e*this._scaleFactor)};ss.prototype.getCoordinate=function(){return this._originalPt};ss.prototype.copyScaled=function(e,t){t.x=this.scale(e.x),t.y=this.scale(e.y)};ss.prototype.getSafeEnvelope=function(){if(this._safeEnv===null){var e=ss.SAFE_ENV_EXPANSION_FACTOR/this._scaleFactor;this._safeEnv=new Ve(this._originalPt.x-e,this._originalPt.x+e,this._originalPt.y-e,this._originalPt.y+e)}return this._safeEnv};ss.prototype.intersectsPixelClosure=function(e,t){return this._li.computeIntersection(e,t,this._corner[0],this._corner[1]),!!(this._li.hasIntersection()||(this._li.computeIntersection(e,t,this._corner[1],this._corner[2]),this._li.hasIntersection())||(this._li.computeIntersection(e,t,this._corner[2],this._corner[3]),this._li.hasIntersection())||(this._li.computeIntersection(e,t,this._corner[3],this._corner[0]),this._li.hasIntersection()))};ss.prototype.intersectsToleranceSquare=function(e,t){var r=!1,n=!1;return this._li.computeIntersection(e,t,this._corner[0],this._corner[1]),!!(this._li.isProper()||(this._li.computeIntersection(e,t,this._corner[1],this._corner[2]),this._li.isProper())||(this._li.hasIntersection()&&(r=!0),this._li.computeIntersection(e,t,this._corner[2],this._corner[3]),this._li.isProper())||(this._li.hasIntersection()&&(n=!0),this._li.computeIntersection(e,t,this._corner[3],this._corner[0]),this._li.isProper())||r&&n||e.equals(this._pt)||t.equals(this._pt))};ss.prototype.addSnappedNode=function(e,t){var r=e.getCoordinate(t),n=e.getCoordinate(t+1);return this.intersects(r,n)?(e.addIntersection(this.getCoordinate(),t),!0):!1};ss.prototype.interfaces_=function(){return[]};ss.prototype.getClass=function(){return ss};nC.SAFE_ENV_EXPANSION_FACTOR.get=function(){return .75};Object.defineProperties(ss,nC);var ug=function(){this.tempEnv1=new Ve,this.selectedSegment=new Ge};ug.prototype.select=function(){if(arguments.length!==1&&arguments.length===2){var e=arguments[0],t=arguments[1];e.getLineSegment(t,this.selectedSegment),this.select(this.selectedSegment)}};ug.prototype.interfaces_=function(){return[]};ug.prototype.getClass=function(){return ug};var of=function(){this._index=null;var e=arguments[0];this._index=e},iC={HotPixelSnapAction:{configurable:!0}};of.prototype.snap=function(){if(arguments.length===1){var e=arguments[0];return this.snap(e,null,-1)}else if(arguments.length===3){var t=arguments[0],r=arguments[1],n=arguments[2],i=t.getSafeEnvelope(),l=new oC(t,r,n);return this._index.query(i,{interfaces_:function(){return[Gc]},visitItem:function(h){var a=h;a.select(i,l)}}),l.isNodeAdded()}};of.prototype.interfaces_=function(){return[]};of.prototype.getClass=function(){return of};iC.HotPixelSnapAction.get=function(){return oC};Object.defineProperties(of,iC);var oC=function(e){function t(){e.call(this),this._hotPixel=null,this._parentEdge=null,this._hotPixelVertexIndex=null,this._isNodeAdded=!1;var r=arguments[0],n=arguments[1],i=arguments[2];this._hotPixel=r,this._parentEdge=n,this._hotPixelVertexIndex=i}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.isNodeAdded=function(){return this._isNodeAdded},t.prototype.select=function(){if(arguments.length===2){var r=arguments[0],n=arguments[1],i=r.getContext();if(this._parentEdge!==null&&i===this._parentEdge&&n===this._hotPixelVertexIndex)return null;this._isNodeAdded=this._hotPixel.addSnappedNode(i,n)}else return e.prototype.select.apply(this,arguments)},t.prototype.interfaces_=function(){return[]},t.prototype.getClass=function(){return t},t}(ug),zp=function(){this._li=null,this._interiorIntersections=null;var e=arguments[0];this._li=e,this._interiorIntersections=new me};zp.prototype.processIntersections=function(e,t,r,n){var i=this;if(e===r&&t===n)return null;var l=e.getCoordinates()[t],h=e.getCoordinates()[t+1],a=r.getCoordinates()[n],g=r.getCoordinates()[n+1];if(this._li.computeIntersection(l,h,a,g),this._li.hasIntersection()&&this._li.isInteriorIntersection()){for(var _=0;_<this._li.getIntersectionNum();_++)i._interiorIntersections.add(i._li.getIntersection(_));e.addIntersections(this._li,t,0),r.addIntersections(this._li,n,1)}};zp.prototype.isDone=function(){return!1};zp.prototype.getInteriorIntersections=function(){return this._interiorIntersections};zp.prototype.interfaces_=function(){return[Jh]};zp.prototype.getClass=function(){return zp};var fu=function(){this._pm=null,this._li=null,this._scaleFactor=null,this._noder=null,this._pointSnapper=null,this._nodedSegStrings=null;var e=arguments[0];this._pm=e,this._li=new lp,this._li.setPrecisionModel(e),this._scaleFactor=e.getScale()};fu.prototype.checkCorrectness=function(e){var t=si.getNodedSubstrings(e),r=new kl(t);try{r.checkValid()}catch(n){if(n instanceof jI)n.printStackTrace();else throw n}finally{}};fu.prototype.getNodedSubstrings=function(){return si.getNodedSubstrings(this._nodedSegStrings)};fu.prototype.snapRound=function(e,t){var r=this.findInteriorIntersections(e,t);this.computeIntersectionSnaps(r),this.computeVertexSnaps(e)};fu.prototype.findInteriorIntersections=function(e,t){var r=new zp(t);return this._noder.setSegmentIntersector(r),this._noder.computeNodes(e),r.getInteriorIntersections()};fu.prototype.computeVertexSnaps=function(){var e=this;if(rr(arguments[0],Ii))for(var t=arguments[0],r=t.iterator();r.hasNext();){var n=r.next();e.computeVertexSnaps(n)}else if(arguments[0]instanceof si)for(var i=arguments[0],l=i.getCoordinates(),h=0;h<l.length;h++){var a=new ss(l[h],e._scaleFactor,e._li),g=e._pointSnapper.snap(a,i,h);g&&i.addIntersection(l[h],h)}};fu.prototype.computeNodes=function(e){this._nodedSegStrings=e,this._noder=new x1,this._pointSnapper=new of(this._noder.getIndex()),this.snapRound(e,this._li)};fu.prototype.computeIntersectionSnaps=function(e){for(var t=this,r=e.iterator();r.hasNext();){var n=r.next(),i=new ss(n,t._scaleFactor,t._li);t._pointSnapper.snap(i)}};fu.prototype.interfaces_=function(){return[Yh]};fu.prototype.getClass=function(){return fu};var io=function(){if(this._argGeom=null,this._distance=null,this._bufParams=new Zr,this._resultGeometry=null,this._saveException=null,arguments.length===1){var e=arguments[0];this._argGeom=e}else if(arguments.length===2){var t=arguments[0],r=arguments[1];this._argGeom=t,this._bufParams=r}},bf={CAP_ROUND:{configurable:!0},CAP_BUTT:{configurable:!0},CAP_FLAT:{configurable:!0},CAP_SQUARE:{configurable:!0},MAX_PRECISION_DIGITS:{configurable:!0}};io.prototype.bufferFixedPrecision=function(e){var t=new Wc(new fu(new Wr(1)),e.getScale()),r=new Vo(this._bufParams);r.setWorkingPrecisionModel(e),r.setNoder(t),this._resultGeometry=r.buffer(this._argGeom,this._distance)};io.prototype.bufferReducedPrecision=function(){var e=this;if(arguments.length===0){for(var t=io.MAX_PRECISION_DIGITS;t>=0;t--){try{e.bufferReducedPrecision(t)}catch(l){if(l instanceof qu)e._saveException=l;else throw l}finally{}if(e._resultGeometry!==null)return null}throw this._saveException}else if(arguments.length===1){var r=arguments[0],n=io.precisionScaleFactor(this._argGeom,this._distance,r),i=new Wr(n);this.bufferFixedPrecision(i)}};io.prototype.computeGeometry=function(){if(this.bufferOriginalPrecision(),this._resultGeometry!==null)return null;var e=this._argGeom.getFactory().getPrecisionModel();e.getType()===Wr.FIXED?this.bufferFixedPrecision(e):this.bufferReducedPrecision()};io.prototype.setQuadrantSegments=function(e){this._bufParams.setQuadrantSegments(e)};io.prototype.bufferOriginalPrecision=function(){try{var e=new Vo(this._bufParams);this._resultGeometry=e.buffer(this._argGeom,this._distance)}catch(t){if(t instanceof Vu)this._saveException=t;else throw t}finally{}};io.prototype.getResultGeometry=function(e){return this._distance=e,this.computeGeometry(),this._resultGeometry};io.prototype.setEndCapStyle=function(e){this._bufParams.setEndCapStyle(e)};io.prototype.interfaces_=function(){return[]};io.prototype.getClass=function(){return io};io.bufferOp=function(){if(arguments.length===2){var e=arguments[0],t=arguments[1],r=new io(e),n=r.getResultGeometry(t);return n}else if(arguments.length===3){if(Number.isInteger(arguments[2])&&arguments[0]instanceof tr&&typeof arguments[1]=="number"){var i=arguments[0],l=arguments[1],h=arguments[2],a=new io(i);a.setQuadrantSegments(h);var g=a.getResultGeometry(l);return g}else if(arguments[2]instanceof Zr&&arguments[0]instanceof tr&&typeof arguments[1]=="number"){var _=arguments[0],E=arguments[1],S=arguments[2],A=new io(_,S),O=A.getResultGeometry(E);return O}}else if(arguments.length===4){var k=arguments[0],G=arguments[1],W=arguments[2],U=arguments[3],tt=new io(k);tt.setQuadrantSegments(W),tt.setEndCapStyle(U);var $=tt.getResultGeometry(G);return $}};io.precisionScaleFactor=function(e,t,r){var n=e.getEnvelopeInternal(),i=Js.max(Math.abs(n.getMaxX()),Math.abs(n.getMaxY()),Math.abs(n.getMinX()),Math.abs(n.getMinY())),l=t>0?t:0,h=i+2*l,a=Math.trunc(Math.log(h)/Math.log(10)+1),g=r-a,_=Math.pow(10,g);return _};bf.CAP_ROUND.get=function(){return Zr.CAP_ROUND};bf.CAP_BUTT.get=function(){return Zr.CAP_FLAT};bf.CAP_FLAT.get=function(){return Zr.CAP_FLAT};bf.CAP_SQUARE.get=function(){return Zr.CAP_SQUARE};bf.MAX_PRECISION_DIGITS.get=function(){return 12};Object.defineProperties(io,bf);var $o=function(){this._pt=[new kt,new kt],this._distance=lr.NaN,this._isNull=!0};$o.prototype.getCoordinates=function(){return this._pt};$o.prototype.getCoordinate=function(e){return this._pt[e]};$o.prototype.setMinimum=function(){if(arguments.length===1){var e=arguments[0];this.setMinimum(e._pt[0],e._pt[1])}else if(arguments.length===2){var t=arguments[0],r=arguments[1];if(this._isNull)return this.initialize(t,r),null;var n=t.distance(r);n<this._distance&&this.initialize(t,r,n)}};$o.prototype.initialize=function(){if(arguments.length===0)this._isNull=!0;else if(arguments.length===2){var e=arguments[0],t=arguments[1];this._pt[0].setCoordinate(e),this._pt[1].setCoordinate(t),this._distance=e.distance(t),this._isNull=!1}else if(arguments.length===3){var r=arguments[0],n=arguments[1],i=arguments[2];this._pt[0].setCoordinate(r),this._pt[1].setCoordinate(n),this._distance=i,this._isNull=!1}};$o.prototype.getDistance=function(){return this._distance};$o.prototype.setMaximum=function(){if(arguments.length===1){var e=arguments[0];this.setMaximum(e._pt[0],e._pt[1])}else if(arguments.length===2){var t=arguments[0],r=arguments[1];if(this._isNull)return this.initialize(t,r),null;var n=t.distance(r);n>this._distance&&this.initialize(t,r,n)}};$o.prototype.interfaces_=function(){return[]};$o.prototype.getClass=function(){return $o};var eu=function(){};eu.prototype.interfaces_=function(){return[]};eu.prototype.getClass=function(){return eu};eu.computeDistance=function(){if(arguments[2]instanceof $o&&arguments[0]instanceof Hn&&arguments[1]instanceof kt)for(var e=arguments[0],t=arguments[1],r=arguments[2],n=e.getCoordinates(),i=new Ge,l=0;l<n.length-1;l++){i.setCoordinates(n[l],n[l+1]);var h=i.closestPoint(t);r.setMinimum(h,t)}else if(arguments[2]instanceof $o&&arguments[0]instanceof Li&&arguments[1]instanceof kt){var a=arguments[0],g=arguments[1],_=arguments[2];eu.computeDistance(a.getExteriorRing(),g,_);for(var E=0;E<a.getNumInteriorRing();E++)eu.computeDistance(a.getInteriorRingN(E),g,_)}else if(arguments[2]instanceof $o&&arguments[0]instanceof tr&&arguments[1]instanceof kt){var S=arguments[0],A=arguments[1],O=arguments[2];if(S instanceof Hn)eu.computeDistance(S,A,O);else if(S instanceof Li)eu.computeDistance(S,A,O);else if(S instanceof qo)for(var k=S,G=0;G<k.getNumGeometries();G++){var W=k.getGeometryN(G);eu.computeDistance(W,A,O)}else O.setMinimum(S.getCoordinate(),A)}else if(arguments[2]instanceof $o&&arguments[0]instanceof Ge&&arguments[1]instanceof kt){var U=arguments[0],tt=arguments[1],$=arguments[2],V=U.closestPoint(tt);$.setMinimum(V,tt)}};var tp=function(e){this._maxPtDist=new $o,this._inputGeom=e||null},b1={MaxPointDistanceFilter:{configurable:!0},MaxMidpointDistanceFilter:{configurable:!0}};tp.prototype.computeMaxMidpointDistance=function(e){var t=new Xc(this._inputGeom);e.apply(t),this._maxPtDist.setMaximum(t.getMaxPointDistance())};tp.prototype.computeMaxVertexDistance=function(e){var t=new Bp(this._inputGeom);e.apply(t),this._maxPtDist.setMaximum(t.getMaxPointDistance())};tp.prototype.findDistance=function(e){return this.computeMaxVertexDistance(e),this.computeMaxMidpointDistance(e),this._maxPtDist.getDistance()};tp.prototype.getDistancePoints=function(){return this._maxPtDist};tp.prototype.interfaces_=function(){return[]};tp.prototype.getClass=function(){return tp};b1.MaxPointDistanceFilter.get=function(){return Bp};b1.MaxMidpointDistanceFilter.get=function(){return Xc};Object.defineProperties(tp,b1);var Bp=function(e){this._maxPtDist=new $o,this._minPtDist=new $o,this._geom=e||null};Bp.prototype.filter=function(e){this._minPtDist.initialize(),eu.computeDistance(this._geom,e,this._minPtDist),this._maxPtDist.setMaximum(this._minPtDist)};Bp.prototype.getMaxPointDistance=function(){return this._maxPtDist};Bp.prototype.interfaces_=function(){return[uu]};Bp.prototype.getClass=function(){return Bp};var Xc=function(e){this._maxPtDist=new $o,this._minPtDist=new $o,this._geom=e||null};Xc.prototype.filter=function(e,t){if(t===0)return null;var r=e.getCoordinate(t-1),n=e.getCoordinate(t),i=new kt((r.x+n.x)/2,(r.y+n.y)/2);this._minPtDist.initialize(),eu.computeDistance(this._geom,i,this._minPtDist),this._maxPtDist.setMaximum(this._minPtDist)};Xc.prototype.isDone=function(){return!1};Xc.prototype.isGeometryChanged=function(){return!1};Xc.prototype.getMaxPointDistance=function(){return this._maxPtDist};Xc.prototype.interfaces_=function(){return[Ga]};Xc.prototype.getClass=function(){return Xc};var Uu=function(e){this._comps=e||null};Uu.prototype.filter=function(e){e instanceof Li&&this._comps.add(e)};Uu.prototype.interfaces_=function(){return[Al]};Uu.prototype.getClass=function(){return Uu};Uu.getPolygons=function(){if(arguments.length===1){var e=arguments[0];return Uu.getPolygons(e,new me)}else if(arguments.length===2){var t=arguments[0],r=arguments[1];return t instanceof Li?r.add(t):t instanceof qo&&t.apply(new Uu(r)),r}};var no=function(){if(this._lines=null,this._isForcedToLineString=!1,arguments.length===1){var e=arguments[0];this._lines=e}else if(arguments.length===2){var t=arguments[0],r=arguments[1];this._lines=t,this._isForcedToLineString=r}};no.prototype.filter=function(e){if(this._isForcedToLineString&&e instanceof cu){var t=e.getFactory().createLineString(e.getCoordinateSequence());return this._lines.add(t),null}e instanceof Hn&&this._lines.add(e)};no.prototype.setForceToLineString=function(e){this._isForcedToLineString=e};no.prototype.interfaces_=function(){return[Gu]};no.prototype.getClass=function(){return no};no.getGeometry=function(){if(arguments.length===1){var e=arguments[0];return e.getFactory().buildGeometry(no.getLines(e))}else if(arguments.length===2){var t=arguments[0],r=arguments[1];return t.getFactory().buildGeometry(no.getLines(t,r))}};no.getLines=function(){if(arguments.length===1){var e=arguments[0];return no.getLines(e,!1)}else if(arguments.length===2){if(rr(arguments[0],Ii)&&rr(arguments[1],Ii)){for(var t=arguments[0],r=arguments[1],n=t.iterator();n.hasNext();){var i=n.next();no.getLines(i,r)}return r}else if(arguments[0]instanceof tr&&typeof arguments[1]=="boolean"){var l=arguments[0],h=arguments[1],a=new me;return l.apply(new no(a,h)),a}else if(arguments[0]instanceof tr&&rr(arguments[1],Ii)){var g=arguments[0],_=arguments[1];return g instanceof Hn?_.add(g):g.apply(new no(_)),_}}else if(arguments.length===3){if(typeof arguments[2]=="boolean"&&rr(arguments[0],Ii)&&rr(arguments[1],Ii)){for(var E=arguments[0],S=arguments[1],A=arguments[2],O=E.iterator();O.hasNext();){var k=O.next();no.getLines(k,S,A)}return S}else if(typeof arguments[2]=="boolean"&&arguments[0]instanceof tr&&rr(arguments[1],Ii)){var G=arguments[0],W=arguments[1],U=arguments[2];return G.apply(new no(W,U)),W}}};var Xa=function(){if(this._boundaryRule=wa.OGC_SFS_BOUNDARY_RULE,this._isIn=null,this._numBoundaries=null,arguments.length!==0&&arguments.length===1){var e=arguments[0];if(e===null)throw new $n("Rule must be non-null");this._boundaryRule=e}};Xa.prototype.locateInternal=function(){var e=this;if(arguments[0]instanceof kt&&arguments[1]instanceof Li){var t=arguments[0],r=arguments[1];if(r.isEmpty())return Bt.EXTERIOR;var n=r.getExteriorRing(),i=this.locateInPolygonRing(t,n);if(i===Bt.EXTERIOR)return Bt.EXTERIOR;if(i===Bt.BOUNDARY)return Bt.BOUNDARY;for(var l=0;l<r.getNumInteriorRing();l++){var h=r.getInteriorRingN(l),a=e.locateInPolygonRing(t,h);if(a===Bt.INTERIOR)return Bt.EXTERIOR;if(a===Bt.BOUNDARY)return Bt.BOUNDARY}return Bt.INTERIOR}else if(arguments[0]instanceof kt&&arguments[1]instanceof Hn){var g=arguments[0],_=arguments[1];if(!_.getEnvelopeInternal().intersects(g))return Bt.EXTERIOR;var E=_.getCoordinates();return!_.isClosed()&&(g.equals(E[0])||g.equals(E[E.length-1]))?Bt.BOUNDARY:Ie.isOnLine(g,E)?Bt.INTERIOR:Bt.EXTERIOR}else if(arguments[0]instanceof kt&&arguments[1]instanceof Is){var S=arguments[0],A=arguments[1],O=A.getCoordinate();return O.equals2D(S)?Bt.INTERIOR:Bt.EXTERIOR}};Xa.prototype.locateInPolygonRing=function(e,t){return t.getEnvelopeInternal().intersects(e)?Ie.locatePointInRing(e,t.getCoordinates()):Bt.EXTERIOR};Xa.prototype.intersects=function(e,t){return this.locate(e,t)!==Bt.EXTERIOR};Xa.prototype.updateLocationInfo=function(e){e===Bt.INTERIOR&&(this._isIn=!0),e===Bt.BOUNDARY&&this._numBoundaries++};Xa.prototype.computeLocation=function(e,t){var r=this;if(t instanceof Is&&this.updateLocationInfo(this.locateInternal(e,t)),t instanceof Hn)this.updateLocationInfo(this.locateInternal(e,t));else if(t instanceof Li)this.updateLocationInfo(this.locateInternal(e,t));else if(t instanceof Hh)for(var n=t,i=0;i<n.getNumGeometries();i++){var l=n.getGeometryN(i);r.updateLocationInfo(r.locateInternal(e,l))}else if(t instanceof su)for(var h=t,a=0;a<h.getNumGeometries();a++){var g=h.getGeometryN(a);r.updateLocationInfo(r.locateInternal(e,g))}else if(t instanceof qo)for(var _=new au(t);_.hasNext();){var E=_.next();E!==t&&r.computeLocation(e,E)}};Xa.prototype.locate=function(e,t){return t.isEmpty()?Bt.EXTERIOR:t instanceof Hn?this.locateInternal(e,t):t instanceof Li?this.locateInternal(e,t):(this._isIn=!1,this._numBoundaries=0,this.computeLocation(e,t),this._boundaryRule.isInBoundary(this._numBoundaries)?Bt.BOUNDARY:this._numBoundaries>0||this._isIn?Bt.INTERIOR:Bt.EXTERIOR)};Xa.prototype.interfaces_=function(){return[]};Xa.prototype.getClass=function(){return Xa};var Uo=function e(){if(this._component=null,this._segIndex=null,this._pt=null,arguments.length===2){var t=arguments[0],r=arguments[1];e.call(this,t,e.INSIDE_AREA,r)}else if(arguments.length===3){var n=arguments[0],i=arguments[1],l=arguments[2];this._component=n,this._segIndex=i,this._pt=l}},sC={INSIDE_AREA:{configurable:!0}};Uo.prototype.isInsideArea=function(){return this._segIndex===Uo.INSIDE_AREA};Uo.prototype.getCoordinate=function(){return this._pt};Uo.prototype.getGeometryComponent=function(){return this._component};Uo.prototype.getSegmentIndex=function(){return this._segIndex};Uo.prototype.interfaces_=function(){return[]};Uo.prototype.getClass=function(){return Uo};sC.INSIDE_AREA.get=function(){return-1};Object.defineProperties(Uo,sC);var Fc=function(e){this._pts=e||null};Fc.prototype.filter=function(e){e instanceof Is&&this._pts.add(e)};Fc.prototype.interfaces_=function(){return[Al]};Fc.prototype.getClass=function(){return Fc};Fc.getPoints=function(){if(arguments.length===1){var e=arguments[0];return e instanceof Is?Za.singletonList(e):Fc.getPoints(e,new me)}else if(arguments.length===2){var t=arguments[0],r=arguments[1];return t instanceof Is?r.add(t):t instanceof qo&&t.apply(new Fc(r)),r}};var $p=function(){this._locations=null;var e=arguments[0];this._locations=e};$p.prototype.filter=function(e){(e instanceof Is||e instanceof Hn||e instanceof Li)&&this._locations.add(new Uo(e,0,e.getCoordinate()))};$p.prototype.interfaces_=function(){return[Al]};$p.prototype.getClass=function(){return $p};$p.getLocations=function(e){var t=new me;return e.apply(new $p(t)),t};var ao=function(){if(this._geom=null,this._terminateDistance=0,this._ptLocator=new Xa,this._minDistanceLocation=null,this._minDistance=lr.MAX_VALUE,arguments.length===2){var e=arguments[0],t=arguments[1];this._geom=[e,t],this._terminateDistance=0}else if(arguments.length===3){var r=arguments[0],n=arguments[1],i=arguments[2];this._geom=new Array(2).fill(null),this._geom[0]=r,this._geom[1]=n,this._terminateDistance=i}};ao.prototype.computeContainmentDistance=function(){var e=this;if(arguments.length===0){var t=new Array(2).fill(null);if(this.computeContainmentDistance(0,t),this._minDistance<=this._terminateDistance)return null;this.computeContainmentDistance(1,t)}else if(arguments.length===2){var r=arguments[0],n=arguments[1],i=1-r,l=Uu.getPolygons(this._geom[r]);if(l.size()>0){var h=$p.getLocations(this._geom[i]);if(this.computeContainmentDistance(h,l,n),this._minDistance<=this._terminateDistance)return this._minDistanceLocation[i]=n[0],this._minDistanceLocation[r]=n[1],null}}else if(arguments.length===3){if(arguments[2]instanceof Array&&rr(arguments[0],Ua)&&rr(arguments[1],Ua)){for(var a=arguments[0],g=arguments[1],_=arguments[2],E=0;E<a.size();E++)for(var S=a.get(E),A=0;A<g.size();A++)if(e.computeContainmentDistance(S,g.get(A),_),e._minDistance<=e._terminateDistance)return null}else if(arguments[2]instanceof Array&&arguments[0]instanceof Uo&&arguments[1]instanceof Li){var O=arguments[0],k=arguments[1],G=arguments[2],W=O.getCoordinate();if(Bt.EXTERIOR!==this._ptLocator.locate(W,k))return this._minDistance=0,G[0]=O,G[1]=new Uo(k,W),null}}};ao.prototype.computeMinDistanceLinesPoints=function(e,t,r){for(var n=this,i=0;i<e.size();i++)for(var l=e.get(i),h=0;h<t.size();h++){var a=t.get(h);if(n.computeMinDistance(l,a,r),n._minDistance<=n._terminateDistance)return null}};ao.prototype.computeFacetDistance=function(){var e=new Array(2).fill(null),t=no.getLines(this._geom[0]),r=no.getLines(this._geom[1]),n=Fc.getPoints(this._geom[0]),i=Fc.getPoints(this._geom[1]);if(this.computeMinDistanceLines(t,r,e),this.updateMinDistance(e,!1),this._minDistance<=this._terminateDistance||(e[0]=null,e[1]=null,this.computeMinDistanceLinesPoints(t,i,e),this.updateMinDistance(e,!1),this._minDistance<=this._terminateDistance)||(e[0]=null,e[1]=null,this.computeMinDistanceLinesPoints(r,n,e),this.updateMinDistance(e,!0),this._minDistance<=this._terminateDistance))return null;e[0]=null,e[1]=null,this.computeMinDistancePoints(n,i,e),this.updateMinDistance(e,!1)};ao.prototype.nearestLocations=function(){return this.computeMinDistance(),this._minDistanceLocation};ao.prototype.updateMinDistance=function(e,t){if(e[0]===null)return null;t?(this._minDistanceLocation[0]=e[1],this._minDistanceLocation[1]=e[0]):(this._minDistanceLocation[0]=e[0],this._minDistanceLocation[1]=e[1])};ao.prototype.nearestPoints=function(){this.computeMinDistance();var e=[this._minDistanceLocation[0].getCoordinate(),this._minDistanceLocation[1].getCoordinate()];return e};ao.prototype.computeMinDistance=function(){var e=this;if(arguments.length===0){if(this._minDistanceLocation!==null||(this._minDistanceLocation=new Array(2).fill(null),this.computeContainmentDistance(),this._minDistance<=this._terminateDistance))return null;this.computeFacetDistance()}else if(arguments.length===3){if(arguments[2]instanceof Array&&arguments[0]instanceof Hn&&arguments[1]instanceof Is){var t=arguments[0],r=arguments[1],n=arguments[2];if(t.getEnvelopeInternal().distance(r.getEnvelopeInternal())>this._minDistance)return null;for(var i=t.getCoordinates(),l=r.getCoordinate(),h=0;h<i.length-1;h++){var a=Ie.distancePointLine(l,i[h],i[h+1]);if(a<e._minDistance){e._minDistance=a;var g=new Ge(i[h],i[h+1]),_=g.closestPoint(l);n[0]=new Uo(t,h,_),n[1]=new Uo(r,0,l)}if(e._minDistance<=e._terminateDistance)return null}}else if(arguments[2]instanceof Array&&arguments[0]instanceof Hn&&arguments[1]instanceof Hn){var E=arguments[0],S=arguments[1],A=arguments[2];if(E.getEnvelopeInternal().distance(S.getEnvelopeInternal())>this._minDistance)return null;for(var O=E.getCoordinates(),k=S.getCoordinates(),G=0;G<O.length-1;G++)for(var W=0;W<k.length-1;W++){var U=Ie.distanceLineLine(O[G],O[G+1],k[W],k[W+1]);if(U<e._minDistance){e._minDistance=U;var tt=new Ge(O[G],O[G+1]),$=new Ge(k[W],k[W+1]),V=tt.closestPoints($);A[0]=new Uo(E,G,V[0]),A[1]=new Uo(S,W,V[1])}if(e._minDistance<=e._terminateDistance)return null}}}};ao.prototype.computeMinDistancePoints=function(e,t,r){for(var n=this,i=0;i<e.size();i++)for(var l=e.get(i),h=0;h<t.size();h++){var a=t.get(h),g=l.getCoordinate().distance(a.getCoordinate());if(g<n._minDistance&&(n._minDistance=g,r[0]=new Uo(l,0,l.getCoordinate()),r[1]=new Uo(a,0,a.getCoordinate())),n._minDistance<=n._terminateDistance)return null}};ao.prototype.distance=function(){if(this._geom[0]===null||this._geom[1]===null)throw new $n("null geometries are not supported");return this._geom[0].isEmpty()||this._geom[1].isEmpty()?0:(this.computeMinDistance(),this._minDistance)};ao.prototype.computeMinDistanceLines=function(e,t,r){for(var n=this,i=0;i<e.size();i++)for(var l=e.get(i),h=0;h<t.size();h++){var a=t.get(h);if(n.computeMinDistance(l,a,r),n._minDistance<=n._terminateDistance)return null}};ao.prototype.interfaces_=function(){return[]};ao.prototype.getClass=function(){return ao};ao.distance=function(e,t){var r=new ao(e,t);return r.distance()};ao.isWithinDistance=function(e,t,r){var n=new ao(e,t,r);return n.distance()<=r};ao.nearestPoints=function(e,t){var r=new ao(e,t);return r.nearestPoints()};var bo=function(){this._pt=[new kt,new kt],this._distance=lr.NaN,this._isNull=!0};bo.prototype.getCoordinates=function(){return this._pt};bo.prototype.getCoordinate=function(e){return this._pt[e]};bo.prototype.setMinimum=function(){if(arguments.length===1){var e=arguments[0];this.setMinimum(e._pt[0],e._pt[1])}else if(arguments.length===2){var t=arguments[0],r=arguments[1];if(this._isNull)return this.initialize(t,r),null;var n=t.distance(r);n<this._distance&&this.initialize(t,r,n)}};bo.prototype.initialize=function(){if(arguments.length===0)this._isNull=!0;else if(arguments.length===2){var e=arguments[0],t=arguments[1];this._pt[0].setCoordinate(e),this._pt[1].setCoordinate(t),this._distance=e.distance(t),this._isNull=!1}else if(arguments.length===3){var r=arguments[0],n=arguments[1],i=arguments[2];this._pt[0].setCoordinate(r),this._pt[1].setCoordinate(n),this._distance=i,this._isNull=!1}};bo.prototype.toString=function(){return Va.toLineString(this._pt[0],this._pt[1])};bo.prototype.getDistance=function(){return this._distance};bo.prototype.setMaximum=function(){if(arguments.length===1){var e=arguments[0];this.setMaximum(e._pt[0],e._pt[1])}else if(arguments.length===2){var t=arguments[0],r=arguments[1];if(this._isNull)return this.initialize(t,r),null;var n=t.distance(r);n>this._distance&&this.initialize(t,r,n)}};bo.prototype.interfaces_=function(){return[]};bo.prototype.getClass=function(){return bo};var wl=function(){};wl.prototype.interfaces_=function(){return[]};wl.prototype.getClass=function(){return wl};wl.computeDistance=function(){if(arguments[2]instanceof bo&&arguments[0]instanceof Hn&&arguments[1]instanceof kt)for(var e=arguments[0],t=arguments[1],r=arguments[2],n=new Ge,i=e.getCoordinates(),l=0;l<i.length-1;l++){n.setCoordinates(i[l],i[l+1]);var h=n.closestPoint(t);r.setMinimum(h,t)}else if(arguments[2]instanceof bo&&arguments[0]instanceof Li&&arguments[1]instanceof kt){var a=arguments[0],g=arguments[1],_=arguments[2];wl.computeDistance(a.getExteriorRing(),g,_);for(var E=0;E<a.getNumInteriorRing();E++)wl.computeDistance(a.getInteriorRingN(E),g,_)}else if(arguments[2]instanceof bo&&arguments[0]instanceof tr&&arguments[1]instanceof kt){var S=arguments[0],A=arguments[1],O=arguments[2];if(S instanceof Hn)wl.computeDistance(S,A,O);else if(S instanceof Li)wl.computeDistance(S,A,O);else if(S instanceof qo)for(var k=S,G=0;G<k.getNumGeometries();G++){var W=k.getGeometryN(G);wl.computeDistance(W,A,O)}else O.setMinimum(S.getCoordinate(),A)}else if(arguments[2]instanceof bo&&arguments[0]instanceof Ge&&arguments[1]instanceof kt){var U=arguments[0],tt=arguments[1],$=arguments[2],V=U.closestPoint(tt);$.setMinimum(V,tt)}};var _a=function(){this._g0=null,this._g1=null,this._ptDist=new bo,this._densifyFrac=0;var e=arguments[0],t=arguments[1];this._g0=e,this._g1=t},w1={MaxPointDistanceFilter:{configurable:!0},MaxDensifiedByFractionDistanceFilter:{configurable:!0}};_a.prototype.getCoordinates=function(){return this._ptDist.getCoordinates()};_a.prototype.setDensifyFraction=function(e){if(e>1||e<=0)throw new $n("Fraction is not in range (0.0 - 1.0]");this._densifyFrac=e};_a.prototype.compute=function(e,t){this.computeOrientedDistance(e,t,this._ptDist),this.computeOrientedDistance(t,e,this._ptDist)};_a.prototype.distance=function(){return this.compute(this._g0,this._g1),this._ptDist.getDistance()};_a.prototype.computeOrientedDistance=function(e,t,r){var n=new Up(t);if(e.apply(n),r.setMaximum(n.getMaxPointDistance()),this._densifyFrac>0){var i=new Hc(t,this._densifyFrac);e.apply(i),r.setMaximum(i.getMaxPointDistance())}};_a.prototype.orientedDistance=function(){return this.computeOrientedDistance(this._g0,this._g1,this._ptDist),this._ptDist.getDistance()};_a.prototype.interfaces_=function(){return[]};_a.prototype.getClass=function(){return _a};_a.distance=function(){if(arguments.length===2){var e=arguments[0],t=arguments[1],r=new _a(e,t);return r.distance()}else if(arguments.length===3){var n=arguments[0],i=arguments[1],l=arguments[2],h=new _a(n,i);return h.setDensifyFraction(l),h.distance()}};w1.MaxPointDistanceFilter.get=function(){return Up};w1.MaxDensifiedByFractionDistanceFilter.get=function(){return Hc};Object.defineProperties(_a,w1);var Up=function(){this._maxPtDist=new bo,this._minPtDist=new bo,this._euclideanDist=new wl,this._geom=null;var e=arguments[0];this._geom=e};Up.prototype.filter=function(e){this._minPtDist.initialize(),wl.computeDistance(this._geom,e,this._minPtDist),this._maxPtDist.setMaximum(this._minPtDist)};Up.prototype.getMaxPointDistance=function(){return this._maxPtDist};Up.prototype.interfaces_=function(){return[uu]};Up.prototype.getClass=function(){return Up};var Hc=function(){this._maxPtDist=new bo,this._minPtDist=new bo,this._geom=null,this._numSubSegs=0;var e=arguments[0],t=arguments[1];this._geom=e,this._numSubSegs=Math.trunc(Math.round(1/t))};Hc.prototype.filter=function(e,t){var r=this;if(t===0)return null;for(var n=e.getCoordinate(t-1),i=e.getCoordinate(t),l=(i.x-n.x)/this._numSubSegs,h=(i.y-n.y)/this._numSubSegs,a=0;a<this._numSubSegs;a++){var g=n.x+a*l,_=n.y+a*h,E=new kt(g,_);r._minPtDist.initialize(),wl.computeDistance(r._geom,E,r._minPtDist),r._maxPtDist.setMaximum(r._minPtDist)}};Hc.prototype.isDone=function(){return!1};Hc.prototype.isGeometryChanged=function(){return!1};Hc.prototype.getMaxPointDistance=function(){return this._maxPtDist};Hc.prototype.interfaces_=function(){return[Ga]};Hc.prototype.getClass=function(){return Hc};var Ss=function(e,t,r){this._minValidDistance=null,this._maxValidDistance=null,this._minDistanceFound=null,this._maxDistanceFound=null,this._isValid=!0,this._errMsg=null,this._errorLocation=null,this._errorIndicator=null,this._input=e||null,this._bufDistance=t||null,this._result=r||null},E1={VERBOSE:{configurable:!0},MAX_DISTANCE_DIFF_FRAC:{configurable:!0}};Ss.prototype.checkMaximumDistance=function(e,t,r){var n=new _a(t,e);if(n.setDensifyFraction(.25),this._maxDistanceFound=n.orientedDistance(),this._maxDistanceFound>r){this._isValid=!1;var i=n.getCoordinates();this._errorLocation=i[1],this._errorIndicator=e.getFactory().createLineString(i),this._errMsg="Distance between buffer curve and input is too large ("+this._maxDistanceFound+" at "+Va.toLineString(i[0],i[1])+")"}};Ss.prototype.isValid=function(){var e=Math.abs(this._bufDistance),t=Ss.MAX_DISTANCE_DIFF_FRAC*e;return this._minValidDistance=e-t,this._maxValidDistance=e+t,this._input.isEmpty()||this._result.isEmpty()?!0:(this._bufDistance>0?this.checkPositiveValid():this.checkNegativeValid(),Ss.VERBOSE&&so.out.println("Min Dist= "+this._minDistanceFound+"  err= "+(1-this._minDistanceFound/this._bufDistance)+"  Max Dist= "+this._maxDistanceFound+"  err= "+(this._maxDistanceFound/this._bufDistance-1)),this._isValid)};Ss.prototype.checkNegativeValid=function(){if(!(this._input instanceof Li||this._input instanceof su||this._input instanceof qo))return null;var e=this.getPolygonLines(this._input);if(this.checkMinimumDistance(e,this._result,this._minValidDistance),!this._isValid)return null;this.checkMaximumDistance(e,this._result,this._maxValidDistance)};Ss.prototype.getErrorIndicator=function(){return this._errorIndicator};Ss.prototype.checkMinimumDistance=function(e,t,r){var n=new ao(e,t,r);if(this._minDistanceFound=n.distance(),this._minDistanceFound<r){this._isValid=!1;var i=n.nearestPoints();this._errorLocation=n.nearestPoints()[1],this._errorIndicator=e.getFactory().createLineString(i),this._errMsg="Distance between buffer curve and input is too small ("+this._minDistanceFound+" at "+Va.toLineString(i[0],i[1])+" )"}};Ss.prototype.checkPositiveValid=function(){var e=this._result.getBoundary();if(this.checkMinimumDistance(this._input,e,this._minValidDistance),!this._isValid)return null;this.checkMaximumDistance(this._input,e,this._maxValidDistance)};Ss.prototype.getErrorLocation=function(){return this._errorLocation};Ss.prototype.getPolygonLines=function(e){for(var t=new me,r=new no(t),n=Uu.getPolygons(e),i=n.iterator();i.hasNext();){var l=i.next();l.apply(r)}return e.getFactory().buildGeometry(t)};Ss.prototype.getErrorMessage=function(){return this._errMsg};Ss.prototype.interfaces_=function(){return[]};Ss.prototype.getClass=function(){return Ss};E1.VERBOSE.get=function(){return!1};E1.MAX_DISTANCE_DIFF_FRAC.get=function(){return .012};Object.defineProperties(Ss,E1);var lo=function(e,t,r){this._isValid=!0,this._errorMsg=null,this._errorLocation=null,this._errorIndicator=null,this._input=e||null,this._distance=t||null,this._result=r||null},S1={VERBOSE:{configurable:!0},MAX_ENV_DIFF_FRAC:{configurable:!0}};lo.prototype.isValid=function(){return this.checkPolygonal(),this._isValid?(this.checkExpectedEmpty(),this._isValid?(this.checkEnvelope(),this._isValid?(this.checkArea(),this._isValid?(this.checkDistance(),this._isValid):this._isValid):this._isValid):this._isValid):this._isValid};lo.prototype.checkEnvelope=function(){if(this._distance<0)return null;var e=this._distance*lo.MAX_ENV_DIFF_FRAC;e===0&&(e=.001);var t=new Ve(this._input.getEnvelopeInternal());t.expandBy(this._distance);var r=new Ve(this._result.getEnvelopeInternal());r.expandBy(e),r.contains(t)||(this._isValid=!1,this._errorMsg="Buffer envelope is incorrect",this._errorIndicator=this._input.getFactory().toGeometry(r)),this.report("Envelope")};lo.prototype.checkDistance=function(){var e=new Ss(this._input,this._distance,this._result);e.isValid()||(this._isValid=!1,this._errorMsg=e.getErrorMessage(),this._errorLocation=e.getErrorLocation(),this._errorIndicator=e.getErrorIndicator()),this.report("Distance")};lo.prototype.checkArea=function(){var e=this._input.getArea(),t=this._result.getArea();this._distance>0&&e>t&&(this._isValid=!1,this._errorMsg="Area of positive buffer is smaller than input",this._errorIndicator=this._result),this._distance<0&&e<t&&(this._isValid=!1,this._errorMsg="Area of negative buffer is larger than input",this._errorIndicator=this._result),this.report("Area")};lo.prototype.checkPolygonal=function(){this._result instanceof Li||this._result instanceof su||(this._isValid=!1),this._errorMsg="Result is not polygonal",this._errorIndicator=this._result,this.report("Polygonal")};lo.prototype.getErrorIndicator=function(){return this._errorIndicator};lo.prototype.getErrorLocation=function(){return this._errorLocation};lo.prototype.checkExpectedEmpty=function(){if(this._input.getDimension()>=2||this._distance>0)return null;this._result.isEmpty()||(this._isValid=!1,this._errorMsg="Result is non-empty",this._errorIndicator=this._result),this.report("ExpectedEmpty")};lo.prototype.report=function(e){if(!lo.VERBOSE)return null;so.out.println("Check "+e+": "+(this._isValid?"passed":"FAILED"))};lo.prototype.getErrorMessage=function(){return this._errorMsg};lo.prototype.interfaces_=function(){return[]};lo.prototype.getClass=function(){return lo};lo.isValidMsg=function(e,t,r){var n=new lo(e,t,r);return n.isValid()?null:n.getErrorMessage()};lo.isValid=function(e,t,r){var n=new lo(e,t,r);return!!n.isValid()};S1.VERBOSE.get=function(){return!1};S1.MAX_ENV_DIFF_FRAC.get=function(){return .012};Object.defineProperties(lo,S1);var Ol=function(){this._pts=null,this._data=null;var e=arguments[0],t=arguments[1];this._pts=e,this._data=t};Ol.prototype.getCoordinates=function(){return this._pts};Ol.prototype.size=function(){return this._pts.length};Ol.prototype.getCoordinate=function(e){return this._pts[e]};Ol.prototype.isClosed=function(){return this._pts[0].equals(this._pts[this._pts.length-1])};Ol.prototype.getSegmentOctant=function(e){return e===this._pts.length-1?-1:Op.octant(this.getCoordinate(e),this.getCoordinate(e+1))};Ol.prototype.setData=function(e){this._data=e};Ol.prototype.getData=function(){return this._data};Ol.prototype.toString=function(){return Va.toLineString(new ei(this._pts))};Ol.prototype.interfaces_=function(){return[pu]};Ol.prototype.getClass=function(){return Ol};var Yi=function(){this._findAllIntersections=!1,this._isCheckEndSegmentsOnly=!1,this._li=null,this._interiorIntersection=null,this._intSegments=null,this._intersections=new me,this._intersectionCount=0,this._keepIntersections=!0;var e=arguments[0];this._li=e,this._interiorIntersection=null};Yi.prototype.getInteriorIntersection=function(){return this._interiorIntersection};Yi.prototype.setCheckEndSegmentsOnly=function(e){this._isCheckEndSegmentsOnly=e};Yi.prototype.getIntersectionSegments=function(){return this._intSegments};Yi.prototype.count=function(){return this._intersectionCount};Yi.prototype.getIntersections=function(){return this._intersections};Yi.prototype.setFindAllIntersections=function(e){this._findAllIntersections=e};Yi.prototype.setKeepIntersections=function(e){this._keepIntersections=e};Yi.prototype.processIntersections=function(e,t,r,n){if(!this._findAllIntersections&&this.hasIntersection()||e===r&&t===n)return null;if(this._isCheckEndSegmentsOnly){var i=this.isEndSegment(e,t)||this.isEndSegment(r,n);if(!i)return null}var l=e.getCoordinates()[t],h=e.getCoordinates()[t+1],a=r.getCoordinates()[n],g=r.getCoordinates()[n+1];this._li.computeIntersection(l,h,a,g),this._li.hasIntersection()&&this._li.isInteriorIntersection()&&(this._intSegments=new Array(4).fill(null),this._intSegments[0]=l,this._intSegments[1]=h,this._intSegments[2]=a,this._intSegments[3]=g,this._interiorIntersection=this._li.getIntersection(0),this._keepIntersections&&this._intersections.add(this._interiorIntersection),this._intersectionCount++)};Yi.prototype.isEndSegment=function(e,t){return t===0||t>=e.size()-2};Yi.prototype.hasIntersection=function(){return this._interiorIntersection!==null};Yi.prototype.isDone=function(){return this._findAllIntersections?!1:this._interiorIntersection!==null};Yi.prototype.interfaces_=function(){return[Jh]};Yi.prototype.getClass=function(){return Yi};Yi.createAllIntersectionsFinder=function(e){var t=new Yi(e);return t.setFindAllIntersections(!0),t};Yi.createAnyIntersectionFinder=function(e){return new Yi(e)};Yi.createIntersectionCounter=function(e){var t=new Yi(e);return t.setFindAllIntersections(!0),t.setKeepIntersections(!1),t};var Ha=function(){this._li=new lp,this._segStrings=null,this._findAllIntersections=!1,this._segInt=null,this._isValid=!0;var e=arguments[0];this._segStrings=e};Ha.prototype.execute=function(){if(this._segInt!==null)return null;this.checkInteriorIntersections()};Ha.prototype.getIntersections=function(){return this._segInt.getIntersections()};Ha.prototype.isValid=function(){return this.execute(),this._isValid};Ha.prototype.setFindAllIntersections=function(e){this._findAllIntersections=e};Ha.prototype.checkInteriorIntersections=function(){this._isValid=!0,this._segInt=new Yi(this._li),this._segInt.setFindAllIntersections(this._findAllIntersections);var e=new x1;if(e.setSegmentIntersector(this._segInt),e.computeNodes(this._segStrings),this._segInt.hasIntersection())return this._isValid=!1,null};Ha.prototype.checkValid=function(){if(this.execute(),!this._isValid)throw new qu(this.getErrorMessage(),this._segInt.getInteriorIntersection())};Ha.prototype.getErrorMessage=function(){if(this._isValid)return"no intersections found";var e=this._segInt.getIntersectionSegments();return"found non-noded intersection between "+Va.toLineString(e[0],e[1])+" and "+Va.toLineString(e[2],e[3])};Ha.prototype.interfaces_=function(){return[]};Ha.prototype.getClass=function(){return Ha};Ha.computeIntersections=function(e){var t=new Ha(e);return t.setFindAllIntersections(!0),t.isValid(),t.getIntersections()};var ep=function e(){this._nv=null;var t=arguments[0];this._nv=new Ha(e.toSegmentStrings(t))};ep.prototype.checkValid=function(){this._nv.checkValid()};ep.prototype.interfaces_=function(){return[]};ep.prototype.getClass=function(){return ep};ep.toSegmentStrings=function(e){for(var t=new me,r=e.iterator();r.hasNext();){var n=r.next();t.add(new Ol(n.getCoordinates(),n))}return t};ep.checkValid=function(e){var t=new ep(e);t.checkValid()};var jp=function(e){this._mapOp=e};jp.prototype.map=function(e){for(var t=this,r=new me,n=0;n<e.getNumGeometries();n++){var i=t._mapOp.map(e.getGeometryN(n));i.isEmpty()||r.add(i)}return e.getFactory().createGeometryCollection(Er.toGeometryArray(r))};jp.prototype.interfaces_=function(){return[]};jp.prototype.getClass=function(){return jp};jp.map=function(e,t){var r=new jp(t);return r.map(e)};var Fl=function(){this._op=null,this._geometryFactory=null,this._ptLocator=null,this._lineEdgesList=new me,this._resultLineList=new me;var e=arguments[0],t=arguments[1],r=arguments[2];this._op=e,this._geometryFactory=t,this._ptLocator=r};Fl.prototype.collectLines=function(e){for(var t=this,r=this._op.getGraph().getEdgeEnds().iterator();r.hasNext();){var n=r.next();t.collectLineEdge(n,e,t._lineEdgesList),t.collectBoundaryTouchEdge(n,e,t._lineEdgesList)}};Fl.prototype.labelIsolatedLine=function(e,t){var r=this._ptLocator.locate(e.getCoordinate(),this._op.getArgGeometry(t));e.getLabel().setLocation(t,r)};Fl.prototype.build=function(e){return this.findCoveredLineEdges(),this.collectLines(e),this.buildLines(e),this._resultLineList};Fl.prototype.collectLineEdge=function(e,t,r){var n=e.getLabel(),i=e.getEdge();e.isLineEdge()&&!e.isVisited()&&hr.isResultOfOp(n,t)&&!i.isCovered()&&(r.add(i),e.setVisitedEdge(!0))};Fl.prototype.findCoveredLineEdges=function(){for(var e=this,t=this._op.getGraph().getNodes().iterator();t.hasNext();){var r=t.next();r.getEdges().findCoveredLineEdges()}for(var n=this._op.getGraph().getEdgeEnds().iterator();n.hasNext();){var i=n.next(),l=i.getEdge();if(i.isLineEdge()&&!l.isCoveredSet()){var h=e._op.isCoveredByA(i.getCoordinate());l.setCovered(h)}}};Fl.prototype.labelIsolatedLines=function(e){for(var t=this,r=e.iterator();r.hasNext();){var n=r.next(),i=n.getLabel();n.isIsolated()&&(i.isNull(0)?t.labelIsolatedLine(n,0):t.labelIsolatedLine(n,1))}};Fl.prototype.buildLines=function(e){for(var t=this,r=this._lineEdgesList.iterator();r.hasNext();){var n=r.next(),i=t._geometryFactory.createLineString(n.getCoordinates());t._resultLineList.add(i),n.setInResult(!0)}};Fl.prototype.collectBoundaryTouchEdge=function(e,t,r){var n=e.getLabel();if(e.isLineEdge()||e.isVisited()||e.isInteriorAreaEdge()||e.getEdge().isInResult())return null;dr.isTrue(!(e.isInResult()||e.getSym().isInResult())||!e.getEdge().isInResult()),hr.isResultOfOp(n,t)&&t===hr.INTERSECTION&&(r.add(e.getEdge()),e.setVisitedEdge(!0))};Fl.prototype.interfaces_=function(){return[]};Fl.prototype.getClass=function(){return Fl};var Vp=function(){this._op=null,this._geometryFactory=null,this._resultPointList=new me;var e=arguments[0],t=arguments[1];this._op=e,this._geometryFactory=t};Vp.prototype.filterCoveredNodeToPoint=function(e){var t=e.getCoordinate();if(!this._op.isCoveredByLA(t)){var r=this._geometryFactory.createPoint(t);this._resultPointList.add(r)}};Vp.prototype.extractNonCoveredResultNodes=function(e){for(var t=this,r=this._op.getGraph().getNodes().iterator();r.hasNext();){var n=r.next();if(!n.isInResult()&&!n.isIncidentEdgeInResult()&&(n.getEdges().getDegree()===0||e===hr.INTERSECTION)){var i=n.getLabel();hr.isResultOfOp(i,e)&&t.filterCoveredNodeToPoint(n)}}};Vp.prototype.build=function(e){return this.extractNonCoveredResultNodes(e),this._resultPointList};Vp.prototype.interfaces_=function(){return[]};Vp.prototype.getClass=function(){return Vp};var as=function(){this._inputGeom=null,this._factory=null,this._pruneEmptyGeometry=!0,this._preserveGeometryCollectionType=!0,this._preserveCollections=!1,this._preserveType=!1};as.prototype.transformPoint=function(e,t){return this._factory.createPoint(this.transformCoordinates(e.getCoordinateSequence(),e))};as.prototype.transformPolygon=function(e,t){var r=this,n=!0,i=this.transformLinearRing(e.getExteriorRing(),e);(i===null||!(i instanceof cu)||i.isEmpty())&&(n=!1);for(var l=new me,h=0;h<e.getNumInteriorRing();h++){var a=r.transformLinearRing(e.getInteriorRingN(h),e);a===null||a.isEmpty()||(a instanceof cu||(n=!1),l.add(a))}if(n)return this._factory.createPolygon(i,l.toArray([]));var g=new me;return i!==null&&g.add(i),g.addAll(l),this._factory.buildGeometry(g)};as.prototype.createCoordinateSequence=function(e){return this._factory.getCoordinateSequenceFactory().create(e)};as.prototype.getInputGeometry=function(){return this._inputGeom};as.prototype.transformMultiLineString=function(e,t){for(var r=this,n=new me,i=0;i<e.getNumGeometries();i++){var l=r.transformLineString(e.getGeometryN(i),e);l!==null&&(l.isEmpty()||n.add(l))}return this._factory.buildGeometry(n)};as.prototype.transformCoordinates=function(e,t){return this.copy(e)};as.prototype.transformLineString=function(e,t){return this._factory.createLineString(this.transformCoordinates(e.getCoordinateSequence(),e))};as.prototype.transformMultiPoint=function(e,t){for(var r=this,n=new me,i=0;i<e.getNumGeometries();i++){var l=r.transformPoint(e.getGeometryN(i),e);l!==null&&(l.isEmpty()||n.add(l))}return this._factory.buildGeometry(n)};as.prototype.transformMultiPolygon=function(e,t){for(var r=this,n=new me,i=0;i<e.getNumGeometries();i++){var l=r.transformPolygon(e.getGeometryN(i),e);l!==null&&(l.isEmpty()||n.add(l))}return this._factory.buildGeometry(n)};as.prototype.copy=function(e){return e.copy()};as.prototype.transformGeometryCollection=function(e,t){for(var r=this,n=new me,i=0;i<e.getNumGeometries();i++){var l=r.transform(e.getGeometryN(i));l!==null&&(r._pruneEmptyGeometry&&l.isEmpty()||n.add(l))}return this._preserveGeometryCollectionType?this._factory.createGeometryCollection(Er.toGeometryArray(n)):this._factory.buildGeometry(n)};as.prototype.transform=function(e){if(this._inputGeom=e,this._factory=e.getFactory(),e instanceof Is)return this.transformPoint(e,null);if(e instanceof Qd)return this.transformMultiPoint(e,null);if(e instanceof cu)return this.transformLinearRing(e,null);if(e instanceof Hn)return this.transformLineString(e,null);if(e instanceof Hh)return this.transformMultiLineString(e,null);if(e instanceof Li)return this.transformPolygon(e,null);if(e instanceof su)return this.transformMultiPolygon(e,null);if(e instanceof qo)return this.transformGeometryCollection(e,null);throw new $n("Unknown Geometry subtype: "+e.getClass().getName())};as.prototype.transformLinearRing=function(e,t){var r=this.transformCoordinates(e.getCoordinateSequence(),e);if(r===null)return this._factory.createLinearRing(null);var n=r.size();return n>0&&n<4&&!this._preserveType?this._factory.createLineString(r):this._factory.createLinearRing(r)};as.prototype.interfaces_=function(){return[]};as.prototype.getClass=function(){return as};var mu=function e(){if(this._snapTolerance=0,this._srcPts=null,this._seg=new Ge,this._allowSnappingToSourceVertices=!1,this._isClosed=!1,arguments[0]instanceof Hn&&typeof arguments[1]=="number"){var t=arguments[0],r=arguments[1];e.call(this,t.getCoordinates(),r)}else if(arguments[0]instanceof Array&&typeof arguments[1]=="number"){var n=arguments[0],i=arguments[1];this._srcPts=n,this._isClosed=e.isClosed(n),this._snapTolerance=i}};mu.prototype.snapVertices=function(e,t){for(var r=this,n=this._isClosed?e.size()-1:e.size(),i=0;i<n;i++){var l=e.get(i),h=r.findSnapForVertex(l,t);h!==null&&(e.set(i,new kt(h)),i===0&&r._isClosed&&e.set(e.size()-1,new kt(h)))}};mu.prototype.findSnapForVertex=function(e,t){for(var r=this,n=0;n<t.length;n++){if(e.equals2D(t[n]))return null;if(e.distance(t[n])<r._snapTolerance)return t[n]}return null};mu.prototype.snapTo=function(e){var t=new Sg(this._srcPts);this.snapVertices(t,e),this.snapSegments(t,e);var r=t.toCoordinateArray();return r};mu.prototype.snapSegments=function(e,t){var r=this;if(t.length===0)return null;var n=t.length;t[0].equals2D(t[t.length-1])&&(n=t.length-1);for(var i=0;i<n;i++){var l=t[i],h=r.findSegmentIndexToSnap(l,e);h>=0&&e.add(h+1,new kt(l),!1)}};mu.prototype.findSegmentIndexToSnap=function(e,t){for(var r=this,n=lr.MAX_VALUE,i=-1,l=0;l<t.size()-1;l++){if(r._seg.p0=t.get(l),r._seg.p1=t.get(l+1),r._seg.p0.equals2D(e)||r._seg.p1.equals2D(e)){if(r._allowSnappingToSourceVertices)continue;return-1}var h=r._seg.distance(e);h<r._snapTolerance&&h<n&&(n=h,i=l)}return i};mu.prototype.setAllowSnappingToSourceVertices=function(e){this._allowSnappingToSourceVertices=e};mu.prototype.interfaces_=function(){return[]};mu.prototype.getClass=function(){return mu};mu.isClosed=function(e){return e.length<=1?!1:e[0].equals2D(e[e.length-1])};var ri=function(e){this._srcGeom=e||null},aC={SNAP_PRECISION_FACTOR:{configurable:!0}};ri.prototype.snapTo=function(e,t){var r=this.extractTargetCoordinates(e),n=new lC(t,r);return n.transform(this._srcGeom)};ri.prototype.snapToSelf=function(e,t){var r=this.extractTargetCoordinates(this._srcGeom),n=new lC(e,r,!0),i=n.transform(this._srcGeom),l=i;return t&&rr(l,Vc)&&(l=i.buffer(0)),l};ri.prototype.computeSnapTolerance=function(e){var t=this.computeMinimumSegmentLength(e),r=t/10;return r};ri.prototype.extractTargetCoordinates=function(e){for(var t=new Pl,r=e.getCoordinates(),n=0;n<r.length;n++)t.add(r[n]);return t.toArray(new Array(0).fill(null))};ri.prototype.computeMinimumSegmentLength=function(e){for(var t=lr.MAX_VALUE,r=0;r<e.length-1;r++){var n=e[r].distance(e[r+1]);n<t&&(t=n)}return t};ri.prototype.interfaces_=function(){return[]};ri.prototype.getClass=function(){return ri};ri.snap=function(e,t,r){var n=new Array(2).fill(null),i=new ri(e);n[0]=i.snapTo(t,r);var l=new ri(t);return n[1]=l.snapTo(n[0],r),n};ri.computeOverlaySnapTolerance=function(){if(arguments.length===1){var e=arguments[0],t=ri.computeSizeBasedSnapTolerance(e),r=e.getPrecisionModel();if(r.getType()===Wr.FIXED){var n=1/r.getScale()*2/1.415;n>t&&(t=n)}return t}else if(arguments.length===2){var i=arguments[0],l=arguments[1];return Math.min(ri.computeOverlaySnapTolerance(i),ri.computeOverlaySnapTolerance(l))}};ri.computeSizeBasedSnapTolerance=function(e){var t=e.getEnvelopeInternal(),r=Math.min(t.getHeight(),t.getWidth()),n=r*ri.SNAP_PRECISION_FACTOR;return n};ri.snapToSelf=function(e,t,r){var n=new ri(e);return n.snapToSelf(t,r)};aC.SNAP_PRECISION_FACTOR.get=function(){return 1e-9};Object.defineProperties(ri,aC);var lC=function(e){function t(r,n,i){e.call(this),this._snapTolerance=r||null,this._snapPts=n||null,this._isSelfSnap=i!==void 0?i:!1}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.snapLine=function(r,n){var i=new mu(r,this._snapTolerance);return i.setAllowSnappingToSourceVertices(this._isSelfSnap),i.snapTo(n)},t.prototype.transformCoordinates=function(r,n){var i=r.toCoordinateArray(),l=this.snapLine(i,this._snapPts);return this._factory.getCoordinateSequenceFactory().create(l)},t.prototype.interfaces_=function(){return[]},t.prototype.getClass=function(){return t},t}(as),Bo=function(){this._isFirst=!0,this._commonMantissaBitsCount=53,this._commonBits=0,this._commonSignExp=null};Bo.prototype.getCommon=function(){return lr.longBitsToDouble(this._commonBits)};Bo.prototype.add=function(e){var t=lr.doubleToLongBits(e);if(this._isFirst)return this._commonBits=t,this._commonSignExp=Bo.signExpBits(this._commonBits),this._isFirst=!1,null;var r=Bo.signExpBits(t);if(r!==this._commonSignExp)return this._commonBits=0,null;this._commonMantissaBitsCount=Bo.numCommonMostSigMantissaBits(this._commonBits,t),this._commonBits=Bo.zeroLowerBits(this._commonBits,64-(12+this._commonMantissaBitsCount))};Bo.prototype.toString=function(){if(arguments.length===1){var e=arguments[0],t=lr.longBitsToDouble(e),r=lr.toBinaryString(e),n="0000000000000000000000000000000000000000000000000000000000000000"+r,i=n.substring(n.length-64),l=i.substring(0,1)+"  "+i.substring(1,12)+"(exp) "+i.substring(12)+" [ "+t+" ]";return l}};Bo.prototype.interfaces_=function(){return[]};Bo.prototype.getClass=function(){return Bo};Bo.getBit=function(e,t){var r=1<<t;return e&r?1:0};Bo.signExpBits=function(e){return e>>52};Bo.zeroLowerBits=function(e,t){var r=(1<<t)-1,n=~r,i=e&n;return i};Bo.numCommonMostSigMantissaBits=function(e,t){for(var r=0,n=52;n>=0;n--){if(Bo.getBit(e,n)!==Bo.getBit(t,n))return r;r++}return 52};var Yc=function(){this._commonCoord=null,this._ccFilter=new Gp},T1={CommonCoordinateFilter:{configurable:!0},Translater:{configurable:!0}};Yc.prototype.addCommonBits=function(e){var t=new Kc(this._commonCoord);e.apply(t),e.geometryChanged()};Yc.prototype.removeCommonBits=function(e){if(this._commonCoord.x===0&&this._commonCoord.y===0)return e;var t=new kt(this._commonCoord);t.x=-t.x,t.y=-t.y;var r=new Kc(t);return e.apply(r),e.geometryChanged(),e};Yc.prototype.getCommonCoordinate=function(){return this._commonCoord};Yc.prototype.add=function(e){e.apply(this._ccFilter),this._commonCoord=this._ccFilter.getCommonCoordinate()};Yc.prototype.interfaces_=function(){return[]};Yc.prototype.getClass=function(){return Yc};T1.CommonCoordinateFilter.get=function(){return Gp};T1.Translater.get=function(){return Kc};Object.defineProperties(Yc,T1);var Gp=function(){this._commonBitsX=new Bo,this._commonBitsY=new Bo};Gp.prototype.filter=function(e){this._commonBitsX.add(e.x),this._commonBitsY.add(e.y)};Gp.prototype.getCommonCoordinate=function(){return new kt(this._commonBitsX.getCommon(),this._commonBitsY.getCommon())};Gp.prototype.interfaces_=function(){return[uu]};Gp.prototype.getClass=function(){return Gp};var Kc=function(){this.trans=null;var e=arguments[0];this.trans=e};Kc.prototype.filter=function(e,t){var r=e.getOrdinate(t,0)+this.trans.x,n=e.getOrdinate(t,1)+this.trans.y;e.setOrdinate(t,0,r),e.setOrdinate(t,1,n)};Kc.prototype.isDone=function(){return!1};Kc.prototype.isGeometryChanged=function(){return!0};Kc.prototype.interfaces_=function(){return[Ga]};Kc.prototype.getClass=function(){return Kc};var Ki=function(e,t){this._geom=new Array(2).fill(null),this._snapTolerance=null,this._cbr=null,this._geom[0]=e,this._geom[1]=t,this.computeSnapTolerance()};Ki.prototype.selfSnap=function(e){var t=new ri(e),r=t.snapTo(e,this._snapTolerance);return r};Ki.prototype.removeCommonBits=function(e){this._cbr=new Yc,this._cbr.add(e[0]),this._cbr.add(e[1]);var t=new Array(2).fill(null);return t[0]=this._cbr.removeCommonBits(e[0].copy()),t[1]=this._cbr.removeCommonBits(e[1].copy()),t};Ki.prototype.prepareResult=function(e){return this._cbr.addCommonBits(e),e};Ki.prototype.getResultGeometry=function(e){var t=this.snap(this._geom),r=hr.overlayOp(t[0],t[1],e);return this.prepareResult(r)};Ki.prototype.checkValid=function(e){e.isValid()||so.out.println("Snapped geometry is invalid")};Ki.prototype.computeSnapTolerance=function(){this._snapTolerance=ri.computeOverlaySnapTolerance(this._geom[0],this._geom[1])};Ki.prototype.snap=function(e){var t=this.removeCommonBits(e),r=ri.snap(t[0],t[1],this._snapTolerance);return r};Ki.prototype.interfaces_=function(){return[]};Ki.prototype.getClass=function(){return Ki};Ki.overlayOp=function(e,t,r){var n=new Ki(e,t);return n.getResultGeometry(r)};Ki.union=function(e,t){return Ki.overlayOp(e,t,hr.UNION)};Ki.intersection=function(e,t){return Ki.overlayOp(e,t,hr.INTERSECTION)};Ki.symDifference=function(e,t){return Ki.overlayOp(e,t,hr.SYMDIFFERENCE)};Ki.difference=function(e,t){return Ki.overlayOp(e,t,hr.DIFFERENCE)};var Xo=function(e,t){this._geom=new Array(2).fill(null),this._geom[0]=e,this._geom[1]=t};Xo.prototype.getResultGeometry=function(e){var t=null,r=!1,n=null;try{t=hr.overlayOp(this._geom[0],this._geom[1],e);var i=!0;i&&(r=!0)}catch(l){if(l instanceof Vu)n=l;else throw l}finally{}if(!r)try{t=Ki.overlayOp(this._geom[0],this._geom[1],e)}catch(l){throw l instanceof Vu?n:l}finally{}return t};Xo.prototype.interfaces_=function(){return[]};Xo.prototype.getClass=function(){return Xo};Xo.overlayOp=function(e,t,r){var n=new Xo(e,t);return n.getResultGeometry(r)};Xo.union=function(e,t){return Xo.overlayOp(e,t,hr.UNION)};Xo.intersection=function(e,t){return Xo.overlayOp(e,t,hr.INTERSECTION)};Xo.symDifference=function(e,t){return Xo.overlayOp(e,t,hr.SYMDIFFERENCE)};Xo.difference=function(e,t){return Xo.overlayOp(e,t,hr.DIFFERENCE)};var cg=function(){this.mce=null,this.chainIndex=null;var e=arguments[0],t=arguments[1];this.mce=e,this.chainIndex=t};cg.prototype.computeIntersections=function(e,t){this.mce.computeIntersectsForChain(this.chainIndex,e.mce,e.chainIndex,t)};cg.prototype.interfaces_=function(){return[]};cg.prototype.getClass=function(){return cg};var Ps=function e(){if(this._label=null,this._xValue=null,this._eventType=null,this._insertEvent=null,this._deleteEventIndex=null,this._obj=null,arguments.length===2){var t=arguments[0],r=arguments[1];this._eventType=e.DELETE,this._xValue=t,this._insertEvent=r}else if(arguments.length===3){var n=arguments[0],i=arguments[1],l=arguments[2];this._eventType=e.INSERT,this._label=n,this._xValue=i,this._obj=l}},I1={INSERT:{configurable:!0},DELETE:{configurable:!0}};Ps.prototype.isDelete=function(){return this._eventType===Ps.DELETE};Ps.prototype.setDeleteEventIndex=function(e){this._deleteEventIndex=e};Ps.prototype.getObject=function(){return this._obj};Ps.prototype.compareTo=function(e){var t=e;return this._xValue<t._xValue?-1:this._xValue>t._xValue?1:this._eventType<t._eventType?-1:this._eventType>t._eventType?1:0};Ps.prototype.getInsertEvent=function(){return this._insertEvent};Ps.prototype.isInsert=function(){return this._eventType===Ps.INSERT};Ps.prototype.isSameLabel=function(e){return this._label===null?!1:this._label===e._label};Ps.prototype.getDeleteEventIndex=function(){return this._deleteEventIndex};Ps.prototype.interfaces_=function(){return[Ia]};Ps.prototype.getClass=function(){return Ps};I1.INSERT.get=function(){return 1};I1.DELETE.get=function(){return 2};Object.defineProperties(Ps,I1);var w_=function(){};w_.prototype.interfaces_=function(){return[]};w_.prototype.getClass=function(){return w_};var uo=function(){this._hasIntersection=!1,this._hasProper=!1,this._hasProperInterior=!1,this._properIntersectionPoint=null,this._li=null,this._includeProper=null,this._recordIsolated=null,this._isSelfIntersection=null,this._numIntersections=0,this.numTests=0,this._bdyNodes=null,this._isDone=!1,this._isDoneWhenProperInt=!1;var e=arguments[0],t=arguments[1],r=arguments[2];this._li=e,this._includeProper=t,this._recordIsolated=r};uo.prototype.isTrivialIntersection=function(e,t,r,n){if(e===r&&this._li.getIntersectionNum()===1){if(uo.isAdjacentSegments(t,n))return!0;if(e.isClosed()){var i=e.getNumPoints()-1;if(t===0&&n===i||n===0&&t===i)return!0}}return!1};uo.prototype.getProperIntersectionPoint=function(){return this._properIntersectionPoint};uo.prototype.setIsDoneIfProperInt=function(e){this._isDoneWhenProperInt=e};uo.prototype.hasProperInteriorIntersection=function(){return this._hasProperInterior};uo.prototype.isBoundaryPointInternal=function(e,t){for(var r=t.iterator();r.hasNext();){var n=r.next(),i=n.getCoordinate();if(e.isIntersection(i))return!0}return!1};uo.prototype.hasProperIntersection=function(){return this._hasProper};uo.prototype.hasIntersection=function(){return this._hasIntersection};uo.prototype.isDone=function(){return this._isDone};uo.prototype.isBoundaryPoint=function(e,t){return t===null?!1:!!(this.isBoundaryPointInternal(e,t[0])||this.isBoundaryPointInternal(e,t[1]))};uo.prototype.setBoundaryNodes=function(e,t){this._bdyNodes=new Array(2).fill(null),this._bdyNodes[0]=e,this._bdyNodes[1]=t};uo.prototype.addIntersections=function(e,t,r,n){if(e===r&&t===n)return null;this.numTests++;var i=e.getCoordinates()[t],l=e.getCoordinates()[t+1],h=r.getCoordinates()[n],a=r.getCoordinates()[n+1];this._li.computeIntersection(i,l,h,a),this._li.hasIntersection()&&(this._recordIsolated&&(e.setIsolated(!1),r.setIsolated(!1)),this._numIntersections++,this.isTrivialIntersection(e,t,r,n)||(this._hasIntersection=!0,(this._includeProper||!this._li.isProper())&&(e.addIntersections(this._li,t,0),r.addIntersections(this._li,n,1)),this._li.isProper()&&(this._properIntersectionPoint=this._li.getIntersection(0).copy(),this._hasProper=!0,this._isDoneWhenProperInt&&(this._isDone=!0),this.isBoundaryPoint(this._li,this._bdyNodes)||(this._hasProperInterior=!0))))};uo.prototype.interfaces_=function(){return[]};uo.prototype.getClass=function(){return uo};uo.isAdjacentSegments=function(e,t){return Math.abs(e-t)===1};var i5=function(e){function t(){e.call(this),this.events=new me,this.nOverlaps=null}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.prepareEvents=function(){var r=this;Za.sort(this.events);for(var n=0;n<this.events.size();n++){var i=r.events.get(n);i.isDelete()&&i.getInsertEvent().setDeleteEventIndex(n)}},t.prototype.computeIntersections=function(){var r=this;if(arguments.length===1){var n=arguments[0];this.nOverlaps=0,this.prepareEvents();for(var i=0;i<this.events.size();i++){var l=r.events.get(i);if(l.isInsert()&&r.processOverlaps(i,l.getDeleteEventIndex(),l,n),n.isDone())break}}else if(arguments.length===3){if(arguments[2]instanceof uo&&rr(arguments[0],Ua)&&rr(arguments[1],Ua)){var h=arguments[0],a=arguments[1],g=arguments[2];this.addEdges(h,h),this.addEdges(a,a),this.computeIntersections(g)}else if(typeof arguments[2]=="boolean"&&rr(arguments[0],Ua)&&arguments[1]instanceof uo){var _=arguments[0],E=arguments[1],S=arguments[2];S?this.addEdges(_,null):this.addEdges(_),this.computeIntersections(E)}}},t.prototype.addEdge=function(r,n){for(var i=this,l=r.getMonotoneChainEdge(),h=l.getStartIndexes(),a=0;a<h.length-1;a++){var g=new cg(l,a),_=new Ps(n,l.getMinX(a),g);i.events.add(_),i.events.add(new Ps(l.getMaxX(a),_))}},t.prototype.processOverlaps=function(r,n,i,l){for(var h=this,a=i.getObject(),g=r;g<n;g++){var _=h.events.get(g);if(_.isInsert()){var E=_.getObject();i.isSameLabel(_)||(a.computeIntersections(E,l),h.nOverlaps++)}}},t.prototype.addEdges=function(){var r=this;if(arguments.length===1)for(var n=arguments[0],i=n.iterator();i.hasNext();){var l=i.next();r.addEdge(l,l)}else if(arguments.length===2)for(var h=arguments[0],a=arguments[1],g=h.iterator();g.hasNext();){var _=g.next();r.addEdge(_,a)}},t.prototype.interfaces_=function(){return[]},t.prototype.getClass=function(){return t},t}(w_),gu=function(){this._min=lr.POSITIVE_INFINITY,this._max=lr.NEGATIVE_INFINITY},uC={NodeComparator:{configurable:!0}};gu.prototype.getMin=function(){return this._min};gu.prototype.intersects=function(e,t){return!(this._min>t||this._max<e)};gu.prototype.getMax=function(){return this._max};gu.prototype.toString=function(){return Va.toLineString(new kt(this._min,0),new kt(this._max,0))};gu.prototype.interfaces_=function(){return[]};gu.prototype.getClass=function(){return gu};uC.NodeComparator.get=function(){return hg};Object.defineProperties(gu,uC);var hg=function(){};hg.prototype.compare=function(e,t){var r=e,n=t,i=(r._min+r._max)/2,l=(n._min+n._max)/2;return i<l?-1:i>l?1:0};hg.prototype.interfaces_=function(){return[Zd]};hg.prototype.getClass=function(){return hg};var o5=function(e){function t(){e.call(this),this._item=null;var r=arguments[0],n=arguments[1],i=arguments[2];this._min=r,this._max=n,this._item=i}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.query=function(r,n,i){if(!this.intersects(r,n))return null;i.visitItem(this._item)},t.prototype.interfaces_=function(){return[]},t.prototype.getClass=function(){return t},t}(gu),s5=function(e){function t(){e.call(this),this._node1=null,this._node2=null;var r=arguments[0],n=arguments[1];this._node1=r,this._node2=n,this.buildExtent(this._node1,this._node2)}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.buildExtent=function(r,n){this._min=Math.min(r._min,n._min),this._max=Math.max(r._max,n._max)},t.prototype.query=function(r,n,i){if(!this.intersects(r,n))return null;this._node1!==null&&this._node1.query(r,n,i),this._node2!==null&&this._node2.query(r,n,i)},t.prototype.interfaces_=function(){return[]},t.prototype.getClass=function(){return t},t}(gu),yu=function(){this._leaves=new me,this._root=null,this._level=0};yu.prototype.buildTree=function(){var e=this;Za.sort(this._leaves,new gu.NodeComparator);for(var t=this._leaves,r=null,n=new me;;){if(e.buildLevel(t,n),n.size()===1)return n.get(0);r=t,t=n,n=r}};yu.prototype.insert=function(e,t,r){if(this._root!==null)throw new Error("Index cannot be added to once it has been queried");this._leaves.add(new o5(e,t,r))};yu.prototype.query=function(e,t,r){this.init(),this._root.query(e,t,r)};yu.prototype.buildRoot=function(){if(this._root!==null)return null;this._root=this.buildTree()};yu.prototype.printNode=function(e){so.out.println(Va.toLineString(new kt(e._min,this._level),new kt(e._max,this._level)))};yu.prototype.init=function(){if(this._root!==null)return null;this.buildRoot()};yu.prototype.buildLevel=function(e,t){this._level++,t.clear();for(var r=0;r<e.size();r+=2){var n=e.get(r),i=r+1<e.size()?e.get(r):null;if(i===null)t.add(n);else{var l=new s5(e.get(r),e.get(r+1));t.add(l)}}};yu.prototype.interfaces_=function(){return[]};yu.prototype.getClass=function(){return yu};var sf=function(){this._items=new me};sf.prototype.visitItem=function(e){this._items.add(e)};sf.prototype.getItems=function(){return this._items};sf.prototype.interfaces_=function(){return[Gc]};sf.prototype.getClass=function(){return sf};var af=function(){this._index=null;var e=arguments[0];if(!rr(e,Vc))throw new $n("Argument must be Polygonal");this._index=new rp(e)},C1={SegmentVisitor:{configurable:!0},IntervalIndexedGeometry:{configurable:!0}};af.prototype.locate=function(e){var t=new Tl(e),r=new lf(t);return this._index.query(e.y,e.y,r),t.getLocation()};af.prototype.interfaces_=function(){return[nf]};af.prototype.getClass=function(){return af};C1.SegmentVisitor.get=function(){return lf};C1.IntervalIndexedGeometry.get=function(){return rp};Object.defineProperties(af,C1);var lf=function(){this._counter=null;var e=arguments[0];this._counter=e};lf.prototype.visitItem=function(e){var t=e;this._counter.countSegment(t.getCoordinate(0),t.getCoordinate(1))};lf.prototype.interfaces_=function(){return[Gc]};lf.prototype.getClass=function(){return lf};var rp=function(){this._index=new yu;var e=arguments[0];this.init(e)};rp.prototype.init=function(e){for(var t=this,r=no.getLines(e),n=r.iterator();n.hasNext();){var i=n.next(),l=i.getCoordinates();t.addLine(l)}};rp.prototype.addLine=function(e){for(var t=this,r=1;r<e.length;r++){var n=new Ge(e[r-1],e[r]),i=Math.min(n.p0.y,n.p1.y),l=Math.max(n.p0.y,n.p1.y);t._index.insert(i,l,n)}};rp.prototype.query=function(){if(arguments.length===2){var e=arguments[0],t=arguments[1],r=new sf;return this._index.query(e,t,r),r.getItems()}else if(arguments.length===3){var n=arguments[0],i=arguments[1],l=arguments[2];this._index.query(n,i,l)}};rp.prototype.interfaces_=function(){return[]};rp.prototype.getClass=function(){return rp};var pm=function(e){function t(){if(e.call(this),this._parentGeom=null,this._lineEdgeMap=new ZI,this._boundaryNodeRule=null,this._useBoundaryDeterminationRule=!0,this._argIndex=null,this._boundaryNodes=null,this._hasTooFewPoints=!1,this._invalidPoint=null,this._areaPtLocator=null,this._ptLocator=new Xa,arguments.length===2){var r=arguments[0],n=arguments[1],i=wa.OGC_SFS_BOUNDARY_RULE;this._argIndex=r,this._parentGeom=n,this._boundaryNodeRule=i,n!==null&&this.add(n)}else if(arguments.length===3){var l=arguments[0],h=arguments[1],a=arguments[2];this._argIndex=l,this._parentGeom=h,this._boundaryNodeRule=a,h!==null&&this.add(h)}}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.insertBoundaryPoint=function(r,n){var i=this._nodes.addNode(n),l=i.getLabel(),h=1,a=Bt.NONE;a=l.getLocation(r,se.ON),a===Bt.BOUNDARY&&h++;var g=t.determineBoundary(this._boundaryNodeRule,h);l.setLocation(r,g)},t.prototype.computeSelfNodes=function(){if(arguments.length===2){var r=arguments[0],n=arguments[1];return this.computeSelfNodes(r,n,!1)}else if(arguments.length===3){var i=arguments[0],l=arguments[1],h=arguments[2],a=new uo(i,!0,!1);a.setIsDoneIfProperInt(h);var g=this.createEdgeSetIntersector(),_=this._parentGeom instanceof cu||this._parentGeom instanceof Li||this._parentGeom instanceof su,E=l||!_;return g.computeIntersections(this._edges,a,E),this.addSelfIntersectionNodes(this._argIndex),a}},t.prototype.computeSplitEdges=function(r){for(var n=this._edges.iterator();n.hasNext();){var i=n.next();i.eiList.addSplitEdges(r)}},t.prototype.computeEdgeIntersections=function(r,n,i){var l=new uo(n,i,!0);l.setBoundaryNodes(this.getBoundaryNodes(),r.getBoundaryNodes());var h=this.createEdgeSetIntersector();return h.computeIntersections(this._edges,r._edges,l),l},t.prototype.getGeometry=function(){return this._parentGeom},t.prototype.getBoundaryNodeRule=function(){return this._boundaryNodeRule},t.prototype.hasTooFewPoints=function(){return this._hasTooFewPoints},t.prototype.addPoint=function(){if(arguments[0]instanceof Is){var r=arguments[0],n=r.getCoordinate();this.insertPoint(this._argIndex,n,Bt.INTERIOR)}else if(arguments[0]instanceof kt){var i=arguments[0];this.insertPoint(this._argIndex,i,Bt.INTERIOR)}},t.prototype.addPolygon=function(r){var n=this;this.addPolygonRing(r.getExteriorRing(),Bt.EXTERIOR,Bt.INTERIOR);for(var i=0;i<r.getNumInteriorRing();i++){var l=r.getInteriorRingN(i);n.addPolygonRing(l,Bt.INTERIOR,Bt.EXTERIOR)}},t.prototype.addEdge=function(r){this.insertEdge(r);var n=r.getCoordinates();this.insertPoint(this._argIndex,n[0],Bt.BOUNDARY),this.insertPoint(this._argIndex,n[n.length-1],Bt.BOUNDARY)},t.prototype.addLineString=function(r){var n=Sr.removeRepeatedPoints(r.getCoordinates());if(n.length<2)return this._hasTooFewPoints=!0,this._invalidPoint=n[0],null;var i=new b_(n,new an(this._argIndex,Bt.INTERIOR));this._lineEdgeMap.put(r,i),this.insertEdge(i),dr.isTrue(n.length>=2,"found LineString with single point"),this.insertBoundaryPoint(this._argIndex,n[0]),this.insertBoundaryPoint(this._argIndex,n[n.length-1])},t.prototype.getInvalidPoint=function(){return this._invalidPoint},t.prototype.getBoundaryPoints=function(){for(var r=this.getBoundaryNodes(),n=new Array(r.size()).fill(null),i=0,l=r.iterator();l.hasNext();){var h=l.next();n[i++]=h.getCoordinate().copy()}return n},t.prototype.getBoundaryNodes=function(){return this._boundaryNodes===null&&(this._boundaryNodes=this._nodes.getBoundaryNodes(this._argIndex)),this._boundaryNodes},t.prototype.addSelfIntersectionNode=function(r,n,i){if(this.isBoundaryNode(r,n))return null;i===Bt.BOUNDARY&&this._useBoundaryDeterminationRule?this.insertBoundaryPoint(r,n):this.insertPoint(r,n,i)},t.prototype.addPolygonRing=function(r,n,i){if(r.isEmpty())return null;var l=Sr.removeRepeatedPoints(r.getCoordinates());if(l.length<4)return this._hasTooFewPoints=!0,this._invalidPoint=l[0],null;var h=n,a=i;Ie.isCCW(l)&&(h=i,a=n);var g=new b_(l,new an(this._argIndex,Bt.BOUNDARY,h,a));this._lineEdgeMap.put(r,g),this.insertEdge(g),this.insertPoint(this._argIndex,l[0],Bt.BOUNDARY)},t.prototype.insertPoint=function(r,n,i){var l=this._nodes.addNode(n),h=l.getLabel();h===null?l._label=new an(r,i):h.setLocation(r,i)},t.prototype.createEdgeSetIntersector=function(){return new i5},t.prototype.addSelfIntersectionNodes=function(r){for(var n=this,i=this._edges.iterator();i.hasNext();)for(var l=i.next(),h=l.getLabel().getLocation(r),a=l.eiList.iterator();a.hasNext();){var g=a.next();n.addSelfIntersectionNode(r,g.coord,h)}},t.prototype.add=function(){if(arguments.length===1){var r=arguments[0];if(r.isEmpty())return null;if(r instanceof su&&(this._useBoundaryDeterminationRule=!1),r instanceof Li)this.addPolygon(r);else if(r instanceof Hn)this.addLineString(r);else if(r instanceof Is)this.addPoint(r);else if(r instanceof Qd)this.addCollection(r);else if(r instanceof Hh)this.addCollection(r);else if(r instanceof su)this.addCollection(r);else if(r instanceof qo)this.addCollection(r);else throw new Error(r.getClass().getName())}else return e.prototype.add.apply(this,arguments)},t.prototype.addCollection=function(r){for(var n=this,i=0;i<r.getNumGeometries();i++){var l=r.getGeometryN(i);n.add(l)}},t.prototype.locate=function(r){return rr(this._parentGeom,Vc)&&this._parentGeom.getNumGeometries()>50?(this._areaPtLocator===null&&(this._areaPtLocator=new af(this._parentGeom)),this._areaPtLocator.locate(r)):this._ptLocator.locate(r,this._parentGeom)},t.prototype.findEdge=function(){if(arguments.length===1){var r=arguments[0];return this._lineEdgeMap.get(r)}else return e.prototype.findEdge.apply(this,arguments)},t.prototype.interfaces_=function(){return[]},t.prototype.getClass=function(){return t},t.determineBoundary=function(r,n){return r.isInBoundary(n)?Bt.BOUNDARY:Bt.INTERIOR},t}(qn),uf=function(){if(this._li=new lp,this._resultPrecisionModel=null,this._arg=null,arguments.length===1){var e=arguments[0];this.setComputationPrecision(e.getPrecisionModel()),this._arg=new Array(1).fill(null),this._arg[0]=new pm(0,e)}else if(arguments.length===2){var t=arguments[0],r=arguments[1],n=wa.OGC_SFS_BOUNDARY_RULE;t.getPrecisionModel().compareTo(r.getPrecisionModel())>=0?this.setComputationPrecision(t.getPrecisionModel()):this.setComputationPrecision(r.getPrecisionModel()),this._arg=new Array(2).fill(null),this._arg[0]=new pm(0,t,n),this._arg[1]=new pm(1,r,n)}else if(arguments.length===3){var i=arguments[0],l=arguments[1],h=arguments[2];i.getPrecisionModel().compareTo(l.getPrecisionModel())>=0?this.setComputationPrecision(i.getPrecisionModel()):this.setComputationPrecision(l.getPrecisionModel()),this._arg=new Array(2).fill(null),this._arg[0]=new pm(0,i,h),this._arg[1]=new pm(1,l,h)}};uf.prototype.getArgGeometry=function(e){return this._arg[e].getGeometry()};uf.prototype.setComputationPrecision=function(e){this._resultPrecisionModel=e,this._li.setPrecisionModel(this._resultPrecisionModel)};uf.prototype.interfaces_=function(){return[]};uf.prototype.getClass=function(){return uf};var $h=function(){};$h.prototype.interfaces_=function(){return[]};$h.prototype.getClass=function(){return $h};$h.map=function(){if(arguments[0]instanceof tr&&rr(arguments[1],$h.MapOp)){for(var e=arguments[0],t=arguments[1],r=new me,n=0;n<e.getNumGeometries();n++){var i=t.map(e.getGeometryN(n));i!==null&&r.add(i)}return e.getFactory().buildGeometry(r)}else if(rr(arguments[0],Ii)&&rr(arguments[1],$h.MapOp)){for(var l=arguments[0],h=arguments[1],a=new me,g=l.iterator();g.hasNext();){var _=g.next(),E=h.map(_);E!==null&&a.add(E)}return a}};$h.MapOp=function(){};var hr=function(e){function t(){var r=arguments[0],n=arguments[1];e.call(this,r,n),this._ptLocator=new Xa,this._geomFact=null,this._resultGeom=null,this._graph=null,this._edgeList=new Wa,this._resultPolyList=new me,this._resultLineList=new me,this._resultPointList=new me,this._graph=new qn(new tC),this._geomFact=r.getFactory()}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.insertUniqueEdge=function(r){var n=this._edgeList.findEqualEdge(r);if(n!==null){var i=n.getLabel(),l=r.getLabel();n.isPointwiseEqual(r)||(l=new an(r.getLabel()),l.flip());var h=n.getDepth();h.isNull()&&h.add(i),h.add(l),i.merge(l)}else this._edgeList.add(r)},t.prototype.getGraph=function(){return this._graph},t.prototype.cancelDuplicateResultEdges=function(){for(var r=this._graph.getEdgeEnds().iterator();r.hasNext();){var n=r.next(),i=n.getSym();n.isInResult()&&i.isInResult()&&(n.setInResult(!1),i.setInResult(!1))}},t.prototype.isCoveredByLA=function(r){return!!(this.isCovered(r,this._resultLineList)||this.isCovered(r,this._resultPolyList))},t.prototype.computeGeometry=function(r,n,i,l){var h=new me;return h.addAll(r),h.addAll(n),h.addAll(i),h.isEmpty()?t.createEmptyResult(l,this._arg[0].getGeometry(),this._arg[1].getGeometry(),this._geomFact):this._geomFact.buildGeometry(h)},t.prototype.mergeSymLabels=function(){for(var r=this._graph.getNodes().iterator();r.hasNext();){var n=r.next();n.getEdges().mergeSymLabels()}},t.prototype.isCovered=function(r,n){for(var i=this,l=n.iterator();l.hasNext();){var h=l.next(),a=i._ptLocator.locate(r,h);if(a!==Bt.EXTERIOR)return!0}return!1},t.prototype.replaceCollapsedEdges=function(){for(var r=new me,n=this._edgeList.iterator();n.hasNext();){var i=n.next();i.isCollapsed()&&(n.remove(),r.add(i.getCollapsedEdge()))}this._edgeList.addAll(r)},t.prototype.updateNodeLabelling=function(){for(var r=this._graph.getNodes().iterator();r.hasNext();){var n=r.next(),i=n.getEdges().getLabel();n.getLabel().merge(i)}},t.prototype.getResultGeometry=function(r){return this.computeOverlay(r),this._resultGeom},t.prototype.insertUniqueEdges=function(r){for(var n=this,i=r.iterator();i.hasNext();){var l=i.next();n.insertUniqueEdge(l)}},t.prototype.computeOverlay=function(r){this.copyPoints(0),this.copyPoints(1),this._arg[0].computeSelfNodes(this._li,!1),this._arg[1].computeSelfNodes(this._li,!1),this._arg[0].computeEdgeIntersections(this._arg[1],this._li,!0);var n=new me;this._arg[0].computeSplitEdges(n),this._arg[1].computeSplitEdges(n),this.insertUniqueEdges(n),this.computeLabelsFromDepths(),this.replaceCollapsedEdges(),ep.checkValid(this._edgeList.getEdges()),this._graph.addEdges(this._edgeList.getEdges()),this.computeLabelling(),this.labelIncompleteNodes(),this.findResultAreaEdges(r),this.cancelDuplicateResultEdges();var i=new Cs(this._geomFact);i.add(this._graph),this._resultPolyList=i.getPolygons();var l=new Fl(this,this._geomFact,this._ptLocator);this._resultLineList=l.build(r);var h=new Vp(this,this._geomFact,this._ptLocator);this._resultPointList=h.build(r),this._resultGeom=this.computeGeometry(this._resultPointList,this._resultLineList,this._resultPolyList,r)},t.prototype.labelIncompleteNode=function(r,n){var i=this._ptLocator.locate(r.getCoordinate(),this._arg[n].getGeometry());r.getLabel().setLocation(n,i)},t.prototype.copyPoints=function(r){for(var n=this,i=this._arg[r].getNodeIterator();i.hasNext();){var l=i.next(),h=n._graph.addNode(l.getCoordinate());h.setLabel(r,l.getLabel().getLocation(r))}},t.prototype.findResultAreaEdges=function(r){for(var n=this._graph.getEdgeEnds().iterator();n.hasNext();){var i=n.next(),l=i.getLabel();l.isArea()&&!i.isInteriorAreaEdge()&&t.isResultOfOp(l.getLocation(0,se.RIGHT),l.getLocation(1,se.RIGHT),r)&&i.setInResult(!0)}},t.prototype.computeLabelsFromDepths=function(){for(var r=this._edgeList.iterator();r.hasNext();){var n=r.next(),i=n.getLabel(),l=n.getDepth();if(!l.isNull()){l.normalize();for(var h=0;h<2;h++)!i.isNull(h)&&i.isArea()&&!l.isNull(h)&&(l.getDelta(h)===0?i.toLine(h):(dr.isTrue(!l.isNull(h,se.LEFT),"depth of LEFT side has not been initialized"),i.setLocation(h,se.LEFT,l.getLocation(h,se.LEFT)),dr.isTrue(!l.isNull(h,se.RIGHT),"depth of RIGHT side has not been initialized"),i.setLocation(h,se.RIGHT,l.getLocation(h,se.RIGHT))))}}},t.prototype.computeLabelling=function(){for(var r=this,n=this._graph.getNodes().iterator();n.hasNext();){var i=n.next();i.getEdges().computeLabelling(r._arg)}this.mergeSymLabels(),this.updateNodeLabelling()},t.prototype.labelIncompleteNodes=function(){for(var r=this,n=this._graph.getNodes().iterator();n.hasNext();){var i=n.next(),l=i.getLabel();i.isIsolated()&&(l.isNull(0)?r.labelIncompleteNode(i,0):r.labelIncompleteNode(i,1)),i.getEdges().updateLabelling(l)}},t.prototype.isCoveredByA=function(r){return!!this.isCovered(r,this._resultPolyList)},t.prototype.interfaces_=function(){return[]},t.prototype.getClass=function(){return t},t}(uf);hr.overlayOp=function(e,t,r){var n=new hr(e,t),i=n.getResultGeometry(r);return i};hr.intersection=function(e,t){if(e.isEmpty()||t.isEmpty())return hr.createEmptyResult(hr.INTERSECTION,e,t,e.getFactory());if(e.isGeometryCollection()){var r=t;return jp.map(e,{interfaces_:function(){return[$h.MapOp]},map:function(n){return n.intersection(r)}})}return e.checkNotGeometryCollection(e),e.checkNotGeometryCollection(t),Xo.overlayOp(e,t,hr.INTERSECTION)};hr.symDifference=function(e,t){if(e.isEmpty()||t.isEmpty()){if(e.isEmpty()&&t.isEmpty())return hr.createEmptyResult(hr.SYMDIFFERENCE,e,t,e.getFactory());if(e.isEmpty())return t.copy();if(t.isEmpty())return e.copy()}return e.checkNotGeometryCollection(e),e.checkNotGeometryCollection(t),Xo.overlayOp(e,t,hr.SYMDIFFERENCE)};hr.resultDimension=function(e,t,r){var n=t.getDimension(),i=r.getDimension(),l=-1;switch(e){case hr.INTERSECTION:l=Math.min(n,i);break;case hr.UNION:l=Math.max(n,i);break;case hr.DIFFERENCE:l=n;break;case hr.SYMDIFFERENCE:l=Math.max(n,i);break}return l};hr.createEmptyResult=function(e,t,r,n){var i=null;switch(hr.resultDimension(e,t,r)){case-1:i=n.createGeometryCollection(new Array(0).fill(null));break;case 0:i=n.createPoint();break;case 1:i=n.createLineString();break;case 2:i=n.createPolygon();break}return i};hr.difference=function(e,t){return e.isEmpty()?hr.createEmptyResult(hr.DIFFERENCE,e,t,e.getFactory()):t.isEmpty()?e.copy():(e.checkNotGeometryCollection(e),e.checkNotGeometryCollection(t),Xo.overlayOp(e,t,hr.DIFFERENCE))};hr.isResultOfOp=function(){if(arguments.length===2){var e=arguments[0],t=arguments[1],r=e.getLocation(0),n=e.getLocation(1);return hr.isResultOfOp(r,n,t)}else if(arguments.length===3){var i=arguments[0],l=arguments[1],h=arguments[2];switch(i===Bt.BOUNDARY&&(i=Bt.INTERIOR),l===Bt.BOUNDARY&&(l=Bt.INTERIOR),h){case hr.INTERSECTION:return i===Bt.INTERIOR&&l===Bt.INTERIOR;case hr.UNION:return i===Bt.INTERIOR||l===Bt.INTERIOR;case hr.DIFFERENCE:return i===Bt.INTERIOR&&l!==Bt.INTERIOR;case hr.SYMDIFFERENCE:return i===Bt.INTERIOR&&l!==Bt.INTERIOR||i!==Bt.INTERIOR&&l===Bt.INTERIOR}return!1}};hr.INTERSECTION=1;hr.UNION=2;hr.DIFFERENCE=3;hr.SYMDIFFERENCE=4;var zc=function(){this._g=null,this._boundaryDistanceTolerance=null,this._linework=null,this._ptLocator=new Xa,this._seg=new Ge;var e=arguments[0],t=arguments[1];this._g=e,this._boundaryDistanceTolerance=t,this._linework=this.extractLinework(e)};zc.prototype.isWithinToleranceOfBoundary=function(e){for(var t=this,r=0;r<this._linework.getNumGeometries();r++)for(var n=t._linework.getGeometryN(r),i=n.getCoordinateSequence(),l=0;l<i.size()-1;l++){i.getCoordinate(l,t._seg.p0),i.getCoordinate(l+1,t._seg.p1);var h=t._seg.distance(e);if(h<=t._boundaryDistanceTolerance)return!0}return!1};zc.prototype.getLocation=function(e){return this.isWithinToleranceOfBoundary(e)?Bt.BOUNDARY:this._ptLocator.locate(e,this._g)};zc.prototype.extractLinework=function(e){var t=new cf;e.apply(t);var r=t.getLinework(),n=Er.toLineStringArray(r);return e.getFactory().createMultiLineString(n)};zc.prototype.interfaces_=function(){return[]};zc.prototype.getClass=function(){return zc};var cf=function(){this._linework=null,this._linework=new me};cf.prototype.getLinework=function(){return this._linework};cf.prototype.filter=function(e){var t=this;if(e instanceof Li){var r=e;this._linework.add(r.getExteriorRing());for(var n=0;n<r.getNumInteriorRing();n++)t._linework.add(r.getInteriorRingN(n))}};cf.prototype.interfaces_=function(){return[Al]};cf.prototype.getClass=function(){return cf};var np=function(){this._g=null,this._doLeft=!0,this._doRight=!0;var e=arguments[0];this._g=e};np.prototype.extractPoints=function(e,t,r){for(var n=this,i=e.getCoordinates(),l=0;l<i.length-1;l++)n.computeOffsetPoints(i[l],i[l+1],t,r)};np.prototype.setSidesToGenerate=function(e,t){this._doLeft=e,this._doRight=t};np.prototype.getPoints=function(e){for(var t=this,r=new me,n=no.getLines(this._g),i=n.iterator();i.hasNext();){var l=i.next();t.extractPoints(l,e,r)}return r};np.prototype.computeOffsetPoints=function(e,t,r,n){var i=t.x-e.x,l=t.y-e.y,h=Math.sqrt(i*i+l*l),a=r*i/h,g=r*l/h,_=(t.x+e.x)/2,E=(t.y+e.y)/2;if(this._doLeft){var S=new kt(_-g,E+a);n.add(S)}if(this._doRight){var A=new kt(_+g,E-a);n.add(A)}};np.prototype.interfaces_=function(){return[]};np.prototype.getClass=function(){return np};var ra=function e(){this._geom=null,this._locFinder=null,this._location=new Array(3).fill(null),this._invalidLocation=null,this._boundaryDistanceTolerance=e.TOLERANCE,this._testCoords=new me;var t=arguments[0],r=arguments[1],n=arguments[2];this._boundaryDistanceTolerance=e.computeBoundaryDistanceTolerance(t,r),this._geom=[t,r,n],this._locFinder=[new zc(this._geom[0],this._boundaryDistanceTolerance),new zc(this._geom[1],this._boundaryDistanceTolerance),new zc(this._geom[2],this._boundaryDistanceTolerance)]},cC={TOLERANCE:{configurable:!0}};ra.prototype.reportResult=function(e,t,r){so.out.println("Overlay result invalid - A:"+Bt.toLocationSymbol(t[0])+" B:"+Bt.toLocationSymbol(t[1])+" expected:"+(r?"i":"e")+" actual:"+Bt.toLocationSymbol(t[2]))};ra.prototype.isValid=function(e){this.addTestPts(this._geom[0]),this.addTestPts(this._geom[1]);var t=this.checkValid(e);return t};ra.prototype.checkValid=function(){var e=this;if(arguments.length===1){for(var t=arguments[0],r=0;r<this._testCoords.size();r++){var n=e._testCoords.get(r);if(!e.checkValid(t,n))return e._invalidLocation=n,!1}return!0}else if(arguments.length===2){var i=arguments[0],l=arguments[1];return this._location[0]=this._locFinder[0].getLocation(l),this._location[1]=this._locFinder[1].getLocation(l),this._location[2]=this._locFinder[2].getLocation(l),ra.hasLocation(this._location,Bt.BOUNDARY)?!0:this.isValidResult(i,this._location)}};ra.prototype.addTestPts=function(e){var t=new np(e);this._testCoords.addAll(t.getPoints(5*this._boundaryDistanceTolerance))};ra.prototype.isValidResult=function(e,t){var r=hr.isResultOfOp(t[0],t[1],e),n=t[2]===Bt.INTERIOR,i=!(r^n);return i||this.reportResult(e,t,r),i};ra.prototype.getInvalidLocation=function(){return this._invalidLocation};ra.prototype.interfaces_=function(){return[]};ra.prototype.getClass=function(){return ra};ra.hasLocation=function(e,t){for(var r=0;r<3;r++)if(e[r]===t)return!0;return!1};ra.computeBoundaryDistanceTolerance=function(e,t){return Math.min(ri.computeSizeBasedSnapTolerance(e),ri.computeSizeBasedSnapTolerance(t))};ra.isValid=function(e,t,r,n){var i=new ra(e,t,n);return i.isValid(r)};cC.TOLERANCE.get=function(){return 1e-6};Object.defineProperties(ra,cC);var Xs=function e(t){this._geomFactory=null,this._skipEmpty=!1,this._inputGeoms=null,this._geomFactory=e.extractFactory(t),this._inputGeoms=t};Xs.prototype.extractElements=function(e,t){var r=this;if(e===null)return null;for(var n=0;n<e.getNumGeometries();n++){var i=e.getGeometryN(n);r._skipEmpty&&i.isEmpty()||t.add(i)}};Xs.prototype.combine=function(){for(var e=this,t=new me,r=this._inputGeoms.iterator();r.hasNext();){var n=r.next();e.extractElements(n,t)}return t.size()===0?this._geomFactory!==null?this._geomFactory.createGeometryCollection(null):null:this._geomFactory.buildGeometry(t)};Xs.prototype.interfaces_=function(){return[]};Xs.prototype.getClass=function(){return Xs};Xs.combine=function(){if(arguments.length===1){var e=arguments[0],t=new Xs(e);return t.combine()}else if(arguments.length===2){var r=arguments[0],n=arguments[1],i=new Xs(Xs.createList(r,n));return i.combine()}else if(arguments.length===3){var l=arguments[0],h=arguments[1],a=arguments[2],g=new Xs(Xs.createList(l,h,a));return g.combine()}};Xs.extractFactory=function(e){return e.isEmpty()?null:e.iterator().next().getFactory()};Xs.createList=function(){if(arguments.length===2){var e=arguments[0],t=arguments[1],r=new me;return r.add(e),r.add(t),r}else if(arguments.length===3){var n=arguments[0],i=arguments[1],l=arguments[2],h=new me;return h.add(n),h.add(i),h.add(l),h}};var mi=function(){this._inputPolys=null,this._geomFactory=null;var e=arguments[0];this._inputPolys=e,this._inputPolys===null&&(this._inputPolys=new me)},hC={STRTREE_NODE_CAPACITY:{configurable:!0}};mi.prototype.reduceToGeometries=function(e){for(var t=this,r=new me,n=e.iterator();n.hasNext();){var i=n.next(),l=null;rr(i,Ua)?l=t.unionTree(i):i instanceof tr&&(l=i),r.add(l)}return r};mi.prototype.extractByEnvelope=function(e,t,r){for(var n=new me,i=0;i<t.getNumGeometries();i++){var l=t.getGeometryN(i);l.getEnvelopeInternal().intersects(e)?n.add(l):r.add(l)}return this._geomFactory.buildGeometry(n)};mi.prototype.unionOptimized=function(e,t){var r=e.getEnvelopeInternal(),n=t.getEnvelopeInternal();if(!r.intersects(n)){var i=Xs.combine(e,t);return i}if(e.getNumGeometries()<=1&&t.getNumGeometries()<=1)return this.unionActual(e,t);var l=r.intersection(n);return this.unionUsingEnvelopeIntersection(e,t,l)};mi.prototype.union=function(){if(this._inputPolys===null)throw new Error("union() method cannot be called twice");if(this._inputPolys.isEmpty())return null;this._geomFactory=this._inputPolys.iterator().next().getFactory();for(var e=new YI(mi.STRTREE_NODE_CAPACITY),t=this._inputPolys.iterator();t.hasNext();){var r=t.next();e.insert(r.getEnvelopeInternal(),r)}this._inputPolys=null;var n=e.itemsTree(),i=this.unionTree(n);return i};mi.prototype.binaryUnion=function(){if(arguments.length===1){var e=arguments[0];return this.binaryUnion(e,0,e.size())}else if(arguments.length===3){var t=arguments[0],r=arguments[1],n=arguments[2];if(n-r<=1){var i=mi.getGeometry(t,r);return this.unionSafe(i,null)}else{if(n-r===2)return this.unionSafe(mi.getGeometry(t,r),mi.getGeometry(t,r+1));var l=Math.trunc((n+r)/2),h=this.binaryUnion(t,r,l),a=this.binaryUnion(t,l,n);return this.unionSafe(h,a)}}};mi.prototype.repeatedUnion=function(e){for(var t=null,r=e.iterator();r.hasNext();){var n=r.next();t===null?t=n.copy():t=t.union(n)}return t};mi.prototype.unionSafe=function(e,t){return e===null&&t===null?null:e===null?t.copy():t===null?e.copy():this.unionOptimized(e,t)};mi.prototype.unionActual=function(e,t){return mi.restrictToPolygons(e.union(t))};mi.prototype.unionTree=function(e){var t=this.reduceToGeometries(e),r=this.binaryUnion(t);return r};mi.prototype.unionUsingEnvelopeIntersection=function(e,t,r){var n=new me,i=this.extractByEnvelope(r,e,n),l=this.extractByEnvelope(r,t,n),h=this.unionActual(i,l);n.add(h);var a=Xs.combine(n);return a};mi.prototype.bufferUnion=function(){if(arguments.length===1){var e=arguments[0],t=e.get(0).getFactory(),r=t.buildGeometry(e),n=r.buffer(0);return n}else if(arguments.length===2){var i=arguments[0],l=arguments[1],h=i.getFactory(),a=h.createGeometryCollection([i,l]),g=a.buffer(0);return g}};mi.prototype.interfaces_=function(){return[]};mi.prototype.getClass=function(){return mi};mi.restrictToPolygons=function(e){if(rr(e,Vc))return e;var t=Uu.getPolygons(e);return t.size()===1?t.get(0):e.getFactory().createMultiPolygon(Er.toPolygonArray(t))};mi.getGeometry=function(e,t){return t>=e.size()?null:e.get(t)};mi.union=function(e){var t=new mi(e);return t.union()};hC.STRTREE_NODE_CAPACITY.get=function(){return 4};Object.defineProperties(mi,hC);var E_=function(){};E_.prototype.interfaces_=function(){return[]};E_.prototype.getClass=function(){return E_};E_.union=function(e,t){if(e.isEmpty()||t.isEmpty()){if(e.isEmpty()&&t.isEmpty())return hr.createEmptyResult(hr.UNION,e,t,e.getFactory());if(e.isEmpty())return t.copy();if(t.isEmpty())return e.copy()}return e.checkNotGeometryCollection(e),e.checkNotGeometryCollection(t),Xo.overlayOp(e,t,hr.UNION)};function up(){return new S_}function S_(){this.reset()}S_.prototype={constructor:S_,reset:function(){this.s=this.t=0},add:function(e){i2(Cy,e,this.t),i2(this,Cy.s,this.s),this.s?this.t+=Cy.t:this.s=Cy.t},valueOf:function(){return this.s}};var Cy=new S_;function i2(e,t,r){var n=e.s=t+r,i=n-t,l=n-i;e.t=t-l+(r-i)}up();up();up();function pC(e,t){function r(n,i){return n=e(n,i),t(n[0],n[1])}return e.invert&&t.invert&&(r.invert=function(n,i){return n=t.invert(n,i),n&&e.invert(n[0],n[1])}),r}var Xn=1e-6,gn=Math.PI,Bu=gn/2,o2=gn/4,Xu=gn*2,Nh=180/gn,xl=gn/180,jo=Math.abs,a5=Math.atan,hf=Math.atan2,Ci=Math.cos,Mi=Math.sin,wf=Math.sqrt;function dC(e){return e>1?0:e<-1?gn:Math.acos(e)}function qp(e){return e>1?Bu:e<-1?-Bu:Math.asin(e)}function hx(e,t){return[e>gn?e-Xu:e<-gn?e+Xu:e,t]}hx.invert=hx;function l5(e,t,r){return(e%=Xu)?t||r?pC(a2(e),l2(t,r)):a2(e):t||r?l2(t,r):hx}function s2(e){return function(t,r){return t+=e,[t>gn?t-Xu:t<-gn?t+Xu:t,r]}}function a2(e){var t=s2(e);return t.invert=s2(-e),t}function l2(e,t){var r=Ci(e),n=Mi(e),i=Ci(t),l=Mi(t);function h(a,g){var _=Ci(g),E=Ci(a)*_,S=Mi(a)*_,A=Mi(g),O=A*r+E*n;return[hf(S*i-O*l,E*r-A*n),qp(O*i+S*l)]}return h.invert=function(a,g){var _=Ci(g),E=Ci(a)*_,S=Mi(a)*_,A=Mi(g),O=A*i-S*l;return[hf(S*i+A*l,E*r+O*n),qp(O*r-E*n)]},h}function fC(e,t){return e<t?-1:e>t?1:e>=t?0:NaN}function u5(e){return e.length===1&&(e=c5(e)),{left:function(t,r,n,i){for(n==null&&(n=0),i==null&&(i=t.length);n<i;){var l=n+i>>>1;e(t[l],r)<0?n=l+1:i=l}return n},right:function(t,r,n,i){for(n==null&&(n=0),i==null&&(i=t.length);n<i;){var l=n+i>>>1;e(t[l],r)>0?i=l:n=l+1}return n}}}function c5(e){return function(t,r){return fC(e(t),r)}}u5(fC);function px(e){return[hf(e[1],e[0]),qp(e[2])]}function pf(e){var t=e[0],r=e[1],n=Ci(r);return[n*Ci(t),n*Mi(t),Mi(r)]}function My(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]}function T_(e,t){return[e[1]*t[2]-e[2]*t[1],e[2]*t[0]-e[0]*t[2],e[0]*t[1]-e[1]*t[0]]}function wv(e,t){e[0]+=t[0],e[1]+=t[1],e[2]+=t[2]}function Py(e,t){return[e[0]*t,e[1]*t,e[2]*t]}function dx(e){var t=wf(e[0]*e[0]+e[1]*e[1]+e[2]*e[2]);e[0]/=t,e[1]/=t,e[2]/=t}var Ev=up();function h5(e,t){var r=t[0],n=t[1],i=[Mi(r),-Ci(r),0],l=0,h=0;Ev.reset();for(var a=0,g=e.length;a<g;++a)if(E=(_=e[a]).length)for(var _,E,S=_[E-1],A=S[0],O=S[1]/2+o2,k=Mi(O),G=Ci(O),W=0;W<E;++W,A=tt,k=V,G=it,S=U){var U=_[W],tt=U[0],$=U[1]/2+o2,V=Mi($),it=Ci($),vt=tt-A,ot=vt>=0?1:-1,et=ot*vt,wt=et>gn,J=k*V;if(Ev.add(hf(J*ot*Mi(et),G*it+J*Ci(et))),l+=wt?vt+ot*Xu:vt,wt^A>=r^tt>=r){var xt=T_(pf(S),pf(U));dx(xt);var $t=T_(i,xt);dx($t);var Ut=(wt^vt>=0?-1:1)*qp($t[2]);(n>Ut||n===Ut&&(xt[0]||xt[1]))&&(h+=wt^vt>=0?1:-1)}}return(l<-Xn||l<Xn&&Ev<-Xn)^h&1}up();up();up();up();function mC(e){return function(t){var r=new fx;for(var n in e)r[n]=e[n];return r.stream=t,r}}function fx(){}fx.prototype={constructor:fx,point:function(e,t){this.stream.point(e,t)},sphere:function(){this.stream.sphere()},lineStart:function(){this.stream.lineStart()},lineEnd:function(){this.stream.lineEnd()},polygonStart:function(){this.stream.polygonStart()},polygonEnd:function(){this.stream.polygonEnd()}};function gC(e){return function(t,r){var n=Ci(t),i=Ci(r),l=e(n*i);return[l*i*Mi(t),l*Mi(r)]}}function yC(e){return function(t,r){var n=wf(t*t+r*r),i=e(n),l=Mi(i),h=Ci(i);return[hf(t*l,n*h),qp(n&&r*l/n)]}}var p5=gC(function(e){return wf(2/(1+e))});p5.invert=yC(function(e){return 2*qp(e/2)});function bm(){}function _C(){var e=[],t;return{point:function(r,n){t.push([r,n])},lineStart:function(){e.push(t=[])},lineEnd:bm,rejoin:function(){e.length>1&&e.push(e.pop().concat(e.shift()))},result:function(){var r=e;return e=[],t=null,r}}}function Gy(e,t){return jo(e[0]-t[0])<Xn&&jo(e[1]-t[1])<Xn}function Ay(e,t,r,n){this.x=e,this.z=t,this.o=r,this.e=n,this.v=!1,this.n=this.p=null}function vC(e,t,r,n,i){var l=[],h=[],a,g;if(e.forEach(function(k){if(!((G=k.length-1)<=0)){var G,W=k[0],U=k[G],tt;if(Gy(W,U)){for(i.lineStart(),a=0;a<G;++a)i.point((W=k[a])[0],W[1]);i.lineEnd();return}l.push(tt=new Ay(W,k,null,!0)),h.push(tt.o=new Ay(W,null,tt,!1)),l.push(tt=new Ay(U,k,null,!1)),h.push(tt.o=new Ay(U,null,tt,!0))}}),!!l.length){for(h.sort(t),u2(l),u2(h),a=0,g=h.length;a<g;++a)h[a].e=r=!r;for(var _=l[0],E,S;;){for(var A=_,O=!0;A.v;)if((A=A.n)===_)return;E=A.z,i.lineStart();do{if(A.v=A.o.v=!0,A.e){if(O)for(a=0,g=E.length;a<g;++a)i.point((S=E[a])[0],S[1]);else n(A.x,A.n.x,1,i);A=A.n}else{if(O)for(E=A.p.z,a=E.length-1;a>=0;--a)i.point((S=E[a])[0],S[1]);else n(A.x,A.p.x,-1,i);A=A.p}A=A.o,E=A.z,O=!O}while(!A.v);i.lineEnd()}}}function u2(e){if(t=e.length){for(var t,r=0,n=e[0],i;++r<t;)n.n=i=e[r],i.p=n,n=i;n.n=i=e[0],i.p=n}}function xC(e){for(var t=e.length,r,n=-1,i=0,l,h;++n<t;)i+=e[n].length;for(l=new Array(i);--t>=0;)for(h=e[t],r=h.length;--r>=0;)l[--i]=h[r];return l}function bC(e,t,r,n){return function(i,l){var h=t(l),a=i.invert(n[0],n[1]),g=_C(),_=t(g),E=!1,S,A,O,k={point:G,lineStart:U,lineEnd:tt,polygonStart:function(){k.point=$,k.lineStart=V,k.lineEnd=it,A=[],S=[]},polygonEnd:function(){k.point=G,k.lineStart=U,k.lineEnd=tt,A=xC(A);var vt=h5(S,a);A.length?(E||(l.polygonStart(),E=!0),vC(A,f5,vt,r,l)):vt&&(E||(l.polygonStart(),E=!0),l.lineStart(),r(null,null,1,l),l.lineEnd()),E&&(l.polygonEnd(),E=!1),A=S=null},sphere:function(){l.polygonStart(),l.lineStart(),r(null,null,1,l),l.lineEnd(),l.polygonEnd()}};function G(vt,ot){var et=i(vt,ot);e(vt=et[0],ot=et[1])&&l.point(vt,ot)}function W(vt,ot){var et=i(vt,ot);h.point(et[0],et[1])}function U(){k.point=W,h.lineStart()}function tt(){k.point=G,h.lineEnd()}function $(vt,ot){O.push([vt,ot]);var et=i(vt,ot);_.point(et[0],et[1])}function V(){_.lineStart(),O=[]}function it(){$(O[0][0],O[0][1]),_.lineEnd();var vt=_.clean(),ot=g.result(),et,wt=ot.length,J,xt,$t;if(O.pop(),S.push(O),O=null,!!wt){if(vt&1){if(xt=ot[0],(J=xt.length-1)>0){for(E||(l.polygonStart(),E=!0),l.lineStart(),et=0;et<J;++et)l.point(($t=xt[et])[0],$t[1]);l.lineEnd()}return}wt>1&&vt&2&&ot.push(ot.pop().concat(ot.shift())),A.push(ot.filter(d5))}}return k}}function d5(e){return e.length>1}function f5(e,t){return((e=e.x)[0]<0?e[1]-Bu-Xn:Bu-e[1])-((t=t.x)[0]<0?t[1]-Bu-Xn:Bu-t[1])}const c2=bC(function(){return!0},m5,y5,[-gn,-Bu]);function m5(e){var t=NaN,r=NaN,n=NaN,i;return{lineStart:function(){e.lineStart(),i=1},point:function(l,h){var a=l>0?gn:-gn,g=jo(l-t);jo(g-gn)<Xn?(e.point(t,r=(r+h)/2>0?Bu:-Bu),e.point(n,r),e.lineEnd(),e.lineStart(),e.point(a,r),e.point(l,r),i=0):n!==a&&g>=gn&&(jo(t-n)<Xn&&(t-=n*Xn),jo(l-a)<Xn&&(l-=a*Xn),r=g5(t,r,l,h),e.point(n,r),e.lineEnd(),e.lineStart(),e.point(a,r),i=0),e.point(t=l,r=h),n=a},lineEnd:function(){e.lineEnd(),t=r=NaN},clean:function(){return 2-i}}}function g5(e,t,r,n){var i,l,h=Mi(e-r);return jo(h)>Xn?a5((Mi(t)*(l=Ci(n))*Mi(r)-Mi(n)*(i=Ci(t))*Mi(e))/(i*l*h)):(t+n)/2}function y5(e,t,r,n){var i;if(e==null)i=r*Bu,n.point(-gn,i),n.point(0,i),n.point(gn,i),n.point(gn,0),n.point(gn,-i),n.point(0,-i),n.point(-gn,-i),n.point(-gn,0),n.point(-gn,i);else if(jo(e[0]-t[0])>Xn){var l=e[0]<t[0]?gn:-gn;i=r*l/2,n.point(-l,i),n.point(0,i),n.point(l,i)}else n.point(t[0],t[1])}function _5(e,t,r,n,i,l){if(r){var h=Ci(t),a=Mi(t),g=n*r;i==null?(i=t+n*Xu,l=t-g/2):(i=h2(h,i),l=h2(h,l),(n>0?i<l:i>l)&&(i+=n*Xu));for(var _,E=i;n>0?E>l:E<l;E-=g)_=px([h,-a*Ci(E),-a*Mi(E)]),e.point(_[0],_[1])}}function h2(e,t){t=pf(t),t[0]-=e,dx(t);var r=dC(-t[1]);return((-t[2]<0?-r:r)+Xu-Xn)%Xu}function v5(e,t){var r=Ci(e),n=r>0,i=jo(r)>Xn;function l(E,S,A,O){_5(O,e,t,A,E,S)}function h(E,S){return Ci(E)*Ci(S)>r}function a(E){var S,A,O,k,G;return{lineStart:function(){k=O=!1,G=1},point:function(W,U){var tt=[W,U],$,V=h(W,U),it=n?V?0:_(W,U):V?_(W+(W<0?gn:-gn),U):0;if(!S&&(k=O=V)&&E.lineStart(),V!==O&&($=g(S,tt),(!$||Gy(S,$)||Gy(tt,$))&&(tt[0]+=Xn,tt[1]+=Xn,V=h(tt[0],tt[1]))),V!==O)G=0,V?(E.lineStart(),$=g(tt,S),E.point($[0],$[1])):($=g(S,tt),E.point($[0],$[1]),E.lineEnd()),S=$;else if(i&&S&&n^V){var vt;!(it&A)&&(vt=g(tt,S,!0))&&(G=0,n?(E.lineStart(),E.point(vt[0][0],vt[0][1]),E.point(vt[1][0],vt[1][1]),E.lineEnd()):(E.point(vt[1][0],vt[1][1]),E.lineEnd(),E.lineStart(),E.point(vt[0][0],vt[0][1])))}V&&(!S||!Gy(S,tt))&&E.point(tt[0],tt[1]),S=tt,O=V,A=it},lineEnd:function(){O&&E.lineEnd(),S=null},clean:function(){return G|(k&&O)<<1}}}function g(E,S,A){var O=pf(E),k=pf(S),G=[1,0,0],W=T_(O,k),U=My(W,W),tt=W[0],$=U-tt*tt;if(!$)return!A&&E;var V=r*U/$,it=-r*tt/$,vt=T_(G,W),ot=Py(G,V),et=Py(W,it);wv(ot,et);var wt=vt,J=My(ot,wt),xt=My(wt,wt),$t=J*J-xt*(My(ot,ot)-1);if(!($t<0)){var Ut=wf($t),Ot=Py(wt,(-J-Ut)/xt);if(wv(Ot,ot),Ot=px(Ot),!A)return Ot;var te=E[0],ye=S[0],Me=E[1],ir=S[1],xr;ye<te&&(xr=te,te=ye,ye=xr);var _r=ye-te,kr=jo(_r-gn)<Xn,vr=kr||_r<Xn;if(!kr&&ir<Me&&(xr=Me,Me=ir,ir=xr),vr?kr?Me+ir>0^Ot[1]<(jo(Ot[0]-te)<Xn?Me:ir):Me<=Ot[1]&&Ot[1]<=ir:_r>gn^(te<=Ot[0]&&Ot[0]<=ye)){var ue=Py(wt,(-J+Ut)/xt);return wv(ue,ot),[Ot,px(ue)]}}}function _(E,S){var A=n?e:gn-e,O=0;return E<-A?O|=1:E>A&&(O|=2),S<-A?O|=4:S>A&&(O|=8),O}return bC(h,a,l,n?[0,-e]:[-gn,e-gn])}function x5(e,t,r,n,i,l){var h=e[0],a=e[1],g=t[0],_=t[1],E=0,S=1,A=g-h,O=_-a,k;if(k=r-h,!(!A&&k>0)){if(k/=A,A<0){if(k<E)return;k<S&&(S=k)}else if(A>0){if(k>S)return;k>E&&(E=k)}if(k=i-h,!(!A&&k<0)){if(k/=A,A<0){if(k>S)return;k>E&&(E=k)}else if(A>0){if(k<E)return;k<S&&(S=k)}if(k=n-a,!(!O&&k>0)){if(k/=O,O<0){if(k<E)return;k<S&&(S=k)}else if(O>0){if(k>S)return;k>E&&(E=k)}if(k=l-a,!(!O&&k<0)){if(k/=O,O<0){if(k>S)return;k>E&&(E=k)}else if(O>0){if(k<E)return;k<S&&(S=k)}return E>0&&(e[0]=h+E*A,e[1]=a+E*O),S<1&&(t[0]=h+S*A,t[1]=a+S*O),!0}}}}}var wm=1e9,Ly=-wm;function b5(e,t,r,n){function i(_,E){return e<=_&&_<=r&&t<=E&&E<=n}function l(_,E,S,A){var O=0,k=0;if(_==null||(O=h(_,S))!==(k=h(E,S))||g(_,E)<0^S>0)do A.point(O===0||O===3?e:r,O>1?n:t);while((O=(O+S+4)%4)!==k);else A.point(E[0],E[1])}function h(_,E){return jo(_[0]-e)<Xn?E>0?0:3:jo(_[0]-r)<Xn?E>0?2:1:jo(_[1]-t)<Xn?E>0?1:0:E>0?3:2}function a(_,E){return g(_.x,E.x)}function g(_,E){var S=h(_,1),A=h(E,1);return S!==A?S-A:S===0?E[1]-_[1]:S===1?_[0]-E[0]:S===2?_[1]-E[1]:E[0]-_[0]}return function(_){var E=_,S=_C(),A,O,k,G,W,U,tt,$,V,it,vt,ot={point:et,lineStart:$t,lineEnd:Ut,polygonStart:J,polygonEnd:xt};function et(te,ye){i(te,ye)&&E.point(te,ye)}function wt(){for(var te=0,ye=0,Me=O.length;ye<Me;++ye)for(var ir=O[ye],xr=1,_r=ir.length,kr=ir[0],vr,ue,nr=kr[0],br=kr[1];xr<_r;++xr)vr=nr,ue=br,kr=ir[xr],nr=kr[0],br=kr[1],ue<=n?br>n&&(nr-vr)*(n-ue)>(br-ue)*(e-vr)&&++te:br<=n&&(nr-vr)*(n-ue)<(br-ue)*(e-vr)&&--te;return te}function J(){E=S,A=[],O=[],vt=!0}function xt(){var te=wt(),ye=vt&&te,Me=(A=xC(A)).length;(ye||Me)&&(_.polygonStart(),ye&&(_.lineStart(),l(null,null,1,_),_.lineEnd()),Me&&vC(A,a,te,l,_),_.polygonEnd()),E=_,A=O=k=null}function $t(){ot.point=Ot,O&&O.push(k=[]),it=!0,V=!1,tt=$=NaN}function Ut(){A&&(Ot(G,W),U&&V&&S.rejoin(),A.push(S.result())),ot.point=et,V&&E.lineEnd()}function Ot(te,ye){var Me=i(te,ye);if(O&&k.push([te,ye]),it)G=te,W=ye,U=Me,it=!1,Me&&(E.lineStart(),E.point(te,ye));else if(Me&&V)E.point(te,ye);else{var ir=[tt=Math.max(Ly,Math.min(wm,tt)),$=Math.max(Ly,Math.min(wm,$))],xr=[te=Math.max(Ly,Math.min(wm,te)),ye=Math.max(Ly,Math.min(wm,ye))];x5(ir,xr,e,t,r,n)?(V||(E.lineStart(),E.point(ir[0],ir[1])),E.point(xr[0],xr[1]),Me||E.lineEnd(),vt=!1):Me&&(E.lineStart(),E.point(te,ye),vt=!1)}tt=te,$=ye,V=Me}return ot}}function p2(e){return e}function I_(e,t){e&&f2.hasOwnProperty(e.type)&&f2[e.type](e,t)}var d2={Feature:function(e,t){I_(e.geometry,t)},FeatureCollection:function(e,t){for(var r=e.features,n=-1,i=r.length;++n<i;)I_(r[n].geometry,t)}},f2={Sphere:function(e,t){t.sphere()},Point:function(e,t){e=e.coordinates,t.point(e[0],e[1],e[2])},MultiPoint:function(e,t){for(var r=e.coordinates,n=-1,i=r.length;++n<i;)e=r[n],t.point(e[0],e[1],e[2])},LineString:function(e,t){mx(e.coordinates,t,0)},MultiLineString:function(e,t){for(var r=e.coordinates,n=-1,i=r.length;++n<i;)mx(r[n],t,0)},Polygon:function(e,t){m2(e.coordinates,t)},MultiPolygon:function(e,t){for(var r=e.coordinates,n=-1,i=r.length;++n<i;)m2(r[n],t)},GeometryCollection:function(e,t){for(var r=e.geometries,n=-1,i=r.length;++n<i;)I_(r[n],t)}};function mx(e,t,r){var n=-1,i=e.length-r,l;for(t.lineStart();++n<i;)l=e[n],t.point(l[0],l[1],l[2]);t.lineEnd()}function m2(e,t){var r=-1,n=e.length;for(t.polygonStart();++r<n;)mx(e[r],t,1);t.polygonEnd()}function w5(e,t){e&&d2.hasOwnProperty(e.type)?d2[e.type](e,t):I_(e,t)}var df=1/0,C_=df,pg=-df,M_=pg,g2={point:E5,lineStart:bm,lineEnd:bm,polygonStart:bm,polygonEnd:bm,result:function(){var e=[[df,C_],[pg,M_]];return pg=M_=-(C_=df=1/0),e}};function E5(e,t){e<df&&(df=e),e>pg&&(pg=e),t<C_&&(C_=t),t>M_&&(M_=t)}function wC(e,t,r){var n=t[1][0]-t[0][0],i=t[1][1]-t[0][1],l=e.clipExtent&&e.clipExtent();e.scale(150).translate([0,0]),l!=null&&e.clipExtent(null),w5(r,e.stream(g2));var h=g2.result(),a=Math.min(n/(h[1][0]-h[0][0]),i/(h[1][1]-h[0][1])),g=+t[0][0]+(n-a*(h[1][0]+h[0][0]))/2,_=+t[0][1]+(i-a*(h[1][1]+h[0][1]))/2;return l!=null&&e.clipExtent(l),e.scale(a*150).translate([g,_])}function S5(e,t,r){return wC(e,[[0,0],t],r)}var y2=16,T5=Ci(30*xl);function _2(e,t){return+t?C5(e,t):I5(e)}function I5(e){return mC({point:function(t,r){t=e(t,r),this.stream.point(t[0],t[1])}})}function C5(e,t){function r(n,i,l,h,a,g,_,E,S,A,O,k,G,W){var U=_-n,tt=E-i,$=U*U+tt*tt;if($>4*t&&G--){var V=h+A,it=a+O,vt=g+k,ot=wf(V*V+it*it+vt*vt),et=qp(vt/=ot),wt=jo(jo(vt)-1)<Xn||jo(l-S)<Xn?(l+S)/2:hf(it,V),J=e(wt,et),xt=J[0],$t=J[1],Ut=xt-n,Ot=$t-i,te=tt*Ut-U*Ot;(te*te/$>t||jo((U*Ut+tt*Ot)/$-.5)>.3||h*A+a*O+g*k<T5)&&(r(n,i,l,h,a,g,xt,$t,wt,V/=ot,it/=ot,vt,G,W),W.point(xt,$t),r(xt,$t,wt,V,it,vt,_,E,S,A,O,k,G,W))}}return function(n){var i,l,h,a,g,_,E,S,A,O,k,G,W={point:U,lineStart:tt,lineEnd:V,polygonStart:function(){n.polygonStart(),W.lineStart=it},polygonEnd:function(){n.polygonEnd(),W.lineStart=tt}};function U(et,wt){et=e(et,wt),n.point(et[0],et[1])}function tt(){S=NaN,W.point=$,n.lineStart()}function $(et,wt){var J=pf([et,wt]),xt=e(et,wt);r(S,A,E,O,k,G,S=xt[0],A=xt[1],E=et,O=J[0],k=J[1],G=J[2],y2,n),n.point(S,A)}function V(){W.point=U,n.lineEnd()}function it(){tt(),W.point=vt,W.lineEnd=ot}function vt(et,wt){$(i=et,wt),l=S,h=A,a=O,g=k,_=G,W.point=$}function ot(){r(S,A,E,O,k,G,l,h,i,a,g,_,y2,n),W.lineEnd=V,V()}return W}}var M5=mC({point:function(e,t){this.stream.point(e*xl,t*xl)}});function P5(e){return A5(function(){return e})()}function A5(e){var t,r=150,n=480,i=250,l,h,a=0,g=0,_=0,E=0,S=0,A,O,k=null,G=c2,W=null,U,tt,$,V=p2,it=.5,vt=_2(xt,it),ot,et;function wt(Ot){return Ot=O(Ot[0]*xl,Ot[1]*xl),[Ot[0]*r+l,h-Ot[1]*r]}function J(Ot){return Ot=O.invert((Ot[0]-l)/r,(h-Ot[1])/r),Ot&&[Ot[0]*Nh,Ot[1]*Nh]}function xt(Ot,te){return Ot=t(Ot,te),[Ot[0]*r+l,h-Ot[1]*r]}wt.stream=function(Ot){return ot&&et===Ot?ot:ot=M5(G(A,vt(V(et=Ot))))},wt.clipAngle=function(Ot){return arguments.length?(G=+Ot?v5(k=Ot*xl,6*xl):(k=null,c2),Ut()):k*Nh},wt.clipExtent=function(Ot){return arguments.length?(V=Ot==null?(W=U=tt=$=null,p2):b5(W=+Ot[0][0],U=+Ot[0][1],tt=+Ot[1][0],$=+Ot[1][1]),Ut()):W==null?null:[[W,U],[tt,$]]},wt.scale=function(Ot){return arguments.length?(r=+Ot,$t()):r},wt.translate=function(Ot){return arguments.length?(n=+Ot[0],i=+Ot[1],$t()):[n,i]},wt.center=function(Ot){return arguments.length?(a=Ot[0]%360*xl,g=Ot[1]%360*xl,$t()):[a*Nh,g*Nh]},wt.rotate=function(Ot){return arguments.length?(_=Ot[0]%360*xl,E=Ot[1]%360*xl,S=Ot.length>2?Ot[2]%360*xl:0,$t()):[_*Nh,E*Nh,S*Nh]},wt.precision=function(Ot){return arguments.length?(vt=_2(xt,it=Ot*Ot),Ut()):wf(it)},wt.fitExtent=function(Ot,te){return wC(wt,Ot,te)},wt.fitSize=function(Ot,te){return S5(wt,Ot,te)};function $t(){O=pC(A=l5(_,E,S),t);var Ot=t(a,g);return l=n-Ot[0]*r,h=i+Ot[1]*r,Ut()}function Ut(){return ot=et=null,wt}return function(){return t=e.apply(this,arguments),wt.invert=t.invert&&J,$t()}}var EC=gC(function(e){return(e=dC(e))&&e/Mi(e)});EC.invert=yC(function(e){return e});function L5(){return P5(EC).scale(79.4188).clipAngle(180-.001)}function v2(e,t){return[e,t]}v2.invert=v2;function R5(e,t,r){r=r||{};var n=r.units||"kilometers",i=r.steps||8;if(!e)throw new Error("geojson is required");if(typeof r!="object")throw new Error("options must be an object");if(typeof i!="number")throw new Error("steps must be an number");if(t===void 0)throw new Error("radius is required");if(i<=0)throw new Error("steps must be greater than 0");var l=[];switch(e.type){case"GeometryCollection":return FI(e,function(h){var a=qy(h,t,n,i);a&&l.push(a)}),ux(l);case"FeatureCollection":return JE(e,function(h){var a=qy(h,t,n,i);a&&JE(a,function(g){g&&l.push(g)})}),ux(l)}return qy(e,t,n,i)}function qy(e,t,r,n){var i=e.properties||{},l=e.type==="Feature"?e.geometry:e;if(l.type==="GeometryCollection"){var h=[];return FI(e,function(G){var W=qy(G,t,r,n);W&&h.push(W)}),ux(h)}var a=D5(l),g={type:l.type,coordinates:TC(l.coordinates,a)},_=new v1,E=_.read(g),S=$4(U4(t,r),"meters"),A=io.bufferOp(E,S,n),O=new XI;if(A=O.write(A),!SC(A.coordinates)){var k={type:A.type,coordinates:IC(A.coordinates,a)};return h1(k,i)}}function SC(e){return Array.isArray(e[0])?SC(e[0]):isNaN(e[0])}function TC(e,t){return typeof e[0]!="object"?t(e):e.map(function(r){return TC(r,t)})}function IC(e,t){return typeof e[0]!="object"?t.invert(e):e.map(function(r){return IC(r,t)})}function D5(e){var t=V4(e).geometry.coordinates,r=[-t[0],-t[1]];return L5().rotate(r).scale(qs)}const N5=-90,k5=90,O5=-180,F5=180,z5=(e,t,r={})=>{const n=new F4(t);e.addLayer(n),r.url?n.addGeoreferenceAnnotationByUrl(r.url):r.manifest&&n.addGeoreferenceAnnotation(r.manifest),r.opacity&&n.setOpacity(r.opacity)},B5=(e,t=null)=>{const r=Jm(e);if(!CC(r))return null;const n=j4(r);let i;return t?i=R5(n,t,{units:"miles"}):i=n,Jm(i)},$5=(e,t)=>e&&e.removeLayer(t),CC=e=>Dm.every(e,Dm.isFinite),U5=e=>{let t=!1;if(e){const[r,n]=e;t=r>=N5&&r<=k5&&n>=O5&&n<=F5}return t},gx={addGeoreferenceLayer:z5,getBoundingBox:B5,removeLayer:$5,validateBoundingBox:CC,validateCoordinates:U5},j5=2,V5=e=>{const t=x2(),r=Qe.useMemo(()=>Dm.isEmpty(e.data)?null:e.data,[e.data]);return Qe.useEffect(()=>{if(t&&r&&e.fitBoundingBox){const n=gx.getBoundingBox(r,e.buffer);n&&t.fitBounds(n,e.boundingBoxOptions,e.boundingBoxData)}},[t,e.buffer,e.data,e.boundingBoxData,e.boundingBoxOptions,e.fitBoundingBox]),r?ny.jsxs(ny.Fragment,{children:[e.animate&&ny.jsx(EP,{data:e.data,id:e.layerId}),ny.jsx(SP,{cluster:e.cluster,clusterMaxZoom:e.clusterMaxZoom,clusterMinPoints:e.clusterMinPoints,clusterProperties:e.clusterProperties,clusterRadius:e.clusterRadius,data:e.data,fillStyle:e.fillStyle,id:e.layerId,interactive:e.interactive,strokeStyle:e.strokeStyle,pointStyle:e.pointStyle})]}):null};V5.defaultProps={buffer:j5,fillStyle:Od.fill,fitBoundingBox:!0,pointStyle:Od.point,strokeStyle:Od.stroke};const G5=w2(()=>Promise.resolve().then(()=>A2),void 0,import.meta.url).then(e=>e.o);Qe.forwardRef(function(e,t){return T2(e,t,G5)});P_.constants.classes.CONTROL_BASE="maplibregl-ctrl";P_.constants.classes.CONTROL_PREFIX="maplibregl-ctrl-";P_.constants.classes.CONTROL_GROUP="maplibregl-ctrl-group";const q5=e=>{const t=x2();return Qe.useEffect(()=>{if(t)return gx.addGeoreferenceLayer(t,e.id,{manifest:e.manifest,opacity:e.opacity,url:e.url}),()=>gx.removeLayer(t,e.id)},[t]),null};q5.defaultProps={opacity:.5};export{q5 as a,Od as o,V5 as x};
function __vite__mapDeps(indexes) {
  if (!__vite__mapDeps.viteFileDeps) {
    __vite__mapDeps.viteFileDeps = []
  }
  return indexes.map((i) => __vite__mapDeps.viteFileDeps[i])
}
