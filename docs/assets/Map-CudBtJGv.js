import{g as Td}from"./iframe-BPWyo1ml.js";function Mn(){return new ms}function ms(){this.reset()}ms.prototype={constructor:ms,reset:function(){this.s=this.t=0},add:function(n){ul(Fi,n,this.t),ul(this,Fi.s,this.s),this.s?this.t+=Fi.t:this.s=Fi.t},valueOf:function(){return this.s}};var Fi=new ms;function ul(n,t,e){var r=n.s=t+e,o=r-t,l=r-o;n.t=t-l+(e-o)}var Gt=1e-6,Rt=Math.PI,Ye=Rt/2,ll=Rt/4,Xe=Rt*2,mn=180/Rt,Ne=Rt/180,Jt=Math.abs,Md=Math.atan,hr=Math.atan2,jt=Math.cos,Vt=Math.sin,wr=Math.sqrt;function Ih(n){return n>1?0:n<-1?Rt:Math.acos(n)}function Fn(n){return n>1?Ye:n<-1?-Ye:Math.asin(n)}function Br(){}function vs(n,t){n&&cl.hasOwnProperty(n.type)&&cl[n.type](n,t)}var hl={Feature:function(n,t){vs(n.geometry,t)},FeatureCollection:function(n,t){for(var e=n.features,r=-1,o=e.length;++r<o;)vs(e[r].geometry,t)}},cl={Sphere:function(n,t){t.sphere()},Point:function(n,t){n=n.coordinates,t.point(n[0],n[1],n[2])},MultiPoint:function(n,t){for(var e=n.coordinates,r=-1,o=e.length;++r<o;)n=e[r],t.point(n[0],n[1],n[2])},LineString:function(n,t){Qo(n.coordinates,t,0)},MultiLineString:function(n,t){for(var e=n.coordinates,r=-1,o=e.length;++r<o;)Qo(e[r],t,0)},Polygon:function(n,t){fl(n.coordinates,t)},MultiPolygon:function(n,t){for(var e=n.coordinates,r=-1,o=e.length;++r<o;)fl(e[r],t)},GeometryCollection:function(n,t){for(var e=n.geometries,r=-1,o=e.length;++r<o;)vs(e[r],t)}};function Qo(n,t,e){var r=-1,o=n.length-e,l;for(t.lineStart();++r<o;)l=n[r],t.point(l[0],l[1],l[2]);t.lineEnd()}function fl(n,t){var e=-1,r=n.length;for(t.polygonStart();++e<r;)Qo(n[e],t,1);t.polygonEnd()}function bd(n,t){n&&hl.hasOwnProperty(n.type)?hl[n.type](n,t):vs(n,t)}Mn();Mn();function ta(n){return[hr(n[1],n[0]),Fn(n[2])]}function cr(n){var t=n[0],e=n[1],r=jt(e);return[r*jt(t),r*Vt(t),Vt(e)]}function Gi(n,t){return n[0]*t[0]+n[1]*t[1]+n[2]*t[2]}function ys(n,t){return[n[1]*t[2]-n[2]*t[1],n[2]*t[0]-n[0]*t[2],n[0]*t[1]-n[1]*t[0]]}function Lo(n,t){n[0]+=t[0],n[1]+=t[1],n[2]+=t[2]}function Bi(n,t){return[n[0]*t,n[1]*t,n[2]*t]}function ea(n){var t=wr(n[0]*n[0]+n[1]*n[1]+n[2]*n[2]);n[0]/=t,n[1]/=t,n[2]/=t}Mn();function Th(n,t){function e(r,o){return r=n(r,o),t(r[0],r[1])}return n.invert&&t.invert&&(e.invert=function(r,o){return r=t.invert(r,o),r&&n.invert(r[0],r[1])}),e}function na(n,t){return[n>Rt?n-Xe:n<-Rt?n+Xe:n,t]}na.invert=na;function Nd(n,t,e){return(n%=Xe)?t||e?Th(dl(n),pl(t,e)):dl(n):t||e?pl(t,e):na}function gl(n){return function(t,e){return t+=n,[t>Rt?t-Xe:t<-Rt?t+Xe:t,e]}}function dl(n){var t=gl(n);return t.invert=gl(-n),t}function pl(n,t){var e=jt(n),r=Vt(n),o=jt(t),l=Vt(t);function f(c,d){var p=jt(d),v=jt(c)*p,y=Vt(c)*p,x=Vt(d),M=x*e+v*r;return[hr(y*o-M*l,v*e-x*r),Fn(M*o+y*l)]}return f.invert=function(c,d){var p=jt(d),v=jt(c)*p,y=Vt(c)*p,x=Vt(d),M=x*o-y*l;return[hr(y*o+x*l,v*e+M*r),Fn(M*e-v*r)]},f}function Sd(n,t,e,r,o,l){if(e){var f=jt(t),c=Vt(t),d=r*e;o==null?(o=t+r*Xe,l=t-d/2):(o=ml(f,o),l=ml(f,l),(r>0?o<l:o>l)&&(o+=r*Xe));for(var p,v=o;r>0?v>l:v<l;v-=d)p=ta([f,-c*jt(v),-c*Vt(v)]),n.point(p[0],p[1])}}function ml(n,t){t=cr(t),t[0]-=n,ea(t);var e=Ih(-t[1]);return((-t[2]<0?-e:e)+Xe-Gt)%Xe}function Mh(){var n=[],t;return{point:function(e,r){t.push([e,r])},lineStart:function(){n.push(t=[])},lineEnd:Br,rejoin:function(){n.length>1&&n.push(n.pop().concat(n.shift()))},result:function(){var e=n;return n=[],t=null,e}}}function Rd(n,t,e,r,o,l){var f=n[0],c=n[1],d=t[0],p=t[1],v=0,y=1,x=d-f,M=p-c,I;if(I=e-f,!(!x&&I>0)){if(I/=x,x<0){if(I<v)return;I<y&&(y=I)}else if(x>0){if(I>y)return;I>v&&(v=I)}if(I=o-f,!(!x&&I<0)){if(I/=x,x<0){if(I>y)return;I>v&&(v=I)}else if(x>0){if(I<v)return;I<y&&(y=I)}if(I=r-c,!(!M&&I>0)){if(I/=M,M<0){if(I<v)return;I<y&&(y=I)}else if(M>0){if(I>y)return;I>v&&(v=I)}if(I=l-c,!(!M&&I<0)){if(I/=M,M<0){if(I>y)return;I>v&&(v=I)}else if(M>0){if(I<v)return;I<y&&(y=I)}return v>0&&(n[0]=f+v*x,n[1]=c+v*M),y<1&&(t[0]=f+y*x,t[1]=c+y*M),!0}}}}}function us(n,t){return Jt(n[0]-t[0])<Gt&&Jt(n[1]-t[1])<Gt}function zi(n,t,e,r){this.x=n,this.z=t,this.o=e,this.e=r,this.v=!1,this.n=this.p=null}function bh(n,t,e,r,o){var l=[],f=[],c,d;if(n.forEach(function(I){if(!((O=I.length-1)<=0)){var O,D=I[0],S=I[O],F;if(us(D,S)){for(o.lineStart(),c=0;c<O;++c)o.point((D=I[c])[0],D[1]);o.lineEnd();return}l.push(F=new zi(D,I,null,!0)),f.push(F.o=new zi(D,null,F,!1)),l.push(F=new zi(S,I,null,!1)),f.push(F.o=new zi(S,null,F,!0))}}),!!l.length){for(f.sort(t),vl(l),vl(f),c=0,d=f.length;c<d;++c)f[c].e=e=!e;for(var p=l[0],v,y;;){for(var x=p,M=!0;x.v;)if((x=x.n)===p)return;v=x.z,o.lineStart();do{if(x.v=x.o.v=!0,x.e){if(M)for(c=0,d=v.length;c<d;++c)o.point((y=v[c])[0],y[1]);else r(x.x,x.n.x,1,o);x=x.n}else{if(M)for(v=x.p.z,c=v.length-1;c>=0;--c)o.point((y=v[c])[0],y[1]);else r(x.x,x.p.x,-1,o);x=x.p}x=x.o,v=x.z,M=!M}while(!x.v);o.lineEnd()}}}function vl(n){if(t=n.length){for(var t,e=0,r=n[0],o;++e<t;)r.n=o=n[e],o.p=r,r=o;r.n=o=n[0],o.p=r}}function Nh(n,t){return n<t?-1:n>t?1:n>=t?0:NaN}function Cd(n){return n.length===1&&(n=Pd(n)),{left:function(t,e,r,o){for(r==null&&(r=0),o==null&&(o=t.length);r<o;){var l=r+o>>>1;n(t[l],e)<0?r=l+1:o=l}return r},right:function(t,e,r,o){for(r==null&&(r=0),o==null&&(o=t.length);r<o;){var l=r+o>>>1;n(t[l],e)>0?o=l:r=l+1}return r}}}function Pd(n){return function(t,e){return Nh(n(t),e)}}Cd(Nh);function Sh(n){for(var t=n.length,e,r=-1,o=0,l,f;++r<t;)o+=n[r].length;for(l=new Array(o);--t>=0;)for(f=n[t],e=f.length;--e>=0;)l[--o]=f[e];return l}var zr=1e9,qi=-zr;function Ld(n,t,e,r){function o(p,v){return n<=p&&p<=e&&t<=v&&v<=r}function l(p,v,y,x){var M=0,I=0;if(p==null||(M=f(p,y))!==(I=f(v,y))||d(p,v)<0^y>0)do x.point(M===0||M===3?n:e,M>1?r:t);while((M=(M+y+4)%4)!==I);else x.point(v[0],v[1])}function f(p,v){return Jt(p[0]-n)<Gt?v>0?0:3:Jt(p[0]-e)<Gt?v>0?2:1:Jt(p[1]-t)<Gt?v>0?1:0:v>0?3:2}function c(p,v){return d(p.x,v.x)}function d(p,v){var y=f(p,1),x=f(v,1);return y!==x?y-x:y===0?v[1]-p[1]:y===1?p[0]-v[0]:y===2?p[1]-v[1]:v[0]-p[0]}return function(p){var v=p,y=Mh(),x,M,I,O,D,S,F,w,T,N,G,A={point:L,lineStart:j,lineEnd:st,polygonStart:C,polygonEnd:B};function L(Q,tt){o(Q,tt)&&v.point(Q,tt)}function E(){for(var Q=0,tt=0,vt=M.length;tt<vt;++tt)for(var kt=M[tt],Tt=1,Z=kt.length,Ot=kt[0],it,Mt,ot=Ot[0],qt=Ot[1];Tt<Z;++Tt)it=ot,Mt=qt,Ot=kt[Tt],ot=Ot[0],qt=Ot[1],Mt<=r?qt>r&&(ot-it)*(r-Mt)>(qt-Mt)*(n-it)&&++Q:qt<=r&&(ot-it)*(r-Mt)<(qt-Mt)*(n-it)&&--Q;return Q}function C(){v=y,x=[],M=[],G=!0}function B(){var Q=E(),tt=G&&Q,vt=(x=Sh(x)).length;(tt||vt)&&(p.polygonStart(),tt&&(p.lineStart(),l(null,null,1,p),p.lineEnd()),vt&&bh(x,c,Q,l,p),p.polygonEnd()),v=p,x=M=I=null}function j(){A.point=Y,M&&M.push(I=[]),N=!0,T=!1,F=w=NaN}function st(){x&&(Y(O,D),S&&T&&y.rejoin(),x.push(y.result())),A.point=L,T&&v.lineEnd()}function Y(Q,tt){var vt=o(Q,tt);if(M&&I.push([Q,tt]),N)O=Q,D=tt,S=vt,N=!1,vt&&(v.lineStart(),v.point(Q,tt));else if(vt&&T)v.point(Q,tt);else{var kt=[F=Math.max(qi,Math.min(zr,F)),w=Math.max(qi,Math.min(zr,w))],Tt=[Q=Math.max(qi,Math.min(zr,Q)),tt=Math.max(qi,Math.min(zr,tt))];Rd(kt,Tt,n,t,e,r)?(T||(v.lineStart(),v.point(kt[0],kt[1])),v.point(Tt[0],Tt[1]),vt||v.lineEnd(),G=!1):vt&&(v.lineStart(),v.point(Q,tt),G=!1)}F=Q,w=tt,T=vt}return A}}var Ao=Mn();function Ad(n,t){var e=t[0],r=t[1],o=[Vt(e),-jt(e),0],l=0,f=0;Ao.reset();for(var c=0,d=n.length;c<d;++c)if(v=(p=n[c]).length)for(var p,v,y=p[v-1],x=y[0],M=y[1]/2+ll,I=Vt(M),O=jt(M),D=0;D<v;++D,x=F,I=T,O=N,y=S){var S=p[D],F=S[0],w=S[1]/2+ll,T=Vt(w),N=jt(w),G=F-x,A=G>=0?1:-1,L=A*G,E=L>Rt,C=I*T;if(Ao.add(hr(C*A*Vt(L),O*N+C*jt(L))),l+=E?G+A*Xe:G,E^x>=e^F>=e){var B=ys(cr(y),cr(S));ea(B);var j=ys(o,B);ea(j);var st=(E^G>=0?-1:1)*Fn(j[2]);(r>st||r===st&&(B[0]||B[1]))&&(f+=E^G>=0?1:-1)}}return(l<-Gt||l<Gt&&Ao<-Gt)^f&1}Mn();function yl(n){return n}Mn();Mn();var fr=1/0,_s=fr,Zr=-fr,ws=Zr,_l={point:Od,lineStart:Br,lineEnd:Br,polygonStart:Br,polygonEnd:Br,result:function(){var n=[[fr,_s],[Zr,ws]];return Zr=ws=-(_s=fr=1/0),n}};function Od(n,t){n<fr&&(fr=n),n>Zr&&(Zr=n),t<_s&&(_s=t),t>ws&&(ws=t)}Mn();function Rh(n,t,e,r){return function(o,l){var f=t(l),c=o.invert(r[0],r[1]),d=Mh(),p=t(d),v=!1,y,x,M,I={point:O,lineStart:S,lineEnd:F,polygonStart:function(){I.point=w,I.lineStart=T,I.lineEnd=N,x=[],y=[]},polygonEnd:function(){I.point=O,I.lineStart=S,I.lineEnd=F,x=Sh(x);var G=Ad(y,c);x.length?(v||(l.polygonStart(),v=!0),bh(x,Fd,G,e,l)):G&&(v||(l.polygonStart(),v=!0),l.lineStart(),e(null,null,1,l),l.lineEnd()),v&&(l.polygonEnd(),v=!1),x=y=null},sphere:function(){l.polygonStart(),l.lineStart(),e(null,null,1,l),l.lineEnd(),l.polygonEnd()}};function O(G,A){var L=o(G,A);n(G=L[0],A=L[1])&&l.point(G,A)}function D(G,A){var L=o(G,A);f.point(L[0],L[1])}function S(){I.point=D,f.lineStart()}function F(){I.point=O,f.lineEnd()}function w(G,A){M.push([G,A]);var L=o(G,A);p.point(L[0],L[1])}function T(){p.lineStart(),M=[]}function N(){w(M[0][0],M[0][1]),p.lineEnd();var G=p.clean(),A=d.result(),L,E=A.length,C,B,j;if(M.pop(),y.push(M),M=null,!!E){if(G&1){if(B=A[0],(C=B.length-1)>0){for(v||(l.polygonStart(),v=!0),l.lineStart(),L=0;L<C;++L)l.point((j=B[L])[0],j[1]);l.lineEnd()}return}E>1&&G&2&&A.push(A.pop().concat(A.shift())),x.push(A.filter(Dd))}}return I}}function Dd(n){return n.length>1}function Fd(n,t){return((n=n.x)[0]<0?n[1]-Ye-Gt:Ye-n[1])-((t=t.x)[0]<0?t[1]-Ye-Gt:Ye-t[1])}const wl=Rh(function(){return!0},Gd,zd,[-Rt,-Ye]);function Gd(n){var t=NaN,e=NaN,r=NaN,o;return{lineStart:function(){n.lineStart(),o=1},point:function(l,f){var c=l>0?Rt:-Rt,d=Jt(l-t);Jt(d-Rt)<Gt?(n.point(t,e=(e+f)/2>0?Ye:-Ye),n.point(r,e),n.lineEnd(),n.lineStart(),n.point(c,e),n.point(l,e),o=0):r!==c&&d>=Rt&&(Jt(t-r)<Gt&&(t-=r*Gt),Jt(l-c)<Gt&&(l-=c*Gt),e=Bd(t,e,l,f),n.point(r,e),n.lineEnd(),n.lineStart(),n.point(c,e),o=0),n.point(t=l,e=f),r=c},lineEnd:function(){n.lineEnd(),t=e=NaN},clean:function(){return 2-o}}}function Bd(n,t,e,r){var o,l,f=Vt(n-e);return Jt(f)>Gt?Md((Vt(t)*(l=jt(r))*Vt(e)-Vt(r)*(o=jt(t))*Vt(n))/(o*l*f)):(t+r)/2}function zd(n,t,e,r){var o;if(n==null)o=e*Ye,r.point(-Rt,o),r.point(0,o),r.point(Rt,o),r.point(Rt,0),r.point(Rt,-o),r.point(0,-o),r.point(-Rt,-o),r.point(-Rt,0),r.point(-Rt,o);else if(Jt(n[0]-t[0])>Gt){var l=n[0]<t[0]?Rt:-Rt;o=e*l/2,r.point(-l,o),r.point(0,o),r.point(l,o)}else r.point(t[0],t[1])}function qd(n,t){var e=jt(n),r=e>0,o=Jt(e)>Gt;function l(v,y,x,M){Sd(M,n,t,x,v,y)}function f(v,y){return jt(v)*jt(y)>e}function c(v){var y,x,M,I,O;return{lineStart:function(){I=M=!1,O=1},point:function(D,S){var F=[D,S],w,T=f(D,S),N=r?T?0:p(D,S):T?p(D+(D<0?Rt:-Rt),S):0;if(!y&&(I=M=T)&&v.lineStart(),T!==M&&(w=d(y,F),(!w||us(y,w)||us(F,w))&&(F[0]+=Gt,F[1]+=Gt,T=f(F[0],F[1]))),T!==M)O=0,T?(v.lineStart(),w=d(F,y),v.point(w[0],w[1])):(w=d(y,F),v.point(w[0],w[1]),v.lineEnd()),y=w;else if(o&&y&&r^T){var G;!(N&x)&&(G=d(F,y,!0))&&(O=0,r?(v.lineStart(),v.point(G[0][0],G[0][1]),v.point(G[1][0],G[1][1]),v.lineEnd()):(v.point(G[1][0],G[1][1]),v.lineEnd(),v.lineStart(),v.point(G[0][0],G[0][1])))}T&&(!y||!us(y,F))&&v.point(F[0],F[1]),y=F,M=T,x=N},lineEnd:function(){M&&v.lineEnd(),y=null},clean:function(){return O|(I&&M)<<1}}}function d(v,y,x){var M=cr(v),I=cr(y),O=[1,0,0],D=ys(M,I),S=Gi(D,D),F=D[0],w=S-F*F;if(!w)return!x&&v;var T=e*S/w,N=-e*F/w,G=ys(O,D),A=Bi(O,T),L=Bi(D,N);Lo(A,L);var E=G,C=Gi(A,E),B=Gi(E,E),j=C*C-B*(Gi(A,A)-1);if(!(j<0)){var st=wr(j),Y=Bi(E,(-C-st)/B);if(Lo(Y,A),Y=ta(Y),!x)return Y;var Q=v[0],tt=y[0],vt=v[1],kt=y[1],Tt;tt<Q&&(Tt=Q,Q=tt,tt=Tt);var Z=tt-Q,Ot=Jt(Z-Rt)<Gt,it=Ot||Z<Gt;if(!Ot&&kt<vt&&(Tt=vt,vt=kt,kt=Tt),it?Ot?vt+kt>0^Y[1]<(Jt(Y[0]-Q)<Gt?vt:kt):vt<=Y[1]&&Y[1]<=kt:Z>Rt^(Q<=Y[0]&&Y[0]<=tt)){var Mt=Bi(E,(-C+st)/B);return Lo(Mt,A),[Y,ta(Mt)]}}}function p(v,y){var x=r?n:Rt-n,M=0;return v<-x?M|=1:v>x&&(M|=2),y<-x?M|=4:y>x&&(M|=8),M}return Rh(f,c,l,r?[0,-n]:[-Rt,n-Rt])}function Ch(n){return function(t){var e=new ra;for(var r in n)e[r]=n[r];return e.stream=t,e}}function ra(){}ra.prototype={constructor:ra,point:function(n,t){this.stream.point(n,t)},sphere:function(){this.stream.sphere()},lineStart:function(){this.stream.lineStart()},lineEnd:function(){this.stream.lineEnd()},polygonStart:function(){this.stream.polygonStart()},polygonEnd:function(){this.stream.polygonEnd()}};function Ph(n,t,e){var r=t[1][0]-t[0][0],o=t[1][1]-t[0][1],l=n.clipExtent&&n.clipExtent();n.scale(150).translate([0,0]),l!=null&&n.clipExtent(null),bd(e,n.stream(_l));var f=_l.result(),c=Math.min(r/(f[1][0]-f[0][0]),o/(f[1][1]-f[0][1])),d=+t[0][0]+(r-c*(f[1][0]+f[0][0]))/2,p=+t[0][1]+(o-c*(f[1][1]+f[0][1]))/2;return l!=null&&n.clipExtent(l),n.scale(c*150).translate([d,p])}function Ud(n,t,e){return Ph(n,[[0,0],t],e)}var xl=16,jd=jt(30*Ne);function El(n,t){return+t?Yd(n,t):Vd(n)}function Vd(n){return Ch({point:function(t,e){t=n(t,e),this.stream.point(t[0],t[1])}})}function Yd(n,t){function e(r,o,l,f,c,d,p,v,y,x,M,I,O,D){var S=p-r,F=v-o,w=S*S+F*F;if(w>4*t&&O--){var T=f+x,N=c+M,G=d+I,A=wr(T*T+N*N+G*G),L=Fn(G/=A),E=Jt(Jt(G)-1)<Gt||Jt(l-y)<Gt?(l+y)/2:hr(N,T),C=n(E,L),B=C[0],j=C[1],st=B-r,Y=j-o,Q=F*st-S*Y;(Q*Q/w>t||Jt((S*st+F*Y)/w-.5)>.3||f*x+c*M+d*I<jd)&&(e(r,o,l,f,c,d,B,j,E,T/=A,N/=A,G,O,D),D.point(B,j),e(B,j,E,T,N,G,p,v,y,x,M,I,O,D))}}return function(r){var o,l,f,c,d,p,v,y,x,M,I,O,D={point:S,lineStart:F,lineEnd:T,polygonStart:function(){r.polygonStart(),D.lineStart=N},polygonEnd:function(){r.polygonEnd(),D.lineStart=F}};function S(L,E){L=n(L,E),r.point(L[0],L[1])}function F(){y=NaN,D.point=w,r.lineStart()}function w(L,E){var C=cr([L,E]),B=n(L,E);e(y,x,v,M,I,O,y=B[0],x=B[1],v=L,M=C[0],I=C[1],O=C[2],xl,r),r.point(y,x)}function T(){D.point=S,r.lineEnd()}function N(){F(),D.point=G,D.lineEnd=A}function G(L,E){w(o=L,E),l=y,f=x,c=M,d=I,p=O,D.point=w}function A(){e(y,x,v,M,I,O,l,f,o,c,d,p,xl,r),D.lineEnd=T,T()}return D}}var Wd=Ch({point:function(n,t){this.stream.point(n*Ne,t*Ne)}});function Xd(n){return Zd(function(){return n})()}function Zd(n){var t,e=150,r=480,o=250,l,f,c=0,d=0,p=0,v=0,y=0,x,M,I=null,O=wl,D=null,S,F,w,T=yl,N=.5,G=El(B,N),A,L;function E(Y){return Y=M(Y[0]*Ne,Y[1]*Ne),[Y[0]*e+l,f-Y[1]*e]}function C(Y){return Y=M.invert((Y[0]-l)/e,(f-Y[1])/e),Y&&[Y[0]*mn,Y[1]*mn]}function B(Y,Q){return Y=t(Y,Q),[Y[0]*e+l,f-Y[1]*e]}E.stream=function(Y){return A&&L===Y?A:A=Wd(O(x,G(T(L=Y))))},E.clipAngle=function(Y){return arguments.length?(O=+Y?qd(I=Y*Ne,6*Ne):(I=null,wl),st()):I*mn},E.clipExtent=function(Y){return arguments.length?(T=Y==null?(D=S=F=w=null,yl):Ld(D=+Y[0][0],S=+Y[0][1],F=+Y[1][0],w=+Y[1][1]),st()):D==null?null:[[D,S],[F,w]]},E.scale=function(Y){return arguments.length?(e=+Y,j()):e},E.translate=function(Y){return arguments.length?(r=+Y[0],o=+Y[1],j()):[r,o]},E.center=function(Y){return arguments.length?(c=Y[0]%360*Ne,d=Y[1]%360*Ne,j()):[c*mn,d*mn]},E.rotate=function(Y){return arguments.length?(p=Y[0]%360*Ne,v=Y[1]%360*Ne,y=Y.length>2?Y[2]%360*Ne:0,j()):[p*mn,v*mn,y*mn]},E.precision=function(Y){return arguments.length?(G=El(B,N=Y*Y),st()):wr(N)},E.fitExtent=function(Y,Q){return Ph(E,Y,Q)},E.fitSize=function(Y,Q){return Ud(E,Y,Q)};function j(){M=Th(x=Nd(p,v,y),t);var Y=t(c,d);return l=r-Y[0]*e,f=o+Y[1]*e,st()}function st(){return A=L=null,E}return function(){return t=n.apply(this,arguments),E.invert=t.invert&&C,j()}}function Lh(n){return function(t,e){var r=jt(t),o=jt(e),l=n(r*o);return[l*o*Vt(t),l*Vt(e)]}}function Ah(n){return function(t,e){var r=wr(t*t+e*e),o=n(r),l=Vt(o),f=jt(o);return[hr(t*l,r*f),Fn(r&&e*l/r)]}}var Hd=Lh(function(n){return wr(2/(1+n))});Hd.invert=Ah(function(n){return 2*Fn(n/2)});var Oh=Lh(function(n){return(n=Ih(n))&&n/Vt(n)});Oh.invert=Ah(function(n){return n});function $d(){return Xd(Oh).scale(79.4188).clipAngle(180-.001)}function kl(n,t){return[n,t]}kl.invert=kl;var he=63710088e-1,Dh={centimeters:he*100,centimetres:he*100,degrees:360/(2*Math.PI),feet:he*3.28084,inches:he*39.37,kilometers:he/1e3,kilometres:he/1e3,meters:he,metres:he,miles:he/1609.344,millimeters:he*1e3,millimetres:he*1e3,nauticalmiles:he/1852,radians:1,yards:he*1.0936};function ba(n,t,e={}){const r={type:"Feature"};return(e.id===0||e.id)&&(r.id=e.id),e.bbox&&(r.bbox=e.bbox),r.properties=t||{},r.geometry=n,r}function Kd(n,t,e={}){if(!n)throw new Error("coordinates is required");if(!Array.isArray(n))throw new Error("coordinates must be an Array");if(n.length<2)throw new Error("coordinates must be at least 2 numbers long");if(!Il(n[0])||!Il(n[1]))throw new Error("coordinates must contain numbers");return ba({type:"Point",coordinates:n},t,e)}function Jd(n,t,e={}){for(const o of n){if(o.length<4)throw new Error("Each LinearRing of a Polygon must have 4 or more Positions.");if(o[o.length-1].length!==o[0].length)throw new Error("First and last Position are not equivalent.");for(let l=0;l<o[o.length-1].length;l++)if(o[o.length-1][l]!==o[0][l])throw new Error("First and last Position are not equivalent.")}return ba({type:"Polygon",coordinates:n},t,e)}function ia(n,t={}){const e={type:"FeatureCollection"};return t.id&&(e.id=t.id),t.bbox&&(e.bbox=t.bbox),e.features=n,e}function Qd(n,t="kilometers"){const e=Dh[t];if(!e)throw new Error(t+" units is invalid");return n*e}function tp(n,t="kilometers"){const e=Dh[t];if(!e)throw new Error(t+" units is invalid");return n/e}function Il(n){return!isNaN(n)&&n!==null&&!Array.isArray(n)}function Fh(n,t,e){if(n!==null)for(var r,o,l,f,c,d,p,v=0,y=0,x,M=n.type,I=M==="FeatureCollection",O=M==="Feature",D=I?n.features.length:1,S=0;S<D;S++){p=I?n.features[S].geometry:O?n.geometry:n,x=p?p.type==="GeometryCollection":!1,c=x?p.geometries.length:1;for(var F=0;F<c;F++){var w=0,T=0;if(f=x?p.geometries[F]:p,f!==null){d=f.coordinates;var N=f.type;switch(v=0,N){case null:break;case"Point":if(t(d,y,S,w,T)===!1)return!1;y++,w++;break;case"LineString":case"MultiPoint":for(r=0;r<d.length;r++){if(t(d[r],y,S,w,T)===!1)return!1;y++,N==="MultiPoint"&&w++}N==="LineString"&&w++;break;case"Polygon":case"MultiLineString":for(r=0;r<d.length;r++){for(o=0;o<d[r].length-v;o++){if(t(d[r][o],y,S,w,T)===!1)return!1;y++}N==="MultiLineString"&&w++,N==="Polygon"&&T++}N==="Polygon"&&w++;break;case"MultiPolygon":for(r=0;r<d.length;r++){for(T=0,o=0;o<d[r].length;o++){for(l=0;l<d[r][o].length-v;l++){if(t(d[r][o][l],y,S,w,T)===!1)return!1;y++}T++}w++}break;case"GeometryCollection":for(r=0;r<f.geometries.length;r++)if(Fh(f.geometries[r],t)===!1)return!1;break;default:throw new Error("Unknown Geometry Type")}}}}}function Tl(n,t){if(n.type==="Feature")t(n,0);else if(n.type==="FeatureCollection")for(var e=0;e<n.features.length&&t(n.features[e],e)!==!1;e++);}function Gh(n,t){var e,r,o,l,f,c,d,p,v,y,x=0,M=n.type==="FeatureCollection",I=n.type==="Feature",O=M?n.features.length:1;for(e=0;e<O;e++){for(c=M?n.features[e].geometry:I?n.geometry:n,p=M?n.features[e].properties:I?n.properties:{},v=M?n.features[e].bbox:I?n.bbox:void 0,y=M?n.features[e].id:I?n.id:void 0,d=c?c.type==="GeometryCollection":!1,f=d?c.geometries.length:1,o=0;o<f;o++){if(l=d?c.geometries[o]:c,l===null){if(t(null,x,p,v,y)===!1)return!1;continue}switch(l.type){case"Point":case"LineString":case"MultiPoint":case"Polygon":case"MultiLineString":case"MultiPolygon":{if(t(l,x,p,v,y)===!1)return!1;break}case"GeometryCollection":{for(r=0;r<l.geometries.length;r++)if(t(l.geometries[r],x,p,v,y)===!1)return!1;break}default:throw new Error("Unknown Geometry Type")}}x++}}var Bh="1.13.7",Ml=typeof self=="object"&&self.self===self&&self||typeof global=="object"&&global.global===global&&global||Function("return this")()||{},Ws=Array.prototype,Na=Object.prototype,bl=typeof Symbol<"u"?Symbol.prototype:null,ep=Ws.push,pi=Ws.slice,Hr=Na.toString,np=Na.hasOwnProperty,zh=typeof ArrayBuffer<"u",rp=typeof DataView<"u",ip=Array.isArray,Nl=Object.keys,Sl=Object.create,Rl=zh&&ArrayBuffer.isView,sp=isNaN,op=isFinite,qh=!{toString:null}.propertyIsEnumerable("toString"),Cl=["valueOf","isPrototypeOf","toString","propertyIsEnumerable","hasOwnProperty","toLocaleString"],ap=Math.pow(2,53)-1;function fe(n,t){return t=t==null?n.length-1:+t,function(){for(var e=Math.max(arguments.length-t,0),r=Array(e),o=0;o<e;o++)r[o]=arguments[o+t];switch(t){case 0:return n.call(this,r);case 1:return n.call(this,arguments[0],r);case 2:return n.call(this,arguments[0],arguments[1],r)}var l=Array(t+1);for(o=0;o<t;o++)l[o]=arguments[o];return l[t]=r,n.apply(this,l)}}function jn(n){var t=typeof n;return t==="function"||t==="object"&&!!n}function up(n){return n===null}function Uh(n){return n===void 0}function jh(n){return n===!0||n===!1||Hr.call(n)==="[object Boolean]"}function lp(n){return!!(n&&n.nodeType===1)}function se(n){var t="[object "+n+"]";return function(e){return Hr.call(e)===t}}const Sa=se("String"),Vh=se("Number"),hp=se("Date"),cp=se("RegExp"),fp=se("Error"),Yh=se("Symbol"),Wh=se("ArrayBuffer");var re=se("Function"),gp=Ml.document&&Ml.document.childNodes;typeof/./!="function"&&typeof Int8Array!="object"&&typeof gp!="function"&&(re=function(n){return typeof n=="function"||!1});const Xh=se("Object");var Zh=rp&&(!/\[native code\]/.test(String(DataView))||Xh(new DataView(new ArrayBuffer(8)))),Ra=typeof Map<"u"&&Xh(new Map),dp=se("DataView");function pp(n){return n!=null&&re(n.getInt8)&&Wh(n.buffer)}const xs=Zh?pp:dp,Vn=ip||se("Array");function bn(n,t){return n!=null&&np.call(n,t)}var $r=se("Arguments");(function(){$r(arguments)||($r=function(n){return bn(n,"callee")})})();function mp(n){return!Yh(n)&&op(n)&&!isNaN(parseFloat(n))}function Hh(n){return Vh(n)&&sp(n)}function $h(n){return function(){return n}}function Kh(n){return function(t){var e=n(t);return typeof e=="number"&&e>=0&&e<=ap}}function Jh(n){return function(t){return t?.[n]}}const Es=Jh("byteLength"),vp=Kh(Es);var yp=/\[object ((I|Ui)nt(8|16|32)|Float(32|64)|Uint8Clamped|Big(I|Ui)nt64)Array\]/;function _p(n){return Rl?Rl(n)&&!xs(n):vp(n)&&yp.test(Hr.call(n))}const Qh=zh?_p:$h(!1),ge=Jh("length");function wp(n){for(var t={},e=n.length,r=0;r<e;++r)t[n[r]]=!0;return{contains:function(o){return t[o]===!0},push:function(o){return t[o]=!0,n.push(o)}}}function tc(n,t){t=wp(t);var e=Cl.length,r=n.constructor,o=re(r)&&r.prototype||Na,l="constructor";for(bn(n,l)&&!t.contains(l)&&t.push(l);e--;)l=Cl[e],l in n&&n[l]!==o[l]&&!t.contains(l)&&t.push(l)}function Qt(n){if(!jn(n))return[];if(Nl)return Nl(n);var t=[];for(var e in n)bn(n,e)&&t.push(e);return qh&&tc(n,t),t}function xp(n){if(n==null)return!0;var t=ge(n);return typeof t=="number"&&(Vn(n)||Sa(n)||$r(n))?t===0:ge(Qt(n))===0}function ec(n,t){var e=Qt(t),r=e.length;if(n==null)return!r;for(var o=Object(n),l=0;l<r;l++){var f=e[l];if(t[f]!==o[f]||!(f in o))return!1}return!0}function Lt(n){if(n instanceof Lt)return n;if(!(this instanceof Lt))return new Lt(n);this._wrapped=n}Lt.VERSION=Bh;Lt.prototype.value=function(){return this._wrapped};Lt.prototype.valueOf=Lt.prototype.toJSON=Lt.prototype.value;Lt.prototype.toString=function(){return String(this._wrapped)};function Pl(n){return new Uint8Array(n.buffer||n,n.byteOffset||0,Es(n))}var Ll="[object DataView]";function sa(n,t,e,r){if(n===t)return n!==0||1/n===1/t;if(n==null||t==null)return!1;if(n!==n)return t!==t;var o=typeof n;return o!=="function"&&o!=="object"&&typeof t!="object"?!1:nc(n,t,e,r)}function nc(n,t,e,r){n instanceof Lt&&(n=n._wrapped),t instanceof Lt&&(t=t._wrapped);var o=Hr.call(n);if(o!==Hr.call(t))return!1;if(Zh&&o=="[object Object]"&&xs(n)){if(!xs(t))return!1;o=Ll}switch(o){case"[object RegExp]":case"[object String]":return""+n==""+t;case"[object Number]":return+n!=+n?+t!=+t:+n==0?1/+n===1/t:+n==+t;case"[object Date]":case"[object Boolean]":return+n==+t;case"[object Symbol]":return bl.valueOf.call(n)===bl.valueOf.call(t);case"[object ArrayBuffer]":case Ll:return nc(Pl(n),Pl(t),e,r)}var l=o==="[object Array]";if(!l&&Qh(n)){var f=Es(n);if(f!==Es(t))return!1;if(n.buffer===t.buffer&&n.byteOffset===t.byteOffset)return!0;l=!0}if(!l){if(typeof n!="object"||typeof t!="object")return!1;var c=n.constructor,d=t.constructor;if(c!==d&&!(re(c)&&c instanceof c&&re(d)&&d instanceof d)&&"constructor"in n&&"constructor"in t)return!1}e=e||[],r=r||[];for(var p=e.length;p--;)if(e[p]===n)return r[p]===t;if(e.push(n),r.push(t),l){if(p=n.length,p!==t.length)return!1;for(;p--;)if(!sa(n[p],t[p],e,r))return!1}else{var v=Qt(n),y;if(p=v.length,Qt(t).length!==p)return!1;for(;p--;)if(y=v[p],!(bn(t,y)&&sa(n[y],t[y],e,r)))return!1}return e.pop(),r.pop(),!0}function Ep(n,t){return sa(n,t)}function mi(n){if(!jn(n))return[];var t=[];for(var e in n)t.push(e);return qh&&tc(n,t),t}function Ca(n){var t=ge(n);return function(e){if(e==null)return!1;var r=mi(e);if(ge(r))return!1;for(var o=0;o<t;o++)if(!re(e[n[o]]))return!1;return n!==sc||!re(e[Pa])}}var Pa="forEach",rc="has",La=["clear","delete"],ic=["get",rc,"set"],kp=La.concat(Pa,ic),sc=La.concat(ic),Ip=["add"].concat(La,Pa,rc);const Tp=Ra?Ca(kp):se("Map"),Mp=Ra?Ca(sc):se("WeakMap"),bp=Ra?Ca(Ip):se("Set"),Np=se("WeakSet");function xr(n){for(var t=Qt(n),e=t.length,r=Array(e),o=0;o<e;o++)r[o]=n[t[o]];return r}function Sp(n){for(var t=Qt(n),e=t.length,r=Array(e),o=0;o<e;o++)r[o]=[t[o],n[t[o]]];return r}function oc(n){for(var t={},e=Qt(n),r=0,o=e.length;r<o;r++)t[n[e[r]]]=e[r];return t}function oa(n){var t=[];for(var e in n)re(n[e])&&t.push(e);return t.sort()}function Aa(n,t){return function(e){var r=arguments.length;if(t&&(e=Object(e)),r<2||e==null)return e;for(var o=1;o<r;o++)for(var l=arguments[o],f=n(l),c=f.length,d=0;d<c;d++){var p=f[d];(!t||e[p]===void 0)&&(e[p]=l[p])}return e}}const ac=Aa(mi),ks=Aa(Qt),uc=Aa(mi,!0);function Rp(){return function(){}}function lc(n){if(!jn(n))return{};if(Sl)return Sl(n);var t=Rp();t.prototype=n;var e=new t;return t.prototype=null,e}function Cp(n,t){var e=lc(n);return t&&ks(e,t),e}function Pp(n){return jn(n)?Vn(n)?n.slice():ac({},n):n}function Lp(n,t){return t(n),n}function hc(n){return Vn(n)?n:[n]}Lt.toPath=hc;function vi(n){return Lt.toPath(n)}function Oa(n,t){for(var e=t.length,r=0;r<e;r++){if(n==null)return;n=n[t[r]]}return e?n:void 0}function cc(n,t,e){var r=Oa(n,vi(t));return Uh(r)?e:r}function Ap(n,t){t=vi(t);for(var e=t.length,r=0;r<e;r++){var o=t[r];if(!bn(n,o))return!1;n=n[o]}return!!e}function Da(n){return n}function Kr(n){return n=ks({},n),function(t){return ec(t,n)}}function Fa(n){return n=vi(n),function(t){return Oa(t,n)}}function yi(n,t,e){if(t===void 0)return n;switch(e??3){case 1:return function(r){return n.call(t,r)};case 3:return function(r,o,l){return n.call(t,r,o,l)};case 4:return function(r,o,l,f){return n.call(t,r,o,l,f)}}return function(){return n.apply(t,arguments)}}function fc(n,t,e){return n==null?Da:re(n)?yi(n,t,e):jn(n)&&!Vn(n)?Kr(n):Fa(n)}function Ga(n,t){return fc(n,t,1/0)}Lt.iteratee=Ga;function de(n,t,e){return Lt.iteratee!==Ga?Lt.iteratee(n,t):fc(n,t,e)}function Op(n,t,e){t=de(t,e);for(var r=Qt(n),o=r.length,l={},f=0;f<o;f++){var c=r[f];l[c]=t(n[c],c,n)}return l}function gc(){}function Dp(n){return n==null?gc:function(t){return cc(n,t)}}function Fp(n,t,e){var r=Array(Math.max(0,n));t=yi(t,e,1);for(var o=0;o<n;o++)r[o]=t(o);return r}function aa(n,t){return t==null&&(t=n,n=0),n+Math.floor(Math.random()*(t-n+1))}const Jr=Date.now||function(){return new Date().getTime()};function dc(n){var t=function(l){return n[l]},e="(?:"+Qt(n).join("|")+")",r=RegExp(e),o=RegExp(e,"g");return function(l){return l=l==null?"":""+l,r.test(l)?l.replace(o,t):l}}const pc={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;","`":"&#x60;"},Gp=dc(pc),Bp=oc(pc),zp=dc(Bp),qp=Lt.templateSettings={evaluate:/<%([\s\S]+?)%>/g,interpolate:/<%=([\s\S]+?)%>/g,escape:/<%-([\s\S]+?)%>/g};var Oo=/(.)^/,Up={"'":"'","\\":"\\","\r":"r","\n":"n","\u2028":"u2028","\u2029":"u2029"},jp=/\\|'|\r|\n|\u2028|\u2029/g;function Vp(n){return"\\"+Up[n]}var Yp=/^\s*(\w|\$)+\s*$/;function Wp(n,t,e){!t&&e&&(t=e),t=uc({},t,Lt.templateSettings);var r=RegExp([(t.escape||Oo).source,(t.interpolate||Oo).source,(t.evaluate||Oo).source].join("|")+"|$","g"),o=0,l="__p+='";n.replace(r,function(p,v,y,x,M){return l+=n.slice(o,M).replace(jp,Vp),o=M+p.length,v?l+=`'+
((__t=(`+v+`))==null?'':_.escape(__t))+
'`:y?l+=`'+
((__t=(`+y+`))==null?'':__t)+
'`:x&&(l+=`';
`+x+`
__p+='`),p}),l+=`';
`;var f=t.variable;if(f){if(!Yp.test(f))throw new Error("variable is not a bare identifier: "+f)}else l=`with(obj||{}){
`+l+`}
`,f="obj";l=`var __t,__p='',__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,'');};
`+l+`return __p;
`;var c;try{c=new Function(f,"_",l)}catch(p){throw p.source=l,p}var d=function(p){return c.call(this,p,Lt)};return d.source="function("+f+`){
`+l+"}",d}function Xp(n,t,e){t=vi(t);var r=t.length;if(!r)return re(e)?e.call(n):e;for(var o=0;o<r;o++){var l=n?.[t[o]];l===void 0&&(l=e,o=r),n=re(l)?l.call(n):l}return n}var Zp=0;function Hp(n){var t=++Zp+"";return n?n+t:t}function $p(n){var t=Lt(n);return t._chain=!0,t}function mc(n,t,e,r,o){if(!(r instanceof t))return n.apply(e,o);var l=lc(n.prototype),f=n.apply(l,o);return jn(f)?f:l}var Er=fe(function(n,t){var e=Er.placeholder,r=function(){for(var o=0,l=t.length,f=Array(l),c=0;c<l;c++)f[c]=t[c]===e?arguments[o++]:t[c];for(;o<arguments.length;)f.push(arguments[o++]);return mc(n,r,this,this,f)};return r});Er.placeholder=Lt;const vc=fe(function(n,t,e){if(!re(n))throw new TypeError("Bind must be called on a function");var r=fe(function(o){return mc(n,r,t,this,e.concat(o))});return r}),xe=Kh(ge);function Yn(n,t,e,r){if(r=r||[],!t&&t!==0)t=1/0;else if(t<=0)return r.concat(n);for(var o=r.length,l=0,f=ge(n);l<f;l++){var c=n[l];if(xe(c)&&(Vn(c)||$r(c)))if(t>1)Yn(c,t-1,e,r),o=r.length;else for(var d=0,p=c.length;d<p;)r[o++]=c[d++];else e||(r[o++]=c)}return r}const Kp=fe(function(n,t){t=Yn(t,!1,!1);var e=t.length;if(e<1)throw new Error("bindAll must be passed function names");for(;e--;){var r=t[e];n[r]=vc(n[r],n)}return n});function Jp(n,t){var e=function(r){var o=e.cache,l=""+(t?t.apply(this,arguments):r);return bn(o,l)||(o[l]=n.apply(this,arguments)),o[l]};return e.cache={},e}const yc=fe(function(n,t,e){return setTimeout(function(){return n.apply(null,e)},t)}),Qp=Er(yc,Lt,1);function tm(n,t,e){var r,o,l,f,c=0;e||(e={});var d=function(){c=e.leading===!1?0:Jr(),r=null,f=n.apply(o,l),r||(o=l=null)},p=function(){var v=Jr();!c&&e.leading===!1&&(c=v);var y=t-(v-c);return o=this,l=arguments,y<=0||y>t?(r&&(clearTimeout(r),r=null),c=v,f=n.apply(o,l),r||(o=l=null)):!r&&e.trailing!==!1&&(r=setTimeout(d,y)),f};return p.cancel=function(){clearTimeout(r),c=0,r=o=l=null},p}function em(n,t,e){var r,o,l,f,c,d=function(){var v=Jr()-o;t>v?r=setTimeout(d,t-v):(r=null,e||(f=n.apply(c,l)),r||(l=c=null))},p=fe(function(v){return c=this,l=v,o=Jr(),r||(r=setTimeout(d,t),e&&(f=n.apply(c,l))),f});return p.cancel=function(){clearTimeout(r),r=l=c=null},p}function nm(n,t){return Er(t,n)}function Ba(n){return function(){return!n.apply(this,arguments)}}function rm(){var n=arguments,t=n.length-1;return function(){for(var e=t,r=n[t].apply(this,arguments);e--;)r=n[e].call(this,r);return r}}function im(n,t){return function(){if(--n<1)return t.apply(this,arguments)}}function _c(n,t){var e;return function(){return--n>0&&(e=t.apply(this,arguments)),n<=1&&(t=null),e}}const sm=Er(_c,2);function wc(n,t,e){t=de(t,e);for(var r=Qt(n),o,l=0,f=r.length;l<f;l++)if(o=r[l],t(n[o],o,n))return o}function xc(n){return function(t,e,r){e=de(e,r);for(var o=ge(t),l=n>0?0:o-1;l>=0&&l<o;l+=n)if(e(t[l],l,t))return l;return-1}}const za=xc(1),Ec=xc(-1);function kc(n,t,e,r){e=de(e,r,1);for(var o=e(t),l=0,f=ge(n);l<f;){var c=Math.floor((l+f)/2);e(n[c])<o?l=c+1:f=c}return l}function Ic(n,t,e){return function(r,o,l){var f=0,c=ge(r);if(typeof l=="number")n>0?f=l>=0?l:Math.max(l+c,f):c=l>=0?Math.min(l+1,c):l+c+1;else if(e&&l&&c)return l=e(r,o),r[l]===o?l:-1;if(o!==o)return l=t(pi.call(r,f,c),Hh),l>=0?l+f:-1;for(l=n>0?f:c-1;l>=0&&l<c;l+=n)if(r[l]===o)return l;return-1}}const Tc=Ic(1,za,kc),om=Ic(-1,Ec);function ua(n,t,e){var r=xe(n)?za:wc,o=r(n,t,e);if(o!==void 0&&o!==-1)return n[o]}function am(n,t){return ua(n,Kr(t))}function fn(n,t,e){t=yi(t,e);var r,o;if(xe(n))for(r=0,o=n.length;r<o;r++)t(n[r],r,n);else{var l=Qt(n);for(r=0,o=l.length;r<o;r++)t(n[l[r]],l[r],n)}return n}function Gn(n,t,e){t=de(t,e);for(var r=!xe(n)&&Qt(n),o=(r||n).length,l=Array(o),f=0;f<o;f++){var c=r?r[f]:f;l[f]=t(n[c],c,n)}return l}function Mc(n){var t=function(e,r,o,l){var f=!xe(e)&&Qt(e),c=(f||e).length,d=n>0?0:c-1;for(l||(o=e[f?f[d]:d],d+=n);d>=0&&d<c;d+=n){var p=f?f[d]:d;o=r(o,e[p],p,e)}return o};return function(e,r,o,l){var f=arguments.length>=3;return t(e,yi(r,l,4),o,f)}}const Do=Mc(1),Al=Mc(-1);function gr(n,t,e){var r=[];return t=de(t,e),fn(n,function(o,l,f){t(o,l,f)&&r.push(o)}),r}function um(n,t,e){return gr(n,Ba(de(t)),e)}function Ol(n,t,e){t=de(t,e);for(var r=!xe(n)&&Qt(n),o=(r||n).length,l=0;l<o;l++){var f=r?r[l]:l;if(!t(n[f],f,n))return!1}return!0}function Dl(n,t,e){t=de(t,e);for(var r=!xe(n)&&Qt(n),o=(r||n).length,l=0;l<o;l++){var f=r?r[l]:l;if(t(n[f],f,n))return!0}return!1}function cn(n,t,e,r){return xe(n)||(n=xr(n)),(typeof e!="number"||r)&&(e=0),Tc(n,t,e)>=0}const lm=fe(function(n,t,e){var r,o;return re(t)?o=t:(t=vi(t),r=t.slice(0,-1),t=t[t.length-1]),Gn(n,function(l){var f=o;if(!f){if(r&&r.length&&(l=Oa(l,r)),l==null)return;f=l[t]}return f==null?f:f.apply(l,e)})});function qa(n,t){return Gn(n,Fa(t))}function hm(n,t){return gr(n,Kr(t))}function bc(n,t,e){var r=-1/0,o=-1/0,l,f;if(t==null||typeof t=="number"&&typeof n[0]!="object"&&n!=null){n=xe(n)?n:xr(n);for(var c=0,d=n.length;c<d;c++)l=n[c],l!=null&&l>r&&(r=l)}else t=de(t,e),fn(n,function(p,v,y){f=t(p,v,y),(f>o||f===-1/0&&r===-1/0)&&(r=p,o=f)});return r}function cm(n,t,e){var r=1/0,o=1/0,l,f;if(t==null||typeof t=="number"&&typeof n[0]!="object"&&n!=null){n=xe(n)?n:xr(n);for(var c=0,d=n.length;c<d;c++)l=n[c],l!=null&&l<r&&(r=l)}else t=de(t,e),fn(n,function(p,v,y){f=t(p,v,y),(f<o||f===1/0&&r===1/0)&&(r=p,o=f)});return r}var fm=/[^\ud800-\udfff]|[\ud800-\udbff][\udc00-\udfff]|[\ud800-\udfff]/g;function Nc(n){return n?Vn(n)?pi.call(n):Sa(n)?n.match(fm):xe(n)?Gn(n,Da):xr(n):[]}function Sc(n,t,e){if(t==null||e)return xe(n)||(n=xr(n)),n[aa(n.length-1)];var r=Nc(n),o=ge(r);t=Math.max(Math.min(t,o),0);for(var l=o-1,f=0;f<t;f++){var c=aa(f,l),d=r[f];r[f]=r[c],r[c]=d}return r.slice(0,t)}function gm(n){return Sc(n,1/0)}function dm(n,t,e){var r=0;return t=de(t,e),qa(Gn(n,function(o,l,f){return{value:o,index:r++,criteria:t(o,l,f)}}).sort(function(o,l){var f=o.criteria,c=l.criteria;if(f!==c){if(f>c||f===void 0)return 1;if(f<c||c===void 0)return-1}return o.index-l.index}),"value")}function Xs(n,t){return function(e,r,o){var l=t?[[],[]]:{};return r=de(r,o),fn(e,function(f,c){var d=r(f,c,e);n(l,f,d)}),l}}const pm=Xs(function(n,t,e){bn(n,e)?n[e].push(t):n[e]=[t]}),mm=Xs(function(n,t,e){n[e]=t}),vm=Xs(function(n,t,e){bn(n,e)?n[e]++:n[e]=1}),ym=Xs(function(n,t,e){n[e?0:1].push(t)},!0);function _m(n){return n==null?0:xe(n)?n.length:Qt(n).length}function wm(n,t,e){return t in e}const Rc=fe(function(n,t){var e={},r=t[0];if(n==null)return e;re(r)?(t.length>1&&(r=yi(r,t[1])),t=mi(n)):(r=wm,t=Yn(t,!1,!1),n=Object(n));for(var o=0,l=t.length;o<l;o++){var f=t[o],c=n[f];r(c,f,n)&&(e[f]=c)}return e}),xm=fe(function(n,t){var e=t[0],r;return re(e)?(e=Ba(e),t.length>1&&(r=t[1])):(t=Gn(Yn(t,!1,!1),String),e=function(o,l){return!cn(t,l)}),Rc(n,e,r)});function Cc(n,t,e){return pi.call(n,0,Math.max(0,n.length-(t==null||e?1:t)))}function Fo(n,t,e){return n==null||n.length<1?t==null||e?void 0:[]:t==null||e?n[0]:Cc(n,n.length-t)}function ls(n,t,e){return pi.call(n,t==null||e?1:t)}function Em(n,t,e){return n==null||n.length<1?t==null||e?void 0:[]:t==null||e?n[n.length-1]:ls(n,Math.max(0,n.length-t))}function km(n){return gr(n,Boolean)}function Im(n,t){return Yn(n,t,!1)}const Pc=fe(function(n,t){return t=Yn(t,!0,!0),gr(n,function(e){return!cn(t,e)})}),Tm=fe(function(n,t){return Pc(n,t)});function la(n,t,e,r){jh(t)||(r=e,e=t,t=!1),e!=null&&(e=de(e,r));for(var o=[],l=[],f=0,c=ge(n);f<c;f++){var d=n[f],p=e?e(d,f,n):d;t&&!e?((!f||l!==p)&&o.push(d),l=p):e?cn(l,p)||(l.push(p),o.push(d)):cn(o,d)||o.push(d)}return o}const Mm=fe(function(n){return la(Yn(n,!0,!0))});function bm(n){for(var t=[],e=arguments.length,r=0,o=ge(n);r<o;r++){var l=n[r];if(!cn(t,l)){var f;for(f=1;f<e&&cn(arguments[f],l);f++);f===e&&t.push(l)}}return t}function ha(n){for(var t=n&&bc(n,ge).length||0,e=Array(t),r=0;r<t;r++)e[r]=qa(n,r);return e}const Nm=fe(ha);function Sm(n,t){for(var e={},r=0,o=ge(n);r<o;r++)t?e[n[r]]=t[r]:e[n[r][0]]=n[r][1];return e}function Rm(n,t,e){t==null&&(t=n||0,n=0),e||(e=t<n?-1:1);for(var r=Math.max(Math.ceil((t-n)/e),0),o=Array(r),l=0;l<r;l++,n+=e)o[l]=n;return o}function Cm(n,t){if(t==null||t<1)return[];for(var e=[],r=0,o=n.length;r<o;)e.push(pi.call(n,r,r+=t));return e}function Ua(n,t){return n._chain?Lt(t).chain():t}function Lc(n){return fn(oa(n),function(t){var e=Lt[t]=n[t];Lt.prototype[t]=function(){var r=[this._wrapped];return ep.apply(r,arguments),Ua(this,e.apply(Lt,r))}}),Lt}fn(["pop","push","reverse","shift","sort","splice","unshift"],function(n){var t=Ws[n];Lt.prototype[n]=function(){var e=this._wrapped;return e!=null&&(t.apply(e,arguments),(n==="shift"||n==="splice")&&e.length===0&&delete e[0]),Ua(this,e)}});fn(["concat","join","slice"],function(n){var t=Ws[n];Lt.prototype[n]=function(){var e=this._wrapped;return e!=null&&(e=t.apply(e,arguments)),Ua(this,e)}});const Pm=Object.freeze(Object.defineProperty({__proto__:null,VERSION:Bh,after:im,all:Ol,allKeys:mi,any:Dl,assign:ks,before:_c,bind:vc,bindAll:Kp,chain:$p,chunk:Cm,clone:Pp,collect:Gn,compact:km,compose:rm,constant:$h,contains:cn,countBy:vm,create:Cp,debounce:em,default:Lt,defaults:uc,defer:Qp,delay:yc,detect:ua,difference:Pc,drop:ls,each:fn,escape:Gp,every:Ol,extend:ac,extendOwn:ks,filter:gr,find:ua,findIndex:za,findKey:wc,findLastIndex:Ec,findWhere:am,first:Fo,flatten:Im,foldl:Do,foldr:Al,forEach:fn,functions:oa,get:cc,groupBy:pm,has:Ap,head:Fo,identity:Da,include:cn,includes:cn,indexBy:mm,indexOf:Tc,initial:Cc,inject:Do,intersection:bm,invert:oc,invoke:lm,isArguments:$r,isArray:Vn,isArrayBuffer:Wh,isBoolean:jh,isDataView:xs,isDate:hp,isElement:lp,isEmpty:xp,isEqual:Ep,isError:fp,isFinite:mp,isFunction:re,isMap:Tp,isMatch:ec,isNaN:Hh,isNull:up,isNumber:Vh,isObject:jn,isRegExp:cp,isSet:bp,isString:Sa,isSymbol:Yh,isTypedArray:Qh,isUndefined:Uh,isWeakMap:Mp,isWeakSet:Np,iteratee:Ga,keys:Qt,last:Em,lastIndexOf:om,map:Gn,mapObject:Op,matcher:Kr,matches:Kr,max:bc,memoize:Jp,methods:oa,min:cm,mixin:Lc,negate:Ba,noop:gc,now:Jr,object:Sm,omit:xm,once:sm,pairs:Sp,partial:Er,partition:ym,pick:Rc,pluck:qa,property:Fa,propertyOf:Dp,random:aa,range:Rm,reduce:Do,reduceRight:Al,reject:um,rest:ls,restArguments:fe,result:Xp,sample:Sc,select:gr,shuffle:gm,size:_m,some:Dl,sortBy:dm,sortedIndex:kc,tail:ls,take:Fo,tap:Lp,template:Wp,templateSettings:qp,throttle:tm,times:Fp,toArray:Nc,toPath:hc,transpose:ha,unescape:zp,union:Mm,uniq:la,unique:la,uniqueId:Hp,unzip:ha,values:xr,where:hm,without:Tm,wrap:nm,zip:Nm},Symbol.toStringTag,{value:"Module"}));var Is=Lc(Pm);Is._=Is;function ur(n,t){const e=t[0],r=t[1];return[n[0]*e+n[2]*r+n[4],n[1]*e+n[3]*r+n[5]]}function Lm(){return[1,0,0,1,0,0]}function Am(n,t){const e=n[0],r=n[1],o=n[2],l=n[3],f=n[4],c=n[5],d=t[0],p=t[1],v=t[2],y=t[3],x=t[4],M=t[5];return[e*d+o*p,r*d+l*p,e*v+o*y,r*v+l*y,e*x+o*M+f,r*x+l*M+c]}function Fl(n,t,e,r,o,l,f){const c=Math.sin(o),d=Math.cos(o);return[e*d,r*c,-e*c,r*d,l*e*d-f*e*c+n,l*r*c+f*r*d+t]}function Om(n){const t=Dm(n),e=n[0],r=n[1],o=n[2],l=n[3],f=n[4],c=n[5];return[l/t,-r/t,-o/t,e/t,(o*c-l*f)/t,-(e*c-r*f)/t]}function Dm(n){return n[0]*n[3]-n[1]*n[2]}function Fm(n){const t=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1];return t[0]=n[0],t[1]=n[1],t[4]=n[2],t[5]=n[3],t[12]=n[4],t[13]=n[5],t}async function Ac(n,t,e){let r;if(typeof e=="function"?r=await e(n,t):r=await fetch(n,t),!r.ok)throw new Error(r.statusText);return r}async function Gm(n,t,e){return await(await Ac(n,t,e)).json()}async function Bm(n,t,e){return await Gm(`${n}/info.json`,t,e)}function Oc(n,t=!1){switch(n.type){case"Polygon":return n.coordinates?{...n,coordinates:Gl(n.coordinates,t)}:n;case"MultiPolygon":return n.coordinates?{...n,coordinates:n.coordinates.map(e=>Gl(e,t))}:n;case"GeometryCollection":return{...n,geometries:n.geometries.map(e=>Oc(e,t))};default:return n}}function Gl(n,t){if(n.length===0)return n;const e=[];for(let r=0;r<n.length;r++)e.push(zm(n[r],r===0?t:!t));return e}function zm(n,t){let e=0,r=0;for(let o=0,l=n.length,f=l-1;o<l;f=o++){const c=(n[o][0]-n[f][0])*(n[f][1]+n[o][1]),d=e+c;r+=Math.abs(e)>=Math.abs(c)?e-d+c:c-d+e,e=d}return e+r>=0!=!!t?n.slice().reverse():n}function ae(n){return Array.isArray(n)&&n.length===2&&typeof n[0]=="number"&&typeof n[1]=="number"}function Ae(n){return Array.isArray(n)&&n.every(ae)}function qm(n){return Array.isArray(n)&&n.every(ae)}function Oe(n){return Array.isArray(n)&&n.every(qm)}function tn(n){return Array.isArray(n)&&n.every(ae)}function en(n){return Array.isArray(n)&&n.every(Ae)}function nn(n){return Array.isArray(n)&&n.every(Oe)}function Zs(n){if(n=n.filter(function(t,e,r){return e===0||!Va(t,r[e-1])}),n.length<2)throw new Error("LineString should contain at least 2 points");return n}function ja(n){if(n=n.filter(function(t,e,r){return e===0||!Va(t,r[e-1])}),Vm(n)&&n.splice(-1),n.length<3)throw new Error("Ring should contain at least 3 points");return n}function Dc(n){return n.map(t=>ja(t))}function Um(n){return n.map(t=>Zs(t))}function jm(n){return n.map(t=>Dc(t))}function Ui(n){return{type:"Point",coordinates:n}}function ji(n){return{type:"LineString",coordinates:n}}function Vi(n,t=!0){const e={type:"Polygon",coordinates:t?n.map(r=>[...r,r[0]]):n};return Oc(e)}function Vm(n){return Array.isArray(n)&&n.length>=2&&Va(n[0],n[n.length-1])}function Va(n,t){return n===t?!0:n===null||t===null?!1:n[0]===t[0]&&n[1]===t[1]}function Ym(n){return[n[0],-n[1]]}function Ts(n,t){return[(t[0]-n[0])/2+n[0],(t[1]-n[1])/2+n[1]]}function Wm(n,t,e){return n*e+t*(1-e)}function Xm(n,t,e){return[n[0]*e+t[0]*(1-e),n[1]*e+t[1]*(1-e)]}function ye(n,t){if(Ae(n)&&n.length===2)return ye(n[0],n[1]);if(ae(n)&&ae(t))return Math.sqrt((t[0]-n[0])**2+(t[1]-n[1])**2);throw new Error("Input type not supported")}function Zm(n){return n*(Math.PI/180)}function rn(n){return typeof n=="object"&&n!==null&&n.type==="Point"&&ae(n.coordinates)}function sn(n){return typeof n=="object"&&n!==null&&n.type==="LineString"&&Ae(n.coordinates)}function on(n){return typeof n=="object"&&n!==null&&n.type==="Polygon"&&Array.isArray(n.coordinates)&&Oe(n.coordinates)}function an(n){return typeof n=="object"&&n!==null&&n.type==="MultiPoint"&&tn(n.coordinates)}function un(n){return typeof n=="object"&&n!==null&&n.type==="MultiLineString"&&en(n.coordinates)}function ln(n){return typeof n=="object"&&n!==null&&n.type==="MultiPolygon"&&Array.isArray(n.coordinates)&&nn(n.coordinates)}function Hm(n){const t=typeof n=="object"&&n!==null,e=t&&"type"in n&&typeof n.type=="string"&&(n.type==="Point"||n.type==="LineString"||n.type==="Polygon"||n.type==="MultiPoint"||n.type==="MultiLineString"||n.type==="MultiPolygon"),r=t&&"coordinates"in n&&Array.isArray(n.coordinates);return e&&r}function qr(n){return n.coordinates}function Ur(n){return Zs(n.coordinates)}function jr(n,t=!1){let e=n.coordinates;return e=Dc(e),t?e.map(r=>[...r,r[0]]):e}function $m(n){return n.coordinates}function Km(n){return Um(n.coordinates)}function Jm(n,t=!1){let e=n.coordinates;return e=jm(e),t?e.map(r=>r.map(o=>[...o,o[0]])):e}function Qm(n){if(rn(n))return qr(n);if(sn(n))return Ur(n);if(on(n))return jr(n);if(an(n))return $m(n);if(un(n))return Km(n);if(ln(n))return Jm(n);throw new Error("Geometry type not supported")}function Yi(n){return n.coordinates.map(t=>({type:"Point",coordinates:t}))}function Wi(n){return n.coordinates.map(t=>({type:"LineString",coordinates:t}))}function Xi(n){return n.coordinates.map(t=>({type:"Polygon",coordinates:t}))}function Zi(n){return{type:"MultiPoint",coordinates:n.map(t=>t.coordinates)}}function Hi(n){return{type:"MultiLineString",coordinates:n.map(t=>t.coordinates)}}function $i(n){return{type:"MultiPolygon",coordinates:n.map(t=>t.coordinates)}}function tv(n,t){return{type:"Feature",properties:t||{},geometry:n}}function ev(n,t){return{type:"FeatureCollection",features:n.map((e,r)=>tv(e))}}function nv(n){return n.geometry}function rv(n){return n.features.map(nv)}function Bl(n){let t=Number.POSITIVE_INFINITY,e=Number.NEGATIVE_INFINITY;for(const r of n)t===void 0?r>=r&&(t=e=r):(t>r&&(t=r),e<r&&(e=r));return[t,e]}function ne(n){if(ae(n)&&(n=[n]),Oe(n)&&(n=n.flat()),Hm(n))return ne(Qm(n));const t=[],e=[];for(const c of n)t.push(c[0]),e.push(c[1]);const[r,o]=Bl(t),[l,f]=Bl(e);return[r,l,o,f]}function zl(n,t){return[Math.min(n[0],t[0]),Math.min(n[1],t[1]),Math.max(n[2],t[2]),Math.max(n[3],t[3])]}function iv(n,t){const e=n[2]>=t[0]&&t[2]>=n[0],r=n[3]>=t[1]&&t[3]>=n[1];return e&&r}function Ms(n){return[[n[0],n[1]],[n[2],n[1]],[n[2],n[3]],[n[0],n[3]]]}function Fc(n){return[[n[0],n[1]],[n[2],n[3]]]}function sv(n){return ye(Fc(n))}function ov(n){return ye(Fc(ne(n)))}function dr(n){return[(n[0]+n[2])/2,(n[1]+n[3])/2]}function Go(n){return[n[2]-n[0],n[3]-n[1]]}function ca(n){return[.5*(ye(n[0],n[1])+ye(n[2],n[3])),.5*(ye(n[1],n[2])+ye(n[3],n[0]))]}function bs(n,t,e){return e?e==="contain"?t[0]>=t[1]?n[0]/t[0]:n[1]/t[1]:t[0]>=t[1]?n[1]/t[1]:n[0]/t[0]:Math.sqrt(n[0]*n[1]/(t[0]*t[1]))}function ql(n,t){return bs(ca(n),ca(t))}function hs(n,t,e,r=!0){if(n.has(t)&&r)return n.get(t);{const o=e();return n.set(t,o),o}}function Bo(n,t,e,r,o=!0){if(n.get(t)?.has(e)&&o)return n.get(t)?.get(e);{const l=r();return n.get(t)||n.set(t,new Map),n.get(t)?.set(e,l),l}}function av(n){const t=parseInt(n.replace(/^#/,""),16),e=t>>16&255,r=t>>8&255,o=t&255;return[e,r,o]}function Ki(n){return av(n).map(t=>t/255)}function uv(n,t){return!n||!t||n.size!==t.size?!1:[...n].every(e=>t.has(e))}function Ul(n,t){if(n!==void 0&&t!==void 0)return Math.max(n,t);if(n!==void 0)return n;if(t!==void 0)return t}function lv(n,t){t===void 0&&(t={});var e=t.offsetLine||0,r=t.offsetColumn||0,o=n.split(`
`),l=0,f=o.map(function(y,x){var M=l+y.length+1,I={start:l,end:M,line:x};return l=M,I}),c=0;function d(y,x){return y.start<=x&&x<y.end}function p(y,x){return{line:e+y.line,column:r+x-y.start,character:x}}function v(y,x){typeof y=="string"&&(y=n.indexOf(y,x||0));for(var M=f[c],I=y>=M.end?1:-1;M;){if(d(M,y))return p(M,y);c+=I,M=f[c]}}return v}function hv(n,t,e){return lv(n,e)(t,e)}var jl=/[a-zA-Z0-9:_-]/,Vl=/[\s\t\r\n]/,cv=/['"]/;function fv(n,t){for(var e="";t--;)e+=n;return e}function gv(n){var t="",e=[],r=c,o=null,l=null;function f(T){var N=hv(n,w),G=N.line,A=N.column,L=n.slice(0,w),E=/(^|\n).*$/.exec(L)[0].replace(/\t/g,"  "),C=n.slice(w),B=/.*(\n|$)/.exec(C)[0],j=""+E+B+`
`+fv(" ",E.length)+"^";throw new Error(T+" ("+G+":"+A+`). If this is valid SVG, it's probably a bug in svg-parser. Please raise an issue at https://github.com/Rich-Harris/svg-parser/issues – thanks!

`+j)}function c(){for(;w<n.length&&n[w]!=="<"||!jl.test(n[w+1]);)t+=n[w++];return d()}function d(){for(var T="";w<n.length&&n[w]!=="<";)T+=n[w++];return/\S/.test(T)&&o.children.push({type:"text",value:T}),n[w]==="<"?p:d}function p(){var T=n[w];if(T==="?")return d;if(T==="!"){if(n.slice(w+1,w+3)==="--")return v;if(n.slice(w+1,w+8)==="[CDATA[")return y;if(/doctype/i.test(n.slice(w+1,w+8)))return d}if(T==="/")return x;var N=M(),G={type:"element",tagName:N,properties:{},children:[]};o?o.children.push(G):l=G;for(var A;w<n.length&&(A=I());)G.properties[A.name]=A.value;var L=!1;return n[w]==="/"&&(w+=1,L=!0),n[w]!==">"&&f("Expected >"),L||(o=G,e.push(G)),d}function v(){var T=n.indexOf("-->",w);return~T||f("expected -->"),w=T+2,d}function y(){var T=n.indexOf("]]>",w);return~T||f("expected ]]>"),o.children.push(n.slice(w+7,T)),w=T+2,d}function x(){var T=M();return T||f("Expected tag name"),T!==o.tagName&&f("Expected closing tag </"+T+"> to match opening tag <"+o.tagName+">"),F(),n[w]!==">"&&f("Expected >"),e.pop(),o=e[e.length-1],d}function M(){for(var T="";w<n.length&&jl.test(n[w]);)T+=n[w++];return T}function I(){if(!Vl.test(n[w]))return null;F();var T=M();if(!T)return null;var N=!0;return F(),n[w]==="="&&(w+=1,F(),N=O(),!isNaN(N)&&N.trim()!==""&&(N=+N)),{name:T,value:N}}function O(){return cv.test(n[w])?S():D()}function D(){var T="";do{var N=n[w];if(N===" "||N===">"||N==="/")return T;T+=N,w+=1}while(w<n.length);return T}function S(){for(var T=n[w++],N="",G=!1;w<n.length;){var A=n[w++];if(A===T&&!G)return N;A==="\\"&&!G&&(G=!0),N+=G?"\\"+A:A,G=!1}}function F(){for(;w<n.length&&Vl.test(n[w]);)w+=1}for(var w=c.length;w<n.length;)r||f("Unexpected character"),r=r(),w+=1;return r!==d&&f("Unexpected end of input"),l.tagName==="svg"&&(l.metadata=t),{type:"root",children:[l]}}function*dv(n){function*t(r){if("children"in r)for(const o of r.children)typeof o!="string"&&(yield*t(o));yield r}const e=gv(n);for(const r of t(e))if("tagName"in r&&r.tagName!=="svg"&&r.tagName!=="g"){const o=pv(r);o&&(yield o)}}function pv(n){const t=n?.tagName?.toLowerCase();if(t==="circle")return{type:"circle",coordinates:[Zt(n,"cx"),Zt(n,"cy")]};if(t==="line")return{type:"line",coordinates:[[Zt(n,"x1"),Zt(n,"y1")],[Zt(n,"x2"),Zt(n,"y2")]]};if(t==="polyline")return{type:"polyline",coordinates:Yl(n)};if(t==="polygon")return{type:"polygon",coordinates:Yl(n)};if(t==="rect")return{type:"rect",coordinates:[[Zt(n,"x"),Zt(n,"y")],[Zt(n,"x")+Zt(n,"width"),Zt(n,"y")],[Zt(n,"x")+Zt(n,"width"),Zt(n,"y")+Zt(n,"height")],[Zt(n,"x"),Zt(n,"y")+Zt(n,"height")],[Zt(n,"x"),Zt(n,"y")]]};throw new Error(`Unsupported SVG element: ${t}`)}function Zt(n,t){const e=n?.properties?.[t];return Number(e)||0}function Yl(n){const t=n?.properties?.points;return t?String(t).trim().split(/\s+/).map(e=>{const r=e.split(",").map(o=>Number(o));return[r[0],r[1]]}):[]}function Wl(n){return n.map(t=>t.join(",")).join(" ")}function mv(n){return`<svg xmlns="http://www.w3.org/2000/svg">
  ${n.map(vv).join(`
`)}
</svg>`}function vv(n){if(n.type==="circle")return Or("circle",{...n.attributes,cx:n.coordinates[0],cy:n.coordinates[1]});if(n.type==="line")return Or("line",{...n.attributes,x1:n.coordinates[0][0],y1:n.coordinates[0][1],x2:n.coordinates[1][0],y2:n.coordinates[1][1]});if(n.type==="polyline")return Or("polyline",{...n.attributes,points:Wl(n.coordinates)});if(n.type==="polygon")return Or("polygon",{...n.attributes,points:Wl(n.coordinates)});if(n.type==="rect")return Or("rect",{...n.attributes,x:n.coordinates[0][0],y:n.coordinates[0][1],width:n.coordinates[1][0]-n.coordinates[0][0],height:n.coordinates[2][1]-n.coordinates[0][1]});throw new Error("Unknown SVG element")}function Or(n,t){const e=Object.entries(t).map(([r,o])=>`${r}="${o}"`);return`<${n} ${e.join(" ")} />`}function rr([n,t]){const e=6378137*Zm(n),r=e/n,o=180/Math.PI*Math.log(Math.tan(Math.PI/4+t*(Math.PI/180)/2))*r;return[e,o]}function Xl([n,t]){const e=Math.PI*6378137,r=n/e*180;let o=t/e*180;return o=180/Math.PI*(2*Math.atan(Math.exp(o*Math.PI/180))-Math.PI/2),[r,o]}class Ns{geoCenter;geoRectangle;geoSize;geoRectangleBbox;projectedGeoCenter;projectedGeoRectangle;projectedGeoSize;projectedGeoRectangleBbox;rotation;projectedGeoPerViewportScale;viewportCenter;viewportRectangle;viewportSize;viewportBbox;devicePixelRatio;canvasCenter;canvasRectangle;canvasSize;canvasBbox;projectedGeoPerCanvasScale;projectedGeoToViewportTransform=[1,0,0,1,0,0];projectedGeoToClipTransform=[1,0,0,1,0,0];constructor(t,e,r,o,l=1){this.projectedGeoCenter=e,this.projectedGeoPerViewportScale=r,this.rotation=o,this.viewportSize=t,this.devicePixelRatio=l,this.projectedGeoRectangle=this.computeProjectedGeoRectangle(this.projectedGeoCenter,this.projectedGeoPerViewportScale,this.rotation,this.viewportSize),this.projectedGeoRectangleBbox=ne(this.projectedGeoRectangle),this.projectedGeoSize=[this.viewportSize[0]*r,this.viewportSize[1]*r],this.geoCenter=Xl(this.projectedGeoCenter),this.geoRectangle=this.projectedGeoRectangle.map(f=>Xl(f)),this.geoRectangleBbox=ne(this.geoRectangle),this.geoSize=Go(this.geoRectangleBbox),this.viewportCenter=[this.viewportSize[0]/2,this.viewportSize[1]/2],this.viewportBbox=[0,0,...this.viewportSize],this.viewportRectangle=Ms(this.viewportBbox),this.canvasCenter=[this.viewportCenter[0]*this.devicePixelRatio,this.viewportSize[1]*this.devicePixelRatio],this.canvasSize=[this.viewportSize[0]*this.devicePixelRatio,this.viewportSize[1]*this.devicePixelRatio],this.canvasBbox=[0,0,...this.canvasSize],this.canvasRectangle=Ms(this.canvasBbox),this.projectedGeoPerCanvasScale=this.projectedGeoPerViewportScale/this.devicePixelRatio,this.projectedGeoToViewportTransform=this.composeProjectedGeoToViewportTransform(),this.projectedGeoToClipTransform=this.composeProjectedGeoToClipTransform()}static fromWarpedMapList(t,e,r,o="contain",l=1){const f=e.getProjectedCenter(),c=e.getProjectedBbox();if(!f||!c)throw new Error("WarpedMapList has no projected center or bbox");const d=Go(c),p=bs(d,t,o)*(1/l);return new Ns(t,f,p,0,r)}static fromProjectedGeoBbox(t,e,r,o="contain"){const l=dr(e),f=Go(e),c=bs(f,t,o);return new Ns(t,l,c,0,r)}composeProjectedGeoToViewportTransform(){return Fl(this.viewportSize[0]/2,this.viewportSize[1]/2,1/this.projectedGeoPerViewportScale,-1/this.projectedGeoPerViewportScale,-this.rotation,-this.projectedGeoCenter[0],-this.projectedGeoCenter[1])}composeProjectedGeoToClipTransform(){return Fl(0,0,2/(this.projectedGeoPerViewportScale*this.viewportSize[0]),2/(this.projectedGeoPerViewportScale*this.viewportSize[1]),-this.rotation,-this.projectedGeoCenter[0],-this.projectedGeoCenter[1])}computeProjectedGeoRectangle(t,e,r,o){const l=e*o[0]/2,f=e*o[1]/2,c=Math.cos(r),d=Math.sin(r),p=l*c,v=l*d,y=f*c,x=f*d,M=t[0],I=t[1];return[[M-p+x,I-v-y],[M-p-x,I-v+y],[M+p-x,I+v+y],[M+p+x,I+v-y]]}}function fa(n){return Array.isArray(n)?`[${n.map(t=>fa(t)).join(",")}]`:typeof n=="number"?`${n}`:typeof n=="string"?`"${n}"`:typeof n=="object"&&n!==null?Object.keys(n).sort().map(t=>`${t}:${fa(n[t])}`).join("|"):String(n)}async function yv(n){const t=await crypto.subtle.digest("SHA-1",new TextEncoder().encode(n));return Array.from(new Uint8Array(t)).map(e=>e.toString(16).padStart(2,"0")).join("")}async function Gc(n,t=16){return(await yv(String(n))).slice(0,t)}async function _v(n,t){return await Gc(fa(n),t)}var St;(function(n){n.assertEqual=o=>o;function t(o){}n.assertIs=t;function e(o){throw new Error}n.assertNever=e,n.arrayToEnum=o=>{const l={};for(const f of o)l[f]=f;return l},n.getValidEnumValues=o=>{const l=n.objectKeys(o).filter(c=>typeof o[o[c]]!="number"),f={};for(const c of l)f[c]=o[c];return n.objectValues(f)},n.objectValues=o=>n.objectKeys(o).map(function(l){return o[l]}),n.objectKeys=typeof Object.keys=="function"?o=>Object.keys(o):o=>{const l=[];for(const f in o)Object.prototype.hasOwnProperty.call(o,f)&&l.push(f);return l},n.find=(o,l)=>{for(const f of o)if(l(f))return f},n.isInteger=typeof Number.isInteger=="function"?o=>Number.isInteger(o):o=>typeof o=="number"&&isFinite(o)&&Math.floor(o)===o;function r(o,l=" | "){return o.map(f=>typeof f=="string"?`'${f}'`:f).join(l)}n.joinValues=r,n.jsonStringifyReplacer=(o,l)=>typeof l=="bigint"?l.toString():l})(St||(St={}));var ga;(function(n){n.mergeShapes=(t,e)=>({...t,...e})})(ga||(ga={}));const nt=St.arrayToEnum(["string","nan","number","integer","float","boolean","date","bigint","symbol","function","undefined","null","array","object","unknown","promise","void","never","map","set"]),yn=n=>{switch(typeof n){case"undefined":return nt.undefined;case"string":return nt.string;case"number":return isNaN(n)?nt.nan:nt.number;case"boolean":return nt.boolean;case"function":return nt.function;case"bigint":return nt.bigint;case"symbol":return nt.symbol;case"object":return Array.isArray(n)?nt.array:n===null?nt.null:n.then&&typeof n.then=="function"&&n.catch&&typeof n.catch=="function"?nt.promise:typeof Map<"u"&&n instanceof Map?nt.map:typeof Set<"u"&&n instanceof Set?nt.set:typeof Date<"u"&&n instanceof Date?nt.date:nt.object;default:return nt.unknown}},W=St.arrayToEnum(["invalid_type","invalid_literal","custom","invalid_union","invalid_union_discriminator","invalid_enum_value","unrecognized_keys","invalid_arguments","invalid_return_type","invalid_date","invalid_string","too_small","too_big","invalid_intersection_types","not_multiple_of","not_finite"]),wv=n=>JSON.stringify(n,null,2).replace(/"([^"]+)":/g,"$1:");class _e extends Error{constructor(t){super(),this.issues=[],this.addIssue=r=>{this.issues=[...this.issues,r]},this.addIssues=(r=[])=>{this.issues=[...this.issues,...r]};const e=new.target.prototype;Object.setPrototypeOf?Object.setPrototypeOf(this,e):this.__proto__=e,this.name="ZodError",this.issues=t}get errors(){return this.issues}format(t){const e=t||function(l){return l.message},r={_errors:[]},o=l=>{for(const f of l.issues)if(f.code==="invalid_union")f.unionErrors.map(o);else if(f.code==="invalid_return_type")o(f.returnTypeError);else if(f.code==="invalid_arguments")o(f.argumentsError);else if(f.path.length===0)r._errors.push(e(f));else{let c=r,d=0;for(;d<f.path.length;){const p=f.path[d];d===f.path.length-1?(c[p]=c[p]||{_errors:[]},c[p]._errors.push(e(f))):c[p]=c[p]||{_errors:[]},c=c[p],d++}}};return o(this),r}static assert(t){if(!(t instanceof _e))throw new Error(`Not a ZodError: ${t}`)}toString(){return this.message}get message(){return JSON.stringify(this.issues,St.jsonStringifyReplacer,2)}get isEmpty(){return this.issues.length===0}flatten(t=e=>e.message){const e={},r=[];for(const o of this.issues)o.path.length>0?(e[o.path[0]]=e[o.path[0]]||[],e[o.path[0]].push(t(o))):r.push(t(o));return{formErrors:r,fieldErrors:e}}get formErrors(){return this.flatten()}}_e.create=n=>new _e(n);const pr=(n,t)=>{let e;switch(n.code){case W.invalid_type:n.received===nt.undefined?e="Required":e=`Expected ${n.expected}, received ${n.received}`;break;case W.invalid_literal:e=`Invalid literal value, expected ${JSON.stringify(n.expected,St.jsonStringifyReplacer)}`;break;case W.unrecognized_keys:e=`Unrecognized key(s) in object: ${St.joinValues(n.keys,", ")}`;break;case W.invalid_union:e="Invalid input";break;case W.invalid_union_discriminator:e=`Invalid discriminator value. Expected ${St.joinValues(n.options)}`;break;case W.invalid_enum_value:e=`Invalid enum value. Expected ${St.joinValues(n.options)}, received '${n.received}'`;break;case W.invalid_arguments:e="Invalid function arguments";break;case W.invalid_return_type:e="Invalid function return type";break;case W.invalid_date:e="Invalid date";break;case W.invalid_string:typeof n.validation=="object"?"includes"in n.validation?(e=`Invalid input: must include "${n.validation.includes}"`,typeof n.validation.position=="number"&&(e=`${e} at one or more positions greater than or equal to ${n.validation.position}`)):"startsWith"in n.validation?e=`Invalid input: must start with "${n.validation.startsWith}"`:"endsWith"in n.validation?e=`Invalid input: must end with "${n.validation.endsWith}"`:St.assertNever(n.validation):n.validation!=="regex"?e=`Invalid ${n.validation}`:e="Invalid";break;case W.too_small:n.type==="array"?e=`Array must contain ${n.exact?"exactly":n.inclusive?"at least":"more than"} ${n.minimum} element(s)`:n.type==="string"?e=`String must contain ${n.exact?"exactly":n.inclusive?"at least":"over"} ${n.minimum} character(s)`:n.type==="number"?e=`Number must be ${n.exact?"exactly equal to ":n.inclusive?"greater than or equal to ":"greater than "}${n.minimum}`:n.type==="date"?e=`Date must be ${n.exact?"exactly equal to ":n.inclusive?"greater than or equal to ":"greater than "}${new Date(Number(n.minimum))}`:e="Invalid input";break;case W.too_big:n.type==="array"?e=`Array must contain ${n.exact?"exactly":n.inclusive?"at most":"less than"} ${n.maximum} element(s)`:n.type==="string"?e=`String must contain ${n.exact?"exactly":n.inclusive?"at most":"under"} ${n.maximum} character(s)`:n.type==="number"?e=`Number must be ${n.exact?"exactly":n.inclusive?"less than or equal to":"less than"} ${n.maximum}`:n.type==="bigint"?e=`BigInt must be ${n.exact?"exactly":n.inclusive?"less than or equal to":"less than"} ${n.maximum}`:n.type==="date"?e=`Date must be ${n.exact?"exactly":n.inclusive?"smaller than or equal to":"smaller than"} ${new Date(Number(n.maximum))}`:e="Invalid input";break;case W.custom:e="Invalid input";break;case W.invalid_intersection_types:e="Intersection results could not be merged";break;case W.not_multiple_of:e=`Number must be a multiple of ${n.multipleOf}`;break;case W.not_finite:e="Number must be finite";break;default:e=t.defaultError,St.assertNever(n)}return{message:e}};let Bc=pr;function xv(n){Bc=n}function Ss(){return Bc}const Rs=n=>{const{data:t,path:e,errorMaps:r,issueData:o}=n,l=[...e,...o.path||[]],f={...o,path:l};if(o.message!==void 0)return{...o,path:l,message:o.message};let c="";const d=r.filter(p=>!!p).slice().reverse();for(const p of d)c=p(f,{data:t,defaultError:c}).message;return{...o,path:l,message:c}},Ev=[];function et(n,t){const e=Ss(),r=Rs({issueData:t,data:n.data,path:n.path,errorMaps:[n.common.contextualErrorMap,n.schemaErrorMap,e,e===pr?void 0:pr].filter(o=>!!o)});n.common.issues.push(r)}class ie{constructor(){this.value="valid"}dirty(){this.value==="valid"&&(this.value="dirty")}abort(){this.value!=="aborted"&&(this.value="aborted")}static mergeArray(t,e){const r=[];for(const o of e){if(o.status==="aborted")return gt;o.status==="dirty"&&t.dirty(),r.push(o.value)}return{status:t.value,value:r}}static async mergeObjectAsync(t,e){const r=[];for(const o of e){const l=await o.key,f=await o.value;r.push({key:l,value:f})}return ie.mergeObjectSync(t,r)}static mergeObjectSync(t,e){const r={};for(const o of e){const{key:l,value:f}=o;if(l.status==="aborted"||f.status==="aborted")return gt;l.status==="dirty"&&t.dirty(),f.status==="dirty"&&t.dirty(),l.value!=="__proto__"&&(typeof f.value<"u"||o.alwaysSet)&&(r[l.value]=f.value)}return{status:t.value,value:r}}}const gt=Object.freeze({status:"aborted"}),Cs=n=>({status:"dirty",value:n}),ue=n=>({status:"valid",value:n}),da=n=>n.status==="aborted",pa=n=>n.status==="dirty",Qr=n=>n.status==="valid",ti=n=>typeof Promise<"u"&&n instanceof Promise;function Ps(n,t,e,r){if(typeof t=="function"?n!==t||!0:!t.has(n))throw new TypeError("Cannot read private member from an object whose class did not declare it");return t.get(n)}function zc(n,t,e,r,o){if(typeof t=="function"?n!==t||!0:!t.has(n))throw new TypeError("Cannot write private member to an object whose class did not declare it");return t.set(n,e),e}var ut;(function(n){n.errToObj=t=>typeof t=="string"?{message:t}:t||{},n.toString=t=>typeof t=="string"?t:t?.message})(ut||(ut={}));var Vr,Yr;class Ze{constructor(t,e,r,o){this._cachedPath=[],this.parent=t,this.data=e,this._path=r,this._key=o}get path(){return this._cachedPath.length||(this._key instanceof Array?this._cachedPath.push(...this._path,...this._key):this._cachedPath.push(...this._path,this._key)),this._cachedPath}}const Zl=(n,t)=>{if(Qr(t))return{success:!0,data:t.value};if(!n.common.issues.length)throw new Error("Validation failed but no issues detected.");return{success:!1,get error(){if(this._error)return this._error;const e=new _e(n.common.issues);return this._error=e,this._error}}};function mt(n){if(!n)return{};const{errorMap:t,invalid_type_error:e,required_error:r,description:o}=n;if(t&&(e||r))throw new Error(`Can't use "invalid_type_error" or "required_error" in conjunction with custom error map.`);return t?{errorMap:t,description:o}:{errorMap:(l,f)=>{var c,d;const{message:p}=n;return l.code==="invalid_enum_value"?{message:p??f.defaultError}:typeof f.data>"u"?{message:(c=p??r)!==null&&c!==void 0?c:f.defaultError}:l.code!=="invalid_type"?{message:f.defaultError}:{message:(d=p??e)!==null&&d!==void 0?d:f.defaultError}},description:o}}class _t{constructor(t){this.spa=this.safeParseAsync,this._def=t,this.parse=this.parse.bind(this),this.safeParse=this.safeParse.bind(this),this.parseAsync=this.parseAsync.bind(this),this.safeParseAsync=this.safeParseAsync.bind(this),this.spa=this.spa.bind(this),this.refine=this.refine.bind(this),this.refinement=this.refinement.bind(this),this.superRefine=this.superRefine.bind(this),this.optional=this.optional.bind(this),this.nullable=this.nullable.bind(this),this.nullish=this.nullish.bind(this),this.array=this.array.bind(this),this.promise=this.promise.bind(this),this.or=this.or.bind(this),this.and=this.and.bind(this),this.transform=this.transform.bind(this),this.brand=this.brand.bind(this),this.default=this.default.bind(this),this.catch=this.catch.bind(this),this.describe=this.describe.bind(this),this.pipe=this.pipe.bind(this),this.readonly=this.readonly.bind(this),this.isNullable=this.isNullable.bind(this),this.isOptional=this.isOptional.bind(this)}get description(){return this._def.description}_getType(t){return yn(t.data)}_getOrReturnCtx(t,e){return e||{common:t.parent.common,data:t.data,parsedType:yn(t.data),schemaErrorMap:this._def.errorMap,path:t.path,parent:t.parent}}_processInputParams(t){return{status:new ie,ctx:{common:t.parent.common,data:t.data,parsedType:yn(t.data),schemaErrorMap:this._def.errorMap,path:t.path,parent:t.parent}}}_parseSync(t){const e=this._parse(t);if(ti(e))throw new Error("Synchronous parse encountered promise.");return e}_parseAsync(t){const e=this._parse(t);return Promise.resolve(e)}parse(t,e){const r=this.safeParse(t,e);if(r.success)return r.data;throw r.error}safeParse(t,e){var r;const o={common:{issues:[],async:(r=e?.async)!==null&&r!==void 0?r:!1,contextualErrorMap:e?.errorMap},path:e?.path||[],schemaErrorMap:this._def.errorMap,parent:null,data:t,parsedType:yn(t)},l=this._parseSync({data:t,path:o.path,parent:o});return Zl(o,l)}async parseAsync(t,e){const r=await this.safeParseAsync(t,e);if(r.success)return r.data;throw r.error}async safeParseAsync(t,e){const r={common:{issues:[],contextualErrorMap:e?.errorMap,async:!0},path:e?.path||[],schemaErrorMap:this._def.errorMap,parent:null,data:t,parsedType:yn(t)},o=this._parse({data:t,path:r.path,parent:r}),l=await(ti(o)?o:Promise.resolve(o));return Zl(r,l)}refine(t,e){const r=o=>typeof e=="string"||typeof e>"u"?{message:e}:typeof e=="function"?e(o):e;return this._refinement((o,l)=>{const f=t(o),c=()=>l.addIssue({code:W.custom,...r(o)});return typeof Promise<"u"&&f instanceof Promise?f.then(d=>d?!0:(c(),!1)):f?!0:(c(),!1)})}refinement(t,e){return this._refinement((r,o)=>t(r)?!0:(o.addIssue(typeof e=="function"?e(r,o):e),!1))}_refinement(t){return new Be({schema:this,typeName:ct.ZodEffects,effect:{type:"refinement",refinement:t}})}superRefine(t){return this._refinement(t)}optional(){return We.create(this,this._def)}nullable(){return kn.create(this,this._def)}nullish(){return this.nullable().optional()}array(){return Ge.create(this,this._def)}promise(){return vr.create(this,this._def)}or(t){return ii.create([this,t],this._def)}and(t){return si.create(this,t,this._def)}transform(t){return new Be({...mt(this._def),schema:this,typeName:ct.ZodEffects,effect:{type:"transform",transform:t}})}default(t){const e=typeof t=="function"?t:()=>t;return new hi({...mt(this._def),innerType:this,defaultValue:e,typeName:ct.ZodDefault})}brand(){return new Ya({typeName:ct.ZodBranded,type:this,...mt(this._def)})}catch(t){const e=typeof t=="function"?t:()=>t;return new ci({...mt(this._def),innerType:this,catchValue:e,typeName:ct.ZodCatch})}describe(t){const e=this.constructor;return new e({...this._def,description:t})}pipe(t){return _i.create(this,t)}readonly(){return fi.create(this)}isOptional(){return this.safeParse(void 0).success}isNullable(){return this.safeParse(null).success}}const kv=/^c[^\s-]{8,}$/i,Iv=/^[0-9a-z]+$/,Tv=/^[0-9A-HJKMNP-TV-Z]{26}$/,Mv=/^[0-9a-fA-F]{8}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{12}$/i,bv=/^[a-z0-9_-]{21}$/i,Nv=/^[-+]?P(?!$)(?:(?:[-+]?\d+Y)|(?:[-+]?\d+[.,]\d+Y$))?(?:(?:[-+]?\d+M)|(?:[-+]?\d+[.,]\d+M$))?(?:(?:[-+]?\d+W)|(?:[-+]?\d+[.,]\d+W$))?(?:(?:[-+]?\d+D)|(?:[-+]?\d+[.,]\d+D$))?(?:T(?=[\d+-])(?:(?:[-+]?\d+H)|(?:[-+]?\d+[.,]\d+H$))?(?:(?:[-+]?\d+M)|(?:[-+]?\d+[.,]\d+M$))?(?:[-+]?\d+(?:[.,]\d+)?S)?)??$/,Sv=/^(?!\.)(?!.*\.\.)([A-Z0-9_'+\-\.]*)[A-Z0-9_+-]@([A-Z0-9][A-Z0-9\-]*\.)+[A-Z]{2,}$/i,Rv="^(\\p{Extended_Pictographic}|\\p{Emoji_Component})+$";let zo;const Cv=/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])$/,Pv=/^(([a-f0-9]{1,4}:){7}|::([a-f0-9]{1,4}:){0,6}|([a-f0-9]{1,4}:){1}:([a-f0-9]{1,4}:){0,5}|([a-f0-9]{1,4}:){2}:([a-f0-9]{1,4}:){0,4}|([a-f0-9]{1,4}:){3}:([a-f0-9]{1,4}:){0,3}|([a-f0-9]{1,4}:){4}:([a-f0-9]{1,4}:){0,2}|([a-f0-9]{1,4}:){5}:([a-f0-9]{1,4}:){0,1})([a-f0-9]{1,4}|(((25[0-5])|(2[0-4][0-9])|(1[0-9]{2})|([0-9]{1,2}))\.){3}((25[0-5])|(2[0-4][0-9])|(1[0-9]{2})|([0-9]{1,2})))$/,Lv=/^([0-9a-zA-Z+/]{4})*(([0-9a-zA-Z+/]{2}==)|([0-9a-zA-Z+/]{3}=))?$/,qc="((\\d\\d[2468][048]|\\d\\d[13579][26]|\\d\\d0[48]|[02468][048]00|[13579][26]00)-02-29|\\d{4}-((0[13578]|1[02])-(0[1-9]|[12]\\d|3[01])|(0[469]|11)-(0[1-9]|[12]\\d|30)|(02)-(0[1-9]|1\\d|2[0-8])))",Av=new RegExp(`^${qc}$`);function Uc(n){let t="([01]\\d|2[0-3]):[0-5]\\d:[0-5]\\d";return n.precision?t=`${t}\\.\\d{${n.precision}}`:n.precision==null&&(t=`${t}(\\.\\d+)?`),t}function Ov(n){return new RegExp(`^${Uc(n)}$`)}function jc(n){let t=`${qc}T${Uc(n)}`;const e=[];return e.push(n.local?"Z?":"Z"),n.offset&&e.push("([+-]\\d{2}:?\\d{2})"),t=`${t}(${e.join("|")})`,new RegExp(`^${t}$`)}function Dv(n,t){return!!((t==="v4"||!t)&&Cv.test(n)||(t==="v6"||!t)&&Pv.test(n))}class De extends _t{_parse(t){if(this._def.coerce&&(t.data=String(t.data)),this._getType(t)!==nt.string){const o=this._getOrReturnCtx(t);return et(o,{code:W.invalid_type,expected:nt.string,received:o.parsedType}),gt}const e=new ie;let r;for(const o of this._def.checks)if(o.kind==="min")t.data.length<o.value&&(r=this._getOrReturnCtx(t,r),et(r,{code:W.too_small,minimum:o.value,type:"string",inclusive:!0,exact:!1,message:o.message}),e.dirty());else if(o.kind==="max")t.data.length>o.value&&(r=this._getOrReturnCtx(t,r),et(r,{code:W.too_big,maximum:o.value,type:"string",inclusive:!0,exact:!1,message:o.message}),e.dirty());else if(o.kind==="length"){const l=t.data.length>o.value,f=t.data.length<o.value;(l||f)&&(r=this._getOrReturnCtx(t,r),l?et(r,{code:W.too_big,maximum:o.value,type:"string",inclusive:!0,exact:!0,message:o.message}):f&&et(r,{code:W.too_small,minimum:o.value,type:"string",inclusive:!0,exact:!0,message:o.message}),e.dirty())}else if(o.kind==="email")Sv.test(t.data)||(r=this._getOrReturnCtx(t,r),et(r,{validation:"email",code:W.invalid_string,message:o.message}),e.dirty());else if(o.kind==="emoji")zo||(zo=new RegExp(Rv,"u")),zo.test(t.data)||(r=this._getOrReturnCtx(t,r),et(r,{validation:"emoji",code:W.invalid_string,message:o.message}),e.dirty());else if(o.kind==="uuid")Mv.test(t.data)||(r=this._getOrReturnCtx(t,r),et(r,{validation:"uuid",code:W.invalid_string,message:o.message}),e.dirty());else if(o.kind==="nanoid")bv.test(t.data)||(r=this._getOrReturnCtx(t,r),et(r,{validation:"nanoid",code:W.invalid_string,message:o.message}),e.dirty());else if(o.kind==="cuid")kv.test(t.data)||(r=this._getOrReturnCtx(t,r),et(r,{validation:"cuid",code:W.invalid_string,message:o.message}),e.dirty());else if(o.kind==="cuid2")Iv.test(t.data)||(r=this._getOrReturnCtx(t,r),et(r,{validation:"cuid2",code:W.invalid_string,message:o.message}),e.dirty());else if(o.kind==="ulid")Tv.test(t.data)||(r=this._getOrReturnCtx(t,r),et(r,{validation:"ulid",code:W.invalid_string,message:o.message}),e.dirty());else if(o.kind==="url")try{new URL(t.data)}catch{r=this._getOrReturnCtx(t,r),et(r,{validation:"url",code:W.invalid_string,message:o.message}),e.dirty()}else o.kind==="regex"?(o.regex.lastIndex=0,o.regex.test(t.data)||(r=this._getOrReturnCtx(t,r),et(r,{validation:"regex",code:W.invalid_string,message:o.message}),e.dirty())):o.kind==="trim"?t.data=t.data.trim():o.kind==="includes"?t.data.includes(o.value,o.position)||(r=this._getOrReturnCtx(t,r),et(r,{code:W.invalid_string,validation:{includes:o.value,position:o.position},message:o.message}),e.dirty()):o.kind==="toLowerCase"?t.data=t.data.toLowerCase():o.kind==="toUpperCase"?t.data=t.data.toUpperCase():o.kind==="startsWith"?t.data.startsWith(o.value)||(r=this._getOrReturnCtx(t,r),et(r,{code:W.invalid_string,validation:{startsWith:o.value},message:o.message}),e.dirty()):o.kind==="endsWith"?t.data.endsWith(o.value)||(r=this._getOrReturnCtx(t,r),et(r,{code:W.invalid_string,validation:{endsWith:o.value},message:o.message}),e.dirty()):o.kind==="datetime"?jc(o).test(t.data)||(r=this._getOrReturnCtx(t,r),et(r,{code:W.invalid_string,validation:"datetime",message:o.message}),e.dirty()):o.kind==="date"?Av.test(t.data)||(r=this._getOrReturnCtx(t,r),et(r,{code:W.invalid_string,validation:"date",message:o.message}),e.dirty()):o.kind==="time"?Ov(o).test(t.data)||(r=this._getOrReturnCtx(t,r),et(r,{code:W.invalid_string,validation:"time",message:o.message}),e.dirty()):o.kind==="duration"?Nv.test(t.data)||(r=this._getOrReturnCtx(t,r),et(r,{validation:"duration",code:W.invalid_string,message:o.message}),e.dirty()):o.kind==="ip"?Dv(t.data,o.version)||(r=this._getOrReturnCtx(t,r),et(r,{validation:"ip",code:W.invalid_string,message:o.message}),e.dirty()):o.kind==="base64"?Lv.test(t.data)||(r=this._getOrReturnCtx(t,r),et(r,{validation:"base64",code:W.invalid_string,message:o.message}),e.dirty()):St.assertNever(o);return{status:e.value,value:t.data}}_regex(t,e,r){return this.refinement(o=>t.test(o),{validation:e,code:W.invalid_string,...ut.errToObj(r)})}_addCheck(t){return new De({...this._def,checks:[...this._def.checks,t]})}email(t){return this._addCheck({kind:"email",...ut.errToObj(t)})}url(t){return this._addCheck({kind:"url",...ut.errToObj(t)})}emoji(t){return this._addCheck({kind:"emoji",...ut.errToObj(t)})}uuid(t){return this._addCheck({kind:"uuid",...ut.errToObj(t)})}nanoid(t){return this._addCheck({kind:"nanoid",...ut.errToObj(t)})}cuid(t){return this._addCheck({kind:"cuid",...ut.errToObj(t)})}cuid2(t){return this._addCheck({kind:"cuid2",...ut.errToObj(t)})}ulid(t){return this._addCheck({kind:"ulid",...ut.errToObj(t)})}base64(t){return this._addCheck({kind:"base64",...ut.errToObj(t)})}ip(t){return this._addCheck({kind:"ip",...ut.errToObj(t)})}datetime(t){var e,r;return typeof t=="string"?this._addCheck({kind:"datetime",precision:null,offset:!1,local:!1,message:t}):this._addCheck({kind:"datetime",precision:typeof t?.precision>"u"?null:t?.precision,offset:(e=t?.offset)!==null&&e!==void 0?e:!1,local:(r=t?.local)!==null&&r!==void 0?r:!1,...ut.errToObj(t?.message)})}date(t){return this._addCheck({kind:"date",message:t})}time(t){return typeof t=="string"?this._addCheck({kind:"time",precision:null,message:t}):this._addCheck({kind:"time",precision:typeof t?.precision>"u"?null:t?.precision,...ut.errToObj(t?.message)})}duration(t){return this._addCheck({kind:"duration",...ut.errToObj(t)})}regex(t,e){return this._addCheck({kind:"regex",regex:t,...ut.errToObj(e)})}includes(t,e){return this._addCheck({kind:"includes",value:t,position:e?.position,...ut.errToObj(e?.message)})}startsWith(t,e){return this._addCheck({kind:"startsWith",value:t,...ut.errToObj(e)})}endsWith(t,e){return this._addCheck({kind:"endsWith",value:t,...ut.errToObj(e)})}min(t,e){return this._addCheck({kind:"min",value:t,...ut.errToObj(e)})}max(t,e){return this._addCheck({kind:"max",value:t,...ut.errToObj(e)})}length(t,e){return this._addCheck({kind:"length",value:t,...ut.errToObj(e)})}nonempty(t){return this.min(1,ut.errToObj(t))}trim(){return new De({...this._def,checks:[...this._def.checks,{kind:"trim"}]})}toLowerCase(){return new De({...this._def,checks:[...this._def.checks,{kind:"toLowerCase"}]})}toUpperCase(){return new De({...this._def,checks:[...this._def.checks,{kind:"toUpperCase"}]})}get isDatetime(){return!!this._def.checks.find(t=>t.kind==="datetime")}get isDate(){return!!this._def.checks.find(t=>t.kind==="date")}get isTime(){return!!this._def.checks.find(t=>t.kind==="time")}get isDuration(){return!!this._def.checks.find(t=>t.kind==="duration")}get isEmail(){return!!this._def.checks.find(t=>t.kind==="email")}get isURL(){return!!this._def.checks.find(t=>t.kind==="url")}get isEmoji(){return!!this._def.checks.find(t=>t.kind==="emoji")}get isUUID(){return!!this._def.checks.find(t=>t.kind==="uuid")}get isNANOID(){return!!this._def.checks.find(t=>t.kind==="nanoid")}get isCUID(){return!!this._def.checks.find(t=>t.kind==="cuid")}get isCUID2(){return!!this._def.checks.find(t=>t.kind==="cuid2")}get isULID(){return!!this._def.checks.find(t=>t.kind==="ulid")}get isIP(){return!!this._def.checks.find(t=>t.kind==="ip")}get isBase64(){return!!this._def.checks.find(t=>t.kind==="base64")}get minLength(){let t=null;for(const e of this._def.checks)e.kind==="min"&&(t===null||e.value>t)&&(t=e.value);return t}get maxLength(){let t=null;for(const e of this._def.checks)e.kind==="max"&&(t===null||e.value<t)&&(t=e.value);return t}}De.create=n=>{var t;return new De({checks:[],typeName:ct.ZodString,coerce:(t=n?.coerce)!==null&&t!==void 0?t:!1,...mt(n)})};function Fv(n,t){const e=(n.toString().split(".")[1]||"").length,r=(t.toString().split(".")[1]||"").length,o=e>r?e:r,l=parseInt(n.toFixed(o).replace(".","")),f=parseInt(t.toFixed(o).replace(".",""));return l%f/Math.pow(10,o)}class wn extends _t{constructor(){super(...arguments),this.min=this.gte,this.max=this.lte,this.step=this.multipleOf}_parse(t){if(this._def.coerce&&(t.data=Number(t.data)),this._getType(t)!==nt.number){const o=this._getOrReturnCtx(t);return et(o,{code:W.invalid_type,expected:nt.number,received:o.parsedType}),gt}let e;const r=new ie;for(const o of this._def.checks)o.kind==="int"?St.isInteger(t.data)||(e=this._getOrReturnCtx(t,e),et(e,{code:W.invalid_type,expected:"integer",received:"float",message:o.message}),r.dirty()):o.kind==="min"?(o.inclusive?t.data<o.value:t.data<=o.value)&&(e=this._getOrReturnCtx(t,e),et(e,{code:W.too_small,minimum:o.value,type:"number",inclusive:o.inclusive,exact:!1,message:o.message}),r.dirty()):o.kind==="max"?(o.inclusive?t.data>o.value:t.data>=o.value)&&(e=this._getOrReturnCtx(t,e),et(e,{code:W.too_big,maximum:o.value,type:"number",inclusive:o.inclusive,exact:!1,message:o.message}),r.dirty()):o.kind==="multipleOf"?Fv(t.data,o.value)!==0&&(e=this._getOrReturnCtx(t,e),et(e,{code:W.not_multiple_of,multipleOf:o.value,message:o.message}),r.dirty()):o.kind==="finite"?Number.isFinite(t.data)||(e=this._getOrReturnCtx(t,e),et(e,{code:W.not_finite,message:o.message}),r.dirty()):St.assertNever(o);return{status:r.value,value:t.data}}gte(t,e){return this.setLimit("min",t,!0,ut.toString(e))}gt(t,e){return this.setLimit("min",t,!1,ut.toString(e))}lte(t,e){return this.setLimit("max",t,!0,ut.toString(e))}lt(t,e){return this.setLimit("max",t,!1,ut.toString(e))}setLimit(t,e,r,o){return new wn({...this._def,checks:[...this._def.checks,{kind:t,value:e,inclusive:r,message:ut.toString(o)}]})}_addCheck(t){return new wn({...this._def,checks:[...this._def.checks,t]})}int(t){return this._addCheck({kind:"int",message:ut.toString(t)})}positive(t){return this._addCheck({kind:"min",value:0,inclusive:!1,message:ut.toString(t)})}negative(t){return this._addCheck({kind:"max",value:0,inclusive:!1,message:ut.toString(t)})}nonpositive(t){return this._addCheck({kind:"max",value:0,inclusive:!0,message:ut.toString(t)})}nonnegative(t){return this._addCheck({kind:"min",value:0,inclusive:!0,message:ut.toString(t)})}multipleOf(t,e){return this._addCheck({kind:"multipleOf",value:t,message:ut.toString(e)})}finite(t){return this._addCheck({kind:"finite",message:ut.toString(t)})}safe(t){return this._addCheck({kind:"min",inclusive:!0,value:Number.MIN_SAFE_INTEGER,message:ut.toString(t)})._addCheck({kind:"max",inclusive:!0,value:Number.MAX_SAFE_INTEGER,message:ut.toString(t)})}get minValue(){let t=null;for(const e of this._def.checks)e.kind==="min"&&(t===null||e.value>t)&&(t=e.value);return t}get maxValue(){let t=null;for(const e of this._def.checks)e.kind==="max"&&(t===null||e.value<t)&&(t=e.value);return t}get isInt(){return!!this._def.checks.find(t=>t.kind==="int"||t.kind==="multipleOf"&&St.isInteger(t.value))}get isFinite(){let t=null,e=null;for(const r of this._def.checks){if(r.kind==="finite"||r.kind==="int"||r.kind==="multipleOf")return!0;r.kind==="min"?(e===null||r.value>e)&&(e=r.value):r.kind==="max"&&(t===null||r.value<t)&&(t=r.value)}return Number.isFinite(e)&&Number.isFinite(t)}}wn.create=n=>new wn({checks:[],typeName:ct.ZodNumber,coerce:n?.coerce||!1,...mt(n)});class xn extends _t{constructor(){super(...arguments),this.min=this.gte,this.max=this.lte}_parse(t){if(this._def.coerce&&(t.data=BigInt(t.data)),this._getType(t)!==nt.bigint){const o=this._getOrReturnCtx(t);return et(o,{code:W.invalid_type,expected:nt.bigint,received:o.parsedType}),gt}let e;const r=new ie;for(const o of this._def.checks)o.kind==="min"?(o.inclusive?t.data<o.value:t.data<=o.value)&&(e=this._getOrReturnCtx(t,e),et(e,{code:W.too_small,type:"bigint",minimum:o.value,inclusive:o.inclusive,message:o.message}),r.dirty()):o.kind==="max"?(o.inclusive?t.data>o.value:t.data>=o.value)&&(e=this._getOrReturnCtx(t,e),et(e,{code:W.too_big,type:"bigint",maximum:o.value,inclusive:o.inclusive,message:o.message}),r.dirty()):o.kind==="multipleOf"?t.data%o.value!==BigInt(0)&&(e=this._getOrReturnCtx(t,e),et(e,{code:W.not_multiple_of,multipleOf:o.value,message:o.message}),r.dirty()):St.assertNever(o);return{status:r.value,value:t.data}}gte(t,e){return this.setLimit("min",t,!0,ut.toString(e))}gt(t,e){return this.setLimit("min",t,!1,ut.toString(e))}lte(t,e){return this.setLimit("max",t,!0,ut.toString(e))}lt(t,e){return this.setLimit("max",t,!1,ut.toString(e))}setLimit(t,e,r,o){return new xn({...this._def,checks:[...this._def.checks,{kind:t,value:e,inclusive:r,message:ut.toString(o)}]})}_addCheck(t){return new xn({...this._def,checks:[...this._def.checks,t]})}positive(t){return this._addCheck({kind:"min",value:BigInt(0),inclusive:!1,message:ut.toString(t)})}negative(t){return this._addCheck({kind:"max",value:BigInt(0),inclusive:!1,message:ut.toString(t)})}nonpositive(t){return this._addCheck({kind:"max",value:BigInt(0),inclusive:!0,message:ut.toString(t)})}nonnegative(t){return this._addCheck({kind:"min",value:BigInt(0),inclusive:!0,message:ut.toString(t)})}multipleOf(t,e){return this._addCheck({kind:"multipleOf",value:t,message:ut.toString(e)})}get minValue(){let t=null;for(const e of this._def.checks)e.kind==="min"&&(t===null||e.value>t)&&(t=e.value);return t}get maxValue(){let t=null;for(const e of this._def.checks)e.kind==="max"&&(t===null||e.value<t)&&(t=e.value);return t}}xn.create=n=>{var t;return new xn({checks:[],typeName:ct.ZodBigInt,coerce:(t=n?.coerce)!==null&&t!==void 0?t:!1,...mt(n)})};class ei extends _t{_parse(t){if(this._def.coerce&&(t.data=!!t.data),this._getType(t)!==nt.boolean){const e=this._getOrReturnCtx(t);return et(e,{code:W.invalid_type,expected:nt.boolean,received:e.parsedType}),gt}return ue(t.data)}}ei.create=n=>new ei({typeName:ct.ZodBoolean,coerce:n?.coerce||!1,...mt(n)});class Bn extends _t{_parse(t){if(this._def.coerce&&(t.data=new Date(t.data)),this._getType(t)!==nt.date){const o=this._getOrReturnCtx(t);return et(o,{code:W.invalid_type,expected:nt.date,received:o.parsedType}),gt}if(isNaN(t.data.getTime())){const o=this._getOrReturnCtx(t);return et(o,{code:W.invalid_date}),gt}const e=new ie;let r;for(const o of this._def.checks)o.kind==="min"?t.data.getTime()<o.value&&(r=this._getOrReturnCtx(t,r),et(r,{code:W.too_small,message:o.message,inclusive:!0,exact:!1,minimum:o.value,type:"date"}),e.dirty()):o.kind==="max"?t.data.getTime()>o.value&&(r=this._getOrReturnCtx(t,r),et(r,{code:W.too_big,message:o.message,inclusive:!0,exact:!1,maximum:o.value,type:"date"}),e.dirty()):St.assertNever(o);return{status:e.value,value:new Date(t.data.getTime())}}_addCheck(t){return new Bn({...this._def,checks:[...this._def.checks,t]})}min(t,e){return this._addCheck({kind:"min",value:t.getTime(),message:ut.toString(e)})}max(t,e){return this._addCheck({kind:"max",value:t.getTime(),message:ut.toString(e)})}get minDate(){let t=null;for(const e of this._def.checks)e.kind==="min"&&(t===null||e.value>t)&&(t=e.value);return t!=null?new Date(t):null}get maxDate(){let t=null;for(const e of this._def.checks)e.kind==="max"&&(t===null||e.value<t)&&(t=e.value);return t!=null?new Date(t):null}}Bn.create=n=>new Bn({checks:[],coerce:n?.coerce||!1,typeName:ct.ZodDate,...mt(n)});class Ls extends _t{_parse(t){if(this._getType(t)!==nt.symbol){const e=this._getOrReturnCtx(t);return et(e,{code:W.invalid_type,expected:nt.symbol,received:e.parsedType}),gt}return ue(t.data)}}Ls.create=n=>new Ls({typeName:ct.ZodSymbol,...mt(n)});class ni extends _t{_parse(t){if(this._getType(t)!==nt.undefined){const e=this._getOrReturnCtx(t);return et(e,{code:W.invalid_type,expected:nt.undefined,received:e.parsedType}),gt}return ue(t.data)}}ni.create=n=>new ni({typeName:ct.ZodUndefined,...mt(n)});class ri extends _t{_parse(t){if(this._getType(t)!==nt.null){const e=this._getOrReturnCtx(t);return et(e,{code:W.invalid_type,expected:nt.null,received:e.parsedType}),gt}return ue(t.data)}}ri.create=n=>new ri({typeName:ct.ZodNull,...mt(n)});class mr extends _t{constructor(){super(...arguments),this._any=!0}_parse(t){return ue(t.data)}}mr.create=n=>new mr({typeName:ct.ZodAny,...mt(n)});class Dn extends _t{constructor(){super(...arguments),this._unknown=!0}_parse(t){return ue(t.data)}}Dn.create=n=>new Dn({typeName:ct.ZodUnknown,...mt(n)});class gn extends _t{_parse(t){const e=this._getOrReturnCtx(t);return et(e,{code:W.invalid_type,expected:nt.never,received:e.parsedType}),gt}}gn.create=n=>new gn({typeName:ct.ZodNever,...mt(n)});class As extends _t{_parse(t){if(this._getType(t)!==nt.undefined){const e=this._getOrReturnCtx(t);return et(e,{code:W.invalid_type,expected:nt.void,received:e.parsedType}),gt}return ue(t.data)}}As.create=n=>new As({typeName:ct.ZodVoid,...mt(n)});class Ge extends _t{_parse(t){const{ctx:e,status:r}=this._processInputParams(t),o=this._def;if(e.parsedType!==nt.array)return et(e,{code:W.invalid_type,expected:nt.array,received:e.parsedType}),gt;if(o.exactLength!==null){const f=e.data.length>o.exactLength.value,c=e.data.length<o.exactLength.value;(f||c)&&(et(e,{code:f?W.too_big:W.too_small,minimum:c?o.exactLength.value:void 0,maximum:f?o.exactLength.value:void 0,type:"array",inclusive:!0,exact:!0,message:o.exactLength.message}),r.dirty())}if(o.minLength!==null&&e.data.length<o.minLength.value&&(et(e,{code:W.too_small,minimum:o.minLength.value,type:"array",inclusive:!0,exact:!1,message:o.minLength.message}),r.dirty()),o.maxLength!==null&&e.data.length>o.maxLength.value&&(et(e,{code:W.too_big,maximum:o.maxLength.value,type:"array",inclusive:!0,exact:!1,message:o.maxLength.message}),r.dirty()),e.common.async)return Promise.all([...e.data].map((f,c)=>o.type._parseAsync(new Ze(e,f,e.path,c)))).then(f=>ie.mergeArray(r,f));const l=[...e.data].map((f,c)=>o.type._parseSync(new Ze(e,f,e.path,c)));return ie.mergeArray(r,l)}get element(){return this._def.type}min(t,e){return new Ge({...this._def,minLength:{value:t,message:ut.toString(e)}})}max(t,e){return new Ge({...this._def,maxLength:{value:t,message:ut.toString(e)}})}length(t,e){return new Ge({...this._def,exactLength:{value:t,message:ut.toString(e)}})}nonempty(t){return this.min(1,t)}}Ge.create=(n,t)=>new Ge({type:n,minLength:null,maxLength:null,exactLength:null,typeName:ct.ZodArray,...mt(t)});function ir(n){if(n instanceof Ut){const t={};for(const e in n.shape){const r=n.shape[e];t[e]=We.create(ir(r))}return new Ut({...n._def,shape:()=>t})}else return n instanceof Ge?new Ge({...n._def,type:ir(n.element)}):n instanceof We?We.create(ir(n.unwrap())):n instanceof kn?kn.create(ir(n.unwrap())):n instanceof He?He.create(n.items.map(t=>ir(t))):n}class Ut extends _t{constructor(){super(...arguments),this._cached=null,this.nonstrict=this.passthrough,this.augment=this.extend}_getCached(){if(this._cached!==null)return this._cached;const t=this._def.shape(),e=St.objectKeys(t);return this._cached={shape:t,keys:e}}_parse(t){if(this._getType(t)!==nt.object){const d=this._getOrReturnCtx(t);return et(d,{code:W.invalid_type,expected:nt.object,received:d.parsedType}),gt}const{status:e,ctx:r}=this._processInputParams(t),{shape:o,keys:l}=this._getCached(),f=[];if(!(this._def.catchall instanceof gn&&this._def.unknownKeys==="strip"))for(const d in r.data)l.includes(d)||f.push(d);const c=[];for(const d of l){const p=o[d],v=r.data[d];c.push({key:{status:"valid",value:d},value:p._parse(new Ze(r,v,r.path,d)),alwaysSet:d in r.data})}if(this._def.catchall instanceof gn){const d=this._def.unknownKeys;if(d==="passthrough")for(const p of f)c.push({key:{status:"valid",value:p},value:{status:"valid",value:r.data[p]}});else if(d==="strict")f.length>0&&(et(r,{code:W.unrecognized_keys,keys:f}),e.dirty());else if(d!=="strip")throw new Error("Internal ZodObject error: invalid unknownKeys value.")}else{const d=this._def.catchall;for(const p of f){const v=r.data[p];c.push({key:{status:"valid",value:p},value:d._parse(new Ze(r,v,r.path,p)),alwaysSet:p in r.data})}}return r.common.async?Promise.resolve().then(async()=>{const d=[];for(const p of c){const v=await p.key,y=await p.value;d.push({key:v,value:y,alwaysSet:p.alwaysSet})}return d}).then(d=>ie.mergeObjectSync(e,d)):ie.mergeObjectSync(e,c)}get shape(){return this._def.shape()}strict(t){return ut.errToObj,new Ut({...this._def,unknownKeys:"strict",...t!==void 0?{errorMap:(e,r)=>{var o,l,f,c;const d=(f=(l=(o=this._def).errorMap)===null||l===void 0?void 0:l.call(o,e,r).message)!==null&&f!==void 0?f:r.defaultError;return e.code==="unrecognized_keys"?{message:(c=ut.errToObj(t).message)!==null&&c!==void 0?c:d}:{message:d}}}:{}})}strip(){return new Ut({...this._def,unknownKeys:"strip"})}passthrough(){return new Ut({...this._def,unknownKeys:"passthrough"})}extend(t){return new Ut({...this._def,shape:()=>({...this._def.shape(),...t})})}merge(t){return new Ut({unknownKeys:t._def.unknownKeys,catchall:t._def.catchall,shape:()=>({...this._def.shape(),...t._def.shape()}),typeName:ct.ZodObject})}setKey(t,e){return this.augment({[t]:e})}catchall(t){return new Ut({...this._def,catchall:t})}pick(t){const e={};return St.objectKeys(t).forEach(r=>{t[r]&&this.shape[r]&&(e[r]=this.shape[r])}),new Ut({...this._def,shape:()=>e})}omit(t){const e={};return St.objectKeys(this.shape).forEach(r=>{t[r]||(e[r]=this.shape[r])}),new Ut({...this._def,shape:()=>e})}deepPartial(){return ir(this)}partial(t){const e={};return St.objectKeys(this.shape).forEach(r=>{const o=this.shape[r];t&&!t[r]?e[r]=o:e[r]=o.optional()}),new Ut({...this._def,shape:()=>e})}required(t){const e={};return St.objectKeys(this.shape).forEach(r=>{if(t&&!t[r])e[r]=this.shape[r];else{let o=this.shape[r];for(;o instanceof We;)o=o._def.innerType;e[r]=o}}),new Ut({...this._def,shape:()=>e})}keyof(){return Vc(St.objectKeys(this.shape))}}Ut.create=(n,t)=>new Ut({shape:()=>n,unknownKeys:"strip",catchall:gn.create(),typeName:ct.ZodObject,...mt(t)});Ut.strictCreate=(n,t)=>new Ut({shape:()=>n,unknownKeys:"strict",catchall:gn.create(),typeName:ct.ZodObject,...mt(t)});Ut.lazycreate=(n,t)=>new Ut({shape:n,unknownKeys:"strip",catchall:gn.create(),typeName:ct.ZodObject,...mt(t)});class ii extends _t{_parse(t){const{ctx:e}=this._processInputParams(t),r=this._def.options;function o(l){for(const c of l)if(c.result.status==="valid")return c.result;for(const c of l)if(c.result.status==="dirty")return e.common.issues.push(...c.ctx.common.issues),c.result;const f=l.map(c=>new _e(c.ctx.common.issues));return et(e,{code:W.invalid_union,unionErrors:f}),gt}if(e.common.async)return Promise.all(r.map(async l=>{const f={...e,common:{...e.common,issues:[]},parent:null};return{result:await l._parseAsync({data:e.data,path:e.path,parent:f}),ctx:f}})).then(o);{let l;const f=[];for(const d of r){const p={...e,common:{...e.common,issues:[]},parent:null},v=d._parseSync({data:e.data,path:e.path,parent:p});if(v.status==="valid")return v;v.status==="dirty"&&!l&&(l={result:v,ctx:p}),p.common.issues.length&&f.push(p.common.issues)}if(l)return e.common.issues.push(...l.ctx.common.issues),l.result;const c=f.map(d=>new _e(d));return et(e,{code:W.invalid_union,unionErrors:c}),gt}}get options(){return this._def.options}}ii.create=(n,t)=>new ii({options:n,typeName:ct.ZodUnion,...mt(t)});const vn=n=>n instanceof ai?vn(n.schema):n instanceof Be?vn(n.innerType()):n instanceof ui?[n.value]:n instanceof En?n.options:n instanceof li?St.objectValues(n.enum):n instanceof hi?vn(n._def.innerType):n instanceof ni?[void 0]:n instanceof ri?[null]:n instanceof We?[void 0,...vn(n.unwrap())]:n instanceof kn?[null,...vn(n.unwrap())]:n instanceof Ya||n instanceof fi?vn(n.unwrap()):n instanceof ci?vn(n._def.innerType):[];class Hs extends _t{_parse(t){const{ctx:e}=this._processInputParams(t);if(e.parsedType!==nt.object)return et(e,{code:W.invalid_type,expected:nt.object,received:e.parsedType}),gt;const r=this.discriminator,o=e.data[r],l=this.optionsMap.get(o);return l?e.common.async?l._parseAsync({data:e.data,path:e.path,parent:e}):l._parseSync({data:e.data,path:e.path,parent:e}):(et(e,{code:W.invalid_union_discriminator,options:Array.from(this.optionsMap.keys()),path:[r]}),gt)}get discriminator(){return this._def.discriminator}get options(){return this._def.options}get optionsMap(){return this._def.optionsMap}static create(t,e,r){const o=new Map;for(const l of e){const f=vn(l.shape[t]);if(!f.length)throw new Error(`A discriminator value for key \`${t}\` could not be extracted from all schema options`);for(const c of f){if(o.has(c))throw new Error(`Discriminator property ${String(t)} has duplicate value ${String(c)}`);o.set(c,l)}}return new Hs({typeName:ct.ZodDiscriminatedUnion,discriminator:t,options:e,optionsMap:o,...mt(r)})}}function ma(n,t){const e=yn(n),r=yn(t);if(n===t)return{valid:!0,data:n};if(e===nt.object&&r===nt.object){const o=St.objectKeys(t),l=St.objectKeys(n).filter(c=>o.indexOf(c)!==-1),f={...n,...t};for(const c of l){const d=ma(n[c],t[c]);if(!d.valid)return{valid:!1};f[c]=d.data}return{valid:!0,data:f}}else if(e===nt.array&&r===nt.array){if(n.length!==t.length)return{valid:!1};const o=[];for(let l=0;l<n.length;l++){const f=n[l],c=t[l],d=ma(f,c);if(!d.valid)return{valid:!1};o.push(d.data)}return{valid:!0,data:o}}else return e===nt.date&&r===nt.date&&+n==+t?{valid:!0,data:n}:{valid:!1}}class si extends _t{_parse(t){const{status:e,ctx:r}=this._processInputParams(t),o=(l,f)=>{if(da(l)||da(f))return gt;const c=ma(l.value,f.value);return c.valid?((pa(l)||pa(f))&&e.dirty(),{status:e.value,value:c.data}):(et(r,{code:W.invalid_intersection_types}),gt)};return r.common.async?Promise.all([this._def.left._parseAsync({data:r.data,path:r.path,parent:r}),this._def.right._parseAsync({data:r.data,path:r.path,parent:r})]).then(([l,f])=>o(l,f)):o(this._def.left._parseSync({data:r.data,path:r.path,parent:r}),this._def.right._parseSync({data:r.data,path:r.path,parent:r}))}}si.create=(n,t,e)=>new si({left:n,right:t,typeName:ct.ZodIntersection,...mt(e)});class He extends _t{_parse(t){const{status:e,ctx:r}=this._processInputParams(t);if(r.parsedType!==nt.array)return et(r,{code:W.invalid_type,expected:nt.array,received:r.parsedType}),gt;if(r.data.length<this._def.items.length)return et(r,{code:W.too_small,minimum:this._def.items.length,inclusive:!0,exact:!1,type:"array"}),gt;!this._def.rest&&r.data.length>this._def.items.length&&(et(r,{code:W.too_big,maximum:this._def.items.length,inclusive:!0,exact:!1,type:"array"}),e.dirty());const o=[...r.data].map((l,f)=>{const c=this._def.items[f]||this._def.rest;return c?c._parse(new Ze(r,l,r.path,f)):null}).filter(l=>!!l);return r.common.async?Promise.all(o).then(l=>ie.mergeArray(e,l)):ie.mergeArray(e,o)}get items(){return this._def.items}rest(t){return new He({...this._def,rest:t})}}He.create=(n,t)=>{if(!Array.isArray(n))throw new Error("You must pass an array of schemas to z.tuple([ ... ])");return new He({items:n,typeName:ct.ZodTuple,rest:null,...mt(t)})};class oi extends _t{get keySchema(){return this._def.keyType}get valueSchema(){return this._def.valueType}_parse(t){const{status:e,ctx:r}=this._processInputParams(t);if(r.parsedType!==nt.object)return et(r,{code:W.invalid_type,expected:nt.object,received:r.parsedType}),gt;const o=[],l=this._def.keyType,f=this._def.valueType;for(const c in r.data)o.push({key:l._parse(new Ze(r,c,r.path,c)),value:f._parse(new Ze(r,r.data[c],r.path,c)),alwaysSet:c in r.data});return r.common.async?ie.mergeObjectAsync(e,o):ie.mergeObjectSync(e,o)}get element(){return this._def.valueType}static create(t,e,r){return e instanceof _t?new oi({keyType:t,valueType:e,typeName:ct.ZodRecord,...mt(r)}):new oi({keyType:De.create(),valueType:t,typeName:ct.ZodRecord,...mt(e)})}}class Os extends _t{get keySchema(){return this._def.keyType}get valueSchema(){return this._def.valueType}_parse(t){const{status:e,ctx:r}=this._processInputParams(t);if(r.parsedType!==nt.map)return et(r,{code:W.invalid_type,expected:nt.map,received:r.parsedType}),gt;const o=this._def.keyType,l=this._def.valueType,f=[...r.data.entries()].map(([c,d],p)=>({key:o._parse(new Ze(r,c,r.path,[p,"key"])),value:l._parse(new Ze(r,d,r.path,[p,"value"]))}));if(r.common.async){const c=new Map;return Promise.resolve().then(async()=>{for(const d of f){const p=await d.key,v=await d.value;if(p.status==="aborted"||v.status==="aborted")return gt;(p.status==="dirty"||v.status==="dirty")&&e.dirty(),c.set(p.value,v.value)}return{status:e.value,value:c}})}else{const c=new Map;for(const d of f){const p=d.key,v=d.value;if(p.status==="aborted"||v.status==="aborted")return gt;(p.status==="dirty"||v.status==="dirty")&&e.dirty(),c.set(p.value,v.value)}return{status:e.value,value:c}}}}Os.create=(n,t,e)=>new Os({valueType:t,keyType:n,typeName:ct.ZodMap,...mt(e)});class zn extends _t{_parse(t){const{status:e,ctx:r}=this._processInputParams(t);if(r.parsedType!==nt.set)return et(r,{code:W.invalid_type,expected:nt.set,received:r.parsedType}),gt;const o=this._def;o.minSize!==null&&r.data.size<o.minSize.value&&(et(r,{code:W.too_small,minimum:o.minSize.value,type:"set",inclusive:!0,exact:!1,message:o.minSize.message}),e.dirty()),o.maxSize!==null&&r.data.size>o.maxSize.value&&(et(r,{code:W.too_big,maximum:o.maxSize.value,type:"set",inclusive:!0,exact:!1,message:o.maxSize.message}),e.dirty());const l=this._def.valueType;function f(d){const p=new Set;for(const v of d){if(v.status==="aborted")return gt;v.status==="dirty"&&e.dirty(),p.add(v.value)}return{status:e.value,value:p}}const c=[...r.data.values()].map((d,p)=>l._parse(new Ze(r,d,r.path,p)));return r.common.async?Promise.all(c).then(d=>f(d)):f(c)}min(t,e){return new zn({...this._def,minSize:{value:t,message:ut.toString(e)}})}max(t,e){return new zn({...this._def,maxSize:{value:t,message:ut.toString(e)}})}size(t,e){return this.min(t,e).max(t,e)}nonempty(t){return this.min(1,t)}}zn.create=(n,t)=>new zn({valueType:n,minSize:null,maxSize:null,typeName:ct.ZodSet,...mt(t)});class lr extends _t{constructor(){super(...arguments),this.validate=this.implement}_parse(t){const{ctx:e}=this._processInputParams(t);if(e.parsedType!==nt.function)return et(e,{code:W.invalid_type,expected:nt.function,received:e.parsedType}),gt;function r(c,d){return Rs({data:c,path:e.path,errorMaps:[e.common.contextualErrorMap,e.schemaErrorMap,Ss(),pr].filter(p=>!!p),issueData:{code:W.invalid_arguments,argumentsError:d}})}function o(c,d){return Rs({data:c,path:e.path,errorMaps:[e.common.contextualErrorMap,e.schemaErrorMap,Ss(),pr].filter(p=>!!p),issueData:{code:W.invalid_return_type,returnTypeError:d}})}const l={errorMap:e.common.contextualErrorMap},f=e.data;if(this._def.returns instanceof vr){const c=this;return ue(async function(...d){const p=new _e([]),v=await c._def.args.parseAsync(d,l).catch(x=>{throw p.addIssue(r(d,x)),p}),y=await Reflect.apply(f,this,v);return await c._def.returns._def.type.parseAsync(y,l).catch(x=>{throw p.addIssue(o(y,x)),p})})}else{const c=this;return ue(function(...d){const p=c._def.args.safeParse(d,l);if(!p.success)throw new _e([r(d,p.error)]);const v=Reflect.apply(f,this,p.data),y=c._def.returns.safeParse(v,l);if(!y.success)throw new _e([o(v,y.error)]);return y.data})}}parameters(){return this._def.args}returnType(){return this._def.returns}args(...t){return new lr({...this._def,args:He.create(t).rest(Dn.create())})}returns(t){return new lr({...this._def,returns:t})}implement(t){return this.parse(t)}strictImplement(t){return this.parse(t)}static create(t,e,r){return new lr({args:t||He.create([]).rest(Dn.create()),returns:e||Dn.create(),typeName:ct.ZodFunction,...mt(r)})}}class ai extends _t{get schema(){return this._def.getter()}_parse(t){const{ctx:e}=this._processInputParams(t);return this._def.getter()._parse({data:e.data,path:e.path,parent:e})}}ai.create=(n,t)=>new ai({getter:n,typeName:ct.ZodLazy,...mt(t)});class ui extends _t{_parse(t){if(t.data!==this._def.value){const e=this._getOrReturnCtx(t);return et(e,{received:e.data,code:W.invalid_literal,expected:this._def.value}),gt}return{status:"valid",value:t.data}}get value(){return this._def.value}}ui.create=(n,t)=>new ui({value:n,typeName:ct.ZodLiteral,...mt(t)});function Vc(n,t){return new En({values:n,typeName:ct.ZodEnum,...mt(t)})}class En extends _t{constructor(){super(...arguments),Vr.set(this,void 0)}_parse(t){if(typeof t.data!="string"){const e=this._getOrReturnCtx(t),r=this._def.values;return et(e,{expected:St.joinValues(r),received:e.parsedType,code:W.invalid_type}),gt}if(Ps(this,Vr)||zc(this,Vr,new Set(this._def.values)),!Ps(this,Vr).has(t.data)){const e=this._getOrReturnCtx(t),r=this._def.values;return et(e,{received:e.data,code:W.invalid_enum_value,options:r}),gt}return ue(t.data)}get options(){return this._def.values}get enum(){const t={};for(const e of this._def.values)t[e]=e;return t}get Values(){const t={};for(const e of this._def.values)t[e]=e;return t}get Enum(){const t={};for(const e of this._def.values)t[e]=e;return t}extract(t,e=this._def){return En.create(t,{...this._def,...e})}exclude(t,e=this._def){return En.create(this.options.filter(r=>!t.includes(r)),{...this._def,...e})}}Vr=new WeakMap;En.create=Vc;class li extends _t{constructor(){super(...arguments),Yr.set(this,void 0)}_parse(t){const e=St.getValidEnumValues(this._def.values),r=this._getOrReturnCtx(t);if(r.parsedType!==nt.string&&r.parsedType!==nt.number){const o=St.objectValues(e);return et(r,{expected:St.joinValues(o),received:r.parsedType,code:W.invalid_type}),gt}if(Ps(this,Yr)||zc(this,Yr,new Set(St.getValidEnumValues(this._def.values))),!Ps(this,Yr).has(t.data)){const o=St.objectValues(e);return et(r,{received:r.data,code:W.invalid_enum_value,options:o}),gt}return ue(t.data)}get enum(){return this._def.values}}Yr=new WeakMap;li.create=(n,t)=>new li({values:n,typeName:ct.ZodNativeEnum,...mt(t)});class vr extends _t{unwrap(){return this._def.type}_parse(t){const{ctx:e}=this._processInputParams(t);if(e.parsedType!==nt.promise&&e.common.async===!1)return et(e,{code:W.invalid_type,expected:nt.promise,received:e.parsedType}),gt;const r=e.parsedType===nt.promise?e.data:Promise.resolve(e.data);return ue(r.then(o=>this._def.type.parseAsync(o,{path:e.path,errorMap:e.common.contextualErrorMap})))}}vr.create=(n,t)=>new vr({type:n,typeName:ct.ZodPromise,...mt(t)});class Be extends _t{innerType(){return this._def.schema}sourceType(){return this._def.schema._def.typeName===ct.ZodEffects?this._def.schema.sourceType():this._def.schema}_parse(t){const{status:e,ctx:r}=this._processInputParams(t),o=this._def.effect||null,l={addIssue:f=>{et(r,f),f.fatal?e.abort():e.dirty()},get path(){return r.path}};if(l.addIssue=l.addIssue.bind(l),o.type==="preprocess"){const f=o.transform(r.data,l);if(r.common.async)return Promise.resolve(f).then(async c=>{if(e.value==="aborted")return gt;const d=await this._def.schema._parseAsync({data:c,path:r.path,parent:r});return d.status==="aborted"?gt:d.status==="dirty"||e.value==="dirty"?Cs(d.value):d});{if(e.value==="aborted")return gt;const c=this._def.schema._parseSync({data:f,path:r.path,parent:r});return c.status==="aborted"?gt:c.status==="dirty"||e.value==="dirty"?Cs(c.value):c}}if(o.type==="refinement"){const f=c=>{const d=o.refinement(c,l);if(r.common.async)return Promise.resolve(d);if(d instanceof Promise)throw new Error("Async refinement encountered during synchronous parse operation. Use .parseAsync instead.");return c};if(r.common.async===!1){const c=this._def.schema._parseSync({data:r.data,path:r.path,parent:r});return c.status==="aborted"?gt:(c.status==="dirty"&&e.dirty(),f(c.value),{status:e.value,value:c.value})}else return this._def.schema._parseAsync({data:r.data,path:r.path,parent:r}).then(c=>c.status==="aborted"?gt:(c.status==="dirty"&&e.dirty(),f(c.value).then(()=>({status:e.value,value:c.value}))))}if(o.type==="transform")if(r.common.async===!1){const f=this._def.schema._parseSync({data:r.data,path:r.path,parent:r});if(!Qr(f))return f;const c=o.transform(f.value,l);if(c instanceof Promise)throw new Error("Asynchronous transform encountered during synchronous parse operation. Use .parseAsync instead.");return{status:e.value,value:c}}else return this._def.schema._parseAsync({data:r.data,path:r.path,parent:r}).then(f=>Qr(f)?Promise.resolve(o.transform(f.value,l)).then(c=>({status:e.value,value:c})):f);St.assertNever(o)}}Be.create=(n,t,e)=>new Be({schema:n,typeName:ct.ZodEffects,effect:t,...mt(e)});Be.createWithPreprocess=(n,t,e)=>new Be({schema:t,effect:{type:"preprocess",transform:n},typeName:ct.ZodEffects,...mt(e)});class We extends _t{_parse(t){return this._getType(t)===nt.undefined?ue(void 0):this._def.innerType._parse(t)}unwrap(){return this._def.innerType}}We.create=(n,t)=>new We({innerType:n,typeName:ct.ZodOptional,...mt(t)});class kn extends _t{_parse(t){return this._getType(t)===nt.null?ue(null):this._def.innerType._parse(t)}unwrap(){return this._def.innerType}}kn.create=(n,t)=>new kn({innerType:n,typeName:ct.ZodNullable,...mt(t)});class hi extends _t{_parse(t){const{ctx:e}=this._processInputParams(t);let r=e.data;return e.parsedType===nt.undefined&&(r=this._def.defaultValue()),this._def.innerType._parse({data:r,path:e.path,parent:e})}removeDefault(){return this._def.innerType}}hi.create=(n,t)=>new hi({innerType:n,typeName:ct.ZodDefault,defaultValue:typeof t.default=="function"?t.default:()=>t.default,...mt(t)});class ci extends _t{_parse(t){const{ctx:e}=this._processInputParams(t),r={...e,common:{...e.common,issues:[]}},o=this._def.innerType._parse({data:r.data,path:r.path,parent:{...r}});return ti(o)?o.then(l=>({status:"valid",value:l.status==="valid"?l.value:this._def.catchValue({get error(){return new _e(r.common.issues)},input:r.data})})):{status:"valid",value:o.status==="valid"?o.value:this._def.catchValue({get error(){return new _e(r.common.issues)},input:r.data})}}removeCatch(){return this._def.innerType}}ci.create=(n,t)=>new ci({innerType:n,typeName:ct.ZodCatch,catchValue:typeof t.catch=="function"?t.catch:()=>t.catch,...mt(t)});class Ds extends _t{_parse(t){if(this._getType(t)!==nt.nan){const e=this._getOrReturnCtx(t);return et(e,{code:W.invalid_type,expected:nt.nan,received:e.parsedType}),gt}return{status:"valid",value:t.data}}}Ds.create=n=>new Ds({typeName:ct.ZodNaN,...mt(n)});const Gv=Symbol("zod_brand");class Ya extends _t{_parse(t){const{ctx:e}=this._processInputParams(t),r=e.data;return this._def.type._parse({data:r,path:e.path,parent:e})}unwrap(){return this._def.type}}class _i extends _t{_parse(t){const{status:e,ctx:r}=this._processInputParams(t);if(r.common.async)return(async()=>{const o=await this._def.in._parseAsync({data:r.data,path:r.path,parent:r});return o.status==="aborted"?gt:o.status==="dirty"?(e.dirty(),Cs(o.value)):this._def.out._parseAsync({data:o.value,path:r.path,parent:r})})();{const o=this._def.in._parseSync({data:r.data,path:r.path,parent:r});return o.status==="aborted"?gt:o.status==="dirty"?(e.dirty(),{status:"dirty",value:o.value}):this._def.out._parseSync({data:o.value,path:r.path,parent:r})}}static create(t,e){return new _i({in:t,out:e,typeName:ct.ZodPipeline})}}class fi extends _t{_parse(t){const e=this._def.innerType._parse(t),r=o=>(Qr(o)&&(o.value=Object.freeze(o.value)),o);return ti(e)?e.then(o=>r(o)):r(e)}unwrap(){return this._def.innerType}}fi.create=(n,t)=>new fi({innerType:n,typeName:ct.ZodReadonly,...mt(t)});function Yc(n,t={},e){return n?mr.create().superRefine((r,o)=>{var l,f;if(!n(r)){const c=typeof t=="function"?t(r):typeof t=="string"?{message:t}:t,d=(f=(l=c.fatal)!==null&&l!==void 0?l:e)!==null&&f!==void 0?f:!0,p=typeof c=="string"?{message:c}:c;o.addIssue({code:"custom",...p,fatal:d})}}):mr.create()}const Bv={object:Ut.lazycreate};var ct;(function(n){n.ZodString="ZodString",n.ZodNumber="ZodNumber",n.ZodNaN="ZodNaN",n.ZodBigInt="ZodBigInt",n.ZodBoolean="ZodBoolean",n.ZodDate="ZodDate",n.ZodSymbol="ZodSymbol",n.ZodUndefined="ZodUndefined",n.ZodNull="ZodNull",n.ZodAny="ZodAny",n.ZodUnknown="ZodUnknown",n.ZodNever="ZodNever",n.ZodVoid="ZodVoid",n.ZodArray="ZodArray",n.ZodObject="ZodObject",n.ZodUnion="ZodUnion",n.ZodDiscriminatedUnion="ZodDiscriminatedUnion",n.ZodIntersection="ZodIntersection",n.ZodTuple="ZodTuple",n.ZodRecord="ZodRecord",n.ZodMap="ZodMap",n.ZodSet="ZodSet",n.ZodFunction="ZodFunction",n.ZodLazy="ZodLazy",n.ZodLiteral="ZodLiteral",n.ZodEnum="ZodEnum",n.ZodEffects="ZodEffects",n.ZodNativeEnum="ZodNativeEnum",n.ZodOptional="ZodOptional",n.ZodNullable="ZodNullable",n.ZodDefault="ZodDefault",n.ZodCatch="ZodCatch",n.ZodPromise="ZodPromise",n.ZodBranded="ZodBranded",n.ZodPipeline="ZodPipeline",n.ZodReadonly="ZodReadonly"})(ct||(ct={}));const zv=(n,t={message:`Input not instance of ${n.name}`})=>Yc(e=>e instanceof n,t),Wc=De.create,Xc=wn.create,qv=Ds.create,Uv=xn.create,Zc=ei.create,jv=Bn.create,Vv=Ls.create,Yv=ni.create,Wv=ri.create,Xv=mr.create,Zv=Dn.create,Hv=gn.create,$v=As.create,Kv=Ge.create,Jv=Ut.create,Qv=Ut.strictCreate,ty=ii.create,ey=Hs.create,ny=si.create,ry=He.create,iy=oi.create,sy=Os.create,oy=zn.create,ay=lr.create,uy=ai.create,ly=ui.create,hy=En.create,cy=li.create,fy=vr.create,Hl=Be.create,gy=We.create,dy=kn.create,py=Be.createWithPreprocess,my=_i.create,vy=()=>Wc().optional(),yy=()=>Xc().optional(),_y=()=>Zc().optional(),wy={string:n=>De.create({...n,coerce:!0}),number:n=>wn.create({...n,coerce:!0}),boolean:n=>ei.create({...n,coerce:!0}),bigint:n=>xn.create({...n,coerce:!0}),date:n=>Bn.create({...n,coerce:!0})},xy=gt;var P=Object.freeze({__proto__:null,defaultErrorMap:pr,setErrorMap:xv,getErrorMap:Ss,makeIssue:Rs,EMPTY_PATH:Ev,addIssueToContext:et,ParseStatus:ie,INVALID:gt,DIRTY:Cs,OK:ue,isAborted:da,isDirty:pa,isValid:Qr,isAsync:ti,get util(){return St},get objectUtil(){return ga},ZodParsedType:nt,getParsedType:yn,ZodType:_t,datetimeRegex:jc,ZodString:De,ZodNumber:wn,ZodBigInt:xn,ZodBoolean:ei,ZodDate:Bn,ZodSymbol:Ls,ZodUndefined:ni,ZodNull:ri,ZodAny:mr,ZodUnknown:Dn,ZodNever:gn,ZodVoid:As,ZodArray:Ge,ZodObject:Ut,ZodUnion:ii,ZodDiscriminatedUnion:Hs,ZodIntersection:si,ZodTuple:He,ZodRecord:oi,ZodMap:Os,ZodSet:zn,ZodFunction:lr,ZodLazy:ai,ZodLiteral:ui,ZodEnum:En,ZodNativeEnum:li,ZodPromise:vr,ZodEffects:Be,ZodTransformer:Be,ZodOptional:We,ZodNullable:kn,ZodDefault:hi,ZodCatch:ci,ZodNaN:Ds,BRAND:Gv,ZodBranded:Ya,ZodPipeline:_i,ZodReadonly:fi,custom:Yc,Schema:_t,ZodSchema:_t,late:Bv,get ZodFirstPartyTypeKind(){return ct},coerce:wy,any:Xv,array:Kv,bigint:Uv,boolean:Zc,date:jv,discriminatedUnion:ey,effect:Hl,enum:hy,function:ay,instanceof:zv,intersection:ny,lazy:uy,literal:ly,map:sy,nan:qv,nativeEnum:cy,never:Hv,null:Wv,nullable:dy,number:Xc,object:Jv,oboolean:_y,onumber:yy,optional:gy,ostring:vy,pipeline:my,preprocess:py,promise:fy,record:iy,set:oy,strictObject:Qv,string:Wc,symbol:Vv,transformer:Hl,tuple:ry,undefined:Yv,union:ty,unknown:Zv,void:$v,NEVER:xy,ZodIssueCode:W,quotelessJson:wv,ZodError:_e});const $s=/^https?:\/\/library.stanford.edu\/iiif\/image-api\/1.1\/compliance.html#level(?<level>[012])$/,Hc=P.string().regex($s),Ey=Hc,Fs="http://library.stanford.edu/iiif/image-api/1.1/context.json",$c="http://iiif.io/api/image/1/context.json",Kc=P.literal(Fs),Jc=P.object({"@context":Kc,"@id":P.string().url(),profile:Hc.optional(),width:P.number().int(),height:P.number().int(),scale_factors:P.number().array().optional(),tile_width:P.number().optional(),tile_height:P.number().optional()}),Qc=P.object({width:P.number().int(),height:P.number().int()}),tf=P.object({width:P.number().int(),height:P.number().int().optional(),scaleFactors:P.array(P.number().int())}),ky=["ImageService1","ImageService2","ImageService3"],ef=P.enum(ky),Ks=/^https?:\/\/iiif.io\/api\/image\/2.*level(?<level>[012])(.json)?$/,$l=P.string().regex(Ks),Iy=P.object({formats:P.string().array().optional(),maxArea:P.number().int().optional(),maxHeight:P.number().int().optional(),maxWidth:P.number().int().optional(),qualities:P.string().array().optional(),supports:P.string().array().optional()}),Gs=$l.or(P.array(P.union([$l,Iy,P.any()]))),Bs="http://iiif.io/api/image/2/context.json",nf=P.literal(Bs).or(P.literal("https://iiif.io/api/image/2/context.json")),Wa=P.object({"@id":P.string().url(),"@type":P.literal("iiif:Image").optional(),"@context":nf,protocol:P.literal("http://iiif.io/api/image"),width:P.number().int(),height:P.number().int(),profile:Gs,sizes:Qc.array().optional(),tiles:tf.array().optional()}),Ty=["level0","level1","level2"],rf=P.enum(Ty),Xa=P.object({id:P.string().url(),type:P.literal("ImageService3"),protocol:P.literal("http://iiif.io/api/image"),profile:rf,width:P.number().int(),height:P.number().int(),maxWidth:P.number().int().optional(),maxHeight:P.number().int().optional(),maxArea:P.number().int().optional(),sizes:Qc.array().optional(),tiles:tf.array().optional(),extraFeatures:P.string().array().optional()}),My=P.object({"@id":P.string().url(),"@type":ef.optional(),profile:Ey.or(Gs).or(rf),width:P.number().int().optional(),height:P.number().int().optional(),"@context":Kc.or(P.literal("http://iiif.io/api/image/1/context.json")).or(nf).optional()}),by=["level0","level1","level2"],Ny=P.object({id:P.string().url(),type:P.literal("ImageService2"),profile:Gs}).or(P.object({"@id":P.string().url(),"@type":P.literal("ImageService2"),profile:Gs})),Sy=P.object({id:P.string().url(),type:ef,profile:P.enum(by)}),Ry=P.union([Ny,Sy]),sf=My.or(Ry),Kl=P.string().or(P.number()).or(P.boolean()),of=Kl.or(Kl.array()),Jl=P.object({"@language":P.string().optional(),"@value":of}),qn=of.or(Jl).or(Jl.array()),Cy=P.union([P.any(),P.object({label:qn.optional(),value:qn.optional()})]).transform(n=>{if(n&&typeof n=="object"&&"label"in n&&"value"in n)return n}),af=Cy.array(),Py=P.object({width:P.number().int().optional(),height:P.number().int().optional(),service:sf}),Ly=P.object({resource:Py}),uf=P.object({"@id":P.string().url(),"@type":P.literal("sc:Canvas"),width:P.number().int(),height:P.number().int(),images:Ly.array().length(1),label:qn.optional(),metadata:af.optional()}),Ay=P.object({canvases:uf.array().nonempty()}),lf=P.object({"@id":P.string().url(),"@type":P.literal("sc:Manifest"),sequences:Ay.array().length(1),label:qn.optional(),description:qn.optional(),metadata:af.optional()}),Ql=P.lazy(()=>P.object({"@id":P.string().url(),"@type":P.literal("sc:Manifest"),label:qn.optional()})),va=P.lazy(()=>P.object({"@id":P.string().url(),"@type":P.literal("sc:Collection"),label:qn.optional(),manifests:Ql.array().optional(),collections:va.array().optional(),members:Ql.or(va).array().optional()})),Oy=P.string().or(P.number()).or(P.boolean()),Un=P.record(P.string(),Oy.array()),Dy=P.union([P.any(),P.object({label:Un.optional(),value:Un.optional()})]).transform(n=>{if(n&&typeof n=="object"&&"label"in n&&"value"in n)return n}),hf=Dy.array(),th=P.object({type:P.literal("Image"),width:P.number().int().optional(),height:P.number().int().optional(),service:sf.array()}),Fy=P.object({type:P.literal("Annotation"),body:th.or(th.array().length(1))}),Gy=P.object({type:P.literal("AnnotationPage"),items:Fy.array().length(1)}),cf=P.object({id:P.string().url(),type:P.literal("Canvas"),width:P.number().int(),height:P.number().int(),items:Gy.array().length(1),label:Un.optional(),metadata:hf.optional()}),ff=P.object({id:P.string().url(),type:P.literal("Manifest"),items:cf.array().nonempty(),label:Un.optional(),description:Un.optional(),metadata:hf.optional()}),By=P.lazy(()=>P.object({id:P.string().url(),type:P.literal("Manifest"),label:Un.optional()})),gf=P.lazy(()=>P.object({id:P.string().url(),type:P.literal("Collection"),label:Un.optional(),items:By.or(gf).array()})),df=Jc.or(Wa).or(Xa);uf.or(cf);const zy=lf.or(ff);va.or(gf);lf.or(Wa);ff.or(Xa);zy.or(df);function pf({width:n,height:t},e,r,o){const l=r*e.originalWidth,f=o*e.originalHeight,c=r*e.originalWidth+e.width*e.scaleFactor>n?n-r*e.originalWidth:e.width*e.scaleFactor,d=o*e.originalHeight+e.height*e.scaleFactor>t?t-o*e.originalHeight:e.height*e.scaleFactor;let p=e.width,v=e.height;return l+e.width*e.scaleFactor>n&&(p=Math.floor((n-l+e.scaleFactor-1)/e.scaleFactor)),f+e.height*e.scaleFactor>t&&(v=Math.floor((t-f+e.scaleFactor-1)/e.scaleFactor)),{region:{x:l,y:f,width:c,height:d},size:{width:p,height:v}}}function qy({width:n,height:t},e=768){const r=Math.max(n,t)/e,o=Math.ceil(Math.log(r)/Math.log(2));return{scaleFactors:Array.from({length:o},(l,f)=>2**f),width:e}}function Uy({width:n,height:t},e,r){const o=e.height||e.width,l=e.width*r,f=o*r;return{scaleFactor:r,width:e.width,height:o,originalWidth:l,originalHeight:f,columns:Math.ceil(n/l),rows:Math.ceil(t/f)}}function jy(n,t){return t.map(e=>e.scaleFactors.map(r=>Uy(n,e,r))).flat()}function Vy(n){return!!n.some(t=>t.width&&t.scaleFactors&&t.scaleFactors.length)}function Yy(n,t,e){if(!t||!Vy(t))if(e)t=[qy(n)];else throw new Error("Image does not support tiles or custom regions and sizes.");return jy(n,t)}function Wy(n,t,e="cover"){if(e==="cover"||e==="contain"){const r=t.width/n.width,o=t.height/n.height,l=e==="cover"?Math.max(r,o):Math.min(r,o),f=n.width*l,c=n.height*l;return{width:f,height:c}}else throw new Error('Mode must be either "cover" or "contain"')}const Xy=.8,Zy=1.5;function mf(n,t,e="cover",{sizes:r,tileZoomLevels:o,supportsAnyRegionAndSize:l,maxWidth:f,maxHeight:c,maxArea:d}){let{width:p,height:v}=Wy(n,t,e);if(f&&p>f&&(v=v/p*f,p=f),c&&v>c&&(p=p/v*c,v=c),d&&p*v>d){const x=v/p,M=Math.floor(Math.sqrt(d/x))*x;p=Math.floor(M)/x,v=p*x}const y=n.width/n.height;if(p=Math.floor(p),v=Math.round(p/y),r){let x;for(const M of r){const I=M.width/p;if(I>=Xy&&I<=Zy){x=M;break}}if(x)return{size:x}}if(l)return{size:{width:Math.round(p),height:Math.round(v)}};if(o){const x=n.width/p,M=o.map(({scaleFactor:F},w)=>({index:w,scaleFactor:F,diff:Math.abs(F-x)})).sort((F,w)=>F.diff-w.diff),I=o[M[0].index],O=Math.ceil(n.width/(I.scaleFactor*o[0].width)),D=Math.ceil(n.height/(I.scaleFactor*o[0].height)),S=[];for(let F=0;F<D;F++){const w=[];for(let T=0;T<O;T++){const N=pf(n,I,T,F);w.push(N)}S.push(w)}return S}throw new Error("Unable to create thumbnail")}const vf=["regionByPx","sizeByWh"];function Hy(n){const t=n.match($s);if(t&&t.groups)return parseInt(t.groups.level)}function eh(n){const t=n.match(Ks);if(t&&t.groups)return parseInt(t.groups.level)}function $y(n){return{maxWidth:n?.maxWidth,maxHeight:n?.maxHeight,maxArea:n?.maxArea,supportsAnyRegionAndSize:vf.every(t=>n?.supports&&n?.supports?.includes(t))}}function Ky(n){if("type"in n&&n.type==="ImageService3")return 3;if("type"in n&&n.type==="ImageService2"||"@type"in n&&n["@type"]==="ImageService2"||"@context"in n&&n["@context"]===Bs)return 2;if("@context"in n&&(n["@context"]===Fs||n["@context"]===$c))return 1;if("profile"in n){let t;return Array.isArray(n.profile)?t=n.profile[0]:t=n.profile,t.match($s)?1:t.match(Ks)?2:3}else throw new Error("Unsupported IIIF Image Service")}function ya(n){if("type"in n||"@type"in n){const t=n.profile;let e=!1;return t==="level0"||typeof t=="string"&&t.endsWith("level0.json")?"extraFeatures"in n&&(e=vf.every(r=>n.extraFeatures&&n.extraFeatures.includes(r))):e=!0,{maxWidth:"maxWidth"in n?n.maxWidth:void 0,maxHeight:"maxHeight"in n?n.maxHeight:void 0,maxArea:"maxArea"in n?n.maxArea:void 0,supportsAnyRegionAndSize:e}}else if(Array.isArray(n.profile)){let t=!1,e=Number.NEGATIVE_INFINITY,r=Number.NEGATIVE_INFINITY,o=Number.NEGATIVE_INFINITY;return n.profile.forEach(l=>{if(typeof l=="string"){const f=eh(l);f&&(t=t||f>=1)}else{const{maxWidth:f,maxHeight:c,maxArea:d,supportsAnyRegionAndSize:p}=$y(l);f!==void 0&&(r=Math.max(f,r)),c!==void 0&&(e=Math.max(c,e)),d!==void 0&&(o=Math.max(d,o)),t=t||p}}),{maxWidth:r>=0?r:void 0,maxHeight:e>=0?e:void 0,maxArea:o>=0?o:void 0,supportsAnyRegionAndSize:t}}else if("profile"in n&&n.profile){const t=Hy(n.profile),e=eh(n.profile);return t?{supportsAnyRegionAndSize:t>=1}:e?{supportsAnyRegionAndSize:e>=1}:{supportsAnyRegionAndSize:!1}}else throw new Error("Invalid Image")}const Jy="image";class Qy{embedded=!0;uri;type=Jy;maxWidth;maxHeight;maxArea;supportsAnyRegionAndSize;width;height;majorVersion;constructor(t,e){if(e){const r=t;let o,l;if(Array.isArray(r.service)?r.service.forEach(f=>{try{const c=Ky(f);(!l||c>l)&&(l=c,o=f)}catch{}}):o=r.service,!o)throw new Error("Unsupported IIIF Image Service");if("@id"in o)this.uri=o["@id"];else if("id"in o)this.uri=o.id;else throw new Error("Unsupported IIIF Image Service");if("type"in o&&o.type==="ImageService3")this.majorVersion=3;else if("type"in o&&o.type==="ImageService2"||"@type"in o&&o["@type"]==="ImageService2"||"@context"in o&&o["@context"]===Bs)this.majorVersion=2;else if("@context"in o&&(o["@context"]===Fs||o["@context"]===$c))this.majorVersion=1;else if("profile"in o){let f;Array.isArray(o.profile)?f=o.profile[0]:f=o.profile,f.match($s)?this.majorVersion=1:f.match(Ks)?this.majorVersion=2:this.majorVersion=3}else throw new Error("Unsupported IIIF Image Service");if("profile"in o){const f=ya(o);this.supportsAnyRegionAndSize=f.supportsAnyRegionAndSize,this.maxWidth=f.maxWidth,this.maxHeight=f.maxHeight,this.maxArea=f.maxArea}else this.supportsAnyRegionAndSize=!1}else{if("@id"in t)this.uri=t["@id"];else if("id"in t)this.uri=t.id;else throw new Error("Unsupported IIIF Image");if("type"in t&&t.type==="ImageService3")this.majorVersion=3;else if("@type"in t&&t["@type"]==="iiif:Image"||"@context"in t&&t["@context"]===Bs)this.majorVersion=2;else if("@context"in t&&t["@context"]===Fs)this.majorVersion=1;else throw new Error("Unsupported IIIF Image");if("profile"in t){const r=ya(t);this.supportsAnyRegionAndSize=r.supportsAnyRegionAndSize,this.maxWidth=r.maxWidth,this.maxHeight=r.maxHeight,this.maxArea=r.maxArea}else this.supportsAnyRegionAndSize=!1}if(t.width!==void 0)this.width=t.width;else if(e)this.width=e.width;else throw new Error("Width not present on either Canvas or Image Resource");if(t.height!==void 0)this.height=t.height;else if(e)this.height=e.height;else throw new Error("Height not present on either Canvas or Image Resource")}getImageUrl(t){const{region:e,size:r}=t;let o,l,f,c,d;e?(d=`${e.x},${e.y},${e.width},${e.height}`,f=e.height,c=e.width):(d="full",f=this.height,c=this.width);let p;if(r){o=Math.round(r.width),l=Math.round(r.height);const x=String(o);let M=String(l);const I=c/f,O=l*I/I;l===Math.round(O)&&(M=""),p=`${x},${M}`}else o=this.width,l=this.height,p=this.majorVersion===2?"full":"max";const v=o*l;if(this.maxWidth!==void 0&&o>this.maxWidth)throw new Error(`Width of requested image is too large: ${o} > ${this.maxWidth}`);if(this.maxHeight!==void 0&&l>this.maxHeight)throw new Error(`Height of requested image is too large: ${l} > ${this.maxHeight}`);if(this.maxArea!==void 0&&v>this.maxArea)throw new Error(`Area of requested image is too large: ${v} > ${this.maxArea}`);const y=this.majorVersion===1?"native":"default";return`${this.uri}/${d}/${p}/0/${y}.jpg`}getThumbnail(t,e="cover"){return mf({width:this.width,height:this.height},t,e,{supportsAnyRegionAndSize:this.supportsAnyRegionAndSize,maxWidth:this.maxWidth,maxHeight:this.maxHeight,maxArea:this.maxArea})}}class Za extends Qy{tileZoomLevels;sizes;embedded=!1;constructor(t){super(t);const e=ya(t);let r;"tiles"in t&&(r=t.tiles),this.tileZoomLevels=Yy({width:this.width,height:this.height},r,e.supportsAnyRegionAndSize),"sizes"in t&&(this.sizes=t.sizes)}static parse(t,e=null){let r;return e===1?r=Jc.parse(t):e===2?r=Wa.parse(t):e===3?r=Xa.parse(t):r=df.parse(t),new Za(r)}getIiifTile(t,e,r){return pf({width:this.width,height:this.height},t,e,r)}getThumbnail(t,e="cover"){return mf({width:this.width,height:this.height},t,e,{supportsAnyRegionAndSize:this.supportsAnyRegionAndSize,sizes:this.sizes,tileZoomLevels:this.tileZoomLevels,maxWidth:this.maxWidth,maxHeight:this.maxHeight,maxArea:this.maxArea})}}const nh=P.record(P.string(),P.string().array());P.object({label:nh.optional(),value:nh.optional()});var le=63710088e-1,yf={centimeters:le*100,centimetres:le*100,degrees:le/111325,feet:le*3.28084,inches:le*39.37,kilometers:le/1e3,kilometres:le/1e3,meters:le,metres:le,miles:le/1609.344,millimeters:le*1e3,millimetres:le*1e3,nauticalmiles:le/1852,radians:1,yards:le*1.0936};function t0(n,t,e){e===void 0&&(e={});var r={type:"Feature"};return(e.id===0||e.id)&&(r.id=e.id),e.bbox&&(r.bbox=e.bbox),r.properties=t||{},r.geometry=n,r}function e0(n,t,e){if(e===void 0&&(e={}),!n)throw new Error("coordinates is required");if(!Array.isArray(n))throw new Error("coordinates must be an Array");if(n.length<2)throw new Error("coordinates must be at least 2 numbers long");if(!rh(n[0])||!rh(n[1]))throw new Error("coordinates must contain numbers");var r={type:"Point",coordinates:n};return t0(r,t,e)}function n0(n,t){t===void 0&&(t="kilometers");var e=yf[t];if(!e)throw new Error(t+" units is invalid");return n*e}function r0(n,t){t===void 0&&(t="kilometers");var e=yf[t];if(!e)throw new Error(t+" units is invalid");return n/e}function _a(n){var t=n%(2*Math.PI);return t*180/Math.PI}function Fe(n){var t=n%360;return t*Math.PI/180}function rh(n){return!isNaN(n)&&n!==null&&!Array.isArray(n)}function yr(n){if(!n)throw new Error("coord is required");if(!Array.isArray(n)){if(n.type==="Feature"&&n.geometry!==null&&n.geometry.type==="Point")return n.geometry.coordinates;if(n.type==="Point")return n.coordinates}if(Array.isArray(n)&&n.length>=2&&!Array.isArray(n[0])&&!Array.isArray(n[1]))return n;throw new Error("coord must be GeoJSON Point or an Array of numbers")}function i0(n){return n.type==="Feature"?n.geometry:n}function _f(n,t,e){if(e===void 0&&(e={}),e.final===!0)return s0(n,t);var r=yr(n),o=yr(t),l=Fe(r[0]),f=Fe(o[0]),c=Fe(r[1]),d=Fe(o[1]),p=Math.sin(f-l)*Math.cos(d),v=Math.cos(c)*Math.sin(d)-Math.sin(c)*Math.cos(d)*Math.cos(f-l);return _a(Math.atan2(p,v))}function s0(n,t){var e=_f(t,n);return e=(e+180)%360,e}function o0(n,t,e,r){r===void 0&&(r={});var o=yr(n),l=Fe(o[0]),f=Fe(o[1]),c=Fe(e),d=r0(t,r.units),p=Math.asin(Math.sin(f)*Math.cos(d)+Math.cos(f)*Math.sin(d)*Math.cos(c)),v=l+Math.atan2(Math.sin(c)*Math.sin(d)*Math.cos(f),Math.cos(d)-Math.sin(f)*Math.sin(p)),y=_a(v),x=_a(p);return e0([y,x],r.properties)}function Ha(n,t,e){e===void 0&&(e={});var r=yr(n),o=yr(t),l=Fe(o[1]-r[1]),f=Fe(o[0]-r[0]),c=Fe(r[1]),d=Fe(o[1]),p=Math.pow(Math.sin(l/2),2)+Math.pow(Math.sin(f/2),2)*Math.cos(c)*Math.cos(d);return n0(2*Math.atan2(Math.sqrt(p),Math.sqrt(1-p)),e.units)}function zs(n,t){var e=Ha(n,t),r=_f(n,t),o=o0(n,e/2,r);return o}function wf(n){if(n.__esModule)return n;var t=n.default;if(typeof t=="function"){var e=function r(){return this instanceof r?Reflect.construct(t,arguments,this.constructor):t.apply(this,arguments)};e.prototype=t.prototype}else e={};return Object.defineProperty(e,"__esModule",{value:!0}),Object.keys(n).forEach(function(r){var o=Object.getOwnPropertyDescriptor(n,r);Object.defineProperty(e,r,o.get?o:{enumerable:!0,get:function(){return n[r]}})}),e}var Et={};const a0=Object.prototype.toString;function gi(n){const t=a0.call(n);return t.endsWith("Array]")&&!t.includes("Big")}const u0=Object.freeze(Object.defineProperty({__proto__:null,isAnyArray:gi},Symbol.toStringTag,{value:"Module"})),l0=wf(u0);function h0(n){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(!gi(n))throw new TypeError("input must be an array");if(n.length===0)throw new TypeError("input must not be empty");var e=t.fromIndex,r=e===void 0?0:e,o=t.toIndex,l=o===void 0?n.length:o;if(r<0||r>=n.length||!Number.isInteger(r))throw new Error("fromIndex must be a positive integer smaller than length");if(l<=r||l>n.length||!Number.isInteger(l))throw new Error("toIndex must be an integer greater than fromIndex and at most equal to length");for(var f=n[r],c=r+1;c<l;c++)n[c]>f&&(f=n[c]);return f}function c0(n){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(!gi(n))throw new TypeError("input must be an array");if(n.length===0)throw new TypeError("input must not be empty");var e=t.fromIndex,r=e===void 0?0:e,o=t.toIndex,l=o===void 0?n.length:o;if(r<0||r>=n.length||!Number.isInteger(r))throw new Error("fromIndex must be a positive integer smaller than length");if(l<=r||l>n.length||!Number.isInteger(l))throw new Error("toIndex must be an integer greater than fromIndex and at most equal to length");for(var f=n[r],c=r+1;c<l;c++)n[c]<f&&(f=n[c]);return f}function f0(n){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(gi(n)){if(n.length===0)throw new TypeError("input must not be empty")}else throw new TypeError("input must be an array");var e;if(t.output!==void 0){if(!gi(t.output))throw new TypeError("output option must be an array if specified");e=t.output}else e=new Array(n.length);var r=c0(n),o=h0(n);if(r===o)throw new RangeError("minimum and maximum input values are equal. Cannot rescale a constant array");var l=t.min,f=l===void 0?t.autoMinMax?r:0:l,c=t.max,d=c===void 0?t.autoMinMax?o:1:c;if(f>=d)throw new RangeError("min option must be smaller than max option");for(var p=(d-f)/(o-r),v=0;v<n.length;v++)e[v]=(n[v]-r)*p+f;return e}const g0=Object.freeze(Object.defineProperty({__proto__:null,default:f0},Symbol.toStringTag,{value:"Module"})),d0=wf(g0);Object.defineProperty(Et,"__esModule",{value:!0});var ce=l0,ih=d0;const Ji=" ".repeat(2),xf=" ".repeat(4);function p0(){return Ef(this)}function Ef(n,t={}){const{maxRows:e=15,maxColumns:r=10,maxNumSize:o=8,padMinus:l="auto"}=t;return`${n.constructor.name} {
${Ji}[
${xf}${m0(n,e,r,o,l)}
${Ji}]
${Ji}rows: ${n.rows}
${Ji}columns: ${n.columns}
}`}function m0(n,t,e,r,o){const{rows:l,columns:f}=n,c=Math.min(l,t),d=Math.min(f,e),p=[];if(o==="auto"){o=!1;t:for(let v=0;v<c;v++)for(let y=0;y<d;y++)if(n.get(v,y)<0){o=!0;break t}}for(let v=0;v<c;v++){let y=[];for(let x=0;x<d;x++)y.push(v0(n.get(v,x),r,o));p.push(`${y.join(" ")}`)}return d!==f&&(p[p.length-1]+=` ... ${f-e} more columns`),c!==l&&p.push(`... ${l-t} more rows`),p.join(`
${xf}`)}function v0(n,t,e){return(n>=0&&e?` ${sh(n,t-1)}`:sh(n,t)).padEnd(t)}function sh(n,t){let e=n.toString();if(e.length<=t)return e;let r=n.toFixed(t);if(r.length>t&&(r=n.toFixed(Math.max(0,t-(r.length-t)))),r.length<=t&&!r.startsWith("0.000")&&!r.startsWith("-0.000"))return r;let o=n.toExponential(t);return o.length>t&&(o=n.toExponential(Math.max(0,t-(o.length-t)))),o.slice(0)}function y0(n,t){n.prototype.add=function(e){return typeof e=="number"?this.addS(e):this.addM(e)},n.prototype.addS=function(e){for(let r=0;r<this.rows;r++)for(let o=0;o<this.columns;o++)this.set(r,o,this.get(r,o)+e);return this},n.prototype.addM=function(e){if(e=t.checkMatrix(e),this.rows!==e.rows||this.columns!==e.columns)throw new RangeError("Matrices dimensions must be equal");for(let r=0;r<this.rows;r++)for(let o=0;o<this.columns;o++)this.set(r,o,this.get(r,o)+e.get(r,o));return this},n.add=function(e,r){return new t(e).add(r)},n.prototype.sub=function(e){return typeof e=="number"?this.subS(e):this.subM(e)},n.prototype.subS=function(e){for(let r=0;r<this.rows;r++)for(let o=0;o<this.columns;o++)this.set(r,o,this.get(r,o)-e);return this},n.prototype.subM=function(e){if(e=t.checkMatrix(e),this.rows!==e.rows||this.columns!==e.columns)throw new RangeError("Matrices dimensions must be equal");for(let r=0;r<this.rows;r++)for(let o=0;o<this.columns;o++)this.set(r,o,this.get(r,o)-e.get(r,o));return this},n.sub=function(e,r){return new t(e).sub(r)},n.prototype.subtract=n.prototype.sub,n.prototype.subtractS=n.prototype.subS,n.prototype.subtractM=n.prototype.subM,n.subtract=n.sub,n.prototype.mul=function(e){return typeof e=="number"?this.mulS(e):this.mulM(e)},n.prototype.mulS=function(e){for(let r=0;r<this.rows;r++)for(let o=0;o<this.columns;o++)this.set(r,o,this.get(r,o)*e);return this},n.prototype.mulM=function(e){if(e=t.checkMatrix(e),this.rows!==e.rows||this.columns!==e.columns)throw new RangeError("Matrices dimensions must be equal");for(let r=0;r<this.rows;r++)for(let o=0;o<this.columns;o++)this.set(r,o,this.get(r,o)*e.get(r,o));return this},n.mul=function(e,r){return new t(e).mul(r)},n.prototype.multiply=n.prototype.mul,n.prototype.multiplyS=n.prototype.mulS,n.prototype.multiplyM=n.prototype.mulM,n.multiply=n.mul,n.prototype.div=function(e){return typeof e=="number"?this.divS(e):this.divM(e)},n.prototype.divS=function(e){for(let r=0;r<this.rows;r++)for(let o=0;o<this.columns;o++)this.set(r,o,this.get(r,o)/e);return this},n.prototype.divM=function(e){if(e=t.checkMatrix(e),this.rows!==e.rows||this.columns!==e.columns)throw new RangeError("Matrices dimensions must be equal");for(let r=0;r<this.rows;r++)for(let o=0;o<this.columns;o++)this.set(r,o,this.get(r,o)/e.get(r,o));return this},n.div=function(e,r){return new t(e).div(r)},n.prototype.divide=n.prototype.div,n.prototype.divideS=n.prototype.divS,n.prototype.divideM=n.prototype.divM,n.divide=n.div,n.prototype.mod=function(e){return typeof e=="number"?this.modS(e):this.modM(e)},n.prototype.modS=function(e){for(let r=0;r<this.rows;r++)for(let o=0;o<this.columns;o++)this.set(r,o,this.get(r,o)%e);return this},n.prototype.modM=function(e){if(e=t.checkMatrix(e),this.rows!==e.rows||this.columns!==e.columns)throw new RangeError("Matrices dimensions must be equal");for(let r=0;r<this.rows;r++)for(let o=0;o<this.columns;o++)this.set(r,o,this.get(r,o)%e.get(r,o));return this},n.mod=function(e,r){return new t(e).mod(r)},n.prototype.modulus=n.prototype.mod,n.prototype.modulusS=n.prototype.modS,n.prototype.modulusM=n.prototype.modM,n.modulus=n.mod,n.prototype.and=function(e){return typeof e=="number"?this.andS(e):this.andM(e)},n.prototype.andS=function(e){for(let r=0;r<this.rows;r++)for(let o=0;o<this.columns;o++)this.set(r,o,this.get(r,o)&e);return this},n.prototype.andM=function(e){if(e=t.checkMatrix(e),this.rows!==e.rows||this.columns!==e.columns)throw new RangeError("Matrices dimensions must be equal");for(let r=0;r<this.rows;r++)for(let o=0;o<this.columns;o++)this.set(r,o,this.get(r,o)&e.get(r,o));return this},n.and=function(e,r){return new t(e).and(r)},n.prototype.or=function(e){return typeof e=="number"?this.orS(e):this.orM(e)},n.prototype.orS=function(e){for(let r=0;r<this.rows;r++)for(let o=0;o<this.columns;o++)this.set(r,o,this.get(r,o)|e);return this},n.prototype.orM=function(e){if(e=t.checkMatrix(e),this.rows!==e.rows||this.columns!==e.columns)throw new RangeError("Matrices dimensions must be equal");for(let r=0;r<this.rows;r++)for(let o=0;o<this.columns;o++)this.set(r,o,this.get(r,o)|e.get(r,o));return this},n.or=function(e,r){return new t(e).or(r)},n.prototype.xor=function(e){return typeof e=="number"?this.xorS(e):this.xorM(e)},n.prototype.xorS=function(e){for(let r=0;r<this.rows;r++)for(let o=0;o<this.columns;o++)this.set(r,o,this.get(r,o)^e);return this},n.prototype.xorM=function(e){if(e=t.checkMatrix(e),this.rows!==e.rows||this.columns!==e.columns)throw new RangeError("Matrices dimensions must be equal");for(let r=0;r<this.rows;r++)for(let o=0;o<this.columns;o++)this.set(r,o,this.get(r,o)^e.get(r,o));return this},n.xor=function(e,r){return new t(e).xor(r)},n.prototype.leftShift=function(e){return typeof e=="number"?this.leftShiftS(e):this.leftShiftM(e)},n.prototype.leftShiftS=function(e){for(let r=0;r<this.rows;r++)for(let o=0;o<this.columns;o++)this.set(r,o,this.get(r,o)<<e);return this},n.prototype.leftShiftM=function(e){if(e=t.checkMatrix(e),this.rows!==e.rows||this.columns!==e.columns)throw new RangeError("Matrices dimensions must be equal");for(let r=0;r<this.rows;r++)for(let o=0;o<this.columns;o++)this.set(r,o,this.get(r,o)<<e.get(r,o));return this},n.leftShift=function(e,r){return new t(e).leftShift(r)},n.prototype.signPropagatingRightShift=function(e){return typeof e=="number"?this.signPropagatingRightShiftS(e):this.signPropagatingRightShiftM(e)},n.prototype.signPropagatingRightShiftS=function(e){for(let r=0;r<this.rows;r++)for(let o=0;o<this.columns;o++)this.set(r,o,this.get(r,o)>>e);return this},n.prototype.signPropagatingRightShiftM=function(e){if(e=t.checkMatrix(e),this.rows!==e.rows||this.columns!==e.columns)throw new RangeError("Matrices dimensions must be equal");for(let r=0;r<this.rows;r++)for(let o=0;o<this.columns;o++)this.set(r,o,this.get(r,o)>>e.get(r,o));return this},n.signPropagatingRightShift=function(e,r){return new t(e).signPropagatingRightShift(r)},n.prototype.rightShift=function(e){return typeof e=="number"?this.rightShiftS(e):this.rightShiftM(e)},n.prototype.rightShiftS=function(e){for(let r=0;r<this.rows;r++)for(let o=0;o<this.columns;o++)this.set(r,o,this.get(r,o)>>>e);return this},n.prototype.rightShiftM=function(e){if(e=t.checkMatrix(e),this.rows!==e.rows||this.columns!==e.columns)throw new RangeError("Matrices dimensions must be equal");for(let r=0;r<this.rows;r++)for(let o=0;o<this.columns;o++)this.set(r,o,this.get(r,o)>>>e.get(r,o));return this},n.rightShift=function(e,r){return new t(e).rightShift(r)},n.prototype.zeroFillRightShift=n.prototype.rightShift,n.prototype.zeroFillRightShiftS=n.prototype.rightShiftS,n.prototype.zeroFillRightShiftM=n.prototype.rightShiftM,n.zeroFillRightShift=n.rightShift,n.prototype.not=function(){for(let e=0;e<this.rows;e++)for(let r=0;r<this.columns;r++)this.set(e,r,~this.get(e,r));return this},n.not=function(e){return new t(e).not()},n.prototype.abs=function(){for(let e=0;e<this.rows;e++)for(let r=0;r<this.columns;r++)this.set(e,r,Math.abs(this.get(e,r)));return this},n.abs=function(e){return new t(e).abs()},n.prototype.acos=function(){for(let e=0;e<this.rows;e++)for(let r=0;r<this.columns;r++)this.set(e,r,Math.acos(this.get(e,r)));return this},n.acos=function(e){return new t(e).acos()},n.prototype.acosh=function(){for(let e=0;e<this.rows;e++)for(let r=0;r<this.columns;r++)this.set(e,r,Math.acosh(this.get(e,r)));return this},n.acosh=function(e){return new t(e).acosh()},n.prototype.asin=function(){for(let e=0;e<this.rows;e++)for(let r=0;r<this.columns;r++)this.set(e,r,Math.asin(this.get(e,r)));return this},n.asin=function(e){return new t(e).asin()},n.prototype.asinh=function(){for(let e=0;e<this.rows;e++)for(let r=0;r<this.columns;r++)this.set(e,r,Math.asinh(this.get(e,r)));return this},n.asinh=function(e){return new t(e).asinh()},n.prototype.atan=function(){for(let e=0;e<this.rows;e++)for(let r=0;r<this.columns;r++)this.set(e,r,Math.atan(this.get(e,r)));return this},n.atan=function(e){return new t(e).atan()},n.prototype.atanh=function(){for(let e=0;e<this.rows;e++)for(let r=0;r<this.columns;r++)this.set(e,r,Math.atanh(this.get(e,r)));return this},n.atanh=function(e){return new t(e).atanh()},n.prototype.cbrt=function(){for(let e=0;e<this.rows;e++)for(let r=0;r<this.columns;r++)this.set(e,r,Math.cbrt(this.get(e,r)));return this},n.cbrt=function(e){return new t(e).cbrt()},n.prototype.ceil=function(){for(let e=0;e<this.rows;e++)for(let r=0;r<this.columns;r++)this.set(e,r,Math.ceil(this.get(e,r)));return this},n.ceil=function(e){return new t(e).ceil()},n.prototype.clz32=function(){for(let e=0;e<this.rows;e++)for(let r=0;r<this.columns;r++)this.set(e,r,Math.clz32(this.get(e,r)));return this},n.clz32=function(e){return new t(e).clz32()},n.prototype.cos=function(){for(let e=0;e<this.rows;e++)for(let r=0;r<this.columns;r++)this.set(e,r,Math.cos(this.get(e,r)));return this},n.cos=function(e){return new t(e).cos()},n.prototype.cosh=function(){for(let e=0;e<this.rows;e++)for(let r=0;r<this.columns;r++)this.set(e,r,Math.cosh(this.get(e,r)));return this},n.cosh=function(e){return new t(e).cosh()},n.prototype.exp=function(){for(let e=0;e<this.rows;e++)for(let r=0;r<this.columns;r++)this.set(e,r,Math.exp(this.get(e,r)));return this},n.exp=function(e){return new t(e).exp()},n.prototype.expm1=function(){for(let e=0;e<this.rows;e++)for(let r=0;r<this.columns;r++)this.set(e,r,Math.expm1(this.get(e,r)));return this},n.expm1=function(e){return new t(e).expm1()},n.prototype.floor=function(){for(let e=0;e<this.rows;e++)for(let r=0;r<this.columns;r++)this.set(e,r,Math.floor(this.get(e,r)));return this},n.floor=function(e){return new t(e).floor()},n.prototype.fround=function(){for(let e=0;e<this.rows;e++)for(let r=0;r<this.columns;r++)this.set(e,r,Math.fround(this.get(e,r)));return this},n.fround=function(e){return new t(e).fround()},n.prototype.log=function(){for(let e=0;e<this.rows;e++)for(let r=0;r<this.columns;r++)this.set(e,r,Math.log(this.get(e,r)));return this},n.log=function(e){return new t(e).log()},n.prototype.log1p=function(){for(let e=0;e<this.rows;e++)for(let r=0;r<this.columns;r++)this.set(e,r,Math.log1p(this.get(e,r)));return this},n.log1p=function(e){return new t(e).log1p()},n.prototype.log10=function(){for(let e=0;e<this.rows;e++)for(let r=0;r<this.columns;r++)this.set(e,r,Math.log10(this.get(e,r)));return this},n.log10=function(e){return new t(e).log10()},n.prototype.log2=function(){for(let e=0;e<this.rows;e++)for(let r=0;r<this.columns;r++)this.set(e,r,Math.log2(this.get(e,r)));return this},n.log2=function(e){return new t(e).log2()},n.prototype.round=function(){for(let e=0;e<this.rows;e++)for(let r=0;r<this.columns;r++)this.set(e,r,Math.round(this.get(e,r)));return this},n.round=function(e){return new t(e).round()},n.prototype.sign=function(){for(let e=0;e<this.rows;e++)for(let r=0;r<this.columns;r++)this.set(e,r,Math.sign(this.get(e,r)));return this},n.sign=function(e){return new t(e).sign()},n.prototype.sin=function(){for(let e=0;e<this.rows;e++)for(let r=0;r<this.columns;r++)this.set(e,r,Math.sin(this.get(e,r)));return this},n.sin=function(e){return new t(e).sin()},n.prototype.sinh=function(){for(let e=0;e<this.rows;e++)for(let r=0;r<this.columns;r++)this.set(e,r,Math.sinh(this.get(e,r)));return this},n.sinh=function(e){return new t(e).sinh()},n.prototype.sqrt=function(){for(let e=0;e<this.rows;e++)for(let r=0;r<this.columns;r++)this.set(e,r,Math.sqrt(this.get(e,r)));return this},n.sqrt=function(e){return new t(e).sqrt()},n.prototype.tan=function(){for(let e=0;e<this.rows;e++)for(let r=0;r<this.columns;r++)this.set(e,r,Math.tan(this.get(e,r)));return this},n.tan=function(e){return new t(e).tan()},n.prototype.tanh=function(){for(let e=0;e<this.rows;e++)for(let r=0;r<this.columns;r++)this.set(e,r,Math.tanh(this.get(e,r)));return this},n.tanh=function(e){return new t(e).tanh()},n.prototype.trunc=function(){for(let e=0;e<this.rows;e++)for(let r=0;r<this.columns;r++)this.set(e,r,Math.trunc(this.get(e,r)));return this},n.trunc=function(e){return new t(e).trunc()},n.pow=function(e,r){return new t(e).pow(r)},n.prototype.pow=function(e){return typeof e=="number"?this.powS(e):this.powM(e)},n.prototype.powS=function(e){for(let r=0;r<this.rows;r++)for(let o=0;o<this.columns;o++)this.set(r,o,Math.pow(this.get(r,o),e));return this},n.prototype.powM=function(e){if(e=t.checkMatrix(e),this.rows!==e.rows||this.columns!==e.columns)throw new RangeError("Matrices dimensions must be equal");for(let r=0;r<this.rows;r++)for(let o=0;o<this.columns;o++)this.set(r,o,Math.pow(this.get(r,o),e.get(r,o)));return this}}function Se(n,t,e){let r=e?n.rows:n.rows-1;if(t<0||t>r)throw new RangeError("Row index out of range")}function Re(n,t,e){let r=e?n.columns:n.columns-1;if(t<0||t>r)throw new RangeError("Column index out of range")}function sr(n,t){if(t.to1DArray&&(t=t.to1DArray()),t.length!==n.columns)throw new RangeError("vector size must be the same as the number of columns");return t}function or(n,t){if(t.to1DArray&&(t=t.to1DArray()),t.length!==n.rows)throw new RangeError("vector size must be the same as the number of rows");return t}function $a(n,t){if(!ce.isAnyArray(t))throw new TypeError("row indices must be an array");for(let e=0;e<t.length;e++)if(t[e]<0||t[e]>=n.rows)throw new RangeError("row indices are out of range")}function Ka(n,t){if(!ce.isAnyArray(t))throw new TypeError("column indices must be an array");for(let e=0;e<t.length;e++)if(t[e]<0||t[e]>=n.columns)throw new RangeError("column indices are out of range")}function wa(n,t,e,r,o){if(arguments.length!==5)throw new RangeError("expected 4 arguments");if(Qi("startRow",t),Qi("endRow",e),Qi("startColumn",r),Qi("endColumn",o),t>e||r>o||t<0||t>=n.rows||e<0||e>=n.rows||r<0||r>=n.columns||o<0||o>=n.columns)throw new RangeError("Submatrix indices are out of range")}function Js(n,t=0){let e=[];for(let r=0;r<n;r++)e.push(t);return e}function Qi(n,t){if(typeof t!="number")throw new TypeError(`${n} must be a number`)}function tr(n){if(n.isEmpty())throw new Error("Empty matrix has no elements to index")}function _0(n){let t=Js(n.rows);for(let e=0;e<n.rows;++e)for(let r=0;r<n.columns;++r)t[e]+=n.get(e,r);return t}function w0(n){let t=Js(n.columns);for(let e=0;e<n.rows;++e)for(let r=0;r<n.columns;++r)t[r]+=n.get(e,r);return t}function x0(n){let t=0;for(let e=0;e<n.rows;e++)for(let r=0;r<n.columns;r++)t+=n.get(e,r);return t}function E0(n){let t=Js(n.rows,1);for(let e=0;e<n.rows;++e)for(let r=0;r<n.columns;++r)t[e]*=n.get(e,r);return t}function k0(n){let t=Js(n.columns,1);for(let e=0;e<n.rows;++e)for(let r=0;r<n.columns;++r)t[r]*=n.get(e,r);return t}function I0(n){let t=1;for(let e=0;e<n.rows;e++)for(let r=0;r<n.columns;r++)t*=n.get(e,r);return t}function T0(n,t,e){const r=n.rows,o=n.columns,l=[];for(let f=0;f<r;f++){let c=0,d=0,p=0;for(let v=0;v<o;v++)p=n.get(f,v)-e[f],c+=p,d+=p*p;t?l.push((d-c*c/o)/(o-1)):l.push((d-c*c/o)/o)}return l}function M0(n,t,e){const r=n.rows,o=n.columns,l=[];for(let f=0;f<o;f++){let c=0,d=0,p=0;for(let v=0;v<r;v++)p=n.get(v,f)-e[f],c+=p,d+=p*p;t?l.push((d-c*c/r)/(r-1)):l.push((d-c*c/r)/r)}return l}function b0(n,t,e){const r=n.rows,o=n.columns,l=r*o;let f=0,c=0,d=0;for(let p=0;p<r;p++)for(let v=0;v<o;v++)d=n.get(p,v)-e,f+=d,c+=d*d;return t?(c-f*f/l)/(l-1):(c-f*f/l)/l}function N0(n,t){for(let e=0;e<n.rows;e++)for(let r=0;r<n.columns;r++)n.set(e,r,n.get(e,r)-t[e])}function S0(n,t){for(let e=0;e<n.rows;e++)for(let r=0;r<n.columns;r++)n.set(e,r,n.get(e,r)-t[r])}function R0(n,t){for(let e=0;e<n.rows;e++)for(let r=0;r<n.columns;r++)n.set(e,r,n.get(e,r)-t)}function C0(n){const t=[];for(let e=0;e<n.rows;e++){let r=0;for(let o=0;o<n.columns;o++)r+=Math.pow(n.get(e,o),2)/(n.columns-1);t.push(Math.sqrt(r))}return t}function P0(n,t){for(let e=0;e<n.rows;e++)for(let r=0;r<n.columns;r++)n.set(e,r,n.get(e,r)/t[e])}function L0(n){const t=[];for(let e=0;e<n.columns;e++){let r=0;for(let o=0;o<n.rows;o++)r+=Math.pow(n.get(o,e),2)/(n.rows-1);t.push(Math.sqrt(r))}return t}function A0(n,t){for(let e=0;e<n.rows;e++)for(let r=0;r<n.columns;r++)n.set(e,r,n.get(e,r)/t[r])}function O0(n){const t=n.size-1;let e=0;for(let r=0;r<n.columns;r++)for(let o=0;o<n.rows;o++)e+=Math.pow(n.get(o,r),2)/t;return Math.sqrt(e)}function D0(n,t){for(let e=0;e<n.rows;e++)for(let r=0;r<n.columns;r++)n.set(e,r,n.get(e,r)/t)}let Yt=class $t{static from1DArray(t,e,r){if(t*e!==r.length)throw new RangeError("data length does not match given dimensions");let o=new J(t,e);for(let l=0;l<t;l++)for(let f=0;f<e;f++)o.set(l,f,r[l*e+f]);return o}static rowVector(t){let e=new J(1,t.length);for(let r=0;r<t.length;r++)e.set(0,r,t[r]);return e}static columnVector(t){let e=new J(t.length,1);for(let r=0;r<t.length;r++)e.set(r,0,t[r]);return e}static zeros(t,e){return new J(t,e)}static ones(t,e){return new J(t,e).fill(1)}static rand(t,e,r={}){if(typeof r!="object")throw new TypeError("options must be an object");const{random:o=Math.random}=r;let l=new J(t,e);for(let f=0;f<t;f++)for(let c=0;c<e;c++)l.set(f,c,o());return l}static randInt(t,e,r={}){if(typeof r!="object")throw new TypeError("options must be an object");const{min:o=0,max:l=1e3,random:f=Math.random}=r;if(!Number.isInteger(o))throw new TypeError("min must be an integer");if(!Number.isInteger(l))throw new TypeError("max must be an integer");if(o>=l)throw new RangeError("min must be smaller than max");let c=l-o,d=new J(t,e);for(let p=0;p<t;p++)for(let v=0;v<e;v++){let y=o+Math.round(f()*c);d.set(p,v,y)}return d}static eye(t,e,r){e===void 0&&(e=t),r===void 0&&(r=1);let o=Math.min(t,e),l=this.zeros(t,e);for(let f=0;f<o;f++)l.set(f,f,r);return l}static diag(t,e,r){let o=t.length;e===void 0&&(e=o),r===void 0&&(r=e);let l=Math.min(o,e,r),f=this.zeros(e,r);for(let c=0;c<l;c++)f.set(c,c,t[c]);return f}static min(t,e){t=this.checkMatrix(t),e=this.checkMatrix(e);let r=t.rows,o=t.columns,l=new J(r,o);for(let f=0;f<r;f++)for(let c=0;c<o;c++)l.set(f,c,Math.min(t.get(f,c),e.get(f,c)));return l}static max(t,e){t=this.checkMatrix(t),e=this.checkMatrix(e);let r=t.rows,o=t.columns,l=new this(r,o);for(let f=0;f<r;f++)for(let c=0;c<o;c++)l.set(f,c,Math.max(t.get(f,c),e.get(f,c)));return l}static checkMatrix(t){return $t.isMatrix(t)?t:new J(t)}static isMatrix(t){return t!=null&&t.klass==="Matrix"}get size(){return this.rows*this.columns}apply(t){if(typeof t!="function")throw new TypeError("callback must be a function");for(let e=0;e<this.rows;e++)for(let r=0;r<this.columns;r++)t.call(this,e,r);return this}to1DArray(){let t=[];for(let e=0;e<this.rows;e++)for(let r=0;r<this.columns;r++)t.push(this.get(e,r));return t}to2DArray(){let t=[];for(let e=0;e<this.rows;e++){t.push([]);for(let r=0;r<this.columns;r++)t[e].push(this.get(e,r))}return t}toJSON(){return this.to2DArray()}isRowVector(){return this.rows===1}isColumnVector(){return this.columns===1}isVector(){return this.rows===1||this.columns===1}isSquare(){return this.rows===this.columns}isEmpty(){return this.rows===0||this.columns===0}isSymmetric(){if(this.isSquare()){for(let t=0;t<this.rows;t++)for(let e=0;e<=t;e++)if(this.get(t,e)!==this.get(e,t))return!1;return!0}return!1}isDistance(){if(!this.isSymmetric())return!1;for(let t=0;t<this.rows;t++)if(this.get(t,t)!==0)return!1;return!0}isEchelonForm(){let t=0,e=0,r=-1,o=!0,l=!1;for(;t<this.rows&&o;){for(e=0,l=!1;e<this.columns&&l===!1;)this.get(t,e)===0?e++:this.get(t,e)===1&&e>r?(l=!0,r=e):(o=!1,l=!0);t++}return o}isReducedEchelonForm(){let t=0,e=0,r=-1,o=!0,l=!1;for(;t<this.rows&&o;){for(e=0,l=!1;e<this.columns&&l===!1;)this.get(t,e)===0?e++:this.get(t,e)===1&&e>r?(l=!0,r=e):(o=!1,l=!0);for(let f=e+1;f<this.rows;f++)this.get(t,f)!==0&&(o=!1);t++}return o}echelonForm(){let t=this.clone(),e=0,r=0;for(;e<t.rows&&r<t.columns;){let o=e;for(let l=e;l<t.rows;l++)t.get(l,r)>t.get(o,r)&&(o=l);if(t.get(o,r)===0)r++;else{t.swapRows(e,o);let l=t.get(e,r);for(let f=r;f<t.columns;f++)t.set(e,f,t.get(e,f)/l);for(let f=e+1;f<t.rows;f++){let c=t.get(f,r)/t.get(e,r);t.set(f,r,0);for(let d=r+1;d<t.columns;d++)t.set(f,d,t.get(f,d)-t.get(e,d)*c)}e++,r++}}return t}reducedEchelonForm(){let t=this.echelonForm(),e=t.columns,r=t.rows,o=r-1;for(;o>=0;)if(t.maxRow(o)===0)o--;else{let l=0,f=!1;for(;l<r&&f===!1;)t.get(o,l)===1?f=!0:l++;for(let c=0;c<o;c++){let d=t.get(c,l);for(let p=l;p<e;p++){let v=t.get(c,p)-d*t.get(o,p);t.set(c,p,v)}}o--}return t}set(){throw new Error("set method is unimplemented")}get(){throw new Error("get method is unimplemented")}repeat(t={}){if(typeof t!="object")throw new TypeError("options must be an object");const{rows:e=1,columns:r=1}=t;if(!Number.isInteger(e)||e<=0)throw new TypeError("rows must be a positive integer");if(!Number.isInteger(r)||r<=0)throw new TypeError("columns must be a positive integer");let o=new J(this.rows*e,this.columns*r);for(let l=0;l<e;l++)for(let f=0;f<r;f++)o.setSubMatrix(this,this.rows*l,this.columns*f);return o}fill(t){for(let e=0;e<this.rows;e++)for(let r=0;r<this.columns;r++)this.set(e,r,t);return this}neg(){return this.mulS(-1)}getRow(t){Se(this,t);let e=[];for(let r=0;r<this.columns;r++)e.push(this.get(t,r));return e}getRowVector(t){return J.rowVector(this.getRow(t))}setRow(t,e){Se(this,t),e=sr(this,e);for(let r=0;r<this.columns;r++)this.set(t,r,e[r]);return this}swapRows(t,e){Se(this,t),Se(this,e);for(let r=0;r<this.columns;r++){let o=this.get(t,r);this.set(t,r,this.get(e,r)),this.set(e,r,o)}return this}getColumn(t){Re(this,t);let e=[];for(let r=0;r<this.rows;r++)e.push(this.get(r,t));return e}getColumnVector(t){return J.columnVector(this.getColumn(t))}setColumn(t,e){Re(this,t),e=or(this,e);for(let r=0;r<this.rows;r++)this.set(r,t,e[r]);return this}swapColumns(t,e){Re(this,t),Re(this,e);for(let r=0;r<this.rows;r++){let o=this.get(r,t);this.set(r,t,this.get(r,e)),this.set(r,e,o)}return this}addRowVector(t){t=sr(this,t);for(let e=0;e<this.rows;e++)for(let r=0;r<this.columns;r++)this.set(e,r,this.get(e,r)+t[r]);return this}subRowVector(t){t=sr(this,t);for(let e=0;e<this.rows;e++)for(let r=0;r<this.columns;r++)this.set(e,r,this.get(e,r)-t[r]);return this}mulRowVector(t){t=sr(this,t);for(let e=0;e<this.rows;e++)for(let r=0;r<this.columns;r++)this.set(e,r,this.get(e,r)*t[r]);return this}divRowVector(t){t=sr(this,t);for(let e=0;e<this.rows;e++)for(let r=0;r<this.columns;r++)this.set(e,r,this.get(e,r)/t[r]);return this}addColumnVector(t){t=or(this,t);for(let e=0;e<this.rows;e++)for(let r=0;r<this.columns;r++)this.set(e,r,this.get(e,r)+t[e]);return this}subColumnVector(t){t=or(this,t);for(let e=0;e<this.rows;e++)for(let r=0;r<this.columns;r++)this.set(e,r,this.get(e,r)-t[e]);return this}mulColumnVector(t){t=or(this,t);for(let e=0;e<this.rows;e++)for(let r=0;r<this.columns;r++)this.set(e,r,this.get(e,r)*t[e]);return this}divColumnVector(t){t=or(this,t);for(let e=0;e<this.rows;e++)for(let r=0;r<this.columns;r++)this.set(e,r,this.get(e,r)/t[e]);return this}mulRow(t,e){Se(this,t);for(let r=0;r<this.columns;r++)this.set(t,r,this.get(t,r)*e);return this}mulColumn(t,e){Re(this,t);for(let r=0;r<this.rows;r++)this.set(r,t,this.get(r,t)*e);return this}max(t){if(this.isEmpty())return NaN;switch(t){case"row":{const e=new Array(this.rows).fill(Number.NEGATIVE_INFINITY);for(let r=0;r<this.rows;r++)for(let o=0;o<this.columns;o++)this.get(r,o)>e[r]&&(e[r]=this.get(r,o));return e}case"column":{const e=new Array(this.columns).fill(Number.NEGATIVE_INFINITY);for(let r=0;r<this.rows;r++)for(let o=0;o<this.columns;o++)this.get(r,o)>e[o]&&(e[o]=this.get(r,o));return e}case void 0:{let e=this.get(0,0);for(let r=0;r<this.rows;r++)for(let o=0;o<this.columns;o++)this.get(r,o)>e&&(e=this.get(r,o));return e}default:throw new Error(`invalid option: ${t}`)}}maxIndex(){tr(this);let t=this.get(0,0),e=[0,0];for(let r=0;r<this.rows;r++)for(let o=0;o<this.columns;o++)this.get(r,o)>t&&(t=this.get(r,o),e[0]=r,e[1]=o);return e}min(t){if(this.isEmpty())return NaN;switch(t){case"row":{const e=new Array(this.rows).fill(Number.POSITIVE_INFINITY);for(let r=0;r<this.rows;r++)for(let o=0;o<this.columns;o++)this.get(r,o)<e[r]&&(e[r]=this.get(r,o));return e}case"column":{const e=new Array(this.columns).fill(Number.POSITIVE_INFINITY);for(let r=0;r<this.rows;r++)for(let o=0;o<this.columns;o++)this.get(r,o)<e[o]&&(e[o]=this.get(r,o));return e}case void 0:{let e=this.get(0,0);for(let r=0;r<this.rows;r++)for(let o=0;o<this.columns;o++)this.get(r,o)<e&&(e=this.get(r,o));return e}default:throw new Error(`invalid option: ${t}`)}}minIndex(){tr(this);let t=this.get(0,0),e=[0,0];for(let r=0;r<this.rows;r++)for(let o=0;o<this.columns;o++)this.get(r,o)<t&&(t=this.get(r,o),e[0]=r,e[1]=o);return e}maxRow(t){if(Se(this,t),this.isEmpty())return NaN;let e=this.get(t,0);for(let r=1;r<this.columns;r++)this.get(t,r)>e&&(e=this.get(t,r));return e}maxRowIndex(t){Se(this,t),tr(this);let e=this.get(t,0),r=[t,0];for(let o=1;o<this.columns;o++)this.get(t,o)>e&&(e=this.get(t,o),r[1]=o);return r}minRow(t){if(Se(this,t),this.isEmpty())return NaN;let e=this.get(t,0);for(let r=1;r<this.columns;r++)this.get(t,r)<e&&(e=this.get(t,r));return e}minRowIndex(t){Se(this,t),tr(this);let e=this.get(t,0),r=[t,0];for(let o=1;o<this.columns;o++)this.get(t,o)<e&&(e=this.get(t,o),r[1]=o);return r}maxColumn(t){if(Re(this,t),this.isEmpty())return NaN;let e=this.get(0,t);for(let r=1;r<this.rows;r++)this.get(r,t)>e&&(e=this.get(r,t));return e}maxColumnIndex(t){Re(this,t),tr(this);let e=this.get(0,t),r=[0,t];for(let o=1;o<this.rows;o++)this.get(o,t)>e&&(e=this.get(o,t),r[0]=o);return r}minColumn(t){if(Re(this,t),this.isEmpty())return NaN;let e=this.get(0,t);for(let r=1;r<this.rows;r++)this.get(r,t)<e&&(e=this.get(r,t));return e}minColumnIndex(t){Re(this,t),tr(this);let e=this.get(0,t),r=[0,t];for(let o=1;o<this.rows;o++)this.get(o,t)<e&&(e=this.get(o,t),r[0]=o);return r}diag(){let t=Math.min(this.rows,this.columns),e=[];for(let r=0;r<t;r++)e.push(this.get(r,r));return e}norm(t="frobenius"){switch(t){case"max":return this.max();case"frobenius":return Math.sqrt(this.dot(this));default:throw new RangeError(`unknown norm type: ${t}`)}}cumulativeSum(){let t=0;for(let e=0;e<this.rows;e++)for(let r=0;r<this.columns;r++)t+=this.get(e,r),this.set(e,r,t);return this}dot(t){$t.isMatrix(t)&&(t=t.to1DArray());let e=this.to1DArray();if(e.length!==t.length)throw new RangeError("vectors do not have the same size");let r=0;for(let o=0;o<e.length;o++)r+=e[o]*t[o];return r}mmul(t){t=J.checkMatrix(t);let e=this.rows,r=this.columns,o=t.columns,l=new J(e,o),f=new Float64Array(r);for(let c=0;c<o;c++){for(let d=0;d<r;d++)f[d]=t.get(d,c);for(let d=0;d<e;d++){let p=0;for(let v=0;v<r;v++)p+=this.get(d,v)*f[v];l.set(d,c,p)}}return l}strassen2x2(t){t=J.checkMatrix(t);let e=new J(2,2);const r=this.get(0,0),o=t.get(0,0),l=this.get(0,1),f=t.get(0,1),c=this.get(1,0),d=t.get(1,0),p=this.get(1,1),v=t.get(1,1),y=(r+p)*(o+v),x=(c+p)*o,M=r*(f-v),I=p*(d-o),O=(r+l)*v,D=(c-r)*(o+f),S=(l-p)*(d+v),F=y+I-O+S,w=M+O,T=x+I,N=y-x+M+D;return e.set(0,0,F),e.set(0,1,w),e.set(1,0,T),e.set(1,1,N),e}strassen3x3(t){t=J.checkMatrix(t);let e=new J(3,3);const r=this.get(0,0),o=this.get(0,1),l=this.get(0,2),f=this.get(1,0),c=this.get(1,1),d=this.get(1,2),p=this.get(2,0),v=this.get(2,1),y=this.get(2,2),x=t.get(0,0),M=t.get(0,1),I=t.get(0,2),O=t.get(1,0),D=t.get(1,1),S=t.get(1,2),F=t.get(2,0),w=t.get(2,1),T=t.get(2,2),N=(r+o+l-f-c-v-y)*D,G=(r-f)*(-M+D),A=c*(-x+M+O-D-S-F+T),L=(-r+f+c)*(x-M+D),E=(f+c)*(-x+M),C=r*x,B=(-r+p+v)*(x-I+S),j=(-r+p)*(I-S),st=(p+v)*(-x+I),Y=(r+o+l-c-d-p-v)*S,Q=v*(-x+I+O-D-S-F+w),tt=(-l+v+y)*(D+F-w),vt=(l-y)*(D-w),kt=l*F,Tt=(v+y)*(-F+w),Z=(-l+c+d)*(S+F-T),Ot=(l-d)*(S-T),it=(c+d)*(-F+T),Mt=o*O,ot=d*w,qt=f*I,Wt=p*M,Ii=y*T,U=C+kt+Mt,ho=N+L+E+C+tt+kt+Tt,Dt=C+B+st+Y+kt+Z+it,at=G+A+L+C+kt+Z+Ot,R=G+L+E+C+ot,Ee=kt+Z+Ot+it+qt,Wn=C+B+j+Q+tt+vt+kt,ze=tt+vt+kt+Tt+Wt,Ti=C+B+j+st+Ii;return e.set(0,0,U),e.set(0,1,ho),e.set(0,2,Dt),e.set(1,0,at),e.set(1,1,R),e.set(1,2,Ee),e.set(2,0,Wn),e.set(2,1,ze),e.set(2,2,Ti),e}mmulStrassen(t){t=J.checkMatrix(t);let e=this.clone(),r=e.rows,o=e.columns,l=t.rows,f=t.columns;o!==l&&console.warn(`Multiplying ${r} x ${o} and ${l} x ${f} matrix: dimensions do not match.`);function c(y,x,M){let I=y.rows,O=y.columns;if(I===x&&O===M)return y;{let D=$t.zeros(x,M);return D=D.setSubMatrix(y,0,0),D}}let d=Math.max(r,l),p=Math.max(o,f);e=c(e,d,p),t=c(t,d,p);function v(y,x,M,I){if(M<=512||I<=512)return y.mmul(x);M%2===1&&I%2===1?(y=c(y,M+1,I+1),x=c(x,M+1,I+1)):M%2===1?(y=c(y,M+1,I),x=c(x,M+1,I)):I%2===1&&(y=c(y,M,I+1),x=c(x,M,I+1));let O=parseInt(y.rows/2,10),D=parseInt(y.columns/2,10),S=y.subMatrix(0,O-1,0,D-1),F=x.subMatrix(0,O-1,0,D-1),w=y.subMatrix(0,O-1,D,y.columns-1),T=x.subMatrix(0,O-1,D,x.columns-1),N=y.subMatrix(O,y.rows-1,0,D-1),G=x.subMatrix(O,x.rows-1,0,D-1),A=y.subMatrix(O,y.rows-1,D,y.columns-1),L=x.subMatrix(O,x.rows-1,D,x.columns-1),E=v($t.add(S,A),$t.add(F,L),O,D),C=v($t.add(N,A),F,O,D),B=v(S,$t.sub(T,L),O,D),j=v(A,$t.sub(G,F),O,D),st=v($t.add(S,w),L,O,D),Y=v($t.sub(N,S),$t.add(F,T),O,D),Q=v($t.sub(w,A),$t.add(G,L),O,D),tt=$t.add(E,j);tt.sub(st),tt.add(Q);let vt=$t.add(B,st),kt=$t.add(C,j),Tt=$t.sub(E,C);Tt.add(B),Tt.add(Y);let Z=$t.zeros(2*tt.rows,2*tt.columns);return Z=Z.setSubMatrix(tt,0,0),Z=Z.setSubMatrix(vt,tt.rows,0),Z=Z.setSubMatrix(kt,0,tt.columns),Z=Z.setSubMatrix(Tt,tt.rows,tt.columns),Z.subMatrix(0,M-1,0,I-1)}return v(e,t,d,p)}scaleRows(t={}){if(typeof t!="object")throw new TypeError("options must be an object");const{min:e=0,max:r=1}=t;if(!Number.isFinite(e))throw new TypeError("min must be a number");if(!Number.isFinite(r))throw new TypeError("max must be a number");if(e>=r)throw new RangeError("min must be smaller than max");let o=new J(this.rows,this.columns);for(let l=0;l<this.rows;l++){const f=this.getRow(l);f.length>0&&ih(f,{min:e,max:r,output:f}),o.setRow(l,f)}return o}scaleColumns(t={}){if(typeof t!="object")throw new TypeError("options must be an object");const{min:e=0,max:r=1}=t;if(!Number.isFinite(e))throw new TypeError("min must be a number");if(!Number.isFinite(r))throw new TypeError("max must be a number");if(e>=r)throw new RangeError("min must be smaller than max");let o=new J(this.rows,this.columns);for(let l=0;l<this.columns;l++){const f=this.getColumn(l);f.length&&ih(f,{min:e,max:r,output:f}),o.setColumn(l,f)}return o}flipRows(){const t=Math.ceil(this.columns/2);for(let e=0;e<this.rows;e++)for(let r=0;r<t;r++){let o=this.get(e,r),l=this.get(e,this.columns-1-r);this.set(e,r,l),this.set(e,this.columns-1-r,o)}return this}flipColumns(){const t=Math.ceil(this.rows/2);for(let e=0;e<this.columns;e++)for(let r=0;r<t;r++){let o=this.get(r,e),l=this.get(this.rows-1-r,e);this.set(r,e,l),this.set(this.rows-1-r,e,o)}return this}kroneckerProduct(t){t=J.checkMatrix(t);let e=this.rows,r=this.columns,o=t.rows,l=t.columns,f=new J(e*o,r*l);for(let c=0;c<e;c++)for(let d=0;d<r;d++)for(let p=0;p<o;p++)for(let v=0;v<l;v++)f.set(o*c+p,l*d+v,this.get(c,d)*t.get(p,v));return f}kroneckerSum(t){if(t=J.checkMatrix(t),!this.isSquare()||!t.isSquare())throw new Error("Kronecker Sum needs two Square Matrices");let e=this.rows,r=t.rows,o=this.kroneckerProduct(J.eye(r,r)),l=J.eye(e,e).kroneckerProduct(t);return o.add(l)}transpose(){let t=new J(this.columns,this.rows);for(let e=0;e<this.rows;e++)for(let r=0;r<this.columns;r++)t.set(r,e,this.get(e,r));return t}sortRows(t=oh){for(let e=0;e<this.rows;e++)this.setRow(e,this.getRow(e).sort(t));return this}sortColumns(t=oh){for(let e=0;e<this.columns;e++)this.setColumn(e,this.getColumn(e).sort(t));return this}subMatrix(t,e,r,o){wa(this,t,e,r,o);let l=new J(e-t+1,o-r+1);for(let f=t;f<=e;f++)for(let c=r;c<=o;c++)l.set(f-t,c-r,this.get(f,c));return l}subMatrixRow(t,e,r){if(e===void 0&&(e=0),r===void 0&&(r=this.columns-1),e>r||e<0||e>=this.columns||r<0||r>=this.columns)throw new RangeError("Argument out of range");let o=new J(t.length,r-e+1);for(let l=0;l<t.length;l++)for(let f=e;f<=r;f++){if(t[l]<0||t[l]>=this.rows)throw new RangeError(`Row index out of range: ${t[l]}`);o.set(l,f-e,this.get(t[l],f))}return o}subMatrixColumn(t,e,r){if(e===void 0&&(e=0),r===void 0&&(r=this.rows-1),e>r||e<0||e>=this.rows||r<0||r>=this.rows)throw new RangeError("Argument out of range");let o=new J(r-e+1,t.length);for(let l=0;l<t.length;l++)for(let f=e;f<=r;f++){if(t[l]<0||t[l]>=this.columns)throw new RangeError(`Column index out of range: ${t[l]}`);o.set(f-e,l,this.get(f,t[l]))}return o}setSubMatrix(t,e,r){if(t=J.checkMatrix(t),t.isEmpty())return this;let o=e+t.rows-1,l=r+t.columns-1;wa(this,e,o,r,l);for(let f=0;f<t.rows;f++)for(let c=0;c<t.columns;c++)this.set(e+f,r+c,t.get(f,c));return this}selection(t,e){$a(this,t),Ka(this,e);let r=new J(t.length,e.length);for(let o=0;o<t.length;o++){let l=t[o];for(let f=0;f<e.length;f++){let c=e[f];r.set(o,f,this.get(l,c))}}return r}trace(){let t=Math.min(this.rows,this.columns),e=0;for(let r=0;r<t;r++)e+=this.get(r,r);return e}clone(){return this.constructor.copy(this,new J(this.rows,this.columns))}static copy(t,e){for(const[r,o,l]of t.entries())e.set(r,o,l);return e}sum(t){switch(t){case"row":return _0(this);case"column":return w0(this);case void 0:return x0(this);default:throw new Error(`invalid option: ${t}`)}}product(t){switch(t){case"row":return E0(this);case"column":return k0(this);case void 0:return I0(this);default:throw new Error(`invalid option: ${t}`)}}mean(t){const e=this.sum(t);switch(t){case"row":{for(let r=0;r<this.rows;r++)e[r]/=this.columns;return e}case"column":{for(let r=0;r<this.columns;r++)e[r]/=this.rows;return e}case void 0:return e/this.size;default:throw new Error(`invalid option: ${t}`)}}variance(t,e={}){if(typeof t=="object"&&(e=t,t=void 0),typeof e!="object")throw new TypeError("options must be an object");const{unbiased:r=!0,mean:o=this.mean(t)}=e;if(typeof r!="boolean")throw new TypeError("unbiased must be a boolean");switch(t){case"row":{if(!ce.isAnyArray(o))throw new TypeError("mean must be an array");return T0(this,r,o)}case"column":{if(!ce.isAnyArray(o))throw new TypeError("mean must be an array");return M0(this,r,o)}case void 0:{if(typeof o!="number")throw new TypeError("mean must be a number");return b0(this,r,o)}default:throw new Error(`invalid option: ${t}`)}}standardDeviation(t,e){typeof t=="object"&&(e=t,t=void 0);const r=this.variance(t,e);if(t===void 0)return Math.sqrt(r);for(let o=0;o<r.length;o++)r[o]=Math.sqrt(r[o]);return r}center(t,e={}){if(typeof t=="object"&&(e=t,t=void 0),typeof e!="object")throw new TypeError("options must be an object");const{center:r=this.mean(t)}=e;switch(t){case"row":{if(!ce.isAnyArray(r))throw new TypeError("center must be an array");return N0(this,r),this}case"column":{if(!ce.isAnyArray(r))throw new TypeError("center must be an array");return S0(this,r),this}case void 0:{if(typeof r!="number")throw new TypeError("center must be a number");return R0(this,r),this}default:throw new Error(`invalid option: ${t}`)}}scale(t,e={}){if(typeof t=="object"&&(e=t,t=void 0),typeof e!="object")throw new TypeError("options must be an object");let r=e.scale;switch(t){case"row":{if(r===void 0)r=C0(this);else if(!ce.isAnyArray(r))throw new TypeError("scale must be an array");return P0(this,r),this}case"column":{if(r===void 0)r=L0(this);else if(!ce.isAnyArray(r))throw new TypeError("scale must be an array");return A0(this,r),this}case void 0:{if(r===void 0)r=O0(this);else if(typeof r!="number")throw new TypeError("scale must be a number");return D0(this,r),this}default:throw new Error(`invalid option: ${t}`)}}toString(t){return Ef(this,t)}[Symbol.iterator](){return this.entries()}*entries(){for(let t=0;t<this.rows;t++)for(let e=0;e<this.columns;e++)yield[t,e,this.get(t,e)]}*values(){for(let t=0;t<this.rows;t++)for(let e=0;e<this.columns;e++)yield this.get(t,e)}};Yt.prototype.klass="Matrix";typeof Symbol<"u"&&(Yt.prototype[Symbol.for("nodejs.util.inspect.custom")]=p0);function oh(n,t){return n-t}function F0(n){return n.every(t=>typeof t=="number")}Yt.random=Yt.rand;Yt.randomInt=Yt.randInt;Yt.diagonal=Yt.diag;Yt.prototype.diagonal=Yt.prototype.diag;Yt.identity=Yt.eye;Yt.prototype.negate=Yt.prototype.neg;Yt.prototype.tensorProduct=Yt.prototype.kroneckerProduct;let J=class xa extends Yt{data;#t(t,e){if(this.data=[],Number.isInteger(e)&&e>=0)for(let r=0;r<t;r++)this.data.push(new Float64Array(e));else throw new TypeError("nColumns must be a positive integer");this.rows=t,this.columns=e}constructor(t,e){if(super(),xa.isMatrix(t))this.#t(t.rows,t.columns),xa.copy(t,this);else if(Number.isInteger(t)&&t>=0)this.#t(t,e);else if(ce.isAnyArray(t)){const r=t;if(t=r.length,e=t?r[0].length:0,typeof e!="number")throw new TypeError("Data must be a 2D array with at least one element");this.data=[];for(let o=0;o<t;o++){if(r[o].length!==e)throw new RangeError("Inconsistent array dimensions");if(!F0(r[o]))throw new TypeError("Input data contains non-numeric values");this.data.push(Float64Array.from(r[o]))}this.rows=t,this.columns=e}else throw new TypeError("First argument must be a positive number or an array")}set(t,e,r){return this.data[t][e]=r,this}get(t,e){return this.data[t][e]}removeRow(t){return Se(this,t),this.data.splice(t,1),this.rows-=1,this}addRow(t,e){return e===void 0&&(e=t,t=this.rows),Se(this,t,!0),e=Float64Array.from(sr(this,e)),this.data.splice(t,0,e),this.rows+=1,this}removeColumn(t){Re(this,t);for(let e=0;e<this.rows;e++){const r=new Float64Array(this.columns-1);for(let o=0;o<t;o++)r[o]=this.data[e][o];for(let o=t+1;o<this.columns;o++)r[o-1]=this.data[e][o];this.data[e]=r}return this.columns-=1,this}addColumn(t,e){typeof e>"u"&&(e=t,t=this.columns),Re(this,t,!0),e=or(this,e);for(let r=0;r<this.rows;r++){const o=new Float64Array(this.columns+1);let l=0;for(;l<t;l++)o[l]=this.data[r][l];for(o[l++]=e[r];l<this.columns+1;l++)o[l]=this.data[r][l-1];this.data[r]=o}return this.columns+=1,this}};y0(Yt,J);class _n extends Yt{#t;get size(){return this.#t.size}get rows(){return this.#t.rows}get columns(){return this.#t.columns}get diagonalSize(){return this.rows}static isSymmetricMatrix(t){return J.isMatrix(t)&&t.klassType==="SymmetricMatrix"}static zeros(t){return new this(t)}static ones(t){return new this(t).fill(1)}constructor(t){if(super(),J.isMatrix(t)){if(!t.isSymmetric())throw new TypeError("not symmetric data");this.#t=J.copy(t,new J(t.rows,t.rows))}else if(Number.isInteger(t)&&t>=0)this.#t=new J(t,t);else if(this.#t=new J(t),!this.isSymmetric())throw new TypeError("not symmetric data")}clone(){const t=new _n(this.diagonalSize);for(const[e,r,o]of this.upperRightEntries())t.set(e,r,o);return t}toMatrix(){return new J(this)}get(t,e){return this.#t.get(t,e)}set(t,e,r){return this.#t.set(t,e,r),this.#t.set(e,t,r),this}removeCross(t){return this.#t.removeRow(t),this.#t.removeColumn(t),this}addCross(t,e){e===void 0&&(e=t,t=this.diagonalSize);const r=e.slice();return r.splice(t,1),this.#t.addRow(t,r),this.#t.addColumn(t,e),this}applyMask(t){if(t.length!==this.diagonalSize)throw new RangeError("Mask size do not match with matrix size");const e=[];for(const[r,o]of t.entries())o||e.push(r);e.reverse();for(const r of e)this.removeCross(r);return this}toCompact(){const{diagonalSize:t}=this,e=new Array(t*(t+1)/2);for(let r=0,o=0,l=0;l<e.length;l++)e[l]=this.get(o,r),++r>=t&&(r=++o);return e}static fromCompact(t){const e=t.length,r=(Math.sqrt(8*e+1)-1)/2;if(!Number.isInteger(r))throw new TypeError(`This array is not a compact representation of a Symmetric Matrix, ${JSON.stringify(t)}`);const o=new _n(r);for(let l=0,f=0,c=0;c<e;c++)o.set(l,f,t[c]),++l>=r&&(l=++f);return o}*upperRightEntries(){for(let t=0,e=0;t<this.diagonalSize;void 0){const r=this.get(t,e);yield[t,e,r],++e>=this.diagonalSize&&(e=++t)}}*upperRightValues(){for(let t=0,e=0;t<this.diagonalSize;void 0)yield this.get(t,e),++e>=this.diagonalSize&&(e=++t)}}_n.prototype.klassType="SymmetricMatrix";class Qs extends _n{static isDistanceMatrix(t){return _n.isSymmetricMatrix(t)&&t.klassSubType==="DistanceMatrix"}constructor(t){if(super(t),!this.isDistance())throw new TypeError("Provided arguments do no produce a distance matrix")}set(t,e,r){return t===e&&(r=0),super.set(t,e,r)}addCross(t,e){return e===void 0&&(e=t,t=this.diagonalSize),e=e.slice(),e[t]=0,super.addCross(t,e)}toSymmetricMatrix(){return new _n(this)}clone(){const t=new Qs(this.diagonalSize);for(const[e,r,o]of this.upperRightEntries())e!==r&&t.set(e,r,o);return t}toCompact(){const{diagonalSize:t}=this,e=(t-1)*t/2,r=new Array(e);for(let o=1,l=0,f=0;f<r.length;f++)r[f]=this.get(l,o),++o>=t&&(o=++l+1);return r}static fromCompact(t){const e=t.length,r=(Math.sqrt(8*e+1)+1)/2;if(!Number.isInteger(r))throw new TypeError(`This array is not a compact representation of a DistanceMatrix, ${JSON.stringify(t)}`);const o=new this(r);for(let l=1,f=0,c=0;c<e;c++)o.set(l,f,t[c]),++l>=r&&(l=++f+1);return o}}Qs.prototype.klassSubType="DistanceMatrix";class dn extends Yt{constructor(t,e,r){super(),this.matrix=t,this.rows=e,this.columns=r}}class G0 extends dn{constructor(t,e){Re(t,e),super(t,t.rows,1),this.column=e}set(t,e,r){return this.matrix.set(t,this.column,r),this}get(t){return this.matrix.get(t,this.column)}}class B0 extends dn{constructor(t,e){Ka(t,e),super(t,t.rows,e.length),this.columnIndices=e}set(t,e,r){return this.matrix.set(t,this.columnIndices[e],r),this}get(t,e){return this.matrix.get(t,this.columnIndices[e])}}class z0 extends dn{constructor(t){super(t,t.rows,t.columns)}set(t,e,r){return this.matrix.set(t,this.columns-e-1,r),this}get(t,e){return this.matrix.get(t,this.columns-e-1)}}class q0 extends dn{constructor(t){super(t,t.rows,t.columns)}set(t,e,r){return this.matrix.set(this.rows-t-1,e,r),this}get(t,e){return this.matrix.get(this.rows-t-1,e)}}class U0 extends dn{constructor(t,e){Se(t,e),super(t,1,t.columns),this.row=e}set(t,e,r){return this.matrix.set(this.row,e,r),this}get(t,e){return this.matrix.get(this.row,e)}}class j0 extends dn{constructor(t,e){$a(t,e),super(t,e.length,t.columns),this.rowIndices=e}set(t,e,r){return this.matrix.set(this.rowIndices[t],e,r),this}get(t,e){return this.matrix.get(this.rowIndices[t],e)}}class cs extends dn{constructor(t,e,r){$a(t,e),Ka(t,r),super(t,e.length,r.length),this.rowIndices=e,this.columnIndices=r}set(t,e,r){return this.matrix.set(this.rowIndices[t],this.columnIndices[e],r),this}get(t,e){return this.matrix.get(this.rowIndices[t],this.columnIndices[e])}}class V0 extends dn{constructor(t,e,r,o,l){wa(t,e,r,o,l),super(t,r-e+1,l-o+1),this.startRow=e,this.startColumn=o}set(t,e,r){return this.matrix.set(this.startRow+t,this.startColumn+e,r),this}get(t,e){return this.matrix.get(this.startRow+t,this.startColumn+e)}}class Y0 extends dn{constructor(t){super(t,t.columns,t.rows)}set(t,e,r){return this.matrix.set(e,t,r),this}get(t,e){return this.matrix.get(e,t)}}class kf extends Yt{constructor(t,e={}){const{rows:r=1}=e;if(t.length%r!==0)throw new Error("the data length is not divisible by the number of rows");super(),this.rows=r,this.columns=t.length/r,this.data=t}set(t,e,r){let o=this._calculateIndex(t,e);return this.data[o]=r,this}get(t,e){let r=this._calculateIndex(t,e);return this.data[r]}_calculateIndex(t,e){return t*this.columns+e}}let we=class extends Yt{constructor(n){super(),this.data=n,this.rows=n.length,this.columns=n[0].length}set(n,t,e){return this.data[n][t]=e,this}get(n,t){return this.data[n][t]}};function W0(n,t){if(ce.isAnyArray(n))return n[0]&&ce.isAnyArray(n[0])?new we(n):new kf(n,t);throw new Error("the argument is not an array")}class to{constructor(t){t=we.checkMatrix(t);let e=t.clone(),r=e.rows,o=e.columns,l=new Float64Array(r),f=1,c,d,p,v,y,x,M,I,O;for(c=0;c<r;c++)l[c]=c;for(I=new Float64Array(r),d=0;d<o;d++){for(c=0;c<r;c++)I[c]=e.get(c,d);for(c=0;c<r;c++){for(O=Math.min(c,d),y=0,p=0;p<O;p++)y+=e.get(c,p)*I[p];I[c]-=y,e.set(c,d,I[c])}for(v=d,c=d+1;c<r;c++)Math.abs(I[c])>Math.abs(I[v])&&(v=c);if(v!==d){for(p=0;p<o;p++)x=e.get(v,p),e.set(v,p,e.get(d,p)),e.set(d,p,x);M=l[v],l[v]=l[d],l[d]=M,f=-f}if(d<r&&e.get(d,d)!==0)for(c=d+1;c<r;c++)e.set(c,d,e.get(c,d)/e.get(d,d))}this.LU=e,this.pivotVector=l,this.pivotSign=f}isSingular(){let t=this.LU,e=t.columns;for(let r=0;r<e;r++)if(t.get(r,r)===0)return!0;return!1}solve(t){t=J.checkMatrix(t);let e=this.LU;if(e.rows!==t.rows)throw new Error("Invalid matrix dimensions");if(this.isSingular())throw new Error("LU matrix is singular");let r=t.columns,o=t.subMatrixRow(this.pivotVector,0,r-1),l=e.columns,f,c,d;for(d=0;d<l;d++)for(f=d+1;f<l;f++)for(c=0;c<r;c++)o.set(f,c,o.get(f,c)-o.get(d,c)*e.get(f,d));for(d=l-1;d>=0;d--){for(c=0;c<r;c++)o.set(d,c,o.get(d,c)/e.get(d,d));for(f=0;f<d;f++)for(c=0;c<r;c++)o.set(f,c,o.get(f,c)-o.get(d,c)*e.get(f,d))}return o}get determinant(){let t=this.LU;if(!t.isSquare())throw new Error("Matrix must be square");let e=this.pivotSign,r=t.columns;for(let o=0;o<r;o++)e*=t.get(o,o);return e}get lowerTriangularMatrix(){let t=this.LU,e=t.rows,r=t.columns,o=new J(e,r);for(let l=0;l<e;l++)for(let f=0;f<r;f++)l>f?o.set(l,f,t.get(l,f)):l===f?o.set(l,f,1):o.set(l,f,0);return o}get upperTriangularMatrix(){let t=this.LU,e=t.rows,r=t.columns,o=new J(e,r);for(let l=0;l<e;l++)for(let f=0;f<r;f++)l<=f?o.set(l,f,t.get(l,f)):o.set(l,f,0);return o}get pivotPermutationVector(){return Array.from(this.pivotVector)}}function hn(n,t){let e=0;return Math.abs(n)>Math.abs(t)?(e=t/n,Math.abs(n)*Math.sqrt(1+e*e)):t!==0?(e=n/t,Math.abs(t)*Math.sqrt(1+e*e)):0}class Ja{constructor(t){t=we.checkMatrix(t);let e=t.clone(),r=t.rows,o=t.columns,l=new Float64Array(o),f,c,d,p;for(d=0;d<o;d++){let v=0;for(f=d;f<r;f++)v=hn(v,e.get(f,d));if(v!==0){for(e.get(d,d)<0&&(v=-v),f=d;f<r;f++)e.set(f,d,e.get(f,d)/v);for(e.set(d,d,e.get(d,d)+1),c=d+1;c<o;c++){for(p=0,f=d;f<r;f++)p+=e.get(f,d)*e.get(f,c);for(p=-p/e.get(d,d),f=d;f<r;f++)e.set(f,c,e.get(f,c)+p*e.get(f,d))}}l[d]=-v}this.QR=e,this.Rdiag=l}solve(t){t=J.checkMatrix(t);let e=this.QR,r=e.rows;if(t.rows!==r)throw new Error("Matrix row dimensions must agree");if(!this.isFullRank())throw new Error("Matrix is rank deficient");let o=t.columns,l=t.clone(),f=e.columns,c,d,p,v;for(p=0;p<f;p++)for(d=0;d<o;d++){for(v=0,c=p;c<r;c++)v+=e.get(c,p)*l.get(c,d);for(v=-v/e.get(p,p),c=p;c<r;c++)l.set(c,d,l.get(c,d)+v*e.get(c,p))}for(p=f-1;p>=0;p--){for(d=0;d<o;d++)l.set(p,d,l.get(p,d)/this.Rdiag[p]);for(c=0;c<p;c++)for(d=0;d<o;d++)l.set(c,d,l.get(c,d)-l.get(p,d)*e.get(c,p))}return l.subMatrix(0,f-1,0,o-1)}isFullRank(){let t=this.QR.columns;for(let e=0;e<t;e++)if(this.Rdiag[e]===0)return!1;return!0}get upperTriangularMatrix(){let t=this.QR,e=t.columns,r=new J(e,e),o,l;for(o=0;o<e;o++)for(l=0;l<e;l++)o<l?r.set(o,l,t.get(o,l)):o===l?r.set(o,l,this.Rdiag[o]):r.set(o,l,0);return r}get orthogonalMatrix(){let t=this.QR,e=t.rows,r=t.columns,o=new J(e,r),l,f,c,d;for(c=r-1;c>=0;c--){for(l=0;l<e;l++)o.set(l,c,0);for(o.set(c,c,1),f=c;f<r;f++)if(t.get(c,c)!==0){for(d=0,l=c;l<e;l++)d+=t.get(l,c)*o.get(l,f);for(d=-d/t.get(c,c),l=c;l<e;l++)o.set(l,f,o.get(l,f)+d*t.get(l,c))}}return o}}let kr=class{constructor(n,t={}){if(n=we.checkMatrix(n),n.isEmpty())throw new Error("Matrix must be non-empty");let e=n.rows,r=n.columns;const{computeLeftSingularVectors:o=!0,computeRightSingularVectors:l=!0,autoTranspose:f=!1}=t;let c=!!o,d=!!l,p=!1,v;if(e<r)if(!f)v=n.clone(),console.warn("Computing SVD on a matrix with more columns than rows. Consider enabling autoTranspose");else{v=n.transpose(),e=v.rows,r=v.columns,p=!0;let E=c;c=d,d=E}else v=n.clone();let y=Math.min(e,r),x=Math.min(e+1,r),M=new Float64Array(x),I=new J(e,y),O=new J(r,r),D=new Float64Array(r),S=new Float64Array(e),F=new Float64Array(x);for(let E=0;E<x;E++)F[E]=E;let w=Math.min(e-1,r),T=Math.max(0,Math.min(r-2,e)),N=Math.max(w,T);for(let E=0;E<N;E++){if(E<w){M[E]=0;for(let C=E;C<e;C++)M[E]=hn(M[E],v.get(C,E));if(M[E]!==0){v.get(E,E)<0&&(M[E]=-M[E]);for(let C=E;C<e;C++)v.set(C,E,v.get(C,E)/M[E]);v.set(E,E,v.get(E,E)+1)}M[E]=-M[E]}for(let C=E+1;C<r;C++){if(E<w&&M[E]!==0){let B=0;for(let j=E;j<e;j++)B+=v.get(j,E)*v.get(j,C);B=-B/v.get(E,E);for(let j=E;j<e;j++)v.set(j,C,v.get(j,C)+B*v.get(j,E))}D[C]=v.get(E,C)}if(c&&E<w)for(let C=E;C<e;C++)I.set(C,E,v.get(C,E));if(E<T){D[E]=0;for(let C=E+1;C<r;C++)D[E]=hn(D[E],D[C]);if(D[E]!==0){D[E+1]<0&&(D[E]=0-D[E]);for(let C=E+1;C<r;C++)D[C]/=D[E];D[E+1]+=1}if(D[E]=-D[E],E+1<e&&D[E]!==0){for(let C=E+1;C<e;C++)S[C]=0;for(let C=E+1;C<e;C++)for(let B=E+1;B<r;B++)S[C]+=D[B]*v.get(C,B);for(let C=E+1;C<r;C++){let B=-D[C]/D[E+1];for(let j=E+1;j<e;j++)v.set(j,C,v.get(j,C)+B*S[j])}}if(d)for(let C=E+1;C<r;C++)O.set(C,E,D[C])}}let G=Math.min(r,e+1);if(w<r&&(M[w]=v.get(w,w)),e<G&&(M[G-1]=0),T+1<G&&(D[T]=v.get(T,G-1)),D[G-1]=0,c){for(let E=w;E<y;E++){for(let C=0;C<e;C++)I.set(C,E,0);I.set(E,E,1)}for(let E=w-1;E>=0;E--)if(M[E]!==0){for(let C=E+1;C<y;C++){let B=0;for(let j=E;j<e;j++)B+=I.get(j,E)*I.get(j,C);B=-B/I.get(E,E);for(let j=E;j<e;j++)I.set(j,C,I.get(j,C)+B*I.get(j,E))}for(let C=E;C<e;C++)I.set(C,E,-I.get(C,E));I.set(E,E,1+I.get(E,E));for(let C=0;C<E-1;C++)I.set(C,E,0)}else{for(let C=0;C<e;C++)I.set(C,E,0);I.set(E,E,1)}}if(d)for(let E=r-1;E>=0;E--){if(E<T&&D[E]!==0)for(let C=E+1;C<r;C++){let B=0;for(let j=E+1;j<r;j++)B+=O.get(j,E)*O.get(j,C);B=-B/O.get(E+1,E);for(let j=E+1;j<r;j++)O.set(j,C,O.get(j,C)+B*O.get(j,E))}for(let C=0;C<r;C++)O.set(C,E,0);O.set(E,E,1)}let A=G-1,L=Number.EPSILON;for(;G>0;){let E,C;for(E=G-2;E>=-1&&E!==-1;E--){const B=Number.MIN_VALUE+L*Math.abs(M[E]+Math.abs(M[E+1]));if(Math.abs(D[E])<=B||Number.isNaN(D[E])){D[E]=0;break}}if(E===G-2)C=4;else{let B;for(B=G-1;B>=E&&B!==E;B--){let j=(B!==G?Math.abs(D[B]):0)+(B!==E+1?Math.abs(D[B-1]):0);if(Math.abs(M[B])<=L*j){M[B]=0;break}}B===E?C=3:B===G-1?C=1:(C=2,E=B)}switch(E++,C){case 1:{let B=D[G-2];D[G-2]=0;for(let j=G-2;j>=E;j--){let st=hn(M[j],B),Y=M[j]/st,Q=B/st;if(M[j]=st,j!==E&&(B=-Q*D[j-1],D[j-1]=Y*D[j-1]),d)for(let tt=0;tt<r;tt++)st=Y*O.get(tt,j)+Q*O.get(tt,G-1),O.set(tt,G-1,-Q*O.get(tt,j)+Y*O.get(tt,G-1)),O.set(tt,j,st)}break}case 2:{let B=D[E-1];D[E-1]=0;for(let j=E;j<G;j++){let st=hn(M[j],B),Y=M[j]/st,Q=B/st;if(M[j]=st,B=-Q*D[j],D[j]=Y*D[j],c)for(let tt=0;tt<e;tt++)st=Y*I.get(tt,j)+Q*I.get(tt,E-1),I.set(tt,E-1,-Q*I.get(tt,j)+Y*I.get(tt,E-1)),I.set(tt,j,st)}break}case 3:{const B=Math.max(Math.abs(M[G-1]),Math.abs(M[G-2]),Math.abs(D[G-2]),Math.abs(M[E]),Math.abs(D[E])),j=M[G-1]/B,st=M[G-2]/B,Y=D[G-2]/B,Q=M[E]/B,tt=D[E]/B,vt=((st+j)*(st-j)+Y*Y)/2,kt=j*Y*(j*Y);let Tt=0;(vt!==0||kt!==0)&&(vt<0?Tt=0-Math.sqrt(vt*vt+kt):Tt=Math.sqrt(vt*vt+kt),Tt=kt/(vt+Tt));let Z=(Q+j)*(Q-j)+Tt,Ot=Q*tt;for(let it=E;it<G-1;it++){let Mt=hn(Z,Ot);Mt===0&&(Mt=Number.MIN_VALUE);let ot=Z/Mt,qt=Ot/Mt;if(it!==E&&(D[it-1]=Mt),Z=ot*M[it]+qt*D[it],D[it]=ot*D[it]-qt*M[it],Ot=qt*M[it+1],M[it+1]=ot*M[it+1],d)for(let Wt=0;Wt<r;Wt++)Mt=ot*O.get(Wt,it)+qt*O.get(Wt,it+1),O.set(Wt,it+1,-qt*O.get(Wt,it)+ot*O.get(Wt,it+1)),O.set(Wt,it,Mt);if(Mt=hn(Z,Ot),Mt===0&&(Mt=Number.MIN_VALUE),ot=Z/Mt,qt=Ot/Mt,M[it]=Mt,Z=ot*D[it]+qt*M[it+1],M[it+1]=-qt*D[it]+ot*M[it+1],Ot=qt*D[it+1],D[it+1]=ot*D[it+1],c&&it<e-1)for(let Wt=0;Wt<e;Wt++)Mt=ot*I.get(Wt,it)+qt*I.get(Wt,it+1),I.set(Wt,it+1,-qt*I.get(Wt,it)+ot*I.get(Wt,it+1)),I.set(Wt,it,Mt)}D[G-2]=Z;break}case 4:{if(M[E]<=0&&(M[E]=M[E]<0?-M[E]:0,d))for(let B=0;B<=A;B++)O.set(B,E,-O.get(B,E));for(;E<A&&!(M[E]>=M[E+1]);){let B=M[E];if(M[E]=M[E+1],M[E+1]=B,d&&E<r-1)for(let j=0;j<r;j++)B=O.get(j,E+1),O.set(j,E+1,O.get(j,E)),O.set(j,E,B);if(c&&E<e-1)for(let j=0;j<e;j++)B=I.get(j,E+1),I.set(j,E+1,I.get(j,E)),I.set(j,E,B);E++}G--;break}}}if(p){let E=O;O=I,I=E}this.m=e,this.n=r,this.s=M,this.U=I,this.V=O}solve(n){let t=n,e=this.threshold,r=this.s.length,o=J.zeros(r,r);for(let y=0;y<r;y++)Math.abs(this.s[y])<=e?o.set(y,y,0):o.set(y,y,1/this.s[y]);let l=this.U,f=this.rightSingularVectors,c=f.mmul(o),d=f.rows,p=l.rows,v=J.zeros(d,p);for(let y=0;y<d;y++)for(let x=0;x<p;x++){let M=0;for(let I=0;I<r;I++)M+=c.get(y,I)*l.get(x,I);v.set(y,x,M)}return v.mmul(t)}solveForDiagonal(n){return this.solve(J.diag(n))}inverse(){let n=this.V,t=this.threshold,e=n.rows,r=n.columns,o=new J(e,this.s.length);for(let p=0;p<e;p++)for(let v=0;v<r;v++)Math.abs(this.s[v])>t&&o.set(p,v,n.get(p,v)/this.s[v]);let l=this.U,f=l.rows,c=l.columns,d=new J(e,f);for(let p=0;p<e;p++)for(let v=0;v<f;v++){let y=0;for(let x=0;x<c;x++)y+=o.get(p,x)*l.get(v,x);d.set(p,v,y)}return d}get condition(){return this.s[0]/this.s[Math.min(this.m,this.n)-1]}get norm2(){return this.s[0]}get rank(){let n=Math.max(this.m,this.n)*this.s[0]*Number.EPSILON,t=0,e=this.s;for(let r=0,o=e.length;r<o;r++)e[r]>n&&t++;return t}get diagonal(){return Array.from(this.s)}get threshold(){return Number.EPSILON/2*Math.max(this.m,this.n)*this.s[0]}get leftSingularVectors(){return this.U}get rightSingularVectors(){return this.V}get diagonalMatrix(){return J.diag(this.s)}};function X0(n,t=!1){return n=we.checkMatrix(n),t?new kr(n).inverse():If(n,J.eye(n.rows))}function If(n,t,e=!1){return n=we.checkMatrix(n),t=we.checkMatrix(t),e?new kr(n).solve(t):n.isSquare()?new to(n).solve(t):new Ja(n).solve(t)}function fs(n){if(n=J.checkMatrix(n),n.isSquare()){if(n.columns===0)return 1;let t,e,r,o;if(n.columns===2)return t=n.get(0,0),e=n.get(0,1),r=n.get(1,0),o=n.get(1,1),t*o-e*r;if(n.columns===3){let l,f,c;return l=new cs(n,[1,2],[1,2]),f=new cs(n,[1,2],[0,2]),c=new cs(n,[1,2],[0,1]),t=n.get(0,0),e=n.get(0,1),r=n.get(0,2),t*fs(l)-e*fs(f)+r*fs(c)}else return new to(n).determinant}else throw Error("determinant can only be calculated for a square matrix")}function Z0(n,t){let e=[];for(let r=0;r<n;r++)r!==t&&e.push(r);return e}function H0(n,t,e,r=1e-9,o=1e-9){if(n>o)return new Array(t.rows+1).fill(0);{let l=t.addRow(e,[0]);for(let f=0;f<l.rows;f++)Math.abs(l.get(f,0))<r&&l.set(f,0,0);return l.to1DArray()}}function $0(n,t={}){const{thresholdValue:e=1e-9,thresholdError:r=1e-9}=t;n=J.checkMatrix(n);let o=n.rows,l=new J(o,o);for(let f=0;f<o;f++){let c=J.columnVector(n.getRow(f)),d=n.subMatrixRow(Z0(o,f)).transpose(),p=new kr(d).solve(c),v=J.sub(c,d.mmul(p)).abs().max();l.setRow(f,H0(v,p,f,e,r))}return l}function K0(n,t=Number.EPSILON){if(n=J.checkMatrix(n),n.isEmpty())return n.transpose();let e=new kr(n,{autoTranspose:!0}),r=e.leftSingularVectors,o=e.rightSingularVectors,l=e.diagonal;for(let f=0;f<l.length;f++)Math.abs(l[f])>t?l[f]=1/l[f]:l[f]=0;return o.mmul(J.diag(l).mmul(r.transpose()))}function J0(n,t=n,e={}){n=new J(n);let r=!1;if(typeof t=="object"&&!J.isMatrix(t)&&!ce.isAnyArray(t)?(e=t,t=n,r=!0):t=new J(t),n.rows!==t.rows)throw new TypeError("Both matrices must have the same number of rows");const{center:o=!0}=e;o&&(n=n.center("column"),r||(t=t.center("column")));const l=n.transpose().mmul(t);for(let f=0;f<l.rows;f++)for(let c=0;c<l.columns;c++)l.set(f,c,l.get(f,c)*(1/(n.rows-1)));return l}function Q0(n,t=n,e={}){n=new J(n);let r=!1;if(typeof t=="object"&&!J.isMatrix(t)&&!ce.isAnyArray(t)?(e=t,t=n,r=!0):t=new J(t),n.rows!==t.rows)throw new TypeError("Both matrices must have the same number of rows");const{center:o=!0,scale:l=!0}=e;o&&(n.center("column"),r||t.center("column")),l&&(n.scale("column"),r||t.scale("column"));const f=n.standardDeviation("column",{unbiased:!0}),c=r?f:t.standardDeviation("column",{unbiased:!0}),d=n.transpose().mmul(t);for(let p=0;p<d.rows;p++)for(let v=0;v<d.columns;v++)d.set(p,v,d.get(p,v)*(1/(f[p]*c[v]))*(1/(n.rows-1)));return d}class Tf{constructor(t,e={}){const{assumeSymmetric:r=!1}=e;if(t=we.checkMatrix(t),!t.isSquare())throw new Error("Matrix is not a square matrix");if(t.isEmpty())throw new Error("Matrix must be non-empty");let o=t.columns,l=new J(o,o),f=new Float64Array(o),c=new Float64Array(o),d=t,p,v,y=!1;if(r?y=!0:y=t.isSymmetric(),y){for(p=0;p<o;p++)for(v=0;v<o;v++)l.set(p,v,d.get(p,v));t_(o,c,f,l),e_(o,c,f,l)}else{let x=new J(o,o),M=new Float64Array(o);for(v=0;v<o;v++)for(p=0;p<o;p++)x.set(p,v,d.get(p,v));n_(o,x,M,l),r_(o,c,f,l,x)}this.n=o,this.e=c,this.d=f,this.V=l}get realEigenvalues(){return Array.from(this.d)}get imaginaryEigenvalues(){return Array.from(this.e)}get eigenvectorMatrix(){return this.V}get diagonalMatrix(){let t=this.n,e=this.e,r=this.d,o=new J(t,t),l,f;for(l=0;l<t;l++){for(f=0;f<t;f++)o.set(l,f,0);o.set(l,l,r[l]),e[l]>0?o.set(l,l+1,e[l]):e[l]<0&&o.set(l,l-1,e[l])}return o}}function t_(n,t,e,r){let o,l,f,c,d,p,v,y;for(d=0;d<n;d++)e[d]=r.get(n-1,d);for(c=n-1;c>0;c--){for(y=0,f=0,p=0;p<c;p++)y=y+Math.abs(e[p]);if(y===0)for(t[c]=e[c-1],d=0;d<c;d++)e[d]=r.get(c-1,d),r.set(c,d,0),r.set(d,c,0);else{for(p=0;p<c;p++)e[p]/=y,f+=e[p]*e[p];for(o=e[c-1],l=Math.sqrt(f),o>0&&(l=-l),t[c]=y*l,f=f-o*l,e[c-1]=o-l,d=0;d<c;d++)t[d]=0;for(d=0;d<c;d++){for(o=e[d],r.set(d,c,o),l=t[d]+r.get(d,d)*o,p=d+1;p<=c-1;p++)l+=r.get(p,d)*e[p],t[p]+=r.get(p,d)*o;t[d]=l}for(o=0,d=0;d<c;d++)t[d]/=f,o+=t[d]*e[d];for(v=o/(f+f),d=0;d<c;d++)t[d]-=v*e[d];for(d=0;d<c;d++){for(o=e[d],l=t[d],p=d;p<=c-1;p++)r.set(p,d,r.get(p,d)-(o*t[p]+l*e[p]));e[d]=r.get(c-1,d),r.set(c,d,0)}}e[c]=f}for(c=0;c<n-1;c++){if(r.set(n-1,c,r.get(c,c)),r.set(c,c,1),f=e[c+1],f!==0){for(p=0;p<=c;p++)e[p]=r.get(p,c+1)/f;for(d=0;d<=c;d++){for(l=0,p=0;p<=c;p++)l+=r.get(p,c+1)*r.get(p,d);for(p=0;p<=c;p++)r.set(p,d,r.get(p,d)-l*e[p])}}for(p=0;p<=c;p++)r.set(p,c+1,0)}for(d=0;d<n;d++)e[d]=r.get(n-1,d),r.set(n-1,d,0);r.set(n-1,n-1,1),t[0]=0}function e_(n,t,e,r){let o,l,f,c,d,p,v,y,x,M,I,O,D,S,F,w;for(f=1;f<n;f++)t[f-1]=t[f];t[n-1]=0;let T=0,N=0,G=Number.EPSILON;for(p=0;p<n;p++){for(N=Math.max(N,Math.abs(e[p])+Math.abs(t[p])),v=p;v<n&&!(Math.abs(t[v])<=G*N);)v++;if(v>p)do{for(o=e[p],y=(e[p+1]-o)/(2*t[p]),x=hn(y,1),y<0&&(x=-x),e[p]=t[p]/(y+x),e[p+1]=t[p]*(y+x),M=e[p+1],l=o-e[p],f=p+2;f<n;f++)e[f]-=l;for(T=T+l,y=e[v],I=1,O=I,D=I,S=t[p+1],F=0,w=0,f=v-1;f>=p;f--)for(D=O,O=I,w=F,o=I*t[f],l=I*y,x=hn(y,t[f]),t[f+1]=F*x,F=t[f]/x,I=y/x,y=I*e[f]-F*o,e[f+1]=l+F*(I*o+F*e[f]),d=0;d<n;d++)l=r.get(d,f+1),r.set(d,f+1,F*r.get(d,f)+I*l),r.set(d,f,I*r.get(d,f)-F*l);y=-F*w*D*S*t[p]/M,t[p]=F*y,e[p]=I*y}while(Math.abs(t[p])>G*N);e[p]=e[p]+T,t[p]=0}for(f=0;f<n-1;f++){for(d=f,y=e[f],c=f+1;c<n;c++)e[c]<y&&(d=c,y=e[c]);if(d!==f)for(e[d]=e[f],e[f]=y,c=0;c<n;c++)y=r.get(c,f),r.set(c,f,r.get(c,d)),r.set(c,d,y)}}function n_(n,t,e,r){let o=0,l=n-1,f,c,d,p,v,y,x;for(y=o+1;y<=l-1;y++){for(x=0,p=y;p<=l;p++)x=x+Math.abs(t.get(p,y-1));if(x!==0){for(d=0,p=l;p>=y;p--)e[p]=t.get(p,y-1)/x,d+=e[p]*e[p];for(c=Math.sqrt(d),e[y]>0&&(c=-c),d=d-e[y]*c,e[y]=e[y]-c,v=y;v<n;v++){for(f=0,p=l;p>=y;p--)f+=e[p]*t.get(p,v);for(f=f/d,p=y;p<=l;p++)t.set(p,v,t.get(p,v)-f*e[p])}for(p=0;p<=l;p++){for(f=0,v=l;v>=y;v--)f+=e[v]*t.get(p,v);for(f=f/d,v=y;v<=l;v++)t.set(p,v,t.get(p,v)-f*e[v])}e[y]=x*e[y],t.set(y,y-1,x*c)}}for(p=0;p<n;p++)for(v=0;v<n;v++)r.set(p,v,p===v?1:0);for(y=l-1;y>=o+1;y--)if(t.get(y,y-1)!==0){for(p=y+1;p<=l;p++)e[p]=t.get(p,y-1);for(v=y;v<=l;v++){for(c=0,p=y;p<=l;p++)c+=e[p]*r.get(p,v);for(c=c/e[y]/t.get(y,y-1),p=y;p<=l;p++)r.set(p,v,r.get(p,v)+c*e[p])}}}function r_(n,t,e,r,o){let l=n-1,f=0,c=n-1,d=Number.EPSILON,p=0,v=0,y=0,x=0,M=0,I=0,O=0,D=0,S,F,w,T,N,G,A,L,E,C,B,j,st,Y,Q;for(S=0;S<n;S++)for((S<f||S>c)&&(e[S]=o.get(S,S),t[S]=0),F=Math.max(S-1,0);F<n;F++)v=v+Math.abs(o.get(S,F));for(;l>=f;){for(T=l;T>f&&(I=Math.abs(o.get(T-1,T-1))+Math.abs(o.get(T,T)),I===0&&(I=v),!(Math.abs(o.get(T,T-1))<d*I));)T--;if(T===l)o.set(l,l,o.get(l,l)+p),e[l]=o.get(l,l),t[l]=0,l--,D=0;else if(T===l-1){if(A=o.get(l,l-1)*o.get(l-1,l),y=(o.get(l-1,l-1)-o.get(l,l))/2,x=y*y+A,O=Math.sqrt(Math.abs(x)),o.set(l,l,o.get(l,l)+p),o.set(l-1,l-1,o.get(l-1,l-1)+p),L=o.get(l,l),x>=0){for(O=y>=0?y+O:y-O,e[l-1]=L+O,e[l]=e[l-1],O!==0&&(e[l]=L-A/O),t[l-1]=0,t[l]=0,L=o.get(l,l-1),I=Math.abs(L)+Math.abs(O),y=L/I,x=O/I,M=Math.sqrt(y*y+x*x),y=y/M,x=x/M,F=l-1;F<n;F++)O=o.get(l-1,F),o.set(l-1,F,x*O+y*o.get(l,F)),o.set(l,F,x*o.get(l,F)-y*O);for(S=0;S<=l;S++)O=o.get(S,l-1),o.set(S,l-1,x*O+y*o.get(S,l)),o.set(S,l,x*o.get(S,l)-y*O);for(S=f;S<=c;S++)O=r.get(S,l-1),r.set(S,l-1,x*O+y*r.get(S,l)),r.set(S,l,x*r.get(S,l)-y*O)}else e[l-1]=L+y,e[l]=L+y,t[l-1]=O,t[l]=-O;l=l-2,D=0}else{if(L=o.get(l,l),E=0,A=0,T<l&&(E=o.get(l-1,l-1),A=o.get(l,l-1)*o.get(l-1,l)),D===10){for(p+=L,S=f;S<=l;S++)o.set(S,S,o.get(S,S)-L);I=Math.abs(o.get(l,l-1))+Math.abs(o.get(l-1,l-2)),L=E=.75*I,A=-.4375*I*I}if(D===30&&(I=(E-L)/2,I=I*I+A,I>0)){for(I=Math.sqrt(I),E<L&&(I=-I),I=L-A/((E-L)/2+I),S=f;S<=l;S++)o.set(S,S,o.get(S,S)-I);p+=I,L=E=A=.964}for(D=D+1,N=l-2;N>=T&&(O=o.get(N,N),M=L-O,I=E-O,y=(M*I-A)/o.get(N+1,N)+o.get(N,N+1),x=o.get(N+1,N+1)-O-M-I,M=o.get(N+2,N+1),I=Math.abs(y)+Math.abs(x)+Math.abs(M),y=y/I,x=x/I,M=M/I,!(N===T||Math.abs(o.get(N,N-1))*(Math.abs(x)+Math.abs(M))<d*(Math.abs(y)*(Math.abs(o.get(N-1,N-1))+Math.abs(O)+Math.abs(o.get(N+1,N+1))))));)N--;for(S=N+2;S<=l;S++)o.set(S,S-2,0),S>N+2&&o.set(S,S-3,0);for(w=N;w<=l-1&&(Y=w!==l-1,w!==N&&(y=o.get(w,w-1),x=o.get(w+1,w-1),M=Y?o.get(w+2,w-1):0,L=Math.abs(y)+Math.abs(x)+Math.abs(M),L!==0&&(y=y/L,x=x/L,M=M/L)),L!==0);w++)if(I=Math.sqrt(y*y+x*x+M*M),y<0&&(I=-I),I!==0){for(w!==N?o.set(w,w-1,-I*L):T!==N&&o.set(w,w-1,-o.get(w,w-1)),y=y+I,L=y/I,E=x/I,O=M/I,x=x/y,M=M/y,F=w;F<n;F++)y=o.get(w,F)+x*o.get(w+1,F),Y&&(y=y+M*o.get(w+2,F),o.set(w+2,F,o.get(w+2,F)-y*O)),o.set(w,F,o.get(w,F)-y*L),o.set(w+1,F,o.get(w+1,F)-y*E);for(S=0;S<=Math.min(l,w+3);S++)y=L*o.get(S,w)+E*o.get(S,w+1),Y&&(y=y+O*o.get(S,w+2),o.set(S,w+2,o.get(S,w+2)-y*M)),o.set(S,w,o.get(S,w)-y),o.set(S,w+1,o.get(S,w+1)-y*x);for(S=f;S<=c;S++)y=L*r.get(S,w)+E*r.get(S,w+1),Y&&(y=y+O*r.get(S,w+2),r.set(S,w+2,r.get(S,w+2)-y*M)),r.set(S,w,r.get(S,w)-y),r.set(S,w+1,r.get(S,w+1)-y*x)}}}if(v!==0){for(l=n-1;l>=0;l--)if(y=e[l],x=t[l],x===0)for(T=l,o.set(l,l,1),S=l-1;S>=0;S--){for(A=o.get(S,S)-y,M=0,F=T;F<=l;F++)M=M+o.get(S,F)*o.get(F,l);if(t[S]<0)O=A,I=M;else if(T=S,t[S]===0?o.set(S,l,A!==0?-M/A:-M/(d*v)):(L=o.get(S,S+1),E=o.get(S+1,S),x=(e[S]-y)*(e[S]-y)+t[S]*t[S],G=(L*I-O*M)/x,o.set(S,l,G),o.set(S+1,l,Math.abs(L)>Math.abs(O)?(-M-A*G)/L:(-I-E*G)/O)),G=Math.abs(o.get(S,l)),d*G*G>1)for(F=S;F<=l;F++)o.set(F,l,o.get(F,l)/G)}else if(x<0)for(T=l-1,Math.abs(o.get(l,l-1))>Math.abs(o.get(l-1,l))?(o.set(l-1,l-1,x/o.get(l,l-1)),o.set(l-1,l,-(o.get(l,l)-y)/o.get(l,l-1))):(Q=ts(0,-o.get(l-1,l),o.get(l-1,l-1)-y,x),o.set(l-1,l-1,Q[0]),o.set(l-1,l,Q[1])),o.set(l,l-1,0),o.set(l,l,1),S=l-2;S>=0;S--){for(C=0,B=0,F=T;F<=l;F++)C=C+o.get(S,F)*o.get(F,l-1),B=B+o.get(S,F)*o.get(F,l);if(A=o.get(S,S)-y,t[S]<0)O=A,M=C,I=B;else if(T=S,t[S]===0?(Q=ts(-C,-B,A,x),o.set(S,l-1,Q[0]),o.set(S,l,Q[1])):(L=o.get(S,S+1),E=o.get(S+1,S),j=(e[S]-y)*(e[S]-y)+t[S]*t[S]-x*x,st=(e[S]-y)*2*x,j===0&&st===0&&(j=d*v*(Math.abs(A)+Math.abs(x)+Math.abs(L)+Math.abs(E)+Math.abs(O))),Q=ts(L*M-O*C+x*B,L*I-O*B-x*C,j,st),o.set(S,l-1,Q[0]),o.set(S,l,Q[1]),Math.abs(L)>Math.abs(O)+Math.abs(x)?(o.set(S+1,l-1,(-C-A*o.get(S,l-1)+x*o.get(S,l))/L),o.set(S+1,l,(-B-A*o.get(S,l)-x*o.get(S,l-1))/L)):(Q=ts(-M-E*o.get(S,l-1),-I-E*o.get(S,l),O,x),o.set(S+1,l-1,Q[0]),o.set(S+1,l,Q[1]))),G=Math.max(Math.abs(o.get(S,l-1)),Math.abs(o.get(S,l))),d*G*G>1)for(F=S;F<=l;F++)o.set(F,l-1,o.get(F,l-1)/G),o.set(F,l,o.get(F,l)/G)}for(S=0;S<n;S++)if(S<f||S>c)for(F=S;F<n;F++)r.set(S,F,o.get(S,F));for(F=n-1;F>=f;F--)for(S=f;S<=c;S++){for(O=0,w=f;w<=Math.min(F,c);w++)O=O+r.get(S,w)*o.get(w,F);r.set(S,F,O)}}}function ts(n,t,e,r){let o,l;return Math.abs(e)>Math.abs(r)?(o=r/e,l=e+o*r,[(n+o*t)/l,(t-o*n)/l]):(o=e/r,l=r+o*e,[(o*n+t)/l,(o*t-n)/l])}class Mf{constructor(t){if(t=we.checkMatrix(t),!t.isSymmetric())throw new Error("Matrix is not symmetric");let e=t,r=e.rows,o=new J(r,r),l=!0,f,c,d;for(c=0;c<r;c++){let p=0;for(d=0;d<c;d++){let v=0;for(f=0;f<d;f++)v+=o.get(d,f)*o.get(c,f);v=(e.get(c,d)-v)/o.get(d,d),o.set(c,d,v),p=p+v*v}for(p=e.get(c,c)-p,l&=p>0,o.set(c,c,Math.sqrt(Math.max(p,0))),d=c+1;d<r;d++)o.set(c,d,0)}this.L=o,this.positiveDefinite=!!l}isPositiveDefinite(){return this.positiveDefinite}solve(t){t=we.checkMatrix(t);let e=this.L,r=e.rows;if(t.rows!==r)throw new Error("Matrix dimensions do not match");if(this.isPositiveDefinite()===!1)throw new Error("Matrix is not positive definite");let o=t.columns,l=t.clone(),f,c,d;for(d=0;d<r;d++)for(c=0;c<o;c++){for(f=0;f<d;f++)l.set(d,c,l.get(d,c)-l.get(f,c)*e.get(d,f));l.set(d,c,l.get(d,c)/e.get(d,d))}for(d=r-1;d>=0;d--)for(c=0;c<o;c++){for(f=d+1;f<r;f++)l.set(d,c,l.get(d,c)-l.get(f,c)*e.get(f,d));l.set(d,c,l.get(d,c)/e.get(d,d))}return l}get lowerTriangularMatrix(){return this.L}}class bf{constructor(t,e={}){t=we.checkMatrix(t);let{Y:r}=e;const{scaleScores:o=!1,maxIterations:l=1e3,terminationCriteria:f=1e-10}=e;let c;if(r){if(ce.isAnyArray(r)&&typeof r[0]=="number"?r=J.columnVector(r):r=we.checkMatrix(r),r.rows!==t.rows)throw new Error("Y should have the same number of rows as X");c=r.getColumnVector(0)}else c=t.getColumnVector(0);let d=1,p,v,y,x;for(let M=0;M<l&&d>f;M++)y=t.transpose().mmul(c).div(c.transpose().mmul(c).get(0,0)),y=y.div(y.norm()),p=t.mmul(y).div(y.transpose().mmul(y).get(0,0)),M>0&&(d=p.clone().sub(x).pow(2).sum()),x=p.clone(),r?(v=r.transpose().mmul(p).div(p.transpose().mmul(p).get(0,0)),v=v.div(v.norm()),c=r.mmul(v).div(v.transpose().mmul(v).get(0,0))):c=p;if(r){let M=t.transpose().mmul(p).div(p.transpose().mmul(p).get(0,0));M=M.div(M.norm());let I=t.clone().sub(p.clone().mmul(M.transpose())),O=c.transpose().mmul(p).div(p.transpose().mmul(p).get(0,0)),D=r.clone().sub(p.clone().mulS(O.get(0,0)).mmul(v.transpose()));this.t=p,this.p=M.transpose(),this.w=y.transpose(),this.q=v,this.u=c,this.s=p.transpose().mmul(p),this.xResidual=I,this.yResidual=D,this.betas=O}else this.w=y.transpose(),this.s=p.transpose().mmul(p).sqrt(),o?this.t=p.clone().div(this.s.get(0,0)):this.t=p,this.xResidual=t.sub(p.mmul(y.transpose()))}}Et.AbstractMatrix=Yt;Et.CHO=Mf;Et.CholeskyDecomposition=Mf;Et.DistanceMatrix=Qs;Et.EVD=Tf;Et.EigenvalueDecomposition=Tf;Et.LU=to;Et.LuDecomposition=to;var i_=Et.Matrix=J;Et.MatrixColumnSelectionView=B0;Et.MatrixColumnView=G0;Et.MatrixFlipColumnView=z0;Et.MatrixFlipRowView=q0;Et.MatrixRowSelectionView=j0;Et.MatrixRowView=U0;Et.MatrixSelectionView=cs;Et.MatrixSubView=V0;Et.MatrixTransposeView=Y0;Et.NIPALS=bf;Et.Nipals=bf;Et.QR=Ja;Et.QrDecomposition=Ja;Et.SVD=kr;var s_=Et.SingularValueDecomposition=kr;Et.SymmetricMatrix=_n;Et.WrapperMatrix1D=kf;Et.WrapperMatrix2D=we;Et.correlation=Q0;Et.covariance=J0;var ah=Et.default=J;Et.determinant=fs;var o_=Et.inverse=X0;Et.linearDependencies=$0;var a_=Et.pseudoInverse=K0;Et.solve=If;Et.wrap=W0;const Ce=i_,u_=s_;ah.Matrix&&ah.Matrix;const l_=o_,Nf=a_;class wi{sourcePoints;destinationPoints;pointCount;pointCountMinimum;type;constructor(t,e,r,o){if(this.sourcePoints=t,this.destinationPoints=e,this.pointCount=this.sourcePoints.length,this.type=r,this.pointCountMinimum=o,this.pointCount<this.pointCountMinimum)throw new Error("Not enough control points. A "+this.type+" transformation requires a minimum of "+this.pointCountMinimum+" points, but "+this.pointCount+" are given.")}evaluate(t,e="function"){if(e=="function")return this.evaluateFunction(t);if(e=="partialDerivativeX")return this.evaluatePartialDerivativeX(t);if(e=="partialDerivativeY")return this.evaluatePartialDerivativeY(t);throw new Error("Evaluation of type "+e+" not supported")}}class Sf extends wi{helmertParametersMatrix;helmertParameters;scale;rotation;translation;constructor(t,e){super(t,e,"helmert",2);const r=Ce.columnVector(e.flat()),o=Ce.zeros(2*this.pointCount,4);for(let f=0;f<this.pointCount;f++)o.set(2*f,0,1),o.set(2*f,1,0),o.set(2*f,2,this.sourcePoints[f][0]),o.set(2*f,3,-this.sourcePoints[f][1]),o.set(2*f+1,0,0),o.set(2*f+1,1,1),o.set(2*f+1,2,this.sourcePoints[f][1]),o.set(2*f+1,3,this.sourcePoints[f][0]);const l=Nf(o);this.helmertParametersMatrix=l.mmul(r),this.helmertParameters=this.helmertParametersMatrix.to1DArray(),this.scale=Math.sqrt(this.helmertParameters[2]**2+this.helmertParameters[3]**2),this.rotation=Math.atan2(this.helmertParameters[3],this.helmertParameters[2]),this.translation=[this.helmertParameters[0],this.helmertParameters[1]]}evaluateFunction(t){if(!this.helmertParameters)throw new Error("Helmert parameters not computed");return[this.helmertParameters[0]+this.helmertParameters[2]*t[0]-this.helmertParameters[3]*t[1],this.helmertParameters[1]+this.helmertParameters[2]*t[1]+this.helmertParameters[3]*t[0]]}evaluatePartialDerivativeX(t){if(!this.helmertParameters)throw new Error("Helmert parameters not computed");return[this.helmertParameters[2],this.helmertParameters[3]]}evaluatePartialDerivativeY(t){if(!this.helmertParameters)throw new Error("Helmert parameters not computed");return[-this.helmertParameters[3],this.helmertParameters[2]]}}class h_ extends wi{scale;sourcePointsCenter;destinationPointsCenter;translation;constructor(t,e){super(t,e,"straight",2);const r=new Sf(this.sourcePoints,this.destinationPoints);if(this.scale=r.scale,!this.scale)throw new Error("Scale could not be computed");this.sourcePointsCenter=this.sourcePoints.reduce((l,f)=>[l[0]+f[0],l[1]+f[1]]).map(l=>l/this.pointCount),this.destinationPointsCenter=this.destinationPoints.reduce((l,f)=>[l[0]+f[0],l[1]+f[1]]).map(l=>l/this.pointCount);const o=this.scale;this.translation=this.destinationPointsCenter.map((l,f)=>l-this.sourcePointsCenter[f]*o)}evaluateFunction(t){if(!this.scale||!this.translation)throw new Error("Straight parameters not computed");return[this.translation[0]+this.scale*t[0],this.translation[1]+this.scale*t[1]]}evaluatePartialDerivativeX(t){if(!this.scale||!this.translation)throw new Error("Straight parameters not computed");return[this.scale,0]}evaluatePartialDerivativeY(t){if(!this.scale||!this.translation)throw new Error("Straight parameters not computed");return[0,this.scale]}}class qo extends wi{polynomialParametersMatrices;polynomialParameters;order;pointCountMinimum;constructor(t,e,r){r=r||1;const o=(r+1)*(r+2)/2;if(super(t,e,"polynomial"+r,o),this.order=r,this.pointCountMinimum=o,this.order<1||this.order>3)throw new Error("Only polynomial transformations of order 1, 2 or 3 are supported");const l=[Ce.columnVector(this.destinationPoints.map(d=>d[0])),Ce.columnVector(this.destinationPoints.map(d=>d[1]))],f=Ce.zeros(this.pointCount,this.pointCountMinimum);for(let d=0;d<this.pointCount;d++)switch(this.order){case 1:f.set(d,0,1),f.set(d,1,this.sourcePoints[d][0]),f.set(d,2,this.sourcePoints[d][1]);break;case 2:f.set(d,0,1),f.set(d,1,this.sourcePoints[d][0]),f.set(d,2,this.sourcePoints[d][1]),f.set(d,3,this.sourcePoints[d][0]**2),f.set(d,4,this.sourcePoints[d][1]**2),f.set(d,5,this.sourcePoints[d][0]*this.sourcePoints[d][1]);break;case 3:f.set(d,0,1),f.set(d,1,this.sourcePoints[d][0]),f.set(d,2,this.sourcePoints[d][1]),f.set(d,3,this.sourcePoints[d][0]**2),f.set(d,4,this.sourcePoints[d][1]**2),f.set(d,5,this.sourcePoints[d][0]*this.sourcePoints[d][1]),f.set(d,6,this.sourcePoints[d][0]**3),f.set(d,7,this.sourcePoints[d][1]**3),f.set(d,8,this.sourcePoints[d][0]**2*this.sourcePoints[d][1]),f.set(d,9,this.sourcePoints[d][0]*this.sourcePoints[d][1]**2);break}const c=Nf(f);this.polynomialParametersMatrices=[c.mmul(l[0]),c.mmul(l[1])],this.polynomialParameters=this.polynomialParametersMatrices.map(d=>d.to1DArray())}evaluateFunction(t){if(!this.polynomialParameters)throw new Error("Polynomial parameters not computed");const e=[0,0];for(let r=0;r<2;r++)switch(this.order){case 1:e[r]+=this.polynomialParameters[r][0]+this.polynomialParameters[r][1]*t[0]+this.polynomialParameters[r][2]*t[1];break;case 2:e[r]+=this.polynomialParameters[r][0]+this.polynomialParameters[r][1]*t[0]+this.polynomialParameters[r][2]*t[1]+this.polynomialParameters[r][3]*t[0]**2+this.polynomialParameters[r][4]*t[1]**2+this.polynomialParameters[r][5]*t[0]*t[1];break;case 3:e[r]+=this.polynomialParameters[r][0]+this.polynomialParameters[r][1]*t[0]+this.polynomialParameters[r][2]*t[1]+this.polynomialParameters[r][3]*t[0]**2+this.polynomialParameters[r][4]*t[1]**2+this.polynomialParameters[r][5]*t[0]*t[1]+this.polynomialParameters[r][6]*t[0]**3+this.polynomialParameters[r][7]*t[1]**3+this.polynomialParameters[r][8]*t[0]**2*t[1]+this.polynomialParameters[r][9]*t[0]*t[1]**2;break}return e}evaluatePartialDerivativeX(t){if(!this.polynomialParameters)throw new Error("Polynomial parameters not computed");const e=[0,0];for(let r=0;r<2;r++)switch(this.order){case 1:e[r]+=this.polynomialParameters[r][1];break;case 2:e[r]+=this.polynomialParameters[r][1]+2*this.polynomialParameters[r][3]*t[0]+this.polynomialParameters[r][5]*t[1];break;case 3:e[r]+=this.polynomialParameters[r][1]+2*this.polynomialParameters[r][3]*t[0]+this.polynomialParameters[r][5]*t[1]+3*this.polynomialParameters[r][6]*t[0]**2+2*this.polynomialParameters[r][8]*t[0]*t[1]+this.polynomialParameters[r][9]*t[1]**2;break}return e}evaluatePartialDerivativeY(t){if(!this.polynomialParameters)throw new Error("Polynomial parameters not computed");const e=[0,0];for(let r=0;r<2;r++)switch(this.order){case 1:e[r]+=this.polynomialParameters[r][2];break;case 2:e[r]+=this.polynomialParameters[r][2]+2*this.polynomialParameters[r][4]*t[1]+this.polynomialParameters[r][5]*t[0];break;case 3:e[r]+=this.polynomialParameters[r][2]+2*this.polynomialParameters[r][4]*t[1]+this.polynomialParameters[r][5]*t[0]+3*this.polynomialParameters[r][7]*t[1]**2+this.polynomialParameters[r][8]*t[0]**2+2*this.polynomialParameters[r][9]*t[0]*t[1];break}return e}}class c_ extends wi{projectiveParametersMatrix;projectiveParameters;constructor(t,e){super(t,e,"projective",4);const r=Ce.zeros(2*this.pointCount,9);for(let l=0;l<this.pointCount;l++)r.set(2*l,0,-t[l][0]),r.set(2*l,1,-t[l][1]),r.set(2*l,2,-1),r.set(2*l,3,0),r.set(2*l,4,0),r.set(2*l,5,0),r.set(2*l,6,e[l][0]*t[l][0]),r.set(2*l,7,e[l][0]*t[l][1]),r.set(2*l,8,e[l][0]),r.set(2*l+1,0,0),r.set(2*l+1,1,0),r.set(2*l+1,2,0),r.set(2*l+1,3,-t[l][0]),r.set(2*l+1,4,-t[l][1]),r.set(2*l+1,5,-1),r.set(2*l+1,6,e[l][1]*t[l][0]),r.set(2*l+1,7,e[l][1]*t[l][1]),r.set(2*l+1,8,e[l][1]);const o=new u_(r);this.projectiveParametersMatrix=Ce.from1DArray(3,3,o.rightSingularVectors.getColumn(8)).transpose(),this.projectiveParameters=this.projectiveParametersMatrix.to2DArray()}evaluateFunction(t){if(!this.projectiveParameters)throw new Error("projective parameters not computed");const e=this.projectiveParameters[0][2]*t[0]+this.projectiveParameters[1][2]*t[1]+this.projectiveParameters[2][2],r=this.projectiveParameters[0][0]*t[0]+this.projectiveParameters[1][0]*t[1]+this.projectiveParameters[2][0],o=this.projectiveParameters[0][1]*t[0]+this.projectiveParameters[1][1]*t[1]+this.projectiveParameters[2][1];return[r/e,o/e]}evaluatePartialDerivativeX(t){if(!this.projectiveParameters)throw new Error("projective parameters not computed");const e=this.projectiveParameters[0][2]*t[0]+this.projectiveParameters[1][2]*t[1]+this.projectiveParameters[2][2],r=this.projectiveParameters[0][0]*t[0]+this.projectiveParameters[1][0]*t[1]+this.projectiveParameters[2][0],o=this.projectiveParameters[0][1]*t[0]+this.projectiveParameters[1][1]*t[1]+this.projectiveParameters[2][1];return[(e*this.projectiveParameters[0][0]-this.projectiveParameters[0][2]*r)/e**2,(e*this.projectiveParameters[0][1]-this.projectiveParameters[0][2]*o)/e**2]}evaluatePartialDerivativeY(t){if(!this.projectiveParameters)throw new Error("projective parameters not computed");const e=this.projectiveParameters[0][2]*t[0]+this.projectiveParameters[1][2]*t[1]+this.projectiveParameters[2][2],r=this.projectiveParameters[0][0]*t[0]+this.projectiveParameters[1][0]*t[1]+this.projectiveParameters[2][0],o=this.projectiveParameters[0][1]*t[0]+this.projectiveParameters[1][1]*t[1]+this.projectiveParameters[2][1];return[(e*this.projectiveParameters[1][0]-this.projectiveParameters[1][2]*r)/e**2,(e*this.projectiveParameters[1][1]-this.projectiveParameters[1][2]*o)/e**2]}}class f_ extends wi{kernelFunction;normFunction;weightsMatrices;rbfWeights;affineWeights;epsilon;constructor(t,e,r,o,l){super(t,e,"thinPlateSpline",3),this.kernelFunction=r,this.normFunction=o;const f=[Ce.columnVector([...this.destinationPoints,[0,0],[0,0],[0,0]].map(y=>y[0])),Ce.columnVector([...this.destinationPoints,[0,0],[0,0],[0,0]].map(y=>y[1]))],c=Ce.zeros(this.pointCount,this.pointCount);for(let y=0;y<this.pointCount;y++)for(let x=0;x<this.pointCount;x++)c.set(y,x,o(this.sourcePoints[y],this.sourcePoints[x]));l===void 0&&(l=c.sum()/(Math.pow(this.pointCount,2)-this.pointCount)),this.epsilon=l;for(let y=0;y<this.pointCount;y++)for(let x=0;x<this.pointCount;x++)c.set(y,x,r(c.get(y,x),{epsilon:l}));const d=Ce.zeros(this.pointCount,3),p=Ce.zeros(this.pointCount+3,this.pointCount+3);for(let y=0;y<this.pointCount;y++)d.set(y,0,1),d.set(y,1,this.sourcePoints[y][0]),d.set(y,2,this.sourcePoints[y][1]);for(let y=0;y<this.pointCount+3;y++)for(let x=0;x<this.pointCount+3;x++)y<this.pointCount&&x<this.pointCount?p.set(y,x,c.get(y,x)):y>=this.pointCount&&x<this.pointCount?p.set(y,x,d.transpose().get(y-this.pointCount,x)):y<this.pointCount&&x>=this.pointCount&&p.set(y,x,d.get(y,x-this.pointCount));const v=l_(p);this.weightsMatrices=[v.mmul(f[0]),v.mmul(f[1])],this.rbfWeights=this.weightsMatrices.map(y=>y.selection([...Array(this.pointCount).keys()],[0]).to1DArray()),this.affineWeights=this.weightsMatrices.map(y=>y.selection([0,1,2].map(x=>x+this.pointCount),[0]).to1DArray())}evaluateFunction(t){if(!this.rbfWeights||!this.affineWeights)throw new Error("Weights not computed");const e=this.sourcePoints.map(o=>this.normFunction(t,o)),r=[0,0];for(let o=0;o<2;o++)r[o]=e.reduce((l,f,c)=>l+this.kernelFunction(f,{epsilon:this.epsilon})*this.rbfWeights[o][c],0),r[o]+=this.affineWeights[o][0]+this.affineWeights[o][1]*t[0]+this.affineWeights[o][2]*t[1];return r}evaluatePartialDerivativeX(t){if(!this.rbfWeights||!this.affineWeights)throw new Error("Weights not computed");const e=this.sourcePoints.map(o=>this.normFunction(t,o)),r=[0,0];for(let o=0;o<2;o++)r[o]=e.reduce((l,f,c)=>l+(f==0?0:this.kernelFunction(f,{derivative:1,epsilon:this.epsilon})*((t[0]-this.sourcePoints[c][0])/f)*this.rbfWeights[o][c]),0),r[o]+=this.affineWeights[o][1];return r}evaluatePartialDerivativeY(t){if(!this.rbfWeights||!this.affineWeights)throw new Error("Weights not computed");const e=this.sourcePoints.map(o=>this.normFunction(t,o)),r=[0,0];for(let o=0;o<2;o++)r[o]=e.reduce((l,f,c)=>l+(f==0?0:this.kernelFunction(f,{derivative:1,epsilon:this.epsilon})*((t[1]-this.sourcePoints[c][1])/f)*this.rbfWeights[o][c]),0),r[o]+=this.affineWeights[o][2];return r}}function g_(n,t){if(t.derivative){if(t.derivative==1)return n===0?0:n+2*n*Math.log(n);throw new Error("Derivate of order "+t.derivative+" not implemented")}else return n===0?0:Math.pow(n,2)*Math.log(n)}function d_(n,t){const e=[t[0]-n[0],t[1]-n[1]];return Math.sqrt(e[0]**2+e[1]**2)}function Bt(n,t,e){return{maxOffsetRatio:0,maxDepth:0,destinationIsGeographic:!1,sourceIsGeographic:!1,inputIsMultiGeometry:!1,differentHandedness:!1,evaluationType:"function",...e,...t,...n}}function es(n,t,e){t=Zs(t);const r=t.map(f=>({source:f,destination:n.transformForward(f)})),o=eo(r,!1),l=Rf(n,o,e);return no(l,!0).map(f=>f.destination)}function ns(n,t,e){t=Zs(t);const r=t.map(f=>({source:n.transformBackward(f),destination:f})),o=eo(r,!1),l=Cf(n,o,e);return no(l,!0).map(f=>f.source)}function p_(n,t,e){t=ja(t);const r=t.map(f=>({source:f,destination:n.transformForward(f)})),o=eo(r,!0),l=Rf(n,o,e);return no(l,!1).map(f=>f.destination)}function m_(n,t,e){t=ja(t);const r=t.map(f=>({source:n.transformBackward(f),destination:f})),o=eo(r,!0),l=Cf(n,o,e);return no(l,!1).map(f=>f.source)}function rs(n,t,e){return t.map(r=>p_(n,r,e))}function is(n,t,e){return t.map(r=>m_(n,r,e))}function eo(n,t=!1){const e=n.length-(t?0:1),r=[];for(let o=0;o<e;o++)r.push({from:n[o],to:n[(o+1)%n.length]});return r}function no(n,t=!1){const e=n.map(r=>r.from);return t&&e.push(n[n.length-1].to),e}function Rf(n,t,e){return e.maxDepth<=0?t:t.map(r=>Ea(n,r,e,0)).flat(1)}function Cf(n,t,e){return e.maxDepth<=0?t:t.map(r=>ka(n,r,e,0)).flat(1)}function Ea(n,t,e,r){if(r>=e.maxDepth)return t;const o=(e.sourceIsGeographic?(p,v)=>zs(p,v).geometry.coordinates:Ts)(t.from.source,t.to.source),l=(e.destinationIsGeographic?(p,v)=>zs(p,v).geometry.coordinates:Ts)(t.from.destination,t.to.destination),f=n.transformForward(o),c=e.destinationIsGeographic?Ha:ye,d=c(t.from.destination,t.to.destination);if(c(l,f)/d>e.maxOffsetRatio&&d>0){const p={source:o,destination:f};return[Ea(n,{from:t.from,to:p},e,r+1),Ea(n,{from:p,to:t.to},e,r+1)].flat(1)}else return t}function ka(n,t,e,r){if(r>=e.maxDepth)return t;const o=(e.destinationIsGeographic?(p,v)=>zs(p,v).geometry.coordinates:Ts)(t.from.destination,t.to.destination),l=(e.sourceIsGeographic?(p,v)=>zs(p,v).geometry.coordinates:Ts)(t.from.source,t.to.source),f=n.transformBackward(o),c=e.sourceIsGeographic?Ha:ye,d=c(t.from.source,t.to.source);if(c(l,f)/d>e.maxOffsetRatio&&d>0){const p={source:f,destination:o};return[ka(n,{from:t.from,to:p},e,r+1),ka(n,{from:p,to:t.to},e,r+1)].flat(1)}else return t}class Uo{gcps;sourcePoints;destinationPoints;type;options;forwardTransformation;backwardTransformation;constructor(t,e="polynomial",r){if(r&&(this.options=r),t.length===0)throw new Error("No control points");this.gcps=t.map(o=>{if("resource"in o&&"geo"in o)return{source:o.resource,destination:o.geo};if("source"in o&&"destination"in o)return o;throw new Error("Unsupported GCP type")}),this.sourcePoints=this.gcps.map(o=>o.source),this.destinationPoints=this.gcps.map(o=>o.destination),this.type=e}createForwardTransformation(){this.forwardTransformation=this.computeTransformation(this.sourcePoints.map(t=>this.assureEqualHandedness(t)),this.destinationPoints)}createBackwardTransformation(){this.backwardTransformation=this.computeTransformation(this.destinationPoints,this.sourcePoints.map(t=>this.assureEqualHandedness(t)))}transformForward(t,e){if(!Bt(e,this.options).inputIsMultiGeometry){if(ae(t))return this.forwardTransformation||this.createForwardTransformation(),this.forwardTransformation.evaluate(this.assureEqualHandedness(t),Bt(e,this.options).evaluationType);if(rn(t))return this.transformForward(qr(t),e);if(Ae(t))return es(this,t,Bt(e,this.options));if(sn(t))return es(this,Ur(t),Bt(e,this.options,{sourceIsGeographic:!0}));if(Oe(t))return rs(this,t,Bt(e,this.options));if(on(t))return rs(this,jr(t),Bt(e,this.options,{sourceIsGeographic:!0}))}if(e&&(e.inputIsMultiGeometry=!1),tn(t))return t.map(r=>this.transformForward(r,e));if(an(t))return Yi(t).map(r=>this.transformForward(r,e));if(en(t))return t.map(r=>this.transformForward(r,e));if(un(t))return Wi(t).map(r=>this.transformForward(r,e));if(nn(t))return t.map(r=>this.transformForward(r,e));if(ln(t))return Xi(t).map(r=>this.transformForward(r,e));throw new Error("Input type not supported")}transformForwardAsGeojson(t,e){if(!Bt(e,this.options).inputIsMultiGeometry){if(ae(t))return Ui(this.transformForward(t));if(rn(t))return Ui(this.transformForward(qr(t)));if(Ae(t))return ji(es(this,t,Bt(e,this.options,{destinationIsGeographic:!0})));if(sn(t))return ji(es(this,Ur(t),Bt(e,this.options,{sourceIsGeographic:!0,destinationIsGeographic:!0})));if(Oe(t))return Vi(rs(this,t,Bt(e,this.options,{destinationIsGeographic:!0})));if(on(t))return Vi(rs(this,jr(t),Bt(e,this.options,{sourceIsGeographic:!0,destinationIsGeographic:!0})))}if(e&&(e.inputIsMultiGeometry=!1),tn(t))return Zi(t.map(r=>this.transformForwardAsGeojson(r,e)));if(an(t))return Zi(Yi(t).map(r=>this.transformForwardAsGeojson(r,e)));if(en(t))return Hi(t.map(r=>this.transformForwardAsGeojson(r,e)));if(un(t))return Hi(Wi(t).map(r=>this.transformForwardAsGeojson(r,e)));if(nn(t))return $i(t.map(r=>this.transformForwardAsGeojson(r,e)));if(ln(t))return $i(Xi(t).map(r=>this.transformForwardAsGeojson(r,e)));throw new Error("Input type not supported")}transformBackward(t,e){if(!Bt(e,this.options).inputIsMultiGeometry){if(ae(t))return this.backwardTransformation||this.createBackwardTransformation(),this.assureEqualHandedness(this.backwardTransformation.evaluate(t));if(rn(t))return this.transformBackward(qr(t));if(Ae(t))return ns(this,t,Bt(e,this.options));if(sn(t))return ns(this,Ur(t),Bt(e,this.options,{destinationIsGeographic:!0}));if(Oe(t))return is(this,t,Bt(e,this.options));if(on(t))return is(this,jr(t),Bt(e,this.options,{destinationIsGeographic:!0}))}if(e&&(e.inputIsMultiGeometry=!1),tn(t))return t.map(r=>this.transformBackward(r,e));if(an(t))return Yi(t).map(r=>this.transformBackward(r,e));if(en(t))return t.map(r=>this.transformBackward(r,e));if(un(t))return Wi(t).map(r=>this.transformBackward(r,e));if(nn(t))return t.map(r=>this.transformBackward(r,e));if(ln(t))return Xi(t).map(r=>this.transformBackward(r,e));throw new Error("Input type not supported")}transformBackwardAsGeojson(t,e){if(!Bt(e,this.options).inputIsMultiGeometry){if(ae(t))return Ui(this.transformBackward(t));if(rn(t))return Ui(this.transformBackward(qr(t)));if(Ae(t))return ji(ns(this,t,Bt(e,this.options,{sourceIsGeographic:!0})));if(sn(t))return ji(ns(this,Ur(t),Bt(e,this.options,{sourceIsGeographic:!0,destinationIsGeographic:!0})));if(Oe(t))return Vi(is(this,t,Bt(e,this.options,{sourceIsGeographic:!0})));if(on(t))return Vi(is(this,jr(t),Bt(e,this.options,{sourceIsGeographic:!0,destinationIsGeographic:!0})))}if(e&&(e.inputIsMultiGeometry=!1),tn(t))return Zi(t.map(r=>this.transformBackwardAsGeojson(r,e)));if(an(t))return Zi(Yi(t).map(r=>this.transformBackwardAsGeojson(r,e)));if(en(t))return Hi(t.map(r=>this.transformBackwardAsGeojson(r,e)));if(un(t))return Hi(Wi(t).map(r=>this.transformBackwardAsGeojson(r,e)));if(nn(t))return $i(t.map(r=>this.transformBackwardAsGeojson(r,e)));if(ln(t))return $i(Xi(t).map(r=>this.transformBackwardAsGeojson(r,e)));throw new Error("Input type not supported")}transformToGeo(t,e){if(!Bt(e,this.options).inputIsMultiGeometry){if(ae(t))return this.transformForward(t,e);if(rn(t))return this.transformForward(t,e);if(Ae(t))return this.transformForward(t,e);if(sn(t))return this.transformForward(t,e);if(Oe(t))return this.transformForward(t,e);if(on(t))return this.transformForward(t,e)}if(e&&(e.inputIsMultiGeometry=!1),tn(t))return this.transformForward(t,e);if(an(t))return this.transformForward(t,e);if(en(t))return this.transformForward(t,e);if(un(t))return this.transformForward(t,e);if(nn(t))return this.transformForward(t,e);if(ln(t))return this.transformForward(t,e);throw new Error("Input type not supported")}transformToGeoAsGeojson(t,e){if(!Bt(e,this.options).inputIsMultiGeometry){if(ae(t))return this.transformForwardAsGeojson(t,e);if(rn(t))return this.transformForwardAsGeojson(t,e);if(Ae(t))return this.transformForwardAsGeojson(t,e);if(sn(t))return this.transformForwardAsGeojson(t,e);if(Oe(t))return this.transformForwardAsGeojson(t,e);if(on(t))return this.transformForwardAsGeojson(t,e)}if(e&&(e.inputIsMultiGeometry=!1),tn(t))return this.transformForwardAsGeojson(t,e);if(an(t))return this.transformForwardAsGeojson(t,e);if(en(t))return this.transformForwardAsGeojson(t,e);if(un(t))return this.transformForwardAsGeojson(t,e);if(nn(t))return this.transformForwardAsGeojson(t,e);if(ln(t))return this.transformForwardAsGeojson(t,e);throw new Error("Input type not supported")}transformToResource(t,e){if(!Bt(e,this.options).inputIsMultiGeometry){if(ae(t))return this.transformBackward(t,e);if(rn(t))return this.transformBackward(t,e);if(Ae(t))return this.transformBackward(t,e);if(sn(t))return this.transformBackward(t,e);if(Oe(t))return this.transformBackward(t,e);if(on(t))return this.transformBackward(t,e)}if(e&&(e.inputIsMultiGeometry=!1),tn(t))return this.transformBackward(t,e);if(an(t))return this.transformBackward(t,e);if(en(t))return this.transformBackward(t,e);if(un(t))return this.transformBackward(t,e);if(nn(t))return this.transformBackward(t,e);if(ln(t))return this.transformBackward(t,e);throw new Error("Input type not supported")}transformToResourceAsGeojson(t,e){if(!Bt(e,this.options).inputIsMultiGeometry){if(ae(t))return this.transformBackwardAsGeojson(t,e);if(rn(t))return this.transformBackwardAsGeojson(t,e);if(Ae(t))return this.transformBackwardAsGeojson(t,e);if(sn(t))return this.transformBackwardAsGeojson(t,e);if(Oe(t))return this.transformBackwardAsGeojson(t,e);if(on(t))return this.transformBackwardAsGeojson(t,e)}if(e&&(e.inputIsMultiGeometry=!1),tn(t))return this.transformBackwardAsGeojson(t,e);if(an(t))return this.transformBackwardAsGeojson(t,e);if(en(t))return this.transformBackwardAsGeojson(t,e);if(un(t))return this.transformBackwardAsGeojson(t,e);if(nn(t))return this.transformBackwardAsGeojson(t,e);if(ln(t))return this.transformBackwardAsGeojson(t,e);throw new Error("Input type not supported")}transformSvgToGeojson(t,e){if(t.type==="circle")return this.transformForwardAsGeojson(t.coordinates);if(t.type==="line")return this.transformForwardAsGeojson(t.coordinates,e);if(t.type==="polyline")return this.transformForwardAsGeojson(t.coordinates,e);if(t.type==="rect")return this.transformForwardAsGeojson([t.coordinates],e);if(t.type==="polygon")return this.transformForwardAsGeojson([t.coordinates],e);throw new Error("Unsupported SVG geometry")}transformSvgStringToGeojsonFeatureCollection(t,e){const r=[];for(const o of dv(t)){const l=this.transformSvgToGeojson(o,e);r.push(l)}return ev(r)}transformGeojsonToSvg(t,e){if(t.type==="Point")return{type:"circle",coordinates:this.transformBackward(t)};if(t.type==="LineString")return{type:"polyline",coordinates:this.transformBackward(t,e)};if(t.type==="Polygon")return{type:"polygon",coordinates:this.transformBackward(t,e)[0]};throw new Error("Unsupported GeoJSON geometry")}transformGeojsonFeatureCollectionToSvgString(t,e){const r=[];for(const o of rv(t)){const l=this.transformGeojsonToSvg(o,e);r.push(l)}return mv(r)}assureEqualHandedness(t){return this.options?.differentHandedness?Ym(t):t}computeTransformation(t,e){if(this.type==="straight")return new h_(t,e);if(this.type==="helmert")return new Sf(t,e);if(this.type==="polynomial1"||this.type==="polynomial")return new qo(t,e);if(this.type==="polynomial2")return new qo(t,e,2);if(this.type==="polynomial3")return new qo(t,e,3);if(this.type==="projective")return new c_(t,e);if(this.type==="thinPlateSpline")return new f_(t,e,g_,d_);throw new Error(`Unsupported transformation type: ${this.type}`)}}const Pf=["log2sigma","twoOmega","airyKavr","signDetJ","thetaa"];function v_(n,t,e,r=1){if(!e)return 0;const o=n[0]**2+n[1]**2,l=t[0]**2+t[1]**2,f=n[0]*t[0]+n[1]*t[1],c=Math.sqrt(.5*(o+l+Math.sqrt((o-l)**2+4*f**2))),d=Math.sqrt(.5*(o+l-Math.sqrt((o-l)**2+4*f**2))),p=Math.atan(n[1]/n[0]),v=Math.sign(-f)*Math.asin(Math.sqrt((1-c**2/o)/(1-(c/d)**2)));switch(Pf.indexOf(e)){case 0:return(Math.log(c*d)-2*Math.log(r))/Math.log(2);case 1:return 2*Math.asin((c-d)/(c+d));case 2:return .5*(Math.log(c/r)**2+Math.log(d/r)**2);case 3:return Math.sign(n[0]*t[1]-n[1]*t[0]);case 4:return p-v;default:throw new Error("Distortion "+e+" not supported")}}var $=(n=>(n.GEOREFERENCEANNOTATIONADDED="georeferenceannotationadded",n.GEOREFERENCEANNOTATIONREMOVED="georeferenceannotationremoved",n.WARPEDMAPADDED="warpedmapadded",n.WARPEDMAPREMOVED="warpedmapremoved",n.WARPEDMAPENTER="warpedmapenter",n.WARPEDMAPLEAVE="warpedmapleave",n.IMAGEINFOLOADED="imageinfoloaded",n.TILEFETCHED="tilefetched",n.TILEFETCHERROR="tilefetcherror",n.MAPTILELOADED="maptileloaded",n.MAPTILEREMOVED="maptileremoved",n.FIRSTMAPTILELOADED="firstmaptileloaded",n.ALLREQUESTEDTILESLOADED="allrequestedtilesloaded",n.TEXTURESUPDATED="texturesupdated",n.ZINDICESCHANGES="zindiceschanged",n.RESOURCEMASKUPDATED="resourcemaskupdated",n.VISIBILITYCHANGED="visibilitychanged",n.TRANSFORMATIONCHANGED="transformationchanged",n.DISTORTIONCHANGED="distortionchanged",n.CHANGED="changed",n.CLEARED="cleared",n))($||{});let wt=class extends Event{data;constructor(n,t){super(n),this.data=t}};const jo={maxOffsetRatio:.05,maxDepth:2,differentHandedness:!0},Lf=!0;function y_(){return{visible:Lf}}class __ extends EventTarget{mapId;georeferencedMap;gcps;projectedGcps;resourceMask;resourceMaskBbox;resourceMaskRectangle;resourceFullMask;resourceFullMaskBbox;resourceFullMaskRectangle;imageInformations;imageId;parsedImage;loadingImageInfo;fetchFn;visible;transformationType;transformer;projectedTransformer;transformerByTransformationType=new Map;projectedTransformerByTransformationType=new Map;geoMask;geoMaskBbox;geoMaskRectangle;geoFullMask;geoFullMaskBbox;geoFullMaskRectangle;projectedGeoMask;projectedGeoMaskBbox;projectedGeoMaskRectangle;projectedGeoFullMask;projectedGeoFullMaskBbox;projectedGeoFullMaskRectangle;resourceToProjectedGeoScale;distortionMeasure;bestScaleFactor;resourceViewportRing=[];resourceViewportRingBbox;constructor(t,e,r){super(),r={...y_(),...r},this.mapId=t,this.georeferencedMap=e,this.gcps=this.georeferencedMap.gcps,this.projectedGcps=this.gcps.map(({resource:o,geo:l})=>({resource:o,geo:rr(l)})),this.resourceMask=this.georeferencedMap.resourceMask,this.updateResourceMaskProperties(),this.resourceFullMask=[[0,0],[this.georeferencedMap.resource.width,0],[this.georeferencedMap.resource.width,this.georeferencedMap.resource.height],[0,this.georeferencedMap.resource.height]],this.resourceFullMaskBbox=ne(this.resourceFullMask),this.resourceFullMaskRectangle=Ms(this.resourceFullMaskBbox),this.imageInformations=r.imageInformations,this.loadingImageInfo=!1,this.visible=r.visible||Lf,this.fetchFn=r.fetchFn,this.transformationType=r.transformation?.type||this.georeferencedMap.transformation?.type||"polynomial",this.updateTransformerProperties()}getViewportMask(t){return this.projectedGeoMask.map(e=>ur(t.projectedGeoToViewportTransform,e))}getViewportMaskBbox(t){return ne(this.getViewportMask(t))}getViewportMaskRectangle(t){return this.projectedGeoMaskRectangle.map(e=>ur(t.projectedGeoToViewportTransform,e))}getViewportFullMask(t){return this.projectedGeoFullMask.map(e=>ur(t.projectedGeoToViewportTransform,e))}getViewportFullMaskBbox(t){return ne(this.getViewportFullMask(t))}getViewportFullMaskRectangle(t){return this.projectedGeoFullMaskRectangle.map(e=>ur(t.projectedGeoToViewportTransform,e))}getResourceToViewportScale(t){return ql(this.resourceMaskRectangle,this.getViewportMaskRectangle(t))}getResourceToCanvasScale(t){return this.getResourceToViewportScale(t)/t.devicePixelRatio}getReferenceScale(){const t=hs(this.projectedTransformerByTransformationType,"helmert",()=>new Uo(this.projectedGcps,"helmert",jo));return t.forwardTransformation||t.createForwardTransformation(),t.forwardTransformation.scale}setResourceViewportRing(t){this.resourceViewportRing=t,this.resourceViewportRingBbox=ne(t)}setResourceMask(t){this.resourceMask=t,this.updateResourceMaskProperties(),this.updateGeoMask(),this.updateProjectedGeoMask(),this.updateResourceToProjectedGeoScale()}setTransformationType(t){this.transformationType=t,this.updateTransformerProperties()}setDistortionMeasure(t){this.distortionMeasure=t}setGcps(t){this.gcps=t,this.updateTransformerProperties(!1)}setBestScaleFactor(t){const e=this.bestScaleFactor!=t;return e&&(this.bestScaleFactor=t),e}hasImageInfo(){return this.imageId!==void 0&&this.parsedImage!==void 0}async loadImageInfo(){try{this.loadingImageInfo=!0;const t=this.georeferencedMap.resource.id;let e;this.imageInformations?.get(t)?e=this.imageInformations.get(t):(e=await Bm(t,void 0,this.fetchFn),this.imageInformations?.set(t,e)),this.parsedImage=Za.parse(e),this.imageId=await Gc(t),this.dispatchEvent(new wt($.IMAGEINFOLOADED))}catch(t){throw this.loadingImageInfo=!1,t}finally{this.loadingImageInfo=!1}}dispose(){}updateResourceMaskProperties(){this.resourceMaskBbox=ne(this.resourceMask),this.resourceMaskRectangle=Ms(this.resourceMaskBbox)}updateTransformerProperties(t=!0){this.updateTransformer(t),this.updateProjectedTransformer(t),this.updateGeoMask(),this.updateFullGeoMask(),this.updateProjectedGeoMask(),this.updateProjectedFullGeoMask(),this.updateResourceToProjectedGeoScale()}updateTransformer(t=!0){this.transformer=hs(this.transformerByTransformationType,this.transformationType,()=>new Uo(this.gcps,this.transformationType,jo),t)}updateProjectedTransformer(t=!0){this.projectedTransformer=hs(this.projectedTransformerByTransformationType,this.transformationType,()=>new Uo(this.projectedGcps,this.transformationType,jo),t)}updateGeoMask(){this.geoMask=this.transformer.transformForwardAsGeojson([this.resourceMask]),this.geoMaskBbox=ne(this.geoMask),this.geoMaskRectangle=this.transformer.transformForward([this.resourceMaskRectangle],{maxDepth:0})[0]}updateFullGeoMask(){this.geoFullMask=this.transformer.transformForwardAsGeojson([this.resourceFullMask]),this.geoFullMaskBbox=ne(this.geoFullMask),this.geoFullMaskRectangle=this.transformer.transformForward([this.resourceFullMaskRectangle],{maxDepth:0})[0]}updateProjectedGeoMask(){this.projectedGeoMask=this.projectedTransformer.transformForward([this.resourceMask])[0],this.projectedGeoMaskBbox=ne(this.projectedGeoMask),this.projectedGeoMaskRectangle=this.projectedTransformer.transformForward([this.resourceMaskRectangle],{maxDepth:0})[0]}updateProjectedFullGeoMask(){this.projectedGeoFullMask=this.projectedTransformer.transformForward([this.resourceFullMask])[0],this.projectedGeoFullMaskBbox=ne(this.projectedGeoFullMask),this.projectedGeoFullMaskRectangle=this.projectedTransformer.transformForward([this.resourceFullMaskRectangle],{maxDepth:0})[0]}updateResourceToProjectedGeoScale(){this.resourceToProjectedGeoScale=ql(this.resourceMaskRectangle,this.projectedGeoMaskRectangle)}}function w_(n){return Math.sqrt(Math.pow(n[1][0]-n[0][0],2)+Math.pow(n[1][1]-n[0][1],2))}function x_(n){return Math.atan2(n[1][1]-n[0][1],n[1][0]-n[0][0])}function E_(n,t,e){return[n[0]+Math.cos(e)*t,n[1]+Math.sin(e)*t]}function k_(n,t){let e=n[0];const r=[e];for(;w_([e,n[1]])>t;){const o=E_(e,t,x_(n));r.push(o),e=o}return r}function I_(n,t){n=[...n,n[0]];let e=[];for(let r=0;r<n.length-1;r++)e=e.concat(k_([n[r],n[r+1]],t));return e}function T_(n,t){const e=[],r=ne(n);for(let o=r[0]+t,l=0;o<=r[2];l++,o+=t)for(let f=r[1]+t,c=0;f<=r[3];c++,f+=t)e.push([o,f]);return e}function M_(n){return n&&n.__esModule&&Object.prototype.hasOwnProperty.call(n,"default")?n.default:n}var Af={exports:{}},Of=b_,uh=+(Math.pow(2,27)+1);function b_(n,t,e){var r=n*t,o=uh*n,l=o-n,f=o-l,c=n-f,d=uh*t,p=d-t,v=d-p,y=t-v,x=r-f*v,M=x-c*v,I=M-f*y,O=c*y-I;return e?(e[0]=O,e[1]=r,e):[O,r]}var N_=R_;function S_(n,t){var e=n+t,r=e-n,o=e-r,l=t-r,f=n-o,c=f+l;return c?[c,e]:[e]}function R_(n,t){var e=n.length|0,r=t.length|0;if(e===1&&r===1)return S_(n[0],t[0]);var o=e+r,l=new Array(o),f=0,c=0,d=0,p=Math.abs,v=n[c],y=p(v),x=t[d],M=p(x),I,O;y<M?(O=v,c+=1,c<e&&(v=n[c],y=p(v))):(O=x,d+=1,d<r&&(x=t[d],M=p(x))),c<e&&y<M||d>=r?(I=v,c+=1,c<e&&(v=n[c],y=p(v))):(I=x,d+=1,d<r&&(x=t[d],M=p(x)));for(var D=I+O,S=D-I,F=O-S,w=F,T=D,N,G,A,L,E;c<e&&d<r;)y<M?(I=v,c+=1,c<e&&(v=n[c],y=p(v))):(I=x,d+=1,d<r&&(x=t[d],M=p(x))),O=w,D=I+O,S=D-I,F=O-S,F&&(l[f++]=F),N=T+D,G=N-T,A=N-G,L=D-G,E=T-A,w=E+L,T=N;for(;c<e;)I=v,O=w,D=I+O,S=D-I,F=O-S,F&&(l[f++]=F),N=T+D,G=N-T,A=N-G,L=D-G,E=T-A,w=E+L,T=N,c+=1,c<e&&(v=n[c]);for(;d<r;)I=x,O=w,D=I+O,S=D-I,F=O-S,F&&(l[f++]=F),N=T+D,G=N-T,A=N-G,L=D-G,E=T-A,w=E+L,T=N,d+=1,d<r&&(x=t[d]);return w&&(l[f++]=w),T&&(l[f++]=T),f||(l[f++]=0),l.length=f,l}var C_=P_;function P_(n,t,e){var r=n+t,o=r-n,l=r-o,f=t-o,c=n-l;return e?(e[0]=c+f,e[1]=r,e):[c+f,r]}var Vo=Of,L_=C_,A_=O_;function O_(n,t){var e=n.length;if(e===1){var r=Vo(n[0],t);return r[0]?r:[r[1]]}var o=new Array(2*e),l=[.1,.1],f=[.1,.1],c=0;Vo(n[0],t,l),l[0]&&(o[c++]=l[0]);for(var d=1;d<e;++d){Vo(n[d],t,f);var p=l[1];L_(p,f[0],l),l[0]&&(o[c++]=l[0]);var v=f[1],y=l[1],x=v+y,M=x-v,I=y-M;l[1]=x,I&&(o[c++]=I)}return l[1]&&(o[c++]=l[1]),c===0&&(o[c++]=0),o.length=c,o}var D_=G_;function F_(n,t){var e=n+t,r=e-n,o=e-r,l=t-r,f=n-o,c=f+l;return c?[c,e]:[e]}function G_(n,t){var e=n.length|0,r=t.length|0;if(e===1&&r===1)return F_(n[0],-t[0]);var o=e+r,l=new Array(o),f=0,c=0,d=0,p=Math.abs,v=n[c],y=p(v),x=-t[d],M=p(x),I,O;y<M?(O=v,c+=1,c<e&&(v=n[c],y=p(v))):(O=x,d+=1,d<r&&(x=-t[d],M=p(x))),c<e&&y<M||d>=r?(I=v,c+=1,c<e&&(v=n[c],y=p(v))):(I=x,d+=1,d<r&&(x=-t[d],M=p(x)));for(var D=I+O,S=D-I,F=O-S,w=F,T=D,N,G,A,L,E;c<e&&d<r;)y<M?(I=v,c+=1,c<e&&(v=n[c],y=p(v))):(I=x,d+=1,d<r&&(x=-t[d],M=p(x))),O=w,D=I+O,S=D-I,F=O-S,F&&(l[f++]=F),N=T+D,G=N-T,A=N-G,L=D-G,E=T-A,w=E+L,T=N;for(;c<e;)I=v,O=w,D=I+O,S=D-I,F=O-S,F&&(l[f++]=F),N=T+D,G=N-T,A=N-G,L=D-G,E=T-A,w=E+L,T=N,c+=1,c<e&&(v=n[c]);for(;d<r;)I=x,O=w,D=I+O,S=D-I,F=O-S,F&&(l[f++]=F),N=T+D,G=N-T,A=N-G,L=D-G,E=T-A,w=E+L,T=N,d+=1,d<r&&(x=-t[d]);return w&&(l[f++]=w),T&&(l[f++]=T),f||(l[f++]=0),l.length=f,l}(function(n){var t=Of,e=N_,r=A_,o=D_,l=5,f=11102230246251565e-32,c=(3+16*f)*f,d=(7+56*f)*f;function p(w,T,N,G){return function(A,L,E){var C=w(w(T(L[1],E[0]),T(-E[1],L[0])),w(T(A[1],L[0]),T(-L[1],A[0]))),B=w(T(A[1],E[0]),T(-E[1],A[0])),j=G(C,B);return j[j.length-1]}}function v(w,T,N,G){return function(A,L,E,C){var B=w(w(N(w(T(E[1],C[0]),T(-C[1],E[0])),L[2]),w(N(w(T(L[1],C[0]),T(-C[1],L[0])),-E[2]),N(w(T(L[1],E[0]),T(-E[1],L[0])),C[2]))),w(N(w(T(L[1],C[0]),T(-C[1],L[0])),A[2]),w(N(w(T(A[1],C[0]),T(-C[1],A[0])),-L[2]),N(w(T(A[1],L[0]),T(-L[1],A[0])),C[2])))),j=w(w(N(w(T(E[1],C[0]),T(-C[1],E[0])),A[2]),w(N(w(T(A[1],C[0]),T(-C[1],A[0])),-E[2]),N(w(T(A[1],E[0]),T(-E[1],A[0])),C[2]))),w(N(w(T(L[1],E[0]),T(-E[1],L[0])),A[2]),w(N(w(T(A[1],E[0]),T(-E[1],A[0])),-L[2]),N(w(T(A[1],L[0]),T(-L[1],A[0])),E[2])))),st=G(B,j);return st[st.length-1]}}function y(w,T,N,G){return function(A,L,E,C,B){var j=w(w(w(N(w(N(w(T(C[1],B[0]),T(-B[1],C[0])),E[2]),w(N(w(T(E[1],B[0]),T(-B[1],E[0])),-C[2]),N(w(T(E[1],C[0]),T(-C[1],E[0])),B[2]))),L[3]),w(N(w(N(w(T(C[1],B[0]),T(-B[1],C[0])),L[2]),w(N(w(T(L[1],B[0]),T(-B[1],L[0])),-C[2]),N(w(T(L[1],C[0]),T(-C[1],L[0])),B[2]))),-E[3]),N(w(N(w(T(E[1],B[0]),T(-B[1],E[0])),L[2]),w(N(w(T(L[1],B[0]),T(-B[1],L[0])),-E[2]),N(w(T(L[1],E[0]),T(-E[1],L[0])),B[2]))),C[3]))),w(N(w(N(w(T(E[1],C[0]),T(-C[1],E[0])),L[2]),w(N(w(T(L[1],C[0]),T(-C[1],L[0])),-E[2]),N(w(T(L[1],E[0]),T(-E[1],L[0])),C[2]))),-B[3]),w(N(w(N(w(T(C[1],B[0]),T(-B[1],C[0])),L[2]),w(N(w(T(L[1],B[0]),T(-B[1],L[0])),-C[2]),N(w(T(L[1],C[0]),T(-C[1],L[0])),B[2]))),A[3]),N(w(N(w(T(C[1],B[0]),T(-B[1],C[0])),A[2]),w(N(w(T(A[1],B[0]),T(-B[1],A[0])),-C[2]),N(w(T(A[1],C[0]),T(-C[1],A[0])),B[2]))),-L[3])))),w(w(N(w(N(w(T(L[1],B[0]),T(-B[1],L[0])),A[2]),w(N(w(T(A[1],B[0]),T(-B[1],A[0])),-L[2]),N(w(T(A[1],L[0]),T(-L[1],A[0])),B[2]))),C[3]),w(N(w(N(w(T(L[1],C[0]),T(-C[1],L[0])),A[2]),w(N(w(T(A[1],C[0]),T(-C[1],A[0])),-L[2]),N(w(T(A[1],L[0]),T(-L[1],A[0])),C[2]))),-B[3]),N(w(N(w(T(E[1],C[0]),T(-C[1],E[0])),L[2]),w(N(w(T(L[1],C[0]),T(-C[1],L[0])),-E[2]),N(w(T(L[1],E[0]),T(-E[1],L[0])),C[2]))),A[3]))),w(N(w(N(w(T(E[1],C[0]),T(-C[1],E[0])),A[2]),w(N(w(T(A[1],C[0]),T(-C[1],A[0])),-E[2]),N(w(T(A[1],E[0]),T(-E[1],A[0])),C[2]))),-L[3]),w(N(w(N(w(T(L[1],C[0]),T(-C[1],L[0])),A[2]),w(N(w(T(A[1],C[0]),T(-C[1],A[0])),-L[2]),N(w(T(A[1],L[0]),T(-L[1],A[0])),C[2]))),E[3]),N(w(N(w(T(L[1],E[0]),T(-E[1],L[0])),A[2]),w(N(w(T(A[1],E[0]),T(-E[1],A[0])),-L[2]),N(w(T(A[1],L[0]),T(-L[1],A[0])),E[2]))),-C[3]))))),st=w(w(w(N(w(N(w(T(C[1],B[0]),T(-B[1],C[0])),E[2]),w(N(w(T(E[1],B[0]),T(-B[1],E[0])),-C[2]),N(w(T(E[1],C[0]),T(-C[1],E[0])),B[2]))),A[3]),N(w(N(w(T(C[1],B[0]),T(-B[1],C[0])),A[2]),w(N(w(T(A[1],B[0]),T(-B[1],A[0])),-C[2]),N(w(T(A[1],C[0]),T(-C[1],A[0])),B[2]))),-E[3])),w(N(w(N(w(T(E[1],B[0]),T(-B[1],E[0])),A[2]),w(N(w(T(A[1],B[0]),T(-B[1],A[0])),-E[2]),N(w(T(A[1],E[0]),T(-E[1],A[0])),B[2]))),C[3]),N(w(N(w(T(E[1],C[0]),T(-C[1],E[0])),A[2]),w(N(w(T(A[1],C[0]),T(-C[1],A[0])),-E[2]),N(w(T(A[1],E[0]),T(-E[1],A[0])),C[2]))),-B[3]))),w(w(N(w(N(w(T(E[1],B[0]),T(-B[1],E[0])),L[2]),w(N(w(T(L[1],B[0]),T(-B[1],L[0])),-E[2]),N(w(T(L[1],E[0]),T(-E[1],L[0])),B[2]))),A[3]),N(w(N(w(T(E[1],B[0]),T(-B[1],E[0])),A[2]),w(N(w(T(A[1],B[0]),T(-B[1],A[0])),-E[2]),N(w(T(A[1],E[0]),T(-E[1],A[0])),B[2]))),-L[3])),w(N(w(N(w(T(L[1],B[0]),T(-B[1],L[0])),A[2]),w(N(w(T(A[1],B[0]),T(-B[1],A[0])),-L[2]),N(w(T(A[1],L[0]),T(-L[1],A[0])),B[2]))),E[3]),N(w(N(w(T(L[1],E[0]),T(-E[1],L[0])),A[2]),w(N(w(T(A[1],E[0]),T(-E[1],A[0])),-L[2]),N(w(T(A[1],L[0]),T(-L[1],A[0])),E[2]))),-B[3])))),Y=G(j,st);return Y[Y.length-1]}}function x(w){var T=w===3?p:w===4?v:y;return T(e,t,r,o)}var M=x(3),I=x(4),O=[function(){return 0},function(){return 0},function(w,T){return T[0]-w[0]},function(w,T,N){var G=(w[1]-N[1])*(T[0]-N[0]),A=(w[0]-N[0])*(T[1]-N[1]),L=G-A,E;if(G>0){if(A<=0)return L;E=G+A}else if(G<0){if(A>=0)return L;E=-(G+A)}else return L;var C=c*E;return L>=C||L<=-C?L:M(w,T,N)},function(w,T,N,G){var A=w[0]-G[0],L=T[0]-G[0],E=N[0]-G[0],C=w[1]-G[1],B=T[1]-G[1],j=N[1]-G[1],st=w[2]-G[2],Y=T[2]-G[2],Q=N[2]-G[2],tt=L*j,vt=E*B,kt=E*C,Tt=A*j,Z=A*B,Ot=L*C,it=st*(tt-vt)+Y*(kt-Tt)+Q*(Z-Ot),Mt=(Math.abs(tt)+Math.abs(vt))*Math.abs(st)+(Math.abs(kt)+Math.abs(Tt))*Math.abs(Y)+(Math.abs(Z)+Math.abs(Ot))*Math.abs(Q),ot=d*Mt;return it>ot||-it>ot?it:I(w,T,N,G)}];function D(w){var T=O[w.length];return T||(T=O[w.length]=x(w.length)),T.apply(void 0,w)}function S(w,T,N,G,A,L,E){return function(C,B,j,st,Y){switch(arguments.length){case 0:case 1:return 0;case 2:return G(C,B);case 3:return A(C,B,j);case 4:return L(C,B,j,st);case 5:return E(C,B,j,st,Y)}for(var Q=new Array(arguments.length),tt=0;tt<arguments.length;++tt)Q[tt]=arguments[tt];return w(Q)}}function F(){for(;O.length<=l;)O.push(x(O.length));n.exports=S.apply(void 0,[D].concat(O));for(var w=0;w<=l;++w)n.exports[w]=O[w]}F()})(Af);var B_=Af.exports,z_=q_,ss=B_;function q_(n,t){for(var e=t[0],r=t[1],o=n.length,l=1,f=o,c=0,d=o-1;c<f;d=c++){var p=n[c],v=n[d],y=p[1],x=v[1];if(x<y){if(x<r&&r<y){var M=ss(p,v,t);if(M===0)return 0;l^=0<M|0}else if(r===y){var I=n[(c+1)%o],O=I[1];if(y<O){var M=ss(p,v,t);if(M===0)return 0;l^=0<M|0}}}else if(y<x){if(y<r&&r<x){var M=ss(p,v,t);if(M===0)return 0;l^=M<0|0}else if(r===y){var I=n[(c+1)%o],O=I[1];if(O<y){var M=ss(p,v,t);if(M===0)return 0;l^=M<0|0}}}else if(r===y){var D=Math.min(p[0],v[0]),S=Math.max(p[0],v[0]);if(c===0){for(;d>0;){var F=(d+o-1)%o,w=n[F];if(w[1]!==r)break;var T=w[0];D=Math.min(D,T),S=Math.max(S,T),d=F}if(d===0)return D<=e&&e<=S?0:1;f=d+1}for(var N=n[(d+o-1)%o][1];c+1<f;){var w=n[c+1];if(w[1]!==r)break;var T=w[0];D=Math.min(D,T),S=Math.max(S,T),c+=1}if(D<=e&&e<=S)return 0;var G=n[(c+1)%o][1];e<D&&N<r!=G<r&&(l^=1)}}return 2*l-1}const U_=M_(z_);var Df={};const j_="1.5.0",V_={version:j_};function Ff(n){return"("+n.x+";"+n.y+")"}function Y_(n){var t=n.toString();return t==="[object Object]"?Ff(n):t}function W_(n,t){return n.y===t.y?n.x-t.x:n.y-t.y}function X_(n,t){return n.x===t.x&&n.y===t.y}var Qa={toString:Y_,toStringBase:Ff,compare:W_,equals:X_},Z_=Qa,qs=function(n,t){this.name="PointError",this.points=t=t||[],this.message=n||"Invalid Points!";for(var e=0;e<t.length;e++)this.message+=" "+Z_.toString(t[e])};qs.prototype=new Error;qs.prototype.constructor=qs;var tu=qs,xi=Qa,At=function(n,t){this.x=+n||0,this.y=+t||0,this._p2t_edge_list=null};At.prototype.toString=function(){return xi.toStringBase(this)};At.prototype.toJSON=function(){return{x:this.x,y:this.y}};At.prototype.clone=function(){return new At(this.x,this.y)};At.prototype.set_zero=function(){return this.x=0,this.y=0,this};At.prototype.set=function(n,t){return this.x=+n||0,this.y=+t||0,this};At.prototype.negate=function(){return this.x=-this.x,this.y=-this.y,this};At.prototype.add=function(n){return this.x+=n.x,this.y+=n.y,this};At.prototype.sub=function(n){return this.x-=n.x,this.y-=n.y,this};At.prototype.mul=function(n){return this.x*=n,this.y*=n,this};At.prototype.length=function(){return Math.sqrt(this.x*this.x+this.y*this.y)};At.prototype.normalize=function(){var n=this.length();return this.x/=n,this.y/=n,n};At.prototype.equals=function(n){return this.x===n.x&&this.y===n.y};At.negate=function(n){return new At(-n.x,-n.y)};At.add=function(n,t){return new At(n.x+t.x,n.y+t.y)};At.sub=function(n,t){return new At(n.x-t.x,n.y-t.y)};At.mul=function(n,t){return new At(n*t.x,n*t.y)};At.cross=function(n,t){return typeof n=="number"?typeof t=="number"?n*t:new At(-n*t.y,n*t.x):typeof t=="number"?new At(t*n.y,-t*n.x):n.x*t.y-n.y*t.x};At.toString=xi.toString;At.compare=xi.compare;At.cmp=xi.compare;At.equals=xi.equals;At.dot=function(n,t){return n.x*t.x+n.y*t.y};var Gf=At,H_=Qa,xt=function(n,t,e){this.points_=[n,t,e],this.neighbors_=[null,null,null],this.interior_=!1,this.constrained_edge=[!1,!1,!1],this.delaunay_edge=[!1,!1,!1]},Yo=H_.toString;xt.prototype.toString=function(){return"["+Yo(this.points_[0])+Yo(this.points_[1])+Yo(this.points_[2])+"]"};xt.prototype.getPoint=function(n){return this.points_[n]};xt.prototype.GetPoint=xt.prototype.getPoint;xt.prototype.getPoints=function(){return this.points_};xt.prototype.getNeighbor=function(n){return this.neighbors_[n]};xt.prototype.containsPoint=function(n){var t=this.points_;return n===t[0]||n===t[1]||n===t[2]};xt.prototype.containsEdge=function(n){return this.containsPoint(n.p)&&this.containsPoint(n.q)};xt.prototype.containsPoints=function(n,t){return this.containsPoint(n)&&this.containsPoint(t)};xt.prototype.isInterior=function(){return this.interior_};xt.prototype.setInterior=function(n){return this.interior_=n,this};xt.prototype.markNeighborPointers=function(n,t,e){var r=this.points_;if(n===r[2]&&t===r[1]||n===r[1]&&t===r[2])this.neighbors_[0]=e;else if(n===r[0]&&t===r[2]||n===r[2]&&t===r[0])this.neighbors_[1]=e;else if(n===r[0]&&t===r[1]||n===r[1]&&t===r[0])this.neighbors_[2]=e;else throw new Error("poly2tri Invalid Triangle.markNeighborPointers() call")};xt.prototype.markNeighbor=function(n){var t=this.points_;n.containsPoints(t[1],t[2])?(this.neighbors_[0]=n,n.markNeighborPointers(t[1],t[2],this)):n.containsPoints(t[0],t[2])?(this.neighbors_[1]=n,n.markNeighborPointers(t[0],t[2],this)):n.containsPoints(t[0],t[1])&&(this.neighbors_[2]=n,n.markNeighborPointers(t[0],t[1],this))};xt.prototype.clearNeighbors=function(){this.neighbors_[0]=null,this.neighbors_[1]=null,this.neighbors_[2]=null};xt.prototype.clearDelaunayEdges=function(){this.delaunay_edge[0]=!1,this.delaunay_edge[1]=!1,this.delaunay_edge[2]=!1};xt.prototype.pointCW=function(n){var t=this.points_;return n===t[0]?t[2]:n===t[1]?t[0]:n===t[2]?t[1]:null};xt.prototype.pointCCW=function(n){var t=this.points_;return n===t[0]?t[1]:n===t[1]?t[2]:n===t[2]?t[0]:null};xt.prototype.neighborCW=function(n){return n===this.points_[0]?this.neighbors_[1]:n===this.points_[1]?this.neighbors_[2]:this.neighbors_[0]};xt.prototype.neighborCCW=function(n){return n===this.points_[0]?this.neighbors_[2]:n===this.points_[1]?this.neighbors_[0]:this.neighbors_[1]};xt.prototype.getConstrainedEdgeCW=function(n){return n===this.points_[0]?this.constrained_edge[1]:n===this.points_[1]?this.constrained_edge[2]:this.constrained_edge[0]};xt.prototype.getConstrainedEdgeCCW=function(n){return n===this.points_[0]?this.constrained_edge[2]:n===this.points_[1]?this.constrained_edge[0]:this.constrained_edge[1]};xt.prototype.getConstrainedEdgeAcross=function(n){return n===this.points_[0]?this.constrained_edge[0]:n===this.points_[1]?this.constrained_edge[1]:this.constrained_edge[2]};xt.prototype.setConstrainedEdgeCW=function(n,t){n===this.points_[0]?this.constrained_edge[1]=t:n===this.points_[1]?this.constrained_edge[2]=t:this.constrained_edge[0]=t};xt.prototype.setConstrainedEdgeCCW=function(n,t){n===this.points_[0]?this.constrained_edge[2]=t:n===this.points_[1]?this.constrained_edge[0]=t:this.constrained_edge[1]=t};xt.prototype.getDelaunayEdgeCW=function(n){return n===this.points_[0]?this.delaunay_edge[1]:n===this.points_[1]?this.delaunay_edge[2]:this.delaunay_edge[0]};xt.prototype.getDelaunayEdgeCCW=function(n){return n===this.points_[0]?this.delaunay_edge[2]:n===this.points_[1]?this.delaunay_edge[0]:this.delaunay_edge[1]};xt.prototype.setDelaunayEdgeCW=function(n,t){n===this.points_[0]?this.delaunay_edge[1]=t:n===this.points_[1]?this.delaunay_edge[2]=t:this.delaunay_edge[0]=t};xt.prototype.setDelaunayEdgeCCW=function(n,t){n===this.points_[0]?this.delaunay_edge[2]=t:n===this.points_[1]?this.delaunay_edge[0]=t:this.delaunay_edge[1]=t};xt.prototype.neighborAcross=function(n){return n===this.points_[0]?this.neighbors_[0]:n===this.points_[1]?this.neighbors_[1]:this.neighbors_[2]};xt.prototype.oppositePoint=function(n,t){var e=n.pointCW(t);return this.pointCW(e)};xt.prototype.legalize=function(n,t){var e=this.points_;if(n===e[0])e[1]=e[0],e[0]=e[2],e[2]=t;else if(n===e[1])e[2]=e[1],e[1]=e[0],e[0]=t;else if(n===e[2])e[0]=e[2],e[2]=e[1],e[1]=t;else throw new Error("poly2tri Invalid Triangle.legalize() call")};xt.prototype.index=function(n){var t=this.points_;if(n===t[0])return 0;if(n===t[1])return 1;if(n===t[2])return 2;throw new Error("poly2tri Invalid Triangle.index() call")};xt.prototype.edgeIndex=function(n,t){var e=this.points_;if(n===e[0]){if(t===e[1])return 2;if(t===e[2])return 1}else if(n===e[1]){if(t===e[2])return 0;if(t===e[0])return 2}else if(n===e[2]){if(t===e[0])return 1;if(t===e[1])return 0}return-1};xt.prototype.markConstrainedEdgeByIndex=function(n){this.constrained_edge[n]=!0};xt.prototype.markConstrainedEdgeByEdge=function(n){this.markConstrainedEdgeByPoints(n.p,n.q)};xt.prototype.markConstrainedEdgeByPoints=function(n,t){var e=this.points_;t===e[0]&&n===e[1]||t===e[1]&&n===e[0]?this.constrained_edge[2]=!0:t===e[0]&&n===e[2]||t===e[2]&&n===e[0]?this.constrained_edge[1]=!0:(t===e[1]&&n===e[2]||t===e[2]&&n===e[1])&&(this.constrained_edge[0]=!0)};var eu=xt,nu={};function $_(n,t){if(!n)throw new Error(t||"Assert Failed")}var K_=$_,ru={exports:{}},J_=function(n,t){this.point=n,this.triangle=t||null,this.next=null,this.prev=null,this.value=n.x},$e=function(n,t){this.head_=n,this.tail_=t,this.search_node_=n};$e.prototype.head=function(){return this.head_};$e.prototype.setHead=function(n){this.head_=n};$e.prototype.tail=function(){return this.tail_};$e.prototype.setTail=function(n){this.tail_=n};$e.prototype.search=function(){return this.search_node_};$e.prototype.setSearch=function(n){this.search_node_=n};$e.prototype.findSearchNode=function(){return this.search_node_};$e.prototype.locateNode=function(n){var t=this.search_node_;if(n<t.value){for(;t=t.prev;)if(n>=t.value)return this.search_node_=t,t}else for(;t=t.next;)if(n<t.value)return this.search_node_=t.prev,t.prev;return null};$e.prototype.locatePoint=function(n){var t=n.x,e=this.findSearchNode(t),r=e.point.x;if(t===r){if(n!==e.point)if(n===e.prev.point)e=e.prev;else if(n===e.next.point)e=e.next;else throw new Error("poly2tri Invalid AdvancingFront.locatePoint() call")}else if(t<r)for(;(e=e.prev)&&n!==e.point;);else for(;(e=e.next)&&n!==e.point;);return e&&(this.search_node_=e),e};ru.exports=$e;ru.exports.Node=J_;var Bf=ru.exports,Ir={},di=1e-12;Ir.EPSILON=di;var gs={CW:1,CCW:-1,COLLINEAR:0};Ir.Orientation=gs;function Q_(n,t,e){var r=(n.x-e.x)*(t.y-e.y),o=(n.y-e.y)*(t.x-e.x),l=r-o;return l>-di&&l<di?gs.COLLINEAR:l>0?gs.CCW:gs.CW}Ir.orient2d=Q_;function t1(n,t,e,r){var o=(n.x-t.x)*(r.y-t.y)-(r.x-t.x)*(n.y-t.y);if(o>=-di)return!1;var l=(n.x-e.x)*(r.y-e.y)-(r.x-e.x)*(n.y-e.y);return!(l<=di)}Ir.inScanArea=t1;function e1(n,t,e){var r=t.x-n.x,o=t.y-n.y,l=e.x-n.x,f=e.y-n.y;return r*l+o*f<0}Ir.isAngleObtuse=e1;var iu=K_,Us=tu,zf=eu,n1=Bf.Node,Ei=Ir,r1=Ei.EPSILON,Xt=Ei.Orientation,Kt=Ei.orient2d,qf=Ei.inScanArea,lh=Ei.isAngleObtuse;function i1(n){n.initTriangulation(),n.createAdvancingFront(),s1(n),o1(n)}function s1(n){var t,e=n.pointCount();for(t=1;t<e;++t)for(var r=n.getPoint(t),o=a1(n,r),l=r._p2t_edge_list,f=0;l&&f<l.length;++f)u1(n,l[f],o)}function o1(n){for(var t=n.front().head().next.triangle,e=n.front().head().next.point;!t.getConstrainedEdgeCW(e);)t=t.neighborCCW(e);n.meshClean(t)}function a1(n,t){var e=n.locateNode(t),r=l1(n,t,e);return t.x<=e.point.x+r1&&_r(n,e),h1(n,r),r}function u1(n,t,e){n.edge_event.constrained_edge=t,n.edge_event.right=t.p.x>t.q.x,!Uf(e.triangle,t.p,t.q)&&(p1(n,t,e),su(n,t.p,t.q,e.triangle,t.q))}function su(n,t,e,r,o){if(!Uf(r,t,e)){var l=r.pointCCW(o),f=Kt(e,l,t);if(f===Xt.COLLINEAR)throw new Us("poly2tri EdgeEvent: Collinear not supported!",[e,l,t]);var c=r.pointCW(o),d=Kt(e,c,t);if(d===Xt.COLLINEAR)throw new Us("poly2tri EdgeEvent: Collinear not supported!",[e,c,t]);f===d?(f===Xt.CW?r=r.neighborCCW(o):r=r.neighborCW(o),su(n,t,e,r,o)):uu(n,t,e,r,o)}}function Uf(n,t,e){var r=n.edgeIndex(t,e);if(r!==-1){n.markConstrainedEdgeByIndex(r);var o=n.getNeighbor(r);return o&&o.markConstrainedEdgeByPoints(t,e),!0}return!1}function l1(n,t,e){var r=new zf(t,e.point,e.next.point);r.markNeighbor(e.triangle),n.addToMap(r);var o=new n1(t);return o.next=e.next,o.prev=e,e.next.prev=o,e.next=o,In(n,r)||n.mapTriangleToNodes(r),o}function _r(n,t){var e=new zf(t.prev.point,t.point,t.next.point);e.markNeighbor(t.prev.triangle),e.markNeighbor(t.triangle),n.addToMap(e),t.prev.next=t.next,t.next.prev=t.prev,In(n,e)||n.mapTriangleToNodes(e)}function h1(n,t){for(var e=t.next;e.next&&!lh(e.point,e.next.point,e.prev.point);)_r(n,e),e=e.next;for(e=t.prev;e.prev&&!lh(e.point,e.next.point,e.prev.point);)_r(n,e),e=e.prev;t.next&&t.next.next&&c1(t)&&g1(n,t)}function c1(n){var t=n.point.x-n.next.next.point.x,e=n.point.y-n.next.next.point.y;return iu(e>=0,"unordered y"),t>=0||Math.abs(t)<e}function In(n,t){for(var e=0;e<3;++e)if(!t.delaunay_edge[e]){var r=t.getNeighbor(e);if(r){var o=t.getPoint(e),l=r.oppositePoint(t,o),f=r.index(l);if(r.constrained_edge[f]||r.delaunay_edge[f]){t.constrained_edge[e]=r.constrained_edge[f];continue}var c=f1(o,t.pointCCW(o),t.pointCW(o),l);if(c){t.delaunay_edge[e]=!0,r.delaunay_edge[f]=!0,jf(t,o,r,l);var d=!In(n,t);return d&&n.mapTriangleToNodes(t),d=!In(n,r),d&&n.mapTriangleToNodes(r),t.delaunay_edge[e]=!1,r.delaunay_edge[f]=!1,!0}}}return!1}function f1(n,t,e,r){var o=n.x-r.x,l=n.y-r.y,f=t.x-r.x,c=t.y-r.y,d=o*c,p=f*l,v=d-p;if(v<=0)return!1;var y=e.x-r.x,x=e.y-r.y,M=y*l,I=o*x,O=M-I;if(O<=0)return!1;var D=f*x,S=y*c,F=o*o+l*l,w=f*f+c*c,T=y*y+x*x,N=F*(D-S)+w*O+T*v;return N>0}function jf(n,t,e,r){var o,l,f,c;o=n.neighborCCW(t),l=n.neighborCW(t),f=e.neighborCCW(r),c=e.neighborCW(r);var d,p,v,y;d=n.getConstrainedEdgeCCW(t),p=n.getConstrainedEdgeCW(t),v=e.getConstrainedEdgeCCW(r),y=e.getConstrainedEdgeCW(r);var x,M,I,O;x=n.getDelaunayEdgeCCW(t),M=n.getDelaunayEdgeCW(t),I=e.getDelaunayEdgeCCW(r),O=e.getDelaunayEdgeCW(r),n.legalize(t,r),e.legalize(r,t),e.setDelaunayEdgeCCW(t,x),n.setDelaunayEdgeCW(t,M),n.setDelaunayEdgeCCW(r,I),e.setDelaunayEdgeCW(r,O),e.setConstrainedEdgeCCW(t,d),n.setConstrainedEdgeCW(t,p),n.setConstrainedEdgeCCW(r,v),e.setConstrainedEdgeCW(r,y),n.clearNeighbors(),e.clearNeighbors(),o&&e.markNeighbor(o),l&&n.markNeighbor(l),f&&n.markNeighbor(f),c&&e.markNeighbor(c),n.markNeighbor(e)}function g1(n,t){for(Kt(t.point,t.next.point,t.next.next.point)===Xt.CCW?n.basin.left_node=t.next.next:n.basin.left_node=t.next,n.basin.bottom_node=n.basin.left_node;n.basin.bottom_node.next&&n.basin.bottom_node.point.y>=n.basin.bottom_node.next.point.y;)n.basin.bottom_node=n.basin.bottom_node.next;if(n.basin.bottom_node!==n.basin.left_node){for(n.basin.right_node=n.basin.bottom_node;n.basin.right_node.next&&n.basin.right_node.point.y<n.basin.right_node.next.point.y;)n.basin.right_node=n.basin.right_node.next;n.basin.right_node!==n.basin.bottom_node&&(n.basin.width=n.basin.right_node.point.x-n.basin.left_node.point.x,n.basin.left_highest=n.basin.left_node.point.y>n.basin.right_node.point.y,Vf(n,n.basin.bottom_node))}}function Vf(n,t){if(!d1(n,t)){_r(n,t);var e;if(!(t.prev===n.basin.left_node&&t.next===n.basin.right_node)){if(t.prev===n.basin.left_node){if(e=Kt(t.point,t.next.point,t.next.next.point),e===Xt.CW)return;t=t.next}else if(t.next===n.basin.right_node){if(e=Kt(t.point,t.prev.point,t.prev.prev.point),e===Xt.CCW)return;t=t.prev}else t.prev.point.y<t.next.point.y?t=t.prev:t=t.next;Vf(n,t)}}}function d1(n,t){var e;return n.basin.left_highest?e=n.basin.left_node.point.y-t.point.y:e=n.basin.right_node.point.y-t.point.y,n.basin.width>e}function p1(n,t,e){n.edge_event.right?m1(n,t,e):v1(n,t,e)}function m1(n,t,e){for(;e.next.point.x<t.p.x;)Kt(t.q,e.next.point,t.p)===Xt.CCW?Yf(n,t,e):e=e.next}function Yf(n,t,e){e.point.x<t.p.x&&(Kt(e.point,e.next.point,e.next.next.point)===Xt.CCW?ou(n,t,e):(Wf(n,t,e),Yf(n,t,e)))}function ou(n,t,e){_r(n,e.next),e.next.point!==t.p&&Kt(t.q,e.next.point,t.p)===Xt.CCW&&Kt(e.point,e.next.point,e.next.next.point)===Xt.CCW&&ou(n,t,e)}function Wf(n,t,e){Kt(e.next.point,e.next.next.point,e.next.next.next.point)===Xt.CCW?ou(n,t,e.next):Kt(t.q,e.next.next.point,t.p)===Xt.CCW&&Wf(n,t,e.next)}function v1(n,t,e){for(;e.prev.point.x>t.p.x;)Kt(t.q,e.prev.point,t.p)===Xt.CW?Xf(n,t,e):e=e.prev}function Xf(n,t,e){e.point.x>t.p.x&&(Kt(e.point,e.prev.point,e.prev.prev.point)===Xt.CW?au(n,t,e):(Zf(n,t,e),Xf(n,t,e)))}function Zf(n,t,e){Kt(e.prev.point,e.prev.prev.point,e.prev.prev.prev.point)===Xt.CW?au(n,t,e.prev):Kt(t.q,e.prev.prev.point,t.p)===Xt.CW&&Zf(n,t,e.prev)}function au(n,t,e){_r(n,e.prev),e.prev.point!==t.p&&Kt(t.q,e.prev.point,t.p)===Xt.CW&&Kt(e.point,e.prev.point,e.prev.prev.point)===Xt.CW&&au(n,t,e)}function uu(n,t,e,r,o){var l=r.neighborAcross(o);iu(l,"FLIP failed due to missing triangle!");var f=l.oppositePoint(r,o);if(r.getConstrainedEdgeAcross(o)){var c=r.index(o);throw new Us("poly2tri Intersecting Constraints",[o,f,r.getPoint((c+1)%3),r.getPoint((c+2)%3)])}if(qf(o,r.pointCCW(o),r.pointCW(o),f))if(jf(r,o,l,f),n.mapTriangleToNodes(r),n.mapTriangleToNodes(l),o===e&&f===t)e===n.edge_event.constrained_edge.q&&t===n.edge_event.constrained_edge.p&&(r.markConstrainedEdgeByPoints(t,e),l.markConstrainedEdgeByPoints(t,e),In(n,r),In(n,l));else{var d=Kt(e,f,t);r=y1(n,d,r,l,o,f),uu(n,t,e,r,o)}else{var p=Hf(t,e,l,f);$f(n,t,e,r,l,p),su(n,t,e,r,o)}}function y1(n,t,e,r,o,l){var f;return t===Xt.CCW?(f=r.edgeIndex(o,l),r.delaunay_edge[f]=!0,In(n,r),r.clearDelaunayEdges(),e):(f=e.edgeIndex(o,l),e.delaunay_edge[f]=!0,In(n,e),e.clearDelaunayEdges(),r)}function Hf(n,t,e,r){var o=Kt(t,r,n);if(o===Xt.CW)return e.pointCCW(r);if(o===Xt.CCW)return e.pointCW(r);throw new Us("poly2tri [Unsupported] nextFlipPoint: opposing point on constrained edge!",[t,r,n])}function $f(n,t,e,r,o,l){var f=o.neighborAcross(l);iu(f,"FLIP failed due to missing triangle");var c=f.oppositePoint(o,l);if(qf(e,r.pointCCW(e),r.pointCW(e),c))uu(n,e,c,f,c);else{var d=Hf(t,e,f,c);$f(n,t,e,r,f,d)}}nu.triangulate=i1;var _1=tu,Dr=Gf,w1=eu,x1=nu,Kf=Bf,Wo=Kf.Node,hh=.3,E1=function(n,t){if(this.p=n,this.q=t,n.y>t.y)this.q=n,this.p=t;else if(n.y===t.y){if(n.x>t.x)this.q=n,this.p=t;else if(n.x===t.x)throw new _1("poly2tri Invalid Edge constructor: repeated points!",[n])}this.q._p2t_edge_list||(this.q._p2t_edge_list=[]),this.q._p2t_edge_list.push(this)},Jf=function(){this.left_node=null,this.bottom_node=null,this.right_node=null,this.width=0,this.left_highest=!1};Jf.prototype.clear=function(){this.left_node=null,this.bottom_node=null,this.right_node=null,this.width=0,this.left_highest=!1};var k1=function(){this.constrained_edge=null,this.right=!1},Pt=function(n,t){t=t||{},this.triangles_=[],this.map_=[],this.points_=t.cloneArrays?n.slice(0):n,this.edge_list=[],this.pmin_=this.pmax_=null,this.front_=null,this.head_=null,this.tail_=null,this.af_head_=null,this.af_middle_=null,this.af_tail_=null,this.basin=new Jf,this.edge_event=new k1,this.initEdges(this.points_)};Pt.prototype.addHole=function(n){this.initEdges(n);var t,e=n.length;for(t=0;t<e;t++)this.points_.push(n[t]);return this};Pt.prototype.AddHole=Pt.prototype.addHole;Pt.prototype.addHoles=function(n){var t,e=n.length;for(t=0;t<e;t++)this.initEdges(n[t]);return this.points_=this.points_.concat.apply(this.points_,n),this};Pt.prototype.addPoint=function(n){return this.points_.push(n),this};Pt.prototype.AddPoint=Pt.prototype.addPoint;Pt.prototype.addPoints=function(n){return this.points_=this.points_.concat(n),this};Pt.prototype.triangulate=function(){return x1.triangulate(this),this};Pt.prototype.getBoundingBox=function(){return{min:this.pmin_,max:this.pmax_}};Pt.prototype.getTriangles=function(){return this.triangles_};Pt.prototype.GetTriangles=Pt.prototype.getTriangles;Pt.prototype.front=function(){return this.front_};Pt.prototype.pointCount=function(){return this.points_.length};Pt.prototype.head=function(){return this.head_};Pt.prototype.setHead=function(n){this.head_=n};Pt.prototype.tail=function(){return this.tail_};Pt.prototype.setTail=function(n){this.tail_=n};Pt.prototype.getMap=function(){return this.map_};Pt.prototype.initTriangulation=function(){var n=this.points_[0].x,t=this.points_[0].x,e=this.points_[0].y,r=this.points_[0].y,o,l=this.points_.length;for(o=1;o<l;o++){var f=this.points_[o];f.x>n&&(n=f.x),f.x<t&&(t=f.x),f.y>e&&(e=f.y),f.y<r&&(r=f.y)}this.pmin_=new Dr(t,r),this.pmax_=new Dr(n,e);var c=hh*(n-t),d=hh*(e-r);this.head_=new Dr(n+c,r-d),this.tail_=new Dr(t-c,r-d),this.points_.sort(Dr.compare)};Pt.prototype.initEdges=function(n){var t,e=n.length;for(t=0;t<e;++t)this.edge_list.push(new E1(n[t],n[(t+1)%e]))};Pt.prototype.getPoint=function(n){return this.points_[n]};Pt.prototype.addToMap=function(n){this.map_.push(n)};Pt.prototype.locateNode=function(n){return this.front_.locateNode(n.x)};Pt.prototype.createAdvancingFront=function(){var n,t,e,r=new w1(this.points_[0],this.tail_,this.head_);this.map_.push(r),n=new Wo(r.getPoint(1),r),t=new Wo(r.getPoint(0),r),e=new Wo(r.getPoint(2)),this.front_=new Kf(n,e),n.next=t,t.next=e,t.prev=n,e.prev=t};Pt.prototype.removeNode=function(n){};Pt.prototype.mapTriangleToNodes=function(n){for(var t=0;t<3;++t)if(!n.getNeighbor(t)){var e=this.front_.locatePoint(n.pointCW(n.getPoint(t)));e&&(e.triangle=n)}};Pt.prototype.removeFromMap=function(n){var t,e=this.map_,r=e.length;for(t=0;t<r;t++)if(e[t]===n){e.splice(t,1);break}};Pt.prototype.meshClean=function(n){for(var t=[n],e,r;e=t.pop();)if(!e.isInterior())for(e.setInterior(!0),this.triangles_.push(e),r=0;r<3;r++)e.constrained_edge[r]||t.push(e.getNeighbor(r))};var I1=Pt;(function(n){var t=globalThis.poly2tri;n.noConflict=function(){return globalThis.poly2tri=t,n},n.VERSION=V_.version,n.PointError=tu,n.Point=Gf,n.Triangle=eu,n.SweepContext=I1;var e=nu;n.triangulate=e.triangulate,n.sweep={Triangulate:e.triangulate}})(Df);function T1(n,t){let e=0;const r=new Df.SweepContext(I_(n,t).map(o=>({x:o[0],y:o[1],type:"p",item:e++})));r.addPoints(T_(n,t).filter(o=>U_(n,o)===-1).map(o=>({x:o[0],y:o[1],type:"g",item:e++})));try{r.triangulate()}catch{throw new Error("A Point Error occured during resource mask triangulation. This is typically because the resource mask contains duplicate or collinear points, or is self-intersecting.")}return r.getTriangles()}function M1(n,t){const e=T1(n,t).map(o=>o.getPoints().map(l=>l)),r=[...new Map(e.flat().map(o=>[o.item,o])).values()].sort((o,l)=>o.item-l.item).map(o=>[o.x,o.y]);return{uniquePointsIndexTriangles:e.map(o=>o.map(l=>l.item)),uniquePoints:r}}const b1=80,N1=10;function S1(){return{}}class R1 extends __{resourceTrianglePoints=[];resourceUniquePoints=[];trianglePointsUniquePointsIndex=[];triangulationByBestScaleFactor=new Map;triangulateErrorCount=0;projectedGeoPreviousTrianglePoints=[];projectedGeoTrianglePoints=[];projectedGeoUniquePoints=[];projectedGeoUniquePointsByBestScaleFactorAndTransformationType=new Map;projectedGeoUniquePointsPartialDerivativeX=[];projectedGeoUniquePointsPartialDerivativeY=[];projectedGeoUniquePointsPartialDerivativeXByBestScaleFactorAndTransformationType=new Map;projectedGeoUniquePointsPartialDerivativeYByBestScaleFactorAndTransformationType=new Map;previousTrianglePointsDistortion=[];trianglePointsDistortion=[];uniquePointsDistortion=[];constructor(t,e,r){r={...S1(),...r},super(t,e,r)}setResourceMask(t){super.setResourceMask(t),this.triangulationByBestScaleFactor=new Map,this.projectedGeoUniquePointsByBestScaleFactorAndTransformationType=new Map,this.projectedGeoUniquePointsPartialDerivativeXByBestScaleFactorAndTransformationType=new Map,this.projectedGeoUniquePointsPartialDerivativeYByBestScaleFactorAndTransformationType=new Map,this.updateTriangulation()}setBestScaleFactor(t){const e=super.setBestScaleFactor(t);return e&&this.updateTriangulation(!0),e}updateTriangulation(t=!1){const{trianglePointsUniquePointsIndex:e,resourceUniquePoints:r}=hs(this.triangulationByBestScaleFactor,this.bestScaleFactor,()=>{const o=ov(this.resourceMask)*this.bestScaleFactor/b1;try{const{uniquePointsIndexTriangles:l,uniquePoints:f}=M1(this.resourceMask,o);return{trianglePointsUniquePointsIndex:l.flat(),resourceUniquePoints:f}}catch(l){return this.triangulateErrorCount++,this.triangulateErrorCount<=N1&&(console.error(`Error computing triangulation for map ${this.mapId}.`,`Fix this map with Allmaps Editor: https://editor.allmaps.org/#/collection?url=${this.parsedImage?.uri}/info.json`),this.triangulateErrorCount===1&&console.error(l)),{trianglePointsUniquePointsIndex:this.trianglePointsUniquePointsIndex,resourceUniquePoints:this.resourceUniquePoints}}});this.resourceTrianglePoints=e.map(o=>r[o]),this.resourceUniquePoints=r,this.trianglePointsUniquePointsIndex=e,this.updateProjectedGeoTrianglePoints(t)}updateProjectedGeoTrianglePoints(t=!1){this.projectedGeoUniquePoints=Bo(this.projectedGeoUniquePointsByBestScaleFactorAndTransformationType,this.bestScaleFactor,this.transformationType,()=>this.resourceUniquePoints.map(e=>this.projectedTransformer.transformToGeo(e))),this.projectedGeoTrianglePoints=this.trianglePointsUniquePointsIndex.map(e=>this.projectedGeoUniquePoints[e]),(t||!this.projectedGeoPreviousTrianglePoints.length)&&(this.projectedGeoPreviousTrianglePoints=this.projectedGeoTrianglePoints),this.updateTrianglePointsDistortion(t)}updateTrianglePointsDistortion(t=!1){this.distortionMeasure&&(this.projectedGeoUniquePointsPartialDerivativeX=Bo(this.projectedGeoUniquePointsPartialDerivativeXByBestScaleFactorAndTransformationType,this.bestScaleFactor,this.transformationType,()=>this.resourceUniquePoints.map(e=>this.projectedTransformer.transformToGeo(e,{evaluationType:"partialDerivativeX"}))),this.projectedGeoUniquePointsPartialDerivativeY=Bo(this.projectedGeoUniquePointsPartialDerivativeYByBestScaleFactorAndTransformationType,this.bestScaleFactor,this.transformationType,()=>this.resourceUniquePoints.map(e=>this.projectedTransformer.transformToGeo(e,{evaluationType:"partialDerivativeY"})))),this.uniquePointsDistortion=this.projectedGeoUniquePoints.map((e,r)=>v_(this.projectedGeoUniquePointsPartialDerivativeX[r],this.projectedGeoUniquePointsPartialDerivativeY[r],this.distortionMeasure,this.getReferenceScale())),this.trianglePointsDistortion=this.trianglePointsUniquePointsIndex.map(e=>this.uniquePointsDistortion[e]),(t||!this.previousTrianglePointsDistortion.length)&&(this.previousTrianglePointsDistortion=this.trianglePointsDistortion)}resetTrianglePoints(){this.projectedGeoPreviousTrianglePoints=this.projectedGeoTrianglePoints,this.previousTrianglePointsDistortion=this.trianglePointsDistortion}mixTrianglePoints(t){this.projectedGeoPreviousTrianglePoints=this.projectedGeoTrianglePoints.map((e,r)=>Xm(e,this.projectedGeoPreviousTrianglePoints[r],t)),this.previousTrianglePointsDistortion=this.trianglePointsDistortion.map((e,r)=>Wm(e,this.previousTrianglePointsDistortion[r],t))}}function C1(n){let t=0,e=0;for(const f of n)t+=f.w*f.h,e=Math.max(e,f.w);n.sort((f,c)=>c.h-f.h);const r=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(t/.95)),e),h:1/0}];let o=0,l=0;for(const f of n)for(let c=r.length-1;c>=0;c--){const d=r[c];if(!(f.w>d.w||f.h>d.h)){if(f.x=d.x,f.y=d.y,l=Math.max(l,f.y+f.h),o=Math.max(o,f.x+f.w),f.w===d.w&&f.h===d.h){const p=r.pop();c<r.length&&(r[c]=p)}else f.h===d.h?(d.x+=f.w,d.w-=f.w):f.w===d.w?(d.y+=f.h,d.h-=f.h):(r.push({x:d.x+f.w,y:d.y,w:d.w-f.w,h:f.h}),d.y+=f.h,d.h-=f.h);break}}return{w:o,h:l,fill:t/(o*l)||0}}var P1=typeof globalThis=="object"&&globalThis&&globalThis.Object===Object&&globalThis,L1=typeof self=="object"&&self&&self.Object===Object&&self,Qf=P1||L1||Function("return this")(),js=Qf.Symbol,tg=Object.prototype,A1=tg.hasOwnProperty,O1=tg.toString,Fr=js?js.toStringTag:void 0;function D1(n){var t=A1.call(n,Fr),e=n[Fr];try{n[Fr]=void 0;var r=!0}catch{}var o=O1.call(n);return r&&(t?n[Fr]=e:delete n[Fr]),o}var F1=Object.prototype,G1=F1.toString;function B1(n){return G1.call(n)}var z1="[object Null]",q1="[object Undefined]",ch=js?js.toStringTag:void 0;function U1(n){return n==null?n===void 0?q1:z1:ch&&ch in Object(n)?D1(n):B1(n)}function j1(n){return n!=null&&typeof n=="object"}var V1="[object Symbol]";function Y1(n){return typeof n=="symbol"||j1(n)&&U1(n)==V1}var W1=/\s/;function X1(n){for(var t=n.length;t--&&W1.test(n.charAt(t)););return t}var Z1=/^\s+/;function H1(n){return n&&n.slice(0,X1(n)+1).replace(Z1,"")}function Vs(n){var t=typeof n;return n!=null&&(t=="object"||t=="function")}var fh=NaN,$1=/^[-+]0x[0-9a-f]+$/i,K1=/^0b[01]+$/i,J1=/^0o[0-7]+$/i,Q1=parseInt;function gh(n){if(typeof n=="number")return n;if(Y1(n))return fh;if(Vs(n)){var t=typeof n.valueOf=="function"?n.valueOf():n;n=Vs(t)?t+"":t}if(typeof n!="string")return n===0?n:+n;n=H1(n);var e=K1.test(n);return e||J1.test(n)?Q1(n.slice(2),e?2:8):$1.test(n)?fh:+n}var Xo=function(){return Qf.Date.now()},tw="Expected a function",ew=Math.max,nw=Math.min;function rw(n,t,e){var r,o,l,f,c,d,p=0,v=!1,y=!1,x=!0;if(typeof n!="function")throw new TypeError(tw);t=gh(t)||0,Vs(e)&&(v=!!e.leading,y="maxWait"in e,l=y?ew(gh(e.maxWait)||0,t):l,x="trailing"in e?!!e.trailing:x);function M(G){var A=r,L=o;return r=o=void 0,p=G,f=n.apply(L,A),f}function I(G){return p=G,c=setTimeout(S,t),v?M(G):f}function O(G){var A=G-d,L=G-p,E=t-A;return y?nw(E,l-L):E}function D(G){var A=G-d,L=G-p;return d===void 0||A>=t||A<0||y&&L>=l}function S(){var G=Xo();if(D(G))return F(G);c=setTimeout(S,O(G))}function F(G){return c=void 0,x&&r?M(G):(r=o=void 0,f)}function w(){c!==void 0&&clearTimeout(c),p=0,r=d=o=c=void 0}function T(){return c===void 0?f:F(Xo())}function N(){var G=Xo(),A=D(G);if(r=arguments,o=this,d=G,A){if(c===void 0)return I(d);if(y)return clearTimeout(c),c=setTimeout(S,t),M(d)}return c===void 0&&(c=setTimeout(S,t)),f}return N.cancel=w,N.flush=T,N}var iw="Expected a function";function Ia(n,t,e){var r=!0,o=!0;if(typeof n!="function")throw new TypeError(iw);return Vs(e)&&(r="leading"in e?!!e.leading:r,o="trailing"in e?!!e.trailing:o),rw(n,t,{leading:r,maxWait:t,trailing:o})}const sw=.5;function eg(n,t){return`${n}:${t}`}function ng(n){return eg(n.mapId,n.tileUrl)}function Zo(n){return new Set(n.map(t=>ng(t)))}function ow(n,t,e=sw){let r=Number.POSITIVE_INFINITY,o=n.tileZoomLevels.at(-1);for(const l of n.tileZoomLevels){const f=Math.abs(Math.log(l.scaleFactor)-Math.log(t+e));f<r&&(r=f,o=l)}return o}function aw(n,t,e){const r=uw(n,t),o=lw(r),l=cw(o,e,t),f=dr(ne(n));return l.sort((c,d)=>dh(c,f)-dh(d,f)),l}function uw(n,t){return n.map(e=>[e[0]/t.originalWidth,e[1]/t.originalHeight])}function lw(n){const t={};for(let e=0;e<n.length;e++){const r=[n[e],n[(e+1)%n.length]];hw(r).forEach(([o,l])=>{t[o]||(t[o]=[Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY]),l<t[o][0]&&(t[o][0]=l),l>t[o][1]&&(t[o][1]=l)})}return t}function hw([n,t]){let e=Math.floor(n[0]),r=Math.floor(n[1]);const o=Math.floor(t[0]),l=Math.floor(t[1]),f=[[e,r]];if(e===o&&r===l)return f;const c=Math.sign(t[0]-n[0]),d=Math.sign(t[1]-n[1]),p=Math.abs(n[0]-e-Math.max(0,c)),v=Math.abs(n[1]-r-Math.max(0,d)),y=Math.abs(n[0]-t[0]),x=Math.abs(n[1]-t[1]);let M=p/y,I=v/x;const O=1/y,D=1/x;for(;!(e===o&&r===l);)M<I?(M=M+O,e=e+c):(I=I+D,r=r+d),f.push([e,r]);return f}function cw(n,t,e){const r=[];for(const o in n){const l=parseInt(o);if(l<0||l>=e.columns)break;const f=Math.max(n[l][0],0),c=Math.min(n[l][1],e.rows-1);for(let d=f;d<=c;d++)r.push({column:l,row:d,tileZoomLevel:e,imageSize:[t.width,t.height]})}return r}function fw(n){return(n.imageRequest.size?.height||0)*(n.imageRequest.size?.width||0)*3}function dh(n,t){return ye(gw(n),t)}function gw(n){const t=rg(n);return[(t[2]-t[0])/2+t[0],(t[3]-t[1])/2+t[1]]}function dw(n){const t=n.column*n.tileZoomLevel.originalWidth,e=n.row*n.tileZoomLevel.originalHeight;return[t,e]}function rg(n){const t=dw(n),e=Math.min(t[0]+n.tileZoomLevel.originalWidth,n.imageSize[0]),r=Math.min(t[1]+n.tileZoomLevel.originalHeight,n.imageSize[1]);return[t[0],t[1],e,r]}function ph(n,t,e){const r=n.createShader(t);if(r){if(n.shaderSource(r,e),n.compileShader(r),n.getShaderParameter(r,n.COMPILE_STATUS))return r;{const o=n.getShaderInfoLog(r);throw n.deleteShader(r),new Error("Failed to compile shader: "+o)}}else throw new Error("Failed to create shader")}function pw(n,t,e){const r=n.createProgram();if(r){if(n.attachShader(r,t),n.attachShader(r,e),n.linkProgram(r),n.getProgramParameter(r,n.LINK_STATUS))return r;{const o=n.getProgramInfoLog(r);throw n.deleteProgram(r),new Error("Failed to link program: "+o)}}else throw new Error("Failed to create program")}function er(n,t,e,r,o){const l=n.createBuffer();n.bindBuffer(n.ARRAY_BUFFER,l),n.bufferData(n.ARRAY_BUFFER,e,n.STATIC_DRAW);const f=n.FLOAT,c=!1,d=0,p=0,v=n.getAttribLocation(t,o);n.vertexAttribPointer(v,r,f,c,d,p),n.enableVertexAttribArray(v)}const mw=100,vw={leading:!0,trailing:!0},yw=1,_w=1;function ww(n,t){return(e,r,o)=>new xw(e,r,n,t,o)}let xw=class extends R1{gl;program;vao;CachedTilesByTileUrl=new Map;opacity=yw;saturation=_w;renderOptions={};packedTilesTexture;packedTilesPositionsTexture;packedTilesResourcePositionsAndDimensionsTexture;packedTilesScaleFactorsTexture;projectedGeoToClipTransform;throttledUpdateTextures;constructor(n,t,e,r,o){super(n,t,o),this.gl=e,this.program=r,this.vao=e.createVertexArray(),this.packedTilesTexture=e.createTexture(),this.packedTilesScaleFactorsTexture=e.createTexture(),this.packedTilesPositionsTexture=e.createTexture(),this.packedTilesResourcePositionsAndDimensionsTexture=e.createTexture(),this.throttledUpdateTextures=Ia(this.updateTextures.bind(this),mw,vw)}updateVertexBuffers(n){this.projectedGeoToClipTransform=n,this.updateVertexBuffersInternal()}addCachedTileAndUpdateTextures(n){this.CachedTilesByTileUrl.set(n.tileUrl,n),this.throttledUpdateTextures()}removeCachedTileAndUpdateTextures(n){this.CachedTilesByTileUrl.delete(n),this.throttledUpdateTextures()}dispose(){this.gl.deleteVertexArray(this.vao),this.gl.deleteTexture(this.packedTilesTexture),this.gl.deleteTexture(this.packedTilesScaleFactorsTexture),this.gl.deleteTexture(this.packedTilesPositionsTexture),this.gl.deleteTexture(this.packedTilesResourcePositionsAndDimensionsTexture)}updateVertexBuffersInternal(){if(!this.vao||!this.projectedGeoToClipTransform)return;this.gl.bindVertexArray(this.vao);const n=this.resourceTrianglePoints;er(this.gl,this.program,new Float32Array(n.flat()),2,"a_resourceTrianglePoint");const t=this.projectedGeoPreviousTrianglePoints.map(f=>ur(this.projectedGeoToClipTransform,f));er(this.gl,this.program,new Float32Array(t.flat()),2,"a_clipPreviousTrianglePoint");const e=this.projectedGeoTrianglePoints.map(f=>ur(this.projectedGeoToClipTransform,f));er(this.gl,this.program,new Float32Array(e.flat()),2,"a_clipTrianglePoint");const r=this.previousTrianglePointsDistortion;er(this.gl,this.program,new Float32Array(r),1,"a_previousTrianglePointDistortion");const o=this.trianglePointsDistortion;er(this.gl,this.program,new Float32Array(o),1,"a_trianglePointDistortion");const l=new Float32Array(this.resourceTrianglePoints.length).map((f,c)=>Math.round((c-1)/3));er(this.gl,this.program,l,1,"a_triangleIndex")}async updateTextures(){const n=this.gl;if(this.CachedTilesByTileUrl.size===0)return;let t=[...this.CachedTilesByTileUrl.values()];t=t.filter(p=>this.resourceViewportRingBbox?iv(rg(p.tile),this.resourceViewportRingBbox):!0);const e=t.length,r=t.map((p,v)=>({w:p.data.width,h:p.data.height,x:0,y:0,index:v})),{w:o,h:l}=C1(r);n.pixelStorei(n.UNPACK_ALIGNMENT,4),n.bindTexture(n.TEXTURE_2D,this.packedTilesTexture),n.texImage2D(n.TEXTURE_2D,0,n.RGBA,o,l,0,n.RGBA,n.UNSIGNED_BYTE,null);for(const p of r){const v=t[p.index].data;n.texSubImage2D(n.TEXTURE_2D,0,p.x,p.y,v.width,v.height,n.RGBA,n.UNSIGNED_BYTE,v)}n.texParameteri(n.TEXTURE_2D,n.TEXTURE_MIN_FILTER,n.LINEAR),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_MAG_FILTER,n.LINEAR),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_WRAP_S,n.CLAMP_TO_EDGE),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_WRAP_T,n.CLAMP_TO_EDGE);const f=r.map(p=>[p.x,p.y]);n.bindTexture(n.TEXTURE_2D,this.packedTilesPositionsTexture),n.texImage2D(n.TEXTURE_2D,0,n.RG32I,1,e,0,n.RG_INTEGER,n.INT,new Int32Array(f.flat())),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_MIN_FILTER,n.NEAREST),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_MAG_FILTER,n.NEAREST),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_WRAP_S,n.CLAMP_TO_EDGE),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_WRAP_T,n.CLAMP_TO_EDGE);const c=r.map(p=>{const v=t[p.index];if(v&&v.imageRequest&&v.imageRequest.region)return[v.imageRequest.region.x,v.imageRequest.region.y,v.imageRequest.region.width,v.imageRequest.region.height]});n.bindTexture(n.TEXTURE_2D,this.packedTilesResourcePositionsAndDimensionsTexture),n.texImage2D(n.TEXTURE_2D,0,n.RGBA32I,1,e,0,n.RGBA_INTEGER,n.INT,new Int32Array(c.flat())),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_MIN_FILTER,n.NEAREST),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_MAG_FILTER,n.NEAREST),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_WRAP_S,n.CLAMP_TO_EDGE),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_WRAP_T,n.CLAMP_TO_EDGE);const d=r.map(({index:p})=>t[p].tile.tileZoomLevel.scaleFactor);n.bindTexture(n.TEXTURE_2D,this.packedTilesScaleFactorsTexture),n.texImage2D(n.TEXTURE_2D,0,n.R32I,1,e,0,n.RED_INTEGER,n.INT,new Int32Array(d)),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_MIN_FILTER,n.NEAREST),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_MAG_FILTER,n.NEAREST),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_WRAP_S,n.CLAMP_TO_EDGE),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_WRAP_T,n.CLAMP_TO_EDGE),this.dispatchEvent(new wt($.TEXTURESUPDATED))}};const Ew=P.string().or(P.number()).or(P.boolean()),kw=P.record(P.string(),Ew.array()),Tn=P.tuple([P.number(),P.number()]),ig=P.object({type:P.literal("Point"),coordinates:Tn}),sg=Tn.array().min(3),ki=P.enum(["ImageService1","ImageService2","ImageService3"]),Iw=P.object({id:P.string().url(),type:P.string(),label:kw.optional()}),ro=Iw.extend({partOf:P.lazy(()=>ro.array()).optional()}),io=P.union([P.any(),P.object({type:P.string(),options:P.object({}).optional()})]).transform(n=>{if(n&&typeof n=="object"&&"type"in n)return n}),so=P.union([P.string().url().array(),P.string().url()]),Tw=/^<svg\s+width="\d+"\s+height="\d+"\s*>\s*<polygon\s+points="\s*(-?\d+(\.\d+)?,-?\d+(\.\d+)?\s+){2,}-?\d+(\.\d+)?,-?\d+(\.\d+)?\s*"\s*\/>\s*<\/svg>$/,Mw=P.object({type:P.literal("SvgSelector"),value:P.string().regex(Tw)}),bw=P.object({source:P.string().url(),service:P.array(P.object({"@id":P.string().url(),type:ki})).length(1),selector:Mw}),og=P.object({pixelCoords:Tn}),Nw=P.object({type:P.literal("FeatureCollection"),transformation:io.optional(),features:P.array(P.object({type:P.literal("Feature"),properties:og,geometry:ig}))}),lu=P.object({id:P.string().optional(),type:P.literal("Annotation"),"@context":so.optional(),motivation:P.string().default("georeferencing").optional(),target:bw,body:Nw}),ag=P.object({id:P.string().optional(),type:P.literal("AnnotationPage"),"@context":so.optional(),items:P.array(lu)}),hu=/<polygon\s+points="\s*(-?\d+(\.\d+)?,-?\d+(\.\d+)?\s+){2,}-?\d+(\.\d+)?,-?\d+(\.\d+)?\s*"\s*\/>/,Sw=new RegExp(`^<svg\\s+width="\\d+"\\s+height="\\d+"\\s*>\\s*${hu.source}\\s*</svg>$`),Rw=new RegExp(`^<svg\\s+height="\\d+"\\s+width="\\d+"\\s*>\\s*${hu.source}\\s*</svg>$`),Cw=new RegExp(`^<svg\\s*>\\s*${hu.source}\\s*</svg>$`),Pw=P.string().regex(Cw),Lw=P.string().regex(Sw),Aw=P.string().regex(Rw),Ow=P.object({type:P.literal("SvgSelector"),value:Pw.or(Lw).or(Aw)}),Dw=P.object({"@id":P.string().url(),type:ki,height:P.number().positive(),width:P.number().positive(),partOf:ro.array().optional()}),Fw=P.object({id:P.string().url(),type:ki,height:P.number().positive(),width:P.number().positive(),partOf:ro.array().optional()}),Gw=P.object({type:P.literal("SpecificResource"),source:Dw.or(Fw),selector:Ow}),ug=P.object({resourceCoords:Tn}),Bw=P.object({type:P.literal("FeatureCollection"),transformation:io.optional(),features:P.array(P.object({type:P.literal("Feature"),properties:ug,geometry:ig}))}),cu=P.object({id:P.string().optional(),type:P.literal("Annotation"),"@context":so.optional(),motivation:P.string().default("georeferencing").optional(),created:P.string().datetime().optional(),modified:P.string().datetime().optional(),target:Gw,body:Bw}),lg=P.object({id:P.string().optional(),type:P.literal("AnnotationPage"),"@context":so.optional(),items:P.array(cu)});lu.or(cu);ag.or(lg);og.or(ug);function hg(n){return Array.isArray(n)}function zw(n){return!!(n&&typeof n=="object"&&"type"in n&&n.type==="AnnotationPage")}function Ys(n){return!!(n&&typeof n=="object"&&"type"in n&&n.type==="GeoreferencedMap")}function mh(n){return!!(n&&typeof n=="object"&&"target"in n&&n.target&&typeof n.target=="object"&&"source"in n.target&&typeof n.target.source=="string")}function oo(n){return"type"in n&&n.type==="GeoreferencedMap"}function ao(n){return"source"in n.target&&typeof n.target.source=="object"}function qw(n){return{id:Uw(n),...Zw(n),type:jw(n),partOf:Vw(n)}}function Uw(n){if(ao(n)){const t=n.target.source;return"id"in t?t.id:t["@id"]}else return n.target.service[0]["@id"]}function jw(n){return"service"in n.target?n.target.service[0].type:n.target.source.type}function Vw(n){if(ao(n))return n.target.source.partOf}function Yw(n){return"pixelCoords"in n?n.pixelCoords:n.resourceCoords}function Ww(n){return n.body.features.map(t=>({resource:Yw(t.properties),geo:t.geometry.coordinates}))}function Xw(n){if(ao(n))return{created:n.created,modified:n.modified}}function Zw(n){if(ao(n))return{width:n.target.source.width,height:n.target.source.height};const t=n.target.selector.value,e=/width="(?<width>\d+)"/.exec(t),r=/height="(?<height>\d+)"/.exec(t),o=e?.groups?.width,l=r?.groups?.height;if(!o||!l)throw new Error("Could not parse image dimensions");return{width:parseInt(o),height:parseInt(l)}}function Hw(n){const t=n.target.selector.value,e=/points="(?<points>.+)"/.exec(t)?.groups;if(e&&e.points){const r=e.points.trim().split(/\s+/);if(r[0]===r[r.length-1]&&r.splice(-1),r.length>=3)return r.map(o=>{const l=o.split(",");if(l.length===2)return[parseFloat(l[0]),parseFloat(l[1])];throw new Error("Could not parse resource mask")});throw new Error("Could not parse resource mask")}else throw new Error("Could not parse resource mask")}function vh(n){return{"@context":"https://schemas.allmaps.org/map/2/context.json",type:"GeoreferencedMap",id:n.id,...Xw(n),resource:qw(n),gcps:Ww(n),resourceMask:Hw(n),transformation:n.body.transformation}}function Ta(n){if(zw(n)){let t;return"items"in n&&Array.isArray(n.items)&&mh(n.items[0])?t=ag.parse(n):t=lg.parse(n),t.items.map(e=>vh(e))}else{let t;return mh(n)?t=lu.parse(n):t=cu.parse(n),[vh(t)]}}const cg=P.object({image:Tn,world:Tn}),$w=P.object({uri:P.string().url(),width:P.number(),height:P.number(),type:ki}),uo=P.object({id:P.string().optional(),version:P.number().min(1).max(1).default(1),image:$w,gcps:cg.array(),pixelMask:sg,transformation:io.optional()}),fu=P.array(uo),fg=P.object({resource:Tn,geo:Tn}),Kw=P.object({id:P.string().url(),width:P.number(),height:P.number(),type:ki,partOf:ro.array().optional()}),lo=P.object({"@context":P.literal("https://schemas.allmaps.org/map/2/context.json").optional(),type:P.literal("GeoreferencedMap"),id:P.string().optional(),created:P.string().datetime().optional(),modified:P.string().datetime().optional(),resource:Kw,gcps:fg.array(),resourceMask:sg,transformation:io.optional()}),gu=P.array(lo);uo.or(lo);fu.or(gu);cg.or(fg);function Jw(n){let t,e,r;return oo(n)?(t=n.resource.width,e=n.resource.height,r=n.resourceMask):(t=n.image.width,e=n.image.height,r=n.pixelMask),{type:"SvgSelector",value:`<svg width="${t}" height="${e}"><polygon points="${r.map(o=>o.join(",")).join(" ")}" /></svg>`}}function Qw(n){let t,e,r,o,l;return oo(n)?(t=n.resource.id,e=n.resource.type,r=n.resource.width,o=n.resource.height,l=n.resource.partOf):(t=n.image.uri,e=n.image.type,r=n.image.width,o=n.image.height),{id:t,type:e,height:o,width:r,partOf:l}}function tx(n){if(oo(n))return{created:n.created,modified:n.modified}}function ex(){return["http://iiif.io/api/extension/georef/1/context.json","http://iiif.io/api/presentation/3/context.json"]}function nx(n){let t,e;return"resource"in n?(t=n.resource,e=n.geo):(t=n.image,e=n.world),{type:"Feature",properties:{resourceCoords:t},geometry:{type:"Point",coordinates:e}}}function yh(n){const t={type:"SpecificResource",source:Qw(n),selector:Jw(n)},e={type:"FeatureCollection",transformation:n.transformation,features:n.gcps.map(r=>nx(r))};return{id:n.id,type:"Annotation","@context":ex(),...tx(n),motivation:"georeferencing",target:t,body:e}}function rx(n){if(hg(n)){let t;return Ys(n[0])?t=gu.parse(n):t=fu.parse(n),{type:"AnnotationPage","@context":"http://www.w3.org/ns/anno.jsonld",items:t.map(e=>yh(e))}}else{let t;return Ys(n)?t=lo.parse(n):t=uo.parse(n),yh(t)}}function gg(n){return oo(n)?n:Ta(rx(n))[0]}function ix(n){return n.map(gg)}function _h(n){if(hg(n)){let t;return Ys(n[0])?t=gu.parse(n):t=fu.parse(n),ix(t)}else{let t;return Ys(n)?t=lo.parse(n):t=uo.parse(n),gg(t)}}function sx(n,t,e,r,o){dg(n,t,e||0,r||n.length-1,o||ox)}function dg(n,t,e,r,o){for(;r>e;){if(r-e>600){var l=r-e+1,f=t-e+1,c=Math.log(l),d=.5*Math.exp(2*c/3),p=.5*Math.sqrt(c*d*(l-d)/l)*(f-l/2<0?-1:1),v=Math.max(e,Math.floor(t-f*d/l+p)),y=Math.min(r,Math.floor(t+(l-f)*d/l+p));dg(n,t,v,y,o)}var x=n[t],M=e,I=r;for(Gr(n,e,t),o(n[r],x)>0&&Gr(n,e,r);M<I;){for(Gr(n,M,I),M++,I--;o(n[M],x)<0;)M++;for(;o(n[I],x)>0;)I--}o(n[e],x)===0?Gr(n,e,I):(I++,Gr(n,I,r)),I<=t&&(e=I+1),t<=I&&(r=I-1)}}function Gr(n,t,e){var r=n[t];n[t]=n[e],n[e]=r}function ox(n,t){return n<t?-1:n>t?1:0}class ax{constructor(t=9){this._maxEntries=Math.max(4,t),this._minEntries=Math.max(2,Math.ceil(this._maxEntries*.4)),this.clear()}all(){return this._all(this.data,[])}search(t){let e=this.data;const r=[];if(!as(t,e))return r;const o=this.toBBox,l=[];for(;e;){for(let f=0;f<e.children.length;f++){const c=e.children[f],d=e.leaf?o(c):c;as(t,d)&&(e.leaf?r.push(c):$o(t,d)?this._all(c,r):l.push(c))}e=l.pop()}return r}collides(t){let e=this.data;if(!as(t,e))return!1;const r=[];for(;e;){for(let o=0;o<e.children.length;o++){const l=e.children[o],f=e.leaf?this.toBBox(l):l;if(as(t,f)){if(e.leaf||$o(t,f))return!0;r.push(l)}}e=r.pop()}return!1}load(t){if(!(t&&t.length))return this;if(t.length<this._minEntries){for(let r=0;r<t.length;r++)this.insert(t[r]);return this}let e=this._build(t.slice(),0,t.length-1,0);if(!this.data.children.length)this.data=e;else if(this.data.height===e.height)this._splitRoot(this.data,e);else{if(this.data.height<e.height){const r=this.data;this.data=e,e=r}this._insert(e,this.data.height-e.height-1,!0)}return this}insert(t){return t&&this._insert(t,this.data.height-1),this}clear(){return this.data=ar([]),this}remove(t,e){if(!t)return this;let r=this.data;const o=this.toBBox(t),l=[],f=[];let c,d,p;for(;r||l.length;){if(r||(r=l.pop(),d=l[l.length-1],c=f.pop(),p=!0),r.leaf){const v=ux(t,r.children,e);if(v!==-1)return r.children.splice(v,1),l.push(r),this._condense(l),this}!p&&!r.leaf&&$o(r,o)?(l.push(r),f.push(c),c=0,d=r,r=r.children[0]):d?(c++,r=d.children[c],p=!1):r=null}return this}toBBox(t){return t}compareMinX(t,e){return t.minX-e.minX}compareMinY(t,e){return t.minY-e.minY}toJSON(){return this.data}fromJSON(t){return this.data=t,this}_all(t,e){const r=[];for(;t;)t.leaf?e.push(...t.children):r.push(...t.children),t=r.pop();return e}_build(t,e,r,o){const l=r-e+1;let f=this._maxEntries,c;if(l<=f)return c=ar(t.slice(e,r+1)),nr(c,this.toBBox),c;o||(o=Math.ceil(Math.log(l)/Math.log(f)),f=Math.ceil(l/Math.pow(f,o-1))),c=ar([]),c.leaf=!1,c.height=o;const d=Math.ceil(l/f),p=d*Math.ceil(Math.sqrt(f));wh(t,e,r,p,this.compareMinX);for(let v=e;v<=r;v+=p){const y=Math.min(v+p-1,r);wh(t,v,y,d,this.compareMinY);for(let x=v;x<=y;x+=d){const M=Math.min(x+d-1,y);c.children.push(this._build(t,x,M,o-1))}}return nr(c,this.toBBox),c}_chooseSubtree(t,e,r,o){for(;o.push(e),!(e.leaf||o.length-1===r);){let l=1/0,f=1/0,c;for(let d=0;d<e.children.length;d++){const p=e.children[d],v=Ho(p),y=cx(t,p)-v;y<f?(f=y,l=v<l?v:l,c=p):y===f&&v<l&&(l=v,c=p)}e=c||e.children[0]}return e}_insert(t,e,r){const o=r?t:this.toBBox(t),l=[],f=this._chooseSubtree(o,this.data,e,l);for(f.children.push(t),Xr(f,o);e>=0&&l[e].children.length>this._maxEntries;)this._split(l,e),e--;this._adjustParentBBoxes(o,l,e)}_split(t,e){const r=t[e],o=r.children.length,l=this._minEntries;this._chooseSplitAxis(r,l,o);const f=this._chooseSplitIndex(r,l,o),c=ar(r.children.splice(f,r.children.length-f));c.height=r.height,c.leaf=r.leaf,nr(r,this.toBBox),nr(c,this.toBBox),e?t[e-1].children.push(c):this._splitRoot(r,c)}_splitRoot(t,e){this.data=ar([t,e]),this.data.height=t.height+1,this.data.leaf=!1,nr(this.data,this.toBBox)}_chooseSplitIndex(t,e,r){let o,l=1/0,f=1/0;for(let c=e;c<=r-e;c++){const d=Wr(t,0,c,this.toBBox),p=Wr(t,c,r,this.toBBox),v=fx(d,p),y=Ho(d)+Ho(p);v<l?(l=v,o=c,f=y<f?y:f):v===l&&y<f&&(f=y,o=c)}return o||r-e}_chooseSplitAxis(t,e,r){const o=t.leaf?this.compareMinX:lx,l=t.leaf?this.compareMinY:hx,f=this._allDistMargin(t,e,r,o),c=this._allDistMargin(t,e,r,l);f<c&&t.children.sort(o)}_allDistMargin(t,e,r,o){t.children.sort(o);const l=this.toBBox,f=Wr(t,0,e,l),c=Wr(t,r-e,r,l);let d=os(f)+os(c);for(let p=e;p<r-e;p++){const v=t.children[p];Xr(f,t.leaf?l(v):v),d+=os(f)}for(let p=r-e-1;p>=e;p--){const v=t.children[p];Xr(c,t.leaf?l(v):v),d+=os(c)}return d}_adjustParentBBoxes(t,e,r){for(let o=r;o>=0;o--)Xr(e[o],t)}_condense(t){for(let e=t.length-1,r;e>=0;e--)t[e].children.length===0?e>0?(r=t[e-1].children,r.splice(r.indexOf(t[e]),1)):this.clear():nr(t[e],this.toBBox)}}function ux(n,t,e){if(!e)return t.indexOf(n);for(let r=0;r<t.length;r++)if(e(n,t[r]))return r;return-1}function nr(n,t){Wr(n,0,n.children.length,t,n)}function Wr(n,t,e,r,o){o||(o=ar(null)),o.minX=1/0,o.minY=1/0,o.maxX=-1/0,o.maxY=-1/0;for(let l=t;l<e;l++){const f=n.children[l];Xr(o,n.leaf?r(f):f)}return o}function Xr(n,t){return n.minX=Math.min(n.minX,t.minX),n.minY=Math.min(n.minY,t.minY),n.maxX=Math.max(n.maxX,t.maxX),n.maxY=Math.max(n.maxY,t.maxY),n}function lx(n,t){return n.minX-t.minX}function hx(n,t){return n.minY-t.minY}function Ho(n){return(n.maxX-n.minX)*(n.maxY-n.minY)}function os(n){return n.maxX-n.minX+(n.maxY-n.minY)}function cx(n,t){return(Math.max(t.maxX,n.maxX)-Math.min(t.minX,n.minX))*(Math.max(t.maxY,n.maxY)-Math.min(t.minY,n.minY))}function fx(n,t){const e=Math.max(n.minX,t.minX),r=Math.max(n.minY,t.minY),o=Math.min(n.maxX,t.maxX),l=Math.min(n.maxY,t.maxY);return Math.max(0,o-e)*Math.max(0,l-r)}function $o(n,t){return n.minX<=t.minX&&n.minY<=t.minY&&t.maxX<=n.maxX&&t.maxY<=n.maxY}function as(n,t){return t.minX<=n.maxX&&t.minY<=n.maxY&&t.maxX>=n.minX&&t.maxY>=n.minY}function ar(n){return{children:n,height:1,leaf:!0,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0}}function wh(n,t,e,r,o){const l=[t,e];for(;l.length;){if(e=l.pop(),t=l.pop(),e-t<=r)continue;const f=t+Math.ceil((e-t)/r/2)*r;sx(n,f,t,e,o),l.push(t,f,f,e)}}function gx(n,t,e){if(e===void 0&&(e={}),!n)throw new Error("point is required");if(!t)throw new Error("polygon is required");var r=yr(n),o=i0(t),l=o.type,f=t.bbox,c=o.coordinates;if(f&&dx(r,f)===!1)return!1;l==="Polygon"&&(c=[c]);for(var d=!1,p=0;p<c.length&&!d;p++)if(xh(r,c[p][0],e.ignoreBoundary)){for(var v=!1,y=1;y<c[p].length&&!v;)xh(r,c[p][y],!e.ignoreBoundary)&&(v=!0),y++;v||(d=!0)}return d}function xh(n,t,e){var r=!1;t[0][0]===t[t.length-1][0]&&t[0][1]===t[t.length-1][1]&&(t=t.slice(0,t.length-1));for(var o=0,l=t.length-1;o<t.length;l=o++){var f=t[o][0],c=t[o][1],d=t[l][0],p=t[l][1],v=n[1]*(f-d)+c*(d-n[0])+p*(n[0]-f)===0&&(f-n[0])*(d-n[0])<=0&&(c-n[1])*(p-n[1])<=0;if(v)return!e;var y=c>n[1]!=p>n[1]&&n[0]<(d-f)*(n[1]-c)/(p-c)+f;y&&(r=!r)}return r}function dx(n,t){return t[0]<=n[0]&&t[1]<=n[1]&&t[2]>=n[0]&&t[3]>=n[1]}const px=!0;let mx=class{rbush=new ax;polygonsById=new Map;bboxesById=new Map;itemsById=new Map;addItem(n,t){this.removeItem(n);const e=ne(t),r={minX:e[0],minY:e[1],maxX:e[2],maxY:e[3],id:n};this.polygonsById.set(n,t),this.bboxesById.set(n,e),this.itemsById.set(n,r),this.rbush.insert(r)}removeItem(n){const t=this.itemsById.get(n);t&&(this.rbush.remove(t),this.polygonsById.delete(n),this.bboxesById.delete(n),this.itemsById.delete(n))}clear(){this.polygonsById.clear(),this.bboxesById.clear(),this.itemsById.clear(),this.rbush.clear()}search(n,t,e,r){return this.rbush.search({minX:n,minY:t,maxX:e,maxY:r})}getBbox(n){return this.bboxesById.get(n)}getPolygon(n){return this.polygonsById.get(n)}searchFromBbox(n){const[t,e,r,o]=n;return this.search(t,e,r,o).map(l=>l.id)}searchFromPoint(n,t=px){const[e,r,o,l]=[n[0],n[1],n[0],n[1]],f=this.search(e,r,o,l);return t?f.filter(c=>{const d=this.polygonsById.get(c.id);return d?gx(n,d):!1}).map(c=>c.id):f.map(c=>c.id)}};function vx(){return{createRTree:!0,imageInformations:new Map}}let yx=class extends EventTarget{warpedMapFactory;warpedMapsById=new Map;zIndices=new Map;rtree;imageInformations;transformation;fetchFn;constructor(n,t){super(),this.warpedMapFactory=n,t={...vx(),...t},this.fetchFn=t?.fetchFn,this.imageInformations=t.imageInformations,this.transformation=t.transformation,t.createRTree&&(this.rtree=new mx)}getMapIds(){return this.warpedMapsById.keys()}getWarpedMaps(n){if(n===void 0)return this.warpedMapsById.values();{const t=[];for(const e of n){const r=this.warpedMapsById.get(e);r&&t.push(r)}return t}}getWarpedMap(n){return this.warpedMapsById.get(n)}getMapZIndex(n){return this.zIndices.get(n)}getCenter(){const n=this.getBbox();if(n)return dr(n)}getProjectedCenter(){const n=this.getProjectedBbox();if(n)return dr(n)}getBbox(){let n;for(const t of this.getWarpedMaps())t.visible&&(n?n=zl(n,t.geoMaskBbox):n=t.geoMaskBbox);return n}getProjectedBbox(){let n;for(const t of this.getWarpedMaps())t.visible&&(n?n=zl(n,t.projectedGeoMaskBbox):n=t.projectedGeoMaskBbox);return n}getMapsByGeoBbox(n){return this.rtree?this.rtree.searchFromBbox(n):Array.from(this.warpedMapsById.keys())}setImageInformations(n){this.imageInformations=n}setMapResourceMask(n,t){const e=this.warpedMapsById.get(n);e&&(e.setResourceMask(t),this.addToOrUpdateRtree(e),this.dispatchEvent(new wt($.RESOURCEMASKUPDATED,n)))}setMapsTransformationType(n,t){const e=[];for(const r of n){const o=this.warpedMapsById.get(r);o&&o.transformationType!=t&&(o.setTransformationType(t),this.addToOrUpdateRtree(o),e.push(r))}e.length>0&&this.dispatchEvent(new wt($.TRANSFORMATIONCHANGED,e))}setMapsDistortionMeasure(n,t){const e=[];for(const r of n){const o=this.warpedMapsById.get(r);o&&o.distortionMeasure!=t&&(o.setDistortionMeasure(t),e.push(r))}e.length>0&&this.dispatchEvent(new wt($.DISTORTIONCHANGED,e))}bringMapsToFront(n){let t=this.warpedMapsById.size;for(const e of n)this.zIndices.has(e)&&(this.zIndices.set(e,t),t++);this.removeZIndexHoles(),this.dispatchEvent(new wt($.ZINDICESCHANGES))}sendMapsToBack(n){let t=-Array.from(n).length;for(const e of n)this.zIndices.has(e)&&(this.zIndices.set(e,t),t++);this.removeZIndexHoles(),this.dispatchEvent(new wt($.ZINDICESCHANGES))}bringMapsForward(n){for(const[t,e]of this.zIndices.entries())this.zIndices.set(t,e*2);for(const t of n){const e=this.zIndices.get(t);e!==void 0&&this.zIndices.set(t,e+3)}this.removeZIndexHoles(),this.dispatchEvent(new wt($.ZINDICESCHANGES))}sendMapsBackward(n){for(const[t,e]of this.zIndices.entries())this.zIndices.set(t,e*2);for(const t of n){const e=this.zIndices.get(t);e!==void 0&&this.zIndices.set(t,e-3)}this.removeZIndexHoles(),this.dispatchEvent(new wt($.ZINDICESCHANGES))}showMaps(n){for(const t of n){const e=this.warpedMapsById.get(t);e&&(e.visible=!0)}this.dispatchEvent(new wt($.VISIBILITYCHANGED,n))}hideMaps(n){for(const t of n){const e=this.warpedMapsById.get(t);e&&(e.visible=!1)}this.dispatchEvent(new wt($.VISIBILITYCHANGED,n))}async addGeoreferencedMap(n){const t=_h(n),e=Array.isArray(t)?t[0]:t;return this.addGeoreferencedMapInternal(e)}async removeGeoreferencedMap(n){const t=_h(n),e=Array.isArray(t)?t[0]:t;return this.removeGeoreferencedMapInternal(e)}async addGeoreferenceAnnotation(n){const t=[],e=Ta(n),r=await Promise.allSettled(e.map(o=>this.addGeoreferencedMapInternal(o)));for(const o of r)o.status==="fulfilled"?t.push(o.value):t.push(o.reason);return this.dispatchEvent(new wt($.GEOREFERENCEANNOTATIONADDED)),this.dispatchEvent(new wt($.ZINDICESCHANGES)),t}async removeGeoreferenceAnnotation(n){const t=[],e=Ta(n);for(const r of e){const o=await this.removeGeoreferencedMapInternal(r);t.push(o)}return this.dispatchEvent(new wt($.GEOREFERENCEANNOTATIONREMOVED)),t}clear(){this.warpedMapsById=new Map,this.zIndices=new Map,this.rtree?.clear(),this.dispatchEvent(new wt($.CLEARED))}dispose(){for(const n of this.getWarpedMaps())this.removeEventListenersFromWarpedMap(n),n.dispose()}async addGeoreferencedMapInternal(n){const t=await this.getOrComputeMapId(n),e=this.warpedMapFactory(t,n,{imageInformations:this.imageInformations,fetchFn:this.fetchFn,transformation:this.transformation});return this.warpedMapsById.set(t,e),this.zIndices.set(t,this.warpedMapsById.size-1),this.addToOrUpdateRtree(e),this.addEventListenersToWarpedMap(e),this.dispatchEvent(new wt($.WARPEDMAPADDED,t)),t}async removeGeoreferencedMapInternal(n){const t=await this.getOrComputeMapId(n),e=this.warpedMapsById.get(t);if(e)this.warpedMapsById.delete(t),this.zIndices.delete(t),this.removeFromRtree(e),this.dispatchEvent(new wt($.WARPEDMAPREMOVED,t)),this.removeZIndexHoles(),this.dispatchEvent(new wt($.ZINDICESCHANGES));else throw new Error(`No map found with ID ${t}`);return t}async getOrComputeMapId(n){return n.id||await _v(n)}addToOrUpdateRtree(n){this.rtree&&(this.rtree.removeItem(n.mapId),this.rtree.addItem(n.mapId,n.geoMask))}removeFromRtree(n){this.rtree&&this.rtree.removeItem(n.mapId)}removeZIndexHoles(){const n=[...this.zIndices.entries()].sort((e,r)=>e[1]-r[1]);let t=0;for(const e of n){const r=e[0];this.zIndices.set(r,t),t++}}imageInfoLoaded(){this.dispatchEvent(new wt($.IMAGEINFOLOADED))}addEventListenersToWarpedMap(n){n.addEventListener($.IMAGEINFOLOADED,this.imageInfoLoaded.bind(this))}removeEventListenersFromWarpedMap(n){n.removeEventListener($.IMAGEINFOLOADED,this.imageInfoLoaded.bind(this))}};class _x extends EventTarget{tile;imageRequest;tileUrl;fetchFn;abortController;data;constructor(t,e){super(),this.tile=t.tile,this.imageRequest=t.imageRequest,this.tileUrl=t.tileUrl,this.fetchFn=e,this.abortController=new AbortController}isCachedTile(){return this.data!==void 0}abort(){this.abortController.signal.aborted||this.abortController.abort()}}class wx{mapId;tile;imageRequest;tileUrl;constructor(t,e){this.mapId=e.mapId,this.tile=t;const r=e.parsedImage.getIiifTile(t.tileZoomLevel,t.column,t.row);this.imageRequest=r,this.tileUrl=e.parsedImage.getImageUrl(r)}}class du extends _x{async fetch(){try{const t=await(await Ac(this.tileUrl,{signal:this.abortController.signal},this.fetchFn)).blob();this.data=await createImageBitmap(t),this.dispatchEvent(new wt($.TILEFETCHED,this.tileUrl))}catch(t){t instanceof Error&&t.name==="AbortError"||this.dispatchEvent(new wt($.TILEFETCHERROR,this.tileUrl))}return this.data}static createFactory(){return(t,e)=>new du(t,e)}}const xx=0,Ex=32*1e3*1e3;class kx extends EventTarget{cachableTileFactory;fetchFn;tilesByTileUrl=new Map;mapIdsByTileUrl=new Map;tileUrlsByMapId=new Map;tilesFetchingCount=0;previousRequestedTiles=[];outgoingTilesHistory=[];constructor(t,e){super(),this.cachableTileFactory=t,this.fetchFn=e?.fetchFn}getCacheableTile(t){return this.tilesByTileUrl.get(t)}getCachedTile(t){const e=this.tilesByTileUrl.get(t);if(e&&e.isCachedTile())return e}getCacheableTiles(){return this.tilesByTileUrl.values()}getCachedTiles(){const t=[];for(const e of this.tilesByTileUrl.values())e.isCachedTile()&&t.push(e);return t}getCachedTilesForMapId(t){const e=[];for(const r of this.tilesByTileUrl.values())r.isCachedTile()&&this.tileUrlsByMapId.get(t)?.has(r.tileUrl)&&e.push(r);return e}getTileUrls(){return this.tilesByTileUrl.keys()}requestFetchableTiles(t){const e=Zo(this.previousRequestedTiles),r=Zo(t);if(uv(e,r))return;const o=[];for(const c of this.previousRequestedTiles)r.has(ng(c))||o.push(c);this.updateOutgoingTilesHistory(o,t.length);const l=Zo(this.outgoingTilesHistory),f=new Set([...r,...l]);for(const[c,d]of this.mapIdsByTileUrl)for(const p of d)f.has(eg(p,c))||this.removeMapTile(p,c);for(const c of t)this.addMapTile(c);this.previousRequestedTiles=t}async allRequestedTilesLoaded(){return new Promise(t=>{if(this.finished)t();else{const e=()=>{this.removeEventListener($.ALLREQUESTEDTILESLOADED,e),t()};this.addEventListener($.ALLREQUESTEDTILESLOADED,e)}})}getTileUrlsForMapId(t){return this.tileUrlsByMapId.get(t)||new Set}clear(){this.tilesByTileUrl=new Map,this.mapIdsByTileUrl=new Map,this.tileUrlsByMapId=new Map,this.tilesFetchingCount=0,this.outgoingTilesHistory=[]}dispose(){for(const t of this.getCacheableTiles())this.removeEventListenersFromTile(t)}addMapTile(t){const e=t.mapId,r=t.tileUrl;if(this.tilesByTileUrl.has(r))this.dispatchEvent(new wt($.MAPTILELOADED,{mapId:e,tileUrl:r}));else{const o=this.cachableTileFactory(t,this.fetchFn);this.addEventListenersToTile(o),this.tilesByTileUrl.set(r,o),this.updateTilesFetchingCount(1),o.fetch()}this.addTileUrlForMapId(e,r),this.addMapIdForTileUrl(e,r)}removeMapTile(t,e){const r=this.tilesByTileUrl.get(e);if(!r)return;const o=this.removeMapIdForTileUrl(t,e);this.removeTileUrlForMapId(t,e),o.size||(r.isCachedTile()||(r.abort(),this.updateTilesFetchingCount(-1)),this.tilesByTileUrl.delete(e)),this.dispatchEvent(new wt($.MAPTILEREMOVED,{mapId:t,tileUrl:e}))}updateOutgoingTilesHistory(t,e){for(let f=t.length-1;f>=0;f--){const c=t[f];this.outgoingTilesHistory.unshift(c)}this.outgoingTilesHistory=Array.from(new Set(this.outgoingTilesHistory));let r=0,o=0,l=0;for(const f of this.outgoingTilesHistory){if(r+=1,l=fw(f),o+=l,r+e>xx){r-=1,o-=l;break}if(o>Ex){r-=1,o-=l;break}}this.outgoingTilesHistory=this.outgoingTilesHistory.slice(0,r)}tileFetched(t){if(t instanceof wt){const e=t.data;this.updateTilesFetchingCount(-1);for(const r of this.mapIdsByTileUrl.get(e)||[])this.dispatchEvent(new wt($.MAPTILELOADED,{mapId:r,tileUrl:e})),this.tileUrlsByMapId.get(r)?.values().next().value===e&&this.dispatchEvent(new wt($.FIRSTMAPTILELOADED,{mapId:r,tileUrl:e}))}}tileFetchError(t){if(t instanceof wt){const e=t.data;this.tilesByTileUrl.has(e)||this.updateTilesFetchingCount(-1)}}addMapIdForTileUrl(t,e){let r=this.mapIdsByTileUrl.get(e);return r?r.add(t):r=new Set([t]),this.mapIdsByTileUrl.set(e,r),r}removeMapIdForTileUrl(t,e){const r=this.mapIdsByTileUrl.get(e);if(r)r.delete(t);else return new Set;return r.size?this.mapIdsByTileUrl.set(e,r):this.mapIdsByTileUrl.delete(e),r}addTileUrlForMapId(t,e){let r=this.tileUrlsByMapId.get(t);return r?r.add(e):r=new Set([e]),this.tileUrlsByMapId.set(t,r),r}removeTileUrlForMapId(t,e){const r=this.tileUrlsByMapId.get(t);return r?(r.delete(e),r.size?this.tileUrlsByMapId.set(t,r):this.tileUrlsByMapId.delete(t),r):new Set}get finished(){return this.tilesFetchingCount===0}updateTilesFetchingCount(t){this.tilesFetchingCount+=t,this.tilesFetchingCount===0&&this.dispatchEvent(new wt($.ALLREQUESTEDTILESLOADED))}addEventListenersToTile(t){t.addEventListener($.TILEFETCHED,this.tileFetched.bind(this)),t.addEventListener($.TILEFETCHERROR,this.tileFetchError.bind(this))}removeEventListenersFromTile(t){t.removeEventListener($.TILEFETCHED,this.tileFetched.bind(this)),t.removeEventListener($.TILEFETCHERROR,this.tileFetchError.bind(this))}}const Ix=5;class Tx extends EventTarget{warpedMapList;tileCache;mapsInViewport=new Set;viewport;constructor(t,e,r){super(),this.tileCache=new kx(t,r),this.warpedMapList=new yx(e,r)}async addGeoreferenceAnnotation(t){return this.warpedMapList.addGeoreferenceAnnotation(t)}async addGeoreferencedMap(t){return this.warpedMapList.addGeoreferencedMap(t)}loadMissingImageInfosInViewport(){return this.viewport?Array.from(this.warpedMapList.getMapsByGeoBbox(this.viewport.geoRectangleBbox)).map(t=>this.warpedMapList.getWarpedMap(t)).filter(t=>!t.hasImageInfo()&&!t.loadingImageInfo).map(t=>t.loadImageInfo()):[]}someImageInfosInViewport(){return this.viewport?Array.from(this.warpedMapList.getMapsByGeoBbox(this.viewport.geoRectangleBbox)).map(t=>this.warpedMapList.getWarpedMap(t)).map(t=>t.hasImageInfo()).some(t=>t===!0):!1}shouldUpdateRequestedTiles(){return!0}updateRequestedTiles(){if(!this.viewport)return;const t=this.viewport;if(!this.shouldUpdateRequestedTiles())return;const e=Array.from(this.warpedMapList.getMapsByGeoBbox(this.viewport.geoRectangleBbox)).sort((o,l)=>{const f=this.warpedMapList.getWarpedMap(o),c=this.warpedMapList.getWarpedMap(l);return f&&c?ye(dr(f.geoMaskBbox),t.geoCenter)-ye(dr(c.geoMaskBbox),t.geoCenter):0}),r=[];for(const o of e){const l=this.warpedMapList.getWarpedMap(o);if(!l||!l.visible||!l.hasImageInfo()||sv(l.getViewportMaskBbox(t))<Ix)continue;const f=ow(l.parsedImage,l.getResourceToCanvasScale(t));l.setBestScaleFactor(f.scaleFactor);const c={maxDepth:0,sourceIsGeographic:!1,destinationIsGeographic:!0},d=l.transformer.transformBackward([t.geoRectangle],c)[0];l.setResourceViewportRing(d);const p=aw(d,f,l.parsedImage);for(const v of p)r.push(new wx(v,l))}this.tileCache.requestFetchableTiles(r),this.updateMapsInViewport(r)}updateMapsInViewport(t){const e=Array.from(this.mapsInViewport),r=t.map(f=>f.mapId).filter((f,c,d)=>d.indexOf(f)===c);this.mapsInViewport=new Set(r.sort((f,c)=>{const d=this.warpedMapList.getMapZIndex(f),p=this.warpedMapList.getMapZIndex(c);return d!==void 0&&p!==void 0?d-p:0}));const o=r.filter(f=>!e.includes(f)),l=e.filter(f=>!r.includes(f));for(const f in o)this.dispatchEvent(new wt($.WARPEDMAPENTER,f));for(const f in l)this.dispatchEvent(new wt($.WARPEDMAPLEAVE,f))}mapTileLoaded(t){}mapTileRemoved(t){}imageInfoLoaded(t){}warpedMapAdded(t){}warpedMapRemoved(t){}transformationChanged(t){}distortionChanged(t){}addEventListeners(){this.tileCache.addEventListener($.MAPTILELOADED,this.mapTileLoaded.bind(this)),this.tileCache.addEventListener($.MAPTILEREMOVED,this.mapTileRemoved.bind(this)),this.warpedMapList.addEventListener($.IMAGEINFOLOADED,this.imageInfoLoaded.bind(this)),this.warpedMapList.addEventListener($.WARPEDMAPADDED,this.warpedMapAdded.bind(this)),this.warpedMapList.addEventListener($.WARPEDMAPREMOVED,this.warpedMapRemoved.bind(this)),this.warpedMapList.addEventListener($.TRANSFORMATIONCHANGED,this.transformationChanged.bind(this)),this.warpedMapList.addEventListener($.DISTORTIONCHANGED,this.distortionChanged.bind(this))}removeEventListeners(){this.tileCache.removeEventListener($.MAPTILELOADED,this.mapTileLoaded.bind(this)),this.tileCache.removeEventListener($.MAPTILEREMOVED,this.mapTileRemoved.bind(this)),this.warpedMapList.removeEventListener($.IMAGEINFOLOADED,this.imageInfoLoaded.bind(this)),this.warpedMapList.removeEventListener($.WARPEDMAPADDED,this.warpedMapAdded.bind(this)),this.warpedMapList.removeEventListener($.WARPEDMAPREMOVED,this.warpedMapRemoved.bind(this)),this.warpedMapList.removeEventListener($.TRANSFORMATIONCHANGED,this.transformationChanged.bind(this)),this.warpedMapList.removeEventListener($.DISTORTIONCHANGED,this.distortionChanged.bind(this))}}var Mx=`#version 300 es

precision highp float;

uniform mat4 u_renderTransform;

uniform float u_animationProgress;

in vec2 a_resourceTrianglePoint;
in vec2 a_clipPreviousTrianglePoint;
in vec2 a_clipTrianglePoint;
in float a_previousTrianglePointDistortion;
in float a_trianglePointDistortion;
in float a_triangleIndex;

out vec2 v_resourceTrianglePoint;
out float v_trianglePointDistortion;
out float v_triangleIndex;

float cubicInOut(float t) {
  return t < 0.5f ? 4.0f * t * t * t : 0.5f * pow(2.0f * t - 2.0f, 3.0f) + 1.0f;
}

void main() {
  
  vec2 clipTrianglePoint = mix(a_clipPreviousTrianglePoint, a_clipTrianglePoint, cubicInOut(u_animationProgress));
  float trianglePointDistortion = mix(a_previousTrianglePointDistortion, a_trianglePointDistortion, cubicInOut(u_animationProgress));

  
  
  

  gl_Position = u_renderTransform * vec4(clipTrianglePoint, 0.0f, 1.0f);

  
  v_resourceTrianglePoint = a_resourceTrianglePoint;
  v_trianglePointDistortion = trianglePointDistortion;
  v_triangleIndex = a_triangleIndex;
}`,bx=`#version 300 es

precision highp float;
precision highp isampler2D;

#ifndef SPECTRAL
#define SPECTRAL

const int SPECTRAL_SIZE = 38;
const float SPECTRAL_GAMMA = 2.4;
const float SPECTRAL_EPSILON = 0.0001;

float spectral_uncompand(float x) {
  return (x < 0.04045) ? x / 12.92 : pow((x + 0.055) / 1.055, SPECTRAL_GAMMA);
}

float spectral_compand(float x) {
  return (x < 0.0031308) ? x * 12.92 : 1.055 * pow(x, 1.0 / SPECTRAL_GAMMA) - 0.055;
}

vec3 spectral_srgb_to_linear(vec3 srgb) {
    return vec3(spectral_uncompand(srgb[0]), spectral_uncompand(srgb[1]), spectral_uncompand(srgb[2]));
}

vec3 spectral_linear_to_srgb(vec3 lrgb) {
    return clamp(vec3(spectral_compand(lrgb[0]), spectral_compand(lrgb[1]), spectral_compand(lrgb[2])), 0.0, 1.0);
}

void spectral_upsampling(vec3 lrgb, out float w, out float c, out float m, out float y, out float r, out float g, out float b) {
    w = min(lrgb.r, min(lrgb.g, lrgb.b));

    lrgb -= w;

    c = min(lrgb.g, lrgb.b);
    m = min(lrgb.r, lrgb.b);
    y = min(lrgb.r, lrgb.g);
    r = min(max(0., lrgb.r - lrgb.b), max(0., lrgb.r - lrgb.g));
    g = min(max(0., lrgb.g - lrgb.b), max(0., lrgb.g - lrgb.r));
    b = min(max(0., lrgb.b - lrgb.g), max(0., lrgb.b - lrgb.r));
}

void spectral_linear_to_reflectance(vec3 lrgb, inout float R[SPECTRAL_SIZE]) {
    float w, c, m, y, r, g, b;

    spectral_upsampling(lrgb, w, c, m, y, r, g, b);

     R[0] = max(SPECTRAL_EPSILON, w + c * 0.96853629 + m * 0.51567122 + y * 0.02055257 + r * 0.03147571 + g * 0.49108579 + b * 0.97901834);
     R[1] = max(SPECTRAL_EPSILON, w + c * 0.96855103 + m * 0.54015520 + y * 0.02059936 + r * 0.03146636 + g * 0.46944057 + b * 0.97901649);
     R[2] = max(SPECTRAL_EPSILON, w + c * 0.96859338 + m * 0.62645502 + y * 0.02062723 + r * 0.03140624 + g * 0.40165780 + b * 0.97901118);
     R[3] = max(SPECTRAL_EPSILON, w + c * 0.96877345 + m * 0.75595012 + y * 0.02073387 + r * 0.03119611 + g * 0.24490420 + b * 0.97892146);
     R[4] = max(SPECTRAL_EPSILON, w + c * 0.96942204 + m * 0.92826996 + y * 0.02114202 + r * 0.03053888 + g * 0.06826880 + b * 0.97858555);
     R[5] = max(SPECTRAL_EPSILON, w + c * 0.97143709 + m * 0.97223624 + y * 0.02233154 + r * 0.02856855 + g * 0.02732883 + b * 0.97743705);
     R[6] = max(SPECTRAL_EPSILON, w + c * 0.97541862 + m * 0.98616174 + y * 0.02556857 + r * 0.02459485 + g * 0.01360600 + b * 0.97428075);
     R[7] = max(SPECTRAL_EPSILON, w + c * 0.98074186 + m * 0.98955255 + y * 0.03330189 + r * 0.01929520 + g * 0.01000187 + b * 0.96663223);
     R[8] = max(SPECTRAL_EPSILON, w + c * 0.98580992 + m * 0.98676237 + y * 0.05185294 + r * 0.01423112 + g * 0.01284127 + b * 0.94822893);
     R[9] = max(SPECTRAL_EPSILON, w + c * 0.98971194 + m * 0.97312575 + y * 0.10087639 + r * 0.01033111 + g * 0.02636635 + b * 0.89937713);
    R[10] = max(SPECTRAL_EPSILON, w + c * 0.99238027 + m * 0.91944277 + y * 0.24000413 + r * 0.00765876 + g * 0.07058713 + b * 0.76070164);
    R[11] = max(SPECTRAL_EPSILON, w + c * 0.99409844 + m * 0.32564851 + y * 0.53589066 + r * 0.00593693 + g * 0.70421692 + b * 0.46420440);
    R[12] = max(SPECTRAL_EPSILON, w + c * 0.99517200 + m * 0.13820628 + y * 0.79874659 + r * 0.00485616 + g * 0.85473994 + b * 0.20123039);
    R[13] = max(SPECTRAL_EPSILON, w + c * 0.99576545 + m * 0.05015143 + y * 0.91186529 + r * 0.00426186 + g * 0.95081565 + b * 0.08808402);
    R[14] = max(SPECTRAL_EPSILON, w + c * 0.99593552 + m * 0.02912336 + y * 0.95399623 + r * 0.00409039 + g * 0.97170370 + b * 0.04592894);
    R[15] = max(SPECTRAL_EPSILON, w + c * 0.99564041 + m * 0.02421691 + y * 0.97137099 + r * 0.00438375 + g * 0.97651888 + b * 0.02860373);
    R[16] = max(SPECTRAL_EPSILON, w + c * 0.99464769 + m * 0.02660696 + y * 0.97939505 + r * 0.00537525 + g * 0.97429245 + b * 0.02060067);
    R[17] = max(SPECTRAL_EPSILON, w + c * 0.99229579 + m * 0.03407586 + y * 0.98345207 + r * 0.00772962 + g * 0.97012917 + b * 0.01656701);
    R[18] = max(SPECTRAL_EPSILON, w + c * 0.98638762 + m * 0.04835936 + y * 0.98553736 + r * 0.01366120 + g * 0.94258630 + b * 0.01451549);
    R[19] = max(SPECTRAL_EPSILON, w + c * 0.96829712 + m * 0.00011720 + y * 0.98648905 + r * 0.03181352 + g * 0.99989207 + b * 0.01357964);
    R[20] = max(SPECTRAL_EPSILON, w + c * 0.89228016 + m * 0.00008554 + y * 0.98674535 + r * 0.10791525 + g * 0.99989891 + b * 0.01331243);
    R[21] = max(SPECTRAL_EPSILON, w + c * 0.53740239 + m * 0.85267882 + y * 0.98657555 + r * 0.46249516 + g * 0.13823139 + b * 0.01347661);
    R[22] = max(SPECTRAL_EPSILON, w + c * 0.15360445 + m * 0.93188793 + y * 0.98611877 + r * 0.84604333 + g * 0.06968113 + b * 0.01387181);
    R[23] = max(SPECTRAL_EPSILON, w + c * 0.05705719 + m * 0.94810268 + y * 0.98559942 + r * 0.94275572 + g * 0.05628787 + b * 0.01435472);
    R[24] = max(SPECTRAL_EPSILON, w + c * 0.03126539 + m * 0.94200977 + y * 0.98507063 + r * 0.96860996 + g * 0.06111561 + b * 0.01479836);
    R[25] = max(SPECTRAL_EPSILON, w + c * 0.02205445 + m * 0.91478045 + y * 0.98460039 + r * 0.97783966 + g * 0.08987709 + b * 0.01515250);
    R[26] = max(SPECTRAL_EPSILON, w + c * 0.01802271 + m * 0.87065445 + y * 0.98425301 + r * 0.98187757 + g * 0.13656016 + b * 0.01540513);
    R[27] = max(SPECTRAL_EPSILON, w + c * 0.01613460 + m * 0.78827548 + y * 0.98403909 + r * 0.98377315 + g * 0.22169624 + b * 0.01557233);
    R[28] = max(SPECTRAL_EPSILON, w + c * 0.01520947 + m * 0.65738359 + y * 0.98388535 + r * 0.98470202 + g * 0.32176956 + b * 0.01565710);
    R[29] = max(SPECTRAL_EPSILON, w + c * 0.01475977 + m * 0.59909403 + y * 0.98376116 + r * 0.98515481 + g * 0.36157329 + b * 0.01571025);
    R[30] = max(SPECTRAL_EPSILON, w + c * 0.01454263 + m * 0.56817268 + y * 0.98368246 + r * 0.98537114 + g * 0.48361920 + b * 0.01571916);
    R[31] = max(SPECTRAL_EPSILON, w + c * 0.01444459 + m * 0.54031997 + y * 0.98365023 + r * 0.98546685 + g * 0.46488579 + b * 0.01572133);
    R[32] = max(SPECTRAL_EPSILON, w + c * 0.01439897 + m * 0.52110241 + y * 0.98361309 + r * 0.98550011 + g * 0.47440306 + b * 0.01572502);
    R[33] = max(SPECTRAL_EPSILON, w + c * 0.01437620 + m * 0.51041094 + y * 0.98357259 + r * 0.98551031 + g * 0.48576990 + b * 0.01571717);
    R[34] = max(SPECTRAL_EPSILON, w + c * 0.01436343 + m * 0.50526577 + y * 0.98353856 + r * 0.98550741 + g * 0.49267971 + b * 0.01571905);
    R[35] = max(SPECTRAL_EPSILON, w + c * 0.01435687 + m * 0.50255080 + y * 0.98351247 + r * 0.98551323 + g * 0.49625685 + b * 0.01571059);
    R[36] = max(SPECTRAL_EPSILON, w + c * 0.01435370 + m * 0.50126452 + y * 0.98350101 + r * 0.98551563 + g * 0.49807754 + b * 0.01569728);
    R[37] = max(SPECTRAL_EPSILON, w + c * 0.01435408 + m * 0.50083021 + y * 0.98350852 + r * 0.98551547 + g * 0.49889859 + b * 0.01570020);
}

vec3 spectral_xyz_to_srgb(vec3 xyz) {
    mat3 XYZ_RGB;

    XYZ_RGB[0] = vec3( 3.24306333, -1.53837619, -0.49893282);
    XYZ_RGB[1] = vec3(-0.96896309,  1.87542451,  0.04154303);
    XYZ_RGB[2] = vec3( 0.05568392, -0.20417438,  1.05799454);

    float r = dot(XYZ_RGB[0], xyz);
    float g = dot(XYZ_RGB[1], xyz);
    float b = dot(XYZ_RGB[2], xyz);

    return spectral_linear_to_srgb(vec3(r, g, b));
}

vec3 spectral_reflectance_to_xyz(float R[SPECTRAL_SIZE]) {
    vec3 xyz = vec3(0.0);

    xyz +=  R[0] * vec3(0.00006469, 0.00000184, 0.00030502);
    xyz +=  R[1] * vec3(0.00021941, 0.00000621, 0.00103681);
    xyz +=  R[2] * vec3(0.00112057, 0.00003101, 0.00531314);
    xyz +=  R[3] * vec3(0.00376661, 0.00010475, 0.01795439);
    xyz +=  R[4] * vec3(0.01188055, 0.00035364, 0.05707758);
    xyz +=  R[5] * vec3(0.02328644, 0.00095147, 0.11365162);
    xyz +=  R[6] * vec3(0.03455942, 0.00228226, 0.17335873);
    xyz +=  R[7] * vec3(0.03722379, 0.00420733, 0.19620658);
    xyz +=  R[8] * vec3(0.03241838, 0.00668880, 0.18608237);
    xyz +=  R[9] * vec3(0.02123321, 0.00988840, 0.13995048);
    xyz += R[10] * vec3(0.01049099, 0.01524945, 0.08917453);
    xyz += R[11] * vec3(0.00329584, 0.02141831, 0.04789621);
    xyz += R[12] * vec3(0.00050704, 0.03342293, 0.02814563);
    xyz += R[13] * vec3(0.00094867, 0.05131001, 0.01613766);
    xyz += R[14] * vec3(0.00627372, 0.07040208, 0.00775910);
    xyz += R[15] * vec3(0.01686462, 0.08783871, 0.00429615);
    xyz += R[16] * vec3(0.02868965, 0.09424905, 0.00200551);
    xyz += R[17] * vec3(0.04267481, 0.09795667, 0.00086147);
    xyz += R[18] * vec3(0.05625475, 0.09415219, 0.00036904);
    xyz += R[19] * vec3(0.06947040, 0.08678102, 0.00019143);
    xyz += R[20] * vec3(0.08305315, 0.07885653, 0.00014956);
    xyz += R[21] * vec3(0.08612610, 0.06352670, 0.00009231);
    xyz += R[22] * vec3(0.09046614, 0.05374142, 0.00006813);
    xyz += R[23] * vec3(0.08500387, 0.04264606, 0.00002883);
    xyz += R[24] * vec3(0.07090667, 0.03161735, 0.00001577);
    xyz += R[25] * vec3(0.05062889, 0.02088521, 0.00000394);
    xyz += R[26] * vec3(0.03547396, 0.01386011, 0.00000158);
    xyz += R[27] * vec3(0.02146821, 0.00810264, 0.00000000);
    xyz += R[28] * vec3(0.01251646, 0.00463010, 0.00000000);
    xyz += R[29] * vec3(0.00680458, 0.00249138, 0.00000000);
    xyz += R[30] * vec3(0.00346457, 0.00125930, 0.00000000);
    xyz += R[31] * vec3(0.00149761, 0.00054165, 0.00000000);
    xyz += R[32] * vec3(0.00076970, 0.00027795, 0.00000000);
    xyz += R[33] * vec3(0.00040737, 0.00014711, 0.00000000);
    xyz += R[34] * vec3(0.00016901, 0.00006103, 0.00000000);
    xyz += R[35] * vec3(0.00009522, 0.00003439, 0.00000000);
    xyz += R[36] * vec3(0.00004903, 0.00001771, 0.00000000);
    xyz += R[37] * vec3(0.00002000, 0.00000722, 0.00000000);

    return xyz;
}

float spectral_linear_to_concentration(float l1, float l2, float t) {
    float t1 = l1 * pow(1.0 - t, 2.0);
    float t2 = l2 * pow(t, 2.0);

    return t2 / (t1 + t2);
}

vec3 spectral_mix(vec3 color1, vec3 color2, float t) {
    vec3 lrgb1 = spectral_srgb_to_linear(color1);
    vec3 lrgb2 = spectral_srgb_to_linear(color2);

    float R1[SPECTRAL_SIZE];
    float R2[SPECTRAL_SIZE];

    spectral_linear_to_reflectance(lrgb1, R1);
    spectral_linear_to_reflectance(lrgb2, R2);

    float l1 = spectral_reflectance_to_xyz(R1)[1];
    float l2 = spectral_reflectance_to_xyz(R2)[1];

    t = spectral_linear_to_concentration(l1, l2, t);

    float R[SPECTRAL_SIZE];

    for (int i = 0; i < SPECTRAL_SIZE; i++) {
      float KS = (1.0 - t) * (pow(1.0 - R1[i], 2.0) / (2.0 * R1[i])) + t * (pow(1.0 - R2[i], 2.0) / (2.0 * R2[i]));
      float KM = 1.0 + KS - sqrt(pow(KS, 2.0) + 2.0 * KS);

      
      

      R[i] = KM;
    }

    return spectral_xyz_to_srgb(spectral_reflectance_to_xyz(R));
}

vec4 spectral_mix(vec4 color1, vec4 color2, float t) {
    return vec4(spectral_mix(color1.rgb, color2.rgb, t), mix(color1.a, color2.a, t));
}

#endif

uniform bool u_removeColor;
uniform vec3 u_removeColorOptionsColor;
uniform float u_removeColorOptionsThreshold;
uniform float u_removeColorOptionsHardness;

uniform bool u_colorize;
uniform vec3 u_colorizeOptionsColor;

uniform bool u_grid;

uniform float u_opacity;
uniform float u_saturation;

uniform bool u_distortion;
uniform int u_distortionOptionsdistortionMeasure;

uniform int u_bestScaleFactor;

uniform sampler2D u_packedTilesTexture;
uniform isampler2D u_packedTilesPositionsTexture;
uniform isampler2D u_packedTilesResourcePositionsAndDimensionsTexture;
uniform isampler2D u_packedTilesScaleFactorsTexture;

in vec2 v_resourceTrianglePoint;
in float v_triangleIndex;
in float v_trianglePointDistortion;

out vec4 color;

vec4 rgbToVec4(int r, int g, int b) {
  return vec4(float(r) / 255.0f, float(g) / 255.0f, float(b) / 255.0f, 1.0f);
}

void main() {
  
  
  
  vec4 colorTransparent = vec4(0.0f, 0.0f, 0.0f, 0.0f);
  vec4 colorWhite = vec4(1.0f, 1.0f, 1.0f, 1.0f);
  vec4 colorBlack = vec4(0.0f, 0.0f, 0.0f, 1.0f);

  vec4 colorGreen300 = vec4(0.5254f, 0.9372f, 0.6745f, 1.0f);
  vec4 colorPurple300 = vec4(0.8470f, 0.7058f, 0.9960f, 1.0f);
  vec4 colorRed300 = vec4(0.9882f, 0.6470f, 0.6470f, 1.0f);
  vec4 colorYellow300 = vec4(0.9921f, 0.8784f, 0.2784f, 1.0f);
  vec4 colorOrange300 = vec4(0.9921f, 0.7294f, 0.4549f, 1.0f);
  vec4 colorPink300 = vec4(0.9764f, 0.6588f, 0.8313f, 1.0f);
  vec4 colorBlue300 = vec4(0.5764f, 0.7725f, 0.9921f, 1.0f);
  vec4 colorGrey300 = vec4(0.8196f, 0.8352f, 0.8588f, 1.0f);

  vec4 colorGreen500 = vec4(0.1333f, 0.7725f, 0.3686f, 1.0f);
  vec4 colorPurple500 = vec4(0.6588f, 0.3333f, 0.9686f, 1.0f);
  vec4 colorRed500 = vec4(0.9372f, 0.2666f, 0.2666f, 1.0f);
  vec4 colorYellow500 = vec4(0.9176f, 0.7019f, 0.0313f, 1.0f);
  vec4 colorOrange500 = vec4(0.9764f, 0.4509f, 0.0862f, 1.0f);
  vec4 colorPink500 = vec4(0.9254f, 0.2823f, 0.6f, 1.0f);
  vec4 colorBlue500 = vec4(0.2313f, 0.5098f, 0.9647f, 1.0f);
  vec4 colorGrey500 = vec4(0.4196f, 0.4470f, 0.5019f, 1.0f);

  float resourceTrianglePointX = v_resourceTrianglePoint.x;
  float resourceTrianglePointY = v_resourceTrianglePoint.y;

  
  int packedTilesCount = textureSize(u_packedTilesPositionsTexture, 0).y;
  ivec2 packedTilesTextureSize = textureSize(u_packedTilesTexture, 0);

  
  int smallestScaleFactorDiff = 256 * 256; 
  int bestScaleFactor = 0;

  
  vec2 packedTilesTexturePoint = vec2(0.0f, 0.0f);

  
  color = colorTransparent;
  bool found = false;

  
  for(int index = 0; index < packedTilesCount; index += 1) {

    
    ivec2 packedTilePosition = texelFetch(u_packedTilesPositionsTexture, ivec2(0, index), 0).rg;
    ivec4 packedTileResourcePositionAndDimension = texelFetch(u_packedTilesResourcePositionsAndDimensionsTexture, ivec2(0, index), 0);
    int packedTileScaleFactor = texelFetch(u_packedTilesScaleFactorsTexture, ivec2(0, index), 0).r;

    float packedTilePositionX = float(packedTilePosition.r);
    float packedTilePositionY = float(packedTilePosition.g);

    float packedTileResourcePositionX = float(packedTileResourcePositionAndDimension.r);
    float packedTileResourcePositionY = float(packedTileResourcePositionAndDimension.g);

    float packedTileDimensionWidth = float(packedTileResourcePositionAndDimension.b);
    float packedTileDimensionHeight = float(packedTileResourcePositionAndDimension.a);

    
    
    
    
    if(resourceTrianglePointX >= packedTileResourcePositionX &&
      resourceTrianglePointX < packedTileResourcePositionX + packedTileDimensionWidth &&
      resourceTrianglePointY >= packedTileResourcePositionY &&
      resourceTrianglePointY < packedTileResourcePositionY + packedTileDimensionHeight) {
      found = true;

      int scaleFactorDiff = abs(u_bestScaleFactor - packedTileScaleFactor);

      if(scaleFactorDiff < smallestScaleFactorDiff || bestScaleFactor == 0) {

        smallestScaleFactorDiff = scaleFactorDiff;
        bestScaleFactor = packedTileScaleFactor;

        float packedTilePointX = (resourceTrianglePointX - packedTileResourcePositionX) / float(bestScaleFactor);
        float packedTilePointY = (resourceTrianglePointY - packedTileResourcePositionY) / float(bestScaleFactor);

        float packedTilesPointX = packedTilePositionX + packedTilePointX;
        float packedTilesPointY = packedTilePositionY + packedTilePointY;

        float packedTilesTexturePointX = packedTilesPointX / float(packedTilesTextureSize.x);
        float packedTilesTexturePointY = packedTilesPointY / float(packedTilesTextureSize.y);

        packedTilesTexturePoint = vec2(packedTilesTexturePointX, packedTilesTexturePointY);
      }
    }
  }

  if(found == true) {
    
    color = texture(u_packedTilesTexture, packedTilesTexturePoint);

    
    if(u_removeColorOptionsThreshold > 0.0f) {
      vec3 backgroundColorDiff = color.rgb - u_removeColorOptionsColor.rgb;
      float backgroundColorDistance = length(backgroundColorDiff);
      if(u_removeColor && backgroundColorDistance < u_removeColorOptionsThreshold) {
        float amount = smoothstep(u_removeColorOptionsThreshold - u_removeColorOptionsThreshold * (1.0f - u_removeColorOptionsHardness), u_removeColorOptionsThreshold, backgroundColorDistance);
        color = vec4(color.rgb * amount, amount);
      }
    }

    
    float gray = 0.21f * color.r + 0.71f * color.g + 0.07f * color.b;
    color = vec4(color.rgb * (u_saturation) + (gray * (1.0f - u_saturation)), color.a);

    
    if(u_colorize) {
      color = vec4((u_colorizeOptionsColor + color.rgb) * color.a, color.a);
    }

    
    color = vec4(color.rgb * u_opacity, color.a * u_opacity);

    
    
    if(u_distortion) {
      
      

      float trianglePointDistortion = v_trianglePointDistortion;

      
      trianglePointDistortion = floor(trianglePointDistortion * 10.0f) / 10.0f;

      switch(u_distortionOptionsdistortionMeasure) {
        case 0:
          if(trianglePointDistortion > 0.0f) {
            color = spectral_mix(color, colorRed500, trianglePointDistortion);
          } else {
            color = spectral_mix(color, colorBlue500, abs(trianglePointDistortion));
          }
          break;
        case 1:
          color = spectral_mix(color, colorGreen500, trianglePointDistortion);
          break;
        case 2:
          color = spectral_mix(color, colorYellow500, trianglePointDistortion);
          break;
        case 3:
          color = trianglePointDistortion == -1.0f ? colorRed300 : color;
          break;
        default:
          color = color;
      }
    }

    
    
    if(false) {
      color = vec4(abs(sin(v_triangleIndex)), abs(sin(v_triangleIndex + 1.0f)), abs(sin(v_triangleIndex + 2.0f)), 1);
    }

    
    if(u_grid) {
      float gridSize = 20.0f * float(u_bestScaleFactor);
      float gridWidth = 2.0f * float(u_bestScaleFactor);
      if(mod(float(resourceTrianglePointX) + gridWidth / 2.0f, gridSize) < gridWidth || mod(float(resourceTrianglePointY) + gridWidth / 2.0f, gridSize) < gridWidth) {
        color = colorBlack;
      }
    }
  }
}`;const Nx=500,Sx={leading:!0,trailing:!0},Rx=50,Cx={leading:!0,trailing:!0},Ko=1,Jo=1,Px=0,Lx=.7,Ax=5,Eh=750;class Ox extends Tx{gl;program;previousSignificantViewport;opacity=Ko;saturation=Jo;renderOptions={};invertedRenderTransform;lastAnimationFrameRequestId;animating=!1;transformationTransitionStart;animationProgress=1;throttledPrepareRenderInternal;throttledChanged;constructor(t,e){const r=ph(t,t.VERTEX_SHADER,Mx),o=ph(t,t.FRAGMENT_SHADER,bx),l=pw(t,r,o);super(du.createFactory(),ww(t,l),e),this.gl=t,this.program=l,t.deleteShader(r),t.deleteShader(o),t.disable(t.DEPTH_TEST),this.invertedRenderTransform=Lm(),this.addEventListeners(),this.throttledPrepareRenderInternal=Ia(this.prepareRenderInternal.bind(this),Nx,Sx),this.throttledChanged=Ia(this.changed.bind(this),Rx,Cx)}getOpacity(){return this.opacity}setOpacity(t){this.opacity=t}resetOpacity(){this.opacity=Ko}getMapOpacity(t){const e=this.warpedMapList.getWarpedMap(t);if(e)return e.opacity}setMapOpacity(t,e){const r=this.warpedMapList.getWarpedMap(t);r&&(r.opacity=Math.min(Math.max(e,0),1))}resetMapOpacity(t){const e=this.warpedMapList.getWarpedMap(t);e&&(e.opacity=Ko)}getRemoveColorOptions(){return this.renderOptions.removeColorOptions}setRemoveColorOptions(t){this.renderOptions.removeColorOptions=t}resetRemoveColorOptions(){this.renderOptions.removeColorOptions=void 0}getMapRemoveColorOptions(t){const e=this.warpedMapList.getWarpedMap(t);if(e)return e.renderOptions.removeColorOptions}setMapRemoveColorOptions(t,e){const r=this.warpedMapList.getWarpedMap(t);r&&(r.renderOptions.removeColorOptions=e)}resetMapRemoveColorOptions(t){const e=this.warpedMapList.getWarpedMap(t);e&&(e.renderOptions.removeColorOptions=void 0)}getColorizeOptions(){return this.renderOptions.colorizeOptions}setColorizeOptions(t){this.renderOptions.colorizeOptions=t}resetColorizeOptions(){this.renderOptions.colorizeOptions=void 0}getMapColorizeOptions(t){const e=this.warpedMapList.getWarpedMap(t);if(e)return e.renderOptions.colorizeOptions}setMapColorizeOptions(t,e){const r=this.warpedMapList.getWarpedMap(t);r&&(r.renderOptions.colorizeOptions=e)}resetMapColorizeOptions(t){const e=this.warpedMapList.getWarpedMap(t);e&&(e.renderOptions.colorizeOptions=void 0)}getGridOptions(){return this.renderOptions.gridOptions}setGridOptions(t){this.renderOptions.gridOptions=t}resetGridOptions(){this.renderOptions.gridOptions=void 0}getMapGridOptions(t){const e=this.warpedMapList.getWarpedMap(t);if(e)return e.renderOptions.gridOptions}setMapGridOptions(t,e){const r=this.warpedMapList.getWarpedMap(t);r&&(r.renderOptions.gridOptions=e)}resetMapGridOptions(t){const e=this.warpedMapList.getWarpedMap(t);e&&(e.renderOptions.gridOptions=void 0)}getSaturation(){return this.saturation}setSaturation(t){this.saturation=t}resetSaturation(){this.saturation=Jo}getMapSaturation(t){const e=this.warpedMapList.getWarpedMap(t);if(e)return e.saturation}setMapSaturation(t,e){const r=this.warpedMapList.getWarpedMap(t);r&&(r.saturation=e)}resetMapSaturation(t){const e=this.warpedMapList.getWarpedMap(t);e&&(e.saturation=Jo)}render(t){this.viewport=t,this.loadMissingImageInfosInViewport(),this.someImageInfosInViewport()&&this.throttledPrepareRenderInternal(),this.renderInternal()}clear(){this.warpedMapList.clear(),this.mapsInViewport=new Set,this.gl.clear(this.gl.DEPTH_BUFFER_BIT|this.gl.COLOR_BUFFER_BIT),this.tileCache.clear()}dispose(){for(const t of this.warpedMapList.getWarpedMaps())this.removeEventListenersFromWebGL2WarpedMap(t),t.dispose();this.tileCache.clear(),this.tileCache.dispose(),this.removeEventListeners(),this.gl.deleteProgram(this.program)}prepareRenderInternal(){this.updateRequestedTiles(),this.updateVertexBuffers()}shouldUpdateRequestedTiles(){if(!this.viewport||this.animating)return!1;if(this.previousSignificantViewport){const t=[];for(let r=0;r<4;r++)t.push(ye(this.previousSignificantViewport.projectedGeoRectangle[r],this.viewport.projectedGeoRectangle[r])/this.viewport.projectedGeoPerViewportScale);const e=Math.max(...t);return e===0?!0:e>Ax?(this.previousSignificantViewport=this.viewport,!0):!1}else return this.previousSignificantViewport=this.viewport,!0}updateVertexBuffers(){if(this.viewport){this.invertedRenderTransform=Om(this.viewport.projectedGeoToClipTransform);for(const t of this.mapsInViewport){const e=this.warpedMapList.getWarpedMap(t);if(!e)break;e.updateVertexBuffers(this.viewport.projectedGeoToClipTransform)}}}renderInternal(){if(!this.viewport)return;const t=Am(this.viewport.projectedGeoToClipTransform,this.invertedRenderTransform),e=this.gl;e.viewport(0,0,e.canvas.width,e.canvas.height),e.enable(e.BLEND),e.blendFunc(e.ONE,e.ONE_MINUS_SRC_ALPHA),e.useProgram(this.program);const r=e.getUniformLocation(this.program,"u_renderTransform");e.uniformMatrix4fv(r,!1,Fm(t));const o=e.getUniformLocation(this.program,"u_animationProgress");e.uniform1f(o,this.animationProgress);for(const l of this.mapsInViewport){const f=this.warpedMapList.getWarpedMap(l);if(!f)continue;this.setRenderOptionsUniforms(this.renderOptions,f.renderOptions);const c=e.getUniformLocation(this.program,"u_opacity");e.uniform1f(c,this.opacity*f.opacity);const d=e.getUniformLocation(this.program,"u_saturation");e.uniform1f(d,this.saturation*f.saturation);const p=e.getUniformLocation(this.program,"u_distortion");if(e.uniform1f(p,f.distortionMeasure?1:0),f.distortionMeasure){const w=e.getUniformLocation(this.program,"u_distortionOptionsdistortionMeasure");e.uniform1i(w,Pf.indexOf(f.distortionMeasure))}const v=e.getUniformLocation(this.program,"u_bestScaleFactor"),y=f.bestScaleFactor;e.uniform1i(v,y);const x=e.getUniformLocation(this.program,"u_packedTilesTexture");e.uniform1i(x,0),e.activeTexture(e.TEXTURE0),e.bindTexture(e.TEXTURE_2D,f.packedTilesTexture);const M=e.getUniformLocation(this.program,"u_packedTilesPositionsTexture");e.uniform1i(M,1),e.activeTexture(e.TEXTURE1),e.bindTexture(e.TEXTURE_2D,f.packedTilesPositionsTexture);const I=e.getUniformLocation(this.program,"u_packedTilesResourcePositionsAndDimensionsTexture");e.uniform1i(I,2),e.activeTexture(e.TEXTURE2),e.bindTexture(e.TEXTURE_2D,f.packedTilesResourcePositionsAndDimensionsTexture);const O=e.getUniformLocation(this.program,"u_packedTilesScaleFactorsTexture");e.uniform1i(O,3),e.activeTexture(e.TEXTURE3),e.bindTexture(e.TEXTURE_2D,f.packedTilesScaleFactorsTexture);const D=f.vao,S=f.resourceTrianglePoints.length,F=this.gl.TRIANGLES;e.bindVertexArray(D),e.drawArrays(F,0,S)}}setRenderOptionsUniforms(t,e){const r=this.gl,o={removeColorOptions:{color:e.removeColorOptions?.color||t.removeColorOptions?.color,hardness:Ul(e.removeColorOptions?.hardness,t.removeColorOptions?.hardness),threshold:Ul(e.removeColorOptions?.threshold,t.removeColorOptions?.threshold)},colorizeOptions:{...t.colorizeOptions,...e.colorizeOptions},gridOptions:{...t.gridOptions,...e.gridOptions}},l=o.removeColorOptions?.color,f=r.getUniformLocation(this.program,"u_removeColor");if(r.uniform1f(f,l?1:0),l){const y=r.getUniformLocation(this.program,"u_removeColorOptionsColor");r.uniform3fv(y,l);const x=r.getUniformLocation(this.program,"u_removeColorOptionsThreshold");r.uniform1f(x,o.removeColorOptions?.threshold||Px);const M=r.getUniformLocation(this.program,"u_removeColorOptionsHardness");r.uniform1f(M,o.removeColorOptions?.hardness||Lx)}const c=o.colorizeOptions?.color,d=r.getUniformLocation(this.program,"u_colorize");if(r.uniform1f(d,c?1:0),c){const y=r.getUniformLocation(this.program,"u_colorizeOptionsColor");r.uniform3fv(y,c)}const p=o.gridOptions?.enabled,v=r.getUniformLocation(this.program,"u_grid");r.uniform1f(v,p?1:0)}startTransformationTransition(){this.lastAnimationFrameRequestId!==void 0&&cancelAnimationFrame(this.lastAnimationFrameRequestId),this.animating=!0,this.transformationTransitionStart=void 0,this.lastAnimationFrameRequestId=requestAnimationFrame(this.transformationTransitionFrame.bind(this))}transformationTransitionFrame(t){if(this.transformationTransitionStart||(this.transformationTransitionStart=t),t-this.transformationTransitionStart<Eh)this.animationProgress=(t-this.transformationTransitionStart)/Eh,this.renderInternal(),this.lastAnimationFrameRequestId=requestAnimationFrame(this.transformationTransitionFrame.bind(this));else{for(const e of this.warpedMapList.getWarpedMaps())e.resetTrianglePoints();this.updateVertexBuffers(),this.animating=!1,this.animationProgress=0,this.transformationTransitionStart=void 0}}changed(){this.dispatchEvent(new wt($.CHANGED))}imageInfoLoaded(t){t instanceof wt&&this.dispatchEvent(new wt($.IMAGEINFOLOADED))}mapTileLoaded(t){if(t instanceof wt){const{mapId:e,tileUrl:r}=t.data,o=this.tileCache.getCacheableTile(r);if(!o||!o.isCachedTile())return;const l=this.warpedMapList.getWarpedMap(e);if(!l)return;l.addCachedTileAndUpdateTextures(o)}}mapTileRemoved(t){if(t instanceof wt){const{mapId:e,tileUrl:r}=t.data,o=this.warpedMapList.getWarpedMap(e);if(!o)return;o.removeCachedTileAndUpdateTextures(r)}}warpedMapAdded(t){if(t instanceof wt){const e=t.data,r=this.warpedMapList.getWarpedMap(e);r&&this.addEventListenersToWebGL2WarpedMap(r)}}transformationChanged(t){if(t instanceof wt){const e=t.data;for(const r of this.warpedMapList.getWarpedMaps(e))this.animating&&r.mixTrianglePoints(this.animationProgress),r.updateProjectedGeoTrianglePoints(!1);this.updateVertexBuffers(),this.startTransformationTransition()}}distortionChanged(t){if(t instanceof wt){const e=t.data;for(const r of this.warpedMapList.getWarpedMaps(e))this.animating&&r.mixTrianglePoints(this.animationProgress),r.updateTrianglePointsDistortion(!1);this.updateVertexBuffers(),this.startTransformationTransition()}}addEventListenersToWebGL2WarpedMap(t){t.addEventListener($.TEXTURESUPDATED,this.throttledChanged.bind(this))}removeEventListenersFromWebGL2WarpedMap(t){t.removeEventListener($.TEXTURESUPDATED,this.throttledChanged.bind(this))}}const Dx="Renderer not defined. Add the layer to a map before calling this function.";function yt(n){if(!n)throw new Error(Dx)}class Fx{id="warped-map-layer";type="custom";renderingMode="2d";map;renderer;options;constructor(t,e){t&&(this.id=t),this.options=e}onAdd(t,e){this.map=t,this.renderer=new Ox(e,this.options),this.addEventListeners()}onRemove(){this.renderer&&(this.renderer.dispose(),this.removeEventListeners())}async addGeoreferenceAnnotation(t){yt(this.renderer);const e=await this.renderer.warpedMapList.addGeoreferenceAnnotation(t);return this.map?.triggerRepaint(),e}async removeGeoreferenceAnnotation(t){yt(this.renderer);const e=await this.renderer.warpedMapList.removeGeoreferenceAnnotation(t);return this.map?.triggerRepaint(),e}async addGeoreferenceAnnotationByUrl(t){const e=await fetch(t).then(r=>r.json());return this.addGeoreferenceAnnotation(e)}async removeGeoreferenceAnnotationByUrl(t){const e=await fetch(t).then(r=>r.json());return this.removeGeoreferenceAnnotation(e)}async addGeoreferencedMap(t){yt(this.renderer);const e=this.renderer.warpedMapList.addGeoreferencedMap(t);return this.map?.triggerRepaint(),e}async removeGeoreferencedMap(t){yt(this.renderer);const e=this.renderer.warpedMapList.removeGeoreferencedMap(t);return this.map?.triggerRepaint(),e}getWarpedMapList(){return yt(this.renderer),this.renderer.warpedMapList}getWarpedMap(t){return yt(this.renderer),this.renderer.warpedMapList.getWarpedMap(t)}showMap(t){yt(this.renderer),this.renderer.warpedMapList.showMaps([t]),this.map?.triggerRepaint()}showMaps(t){yt(this.renderer),this.renderer.warpedMapList.showMaps(t),this.map?.triggerRepaint()}hideMap(t){yt(this.renderer),this.renderer.warpedMapList.hideMaps([t]),this.map?.triggerRepaint()}hideMaps(t){yt(this.renderer),this.renderer.warpedMapList.hideMaps(t),this.map?.triggerRepaint()}isMapVisible(t){return yt(this.renderer),this.renderer.warpedMapList.getWarpedMap(t)?.visible}setMapResourceMask(t,e){yt(this.renderer),this.renderer.warpedMapList.setMapResourceMask(t,e),this.map?.triggerRepaint()}setMapsTransformationType(t,e){yt(this.renderer),this.renderer.warpedMapList.setMapsTransformationType(t,e),this.map?.triggerRepaint()}setMapsDistortionMeasure(t,e){yt(this.renderer),this.renderer.warpedMapList.setMapsDistortionMeasure(t,e),this.map?.triggerRepaint()}getBounds(){yt(this.renderer);const t=this.renderer.warpedMapList.getBbox();if(t)return[[t[0],t[1]],[t[2],t[3]]]}bringMapsToFront(t){yt(this.renderer),this.renderer.warpedMapList.bringMapsToFront(t),this.map?.triggerRepaint()}sendMapsToBack(t){yt(this.renderer),this.renderer.warpedMapList.sendMapsToBack(t),this.map?.triggerRepaint()}bringMapsForward(t){yt(this.renderer),this.renderer.warpedMapList.bringMapsForward(t),this.map?.triggerRepaint()}sendMapsBackward(t){yt(this.renderer),this.renderer.warpedMapList.sendMapsBackward(t),this.map?.triggerRepaint()}getMapZIndex(t){return yt(this.renderer),this.renderer.warpedMapList.getMapZIndex(t)}setImageInformations(t){yt(this.renderer),this.renderer.warpedMapList.setImageInformations(t)}getOpacity(){return yt(this.renderer),this.renderer.getOpacity()}setOpacity(t){yt(this.renderer),this.renderer.setOpacity(t),this.map?.triggerRepaint()}resetOpacity(){yt(this.renderer),this.renderer.resetOpacity(),this.map?.triggerRepaint()}getMapOpacity(t){return yt(this.renderer),this.renderer.getMapOpacity(t)}setMapOpacity(t,e){yt(this.renderer),this.renderer.setMapOpacity(t,e),this.map?.triggerRepaint()}resetMapOpacity(t){yt(this.renderer),this.renderer.resetMapOpacity(t),this.map?.triggerRepaint()}setSaturation(t){yt(this.renderer),this.renderer.setSaturation(t),this.map?.triggerRepaint()}resetSaturation(){yt(this.renderer),this.renderer.resetSaturation(),this.map?.triggerRepaint()}setMapSaturation(t,e){yt(this.renderer),this.renderer.setMapSaturation(t,e),this.map?.triggerRepaint()}resetMapSaturation(t){yt(this.renderer),this.renderer.resetMapSaturation(t),this.map?.triggerRepaint()}setRemoveColor(t){yt(this.renderer);const e=t.hexColor?Ki(t.hexColor):void 0;this.renderer.setRemoveColorOptions({color:e,threshold:t.threshold,hardness:t.hardness}),this.map?.triggerRepaint()}resetRemoveColor(){yt(this.renderer),this.renderer.resetRemoveColorOptions(),this.map?.triggerRepaint()}setMapRemoveColor(t,e){yt(this.renderer);const r=e.hexColor?Ki(e.hexColor):void 0;this.renderer.setMapRemoveColorOptions(t,{color:r,threshold:e.threshold,hardness:e.hardness}),this.map?.triggerRepaint()}resetMapRemoveColor(t){yt(this.renderer),this.renderer.resetMapRemoveColorOptions(t)}setColorize(t){yt(this.renderer);const e=Ki(t);e&&(this.renderer.setColorizeOptions({color:e}),this.map?.triggerRepaint())}resetColorize(){yt(this.renderer),this.renderer.resetColorizeOptions(),this.map?.triggerRepaint()}setMapColorize(t,e){yt(this.renderer);const r=Ki(e);r&&(this.renderer.setMapColorizeOptions(t,{color:r}),this.map?.triggerRepaint())}resetMapColorize(t){yt(this.renderer),this.renderer.resetMapColorizeOptions(t),this.map?.triggerRepaint()}clear(){yt(this.renderer),this.renderer.clear(),this.map?.triggerRepaint()}preparerender(){}render(){if(!this.map||!this.renderer)return;const t=this.map.getCanvas(),e=[t.width/window.devicePixelRatio,t.height/window.devicePixelRatio],r=this.map.getCenter(),o=rr([r.lng,r.lat]),l=this.map.unproject([0,e[1]]),f=this.map.unproject([e[0],e[1]]),c=this.map.unproject([e[0],0]),d=this.map.unproject([0,0]),p=rr([l.lng,l.lat]),v=rr([f.lng,f.lat]),y=rr([c.lng,c.lat]),x=rr([d.lng,d.lat]),M=ca([p,v,y,x]),I=bs(M,e),O=-(this.map.getBearing()/180)*Math.PI,D=new Ns(e,o,I,O,window.devicePixelRatio);this.renderer.render(D)}addEventListeners(){this.renderer&&(this.renderer.addEventListener($.CHANGED,this.render.bind(this)),this.renderer.addEventListener($.IMAGEINFOLOADED,this.render.bind(this)),this.renderer.addEventListener($.WARPEDMAPENTER,this.passWarpedMapEvent.bind(this)),this.renderer.addEventListener($.WARPEDMAPLEAVE,this.passWarpedMapEvent.bind(this)),this.renderer.tileCache.addEventListener($.FIRSTMAPTILELOADED,this.passWarpedMapEvent.bind(this)),this.renderer.tileCache.addEventListener($.ALLREQUESTEDTILESLOADED,this.passWarpedMapEvent.bind(this)),this.renderer.warpedMapList.addEventListener($.GEOREFERENCEANNOTATIONADDED,this.passWarpedMapEvent.bind(this)),this.renderer.warpedMapList.addEventListener($.WARPEDMAPADDED,this.passWarpedMapEvent.bind(this)),this.renderer.warpedMapList.addEventListener($.WARPEDMAPREMOVED,this.passWarpedMapEvent.bind(this)),this.renderer.warpedMapList.addEventListener($.VISIBILITYCHANGED,this.render.bind(this)),this.renderer.warpedMapList.addEventListener($.CLEARED,this.render.bind(this)))}removeEventListeners(){this.renderer&&(this.renderer.removeEventListener($.CHANGED,this.render.bind(this)),this.renderer.removeEventListener($.IMAGEINFOLOADED,this.render.bind(this)),this.renderer.removeEventListener($.WARPEDMAPENTER,this.passWarpedMapEvent.bind(this)),this.renderer.removeEventListener($.WARPEDMAPLEAVE,this.passWarpedMapEvent.bind(this)),this.renderer.tileCache.removeEventListener($.FIRSTMAPTILELOADED,this.passWarpedMapEvent.bind(this)),this.renderer.tileCache.removeEventListener($.ALLREQUESTEDTILESLOADED,this.passWarpedMapEvent.bind(this)),this.renderer.warpedMapList.removeEventListener($.GEOREFERENCEANNOTATIONADDED,this.passWarpedMapEvent.bind(this)),this.renderer.warpedMapList.removeEventListener($.WARPEDMAPADDED,this.passWarpedMapEvent.bind(this)),this.renderer.warpedMapList.removeEventListener($.WARPEDMAPREMOVED,this.passWarpedMapEvent.bind(this)),this.renderer.warpedMapList.removeEventListener($.VISIBILITYCHANGED,this.render.bind(this)),this.renderer.warpedMapList.removeEventListener($.CLEARED,this.render.bind(this)))}passWarpedMapEvent(t){t instanceof wt&&this.map&&this.map.fire(t.type,t.data)}}function Ma(n,t={}){if(n.bbox!=null&&t.recompute!==!0)return n.bbox;const e=[1/0,1/0,-1/0,-1/0];return Fh(n,r=>{e[0]>r[0]&&(e[0]=r[0]),e[1]>r[1]&&(e[1]=r[1]),e[2]<r[0]&&(e[2]=r[0]),e[3]<r[1]&&(e[3]=r[1])}),e}function Gx(n,t={}){const e=Number(n[0]),r=Number(n[1]),o=Number(n[2]),l=Number(n[3]);if(n.length===6)throw new Error("@turf/bbox-polygon does not support BBox with 6 positions");const f=[e,r];return Jd([[f,[o,r],[o,l],[e,l],f]],t.properties,{bbox:n,id:t.id})}function Bx(n,t={}){const e=Ma(n),r=(e[0]+e[2])/2,o=(e[1]+e[3])/2;return Kd([r,o],t.properties,t)}var ds={exports:{}},zx=ds.exports,kh;function qx(){return kh||(kh=1,function(n,t){(function(e,r){n.exports=r()})(zx,function(){function e(u,i){(i==null||i>u.length)&&(i=u.length);for(var s=0,a=Array(i);s<i;s++)a[s]=u[s];return a}function r(u,i,s){return i=v(i),function(a,h){if(h&&(typeof h=="object"||typeof h=="function"))return h;if(h!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return function(g){if(g===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return g}(a)}(u,x()?Reflect.construct(i,s||[],v(u).constructor):i.apply(u,s))}function o(u,i){if(!(u instanceof i))throw new TypeError("Cannot call a class as a function")}function l(u,i,s){if(x())return Reflect.construct.apply(null,arguments);var a=[null];a.push.apply(a,i);var h=new(u.bind.apply(u,a));return s&&M(h,s.prototype),h}function f(u,i){for(var s=0;s<i.length;s++){var a=i[s];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(u,D(a.key),a)}}function c(u,i,s){return i&&f(u.prototype,i),s&&f(u,s),Object.defineProperty(u,"prototype",{writable:!1}),u}function d(u,i){var s=typeof Symbol<"u"&&u[Symbol.iterator]||u["@@iterator"];if(!s){if(Array.isArray(u)||(s=S(u))||i){s&&(u=s);var a=0,h=function(){};return{s:h,n:function(){return a>=u.length?{done:!0}:{done:!1,value:u[a++]}},e:function(k){throw k},f:h}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var g,m=!0,_=!1;return{s:function(){s=s.call(u)},n:function(){var k=s.next();return m=k.done,k},e:function(k){_=!0,g=k},f:function(){try{m||s.return==null||s.return()}finally{if(_)throw g}}}}function p(){return p=typeof Reflect<"u"&&Reflect.get?Reflect.get.bind():function(u,i,s){var a=function(g,m){for(;!{}.hasOwnProperty.call(g,m)&&(g=v(g))!==null;);return g}(u,i);if(a){var h=Object.getOwnPropertyDescriptor(a,i);return h.get?h.get.call(arguments.length<3?u:s):h.value}},p.apply(null,arguments)}function v(u){return v=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(i){return i.__proto__||Object.getPrototypeOf(i)},v(u)}function y(u,i){if(typeof i!="function"&&i!==null)throw new TypeError("Super expression must either be null or a function");u.prototype=Object.create(i&&i.prototype,{constructor:{value:u,writable:!0,configurable:!0}}),Object.defineProperty(u,"prototype",{writable:!1}),i&&M(u,i)}function x(){try{var u=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(x=function(){return!!u})()}function M(u,i){return M=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(s,a){return s.__proto__=a,s},M(u,i)}function I(u,i,s,a){var h=p(v(1&a?u.prototype:u),i,s);return 2&a&&typeof h=="function"?function(g){return h.apply(s,g)}:h}function O(u){return function(i){if(Array.isArray(i))return e(i)}(u)||function(i){if(typeof Symbol<"u"&&i[Symbol.iterator]!=null||i["@@iterator"]!=null)return Array.from(i)}(u)||S(u)||function(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}()}function D(u){var i=function(s,a){if(typeof s!="object"||!s)return s;var h=s[Symbol.toPrimitive];if(h!==void 0){var g=h.call(s,a);if(typeof g!="object")return g;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(s)}(u,"string");return typeof i=="symbol"?i:i+""}function S(u,i){if(u){if(typeof u=="string")return e(u,i);var s={}.toString.call(u).slice(8,-1);return s==="Object"&&u.constructor&&(s=u.constructor.name),s==="Map"||s==="Set"?Array.from(u):s==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(s)?e(u,i):void 0}}function F(u){var i=typeof Map=="function"?new Map:void 0;return F=function(s){if(s===null||!function(h){try{return Function.toString.call(h).indexOf("[native code]")!==-1}catch{return typeof h=="function"}}(s))return s;if(typeof s!="function")throw new TypeError("Super expression must either be null or a function");if(i!==void 0){if(i.has(s))return i.get(s);i.set(s,a)}function a(){return l(s,arguments,v(this).constructor)}return a.prototype=Object.create(s.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}}),M(a,s)},F(u)}var w=function(){function u(){o(this,u),u.constructor_.apply(this,arguments)}return c(u,[{key:"getEndCapStyle",value:function(){return this._endCapStyle}},{key:"isSingleSided",value:function(){return this._isSingleSided}},{key:"setQuadrantSegments",value:function(i){this._quadrantSegments=i,this._quadrantSegments===0&&(this._joinStyle=u.JOIN_BEVEL),this._quadrantSegments<0&&(this._joinStyle=u.JOIN_MITRE,this._mitreLimit=Math.abs(this._quadrantSegments)),i<=0&&(this._quadrantSegments=1),this._joinStyle!==u.JOIN_ROUND&&(this._quadrantSegments=u.DEFAULT_QUADRANT_SEGMENTS)}},{key:"getJoinStyle",value:function(){return this._joinStyle}},{key:"setJoinStyle",value:function(i){this._joinStyle=i}},{key:"setSimplifyFactor",value:function(i){this._simplifyFactor=i<0?0:i}},{key:"getSimplifyFactor",value:function(){return this._simplifyFactor}},{key:"getQuadrantSegments",value:function(){return this._quadrantSegments}},{key:"setEndCapStyle",value:function(i){this._endCapStyle=i}},{key:"getMitreLimit",value:function(){return this._mitreLimit}},{key:"setMitreLimit",value:function(i){this._mitreLimit=i}},{key:"setSingleSided",value:function(i){this._isSingleSided=i}}],[{key:"constructor_",value:function(){if(this._quadrantSegments=u.DEFAULT_QUADRANT_SEGMENTS,this._endCapStyle=u.CAP_ROUND,this._joinStyle=u.JOIN_ROUND,this._mitreLimit=u.DEFAULT_MITRE_LIMIT,this._isSingleSided=!1,this._simplifyFactor=u.DEFAULT_SIMPLIFY_FACTOR,arguments.length!==0){if(arguments.length===1){var i=arguments[0];this.setQuadrantSegments(i)}else if(arguments.length===2){var s=arguments[0],a=arguments[1];this.setQuadrantSegments(s),this.setEndCapStyle(a)}else if(arguments.length===4){var h=arguments[0],g=arguments[1],m=arguments[2],_=arguments[3];this.setQuadrantSegments(h),this.setEndCapStyle(g),this.setJoinStyle(m),this.setMitreLimit(_)}}}},{key:"bufferDistanceError",value:function(i){var s=Math.PI/2/i;return 1-Math.cos(s/2)}}])}();w.CAP_ROUND=1,w.CAP_FLAT=2,w.CAP_SQUARE=3,w.JOIN_ROUND=1,w.JOIN_MITRE=2,w.JOIN_BEVEL=3,w.DEFAULT_QUADRANT_SEGMENTS=8,w.DEFAULT_MITRE_LIMIT=5,w.DEFAULT_SIMPLIFY_FACTOR=.01;var T=function(u){function i(s){var a;return o(this,i),(a=r(this,i,[s])).name=Object.keys({Exception:i})[0],a}return y(i,u),c(i,[{key:"toString",value:function(){return this.message}}])}(F(Error)),N=function(u){function i(s){var a;return o(this,i),(a=r(this,i,[s])).name=Object.keys({IllegalArgumentException:i})[0],a}return y(i,u),c(i)}(T),G=function(){return c(function u(){o(this,u)},[{key:"filter",value:function(u){}}])}();function A(){}function L(){}function E(){}var C,B,j,st,Y,Q,tt,vt,kt=function(){return c(function u(){o(this,u)},null,[{key:"equalsWithTolerance",value:function(u,i,s){return Math.abs(u-i)<=s}}])}(),Tt=function(){return c(function u(i,s){o(this,u),this.low=s||0,this.high=i||0},null,[{key:"toBinaryString",value:function(u){var i,s="";for(i=2147483648;i>0;i>>>=1)s+=(u.high&i)===i?"1":"0";for(i=2147483648;i>0;i>>>=1)s+=(u.low&i)===i?"1":"0";return s}}])}();function Z(){}function Ot(){}Z.NaN=NaN,Z.isNaN=function(u){return Number.isNaN(u)},Z.isInfinite=function(u){return!Number.isFinite(u)},Z.MAX_VALUE=Number.MAX_VALUE,Z.POSITIVE_INFINITY=Number.POSITIVE_INFINITY,Z.NEGATIVE_INFINITY=Number.NEGATIVE_INFINITY,typeof Float64Array=="function"&&typeof Int32Array=="function"?(Q=2146435072,tt=new Float64Array(1),vt=new Int32Array(tt.buffer),Z.doubleToLongBits=function(u){tt[0]=u;var i=0|vt[0],s=0|vt[1];return(s&Q)===Q&&1048575&s&&i!==0&&(i=0,s=2146959360),new Tt(s,i)},Z.longBitsToDouble=function(u){return vt[0]=u.low,vt[1]=u.high,tt[0]}):(C=1023,B=Math.log2,j=Math.floor,st=Math.pow,Y=function(){for(var u=53;u>0;u--){var i=st(2,u)-1;if(j(B(i))+1===u)return i}return 0}(),Z.doubleToLongBits=function(u){var i,s,a,h,g,m,_,k,b;if(u<0||1/u===Number.NEGATIVE_INFINITY?(m=1<<31,u=-u):m=0,u===0)return new Tt(k=m,b=0);if(u===1/0)return new Tt(k=2146435072|m,b=0);if(u!=u)return new Tt(k=2146959360,b=0);if(h=0,b=0,(i=j(u))>1)if(i<=Y)(h=j(B(i)))<=20?(b=0,k=i<<20-h&1048575):(b=i%(s=st(2,a=h-20))<<32-a,k=i/s&1048575);else for(a=i,b=0;(a=j(s=a/2))!==0;)h++,b>>>=1,b|=(1&k)<<31,k>>>=1,s!==a&&(k|=524288);if(_=h+C,g=i===0,i=u-i,h<52&&i!==0)for(a=0;;){if((s=2*i)>=1?(i=s-1,g?(_--,g=!1):(a<<=1,a|=1,h++)):(i=s,g?--_==0&&(h++,g=!1):(a<<=1,h++)),h===20)k|=a,a=0;else if(h===52){b|=a;break}if(s===1){h<20?k|=a<<20-h:h<52&&(b|=a<<52-h);break}}return k|=_<<20,new Tt(k|=m,b)},Z.longBitsToDouble=function(u){var i,s,a,h,g=u.high,m=u.low,_=g&1<<31?-1:1;for(a=((2146435072&g)>>20)-C,h=0,s=1<<19,i=1;i<=20;i++)g&s&&(h+=st(2,-i)),s>>>=1;for(s=1<<31,i=21;i<=52;i++)m&s&&(h+=st(2,-i)),s>>>=1;if(a===-1023){if(h===0)return 0*_;a=-1022}else{if(a===1024)return h===0?_/0:NaN;h+=1}return _*h*st(2,a)});var it=function(u){function i(s){var a;return o(this,i),(a=r(this,i,[s])).name=Object.keys({RuntimeException:i})[0],a}return y(i,u),c(i)}(T),Mt=function(u){function i(){var s;return o(this,i),s=r(this,i),i.constructor_.apply(s,arguments),s}return y(i,u),c(i,null,[{key:"constructor_",value:function(){if(arguments.length===0)it.constructor_.call(this);else if(arguments.length===1){var s=arguments[0];it.constructor_.call(this,s)}}}])}(it),ot=function(){function u(){o(this,u)}return c(u,null,[{key:"shouldNeverReachHere",value:function(){if(arguments.length===0)u.shouldNeverReachHere(null);else if(arguments.length===1){var i=arguments[0];throw new Mt("Should never reach here"+(i!==null?": "+i:""))}}},{key:"isTrue",value:function(){if(arguments.length===1){var i=arguments[0];u.isTrue(i,null)}else if(arguments.length===2){var s=arguments[1];if(!arguments[0])throw s===null?new Mt:new Mt(s)}}},{key:"equals",value:function(){if(arguments.length===2){var i=arguments[0],s=arguments[1];u.equals(i,s,null)}else if(arguments.length===3){var a=arguments[0],h=arguments[1],g=arguments[2];if(!h.equals(a))throw new Mt("Expected "+a+" but encountered "+h+(g!==null?": "+g:""))}}}])}(),qt=new ArrayBuffer(8),Wt=new Float64Array(qt),Ii=new Int32Array(qt),U=function(){function u(){o(this,u),u.constructor_.apply(this,arguments)}return c(u,[{key:"getM",value:function(){return Z.NaN}},{key:"setOrdinate",value:function(i,s){switch(i){case u.X:this.x=s;break;case u.Y:this.y=s;break;case u.Z:this.setZ(s);break;default:throw new N("Invalid ordinate index: "+i)}}},{key:"equals2D",value:function(){if(arguments.length===1){var i=arguments[0];return this.x===i.x&&this.y===i.y}if(arguments.length===2){var s=arguments[0],a=arguments[1];return!!kt.equalsWithTolerance(this.x,s.x,a)&&!!kt.equalsWithTolerance(this.y,s.y,a)}}},{key:"setM",value:function(i){throw new N("Invalid ordinate index: "+u.M)}},{key:"getZ",value:function(){return this.z}},{key:"getOrdinate",value:function(i){switch(i){case u.X:return this.x;case u.Y:return this.y;case u.Z:return this.getZ()}throw new N("Invalid ordinate index: "+i)}},{key:"equals3D",value:function(i){return this.x===i.x&&this.y===i.y&&(this.getZ()===i.getZ()||Z.isNaN(this.getZ())&&Z.isNaN(i.getZ()))}},{key:"equals",value:function(i){return i instanceof u&&this.equals2D(i)}},{key:"equalInZ",value:function(i,s){return kt.equalsWithTolerance(this.getZ(),i.getZ(),s)}},{key:"setX",value:function(i){this.x=i}},{key:"compareTo",value:function(i){var s=i;return this.x<s.x?-1:this.x>s.x?1:this.y<s.y?-1:this.y>s.y?1:0}},{key:"getX",value:function(){return this.x}},{key:"setZ",value:function(i){this.z=i}},{key:"clone",value:function(){try{return null}catch(i){if(i instanceof CloneNotSupportedException)return ot.shouldNeverReachHere("this shouldn't happen because this class is Cloneable"),null;throw i}}},{key:"copy",value:function(){return new u(this)}},{key:"toString",value:function(){return"("+this.x+", "+this.y+", "+this.getZ()+")"}},{key:"distance3D",value:function(i){var s=this.x-i.x,a=this.y-i.y,h=this.getZ()-i.getZ();return Math.sqrt(s*s+a*a+h*h)}},{key:"getY",value:function(){return this.y}},{key:"setY",value:function(i){this.y=i}},{key:"distance",value:function(i){var s=this.x-i.x,a=this.y-i.y;return Math.sqrt(s*s+a*a)}},{key:"hashCode",value:function(){var i=17;return i=37*(i=37*i+u.hashCode(this.x))+u.hashCode(this.y)}},{key:"setCoordinate",value:function(i){this.x=i.x,this.y=i.y,this.z=i.getZ()}},{key:"interfaces_",get:function(){return[A,L,E]}}],[{key:"constructor_",value:function(){if(this.x=null,this.y=null,this.z=null,arguments.length===0)u.constructor_.call(this,0,0);else if(arguments.length===1){var i=arguments[0];u.constructor_.call(this,i.x,i.y,i.getZ())}else if(arguments.length===2){var s=arguments[0],a=arguments[1];u.constructor_.call(this,s,a,u.NULL_ORDINATE)}else if(arguments.length===3){var h=arguments[0],g=arguments[1],m=arguments[2];this.x=h,this.y=g,this.z=m}}},{key:"hashCode",value:function(i){return Wt[0]=i,Ii[0]^Ii[1]}}])}(),ho=function(){function u(){o(this,u),u.constructor_.apply(this,arguments)}return c(u,[{key:"compare",value:function(i,s){var a=u.compare(i.x,s.x);if(a!==0)return a;var h=u.compare(i.y,s.y);return h!==0?h:this._dimensionsToTest<=2?0:u.compare(i.getZ(),s.getZ())}},{key:"interfaces_",get:function(){return[Ot]}}],[{key:"constructor_",value:function(){if(this._dimensionsToTest=2,arguments.length===0)u.constructor_.call(this,2);else if(arguments.length===1){var i=arguments[0];if(i!==2&&i!==3)throw new N("only 2 or 3 dimensions may be specified");this._dimensionsToTest=i}}},{key:"compare",value:function(i,s){return i<s?-1:i>s?1:Z.isNaN(i)?Z.isNaN(s)?0:-1:Z.isNaN(s)?1:0}}])}();U.DimensionalComparator=ho,U.NULL_ORDINATE=Z.NaN,U.X=0,U.Y=1,U.Z=2,U.M=3;var Dt=function(){function u(){o(this,u),u.constructor_.apply(this,arguments)}return c(u,[{key:"getArea",value:function(){return this.getWidth()*this.getHeight()}},{key:"equals",value:function(i){if(!(i instanceof u))return!1;var s=i;return this.isNull()?s.isNull():this._maxx===s.getMaxX()&&this._maxy===s.getMaxY()&&this._minx===s.getMinX()&&this._miny===s.getMinY()}},{key:"intersection",value:function(i){if(this.isNull()||i.isNull()||!this.intersects(i))return new u;var s=this._minx>i._minx?this._minx:i._minx,a=this._miny>i._miny?this._miny:i._miny;return new u(s,this._maxx<i._maxx?this._maxx:i._maxx,a,this._maxy<i._maxy?this._maxy:i._maxy)}},{key:"isNull",value:function(){return this._maxx<this._minx}},{key:"getMaxX",value:function(){return this._maxx}},{key:"covers",value:function(){if(arguments.length===1){if(arguments[0]instanceof U){var i=arguments[0];return this.covers(i.x,i.y)}if(arguments[0]instanceof u){var s=arguments[0];return!this.isNull()&&!s.isNull()&&s.getMinX()>=this._minx&&s.getMaxX()<=this._maxx&&s.getMinY()>=this._miny&&s.getMaxY()<=this._maxy}}else if(arguments.length===2){var a=arguments[0],h=arguments[1];return!this.isNull()&&a>=this._minx&&a<=this._maxx&&h>=this._miny&&h<=this._maxy}}},{key:"intersects",value:function(){if(arguments.length===1){if(arguments[0]instanceof u){var i=arguments[0];return!this.isNull()&&!i.isNull()&&!(i._minx>this._maxx||i._maxx<this._minx||i._miny>this._maxy||i._maxy<this._miny)}if(arguments[0]instanceof U){var s=arguments[0];return this.intersects(s.x,s.y)}}else if(arguments.length===2){if(arguments[0]instanceof U&&arguments[1]instanceof U){var a=arguments[0],h=arguments[1];return!this.isNull()&&!((a.x<h.x?a.x:h.x)>this._maxx)&&!((a.x>h.x?a.x:h.x)<this._minx)&&!((a.y<h.y?a.y:h.y)>this._maxy)&&!((a.y>h.y?a.y:h.y)<this._miny)}if(typeof arguments[0]=="number"&&typeof arguments[1]=="number"){var g=arguments[0],m=arguments[1];return!this.isNull()&&!(g>this._maxx||g<this._minx||m>this._maxy||m<this._miny)}}}},{key:"getMinY",value:function(){return this._miny}},{key:"getDiameter",value:function(){if(this.isNull())return 0;var i=this.getWidth(),s=this.getHeight();return Math.sqrt(i*i+s*s)}},{key:"getMinX",value:function(){return this._minx}},{key:"expandToInclude",value:function(){if(arguments.length===1){if(arguments[0]instanceof U){var i=arguments[0];this.expandToInclude(i.x,i.y)}else if(arguments[0]instanceof u){var s=arguments[0];if(s.isNull())return null;this.isNull()?(this._minx=s.getMinX(),this._maxx=s.getMaxX(),this._miny=s.getMinY(),this._maxy=s.getMaxY()):(s._minx<this._minx&&(this._minx=s._minx),s._maxx>this._maxx&&(this._maxx=s._maxx),s._miny<this._miny&&(this._miny=s._miny),s._maxy>this._maxy&&(this._maxy=s._maxy))}}else if(arguments.length===2){var a=arguments[0],h=arguments[1];this.isNull()?(this._minx=a,this._maxx=a,this._miny=h,this._maxy=h):(a<this._minx&&(this._minx=a),a>this._maxx&&(this._maxx=a),h<this._miny&&(this._miny=h),h>this._maxy&&(this._maxy=h))}}},{key:"minExtent",value:function(){if(this.isNull())return 0;var i=this.getWidth(),s=this.getHeight();return i<s?i:s}},{key:"getWidth",value:function(){return this.isNull()?0:this._maxx-this._minx}},{key:"compareTo",value:function(i){var s=i;return this.isNull()?s.isNull()?0:-1:s.isNull()?1:this._minx<s._minx?-1:this._minx>s._minx?1:this._miny<s._miny?-1:this._miny>s._miny?1:this._maxx<s._maxx?-1:this._maxx>s._maxx?1:this._maxy<s._maxy?-1:this._maxy>s._maxy?1:0}},{key:"translate",value:function(i,s){if(this.isNull())return null;this.init(this.getMinX()+i,this.getMaxX()+i,this.getMinY()+s,this.getMaxY()+s)}},{key:"copy",value:function(){return new u(this)}},{key:"toString",value:function(){return"Env["+this._minx+" : "+this._maxx+", "+this._miny+" : "+this._maxy+"]"}},{key:"setToNull",value:function(){this._minx=0,this._maxx=-1,this._miny=0,this._maxy=-1}},{key:"disjoint",value:function(i){return!(!this.isNull()&&!i.isNull())||i._minx>this._maxx||i._maxx<this._minx||i._miny>this._maxy||i._maxy<this._miny}},{key:"getHeight",value:function(){return this.isNull()?0:this._maxy-this._miny}},{key:"maxExtent",value:function(){if(this.isNull())return 0;var i=this.getWidth(),s=this.getHeight();return i>s?i:s}},{key:"expandBy",value:function(){if(arguments.length===1){var i=arguments[0];this.expandBy(i,i)}else if(arguments.length===2){var s=arguments[0],a=arguments[1];if(this.isNull())return null;this._minx-=s,this._maxx+=s,this._miny-=a,this._maxy+=a,(this._minx>this._maxx||this._miny>this._maxy)&&this.setToNull()}}},{key:"contains",value:function(){if(arguments.length===1){if(arguments[0]instanceof u){var i=arguments[0];return this.covers(i)}if(arguments[0]instanceof U){var s=arguments[0];return this.covers(s)}}else if(arguments.length===2){var a=arguments[0],h=arguments[1];return this.covers(a,h)}}},{key:"centre",value:function(){return this.isNull()?null:new U((this.getMinX()+this.getMaxX())/2,(this.getMinY()+this.getMaxY())/2)}},{key:"init",value:function(){if(arguments.length===0)this.setToNull();else if(arguments.length===1){if(arguments[0]instanceof U){var i=arguments[0];this.init(i.x,i.x,i.y,i.y)}else if(arguments[0]instanceof u){var s=arguments[0];this._minx=s._minx,this._maxx=s._maxx,this._miny=s._miny,this._maxy=s._maxy}}else if(arguments.length===2){var a=arguments[0],h=arguments[1];this.init(a.x,h.x,a.y,h.y)}else if(arguments.length===4){var g=arguments[0],m=arguments[1],_=arguments[2],k=arguments[3];g<m?(this._minx=g,this._maxx=m):(this._minx=m,this._maxx=g),_<k?(this._miny=_,this._maxy=k):(this._miny=k,this._maxy=_)}}},{key:"getMaxY",value:function(){return this._maxy}},{key:"distance",value:function(i){if(this.intersects(i))return 0;var s=0;this._maxx<i._minx?s=i._minx-this._maxx:this._minx>i._maxx&&(s=this._minx-i._maxx);var a=0;return this._maxy<i._miny?a=i._miny-this._maxy:this._miny>i._maxy&&(a=this._miny-i._maxy),s===0?a:a===0?s:Math.sqrt(s*s+a*a)}},{key:"hashCode",value:function(){var i=17;return i=37*(i=37*(i=37*(i=37*i+U.hashCode(this._minx))+U.hashCode(this._maxx))+U.hashCode(this._miny))+U.hashCode(this._maxy)}},{key:"interfaces_",get:function(){return[A,E]}}],[{key:"constructor_",value:function(){if(this._minx=null,this._maxx=null,this._miny=null,this._maxy=null,arguments.length===0)this.init();else if(arguments.length===1){if(arguments[0]instanceof U){var i=arguments[0];this.init(i.x,i.x,i.y,i.y)}else if(arguments[0]instanceof u){var s=arguments[0];this.init(s)}}else if(arguments.length===2){var a=arguments[0],h=arguments[1];this.init(a.x,h.x,a.y,h.y)}else if(arguments.length===4){var g=arguments[0],m=arguments[1],_=arguments[2],k=arguments[3];this.init(g,m,_,k)}}},{key:"intersects",value:function(){if(arguments.length===3){var i=arguments[0],s=arguments[1],a=arguments[2];return a.x>=(i.x<s.x?i.x:s.x)&&a.x<=(i.x>s.x?i.x:s.x)&&a.y>=(i.y<s.y?i.y:s.y)&&a.y<=(i.y>s.y?i.y:s.y)}if(arguments.length===4){var h=arguments[0],g=arguments[1],m=arguments[2],_=arguments[3],k=Math.min(m.x,_.x),b=Math.max(m.x,_.x),z=Math.min(h.x,g.x),q=Math.max(h.x,g.x);return!(z>b)&&!(q<k)&&(k=Math.min(m.y,_.y),b=Math.max(m.y,_.y),z=Math.min(h.y,g.y),q=Math.max(h.y,g.y),!(z>b)&&!(q<k))}}}])}(),at=function(){function u(){o(this,u),u.constructor_.apply(this,arguments)}return c(u,[{key:"isGeometryCollection",value:function(){return this.getTypeCode()===u.TYPECODE_GEOMETRYCOLLECTION}},{key:"getFactory",value:function(){return this._factory}},{key:"getGeometryN",value:function(i){return this}},{key:"getArea",value:function(){return 0}},{key:"isRectangle",value:function(){return!1}},{key:"equalsExact",value:function(i){return this===i||this.equalsExact(i,0)}},{key:"geometryChanged",value:function(){this.apply(u.geometryChangedFilter)}},{key:"geometryChangedAction",value:function(){this._envelope=null}},{key:"equalsNorm",value:function(i){return i!==null&&this.norm().equalsExact(i.norm())}},{key:"getLength",value:function(){return 0}},{key:"getNumGeometries",value:function(){return 1}},{key:"compareTo",value:function(){var i;if(arguments.length===1){var s=arguments[0];return i=s,this.getTypeCode()!==i.getTypeCode()?this.getTypeCode()-i.getTypeCode():this.isEmpty()&&i.isEmpty()?0:this.isEmpty()?-1:i.isEmpty()?1:this.compareToSameClass(s)}if(arguments.length===2){var a=arguments[0],h=arguments[1];return i=a,this.getTypeCode()!==i.getTypeCode()?this.getTypeCode()-i.getTypeCode():this.isEmpty()&&i.isEmpty()?0:this.isEmpty()?-1:i.isEmpty()?1:this.compareToSameClass(a,h)}}},{key:"getUserData",value:function(){return this._userData}},{key:"getSRID",value:function(){return this._SRID}},{key:"getEnvelope",value:function(){return this.getFactory().toGeometry(this.getEnvelopeInternal())}},{key:"checkNotGeometryCollection",value:function(i){if(i.getTypeCode()===u.TYPECODE_GEOMETRYCOLLECTION)throw new N("This method does not support GeometryCollection arguments")}},{key:"equal",value:function(i,s,a){return a===0?i.equals(s):i.distance(s)<=a}},{key:"norm",value:function(){var i=this.copy();return i.normalize(),i}},{key:"reverse",value:function(){var i=this.reverseInternal();return this.envelope!=null&&(i.envelope=this.envelope.copy()),i.setSRID(this.getSRID()),i}},{key:"copy",value:function(){var i=this.copyInternal();return i.envelope=this._envelope==null?null:this._envelope.copy(),i._SRID=this._SRID,i._userData=this._userData,i}},{key:"getPrecisionModel",value:function(){return this._factory.getPrecisionModel()}},{key:"getEnvelopeInternal",value:function(){return this._envelope===null&&(this._envelope=this.computeEnvelopeInternal()),new Dt(this._envelope)}},{key:"setSRID",value:function(i){this._SRID=i}},{key:"setUserData",value:function(i){this._userData=i}},{key:"compare",value:function(i,s){for(var a=i.iterator(),h=s.iterator();a.hasNext()&&h.hasNext();){var g=a.next(),m=h.next(),_=g.compareTo(m);if(_!==0)return _}return a.hasNext()?1:h.hasNext()?-1:0}},{key:"hashCode",value:function(){return this.getEnvelopeInternal().hashCode()}},{key:"isEquivalentClass",value:function(i){return this.getClass()===i.getClass()}},{key:"isGeometryCollectionOrDerived",value:function(){return this.getTypeCode()===u.TYPECODE_GEOMETRYCOLLECTION||this.getTypeCode()===u.TYPECODE_MULTIPOINT||this.getTypeCode()===u.TYPECODE_MULTILINESTRING||this.getTypeCode()===u.TYPECODE_MULTIPOLYGON}},{key:"interfaces_",get:function(){return[L,A,E]}},{key:"getClass",value:function(){return u}}],[{key:"hasNonEmptyElements",value:function(i){for(var s=0;s<i.length;s++)if(!i[s].isEmpty())return!0;return!1}},{key:"hasNullElements",value:function(i){for(var s=0;s<i.length;s++)if(i[s]===null)return!0;return!1}}])}();at.constructor_=function(u){u&&(this._envelope=null,this._userData=null,this._factory=u,this._SRID=u.getSRID())},at.TYPECODE_POINT=0,at.TYPECODE_MULTIPOINT=1,at.TYPECODE_LINESTRING=2,at.TYPECODE_LINEARRING=3,at.TYPECODE_MULTILINESTRING=4,at.TYPECODE_POLYGON=5,at.TYPECODE_MULTIPOLYGON=6,at.TYPECODE_GEOMETRYCOLLECTION=7,at.TYPENAME_POINT="Point",at.TYPENAME_MULTIPOINT="MultiPoint",at.TYPENAME_LINESTRING="LineString",at.TYPENAME_LINEARRING="LinearRing",at.TYPENAME_MULTILINESTRING="MultiLineString",at.TYPENAME_POLYGON="Polygon",at.TYPENAME_MULTIPOLYGON="MultiPolygon",at.TYPENAME_GEOMETRYCOLLECTION="GeometryCollection",at.geometryChangedFilter={get interfaces_(){return[G]},filter:function(u){u.geometryChangedAction()}};var R=function(){function u(){o(this,u)}return c(u,null,[{key:"toLocationSymbol",value:function(i){switch(i){case u.EXTERIOR:return"e";case u.BOUNDARY:return"b";case u.INTERIOR:return"i";case u.NONE:return"-"}throw new N("Unknown location value: "+i)}}])}();R.INTERIOR=0,R.BOUNDARY=1,R.EXTERIOR=2,R.NONE=-1;var Ee=function(){return c(function u(){o(this,u)},[{key:"add",value:function(){}},{key:"addAll",value:function(){}},{key:"isEmpty",value:function(){}},{key:"iterator",value:function(){}},{key:"size",value:function(){}},{key:"toArray",value:function(){}},{key:"remove",value:function(){}}])}(),Wn=function(u){function i(s){var a;return o(this,i),(a=r(this,i,[s])).name=Object.keys({NoSuchElementException:i})[0],a}return y(i,u),c(i)}(T),ze=function(u){function i(s){var a;return o(this,i),(a=r(this,i,[s])).name=Object.keys({UnsupportedOperationException:i})[0],a}return y(i,u),c(i)}(T),Ti=function(u){function i(){return o(this,i),r(this,i,arguments)}return y(i,u),c(i,[{key:"contains",value:function(){}}])}(Ee),co=function(u){function i(s){var a;return o(this,i),(a=r(this,i)).map=new Map,s instanceof Ee&&a.addAll(s),a}return y(i,u),c(i,[{key:"contains",value:function(s){var a=s.hashCode?s.hashCode():s;return!!this.map.has(a)}},{key:"add",value:function(s){var a=s.hashCode?s.hashCode():s;return!this.map.has(a)&&!!this.map.set(a,s)}},{key:"addAll",value:function(s){var a,h=d(s);try{for(h.s();!(a=h.n()).done;){var g=a.value;this.add(g)}}catch(m){h.e(m)}finally{h.f()}return!0}},{key:"remove",value:function(){throw new ze}},{key:"size",value:function(){return this.map.size}},{key:"isEmpty",value:function(){return this.map.size===0}},{key:"toArray",value:function(){return Array.from(this.map.values())}},{key:"iterator",value:function(){return new _g(this.map)}},{key:Symbol.iterator,value:function(){return this.map}}])}(Ti),_g=function(){return c(function u(i){o(this,u),this.iterator=i.values();var s=this.iterator.next(),a=s.done,h=s.value;this.done=a,this.value=h},[{key:"next",value:function(){if(this.done)throw new Wn;var u=this.value,i=this.iterator.next(),s=i.done,a=i.value;return this.done=s,this.value=a,u}},{key:"hasNext",value:function(){return!this.done}},{key:"remove",value:function(){throw new ze}}])}(),X=function(){function u(){o(this,u)}return c(u,null,[{key:"opposite",value:function(i){return i===u.LEFT?u.RIGHT:i===u.RIGHT?u.LEFT:i}}])}();X.ON=0,X.LEFT=1,X.RIGHT=2;var pu=function(u){function i(s){var a;return o(this,i),(a=r(this,i,[s])).name=Object.keys({EmptyStackException:i})[0],a}return y(i,u),c(i)}(T),mu=function(u){function i(s){var a;return o(this,i),(a=r(this,i,[s])).name=Object.keys({IndexOutOfBoundsException:i})[0],a}return y(i,u),c(i)}(T),Nn=function(u){function i(){return o(this,i),r(this,i,arguments)}return y(i,u),c(i,[{key:"get",value:function(){}},{key:"set",value:function(){}},{key:"isEmpty",value:function(){}}])}(Ee),wg=function(u){function i(){var s;return o(this,i),(s=r(this,i)).array=[],s}return y(i,u),c(i,[{key:"add",value:function(s){return this.array.push(s),!0}},{key:"get",value:function(s){if(s<0||s>=this.size())throw new mu;return this.array[s]}},{key:"push",value:function(s){return this.array.push(s),s}},{key:"pop",value:function(){if(this.array.length===0)throw new pu;return this.array.pop()}},{key:"peek",value:function(){if(this.array.length===0)throw new pu;return this.array[this.array.length-1]}},{key:"empty",value:function(){return this.array.length===0}},{key:"isEmpty",value:function(){return this.empty()}},{key:"search",value:function(s){return this.array.indexOf(s)}},{key:"size",value:function(){return this.array.length}},{key:"toArray",value:function(){return this.array.slice()}}])}(Nn);function pt(u,i){return u.interfaces_&&u.interfaces_.indexOf(i)>-1}var Tr=function(){return c(function u(i){o(this,u),this.str=i},[{key:"append",value:function(u){this.str+=u}},{key:"setCharAt",value:function(u,i){this.str=this.str.substr(0,u)+i+this.str.substr(u+1)}},{key:"toString",value:function(){return this.str}}])}(),Mi=function(){function u(i){o(this,u),this.value=i}return c(u,[{key:"intValue",value:function(){return this.value}},{key:"compareTo",value:function(i){return this.value<i?-1:this.value>i?1:0}}],[{key:"compare",value:function(i,s){return i<s?-1:i>s?1:0}},{key:"isNan",value:function(i){return Number.isNaN(i)}},{key:"valueOf",value:function(i){return new u(i)}}])}(),fo=function(){return c(function u(){o(this,u)},null,[{key:"isWhitespace",value:function(u){return u<=32&&u>=0||u===127}},{key:"toUpperCase",value:function(u){return u.toUpperCase()}}])}(),ft=function(){function u(){o(this,u),u.constructor_.apply(this,arguments)}return c(u,[{key:"le",value:function(i){return this._hi<i._hi||this._hi===i._hi&&this._lo<=i._lo}},{key:"extractSignificantDigits",value:function(i,s){var a=this.abs(),h=u.magnitude(a._hi),g=u.TEN.pow(h);(a=a.divide(g)).gt(u.TEN)?(a=a.divide(u.TEN),h+=1):a.lt(u.ONE)&&(a=a.multiply(u.TEN),h-=1);for(var m=h+1,_=new Tr,k=u.MAX_PRINT_DIGITS-1,b=0;b<=k;b++){i&&b===m&&_.append(".");var z=Math.trunc(a._hi);if(z<0)break;var q=!1,V=0;z>9?(q=!0,V="9"):V="0"+z,_.append(V),a=a.subtract(u.valueOf(z)).multiply(u.TEN),q&&a.selfAdd(u.TEN);var K=!0,rt=u.magnitude(a._hi);if(rt<0&&Math.abs(rt)>=k-b&&(K=!1),!K)break}return s[0]=h,_.toString()}},{key:"sqr",value:function(){return this.multiply(this)}},{key:"doubleValue",value:function(){return this._hi+this._lo}},{key:"subtract",value:function(){if(arguments[0]instanceof u){var i=arguments[0];return this.add(i.negate())}if(typeof arguments[0]=="number"){var s=arguments[0];return this.add(-s)}}},{key:"equals",value:function(){if(arguments.length===1&&arguments[0]instanceof u){var i=arguments[0];return this._hi===i._hi&&this._lo===i._lo}}},{key:"isZero",value:function(){return this._hi===0&&this._lo===0}},{key:"selfSubtract",value:function(){if(arguments[0]instanceof u){var i=arguments[0];return this.isNaN()?this:this.selfAdd(-i._hi,-i._lo)}if(typeof arguments[0]=="number"){var s=arguments[0];return this.isNaN()?this:this.selfAdd(-s,0)}}},{key:"getSpecialNumberString",value:function(){return this.isZero()?"0.0":this.isNaN()?"NaN ":null}},{key:"min",value:function(i){return this.le(i)?this:i}},{key:"selfDivide",value:function(){if(arguments.length===1){if(arguments[0]instanceof u){var i=arguments[0];return this.selfDivide(i._hi,i._lo)}if(typeof arguments[0]=="number"){var s=arguments[0];return this.selfDivide(s,0)}}else if(arguments.length===2){var a,h,g,m,_=arguments[0],k=arguments[1],b=null,z=null,q=null,V=null;return g=this._hi/_,V=(b=(q=u.SPLIT*g)-(b=q-g))*(z=(V=u.SPLIT*_)-(z=V-_))-(m=g*_)+b*(h=_-z)+(a=g-b)*z+a*h,V=g+(q=(this._hi-m-V+this._lo-g*k)/_),this._hi=V,this._lo=g-V+q,this}}},{key:"dump",value:function(){return"DD<"+this._hi+", "+this._lo+">"}},{key:"divide",value:function(){if(arguments[0]instanceof u){var i,s,a,h,g=arguments[0],m=null,_=null,k=null,b=null;return i=(a=this._hi/g._hi)-(m=(k=u.SPLIT*a)-(m=k-a)),b=m*(_=(b=u.SPLIT*g._hi)-(_=b-g._hi))-(h=a*g._hi)+m*(s=g._hi-_)+i*_+i*s,new u(b=a+(k=(this._hi-h-b+this._lo-a*g._lo)/g._hi),a-b+k)}if(typeof arguments[0]=="number"){var z=arguments[0];return Z.isNaN(z)?u.createNaN():u.copy(this).selfDivide(z,0)}}},{key:"ge",value:function(i){return this._hi>i._hi||this._hi===i._hi&&this._lo>=i._lo}},{key:"pow",value:function(i){if(i===0)return u.valueOf(1);var s=new u(this),a=u.valueOf(1),h=Math.abs(i);if(h>1)for(;h>0;)h%2==1&&a.selfMultiply(s),(h/=2)>0&&(s=s.sqr());else a=s;return i<0?a.reciprocal():a}},{key:"ceil",value:function(){if(this.isNaN())return u.NaN;var i=Math.ceil(this._hi),s=0;return i===this._hi&&(s=Math.ceil(this._lo)),new u(i,s)}},{key:"compareTo",value:function(i){var s=i;return this._hi<s._hi?-1:this._hi>s._hi?1:this._lo<s._lo?-1:this._lo>s._lo?1:0}},{key:"rint",value:function(){return this.isNaN()?this:this.add(.5).floor()}},{key:"setValue",value:function(){if(arguments[0]instanceof u){var i=arguments[0];return this.init(i),this}if(typeof arguments[0]=="number"){var s=arguments[0];return this.init(s),this}}},{key:"max",value:function(i){return this.ge(i)?this:i}},{key:"sqrt",value:function(){if(this.isZero())return u.valueOf(0);if(this.isNegative())return u.NaN;var i=1/Math.sqrt(this._hi),s=this._hi*i,a=u.valueOf(s),h=this.subtract(a.sqr())._hi*(.5*i);return a.add(h)}},{key:"selfAdd",value:function(){if(arguments.length===1){if(arguments[0]instanceof u){var i=arguments[0];return this.selfAdd(i._hi,i._lo)}if(typeof arguments[0]=="number"){var s,a,h,g,m,_=arguments[0],k=null;return k=(h=this._hi+_)-(g=h-this._hi),a=(m=(k=_-g+(this._hi-k))+this._lo)+(h-(s=h+m)),this._hi=s+a,this._lo=a+(s-this._hi),this}}else if(arguments.length===2){var b,z,q,V,K=arguments[0],rt=arguments[1],lt=null,Nt=null,It=null;q=this._hi+K,z=this._lo+rt,Nt=q-(It=q-this._hi),lt=z-(V=z-this._lo);var Ft=(b=q+(It=(Nt=K-It+(this._hi-Nt))+z))+(It=(lt=rt-V+(this._lo-lt))+(It+(q-b))),te=It+(b-Ft);return this._hi=Ft,this._lo=te,this}}},{key:"selfMultiply",value:function(){if(arguments.length===1){if(arguments[0]instanceof u){var i=arguments[0];return this.selfMultiply(i._hi,i._lo)}if(typeof arguments[0]=="number"){var s=arguments[0];return this.selfMultiply(s,0)}}else if(arguments.length===2){var a,h,g=arguments[0],m=arguments[1],_=null,k=null,b=null,z=null;_=(b=u.SPLIT*this._hi)-this._hi,z=u.SPLIT*g,_=b-_,a=this._hi-_,k=z-g;var q=(b=this._hi*g)+(z=_*(k=z-k)-b+_*(h=g-k)+a*k+a*h+(this._hi*m+this._lo*g)),V=z+(_=b-q);return this._hi=q,this._lo=V,this}}},{key:"selfSqr",value:function(){return this.selfMultiply(this)}},{key:"floor",value:function(){if(this.isNaN())return u.NaN;var i=Math.floor(this._hi),s=0;return i===this._hi&&(s=Math.floor(this._lo)),new u(i,s)}},{key:"negate",value:function(){return this.isNaN()?this:new u(-this._hi,-this._lo)}},{key:"clone",value:function(){try{return null}catch(i){if(i instanceof CloneNotSupportedException)return null;throw i}}},{key:"multiply",value:function(){if(arguments[0]instanceof u){var i=arguments[0];return i.isNaN()?u.createNaN():u.copy(this).selfMultiply(i)}if(typeof arguments[0]=="number"){var s=arguments[0];return Z.isNaN(s)?u.createNaN():u.copy(this).selfMultiply(s,0)}}},{key:"isNaN",value:function(){return Z.isNaN(this._hi)}},{key:"intValue",value:function(){return Math.trunc(this._hi)}},{key:"toString",value:function(){var i=u.magnitude(this._hi);return i>=-3&&i<=20?this.toStandardNotation():this.toSciNotation()}},{key:"toStandardNotation",value:function(){var i=this.getSpecialNumberString();if(i!==null)return i;var s=new Array(1).fill(null),a=this.extractSignificantDigits(!0,s),h=s[0]+1,g=a;if(a.charAt(0)===".")g="0"+a;else if(h<0)g="0."+u.stringOfChar("0",-h)+a;else if(a.indexOf(".")===-1){var m=h-a.length;g=a+u.stringOfChar("0",m)+".0"}return this.isNegative()?"-"+g:g}},{key:"reciprocal",value:function(){var i,s,a,h,g=null,m=null,_=null,k=null;i=(a=1/this._hi)-(g=(_=u.SPLIT*a)-(g=_-a)),m=(k=u.SPLIT*this._hi)-this._hi;var b=a+(_=(1-(h=a*this._hi)-(k=g*(m=k-m)-h+g*(s=this._hi-m)+i*m+i*s)-a*this._lo)/this._hi);return new u(b,a-b+_)}},{key:"toSciNotation",value:function(){if(this.isZero())return u.SCI_NOT_ZERO;var i=this.getSpecialNumberString();if(i!==null)return i;var s=new Array(1).fill(null),a=this.extractSignificantDigits(!1,s),h=u.SCI_NOT_EXPONENT_CHAR+s[0];if(a.charAt(0)==="0")throw new IllegalStateException("Found leading zero: "+a);var g="";a.length>1&&(g=a.substring(1));var m=a.charAt(0)+"."+g;return this.isNegative()?"-"+m+h:m+h}},{key:"abs",value:function(){return this.isNaN()?u.NaN:this.isNegative()?this.negate():new u(this)}},{key:"isPositive",value:function(){return this._hi>0||this._hi===0&&this._lo>0}},{key:"lt",value:function(i){return this._hi<i._hi||this._hi===i._hi&&this._lo<i._lo}},{key:"add",value:function(){if(arguments[0]instanceof u){var i=arguments[0];return u.copy(this).selfAdd(i)}if(typeof arguments[0]=="number"){var s=arguments[0];return u.copy(this).selfAdd(s)}}},{key:"init",value:function(){if(arguments.length===1){if(typeof arguments[0]=="number"){var i=arguments[0];this._hi=i,this._lo=0}else if(arguments[0]instanceof u){var s=arguments[0];this._hi=s._hi,this._lo=s._lo}}else if(arguments.length===2){var a=arguments[0],h=arguments[1];this._hi=a,this._lo=h}}},{key:"gt",value:function(i){return this._hi>i._hi||this._hi===i._hi&&this._lo>i._lo}},{key:"isNegative",value:function(){return this._hi<0||this._hi===0&&this._lo<0}},{key:"trunc",value:function(){return this.isNaN()?u.NaN:this.isPositive()?this.floor():this.ceil()}},{key:"signum",value:function(){return this._hi>0?1:this._hi<0?-1:this._lo>0?1:this._lo<0?-1:0}},{key:"interfaces_",get:function(){return[E,A,L]}}],[{key:"constructor_",value:function(){if(this._hi=0,this._lo=0,arguments.length===0)this.init(0);else if(arguments.length===1){if(typeof arguments[0]=="number"){var i=arguments[0];this.init(i)}else if(arguments[0]instanceof u){var s=arguments[0];this.init(s)}else if(typeof arguments[0]=="string"){var a=arguments[0];u.constructor_.call(this,u.parse(a))}}else if(arguments.length===2){var h=arguments[0],g=arguments[1];this.init(h,g)}}},{key:"determinant",value:function(){if(typeof arguments[3]=="number"&&typeof arguments[2]=="number"&&typeof arguments[0]=="number"&&typeof arguments[1]=="number"){var i=arguments[0],s=arguments[1],a=arguments[2],h=arguments[3];return u.determinant(u.valueOf(i),u.valueOf(s),u.valueOf(a),u.valueOf(h))}if(arguments[3]instanceof u&&arguments[2]instanceof u&&arguments[0]instanceof u&&arguments[1]instanceof u){var g=arguments[1],m=arguments[2],_=arguments[3];return arguments[0].multiply(_).selfSubtract(g.multiply(m))}}},{key:"sqr",value:function(i){return u.valueOf(i).selfMultiply(i)}},{key:"valueOf",value:function(){if(typeof arguments[0]=="string"){var i=arguments[0];return u.parse(i)}if(typeof arguments[0]=="number")return new u(arguments[0])}},{key:"sqrt",value:function(i){return u.valueOf(i).sqrt()}},{key:"parse",value:function(i){for(var s=0,a=i.length;fo.isWhitespace(i.charAt(s));)s++;var h=!1;if(s<a){var g=i.charAt(s);g!=="-"&&g!=="+"||(s++,g==="-"&&(h=!0))}for(var m=new u,_=0,k=0,b=0,z=!1;!(s>=a);){var q=i.charAt(s);if(s++,fo.isDigit(q)){var V=q-"0";m.selfMultiply(u.TEN),m.selfAdd(V),_++}else{if(q!=="."){if(q==="e"||q==="E"){var K=i.substring(s);try{b=Mi.parseInt(K)}catch(Ft){throw Ft instanceof NumberFormatException?new NumberFormatException("Invalid exponent "+K+" in string "+i):Ft}break}throw new NumberFormatException("Unexpected character '"+q+"' at position "+s+" in string "+i)}k=_,z=!0}}var rt=m;z||(k=_);var lt=_-k-b;if(lt===0)rt=m;else if(lt>0){var Nt=u.TEN.pow(lt);rt=m.divide(Nt)}else if(lt<0){var It=u.TEN.pow(-lt);rt=m.multiply(It)}return h?rt.negate():rt}},{key:"createNaN",value:function(){return new u(Z.NaN,Z.NaN)}},{key:"copy",value:function(i){return new u(i)}},{key:"magnitude",value:function(i){var s=Math.abs(i),a=Math.log(s)/Math.log(10),h=Math.trunc(Math.floor(a));return 10*Math.pow(10,h)<=s&&(h+=1),h}},{key:"stringOfChar",value:function(i,s){for(var a=new Tr,h=0;h<s;h++)a.append(i);return a.toString()}}])}();ft.PI=new ft(3.141592653589793,12246467991473532e-32),ft.TWO_PI=new ft(6.283185307179586,24492935982947064e-32),ft.PI_2=new ft(1.5707963267948966,6123233995736766e-32),ft.E=new ft(2.718281828459045,14456468917292502e-32),ft.NaN=new ft(Z.NaN,Z.NaN),ft.EPS=123259516440783e-46,ft.SPLIT=134217729,ft.MAX_PRINT_DIGITS=32,ft.TEN=ft.valueOf(10),ft.ONE=ft.valueOf(1),ft.SCI_NOT_EXPONENT_CHAR="E",ft.SCI_NOT_ZERO="0.0E0";var go=function(){function u(){o(this,u)}return c(u,null,[{key:"orientationIndex",value:function(i,s,a){var h=u.orientationIndexFilter(i,s,a);if(h<=1)return h;var g=ft.valueOf(s.x).selfAdd(-i.x),m=ft.valueOf(s.y).selfAdd(-i.y),_=ft.valueOf(a.x).selfAdd(-s.x),k=ft.valueOf(a.y).selfAdd(-s.y);return g.selfMultiply(k).selfSubtract(m.selfMultiply(_)).signum()}},{key:"signOfDet2x2",value:function(){if(arguments[3]instanceof ft&&arguments[2]instanceof ft&&arguments[0]instanceof ft&&arguments[1]instanceof ft){var i=arguments[1],s=arguments[2],a=arguments[3];return arguments[0].multiply(a).selfSubtract(i.multiply(s)).signum()}if(typeof arguments[3]=="number"&&typeof arguments[2]=="number"&&typeof arguments[0]=="number"&&typeof arguments[1]=="number"){var h=arguments[0],g=arguments[1],m=arguments[2],_=arguments[3],k=ft.valueOf(h),b=ft.valueOf(g),z=ft.valueOf(m),q=ft.valueOf(_);return k.multiply(q).selfSubtract(b.multiply(z)).signum()}}},{key:"intersection",value:function(i,s,a,h){var g=new ft(i.y).selfSubtract(s.y),m=new ft(s.x).selfSubtract(i.x),_=new ft(i.x).selfMultiply(s.y).selfSubtract(new ft(s.x).selfMultiply(i.y)),k=new ft(a.y).selfSubtract(h.y),b=new ft(h.x).selfSubtract(a.x),z=new ft(a.x).selfMultiply(h.y).selfSubtract(new ft(h.x).selfMultiply(a.y)),q=m.multiply(z).selfSubtract(b.multiply(_)),V=k.multiply(_).selfSubtract(g.multiply(z)),K=g.multiply(b).selfSubtract(k.multiply(m)),rt=q.selfDivide(K).doubleValue(),lt=V.selfDivide(K).doubleValue();return Z.isNaN(rt)||Z.isInfinite(rt)||Z.isNaN(lt)||Z.isInfinite(lt)?null:new U(rt,lt)}},{key:"orientationIndexFilter",value:function(i,s,a){var h=null,g=(i.x-a.x)*(s.y-a.y),m=(i.y-a.y)*(s.x-a.x),_=g-m;if(g>0){if(m<=0)return u.signum(_);h=g+m}else{if(!(g<0)||m>=0)return u.signum(_);h=-g-m}var k=u.DP_SAFE_EPSILON*h;return _>=k||-_>=k?u.signum(_):2}},{key:"signum",value:function(i){return i>0?1:i<0?-1:0}}])}();go.DP_SAFE_EPSILON=1e-15;var bt=function(){return c(function u(){o(this,u)},[{key:"getM",value:function(u){if(this.hasM()){var i=this.getDimension()-this.getMeasures();return this.getOrdinate(u,i)}return Z.NaN}},{key:"setOrdinate",value:function(u,i,s){}},{key:"getZ",value:function(u){return this.hasZ()?this.getOrdinate(u,2):Z.NaN}},{key:"size",value:function(){}},{key:"getOrdinate",value:function(u,i){}},{key:"getCoordinate",value:function(){}},{key:"getCoordinateCopy",value:function(u){}},{key:"createCoordinate",value:function(){}},{key:"getDimension",value:function(){}},{key:"hasM",value:function(){return this.getMeasures()>0}},{key:"getX",value:function(u){}},{key:"hasZ",value:function(){return this.getDimension()-this.getMeasures()>2}},{key:"getMeasures",value:function(){return 0}},{key:"expandEnvelope",value:function(u){}},{key:"copy",value:function(){}},{key:"getY",value:function(u){}},{key:"toCoordinateArray",value:function(){}},{key:"interfaces_",get:function(){return[L]}}])}();bt.X=0,bt.Y=1,bt.Z=2,bt.M=3;var dt=function(){function u(){o(this,u)}return c(u,null,[{key:"index",value:function(i,s,a){return go.orientationIndex(i,s,a)}},{key:"isCCW",value:function(){if(arguments[0]instanceof Array){var i=arguments[0],s=i.length-1;if(s<3)throw new N("Ring has fewer than 4 points, so orientation cannot be determined");for(var a=i[0],h=0,g=1;g<=s;g++){var m=i[g];m.y>a.y&&(a=m,h=g)}var _=h;do(_-=1)<0&&(_=s);while(i[_].equals2D(a)&&_!==h);var k=h;do k=(k+1)%s;while(i[k].equals2D(a)&&k!==h);var b=i[_],z=i[k];if(b.equals2D(a)||z.equals2D(a)||b.equals2D(z))return!1;var q=u.index(b,a,z);return q===0?b.x>z.x:q>0}if(pt(arguments[0],bt)){var V=arguments[0],K=V.size()-1;if(K<3)throw new N("Ring has fewer than 4 points, so orientation cannot be determined");for(var rt=V.getCoordinate(0),lt=0,Nt=1;Nt<=K;Nt++){var It=V.getCoordinate(Nt);It.y>rt.y&&(rt=It,lt=Nt)}var Ft=null,te=lt;do(te-=1)<0&&(te=K),Ft=V.getCoordinate(te);while(Ft.equals2D(rt)&&te!==lt);var ee=null,On=lt;do On=(On+1)%K,ee=V.getCoordinate(On);while(ee.equals2D(rt)&&On!==lt);if(Ft.equals2D(rt)||ee.equals2D(rt)||Ft.equals2D(ee))return!1;var Ar=u.index(Ft,rt,ee);return Ar===0?Ft.x>ee.x:Ar>0}}}])}();dt.CLOCKWISE=-1,dt.RIGHT=dt.CLOCKWISE,dt.COUNTERCLOCKWISE=1,dt.LEFT=dt.COUNTERCLOCKWISE,dt.COLLINEAR=0,dt.STRAIGHT=dt.COLLINEAR;var xg=function(){return c(function u(){o(this,u),u.constructor_.apply(this,arguments)},[{key:"getCoordinate",value:function(){return this._minCoord}},{key:"getRightmostSide",value:function(u,i){var s=this.getRightmostSideOfSegment(u,i);return s<0&&(s=this.getRightmostSideOfSegment(u,i-1)),s<0&&(this._minCoord=null,this.checkForRightmostCoordinate(u)),s}},{key:"findRightmostEdgeAtVertex",value:function(){var u=this._minDe.getEdge().getCoordinates();ot.isTrue(this._minIndex>0&&this._minIndex<u.length,"rightmost point expected to be interior vertex of edge");var i=u[this._minIndex-1],s=u[this._minIndex+1],a=dt.index(this._minCoord,s,i),h=!1;(i.y<this._minCoord.y&&s.y<this._minCoord.y&&a===dt.COUNTERCLOCKWISE||i.y>this._minCoord.y&&s.y>this._minCoord.y&&a===dt.CLOCKWISE)&&(h=!0),h&&(this._minIndex=this._minIndex-1)}},{key:"getRightmostSideOfSegment",value:function(u,i){var s=u.getEdge().getCoordinates();if(i<0||i+1>=s.length||s[i].y===s[i+1].y)return-1;var a=X.LEFT;return s[i].y<s[i+1].y&&(a=X.RIGHT),a}},{key:"getEdge",value:function(){return this._orientedDe}},{key:"checkForRightmostCoordinate",value:function(u){for(var i=u.getEdge().getCoordinates(),s=0;s<i.length-1;s++)(this._minCoord===null||i[s].x>this._minCoord.x)&&(this._minDe=u,this._minIndex=s,this._minCoord=i[s])}},{key:"findRightmostEdgeAtNode",value:function(){var u=this._minDe.getNode().getEdges();this._minDe=u.getRightmostEdge(),this._minDe.isForward()||(this._minDe=this._minDe.getSym(),this._minIndex=this._minDe.getEdge().getCoordinates().length-1)}},{key:"findEdge",value:function(u){for(var i=u.iterator();i.hasNext();){var s=i.next();s.isForward()&&this.checkForRightmostCoordinate(s)}ot.isTrue(this._minIndex!==0||this._minCoord.equals(this._minDe.getCoordinate()),"inconsistency in rightmost processing"),this._minIndex===0?this.findRightmostEdgeAtNode():this.findRightmostEdgeAtVertex(),this._orientedDe=this._minDe,this.getRightmostSide(this._minDe,this._minIndex)===X.LEFT&&(this._orientedDe=this._minDe.getSym())}}],[{key:"constructor_",value:function(){this._minIndex=-1,this._minCoord=null,this._minDe=null,this._orientedDe=null}}])}(),Ke=function(u){function i(s,a){var h;return o(this,i),(h=r(this,i,[a?s+" [ "+a+" ]":s])).pt=a?new U(a):void 0,h.name=Object.keys({TopologyException:i})[0],h}return y(i,u),c(i,[{key:"getCoordinate",value:function(){return this.pt}}])}(it),Eg=function(){return c(function u(){o(this,u),this.array=[]},[{key:"addLast",value:function(u){this.array.push(u)}},{key:"removeFirst",value:function(){return this.array.shift()}},{key:"isEmpty",value:function(){return this.array.length===0}}])}(),ht=function(u){function i(s){var a;return o(this,i),(a=r(this,i)).array=[],s instanceof Ee&&a.addAll(s),a}return y(i,u),c(i,[{key:"interfaces_",get:function(){return[Nn,Ee]}},{key:"ensureCapacity",value:function(){}},{key:"add",value:function(s){return arguments.length===1?this.array.push(s):this.array.splice(arguments[0],0,arguments[1]),!0}},{key:"clear",value:function(){this.array=[]}},{key:"addAll",value:function(s){var a,h=d(s);try{for(h.s();!(a=h.n()).done;){var g=a.value;this.array.push(g)}}catch(m){h.e(m)}finally{h.f()}}},{key:"set",value:function(s,a){var h=this.array[s];return this.array[s]=a,h}},{key:"iterator",value:function(){return new kg(this)}},{key:"get",value:function(s){if(s<0||s>=this.size())throw new mu;return this.array[s]}},{key:"isEmpty",value:function(){return this.array.length===0}},{key:"sort",value:function(s){s?this.array.sort(function(a,h){return s.compare(a,h)}):this.array.sort()}},{key:"size",value:function(){return this.array.length}},{key:"toArray",value:function(){return this.array.slice()}},{key:"remove",value:function(s){for(var a=0,h=this.array.length;a<h;a++)if(this.array[a]===s)return!!this.array.splice(a,1);return!1}},{key:Symbol.iterator,value:function(){return this.array.values()}}])}(Nn),kg=function(){return c(function u(i){o(this,u),this.arrayList=i,this.position=0},[{key:"next",value:function(){if(this.position===this.arrayList.size())throw new Wn;return this.arrayList.get(this.position++)}},{key:"hasNext",value:function(){return this.position<this.arrayList.size()}},{key:"set",value:function(u){return this.arrayList.set(this.position-1,u)}},{key:"remove",value:function(){this.arrayList.remove(this.arrayList.get(this.position))}}])}(),Ig=function(){return c(function u(){o(this,u),u.constructor_.apply(this,arguments)},[{key:"clearVisitedEdges",value:function(){for(var u=this._dirEdgeList.iterator();u.hasNext();)u.next().setVisited(!1)}},{key:"getRightmostCoordinate",value:function(){return this._rightMostCoord}},{key:"computeNodeDepth",value:function(u){for(var i=null,s=u.getEdges().iterator();s.hasNext();){var a=s.next();if(a.isVisited()||a.getSym().isVisited()){i=a;break}}if(i===null)throw new Ke("unable to find edge to compute depths at "+u.getCoordinate());u.getEdges().computeDepths(i);for(var h=u.getEdges().iterator();h.hasNext();){var g=h.next();g.setVisited(!0),this.copySymDepths(g)}}},{key:"computeDepth",value:function(u){this.clearVisitedEdges();var i=this._finder.getEdge();i.getNode(),i.getLabel(),i.setEdgeDepths(X.RIGHT,u),this.copySymDepths(i),this.computeDepths(i)}},{key:"create",value:function(u){this.addReachable(u),this._finder.findEdge(this._dirEdgeList),this._rightMostCoord=this._finder.getCoordinate()}},{key:"findResultEdges",value:function(){for(var u=this._dirEdgeList.iterator();u.hasNext();){var i=u.next();i.getDepth(X.RIGHT)>=1&&i.getDepth(X.LEFT)<=0&&!i.isInteriorAreaEdge()&&i.setInResult(!0)}}},{key:"computeDepths",value:function(u){var i=new co,s=new Eg,a=u.getNode();for(s.addLast(a),i.add(a),u.setVisited(!0);!s.isEmpty();){var h=s.removeFirst();i.add(h),this.computeNodeDepth(h);for(var g=h.getEdges().iterator();g.hasNext();){var m=g.next().getSym();if(!m.isVisited()){var _=m.getNode();i.contains(_)||(s.addLast(_),i.add(_))}}}}},{key:"compareTo",value:function(u){var i=u;return this._rightMostCoord.x<i._rightMostCoord.x?-1:this._rightMostCoord.x>i._rightMostCoord.x?1:0}},{key:"getEnvelope",value:function(){if(this._env===null){for(var u=new Dt,i=this._dirEdgeList.iterator();i.hasNext();)for(var s=i.next().getEdge().getCoordinates(),a=0;a<s.length-1;a++)u.expandToInclude(s[a]);this._env=u}return this._env}},{key:"addReachable",value:function(u){var i=new wg;for(i.add(u);!i.empty();){var s=i.pop();this.add(s,i)}}},{key:"copySymDepths",value:function(u){var i=u.getSym();i.setDepth(X.LEFT,u.getDepth(X.RIGHT)),i.setDepth(X.RIGHT,u.getDepth(X.LEFT))}},{key:"add",value:function(u,i){u.setVisited(!0),this._nodes.add(u);for(var s=u.getEdges().iterator();s.hasNext();){var a=s.next();this._dirEdgeList.add(a);var h=a.getSym().getNode();h.isVisited()||i.push(h)}}},{key:"getNodes",value:function(){return this._nodes}},{key:"getDirectedEdges",value:function(){return this._dirEdgeList}},{key:"interfaces_",get:function(){return[A]}}],[{key:"constructor_",value:function(){this._finder=null,this._dirEdgeList=new ht,this._nodes=new ht,this._rightMostCoord=null,this._env=null,this._finder=new xg}}])}(),po=function(){return c(function u(){o(this,u)},null,[{key:"intersection",value:function(u,i,s,a){var h=u.x<i.x?u.x:i.x,g=u.y<i.y?u.y:i.y,m=u.x>i.x?u.x:i.x,_=u.y>i.y?u.y:i.y,k=s.x<a.x?s.x:a.x,b=s.y<a.y?s.y:a.y,z=s.x>a.x?s.x:a.x,q=s.y>a.y?s.y:a.y,V=((h>k?h:k)+(m<z?m:z))/2,K=((g>b?g:b)+(_<q?_:q))/2,rt=u.x-V,lt=u.y-K,Nt=i.x-V,It=i.y-K,Ft=s.x-V,te=s.y-K,ee=a.x-V,On=a.y-K,Ar=lt-It,nl=Nt-rt,rl=rt*It-Nt*lt,il=te-On,sl=ee-Ft,ol=Ft*On-ee*te,al=Ar*sl-il*nl,Co=(nl*ol-sl*rl)/al,Po=(il*rl-Ar*ol)/al;return Z.isNaN(Co)||Z.isInfinite(Co)||Z.isNaN(Po)||Z.isInfinite(Po)?null:new U(Co+V,Po+K)}}])}(),ke=function(){return c(function u(){o(this,u)},null,[{key:"arraycopy",value:function(u,i,s,a,h){for(var g=0,m=i;m<i+h;m++)s[a+g]=u[m],g++}},{key:"getProperty",value:function(u){return{"line.separator":`
`}[u]}}])}(),Mr=function(){function u(){o(this,u)}return c(u,null,[{key:"log10",value:function(i){var s=Math.log(i);return Z.isInfinite(s)||Z.isNaN(s)?s:s/u.LOG_10}},{key:"min",value:function(i,s,a,h){var g=i;return s<g&&(g=s),a<g&&(g=a),h<g&&(g=h),g}},{key:"clamp",value:function(){if(typeof arguments[2]=="number"&&typeof arguments[0]=="number"&&typeof arguments[1]=="number"){var i=arguments[0],s=arguments[1],a=arguments[2];return i<s?s:i>a?a:i}if(Number.isInteger(arguments[2])&&Number.isInteger(arguments[0])&&Number.isInteger(arguments[1])){var h=arguments[0],g=arguments[1],m=arguments[2];return h<g?g:h>m?m:h}}},{key:"wrap",value:function(i,s){return i<0?s- -i%s:i%s}},{key:"max",value:function(){if(arguments.length===3){var i=arguments[1],s=arguments[2],a=arguments[0];return i>a&&(a=i),s>a&&(a=s),a}if(arguments.length===4){var h=arguments[1],g=arguments[2],m=arguments[3],_=arguments[0];return h>_&&(_=h),g>_&&(_=g),m>_&&(_=m),_}}},{key:"average",value:function(i,s){return(i+s)/2}}])}();Mr.LOG_10=Math.log(10);var qe=function(){function u(){o(this,u)}return c(u,null,[{key:"segmentToSegment",value:function(i,s,a,h){if(i.equals(s))return u.pointToSegment(i,a,h);if(a.equals(h))return u.pointToSegment(h,i,s);var g=!1;if(Dt.intersects(i,s,a,h)){var m=(s.x-i.x)*(h.y-a.y)-(s.y-i.y)*(h.x-a.x);if(m===0)g=!0;else{var _=(i.y-a.y)*(h.x-a.x)-(i.x-a.x)*(h.y-a.y),k=((i.y-a.y)*(s.x-i.x)-(i.x-a.x)*(s.y-i.y))/m,b=_/m;(b<0||b>1||k<0||k>1)&&(g=!0)}}else g=!0;return g?Mr.min(u.pointToSegment(i,a,h),u.pointToSegment(s,a,h),u.pointToSegment(a,i,s),u.pointToSegment(h,i,s)):0}},{key:"pointToSegment",value:function(i,s,a){if(s.x===a.x&&s.y===a.y)return i.distance(s);var h=(a.x-s.x)*(a.x-s.x)+(a.y-s.y)*(a.y-s.y),g=((i.x-s.x)*(a.x-s.x)+(i.y-s.y)*(a.y-s.y))/h;if(g<=0)return i.distance(s);if(g>=1)return i.distance(a);var m=((s.y-i.y)*(a.x-s.x)-(s.x-i.x)*(a.y-s.y))/h;return Math.abs(m)*Math.sqrt(h)}},{key:"pointToLinePerpendicular",value:function(i,s,a){var h=(a.x-s.x)*(a.x-s.x)+(a.y-s.y)*(a.y-s.y),g=((s.y-i.y)*(a.x-s.x)-(s.x-i.x)*(a.y-s.y))/h;return Math.abs(g)*Math.sqrt(h)}},{key:"pointToSegmentString",value:function(i,s){if(s.length===0)throw new N("Line array must contain at least one vertex");for(var a=i.distance(s[0]),h=0;h<s.length-1;h++){var g=u.pointToSegment(i,s[h],s[h+1]);g<a&&(a=g)}return a}}])}(),vu=function(){return c(function u(){o(this,u)},[{key:"create",value:function(){if(arguments.length===1)arguments[0]instanceof Array||pt(arguments[0],bt);else if(arguments.length!==2){if(arguments.length===3){var u=arguments[0],i=arguments[1];return this.create(u,i)}}}}])}(),bi=function(){return c(function u(){o(this,u)},[{key:"filter",value:function(u){}}])}(),Tg=function(){return c(function u(){o(this,u)},null,[{key:"ofLine",value:function(u){var i=u.size();if(i<=1)return 0;var s=0,a=new U;u.getCoordinate(0,a);for(var h=a.x,g=a.y,m=1;m<i;m++){u.getCoordinate(m,a);var _=a.x,k=a.y,b=_-h,z=k-g;s+=Math.sqrt(b*b+z*z),h=_,g=k}return s}}])}(),yu=c(function u(){o(this,u)}),Sn=function(){function u(){o(this,u)}return c(u,null,[{key:"copyCoord",value:function(i,s,a,h){for(var g=Math.min(i.getDimension(),a.getDimension()),m=0;m<g;m++)a.setOrdinate(h,m,i.getOrdinate(s,m))}},{key:"isRing",value:function(i){var s=i.size();return s===0||!(s<=3)&&i.getOrdinate(0,bt.X)===i.getOrdinate(s-1,bt.X)&&i.getOrdinate(0,bt.Y)===i.getOrdinate(s-1,bt.Y)}},{key:"scroll",value:function(){if(arguments.length===2){if(pt(arguments[0],bt)&&Number.isInteger(arguments[1])){var i=arguments[0],s=arguments[1];u.scroll(i,s,u.isRing(i))}else if(pt(arguments[0],bt)&&arguments[1]instanceof U){var a=arguments[0],h=arguments[1],g=u.indexOf(h,a);if(g<=0)return null;u.scroll(a,g)}}else if(arguments.length===3){var m=arguments[0],_=arguments[1],k=arguments[2];if(_<=0)return null;for(var b=m.copy(),z=k?m.size()-1:m.size(),q=0;q<z;q++)for(var V=0;V<m.getDimension();V++)m.setOrdinate(q,V,b.getOrdinate((_+q)%z,V));if(k)for(var K=0;K<m.getDimension();K++)m.setOrdinate(z,K,m.getOrdinate(0,K))}}},{key:"isEqual",value:function(i,s){var a=i.size();if(a!==s.size())return!1;for(var h=Math.min(i.getDimension(),s.getDimension()),g=0;g<a;g++)for(var m=0;m<h;m++){var _=i.getOrdinate(g,m),k=s.getOrdinate(g,m);if(i.getOrdinate(g,m)!==s.getOrdinate(g,m)&&(!Z.isNaN(_)||!Z.isNaN(k)))return!1}return!0}},{key:"minCoordinateIndex",value:function(){if(arguments.length===1){var i=arguments[0];return u.minCoordinateIndex(i,0,i.size()-1)}if(arguments.length===3){for(var s=arguments[0],a=arguments[2],h=-1,g=null,m=arguments[1];m<=a;m++){var _=s.getCoordinate(m);(g===null||g.compareTo(_)>0)&&(g=_,h=m)}return h}}},{key:"extend",value:function(i,s,a){var h=i.create(a,s.getDimension()),g=s.size();if(u.copy(s,0,h,0,g),g>0)for(var m=g;m<a;m++)u.copy(s,g-1,h,m,1);return h}},{key:"reverse",value:function(i){for(var s=i.size()-1,a=Math.trunc(s/2),h=0;h<=a;h++)u.swap(i,h,s-h)}},{key:"swap",value:function(i,s,a){if(s===a)return null;for(var h=0;h<i.getDimension();h++){var g=i.getOrdinate(s,h);i.setOrdinate(s,h,i.getOrdinate(a,h)),i.setOrdinate(a,h,g)}}},{key:"copy",value:function(i,s,a,h,g){for(var m=0;m<g;m++)u.copyCoord(i,s+m,a,h+m)}},{key:"ensureValidRing",value:function(i,s){var a=s.size();return a===0?s:a<=3?u.createClosedRing(i,s,4):s.getOrdinate(0,bt.X)===s.getOrdinate(a-1,bt.X)&&s.getOrdinate(0,bt.Y)===s.getOrdinate(a-1,bt.Y)?s:u.createClosedRing(i,s,a+1)}},{key:"indexOf",value:function(i,s){for(var a=0;a<s.size();a++)if(i.x===s.getOrdinate(a,bt.X)&&i.y===s.getOrdinate(a,bt.Y))return a;return-1}},{key:"createClosedRing",value:function(i,s,a){var h=i.create(a,s.getDimension()),g=s.size();u.copy(s,0,h,0,g);for(var m=g;m<a;m++)u.copy(s,0,h,m,1);return h}},{key:"minCoordinate",value:function(i){for(var s=null,a=0;a<i.size();a++){var h=i.getCoordinate(a);(s===null||s.compareTo(h)>0)&&(s=h)}return s}}])}(),H=function(){function u(){o(this,u)}return c(u,null,[{key:"toDimensionSymbol",value:function(i){switch(i){case u.FALSE:return u.SYM_FALSE;case u.TRUE:return u.SYM_TRUE;case u.DONTCARE:return u.SYM_DONTCARE;case u.P:return u.SYM_P;case u.L:return u.SYM_L;case u.A:return u.SYM_A}throw new N("Unknown dimension value: "+i)}},{key:"toDimensionValue",value:function(i){switch(fo.toUpperCase(i)){case u.SYM_FALSE:return u.FALSE;case u.SYM_TRUE:return u.TRUE;case u.SYM_DONTCARE:return u.DONTCARE;case u.SYM_P:return u.P;case u.SYM_L:return u.L;case u.SYM_A:return u.A}throw new N("Unknown dimension symbol: "+i)}}])}();H.P=0,H.L=1,H.A=2,H.FALSE=-1,H.TRUE=-2,H.DONTCARE=-3,H.SYM_FALSE="F",H.SYM_TRUE="T",H.SYM_DONTCARE="*",H.SYM_P="0",H.SYM_L="1",H.SYM_A="2";var Ni=function(){return c(function u(){o(this,u)},[{key:"filter",value:function(u){}}])}(),Si=function(){return c(function u(){o(this,u)},[{key:"filter",value:function(u,i){}},{key:"isDone",value:function(){}},{key:"isGeometryChanged",value:function(){}}])}(),br=function(u){function i(){var s;return o(this,i),s=r(this,i),i.constructor_.apply(s,arguments),s}return y(i,u),c(i,[{key:"computeEnvelopeInternal",value:function(){return this.isEmpty()?new Dt:this._points.expandEnvelope(new Dt)}},{key:"isRing",value:function(){return this.isClosed()&&this.isSimple()}},{key:"getCoordinates",value:function(){return this._points.toCoordinateArray()}},{key:"copyInternal",value:function(){return new i(this._points.copy(),this._factory)}},{key:"equalsExact",value:function(){if(arguments.length===2&&typeof arguments[1]=="number"&&arguments[0]instanceof at){var s=arguments[0],a=arguments[1];if(!this.isEquivalentClass(s))return!1;var h=s;if(this._points.size()!==h._points.size())return!1;for(var g=0;g<this._points.size();g++)if(!this.equal(this._points.getCoordinate(g),h._points.getCoordinate(g),a))return!1;return!0}return I(i,"equalsExact",this,1).apply(this,arguments)}},{key:"normalize",value:function(){for(var s=0;s<Math.trunc(this._points.size()/2);s++){var a=this._points.size()-1-s;if(!this._points.getCoordinate(s).equals(this._points.getCoordinate(a))){if(this._points.getCoordinate(s).compareTo(this._points.getCoordinate(a))>0){var h=this._points.copy();Sn.reverse(h),this._points=h}return null}}}},{key:"getCoordinate",value:function(){return this.isEmpty()?null:this._points.getCoordinate(0)}},{key:"getBoundaryDimension",value:function(){return this.isClosed()?H.FALSE:0}},{key:"isClosed",value:function(){return!this.isEmpty()&&this.getCoordinateN(0).equals2D(this.getCoordinateN(this.getNumPoints()-1))}},{key:"reverseInternal",value:function(){var s=this._points.copy();return Sn.reverse(s),this.getFactory().createLineString(s)}},{key:"getEndPoint",value:function(){return this.isEmpty()?null:this.getPointN(this.getNumPoints()-1)}},{key:"getTypeCode",value:function(){return at.TYPECODE_LINESTRING}},{key:"getDimension",value:function(){return 1}},{key:"getLength",value:function(){return Tg.ofLine(this._points)}},{key:"getNumPoints",value:function(){return this._points.size()}},{key:"compareToSameClass",value:function(){if(arguments.length===1){for(var s=arguments[0],a=0,h=0;a<this._points.size()&&h<s._points.size();){var g=this._points.getCoordinate(a).compareTo(s._points.getCoordinate(h));if(g!==0)return g;a++,h++}return a<this._points.size()?1:h<s._points.size()?-1:0}if(arguments.length===2){var m=arguments[0];return arguments[1].compare(this._points,m._points)}}},{key:"apply",value:function(){if(pt(arguments[0],bi))for(var s=arguments[0],a=0;a<this._points.size();a++)s.filter(this._points.getCoordinate(a));else if(pt(arguments[0],Si)){var h=arguments[0];if(this._points.size()===0)return null;for(var g=0;g<this._points.size()&&(h.filter(this._points,g),!h.isDone());g++);h.isGeometryChanged()&&this.geometryChanged()}else pt(arguments[0],Ni)?arguments[0].filter(this):pt(arguments[0],G)&&arguments[0].filter(this)}},{key:"getBoundary",value:function(){throw new ze}},{key:"isEquivalentClass",value:function(s){return s instanceof i}},{key:"getCoordinateN",value:function(s){return this._points.getCoordinate(s)}},{key:"getGeometryType",value:function(){return at.TYPENAME_LINESTRING}},{key:"getCoordinateSequence",value:function(){return this._points}},{key:"isEmpty",value:function(){return this._points.size()===0}},{key:"init",value:function(s){if(s===null&&(s=this.getFactory().getCoordinateSequenceFactory().create([])),s.size()===1)throw new N("Invalid number of points in LineString (found "+s.size()+" - must be 0 or >= 2)");this._points=s}},{key:"isCoordinate",value:function(s){for(var a=0;a<this._points.size();a++)if(this._points.getCoordinate(a).equals(s))return!0;return!1}},{key:"getStartPoint",value:function(){return this.isEmpty()?null:this.getPointN(0)}},{key:"getPointN",value:function(s){return this.getFactory().createPoint(this._points.getCoordinate(s))}},{key:"interfaces_",get:function(){return[yu]}}],[{key:"constructor_",value:function(){if(this._points=null,arguments.length!==0){if(arguments.length===2){var s=arguments[0],a=arguments[1];at.constructor_.call(this,a),this.init(s)}}}}])}(at),_u=c(function u(){o(this,u)}),mo=function(u){function i(){var s;return o(this,i),s=r(this,i),i.constructor_.apply(s,arguments),s}return y(i,u),c(i,[{key:"computeEnvelopeInternal",value:function(){if(this.isEmpty())return new Dt;var s=new Dt;return s.expandToInclude(this._coordinates.getX(0),this._coordinates.getY(0)),s}},{key:"getCoordinates",value:function(){return this.isEmpty()?[]:[this.getCoordinate()]}},{key:"copyInternal",value:function(){return new i(this._coordinates.copy(),this._factory)}},{key:"equalsExact",value:function(){if(arguments.length===2&&typeof arguments[1]=="number"&&arguments[0]instanceof at){var s=arguments[0],a=arguments[1];return!!this.isEquivalentClass(s)&&(!(!this.isEmpty()||!s.isEmpty())||this.isEmpty()===s.isEmpty()&&this.equal(s.getCoordinate(),this.getCoordinate(),a))}return I(i,"equalsExact",this,1).apply(this,arguments)}},{key:"normalize",value:function(){}},{key:"getCoordinate",value:function(){return this._coordinates.size()!==0?this._coordinates.getCoordinate(0):null}},{key:"getBoundaryDimension",value:function(){return H.FALSE}},{key:"reverseInternal",value:function(){return this.getFactory().createPoint(this._coordinates.copy())}},{key:"getTypeCode",value:function(){return at.TYPECODE_POINT}},{key:"getDimension",value:function(){return 0}},{key:"getNumPoints",value:function(){return this.isEmpty()?0:1}},{key:"getX",value:function(){if(this.getCoordinate()===null)throw new IllegalStateException("getX called on empty Point");return this.getCoordinate().x}},{key:"compareToSameClass",value:function(){if(arguments.length===1){var s=arguments[0];return this.getCoordinate().compareTo(s.getCoordinate())}if(arguments.length===2){var a=arguments[0];return arguments[1].compare(this._coordinates,a._coordinates)}}},{key:"apply",value:function(){if(pt(arguments[0],bi)){var s=arguments[0];if(this.isEmpty())return null;s.filter(this.getCoordinate())}else if(pt(arguments[0],Si)){var a=arguments[0];if(this.isEmpty())return null;a.filter(this._coordinates,0),a.isGeometryChanged()&&this.geometryChanged()}else pt(arguments[0],Ni)?arguments[0].filter(this):pt(arguments[0],G)&&arguments[0].filter(this)}},{key:"getBoundary",value:function(){return this.getFactory().createGeometryCollection()}},{key:"getGeometryType",value:function(){return at.TYPENAME_POINT}},{key:"getCoordinateSequence",value:function(){return this._coordinates}},{key:"getY",value:function(){if(this.getCoordinate()===null)throw new IllegalStateException("getY called on empty Point");return this.getCoordinate().y}},{key:"isEmpty",value:function(){return this._coordinates.size()===0}},{key:"init",value:function(s){s===null&&(s=this.getFactory().getCoordinateSequenceFactory().create([])),ot.isTrue(s.size()<=1),this._coordinates=s}},{key:"isSimple",value:function(){return!0}},{key:"interfaces_",get:function(){return[_u]}}],[{key:"constructor_",value:function(){this._coordinates=null;var s=arguments[0],a=arguments[1];at.constructor_.call(this,a),this.init(s)}}])}(at),wu=function(){function u(){o(this,u)}return c(u,null,[{key:"ofRing",value:function(){if(arguments[0]instanceof Array){var i=arguments[0];return Math.abs(u.ofRingSigned(i))}if(pt(arguments[0],bt)){var s=arguments[0];return Math.abs(u.ofRingSigned(s))}}},{key:"ofRingSigned",value:function(){if(arguments[0]instanceof Array){var i=arguments[0];if(i.length<3)return 0;for(var s=0,a=i[0].x,h=1;h<i.length-1;h++){var g=i[h].x-a,m=i[h+1].y;s+=g*(i[h-1].y-m)}return s/2}if(pt(arguments[0],bt)){var _=arguments[0],k=_.size();if(k<3)return 0;var b=new U,z=new U,q=new U;_.getCoordinate(0,z),_.getCoordinate(1,q);var V=z.x;q.x-=V;for(var K=0,rt=1;rt<k-1;rt++)b.y=z.y,z.x=q.x,z.y=q.y,_.getCoordinate(rt+1,q),q.x-=V,K+=z.x*(b.y-q.y);return K/2}}}])}(),Rn=function(){return c(function u(){o(this,u)},null,[{key:"sort",value:function(){var u=arguments,i=arguments[0];if(arguments.length===1)i.sort(function(V,K){return V.compareTo(K)});else if(arguments.length===2)i.sort(function(V,K){return u[1].compare(V,K)});else if(arguments.length===3){var s=i.slice(arguments[1],arguments[2]);s.sort();var a=i.slice(0,arguments[1]).concat(s,i.slice(arguments[2],i.length));i.splice(0,i.length);var h,g=d(a);try{for(g.s();!(h=g.n()).done;){var m=h.value;i.push(m)}}catch(V){g.e(V)}finally{g.f()}}else if(arguments.length===4){var _=i.slice(arguments[1],arguments[2]);_.sort(function(V,K){return u[3].compare(V,K)});var k=i.slice(0,arguments[1]).concat(_,i.slice(arguments[2],i.length));i.splice(0,i.length);var b,z=d(k);try{for(z.s();!(b=z.n()).done;){var q=b.value;i.push(q)}}catch(V){z.e(V)}finally{z.f()}}}},{key:"asList",value:function(u){var i,s=new ht,a=d(u);try{for(a.s();!(i=a.n()).done;){var h=i.value;s.add(h)}}catch(g){a.e(g)}finally{a.f()}return s}},{key:"copyOf",value:function(u,i){return u.slice(0,i)}}])}(),xu=c(function u(){o(this,u)}),Ri=function(u){function i(){var s;return o(this,i),s=r(this,i),i.constructor_.apply(s,arguments),s}return y(i,u),c(i,[{key:"computeEnvelopeInternal",value:function(){return this._shell.getEnvelopeInternal()}},{key:"getCoordinates",value:function(){if(this.isEmpty())return[];for(var s=new Array(this.getNumPoints()).fill(null),a=-1,h=this._shell.getCoordinates(),g=0;g<h.length;g++)s[++a]=h[g];for(var m=0;m<this._holes.length;m++)for(var _=this._holes[m].getCoordinates(),k=0;k<_.length;k++)s[++a]=_[k];return s}},{key:"getArea",value:function(){var s=0;s+=wu.ofRing(this._shell.getCoordinateSequence());for(var a=0;a<this._holes.length;a++)s-=wu.ofRing(this._holes[a].getCoordinateSequence());return s}},{key:"copyInternal",value:function(){for(var s=this._shell.copy(),a=new Array(this._holes.length).fill(null),h=0;h<this._holes.length;h++)a[h]=this._holes[h].copy();return new i(s,a,this._factory)}},{key:"isRectangle",value:function(){if(this.getNumInteriorRing()!==0||this._shell===null||this._shell.getNumPoints()!==5)return!1;for(var s=this._shell.getCoordinateSequence(),a=this.getEnvelopeInternal(),h=0;h<5;h++){var g=s.getX(h);if(g!==a.getMinX()&&g!==a.getMaxX())return!1;var m=s.getY(h);if(m!==a.getMinY()&&m!==a.getMaxY())return!1}for(var _=s.getX(0),k=s.getY(0),b=1;b<=4;b++){var z=s.getX(b),q=s.getY(b);if(z!==_==(q!==k))return!1;_=z,k=q}return!0}},{key:"equalsExact",value:function(){if(arguments.length===2&&typeof arguments[1]=="number"&&arguments[0]instanceof at){var s=arguments[0],a=arguments[1];if(!this.isEquivalentClass(s))return!1;var h=s,g=this._shell,m=h._shell;if(!g.equalsExact(m,a)||this._holes.length!==h._holes.length)return!1;for(var _=0;_<this._holes.length;_++)if(!this._holes[_].equalsExact(h._holes[_],a))return!1;return!0}return I(i,"equalsExact",this,1).apply(this,arguments)}},{key:"normalize",value:function(){if(arguments.length===0){this._shell=this.normalized(this._shell,!0);for(var s=0;s<this._holes.length;s++)this._holes[s]=this.normalized(this._holes[s],!1);Rn.sort(this._holes)}else if(arguments.length===2){var a=arguments[0],h=arguments[1];if(a.isEmpty())return null;var g=a.getCoordinateSequence(),m=Sn.minCoordinateIndex(g,0,g.size()-2);Sn.scroll(g,m,!0),dt.isCCW(g)===h&&Sn.reverse(g)}}},{key:"getCoordinate",value:function(){return this._shell.getCoordinate()}},{key:"getNumInteriorRing",value:function(){return this._holes.length}},{key:"getBoundaryDimension",value:function(){return 1}},{key:"reverseInternal",value:function(){for(var s=this.getExteriorRing().reverse(),a=new Array(this.getNumInteriorRing()).fill(null),h=0;h<a.length;h++)a[h]=this.getInteriorRingN(h).reverse();return this.getFactory().createPolygon(s,a)}},{key:"getTypeCode",value:function(){return at.TYPECODE_POLYGON}},{key:"getDimension",value:function(){return 2}},{key:"getLength",value:function(){var s=0;s+=this._shell.getLength();for(var a=0;a<this._holes.length;a++)s+=this._holes[a].getLength();return s}},{key:"getNumPoints",value:function(){for(var s=this._shell.getNumPoints(),a=0;a<this._holes.length;a++)s+=this._holes[a].getNumPoints();return s}},{key:"convexHull",value:function(){return this.getExteriorRing().convexHull()}},{key:"normalized",value:function(s,a){var h=s.copy();return this.normalize(h,a),h}},{key:"compareToSameClass",value:function(){if(arguments.length===1){var s=arguments[0],a=this._shell,h=s._shell;return a.compareToSameClass(h)}if(arguments.length===2){var g=arguments[1],m=arguments[0],_=this._shell,k=m._shell,b=_.compareToSameClass(k,g);if(b!==0)return b;for(var z=this.getNumInteriorRing(),q=m.getNumInteriorRing(),V=0;V<z&&V<q;){var K=this.getInteriorRingN(V),rt=m.getInteriorRingN(V),lt=K.compareToSameClass(rt,g);if(lt!==0)return lt;V++}return V<z?1:V<q?-1:0}}},{key:"apply",value:function(){if(pt(arguments[0],bi)){var s=arguments[0];this._shell.apply(s);for(var a=0;a<this._holes.length;a++)this._holes[a].apply(s)}else if(pt(arguments[0],Si)){var h=arguments[0];if(this._shell.apply(h),!h.isDone())for(var g=0;g<this._holes.length&&(this._holes[g].apply(h),!h.isDone());g++);h.isGeometryChanged()&&this.geometryChanged()}else if(pt(arguments[0],Ni))arguments[0].filter(this);else if(pt(arguments[0],G)){var m=arguments[0];m.filter(this),this._shell.apply(m);for(var _=0;_<this._holes.length;_++)this._holes[_].apply(m)}}},{key:"getBoundary",value:function(){if(this.isEmpty())return this.getFactory().createMultiLineString();var s=new Array(this._holes.length+1).fill(null);s[0]=this._shell;for(var a=0;a<this._holes.length;a++)s[a+1]=this._holes[a];return s.length<=1?this.getFactory().createLinearRing(s[0].getCoordinateSequence()):this.getFactory().createMultiLineString(s)}},{key:"getGeometryType",value:function(){return at.TYPENAME_POLYGON}},{key:"getExteriorRing",value:function(){return this._shell}},{key:"isEmpty",value:function(){return this._shell.isEmpty()}},{key:"getInteriorRingN",value:function(s){return this._holes[s]}},{key:"interfaces_",get:function(){return[xu]}}],[{key:"constructor_",value:function(){this._shell=null,this._holes=null;var s=arguments[0],a=arguments[1],h=arguments[2];if(at.constructor_.call(this,h),s===null&&(s=this.getFactory().createLinearRing()),a===null&&(a=[]),at.hasNullElements(a))throw new N("holes must not contain null elements");if(s.isEmpty()&&at.hasNonEmptyElements(a))throw new N("shell is empty but holes are not");this._shell=s,this._holes=a}}])}(at),Mg=function(u){function i(){return o(this,i),r(this,i,arguments)}return y(i,u),c(i)}(Ti),Eu=function(u){function i(s){var a;return o(this,i),(a=r(this,i)).array=[],s instanceof Ee&&a.addAll(s),a}return y(i,u),c(i,[{key:"contains",value:function(s){var a,h=d(this.array);try{for(h.s();!(a=h.n()).done;)if(a.value.compareTo(s)===0)return!0}catch(g){h.e(g)}finally{h.f()}return!1}},{key:"add",value:function(s){if(this.contains(s))return!1;for(var a=0,h=this.array.length;a<h;a++)if(this.array[a].compareTo(s)===1)return!!this.array.splice(a,0,s);return this.array.push(s),!0}},{key:"addAll",value:function(s){var a,h=d(s);try{for(h.s();!(a=h.n()).done;){var g=a.value;this.add(g)}}catch(m){h.e(m)}finally{h.f()}return!0}},{key:"remove",value:function(){throw new ze}},{key:"size",value:function(){return this.array.length}},{key:"isEmpty",value:function(){return this.array.length===0}},{key:"toArray",value:function(){return this.array.slice()}},{key:"iterator",value:function(){return new bg(this.array)}}])}(Mg),bg=function(){return c(function u(i){o(this,u),this.array=i,this.position=0},[{key:"next",value:function(){if(this.position===this.array.length)throw new Wn;return this.array[this.position++]}},{key:"hasNext",value:function(){return this.position<this.array.length}},{key:"remove",value:function(){throw new ze}}])}(),pe=function(u){function i(){var s;return o(this,i),s=r(this,i),i.constructor_.apply(s,arguments),s}return y(i,u),c(i,[{key:"computeEnvelopeInternal",value:function(){for(var s=new Dt,a=0;a<this._geometries.length;a++)s.expandToInclude(this._geometries[a].getEnvelopeInternal());return s}},{key:"getGeometryN",value:function(s){return this._geometries[s]}},{key:"getCoordinates",value:function(){for(var s=new Array(this.getNumPoints()).fill(null),a=-1,h=0;h<this._geometries.length;h++)for(var g=this._geometries[h].getCoordinates(),m=0;m<g.length;m++)s[++a]=g[m];return s}},{key:"getArea",value:function(){for(var s=0,a=0;a<this._geometries.length;a++)s+=this._geometries[a].getArea();return s}},{key:"copyInternal",value:function(){for(var s=new Array(this._geometries.length).fill(null),a=0;a<s.length;a++)s[a]=this._geometries[a].copy();return new i(s,this._factory)}},{key:"equalsExact",value:function(){if(arguments.length===2&&typeof arguments[1]=="number"&&arguments[0]instanceof at){var s=arguments[0],a=arguments[1];if(!this.isEquivalentClass(s))return!1;var h=s;if(this._geometries.length!==h._geometries.length)return!1;for(var g=0;g<this._geometries.length;g++)if(!this._geometries[g].equalsExact(h._geometries[g],a))return!1;return!0}return I(i,"equalsExact",this,1).apply(this,arguments)}},{key:"normalize",value:function(){for(var s=0;s<this._geometries.length;s++)this._geometries[s].normalize();Rn.sort(this._geometries)}},{key:"getCoordinate",value:function(){return this.isEmpty()?null:this._geometries[0].getCoordinate()}},{key:"getBoundaryDimension",value:function(){for(var s=H.FALSE,a=0;a<this._geometries.length;a++)s=Math.max(s,this._geometries[a].getBoundaryDimension());return s}},{key:"reverseInternal",value:function(){for(var s=this._geometries.length,a=new ht(s),h=0;h<s;h++)a.add(this._geometries[h].reverse());return this.getFactory().buildGeometry(a)}},{key:"getTypeCode",value:function(){return at.TYPECODE_GEOMETRYCOLLECTION}},{key:"getDimension",value:function(){for(var s=H.FALSE,a=0;a<this._geometries.length;a++)s=Math.max(s,this._geometries[a].getDimension());return s}},{key:"getLength",value:function(){for(var s=0,a=0;a<this._geometries.length;a++)s+=this._geometries[a].getLength();return s}},{key:"getNumPoints",value:function(){for(var s=0,a=0;a<this._geometries.length;a++)s+=this._geometries[a].getNumPoints();return s}},{key:"getNumGeometries",value:function(){return this._geometries.length}},{key:"compareToSameClass",value:function(){if(arguments.length===1){var s=arguments[0],a=new Eu(Rn.asList(this._geometries)),h=new Eu(Rn.asList(s._geometries));return this.compare(a,h)}if(arguments.length===2){for(var g=arguments[1],m=arguments[0],_=this.getNumGeometries(),k=m.getNumGeometries(),b=0;b<_&&b<k;){var z=this.getGeometryN(b),q=m.getGeometryN(b),V=z.compareToSameClass(q,g);if(V!==0)return V;b++}return b<_?1:b<k?-1:0}}},{key:"apply",value:function(){if(pt(arguments[0],bi))for(var s=arguments[0],a=0;a<this._geometries.length;a++)this._geometries[a].apply(s);else if(pt(arguments[0],Si)){var h=arguments[0];if(this._geometries.length===0)return null;for(var g=0;g<this._geometries.length&&(this._geometries[g].apply(h),!h.isDone());g++);h.isGeometryChanged()&&this.geometryChanged()}else if(pt(arguments[0],Ni)){var m=arguments[0];m.filter(this);for(var _=0;_<this._geometries.length;_++)this._geometries[_].apply(m)}else if(pt(arguments[0],G)){var k=arguments[0];k.filter(this);for(var b=0;b<this._geometries.length;b++)this._geometries[b].apply(k)}}},{key:"getBoundary",value:function(){return at.checkNotGeometryCollection(this),ot.shouldNeverReachHere(),null}},{key:"getGeometryType",value:function(){return at.TYPENAME_GEOMETRYCOLLECTION}},{key:"isEmpty",value:function(){for(var s=0;s<this._geometries.length;s++)if(!this._geometries[s].isEmpty())return!1;return!0}}],[{key:"constructor_",value:function(){if(this._geometries=null,arguments.length!==0){if(arguments.length===2){var s=arguments[0],a=arguments[1];if(at.constructor_.call(this,a),s===null&&(s=[]),at.hasNullElements(s))throw new N("geometries must not contain null elements");this._geometries=s}}}}])}(at),vo=function(u){function i(){var s;return o(this,i),s=r(this,i),i.constructor_.apply(s,arguments),s}return y(i,u),c(i,[{key:"copyInternal",value:function(){for(var s=new Array(this._geometries.length).fill(null),a=0;a<s.length;a++)s[a]=this._geometries[a].copy();return new i(s,this._factory)}},{key:"isValid",value:function(){return!0}},{key:"equalsExact",value:function(){if(arguments.length===2&&typeof arguments[1]=="number"&&arguments[0]instanceof at){var s=arguments[0],a=arguments[1];return!!this.isEquivalentClass(s)&&I(i,"equalsExact",this,1).call(this,s,a)}return I(i,"equalsExact",this,1).apply(this,arguments)}},{key:"getCoordinate",value:function(){if(arguments.length===1&&Number.isInteger(arguments[0])){var s=arguments[0];return this._geometries[s].getCoordinate()}return I(i,"getCoordinate",this,1).apply(this,arguments)}},{key:"getBoundaryDimension",value:function(){return H.FALSE}},{key:"getTypeCode",value:function(){return at.TYPECODE_MULTIPOINT}},{key:"getDimension",value:function(){return 0}},{key:"getBoundary",value:function(){return this.getFactory().createGeometryCollection()}},{key:"getGeometryType",value:function(){return at.TYPENAME_MULTIPOINT}},{key:"interfaces_",get:function(){return[_u]}}],[{key:"constructor_",value:function(){var s=arguments[0],a=arguments[1];pe.constructor_.call(this,s,a)}}])}(pe),Nr=function(u){function i(){var s;return o(this,i),s=r(this,i),i.constructor_.apply(s,arguments),s}return y(i,u),c(i,[{key:"copyInternal",value:function(){return new i(this._points.copy(),this._factory)}},{key:"getBoundaryDimension",value:function(){return H.FALSE}},{key:"isClosed",value:function(){return!!this.isEmpty()||I(i,"isClosed",this,1).call(this)}},{key:"reverseInternal",value:function(){var s=this._points.copy();return Sn.reverse(s),this.getFactory().createLinearRing(s)}},{key:"getTypeCode",value:function(){return at.TYPECODE_LINEARRING}},{key:"validateConstruction",value:function(){if(!this.isEmpty()&&!I(i,"isClosed",this,1).call(this))throw new N("Points of LinearRing do not form a closed linestring");if(this.getCoordinateSequence().size()>=1&&this.getCoordinateSequence().size()<i.MINIMUM_VALID_SIZE)throw new N("Invalid number of points in LinearRing (found "+this.getCoordinateSequence().size()+" - must be 0 or >= 4)")}},{key:"getGeometryType",value:function(){return at.TYPENAME_LINEARRING}}],[{key:"constructor_",value:function(){var s=arguments[0],a=arguments[1];br.constructor_.call(this,s,a),this.validateConstruction()}}])}(br);Nr.MINIMUM_VALID_SIZE=4;var Cn=function(u){function i(){var s;return o(this,i),s=r(this,i),i.constructor_.apply(s,arguments),s}return y(i,u),c(i,[{key:"setOrdinate",value:function(s,a){switch(s){case i.X:this.x=a;break;case i.Y:this.y=a;break;default:throw new N("Invalid ordinate index: "+s)}}},{key:"getZ",value:function(){return U.NULL_ORDINATE}},{key:"getOrdinate",value:function(s){switch(s){case i.X:return this.x;case i.Y:return this.y}throw new N("Invalid ordinate index: "+s)}},{key:"setZ",value:function(s){throw new N("CoordinateXY dimension 2 does not support z-ordinate")}},{key:"copy",value:function(){return new i(this)}},{key:"toString",value:function(){return"("+this.x+", "+this.y+")"}},{key:"setCoordinate",value:function(s){this.x=s.x,this.y=s.y,this.z=s.getZ()}}],[{key:"constructor_",value:function(){if(arguments.length===0)U.constructor_.call(this);else if(arguments.length===1){if(arguments[0]instanceof i){var s=arguments[0];U.constructor_.call(this,s.x,s.y)}else if(arguments[0]instanceof U){var a=arguments[0];U.constructor_.call(this,a.x,a.y)}}else if(arguments.length===2){var h=arguments[0],g=arguments[1];U.constructor_.call(this,h,g,U.NULL_ORDINATE)}}}])}(U);Cn.X=0,Cn.Y=1,Cn.Z=-1,Cn.M=-1;var Pn=function(u){function i(){var s;return o(this,i),s=r(this,i),i.constructor_.apply(s,arguments),s}return y(i,u),c(i,[{key:"getM",value:function(){return this._m}},{key:"setOrdinate",value:function(s,a){switch(s){case i.X:this.x=a;break;case i.Y:this.y=a;break;case i.M:this._m=a;break;default:throw new N("Invalid ordinate index: "+s)}}},{key:"setM",value:function(s){this._m=s}},{key:"getZ",value:function(){return U.NULL_ORDINATE}},{key:"getOrdinate",value:function(s){switch(s){case i.X:return this.x;case i.Y:return this.y;case i.M:return this._m}throw new N("Invalid ordinate index: "+s)}},{key:"setZ",value:function(s){throw new N("CoordinateXY dimension 2 does not support z-ordinate")}},{key:"copy",value:function(){return new i(this)}},{key:"toString",value:function(){return"("+this.x+", "+this.y+" m="+this.getM()+")"}},{key:"setCoordinate",value:function(s){this.x=s.x,this.y=s.y,this.z=s.getZ(),this._m=s.getM()}}],[{key:"constructor_",value:function(){if(this._m=null,arguments.length===0)U.constructor_.call(this),this._m=0;else if(arguments.length===1){if(arguments[0]instanceof i){var s=arguments[0];U.constructor_.call(this,s.x,s.y),this._m=s._m}else if(arguments[0]instanceof U){var a=arguments[0];U.constructor_.call(this,a.x,a.y),this._m=this.getM()}}else if(arguments.length===3){var h=arguments[0],g=arguments[1],m=arguments[2];U.constructor_.call(this,h,g,U.NULL_ORDINATE),this._m=m}}}])}(U);Pn.X=0,Pn.Y=1,Pn.Z=-1,Pn.M=2;var yo=function(u){function i(){var s;return o(this,i),s=r(this,i),i.constructor_.apply(s,arguments),s}return y(i,u),c(i,[{key:"getM",value:function(){return this._m}},{key:"setOrdinate",value:function(s,a){switch(s){case U.X:this.x=a;break;case U.Y:this.y=a;break;case U.Z:this.z=a;break;case U.M:this._m=a;break;default:throw new N("Invalid ordinate index: "+s)}}},{key:"setM",value:function(s){this._m=s}},{key:"getOrdinate",value:function(s){switch(s){case U.X:return this.x;case U.Y:return this.y;case U.Z:return this.getZ();case U.M:return this.getM()}throw new N("Invalid ordinate index: "+s)}},{key:"copy",value:function(){return new i(this)}},{key:"toString",value:function(){return"("+this.x+", "+this.y+", "+this.getZ()+" m="+this.getM()+")"}},{key:"setCoordinate",value:function(s){this.x=s.x,this.y=s.y,this.z=s.getZ(),this._m=s.getM()}}],[{key:"constructor_",value:function(){if(this._m=null,arguments.length===0)U.constructor_.call(this),this._m=0;else if(arguments.length===1){if(arguments[0]instanceof i){var s=arguments[0];U.constructor_.call(this,s),this._m=s._m}else if(arguments[0]instanceof U){var a=arguments[0];U.constructor_.call(this,a),this._m=this.getM()}}else if(arguments.length===4){var h=arguments[0],g=arguments[1],m=arguments[2],_=arguments[3];U.constructor_.call(this,h,g,m),this._m=_}}}])}(U),Ci=function(){function u(){o(this,u)}return c(u,null,[{key:"measures",value:function(i){return i instanceof Cn?0:i instanceof Pn||i instanceof yo?1:0}},{key:"dimension",value:function(i){return i instanceof Cn?2:i instanceof Pn?3:i instanceof yo?4:3}},{key:"create",value:function(){if(arguments.length===1){var i=arguments[0];return u.create(i,0)}if(arguments.length===2){var s=arguments[0],a=arguments[1];return s===2?new Cn:s===3&&a===0?new U:s===3&&a===1?new Pn:s===4&&a===1?new yo:new U}}}])}(),Sr=function(u){function i(){var s;return o(this,i),s=r(this,i),i.constructor_.apply(s,arguments),s}return y(i,u),c(i,[{key:"getCoordinate",value:function(s){return this.get(s)}},{key:"addAll",value:function(){if(arguments.length===2&&typeof arguments[1]=="boolean"&&pt(arguments[0],Ee)){for(var s=arguments[1],a=!1,h=arguments[0].iterator();h.hasNext();)this.add(h.next(),s),a=!0;return a}return I(i,"addAll",this,1).apply(this,arguments)}},{key:"clone",value:function(){for(var s=I(i,"clone",this,1).call(this),a=0;a<this.size();a++)s.add(a,this.get(a).clone());return s}},{key:"toCoordinateArray",value:function(){if(arguments.length===0)return this.toArray(i.coordArrayType);if(arguments.length===1){if(arguments[0])return this.toArray(i.coordArrayType);for(var s=this.size(),a=new Array(s).fill(null),h=0;h<s;h++)a[h]=this.get(s-h-1);return a}}},{key:"add",value:function(){if(arguments.length===1){var s=arguments[0];return I(i,"add",this,1).call(this,s)}if(arguments.length===2){if(arguments[0]instanceof Array&&typeof arguments[1]=="boolean"){var a=arguments[0],h=arguments[1];return this.add(a,h,!0),!0}if(arguments[0]instanceof U&&typeof arguments[1]=="boolean"){var g=arguments[0];if(!arguments[1]&&this.size()>=1&&this.get(this.size()-1).equals2D(g))return null;I(i,"add",this,1).call(this,g)}else if(arguments[0]instanceof Object&&typeof arguments[1]=="boolean"){var m=arguments[0],_=arguments[1];return this.add(m,_),!0}}else if(arguments.length===3){if(typeof arguments[2]=="boolean"&&arguments[0]instanceof Array&&typeof arguments[1]=="boolean"){var k=arguments[0],b=arguments[1];if(arguments[2])for(var z=0;z<k.length;z++)this.add(k[z],b);else for(var q=k.length-1;q>=0;q--)this.add(k[q],b);return!0}if(typeof arguments[2]=="boolean"&&Number.isInteger(arguments[0])&&arguments[1]instanceof U){var V=arguments[0],K=arguments[1];if(!arguments[2]){var rt=this.size();if(rt>0&&(V>0&&this.get(V-1).equals2D(K)||V<rt&&this.get(V).equals2D(K)))return null}I(i,"add",this,1).call(this,V,K)}}else if(arguments.length===4){var lt=arguments[0],Nt=arguments[1],It=arguments[2],Ft=arguments[3],te=1;It>Ft&&(te=-1);for(var ee=It;ee!==Ft;ee+=te)this.add(lt[ee],Nt);return!0}}},{key:"closeRing",value:function(){if(this.size()>0){var s=this.get(0).copy();this.add(s,!1)}}}],[{key:"constructor_",value:function(){if(arguments.length!==0){if(arguments.length===1){var s=arguments[0];this.ensureCapacity(s.length),this.add(s,!0)}else if(arguments.length===2){var a=arguments[0],h=arguments[1];this.ensureCapacity(a.length),this.add(a,h)}}}}])}(ht);Sr.coordArrayType=new Array(0).fill(null);var Ht=function(){function u(){o(this,u)}return c(u,null,[{key:"isRing",value:function(i){return!(i.length<4)&&!!i[0].equals2D(i[i.length-1])}},{key:"ptNotInList",value:function(i,s){for(var a=0;a<i.length;a++){var h=i[a];if(u.indexOf(h,s)<0)return h}return null}},{key:"scroll",value:function(i,s){var a=u.indexOf(s,i);if(a<0)return null;var h=new Array(i.length).fill(null);ke.arraycopy(i,a,h,0,i.length-a),ke.arraycopy(i,0,h,i.length-a,a),ke.arraycopy(h,0,i,0,i.length)}},{key:"equals",value:function(){if(arguments.length===2){var i=arguments[0],s=arguments[1];if(i===s)return!0;if(i===null||s===null||i.length!==s.length)return!1;for(var a=0;a<i.length;a++)if(!i[a].equals(s[a]))return!1;return!0}if(arguments.length===3){var h=arguments[0],g=arguments[1],m=arguments[2];if(h===g)return!0;if(h===null||g===null||h.length!==g.length)return!1;for(var _=0;_<h.length;_++)if(m.compare(h[_],g[_])!==0)return!1;return!0}}},{key:"intersection",value:function(i,s){for(var a=new Sr,h=0;h<i.length;h++)s.intersects(i[h])&&a.add(i[h],!0);return a.toCoordinateArray()}},{key:"measures",value:function(i){if(i===null||i.length===0)return 0;var s,a=0,h=d(i);try{for(h.s();!(s=h.n()).done;){var g=s.value;a=Math.max(a,Ci.measures(g))}}catch(m){h.e(m)}finally{h.f()}return a}},{key:"hasRepeatedPoints",value:function(i){for(var s=1;s<i.length;s++)if(i[s-1].equals(i[s]))return!0;return!1}},{key:"removeRepeatedPoints",value:function(i){return u.hasRepeatedPoints(i)?new Sr(i,!1).toCoordinateArray():i}},{key:"reverse",value:function(i){for(var s=i.length-1,a=Math.trunc(s/2),h=0;h<=a;h++){var g=i[h];i[h]=i[s-h],i[s-h]=g}}},{key:"removeNull",value:function(i){for(var s=0,a=0;a<i.length;a++)i[a]!==null&&s++;var h=new Array(s).fill(null);if(s===0)return h;for(var g=0,m=0;m<i.length;m++)i[m]!==null&&(h[g++]=i[m]);return h}},{key:"copyDeep",value:function(){if(arguments.length===1){for(var i=arguments[0],s=new Array(i.length).fill(null),a=0;a<i.length;a++)s[a]=i[a].copy();return s}if(arguments.length===5)for(var h=arguments[0],g=arguments[1],m=arguments[2],_=arguments[3],k=arguments[4],b=0;b<k;b++)m[_+b]=h[g+b].copy()}},{key:"isEqualReversed",value:function(i,s){for(var a=0;a<i.length;a++){var h=i[a],g=s[i.length-a-1];if(h.compareTo(g)!==0)return!1}return!0}},{key:"envelope",value:function(i){for(var s=new Dt,a=0;a<i.length;a++)s.expandToInclude(i[a]);return s}},{key:"toCoordinateArray",value:function(i){return i.toArray(u.coordArrayType)}},{key:"dimension",value:function(i){if(i===null||i.length===0)return 3;var s,a=0,h=d(i);try{for(h.s();!(s=h.n()).done;){var g=s.value;a=Math.max(a,Ci.dimension(g))}}catch(m){h.e(m)}finally{h.f()}return a}},{key:"atLeastNCoordinatesOrNothing",value:function(i,s){return s.length>=i?s:[]}},{key:"indexOf",value:function(i,s){for(var a=0;a<s.length;a++)if(i.equals(s[a]))return a;return-1}},{key:"increasingDirection",value:function(i){for(var s=0;s<Math.trunc(i.length/2);s++){var a=i.length-1-s,h=i[s].compareTo(i[a]);if(h!==0)return h}return 1}},{key:"compare",value:function(i,s){for(var a=0;a<i.length&&a<s.length;){var h=i[a].compareTo(s[a]);if(h!==0)return h;a++}return a<s.length?-1:a<i.length?1:0}},{key:"minCoordinate",value:function(i){for(var s=null,a=0;a<i.length;a++)(s===null||s.compareTo(i[a])>0)&&(s=i[a]);return s}},{key:"extract",value:function(i,s,a){s=Mr.clamp(s,0,i.length);var h=(a=Mr.clamp(a,-1,i.length))-s+1;a<0&&(h=0),s>=i.length&&(h=0),a<s&&(h=0);var g=new Array(h).fill(null);if(h===0)return g;for(var m=0,_=s;_<=a;_++)g[m++]=i[_];return g}}])}(),Ng=function(){return c(function u(){o(this,u)},[{key:"compare",value:function(u,i){var s=u,a=i;return Ht.compare(s,a)}},{key:"interfaces_",get:function(){return[Ot]}}])}(),Sg=function(){return c(function u(){o(this,u)},[{key:"compare",value:function(u,i){var s=u,a=i;if(s.length<a.length)return-1;if(s.length>a.length)return 1;if(s.length===0)return 0;var h=Ht.compare(s,a);return Ht.isEqualReversed(s,a)?0:h}},{key:"OLDcompare",value:function(u,i){var s=u,a=i;if(s.length<a.length)return-1;if(s.length>a.length)return 1;if(s.length===0)return 0;for(var h=Ht.increasingDirection(s),g=Ht.increasingDirection(a),m=h>0?0:s.length-1,_=g>0?0:s.length-1,k=0;k<s.length;k++){var b=s[m].compareTo(a[_]);if(b!==0)return b;m+=h,_+=g}return 0}},{key:"interfaces_",get:function(){return[Ot]}}])}();Ht.ForwardComparator=Ng,Ht.BidirectionalComparator=Sg,Ht.coordArrayType=new Array(0).fill(null);var Pi=function(){return c(function u(i){o(this,u),this.str=i},[{key:"append",value:function(u){this.str+=u}},{key:"setCharAt",value:function(u,i){this.str=this.str.substr(0,u)+i+this.str.substr(u+1)}},{key:"toString",value:function(){return this.str}}])}(),Rr=function(){function u(){o(this,u),u.constructor_.apply(this,arguments)}return c(u,[{key:"getM",value:function(i){return this.hasM()?this._coordinates[i].getM():Z.NaN}},{key:"setOrdinate",value:function(i,s,a){switch(s){case bt.X:this._coordinates[i].x=a;break;case bt.Y:this._coordinates[i].y=a;break;default:this._coordinates[i].setOrdinate(s,a)}}},{key:"getZ",value:function(i){return this.hasZ()?this._coordinates[i].getZ():Z.NaN}},{key:"size",value:function(){return this._coordinates.length}},{key:"getOrdinate",value:function(i,s){switch(s){case bt.X:return this._coordinates[i].x;case bt.Y:return this._coordinates[i].y;default:return this._coordinates[i].getOrdinate(s)}}},{key:"getCoordinate",value:function(){if(arguments.length===1){var i=arguments[0];return this._coordinates[i]}if(arguments.length===2){var s=arguments[0];arguments[1].setCoordinate(this._coordinates[s])}}},{key:"getCoordinateCopy",value:function(i){var s=this.createCoordinate();return s.setCoordinate(this._coordinates[i]),s}},{key:"createCoordinate",value:function(){return Ci.create(this.getDimension(),this.getMeasures())}},{key:"getDimension",value:function(){return this._dimension}},{key:"getX",value:function(i){return this._coordinates[i].x}},{key:"getMeasures",value:function(){return this._measures}},{key:"expandEnvelope",value:function(i){for(var s=0;s<this._coordinates.length;s++)i.expandToInclude(this._coordinates[s]);return i}},{key:"copy",value:function(){for(var i=new Array(this.size()).fill(null),s=0;s<this._coordinates.length;s++){var a=this.createCoordinate();a.setCoordinate(this._coordinates[s]),i[s]=a}return new u(i,this._dimension,this._measures)}},{key:"toString",value:function(){if(this._coordinates.length>0){var i=new Pi(17*this._coordinates.length);i.append("("),i.append(this._coordinates[0]);for(var s=1;s<this._coordinates.length;s++)i.append(", "),i.append(this._coordinates[s]);return i.append(")"),i.toString()}return"()"}},{key:"getY",value:function(i){return this._coordinates[i].y}},{key:"toCoordinateArray",value:function(){return this._coordinates}},{key:"interfaces_",get:function(){return[bt,E]}}],[{key:"constructor_",value:function(){if(this._dimension=3,this._measures=0,this._coordinates=null,arguments.length===1){if(arguments[0]instanceof Array){var i=arguments[0];u.constructor_.call(this,i,Ht.dimension(i),Ht.measures(i))}else if(Number.isInteger(arguments[0])){var s=arguments[0];this._coordinates=new Array(s).fill(null);for(var a=0;a<s;a++)this._coordinates[a]=new U}else if(pt(arguments[0],bt)){var h=arguments[0];if(h===null)return this._coordinates=new Array(0).fill(null),null;this._dimension=h.getDimension(),this._measures=h.getMeasures(),this._coordinates=new Array(h.size()).fill(null);for(var g=0;g<this._coordinates.length;g++)this._coordinates[g]=h.getCoordinateCopy(g)}}else if(arguments.length===2){if(arguments[0]instanceof Array&&Number.isInteger(arguments[1])){var m=arguments[0],_=arguments[1];u.constructor_.call(this,m,_,Ht.measures(m))}else if(Number.isInteger(arguments[0])&&Number.isInteger(arguments[1])){var k=arguments[0],b=arguments[1];this._coordinates=new Array(k).fill(null),this._dimension=b;for(var z=0;z<k;z++)this._coordinates[z]=Ci.create(b)}}else if(arguments.length===3){if(Number.isInteger(arguments[2])&&arguments[0]instanceof Array&&Number.isInteger(arguments[1])){var q=arguments[0],V=arguments[1],K=arguments[2];this._dimension=V,this._measures=K,this._coordinates=q===null?new Array(0).fill(null):q}else if(Number.isInteger(arguments[2])&&Number.isInteger(arguments[0])&&Number.isInteger(arguments[1])){var rt=arguments[0],lt=arguments[1],Nt=arguments[2];this._coordinates=new Array(rt).fill(null),this._dimension=lt,this._measures=Nt;for(var It=0;It<rt;It++)this._coordinates[It]=this.createCoordinate()}}}}])}(),_o=function(){function u(){o(this,u)}return c(u,[{key:"readResolve",value:function(){return u.instance()}},{key:"create",value:function(){if(arguments.length===1){if(arguments[0]instanceof Array)return new Rr(arguments[0]);if(pt(arguments[0],bt))return new Rr(arguments[0])}else{if(arguments.length===2){var i=arguments[1];return i>3&&(i=3),i<2&&(i=2),new Rr(arguments[0],i)}if(arguments.length===3){var s=arguments[2],a=arguments[1]-s;return s>1&&(s=1),a>3&&(a=3),a<2&&(a=2),new Rr(arguments[0],a+s,s)}}}},{key:"interfaces_",get:function(){return[vu,E]}}],[{key:"instance",value:function(){return u.instanceObject}}])}();_o.instanceObject=new _o;var wo=function(u){function i(){var s;return o(this,i),s=r(this,i),i.constructor_.apply(s,arguments),s}return y(i,u),c(i,[{key:"copyInternal",value:function(){for(var s=new Array(this._geometries.length).fill(null),a=0;a<s.length;a++)s[a]=this._geometries[a].copy();return new i(s,this._factory)}},{key:"equalsExact",value:function(){if(arguments.length===2&&typeof arguments[1]=="number"&&arguments[0]instanceof at){var s=arguments[0],a=arguments[1];return!!this.isEquivalentClass(s)&&I(i,"equalsExact",this,1).call(this,s,a)}return I(i,"equalsExact",this,1).apply(this,arguments)}},{key:"getBoundaryDimension",value:function(){return 1}},{key:"getTypeCode",value:function(){return at.TYPECODE_MULTIPOLYGON}},{key:"getDimension",value:function(){return 2}},{key:"getBoundary",value:function(){if(this.isEmpty())return this.getFactory().createMultiLineString();for(var s=new ht,a=0;a<this._geometries.length;a++)for(var h=this._geometries[a].getBoundary(),g=0;g<h.getNumGeometries();g++)s.add(h.getGeometryN(g));var m=new Array(s.size()).fill(null);return this.getFactory().createMultiLineString(s.toArray(m))}},{key:"getGeometryType",value:function(){return at.TYPENAME_MULTIPOLYGON}},{key:"interfaces_",get:function(){return[xu]}}],[{key:"constructor_",value:function(){var s=arguments[0],a=arguments[1];pe.constructor_.call(this,s,a)}}])}(pe),ku=function(){return c(function u(){o(this,u)},[{key:"get",value:function(){}},{key:"put",value:function(){}},{key:"size",value:function(){}},{key:"values",value:function(){}},{key:"entrySet",value:function(){}}])}(),Rg=function(u){function i(){var s;return o(this,i),(s=r(this,i)).map=new Map,s}return y(i,u),c(i,[{key:"get",value:function(s){return this.map.get(s)||null}},{key:"put",value:function(s,a){return this.map.set(s,a),a}},{key:"values",value:function(){for(var s=new ht,a=this.map.values(),h=a.next();!h.done;)s.add(h.value),h=a.next();return s}},{key:"entrySet",value:function(){var s=new co;return this.map.entries().forEach(function(a){return s.add(a)}),s}},{key:"size",value:function(){return this.map.size()}}])}(ku),Pe=function(){function u(){o(this,u),u.constructor_.apply(this,arguments)}return c(u,[{key:"equals",value:function(i){if(!(i instanceof u))return!1;var s=i;return this._modelType===s._modelType&&this._scale===s._scale}},{key:"compareTo",value:function(i){var s=i,a=this.getMaximumSignificantDigits(),h=s.getMaximumSignificantDigits();return Mi.compare(a,h)}},{key:"getScale",value:function(){return this._scale}},{key:"isFloating",value:function(){return this._modelType===u.FLOATING||this._modelType===u.FLOATING_SINGLE}},{key:"getType",value:function(){return this._modelType}},{key:"toString",value:function(){var i="UNKNOWN";return this._modelType===u.FLOATING?i="Floating":this._modelType===u.FLOATING_SINGLE?i="Floating-Single":this._modelType===u.FIXED&&(i="Fixed (Scale="+this.getScale()+")"),i}},{key:"makePrecise",value:function(){if(typeof arguments[0]=="number"){var i=arguments[0];return Z.isNaN(i)||this._modelType===u.FLOATING_SINGLE?i:this._modelType===u.FIXED?Math.round(i*this._scale)/this._scale:i}if(arguments[0]instanceof U){var s=arguments[0];if(this._modelType===u.FLOATING)return null;s.x=this.makePrecise(s.x),s.y=this.makePrecise(s.y)}}},{key:"getMaximumSignificantDigits",value:function(){var i=16;return this._modelType===u.FLOATING?i=16:this._modelType===u.FLOATING_SINGLE?i=6:this._modelType===u.FIXED&&(i=1+Math.trunc(Math.ceil(Math.log(this.getScale())/Math.log(10)))),i}},{key:"setScale",value:function(i){this._scale=Math.abs(i)}},{key:"interfaces_",get:function(){return[E,A]}}],[{key:"constructor_",value:function(){if(this._modelType=null,this._scale=null,arguments.length===0)this._modelType=u.FLOATING;else if(arguments.length===1){if(arguments[0]instanceof Xn){var i=arguments[0];this._modelType=i,i===u.FIXED&&this.setScale(1)}else if(typeof arguments[0]=="number"){var s=arguments[0];this._modelType=u.FIXED,this.setScale(s)}else if(arguments[0]instanceof u){var a=arguments[0];this._modelType=a._modelType,this._scale=a._scale}}}},{key:"mostPrecise",value:function(i,s){return i.compareTo(s)>=0?i:s}}])}(),Xn=function(){function u(){o(this,u),u.constructor_.apply(this,arguments)}return c(u,[{key:"readResolve",value:function(){return u.nameToTypeMap.get(this._name)}},{key:"toString",value:function(){return this._name}},{key:"interfaces_",get:function(){return[E]}}],[{key:"constructor_",value:function(){this._name=null;var i=arguments[0];this._name=i,u.nameToTypeMap.put(i,this)}}])}();Xn.nameToTypeMap=new Rg,Pe.Type=Xn,Pe.FIXED=new Xn("FIXED"),Pe.FLOATING=new Xn("FLOATING"),Pe.FLOATING_SINGLE=new Xn("FLOATING SINGLE"),Pe.maximumPreciseValue=9007199254740992;var xo=function(u){function i(){var s;return o(this,i),s=r(this,i),i.constructor_.apply(s,arguments),s}return y(i,u),c(i,[{key:"copyInternal",value:function(){for(var s=new Array(this._geometries.length).fill(null),a=0;a<s.length;a++)s[a]=this._geometries[a].copy();return new i(s,this._factory)}},{key:"equalsExact",value:function(){if(arguments.length===2&&typeof arguments[1]=="number"&&arguments[0]instanceof at){var s=arguments[0],a=arguments[1];return!!this.isEquivalentClass(s)&&I(i,"equalsExact",this,1).call(this,s,a)}return I(i,"equalsExact",this,1).apply(this,arguments)}},{key:"getBoundaryDimension",value:function(){return this.isClosed()?H.FALSE:0}},{key:"isClosed",value:function(){if(this.isEmpty())return!1;for(var s=0;s<this._geometries.length;s++)if(!this._geometries[s].isClosed())return!1;return!0}},{key:"getTypeCode",value:function(){return at.TYPECODE_MULTILINESTRING}},{key:"getDimension",value:function(){return 1}},{key:"getBoundary",value:function(){throw new ze}},{key:"getGeometryType",value:function(){return at.TYPENAME_MULTILINESTRING}},{key:"interfaces_",get:function(){return[yu]}}],[{key:"constructor_",value:function(){var s=arguments[0],a=arguments[1];pe.constructor_.call(this,s,a)}}])}(pe),Zn=function(){function u(){o(this,u),u.constructor_.apply(this,arguments)}return c(u,[{key:"createEmpty",value:function(i){switch(i){case-1:return this.createGeometryCollection();case 0:return this.createPoint();case 1:return this.createLineString();case 2:return this.createPolygon();default:throw new N("Invalid dimension: "+i)}}},{key:"toGeometry",value:function(i){return i.isNull()?this.createPoint():i.getMinX()===i.getMaxX()&&i.getMinY()===i.getMaxY()?this.createPoint(new U(i.getMinX(),i.getMinY())):i.getMinX()===i.getMaxX()||i.getMinY()===i.getMaxY()?this.createLineString([new U(i.getMinX(),i.getMinY()),new U(i.getMaxX(),i.getMaxY())]):this.createPolygon(this.createLinearRing([new U(i.getMinX(),i.getMinY()),new U(i.getMinX(),i.getMaxY()),new U(i.getMaxX(),i.getMaxY()),new U(i.getMaxX(),i.getMinY()),new U(i.getMinX(),i.getMinY())]),null)}},{key:"createLineString",value:function(){if(arguments.length===0)return this.createLineString(this.getCoordinateSequenceFactory().create([]));if(arguments.length===1){if(arguments[0]instanceof Array){var i=arguments[0];return this.createLineString(i!==null?this.getCoordinateSequenceFactory().create(i):null)}if(pt(arguments[0],bt))return new br(arguments[0],this)}}},{key:"createMultiLineString",value:function(){return arguments.length===0?new xo(null,this):arguments.length===1?new xo(arguments[0],this):void 0}},{key:"buildGeometry",value:function(i){for(var s=null,a=!1,h=!1,g=i.iterator();g.hasNext();){var m=g.next(),_=m.getTypeCode();s===null&&(s=_),_!==s&&(a=!0),m instanceof pe&&(h=!0)}if(s===null)return this.createGeometryCollection();if(a||h)return this.createGeometryCollection(u.toGeometryArray(i));var k=i.iterator().next();if(i.size()>1){if(k instanceof Ri)return this.createMultiPolygon(u.toPolygonArray(i));if(k instanceof br)return this.createMultiLineString(u.toLineStringArray(i));if(k instanceof mo)return this.createMultiPoint(u.toPointArray(i));ot.shouldNeverReachHere("Unhandled geometry type: "+k.getGeometryType())}return k}},{key:"createMultiPointFromCoords",value:function(i){return this.createMultiPoint(i!==null?this.getCoordinateSequenceFactory().create(i):null)}},{key:"createPoint",value:function(){if(arguments.length===0)return this.createPoint(this.getCoordinateSequenceFactory().create([]));if(arguments.length===1){if(arguments[0]instanceof U){var i=arguments[0];return this.createPoint(i!==null?this.getCoordinateSequenceFactory().create([i]):null)}if(pt(arguments[0],bt))return new mo(arguments[0],this)}}},{key:"getCoordinateSequenceFactory",value:function(){return this._coordinateSequenceFactory}},{key:"createPolygon",value:function(){if(arguments.length===0)return this.createPolygon(null,null);if(arguments.length===1){if(pt(arguments[0],bt)){var i=arguments[0];return this.createPolygon(this.createLinearRing(i))}if(arguments[0]instanceof Array){var s=arguments[0];return this.createPolygon(this.createLinearRing(s))}if(arguments[0]instanceof Nr){var a=arguments[0];return this.createPolygon(a,null)}}else if(arguments.length===2)return new Ri(arguments[0],arguments[1],this)}},{key:"getSRID",value:function(){return this._SRID}},{key:"createGeometryCollection",value:function(){return arguments.length===0?new pe(null,this):arguments.length===1?new pe(arguments[0],this):void 0}},{key:"getPrecisionModel",value:function(){return this._precisionModel}},{key:"createLinearRing",value:function(){if(arguments.length===0)return this.createLinearRing(this.getCoordinateSequenceFactory().create([]));if(arguments.length===1){if(arguments[0]instanceof Array){var i=arguments[0];return this.createLinearRing(i!==null?this.getCoordinateSequenceFactory().create(i):null)}if(pt(arguments[0],bt))return new Nr(arguments[0],this)}}},{key:"createMultiPolygon",value:function(){return arguments.length===0?new wo(null,this):arguments.length===1?new wo(arguments[0],this):void 0}},{key:"createMultiPoint",value:function(){if(arguments.length===0)return new vo(null,this);if(arguments.length===1){if(arguments[0]instanceof Array)return new vo(arguments[0],this);if(pt(arguments[0],bt)){var i=arguments[0];if(i===null)return this.createMultiPoint(new Array(0).fill(null));for(var s=new Array(i.size()).fill(null),a=0;a<i.size();a++){var h=this.getCoordinateSequenceFactory().create(1,i.getDimension(),i.getMeasures());Sn.copy(i,a,h,0,1),s[a]=this.createPoint(h)}return this.createMultiPoint(s)}}}},{key:"interfaces_",get:function(){return[E]}}],[{key:"constructor_",value:function(){if(this._precisionModel=null,this._coordinateSequenceFactory=null,this._SRID=null,arguments.length===0)u.constructor_.call(this,new Pe,0);else if(arguments.length===1){if(pt(arguments[0],vu)){var i=arguments[0];u.constructor_.call(this,new Pe,0,i)}else if(arguments[0]instanceof Pe){var s=arguments[0];u.constructor_.call(this,s,0,u.getDefaultCoordinateSequenceFactory())}}else if(arguments.length===2){var a=arguments[0],h=arguments[1];u.constructor_.call(this,a,h,u.getDefaultCoordinateSequenceFactory())}else if(arguments.length===3){var g=arguments[0],m=arguments[1],_=arguments[2];this._precisionModel=g,this._coordinateSequenceFactory=_,this._SRID=m}}},{key:"toMultiPolygonArray",value:function(i){var s=new Array(i.size()).fill(null);return i.toArray(s)}},{key:"toGeometryArray",value:function(i){if(i===null)return null;var s=new Array(i.size()).fill(null);return i.toArray(s)}},{key:"getDefaultCoordinateSequenceFactory",value:function(){return _o.instance()}},{key:"toMultiLineStringArray",value:function(i){var s=new Array(i.size()).fill(null);return i.toArray(s)}},{key:"toLineStringArray",value:function(i){var s=new Array(i.size()).fill(null);return i.toArray(s)}},{key:"toMultiPointArray",value:function(i){var s=new Array(i.size()).fill(null);return i.toArray(s)}},{key:"toLinearRingArray",value:function(i){var s=new Array(i.size()).fill(null);return i.toArray(s)}},{key:"toPointArray",value:function(i){var s=new Array(i.size()).fill(null);return i.toArray(s)}},{key:"toPolygonArray",value:function(i){var s=new Array(i.size()).fill(null);return i.toArray(s)}},{key:"createPointFromInternalCoord",value:function(i,s){return s.getPrecisionModel().makePrecise(i),s.getFactory().createPoint(i)}}])}(),Eo="XY",Cg="XYZ",Pg="XYM",Lg="XYZM",Iu={POINT:"Point",LINE_STRING:"LineString",LINEAR_RING:"LinearRing",POLYGON:"Polygon",MULTI_POINT:"MultiPoint",MULTI_LINE_STRING:"MultiLineString",MULTI_POLYGON:"MultiPolygon",GEOMETRY_COLLECTION:"GeometryCollection",CIRCLE:"Circle"},Tu="EMPTY",Li=1,Je=2,pn=3,Mu=4,Hn=5,Ag=6;for(var Og in Iu)Iu[Og].toUpperCase();var Dg=function(){return c(function u(i){o(this,u),this.wkt=i,this.index_=-1},[{key:"isAlpha_",value:function(u){return u>="a"&&u<="z"||u>="A"&&u<="Z"}},{key:"isNumeric_",value:function(u,i){return u>="0"&&u<="9"||u=="."&&!(i!==void 0&&i)}},{key:"isWhiteSpace_",value:function(u){return u==" "||u=="	"||u=="\r"||u==`
`}},{key:"nextChar_",value:function(){return this.wkt.charAt(++this.index_)}},{key:"nextToken",value:function(){var u,i=this.nextChar_(),s=this.index_,a=i;if(i=="(")u=Je;else if(i==",")u=Hn;else if(i==")")u=pn;else if(this.isNumeric_(i)||i=="-")u=Mu,a=this.readNumber_();else if(this.isAlpha_(i))u=Li,a=this.readText_();else{if(this.isWhiteSpace_(i))return this.nextToken();if(i!=="")throw new Error("Unexpected character: "+i);u=Ag}return{position:s,value:a,type:u}}},{key:"readNumber_",value:function(){var u,i=this.index_,s=!1,a=!1;do u=="."?s=!0:u!="e"&&u!="E"||(a=!0),u=this.nextChar_();while(this.isNumeric_(u,s)||!a&&(u=="e"||u=="E")||a&&(u=="-"||u=="+"));return parseFloat(this.wkt.substring(i,this.index_--))}},{key:"readText_",value:function(){var u,i=this.index_;do u=this.nextChar_();while(this.isAlpha_(u));return this.wkt.substring(i,this.index_--).toUpperCase()}}])}(),Fg=function(){return c(function u(i,s){o(this,u),this.lexer_=i,this.token_,this.layout_=Eo,this.factory=s},[{key:"consume_",value:function(){this.token_=this.lexer_.nextToken()}},{key:"isTokenType",value:function(u){return this.token_.type==u}},{key:"match",value:function(u){var i=this.isTokenType(u);return i&&this.consume_(),i}},{key:"parse",value:function(){return this.consume_(),this.parseGeometry_()}},{key:"parseGeometryLayout_",value:function(){var u=Eo,i=this.token_;if(this.isTokenType(Li)){var s=i.value;s==="Z"?u=Cg:s==="M"?u=Pg:s==="ZM"&&(u=Lg),u!==Eo&&this.consume_()}return u}},{key:"parseGeometryCollectionText_",value:function(){if(this.match(Je)){var u=[];do u.push(this.parseGeometry_());while(this.match(Hn));if(this.match(pn))return u}else if(this.isEmptyGeometry_())return[];throw new Error(this.formatErrorMessage_())}},{key:"parsePointText_",value:function(){if(this.match(Je)){var u=this.parsePoint_();if(this.match(pn))return u}else if(this.isEmptyGeometry_())return null;throw new Error(this.formatErrorMessage_())}},{key:"parseLineStringText_",value:function(){if(this.match(Je)){var u=this.parsePointList_();if(this.match(pn))return u}else if(this.isEmptyGeometry_())return[];throw new Error(this.formatErrorMessage_())}},{key:"parsePolygonText_",value:function(){if(this.match(Je)){var u=this.parseLineStringTextList_();if(this.match(pn))return u}else if(this.isEmptyGeometry_())return[];throw new Error(this.formatErrorMessage_())}},{key:"parseMultiPointText_",value:function(){var u;if(this.match(Je)){if(u=this.token_.type==Je?this.parsePointTextList_():this.parsePointList_(),this.match(pn))return u}else if(this.isEmptyGeometry_())return[];throw new Error(this.formatErrorMessage_())}},{key:"parseMultiLineStringText_",value:function(){if(this.match(Je)){var u=this.parseLineStringTextList_();if(this.match(pn))return u}else if(this.isEmptyGeometry_())return[];throw new Error(this.formatErrorMessage_())}},{key:"parseMultiPolygonText_",value:function(){if(this.match(Je)){var u=this.parsePolygonTextList_();if(this.match(pn))return u}else if(this.isEmptyGeometry_())return[];throw new Error(this.formatErrorMessage_())}},{key:"parsePoint_",value:function(){for(var u=[],i=this.layout_.length,s=0;s<i;++s){var a=this.token_;if(!this.match(Mu))break;u.push(a.value)}if(u.length==i)return u;throw new Error(this.formatErrorMessage_())}},{key:"parsePointList_",value:function(){for(var u=[this.parsePoint_()];this.match(Hn);)u.push(this.parsePoint_());return u}},{key:"parsePointTextList_",value:function(){for(var u=[this.parsePointText_()];this.match(Hn);)u.push(this.parsePointText_());return u}},{key:"parseLineStringTextList_",value:function(){for(var u=[this.parseLineStringText_()];this.match(Hn);)u.push(this.parseLineStringText_());return u}},{key:"parsePolygonTextList_",value:function(){for(var u=[this.parsePolygonText_()];this.match(Hn);)u.push(this.parsePolygonText_());return u}},{key:"isEmptyGeometry_",value:function(){var u=this.isTokenType(Li)&&this.token_.value==Tu;return u&&this.consume_(),u}},{key:"formatErrorMessage_",value:function(){return"Unexpected `"+this.token_.value+"` at position "+this.token_.position+" in `"+this.lexer_.wkt+"`"}},{key:"parseGeometry_",value:function(){var u=this.factory,i=function(lt){return l(U,O(lt))},s=function(lt){var Nt=lt.map(function(It){return u.createLinearRing(It.map(i))});return Nt.length>1?u.createPolygon(Nt[0],Nt.slice(1)):u.createPolygon(Nt[0])},a=this.token_;if(this.match(Li)){var h=a.value;if(this.layout_=this.parseGeometryLayout_(),h=="GEOMETRYCOLLECTION"){var g=this.parseGeometryCollectionText_();return u.createGeometryCollection(g)}switch(h){case"POINT":var m=this.parsePointText_();return m?u.createPoint(l(U,O(m))):u.createPoint();case"LINESTRING":var _=this.parseLineStringText_().map(i);return u.createLineString(_);case"LINEARRING":var k=this.parseLineStringText_().map(i);return u.createLinearRing(k);case"POLYGON":var b=this.parsePolygonText_();return b&&b.length!==0?s(b):u.createPolygon();case"MULTIPOINT":var z=this.parseMultiPointText_();if(!z||z.length===0)return u.createMultiPoint();var q=z.map(i).map(function(lt){return u.createPoint(lt)});return u.createMultiPoint(q);case"MULTILINESTRING":var V=this.parseMultiLineStringText_().map(function(lt){return u.createLineString(lt.map(i))});return u.createMultiLineString(V);case"MULTIPOLYGON":var K=this.parseMultiPolygonText_();if(!K||K.length===0)return u.createMultiPolygon();var rt=K.map(s);return u.createMultiPolygon(rt);default:throw new Error("Invalid geometry type: "+h)}}throw new Error(this.formatErrorMessage_())}}])}();function bu(u){if(u.isEmpty())return"";var i=u.getCoordinate(),s=[i.x,i.y];return i.z===void 0||Number.isNaN(i.z)||s.push(i.z),i.m===void 0||Number.isNaN(i.m)||s.push(i.m),s.join(" ")}function Cr(u){for(var i=u.getCoordinates().map(function(g){var m=[g.x,g.y];return g.z===void 0||Number.isNaN(g.z)||m.push(g.z),g.m===void 0||Number.isNaN(g.m)||m.push(g.m),m}),s=[],a=0,h=i.length;a<h;++a)s.push(i[a].join(" "));return s.join(", ")}function Nu(u){var i=[];i.push("("+Cr(u.getExteriorRing())+")");for(var s=0,a=u.getNumInteriorRing();s<a;++s)i.push("("+Cr(u.getInteriorRingN(s))+")");return i.join(", ")}var Gg={Point:bu,LineString:Cr,LinearRing:Cr,Polygon:Nu,MultiPoint:function(u){for(var i=[],s=0,a=u.getNumGeometries();s<a;++s)i.push("("+bu(u.getGeometryN(s))+")");return i.join(", ")},MultiLineString:function(u){for(var i=[],s=0,a=u.getNumGeometries();s<a;++s)i.push("("+Cr(u.getGeometryN(s))+")");return i.join(", ")},MultiPolygon:function(u){for(var i=[],s=0,a=u.getNumGeometries();s<a;++s)i.push("("+Nu(u.getGeometryN(s))+")");return i.join(", ")},GeometryCollection:function(u){for(var i=[],s=0,a=u.getNumGeometries();s<a;++s)i.push(Su(u.getGeometryN(s)));return i.join(", ")}};function Su(u){var i=u.getGeometryType(),s=Gg[i];i=i.toUpperCase();var a=function(h){var g="";if(h.isEmpty())return g;var m=h.getCoordinate();return m.z===void 0||Number.isNaN(m.z)||(g+="Z"),m.m===void 0||Number.isNaN(m.m)||(g+="M"),g}(u);return a.length>0&&(i+=" "+a),u.isEmpty()?i+" "+Tu:i+" ("+s(u)+")"}var Bg=function(){return c(function u(i){o(this,u),this.geometryFactory=i||new Zn,this.precisionModel=this.geometryFactory.getPrecisionModel()},[{key:"read",value:function(u){var i=new Dg(u);return new Fg(i,this.geometryFactory).parse()}},{key:"write",value:function(u){return Su(u)}}])}(),ko=function(){return c(function u(i){o(this,u),this.parser=new Bg(i)},[{key:"write",value:function(u){return this.parser.write(u)}}],[{key:"toLineString",value:function(u,i){if(arguments.length!==2)throw new Error("Not implemented");return"LINESTRING ( "+u.x+" "+u.y+", "+i.x+" "+i.y+" )"}}])}(),zt=function(){function u(){o(this,u),u.constructor_.apply(this,arguments)}return c(u,[{key:"getIndexAlongSegment",value:function(i,s){return this.computeIntLineIndex(),this._intLineIndex[i][s]}},{key:"getTopologySummary",value:function(){var i=new Pi;return this.isEndPoint()&&i.append(" endpoint"),this._isProper&&i.append(" proper"),this.isCollinear()&&i.append(" collinear"),i.toString()}},{key:"computeIntersection",value:function(i,s,a,h){this._inputLines[0][0]=i,this._inputLines[0][1]=s,this._inputLines[1][0]=a,this._inputLines[1][1]=h,this._result=this.computeIntersect(i,s,a,h)}},{key:"getIntersectionNum",value:function(){return this._result}},{key:"computeIntLineIndex",value:function(){if(arguments.length===0)this._intLineIndex===null&&(this._intLineIndex=Array(2).fill().map(function(){return Array(2)}),this.computeIntLineIndex(0),this.computeIntLineIndex(1));else if(arguments.length===1){var i=arguments[0];this.getEdgeDistance(i,0)>this.getEdgeDistance(i,1)?(this._intLineIndex[i][0]=0,this._intLineIndex[i][1]=1):(this._intLineIndex[i][0]=1,this._intLineIndex[i][1]=0)}}},{key:"isProper",value:function(){return this.hasIntersection()&&this._isProper}},{key:"setPrecisionModel",value:function(i){this._precisionModel=i}},{key:"isInteriorIntersection",value:function(){if(arguments.length===0)return!!this.isInteriorIntersection(0)||!!this.isInteriorIntersection(1);if(arguments.length===1){for(var i=arguments[0],s=0;s<this._result;s++)if(!this._intPt[s].equals2D(this._inputLines[i][0])&&!this._intPt[s].equals2D(this._inputLines[i][1]))return!0;return!1}}},{key:"getIntersection",value:function(i){return this._intPt[i]}},{key:"isEndPoint",value:function(){return this.hasIntersection()&&!this._isProper}},{key:"hasIntersection",value:function(){return this._result!==u.NO_INTERSECTION}},{key:"getEdgeDistance",value:function(i,s){return u.computeEdgeDistance(this._intPt[s],this._inputLines[i][0],this._inputLines[i][1])}},{key:"isCollinear",value:function(){return this._result===u.COLLINEAR_INTERSECTION}},{key:"toString",value:function(){return ko.toLineString(this._inputLines[0][0],this._inputLines[0][1])+" - "+ko.toLineString(this._inputLines[1][0],this._inputLines[1][1])+this.getTopologySummary()}},{key:"getEndpoint",value:function(i,s){return this._inputLines[i][s]}},{key:"isIntersection",value:function(i){for(var s=0;s<this._result;s++)if(this._intPt[s].equals2D(i))return!0;return!1}},{key:"getIntersectionAlongSegment",value:function(i,s){return this.computeIntLineIndex(),this._intPt[this._intLineIndex[i][s]]}}],[{key:"constructor_",value:function(){this._result=null,this._inputLines=Array(2).fill().map(function(){return Array(2)}),this._intPt=new Array(2).fill(null),this._intLineIndex=null,this._isProper=null,this._pa=null,this._pb=null,this._precisionModel=null,this._intPt[0]=new U,this._intPt[1]=new U,this._pa=this._intPt[0],this._pb=this._intPt[1],this._result=0}},{key:"computeEdgeDistance",value:function(i,s,a){var h=Math.abs(a.x-s.x),g=Math.abs(a.y-s.y),m=-1;if(i.equals(s))m=0;else if(i.equals(a))m=h>g?h:g;else{var _=Math.abs(i.x-s.x),k=Math.abs(i.y-s.y);(m=h>g?_:k)!==0||i.equals(s)||(m=Math.max(_,k))}return ot.isTrue(!(m===0&&!i.equals(s)),"Bad distance calculation"),m}},{key:"nonRobustComputeEdgeDistance",value:function(i,s,a){var h=i.x-s.x,g=i.y-s.y,m=Math.sqrt(h*h+g*g);return ot.isTrue(!(m===0&&!i.equals(s)),"Invalid distance calculation"),m}}])}();zt.DONT_INTERSECT=0,zt.DO_INTERSECT=1,zt.COLLINEAR=2,zt.NO_INTERSECTION=0,zt.POINT_INTERSECTION=1,zt.COLLINEAR_INTERSECTION=2;var Ln=function(u){function i(){return o(this,i),r(this,i)}return y(i,u),c(i,[{key:"isInSegmentEnvelopes",value:function(s){var a=new Dt(this._inputLines[0][0],this._inputLines[0][1]),h=new Dt(this._inputLines[1][0],this._inputLines[1][1]);return a.contains(s)&&h.contains(s)}},{key:"computeIntersection",value:function(){if(arguments.length!==3)return I(i,"computeIntersection",this,1).apply(this,arguments);var s=arguments[0],a=arguments[1],h=arguments[2];if(this._isProper=!1,Dt.intersects(a,h,s)&&dt.index(a,h,s)===0&&dt.index(h,a,s)===0)return this._isProper=!0,(s.equals(a)||s.equals(h))&&(this._isProper=!1),this._result=zt.POINT_INTERSECTION,null;this._result=zt.NO_INTERSECTION}},{key:"intersection",value:function(s,a,h,g){var m=this.intersectionSafe(s,a,h,g);return this.isInSegmentEnvelopes(m)||(m=new U(i.nearestEndpoint(s,a,h,g))),this._precisionModel!==null&&this._precisionModel.makePrecise(m),m}},{key:"checkDD",value:function(s,a,h,g,m){var _=go.intersection(s,a,h,g),k=this.isInSegmentEnvelopes(_);ke.out.println("DD in env = "+k+"  --------------------- "+_),m.distance(_)>1e-4&&ke.out.println("Distance = "+m.distance(_))}},{key:"intersectionSafe",value:function(s,a,h,g){var m=po.intersection(s,a,h,g);return m===null&&(m=i.nearestEndpoint(s,a,h,g)),m}},{key:"computeCollinearIntersection",value:function(s,a,h,g){var m=Dt.intersects(s,a,h),_=Dt.intersects(s,a,g),k=Dt.intersects(h,g,s),b=Dt.intersects(h,g,a);return m&&_?(this._intPt[0]=h,this._intPt[1]=g,zt.COLLINEAR_INTERSECTION):k&&b?(this._intPt[0]=s,this._intPt[1]=a,zt.COLLINEAR_INTERSECTION):m&&k?(this._intPt[0]=h,this._intPt[1]=s,!h.equals(s)||_||b?zt.COLLINEAR_INTERSECTION:zt.POINT_INTERSECTION):m&&b?(this._intPt[0]=h,this._intPt[1]=a,!h.equals(a)||_||k?zt.COLLINEAR_INTERSECTION:zt.POINT_INTERSECTION):_&&k?(this._intPt[0]=g,this._intPt[1]=s,!g.equals(s)||m||b?zt.COLLINEAR_INTERSECTION:zt.POINT_INTERSECTION):_&&b?(this._intPt[0]=g,this._intPt[1]=a,!g.equals(a)||m||k?zt.COLLINEAR_INTERSECTION:zt.POINT_INTERSECTION):zt.NO_INTERSECTION}},{key:"computeIntersect",value:function(s,a,h,g){if(this._isProper=!1,!Dt.intersects(s,a,h,g))return zt.NO_INTERSECTION;var m=dt.index(s,a,h),_=dt.index(s,a,g);if(m>0&&_>0||m<0&&_<0)return zt.NO_INTERSECTION;var k=dt.index(h,g,s),b=dt.index(h,g,a);return k>0&&b>0||k<0&&b<0?zt.NO_INTERSECTION:m===0&&_===0&&k===0&&b===0?this.computeCollinearIntersection(s,a,h,g):(m===0||_===0||k===0||b===0?(this._isProper=!1,s.equals2D(h)||s.equals2D(g)?this._intPt[0]=s:a.equals2D(h)||a.equals2D(g)?this._intPt[0]=a:m===0?this._intPt[0]=new U(h):_===0?this._intPt[0]=new U(g):k===0?this._intPt[0]=new U(s):b===0&&(this._intPt[0]=new U(a))):(this._isProper=!0,this._intPt[0]=this.intersection(s,a,h,g)),zt.POINT_INTERSECTION)}}],[{key:"nearestEndpoint",value:function(s,a,h,g){var m=s,_=qe.pointToSegment(s,h,g),k=qe.pointToSegment(a,h,g);return k<_&&(_=k,m=a),(k=qe.pointToSegment(h,s,a))<_&&(_=k,m=h),(k=qe.pointToSegment(g,s,a))<_&&(_=k,m=g),m}}])}(zt),zg=function(){function u(){o(this,u),u.constructor_.apply(this,arguments)}return c(u,[{key:"countSegment",value:function(i,s){if(i.x<this._p.x&&s.x<this._p.x)return null;if(this._p.x===s.x&&this._p.y===s.y)return this._isPointOnSegment=!0,null;if(i.y===this._p.y&&s.y===this._p.y){var a=i.x,h=s.x;return a>h&&(a=s.x,h=i.x),this._p.x>=a&&this._p.x<=h&&(this._isPointOnSegment=!0),null}if(i.y>this._p.y&&s.y<=this._p.y||s.y>this._p.y&&i.y<=this._p.y){var g=dt.index(i,s,this._p);if(g===dt.COLLINEAR)return this._isPointOnSegment=!0,null;s.y<i.y&&(g=-g),g===dt.LEFT&&this._crossingCount++}}},{key:"isPointInPolygon",value:function(){return this.getLocation()!==R.EXTERIOR}},{key:"getLocation",value:function(){return this._isPointOnSegment?R.BOUNDARY:this._crossingCount%2==1?R.INTERIOR:R.EXTERIOR}},{key:"isOnSegment",value:function(){return this._isPointOnSegment}}],[{key:"constructor_",value:function(){this._p=null,this._crossingCount=0,this._isPointOnSegment=!1;var i=arguments[0];this._p=i}},{key:"locatePointInRing",value:function(){if(arguments[0]instanceof U&&pt(arguments[1],bt)){for(var i=arguments[1],s=new u(arguments[0]),a=new U,h=new U,g=1;g<i.size();g++)if(i.getCoordinate(g,a),i.getCoordinate(g-1,h),s.countSegment(a,h),s.isOnSegment())return s.getLocation();return s.getLocation()}if(arguments[0]instanceof U&&arguments[1]instanceof Array){for(var m=arguments[1],_=new u(arguments[0]),k=1;k<m.length;k++){var b=m[k],z=m[k-1];if(_.countSegment(b,z),_.isOnSegment())return _.getLocation()}return _.getLocation()}}}])}(),Io=function(){function u(){o(this,u)}return c(u,null,[{key:"isOnLine",value:function(){if(arguments[0]instanceof U&&pt(arguments[1],bt)){for(var i=arguments[0],s=arguments[1],a=new Ln,h=new U,g=new U,m=s.size(),_=1;_<m;_++)if(s.getCoordinate(_-1,h),s.getCoordinate(_,g),a.computeIntersection(i,h,g),a.hasIntersection())return!0;return!1}if(arguments[0]instanceof U&&arguments[1]instanceof Array){for(var k=arguments[0],b=arguments[1],z=new Ln,q=1;q<b.length;q++){var V=b[q-1],K=b[q];if(z.computeIntersection(k,V,K),z.hasIntersection())return!0}return!1}}},{key:"locateInRing",value:function(i,s){return zg.locatePointInRing(i,s)}},{key:"isInRing",value:function(i,s){return u.locateInRing(i,s)!==R.EXTERIOR}}])}(),Ie=function(){function u(){o(this,u),u.constructor_.apply(this,arguments)}return c(u,[{key:"setAllLocations",value:function(i){for(var s=0;s<this.location.length;s++)this.location[s]=i}},{key:"isNull",value:function(){for(var i=0;i<this.location.length;i++)if(this.location[i]!==R.NONE)return!1;return!0}},{key:"setAllLocationsIfNull",value:function(i){for(var s=0;s<this.location.length;s++)this.location[s]===R.NONE&&(this.location[s]=i)}},{key:"isLine",value:function(){return this.location.length===1}},{key:"merge",value:function(i){if(i.location.length>this.location.length){var s=new Array(3).fill(null);s[X.ON]=this.location[X.ON],s[X.LEFT]=R.NONE,s[X.RIGHT]=R.NONE,this.location=s}for(var a=0;a<this.location.length;a++)this.location[a]===R.NONE&&a<i.location.length&&(this.location[a]=i.location[a])}},{key:"getLocations",value:function(){return this.location}},{key:"flip",value:function(){if(this.location.length<=1)return null;var i=this.location[X.LEFT];this.location[X.LEFT]=this.location[X.RIGHT],this.location[X.RIGHT]=i}},{key:"toString",value:function(){var i=new Tr;return this.location.length>1&&i.append(R.toLocationSymbol(this.location[X.LEFT])),i.append(R.toLocationSymbol(this.location[X.ON])),this.location.length>1&&i.append(R.toLocationSymbol(this.location[X.RIGHT])),i.toString()}},{key:"setLocations",value:function(i,s,a){this.location[X.ON]=i,this.location[X.LEFT]=s,this.location[X.RIGHT]=a}},{key:"get",value:function(i){return i<this.location.length?this.location[i]:R.NONE}},{key:"isArea",value:function(){return this.location.length>1}},{key:"isAnyNull",value:function(){for(var i=0;i<this.location.length;i++)if(this.location[i]===R.NONE)return!0;return!1}},{key:"setLocation",value:function(){if(arguments.length===1){var i=arguments[0];this.setLocation(X.ON,i)}else if(arguments.length===2){var s=arguments[0],a=arguments[1];this.location[s]=a}}},{key:"init",value:function(i){this.location=new Array(i).fill(null),this.setAllLocations(R.NONE)}},{key:"isEqualOnSide",value:function(i,s){return this.location[s]===i.location[s]}},{key:"allPositionsEqual",value:function(i){for(var s=0;s<this.location.length;s++)if(this.location[s]!==i)return!1;return!0}}],[{key:"constructor_",value:function(){if(this.location=null,arguments.length===1){if(arguments[0]instanceof Array){var i=arguments[0];this.init(i.length)}else if(Number.isInteger(arguments[0])){var s=arguments[0];this.init(1),this.location[X.ON]=s}else if(arguments[0]instanceof u){var a=arguments[0];if(this.init(a.location.length),a!==null)for(var h=0;h<this.location.length;h++)this.location[h]=a.location[h]}}else if(arguments.length===3){var g=arguments[0],m=arguments[1],_=arguments[2];this.init(3),this.location[X.ON]=g,this.location[X.LEFT]=m,this.location[X.RIGHT]=_}}}])}(),Te=function(){function u(){o(this,u),u.constructor_.apply(this,arguments)}return c(u,[{key:"getGeometryCount",value:function(){var i=0;return this.elt[0].isNull()||i++,this.elt[1].isNull()||i++,i}},{key:"setAllLocations",value:function(i,s){this.elt[i].setAllLocations(s)}},{key:"isNull",value:function(i){return this.elt[i].isNull()}},{key:"setAllLocationsIfNull",value:function(){if(arguments.length===1){var i=arguments[0];this.setAllLocationsIfNull(0,i),this.setAllLocationsIfNull(1,i)}else if(arguments.length===2){var s=arguments[0],a=arguments[1];this.elt[s].setAllLocationsIfNull(a)}}},{key:"isLine",value:function(i){return this.elt[i].isLine()}},{key:"merge",value:function(i){for(var s=0;s<2;s++)this.elt[s]===null&&i.elt[s]!==null?this.elt[s]=new Ie(i.elt[s]):this.elt[s].merge(i.elt[s])}},{key:"flip",value:function(){this.elt[0].flip(),this.elt[1].flip()}},{key:"getLocation",value:function(){if(arguments.length===1){var i=arguments[0];return this.elt[i].get(X.ON)}if(arguments.length===2){var s=arguments[0],a=arguments[1];return this.elt[s].get(a)}}},{key:"toString",value:function(){var i=new Tr;return this.elt[0]!==null&&(i.append("A:"),i.append(this.elt[0].toString())),this.elt[1]!==null&&(i.append(" B:"),i.append(this.elt[1].toString())),i.toString()}},{key:"isArea",value:function(){if(arguments.length===0)return this.elt[0].isArea()||this.elt[1].isArea();if(arguments.length===1){var i=arguments[0];return this.elt[i].isArea()}}},{key:"isAnyNull",value:function(i){return this.elt[i].isAnyNull()}},{key:"setLocation",value:function(){if(arguments.length===2){var i=arguments[0],s=arguments[1];this.elt[i].setLocation(X.ON,s)}else if(arguments.length===3){var a=arguments[0],h=arguments[1],g=arguments[2];this.elt[a].setLocation(h,g)}}},{key:"isEqualOnSide",value:function(i,s){return this.elt[0].isEqualOnSide(i.elt[0],s)&&this.elt[1].isEqualOnSide(i.elt[1],s)}},{key:"allPositionsEqual",value:function(i,s){return this.elt[i].allPositionsEqual(s)}},{key:"toLine",value:function(i){this.elt[i].isArea()&&(this.elt[i]=new Ie(this.elt[i].location[0]))}}],[{key:"constructor_",value:function(){if(this.elt=new Array(2).fill(null),arguments.length===1){if(Number.isInteger(arguments[0])){var i=arguments[0];this.elt[0]=new Ie(i),this.elt[1]=new Ie(i)}else if(arguments[0]instanceof u){var s=arguments[0];this.elt[0]=new Ie(s.elt[0]),this.elt[1]=new Ie(s.elt[1])}}else if(arguments.length===2){var a=arguments[0],h=arguments[1];this.elt[0]=new Ie(R.NONE),this.elt[1]=new Ie(R.NONE),this.elt[a].setLocation(h)}else if(arguments.length===3){var g=arguments[0],m=arguments[1],_=arguments[2];this.elt[0]=new Ie(g,m,_),this.elt[1]=new Ie(g,m,_)}else if(arguments.length===4){var k=arguments[0],b=arguments[1],z=arguments[2],q=arguments[3];this.elt[0]=new Ie(R.NONE,R.NONE,R.NONE),this.elt[1]=new Ie(R.NONE,R.NONE,R.NONE),this.elt[k].setLocations(b,z,q)}}},{key:"toLineLabel",value:function(i){for(var s=new u(R.NONE),a=0;a<2;a++)s.setLocation(a,i.getLocation(a));return s}}])}(),Ai=function(){return c(function u(){o(this,u),u.constructor_.apply(this,arguments)},[{key:"computeRing",value:function(){if(this._ring!==null)return null;for(var u=new Array(this._pts.size()).fill(null),i=0;i<this._pts.size();i++)u[i]=this._pts.get(i);this._ring=this._geometryFactory.createLinearRing(u),this._isHole=dt.isCCW(this._ring.getCoordinates())}},{key:"isIsolated",value:function(){return this._label.getGeometryCount()===1}},{key:"computePoints",value:function(u){this._startDe=u;var i=u,s=!0;do{if(i===null)throw new Ke("Found null DirectedEdge");if(i.getEdgeRing()===this)throw new Ke("Directed Edge visited twice during ring-building at "+i.getCoordinate());this._edges.add(i);var a=i.getLabel();ot.isTrue(a.isArea()),this.mergeLabel(a),this.addPoints(i.getEdge(),i.isForward(),s),s=!1,this.setEdgeRing(i,this),i=this.getNext(i)}while(i!==this._startDe)}},{key:"getLinearRing",value:function(){return this._ring}},{key:"getCoordinate",value:function(u){return this._pts.get(u)}},{key:"computeMaxNodeDegree",value:function(){this._maxNodeDegree=0;var u=this._startDe;do{var i=u.getNode().getEdges().getOutgoingDegree(this);i>this._maxNodeDegree&&(this._maxNodeDegree=i),u=this.getNext(u)}while(u!==this._startDe);this._maxNodeDegree*=2}},{key:"addPoints",value:function(u,i,s){var a=u.getCoordinates();if(i){var h=1;s&&(h=0);for(var g=h;g<a.length;g++)this._pts.add(a[g])}else{var m=a.length-2;s&&(m=a.length-1);for(var _=m;_>=0;_--)this._pts.add(a[_])}}},{key:"isHole",value:function(){return this._isHole}},{key:"setInResult",value:function(){var u=this._startDe;do u.getEdge().setInResult(!0),u=u.getNext();while(u!==this._startDe)}},{key:"containsPoint",value:function(u){var i=this.getLinearRing();if(!i.getEnvelopeInternal().contains(u)||!Io.isInRing(u,i.getCoordinates()))return!1;for(var s=this._holes.iterator();s.hasNext();)if(s.next().containsPoint(u))return!1;return!0}},{key:"addHole",value:function(u){this._holes.add(u)}},{key:"isShell",value:function(){return this._shell===null}},{key:"getLabel",value:function(){return this._label}},{key:"getEdges",value:function(){return this._edges}},{key:"getMaxNodeDegree",value:function(){return this._maxNodeDegree<0&&this.computeMaxNodeDegree(),this._maxNodeDegree}},{key:"getShell",value:function(){return this._shell}},{key:"mergeLabel",value:function(){if(arguments.length===1){var u=arguments[0];this.mergeLabel(u,0),this.mergeLabel(u,1)}else if(arguments.length===2){var i=arguments[1],s=arguments[0].getLocation(i,X.RIGHT);if(s===R.NONE)return null;if(this._label.getLocation(i)===R.NONE)return this._label.setLocation(i,s),null}}},{key:"setShell",value:function(u){this._shell=u,u!==null&&u.addHole(this)}},{key:"toPolygon",value:function(u){for(var i=new Array(this._holes.size()).fill(null),s=0;s<this._holes.size();s++)i[s]=this._holes.get(s).getLinearRing();return u.createPolygon(this.getLinearRing(),i)}}],[{key:"constructor_",value:function(){if(this._startDe=null,this._maxNodeDegree=-1,this._edges=new ht,this._pts=new ht,this._label=new Te(R.NONE),this._ring=null,this._isHole=null,this._shell=null,this._holes=new ht,this._geometryFactory=null,arguments.length!==0){if(arguments.length===2){var u=arguments[0],i=arguments[1];this._geometryFactory=i,this.computePoints(u),this.computeRing()}}}}])}(),qg=function(u){function i(){var s;return o(this,i),s=r(this,i),i.constructor_.apply(s,arguments),s}return y(i,u),c(i,[{key:"setEdgeRing",value:function(s,a){s.setMinEdgeRing(a)}},{key:"getNext",value:function(s){return s.getNextMin()}}],[{key:"constructor_",value:function(){var s=arguments[0],a=arguments[1];Ai.constructor_.call(this,s,a)}}])}(Ai),Ug=function(u){function i(){var s;return o(this,i),s=r(this,i),i.constructor_.apply(s,arguments),s}return y(i,u),c(i,[{key:"buildMinimalRings",value:function(){var s=new ht,a=this._startDe;do{if(a.getMinEdgeRing()===null){var h=new qg(a,this._geometryFactory);s.add(h)}a=a.getNext()}while(a!==this._startDe);return s}},{key:"setEdgeRing",value:function(s,a){s.setEdgeRing(a)}},{key:"linkDirectedEdgesForMinimalEdgeRings",value:function(){var s=this._startDe;do s.getNode().getEdges().linkMinimalDirectedEdges(this),s=s.getNext();while(s!==this._startDe)}},{key:"getNext",value:function(s){return s.getNext()}}],[{key:"constructor_",value:function(){var s=arguments[0],a=arguments[1];Ai.constructor_.call(this,s,a)}}])}(Ai),Ru=function(){return c(function u(){o(this,u),u.constructor_.apply(this,arguments)},[{key:"setVisited",value:function(u){this._isVisited=u}},{key:"setInResult",value:function(u){this._isInResult=u}},{key:"isCovered",value:function(){return this._isCovered}},{key:"isCoveredSet",value:function(){return this._isCoveredSet}},{key:"setLabel",value:function(u){this._label=u}},{key:"getLabel",value:function(){return this._label}},{key:"setCovered",value:function(u){this._isCovered=u,this._isCoveredSet=!0}},{key:"updateIM",value:function(u){ot.isTrue(this._label.getGeometryCount()>=2,"found partial label"),this.computeIM(u)}},{key:"isInResult",value:function(){return this._isInResult}},{key:"isVisited",value:function(){return this._isVisited}}],[{key:"constructor_",value:function(){if(this._label=null,this._isInResult=!1,this._isCovered=!1,this._isCoveredSet=!1,this._isVisited=!1,arguments.length!==0){if(arguments.length===1){var u=arguments[0];this._label=u}}}}])}(),Oi=function(u){function i(){var s;return o(this,i),s=r(this,i),i.constructor_.apply(s,arguments),s}return y(i,u),c(i,[{key:"isIncidentEdgeInResult",value:function(){for(var s=this.getEdges().getEdges().iterator();s.hasNext();)if(s.next().getEdge().isInResult())return!0;return!1}},{key:"isIsolated",value:function(){return this._label.getGeometryCount()===1}},{key:"getCoordinate",value:function(){return this._coord}},{key:"print",value:function(s){s.println("node "+this._coord+" lbl: "+this._label)}},{key:"computeIM",value:function(s){}},{key:"computeMergedLocation",value:function(s,a){var h=R.NONE;if(h=this._label.getLocation(a),!s.isNull(a)){var g=s.getLocation(a);h!==R.BOUNDARY&&(h=g)}return h}},{key:"setLabel",value:function(){if(arguments.length!==2||!Number.isInteger(arguments[1])||!Number.isInteger(arguments[0]))return I(i,"setLabel",this,1).apply(this,arguments);var s=arguments[0],a=arguments[1];this._label===null?this._label=new Te(s,a):this._label.setLocation(s,a)}},{key:"getEdges",value:function(){return this._edges}},{key:"mergeLabel",value:function(){if(arguments[0]instanceof i){var s=arguments[0];this.mergeLabel(s._label)}else if(arguments[0]instanceof Te)for(var a=arguments[0],h=0;h<2;h++){var g=this.computeMergedLocation(a,h);this._label.getLocation(h)===R.NONE&&this._label.setLocation(h,g)}}},{key:"add",value:function(s){this._edges.insert(s),s.setNode(this)}},{key:"setLabelBoundary",value:function(s){if(this._label===null)return null;var a=R.NONE;this._label!==null&&(a=this._label.getLocation(s));var h=null;switch(a){case R.BOUNDARY:h=R.INTERIOR;break;case R.INTERIOR:default:h=R.BOUNDARY}this._label.setLocation(s,h)}}],[{key:"constructor_",value:function(){this._coord=null,this._edges=null;var s=arguments[0],a=arguments[1];this._coord=s,this._edges=a,this._label=new Te(0,R.NONE)}}])}(Ru),jg=function(u){function i(){return o(this,i),r(this,i,arguments)}return y(i,u),c(i)}(ku);function Cu(u){return u==null?0:u.color}function Ct(u){return u==null?null:u.parent}function Ue(u,i){u!==null&&(u.color=i)}function To(u){return u==null?null:u.left}function Pu(u){return u==null?null:u.right}var Pr=function(u){function i(){var s;return o(this,i),(s=r(this,i)).root_=null,s.size_=0,s}return y(i,u),c(i,[{key:"get",value:function(s){for(var a=this.root_;a!==null;){var h=s.compareTo(a.key);if(h<0)a=a.left;else{if(!(h>0))return a.value;a=a.right}}return null}},{key:"put",value:function(s,a){if(this.root_===null)return this.root_={key:s,value:a,left:null,right:null,parent:null,color:0,getValue:function(){return this.value},getKey:function(){return this.key}},this.size_=1,null;var h,g,m=this.root_;do if(h=m,(g=s.compareTo(m.key))<0)m=m.left;else{if(!(g>0)){var _=m.value;return m.value=a,_}m=m.right}while(m!==null);var k={key:s,left:null,right:null,value:a,parent:h,color:0,getValue:function(){return this.value},getKey:function(){return this.key}};return g<0?h.left=k:h.right=k,this.fixAfterInsertion(k),this.size_++,null}},{key:"fixAfterInsertion",value:function(s){var a;for(s.color=1;s!=null&&s!==this.root_&&s.parent.color===1;)Ct(s)===To(Ct(Ct(s)))?Cu(a=Pu(Ct(Ct(s))))===1?(Ue(Ct(s),0),Ue(a,0),Ue(Ct(Ct(s)),1),s=Ct(Ct(s))):(s===Pu(Ct(s))&&(s=Ct(s),this.rotateLeft(s)),Ue(Ct(s),0),Ue(Ct(Ct(s)),1),this.rotateRight(Ct(Ct(s)))):Cu(a=To(Ct(Ct(s))))===1?(Ue(Ct(s),0),Ue(a,0),Ue(Ct(Ct(s)),1),s=Ct(Ct(s))):(s===To(Ct(s))&&(s=Ct(s),this.rotateRight(s)),Ue(Ct(s),0),Ue(Ct(Ct(s)),1),this.rotateLeft(Ct(Ct(s))));this.root_.color=0}},{key:"values",value:function(){var s=new ht,a=this.getFirstEntry();if(a!==null)for(s.add(a.value);(a=i.successor(a))!==null;)s.add(a.value);return s}},{key:"entrySet",value:function(){var s=new co,a=this.getFirstEntry();if(a!==null)for(s.add(a);(a=i.successor(a))!==null;)s.add(a);return s}},{key:"rotateLeft",value:function(s){if(s!=null){var a=s.right;s.right=a.left,a.left!=null&&(a.left.parent=s),a.parent=s.parent,s.parent==null?this.root_=a:s.parent.left===s?s.parent.left=a:s.parent.right=a,a.left=s,s.parent=a}}},{key:"rotateRight",value:function(s){if(s!=null){var a=s.left;s.left=a.right,a.right!=null&&(a.right.parent=s),a.parent=s.parent,s.parent==null?this.root_=a:s.parent.right===s?s.parent.right=a:s.parent.left=a,a.right=s,s.parent=a}}},{key:"getFirstEntry",value:function(){var s=this.root_;if(s!=null)for(;s.left!=null;)s=s.left;return s}},{key:"size",value:function(){return this.size_}},{key:"containsKey",value:function(s){for(var a=this.root_;a!==null;){var h=s.compareTo(a.key);if(h<0)a=a.left;else{if(!(h>0))return!0;a=a.right}}return!1}}],[{key:"successor",value:function(s){var a;if(s===null)return null;if(s.right!==null){for(a=s.right;a.left!==null;)a=a.left;return a}a=s.parent;for(var h=s;a!==null&&h===a.right;)h=a,a=a.parent;return a}}])}(jg),Lu=function(){return c(function u(){o(this,u),u.constructor_.apply(this,arguments)},[{key:"find",value:function(u){return this.nodeMap.get(u)}},{key:"addNode",value:function(){if(arguments[0]instanceof U){var u=arguments[0],i=this.nodeMap.get(u);return i===null&&(i=this.nodeFact.createNode(u),this.nodeMap.put(u,i)),i}if(arguments[0]instanceof Oi){var s=arguments[0],a=this.nodeMap.get(s.getCoordinate());return a===null?(this.nodeMap.put(s.getCoordinate(),s),s):(a.mergeLabel(s),a)}}},{key:"print",value:function(u){for(var i=this.iterator();i.hasNext();)i.next().print(u)}},{key:"iterator",value:function(){return this.nodeMap.values().iterator()}},{key:"values",value:function(){return this.nodeMap.values()}},{key:"getBoundaryNodes",value:function(u){for(var i=new ht,s=this.iterator();s.hasNext();){var a=s.next();a.getLabel().getLocation(u)===R.BOUNDARY&&i.add(a)}return i}},{key:"add",value:function(u){var i=u.getCoordinate();this.addNode(i).add(u)}}],[{key:"constructor_",value:function(){this.nodeMap=new Pr,this.nodeFact=null;var u=arguments[0];this.nodeFact=u}}])}(),oe=function(){function u(){o(this,u)}return c(u,null,[{key:"isNorthern",value:function(i){return i===u.NE||i===u.NW}},{key:"isOpposite",value:function(i,s){return i!==s&&(i-s+4)%4===2}},{key:"commonHalfPlane",value:function(i,s){if(i===s)return i;if((i-s+4)%4===2)return-1;var a=i<s?i:s;return a===0&&(i>s?i:s)===3?3:a}},{key:"isInHalfPlane",value:function(i,s){return s===u.SE?i===u.SE||i===u.SW:i===s||i===s+1}},{key:"quadrant",value:function(){if(typeof arguments[0]=="number"&&typeof arguments[1]=="number"){var i=arguments[0],s=arguments[1];if(i===0&&s===0)throw new N("Cannot compute the quadrant for point ( "+i+", "+s+" )");return i>=0?s>=0?u.NE:u.SE:s>=0?u.NW:u.SW}if(arguments[0]instanceof U&&arguments[1]instanceof U){var a=arguments[0],h=arguments[1];if(h.x===a.x&&h.y===a.y)throw new N("Cannot compute the quadrant for two identical points "+a);return h.x>=a.x?h.y>=a.y?u.NE:u.SE:h.y>=a.y?u.NW:u.SW}}}])}();oe.NE=0,oe.NW=1,oe.SW=2,oe.SE=3;var Au=function(){function u(){o(this,u),u.constructor_.apply(this,arguments)}return c(u,[{key:"compareDirection",value:function(i){return this._dx===i._dx&&this._dy===i._dy?0:this._quadrant>i._quadrant?1:this._quadrant<i._quadrant?-1:dt.index(i._p0,i._p1,this._p1)}},{key:"getDy",value:function(){return this._dy}},{key:"getCoordinate",value:function(){return this._p0}},{key:"setNode",value:function(i){this._node=i}},{key:"print",value:function(i){var s=Math.atan2(this._dy,this._dx),a=this.getClass().getName(),h=a.lastIndexOf("."),g=a.substring(h+1);i.print("  "+g+": "+this._p0+" - "+this._p1+" "+this._quadrant+":"+s+"   "+this._label)}},{key:"compareTo",value:function(i){var s=i;return this.compareDirection(s)}},{key:"getDirectedCoordinate",value:function(){return this._p1}},{key:"getDx",value:function(){return this._dx}},{key:"getLabel",value:function(){return this._label}},{key:"getEdge",value:function(){return this._edge}},{key:"getQuadrant",value:function(){return this._quadrant}},{key:"getNode",value:function(){return this._node}},{key:"toString",value:function(){var i=Math.atan2(this._dy,this._dx),s=this.getClass().getName(),a=s.lastIndexOf(".");return"  "+s.substring(a+1)+": "+this._p0+" - "+this._p1+" "+this._quadrant+":"+i+"   "+this._label}},{key:"computeLabel",value:function(i){}},{key:"init",value:function(i,s){this._p0=i,this._p1=s,this._dx=s.x-i.x,this._dy=s.y-i.y,this._quadrant=oe.quadrant(this._dx,this._dy),ot.isTrue(!(this._dx===0&&this._dy===0),"EdgeEnd with identical endpoints found")}},{key:"interfaces_",get:function(){return[A]}}],[{key:"constructor_",value:function(){if(this._edge=null,this._label=null,this._node=null,this._p0=null,this._p1=null,this._dx=null,this._dy=null,this._quadrant=null,arguments.length===1){var i=arguments[0];this._edge=i}else if(arguments.length===3){var s=arguments[0],a=arguments[1],h=arguments[2];u.constructor_.call(this,s,a,h,null)}else if(arguments.length===4){var g=arguments[0],m=arguments[1],_=arguments[2],k=arguments[3];u.constructor_.call(this,g),this.init(m,_),this._label=k}}}])}(),Mo=function(u){function i(){var s;return o(this,i),s=r(this,i),i.constructor_.apply(s,arguments),s}return y(i,u),c(i,[{key:"getNextMin",value:function(){return this._nextMin}},{key:"getDepth",value:function(s){return this._depth[s]}},{key:"setVisited",value:function(s){this._isVisited=s}},{key:"computeDirectedLabel",value:function(){this._label=new Te(this._edge.getLabel()),this._isForward||this._label.flip()}},{key:"getNext",value:function(){return this._next}},{key:"setDepth",value:function(s,a){if(this._depth[s]!==-999&&this._depth[s]!==a)throw new Ke("assigned depths do not match",this.getCoordinate());this._depth[s]=a}},{key:"isInteriorAreaEdge",value:function(){for(var s=!0,a=0;a<2;a++)this._label.isArea(a)&&this._label.getLocation(a,X.LEFT)===R.INTERIOR&&this._label.getLocation(a,X.RIGHT)===R.INTERIOR||(s=!1);return s}},{key:"setNextMin",value:function(s){this._nextMin=s}},{key:"print",value:function(s){I(i,"print",this,1).call(this,s),s.print(" "+this._depth[X.LEFT]+"/"+this._depth[X.RIGHT]),s.print(" ("+this.getDepthDelta()+")"),this._isInResult&&s.print(" inResult")}},{key:"setMinEdgeRing",value:function(s){this._minEdgeRing=s}},{key:"isLineEdge",value:function(){var s=this._label.isLine(0)||this._label.isLine(1),a=!this._label.isArea(0)||this._label.allPositionsEqual(0,R.EXTERIOR),h=!this._label.isArea(1)||this._label.allPositionsEqual(1,R.EXTERIOR);return s&&a&&h}},{key:"setEdgeRing",value:function(s){this._edgeRing=s}},{key:"getMinEdgeRing",value:function(){return this._minEdgeRing}},{key:"getDepthDelta",value:function(){var s=this._edge.getDepthDelta();return this._isForward||(s=-s),s}},{key:"setInResult",value:function(s){this._isInResult=s}},{key:"getSym",value:function(){return this._sym}},{key:"isForward",value:function(){return this._isForward}},{key:"getEdge",value:function(){return this._edge}},{key:"printEdge",value:function(s){this.print(s),s.print(" "),this._isForward?this._edge.print(s):this._edge.printReverse(s)}},{key:"setSym",value:function(s){this._sym=s}},{key:"setVisitedEdge",value:function(s){this.setVisited(s),this._sym.setVisited(s)}},{key:"setEdgeDepths",value:function(s,a){var h=this.getEdge().getDepthDelta();this._isForward||(h=-h);var g=1;s===X.LEFT&&(g=-1);var m=X.opposite(s),_=a+h*g;this.setDepth(s,a),this.setDepth(m,_)}},{key:"getEdgeRing",value:function(){return this._edgeRing}},{key:"isInResult",value:function(){return this._isInResult}},{key:"setNext",value:function(s){this._next=s}},{key:"isVisited",value:function(){return this._isVisited}}],[{key:"constructor_",value:function(){this._isForward=null,this._isInResult=!1,this._isVisited=!1,this._sym=null,this._next=null,this._nextMin=null,this._edgeRing=null,this._minEdgeRing=null,this._depth=[0,-999,-999];var s=arguments[0],a=arguments[1];if(Au.constructor_.call(this,s),this._isForward=a,a)this.init(s.getCoordinate(0),s.getCoordinate(1));else{var h=s.getNumPoints()-1;this.init(s.getCoordinate(h),s.getCoordinate(h-1))}this.computeDirectedLabel()}},{key:"depthFactor",value:function(s,a){return s===R.EXTERIOR&&a===R.INTERIOR?1:s===R.INTERIOR&&a===R.EXTERIOR?-1:0}}])}(Au),Ou=function(){return c(function u(){o(this,u)},[{key:"createNode",value:function(u){return new Oi(u,null)}}])}(),Du=function(){return c(function u(){o(this,u),u.constructor_.apply(this,arguments)},[{key:"printEdges",value:function(u){u.println("Edges:");for(var i=0;i<this._edges.size();i++){u.println("edge "+i+":");var s=this._edges.get(i);s.print(u),s.eiList.print(u)}}},{key:"find",value:function(u){return this._nodes.find(u)}},{key:"addNode",value:function(){if(arguments[0]instanceof Oi){var u=arguments[0];return this._nodes.addNode(u)}if(arguments[0]instanceof U){var i=arguments[0];return this._nodes.addNode(i)}}},{key:"getNodeIterator",value:function(){return this._nodes.iterator()}},{key:"linkResultDirectedEdges",value:function(){for(var u=this._nodes.iterator();u.hasNext();)u.next().getEdges().linkResultDirectedEdges()}},{key:"debugPrintln",value:function(u){ke.out.println(u)}},{key:"isBoundaryNode",value:function(u,i){var s=this._nodes.find(i);if(s===null)return!1;var a=s.getLabel();return a!==null&&a.getLocation(u)===R.BOUNDARY}},{key:"linkAllDirectedEdges",value:function(){for(var u=this._nodes.iterator();u.hasNext();)u.next().getEdges().linkAllDirectedEdges()}},{key:"matchInSameDirection",value:function(u,i,s,a){return!!u.equals(s)&&dt.index(u,i,a)===dt.COLLINEAR&&oe.quadrant(u,i)===oe.quadrant(s,a)}},{key:"getEdgeEnds",value:function(){return this._edgeEndList}},{key:"debugPrint",value:function(u){ke.out.print(u)}},{key:"getEdgeIterator",value:function(){return this._edges.iterator()}},{key:"findEdgeInSameDirection",value:function(u,i){for(var s=0;s<this._edges.size();s++){var a=this._edges.get(s),h=a.getCoordinates();if(this.matchInSameDirection(u,i,h[0],h[1])||this.matchInSameDirection(u,i,h[h.length-1],h[h.length-2]))return a}return null}},{key:"insertEdge",value:function(u){this._edges.add(u)}},{key:"findEdgeEnd",value:function(u){for(var i=this.getEdgeEnds().iterator();i.hasNext();){var s=i.next();if(s.getEdge()===u)return s}return null}},{key:"addEdges",value:function(u){for(var i=u.iterator();i.hasNext();){var s=i.next();this._edges.add(s);var a=new Mo(s,!0),h=new Mo(s,!1);a.setSym(h),h.setSym(a),this.add(a),this.add(h)}}},{key:"add",value:function(u){this._nodes.add(u),this._edgeEndList.add(u)}},{key:"getNodes",value:function(){return this._nodes.values()}},{key:"findEdge",value:function(u,i){for(var s=0;s<this._edges.size();s++){var a=this._edges.get(s),h=a.getCoordinates();if(u.equals(h[0])&&i.equals(h[1]))return a}return null}}],[{key:"constructor_",value:function(){if(this._edges=new ht,this._nodes=null,this._edgeEndList=new ht,arguments.length===0)this._nodes=new Lu(new Ou);else if(arguments.length===1){var u=arguments[0];this._nodes=new Lu(u)}}},{key:"linkResultDirectedEdges",value:function(u){for(var i=u.iterator();i.hasNext();)i.next().getEdges().linkResultDirectedEdges()}}])}(),Vg=function(){function u(){o(this,u),u.constructor_.apply(this,arguments)}return c(u,[{key:"sortShellsAndHoles",value:function(i,s,a){for(var h=i.iterator();h.hasNext();){var g=h.next();g.isHole()?a.add(g):s.add(g)}}},{key:"computePolygons",value:function(i){for(var s=new ht,a=i.iterator();a.hasNext();){var h=a.next().toPolygon(this._geometryFactory);s.add(h)}return s}},{key:"placeFreeHoles",value:function(i,s){for(var a=s.iterator();a.hasNext();){var h=a.next();if(h.getShell()===null){var g=u.findEdgeRingContaining(h,i);if(g===null)throw new Ke("unable to assign hole to a shell",h.getCoordinate(0));h.setShell(g)}}}},{key:"buildMinimalEdgeRings",value:function(i,s,a){for(var h=new ht,g=i.iterator();g.hasNext();){var m=g.next();if(m.getMaxNodeDegree()>2){m.linkDirectedEdgesForMinimalEdgeRings();var _=m.buildMinimalRings(),k=this.findShell(_);k!==null?(this.placePolygonHoles(k,_),s.add(k)):a.addAll(_)}else h.add(m)}return h}},{key:"buildMaximalEdgeRings",value:function(i){for(var s=new ht,a=i.iterator();a.hasNext();){var h=a.next();if(h.isInResult()&&h.getLabel().isArea()&&h.getEdgeRing()===null){var g=new Ug(h,this._geometryFactory);s.add(g),g.setInResult()}}return s}},{key:"placePolygonHoles",value:function(i,s){for(var a=s.iterator();a.hasNext();){var h=a.next();h.isHole()&&h.setShell(i)}}},{key:"getPolygons",value:function(){return this.computePolygons(this._shellList)}},{key:"findShell",value:function(i){for(var s=0,a=null,h=i.iterator();h.hasNext();){var g=h.next();g.isHole()||(a=g,s++)}return ot.isTrue(s<=1,"found two shells in MinimalEdgeRing list"),a}},{key:"add",value:function(){if(arguments.length===1){var i=arguments[0];this.add(i.getEdgeEnds(),i.getNodes())}else if(arguments.length===2){var s=arguments[0],a=arguments[1];Du.linkResultDirectedEdges(a);var h=this.buildMaximalEdgeRings(s),g=new ht,m=this.buildMinimalEdgeRings(h,this._shellList,g);this.sortShellsAndHoles(m,this._shellList,g),this.placeFreeHoles(this._shellList,g)}}}],[{key:"constructor_",value:function(){this._geometryFactory=null,this._shellList=new ht;var i=arguments[0];this._geometryFactory=i}},{key:"findEdgeRingContaining",value:function(i,s){for(var a=i.getLinearRing(),h=a.getEnvelopeInternal(),g=a.getCoordinateN(0),m=null,_=null,k=s.iterator();k.hasNext();){var b=k.next(),z=b.getLinearRing(),q=z.getEnvelopeInternal();if(!q.equals(h)&&q.contains(h)){g=Ht.ptNotInList(a.getCoordinates(),z.getCoordinates());var V=!1;Io.isInRing(g,z.getCoordinates())&&(V=!0),V&&(m===null||_.contains(q))&&(_=(m=b).getLinearRing().getEnvelopeInternal())}}return m}}])}(),Fu=function(){return c(function u(){o(this,u)},[{key:"getBounds",value:function(){}}])}(),Qe=function(){return c(function u(){o(this,u),u.constructor_.apply(this,arguments)},[{key:"getItem",value:function(){return this._item}},{key:"getBounds",value:function(){return this._bounds}},{key:"interfaces_",get:function(){return[Fu,E]}}],[{key:"constructor_",value:function(){this._bounds=null,this._item=null;var u=arguments[0],i=arguments[1];this._bounds=u,this._item=i}}])}(),Di=function(){return c(function u(){o(this,u),u.constructor_.apply(this,arguments)},[{key:"poll",value:function(){if(this.isEmpty())return null;var u=this._items.get(1);return this._items.set(1,this._items.get(this._size)),this._size-=1,this.reorder(1),u}},{key:"size",value:function(){return this._size}},{key:"reorder",value:function(u){for(var i=null,s=this._items.get(u);2*u<=this._size&&((i=2*u)!==this._size&&this._items.get(i+1).compareTo(this._items.get(i))<0&&i++,this._items.get(i).compareTo(s)<0);u=i)this._items.set(u,this._items.get(i));this._items.set(u,s)}},{key:"clear",value:function(){this._size=0,this._items.clear()}},{key:"peek",value:function(){return this.isEmpty()?null:this._items.get(1)}},{key:"isEmpty",value:function(){return this._size===0}},{key:"add",value:function(u){this._items.add(null),this._size+=1;var i=this._size;for(this._items.set(0,u);u.compareTo(this._items.get(Math.trunc(i/2)))<0;i/=2)this._items.set(i,this._items.get(Math.trunc(i/2)));this._items.set(i,u)}}],[{key:"constructor_",value:function(){this._size=null,this._items=null,this._size=0,this._items=new ht,this._items.add(null)}}])}(),Yg=function(){return c(function u(){o(this,u)},[{key:"insert",value:function(u,i){}},{key:"remove",value:function(u,i){}},{key:"query",value:function(){}}])}(),Me=function(){return c(function u(){o(this,u),u.constructor_.apply(this,arguments)},[{key:"getLevel",value:function(){return this._level}},{key:"size",value:function(){return this._childBoundables.size()}},{key:"getChildBoundables",value:function(){return this._childBoundables}},{key:"addChildBoundable",value:function(u){ot.isTrue(this._bounds===null),this._childBoundables.add(u)}},{key:"isEmpty",value:function(){return this._childBoundables.isEmpty()}},{key:"getBounds",value:function(){return this._bounds===null&&(this._bounds=this.computeBounds()),this._bounds}},{key:"interfaces_",get:function(){return[Fu,E]}}],[{key:"constructor_",value:function(){if(this._childBoundables=new ht,this._bounds=null,this._level=null,arguments.length!==0){if(arguments.length===1){var u=arguments[0];this._level=u}}}}])}(),$n={reverseOrder:function(){return{compare:function(u,i){return i.compareTo(u)}}},min:function(u){return $n.sort(u),u.get(0)},sort:function(u,i){var s=u.toArray();i?Rn.sort(s,i):Rn.sort(s);for(var a=u.iterator(),h=0,g=s.length;h<g;h++)a.next(),a.set(s[h])},singletonList:function(u){var i=new ht;return i.add(u),i}},Wg=function(){function u(){o(this,u)}return c(u,null,[{key:"maxDistance",value:function(i,s,a,h,g,m,_,k){var b=u.distance(i,s,g,m);return b=Math.max(b,u.distance(i,s,_,k)),b=Math.max(b,u.distance(a,h,g,m)),b=Math.max(b,u.distance(a,h,_,k))}},{key:"distance",value:function(i,s,a,h){var g=a-i,m=h-s;return Math.sqrt(g*g+m*m)}},{key:"maximumDistance",value:function(i,s){var a=Math.min(i.getMinX(),s.getMinX()),h=Math.min(i.getMinY(),s.getMinY()),g=Math.max(i.getMaxX(),s.getMaxX()),m=Math.max(i.getMaxY(),s.getMaxY());return u.distance(a,h,g,m)}},{key:"minMaxDistance",value:function(i,s){var a=i.getMinX(),h=i.getMinY(),g=i.getMaxX(),m=i.getMaxY(),_=s.getMinX(),k=s.getMinY(),b=s.getMaxX(),z=s.getMaxY(),q=u.maxDistance(a,h,a,m,_,k,_,z);return q=Math.min(q,u.maxDistance(a,h,a,m,_,k,b,k)),q=Math.min(q,u.maxDistance(a,h,a,m,b,z,_,z)),q=Math.min(q,u.maxDistance(a,h,a,m,b,z,b,k)),q=Math.min(q,u.maxDistance(a,h,g,h,_,k,_,z)),q=Math.min(q,u.maxDistance(a,h,g,h,_,k,b,k)),q=Math.min(q,u.maxDistance(a,h,g,h,b,z,_,z)),q=Math.min(q,u.maxDistance(a,h,g,h,b,z,b,k)),q=Math.min(q,u.maxDistance(g,m,a,m,_,k,_,z)),q=Math.min(q,u.maxDistance(g,m,a,m,_,k,b,k)),q=Math.min(q,u.maxDistance(g,m,a,m,b,z,_,z)),q=Math.min(q,u.maxDistance(g,m,a,m,b,z,b,k)),q=Math.min(q,u.maxDistance(g,m,g,h,_,k,_,z)),q=Math.min(q,u.maxDistance(g,m,g,h,_,k,b,k)),q=Math.min(q,u.maxDistance(g,m,g,h,b,z,_,z)),q=Math.min(q,u.maxDistance(g,m,g,h,b,z,b,k))}}])}(),Kn=function(){function u(){o(this,u),u.constructor_.apply(this,arguments)}return c(u,[{key:"maximumDistance",value:function(){return Wg.maximumDistance(this._boundable1.getBounds(),this._boundable2.getBounds())}},{key:"expandToQueue",value:function(i,s){var a=u.isComposite(this._boundable1),h=u.isComposite(this._boundable2);if(a&&h)return u.area(this._boundable1)>u.area(this._boundable2)?(this.expand(this._boundable1,this._boundable2,!1,i,s),null):(this.expand(this._boundable2,this._boundable1,!0,i,s),null);if(a)return this.expand(this._boundable1,this._boundable2,!1,i,s),null;if(h)return this.expand(this._boundable2,this._boundable1,!0,i,s),null;throw new N("neither boundable is composite")}},{key:"isLeaves",value:function(){return!(u.isComposite(this._boundable1)||u.isComposite(this._boundable2))}},{key:"compareTo",value:function(i){var s=i;return this._distance<s._distance?-1:this._distance>s._distance?1:0}},{key:"expand",value:function(i,s,a,h,g){for(var m=i.getChildBoundables().iterator();m.hasNext();){var _=m.next(),k=null;(k=a?new u(s,_,this._itemDistance):new u(_,s,this._itemDistance)).getDistance()<g&&h.add(k)}}},{key:"getBoundable",value:function(i){return i===0?this._boundable1:this._boundable2}},{key:"getDistance",value:function(){return this._distance}},{key:"distance",value:function(){return this.isLeaves()?this._itemDistance.distance(this._boundable1,this._boundable2):this._boundable1.getBounds().distance(this._boundable2.getBounds())}},{key:"interfaces_",get:function(){return[A]}}],[{key:"constructor_",value:function(){this._boundable1=null,this._boundable2=null,this._distance=null,this._itemDistance=null;var i=arguments[0],s=arguments[1],a=arguments[2];this._boundable1=i,this._boundable2=s,this._itemDistance=a,this._distance=this.distance()}},{key:"area",value:function(i){return i.getBounds().getArea()}},{key:"isComposite",value:function(i){return i instanceof Me}}])}(),Gu=function(){return c(function u(){o(this,u)},[{key:"visitItem",value:function(u){}}])}(),Jn=function(){function u(){o(this,u),u.constructor_.apply(this,arguments)}return c(u,[{key:"queryInternal",value:function(){if(pt(arguments[2],Gu)&&arguments[0]instanceof Object&&arguments[1]instanceof Me)for(var i=arguments[0],s=arguments[2],a=arguments[1].getChildBoundables(),h=0;h<a.size();h++){var g=a.get(h);this.getIntersectsOp().intersects(g.getBounds(),i)&&(g instanceof Me?this.queryInternal(i,g,s):g instanceof Qe?s.visitItem(g.getItem()):ot.shouldNeverReachHere())}else if(pt(arguments[2],Nn)&&arguments[0]instanceof Object&&arguments[1]instanceof Me)for(var m=arguments[0],_=arguments[2],k=arguments[1].getChildBoundables(),b=0;b<k.size();b++){var z=k.get(b);this.getIntersectsOp().intersects(z.getBounds(),m)&&(z instanceof Me?this.queryInternal(m,z,_):z instanceof Qe?_.add(z.getItem()):ot.shouldNeverReachHere())}}},{key:"getNodeCapacity",value:function(){return this._nodeCapacity}},{key:"lastNode",value:function(i){return i.get(i.size()-1)}},{key:"size",value:function(){if(arguments.length===0)return this.isEmpty()?0:(this.build(),this.size(this._root));if(arguments.length===1){for(var i=0,s=arguments[0].getChildBoundables().iterator();s.hasNext();){var a=s.next();a instanceof Me?i+=this.size(a):a instanceof Qe&&(i+=1)}return i}}},{key:"removeItem",value:function(i,s){for(var a=null,h=i.getChildBoundables().iterator();h.hasNext();){var g=h.next();g instanceof Qe&&g.getItem()===s&&(a=g)}return a!==null&&(i.getChildBoundables().remove(a),!0)}},{key:"itemsTree",value:function(){if(arguments.length===0){this.build();var i=this.itemsTree(this._root);return i===null?new ht:i}if(arguments.length===1){for(var s=arguments[0],a=new ht,h=s.getChildBoundables().iterator();h.hasNext();){var g=h.next();if(g instanceof Me){var m=this.itemsTree(g);m!==null&&a.add(m)}else g instanceof Qe?a.add(g.getItem()):ot.shouldNeverReachHere()}return a.size()<=0?null:a}}},{key:"insert",value:function(i,s){ot.isTrue(!this._built,"Cannot insert items into an STR packed R-tree after it has been built."),this._itemBoundables.add(new Qe(i,s))}},{key:"boundablesAtLevel",value:function(){if(arguments.length===1){var i=arguments[0],s=new ht;return this.boundablesAtLevel(i,this._root,s),s}if(arguments.length===3){var a=arguments[0],h=arguments[1],g=arguments[2];if(ot.isTrue(a>-2),h.getLevel()===a)return g.add(h),null;for(var m=h.getChildBoundables().iterator();m.hasNext();){var _=m.next();_ instanceof Me?this.boundablesAtLevel(a,_,g):(ot.isTrue(_ instanceof Qe),a===-1&&g.add(_))}return null}}},{key:"query",value:function(){if(arguments.length===1){var i=arguments[0];this.build();var s=new ht;return this.isEmpty()||this.getIntersectsOp().intersects(this._root.getBounds(),i)&&this.queryInternal(i,this._root,s),s}if(arguments.length===2){var a=arguments[0],h=arguments[1];if(this.build(),this.isEmpty())return null;this.getIntersectsOp().intersects(this._root.getBounds(),a)&&this.queryInternal(a,this._root,h)}}},{key:"build",value:function(){if(this._built)return null;this._root=this._itemBoundables.isEmpty()?this.createNode(0):this.createHigherLevels(this._itemBoundables,-1),this._itemBoundables=null,this._built=!0}},{key:"getRoot",value:function(){return this.build(),this._root}},{key:"remove",value:function(){if(arguments.length===2){var i=arguments[0],s=arguments[1];return this.build(),!!this.getIntersectsOp().intersects(this._root.getBounds(),i)&&this.remove(i,this._root,s)}if(arguments.length===3){var a=arguments[0],h=arguments[1],g=arguments[2],m=this.removeItem(h,g);if(m)return!0;for(var _=null,k=h.getChildBoundables().iterator();k.hasNext();){var b=k.next();if(this.getIntersectsOp().intersects(b.getBounds(),a)&&b instanceof Me&&(m=this.remove(a,b,g))){_=b;break}}return _!==null&&_.getChildBoundables().isEmpty()&&h.getChildBoundables().remove(_),m}}},{key:"createHigherLevels",value:function(i,s){ot.isTrue(!i.isEmpty());var a=this.createParentBoundables(i,s+1);return a.size()===1?a.get(0):this.createHigherLevels(a,s+1)}},{key:"depth",value:function(){if(arguments.length===0)return this.isEmpty()?0:(this.build(),this.depth(this._root));if(arguments.length===1){for(var i=0,s=arguments[0].getChildBoundables().iterator();s.hasNext();){var a=s.next();if(a instanceof Me){var h=this.depth(a);h>i&&(i=h)}}return i+1}}},{key:"createParentBoundables",value:function(i,s){ot.isTrue(!i.isEmpty());var a=new ht;a.add(this.createNode(s));var h=new ht(i);$n.sort(h,this.getComparator());for(var g=h.iterator();g.hasNext();){var m=g.next();this.lastNode(a).getChildBoundables().size()===this.getNodeCapacity()&&a.add(this.createNode(s)),this.lastNode(a).addChildBoundable(m)}return a}},{key:"isEmpty",value:function(){return this._built?this._root.isEmpty():this._itemBoundables.isEmpty()}},{key:"interfaces_",get:function(){return[E]}}],[{key:"constructor_",value:function(){if(this._root=null,this._built=!1,this._itemBoundables=new ht,this._nodeCapacity=null,arguments.length===0)u.constructor_.call(this,u.DEFAULT_NODE_CAPACITY);else if(arguments.length===1){var i=arguments[0];ot.isTrue(i>1,"Node capacity must be greater than 1"),this._nodeCapacity=i}}},{key:"compareDoubles",value:function(i,s){return i>s?1:i<s?-1:0}}])}();Jn.IntersectsOp=function(){},Jn.DEFAULT_NODE_CAPACITY=10;var Xg=function(){return c(function u(){o(this,u)},[{key:"distance",value:function(u,i){}}])}(),je=function(u){function i(){var s;return o(this,i),s=r(this,i),i.constructor_.apply(s,arguments),s}return y(i,u),c(i,[{key:"createParentBoundablesFromVerticalSlices",value:function(s,a){ot.isTrue(s.length>0);for(var h=new ht,g=0;g<s.length;g++)h.addAll(this.createParentBoundablesFromVerticalSlice(s[g],a));return h}},{key:"nearestNeighbourK",value:function(){if(arguments.length===2){var s=arguments[0],a=arguments[1];return this.nearestNeighbourK(s,Z.POSITIVE_INFINITY,a)}if(arguments.length===3){var h=arguments[0],g=arguments[2],m=arguments[1],_=new Di;_.add(h);for(var k=new Di;!_.isEmpty()&&m>=0;){var b=_.poll(),z=b.getDistance();if(z>=m)break;b.isLeaves()?k.size()<g?k.add(b):(k.peek().getDistance()>z&&(k.poll(),k.add(b)),m=k.peek().getDistance()):b.expandToQueue(_,m)}return i.getItems(k)}}},{key:"createNode",value:function(s){return new Bu(s)}},{key:"size",value:function(){return arguments.length===0?I(i,"size",this,1).call(this):I(i,"size",this,1).apply(this,arguments)}},{key:"insert",value:function(){if(!(arguments.length===2&&arguments[1]instanceof Object&&arguments[0]instanceof Dt))return I(i,"insert",this,1).apply(this,arguments);var s=arguments[0],a=arguments[1];if(s.isNull())return null;I(i,"insert",this,1).call(this,s,a)}},{key:"getIntersectsOp",value:function(){return i.intersectsOp}},{key:"verticalSlices",value:function(s,a){for(var h=Math.trunc(Math.ceil(s.size()/a)),g=new Array(a).fill(null),m=s.iterator(),_=0;_<a;_++){g[_]=new ht;for(var k=0;m.hasNext()&&k<h;){var b=m.next();g[_].add(b),k++}}return g}},{key:"query",value:function(){if(arguments.length===1){var s=arguments[0];return I(i,"query",this,1).call(this,s)}if(arguments.length===2){var a=arguments[0],h=arguments[1];I(i,"query",this,1).call(this,a,h)}}},{key:"getComparator",value:function(){return i.yComparator}},{key:"createParentBoundablesFromVerticalSlice",value:function(s,a){return I(i,"createParentBoundables",this,1).call(this,s,a)}},{key:"remove",value:function(){if(arguments.length===2&&arguments[1]instanceof Object&&arguments[0]instanceof Dt){var s=arguments[0],a=arguments[1];return I(i,"remove",this,1).call(this,s,a)}return I(i,"remove",this,1).apply(this,arguments)}},{key:"depth",value:function(){return arguments.length===0?I(i,"depth",this,1).call(this):I(i,"depth",this,1).apply(this,arguments)}},{key:"createParentBoundables",value:function(s,a){ot.isTrue(!s.isEmpty());var h=Math.trunc(Math.ceil(s.size()/this.getNodeCapacity())),g=new ht(s);$n.sort(g,i.xComparator);var m=this.verticalSlices(g,Math.trunc(Math.ceil(Math.sqrt(h))));return this.createParentBoundablesFromVerticalSlices(m,a)}},{key:"nearestNeighbour",value:function(){if(arguments.length===1){if(pt(arguments[0],Xg)){var s=arguments[0];if(this.isEmpty())return null;var a=new Kn(this.getRoot(),this.getRoot(),s);return this.nearestNeighbour(a)}if(arguments[0]instanceof Kn){var h=arguments[0],g=Z.POSITIVE_INFINITY,m=null,_=new Di;for(_.add(h);!_.isEmpty()&&g>0;){var k=_.poll(),b=k.getDistance();if(b>=g)break;k.isLeaves()?(g=b,m=k):k.expandToQueue(_,g)}return m===null?null:[m.getBoundable(0).getItem(),m.getBoundable(1).getItem()]}}else{if(arguments.length===2){var z=arguments[0],q=arguments[1];if(this.isEmpty()||z.isEmpty())return null;var V=new Kn(this.getRoot(),z.getRoot(),q);return this.nearestNeighbour(V)}if(arguments.length===3){var K=arguments[2],rt=new Qe(arguments[0],arguments[1]),lt=new Kn(this.getRoot(),rt,K);return this.nearestNeighbour(lt)[0]}if(arguments.length===4){var Nt=arguments[2],It=arguments[3],Ft=new Qe(arguments[0],arguments[1]),te=new Kn(this.getRoot(),Ft,Nt);return this.nearestNeighbourK(te,It)}}}},{key:"isWithinDistance",value:function(){if(arguments.length===2){var s=arguments[0],a=arguments[1],h=Z.POSITIVE_INFINITY,g=new Di;for(g.add(s);!g.isEmpty();){var m=g.poll(),_=m.getDistance();if(_>a)return!1;if(m.maximumDistance()<=a)return!0;if(m.isLeaves()){if((h=_)<=a)return!0}else m.expandToQueue(g,h)}return!1}if(arguments.length===3){var k=arguments[0],b=arguments[1],z=arguments[2],q=new Kn(this.getRoot(),k.getRoot(),b);return this.isWithinDistance(q,z)}}},{key:"interfaces_",get:function(){return[Yg,E]}}],[{key:"constructor_",value:function(){if(arguments.length===0)i.constructor_.call(this,i.DEFAULT_NODE_CAPACITY);else if(arguments.length===1){var s=arguments[0];Jn.constructor_.call(this,s)}}},{key:"centreX",value:function(s){return i.avg(s.getMinX(),s.getMaxX())}},{key:"avg",value:function(s,a){return(s+a)/2}},{key:"getItems",value:function(s){for(var a=new Array(s.size()).fill(null),h=0;!s.isEmpty();){var g=s.poll();a[h]=g.getBoundable(0).getItem(),h++}return a}},{key:"centreY",value:function(s){return i.avg(s.getMinY(),s.getMaxY())}}])}(Jn),Bu=function(u){function i(){var s;return o(this,i),s=r(this,i),i.constructor_.apply(s,arguments),s}return y(i,u),c(i,[{key:"computeBounds",value:function(){for(var s=null,a=this.getChildBoundables().iterator();a.hasNext();){var h=a.next();s===null?s=new Dt(h.getBounds()):s.expandToInclude(h.getBounds())}return s}}],[{key:"constructor_",value:function(){var s=arguments[0];Me.constructor_.call(this,s)}}])}(Me);je.STRtreeNode=Bu,je.xComparator=new(function(){return c(function u(){o(this,u)},[{key:"interfaces_",get:function(){return[Ot]}},{key:"compare",value:function(u,i){return Jn.compareDoubles(je.centreX(u.getBounds()),je.centreX(i.getBounds()))}}])}()),je.yComparator=new(function(){return c(function u(){o(this,u)},[{key:"interfaces_",get:function(){return[Ot]}},{key:"compare",value:function(u,i){return Jn.compareDoubles(je.centreY(u.getBounds()),je.centreY(i.getBounds()))}}])}()),je.intersectsOp=new(function(){return c(function u(){o(this,u)},[{key:"interfaces_",get:function(){return[IntersectsOp]}},{key:"intersects",value:function(u,i){return u.intersects(i)}}])}()),je.DEFAULT_NODE_CAPACITY=10;var Zg=function(){function u(){o(this,u)}return c(u,null,[{key:"relativeSign",value:function(i,s){return i<s?-1:i>s?1:0}},{key:"compare",value:function(i,s,a){if(s.equals2D(a))return 0;var h=u.relativeSign(s.x,a.x),g=u.relativeSign(s.y,a.y);switch(i){case 0:return u.compareValue(h,g);case 1:return u.compareValue(g,h);case 2:return u.compareValue(g,-h);case 3:return u.compareValue(-h,g);case 4:return u.compareValue(-h,-g);case 5:return u.compareValue(-g,-h);case 6:return u.compareValue(-g,h);case 7:return u.compareValue(h,-g)}return ot.shouldNeverReachHere("invalid octant value"),0}},{key:"compareValue",value:function(i,s){return i<0?-1:i>0?1:s<0?-1:s>0?1:0}}])}(),Hg=function(){return c(function u(){o(this,u),u.constructor_.apply(this,arguments)},[{key:"getCoordinate",value:function(){return this.coord}},{key:"print",value:function(u){u.print(this.coord),u.print(" seg # = "+this.segmentIndex)}},{key:"compareTo",value:function(u){var i=u;return this.segmentIndex<i.segmentIndex?-1:this.segmentIndex>i.segmentIndex?1:this.coord.equals2D(i.coord)?0:this._isInterior?i._isInterior?Zg.compare(this._segmentOctant,this.coord,i.coord):1:-1}},{key:"isEndPoint",value:function(u){return this.segmentIndex===0&&!this._isInterior||this.segmentIndex===u}},{key:"toString",value:function(){return this.segmentIndex+":"+this.coord.toString()}},{key:"isInterior",value:function(){return this._isInterior}},{key:"interfaces_",get:function(){return[A]}}],[{key:"constructor_",value:function(){this._segString=null,this.coord=null,this.segmentIndex=null,this._segmentOctant=null,this._isInterior=null;var u=arguments[0],i=arguments[1],s=arguments[2],a=arguments[3];this._segString=u,this.coord=new U(i),this.segmentIndex=s,this._segmentOctant=a,this._isInterior=!i.equals2D(u.getCoordinate(s))}}])}(),$g=function(){return c(function u(){o(this,u)},[{key:"hasNext",value:function(){}},{key:"next",value:function(){}},{key:"remove",value:function(){}}])}(),Kg=function(){return c(function u(){o(this,u),u.constructor_.apply(this,arguments)},[{key:"getSplitCoordinates",value:function(){var u=new Sr;this.addEndpoints();for(var i=this.iterator(),s=i.next();i.hasNext();){var a=i.next();this.addEdgeCoordinates(s,a,u),s=a}return u.toCoordinateArray()}},{key:"addCollapsedNodes",value:function(){var u=new ht;this.findCollapsesFromInsertedNodes(u),this.findCollapsesFromExistingVertices(u);for(var i=u.iterator();i.hasNext();){var s=i.next().intValue();this.add(this._edge.getCoordinate(s),s)}}},{key:"createSplitEdgePts",value:function(u,i){var s=i.segmentIndex-u.segmentIndex+2;if(s===2)return[new U(u.coord),new U(i.coord)];var a=this._edge.getCoordinate(i.segmentIndex),h=i.isInterior()||!i.coord.equals2D(a);h||s--;var g=new Array(s).fill(null),m=0;g[m++]=new U(u.coord);for(var _=u.segmentIndex+1;_<=i.segmentIndex;_++)g[m++]=this._edge.getCoordinate(_);return h&&(g[m]=new U(i.coord)),g}},{key:"print",value:function(u){u.println("Intersections:");for(var i=this.iterator();i.hasNext();)i.next().print(u)}},{key:"findCollapsesFromExistingVertices",value:function(u){for(var i=0;i<this._edge.size()-2;i++){var s=this._edge.getCoordinate(i);this._edge.getCoordinate(i+1);var a=this._edge.getCoordinate(i+2);s.equals2D(a)&&u.add(Mi.valueOf(i+1))}}},{key:"addEdgeCoordinates",value:function(u,i,s){var a=this.createSplitEdgePts(u,i);s.add(a,!1)}},{key:"iterator",value:function(){return this._nodeMap.values().iterator()}},{key:"addSplitEdges",value:function(u){this.addEndpoints(),this.addCollapsedNodes();for(var i=this.iterator(),s=i.next();i.hasNext();){var a=i.next(),h=this.createSplitEdge(s,a);u.add(h),s=a}}},{key:"findCollapseIndex",value:function(u,i,s){if(!u.coord.equals2D(i.coord))return!1;var a=i.segmentIndex-u.segmentIndex;return i.isInterior()||a--,a===1&&(s[0]=u.segmentIndex+1,!0)}},{key:"findCollapsesFromInsertedNodes",value:function(u){for(var i=new Array(1).fill(null),s=this.iterator(),a=s.next();s.hasNext();){var h=s.next();this.findCollapseIndex(a,h,i)&&u.add(Mi.valueOf(i[0])),a=h}}},{key:"getEdge",value:function(){return this._edge}},{key:"addEndpoints",value:function(){var u=this._edge.size()-1;this.add(this._edge.getCoordinate(0),0),this.add(this._edge.getCoordinate(u),u)}},{key:"createSplitEdge",value:function(u,i){var s=this.createSplitEdgePts(u,i);return new An(s,this._edge.getData())}},{key:"add",value:function(u,i){var s=new Hg(this._edge,u,i,this._edge.getSegmentOctant(i)),a=this._nodeMap.get(s);return a!==null?(ot.isTrue(a.coord.equals2D(u),"Found equal nodes with different coordinates"),a):(this._nodeMap.put(s,s),s)}},{key:"checkSplitEdgesCorrectness",value:function(u){var i=this._edge.getCoordinates(),s=u.get(0).getCoordinate(0);if(!s.equals2D(i[0]))throw new it("bad split edge start point at "+s);var a=u.get(u.size()-1).getCoordinates(),h=a[a.length-1];if(!h.equals2D(i[i.length-1]))throw new it("bad split edge end point at "+h)}}],[{key:"constructor_",value:function(){this._nodeMap=new Pr,this._edge=null;var u=arguments[0];this._edge=u}}])}(),Jg=function(){function u(){o(this,u)}return c(u,null,[{key:"octant",value:function(){if(typeof arguments[0]=="number"&&typeof arguments[1]=="number"){var i=arguments[0],s=arguments[1];if(i===0&&s===0)throw new N("Cannot compute the octant for point ( "+i+", "+s+" )");var a=Math.abs(i),h=Math.abs(s);return i>=0?s>=0?a>=h?0:1:a>=h?7:6:s>=0?a>=h?3:2:a>=h?4:5}if(arguments[0]instanceof U&&arguments[1]instanceof U){var g=arguments[0],m=arguments[1],_=m.x-g.x,k=m.y-g.y;if(_===0&&k===0)throw new N("Cannot compute the octant for two identical points "+g);return u.octant(_,k)}}}])}(),Qg=function(){return c(function u(){o(this,u)},[{key:"getCoordinates",value:function(){}},{key:"size",value:function(){}},{key:"getCoordinate",value:function(u){}},{key:"isClosed",value:function(){}},{key:"setData",value:function(u){}},{key:"getData",value:function(){}}])}(),td=function(){return c(function u(){o(this,u)},[{key:"addIntersection",value:function(u,i){}},{key:"interfaces_",get:function(){return[Qg]}}])}(),An=function(){function u(){o(this,u),u.constructor_.apply(this,arguments)}return c(u,[{key:"getCoordinates",value:function(){return this._pts}},{key:"size",value:function(){return this._pts.length}},{key:"getCoordinate",value:function(i){return this._pts[i]}},{key:"isClosed",value:function(){return this._pts[0].equals(this._pts[this._pts.length-1])}},{key:"getSegmentOctant",value:function(i){return i===this._pts.length-1?-1:this.safeOctant(this.getCoordinate(i),this.getCoordinate(i+1))}},{key:"setData",value:function(i){this._data=i}},{key:"safeOctant",value:function(i,s){return i.equals2D(s)?0:Jg.octant(i,s)}},{key:"getData",value:function(){return this._data}},{key:"addIntersection",value:function(){if(arguments.length===2){var i=arguments[0],s=arguments[1];this.addIntersectionNode(i,s)}else if(arguments.length===4){var a=arguments[1],h=arguments[3],g=new U(arguments[0].getIntersection(h));this.addIntersection(g,a)}}},{key:"toString",value:function(){return ko.toLineString(new Rr(this._pts))}},{key:"getNodeList",value:function(){return this._nodeList}},{key:"addIntersectionNode",value:function(i,s){var a=s,h=a+1;if(h<this._pts.length){var g=this._pts[h];i.equals2D(g)&&(a=h)}return this._nodeList.add(i,a)}},{key:"addIntersections",value:function(i,s,a){for(var h=0;h<i.getIntersectionNum();h++)this.addIntersection(i,s,a,h)}},{key:"interfaces_",get:function(){return[td]}}],[{key:"constructor_",value:function(){this._nodeList=new Kg(this),this._pts=null,this._data=null;var i=arguments[0],s=arguments[1];this._pts=i,this._data=s}},{key:"getNodedSubstrings",value:function(){if(arguments.length===1){var i=arguments[0],s=new ht;return u.getNodedSubstrings(i,s),s}if(arguments.length===2)for(var a=arguments[1],h=arguments[0].iterator();h.hasNext();)h.next().getNodeList().addSplitEdges(a)}}])}(),me=function(){function u(){o(this,u),u.constructor_.apply(this,arguments)}return c(u,[{key:"minX",value:function(){return Math.min(this.p0.x,this.p1.x)}},{key:"orientationIndex",value:function(){if(arguments[0]instanceof u){var i=arguments[0],s=dt.index(this.p0,this.p1,i.p0),a=dt.index(this.p0,this.p1,i.p1);return s>=0&&a>=0||s<=0&&a<=0?Math.max(s,a):0}if(arguments[0]instanceof U){var h=arguments[0];return dt.index(this.p0,this.p1,h)}}},{key:"toGeometry",value:function(i){return i.createLineString([this.p0,this.p1])}},{key:"isVertical",value:function(){return this.p0.x===this.p1.x}},{key:"equals",value:function(i){if(!(i instanceof u))return!1;var s=i;return this.p0.equals(s.p0)&&this.p1.equals(s.p1)}},{key:"intersection",value:function(i){var s=new Ln;return s.computeIntersection(this.p0,this.p1,i.p0,i.p1),s.hasIntersection()?s.getIntersection(0):null}},{key:"project",value:function(){if(arguments[0]instanceof U){var i=arguments[0];if(i.equals(this.p0)||i.equals(this.p1))return new U(i);var s=this.projectionFactor(i),a=new U;return a.x=this.p0.x+s*(this.p1.x-this.p0.x),a.y=this.p0.y+s*(this.p1.y-this.p0.y),a}if(arguments[0]instanceof u){var h=arguments[0],g=this.projectionFactor(h.p0),m=this.projectionFactor(h.p1);if(g>=1&&m>=1||g<=0&&m<=0)return null;var _=this.project(h.p0);g<0&&(_=this.p0),g>1&&(_=this.p1);var k=this.project(h.p1);return m<0&&(k=this.p0),m>1&&(k=this.p1),new u(_,k)}}},{key:"normalize",value:function(){this.p1.compareTo(this.p0)<0&&this.reverse()}},{key:"angle",value:function(){return Math.atan2(this.p1.y-this.p0.y,this.p1.x-this.p0.x)}},{key:"getCoordinate",value:function(i){return i===0?this.p0:this.p1}},{key:"distancePerpendicular",value:function(i){return qe.pointToLinePerpendicular(i,this.p0,this.p1)}},{key:"minY",value:function(){return Math.min(this.p0.y,this.p1.y)}},{key:"midPoint",value:function(){return u.midPoint(this.p0,this.p1)}},{key:"projectionFactor",value:function(i){if(i.equals(this.p0))return 0;if(i.equals(this.p1))return 1;var s=this.p1.x-this.p0.x,a=this.p1.y-this.p0.y,h=s*s+a*a;return h<=0?Z.NaN:((i.x-this.p0.x)*s+(i.y-this.p0.y)*a)/h}},{key:"closestPoints",value:function(i){var s=this.intersection(i);if(s!==null)return[s,s];var a=new Array(2).fill(null),h=Z.MAX_VALUE,g=null,m=this.closestPoint(i.p0);h=m.distance(i.p0),a[0]=m,a[1]=i.p0;var _=this.closestPoint(i.p1);(g=_.distance(i.p1))<h&&(h=g,a[0]=_,a[1]=i.p1);var k=i.closestPoint(this.p0);(g=k.distance(this.p0))<h&&(h=g,a[0]=this.p0,a[1]=k);var b=i.closestPoint(this.p1);return(g=b.distance(this.p1))<h&&(h=g,a[0]=this.p1,a[1]=b),a}},{key:"closestPoint",value:function(i){var s=this.projectionFactor(i);return s>0&&s<1?this.project(i):this.p0.distance(i)<this.p1.distance(i)?this.p0:this.p1}},{key:"maxX",value:function(){return Math.max(this.p0.x,this.p1.x)}},{key:"getLength",value:function(){return this.p0.distance(this.p1)}},{key:"compareTo",value:function(i){var s=i,a=this.p0.compareTo(s.p0);return a!==0?a:this.p1.compareTo(s.p1)}},{key:"reverse",value:function(){var i=this.p0;this.p0=this.p1,this.p1=i}},{key:"equalsTopo",value:function(i){return this.p0.equals(i.p0)&&this.p1.equals(i.p1)||this.p0.equals(i.p1)&&this.p1.equals(i.p0)}},{key:"lineIntersection",value:function(i){return po.intersection(this.p0,this.p1,i.p0,i.p1)}},{key:"maxY",value:function(){return Math.max(this.p0.y,this.p1.y)}},{key:"pointAlongOffset",value:function(i,s){var a=this.p0.x+i*(this.p1.x-this.p0.x),h=this.p0.y+i*(this.p1.y-this.p0.y),g=this.p1.x-this.p0.x,m=this.p1.y-this.p0.y,_=Math.sqrt(g*g+m*m),k=0,b=0;if(s!==0){if(_<=0)throw new IllegalStateException("Cannot compute offset from zero-length line segment");k=s*g/_,b=s*m/_}return new U(a-b,h+k)}},{key:"setCoordinates",value:function(){if(arguments.length===1){var i=arguments[0];this.setCoordinates(i.p0,i.p1)}else if(arguments.length===2){var s=arguments[0],a=arguments[1];this.p0.x=s.x,this.p0.y=s.y,this.p1.x=a.x,this.p1.y=a.y}}},{key:"segmentFraction",value:function(i){var s=this.projectionFactor(i);return s<0?s=0:(s>1||Z.isNaN(s))&&(s=1),s}},{key:"toString",value:function(){return"LINESTRING( "+this.p0.x+" "+this.p0.y+", "+this.p1.x+" "+this.p1.y+")"}},{key:"isHorizontal",value:function(){return this.p0.y===this.p1.y}},{key:"reflect",value:function(i){var s=this.p1.getY()-this.p0.getY(),a=this.p0.getX()-this.p1.getX(),h=this.p0.getY()*(this.p1.getX()-this.p0.getX())-this.p0.getX()*(this.p1.getY()-this.p0.getY()),g=s*s+a*a,m=s*s-a*a,_=i.getX(),k=i.getY();return new U((-m*_-2*s*a*k-2*s*h)/g,(m*k-2*s*a*_-2*a*h)/g)}},{key:"distance",value:function(){if(arguments[0]instanceof u){var i=arguments[0];return qe.segmentToSegment(this.p0,this.p1,i.p0,i.p1)}if(arguments[0]instanceof U){var s=arguments[0];return qe.pointToSegment(s,this.p0,this.p1)}}},{key:"pointAlong",value:function(i){var s=new U;return s.x=this.p0.x+i*(this.p1.x-this.p0.x),s.y=this.p0.y+i*(this.p1.y-this.p0.y),s}},{key:"hashCode",value:function(){var i=Z.doubleToLongBits(this.p0.x);i^=31*Z.doubleToLongBits(this.p0.y);var s=Math.trunc(i)^Math.trunc(i>>32),a=Z.doubleToLongBits(this.p1.x);return a^=31*Z.doubleToLongBits(this.p1.y),s^(Math.trunc(a)^Math.trunc(a>>32))}},{key:"interfaces_",get:function(){return[A,E]}}],[{key:"constructor_",value:function(){if(this.p0=null,this.p1=null,arguments.length===0)u.constructor_.call(this,new U,new U);else if(arguments.length===1){var i=arguments[0];u.constructor_.call(this,i.p0,i.p1)}else if(arguments.length===2){var s=arguments[0],a=arguments[1];this.p0=s,this.p1=a}else if(arguments.length===4){var h=arguments[0],g=arguments[1],m=arguments[2],_=arguments[3];u.constructor_.call(this,new U(h,g),new U(m,_))}}},{key:"midPoint",value:function(i,s){return new U((i.x+s.x)/2,(i.y+s.y)/2)}}])}(),ed=function(){return c(function u(){o(this,u),u.constructor_.apply(this,arguments)},[{key:"overlap",value:function(){if(arguments.length!==2){if(arguments.length===4){var u=arguments[1],i=arguments[2],s=arguments[3];arguments[0].getLineSegment(u,this._overlapSeg1),i.getLineSegment(s,this._overlapSeg2),this.overlap(this._overlapSeg1,this._overlapSeg2)}}}}],[{key:"constructor_",value:function(){this._overlapSeg1=new me,this._overlapSeg2=new me}}])}(),zu=function(){return c(function u(){o(this,u),u.constructor_.apply(this,arguments)},[{key:"getLineSegment",value:function(u,i){i.p0=this._pts[u],i.p1=this._pts[u+1]}},{key:"computeSelect",value:function(u,i,s,a){var h=this._pts[i],g=this._pts[s];if(s-i==1)return a.select(this,i),null;if(!u.intersects(h,g))return null;var m=Math.trunc((i+s)/2);i<m&&this.computeSelect(u,i,m,a),m<s&&this.computeSelect(u,m,s,a)}},{key:"getCoordinates",value:function(){for(var u=new Array(this._end-this._start+1).fill(null),i=0,s=this._start;s<=this._end;s++)u[i++]=this._pts[s];return u}},{key:"computeOverlaps",value:function(){if(arguments.length===2){var u=arguments[0],i=arguments[1];this.computeOverlaps(this._start,this._end,u,u._start,u._end,i)}else if(arguments.length===6){var s=arguments[0],a=arguments[1],h=arguments[2],g=arguments[3],m=arguments[4],_=arguments[5];if(a-s==1&&m-g==1)return _.overlap(this,s,h,g),null;if(!this.overlaps(s,a,h,g,m))return null;var k=Math.trunc((s+a)/2),b=Math.trunc((g+m)/2);s<k&&(g<b&&this.computeOverlaps(s,k,h,g,b,_),b<m&&this.computeOverlaps(s,k,h,b,m,_)),k<a&&(g<b&&this.computeOverlaps(k,a,h,g,b,_),b<m&&this.computeOverlaps(k,a,h,b,m,_))}}},{key:"setId",value:function(u){this._id=u}},{key:"select",value:function(u,i){this.computeSelect(u,this._start,this._end,i)}},{key:"getEnvelope",value:function(){if(this._env===null){var u=this._pts[this._start],i=this._pts[this._end];this._env=new Dt(u,i)}return this._env}},{key:"overlaps",value:function(u,i,s,a,h){return Dt.intersects(this._pts[u],this._pts[i],s._pts[a],s._pts[h])}},{key:"getEndIndex",value:function(){return this._end}},{key:"getStartIndex",value:function(){return this._start}},{key:"getContext",value:function(){return this._context}},{key:"getId",value:function(){return this._id}}],[{key:"constructor_",value:function(){this._pts=null,this._start=null,this._end=null,this._env=null,this._context=null,this._id=null;var u=arguments[0],i=arguments[1],s=arguments[2],a=arguments[3];this._pts=u,this._start=i,this._end=s,this._context=a}}])}(),nd=function(){function u(){o(this,u)}return c(u,null,[{key:"findChainEnd",value:function(i,s){for(var a=s;a<i.length-1&&i[a].equals2D(i[a+1]);)a++;if(a>=i.length-1)return i.length-1;for(var h=oe.quadrant(i[a],i[a+1]),g=s+1;g<i.length&&!(!i[g-1].equals2D(i[g])&&oe.quadrant(i[g-1],i[g])!==h);)g++;return g-1}},{key:"getChains",value:function(){if(arguments.length===1){var i=arguments[0];return u.getChains(i,null)}if(arguments.length===2){var s=arguments[0],a=arguments[1],h=new ht,g=0;do{var m=u.findChainEnd(s,g),_=new zu(s,g,m,a);h.add(_),g=m}while(g<s.length-1);return h}}}])}(),bo=function(){return c(function u(){o(this,u)},[{key:"computeNodes",value:function(u){}},{key:"getNodedSubstrings",value:function(){}}])}(),qu=function(){return c(function u(){o(this,u),u.constructor_.apply(this,arguments)},[{key:"setSegmentIntersector",value:function(u){this._segInt=u}},{key:"interfaces_",get:function(){return[bo]}}],[{key:"constructor_",value:function(){if(this._segInt=null,arguments.length!==0){if(arguments.length===1){var u=arguments[0];this.setSegmentIntersector(u)}}}}])}(),No=function(u){function i(){var s;return o(this,i),s=r(this,i),i.constructor_.apply(s,arguments),s}return y(i,u),c(i,[{key:"getMonotoneChains",value:function(){return this._monoChains}},{key:"getNodedSubstrings",value:function(){return An.getNodedSubstrings(this._nodedSegStrings)}},{key:"getIndex",value:function(){return this._index}},{key:"add",value:function(s){for(var a=nd.getChains(s.getCoordinates(),s).iterator();a.hasNext();){var h=a.next();h.setId(this._idCounter++),this._index.insert(h.getEnvelope(),h),this._monoChains.add(h)}}},{key:"computeNodes",value:function(s){this._nodedSegStrings=s;for(var a=s.iterator();a.hasNext();)this.add(a.next());this.intersectChains()}},{key:"intersectChains",value:function(){for(var s=new Uu(this._segInt),a=this._monoChains.iterator();a.hasNext();)for(var h=a.next(),g=this._index.query(h.getEnvelope()).iterator();g.hasNext();){var m=g.next();if(m.getId()>h.getId()&&(h.computeOverlaps(m,s),this._nOverlaps++),this._segInt.isDone())return null}}}],[{key:"constructor_",value:function(){if(this._monoChains=new ht,this._index=new je,this._idCounter=0,this._nodedSegStrings=null,this._nOverlaps=0,arguments.length!==0){if(arguments.length===1){var s=arguments[0];qu.constructor_.call(this,s)}}}}])}(qu),Uu=function(u){function i(){var s;return o(this,i),s=r(this,i),i.constructor_.apply(s,arguments),s}return y(i,u),c(i,[{key:"overlap",value:function(){if(arguments.length!==4)return I(i,"overlap",this,1).apply(this,arguments);var s=arguments[1],a=arguments[2],h=arguments[3],g=arguments[0].getContext(),m=a.getContext();this._si.processIntersections(g,s,m,h)}}],[{key:"constructor_",value:function(){this._si=null;var s=arguments[0];this._si=s}}])}(ed);No.SegmentOverlapAction=Uu;var Le=function(){function u(){o(this,u),u.constructor_.apply(this,arguments)}return c(u,[{key:"isDeletable",value:function(i,s,a,h){var g=this._inputLine[i],m=this._inputLine[s],_=this._inputLine[a];return!!this.isConcave(g,m,_)&&!!this.isShallow(g,m,_,h)&&this.isShallowSampled(g,m,i,a,h)}},{key:"deleteShallowConcavities",value:function(){for(var i=1,s=this.findNextNonDeletedIndex(i),a=this.findNextNonDeletedIndex(s),h=!1;a<this._inputLine.length;){var g=!1;this.isDeletable(i,s,a,this._distanceTol)&&(this._isDeleted[s]=u.DELETE,g=!0,h=!0),i=g?a:s,s=this.findNextNonDeletedIndex(i),a=this.findNextNonDeletedIndex(s)}return h}},{key:"isShallowConcavity",value:function(i,s,a,h){return dt.index(i,s,a)===this._angleOrientation&&qe.pointToSegment(s,i,a)<h}},{key:"isShallowSampled",value:function(i,s,a,h,g){var m=Math.trunc((h-a)/u.NUM_PTS_TO_CHECK);m<=0&&(m=1);for(var _=a;_<h;_+=m)if(!this.isShallow(i,s,this._inputLine[_],g))return!1;return!0}},{key:"isConcave",value:function(i,s,a){var h=dt.index(i,s,a)===this._angleOrientation;return h}},{key:"simplify",value:function(i){this._distanceTol=Math.abs(i),i<0&&(this._angleOrientation=dt.CLOCKWISE),this._isDeleted=new Array(this._inputLine.length).fill(null);var s=!1;do s=this.deleteShallowConcavities();while(s);return this.collapseLine()}},{key:"findNextNonDeletedIndex",value:function(i){for(var s=i+1;s<this._inputLine.length&&this._isDeleted[s]===u.DELETE;)s++;return s}},{key:"isShallow",value:function(i,s,a,h){return qe.pointToSegment(s,i,a)<h}},{key:"collapseLine",value:function(){for(var i=new Sr,s=0;s<this._inputLine.length;s++)this._isDeleted[s]!==u.DELETE&&i.add(this._inputLine[s]);return i.toCoordinateArray()}}],[{key:"constructor_",value:function(){this._inputLine=null,this._distanceTol=null,this._isDeleted=null,this._angleOrientation=dt.COUNTERCLOCKWISE;var i=arguments[0];this._inputLine=i}},{key:"simplify",value:function(i,s){return new u(i).simplify(s)}}])}();Le.INIT=0,Le.DELETE=1,Le.KEEP=1,Le.NUM_PTS_TO_CHECK=10;var ju=function(){function u(){o(this,u),u.constructor_.apply(this,arguments)}return c(u,[{key:"getCoordinates",value:function(){return this._ptList.toArray(u.COORDINATE_ARRAY_TYPE)}},{key:"setPrecisionModel",value:function(i){this._precisionModel=i}},{key:"addPt",value:function(i){var s=new U(i);if(this._precisionModel.makePrecise(s),this.isRedundant(s))return null;this._ptList.add(s)}},{key:"reverse",value:function(){}},{key:"addPts",value:function(i,s){if(s)for(var a=0;a<i.length;a++)this.addPt(i[a]);else for(var h=i.length-1;h>=0;h--)this.addPt(i[h])}},{key:"isRedundant",value:function(i){if(this._ptList.size()<1)return!1;var s=this._ptList.get(this._ptList.size()-1);return i.distance(s)<this._minimimVertexDistance}},{key:"toString",value:function(){return new Zn().createLineString(this.getCoordinates()).toString()}},{key:"closeRing",value:function(){if(this._ptList.size()<1)return null;var i=new U(this._ptList.get(0)),s=this._ptList.get(this._ptList.size()-1);if(i.equals(s))return null;this._ptList.add(i)}},{key:"setMinimumVertexDistance",value:function(i){this._minimimVertexDistance=i}}],[{key:"constructor_",value:function(){this._ptList=null,this._precisionModel=null,this._minimimVertexDistance=0,this._ptList=new ht}}])}();ju.COORDINATE_ARRAY_TYPE=new Array(0).fill(null);var ve=function(){function u(){o(this,u)}return c(u,null,[{key:"toDegrees",value:function(i){return 180*i/Math.PI}},{key:"normalize",value:function(i){for(;i>Math.PI;)i-=u.PI_TIMES_2;for(;i<=-Math.PI;)i+=u.PI_TIMES_2;return i}},{key:"angle",value:function(){if(arguments.length===1){var i=arguments[0];return Math.atan2(i.y,i.x)}if(arguments.length===2){var s=arguments[0],a=arguments[1],h=a.x-s.x,g=a.y-s.y;return Math.atan2(g,h)}}},{key:"isAcute",value:function(i,s,a){var h=i.x-s.x,g=i.y-s.y;return h*(a.x-s.x)+g*(a.y-s.y)>0}},{key:"isObtuse",value:function(i,s,a){var h=i.x-s.x,g=i.y-s.y;return h*(a.x-s.x)+g*(a.y-s.y)<0}},{key:"interiorAngle",value:function(i,s,a){var h=u.angle(s,i),g=u.angle(s,a);return Math.abs(g-h)}},{key:"normalizePositive",value:function(i){if(i<0){for(;i<0;)i+=u.PI_TIMES_2;i>=u.PI_TIMES_2&&(i=0)}else{for(;i>=u.PI_TIMES_2;)i-=u.PI_TIMES_2;i<0&&(i=0)}return i}},{key:"angleBetween",value:function(i,s,a){var h=u.angle(s,i),g=u.angle(s,a);return u.diff(h,g)}},{key:"diff",value:function(i,s){var a=null;return(a=i<s?s-i:i-s)>Math.PI&&(a=2*Math.PI-a),a}},{key:"toRadians",value:function(i){return i*Math.PI/180}},{key:"getTurn",value:function(i,s){var a=Math.sin(s-i);return a>0?u.COUNTERCLOCKWISE:a<0?u.CLOCKWISE:u.NONE}},{key:"angleBetweenOriented",value:function(i,s,a){var h=u.angle(s,i),g=u.angle(s,a)-h;return g<=-Math.PI?g+u.PI_TIMES_2:g>Math.PI?g-u.PI_TIMES_2:g}}])}();ve.PI_TIMES_2=2*Math.PI,ve.PI_OVER_2=Math.PI/2,ve.PI_OVER_4=Math.PI/4,ve.COUNTERCLOCKWISE=dt.COUNTERCLOCKWISE,ve.CLOCKWISE=dt.CLOCKWISE,ve.NONE=dt.COLLINEAR;var Lr=function(){function u(){o(this,u),u.constructor_.apply(this,arguments)}return c(u,[{key:"addNextSegment",value:function(i,s){if(this._s0=this._s1,this._s1=this._s2,this._s2=i,this._seg0.setCoordinates(this._s0,this._s1),this.computeOffsetSegment(this._seg0,this._side,this._distance,this._offset0),this._seg1.setCoordinates(this._s1,this._s2),this.computeOffsetSegment(this._seg1,this._side,this._distance,this._offset1),this._s1.equals(this._s2))return null;var a=dt.index(this._s0,this._s1,this._s2),h=a===dt.CLOCKWISE&&this._side===X.LEFT||a===dt.COUNTERCLOCKWISE&&this._side===X.RIGHT;a===0?this.addCollinear(s):h?this.addOutsideTurn(a,s):this.addInsideTurn(a,s)}},{key:"addLineEndCap",value:function(i,s){var a=new me(i,s),h=new me;this.computeOffsetSegment(a,X.LEFT,this._distance,h);var g=new me;this.computeOffsetSegment(a,X.RIGHT,this._distance,g);var m=s.x-i.x,_=s.y-i.y,k=Math.atan2(_,m);switch(this._bufParams.getEndCapStyle()){case w.CAP_ROUND:this._segList.addPt(h.p1),this.addDirectedFillet(s,k+Math.PI/2,k-Math.PI/2,dt.CLOCKWISE,this._distance),this._segList.addPt(g.p1);break;case w.CAP_FLAT:this._segList.addPt(h.p1),this._segList.addPt(g.p1);break;case w.CAP_SQUARE:var b=new U;b.x=Math.abs(this._distance)*Math.cos(k),b.y=Math.abs(this._distance)*Math.sin(k);var z=new U(h.p1.x+b.x,h.p1.y+b.y),q=new U(g.p1.x+b.x,g.p1.y+b.y);this._segList.addPt(z),this._segList.addPt(q)}}},{key:"getCoordinates",value:function(){return this._segList.getCoordinates()}},{key:"addMitreJoin",value:function(i,s,a,h){var g=po.intersection(s.p0,s.p1,a.p0,a.p1);if(g!==null&&(h<=0?1:g.distance(i)/Math.abs(h))<=this._bufParams.getMitreLimit())return this._segList.addPt(g),null;this.addLimitedMitreJoin(s,a,h,this._bufParams.getMitreLimit())}},{key:"addOutsideTurn",value:function(i,s){if(this._offset0.p1.distance(this._offset1.p0)<this._distance*u.OFFSET_SEGMENT_SEPARATION_FACTOR)return this._segList.addPt(this._offset0.p1),null;this._bufParams.getJoinStyle()===w.JOIN_MITRE?this.addMitreJoin(this._s1,this._offset0,this._offset1,this._distance):this._bufParams.getJoinStyle()===w.JOIN_BEVEL?this.addBevelJoin(this._offset0,this._offset1):(s&&this._segList.addPt(this._offset0.p1),this.addCornerFillet(this._s1,this._offset0.p1,this._offset1.p0,i,this._distance),this._segList.addPt(this._offset1.p0))}},{key:"createSquare",value:function(i){this._segList.addPt(new U(i.x+this._distance,i.y+this._distance)),this._segList.addPt(new U(i.x+this._distance,i.y-this._distance)),this._segList.addPt(new U(i.x-this._distance,i.y-this._distance)),this._segList.addPt(new U(i.x-this._distance,i.y+this._distance)),this._segList.closeRing()}},{key:"addSegments",value:function(i,s){this._segList.addPts(i,s)}},{key:"addFirstSegment",value:function(){this._segList.addPt(this._offset1.p0)}},{key:"addCornerFillet",value:function(i,s,a,h,g){var m=s.x-i.x,_=s.y-i.y,k=Math.atan2(_,m),b=a.x-i.x,z=a.y-i.y,q=Math.atan2(z,b);h===dt.CLOCKWISE?k<=q&&(k+=2*Math.PI):k>=q&&(k-=2*Math.PI),this._segList.addPt(s),this.addDirectedFillet(i,k,q,h,g),this._segList.addPt(a)}},{key:"addLastSegment",value:function(){this._segList.addPt(this._offset1.p1)}},{key:"initSideSegments",value:function(i,s,a){this._s1=i,this._s2=s,this._side=a,this._seg1.setCoordinates(i,s),this.computeOffsetSegment(this._seg1,a,this._distance,this._offset1)}},{key:"addLimitedMitreJoin",value:function(i,s,a,h){var g=this._seg0.p1,m=ve.angle(g,this._seg0.p0),_=ve.angleBetweenOriented(this._seg0.p0,g,this._seg1.p1)/2,k=ve.normalize(m+_),b=ve.normalize(k+Math.PI),z=h*a,q=a-z*Math.abs(Math.sin(_)),V=g.x+z*Math.cos(b),K=g.y+z*Math.sin(b),rt=new U(V,K),lt=new me(g,rt),Nt=lt.pointAlongOffset(1,q),It=lt.pointAlongOffset(1,-q);this._side===X.LEFT?(this._segList.addPt(Nt),this._segList.addPt(It)):(this._segList.addPt(It),this._segList.addPt(Nt))}},{key:"addDirectedFillet",value:function(i,s,a,h,g){var m=h===dt.CLOCKWISE?-1:1,_=Math.abs(s-a),k=Math.trunc(_/this._filletAngleQuantum+.5);if(k<1)return null;for(var b=_/k,z=new U,q=0;q<k;q++){var V=s+m*q*b;z.x=i.x+g*Math.cos(V),z.y=i.y+g*Math.sin(V),this._segList.addPt(z)}}},{key:"computeOffsetSegment",value:function(i,s,a,h){var g=s===X.LEFT?1:-1,m=i.p1.x-i.p0.x,_=i.p1.y-i.p0.y,k=Math.sqrt(m*m+_*_),b=g*a*m/k,z=g*a*_/k;h.p0.x=i.p0.x-z,h.p0.y=i.p0.y+b,h.p1.x=i.p1.x-z,h.p1.y=i.p1.y+b}},{key:"addInsideTurn",value:function(i,s){if(this._li.computeIntersection(this._offset0.p0,this._offset0.p1,this._offset1.p0,this._offset1.p1),this._li.hasIntersection())this._segList.addPt(this._li.getIntersection(0));else if(this._hasNarrowConcaveAngle=!0,this._offset0.p1.distance(this._offset1.p0)<this._distance*u.INSIDE_TURN_VERTEX_SNAP_DISTANCE_FACTOR)this._segList.addPt(this._offset0.p1);else{if(this._segList.addPt(this._offset0.p1),this._closingSegLengthFactor>0){var a=new U((this._closingSegLengthFactor*this._offset0.p1.x+this._s1.x)/(this._closingSegLengthFactor+1),(this._closingSegLengthFactor*this._offset0.p1.y+this._s1.y)/(this._closingSegLengthFactor+1));this._segList.addPt(a);var h=new U((this._closingSegLengthFactor*this._offset1.p0.x+this._s1.x)/(this._closingSegLengthFactor+1),(this._closingSegLengthFactor*this._offset1.p0.y+this._s1.y)/(this._closingSegLengthFactor+1));this._segList.addPt(h)}else this._segList.addPt(this._s1);this._segList.addPt(this._offset1.p0)}}},{key:"createCircle",value:function(i){var s=new U(i.x+this._distance,i.y);this._segList.addPt(s),this.addDirectedFillet(i,0,2*Math.PI,-1,this._distance),this._segList.closeRing()}},{key:"addBevelJoin",value:function(i,s){this._segList.addPt(i.p1),this._segList.addPt(s.p0)}},{key:"init",value:function(i){this._distance=i,this._maxCurveSegmentError=i*(1-Math.cos(this._filletAngleQuantum/2)),this._segList=new ju,this._segList.setPrecisionModel(this._precisionModel),this._segList.setMinimumVertexDistance(i*u.CURVE_VERTEX_SNAP_DISTANCE_FACTOR)}},{key:"addCollinear",value:function(i){this._li.computeIntersection(this._s0,this._s1,this._s1,this._s2),this._li.getIntersectionNum()>=2&&(this._bufParams.getJoinStyle()===w.JOIN_BEVEL||this._bufParams.getJoinStyle()===w.JOIN_MITRE?(i&&this._segList.addPt(this._offset0.p1),this._segList.addPt(this._offset1.p0)):this.addCornerFillet(this._s1,this._offset0.p1,this._offset1.p0,dt.CLOCKWISE,this._distance))}},{key:"closeRing",value:function(){this._segList.closeRing()}},{key:"hasNarrowConcaveAngle",value:function(){return this._hasNarrowConcaveAngle}}],[{key:"constructor_",value:function(){this._maxCurveSegmentError=0,this._filletAngleQuantum=null,this._closingSegLengthFactor=1,this._segList=null,this._distance=0,this._precisionModel=null,this._bufParams=null,this._li=null,this._s0=null,this._s1=null,this._s2=null,this._seg0=new me,this._seg1=new me,this._offset0=new me,this._offset1=new me,this._side=0,this._hasNarrowConcaveAngle=!1;var i=arguments[0],s=arguments[1],a=arguments[2];this._precisionModel=i,this._bufParams=s,this._li=new Ln,this._filletAngleQuantum=Math.PI/2/s.getQuadrantSegments(),s.getQuadrantSegments()>=8&&s.getJoinStyle()===w.JOIN_ROUND&&(this._closingSegLengthFactor=u.MAX_CLOSING_SEG_LEN_FACTOR),this.init(a)}}])}();Lr.OFFSET_SEGMENT_SEPARATION_FACTOR=.001,Lr.INSIDE_TURN_VERTEX_SNAP_DISTANCE_FACTOR=.001,Lr.CURVE_VERTEX_SNAP_DISTANCE_FACTOR=1e-6,Lr.MAX_CLOSING_SEG_LEN_FACTOR=80;var rd=function(){function u(){o(this,u),u.constructor_.apply(this,arguments)}return c(u,[{key:"getOffsetCurve",value:function(i,s){if(this._distance=s,s===0)return null;var a=s<0,h=Math.abs(s),g=this.getSegGen(h);i.length<=1?this.computePointCurve(i[0],g):this.computeOffsetCurve(i,a,g);var m=g.getCoordinates();return a&&Ht.reverse(m),m}},{key:"computeSingleSidedBufferCurve",value:function(i,s,a){var h=this.simplifyTolerance(this._distance);if(s){a.addSegments(i,!0);var g=Le.simplify(i,-h),m=g.length-1;a.initSideSegments(g[m],g[m-1],X.LEFT),a.addFirstSegment();for(var _=m-2;_>=0;_--)a.addNextSegment(g[_],!0)}else{a.addSegments(i,!1);var k=Le.simplify(i,h),b=k.length-1;a.initSideSegments(k[0],k[1],X.LEFT),a.addFirstSegment();for(var z=2;z<=b;z++)a.addNextSegment(k[z],!0)}a.addLastSegment(),a.closeRing()}},{key:"computeRingBufferCurve",value:function(i,s,a){var h=this.simplifyTolerance(this._distance);s===X.RIGHT&&(h=-h);var g=Le.simplify(i,h),m=g.length-1;a.initSideSegments(g[m-1],g[0],s);for(var _=1;_<=m;_++){var k=_!==1;a.addNextSegment(g[_],k)}a.closeRing()}},{key:"computeLineBufferCurve",value:function(i,s){var a=this.simplifyTolerance(this._distance),h=Le.simplify(i,a),g=h.length-1;s.initSideSegments(h[0],h[1],X.LEFT);for(var m=2;m<=g;m++)s.addNextSegment(h[m],!0);s.addLastSegment(),s.addLineEndCap(h[g-1],h[g]);var _=Le.simplify(i,-a),k=_.length-1;s.initSideSegments(_[k],_[k-1],X.LEFT);for(var b=k-2;b>=0;b--)s.addNextSegment(_[b],!0);s.addLastSegment(),s.addLineEndCap(_[1],_[0]),s.closeRing()}},{key:"computePointCurve",value:function(i,s){switch(this._bufParams.getEndCapStyle()){case w.CAP_ROUND:s.createCircle(i);break;case w.CAP_SQUARE:s.createSquare(i)}}},{key:"getLineCurve",value:function(i,s){if(this._distance=s,this.isLineOffsetEmpty(s))return null;var a=Math.abs(s),h=this.getSegGen(a);if(i.length<=1)this.computePointCurve(i[0],h);else if(this._bufParams.isSingleSided()){var g=s<0;this.computeSingleSidedBufferCurve(i,g,h)}else this.computeLineBufferCurve(i,h);return h.getCoordinates()}},{key:"getBufferParameters",value:function(){return this._bufParams}},{key:"simplifyTolerance",value:function(i){return i*this._bufParams.getSimplifyFactor()}},{key:"getRingCurve",value:function(i,s,a){if(this._distance=a,i.length<=2)return this.getLineCurve(i,a);if(a===0)return u.copyCoordinates(i);var h=this.getSegGen(a);return this.computeRingBufferCurve(i,s,h),h.getCoordinates()}},{key:"computeOffsetCurve",value:function(i,s,a){var h=this.simplifyTolerance(this._distance);if(s){var g=Le.simplify(i,-h),m=g.length-1;a.initSideSegments(g[m],g[m-1],X.LEFT),a.addFirstSegment();for(var _=m-2;_>=0;_--)a.addNextSegment(g[_],!0)}else{var k=Le.simplify(i,h),b=k.length-1;a.initSideSegments(k[0],k[1],X.LEFT),a.addFirstSegment();for(var z=2;z<=b;z++)a.addNextSegment(k[z],!0)}a.addLastSegment()}},{key:"isLineOffsetEmpty",value:function(i){return i===0||i<0&&!this._bufParams.isSingleSided()}},{key:"getSegGen",value:function(i){return new Lr(this._precisionModel,this._bufParams,i)}}],[{key:"constructor_",value:function(){this._distance=0,this._precisionModel=null,this._bufParams=null;var i=arguments[0],s=arguments[1];this._precisionModel=i,this._bufParams=s}},{key:"copyCoordinates",value:function(i){for(var s=new Array(i.length).fill(null),a=0;a<s.length;a++)s[a]=new U(i[a]);return s}}])}(),Vu=function(){return c(function u(){o(this,u),u.constructor_.apply(this,arguments)},[{key:"findStabbedSegments",value:function(){if(arguments.length===1){for(var u=arguments[0],i=new ht,s=this._subgraphs.iterator();s.hasNext();){var a=s.next(),h=a.getEnvelope();u.y<h.getMinY()||u.y>h.getMaxY()||this.findStabbedSegments(u,a.getDirectedEdges(),i)}return i}if(arguments.length===3){if(pt(arguments[2],Nn)&&arguments[0]instanceof U&&arguments[1]instanceof Mo){for(var g=arguments[0],m=arguments[1],_=arguments[2],k=m.getEdge().getCoordinates(),b=0;b<k.length-1;b++)if(this._seg.p0=k[b],this._seg.p1=k[b+1],this._seg.p0.y>this._seg.p1.y&&this._seg.reverse(),!(Math.max(this._seg.p0.x,this._seg.p1.x)<g.x||this._seg.isHorizontal()||g.y<this._seg.p0.y||g.y>this._seg.p1.y||dt.index(this._seg.p0,this._seg.p1,g)===dt.RIGHT)){var z=m.getDepth(X.LEFT);this._seg.p0.equals(k[b])||(z=m.getDepth(X.RIGHT));var q=new Yu(this._seg,z);_.add(q)}}else if(pt(arguments[2],Nn)&&arguments[0]instanceof U&&pt(arguments[1],Nn))for(var V=arguments[0],K=arguments[2],rt=arguments[1].iterator();rt.hasNext();){var lt=rt.next();lt.isForward()&&this.findStabbedSegments(V,lt,K)}}}},{key:"getDepth",value:function(u){var i=this.findStabbedSegments(u);return i.size()===0?0:$n.min(i)._leftDepth}}],[{key:"constructor_",value:function(){this._subgraphs=null,this._seg=new me;var u=arguments[0];this._subgraphs=u}}])}(),Yu=function(){return c(function u(){o(this,u),u.constructor_.apply(this,arguments)},[{key:"compareTo",value:function(u){var i=u;if(this._upwardSeg.minX()>=i._upwardSeg.maxX())return 1;if(this._upwardSeg.maxX()<=i._upwardSeg.minX())return-1;var s=this._upwardSeg.orientationIndex(i._upwardSeg);return s!==0||(s=-1*i._upwardSeg.orientationIndex(this._upwardSeg))!==0?s:this._upwardSeg.compareTo(i._upwardSeg)}},{key:"compareX",value:function(u,i){var s=u.p0.compareTo(i.p0);return s!==0?s:u.p1.compareTo(i.p1)}},{key:"toString",value:function(){return this._upwardSeg.toString()}},{key:"interfaces_",get:function(){return[A]}}],[{key:"constructor_",value:function(){this._upwardSeg=null,this._leftDepth=null;var u=arguments[0],i=arguments[1];this._upwardSeg=new me(u),this._leftDepth=i}}])}();Vu.DepthSegment=Yu;var Wu=function(u){function i(){var s;return o(this,i),s=r(this,i),i.constructor_.apply(s,arguments),s}return y(i,u),c(i,null,[{key:"constructor_",value:function(){T.constructor_.call(this,"Projective point not representable on the Cartesian plane.")}}])}(T),So=function(){function u(){o(this,u),u.constructor_.apply(this,arguments)}return c(u,[{key:"getY",value:function(){var i=this.y/this.w;if(Z.isNaN(i)||Z.isInfinite(i))throw new Wu;return i}},{key:"getX",value:function(){var i=this.x/this.w;if(Z.isNaN(i)||Z.isInfinite(i))throw new Wu;return i}},{key:"getCoordinate",value:function(){var i=new U;return i.x=this.getX(),i.y=this.getY(),i}}],[{key:"constructor_",value:function(){if(this.x=null,this.y=null,this.w=null,arguments.length===0)this.x=0,this.y=0,this.w=1;else if(arguments.length===1){var i=arguments[0];this.x=i.x,this.y=i.y,this.w=1}else if(arguments.length===2){if(typeof arguments[0]=="number"&&typeof arguments[1]=="number"){var s=arguments[0],a=arguments[1];this.x=s,this.y=a,this.w=1}else if(arguments[0]instanceof u&&arguments[1]instanceof u){var h=arguments[0],g=arguments[1];this.x=h.y*g.w-g.y*h.w,this.y=g.x*h.w-h.x*g.w,this.w=h.x*g.y-g.x*h.y}else if(arguments[0]instanceof U&&arguments[1]instanceof U){var m=arguments[0],_=arguments[1];this.x=m.y-_.y,this.y=_.x-m.x,this.w=m.x*_.y-_.x*m.y}}else if(arguments.length===3){var k=arguments[0],b=arguments[1],z=arguments[2];this.x=k,this.y=b,this.w=z}else if(arguments.length===4){var q=arguments[0],V=arguments[1],K=arguments[2],rt=arguments[3],lt=q.y-V.y,Nt=V.x-q.x,It=q.x*V.y-V.x*q.y,Ft=K.y-rt.y,te=rt.x-K.x,ee=K.x*rt.y-rt.x*K.y;this.x=Nt*ee-te*It,this.y=Ft*It-lt*ee,this.w=lt*te-Ft*Nt}}}])}(),id=function(){function u(){o(this,u),u.constructor_.apply(this,arguments)}return c(u,[{key:"area",value:function(){return u.area(this.p0,this.p1,this.p2)}},{key:"signedArea",value:function(){return u.signedArea(this.p0,this.p1,this.p2)}},{key:"interpolateZ",value:function(i){if(i===null)throw new N("Supplied point is null.");return u.interpolateZ(i,this.p0,this.p1,this.p2)}},{key:"longestSideLength",value:function(){return u.longestSideLength(this.p0,this.p1,this.p2)}},{key:"isAcute",value:function(){return u.isAcute(this.p0,this.p1,this.p2)}},{key:"circumcentre",value:function(){return u.circumcentre(this.p0,this.p1,this.p2)}},{key:"area3D",value:function(){return u.area3D(this.p0,this.p1,this.p2)}},{key:"centroid",value:function(){return u.centroid(this.p0,this.p1,this.p2)}},{key:"inCentre",value:function(){return u.inCentre(this.p0,this.p1,this.p2)}}],[{key:"constructor_",value:function(){this.p0=null,this.p1=null,this.p2=null;var i=arguments[0],s=arguments[1],a=arguments[2];this.p0=i,this.p1=s,this.p2=a}},{key:"area",value:function(i,s,a){return Math.abs(((a.x-i.x)*(s.y-i.y)-(s.x-i.x)*(a.y-i.y))/2)}},{key:"signedArea",value:function(i,s,a){return((a.x-i.x)*(s.y-i.y)-(s.x-i.x)*(a.y-i.y))/2}},{key:"det",value:function(i,s,a,h){return i*h-s*a}},{key:"interpolateZ",value:function(i,s,a,h){var g=s.x,m=s.y,_=a.x-g,k=h.x-g,b=a.y-m,z=h.y-m,q=_*z-k*b,V=i.x-g,K=i.y-m,rt=(z*V-k*K)/q,lt=(-b*V+_*K)/q;return s.getZ()+rt*(a.getZ()-s.getZ())+lt*(h.getZ()-s.getZ())}},{key:"longestSideLength",value:function(i,s,a){var h=i.distance(s),g=s.distance(a),m=a.distance(i),_=h;return g>_&&(_=g),m>_&&(_=m),_}},{key:"circumcentreDD",value:function(i,s,a){var h=ft.valueOf(i.x).subtract(a.x),g=ft.valueOf(i.y).subtract(a.y),m=ft.valueOf(s.x).subtract(a.x),_=ft.valueOf(s.y).subtract(a.y),k=ft.determinant(h,g,m,_).multiply(2),b=h.sqr().add(g.sqr()),z=m.sqr().add(_.sqr()),q=ft.determinant(g,b,_,z),V=ft.determinant(h,b,m,z),K=ft.valueOf(a.x).subtract(q.divide(k)).doubleValue(),rt=ft.valueOf(a.y).add(V.divide(k)).doubleValue();return new U(K,rt)}},{key:"isAcute",value:function(i,s,a){return!!ve.isAcute(i,s,a)&&!!ve.isAcute(s,a,i)&&!!ve.isAcute(a,i,s)}},{key:"circumcentre",value:function(i,s,a){var h=a.x,g=a.y,m=i.x-h,_=i.y-g,k=s.x-h,b=s.y-g,z=2*u.det(m,_,k,b),q=u.det(_,m*m+_*_,b,k*k+b*b),V=u.det(m,m*m+_*_,k,k*k+b*b);return new U(h-q/z,g+V/z)}},{key:"perpendicularBisector",value:function(i,s){var a=s.x-i.x,h=s.y-i.y,g=new So(i.x+a/2,i.y+h/2,1),m=new So(i.x-h+a/2,i.y+a+h/2,1);return new So(g,m)}},{key:"angleBisector",value:function(i,s,a){var h=s.distance(i),g=h/(h+s.distance(a)),m=a.x-i.x,_=a.y-i.y;return new U(i.x+g*m,i.y+g*_)}},{key:"area3D",value:function(i,s,a){var h=s.x-i.x,g=s.y-i.y,m=s.getZ()-i.getZ(),_=a.x-i.x,k=a.y-i.y,b=a.getZ()-i.getZ(),z=g*b-m*k,q=m*_-h*b,V=h*k-g*_,K=z*z+q*q+V*V,rt=Math.sqrt(K)/2;return rt}},{key:"centroid",value:function(i,s,a){var h=(i.x+s.x+a.x)/3,g=(i.y+s.y+a.y)/3;return new U(h,g)}},{key:"inCentre",value:function(i,s,a){var h=s.distance(a),g=i.distance(a),m=i.distance(s),_=h+g+m,k=(h*i.x+g*s.x+m*a.x)/_,b=(h*i.y+g*s.y+m*a.y)/_;return new U(k,b)}}])}(),sd=function(){return c(function u(){o(this,u),u.constructor_.apply(this,arguments)},[{key:"addRingSide",value:function(u,i,s,a,h){if(i===0&&u.length<Nr.MINIMUM_VALID_SIZE)return null;var g=a,m=h;u.length>=Nr.MINIMUM_VALID_SIZE&&dt.isCCW(u)&&(g=h,m=a,s=X.opposite(s));var _=this._curveBuilder.getRingCurve(u,s,i);this.addCurve(_,g,m)}},{key:"addRingBothSides",value:function(u,i){this.addRingSide(u,i,X.LEFT,R.EXTERIOR,R.INTERIOR),this.addRingSide(u,i,X.RIGHT,R.INTERIOR,R.EXTERIOR)}},{key:"addPoint",value:function(u){if(this._distance<=0)return null;var i=u.getCoordinates(),s=this._curveBuilder.getLineCurve(i,this._distance);this.addCurve(s,R.EXTERIOR,R.INTERIOR)}},{key:"addPolygon",value:function(u){var i=this._distance,s=X.LEFT;this._distance<0&&(i=-this._distance,s=X.RIGHT);var a=u.getExteriorRing(),h=Ht.removeRepeatedPoints(a.getCoordinates());if(this._distance<0&&this.isErodedCompletely(a,this._distance)||this._distance<=0&&h.length<3)return null;this.addRingSide(h,i,s,R.EXTERIOR,R.INTERIOR);for(var g=0;g<u.getNumInteriorRing();g++){var m=u.getInteriorRingN(g),_=Ht.removeRepeatedPoints(m.getCoordinates());this._distance>0&&this.isErodedCompletely(m,-this._distance)||this.addRingSide(_,i,X.opposite(s),R.INTERIOR,R.EXTERIOR)}}},{key:"isTriangleErodedCompletely",value:function(u,i){var s=new id(u[0],u[1],u[2]),a=s.inCentre();return qe.pointToSegment(a,s.p0,s.p1)<Math.abs(i)}},{key:"addLineString",value:function(u){if(this._curveBuilder.isLineOffsetEmpty(this._distance))return null;var i=Ht.removeRepeatedPoints(u.getCoordinates());if(Ht.isRing(i)&&!this._curveBuilder.getBufferParameters().isSingleSided())this.addRingBothSides(i,this._distance);else{var s=this._curveBuilder.getLineCurve(i,this._distance);this.addCurve(s,R.EXTERIOR,R.INTERIOR)}}},{key:"addCurve",value:function(u,i,s){if(u===null||u.length<2)return null;var a=new An(u,new Te(0,R.BOUNDARY,i,s));this._curveList.add(a)}},{key:"getCurves",value:function(){return this.add(this._inputGeom),this._curveList}},{key:"add",value:function(u){if(u.isEmpty())return null;if(u instanceof Ri)this.addPolygon(u);else if(u instanceof br)this.addLineString(u);else if(u instanceof mo)this.addPoint(u);else if(u instanceof vo)this.addCollection(u);else if(u instanceof xo)this.addCollection(u);else if(u instanceof wo)this.addCollection(u);else{if(!(u instanceof pe))throw new ze(u.getGeometryType());this.addCollection(u)}}},{key:"isErodedCompletely",value:function(u,i){var s=u.getCoordinates();if(s.length<4)return i<0;if(s.length===4)return this.isTriangleErodedCompletely(s,i);var a=u.getEnvelopeInternal(),h=Math.min(a.getHeight(),a.getWidth());return i<0&&2*Math.abs(i)>h}},{key:"addCollection",value:function(u){for(var i=0;i<u.getNumGeometries();i++){var s=u.getGeometryN(i);this.add(s)}}}],[{key:"constructor_",value:function(){this._inputGeom=null,this._distance=null,this._curveBuilder=null,this._curveList=new ht;var u=arguments[0],i=arguments[1],s=arguments[2];this._inputGeom=u,this._distance=i,this._curveBuilder=s}}])}(),od=function(){return c(function u(){o(this,u)},[{key:"locate",value:function(u){}}])}(),ad=function(){function u(){o(this,u),u.constructor_.apply(this,arguments)}return c(u,[{key:"next",value:function(){if(this._atStart)return this._atStart=!1,u.isAtomic(this._parent)&&this._index++,this._parent;if(this._subcollectionIterator!==null){if(this._subcollectionIterator.hasNext())return this._subcollectionIterator.next();this._subcollectionIterator=null}if(this._index>=this._max)throw new Wn;var i=this._parent.getGeometryN(this._index++);return i instanceof pe?(this._subcollectionIterator=new u(i),this._subcollectionIterator.next()):i}},{key:"remove",value:function(){throw new ze(this.getClass().getName())}},{key:"hasNext",value:function(){if(this._atStart)return!0;if(this._subcollectionIterator!==null){if(this._subcollectionIterator.hasNext())return!0;this._subcollectionIterator=null}return!(this._index>=this._max)}},{key:"interfaces_",get:function(){return[$g]}}],[{key:"constructor_",value:function(){this._parent=null,this._atStart=null,this._max=null,this._index=null,this._subcollectionIterator=null;var i=arguments[0];this._parent=i,this._atStart=!0,this._index=0,this._max=i.getNumGeometries()}},{key:"isAtomic",value:function(i){return!(i instanceof pe)}}])}(),ud=function(){function u(){o(this,u),u.constructor_.apply(this,arguments)}return c(u,[{key:"locate",value:function(i){return u.locate(i,this._geom)}},{key:"interfaces_",get:function(){return[od]}}],[{key:"constructor_",value:function(){this._geom=null;var i=arguments[0];this._geom=i}},{key:"locatePointInPolygon",value:function(i,s){if(s.isEmpty())return R.EXTERIOR;var a=s.getExteriorRing(),h=u.locatePointInRing(i,a);if(h!==R.INTERIOR)return h;for(var g=0;g<s.getNumInteriorRing();g++){var m=s.getInteriorRingN(g),_=u.locatePointInRing(i,m);if(_===R.BOUNDARY)return R.BOUNDARY;if(_===R.INTERIOR)return R.EXTERIOR}return R.INTERIOR}},{key:"locatePointInRing",value:function(i,s){return s.getEnvelopeInternal().intersects(i)?Io.locateInRing(i,s.getCoordinates()):R.EXTERIOR}},{key:"containsPointInPolygon",value:function(i,s){return R.EXTERIOR!==u.locatePointInPolygon(i,s)}},{key:"locateInGeometry",value:function(i,s){if(s instanceof Ri)return u.locatePointInPolygon(i,s);if(s instanceof pe)for(var a=new ad(s);a.hasNext();){var h=a.next();if(h!==s){var g=u.locateInGeometry(i,h);if(g!==R.EXTERIOR)return g}}return R.EXTERIOR}},{key:"isContained",value:function(i,s){return R.EXTERIOR!==u.locate(i,s)}},{key:"locate",value:function(i,s){return s.isEmpty()?R.EXTERIOR:s.getEnvelopeInternal().intersects(i)?u.locateInGeometry(i,s):R.EXTERIOR}}])}(),ld=function(){return c(function u(){o(this,u),u.constructor_.apply(this,arguments)},[{key:"getNextCW",value:function(u){this.getEdges();var i=this._edgeList.indexOf(u),s=i-1;return i===0&&(s=this._edgeList.size()-1),this._edgeList.get(s)}},{key:"propagateSideLabels",value:function(u){for(var i=R.NONE,s=this.iterator();s.hasNext();){var a=s.next().getLabel();a.isArea(u)&&a.getLocation(u,X.LEFT)!==R.NONE&&(i=a.getLocation(u,X.LEFT))}if(i===R.NONE)return null;for(var h=i,g=this.iterator();g.hasNext();){var m=g.next(),_=m.getLabel();if(_.getLocation(u,X.ON)===R.NONE&&_.setLocation(u,X.ON,h),_.isArea(u)){var k=_.getLocation(u,X.LEFT),b=_.getLocation(u,X.RIGHT);if(b!==R.NONE){if(b!==h)throw new Ke("side location conflict",m.getCoordinate());k===R.NONE&&ot.shouldNeverReachHere("found single null side (at "+m.getCoordinate()+")"),h=k}else ot.isTrue(_.getLocation(u,X.LEFT)===R.NONE,"found single null side"),_.setLocation(u,X.RIGHT,h),_.setLocation(u,X.LEFT,h)}}}},{key:"getCoordinate",value:function(){var u=this.iterator();return u.hasNext()?u.next().getCoordinate():null}},{key:"print",value:function(u){ke.out.println("EdgeEndStar:   "+this.getCoordinate());for(var i=this.iterator();i.hasNext();)i.next().print(u)}},{key:"isAreaLabelsConsistent",value:function(u){return this.computeEdgeEndLabels(u.getBoundaryNodeRule()),this.checkAreaLabelsConsistent(0)}},{key:"checkAreaLabelsConsistent",value:function(u){var i=this.getEdges();if(i.size()<=0)return!0;var s=i.size()-1,a=i.get(s).getLabel().getLocation(u,X.LEFT);ot.isTrue(a!==R.NONE,"Found unlabelled area edge");for(var h=a,g=this.iterator();g.hasNext();){var m=g.next().getLabel();ot.isTrue(m.isArea(u),"Found non-area edge");var _=m.getLocation(u,X.LEFT),k=m.getLocation(u,X.RIGHT);if(_===k||k!==h)return!1;h=_}return!0}},{key:"findIndex",value:function(u){this.iterator();for(var i=0;i<this._edgeList.size();i++)if(this._edgeList.get(i)===u)return i;return-1}},{key:"iterator",value:function(){return this.getEdges().iterator()}},{key:"getEdges",value:function(){return this._edgeList===null&&(this._edgeList=new ht(this._edgeMap.values())),this._edgeList}},{key:"getLocation",value:function(u,i,s){return this._ptInAreaLocation[u]===R.NONE&&(this._ptInAreaLocation[u]=ud.locate(i,s[u].getGeometry())),this._ptInAreaLocation[u]}},{key:"toString",value:function(){var u=new Tr;u.append("EdgeEndStar:   "+this.getCoordinate()),u.append(`
`);for(var i=this.iterator();i.hasNext();){var s=i.next();u.append(s),u.append(`
`)}return u.toString()}},{key:"computeEdgeEndLabels",value:function(u){for(var i=this.iterator();i.hasNext();)i.next().computeLabel(u)}},{key:"computeLabelling",value:function(u){this.computeEdgeEndLabels(u[0].getBoundaryNodeRule()),this.propagateSideLabels(0),this.propagateSideLabels(1);for(var i=[!1,!1],s=this.iterator();s.hasNext();)for(var a=s.next().getLabel(),h=0;h<2;h++)a.isLine(h)&&a.getLocation(h)===R.BOUNDARY&&(i[h]=!0);for(var g=this.iterator();g.hasNext();)for(var m=g.next(),_=m.getLabel(),k=0;k<2;k++)if(_.isAnyNull(k)){var b=R.NONE;if(i[k])b=R.EXTERIOR;else{var z=m.getCoordinate();b=this.getLocation(k,z,u)}_.setAllLocationsIfNull(k,b)}}},{key:"getDegree",value:function(){return this._edgeMap.size()}},{key:"insertEdgeEnd",value:function(u,i){this._edgeMap.put(u,i),this._edgeList=null}}],[{key:"constructor_",value:function(){this._edgeMap=new Pr,this._edgeList=null,this._ptInAreaLocation=[R.NONE,R.NONE]}}])}(),hd=function(u){function i(){var s;return o(this,i),s=r(this,i),i.constructor_.apply(s,arguments),s}return y(i,u),c(i,[{key:"linkResultDirectedEdges",value:function(){this.getResultAreaEdges();for(var s=null,a=null,h=this._SCANNING_FOR_INCOMING,g=0;g<this._resultAreaEdgeList.size();g++){var m=this._resultAreaEdgeList.get(g),_=m.getSym();if(m.getLabel().isArea())switch(s===null&&m.isInResult()&&(s=m),h){case this._SCANNING_FOR_INCOMING:if(!_.isInResult())continue;a=_,h=this._LINKING_TO_OUTGOING;break;case this._LINKING_TO_OUTGOING:if(!m.isInResult())continue;a.setNext(m),h=this._SCANNING_FOR_INCOMING}}if(h===this._LINKING_TO_OUTGOING){if(s===null)throw new Ke("no outgoing dirEdge found",this.getCoordinate());ot.isTrue(s.isInResult(),"unable to link last incoming dirEdge"),a.setNext(s)}}},{key:"insert",value:function(s){var a=s;this.insertEdgeEnd(a,a)}},{key:"getRightmostEdge",value:function(){var s=this.getEdges(),a=s.size();if(a<1)return null;var h=s.get(0);if(a===1)return h;var g=s.get(a-1),m=h.getQuadrant(),_=g.getQuadrant();return oe.isNorthern(m)&&oe.isNorthern(_)?h:oe.isNorthern(m)||oe.isNorthern(_)?h.getDy()!==0?h:g.getDy()!==0?g:(ot.shouldNeverReachHere("found two horizontal edges incident on node"),null):g}},{key:"print",value:function(s){ke.out.println("DirectedEdgeStar: "+this.getCoordinate());for(var a=this.iterator();a.hasNext();){var h=a.next();s.print("out "),h.print(s),s.println(),s.print("in "),h.getSym().print(s),s.println()}}},{key:"getResultAreaEdges",value:function(){if(this._resultAreaEdgeList!==null)return this._resultAreaEdgeList;this._resultAreaEdgeList=new ht;for(var s=this.iterator();s.hasNext();){var a=s.next();(a.isInResult()||a.getSym().isInResult())&&this._resultAreaEdgeList.add(a)}return this._resultAreaEdgeList}},{key:"updateLabelling",value:function(s){for(var a=this.iterator();a.hasNext();){var h=a.next().getLabel();h.setAllLocationsIfNull(0,s.getLocation(0)),h.setAllLocationsIfNull(1,s.getLocation(1))}}},{key:"linkAllDirectedEdges",value:function(){this.getEdges();for(var s=null,a=null,h=this._edgeList.size()-1;h>=0;h--){var g=this._edgeList.get(h),m=g.getSym();a===null&&(a=m),s!==null&&m.setNext(s),s=g}a.setNext(s)}},{key:"computeDepths",value:function(){if(arguments.length===1){var s=arguments[0],a=this.findIndex(s),h=s.getDepth(X.LEFT),g=s.getDepth(X.RIGHT),m=this.computeDepths(a+1,this._edgeList.size(),h);if(this.computeDepths(0,a,m)!==g)throw new Ke("depth mismatch at "+s.getCoordinate())}else if(arguments.length===3){for(var _=arguments[1],k=arguments[2],b=arguments[0];b<_;b++){var z=this._edgeList.get(b);z.setEdgeDepths(X.RIGHT,k),k=z.getDepth(X.LEFT)}return k}}},{key:"mergeSymLabels",value:function(){for(var s=this.iterator();s.hasNext();){var a=s.next();a.getLabel().merge(a.getSym().getLabel())}}},{key:"linkMinimalDirectedEdges",value:function(s){for(var a=null,h=null,g=this._SCANNING_FOR_INCOMING,m=this._resultAreaEdgeList.size()-1;m>=0;m--){var _=this._resultAreaEdgeList.get(m),k=_.getSym();switch(a===null&&_.getEdgeRing()===s&&(a=_),g){case this._SCANNING_FOR_INCOMING:if(k.getEdgeRing()!==s)continue;h=k,g=this._LINKING_TO_OUTGOING;break;case this._LINKING_TO_OUTGOING:if(_.getEdgeRing()!==s)continue;h.setNextMin(_),g=this._SCANNING_FOR_INCOMING}}g===this._LINKING_TO_OUTGOING&&(ot.isTrue(a!==null,"found null for first outgoing dirEdge"),ot.isTrue(a.getEdgeRing()===s,"unable to link last incoming dirEdge"),h.setNextMin(a))}},{key:"getOutgoingDegree",value:function(){if(arguments.length===0){for(var s=0,a=this.iterator();a.hasNext();)a.next().isInResult()&&s++;return s}if(arguments.length===1){for(var h=arguments[0],g=0,m=this.iterator();m.hasNext();)m.next().getEdgeRing()===h&&g++;return g}}},{key:"getLabel",value:function(){return this._label}},{key:"findCoveredLineEdges",value:function(){for(var s=R.NONE,a=this.iterator();a.hasNext();){var h=a.next(),g=h.getSym();if(!h.isLineEdge()){if(h.isInResult()){s=R.INTERIOR;break}if(g.isInResult()){s=R.EXTERIOR;break}}}if(s===R.NONE)return null;for(var m=s,_=this.iterator();_.hasNext();){var k=_.next(),b=k.getSym();k.isLineEdge()?k.getEdge().setCovered(m===R.INTERIOR):(k.isInResult()&&(m=R.EXTERIOR),b.isInResult()&&(m=R.INTERIOR))}}},{key:"computeLabelling",value:function(s){I(i,"computeLabelling",this,1).call(this,s),this._label=new Te(R.NONE);for(var a=this.iterator();a.hasNext();)for(var h=a.next().getEdge().getLabel(),g=0;g<2;g++){var m=h.getLocation(g);m!==R.INTERIOR&&m!==R.BOUNDARY||this._label.setLocation(g,R.INTERIOR)}}}],[{key:"constructor_",value:function(){this._resultAreaEdgeList=null,this._label=null,this._SCANNING_FOR_INCOMING=1,this._LINKING_TO_OUTGOING=2}}])}(ld),cd=function(u){function i(){return o(this,i),r(this,i)}return y(i,u),c(i,[{key:"createNode",value:function(s){return new Oi(s,new hd)}}])}(Ou),Xu=function(){function u(){o(this,u),u.constructor_.apply(this,arguments)}return c(u,[{key:"compareTo",value:function(i){var s=i;return u.compareOriented(this._pts,this._orientation,s._pts,s._orientation)}},{key:"interfaces_",get:function(){return[A]}}],[{key:"constructor_",value:function(){this._pts=null,this._orientation=null;var i=arguments[0];this._pts=i,this._orientation=u.orientation(i)}},{key:"orientation",value:function(i){return Ht.increasingDirection(i)===1}},{key:"compareOriented",value:function(i,s,a,h){for(var g=s?1:-1,m=h?1:-1,_=s?i.length:-1,k=h?a.length:-1,b=s?0:i.length-1,z=h?0:a.length-1;;){var q=i[b].compareTo(a[z]);if(q!==0)return q;var V=(b+=g)===_,K=(z+=m)===k;if(V&&!K)return-1;if(!V&&K)return 1;if(V&&K)return 0}}}])}(),fd=function(){return c(function u(){o(this,u),u.constructor_.apply(this,arguments)},[{key:"print",value:function(u){u.print("MULTILINESTRING ( ");for(var i=0;i<this._edges.size();i++){var s=this._edges.get(i);i>0&&u.print(","),u.print("(");for(var a=s.getCoordinates(),h=0;h<a.length;h++)h>0&&u.print(","),u.print(a[h].x+" "+a[h].y);u.println(")")}u.print(")  ")}},{key:"addAll",value:function(u){for(var i=u.iterator();i.hasNext();)this.add(i.next())}},{key:"findEdgeIndex",value:function(u){for(var i=0;i<this._edges.size();i++)if(this._edges.get(i).equals(u))return i;return-1}},{key:"iterator",value:function(){return this._edges.iterator()}},{key:"getEdges",value:function(){return this._edges}},{key:"get",value:function(u){return this._edges.get(u)}},{key:"findEqualEdge",value:function(u){var i=new Xu(u.getCoordinates());return this._ocaMap.get(i)}},{key:"add",value:function(u){this._edges.add(u);var i=new Xu(u.getCoordinates());this._ocaMap.put(i,u)}}],[{key:"constructor_",value:function(){this._edges=new ht,this._ocaMap=new Pr}}])}(),Zu=function(){return c(function u(){o(this,u)},[{key:"processIntersections",value:function(u,i,s,a){}},{key:"isDone",value:function(){}}])}(),gd=function(){function u(){o(this,u),u.constructor_.apply(this,arguments)}return c(u,[{key:"isTrivialIntersection",value:function(i,s,a,h){if(i===a&&this._li.getIntersectionNum()===1){if(u.isAdjacentSegments(s,h))return!0;if(i.isClosed()){var g=i.size()-1;if(s===0&&h===g||h===0&&s===g)return!0}}return!1}},{key:"getProperIntersectionPoint",value:function(){return this._properIntersectionPoint}},{key:"hasProperInteriorIntersection",value:function(){return this._hasProperInterior}},{key:"getLineIntersector",value:function(){return this._li}},{key:"hasProperIntersection",value:function(){return this._hasProper}},{key:"processIntersections",value:function(i,s,a,h){if(i===a&&s===h)return null;this.numTests++;var g=i.getCoordinates()[s],m=i.getCoordinates()[s+1],_=a.getCoordinates()[h],k=a.getCoordinates()[h+1];this._li.computeIntersection(g,m,_,k),this._li.hasIntersection()&&(this.numIntersections++,this._li.isInteriorIntersection()&&(this.numInteriorIntersections++,this._hasInterior=!0),this.isTrivialIntersection(i,s,a,h)||(this._hasIntersection=!0,i.addIntersections(this._li,s,0),a.addIntersections(this._li,h,1),this._li.isProper()&&(this.numProperIntersections++,this._hasProper=!0,this._hasProperInterior=!0)))}},{key:"hasIntersection",value:function(){return this._hasIntersection}},{key:"isDone",value:function(){return!1}},{key:"hasInteriorIntersection",value:function(){return this._hasInterior}},{key:"interfaces_",get:function(){return[Zu]}}],[{key:"constructor_",value:function(){this._hasIntersection=!1,this._hasProper=!1,this._hasProperInterior=!1,this._hasInterior=!1,this._properIntersectionPoint=null,this._li=null,this._isSelfIntersection=null,this.numIntersections=0,this.numInteriorIntersections=0,this.numProperIntersections=0,this.numTests=0;var i=arguments[0];this._li=i}},{key:"isAdjacentSegments",value:function(i,s){return Math.abs(i-s)===1}}])}(),dd=function(){return c(function u(){o(this,u),u.constructor_.apply(this,arguments)},[{key:"getSegmentIndex",value:function(){return this.segmentIndex}},{key:"getCoordinate",value:function(){return this.coord}},{key:"print",value:function(u){u.print(this.coord),u.print(" seg # = "+this.segmentIndex),u.println(" dist = "+this.dist)}},{key:"compareTo",value:function(u){var i=u;return this.compare(i.segmentIndex,i.dist)}},{key:"isEndPoint",value:function(u){return this.segmentIndex===0&&this.dist===0||this.segmentIndex===u}},{key:"toString",value:function(){return this.coord+" seg # = "+this.segmentIndex+" dist = "+this.dist}},{key:"getDistance",value:function(){return this.dist}},{key:"compare",value:function(u,i){return this.segmentIndex<u?-1:this.segmentIndex>u?1:this.dist<i?-1:this.dist>i?1:0}},{key:"interfaces_",get:function(){return[A]}}],[{key:"constructor_",value:function(){this.coord=null,this.segmentIndex=null,this.dist=null;var u=arguments[0],i=arguments[1],s=arguments[2];this.coord=new U(u),this.segmentIndex=i,this.dist=s}}])}(),pd=function(){return c(function u(){o(this,u),u.constructor_.apply(this,arguments)},[{key:"print",value:function(u){u.println("Intersections:");for(var i=this.iterator();i.hasNext();)i.next().print(u)}},{key:"iterator",value:function(){return this._nodeMap.values().iterator()}},{key:"addSplitEdges",value:function(u){this.addEndpoints();for(var i=this.iterator(),s=i.next();i.hasNext();){var a=i.next(),h=this.createSplitEdge(s,a);u.add(h),s=a}}},{key:"addEndpoints",value:function(){var u=this.edge.pts.length-1;this.add(this.edge.pts[0],0,0),this.add(this.edge.pts[u],u,0)}},{key:"createSplitEdge",value:function(u,i){var s=i.segmentIndex-u.segmentIndex+2,a=this.edge.pts[i.segmentIndex],h=i.dist>0||!i.coord.equals2D(a);h||s--;var g=new Array(s).fill(null),m=0;g[m++]=new U(u.coord);for(var _=u.segmentIndex+1;_<=i.segmentIndex;_++)g[m++]=this.edge.pts[_];return h&&(g[m]=i.coord),new $u(g,new Te(this.edge._label))}},{key:"add",value:function(u,i,s){var a=new dd(u,i,s),h=this._nodeMap.get(a);return h!==null?h:(this._nodeMap.put(a,a),a)}},{key:"isIntersection",value:function(u){for(var i=this.iterator();i.hasNext();)if(i.next().coord.equals(u))return!0;return!1}}],[{key:"constructor_",value:function(){this._nodeMap=new Pr,this.edge=null;var u=arguments[0];this.edge=u}}])}(),md=function(){function u(){o(this,u),u.constructor_.apply(this,arguments)}return c(u,[{key:"isIntersects",value:function(){return!this.isDisjoint()}},{key:"isCovers",value:function(){return(u.isTrue(this._matrix[R.INTERIOR][R.INTERIOR])||u.isTrue(this._matrix[R.INTERIOR][R.BOUNDARY])||u.isTrue(this._matrix[R.BOUNDARY][R.INTERIOR])||u.isTrue(this._matrix[R.BOUNDARY][R.BOUNDARY]))&&this._matrix[R.EXTERIOR][R.INTERIOR]===H.FALSE&&this._matrix[R.EXTERIOR][R.BOUNDARY]===H.FALSE}},{key:"isCoveredBy",value:function(){return(u.isTrue(this._matrix[R.INTERIOR][R.INTERIOR])||u.isTrue(this._matrix[R.INTERIOR][R.BOUNDARY])||u.isTrue(this._matrix[R.BOUNDARY][R.INTERIOR])||u.isTrue(this._matrix[R.BOUNDARY][R.BOUNDARY]))&&this._matrix[R.INTERIOR][R.EXTERIOR]===H.FALSE&&this._matrix[R.BOUNDARY][R.EXTERIOR]===H.FALSE}},{key:"set",value:function(){if(arguments.length===1)for(var i=arguments[0],s=0;s<i.length;s++){var a=Math.trunc(s/3),h=s%3;this._matrix[a][h]=H.toDimensionValue(i.charAt(s))}else if(arguments.length===3){var g=arguments[0],m=arguments[1],_=arguments[2];this._matrix[g][m]=_}}},{key:"isContains",value:function(){return u.isTrue(this._matrix[R.INTERIOR][R.INTERIOR])&&this._matrix[R.EXTERIOR][R.INTERIOR]===H.FALSE&&this._matrix[R.EXTERIOR][R.BOUNDARY]===H.FALSE}},{key:"setAtLeast",value:function(){if(arguments.length===1)for(var i=arguments[0],s=0;s<i.length;s++){var a=Math.trunc(s/3),h=s%3;this.setAtLeast(a,h,H.toDimensionValue(i.charAt(s)))}else if(arguments.length===3){var g=arguments[0],m=arguments[1],_=arguments[2];this._matrix[g][m]<_&&(this._matrix[g][m]=_)}}},{key:"setAtLeastIfValid",value:function(i,s,a){i>=0&&s>=0&&this.setAtLeast(i,s,a)}},{key:"isWithin",value:function(){return u.isTrue(this._matrix[R.INTERIOR][R.INTERIOR])&&this._matrix[R.INTERIOR][R.EXTERIOR]===H.FALSE&&this._matrix[R.BOUNDARY][R.EXTERIOR]===H.FALSE}},{key:"isTouches",value:function(i,s){return i>s?this.isTouches(s,i):(i===H.A&&s===H.A||i===H.L&&s===H.L||i===H.L&&s===H.A||i===H.P&&s===H.A||i===H.P&&s===H.L)&&this._matrix[R.INTERIOR][R.INTERIOR]===H.FALSE&&(u.isTrue(this._matrix[R.INTERIOR][R.BOUNDARY])||u.isTrue(this._matrix[R.BOUNDARY][R.INTERIOR])||u.isTrue(this._matrix[R.BOUNDARY][R.BOUNDARY]))}},{key:"isOverlaps",value:function(i,s){return i===H.P&&s===H.P||i===H.A&&s===H.A?u.isTrue(this._matrix[R.INTERIOR][R.INTERIOR])&&u.isTrue(this._matrix[R.INTERIOR][R.EXTERIOR])&&u.isTrue(this._matrix[R.EXTERIOR][R.INTERIOR]):i===H.L&&s===H.L&&this._matrix[R.INTERIOR][R.INTERIOR]===1&&u.isTrue(this._matrix[R.INTERIOR][R.EXTERIOR])&&u.isTrue(this._matrix[R.EXTERIOR][R.INTERIOR])}},{key:"isEquals",value:function(i,s){return i===s&&u.isTrue(this._matrix[R.INTERIOR][R.INTERIOR])&&this._matrix[R.INTERIOR][R.EXTERIOR]===H.FALSE&&this._matrix[R.BOUNDARY][R.EXTERIOR]===H.FALSE&&this._matrix[R.EXTERIOR][R.INTERIOR]===H.FALSE&&this._matrix[R.EXTERIOR][R.BOUNDARY]===H.FALSE}},{key:"toString",value:function(){for(var i=new Pi("123456789"),s=0;s<3;s++)for(var a=0;a<3;a++)i.setCharAt(3*s+a,H.toDimensionSymbol(this._matrix[s][a]));return i.toString()}},{key:"setAll",value:function(i){for(var s=0;s<3;s++)for(var a=0;a<3;a++)this._matrix[s][a]=i}},{key:"get",value:function(i,s){return this._matrix[i][s]}},{key:"transpose",value:function(){var i=this._matrix[1][0];return this._matrix[1][0]=this._matrix[0][1],this._matrix[0][1]=i,i=this._matrix[2][0],this._matrix[2][0]=this._matrix[0][2],this._matrix[0][2]=i,i=this._matrix[2][1],this._matrix[2][1]=this._matrix[1][2],this._matrix[1][2]=i,this}},{key:"matches",value:function(i){if(i.length!==9)throw new N("Should be length 9: "+i);for(var s=0;s<3;s++)for(var a=0;a<3;a++)if(!u.matches(this._matrix[s][a],i.charAt(3*s+a)))return!1;return!0}},{key:"add",value:function(i){for(var s=0;s<3;s++)for(var a=0;a<3;a++)this.setAtLeast(s,a,i.get(s,a))}},{key:"isDisjoint",value:function(){return this._matrix[R.INTERIOR][R.INTERIOR]===H.FALSE&&this._matrix[R.INTERIOR][R.BOUNDARY]===H.FALSE&&this._matrix[R.BOUNDARY][R.INTERIOR]===H.FALSE&&this._matrix[R.BOUNDARY][R.BOUNDARY]===H.FALSE}},{key:"isCrosses",value:function(i,s){return i===H.P&&s===H.L||i===H.P&&s===H.A||i===H.L&&s===H.A?u.isTrue(this._matrix[R.INTERIOR][R.INTERIOR])&&u.isTrue(this._matrix[R.INTERIOR][R.EXTERIOR]):i===H.L&&s===H.P||i===H.A&&s===H.P||i===H.A&&s===H.L?u.isTrue(this._matrix[R.INTERIOR][R.INTERIOR])&&u.isTrue(this._matrix[R.EXTERIOR][R.INTERIOR]):i===H.L&&s===H.L&&this._matrix[R.INTERIOR][R.INTERIOR]===0}},{key:"interfaces_",get:function(){return[L]}}],[{key:"constructor_",value:function(){if(this._matrix=null,arguments.length===0)this._matrix=Array(3).fill().map(function(){return Array(3)}),this.setAll(H.FALSE);else if(arguments.length===1){if(typeof arguments[0]=="string"){var i=arguments[0];u.constructor_.call(this),this.set(i)}else if(arguments[0]instanceof u){var s=arguments[0];u.constructor_.call(this),this._matrix[R.INTERIOR][R.INTERIOR]=s._matrix[R.INTERIOR][R.INTERIOR],this._matrix[R.INTERIOR][R.BOUNDARY]=s._matrix[R.INTERIOR][R.BOUNDARY],this._matrix[R.INTERIOR][R.EXTERIOR]=s._matrix[R.INTERIOR][R.EXTERIOR],this._matrix[R.BOUNDARY][R.INTERIOR]=s._matrix[R.BOUNDARY][R.INTERIOR],this._matrix[R.BOUNDARY][R.BOUNDARY]=s._matrix[R.BOUNDARY][R.BOUNDARY],this._matrix[R.BOUNDARY][R.EXTERIOR]=s._matrix[R.BOUNDARY][R.EXTERIOR],this._matrix[R.EXTERIOR][R.INTERIOR]=s._matrix[R.EXTERIOR][R.INTERIOR],this._matrix[R.EXTERIOR][R.BOUNDARY]=s._matrix[R.EXTERIOR][R.BOUNDARY],this._matrix[R.EXTERIOR][R.EXTERIOR]=s._matrix[R.EXTERIOR][R.EXTERIOR]}}}},{key:"matches",value:function(){if(Number.isInteger(arguments[0])&&typeof arguments[1]=="string"){var i=arguments[0],s=arguments[1];return s===H.SYM_DONTCARE||s===H.SYM_TRUE&&(i>=0||i===H.TRUE)||s===H.SYM_FALSE&&i===H.FALSE||s===H.SYM_P&&i===H.P||s===H.SYM_L&&i===H.L||s===H.SYM_A&&i===H.A}if(typeof arguments[0]=="string"&&typeof arguments[1]=="string"){var a=arguments[1];return new u(arguments[0]).matches(a)}}},{key:"isTrue",value:function(i){return i>=0||i===H.TRUE}}])}(),vd=function(){function u(){o(this,u),u.constructor_.apply(this,arguments)}return c(u,[{key:"size",value:function(){return this._size}},{key:"addAll",value:function(i){return i===null||i.length===0?null:(this.ensureCapacity(this._size+i.length),ke.arraycopy(i,0,this._data,this._size,i.length),void(this._size+=i.length))}},{key:"ensureCapacity",value:function(i){if(i<=this._data.length)return null;var s=Math.max(i,2*this._data.length);this._data=Rn.copyOf(this._data,s)}},{key:"toArray",value:function(){var i=new Array(this._size).fill(null);return ke.arraycopy(this._data,0,i,0,this._size),i}},{key:"add",value:function(i){this.ensureCapacity(this._size+1),this._data[this._size]=i,++this._size}}],[{key:"constructor_",value:function(){if(this._data=null,this._size=0,arguments.length===0)u.constructor_.call(this,10);else if(arguments.length===1){var i=arguments[0];this._data=new Array(i).fill(null)}}}])}(),yd=function(){function u(){o(this,u)}return c(u,[{key:"getChainStartIndices",value:function(i){var s=0,a=new vd(Math.trunc(i.length/2));a.add(s);do{var h=this.findChainEnd(i,s);a.add(h),s=h}while(s<i.length-1);return a.toArray()}},{key:"findChainEnd",value:function(i,s){for(var a=oe.quadrant(i[s],i[s+1]),h=s+1;h<i.length&&oe.quadrant(i[h-1],i[h])===a;)h++;return h-1}},{key:"OLDgetChainStartIndices",value:function(i){var s=0,a=new ht;a.add(s);do{var h=this.findChainEnd(i,s);a.add(h),s=h}while(s<i.length-1);return u.toIntArray(a)}}],[{key:"toIntArray",value:function(i){for(var s=new Array(i.size()).fill(null),a=0;a<s.length;a++)s[a]=i.get(a).intValue();return s}}])}(),_d=function(){return c(function u(){o(this,u),u.constructor_.apply(this,arguments)},[{key:"getCoordinates",value:function(){return this.pts}},{key:"getMaxX",value:function(u){var i=this.pts[this.startIndex[u]].x,s=this.pts[this.startIndex[u+1]].x;return i>s?i:s}},{key:"getMinX",value:function(u){var i=this.pts[this.startIndex[u]].x,s=this.pts[this.startIndex[u+1]].x;return i<s?i:s}},{key:"computeIntersectsForChain",value:function(){if(arguments.length===4){var u=arguments[0],i=arguments[1],s=arguments[2],a=arguments[3];this.computeIntersectsForChain(this.startIndex[u],this.startIndex[u+1],i,i.startIndex[s],i.startIndex[s+1],a)}else if(arguments.length===6){var h=arguments[0],g=arguments[1],m=arguments[2],_=arguments[3],k=arguments[4],b=arguments[5];if(g-h==1&&k-_==1)return b.addIntersections(this.e,h,m.e,_),null;if(!this.overlaps(h,g,m,_,k))return null;var z=Math.trunc((h+g)/2),q=Math.trunc((_+k)/2);h<z&&(_<q&&this.computeIntersectsForChain(h,z,m,_,q,b),q<k&&this.computeIntersectsForChain(h,z,m,q,k,b)),z<g&&(_<q&&this.computeIntersectsForChain(z,g,m,_,q,b),q<k&&this.computeIntersectsForChain(z,g,m,q,k,b))}}},{key:"overlaps",value:function(u,i,s,a,h){return Dt.intersects(this.pts[u],this.pts[i],s.pts[a],s.pts[h])}},{key:"getStartIndexes",value:function(){return this.startIndex}},{key:"computeIntersects",value:function(u,i){for(var s=0;s<this.startIndex.length-1;s++)for(var a=0;a<u.startIndex.length-1;a++)this.computeIntersectsForChain(s,u,a,i)}}],[{key:"constructor_",value:function(){this.e=null,this.pts=null,this.startIndex=null;var u=arguments[0];this.e=u,this.pts=u.getCoordinates();var i=new yd;this.startIndex=i.getChainStartIndices(this.pts)}}])}(),Hu=function(){function u(){o(this,u),u.constructor_.apply(this,arguments)}return c(u,[{key:"getDepth",value:function(i,s){return this._depth[i][s]}},{key:"setDepth",value:function(i,s,a){this._depth[i][s]=a}},{key:"isNull",value:function(){if(arguments.length===0){for(var i=0;i<2;i++)for(var s=0;s<3;s++)if(this._depth[i][s]!==u.NULL_VALUE)return!1;return!0}if(arguments.length===1){var a=arguments[0];return this._depth[a][1]===u.NULL_VALUE}if(arguments.length===2){var h=arguments[0],g=arguments[1];return this._depth[h][g]===u.NULL_VALUE}}},{key:"normalize",value:function(){for(var i=0;i<2;i++)if(!this.isNull(i)){var s=this._depth[i][1];this._depth[i][2]<s&&(s=this._depth[i][2]),s<0&&(s=0);for(var a=1;a<3;a++){var h=0;this._depth[i][a]>s&&(h=1),this._depth[i][a]=h}}}},{key:"getDelta",value:function(i){return this._depth[i][X.RIGHT]-this._depth[i][X.LEFT]}},{key:"getLocation",value:function(i,s){return this._depth[i][s]<=0?R.EXTERIOR:R.INTERIOR}},{key:"toString",value:function(){return"A: "+this._depth[0][1]+","+this._depth[0][2]+" B: "+this._depth[1][1]+","+this._depth[1][2]}},{key:"add",value:function(){if(arguments.length===1)for(var i=arguments[0],s=0;s<2;s++)for(var a=1;a<3;a++){var h=i.getLocation(s,a);h!==R.EXTERIOR&&h!==R.INTERIOR||(this.isNull(s,a)?this._depth[s][a]=u.depthAtLocation(h):this._depth[s][a]+=u.depthAtLocation(h))}else if(arguments.length===3){var g=arguments[0],m=arguments[1];arguments[2]===R.INTERIOR&&this._depth[g][m]++}}}],[{key:"constructor_",value:function(){this._depth=Array(2).fill().map(function(){return Array(3)});for(var i=0;i<2;i++)for(var s=0;s<3;s++)this._depth[i][s]=u.NULL_VALUE}},{key:"depthAtLocation",value:function(i){return i===R.EXTERIOR?0:i===R.INTERIOR?1:u.NULL_VALUE}}])}();Hu.NULL_VALUE=-1;var $u=function(u){function i(){var s;return o(this,i),s=r(this,i),i.constructor_.apply(s,arguments),s}return y(i,u),c(i,[{key:"getDepth",value:function(){return this._depth}},{key:"getCollapsedEdge",value:function(){var s=new Array(2).fill(null);return s[0]=this.pts[0],s[1]=this.pts[1],new i(s,Te.toLineLabel(this._label))}},{key:"isIsolated",value:function(){return this._isIsolated}},{key:"getCoordinates",value:function(){return this.pts}},{key:"setIsolated",value:function(s){this._isIsolated=s}},{key:"setName",value:function(s){this._name=s}},{key:"equals",value:function(s){if(!(s instanceof i))return!1;var a=s;if(this.pts.length!==a.pts.length)return!1;for(var h=!0,g=!0,m=this.pts.length,_=0;_<this.pts.length;_++)if(this.pts[_].equals2D(a.pts[_])||(h=!1),this.pts[_].equals2D(a.pts[--m])||(g=!1),!h&&!g)return!1;return!0}},{key:"getCoordinate",value:function(){if(arguments.length===0)return this.pts.length>0?this.pts[0]:null;if(arguments.length===1){var s=arguments[0];return this.pts[s]}}},{key:"print",value:function(s){s.print("edge "+this._name+": "),s.print("LINESTRING (");for(var a=0;a<this.pts.length;a++)a>0&&s.print(","),s.print(this.pts[a].x+" "+this.pts[a].y);s.print(")  "+this._label+" "+this._depthDelta)}},{key:"computeIM",value:function(s){i.updateIM(this._label,s)}},{key:"isCollapsed",value:function(){return!!this._label.isArea()&&this.pts.length===3&&!!this.pts[0].equals(this.pts[2])}},{key:"isClosed",value:function(){return this.pts[0].equals(this.pts[this.pts.length-1])}},{key:"getMaximumSegmentIndex",value:function(){return this.pts.length-1}},{key:"getDepthDelta",value:function(){return this._depthDelta}},{key:"getNumPoints",value:function(){return this.pts.length}},{key:"printReverse",value:function(s){s.print("edge "+this._name+": ");for(var a=this.pts.length-1;a>=0;a--)s.print(this.pts[a]+" ");s.println("")}},{key:"getMonotoneChainEdge",value:function(){return this._mce===null&&(this._mce=new _d(this)),this._mce}},{key:"getEnvelope",value:function(){if(this._env===null){this._env=new Dt;for(var s=0;s<this.pts.length;s++)this._env.expandToInclude(this.pts[s])}return this._env}},{key:"addIntersection",value:function(s,a,h,g){var m=new U(s.getIntersection(g)),_=a,k=s.getEdgeDistance(h,g),b=_+1;if(b<this.pts.length){var z=this.pts[b];m.equals2D(z)&&(_=b,k=0)}this.eiList.add(m,_,k)}},{key:"toString",value:function(){var s=new Pi;s.append("edge "+this._name+": "),s.append("LINESTRING (");for(var a=0;a<this.pts.length;a++)a>0&&s.append(","),s.append(this.pts[a].x+" "+this.pts[a].y);return s.append(")  "+this._label+" "+this._depthDelta),s.toString()}},{key:"isPointwiseEqual",value:function(s){if(this.pts.length!==s.pts.length)return!1;for(var a=0;a<this.pts.length;a++)if(!this.pts[a].equals2D(s.pts[a]))return!1;return!0}},{key:"setDepthDelta",value:function(s){this._depthDelta=s}},{key:"getEdgeIntersectionList",value:function(){return this.eiList}},{key:"addIntersections",value:function(s,a,h){for(var g=0;g<s.getIntersectionNum();g++)this.addIntersection(s,a,h,g)}}],[{key:"constructor_",value:function(){if(this.pts=null,this._env=null,this.eiList=new pd(this),this._name=null,this._mce=null,this._isIsolated=!0,this._depth=new Hu,this._depthDelta=0,arguments.length===1){var s=arguments[0];i.constructor_.call(this,s,null)}else if(arguments.length===2){var a=arguments[0],h=arguments[1];this.pts=a,this._label=h}}},{key:"updateIM",value:function(){if(!(arguments.length===2&&arguments[1]instanceof md&&arguments[0]instanceof Te))return I(i,"updateIM",this).apply(this,arguments);var s=arguments[0],a=arguments[1];a.setAtLeastIfValid(s.getLocation(0,X.ON),s.getLocation(1,X.ON),1),s.isArea()&&(a.setAtLeastIfValid(s.getLocation(0,X.LEFT),s.getLocation(1,X.LEFT),2),a.setAtLeastIfValid(s.getLocation(0,X.RIGHT),s.getLocation(1,X.RIGHT),2))}}])}(Ru),Ku=function(){function u(){o(this,u),u.constructor_.apply(this,arguments)}return c(u,[{key:"setWorkingPrecisionModel",value:function(i){this._workingPrecisionModel=i}},{key:"insertUniqueEdge",value:function(i){var s=this._edgeList.findEqualEdge(i);if(s!==null){var a=s.getLabel(),h=i.getLabel();s.isPointwiseEqual(i)||(h=new Te(i.getLabel())).flip(),a.merge(h);var g=u.depthDelta(h),m=s.getDepthDelta()+g;s.setDepthDelta(m)}else this._edgeList.add(i),i.setDepthDelta(u.depthDelta(i.getLabel()))}},{key:"buildSubgraphs",value:function(i,s){for(var a=new ht,h=i.iterator();h.hasNext();){var g=h.next(),m=g.getRightmostCoordinate(),_=new Vu(a).getDepth(m);g.computeDepth(_),g.findResultEdges(),a.add(g),s.add(g.getDirectedEdges(),g.getNodes())}}},{key:"createSubgraphs",value:function(i){for(var s=new ht,a=i.getNodes().iterator();a.hasNext();){var h=a.next();if(!h.isVisited()){var g=new Ig;g.create(h),s.add(g)}}return $n.sort(s,$n.reverseOrder()),s}},{key:"createEmptyResultGeometry",value:function(){return this._geomFact.createPolygon()}},{key:"getNoder",value:function(i){if(this._workingNoder!==null)return this._workingNoder;var s=new No,a=new Ln;return a.setPrecisionModel(i),s.setSegmentIntersector(new gd(a)),s}},{key:"buffer",value:function(i,s){var a=this._workingPrecisionModel;a===null&&(a=i.getPrecisionModel()),this._geomFact=i.getFactory();var h=new rd(a,this._bufParams),g=new sd(i,s,h).getCurves();if(g.size()<=0)return this.createEmptyResultGeometry();this.computeNodedEdges(g,a),this._graph=new Du(new cd),this._graph.addEdges(this._edgeList.getEdges());var m=this.createSubgraphs(this._graph),_=new Vg(this._geomFact);this.buildSubgraphs(m,_);var k=_.getPolygons();return k.size()<=0?this.createEmptyResultGeometry():this._geomFact.buildGeometry(k)}},{key:"computeNodedEdges",value:function(i,s){var a=this.getNoder(s);a.computeNodes(i);for(var h=a.getNodedSubstrings().iterator();h.hasNext();){var g=h.next(),m=g.getCoordinates();if(m.length!==2||!m[0].equals2D(m[1])){var _=g.getData(),k=new $u(g.getCoordinates(),new Te(_));this.insertUniqueEdge(k)}}}},{key:"setNoder",value:function(i){this._workingNoder=i}}],[{key:"constructor_",value:function(){this._bufParams=null,this._workingPrecisionModel=null,this._workingNoder=null,this._geomFact=null,this._graph=null,this._edgeList=new fd;var i=arguments[0];this._bufParams=i}},{key:"depthDelta",value:function(i){var s=i.getLocation(0,X.LEFT),a=i.getLocation(0,X.RIGHT);return s===R.INTERIOR&&a===R.EXTERIOR?1:s===R.EXTERIOR&&a===R.INTERIOR?-1:0}},{key:"convertSegStrings",value:function(i){for(var s=new Zn,a=new ht;i.hasNext();){var h=i.next(),g=s.createLineString(h.getCoordinates());a.add(g)}return s.buildGeometry(a)}}])}(),wd=function(){function u(){o(this,u),u.constructor_.apply(this,arguments)}return c(u,[{key:"rescale",value:function(){if(pt(arguments[0],Ee))for(var i=arguments[0].iterator();i.hasNext();){var s=i.next();this.rescale(s.getCoordinates())}else if(arguments[0]instanceof Array){for(var a=arguments[0],h=0;h<a.length;h++)a[h].x=a[h].x/this._scaleFactor+this._offsetX,a[h].y=a[h].y/this._scaleFactor+this._offsetY;a.length===2&&a[0].equals2D(a[1])&&ke.out.println(a)}}},{key:"scale",value:function(){if(pt(arguments[0],Ee)){for(var i=arguments[0],s=new ht(i.size()),a=i.iterator();a.hasNext();){var h=a.next();s.add(new An(this.scale(h.getCoordinates()),h.getData()))}return s}if(arguments[0]instanceof Array){for(var g=arguments[0],m=new Array(g.length).fill(null),_=0;_<g.length;_++)m[_]=new U(Math.round((g[_].x-this._offsetX)*this._scaleFactor),Math.round((g[_].y-this._offsetY)*this._scaleFactor),g[_].getZ());return Ht.removeRepeatedPoints(m)}}},{key:"isIntegerPrecision",value:function(){return this._scaleFactor===1}},{key:"getNodedSubstrings",value:function(){var i=this._noder.getNodedSubstrings();return this._isScaled&&this.rescale(i),i}},{key:"computeNodes",value:function(i){var s=i;this._isScaled&&(s=this.scale(i)),this._noder.computeNodes(s)}},{key:"interfaces_",get:function(){return[bo]}}],[{key:"constructor_",value:function(){if(this._noder=null,this._scaleFactor=null,this._offsetX=null,this._offsetY=null,this._isScaled=!1,arguments.length===2){var i=arguments[0],s=arguments[1];u.constructor_.call(this,i,s,0,0)}else if(arguments.length===4){var a=arguments[0],h=arguments[1];this._noder=a,this._scaleFactor=h,this._isScaled=!this.isIntegerPrecision()}}}])}(),Ju=function(){function u(){o(this,u),u.constructor_.apply(this,arguments)}return c(u,[{key:"checkEndPtVertexIntersections",value:function(){if(arguments.length===0)for(var i=this._segStrings.iterator();i.hasNext();){var s=i.next().getCoordinates();this.checkEndPtVertexIntersections(s[0],this._segStrings),this.checkEndPtVertexIntersections(s[s.length-1],this._segStrings)}else if(arguments.length===2){for(var a=arguments[0],h=arguments[1].iterator();h.hasNext();)for(var g=h.next().getCoordinates(),m=1;m<g.length-1;m++)if(g[m].equals(a))throw new it("found endpt/interior pt intersection at index "+m+" :pt "+a)}}},{key:"checkInteriorIntersections",value:function(){if(arguments.length===0)for(var i=this._segStrings.iterator();i.hasNext();)for(var s=i.next(),a=this._segStrings.iterator();a.hasNext();){var h=a.next();this.checkInteriorIntersections(s,h)}else if(arguments.length===2)for(var g=arguments[0],m=arguments[1],_=g.getCoordinates(),k=m.getCoordinates(),b=0;b<_.length-1;b++)for(var z=0;z<k.length-1;z++)this.checkInteriorIntersections(g,b,m,z);else if(arguments.length===4){var q=arguments[0],V=arguments[1],K=arguments[2],rt=arguments[3];if(q===K&&V===rt)return null;var lt=q.getCoordinates()[V],Nt=q.getCoordinates()[V+1],It=K.getCoordinates()[rt],Ft=K.getCoordinates()[rt+1];if(this._li.computeIntersection(lt,Nt,It,Ft),this._li.hasIntersection()&&(this._li.isProper()||this.hasInteriorIntersection(this._li,lt,Nt)||this.hasInteriorIntersection(this._li,It,Ft)))throw new it("found non-noded intersection at "+lt+"-"+Nt+" and "+It+"-"+Ft)}}},{key:"checkValid",value:function(){this.checkEndPtVertexIntersections(),this.checkInteriorIntersections(),this.checkCollapses()}},{key:"checkCollapses",value:function(){if(arguments.length===0)for(var i=this._segStrings.iterator();i.hasNext();){var s=i.next();this.checkCollapses(s)}else if(arguments.length===1)for(var a=arguments[0].getCoordinates(),h=0;h<a.length-2;h++)this.checkCollapse(a[h],a[h+1],a[h+2])}},{key:"hasInteriorIntersection",value:function(i,s,a){for(var h=0;h<i.getIntersectionNum();h++){var g=i.getIntersection(h);if(!g.equals(s)&&!g.equals(a))return!0}return!1}},{key:"checkCollapse",value:function(i,s,a){if(i.equals(a))throw new it("found non-noded collapse at "+u.fact.createLineString([i,s,a]))}}],[{key:"constructor_",value:function(){this._li=new Ln,this._segStrings=null;var i=arguments[0];this._segStrings=i}}])}();Ju.fact=new Zn;var Ro=function(){function u(){o(this,u),u.constructor_.apply(this,arguments)}return c(u,[{key:"intersectsScaled",value:function(i,s){var a=Math.min(i.x,s.x),h=Math.max(i.x,s.x),g=Math.min(i.y,s.y),m=Math.max(i.y,s.y),_=this._maxx<a||this._minx>h||this._maxy<g||this._miny>m;if(_)return!1;var k=this.intersectsToleranceSquare(i,s);return ot.isTrue(!(_&&k),"Found bad envelope test"),k}},{key:"initCorners",value:function(i){var s=.5;this._minx=i.x-s,this._maxx=i.x+s,this._miny=i.y-s,this._maxy=i.y+s,this._corner[0]=new U(this._maxx,this._maxy),this._corner[1]=new U(this._minx,this._maxy),this._corner[2]=new U(this._minx,this._miny),this._corner[3]=new U(this._maxx,this._miny)}},{key:"intersects",value:function(i,s){return this._scaleFactor===1?this.intersectsScaled(i,s):(this.copyScaled(i,this._p0Scaled),this.copyScaled(s,this._p1Scaled),this.intersectsScaled(this._p0Scaled,this._p1Scaled))}},{key:"scale",value:function(i){return Math.round(i*this._scaleFactor)}},{key:"getCoordinate",value:function(){return this._originalPt}},{key:"copyScaled",value:function(i,s){s.x=this.scale(i.x),s.y=this.scale(i.y)}},{key:"getSafeEnvelope",value:function(){if(this._safeEnv===null){var i=u.SAFE_ENV_EXPANSION_FACTOR/this._scaleFactor;this._safeEnv=new Dt(this._originalPt.x-i,this._originalPt.x+i,this._originalPt.y-i,this._originalPt.y+i)}return this._safeEnv}},{key:"intersectsPixelClosure",value:function(i,s){return this._li.computeIntersection(i,s,this._corner[0],this._corner[1]),!!this._li.hasIntersection()||(this._li.computeIntersection(i,s,this._corner[1],this._corner[2]),!!this._li.hasIntersection()||(this._li.computeIntersection(i,s,this._corner[2],this._corner[3]),!!this._li.hasIntersection()||(this._li.computeIntersection(i,s,this._corner[3],this._corner[0]),!!this._li.hasIntersection())))}},{key:"intersectsToleranceSquare",value:function(i,s){var a=!1,h=!1;return this._li.computeIntersection(i,s,this._corner[0],this._corner[1]),!!this._li.isProper()||(this._li.computeIntersection(i,s,this._corner[1],this._corner[2]),!!this._li.isProper()||(this._li.hasIntersection()&&(a=!0),this._li.computeIntersection(i,s,this._corner[2],this._corner[3]),!!this._li.isProper()||(this._li.hasIntersection()&&(h=!0),this._li.computeIntersection(i,s,this._corner[3],this._corner[0]),!!this._li.isProper()||!(!a||!h)||!!i.equals(this._pt)||!!s.equals(this._pt))))}},{key:"addSnappedNode",value:function(i,s){var a=i.getCoordinate(s),h=i.getCoordinate(s+1);return!!this.intersects(a,h)&&(i.addIntersection(this.getCoordinate(),s),!0)}}],[{key:"constructor_",value:function(){this._li=null,this._pt=null,this._originalPt=null,this._ptScaled=null,this._p0Scaled=null,this._p1Scaled=null,this._scaleFactor=null,this._minx=null,this._maxx=null,this._miny=null,this._maxy=null,this._corner=new Array(4).fill(null),this._safeEnv=null;var i=arguments[0],s=arguments[1],a=arguments[2];if(this._originalPt=i,this._pt=i,this._scaleFactor=s,this._li=a,s<=0)throw new N("Scale factor must be non-zero");s!==1&&(this._pt=new U(this.scale(i.x),this.scale(i.y)),this._p0Scaled=new U,this._p1Scaled=new U),this.initCorners(this._pt)}}])}();Ro.SAFE_ENV_EXPANSION_FACTOR=.75;var xd=function(){return c(function u(){o(this,u),u.constructor_.apply(this,arguments)},[{key:"select",value:function(){if(arguments.length!==1){if(arguments.length===2){var u=arguments[1];arguments[0].getLineSegment(u,this.selectedSegment),this.select(this.selectedSegment)}}}}],[{key:"constructor_",value:function(){this.selectedSegment=new me}}])}(),Qu=function(){return c(function u(){o(this,u),u.constructor_.apply(this,arguments)},[{key:"snap",value:function(){if(arguments.length===1){var u=arguments[0];return this.snap(u,null,-1)}if(arguments.length===3){var i=arguments[0],s=arguments[1],a=arguments[2],h=i.getSafeEnvelope(),g=new tl(i,s,a);return this._index.query(h,new(function(){return c(function m(){o(this,m)},[{key:"interfaces_",get:function(){return[Gu]}},{key:"visitItem",value:function(m){m.select(h,g)}}])}())),g.isNodeAdded()}}}],[{key:"constructor_",value:function(){this._index=null;var u=arguments[0];this._index=u}}])}(),tl=function(u){function i(){var s;return o(this,i),s=r(this,i),i.constructor_.apply(s,arguments),s}return y(i,u),c(i,[{key:"isNodeAdded",value:function(){return this._isNodeAdded}},{key:"select",value:function(){if(!(arguments.length===2&&Number.isInteger(arguments[1])&&arguments[0]instanceof zu))return I(i,"select",this,1).apply(this,arguments);var s=arguments[1],a=arguments[0].getContext();if(this._parentEdge===a&&(s===this._hotPixelVertexIndex||s+1===this._hotPixelVertexIndex))return null;this._isNodeAdded|=this._hotPixel.addSnappedNode(a,s)}}],[{key:"constructor_",value:function(){this._hotPixel=null,this._parentEdge=null,this._hotPixelVertexIndex=null,this._isNodeAdded=!1;var s=arguments[0],a=arguments[1],h=arguments[2];this._hotPixel=s,this._parentEdge=a,this._hotPixelVertexIndex=h}}])}(xd);Qu.HotPixelSnapAction=tl;var Ed=function(){return c(function u(){o(this,u),u.constructor_.apply(this,arguments)},[{key:"processIntersections",value:function(u,i,s,a){if(u===s&&i===a)return null;var h=u.getCoordinates()[i],g=u.getCoordinates()[i+1],m=s.getCoordinates()[a],_=s.getCoordinates()[a+1];if(this._li.computeIntersection(h,g,m,_),this._li.hasIntersection()&&this._li.isInteriorIntersection()){for(var k=0;k<this._li.getIntersectionNum();k++)this._interiorIntersections.add(this._li.getIntersection(k));u.addIntersections(this._li,i,0),s.addIntersections(this._li,a,1)}}},{key:"isDone",value:function(){return!1}},{key:"getInteriorIntersections",value:function(){return this._interiorIntersections}},{key:"interfaces_",get:function(){return[Zu]}}],[{key:"constructor_",value:function(){this._li=null,this._interiorIntersections=null;var u=arguments[0];this._li=u,this._interiorIntersections=new ht}}])}(),kd=function(){return c(function u(){o(this,u),u.constructor_.apply(this,arguments)},[{key:"checkCorrectness",value:function(u){var i=An.getNodedSubstrings(u),s=new Ju(i);try{s.checkValid()}catch(a){if(!(a instanceof T))throw a;a.printStackTrace()}}},{key:"getNodedSubstrings",value:function(){return An.getNodedSubstrings(this._nodedSegStrings)}},{key:"snapRound",value:function(u,i){var s=this.findInteriorIntersections(u,i);this.computeIntersectionSnaps(s),this.computeVertexSnaps(u)}},{key:"findInteriorIntersections",value:function(u,i){var s=new Ed(i);return this._noder.setSegmentIntersector(s),this._noder.computeNodes(u),s.getInteriorIntersections()}},{key:"computeVertexSnaps",value:function(){if(pt(arguments[0],Ee))for(var u=arguments[0].iterator();u.hasNext();){var i=u.next();this.computeVertexSnaps(i)}else if(arguments[0]instanceof An)for(var s=arguments[0],a=s.getCoordinates(),h=0;h<a.length;h++){var g=new Ro(a[h],this._scaleFactor,this._li);this._pointSnapper.snap(g,s,h)&&s.addIntersection(a[h],h)}}},{key:"computeNodes",value:function(u){this._nodedSegStrings=u,this._noder=new No,this._pointSnapper=new Qu(this._noder.getIndex()),this.snapRound(u,this._li)}},{key:"computeIntersectionSnaps",value:function(u){for(var i=u.iterator();i.hasNext();){var s=i.next(),a=new Ro(s,this._scaleFactor,this._li);this._pointSnapper.snap(a)}}},{key:"interfaces_",get:function(){return[bo]}}],[{key:"constructor_",value:function(){this._pm=null,this._li=null,this._scaleFactor=null,this._noder=null,this._pointSnapper=null,this._nodedSegStrings=null;var u=arguments[0];this._pm=u,this._li=new Ln,this._li.setPrecisionModel(u),this._scaleFactor=u.getScale()}}])}(),Qn=function(){function u(){o(this,u),u.constructor_.apply(this,arguments)}return c(u,[{key:"bufferFixedPrecision",value:function(i){var s=new wd(new kd(new Pe(1)),i.getScale()),a=new Ku(this._bufParams);a.setWorkingPrecisionModel(i),a.setNoder(s),this._resultGeometry=a.buffer(this._argGeom,this._distance)}},{key:"bufferReducedPrecision",value:function(){if(arguments.length===0){for(var i=u.MAX_PRECISION_DIGITS;i>=0;i--){try{this.bufferReducedPrecision(i)}catch(g){if(!(g instanceof Ke))throw g;this._saveException=g}if(this._resultGeometry!==null)return null}throw this._saveException}if(arguments.length===1){var s=arguments[0],a=u.precisionScaleFactor(this._argGeom,this._distance,s),h=new Pe(a);this.bufferFixedPrecision(h)}}},{key:"computeGeometry",value:function(){if(this.bufferOriginalPrecision(),this._resultGeometry!==null)return null;var i=this._argGeom.getFactory().getPrecisionModel();i.getType()===Pe.FIXED?this.bufferFixedPrecision(i):this.bufferReducedPrecision()}},{key:"setQuadrantSegments",value:function(i){this._bufParams.setQuadrantSegments(i)}},{key:"bufferOriginalPrecision",value:function(){try{var i=new Ku(this._bufParams);this._resultGeometry=i.buffer(this._argGeom,this._distance)}catch(s){if(!(s instanceof it))throw s;this._saveException=s}}},{key:"getResultGeometry",value:function(i){return this._distance=i,this.computeGeometry(),this._resultGeometry}},{key:"setEndCapStyle",value:function(i){this._bufParams.setEndCapStyle(i)}}],[{key:"constructor_",value:function(){if(this._argGeom=null,this._distance=null,this._bufParams=new w,this._resultGeometry=null,this._saveException=null,arguments.length===1){var i=arguments[0];this._argGeom=i}else if(arguments.length===2){var s=arguments[0],a=arguments[1];this._argGeom=s,this._bufParams=a}}},{key:"bufferOp",value:function(){if(arguments.length===2){var i=arguments[1];return new u(arguments[0]).getResultGeometry(i)}if(arguments.length===3){if(Number.isInteger(arguments[2])&&arguments[0]instanceof at&&typeof arguments[1]=="number"){var s=arguments[1],a=arguments[2],h=new u(arguments[0]);return h.setQuadrantSegments(a),h.getResultGeometry(s)}if(arguments[2]instanceof w&&arguments[0]instanceof at&&typeof arguments[1]=="number"){var g=arguments[1];return new u(arguments[0],arguments[2]).getResultGeometry(g)}}else if(arguments.length===4){var m=arguments[1],_=arguments[2],k=arguments[3],b=new u(arguments[0]);return b.setQuadrantSegments(_),b.setEndCapStyle(k),b.getResultGeometry(m)}}},{key:"precisionScaleFactor",value:function(i,s,a){var h=i.getEnvelopeInternal(),g=Mr.max(Math.abs(h.getMaxX()),Math.abs(h.getMaxY()),Math.abs(h.getMinX()),Math.abs(h.getMinY()))+2*(s>0?s:0),m=a-Math.trunc(Math.log(g)/Math.log(10)+1);return Math.pow(10,m)}}])}();Qn.CAP_ROUND=w.CAP_ROUND,Qn.CAP_BUTT=w.CAP_FLAT,Qn.CAP_FLAT=w.CAP_FLAT,Qn.CAP_SQUARE=w.CAP_SQUARE,Qn.MAX_PRECISION_DIGITS=12;var Id=["Point","MultiPoint","LineString","MultiLineString","Polygon","MultiPolygon"],el=function(){return c(function u(i){o(this,u),this.geometryFactory=i||new Zn},[{key:"read",value:function(u){var i,s=(i=typeof u=="string"?JSON.parse(u):u).type;if(!be[s])throw new Error("Unknown GeoJSON type: "+i.type);return Id.indexOf(s)!==-1?be[s].call(this,i.coordinates):s==="GeometryCollection"?be[s].call(this,i.geometries):be[s].call(this,i)}},{key:"write",value:function(u){var i=u.getGeometryType();if(!Ve[i])throw new Error("Geometry is not supported");return Ve[i].call(this,u)}}])}(),be={Feature:function(u){var i={};for(var s in u)i[s]=u[s];if(u.geometry){var a=u.geometry.type;if(!be[a])throw new Error("Unknown GeoJSON type: "+u.type);i.geometry=this.read(u.geometry)}return u.bbox&&(i.bbox=be.bbox.call(this,u.bbox)),i},FeatureCollection:function(u){var i={};if(u.features){i.features=[];for(var s=0;s<u.features.length;++s)i.features.push(this.read(u.features[s]))}return u.bbox&&(i.bbox=this.parse.bbox.call(this,u.bbox)),i},coordinates:function(u){for(var i=[],s=0;s<u.length;++s){var a=u[s];i.push(l(U,O(a)))}return i},bbox:function(u){return this.geometryFactory.createLinearRing([new U(u[0],u[1]),new U(u[2],u[1]),new U(u[2],u[3]),new U(u[0],u[3]),new U(u[0],u[1])])},Point:function(u){var i=l(U,O(u));return this.geometryFactory.createPoint(i)},MultiPoint:function(u){for(var i=[],s=0;s<u.length;++s)i.push(be.Point.call(this,u[s]));return this.geometryFactory.createMultiPoint(i)},LineString:function(u){var i=be.coordinates.call(this,u);return this.geometryFactory.createLineString(i)},MultiLineString:function(u){for(var i=[],s=0;s<u.length;++s)i.push(be.LineString.call(this,u[s]));return this.geometryFactory.createMultiLineString(i)},Polygon:function(u){for(var i=be.coordinates.call(this,u[0]),s=this.geometryFactory.createLinearRing(i),a=[],h=1;h<u.length;++h){var g=u[h],m=be.coordinates.call(this,g),_=this.geometryFactory.createLinearRing(m);a.push(_)}return this.geometryFactory.createPolygon(s,a)},MultiPolygon:function(u){for(var i=[],s=0;s<u.length;++s){var a=u[s];i.push(be.Polygon.call(this,a))}return this.geometryFactory.createMultiPolygon(i)},GeometryCollection:function(u){for(var i=[],s=0;s<u.length;++s){var a=u[s];i.push(this.read(a))}return this.geometryFactory.createGeometryCollection(i)}},Ve={coordinate:function(u){var i=[u.x,u.y];return u.z&&i.push(u.z),u.m&&i.push(u.m),i},Point:function(u){return{type:"Point",coordinates:Ve.coordinate.call(this,u.getCoordinate())}},MultiPoint:function(u){for(var i=[],s=0;s<u._geometries.length;++s){var a=u._geometries[s],h=Ve.Point.call(this,a);i.push(h.coordinates)}return{type:"MultiPoint",coordinates:i}},LineString:function(u){for(var i=[],s=u.getCoordinates(),a=0;a<s.length;++a){var h=s[a];i.push(Ve.coordinate.call(this,h))}return{type:"LineString",coordinates:i}},MultiLineString:function(u){for(var i=[],s=0;s<u._geometries.length;++s){var a=u._geometries[s],h=Ve.LineString.call(this,a);i.push(h.coordinates)}return{type:"MultiLineString",coordinates:i}},Polygon:function(u){var i=[],s=Ve.LineString.call(this,u._shell);i.push(s.coordinates);for(var a=0;a<u._holes.length;++a){var h=u._holes[a],g=Ve.LineString.call(this,h);i.push(g.coordinates)}return{type:"Polygon",coordinates:i}},MultiPolygon:function(u){for(var i=[],s=0;s<u._geometries.length;++s){var a=u._geometries[s],h=Ve.Polygon.call(this,a);i.push(h.coordinates)}return{type:"MultiPolygon",coordinates:i}},GeometryCollection:function(u){for(var i=[],s=0;s<u._geometries.length;++s){var a=u._geometries[s],h=a.getGeometryType();i.push(Ve[h].call(this,a))}return{type:"GeometryCollection",geometries:i}}};return{BufferOp:Qn,GeoJSONReader:function(){return c(function u(i){o(this,u),this.parser=new el(i||new Zn)},[{key:"read",value:function(u){return this.parser.read(u)}}])}(),GeoJSONWriter:function(){return c(function u(){o(this,u),this.parser=new el(this.geometryFactory)},[{key:"write",value:function(u){return this.parser.write(u)}}])}()}})}(ds)),ds.exports}var Ux=qx();const jx=Td(Ux);var{BufferOp:Vx,GeoJSONReader:Yx,GeoJSONWriter:Wx}=jx;function Xx(n,t,e){e=e||{};var r=e.units||"kilometers",o=e.steps||8;if(!n)throw new Error("geojson is required");if(typeof e!="object")throw new Error("options must be an object");if(typeof o!="number")throw new Error("steps must be an number");if(t===void 0)throw new Error("radius is required");if(o<=0)throw new Error("steps must be greater than 0");var l=[];switch(n.type){case"GeometryCollection":return Gh(n,function(f){var c=ps(f,t,r,o);c&&l.push(c)}),ia(l);case"FeatureCollection":return Tl(n,function(f){var c=ps(f,t,r,o);c&&Tl(c,function(d){d&&l.push(d)})}),ia(l)}return ps(n,t,r,o)}function ps(n,t,e,r){var o=n.properties||{},l=n.type==="Feature"?n.geometry:n;if(l.type==="GeometryCollection"){var f=[];return Gh(n,function(O){var D=ps(O,t,e,r);D&&f.push(D)}),ia(f)}var c=Zx(l),d={type:l.type,coordinates:mg(l.coordinates,c)},p=new Yx,v=p.read(d),y=Qd(tp(t,e),"meters"),x=Vx.bufferOp(v,y,r),M=new Wx;if(x=M.write(x),!pg(x.coordinates)){var I={type:x.type,coordinates:vg(x.coordinates,c)};return ba(I,o)}}function pg(n){return Array.isArray(n[0])?pg(n[0]):isNaN(n[0])}function mg(n,t){return typeof n[0]!="object"?t(n):n.map(function(e){return mg(e,t)})}function vg(n,t){return typeof n[0]!="object"?t.invert(n):n.map(function(e){return vg(e,t)})}function Zx(n){var t=Bx(n).geometry.coordinates,e=[-t[0],-t[1]];return $d().rotate(e).scale(he)}const Hx=-90,$x=90,Kx=-180,Jx=180,Qx=(n,t,e={})=>{const r=new Fx(t);n.addLayer(r),e.url?r.addGeoreferenceAnnotationByUrl(e.url):e.manifest&&r.addGeoreferenceAnnotation(e.manifest),e.opacity&&r.setOpacity(e.opacity)},tE=(n,t=null)=>{const e=Ma(n);if(!yg(e))return null;const r=Gx(e);let o;return t?o=Xx(r,t,{units:"miles"}):o=r,Ma(o)},eE=(n,t)=>n&&n.removeLayer(t),yg=n=>Is.every(n,Is.isFinite),nE=n=>{let t=!1;if(n){const[e,r]=n;t=e>=Hx&&e<=$x&&r>=Kx&&r<=Jx}return t},iE={addGeoreferenceLayer:Qx,getBoundingBox:tE,removeLayer:eE,validateBoundingBox:yg,validateCoordinates:nE};export{iE as M,Is as _,ba as f};
