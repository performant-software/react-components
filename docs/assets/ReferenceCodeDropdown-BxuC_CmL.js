import{j as g}from"./jsx-runtime-BTCK_S7S.js";import{r as a}from"./index-CBqU2yxZ.js";import{D as v}from"./Dropdown-Di2cPjwR.js";import{_ as t}from"./index-default-C_maRo4o.js";import"./index.es28-Dp3-vHIY.js";import{s as h}from"./index.es12-BljXGOZw.js";class k extends h{getBaseUrl(){return"/controlled_vocabulary/reference_codes"}getTransform(){return{}}}const w=new k,p=e=>{const[d,c]=a.useState(!1),[i,y]=a.useState([]),_=a.useMemo(()=>{const r=t.pluck(t.filter(e.value,n=>!n._destroy),"reference_code_id");return e.multiple?r:t.first(r)},[e.multiple,e.value]),m=a.useCallback(r=>{const n=t.findWhere(i,{key:r});return{reference_code_id:r,reference_code:{id:r,name:n.text}}},[i]),f=a.useCallback(r=>({key:r.id,value:r.id,text:r.name}),[]),b=a.useCallback((r,n)=>{let u;e.multiple?u=n.value:u=t.compact([n.value]);const o=[];t.each(u,l=>{let s=t.findWhere(e.value,{reference_code_id:l});s||(s=m(l)),o.push(t.omit(s,"_destroy"))}),t.each(e.value,l=>{l.id&&!t.contains(u,l.reference_code_id)&&o.push({...l,_destroy:!0})}),e.onChange(o)},[m,e.multiple,e.onChange,e.value]);return a.useEffect(()=>{c(!0);const r={per_page:0,reference_table:e.referenceTable,sort_by:"name"};w.fetchAll(r).then(({data:n})=>y(t.map(n.reference_codes,f))).finally(()=>c(!1))},[f]),g.jsx(v,{clearable:!0,disabled:d||e.disabled,fluid:e.fluid,loading:d,multiple:e.multiple,onChange:b,options:i,placeholder:e.placeholder,search:!0,selection:!0,selectOnBlur:!1,value:_})};p.defaultProps={disabled:!1,fluid:!0,multiple:!1,placeholder:void 0};p.__docgenInfo={description:"",methods:[],displayName:"ReferenceCodeDropdown",props:{disabled:{required:!1,flowType:{name:"boolean"},description:"",defaultValue:{value:"false",computed:!1}},fluid:{required:!1,flowType:{name:"boolean"},description:"",defaultValue:{value:"true",computed:!1}},multiple:{required:!1,flowType:{name:"boolean"},description:"",defaultValue:{value:"false",computed:!1}},onChange:{required:!0,flowType:{name:"signature",type:"function",raw:"(item: Item) => void",signature:{arguments:[{name:"item",type:{name:"signature",type:"object",raw:`{
  reference_table_id: number,
  key: string
}`,signature:{properties:[{key:"reference_table_id",value:{name:"number",required:!0}},{key:"key",value:{name:"string",required:!0}}]}}}],return:{name:"void"}}},description:""},placeholder:{required:!1,flowType:{name:"string"},description:"",defaultValue:{value:"undefined",computed:!0}},referenceTable:{required:!0,flowType:{name:"string"},description:""},value:{required:!0,flowType:{name:"union",raw:"Item | Array<Item>",elements:[{name:"signature",type:"object",raw:`{
  reference_table_id: number,
  key: string
}`,signature:{properties:[{key:"reference_table_id",value:{name:"number",required:!0}},{key:"key",value:{name:"string",required:!0}}]}},{name:"Array",elements:[{name:"signature",type:"object",raw:`{
  reference_table_id: number,
  key: string
}`,signature:{properties:[{key:"reference_table_id",value:{name:"number",required:!0}},{key:"key",value:{name:"string",required:!0}}]}}],raw:"Array<Item>"}]},description:""}}};export{p as R};
