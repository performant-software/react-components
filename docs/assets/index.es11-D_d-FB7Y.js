import{r as Di,_ as KE,a as W1,R as by}from"./iframe-FoyjJkLC.js";import{f as Y1}from"./peripleo-maplibre.es11-DoLbnBqT.js";import{f as JE,g as QE}from"./MapStyles-iffSCOFm.js";var rf=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function l_(r){return r&&r.__esModule&&Object.prototype.hasOwnProperty.call(r,"default")?r.default:r}var Of={exports:{}},eI=Of.exports,G0;function tI(){return G0||(G0=1,function(r,e){(function(i,s){r.exports=s()})(eI,function(){var i=function(C,j){var de={drag:[],click:[],mousemove:[],mousedown:[],mouseup:[],mouseout:[],keydown:[],keyup:[],touchstart:[],touchmove:[],touchend:[],tap:[]},Ne={on:function(je,rt,Ct){if(de[je]===void 0)throw new Error("Invalid event type: "+je);de[je].push({selector:rt,fn:Ct})},render:function(je){j.store.featureChanged(je)}},qe=function(je,rt){for(var Ct=de[je],Dt=Ct.length;Dt--;){var Nt=Ct[Dt];if(Nt.selector(rt)){Nt.fn.call(Ne,rt)||j.store.render(),j.ui.updateMapClasses();break}}};return C.start.call(Ne),{render:C.render,stop:function(){C.stop&&C.stop()},trash:function(){C.trash&&(C.trash(),j.store.render())},combineFeatures:function(){C.combineFeatures&&C.combineFeatures()},uncombineFeatures:function(){C.uncombineFeatures&&C.uncombineFeatures()},drag:function(je){qe("drag",je)},click:function(je){qe("click",je)},mousemove:function(je){qe("mousemove",je)},mousedown:function(je){qe("mousedown",je)},mouseup:function(je){qe("mouseup",je)},mouseout:function(je){qe("mouseout",je)},keydown:function(je){qe("keydown",je)},keyup:function(je){qe("keyup",je)},touchstart:function(je){qe("touchstart",je)},touchmove:function(je){qe("touchmove",je)},touchend:function(je){qe("touchend",je)},tap:function(je){qe("tap",je)}}};function s(C){return C&&C.__esModule&&Object.prototype.hasOwnProperty.call(C,"default")?C.default:C}function h(C){if(C.__esModule)return C;var j=C.default;if(typeof j=="function"){var de=function Ne(){if(this instanceof Ne){var qe=[null];qe.push.apply(qe,arguments);var je=Function.bind.apply(j,qe);return new je}return j.apply(this,arguments)};de.prototype=j.prototype}else de={};return Object.defineProperty(de,"__esModule",{value:!0}),Object.keys(C).forEach(function(Ne){var qe=Object.getOwnPropertyDescriptor(C,Ne);Object.defineProperty(de,Ne,qe.get?qe:{enumerable:!0,get:function(){return C[Ne]}})}),de}var x={},m={RADIUS:6378137},o=m;function P(C){var j=0;if(C&&C.length>0){j+=Math.abs(L(C[0]));for(var de=1;de<C.length;de++)j-=Math.abs(L(C[de]))}return j}function L(C){var j,de,Ne,qe,je,rt,Ct=0,Dt=C.length;if(Dt>2){for(rt=0;rt<Dt;rt++)rt===Dt-2?(Ne=Dt-2,qe=Dt-1,je=0):rt===Dt-1?(Ne=Dt-1,qe=0,je=1):(Ne=rt,qe=rt+1,je=rt+2),j=C[Ne],de=C[qe],Ct+=(D(C[je][0])-D(j[0]))*Math.sin(D(de[1]));Ct=Ct*o.RADIUS*o.RADIUS/2}return Ct}function D(C){return C*Math.PI/180}x.geometry=function C(j){var de,Ne=0;switch(j.type){case"Polygon":return P(j.coordinates);case"MultiPolygon":for(de=0;de<j.coordinates.length;de++)Ne+=P(j.coordinates[de]);return Ne;case"Point":case"MultiPoint":case"LineString":case"MultiLineString":return 0;case"GeometryCollection":for(de=0;de<j.geometries.length;de++)Ne+=C(j.geometries[de]);return Ne}},x.ring=L;var F={CONTROL_BASE:"mapboxgl-ctrl",CONTROL_PREFIX:"mapboxgl-ctrl-",CONTROL_BUTTON:"mapbox-gl-draw_ctrl-draw-btn",CONTROL_BUTTON_LINE:"mapbox-gl-draw_line",CONTROL_BUTTON_POLYGON:"mapbox-gl-draw_polygon",CONTROL_BUTTON_POINT:"mapbox-gl-draw_point",CONTROL_BUTTON_TRASH:"mapbox-gl-draw_trash",CONTROL_BUTTON_COMBINE_FEATURES:"mapbox-gl-draw_combine",CONTROL_BUTTON_UNCOMBINE_FEATURES:"mapbox-gl-draw_uncombine",CONTROL_GROUP:"mapboxgl-ctrl-group",ATTRIBUTION:"mapboxgl-ctrl-attrib",ACTIVE_BUTTON:"active",BOX_SELECT:"mapbox-gl-draw_boxselect"},Y={HOT:"mapbox-gl-draw-hot",COLD:"mapbox-gl-draw-cold"},V={ADD:"add",MOVE:"move",DRAG:"drag",POINTER:"pointer",NONE:"none"},H={POLYGON:"polygon",LINE:"line_string",POINT:"point"},ve={FEATURE:"Feature",POLYGON:"Polygon",LINE_STRING:"LineString",POINT:"Point",FEATURE_COLLECTION:"FeatureCollection",MULTI_PREFIX:"Multi",MULTI_POINT:"MultiPoint",MULTI_LINE_STRING:"MultiLineString",MULTI_POLYGON:"MultiPolygon"},_e={DRAW_LINE_STRING:"draw_line_string",DRAW_POLYGON:"draw_polygon",DRAW_POINT:"draw_point",SIMPLE_SELECT:"simple_select",DIRECT_SELECT:"direct_select",STATIC:"static"},oe={CREATE:"draw.create",DELETE:"draw.delete",UPDATE:"draw.update",SELECTION_CHANGE:"draw.selectionchange",MODE_CHANGE:"draw.modechange",ACTIONABLE:"draw.actionable",RENDER:"draw.render",COMBINE_FEATURES:"draw.combine",UNCOMBINE_FEATURES:"draw.uncombine"},fe={MOVE:"move",CHANGE_COORDINATES:"change_coordinates"},K={FEATURE:"feature",MIDPOINT:"midpoint",VERTEX:"vertex"},ne={ACTIVE:"true",INACTIVE:"false"},ye=["scrollZoom","boxZoom","dragRotate","dragPan","keyboard","doubleClickZoom","touchZoomRotate"],Re=-85,Se=Object.freeze({__proto__:null,classes:F,sources:Y,cursors:V,types:H,geojsonTypes:ve,modes:_e,events:oe,updateActions:fe,meta:K,activeStates:ne,interactions:ye,LAT_MIN:-90,LAT_RENDERED_MIN:Re,LAT_MAX:90,LAT_RENDERED_MAX:85,LNG_MIN:-270,LNG_MAX:270}),Z={Point:0,LineString:1,MultiLineString:1,Polygon:2};function $(C,j){var de=Z[C.geometry.type]-Z[j.geometry.type];return de===0&&C.geometry.type===ve.POLYGON?C.area-j.area:de}function Q(C){return C.map(function(j){return j.geometry.type===ve.POLYGON&&(j.area=x.geometry({type:ve.FEATURE,property:{},geometry:j.geometry})),j}).sort($).map(function(j){return delete j.area,j})}function ue(C,j){return j===void 0&&(j=0),[[C.point.x-j,C.point.y-j],[C.point.x+j,C.point.y+j]]}function he(C){if(this._items={},this._nums={},this._length=C?C.length:0,C)for(var j=0,de=C.length;j<de;j++)this.add(C[j]),C[j]!==void 0&&(typeof C[j]=="string"?this._items[C[j]]=j:this._nums[C[j]]=j)}he.prototype.add=function(C){return this.has(C)||(this._length++,typeof C=="string"?this._items[C]=this._length:this._nums[C]=this._length),this},he.prototype.delete=function(C){return this.has(C)===!1||(this._length--,delete this._items[C],delete this._nums[C]),this},he.prototype.has=function(C){return(typeof C=="string"||typeof C=="number")&&(this._items[C]!==void 0||this._nums[C]!==void 0)},he.prototype.values=function(){var C=this,j=[];return Object.keys(this._items).forEach(function(de){j.push({k:de,v:C._items[de]})}),Object.keys(this._nums).forEach(function(de){j.push({k:JSON.parse(de),v:C._nums[de]})}),j.sort(function(de,Ne){return de.v-Ne.v}).map(function(de){return de.k})},he.prototype.clear=function(){return this._length=0,this._items={},this._nums={},this};var Pe=[K.FEATURE,K.MIDPOINT,K.VERTEX],Ae={click:function(C,j,de){return ke(C,j,de,de.options.clickBuffer)},touch:function(C,j,de){return ke(C,j,de,de.options.touchBuffer)}};function ke(C,j,de,Ne){if(de.map===null)return[];var qe=C?ue(C,Ne):j,je={};de.options.styles&&(je.layers=de.options.styles.map(function(Nt){return Nt.id}).filter(function(Nt){return de.map.getLayer(Nt)!=null}));var rt=de.map.queryRenderedFeatures(qe,je).filter(function(Nt){return Pe.indexOf(Nt.properties.meta)!==-1}),Ct=new he,Dt=[];return rt.forEach(function(Nt){var Wt=Nt.properties.id;Ct.has(Wt)||(Ct.add(Wt),Dt.push(Nt))}),Q(Dt)}function Be(C,j){var de=Ae.click(C,null,j),Ne={mouse:V.NONE};return de[0]&&(Ne.mouse=de[0].properties.active===ne.ACTIVE?V.MOVE:V.POINTER,Ne.feature=de[0].properties.meta),j.events.currentModeName().indexOf("draw")!==-1&&(Ne.mouse=V.ADD),j.ui.queueMapClasses(Ne),j.ui.updateMapClasses(),de[0]}function Ke(C,j){var de=C.x-j.x,Ne=C.y-j.y;return Math.sqrt(de*de+Ne*Ne)}function tt(C,j,de){de===void 0&&(de={});var Ne=de.fineTolerance!=null?de.fineTolerance:4,qe=de.grossTolerance!=null?de.grossTolerance:12,je=de.interval!=null?de.interval:500;C.point=C.point||j.point,C.time=C.time||j.time;var rt=Ke(C.point,j.point);return rt<Ne||rt<qe&&j.time-C.time<je}function pt(C,j,de){de===void 0&&(de={});var Ne=de.tolerance!=null?de.tolerance:25,qe=de.interval!=null?de.interval:250;return C.point=C.point||j.point,C.time=C.time||j.time,Ke(C.point,j.point)<Ne&&j.time-C.time<qe}var vt={exports:{}},Ft=vt.exports=function(C,j){if(j||(j=16),C===void 0&&(C=128),C<=0)return"0";for(var de=Math.log(Math.pow(2,C))/Math.log(j),Ne=2;de===1/0;Ne*=2)de=Math.log(Math.pow(2,C/Ne))/Math.log(j)*Ne;var qe=de-Math.floor(de),je="";for(Ne=0;Ne<Math.floor(de);Ne++)je=Math.floor(Math.random()*j).toString(j)+je;if(qe){var rt=Math.pow(j,qe);je=Math.floor(Math.random()*rt).toString(j)+je}var Ct=parseInt(je,j);return Ct!==1/0&&Ct>=Math.pow(2,C)?Ft(C,j):je};Ft.rack=function(C,j,de){var Ne=function(je){var rt=0;do{if(rt++>10){if(!de)throw new Error("too many ID collisions, use more bits");C+=de}var Ct=Ft(C,j)}while(Object.hasOwnProperty.call(qe,Ct));return qe[Ct]=je,Ct},qe=Ne.hats={};return Ne.get=function(je){return Ne.hats[je]},Ne.set=function(je,rt){return Ne.hats[je]=rt,Ne},Ne.bits=C||128,Ne.base=j||16,Ne};var It=s(vt.exports),Zt=function(C,j){this.ctx=C,this.properties=j.properties||{},this.coordinates=j.geometry.coordinates,this.id=j.id||It(),this.type=j.geometry.type};Zt.prototype.changed=function(){this.ctx.store.featureChanged(this.id)},Zt.prototype.incomingCoords=function(C){this.setCoordinates(C)},Zt.prototype.setCoordinates=function(C){this.coordinates=C,this.changed()},Zt.prototype.getCoordinates=function(){return JSON.parse(JSON.stringify(this.coordinates))},Zt.prototype.setProperty=function(C,j){this.properties[C]=j},Zt.prototype.toGeoJSON=function(){return JSON.parse(JSON.stringify({id:this.id,type:ve.FEATURE,properties:this.properties,geometry:{coordinates:this.getCoordinates(),type:this.type}}))},Zt.prototype.internal=function(C){var j={id:this.id,meta:K.FEATURE,"meta:type":this.type,active:ne.INACTIVE,mode:C};if(this.ctx.options.userProperties)for(var de in this.properties)j["user_"+de]=this.properties[de];return{type:ve.FEATURE,properties:j,geometry:{coordinates:this.getCoordinates(),type:this.type}}};var zt=function(C,j){Zt.call(this,C,j)};(zt.prototype=Object.create(Zt.prototype)).isValid=function(){return typeof this.coordinates[0]=="number"&&typeof this.coordinates[1]=="number"},zt.prototype.updateCoordinate=function(C,j,de){this.coordinates=arguments.length===3?[j,de]:[C,j],this.changed()},zt.prototype.getCoordinate=function(){return this.getCoordinates()};var ti=function(C,j){Zt.call(this,C,j)};(ti.prototype=Object.create(Zt.prototype)).isValid=function(){return this.coordinates.length>1},ti.prototype.addCoordinate=function(C,j,de){this.changed();var Ne=parseInt(C,10);this.coordinates.splice(Ne,0,[j,de])},ti.prototype.getCoordinate=function(C){var j=parseInt(C,10);return JSON.parse(JSON.stringify(this.coordinates[j]))},ti.prototype.removeCoordinate=function(C){this.changed(),this.coordinates.splice(parseInt(C,10),1)},ti.prototype.updateCoordinate=function(C,j,de){var Ne=parseInt(C,10);this.coordinates[Ne]=[j,de],this.changed()};var ai=function(C,j){Zt.call(this,C,j),this.coordinates=this.coordinates.map(function(de){return de.slice(0,-1)})};(ai.prototype=Object.create(Zt.prototype)).isValid=function(){return this.coordinates.length!==0&&this.coordinates.every(function(C){return C.length>2})},ai.prototype.incomingCoords=function(C){this.coordinates=C.map(function(j){return j.slice(0,-1)}),this.changed()},ai.prototype.setCoordinates=function(C){this.coordinates=C,this.changed()},ai.prototype.addCoordinate=function(C,j,de){this.changed();var Ne=C.split(".").map(function(qe){return parseInt(qe,10)});this.coordinates[Ne[0]].splice(Ne[1],0,[j,de])},ai.prototype.removeCoordinate=function(C){this.changed();var j=C.split(".").map(function(Ne){return parseInt(Ne,10)}),de=this.coordinates[j[0]];de&&(de.splice(j[1],1),de.length<3&&this.coordinates.splice(j[0],1))},ai.prototype.getCoordinate=function(C){var j=C.split(".").map(function(Ne){return parseInt(Ne,10)}),de=this.coordinates[j[0]];return JSON.parse(JSON.stringify(de[j[1]]))},ai.prototype.getCoordinates=function(){return this.coordinates.map(function(C){return C.concat([C[0]])})},ai.prototype.updateCoordinate=function(C,j,de){this.changed();var Ne=C.split("."),qe=parseInt(Ne[0],10),je=parseInt(Ne[1],10);this.coordinates[qe]===void 0&&(this.coordinates[qe]=[]),this.coordinates[qe][je]=[j,de]};var Ir={MultiPoint:zt,MultiLineString:ti,MultiPolygon:ai},lt=function(C,j,de,Ne,qe){var je=de.split("."),rt=parseInt(je[0],10),Ct=je[1]?je.slice(1).join("."):null;return C[rt][j](Ct,Ne,qe)},Xi=function(C,j){if(Zt.call(this,C,j),delete this.coordinates,this.model=Ir[j.geometry.type],this.model===void 0)throw new TypeError(j.geometry.type+" is not a valid type");this.features=this._coordinatesToFeatures(j.geometry.coordinates)};function ii(C){this.map=C.map,this.drawConfig=JSON.parse(JSON.stringify(C.options||{})),this._ctx=C}(Xi.prototype=Object.create(Zt.prototype))._coordinatesToFeatures=function(C){var j=this,de=this.model.bind(this);return C.map(function(Ne){return new de(j.ctx,{id:It(),type:ve.FEATURE,properties:{},geometry:{coordinates:Ne,type:j.type.replace("Multi","")}})})},Xi.prototype.isValid=function(){return this.features.every(function(C){return C.isValid()})},Xi.prototype.setCoordinates=function(C){this.features=this._coordinatesToFeatures(C),this.changed()},Xi.prototype.getCoordinate=function(C){return lt(this.features,"getCoordinate",C)},Xi.prototype.getCoordinates=function(){return JSON.parse(JSON.stringify(this.features.map(function(C){return C.type===ve.POLYGON?C.getCoordinates():C.coordinates})))},Xi.prototype.updateCoordinate=function(C,j,de){lt(this.features,"updateCoordinate",C,j,de),this.changed()},Xi.prototype.addCoordinate=function(C,j,de){lt(this.features,"addCoordinate",C,j,de),this.changed()},Xi.prototype.removeCoordinate=function(C){lt(this.features,"removeCoordinate",C),this.changed()},Xi.prototype.getFeatures=function(){return this.features},ii.prototype.setSelected=function(C){return this._ctx.store.setSelected(C)},ii.prototype.setSelectedCoordinates=function(C){var j=this;this._ctx.store.setSelectedCoordinates(C),C.reduce(function(de,Ne){return de[Ne.feature_id]===void 0&&(de[Ne.feature_id]=!0,j._ctx.store.get(Ne.feature_id).changed()),de},{})},ii.prototype.getSelected=function(){return this._ctx.store.getSelected()},ii.prototype.getSelectedIds=function(){return this._ctx.store.getSelectedIds()},ii.prototype.isSelected=function(C){return this._ctx.store.isSelected(C)},ii.prototype.getFeature=function(C){return this._ctx.store.get(C)},ii.prototype.select=function(C){return this._ctx.store.select(C)},ii.prototype.deselect=function(C){return this._ctx.store.deselect(C)},ii.prototype.deleteFeature=function(C,j){return j===void 0&&(j={}),this._ctx.store.delete(C,j)},ii.prototype.addFeature=function(C){return this._ctx.store.add(C)},ii.prototype.clearSelectedFeatures=function(){return this._ctx.store.clearSelected()},ii.prototype.clearSelectedCoordinates=function(){return this._ctx.store.clearSelectedCoordinates()},ii.prototype.setActionableState=function(C){C===void 0&&(C={});var j={trash:C.trash||!1,combineFeatures:C.combineFeatures||!1,uncombineFeatures:C.uncombineFeatures||!1};return this._ctx.events.actionable(j)},ii.prototype.changeMode=function(C,j,de){return j===void 0&&(j={}),de===void 0&&(de={}),this._ctx.events.changeMode(C,j,de)},ii.prototype.updateUIClasses=function(C){return this._ctx.ui.queueMapClasses(C)},ii.prototype.activateUIButton=function(C){return this._ctx.ui.setActiveButton(C)},ii.prototype.featuresAt=function(C,j,de){if(de===void 0&&(de="click"),de!=="click"&&de!=="touch")throw new Error("invalid buffer type");return Ae[de](C,j,this._ctx)},ii.prototype.newFeature=function(C){var j=C.geometry.type;return j===ve.POINT?new zt(this._ctx,C):j===ve.LINE_STRING?new ti(this._ctx,C):j===ve.POLYGON?new ai(this._ctx,C):new Xi(this._ctx,C)},ii.prototype.isInstanceOf=function(C,j){if(C===ve.POINT)return j instanceof zt;if(C===ve.LINE_STRING)return j instanceof ti;if(C===ve.POLYGON)return j instanceof ai;if(C==="MultiFeature")return j instanceof Xi;throw new Error("Unknown feature class: "+C)},ii.prototype.doRender=function(C){return this._ctx.store.featureChanged(C)},ii.prototype.onSetup=function(){},ii.prototype.onDrag=function(){},ii.prototype.onClick=function(){},ii.prototype.onMouseMove=function(){},ii.prototype.onMouseDown=function(){},ii.prototype.onMouseUp=function(){},ii.prototype.onMouseOut=function(){},ii.prototype.onKeyUp=function(){},ii.prototype.onKeyDown=function(){},ii.prototype.onTouchStart=function(){},ii.prototype.onTouchMove=function(){},ii.prototype.onTouchEnd=function(){},ii.prototype.onTap=function(){},ii.prototype.onStop=function(){},ii.prototype.onTrash=function(){},ii.prototype.onCombineFeature=function(){},ii.prototype.onUncombineFeature=function(){},ii.prototype.toDisplayFeatures=function(){throw new Error("You must overwrite toDisplayFeatures")};var Jt={drag:"onDrag",click:"onClick",mousemove:"onMouseMove",mousedown:"onMouseDown",mouseup:"onMouseUp",mouseout:"onMouseOut",keyup:"onKeyUp",keydown:"onKeyDown",touchstart:"onTouchStart",touchmove:"onTouchMove",touchend:"onTouchEnd",tap:"onTap"},$e=Object.keys(Jt);function zi(C){var j=Object.keys(C);return function(de,Ne){Ne===void 0&&(Ne={});var qe={},je=j.reduce(function(rt,Ct){return rt[Ct]=C[Ct],rt},new ii(de));return{start:function(){var rt=this;qe=je.onSetup(Ne),$e.forEach(function(Ct){var Dt,Nt=Jt[Ct],Wt=function(){return!1};C[Nt]&&(Wt=function(){return!0}),rt.on(Ct,Wt,(Dt=Nt,function(jt){return je[Dt](qe,jt)}))})},stop:function(){je.onStop(qe)},trash:function(){je.onTrash(qe)},combineFeatures:function(){je.onCombineFeatures(qe)},uncombineFeatures:function(){je.onUncombineFeatures(qe)},render:function(rt,Ct){je.toDisplayFeatures(qe,rt,Ct)}}}}function Qi(C){return[].concat(C).filter(function(j){return j!==void 0})}function Gi(){var C=this;if(!(C.ctx.map&&C.ctx.map.getSource(Y.HOT)!==void 0))return Dt();var j=C.ctx.events.currentModeName();C.ctx.ui.queueMapClasses({mode:j});var de=[],Ne=[];C.isDirty?Ne=C.getAllIds():(de=C.getChangedIds().filter(function(Nt){return C.get(Nt)!==void 0}),Ne=C.sources.hot.filter(function(Nt){return Nt.properties.id&&de.indexOf(Nt.properties.id)===-1&&C.get(Nt.properties.id)!==void 0}).map(function(Nt){return Nt.properties.id})),C.sources.hot=[];var qe=C.sources.cold.length;C.sources.cold=C.isDirty?[]:C.sources.cold.filter(function(Nt){var Wt=Nt.properties.id||Nt.properties.parent;return de.indexOf(Wt)===-1});var je=qe!==C.sources.cold.length||Ne.length>0;function rt(Nt,Wt){var jt=C.get(Nt).internal(j);C.ctx.events.currentModeRender(jt,function(ki){C.sources[Wt].push(ki)})}if(de.forEach(function(Nt){return rt(Nt,"hot")}),Ne.forEach(function(Nt){return rt(Nt,"cold")}),je&&C.ctx.map.getSource(Y.COLD).setData({type:ve.FEATURE_COLLECTION,features:C.sources.cold}),C.ctx.map.getSource(Y.HOT).setData({type:ve.FEATURE_COLLECTION,features:C.sources.hot}),C._emitSelectionChange&&(C.ctx.map.fire(oe.SELECTION_CHANGE,{features:C.getSelected().map(function(Nt){return Nt.toGeoJSON()}),points:C.getSelectedCoordinates().map(function(Nt){return{type:ve.FEATURE,properties:{},geometry:{type:ve.POINT,coordinates:Nt.coordinates}}})}),C._emitSelectionChange=!1),C._deletedFeaturesToEmit.length){var Ct=C._deletedFeaturesToEmit.map(function(Nt){return Nt.toGeoJSON()});C._deletedFeaturesToEmit=[],C.ctx.map.fire(oe.DELETE,{features:Ct})}function Dt(){C.isDirty=!1,C.clearChangedIds()}Dt(),C.ctx.map.fire(oe.RENDER,{})}function sr(C){var j,de=this;this._features={},this._featureIds=new he,this._selectedFeatureIds=new he,this._selectedCoordinates=[],this._changedFeatureIds=new he,this._deletedFeaturesToEmit=[],this._emitSelectionChange=!1,this._mapInitialConfig={},this.ctx=C,this.sources={hot:[],cold:[]},this.render=function(){j||(j=requestAnimationFrame(function(){j=null,Gi.call(de)}))},this.isDirty=!1}function jr(C,j){var de=C._selectedCoordinates.filter(function(Ne){return C._selectedFeatureIds.has(Ne.feature_id)});C._selectedCoordinates.length===de.length||j.silent||(C._emitSelectionChange=!0),C._selectedCoordinates=de}sr.prototype.createRenderBatch=function(){var C=this,j=this.render,de=0;return this.render=function(){de++},function(){C.render=j,de>0&&C.render()}},sr.prototype.setDirty=function(){return this.isDirty=!0,this},sr.prototype.featureChanged=function(C){return this._changedFeatureIds.add(C),this},sr.prototype.getChangedIds=function(){return this._changedFeatureIds.values()},sr.prototype.clearChangedIds=function(){return this._changedFeatureIds.clear(),this},sr.prototype.getAllIds=function(){return this._featureIds.values()},sr.prototype.add=function(C){return this.featureChanged(C.id),this._features[C.id]=C,this._featureIds.add(C.id),this},sr.prototype.delete=function(C,j){var de=this;return j===void 0&&(j={}),Qi(C).forEach(function(Ne){de._featureIds.has(Ne)&&(de._featureIds.delete(Ne),de._selectedFeatureIds.delete(Ne),j.silent||de._deletedFeaturesToEmit.indexOf(de._features[Ne])===-1&&de._deletedFeaturesToEmit.push(de._features[Ne]),delete de._features[Ne],de.isDirty=!0)}),jr(this,j),this},sr.prototype.get=function(C){return this._features[C]},sr.prototype.getAll=function(){var C=this;return Object.keys(this._features).map(function(j){return C._features[j]})},sr.prototype.select=function(C,j){var de=this;return j===void 0&&(j={}),Qi(C).forEach(function(Ne){de._selectedFeatureIds.has(Ne)||(de._selectedFeatureIds.add(Ne),de._changedFeatureIds.add(Ne),j.silent||(de._emitSelectionChange=!0))}),this},sr.prototype.deselect=function(C,j){var de=this;return j===void 0&&(j={}),Qi(C).forEach(function(Ne){de._selectedFeatureIds.has(Ne)&&(de._selectedFeatureIds.delete(Ne),de._changedFeatureIds.add(Ne),j.silent||(de._emitSelectionChange=!0))}),jr(this,j),this},sr.prototype.clearSelected=function(C){return C===void 0&&(C={}),this.deselect(this._selectedFeatureIds.values(),{silent:C.silent}),this},sr.prototype.setSelected=function(C,j){var de=this;return j===void 0&&(j={}),C=Qi(C),this.deselect(this._selectedFeatureIds.values().filter(function(Ne){return C.indexOf(Ne)===-1}),{silent:j.silent}),this.select(C.filter(function(Ne){return!de._selectedFeatureIds.has(Ne)}),{silent:j.silent}),this},sr.prototype.setSelectedCoordinates=function(C){return this._selectedCoordinates=C,this._emitSelectionChange=!0,this},sr.prototype.clearSelectedCoordinates=function(){return this._selectedCoordinates=[],this._emitSelectionChange=!0,this},sr.prototype.getSelectedIds=function(){return this._selectedFeatureIds.values()},sr.prototype.getSelected=function(){var C=this;return this._selectedFeatureIds.values().map(function(j){return C.get(j)})},sr.prototype.getSelectedCoordinates=function(){var C=this;return this._selectedCoordinates.map(function(j){return{coordinates:C.get(j.feature_id).getCoordinate(j.coord_path)}})},sr.prototype.isSelected=function(C){return this._selectedFeatureIds.has(C)},sr.prototype.setFeatureProperty=function(C,j,de){this.get(C).setProperty(j,de),this.featureChanged(C)},sr.prototype.storeMapConfig=function(){var C=this;ye.forEach(function(j){C.ctx.map[j]&&(C._mapInitialConfig[j]=C.ctx.map[j].isEnabled())})},sr.prototype.restoreMapConfig=function(){var C=this;Object.keys(this._mapInitialConfig).forEach(function(j){C._mapInitialConfig[j]?C.ctx.map[j].enable():C.ctx.map[j].disable()})},sr.prototype.getInitialConfigValue=function(C){return this._mapInitialConfig[C]===void 0||this._mapInitialConfig[C]};var En=function(){for(var C=arguments,j={},de=0;de<arguments.length;de++){var Ne=C[de];for(var qe in Ne)Ot.call(Ne,qe)&&(j[qe]=Ne[qe])}return j},Ot=Object.prototype.hasOwnProperty,In=s(En),xs=["mode","feature","mouse"];function os(C){var j=null,de=null,Ne={onRemove:function(){return C.map.off("load",Ne.connect),clearInterval(de),Ne.removeLayers(),C.store.restoreMapConfig(),C.ui.removeButtons(),C.events.removeEventListeners(),C.ui.clearMapClasses(),C.boxZoomInitial&&C.map.boxZoom.enable(),C.map=null,C.container=null,C.store=null,j&&j.parentNode&&j.parentNode.removeChild(j),j=null,this},connect:function(){C.map.off("load",Ne.connect),clearInterval(de),Ne.addLayers(),C.store.storeMapConfig(),C.events.addEventListeners()},onAdd:function(qe){var je=qe.fire;return qe.fire=function(rt,Ct){var Dt=arguments;return je.length===1&&arguments.length!==1&&(Dt=[In({},{type:rt},Ct)]),je.apply(qe,Dt)},C.map=qe,C.events=function(rt){var Ct=Object.keys(rt.options.modes).reduce(function(Mt,ei){return Mt[ei]=zi(rt.options.modes[ei]),Mt},{}),Dt={},Nt={},Wt={},jt=null,ki=null;Wt.drag=function(Mt,ei){ei({point:Mt.point,time:new Date().getTime()})?(rt.ui.queueMapClasses({mouse:V.DRAG}),ki.drag(Mt)):Mt.originalEvent.stopPropagation()},Wt.mousedrag=function(Mt){Wt.drag(Mt,function(ei){return!tt(Dt,ei)})},Wt.touchdrag=function(Mt){Wt.drag(Mt,function(ei){return!pt(Nt,ei)})},Wt.mousemove=function(Mt){if((Mt.originalEvent.buttons!==void 0?Mt.originalEvent.buttons:Mt.originalEvent.which)===1)return Wt.mousedrag(Mt);var ei=Be(Mt,rt);Mt.featureTarget=ei,ki.mousemove(Mt)},Wt.mousedown=function(Mt){Dt={time:new Date().getTime(),point:Mt.point};var ei=Be(Mt,rt);Mt.featureTarget=ei,ki.mousedown(Mt)},Wt.mouseup=function(Mt){var ei=Be(Mt,rt);Mt.featureTarget=ei,tt(Dt,{point:Mt.point,time:new Date().getTime()})?ki.click(Mt):ki.mouseup(Mt)},Wt.mouseout=function(Mt){ki.mouseout(Mt)},Wt.touchstart=function(Mt){if(rt.options.touchEnabled){Nt={time:new Date().getTime(),point:Mt.point};var ei=Ae.touch(Mt,null,rt)[0];Mt.featureTarget=ei,ki.touchstart(Mt)}},Wt.touchmove=function(Mt){if(rt.options.touchEnabled)return ki.touchmove(Mt),Wt.touchdrag(Mt)},Wt.touchend=function(Mt){if(Mt.originalEvent.preventDefault(),rt.options.touchEnabled){var ei=Ae.touch(Mt,null,rt)[0];Mt.featureTarget=ei,pt(Nt,{time:new Date().getTime(),point:Mt.point})?ki.tap(Mt):ki.touchend(Mt)}};var si=function(Mt){return!(Mt===8||Mt===46||Mt>=48&&Mt<=57)};function Pi(Mt,ei,ji){ji===void 0&&(ji={}),ki.stop();var or=Ct[Mt];if(or===void 0)throw new Error(Mt+" is not valid");jt=Mt;var rr=or(rt,ei);ki=i(rr,rt),ji.silent||rt.map.fire(oe.MODE_CHANGE,{mode:Mt}),rt.store.setDirty(),rt.store.render()}Wt.keydown=function(Mt){(Mt.srcElement||Mt.target).classList.contains("mapboxgl-canvas")&&(Mt.keyCode!==8&&Mt.keyCode!==46||!rt.options.controls.trash?si(Mt.keyCode)?ki.keydown(Mt):Mt.keyCode===49&&rt.options.controls.point?Pi(_e.DRAW_POINT):Mt.keyCode===50&&rt.options.controls.line_string?Pi(_e.DRAW_LINE_STRING):Mt.keyCode===51&&rt.options.controls.polygon&&Pi(_e.DRAW_POLYGON):(Mt.preventDefault(),ki.trash()))},Wt.keyup=function(Mt){si(Mt.keyCode)&&ki.keyup(Mt)},Wt.zoomend=function(){rt.store.changeZoom()},Wt.data=function(Mt){if(Mt.dataType==="style"){var ei=rt.setup,ji=rt.map,or=rt.options,rr=rt.store;or.styles.some(function(Ar){return ji.getLayer(Ar.id)})||(ei.addLayers(),rr.setDirty(),rr.render())}};var Rr={trash:!1,combineFeatures:!1,uncombineFeatures:!1};return{start:function(){jt=rt.options.defaultMode,ki=i(Ct[jt](rt),rt)},changeMode:Pi,actionable:function(Mt){var ei=!1;Object.keys(Mt).forEach(function(ji){if(Rr[ji]===void 0)throw new Error("Invalid action type");Rr[ji]!==Mt[ji]&&(ei=!0),Rr[ji]=Mt[ji]}),ei&&rt.map.fire(oe.ACTIONABLE,{actions:Rr})},currentModeName:function(){return jt},currentModeRender:function(Mt,ei){return ki.render(Mt,ei)},fire:function(Mt,ei){Wt[Mt]&&Wt[Mt](ei)},addEventListeners:function(){rt.map.on("mousemove",Wt.mousemove),rt.map.on("mousedown",Wt.mousedown),rt.map.on("mouseup",Wt.mouseup),rt.map.on("data",Wt.data),rt.map.on("touchmove",Wt.touchmove),rt.map.on("touchstart",Wt.touchstart),rt.map.on("touchend",Wt.touchend),rt.container.addEventListener("mouseout",Wt.mouseout),rt.options.keybindings&&(rt.container.addEventListener("keydown",Wt.keydown),rt.container.addEventListener("keyup",Wt.keyup))},removeEventListeners:function(){rt.map.off("mousemove",Wt.mousemove),rt.map.off("mousedown",Wt.mousedown),rt.map.off("mouseup",Wt.mouseup),rt.map.off("data",Wt.data),rt.map.off("touchmove",Wt.touchmove),rt.map.off("touchstart",Wt.touchstart),rt.map.off("touchend",Wt.touchend),rt.container.removeEventListener("mouseout",Wt.mouseout),rt.options.keybindings&&(rt.container.removeEventListener("keydown",Wt.keydown),rt.container.removeEventListener("keyup",Wt.keyup))},trash:function(Mt){ki.trash(Mt)},combineFeatures:function(){ki.combineFeatures()},uncombineFeatures:function(){ki.uncombineFeatures()},getMode:function(){return jt}}}(C),C.ui=function(rt){var Ct={},Dt=null,Nt={mode:null,feature:null,mouse:null},Wt={mode:null,feature:null,mouse:null};function jt(Mt){Wt=In(Wt,Mt)}function ki(){var Mt,ei;if(rt.container){var ji=[],or=[];xs.forEach(function(rr){Wt[rr]!==Nt[rr]&&(ji.push(rr+"-"+Nt[rr]),Wt[rr]!==null&&or.push(rr+"-"+Wt[rr]))}),ji.length>0&&(Mt=rt.container.classList).remove.apply(Mt,ji),or.length>0&&(ei=rt.container.classList).add.apply(ei,or),Nt=In(Nt,Wt)}}function si(Mt,ei){ei===void 0&&(ei={});var ji=document.createElement("button");return ji.className=F.CONTROL_BUTTON+" "+ei.className,ji.setAttribute("title",ei.title),ei.container.appendChild(ji),ji.addEventListener("click",function(or){if(or.preventDefault(),or.stopPropagation(),or.target===Dt)return Pi(),void ei.onDeactivate();Rr(Mt),ei.onActivate()},!0),ji}function Pi(){Dt&&(Dt.classList.remove(F.ACTIVE_BUTTON),Dt=null)}function Rr(Mt){Pi();var ei=Ct[Mt];ei&&ei&&Mt!=="trash"&&(ei.classList.add(F.ACTIVE_BUTTON),Dt=ei)}return{setActiveButton:Rr,queueMapClasses:jt,updateMapClasses:ki,clearMapClasses:function(){jt({mode:null,feature:null,mouse:null}),ki()},addButtons:function(){var Mt=rt.options.controls,ei=document.createElement("div");return ei.className=F.CONTROL_GROUP+" "+F.CONTROL_BASE,Mt&&(Mt[H.LINE]&&(Ct[H.LINE]=si(H.LINE,{container:ei,className:F.CONTROL_BUTTON_LINE,title:"LineString tool "+(rt.options.keybindings?"(l)":""),onActivate:function(){return rt.events.changeMode(_e.DRAW_LINE_STRING)},onDeactivate:function(){return rt.events.trash()}})),Mt[H.POLYGON]&&(Ct[H.POLYGON]=si(H.POLYGON,{container:ei,className:F.CONTROL_BUTTON_POLYGON,title:"Polygon tool "+(rt.options.keybindings?"(p)":""),onActivate:function(){return rt.events.changeMode(_e.DRAW_POLYGON)},onDeactivate:function(){return rt.events.trash()}})),Mt[H.POINT]&&(Ct[H.POINT]=si(H.POINT,{container:ei,className:F.CONTROL_BUTTON_POINT,title:"Marker tool "+(rt.options.keybindings?"(m)":""),onActivate:function(){return rt.events.changeMode(_e.DRAW_POINT)},onDeactivate:function(){return rt.events.trash()}})),Mt.trash&&(Ct.trash=si("trash",{container:ei,className:F.CONTROL_BUTTON_TRASH,title:"Delete",onActivate:function(){rt.events.trash()}})),Mt.combine_features&&(Ct.combine_features=si("combineFeatures",{container:ei,className:F.CONTROL_BUTTON_COMBINE_FEATURES,title:"Combine",onActivate:function(){rt.events.combineFeatures()}})),Mt.uncombine_features&&(Ct.uncombine_features=si("uncombineFeatures",{container:ei,className:F.CONTROL_BUTTON_UNCOMBINE_FEATURES,title:"Uncombine",onActivate:function(){rt.events.uncombineFeatures()}}))),ei},removeButtons:function(){Object.keys(Ct).forEach(function(Mt){var ei=Ct[Mt];ei.parentNode&&ei.parentNode.removeChild(ei),delete Ct[Mt]})}}}(C),C.container=qe.getContainer(),C.store=new sr(C),j=C.ui.addButtons(),C.options.boxSelect&&(C.boxZoomInitial=qe.boxZoom.isEnabled(),qe.boxZoom.disable(),qe.dragPan.disable(),qe.dragPan.enable()),qe.loaded()?Ne.connect():(qe.on("load",Ne.connect),de=setInterval(function(){qe.loaded()&&Ne.connect()},16)),C.events.start(),j},addLayers:function(){C.map.addSource(Y.COLD,{data:{type:ve.FEATURE_COLLECTION,features:[]},type:"geojson"}),C.map.addSource(Y.HOT,{data:{type:ve.FEATURE_COLLECTION,features:[]},type:"geojson"}),C.options.styles.forEach(function(qe){C.map.addLayer(qe)}),C.store.setDirty(!0),C.store.render()},removeLayers:function(){C.options.styles.forEach(function(qe){C.map.getLayer(qe.id)&&C.map.removeLayer(qe.id)}),C.map.getSource(Y.COLD)&&C.map.removeSource(Y.COLD),C.map.getSource(Y.HOT)&&C.map.removeSource(Y.HOT)}};return C.setup=Ne,Ne}var $s=[{id:"gl-draw-polygon-fill-inactive",type:"fill",filter:["all",["==","active","false"],["==","$type","Polygon"],["!=","mode","static"]],paint:{"fill-color":"#3bb2d0","fill-outline-color":"#3bb2d0","fill-opacity":.1}},{id:"gl-draw-polygon-fill-active",type:"fill",filter:["all",["==","active","true"],["==","$type","Polygon"]],paint:{"fill-color":"#fbb03b","fill-outline-color":"#fbb03b","fill-opacity":.1}},{id:"gl-draw-polygon-midpoint",type:"circle",filter:["all",["==","$type","Point"],["==","meta","midpoint"]],paint:{"circle-radius":3,"circle-color":"#fbb03b"}},{id:"gl-draw-polygon-stroke-inactive",type:"line",filter:["all",["==","active","false"],["==","$type","Polygon"],["!=","mode","static"]],layout:{"line-cap":"round","line-join":"round"},paint:{"line-color":"#3bb2d0","line-width":2}},{id:"gl-draw-polygon-stroke-active",type:"line",filter:["all",["==","active","true"],["==","$type","Polygon"]],layout:{"line-cap":"round","line-join":"round"},paint:{"line-color":"#fbb03b","line-dasharray":[.2,2],"line-width":2}},{id:"gl-draw-line-inactive",type:"line",filter:["all",["==","active","false"],["==","$type","LineString"],["!=","mode","static"]],layout:{"line-cap":"round","line-join":"round"},paint:{"line-color":"#3bb2d0","line-width":2}},{id:"gl-draw-line-active",type:"line",filter:["all",["==","$type","LineString"],["==","active","true"]],layout:{"line-cap":"round","line-join":"round"},paint:{"line-color":"#fbb03b","line-dasharray":[.2,2],"line-width":2}},{id:"gl-draw-polygon-and-line-vertex-stroke-inactive",type:"circle",filter:["all",["==","meta","vertex"],["==","$type","Point"],["!=","mode","static"]],paint:{"circle-radius":5,"circle-color":"#fff"}},{id:"gl-draw-polygon-and-line-vertex-inactive",type:"circle",filter:["all",["==","meta","vertex"],["==","$type","Point"],["!=","mode","static"]],paint:{"circle-radius":3,"circle-color":"#fbb03b"}},{id:"gl-draw-point-point-stroke-inactive",type:"circle",filter:["all",["==","active","false"],["==","$type","Point"],["==","meta","feature"],["!=","mode","static"]],paint:{"circle-radius":5,"circle-opacity":1,"circle-color":"#fff"}},{id:"gl-draw-point-inactive",type:"circle",filter:["all",["==","active","false"],["==","$type","Point"],["==","meta","feature"],["!=","mode","static"]],paint:{"circle-radius":3,"circle-color":"#3bb2d0"}},{id:"gl-draw-point-stroke-active",type:"circle",filter:["all",["==","$type","Point"],["==","active","true"],["!=","meta","midpoint"]],paint:{"circle-radius":7,"circle-color":"#fff"}},{id:"gl-draw-point-active",type:"circle",filter:["all",["==","$type","Point"],["!=","meta","midpoint"],["==","active","true"]],paint:{"circle-radius":5,"circle-color":"#fbb03b"}},{id:"gl-draw-polygon-fill-static",type:"fill",filter:["all",["==","mode","static"],["==","$type","Polygon"]],paint:{"fill-color":"#404040","fill-outline-color":"#404040","fill-opacity":.1}},{id:"gl-draw-polygon-stroke-static",type:"line",filter:["all",["==","mode","static"],["==","$type","Polygon"]],layout:{"line-cap":"round","line-join":"round"},paint:{"line-color":"#404040","line-width":2}},{id:"gl-draw-line-static",type:"line",filter:["all",["==","mode","static"],["==","$type","LineString"]],layout:{"line-cap":"round","line-join":"round"},paint:{"line-color":"#404040","line-width":2}},{id:"gl-draw-point-static",type:"circle",filter:["all",["==","mode","static"],["==","$type","Point"]],paint:{"circle-radius":5,"circle-color":"#404040"}}];function Xt(C){return function(j){var de=j.featureTarget;return!!de&&!!de.properties&&de.properties.meta===C}}function _r(C){return!!C.originalEvent&&!!C.originalEvent.shiftKey&&C.originalEvent.button===0}function gi(C){return!!C.featureTarget&&!!C.featureTarget.properties&&C.featureTarget.properties.active===ne.ACTIVE&&C.featureTarget.properties.meta===K.FEATURE}function rn(C){return!!C.featureTarget&&!!C.featureTarget.properties&&C.featureTarget.properties.active===ne.INACTIVE&&C.featureTarget.properties.meta===K.FEATURE}function oi(C){return C.featureTarget===void 0}function er(C){return!!C.featureTarget&&!!C.featureTarget.properties&&C.featureTarget.properties.meta===K.FEATURE}function Bi(C){var j=C.featureTarget;return!!j&&!!j.properties&&j.properties.meta===K.VERTEX}function Ii(C){return!!C.originalEvent&&C.originalEvent.shiftKey===!0}function et(C){return C.keyCode===27}function le(C){return C.keyCode===13}var pe=Object.freeze({__proto__:null,isOfMetaType:Xt,isShiftMousedown:_r,isActiveFeature:gi,isInactiveFeature:rn,noTarget:oi,isFeature:er,isVertex:Bi,isShiftDown:Ii,isEscapeKey:et,isEnterKey:le,isTrue:function(){return!0}}),me=Le;function Le(C,j){this.x=C,this.y=j}Le.prototype={clone:function(){return new Le(this.x,this.y)},add:function(C){return this.clone()._add(C)},sub:function(C){return this.clone()._sub(C)},multByPoint:function(C){return this.clone()._multByPoint(C)},divByPoint:function(C){return this.clone()._divByPoint(C)},mult:function(C){return this.clone()._mult(C)},div:function(C){return this.clone()._div(C)},rotate:function(C){return this.clone()._rotate(C)},rotateAround:function(C,j){return this.clone()._rotateAround(C,j)},matMult:function(C){return this.clone()._matMult(C)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(C){return this.x===C.x&&this.y===C.y},dist:function(C){return Math.sqrt(this.distSqr(C))},distSqr:function(C){var j=C.x-this.x,de=C.y-this.y;return j*j+de*de},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(C){return Math.atan2(this.y-C.y,this.x-C.x)},angleWith:function(C){return this.angleWithSep(C.x,C.y)},angleWithSep:function(C,j){return Math.atan2(this.x*j-this.y*C,this.x*C+this.y*j)},_matMult:function(C){var j=C[0]*this.x+C[1]*this.y,de=C[2]*this.x+C[3]*this.y;return this.x=j,this.y=de,this},_add:function(C){return this.x+=C.x,this.y+=C.y,this},_sub:function(C){return this.x-=C.x,this.y-=C.y,this},_mult:function(C){return this.x*=C,this.y*=C,this},_div:function(C){return this.x/=C,this.y/=C,this},_multByPoint:function(C){return this.x*=C.x,this.y*=C.y,this},_divByPoint:function(C){return this.x/=C.x,this.y/=C.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var C=this.y;return this.y=this.x,this.x=-C,this},_rotate:function(C){var j=Math.cos(C),de=Math.sin(C),Ne=j*this.x-de*this.y,qe=de*this.x+j*this.y;return this.x=Ne,this.y=qe,this},_rotateAround:function(C,j){var de=Math.cos(C),Ne=Math.sin(C),qe=j.x+de*(this.x-j.x)-Ne*(this.y-j.y),je=j.y+Ne*(this.x-j.x)+de*(this.y-j.y);return this.x=qe,this.y=je,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},Le.convert=function(C){return C instanceof Le?C:Array.isArray(C)?new Le(C[0],C[1]):C};var Ze=s(me);function Je(C,j){var de=j.getBoundingClientRect();return new Ze(C.clientX-de.left-(j.clientLeft||0),C.clientY-de.top-(j.clientTop||0))}function at(C,j,de,Ne){return{type:ve.FEATURE,properties:{meta:K.VERTEX,parent:C,coord_path:de,active:Ne?ne.ACTIVE:ne.INACTIVE},geometry:{type:ve.POINT,coordinates:j}}}function He(C,j,de){var Ne=j.geometry.coordinates,qe=de.geometry.coordinates;if(Ne[1]>85||Ne[1]<Re||qe[1]>85||qe[1]<Re)return null;var je={lng:(Ne[0]+qe[0])/2,lat:(Ne[1]+qe[1])/2};return{type:ve.FEATURE,properties:{meta:K.MIDPOINT,parent:C,lng:je.lng,lat:je.lat,coord_path:de.properties.coord_path},geometry:{type:ve.POINT,coordinates:[je.lng,je.lat]}}}function gt(C,j,de){j===void 0&&(j={}),de===void 0&&(de=null);var Ne,qe=C.geometry,je=qe.type,rt=qe.coordinates,Ct=C.properties&&C.properties.id,Dt=[];function Nt(jt,ki){var si="",Pi=null;jt.forEach(function(Rr,Mt){var ei=ki!=null?ki+"."+Mt:String(Mt),ji=at(Ct,Rr,ei,Wt(ei));if(j.midpoints&&Pi){var or=He(Ct,Pi,ji);or&&Dt.push(or)}Pi=ji;var rr=JSON.stringify(Rr);si!==rr&&Dt.push(ji),Mt===0&&(si=rr)})}function Wt(jt){return!!j.selectedPaths&&j.selectedPaths.indexOf(jt)!==-1}return je===ve.POINT?Dt.push(at(Ct,rt,de,Wt(de))):je===ve.POLYGON?rt.forEach(function(jt,ki){Nt(jt,de!==null?de+"."+ki:String(ki))}):je===ve.LINE_STRING?Nt(rt,de):je.indexOf(ve.MULTI_PREFIX)===0&&(Ne=je.replace(ve.MULTI_PREFIX,""),rt.forEach(function(jt,ki){var si={type:ve.FEATURE,properties:C.properties,geometry:{type:Ne,coordinates:jt}};Dt=Dt.concat(gt(si,j,ki))})),Dt}var ft={enable:function(C){setTimeout(function(){C.map&&C.map.doubleClickZoom&&C._ctx&&C._ctx.store&&C._ctx.store.getInitialConfigValue&&C._ctx.store.getInitialConfigValue("doubleClickZoom")&&C.map.doubleClickZoom.enable()},0)},disable:function(C){setTimeout(function(){C.map&&C.map.doubleClickZoom&&C.map.doubleClickZoom.disable()},0)}},nt={exports:{}},Tt=function(C){if(!C||!C.type)return null;var j=Ve[C.type];if(!j)return null;if(j==="geometry")return{type:"FeatureCollection",features:[{type:"Feature",properties:{},geometry:C}]};if(j==="feature")return{type:"FeatureCollection",features:[C]};if(j==="featurecollection")return C},Ve={Point:"geometry",MultiPoint:"geometry",LineString:"geometry",MultiLineString:"geometry",Polygon:"geometry",MultiPolygon:"geometry",GeometryCollection:"geometry",Feature:"feature",FeatureCollection:"featurecollection"},Ut=s(Tt),bt=Object.freeze({__proto__:null,default:function C(j){switch(j&&j.type||null){case"FeatureCollection":return j.features=j.features.reduce(function(de,Ne){return de.concat(C(Ne))},[]),j;case"Feature":return j.geometry?C(j.geometry).map(function(de){var Ne={type:"Feature",properties:JSON.parse(JSON.stringify(j.properties)),geometry:de};return j.id!==void 0&&(Ne.id=j.id),Ne}):[j];case"MultiPoint":return j.coordinates.map(function(de){return{type:"Point",coordinates:de}});case"MultiPolygon":return j.coordinates.map(function(de){return{type:"Polygon",coordinates:de}});case"MultiLineString":return j.coordinates.map(function(de){return{type:"LineString",coordinates:de}});case"GeometryCollection":return j.geometries.map(C).reduce(function(de,Ne){return de.concat(Ne)},[]);case"Point":case"Polygon":case"LineString":return[j]}}}),Ht=Tt,li=h(bt),Ci=function(C){return function j(de){return Array.isArray(de)&&de.length&&typeof de[0]=="number"?[de]:de.reduce(function(Ne,qe){return Array.isArray(qe)&&Array.isArray(qe[0])?Ne.concat(j(qe)):(Ne.push(qe),Ne)},[])}(C)};li instanceof Function||(li=li.default);var br={exports:{}},ur=br.exports=function(C){return new Ui(C)};function Ui(C){this.value=C}function Mi(C,j,de){var Ne=[],qe=[],je=!0;return function rt(Ct){var Dt=de?Hi(Ct):Ct,Nt={},Wt=!0,jt={node:Dt,node_:Ct,path:[].concat(Ne),parent:qe[qe.length-1],parents:qe,key:Ne.slice(-1)[0],isRoot:Ne.length===0,level:Ne.length,circular:null,update:function(Pi,Rr){jt.isRoot||(jt.parent.node[jt.key]=Pi),jt.node=Pi,Rr&&(Wt=!1)},delete:function(Pi){delete jt.parent.node[jt.key],Pi&&(Wt=!1)},remove:function(Pi){Kr(jt.parent.node)?jt.parent.node.splice(jt.key,1):delete jt.parent.node[jt.key],Pi&&(Wt=!1)},keys:null,before:function(Pi){Nt.before=Pi},after:function(Pi){Nt.after=Pi},pre:function(Pi){Nt.pre=Pi},post:function(Pi){Nt.post=Pi},stop:function(){je=!1},block:function(){Wt=!1}};if(!je)return jt;function ki(){if(typeof jt.node=="object"&&jt.node!==null){jt.keys&&jt.node_===jt.node||(jt.keys=Lr(jt.node)),jt.isLeaf=jt.keys.length==0;for(var Pi=0;Pi<qe.length;Pi++)if(qe[Pi].node_===Ct){jt.circular=qe[Pi];break}}else jt.isLeaf=!0,jt.keys=null;jt.notLeaf=!jt.isLeaf,jt.notRoot=!jt.isRoot}ki();var si=j.call(jt,jt.node);return si!==void 0&&jt.update&&jt.update(si),Nt.before&&Nt.before.call(jt,jt.node),Wt&&(typeof jt.node!="object"||jt.node===null||jt.circular||(qe.push(jt),ki(),Sr(jt.keys,function(Pi,Rr){Ne.push(Pi),Nt.pre&&Nt.pre.call(jt,jt.node[Pi],Pi);var Mt=rt(jt.node[Pi]);de&&Or.call(jt.node,Pi)&&(jt.node[Pi]=Mt.node),Mt.isLast=Rr==jt.keys.length-1,Mt.isFirst=Rr==0,Nt.post&&Nt.post.call(jt,Mt),Ne.pop()}),qe.pop()),Nt.after&&Nt.after.call(jt,jt.node)),jt}(C).node}function Hi(C){if(typeof C=="object"&&C!==null){var j;if(Kr(C))j=[];else if(Rt(C)==="[object Date]")j=new Date(C.getTime?C.getTime():C);else if(function(qe){return Rt(qe)==="[object RegExp]"}(C))j=new RegExp(C);else if(function(qe){return Rt(qe)==="[object Error]"}(C))j={message:C.message};else if(function(qe){return Rt(qe)==="[object Boolean]"}(C))j=new Boolean(C);else if(function(qe){return Rt(qe)==="[object Number]"}(C))j=new Number(C);else if(function(qe){return Rt(qe)==="[object String]"}(C))j=new String(C);else if(Object.create&&Object.getPrototypeOf)j=Object.create(Object.getPrototypeOf(C));else if(C.constructor===Object)j={};else{var de=C.constructor&&C.constructor.prototype||C.__proto__||{},Ne=function(){};Ne.prototype=de,j=new Ne}return Sr(Lr(C),function(qe){j[qe]=C[qe]}),j}return C}Ui.prototype.get=function(C){for(var j=this.value,de=0;de<C.length;de++){var Ne=C[de];if(!j||!Or.call(j,Ne)){j=void 0;break}j=j[Ne]}return j},Ui.prototype.has=function(C){for(var j=this.value,de=0;de<C.length;de++){var Ne=C[de];if(!j||!Or.call(j,Ne))return!1;j=j[Ne]}return!0},Ui.prototype.set=function(C,j){for(var de=this.value,Ne=0;Ne<C.length-1;Ne++){var qe=C[Ne];Or.call(de,qe)||(de[qe]={}),de=de[qe]}return de[C[Ne]]=j,j},Ui.prototype.map=function(C){return Mi(this.value,C,!0)},Ui.prototype.forEach=function(C){return this.value=Mi(this.value,C,!1),this.value},Ui.prototype.reduce=function(C,j){var de=arguments.length===1,Ne=de?this.value:j;return this.forEach(function(qe){this.isRoot&&de||(Ne=C.call(this,Ne,qe))}),Ne},Ui.prototype.paths=function(){var C=[];return this.forEach(function(j){C.push(this.path)}),C},Ui.prototype.nodes=function(){var C=[];return this.forEach(function(j){C.push(this.node)}),C},Ui.prototype.clone=function(){var C=[],j=[];return function de(Ne){for(var qe=0;qe<C.length;qe++)if(C[qe]===Ne)return j[qe];if(typeof Ne=="object"&&Ne!==null){var je=Hi(Ne);return C.push(Ne),j.push(je),Sr(Lr(Ne),function(rt){je[rt]=de(Ne[rt])}),C.pop(),j.pop(),je}return Ne}(this.value)};var Lr=Object.keys||function(C){var j=[];for(var de in C)j.push(de);return j};function Rt(C){return Object.prototype.toString.call(C)}var Kr=Array.isArray||function(C){return Object.prototype.toString.call(C)==="[object Array]"},Sr=function(C,j){if(C.forEach)return C.forEach(j);for(var de=0;de<C.length;de++)j(C[de],de,C)};Sr(Lr(Ui.prototype),function(C){ur[C]=function(j){var de=[].slice.call(arguments,1),Ne=new Ui(j);return Ne[C].apply(Ne,de)}});var Or=Object.hasOwnProperty||function(C,j){return j in C},Ps=br.exports,Bt=xi;function xi(C){if(!(this instanceof xi))return new xi(C);this._bbox=C||[1/0,1/0,-1/0,-1/0],this._valid=!!C}xi.prototype.include=function(C){return this._valid=!0,this._bbox[0]=Math.min(this._bbox[0],C[0]),this._bbox[1]=Math.min(this._bbox[1],C[1]),this._bbox[2]=Math.max(this._bbox[2],C[0]),this._bbox[3]=Math.max(this._bbox[3],C[1]),this},xi.prototype.equals=function(C){var j;return j=C instanceof xi?C.bbox():C,this._bbox[0]==j[0]&&this._bbox[1]==j[1]&&this._bbox[2]==j[2]&&this._bbox[3]==j[3]},xi.prototype.center=function(C){return this._valid?[(this._bbox[0]+this._bbox[2])/2,(this._bbox[1]+this._bbox[3])/2]:null},xi.prototype.union=function(C){var j;return this._valid=!0,j=C instanceof xi?C.bbox():C,this._bbox[0]=Math.min(this._bbox[0],j[0]),this._bbox[1]=Math.min(this._bbox[1],j[1]),this._bbox[2]=Math.max(this._bbox[2],j[2]),this._bbox[3]=Math.max(this._bbox[3],j[3]),this},xi.prototype.bbox=function(){return this._valid?this._bbox:null},xi.prototype.contains=function(C){if(!C)return this._fastContains();if(!this._valid)return null;var j=C[0],de=C[1];return this._bbox[0]<=j&&this._bbox[1]<=de&&this._bbox[2]>=j&&this._bbox[3]>=de},xi.prototype.intersect=function(C){return this._valid?(j=C instanceof xi?C.bbox():C,!(this._bbox[0]>j[2]||this._bbox[2]<j[0]||this._bbox[3]<j[1]||this._bbox[1]>j[3])):null;var j},xi.prototype._fastContains=function(){if(!this._valid)return new Function("return null;");var C="return "+this._bbox[0]+"<= ll[0] &&"+this._bbox[1]+"<= ll[1] &&"+this._bbox[2]+">= ll[0] &&"+this._bbox[3]+">= ll[1]";return new Function("ll",C)},xi.prototype.polygon=function(){return this._valid?{type:"Polygon",coordinates:[[[this._bbox[0],this._bbox[1]],[this._bbox[2],this._bbox[1]],[this._bbox[2],this._bbox[3]],[this._bbox[0],this._bbox[3]],[this._bbox[0],this._bbox[1]]]]}:null};var it=function(C){if(!C)return[];var j=li(Ht(C)),de=[];return j.features.forEach(function(Ne){Ne.geometry&&(de=de.concat(Ci(Ne.geometry.coordinates)))}),de},Wi=Ps,Dr=Bt,Er={features:["FeatureCollection"],coordinates:["Point","MultiPoint","LineString","MultiLineString","Polygon","MultiPolygon"],geometry:["Feature"],geometries:["GeometryCollection"]},ri=Object.keys(Er);function Wr(C){for(var j=Dr(),de=it(C),Ne=0;Ne<de.length;Ne++)j.include(de[Ne]);return j}nt.exports=function(C){return Wr(C).bbox()},nt.exports.polygon=function(C){return Wr(C).polygon()},nt.exports.bboxify=function(C){return Wi(C).map(function(j){j&&ri.some(function(de){return!!j[de]&&Er[de].indexOf(j.type)!==-1})&&(j.bbox=Wr(j).bbox(),this.update(j))})};var vn=s(nt.exports),Ai=-90;function Sn(C,j){var de=Ai,Ne=90,qe=Ai,je=90,rt=270,Ct=-270;C.forEach(function(Nt){var Wt=vn(Nt),jt=Wt[1],ki=Wt[3],si=Wt[0],Pi=Wt[2];jt>de&&(de=jt),ki<Ne&&(Ne=ki),ki>qe&&(qe=ki),jt<je&&(je=jt),si<rt&&(rt=si),Pi>Ct&&(Ct=Pi)});var Dt=j;return de+Dt.lat>85&&(Dt.lat=85-de),qe+Dt.lat>90&&(Dt.lat=90-qe),Ne+Dt.lat<-85&&(Dt.lat=-85-Ne),je+Dt.lat<Ai&&(Dt.lat=Ai-je),rt+Dt.lng<=-270&&(Dt.lng+=360*Math.ceil(Math.abs(Dt.lng)/360)),Ct+Dt.lng>=270&&(Dt.lng-=360*Math.ceil(Math.abs(Dt.lng)/360)),Dt}function Yr(C,j){var de=Sn(C.map(function(Ne){return Ne.toGeoJSON()}),j);C.forEach(function(Ne){var qe,je=Ne.getCoordinates(),rt=function(Dt){var Nt={lng:Dt[0]+de.lng,lat:Dt[1]+de.lat};return[Nt.lng,Nt.lat]},Ct=function(Dt){return Dt.map(function(Nt){return rt(Nt)})};Ne.type===ve.POINT?qe=rt(je):Ne.type===ve.LINE_STRING||Ne.type===ve.MULTI_POINT?qe=je.map(rt):Ne.type===ve.POLYGON||Ne.type===ve.MULTI_LINE_STRING?qe=je.map(Ct):Ne.type===ve.MULTI_POLYGON&&(qe=je.map(function(Dt){return Dt.map(function(Nt){return Ct(Nt)})})),Ne.incomingCoords(qe)})}var gr={onSetup:function(C){var j=this,de={dragMoveLocation:null,boxSelectStartLocation:null,boxSelectElement:void 0,boxSelecting:!1,canBoxSelect:!1,dragMoving:!1,canDragMove:!1,initiallySelectedFeatureIds:C.featureIds||[]};return this.setSelected(de.initiallySelectedFeatureIds.filter(function(Ne){return j.getFeature(Ne)!==void 0})),this.fireActionable(),this.setActionableState({combineFeatures:!0,uncombineFeatures:!0,trash:!0}),de},fireUpdate:function(){this.map.fire(oe.UPDATE,{action:fe.MOVE,features:this.getSelected().map(function(C){return C.toGeoJSON()})})},fireActionable:function(){var C=this,j=this.getSelected(),de=j.filter(function(Ct){return C.isInstanceOf("MultiFeature",Ct)}),Ne=!1;if(j.length>1){Ne=!0;var qe=j[0].type.replace("Multi","");j.forEach(function(Ct){Ct.type.replace("Multi","")!==qe&&(Ne=!1)})}var je=de.length>0,rt=j.length>0;this.setActionableState({combineFeatures:Ne,uncombineFeatures:je,trash:rt})},getUniqueIds:function(C){return C.length?C.map(function(j){return j.properties.id}).filter(function(j){return j!==void 0}).reduce(function(j,de){return j.add(de),j},new he).values():[]},stopExtendedInteractions:function(C){C.boxSelectElement&&(C.boxSelectElement.parentNode&&C.boxSelectElement.parentNode.removeChild(C.boxSelectElement),C.boxSelectElement=null),this.map.dragPan.enable(),C.boxSelecting=!1,C.canBoxSelect=!1,C.dragMoving=!1,C.canDragMove=!1},onStop:function(){ft.enable(this)},onMouseMove:function(C,j){return er(j)&&C.dragMoving&&this.fireUpdate(),this.stopExtendedInteractions(C),!0},onMouseOut:function(C){return!C.dragMoving||this.fireUpdate()}};gr.onTap=gr.onClick=function(C,j){return oi(j)?this.clickAnywhere(C,j):Xt(K.VERTEX)(j)?this.clickOnVertex(C,j):er(j)?this.clickOnFeature(C,j):void 0},gr.clickAnywhere=function(C){var j=this,de=this.getSelectedIds();de.length&&(this.clearSelectedFeatures(),de.forEach(function(Ne){return j.doRender(Ne)})),ft.enable(this),this.stopExtendedInteractions(C)},gr.clickOnVertex=function(C,j){this.changeMode(_e.DIRECT_SELECT,{featureId:j.featureTarget.properties.parent,coordPath:j.featureTarget.properties.coord_path,startPos:j.lngLat}),this.updateUIClasses({mouse:V.MOVE})},gr.startOnActiveFeature=function(C,j){this.stopExtendedInteractions(C),this.map.dragPan.disable(),this.doRender(j.featureTarget.properties.id),C.canDragMove=!0,C.dragMoveLocation=j.lngLat},gr.clickOnFeature=function(C,j){var de=this;ft.disable(this),this.stopExtendedInteractions(C);var Ne=Ii(j),qe=this.getSelectedIds(),je=j.featureTarget.properties.id,rt=this.isSelected(je);if(!Ne&&rt&&this.getFeature(je).type!==ve.POINT)return this.changeMode(_e.DIRECT_SELECT,{featureId:je});rt&&Ne?(this.deselect(je),this.updateUIClasses({mouse:V.POINTER}),qe.length===1&&ft.enable(this)):!rt&&Ne?(this.select(je),this.updateUIClasses({mouse:V.MOVE})):rt||Ne||(qe.forEach(function(Ct){return de.doRender(Ct)}),this.setSelected(je),this.updateUIClasses({mouse:V.MOVE})),this.doRender(je)},gr.onMouseDown=function(C,j){return gi(j)?this.startOnActiveFeature(C,j):this.drawConfig.boxSelect&&_r(j)?this.startBoxSelect(C,j):void 0},gr.startBoxSelect=function(C,j){this.stopExtendedInteractions(C),this.map.dragPan.disable(),C.boxSelectStartLocation=Je(j.originalEvent,this.map.getContainer()),C.canBoxSelect=!0},gr.onTouchStart=function(C,j){if(gi(j))return this.startOnActiveFeature(C,j)},gr.onDrag=function(C,j){return C.canDragMove?this.dragMove(C,j):this.drawConfig.boxSelect&&C.canBoxSelect?this.whileBoxSelect(C,j):void 0},gr.whileBoxSelect=function(C,j){C.boxSelecting=!0,this.updateUIClasses({mouse:V.ADD}),C.boxSelectElement||(C.boxSelectElement=document.createElement("div"),C.boxSelectElement.classList.add(F.BOX_SELECT),this.map.getContainer().appendChild(C.boxSelectElement));var de=Je(j.originalEvent,this.map.getContainer()),Ne=Math.min(C.boxSelectStartLocation.x,de.x),qe=Math.max(C.boxSelectStartLocation.x,de.x),je=Math.min(C.boxSelectStartLocation.y,de.y),rt=Math.max(C.boxSelectStartLocation.y,de.y),Ct="translate("+Ne+"px, "+je+"px)";C.boxSelectElement.style.transform=Ct,C.boxSelectElement.style.WebkitTransform=Ct,C.boxSelectElement.style.width=qe-Ne+"px",C.boxSelectElement.style.height=rt-je+"px"},gr.dragMove=function(C,j){C.dragMoving=!0,j.originalEvent.stopPropagation();var de={lng:j.lngLat.lng-C.dragMoveLocation.lng,lat:j.lngLat.lat-C.dragMoveLocation.lat};Yr(this.getSelected(),de),C.dragMoveLocation=j.lngLat},gr.onTouchEnd=gr.onMouseUp=function(C,j){var de=this;if(C.dragMoving)this.fireUpdate();else if(C.boxSelecting){var Ne=[C.boxSelectStartLocation,Je(j.originalEvent,this.map.getContainer())],qe=this.featuresAt(null,Ne,"click"),je=this.getUniqueIds(qe).filter(function(rt){return!de.isSelected(rt)});je.length&&(this.select(je),je.forEach(function(rt){return de.doRender(rt)}),this.updateUIClasses({mouse:V.MOVE}))}this.stopExtendedInteractions(C)},gr.toDisplayFeatures=function(C,j,de){j.properties.active=this.isSelected(j.properties.id)?ne.ACTIVE:ne.INACTIVE,de(j),this.fireActionable(),j.properties.active===ne.ACTIVE&&j.geometry.type!==ve.POINT&&gt(j).forEach(de)},gr.onTrash=function(){this.deleteFeature(this.getSelectedIds()),this.fireActionable()},gr.onCombineFeatures=function(){var C=this.getSelected();if(!(C.length===0||C.length<2)){for(var j=[],de=[],Ne=C[0].type.replace("Multi",""),qe=0;qe<C.length;qe++){var je=C[qe];if(je.type.replace("Multi","")!==Ne)return;je.type.includes("Multi")?je.getCoordinates().forEach(function(Ct){j.push(Ct)}):j.push(je.getCoordinates()),de.push(je.toGeoJSON())}if(de.length>1){var rt=this.newFeature({type:ve.FEATURE,properties:de[0].properties,geometry:{type:"Multi"+Ne,coordinates:j}});this.addFeature(rt),this.deleteFeature(this.getSelectedIds(),{silent:!0}),this.setSelected([rt.id]),this.map.fire(oe.COMBINE_FEATURES,{createdFeatures:[rt.toGeoJSON()],deletedFeatures:de})}this.fireActionable()}},gr.onUncombineFeatures=function(){var C=this,j=this.getSelected();if(j.length!==0){for(var de=[],Ne=[],qe=function(rt){var Ct=j[rt];C.isInstanceOf("MultiFeature",Ct)&&(Ct.getFeatures().forEach(function(Dt){C.addFeature(Dt),Dt.properties=Ct.properties,de.push(Dt.toGeoJSON()),C.select([Dt.id])}),C.deleteFeature(Ct.id,{silent:!0}),Ne.push(Ct.toGeoJSON()))},je=0;je<j.length;je++)qe(je);de.length>1&&this.map.fire(oe.UNCOMBINE_FEATURES,{createdFeatures:de,deletedFeatures:Ne}),this.fireActionable()}};var Xn=Xt(K.VERTEX),Mn=Xt(K.MIDPOINT),qi={fireUpdate:function(){this.map.fire(oe.UPDATE,{action:fe.CHANGE_COORDINATES,features:this.getSelected().map(function(C){return C.toGeoJSON()})})},fireActionable:function(C){this.setActionableState({combineFeatures:!1,uncombineFeatures:!1,trash:C.selectedCoordPaths.length>0})},startDragging:function(C,j){this.map.dragPan.disable(),C.canDragMove=!0,C.dragMoveLocation=j.lngLat},stopDragging:function(C){this.map.dragPan.enable(),C.dragMoving=!1,C.canDragMove=!1,C.dragMoveLocation=null},onVertex:function(C,j){this.startDragging(C,j);var de=j.featureTarget.properties,Ne=C.selectedCoordPaths.indexOf(de.coord_path);Ii(j)||Ne!==-1?Ii(j)&&Ne===-1&&C.selectedCoordPaths.push(de.coord_path):C.selectedCoordPaths=[de.coord_path];var qe=this.pathsToCoordinates(C.featureId,C.selectedCoordPaths);this.setSelectedCoordinates(qe)},onMidpoint:function(C,j){this.startDragging(C,j);var de=j.featureTarget.properties;C.feature.addCoordinate(de.coord_path,de.lng,de.lat),this.fireUpdate(),C.selectedCoordPaths=[de.coord_path]},pathsToCoordinates:function(C,j){return j.map(function(de){return{feature_id:C,coord_path:de}})},onFeature:function(C,j){C.selectedCoordPaths.length===0?this.startDragging(C,j):this.stopDragging(C)},dragFeature:function(C,j,de){Yr(this.getSelected(),de),C.dragMoveLocation=j.lngLat},dragVertex:function(C,j,de){for(var Ne=C.selectedCoordPaths.map(function(Ct){return C.feature.getCoordinate(Ct)}),qe=Sn(Ne.map(function(Ct){return{type:ve.FEATURE,properties:{},geometry:{type:ve.POINT,coordinates:Ct}}}),de),je=0;je<Ne.length;je++){var rt=Ne[je];C.feature.updateCoordinate(C.selectedCoordPaths[je],rt[0]+qe.lng,rt[1]+qe.lat)}},clickNoTarget:function(){this.changeMode(_e.SIMPLE_SELECT)},clickInactive:function(){this.changeMode(_e.SIMPLE_SELECT)},clickActiveFeature:function(C){C.selectedCoordPaths=[],this.clearSelectedCoordinates(),C.feature.changed()},onSetup:function(C){var j=C.featureId,de=this.getFeature(j);if(!de)throw new Error("You must provide a featureId to enter direct_select mode");if(de.type===ve.POINT)throw new TypeError("direct_select mode doesn't handle point features");var Ne={featureId:j,feature:de,dragMoveLocation:C.startPos||null,dragMoving:!1,canDragMove:!1,selectedCoordPaths:C.coordPath?[C.coordPath]:[]};return this.setSelectedCoordinates(this.pathsToCoordinates(j,Ne.selectedCoordPaths)),this.setSelected(j),ft.disable(this),this.setActionableState({trash:!0}),Ne},onStop:function(){ft.enable(this),this.clearSelectedCoordinates()},toDisplayFeatures:function(C,j,de){C.featureId===j.properties.id?(j.properties.active=ne.ACTIVE,de(j),gt(j,{map:this.map,midpoints:!0,selectedPaths:C.selectedCoordPaths}).forEach(de)):(j.properties.active=ne.INACTIVE,de(j)),this.fireActionable(C)},onTrash:function(C){C.selectedCoordPaths.sort(function(j,de){return de.localeCompare(j,"en",{numeric:!0})}).forEach(function(j){return C.feature.removeCoordinate(j)}),this.fireUpdate(),C.selectedCoordPaths=[],this.clearSelectedCoordinates(),this.fireActionable(C),C.feature.isValid()===!1&&(this.deleteFeature([C.featureId]),this.changeMode(_e.SIMPLE_SELECT,{}))},onMouseMove:function(C,j){var de=gi(j),Ne=Xn(j),qe=Mn(j),je=C.selectedCoordPaths.length===0;return de&&je||Ne&&!je?this.updateUIClasses({mouse:V.MOVE}):this.updateUIClasses({mouse:V.NONE}),(Ne||de||qe)&&C.dragMoving&&this.fireUpdate(),this.stopDragging(C),!0},onMouseOut:function(C){return C.dragMoving&&this.fireUpdate(),!0}};qi.onTouchStart=qi.onMouseDown=function(C,j){return Xn(j)?this.onVertex(C,j):gi(j)?this.onFeature(C,j):Mn(j)?this.onMidpoint(C,j):void 0},qi.onDrag=function(C,j){if(C.canDragMove===!0){C.dragMoving=!0,j.originalEvent.stopPropagation();var de={lng:j.lngLat.lng-C.dragMoveLocation.lng,lat:j.lngLat.lat-C.dragMoveLocation.lat};C.selectedCoordPaths.length>0?this.dragVertex(C,j,de):this.dragFeature(C,j,de),C.dragMoveLocation=j.lngLat}},qi.onClick=function(C,j){return oi(j)?this.clickNoTarget(C,j):gi(j)?this.clickActiveFeature(C,j):rn(j)?this.clickInactive(C,j):void this.stopDragging(C)},qi.onTap=function(C,j){return oi(j)?this.clickNoTarget(C,j):gi(j)?this.clickActiveFeature(C,j):rn(j)?this.clickInactive(C,j):void 0},qi.onTouchEnd=qi.onMouseUp=function(C){C.dragMoving&&this.fireUpdate(),this.stopDragging(C)};var xn={};function $n(C,j){return!!C.lngLat&&C.lngLat.lng===j[0]&&C.lngLat.lat===j[1]}xn.onSetup=function(){var C=this.newFeature({type:ve.FEATURE,properties:{},geometry:{type:ve.POINT,coordinates:[]}});return this.addFeature(C),this.clearSelectedFeatures(),this.updateUIClasses({mouse:V.ADD}),this.activateUIButton(H.POINT),this.setActionableState({trash:!0}),{point:C}},xn.stopDrawingAndRemove=function(C){this.deleteFeature([C.point.id],{silent:!0}),this.changeMode(_e.SIMPLE_SELECT)},xn.onTap=xn.onClick=function(C,j){this.updateUIClasses({mouse:V.MOVE}),C.point.updateCoordinate("",j.lngLat.lng,j.lngLat.lat),this.map.fire(oe.CREATE,{features:[C.point.toGeoJSON()]}),this.changeMode(_e.SIMPLE_SELECT,{featureIds:[C.point.id]})},xn.onStop=function(C){this.activateUIButton(),C.point.getCoordinate().length||this.deleteFeature([C.point.id],{silent:!0})},xn.toDisplayFeatures=function(C,j,de){var Ne=j.properties.id===C.point.id;if(j.properties.active=Ne?ne.ACTIVE:ne.INACTIVE,!Ne)return de(j)},xn.onTrash=xn.stopDrawingAndRemove,xn.onKeyUp=function(C,j){if(et(j)||le(j))return this.stopDrawingAndRemove(C,j)};var Jr={onSetup:function(){var C=this.newFeature({type:ve.FEATURE,properties:{},geometry:{type:ve.POLYGON,coordinates:[[]]}});return this.addFeature(C),this.clearSelectedFeatures(),ft.disable(this),this.updateUIClasses({mouse:V.ADD}),this.activateUIButton(H.POLYGON),this.setActionableState({trash:!0}),{polygon:C,currentVertexPosition:0}},clickAnywhere:function(C,j){if(C.currentVertexPosition>0&&$n(j,C.polygon.coordinates[0][C.currentVertexPosition-1]))return this.changeMode(_e.SIMPLE_SELECT,{featureIds:[C.polygon.id]});this.updateUIClasses({mouse:V.ADD}),C.polygon.updateCoordinate("0."+C.currentVertexPosition,j.lngLat.lng,j.lngLat.lat),C.currentVertexPosition++,C.polygon.updateCoordinate("0."+C.currentVertexPosition,j.lngLat.lng,j.lngLat.lat)},clickOnVertex:function(C){return this.changeMode(_e.SIMPLE_SELECT,{featureIds:[C.polygon.id]})},onMouseMove:function(C,j){C.polygon.updateCoordinate("0."+C.currentVertexPosition,j.lngLat.lng,j.lngLat.lat),Bi(j)&&this.updateUIClasses({mouse:V.POINTER})}};Jr.onTap=Jr.onClick=function(C,j){return Bi(j)?this.clickOnVertex(C,j):this.clickAnywhere(C,j)},Jr.onKeyUp=function(C,j){et(j)?(this.deleteFeature([C.polygon.id],{silent:!0}),this.changeMode(_e.SIMPLE_SELECT)):le(j)&&this.changeMode(_e.SIMPLE_SELECT,{featureIds:[C.polygon.id]})},Jr.onStop=function(C){this.updateUIClasses({mouse:V.NONE}),ft.enable(this),this.activateUIButton(),this.getFeature(C.polygon.id)!==void 0&&(C.polygon.removeCoordinate("0."+C.currentVertexPosition),C.polygon.isValid()?this.map.fire(oe.CREATE,{features:[C.polygon.toGeoJSON()]}):(this.deleteFeature([C.polygon.id],{silent:!0}),this.changeMode(_e.SIMPLE_SELECT,{},{silent:!0})))},Jr.toDisplayFeatures=function(C,j,de){var Ne=j.properties.id===C.polygon.id;if(j.properties.active=Ne?ne.ACTIVE:ne.INACTIVE,!Ne)return de(j);if(j.geometry.coordinates.length!==0){var qe=j.geometry.coordinates[0].length;if(!(qe<3)){if(j.properties.meta=K.FEATURE,de(at(C.polygon.id,j.geometry.coordinates[0][0],"0.0",!1)),qe>3){var je=j.geometry.coordinates[0].length-3;de(at(C.polygon.id,j.geometry.coordinates[0][je],"0."+je,!1))}if(qe<=4){var rt=[[j.geometry.coordinates[0][0][0],j.geometry.coordinates[0][0][1]],[j.geometry.coordinates[0][1][0],j.geometry.coordinates[0][1][1]]];if(de({type:ve.FEATURE,properties:j.properties,geometry:{coordinates:rt,type:ve.LINE_STRING}}),qe===3)return}return de(j)}}},Jr.onTrash=function(C){this.deleteFeature([C.polygon.id],{silent:!0}),this.changeMode(_e.SIMPLE_SELECT)};var vr={onSetup:function(C){var j,de,Ne=(C=C||{}).featureId,qe="forward";if(Ne){if(!(j=this.getFeature(Ne)))throw new Error("Could not find a feature with the provided featureId");var je=C.from;if(je&&je.type==="Feature"&&je.geometry&&je.geometry.type==="Point"&&(je=je.geometry),je&&je.type==="Point"&&je.coordinates&&je.coordinates.length===2&&(je=je.coordinates),!je||!Array.isArray(je))throw new Error("Please use the `from` property to indicate which point to continue the line from");var rt=j.coordinates.length-1;if(j.coordinates[rt][0]===je[0]&&j.coordinates[rt][1]===je[1])de=rt+1,j.addCoordinate.apply(j,[de].concat(j.coordinates[rt]));else{if(j.coordinates[0][0]!==je[0]||j.coordinates[0][1]!==je[1])throw new Error("`from` should match the point at either the start or the end of the provided LineString");qe="backwards",de=0,j.addCoordinate.apply(j,[de].concat(j.coordinates[0]))}}else j=this.newFeature({type:ve.FEATURE,properties:{},geometry:{type:ve.LINE_STRING,coordinates:[]}}),de=0,this.addFeature(j);return this.clearSelectedFeatures(),ft.disable(this),this.updateUIClasses({mouse:V.ADD}),this.activateUIButton(H.LINE),this.setActionableState({trash:!0}),{line:j,currentVertexPosition:de,direction:qe}},clickAnywhere:function(C,j){if(C.currentVertexPosition>0&&$n(j,C.line.coordinates[C.currentVertexPosition-1])||C.direction==="backwards"&&$n(j,C.line.coordinates[C.currentVertexPosition+1]))return this.changeMode(_e.SIMPLE_SELECT,{featureIds:[C.line.id]});this.updateUIClasses({mouse:V.ADD}),C.line.updateCoordinate(C.currentVertexPosition,j.lngLat.lng,j.lngLat.lat),C.direction==="forward"?(C.currentVertexPosition++,C.line.updateCoordinate(C.currentVertexPosition,j.lngLat.lng,j.lngLat.lat)):C.line.addCoordinate(0,j.lngLat.lng,j.lngLat.lat)},clickOnVertex:function(C){return this.changeMode(_e.SIMPLE_SELECT,{featureIds:[C.line.id]})},onMouseMove:function(C,j){C.line.updateCoordinate(C.currentVertexPosition,j.lngLat.lng,j.lngLat.lat),Bi(j)&&this.updateUIClasses({mouse:V.POINTER})}};vr.onTap=vr.onClick=function(C,j){if(Bi(j))return this.clickOnVertex(C,j);this.clickAnywhere(C,j)},vr.onKeyUp=function(C,j){le(j)?this.changeMode(_e.SIMPLE_SELECT,{featureIds:[C.line.id]}):et(j)&&(this.deleteFeature([C.line.id],{silent:!0}),this.changeMode(_e.SIMPLE_SELECT))},vr.onStop=function(C){ft.enable(this),this.activateUIButton(),this.getFeature(C.line.id)!==void 0&&(C.line.removeCoordinate(""+C.currentVertexPosition),C.line.isValid()?this.map.fire(oe.CREATE,{features:[C.line.toGeoJSON()]}):(this.deleteFeature([C.line.id],{silent:!0}),this.changeMode(_e.SIMPLE_SELECT,{},{silent:!0})))},vr.onTrash=function(C){this.deleteFeature([C.line.id],{silent:!0}),this.changeMode(_e.SIMPLE_SELECT)},vr.toDisplayFeatures=function(C,j,de){var Ne=j.properties.id===C.line.id;if(j.properties.active=Ne?ne.ACTIVE:ne.INACTIVE,!Ne)return de(j);j.geometry.coordinates.length<2||(j.properties.meta=K.FEATURE,de(at(C.line.id,j.geometry.coordinates[C.direction==="forward"?j.geometry.coordinates.length-2:1],""+(C.direction==="forward"?j.geometry.coordinates.length-2:1),!1)),de(j))};var Qs={simple_select:gr,direct_select:qi,draw_point:xn,draw_polygon:Jr,draw_line_string:vr},Wl={defaultMode:_e.SIMPLE_SELECT,keybindings:!0,touchEnabled:!0,clickBuffer:2,touchBuffer:25,boxSelect:!0,displayControlsDefault:!0,styles:$s,modes:Qs,controls:{},userProperties:!1},Yl={point:!0,line_string:!0,polygon:!0,trash:!0,combine_features:!0,uncombine_features:!0},dl={point:!1,line_string:!1,polygon:!1,trash:!1,combine_features:!1,uncombine_features:!1};function ho(C,j){return C.map(function(de){return de.source?de:In(de,{id:de.id+"."+j,source:j==="hot"?Y.HOT:Y.COLD})})}var Po={exports:{}};(function(C,j){var de="__lodash_hash_undefined__",Ne=9007199254740991,qe="[object Arguments]",je="[object Array]",rt="[object Boolean]",Ct="[object Date]",Dt="[object Error]",Nt="[object Function]",Wt="[object Map]",jt="[object Number]",ki="[object Object]",si="[object Promise]",Pi="[object RegExp]",Rr="[object Set]",Mt="[object String]",ei="[object Symbol]",ji="[object WeakMap]",or="[object ArrayBuffer]",rr="[object DataView]",Ar=/^\[object .+?Constructor\]$/,pr=/^(?:0|[1-9]\d*)$/,ui={};ui["[object Float32Array]"]=ui["[object Float64Array]"]=ui["[object Int8Array]"]=ui["[object Int16Array]"]=ui["[object Int32Array]"]=ui["[object Uint8Array]"]=ui["[object Uint8ClampedArray]"]=ui["[object Uint16Array]"]=ui["[object Uint32Array]"]=!0,ui[qe]=ui[je]=ui[or]=ui[rt]=ui[rr]=ui[Ct]=ui[Dt]=ui[Nt]=ui[Wt]=ui[jt]=ui[ki]=ui[Pi]=ui[Rr]=ui[Mt]=ui[ji]=!1;var Pn=typeof rf=="object"&&rf&&rf.Object===Object&&rf,Vi=typeof self=="object"&&self&&self.Object===Object&&self,Ri=Pn||Vi||Function("return this")(),eo=j&&!j.nodeType&&j,fi=eo&&C&&!C.nodeType&&C,to=fi&&fi.exports===eo,hn=to&&Pn.process,po=function(){try{return hn&&hn.binding&&hn.binding("util")}catch{}}(),Dn=po&&po.isTypedArray;function pl(ot,ut){for(var Kt=-1,bi=ot==null?0:ot.length;++Kt<bi;)if(ut(ot[Kt],Kt,ot))return!0;return!1}function Cs(ot){var ut=-1,Kt=Array(ot.size);return ot.forEach(function(bi,ir){Kt[++ut]=[ir,bi]}),Kt}function js(ot){var ut=-1,Kt=Array(ot.size);return ot.forEach(function(bi){Kt[++ut]=bi}),Kt}var Xo,Ho,kn,Fn=Array.prototype,bn=Function.prototype,Hn=Object.prototype,fo=Ri["__core-js_shared__"],bs=bn.toString,Mr=Hn.hasOwnProperty,jn=(Xo=/[^.]+$/.exec(fo&&fo.keys&&fo.keys.IE_PROTO||""))?"Symbol(src)_1."+Xo:"",mo=Hn.toString,Ko=RegExp("^"+bs.call(Mr).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),Hl=to?Ri.Buffer:void 0,As=Ri.Symbol,Jo=Ri.Uint8Array,Oa=Hn.propertyIsEnumerable,Fu=Fn.splice,Qr=As?As.toStringTag:void 0,ls=Object.getOwnPropertySymbols,Fr=Hl?Hl.isBuffer:void 0,Kn=(Ho=Object.keys,kn=Object,function(ot){return Ho(kn(ot))}),Qo=Ro(Ri,"DataView"),io=Ro(Ri,"Map"),Gs=Ro(Ri,"Promise"),ea=Ro(Ri,"Set"),_a=Ro(Ri,"WeakMap"),ta=Ro(Object,"create"),Ls=us(Qo),Kl=us(io),zn=us(Gs),go=us(ea),Da=us(_a),Co=As?As.prototype:void 0,ia=Co?Co.valueOf:void 0;function Rs(ot){var ut=-1,Kt=ot==null?0:ot.length;for(this.clear();++ut<Kt;){var bi=ot[ut];this.set(bi[0],bi[1])}}function nn(ot){var ut=-1,Kt=ot==null?0:ot.length;for(this.clear();++ut<Kt;){var bi=ot[ut];this.set(bi[0],bi[1])}}function Ao(ot){var ut=-1,Kt=ot==null?0:ot.length;for(this.clear();++ut<Kt;){var bi=ot[ut];this.set(bi[0],bi[1])}}function ra(ot){var ut=-1,Kt=ot==null?0:ot.length;for(this.__data__=new Ao;++ut<Kt;)this.add(ot[ut])}function ws(ot){var ut=this.__data__=new nn(ot);this.size=ut.size}function va(ot,ut){var Kt=Vs(ot),bi=!Kt&&za(ot),ir=!Kt&&!bi&&yl(ot),Zi=!Kt&&!bi&&!ir&&$a(ot),v=Kt||bi||ir||Zi,c=v?function(S,N){for(var U=-1,J=Array(S);++U<S;)J[U]=N(U);return J}(ot.length,String):[],d=c.length;for(var _ in ot)!Mr.call(ot,_)||v&&(_=="length"||ir&&(_=="offset"||_=="parent")||Zi&&(_=="buffer"||_=="byteLength"||_=="byteOffset")||gl(_,d))||c.push(_);return c}function xa(ot,ut){for(var Kt=ot.length;Kt--;)if(Fa(ot[Kt][0],ut))return Kt;return-1}function ro(ot){return ot==null?ot===void 0?"[object Undefined]":"[object Null]":Qr&&Qr in Object(ot)?function(ut){var Kt=Mr.call(ut,Qr),bi=ut[Qr];try{ut[Qr]=void 0;var ir=!0}catch{}var Zi=mo.call(ut);return ir&&(Kt?ut[Qr]=bi:delete ut[Qr]),Zi}(ot):function(ut){return mo.call(ut)}(ot)}function fl(ot){return No(ot)&&ro(ot)==qe}function Lo(ot,ut,Kt,bi,ir){return ot===ut||(ot==null||ut==null||!No(ot)&&!No(ut)?ot!=ot&&ut!=ut:function(Zi,v,c,d,_,S){var N=Vs(Zi),U=Vs(v),J=N?je:Us(Zi),ge=U?je:Us(v),Ie=(J=J==qe?ki:J)==ki,st=(ge=ge==qe?ki:ge)==ki,ht=J==ge;if(ht&&yl(Zi)){if(!yl(v))return!1;N=!0,Ie=!1}if(ht&&!Ie)return S||(S=new ws),N||$a(Zi)?ml(Zi,v,c,d,_,S):function(_i,yi,cr,hr,dn,pn,Gn){switch(cr){case rr:if(_i.byteLength!=yi.byteLength||_i.byteOffset!=yi.byteOffset)return!1;_i=_i.buffer,yi=yi.buffer;case or:return!(_i.byteLength!=yi.byteLength||!pn(new Jo(_i),new Jo(yi)));case rt:case Ct:case jt:return Fa(+_i,+yi);case Dt:return _i.name==yi.name&&_i.message==yi.message;case Pi:case Mt:return _i==yi+"";case Wt:var Un=Cs;case Rr:var no=1&hr;if(Un||(Un=js),_i.size!=yi.size&&!no)return!1;var yo=Gn.get(_i);if(yo)return yo==yi;hr|=2,Gn.set(_i,yi);var Ns=ml(Un(_i),Un(yi),hr,dn,pn,Gn);return Gn.delete(_i),Ns;case ei:if(ia)return ia.call(_i)==ia.call(yi)}return!1}(Zi,v,J,c,d,_,S);if(!(1&c)){var Pt=Ie&&Mr.call(Zi,"__wrapped__"),Qt=st&&Mr.call(v,"__wrapped__");if(Pt||Qt){var wi=Pt?Zi.value():Zi,Ni=Qt?v.value():v;return S||(S=new ws),_(wi,Ni,c,d,S)}}return ht?(S||(S=new ws),function(_i,yi,cr,hr,dn,pn){var Gn=1&cr,Un=ba(_i),no=Un.length,yo=ba(yi).length;if(no!=yo&&!Gn)return!1;for(var Ns=no;Ns--;){var cs=Un[Ns];if(!(Gn?cs in yi:Mr.call(yi,cs)))return!1}var ja=pn.get(_i);if(ja&&pn.get(yi))return ja==yi;var Os=!0;pn.set(_i,yi),pn.set(yi,_i);for(var qs=Gn;++Ns<no;){var Ga=_i[cs=Un[Ns]],Ua=yi[cs];if(hr)var tr=Gn?hr(Ua,Ga,cs,yi,_i,pn):hr(Ga,Ua,cs,_i,yi,pn);if(!(tr===void 0?Ga===Ua||dn(Ga,Ua,cr,hr,pn):tr)){Os=!1;break}qs||(qs=cs=="constructor")}if(Os&&!qs){var _o=_i.constructor,vl=yi.constructor;_o==vl||!("constructor"in _i)||!("constructor"in yi)||typeof _o=="function"&&_o instanceof _o&&typeof vl=="function"&&vl instanceof vl||(Os=!1)}return pn.delete(_i),pn.delete(yi),Os}(Zi,v,c,d,_,S)):!1}(ot,ut,Kt,bi,Lo,ir))}function Jl(ot){return!(!_l(ot)||function(ut){return!!jn&&jn in ut}(ot))&&(sa(ot)?Ko:Ar).test(us(ot))}function Ql(ot){if(Kt=(ut=ot)&&ut.constructor,bi=typeof Kt=="function"&&Kt.prototype||Hn,ut!==bi)return Kn(ot);var ut,Kt,bi,ir=[];for(var Zi in Object(ot))Mr.call(ot,Zi)&&Zi!="constructor"&&ir.push(Zi);return ir}function ml(ot,ut,Kt,bi,ir,Zi){var v=1&Kt,c=ot.length,d=ut.length;if(c!=d&&!(v&&d>c))return!1;var _=Zi.get(ot);if(_&&Zi.get(ut))return _==ut;var S=-1,N=!0,U=2&Kt?new ra:void 0;for(Zi.set(ot,ut),Zi.set(ut,ot);++S<c;){var J=ot[S],ge=ut[S];if(bi)var Ie=v?bi(ge,J,S,ut,ot,Zi):bi(J,ge,S,ot,ut,Zi);if(Ie!==void 0){if(Ie)continue;N=!1;break}if(U){if(!pl(ut,function(st,ht){if(Pt=ht,!U.has(Pt)&&(J===st||ir(J,st,Kt,bi,Zi)))return U.push(ht);var Pt})){N=!1;break}}else if(J!==ge&&!ir(J,ge,Kt,bi,Zi)){N=!1;break}}return Zi.delete(ot),Zi.delete(ut),N}function ba(ot){return function(ut,Kt,bi){var ir=Kt(ut);return Vs(ut)?ir:function(Zi,v){for(var c=-1,d=v.length,_=Zi.length;++c<d;)Zi[_+c]=v[c];return Zi}(ir,bi(ut))}(ot,tu,eu)}function na(ot,ut){var Kt,bi,ir=ot.__data__;return((bi=typeof(Kt=ut))=="string"||bi=="number"||bi=="symbol"||bi=="boolean"?Kt!=="__proto__":Kt===null)?ir[typeof ut=="string"?"string":"hash"]:ir.map}function Ro(ot,ut){var Kt=function(bi,ir){return bi?.[ir]}(ot,ut);return Jl(Kt)?Kt:void 0}Rs.prototype.clear=function(){this.__data__=ta?ta(null):{},this.size=0},Rs.prototype.delete=function(ot){var ut=this.has(ot)&&delete this.__data__[ot];return this.size-=ut?1:0,ut},Rs.prototype.get=function(ot){var ut=this.__data__;if(ta){var Kt=ut[ot];return Kt===de?void 0:Kt}return Mr.call(ut,ot)?ut[ot]:void 0},Rs.prototype.has=function(ot){var ut=this.__data__;return ta?ut[ot]!==void 0:Mr.call(ut,ot)},Rs.prototype.set=function(ot,ut){var Kt=this.__data__;return this.size+=this.has(ot)?0:1,Kt[ot]=ta&&ut===void 0?de:ut,this},nn.prototype.clear=function(){this.__data__=[],this.size=0},nn.prototype.delete=function(ot){var ut=this.__data__,Kt=xa(ut,ot);return!(Kt<0)&&(Kt==ut.length-1?ut.pop():Fu.call(ut,Kt,1),--this.size,!0)},nn.prototype.get=function(ot){var ut=this.__data__,Kt=xa(ut,ot);return Kt<0?void 0:ut[Kt][1]},nn.prototype.has=function(ot){return xa(this.__data__,ot)>-1},nn.prototype.set=function(ot,ut){var Kt=this.__data__,bi=xa(Kt,ot);return bi<0?(++this.size,Kt.push([ot,ut])):Kt[bi][1]=ut,this},Ao.prototype.clear=function(){this.size=0,this.__data__={hash:new Rs,map:new(io||nn),string:new Rs}},Ao.prototype.delete=function(ot){var ut=na(this,ot).delete(ot);return this.size-=ut?1:0,ut},Ao.prototype.get=function(ot){return na(this,ot).get(ot)},Ao.prototype.has=function(ot){return na(this,ot).has(ot)},Ao.prototype.set=function(ot,ut){var Kt=na(this,ot),bi=Kt.size;return Kt.set(ot,ut),this.size+=Kt.size==bi?0:1,this},ra.prototype.add=ra.prototype.push=function(ot){return this.__data__.set(ot,de),this},ra.prototype.has=function(ot){return this.__data__.has(ot)},ws.prototype.clear=function(){this.__data__=new nn,this.size=0},ws.prototype.delete=function(ot){var ut=this.__data__,Kt=ut.delete(ot);return this.size=ut.size,Kt},ws.prototype.get=function(ot){return this.__data__.get(ot)},ws.prototype.has=function(ot){return this.__data__.has(ot)},ws.prototype.set=function(ot,ut){var Kt=this.__data__;if(Kt instanceof nn){var bi=Kt.__data__;if(!io||bi.length<199)return bi.push([ot,ut]),this.size=++Kt.size,this;Kt=this.__data__=new Ao(bi)}return Kt.set(ot,ut),this.size=Kt.size,this};var eu=ls?function(ot){return ot==null?[]:(ot=Object(ot),function(ut,Kt){for(var bi=-1,ir=ut==null?0:ut.length,Zi=0,v=[];++bi<ir;){var c=ut[bi];Kt(c,bi,ut)&&(v[Zi++]=c)}return v}(ls(ot),function(ut){return Oa.call(ot,ut)}))}:function(){return[]},Us=ro;function gl(ot,ut){return!!(ut=ut??Ne)&&(typeof ot=="number"||pr.test(ot))&&ot>-1&&ot%1==0&&ot<ut}function us(ot){if(ot!=null){try{return bs.call(ot)}catch{}try{return ot+""}catch{}}return""}function Fa(ot,ut){return ot===ut||ot!=ot&&ut!=ut}(Qo&&Us(new Qo(new ArrayBuffer(1)))!=rr||io&&Us(new io)!=Wt||Gs&&Us(Gs.resolve())!=si||ea&&Us(new ea)!=Rr||_a&&Us(new _a)!=ji)&&(Us=function(ot){var ut=ro(ot),Kt=ut==ki?ot.constructor:void 0,bi=Kt?us(Kt):"";if(bi)switch(bi){case Ls:return rr;case Kl:return Wt;case zn:return si;case go:return Rr;case Da:return ji}return ut});var za=fl(function(){return arguments}())?fl:function(ot){return No(ot)&&Mr.call(ot,"callee")&&!Oa.call(ot,"callee")},Vs=Array.isArray,yl=Fr||function(){return!1};function sa(ot){if(!_l(ot))return!1;var ut=ro(ot);return ut==Nt||ut=="[object GeneratorFunction]"||ut=="[object AsyncFunction]"||ut=="[object Proxy]"}function Ba(ot){return typeof ot=="number"&&ot>-1&&ot%1==0&&ot<=Ne}function _l(ot){var ut=typeof ot;return ot!=null&&(ut=="object"||ut=="function")}function No(ot){return ot!=null&&typeof ot=="object"}var $a=Dn?function(ot){return function(ut){return ot(ut)}}(Dn):function(ot){return No(ot)&&Ba(ot.length)&&!!ui[ro(ot)]};function tu(ot){return(ut=ot)!=null&&Ba(ut.length)&&!sa(ut)?va(ot):Ql(ot);var ut}C.exports=function(ot,ut){return Lo(ot,ut)}})(Po,Po.exports);var ks=s(Po.exports);function as(C,j){return C.length===j.length&&JSON.stringify(C.map(function(de){return de}).sort())===JSON.stringify(j.map(function(de){return de}).sort())}var Xl={Polygon:ai,LineString:ti,Point:zt,MultiPolygon:Xi,MultiLineString:Xi,MultiPoint:Xi},ko=Object.freeze({__proto__:null,CommonSelectors:pe,constrainFeatureMovement:Sn,createMidPoint:He,createSupplementaryPoints:gt,createVertex:at,doubleClickZoom:ft,euclideanDistance:Ke,featuresAt:Ae,getFeatureAtAndSetCursors:Be,isClick:tt,isEventAtCoordinates:$n,isTap:pt,mapEventToBoundingBox:ue,ModeHandler:i,moveFeatures:Yr,sortFeatures:Q,stringSetsAreEqual:as,StringSet:he,theme:$s,toDenseArray:Qi}),Wo=function(C,j){var de={options:C=function(qe){qe===void 0&&(qe={});var je=In(qe);return qe.controls||(je.controls={}),qe.displayControlsDefault===!1?je.controls=In(dl,qe.controls):je.controls=In(Yl,qe.controls),(je=In(Wl,je)).styles=ho(je.styles,"cold").concat(ho(je.styles,"hot")),je}(C)};j=function(qe,je){return je.modes=_e,je.getFeatureIdsAt=function(rt){return Ae.click({point:rt},null,qe).map(function(Ct){return Ct.properties.id})},je.getSelectedIds=function(){return qe.store.getSelectedIds()},je.getSelected=function(){return{type:ve.FEATURE_COLLECTION,features:qe.store.getSelectedIds().map(function(rt){return qe.store.get(rt)}).map(function(rt){return rt.toGeoJSON()})}},je.getSelectedPoints=function(){return{type:ve.FEATURE_COLLECTION,features:qe.store.getSelectedCoordinates().map(function(rt){return{type:ve.FEATURE,properties:{},geometry:{type:ve.POINT,coordinates:rt.coordinates}}})}},je.set=function(rt){if(rt.type===void 0||rt.type!==ve.FEATURE_COLLECTION||!Array.isArray(rt.features))throw new Error("Invalid FeatureCollection");var Ct=qe.store.createRenderBatch(),Dt=qe.store.getAllIds().slice(),Nt=je.add(rt),Wt=new he(Nt);return(Dt=Dt.filter(function(jt){return!Wt.has(jt)})).length&&je.delete(Dt),Ct(),Nt},je.add=function(rt){var Ct=JSON.parse(JSON.stringify(Ut(rt))).features.map(function(Dt){if(Dt.id=Dt.id||It(),Dt.geometry===null)throw new Error("Invalid geometry: null");if(qe.store.get(Dt.id)===void 0||qe.store.get(Dt.id).type!==Dt.geometry.type){var Nt=Xl[Dt.geometry.type];if(Nt===void 0)throw new Error("Invalid geometry type: "+Dt.geometry.type+".");var Wt=new Nt(qe,Dt);qe.store.add(Wt)}else{var jt=qe.store.get(Dt.id);jt.properties=Dt.properties,ks(jt.properties,Dt.properties)||qe.store.featureChanged(jt.id),ks(jt.getCoordinates(),Dt.geometry.coordinates)||jt.incomingCoords(Dt.geometry.coordinates)}return Dt.id});return qe.store.render(),Ct},je.get=function(rt){var Ct=qe.store.get(rt);if(Ct)return Ct.toGeoJSON()},je.getAll=function(){return{type:ve.FEATURE_COLLECTION,features:qe.store.getAll().map(function(rt){return rt.toGeoJSON()})}},je.delete=function(rt){return qe.store.delete(rt,{silent:!0}),je.getMode()!==_e.DIRECT_SELECT||qe.store.getSelectedIds().length?qe.store.render():qe.events.changeMode(_e.SIMPLE_SELECT,void 0,{silent:!0}),je},je.deleteAll=function(){return qe.store.delete(qe.store.getAllIds(),{silent:!0}),je.getMode()===_e.DIRECT_SELECT?qe.events.changeMode(_e.SIMPLE_SELECT,void 0,{silent:!0}):qe.store.render(),je},je.changeMode=function(rt,Ct){return Ct===void 0&&(Ct={}),rt===_e.SIMPLE_SELECT&&je.getMode()===_e.SIMPLE_SELECT?(as(Ct.featureIds||[],qe.store.getSelectedIds())||(qe.store.setSelected(Ct.featureIds,{silent:!0}),qe.store.render()),je):(rt===_e.DIRECT_SELECT&&je.getMode()===_e.DIRECT_SELECT&&Ct.featureId===qe.store.getSelectedIds()[0]||qe.events.changeMode(rt,Ct,{silent:!0}),je)},je.getMode=function(){return qe.events.getMode()},je.trash=function(){return qe.events.trash({silent:!0}),je},je.combineFeatures=function(){return qe.events.combineFeatures({silent:!0}),je},je.uncombineFeatures=function(){return qe.events.uncombineFeatures({silent:!0}),je},je.setFeatureProperty=function(rt,Ct,Dt){return qe.store.setFeatureProperty(rt,Ct,Dt),je},je}(de,j),de.api=j;var Ne=os(de);return j.onAdd=Ne.onAdd,j.onRemove=Ne.onRemove,j.types=H,j.options=C,j};function Yo(C){Wo(C,this)}return Yo.modes=Qs,Yo.constants=Se,Yo.lib=ko,Yo})}(Of)),Of.exports}var iI=tI();const km=l_(iI),rI=Di.createContext(null);function nI(r,e){const i=Array.isArray(r)?r[0]:r?r.x:0,s=Array.isArray(r)?r[1]:r?r.y:0,h=Array.isArray(e)?e[0]:e?e.x:0,x=Array.isArray(e)?e[1]:e?e.y:0;return i===h&&s===x}function rl(r,e){if(r===e)return!0;if(!r||!e)return!1;if(Array.isArray(r)){if(!Array.isArray(e)||r.length!==e.length)return!1;for(let i=0;i<r.length;i++)if(!rl(r[i],e[i]))return!1;return!0}else if(Array.isArray(e))return!1;if(typeof r=="object"&&typeof e=="object"){const i=Object.keys(r),s=Object.keys(e);if(i.length!==s.length)return!1;for(const h of i)if(!e.hasOwnProperty(h)||!rl(r[h],e[h]))return!1;return!0}return!1}function U0(r){return{longitude:r.center.lng,latitude:r.center.lat,zoom:r.zoom,pitch:r.pitch,bearing:r.bearing,padding:r.padding}}function V0(r,e){const i=e.viewState||e,s={};if("longitude"in i&&"latitude"in i&&(i.longitude!==r.center.lng||i.latitude!==r.center.lat)){const h=r.center.constructor;s.center=new h(i.longitude,i.latitude)}return"zoom"in i&&i.zoom!==r.zoom&&(s.zoom=i.zoom),"bearing"in i&&i.bearing!==r.bearing&&(s.bearing=i.bearing),"pitch"in i&&i.pitch!==r.pitch&&(s.pitch=i.pitch),i.padding&&r.padding&&!rl(i.padding,r.padding)&&(s.padding=i.padding),s}const sI=["type","source","source-layer","minzoom","maxzoom","filter","layout"];function q0(r){if(!r)return null;if(typeof r=="string"||("toJS"in r&&(r=r.toJS()),!r.layers))return r;const e={};for(const s of r.layers)e[s.id]=s;const i=r.layers.map(s=>{let h=null;"interactive"in s&&(h=Object.assign({},s),delete h.interactive);const x=e[s.ref];if(x){h=h||Object.assign({},s),delete h.ref;for(const m of sI)m in x&&(h[m]=x[m])}return h||s});return{...r,layers:i}}const Z0={version:8,sources:{},layers:[]},W0={mousedown:"onMouseDown",mouseup:"onMouseUp",mouseover:"onMouseOver",mousemove:"onMouseMove",click:"onClick",dblclick:"onDblClick",mouseenter:"onMouseEnter",mouseleave:"onMouseLeave",mouseout:"onMouseOut",contextmenu:"onContextMenu",touchstart:"onTouchStart",touchend:"onTouchEnd",touchmove:"onTouchMove",touchcancel:"onTouchCancel"},Y0={movestart:"onMoveStart",move:"onMove",moveend:"onMoveEnd",dragstart:"onDragStart",drag:"onDrag",dragend:"onDragEnd",zoomstart:"onZoomStart",zoom:"onZoom",zoomend:"onZoomEnd",rotatestart:"onRotateStart",rotate:"onRotate",rotateend:"onRotateEnd",pitchstart:"onPitchStart",pitch:"onPitch",pitchend:"onPitchEnd"},X0={wheel:"onWheel",boxzoomstart:"onBoxZoomStart",boxzoomend:"onBoxZoomEnd",boxzoomcancel:"onBoxZoomCancel",resize:"onResize",load:"onLoad",render:"onRender",idle:"onIdle",remove:"onRemove",data:"onData",styledata:"onStyleData",sourcedata:"onSourceData",error:"onError"},oI=["minZoom","maxZoom","minPitch","maxPitch","maxBounds","projection","renderWorldCopies"],aI=["scrollZoom","boxZoom","dragRotate","dragPan","keyboard","doubleClickZoom","touchZoomRotate","touchPitch"];let wy=class Ty{constructor(e,i,s){this._map=null,this._internalUpdate=!1,this._hoveredFeatures=null,this._propsedCameraUpdate=null,this._styleComponents={},this._onEvent=h=>{const x=this.props[X0[h.type]];x?x(h):h.type==="error"&&console.error(h.error)},this._onCameraEvent=h=>{if(this._internalUpdate)return;h.viewState=this._propsedCameraUpdate||U0(this._map.transform);const x=this.props[Y0[h.type]];x&&x(h)},this._onCameraUpdate=h=>this._internalUpdate?h:(this._propsedCameraUpdate=U0(h),V0(h,this.props)),this._onPointerEvent=h=>{(h.type==="mousemove"||h.type==="mouseout")&&this._updateHover(h);const x=this.props[W0[h.type]];x&&(this.props.interactiveLayerIds&&h.type!=="mouseover"&&h.type!=="mouseout"&&(h.features=this._hoveredFeatures||this._queryRenderedFeatures(h.point)),x(h),delete h.features)},this._MapClass=e,this.props=i,this._initialize(s)}get map(){return this._map}setProps(e){const i=this.props;this.props=e;const s=this._updateSettings(e,i),h=this._updateSize(e),x=this._updateViewState(e);this._updateStyle(e,i),this._updateStyleComponents(e),this._updateHandlers(e,i),(s||h||x&&!this._map.isMoving())&&this.redraw()}static reuse(e,i){const s=Ty.savedMaps.pop();if(!s)return null;const h=s.map,x=h.getContainer();for(i.className=x.className;x.childNodes.length>0;)i.appendChild(x.childNodes[0]);h._container=i;const m=h._resizeObserver;m&&(m.disconnect(),m.observe(i)),s.setProps({...e,styleDiffing:!1}),h.resize();const{initialViewState:o}=e;return o&&(o.bounds?h.fitBounds(o.bounds,{...o.fitBoundsOptions,duration:0}):s._updateViewState(o)),h.isStyleLoaded()?h.fire("load"):h.once("style.load",()=>h.fire("load")),h._update(),s}_initialize(e){const{props:i}=this,{mapStyle:s=Z0}=i,h={...i,...i.initialViewState,container:e,style:q0(s)},x=h.initialViewState||h.viewState||h;if(Object.assign(h,{center:[x.longitude||0,x.latitude||0],zoom:x.zoom||0,pitch:x.pitch||0,bearing:x.bearing||0}),i.gl){const o=HTMLCanvasElement.prototype.getContext;HTMLCanvasElement.prototype.getContext=()=>(HTMLCanvasElement.prototype.getContext=o,i.gl)}const m=new this._MapClass(h);x.padding&&m.setPadding(x.padding),i.cursor&&(m.getCanvas().style.cursor=i.cursor),m.transformCameraUpdate=this._onCameraUpdate,m.on("style.load",()=>{this._styleComponents={light:m.getLight(),sky:m.getSky(),projection:m.getProjection?.(),terrain:m.getTerrain()},this._updateStyleComponents(this.props)}),m.on("sourcedata",()=>{this._updateStyleComponents(this.props)});for(const o in W0)m.on(o,this._onPointerEvent);for(const o in Y0)m.on(o,this._onCameraEvent);for(const o in X0)m.on(o,this._onEvent);this._map=m}recycle(){this.map.getContainer().querySelector("[mapboxgl-children]")?.remove(),Ty.savedMaps.push(this)}destroy(){this._map.remove()}redraw(){const e=this._map;e.style&&(e._frame&&(e._frame.cancel(),e._frame=null),e._render())}_updateSize(e){const{viewState:i}=e;if(i){const s=this._map;if(i.width!==s.transform.width||i.height!==s.transform.height)return s.resize(),!0}return!1}_updateViewState(e){const i=this._map,s=i.transform;if(!i.isMoving()){const h=V0(s,e);if(Object.keys(h).length>0)return this._internalUpdate=!0,i.jumpTo(h),this._internalUpdate=!1,!0}return!1}_updateSettings(e,i){const s=this._map;let h=!1;for(const x of oI)x in e&&!rl(e[x],i[x])&&(h=!0,s[`set${x[0].toUpperCase()}${x.slice(1)}`]?.call(s,e[x]));return h}_updateStyle(e,i){if(e.cursor!==i.cursor&&(this._map.getCanvas().style.cursor=e.cursor||""),e.mapStyle!==i.mapStyle){const{mapStyle:s=Z0,styleDiffing:h=!0}=e,x={diff:h};"localIdeographFontFamily"in e&&(x.localIdeographFontFamily=e.localIdeographFontFamily),this._map.setStyle(q0(s),x)}}_updateStyleComponents({light:e,projection:i,sky:s,terrain:h}){const x=this._map,m=this._styleComponents;x.style._loaded&&(e&&!rl(e,m.light)&&(m.light=e,x.setLight(e)),i&&!rl(i,m.projection)&&i!==m.projection?.type&&(m.projection=typeof i=="string"?{type:i}:i,x.setProjection?.(m.projection)),s&&!rl(s,m.sky)&&(m.sky=s,x.setSky(s)),h!==void 0&&!rl(h,m.terrain)&&(!h||x.getSource(h.source))&&(m.terrain=h,x.setTerrain(h)))}_updateHandlers(e,i){const s=this._map;for(const h of aI){const x=e[h]??!0,m=i[h]??!0;rl(x,m)||(x?s[h].enable(x):s[h].disable())}}_queryRenderedFeatures(e){const i=this._map,{interactiveLayerIds:s=[]}=this.props;try{return i.queryRenderedFeatures(e,{layers:s.filter(i.getLayer.bind(i))})}catch{return[]}}_updateHover(e){const{props:i}=this;if(i.interactiveLayerIds&&(i.onMouseMove||i.onMouseEnter||i.onMouseLeave)){const s=e.type,h=this._hoveredFeatures?.length>0,x=this._queryRenderedFeatures(e.point),m=x.length>0;!m&&h&&(e.type="mouseleave",this._onPointerEvent(e)),this._hoveredFeatures=x,m&&!h&&(e.type="mouseenter",this._onPointerEvent(e)),e.type=s}else this._hoveredFeatures=null}};wy.savedMaps=[];const lI=["setMaxBounds","setMinZoom","setMaxZoom","setMinPitch","setMaxPitch","setRenderWorldCopies","setProjection","setStyle","addSource","removeSource","addLayer","removeLayer","setLayerZoomRange","setFilter","setPaintProperty","setLayoutProperty","setLight","setTerrain","setFog","remove"];function uI(r){if(!r)return null;const e=r.map,i={getMap:()=>e};for(const s of cI(e))!(s in i)&&!lI.includes(s)&&(i[s]=e[s].bind(e));return i}function cI(r){const e=new Set;let i=r;for(;i;){for(const s of Object.getOwnPropertyNames(i))s[0]!=="_"&&typeof r[s]=="function"&&s!=="fire"&&s!=="setEventedParent"&&e.add(s);i=Object.getPrototypeOf(i)}return Array.from(e)}const hI=typeof document<"u"?Di.useLayoutEffect:Di.useEffect;function dI(r,e){const{RTLTextPlugin:i,maxParallelImageRequests:s,workerCount:h,workerUrl:x}=e;if(i&&r.getRTLTextPluginStatus&&r.getRTLTextPluginStatus()==="unavailable"){const{pluginUrl:m,lazy:o=!0}=typeof i=="string"?{pluginUrl:i}:i;r.setRTLTextPlugin(m,P=>{P&&console.error(P)},o)}s!==void 0&&r.setMaxParallelImageRequests(s),h!==void 0&&r.setWorkerCount(h),x!==void 0&&r.setWorkerUrl(x)}const Cm=Di.createContext(null);function pI(r,e){const i=Di.useContext(rI),[s,h]=Di.useState(null),x=Di.useRef(),{current:m}=Di.useRef({mapLib:null,map:null});Di.useEffect(()=>{const L=r.mapLib;let D=!0,F;return Promise.resolve(L||KE(()=>Promise.resolve().then(()=>K1),void 0,import.meta.url).then(Y=>Y.L)).then(Y=>{if(!D)return;if(!Y)throw new Error("Invalid mapLib");const V="Map"in Y?Y:Y.default;if(!V.Map)throw new Error("Invalid mapLib");dI(V,r),r.reuseMaps&&(F=wy.reuse(r,x.current)),F||(F=new wy(V.Map,r,x.current)),m.map=uI(F),m.mapLib=V,h(F),i?.onMapMount(m.map,r.id)}).catch(Y=>{const{onError:V}=r;V?V({type:"error",target:null,originalEvent:null,error:Y}):console.error(Y)}),()=>{D=!1,F&&(i?.onMapUnmount(r.id),r.reuseMaps?F.recycle():F.destroy())}},[]),hI(()=>{s&&s.setProps(r)}),Di.useImperativeHandle(e,()=>m.map,[s]);const o=Di.useMemo(()=>({position:"relative",width:"100%",height:"100%",...r.style}),[r.style]),P={height:"100%"};return Di.createElement("div",{id:r.id,ref:x,style:o},s&&Di.createElement(Cm.Provider,{value:m},Di.createElement("div",{"mapboxgl-children":"",style:P},r.children)))}Di.forwardRef(pI);const fI=/box|flex|grid|column|lineHeight|fontWeight|opacity|order|tabSize|zIndex/;function Ul(r,e){if(!r||!e)return;const i=r.style;for(const s in e){const h=e[s];Number.isFinite(h)&&!fI.test(s)?i[s]=`${h}px`:i[s]=h}}function X1(r,e){if(r===e)return null;const i=H0(r),s=H0(e),h=[];for(const x of s)i.has(x)||h.push(x);for(const x of i)s.has(x)||h.push(x);return h.length===0?null:h}function H0(r){return new Set(r?r.trim().split(/\s+/):[])}Di.memo(Di.forwardRef((r,e)=>{const{map:i,mapLib:s}=Di.useContext(Cm),h=Di.useRef({props:r}),x=Di.useMemo(()=>{let oe=!1;Di.Children.forEach(r.children,ne=>{ne&&(oe=!0)});const fe={...r,element:oe?document.createElement("div"):void 0},K=new s.Marker(fe);return K.setLngLat([r.longitude,r.latitude]),K.getElement().addEventListener("click",ne=>{h.current.props.onClick?.({type:"click",target:K,originalEvent:ne})}),K.on("dragstart",ne=>{const ye=ne;ye.lngLat=x.getLngLat(),h.current.props.onDragStart?.(ye)}),K.on("drag",ne=>{const ye=ne;ye.lngLat=x.getLngLat(),h.current.props.onDrag?.(ye)}),K.on("dragend",ne=>{const ye=ne;ye.lngLat=x.getLngLat(),h.current.props.onDragEnd?.(ye)}),K},[]);Di.useEffect(()=>(x.addTo(i.getMap()),()=>{x.remove()}),[]);const{longitude:m,latitude:o,offset:P,style:L,draggable:D=!1,popup:F=null,rotation:Y=0,rotationAlignment:V="auto",pitchAlignment:H="auto"}=r;Di.useEffect(()=>{Ul(x.getElement(),L)},[L]),Di.useImperativeHandle(e,()=>x,[]);const ve=h.current.props;(x.getLngLat().lng!==m||x.getLngLat().lat!==o)&&x.setLngLat([m,o]),P&&!nI(x.getOffset(),P)&&x.setOffset(P),x.isDraggable()!==D&&x.setDraggable(D),x.getRotation()!==Y&&x.setRotation(Y),x.getRotationAlignment()!==V&&x.setRotationAlignment(V),x.getPitchAlignment()!==H&&x.setPitchAlignment(H),x.getPopup()!==F&&x.setPopup(F);const _e=X1(ve.className,r.className);if(_e)for(const oe of _e)x.toggleClassName(oe);return h.current.props=r,W1.createPortal(r.children,x.getElement())}));Di.memo(Di.forwardRef((r,e)=>{const{map:i,mapLib:s}=Di.useContext(Cm),h=Di.useMemo(()=>document.createElement("div"),[]),x=Di.useRef({props:r}),m=Di.useMemo(()=>{const o={...r},P=new s.Popup(o);return P.setLngLat([r.longitude,r.latitude]),P.once("open",L=>{x.current.props.onOpen?.(L)}),P},[]);if(Di.useEffect(()=>{const o=P=>{x.current.props.onClose?.(P)};return m.on("close",o),m.setDOMContent(h).addTo(i.getMap()),()=>{m.off("close",o),m.isOpen()&&m.remove()}},[]),Di.useEffect(()=>{Ul(m.getElement(),r.style)},[r.style]),Di.useImperativeHandle(e,()=>m,[]),m.isOpen()){const o=x.current.props;(m.getLngLat().lng!==r.longitude||m.getLngLat().lat!==r.latitude)&&m.setLngLat([r.longitude,r.latitude]),r.offset&&!rl(o.offset,r.offset)&&m.setOffset(r.offset),(o.anchor!==r.anchor||o.maxWidth!==r.maxWidth)&&(m.options.anchor=r.anchor,m.setMaxWidth(r.maxWidth));const P=X1(o.className,r.className);if(P)for(const L of P)m.toggleClassName(L);x.current.props=r}return W1.createPortal(r.children,h)}));function Vl(r,e,i,s){const h=Di.useContext(Cm),x=Di.useMemo(()=>r(h),[]);return Di.useEffect(()=>{const m=s||i||e,o=typeof e=="function"&&typeof i=="function"?e:null,P=typeof i=="function"?i:typeof e=="function"?e:null,{map:L}=h;return L.hasControl(x)||(L.addControl(x,m?.position),o&&o(h)),()=>{P&&P(h),L.hasControl(x)&&L.removeControl(x)}},[]),x}function mI(r){const e=Vl(({mapLib:i})=>new i.AttributionControl(r),{position:r.position});return Di.useEffect(()=>{Ul(e._container,r.style)},[r.style]),null}Di.memo(mI);function gI(r){const e=Vl(({mapLib:i})=>new i.FullscreenControl({container:r.containerId&&document.getElementById(r.containerId)}),{position:r.position});return Di.useEffect(()=>{Ul(e._controlContainer,r.style)},[r.style]),null}Di.memo(gI);function yI(r,e){const i=Di.useRef({props:r}),s=Vl(({mapLib:h})=>{const x=new h.GeolocateControl(r),m=x._setupUI;return x._setupUI=()=>{x._container.hasChildNodes()||m()},x.on("geolocate",o=>{i.current.props.onGeolocate?.(o)}),x.on("error",o=>{i.current.props.onError?.(o)}),x.on("outofmaxbounds",o=>{i.current.props.onOutOfMaxBounds?.(o)}),x.on("trackuserlocationstart",o=>{i.current.props.onTrackUserLocationStart?.(o)}),x.on("trackuserlocationend",o=>{i.current.props.onTrackUserLocationEnd?.(o)}),x},{position:r.position});return i.current.props=r,Di.useImperativeHandle(e,()=>s,[]),Di.useEffect(()=>{Ul(s._container,r.style)},[r.style]),null}Di.memo(Di.forwardRef(yI));function _I(r){const e=Vl(({mapLib:i})=>new i.NavigationControl(r),{position:r.position});return Di.useEffect(()=>{Ul(e._container,r.style)},[r.style]),null}Di.memo(_I);function vI(r){const e=Vl(({mapLib:x})=>new x.ScaleControl(r),{position:r.position}),i=Di.useRef(r),s=i.current;i.current=r;const{style:h}=r;return r.maxWidth!==void 0&&r.maxWidth!==s.maxWidth&&(e.options.maxWidth=r.maxWidth),r.unit!==void 0&&r.unit!==s.unit&&e.setUnit(r.unit),Di.useEffect(()=>{Ul(e._container,h)},[h]),null}Di.memo(vI);function xI(r){const e=Vl(({mapLib:i})=>new i.TerrainControl(r),{position:r.position});return Di.useEffect(()=>{Ul(e._container,r.style)},[r.style]),null}Di.memo(xI);function bI(r){const e=Vl(({mapLib:i})=>new i.LogoControl(r),{position:r.position});return Di.useEffect(()=>{Ul(e._container,r.style)},[r.style]),null}Di.memo(bI);Di.forwardRef((r,e)=>{const i=Vl(()=>new km(r),({map:s})=>{s.on("draw.create",r.onCreate),s.on("draw.update",r.onUpdate),s.on("draw.delete",r.onDelete)},({map:s})=>{s.off("draw.create",r.onCreate),s.off("draw.update",r.onUpdate),s.off("draw.delete",r.onDelete)},{position:r.position});return Di.useImperativeHandle(e,()=>i,[i]),null});var Xg={exports:{}},md={},K0;function wI(){if(K0)return md;K0=1;/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var r=by,e=Symbol.for("react.element"),i=Symbol.for("react.fragment"),s=Object.prototype.hasOwnProperty,h=r.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,x={key:!0,ref:!0,__self:!0,__source:!0};function m(o,P,L){var D,F={},Y=null,V=null;L!==void 0&&(Y=""+L),P.key!==void 0&&(Y=""+P.key),P.ref!==void 0&&(V=P.ref);for(D in P)s.call(P,D)&&!x.hasOwnProperty(D)&&(F[D]=P[D]);if(o&&o.defaultProps)for(D in P=o.defaultProps,P)F[D]===void 0&&(F[D]=P[D]);return{$$typeof:e,type:o,key:Y,ref:V,props:F,_owner:h.current}}return md.Fragment=i,md.jsx=m,md.jsxs=m,md}var J0;function TI(){return J0||(J0=1,Xg.exports=wI()),Xg.exports}var nf=TI();const EI={type:"circle",paint:{"circle-radius":["interpolate",["linear"],["number",["get","point_count"],1],0,4,10,14],"circle-stroke-width":1,"circle-color":["case",["boolean",["feature-state","hover"],!1],"#3b62ff","#ff623b"],"circle-stroke-color":"#8d260c"}},II={type:"fill",paint:{"fill-color":"#ff623b","fill-opacity":.2}},SI={type:"line",paint:{"line-color":"#ff623b","line-opacity":.6}},hh={point:EI,fill:II,stroke:SI};hh.fill.paint,hh.point.paint,hh.stroke.paint;var Df={exports:{}};/**
 * MapLibre GL JS
 * @license 3-Clause BSD. Full text of license: https://github.com/maplibre/maplibre-gl-js/blob/v5.6.1/LICENSE.txt
 */var MI=Df.exports,Q0;function PI(){return Q0||(Q0=1,function(r,e){(function(i,s){r.exports=s()})(MI,function(){var i={},s={};function h(m,o,P){if(s[m]=P,m==="index"){var L="var sharedModule = {}; ("+s.shared+")(sharedModule); ("+s.worker+")(sharedModule);",D={};return s.shared(D),s.index(i,D),typeof window<"u"&&i.setWorkerUrl(window.URL.createObjectURL(new Blob([L],{type:"text/javascript"}))),i}}h("shared",["exports"],function(m){function o(u,n,a,p){return new(a||(a=Promise))(function(y,T){function E(O){try{A(p.next(O))}catch(B){T(B)}}function M(O){try{A(p.throw(O))}catch(B){T(B)}}function A(O){var B;O.done?y(O.value):(B=O.value,B instanceof a?B:new a(function(q){q(B)})).then(E,M)}A((p=p.apply(u,n||[])).next())})}function P(u){return u&&u.__esModule&&Object.prototype.hasOwnProperty.call(u,"default")?u.default:u}var L,D;function F(){if(D)return L;function u(n,a){this.x=n,this.y=a}return D=1,L=u,u.prototype={clone:function(){return new u(this.x,this.y)},add:function(n){return this.clone()._add(n)},sub:function(n){return this.clone()._sub(n)},multByPoint:function(n){return this.clone()._multByPoint(n)},divByPoint:function(n){return this.clone()._divByPoint(n)},mult:function(n){return this.clone()._mult(n)},div:function(n){return this.clone()._div(n)},rotate:function(n){return this.clone()._rotate(n)},rotateAround:function(n,a){return this.clone()._rotateAround(n,a)},matMult:function(n){return this.clone()._matMult(n)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(n){return this.x===n.x&&this.y===n.y},dist:function(n){return Math.sqrt(this.distSqr(n))},distSqr:function(n){var a=n.x-this.x,p=n.y-this.y;return a*a+p*p},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(n){return Math.atan2(this.y-n.y,this.x-n.x)},angleWith:function(n){return this.angleWithSep(n.x,n.y)},angleWithSep:function(n,a){return Math.atan2(this.x*a-this.y*n,this.x*n+this.y*a)},_matMult:function(n){var a=n[2]*this.x+n[3]*this.y;return this.x=n[0]*this.x+n[1]*this.y,this.y=a,this},_add:function(n){return this.x+=n.x,this.y+=n.y,this},_sub:function(n){return this.x-=n.x,this.y-=n.y,this},_mult:function(n){return this.x*=n,this.y*=n,this},_div:function(n){return this.x/=n,this.y/=n,this},_multByPoint:function(n){return this.x*=n.x,this.y*=n.y,this},_divByPoint:function(n){return this.x/=n.x,this.y/=n.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var n=this.y;return this.y=this.x,this.x=-n,this},_rotate:function(n){var a=Math.cos(n),p=Math.sin(n),y=p*this.x+a*this.y;return this.x=a*this.x-p*this.y,this.y=y,this},_rotateAround:function(n,a){var p=Math.cos(n),y=Math.sin(n),T=a.y+y*(this.x-a.x)+p*(this.y-a.y);return this.x=a.x+p*(this.x-a.x)-y*(this.y-a.y),this.y=T,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},u.convert=function(n){return n instanceof u?n:Array.isArray(n)?new u(n[0],n[1]):n},L}typeof SuppressedError=="function"&&SuppressedError;var Y,V,H=P(F()),ve=function(){if(V)return Y;function u(n,a,p,y){this.cx=3*n,this.bx=3*(p-n)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*a,this.by=3*(y-a)-this.cy,this.ay=1-this.cy-this.by,this.p1x=n,this.p1y=a,this.p2x=p,this.p2y=y}return V=1,Y=u,u.prototype={sampleCurveX:function(n){return((this.ax*n+this.bx)*n+this.cx)*n},sampleCurveY:function(n){return((this.ay*n+this.by)*n+this.cy)*n},sampleCurveDerivativeX:function(n){return(3*this.ax*n+2*this.bx)*n+this.cx},solveCurveX:function(n,a){if(a===void 0&&(a=1e-6),n<0)return 0;if(n>1)return 1;for(var p=n,y=0;y<8;y++){var T=this.sampleCurveX(p)-n;if(Math.abs(T)<a)return p;var E=this.sampleCurveDerivativeX(p);if(Math.abs(E)<1e-6)break;p-=T/E}var M=0,A=1;for(p=n,y=0;y<20&&(T=this.sampleCurveX(p),!(Math.abs(T-n)<a));y++)n>T?M=p:A=p,p=.5*(A-M)+M;return p},solve:function(n,a){return this.sampleCurveY(this.solveCurveX(n,a))}},Y}(),_e=P(ve);let oe,fe;function K(){return oe==null&&(oe=typeof OffscreenCanvas<"u"&&new OffscreenCanvas(1,1).getContext("2d")&&typeof createImageBitmap=="function"),oe}function ne(){if(fe==null&&(fe=!1,K())){const u=new OffscreenCanvas(5,5).getContext("2d",{willReadFrequently:!0});if(u){for(let a=0;a<5*5;a++){const p=4*a;u.fillStyle=`rgb(${p},${p+1},${p+2})`,u.fillRect(a%5,Math.floor(a/5),1,1)}const n=u.getImageData(0,0,5,5).data;for(let a=0;a<5*5*4;a++)if(a%4!=3&&n[a]!==a){fe=!0;break}}}return fe||!1}var ye=1e-6,Re=typeof Float32Array<"u"?Float32Array:Array;function Se(){var u=new Re(9);return Re!=Float32Array&&(u[1]=0,u[2]=0,u[3]=0,u[5]=0,u[6]=0,u[7]=0),u[0]=1,u[4]=1,u[8]=1,u}function Z(u){return u[0]=1,u[1]=0,u[2]=0,u[3]=0,u[4]=0,u[5]=1,u[6]=0,u[7]=0,u[8]=0,u[9]=0,u[10]=1,u[11]=0,u[12]=0,u[13]=0,u[14]=0,u[15]=1,u}function $(){var u=new Re(3);return Re!=Float32Array&&(u[0]=0,u[1]=0,u[2]=0),u}function Q(u){return Math.hypot(u[0],u[1],u[2])}function ue(u,n,a){var p=new Re(3);return p[0]=u,p[1]=n,p[2]=a,p}function he(u,n,a){return u[0]=n[0]+a[0],u[1]=n[1]+a[1],u[2]=n[2]+a[2],u}function Pe(u,n,a){return u[0]=n[0]*a,u[1]=n[1]*a,u[2]=n[2]*a,u}function Ae(u,n,a){var p=n[0],y=n[1],T=n[2],E=a[0],M=a[1],A=a[2];return u[0]=y*A-T*M,u[1]=T*E-p*A,u[2]=p*M-y*E,u}Math.hypot||(Math.hypot=function(){for(var u=0,n=arguments.length;n--;)u+=arguments[n]*arguments[n];return Math.sqrt(u)});var ke,Be=Q;function Ke(u,n,a){var p=n[0],y=n[1],T=n[2],E=n[3];return u[0]=a[0]*p+a[4]*y+a[8]*T+a[12]*E,u[1]=a[1]*p+a[5]*y+a[9]*T+a[13]*E,u[2]=a[2]*p+a[6]*y+a[10]*T+a[14]*E,u[3]=a[3]*p+a[7]*y+a[11]*T+a[15]*E,u}function tt(){var u=new Re(4);return Re!=Float32Array&&(u[0]=0,u[1]=0,u[2]=0),u[3]=1,u}function pt(u,n,a,p){var y=.5*Math.PI/180;n*=y,a*=y,p*=y;var T=Math.sin(n),E=Math.cos(n),M=Math.sin(a),A=Math.cos(a),O=Math.sin(p),B=Math.cos(p);return u[0]=T*A*B-E*M*O,u[1]=E*M*B+T*A*O,u[2]=E*A*O-T*M*B,u[3]=E*A*B+T*M*O,u}function vt(){var u=new Re(2);return Re!=Float32Array&&(u[0]=0,u[1]=0),u}function Ft(u,n){var a=new Re(2);return a[0]=u,a[1]=n,a}$(),ke=new Re(4),Re!=Float32Array&&(ke[0]=0,ke[1]=0,ke[2]=0,ke[3]=0),$(),ue(1,0,0),ue(0,1,0),tt(),tt(),Se(),vt();const It=8192;function Zt(u,n,a){return n*(It/(u.tileSize*Math.pow(2,a-u.tileID.overscaledZ)))}function zt(u,n){return(u%n+n)%n}function ti(u,n,a){return u*(1-a)+n*a}function ai(u){if(u<=0)return 0;if(u>=1)return 1;const n=u*u,a=n*u;return 4*(u<.5?a:3*(u-n)+a-.75)}function Ir(u,n,a,p){const y=new _e(u,n,a,p);return T=>y.solve(T)}const lt=Ir(.25,.1,.25,1);function Xi(u,n,a){return Math.min(a,Math.max(n,u))}function ii(u,n,a){const p=a-n,y=((u-n)%p+p)%p+n;return y===n?a:y}function Jt(u,...n){for(const a of n)for(const p in a)u[p]=a[p];return u}let $e=1;function zi(u,n,a){const p={};for(const y in u)p[y]=n.call(this,u[y],y,u);return p}function Qi(u,n,a){const p={};for(const y in u)n.call(this,u[y],y,u)&&(p[y]=u[y]);return p}function Gi(u){return Array.isArray(u)?u.map(Gi):typeof u=="object"&&u?zi(u,Gi):u}const sr={};function jr(u){sr[u]||(typeof console<"u"&&console.warn(u),sr[u]=!0)}function En(u,n,a){return(a.y-u.y)*(n.x-u.x)>(n.y-u.y)*(a.x-u.x)}function Ot(u){return typeof WorkerGlobalScope<"u"&&u!==void 0&&u instanceof WorkerGlobalScope}let In=null;function xs(u){return typeof ImageBitmap<"u"&&u instanceof ImageBitmap}const os="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";function $s(u,n,a,p,y){return o(this,void 0,void 0,function*(){if(typeof VideoFrame>"u")throw new Error("VideoFrame not supported");const T=new VideoFrame(u,{timestamp:0});try{const E=T?.format;if(!E||!E.startsWith("BGR")&&!E.startsWith("RGB"))throw new Error(`Unrecognized format ${E}`);const M=E.startsWith("BGR"),A=new Uint8ClampedArray(p*y*4);if(yield T.copyTo(A,function(O,B,q,ee,re){const se=4*Math.max(-B,0),ce=(Math.max(0,q)-q)*ee*4+se,be=4*ee,Me=Math.max(0,B),Xe=Math.max(0,q);return{rect:{x:Me,y:Xe,width:Math.min(O.width,B+ee)-Me,height:Math.min(O.height,q+re)-Xe},layout:[{offset:ce,stride:be}]}}(u,n,a,p,y)),M)for(let O=0;O<A.length;O+=4){const B=A[O];A[O]=A[O+2],A[O+2]=B}return A}finally{T.close()}})}let Xt,_r;function gi(u,n,a,p){return u.addEventListener(n,a,p),{unsubscribe:()=>{u.removeEventListener(n,a,p)}}}function rn(u){return u*Math.PI/180}function oi(u){return u/Math.PI*180}const er={touchstart:!0,touchmove:!0,touchmoveWindow:!0,touchend:!0,touchcancel:!0},Bi={dblclick:!0,click:!0,mouseover:!0,mouseout:!0,mousedown:!0,mousemove:!0,mousemoveWindow:!0,mouseup:!0,mouseupWindow:!0,contextmenu:!0,wheel:!0},Ii="AbortError";function et(){return new Error(Ii)}const le={MAX_PARALLEL_IMAGE_REQUESTS:16,MAX_PARALLEL_IMAGE_REQUESTS_PER_FRAME:8,MAX_TILE_CACHE_ZOOM_LEVELS:5,REGISTERED_PROTOCOLS:{},WORKER_URL:""};function pe(u){return le.REGISTERED_PROTOCOLS[u.substring(0,u.indexOf("://"))]}const me="global-dispatcher";class Le extends Error{constructor(n,a,p,y){super(`AJAXError: ${a} (${n}): ${p}`),this.status=n,this.statusText=a,this.url=p,this.body=y}}const Ze=()=>Ot(self)?self.worker&&self.worker.referrer:(window.location.protocol==="blob:"?window.parent:window).location.href,Je=function(u,n){if(/:\/\//.test(u.url)&&!/^https?:|^file:/.test(u.url)){const p=pe(u.url);if(p)return p(u,n);if(Ot(self)&&self.worker&&self.worker.actor)return self.worker.actor.sendAsync({type:"GR",data:u,targetMapId:me},n)}if(!(/^file:/.test(a=u.url)||/^file:/.test(Ze())&&!/^\w+:/.test(a))){if(fetch&&Request&&AbortController&&Object.prototype.hasOwnProperty.call(Request.prototype,"signal"))return function(p,y){return o(this,void 0,void 0,function*(){const T=new Request(p.url,{method:p.method||"GET",body:p.body,credentials:p.credentials,headers:p.headers,cache:p.cache,referrer:Ze(),signal:y.signal});let E,M;p.type!=="json"||T.headers.has("Accept")||T.headers.set("Accept","application/json");try{E=yield fetch(T)}catch(O){throw new Le(0,O.message,p.url,new Blob)}if(!E.ok){const O=yield E.blob();throw new Le(E.status,E.statusText,p.url,O)}M=p.type==="arrayBuffer"||p.type==="image"?E.arrayBuffer():p.type==="json"?E.json():E.text();const A=yield M;if(y.signal.aborted)throw et();return{data:A,cacheControl:E.headers.get("Cache-Control"),expires:E.headers.get("Expires")}})}(u,n);if(Ot(self)&&self.worker&&self.worker.actor)return self.worker.actor.sendAsync({type:"GR",data:u,mustQueue:!0,targetMapId:me},n)}var a;return function(p,y){return new Promise((T,E)=>{var M;const A=new XMLHttpRequest;A.open(p.method||"GET",p.url,!0),p.type!=="arrayBuffer"&&p.type!=="image"||(A.responseType="arraybuffer");for(const O in p.headers)A.setRequestHeader(O,p.headers[O]);p.type==="json"&&(A.responseType="text",!((M=p.headers)===null||M===void 0)&&M.Accept||A.setRequestHeader("Accept","application/json")),A.withCredentials=p.credentials==="include",A.onerror=()=>{E(new Error(A.statusText))},A.onload=()=>{if(!y.signal.aborted)if((A.status>=200&&A.status<300||A.status===0)&&A.response!==null){let O=A.response;if(p.type==="json")try{O=JSON.parse(A.response)}catch(B){return void E(B)}T({data:O,cacheControl:A.getResponseHeader("Cache-Control"),expires:A.getResponseHeader("Expires")})}else{const O=new Blob([A.response],{type:A.getResponseHeader("Content-Type")});E(new Le(A.status,A.statusText,p.url,O))}},y.signal.addEventListener("abort",()=>{A.abort(),E(et())}),A.send(p.body)})}(u,n)};function at(u){if(!u||u.indexOf("://")<=0||u.indexOf("data:image/")===0||u.indexOf("blob:")===0)return!0;const n=new URL(u),a=window.location;return n.protocol===a.protocol&&n.host===a.host}function He(u,n,a){a[u]&&a[u].indexOf(n)!==-1||(a[u]=a[u]||[],a[u].push(n))}function gt(u,n,a){if(a&&a[u]){const p=a[u].indexOf(n);p!==-1&&a[u].splice(p,1)}}class ft{constructor(n,a={}){Jt(this,a),this.type=n}}class nt extends ft{constructor(n,a={}){super("error",Jt({error:n},a))}}class Tt{on(n,a){return this._listeners=this._listeners||{},He(n,a,this._listeners),{unsubscribe:()=>{this.off(n,a)}}}off(n,a){return gt(n,a,this._listeners),gt(n,a,this._oneTimeListeners),this}once(n,a){return a?(this._oneTimeListeners=this._oneTimeListeners||{},He(n,a,this._oneTimeListeners),this):new Promise(p=>this.once(n,p))}fire(n,a){typeof n=="string"&&(n=new ft(n,a||{}));const p=n.type;if(this.listens(p)){n.target=this;const y=this._listeners&&this._listeners[p]?this._listeners[p].slice():[];for(const M of y)M.call(this,n);const T=this._oneTimeListeners&&this._oneTimeListeners[p]?this._oneTimeListeners[p].slice():[];for(const M of T)gt(p,M,this._oneTimeListeners),M.call(this,n);const E=this._eventedParent;E&&(Jt(n,typeof this._eventedParentData=="function"?this._eventedParentData():this._eventedParentData),E.fire(n))}else n instanceof nt&&console.error(n.error);return this}listens(n){return this._listeners&&this._listeners[n]&&this._listeners[n].length>0||this._oneTimeListeners&&this._oneTimeListeners[n]&&this._oneTimeListeners[n].length>0||this._eventedParent&&this._eventedParent.listens(n)}setEventedParent(n,a){return this._eventedParent=n,this._eventedParentData=a,this}}var Ve={$version:8,$root:{version:{required:!0,type:"enum",values:[8]},name:{type:"string"},metadata:{type:"*"},center:{type:"array",value:"number"},centerAltitude:{type:"number"},zoom:{type:"number"},bearing:{type:"number",default:0,period:360,units:"degrees"},pitch:{type:"number",default:0,units:"degrees"},roll:{type:"number",default:0,units:"degrees"},state:{type:"state",default:{}},light:{type:"light"},sky:{type:"sky"},projection:{type:"projection"},terrain:{type:"terrain"},sources:{required:!0,type:"sources"},sprite:{type:"sprite"},glyphs:{type:"string"},transition:{type:"transition"},layers:{required:!0,type:"array",value:"layer"}},sources:{"*":{type:"source"}},source:["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],source_vector:{type:{required:!0,type:"enum",values:{vector:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},attribution:{type:"string"},promoteId:{type:"promoteId"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster:{type:{required:!0,type:"enum",values:{raster:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},attribution:{type:"string"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster_dem:{type:{required:!0,type:"enum",values:{"raster-dem":{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},attribution:{type:"string"},encoding:{type:"enum",values:{terrarium:{},mapbox:{},custom:{}},default:"mapbox"},redFactor:{type:"number",default:1},blueFactor:{type:"number",default:1},greenFactor:{type:"number",default:1},baseShift:{type:"number",default:0},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_geojson:{type:{required:!0,type:"enum",values:{geojson:{}}},data:{required:!0,type:"*"},maxzoom:{type:"number",default:18},attribution:{type:"string"},buffer:{type:"number",default:128,maximum:512,minimum:0},filter:{type:"*"},tolerance:{type:"number",default:.375},cluster:{type:"boolean",default:!1},clusterRadius:{type:"number",default:50,minimum:0},clusterMaxZoom:{type:"number"},clusterMinPoints:{type:"number"},clusterProperties:{type:"*"},lineMetrics:{type:"boolean",default:!1},generateId:{type:"boolean",default:!1},promoteId:{type:"promoteId"}},source_video:{type:{required:!0,type:"enum",values:{video:{}}},urls:{required:!0,type:"array",value:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},source_image:{type:{required:!0,type:"enum",values:{image:{}}},url:{required:!0,type:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},layer:{id:{type:"string",required:!0},type:{type:"enum",values:{fill:{},line:{},symbol:{},circle:{},heatmap:{},"fill-extrusion":{},raster:{},hillshade:{},"color-relief":{},background:{}},required:!0},metadata:{type:"*"},source:{type:"string"},"source-layer":{type:"string"},minzoom:{type:"number",minimum:0,maximum:24},maxzoom:{type:"number",minimum:0,maximum:24},filter:{type:"filter"},layout:{type:"layout"},paint:{type:"paint"}},layout:["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_color-relief","layout_background"],layout_background:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_fill:{"fill-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_circle:{"circle-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_heatmap:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},"layout_fill-extrusion":{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_line:{"line-cap":{type:"enum",values:{butt:{},round:{},square:{}},default:"butt",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-join":{type:"enum",values:{bevel:{},round:{},miter:{}},default:"miter",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{type:"number",default:2,requires:[{"line-join":"miter"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-round-limit":{type:"number",default:1.05,requires:[{"line-join":"round"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_symbol:{"symbol-placement":{type:"enum",values:{point:{},line:{},"line-center":{}},default:"point",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-spacing":{type:"number",default:250,minimum:1,units:"pixels",requires:[{"symbol-placement":"line"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{type:"boolean",default:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{type:"enum",values:{auto:{},"viewport-y":{},source:{}},default:"auto",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{type:"boolean",default:!1,requires:["icon-image",{"!":"icon-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{type:"boolean",default:!1,requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-optional":{type:"boolean",default:!1,requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-size":{type:"number",default:1,minimum:0,units:"factor of the original icon size",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{type:"enum",values:{none:{},width:{},height:{},both:{}},default:"none",requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{type:"array",value:"number",length:4,default:[0,0,0,0],units:"pixels",requires:["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-image":{type:"resolvedImage",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{type:"padding",default:[2],units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-keep-upright":{type:"boolean",default:!1,requires:["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-offset":{type:"array",value:"number",length:2,default:[0,0],requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{type:"enum",values:{map:{},viewport:{},"viewport-glyph":{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-field":{type:"formatted",default:"",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-font":{type:"array",value:"string",default:["Open Sans Regular","Arial Unicode MS Regular"],requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-size":{type:"number",default:16,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{type:"number",default:10,minimum:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{type:"number",default:1.2,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-letter-spacing":{type:"number",default:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-justify":{type:"enum",values:{auto:{},left:{},center:{},right:{}},default:"center",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{type:"number",units:"ems",default:0,requires:["text-field"],"property-type":"data-driven",expression:{interpolated:!0,parameters:["zoom","feature"]}},"text-variable-anchor":{type:"array",value:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-variable-anchor-offset":{type:"variableAnchorOffsetCollection",requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["text-field",{"!":"text-variable-anchor"}],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{type:"number",default:45,units:"degrees",requires:["text-field",{"symbol-placement":["line","line-center"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-writing-mode":{type:"array",value:"enum",values:{horizontal:{},vertical:{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-padding":{type:"number",default:2,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-keep-upright":{type:"boolean",default:!0,requires:["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-transform":{type:"enum",values:{none:{},uppercase:{},lowercase:{}},default:"none",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-offset":{type:"array",value:"number",units:"ems",length:2,default:[0,0],requires:["text-field",{"!":"text-radial-offset"}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{type:"boolean",default:!1,requires:["text-field",{"!":"text-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{type:"boolean",default:!1,requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-optional":{type:"boolean",default:!1,requires:["text-field","icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_raster:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_hillshade:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},"layout_color-relief":{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},filter:{type:"array",value:"*"},filter_operator:{type:"enum",values:{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},in:{},"!in":{},all:{},any:{},none:{},has:{},"!has":{}}},geometry_type:{type:"enum",values:{Point:{},LineString:{},Polygon:{}}},function:{expression:{type:"expression"},stops:{type:"array",value:"function_stop"},base:{type:"number",default:1,minimum:0},property:{type:"string",default:"$zoom"},type:{type:"enum",values:{identity:{},exponential:{},interval:{},categorical:{}},default:"exponential"},colorSpace:{type:"enum",values:{rgb:{},lab:{},hcl:{}},default:"rgb"},default:{type:"*",required:!1}},function_stop:{type:"array",minimum:0,maximum:24,value:["number","color"],length:2},expression:{type:"array",value:"*",minimum:1},light:{anchor:{type:"enum",default:"viewport",values:{map:{},viewport:{}},"property-type":"data-constant",transition:!1,expression:{interpolated:!1,parameters:["zoom"]}},position:{type:"array",default:[1.15,210,30],length:3,value:"number","property-type":"data-constant",transition:!0,expression:{interpolated:!0,parameters:["zoom"]}},color:{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},intensity:{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},sky:{"sky-color":{type:"color","property-type":"data-constant",default:"#88C6FC",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"horizon-color":{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"fog-color":{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"fog-ground-blend":{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"horizon-fog-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"sky-horizon-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"atmosphere-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},terrain:{source:{type:"string",required:!0},exaggeration:{type:"number",minimum:0,default:1}},projection:{type:{type:"projectionDefinition",default:"mercator","property-type":"data-constant",transition:!1,expression:{interpolated:!0,parameters:["zoom"]}}},paint:["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_color-relief","paint_background"],paint_fill:{"fill-antialias":{type:"boolean",default:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{type:"color",transition:!0,requires:[{"!":"fill-pattern"},{"fill-antialias":!0}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-extrusion-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-extrusion-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"fill-extrusion-height":{type:"number",default:0,minimum:0,units:"meters",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{type:"number",default:0,minimum:0,units:"meters",transition:!0,requires:["fill-extrusion-height"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{type:"boolean",default:!0,transition:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_line:{"line-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"line-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["line-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-width":{type:"number",default:1,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{type:"number",default:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{type:"array",value:"number",minimum:0,transition:!0,units:"line widths",requires:[{"!":"line-pattern"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"line-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-gradient":{type:"color",transition:!1,requires:[{"!":"line-dasharray"},{"!":"line-pattern"},{source:"geojson",has:{lineMetrics:!0}}],expression:{interpolated:!0,parameters:["line-progress"]},"property-type":"color-ramp"}},paint_circle:{"circle-radius":{type:"number",default:5,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{type:"number",default:0,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["circle-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{type:"enum",values:{map:{},viewport:{}},default:"map",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"}},paint_heatmap:{"heatmap-radius":{type:"number",default:30,minimum:1,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{type:"number",default:1,minimum:0,transition:!1,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{type:"number",default:1,minimum:0,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"heatmap-color":{type:"color",default:["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",.1,"royalblue",.3,"cyan",.5,"lime",.7,"yellow",1,"red"],transition:!1,expression:{interpolated:!0,parameters:["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_symbol:{"icon-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{type:"color",default:"#000000",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["icon-image","icon-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{type:"color",default:"#000000",transition:!0,overridable:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["text-field","text-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_raster:{"raster-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{type:"number",default:0,period:360,transition:!0,units:"degrees",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{type:"number",default:0,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-saturation":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-contrast":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-resampling":{type:"enum",values:{linear:{},nearest:{}},default:"linear",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{type:"number",default:300,minimum:0,transition:!1,units:"milliseconds",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_hillshade:{"hillshade-illumination-direction":{type:"numberArray",default:335,minimum:0,maximum:359,transition:!1,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-illumination-altitude":{type:"numberArray",default:45,minimum:0,maximum:90,transition:!1,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{type:"number",default:.5,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{type:"colorArray",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{type:"colorArray",default:"#FFFFFF",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-method":{type:"enum",values:{standard:{},basic:{},combined:{},igor:{},multidirectional:{}},default:"standard",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},"paint_color-relief":{"color-relief-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"color-relief-color":{type:"color",transition:!1,expression:{interpolated:!0,parameters:["elevation"]},"property-type":"color-ramp"}},paint_background:{"background-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"background-pattern"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"background-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"background-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},transition:{duration:{type:"number",default:300,minimum:0,units:"milliseconds"},delay:{type:"number",default:0,minimum:0,units:"milliseconds"}},"property-type":{"data-driven":{type:"property-type"},"cross-faded":{type:"property-type"},"cross-faded-data-driven":{type:"property-type"},"color-ramp":{type:"property-type"},"data-constant":{type:"property-type"},constant:{type:"property-type"}},promoteId:{"*":{type:"string"}}};const Ut=["type","source","source-layer","minzoom","maxzoom","filter","layout"];function bt(u,n){const a={};for(const p in u)p!=="ref"&&(a[p]=u[p]);return Ut.forEach(p=>{p in n&&(a[p]=n[p])}),a}function Ht(u,n){if(Array.isArray(u)){if(!Array.isArray(n)||u.length!==n.length)return!1;for(let a=0;a<u.length;a++)if(!Ht(u[a],n[a]))return!1;return!0}if(typeof u=="object"&&u!==null&&n!==null){if(typeof n!="object"||Object.keys(u).length!==Object.keys(n).length)return!1;for(const a in u)if(!Ht(u[a],n[a]))return!1;return!0}return u===n}function li(u,n){u.push(n)}function Ci(u,n,a){li(a,{command:"addSource",args:[u,n[u]]})}function br(u,n,a){li(n,{command:"removeSource",args:[u]}),a[u]=!0}function ur(u,n,a,p){br(u,a,p),Ci(u,n,a)}function Ui(u,n,a){let p;for(p in u[a])if(Object.prototype.hasOwnProperty.call(u[a],p)&&p!=="data"&&!Ht(u[a][p],n[a][p]))return!1;for(p in n[a])if(Object.prototype.hasOwnProperty.call(n[a],p)&&p!=="data"&&!Ht(u[a][p],n[a][p]))return!1;return!0}function Mi(u,n,a,p,y,T){u=u||{},n=n||{};for(const E in u)Object.prototype.hasOwnProperty.call(u,E)&&(Ht(u[E],n[E])||a.push({command:T,args:[p,E,n[E],y]}));for(const E in n)Object.prototype.hasOwnProperty.call(n,E)&&!Object.prototype.hasOwnProperty.call(u,E)&&(Ht(u[E],n[E])||a.push({command:T,args:[p,E,n[E],y]}))}function Hi(u){return u.id}function Lr(u,n){return u[n.id]=n,u}class Rt{constructor(n,a,p,y){this.message=(n?`${n}: `:"")+p,y&&(this.identifier=y),a!=null&&a.__line__&&(this.line=a.__line__)}}function Kr(u,...n){for(const a of n)for(const p in a)u[p]=a[p];return u}class Sr extends Error{constructor(n,a){super(a),this.message=a,this.key=n}}class Or{constructor(n,a=[]){this.parent=n,this.bindings={};for(const[p,y]of a)this.bindings[p]=y}concat(n){return new Or(this,n)}get(n){if(this.bindings[n])return this.bindings[n];if(this.parent)return this.parent.get(n);throw new Error(`${n} not found in scope.`)}has(n){return!!this.bindings[n]||!!this.parent&&this.parent.has(n)}}const Ps={kind:"null"},Bt={kind:"number"},xi={kind:"string"},it={kind:"boolean"},Wi={kind:"color"},Dr={kind:"projectionDefinition"},Er={kind:"object"},ri={kind:"value"},Wr={kind:"collator"},vn={kind:"formatted"},Ai={kind:"padding"},Sn={kind:"colorArray"},Yr={kind:"numberArray"},gr={kind:"resolvedImage"},Xn={kind:"variableAnchorOffsetCollection"};function Mn(u,n){return{kind:"array",itemType:u,N:n}}function qi(u){if(u.kind==="array"){const n=qi(u.itemType);return typeof u.N=="number"?`array<${n}, ${u.N}>`:u.itemType.kind==="value"?"array":`array<${n}>`}return u.kind}const xn=[Ps,Bt,xi,it,Wi,Dr,vn,Er,Mn(ri),Ai,Yr,Sn,gr,Xn];function $n(u,n){if(n.kind==="error")return null;if(u.kind==="array"){if(n.kind==="array"&&(n.N===0&&n.itemType.kind==="value"||!$n(u.itemType,n.itemType))&&(typeof u.N!="number"||u.N===n.N))return null}else{if(u.kind===n.kind)return null;if(u.kind==="value"){for(const a of xn)if(!$n(a,n))return null}}return`Expected ${qi(u)} but found ${qi(n)} instead.`}function Jr(u,n){return n.some(a=>a.kind===u.kind)}function vr(u,n){return n.some(a=>a==="null"?u===null:a==="array"?Array.isArray(u):a==="object"?u&&!Array.isArray(u)&&typeof u=="object":a===typeof u)}function Qs(u,n){return u.kind==="array"&&n.kind==="array"?u.itemType.kind===n.itemType.kind&&typeof u.N=="number":u.kind===n.kind}const Wl=.96422,Yl=.82521,dl=4/29,ho=6/29,Po=3*ho*ho,ks=ho*ho*ho,as=Math.PI/180,Xl=180/Math.PI;function ko(u){return(u%=360)<0&&(u+=360),u}function Wo([u,n,a,p]){let y,T;const E=C((.2225045*(u=Yo(u))+.7168786*(n=Yo(n))+.0606169*(a=Yo(a)))/1);u===n&&n===a?y=T=E:(y=C((.4360747*u+.3850649*n+.1430804*a)/Wl),T=C((.0139322*u+.0971045*n+.7141733*a)/Yl));const M=116*E-16;return[M<0?0:M,500*(y-E),200*(E-T),p]}function Yo(u){return u<=.04045?u/12.92:Math.pow((u+.055)/1.055,2.4)}function C(u){return u>ks?Math.pow(u,1/3):u/Po+dl}function j([u,n,a,p]){let y=(u+16)/116,T=isNaN(n)?y:y+n/500,E=isNaN(a)?y:y-a/200;return y=1*Ne(y),T=Wl*Ne(T),E=Yl*Ne(E),[de(3.1338561*T-1.6168667*y-.4906146*E),de(-.9787684*T+1.9161415*y+.033454*E),de(.0719453*T-.2289914*y+1.4052427*E),p]}function de(u){return(u=u<=.00304?12.92*u:1.055*Math.pow(u,1/2.4)-.055)<0?0:u>1?1:u}function Ne(u){return u>ho?u*u*u:Po*(u-dl)}const qe=Object.hasOwn||function(u,n){return Object.prototype.hasOwnProperty.call(u,n)};function je(u,n){return qe(u,n)?u[n]:void 0}function rt(u){return parseInt(u.padEnd(2,u),16)/255}function Ct(u,n){return Dt(n?u/100:u,0,1)}function Dt(u,n,a){return Math.min(Math.max(n,u),a)}function Nt(u){return!u.some(Number.isNaN)}const Wt={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]};function jt(u,n,a){return u+a*(n-u)}function ki(u,n,a){return u.map((p,y)=>jt(p,n[y],a))}class si{constructor(n,a,p,y=1,T=!0){this.r=n,this.g=a,this.b=p,this.a=y,T||(this.r*=y,this.g*=y,this.b*=y,y||this.overwriteGetter("rgb",[n,a,p,y]))}static parse(n){if(n instanceof si)return n;if(typeof n!="string")return;const a=function(p){if((p=p.toLowerCase().trim())==="transparent")return[0,0,0,0];const y=je(Wt,p);if(y){const[E,M,A]=y;return[E/255,M/255,A/255,1]}if(p.startsWith("#")&&/^#(?:[0-9a-f]{3,4}|[0-9a-f]{6}|[0-9a-f]{8})$/.test(p)){const E=p.length<6?1:2;let M=1;return[rt(p.slice(M,M+=E)),rt(p.slice(M,M+=E)),rt(p.slice(M,M+=E)),rt(p.slice(M,M+E)||"ff")]}if(p.startsWith("rgb")){const E=p.match(/^rgba?\(\s*([\de.+-]+)(%)?(?:\s+|\s*(,)\s*)([\de.+-]+)(%)?(?:\s+|\s*(,)\s*)([\de.+-]+)(%)?(?:\s*([,\/])\s*([\de.+-]+)(%)?)?\s*\)$/);if(E){const[M,A,O,B,q,ee,re,se,ce,be,Me,Xe]=E,ze=[B||" ",re||" ",be].join("");if(ze==="  "||ze==="  /"||ze===",,"||ze===",,,"){const ie=[O,ee,ce].join(""),xe=ie==="%%%"?100:ie===""?255:0;if(xe){const Ge=[Dt(+A/xe,0,1),Dt(+q/xe,0,1),Dt(+se/xe,0,1),Me?Ct(+Me,Xe):1];if(Nt(Ge))return Ge}}return}}const T=p.match(/^hsla?\(\s*([\de.+-]+)(?:deg)?(?:\s+|\s*(,)\s*)([\de.+-]+)%(?:\s+|\s*(,)\s*)([\de.+-]+)%(?:\s*([,\/])\s*([\de.+-]+)(%)?)?\s*\)$/);if(T){const[E,M,A,O,B,q,ee,re,se]=T,ce=[A||" ",B||" ",ee].join("");if(ce==="  "||ce==="  /"||ce===",,"||ce===",,,"){const be=[+M,Dt(+O,0,100),Dt(+q,0,100),re?Ct(+re,se):1];if(Nt(be))return function([Me,Xe,ze,ie]){function xe(Ge){const mt=(Ge+Me/30)%12,Lt=Xe*Math.min(ze,1-ze);return ze-Lt*Math.max(-1,Math.min(mt-3,9-mt,1))}return Me=ko(Me),Xe/=100,ze/=100,[xe(0),xe(8),xe(4),ie]}(be)}}}(n);return a?new si(...a,!1):void 0}get rgb(){const{r:n,g:a,b:p,a:y}=this,T=y||1/0;return this.overwriteGetter("rgb",[n/T,a/T,p/T,y])}get hcl(){return this.overwriteGetter("hcl",function(n){const[a,p,y,T]=Wo(n),E=Math.sqrt(p*p+y*y);return[Math.round(1e4*E)?ko(Math.atan2(y,p)*Xl):NaN,E,a,T]}(this.rgb))}get lab(){return this.overwriteGetter("lab",Wo(this.rgb))}overwriteGetter(n,a){return Object.defineProperty(this,n,{value:a}),a}toString(){const[n,a,p,y]=this.rgb;return`rgba(${[n,a,p].map(T=>Math.round(255*T)).join(",")},${y})`}static interpolate(n,a,p,y="rgb"){switch(y){case"rgb":{const[T,E,M,A]=ki(n.rgb,a.rgb,p);return new si(T,E,M,A,!1)}case"hcl":{const[T,E,M,A]=n.hcl,[O,B,q,ee]=a.hcl;let re,se;if(isNaN(T)||isNaN(O))isNaN(T)?isNaN(O)?re=NaN:(re=O,M!==1&&M!==0||(se=B)):(re=T,q!==1&&q!==0||(se=E));else{let ze=O-T;O>T&&ze>180?ze-=360:O<T&&T-O>180&&(ze+=360),re=T+p*ze}const[ce,be,Me,Xe]=function([ze,ie,xe,Ge]){return ze=isNaN(ze)?0:ze*as,j([xe,Math.cos(ze)*ie,Math.sin(ze)*ie,Ge])}([re,se??jt(E,B,p),jt(M,q,p),jt(A,ee,p)]);return new si(ce,be,Me,Xe,!1)}case"lab":{const[T,E,M,A]=j(ki(n.lab,a.lab,p));return new si(T,E,M,A,!1)}}}}si.black=new si(0,0,0,1),si.white=new si(1,1,1,1),si.transparent=new si(0,0,0,0),si.red=new si(1,0,0,1);class Pi{constructor(n,a,p){this.sensitivity=n?a?"variant":"case":a?"accent":"base",this.locale=p,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(n,a){return this.collator.compare(n,a)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}const Rr=["bottom","center","top"];class Mt{constructor(n,a,p,y,T,E){this.text=n,this.image=a,this.scale=p,this.fontStack=y,this.textColor=T,this.verticalAlign=E}}class ei{constructor(n){this.sections=n}static fromString(n){return new ei([new Mt(n,null,null,null,null,null)])}isEmpty(){return this.sections.length===0||!this.sections.some(n=>n.text.length!==0||n.image&&n.image.name.length!==0)}static factory(n){return n instanceof ei?n:ei.fromString(n)}toString(){return this.sections.length===0?"":this.sections.map(n=>n.text).join("")}}class ji{constructor(n){this.values=n.slice()}static parse(n){if(n instanceof ji)return n;if(typeof n=="number")return new ji([n,n,n,n]);if(Array.isArray(n)&&!(n.length<1||n.length>4)){for(const a of n)if(typeof a!="number")return;switch(n.length){case 1:n=[n[0],n[0],n[0],n[0]];break;case 2:n=[n[0],n[1],n[0],n[1]];break;case 3:n=[n[0],n[1],n[2],n[1]]}return new ji(n)}}toString(){return JSON.stringify(this.values)}static interpolate(n,a,p){return new ji(ki(n.values,a.values,p))}}class or{constructor(n){this.values=n.slice()}static parse(n){if(n instanceof or)return n;if(typeof n=="number")return new or([n]);if(Array.isArray(n)){for(const a of n)if(typeof a!="number")return;return new or(n)}}toString(){return JSON.stringify(this.values)}static interpolate(n,a,p){return new or(ki(n.values,a.values,p))}}class rr{constructor(n){this.values=n.slice()}static parse(n){if(n instanceof rr)return n;if(typeof n=="string"){const p=si.parse(n);return p?new rr([p]):void 0}if(!Array.isArray(n))return;const a=[];for(const p of n){if(typeof p!="string")return;const y=si.parse(p);if(!y)return;a.push(y)}return new rr(a)}toString(){return JSON.stringify(this.values)}static interpolate(n,a,p,y="rgb"){const T=[];if(n.values.length!=a.values.length)throw new Error(`colorArray: Arrays have mismatched length (${n.values.length} vs. ${a.values.length}), cannot interpolate.`);for(let E=0;E<n.values.length;E++)T.push(si.interpolate(n.values[E],a.values[E],p,y));return new rr(T)}}class Ar extends Error{constructor(n){super(n),this.name="RuntimeError"}toJSON(){return this.message}}const pr=new Set(["center","left","right","top","bottom","top-left","top-right","bottom-left","bottom-right"]);class ui{constructor(n){this.values=n.slice()}static parse(n){if(n instanceof ui)return n;if(Array.isArray(n)&&!(n.length<1)&&n.length%2==0){for(let a=0;a<n.length;a+=2){const p=n[a],y=n[a+1];if(typeof p!="string"||!pr.has(p)||!Array.isArray(y)||y.length!==2||typeof y[0]!="number"||typeof y[1]!="number")return}return new ui(n)}}toString(){return JSON.stringify(this.values)}static interpolate(n,a,p){const y=n.values,T=a.values;if(y.length!==T.length)throw new Ar(`Cannot interpolate values of different length. from: ${n.toString()}, to: ${a.toString()}`);const E=[];for(let M=0;M<y.length;M+=2){if(y[M]!==T[M])throw new Ar(`Cannot interpolate values containing mismatched anchors. from[${M}]: ${y[M]}, to[${M}]: ${T[M]}`);E.push(y[M]);const[A,O]=y[M+1],[B,q]=T[M+1];E.push([jt(A,B,p),jt(O,q,p)])}return new ui(E)}}class Pn{constructor(n){this.name=n.name,this.available=n.available}toString(){return this.name}static fromString(n){return n?new Pn({name:n,available:!1}):null}}class Vi{constructor(n,a,p){this.from=n,this.to=a,this.transition=p}static interpolate(n,a,p){return new Vi(n,a,p)}static parse(n){return n instanceof Vi?n:Array.isArray(n)&&n.length===3&&typeof n[0]=="string"&&typeof n[1]=="string"&&typeof n[2]=="number"?new Vi(n[0],n[1],n[2]):typeof n=="object"&&typeof n.from=="string"&&typeof n.to=="string"&&typeof n.transition=="number"?new Vi(n.from,n.to,n.transition):typeof n=="string"?new Vi(n,n,1):void 0}}function Ri(u,n,a,p){return typeof u=="number"&&u>=0&&u<=255&&typeof n=="number"&&n>=0&&n<=255&&typeof a=="number"&&a>=0&&a<=255?p===void 0||typeof p=="number"&&p>=0&&p<=1?null:`Invalid rgba value [${[u,n,a,p].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${(typeof p=="number"?[u,n,a,p]:[u,n,a]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function eo(u){if(u===null||typeof u=="string"||typeof u=="boolean"||typeof u=="number"||u instanceof Vi||u instanceof si||u instanceof Pi||u instanceof ei||u instanceof ji||u instanceof or||u instanceof rr||u instanceof ui||u instanceof Pn)return!0;if(Array.isArray(u)){for(const n of u)if(!eo(n))return!1;return!0}if(typeof u=="object"){for(const n in u)if(!eo(u[n]))return!1;return!0}return!1}function fi(u){if(u===null)return Ps;if(typeof u=="string")return xi;if(typeof u=="boolean")return it;if(typeof u=="number")return Bt;if(u instanceof si)return Wi;if(u instanceof Vi)return Dr;if(u instanceof Pi)return Wr;if(u instanceof ei)return vn;if(u instanceof ji)return Ai;if(u instanceof or)return Yr;if(u instanceof rr)return Sn;if(u instanceof ui)return Xn;if(u instanceof Pn)return gr;if(Array.isArray(u)){const n=u.length;let a;for(const p of u){const y=fi(p);if(a){if(a===y)continue;a=ri;break}a=y}return Mn(a||ri,n)}return Er}function to(u){const n=typeof u;return u===null?"":n==="string"||n==="number"||n==="boolean"?String(u):u instanceof si||u instanceof Vi||u instanceof ei||u instanceof ji||u instanceof or||u instanceof rr||u instanceof ui||u instanceof Pn?u.toString():JSON.stringify(u)}class hn{constructor(n,a){this.type=n,this.value=a}static parse(n,a){if(n.length!==2)return a.error(`'literal' expression requires exactly one argument, but found ${n.length-1} instead.`);if(!eo(n[1]))return a.error("invalid value");const p=n[1];let y=fi(p);const T=a.expectedType;return y.kind!=="array"||y.N!==0||!T||T.kind!=="array"||typeof T.N=="number"&&T.N!==0||(y=T),new hn(y,p)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}}const po={string:xi,number:Bt,boolean:it,object:Er};class Dn{constructor(n,a){this.type=n,this.args=a}static parse(n,a){if(n.length<2)return a.error("Expected at least one argument.");let p,y=1;const T=n[0];if(T==="array"){let M,A;if(n.length>2){const O=n[1];if(typeof O!="string"||!(O in po)||O==="object")return a.error('The item type argument of "array" must be one of string, number, boolean',1);M=po[O],y++}else M=ri;if(n.length>3){if(n[2]!==null&&(typeof n[2]!="number"||n[2]<0||n[2]!==Math.floor(n[2])))return a.error('The length argument to "array" must be a positive integer literal',2);A=n[2],y++}p=Mn(M,A)}else{if(!po[T])throw new Error(`Types doesn't contain name = ${T}`);p=po[T]}const E=[];for(;y<n.length;y++){const M=a.parse(n[y],y,ri);if(!M)return null;E.push(M)}return new Dn(p,E)}evaluate(n){for(let a=0;a<this.args.length;a++){const p=this.args[a].evaluate(n);if(!$n(this.type,fi(p)))return p;if(a===this.args.length-1)throw new Ar(`Expected value to be of type ${qi(this.type)}, but found ${qi(fi(p))} instead.`)}throw new Error}eachChild(n){this.args.forEach(n)}outputDefined(){return this.args.every(n=>n.outputDefined())}}const pl={"to-boolean":it,"to-color":Wi,"to-number":Bt,"to-string":xi};class Cs{constructor(n,a){this.type=n,this.args=a}static parse(n,a){if(n.length<2)return a.error("Expected at least one argument.");const p=n[0];if(!pl[p])throw new Error(`Can't parse ${p} as it is not part of the known types`);if((p==="to-boolean"||p==="to-string")&&n.length!==2)return a.error("Expected one argument.");const y=pl[p],T=[];for(let E=1;E<n.length;E++){const M=a.parse(n[E],E,ri);if(!M)return null;T.push(M)}return new Cs(y,T)}evaluate(n){switch(this.type.kind){case"boolean":return!!this.args[0].evaluate(n);case"color":{let a,p;for(const y of this.args){if(a=y.evaluate(n),p=null,a instanceof si)return a;if(typeof a=="string"){const T=n.parseColor(a);if(T)return T}else if(Array.isArray(a)&&(p=a.length<3||a.length>4?`Invalid rgba value ${JSON.stringify(a)}: expected an array containing either three or four numeric values.`:Ri(a[0],a[1],a[2],a[3]),!p))return new si(a[0]/255,a[1]/255,a[2]/255,a[3])}throw new Ar(p||`Could not parse color from value '${typeof a=="string"?a:JSON.stringify(a)}'`)}case"padding":{let a;for(const p of this.args){a=p.evaluate(n);const y=ji.parse(a);if(y)return y}throw new Ar(`Could not parse padding from value '${typeof a=="string"?a:JSON.stringify(a)}'`)}case"numberArray":{let a;for(const p of this.args){a=p.evaluate(n);const y=or.parse(a);if(y)return y}throw new Ar(`Could not parse numberArray from value '${typeof a=="string"?a:JSON.stringify(a)}'`)}case"colorArray":{let a;for(const p of this.args){a=p.evaluate(n);const y=rr.parse(a);if(y)return y}throw new Ar(`Could not parse colorArray from value '${typeof a=="string"?a:JSON.stringify(a)}'`)}case"variableAnchorOffsetCollection":{let a;for(const p of this.args){a=p.evaluate(n);const y=ui.parse(a);if(y)return y}throw new Ar(`Could not parse variableAnchorOffsetCollection from value '${typeof a=="string"?a:JSON.stringify(a)}'`)}case"number":{let a=null;for(const p of this.args){if(a=p.evaluate(n),a===null)return 0;const y=Number(a);if(!isNaN(y))return y}throw new Ar(`Could not convert ${JSON.stringify(a)} to number.`)}case"formatted":return ei.fromString(to(this.args[0].evaluate(n)));case"resolvedImage":return Pn.fromString(to(this.args[0].evaluate(n)));case"projectionDefinition":return this.args[0].evaluate(n);default:return to(this.args[0].evaluate(n))}}eachChild(n){this.args.forEach(n)}outputDefined(){return this.args.every(n=>n.outputDefined())}}const js=["Unknown","Point","LineString","Polygon"];class Xo{constructor(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache=new Map,this.availableImages=null,this.canonical=null}id(){return this.feature&&"id"in this.feature?this.feature.id:null}geometryType(){return this.feature?typeof this.feature.type=="number"?js[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}parseColor(n){let a=this._parseColorCache.get(n);return a||(a=si.parse(n),this._parseColorCache.set(n,a)),a}}class Ho{constructor(n,a,p=[],y,T=new Or,E=[]){this.registry=n,this.path=p,this.key=p.map(M=>`[${M}]`).join(""),this.scope=T,this.errors=E,this.expectedType=y,this._isConstant=a}parse(n,a,p,y,T={}){return a?this.concat(a,p,y)._parse(n,T):this._parse(n,T)}_parse(n,a){function p(y,T,E){return E==="assert"?new Dn(T,[y]):E==="coerce"?new Cs(T,[y]):y}if(n!==null&&typeof n!="string"&&typeof n!="boolean"&&typeof n!="number"||(n=["literal",n]),Array.isArray(n)){if(n.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const y=n[0];if(typeof y!="string")return this.error(`Expression name must be a string, but found ${typeof y} instead. If you wanted a literal array, use ["literal", [...]].`,0),null;const T=this.registry[y];if(T){let E=T.parse(n,this);if(!E)return null;if(this.expectedType){const M=this.expectedType,A=E.type;if(M.kind!=="string"&&M.kind!=="number"&&M.kind!=="boolean"&&M.kind!=="object"&&M.kind!=="array"||A.kind!=="value"){if(M.kind==="projectionDefinition"&&["string","array"].includes(A.kind)||["color","formatted","resolvedImage"].includes(M.kind)&&["value","string"].includes(A.kind)||["padding","numberArray"].includes(M.kind)&&["value","number","array"].includes(A.kind)||M.kind==="colorArray"&&["value","string","array"].includes(A.kind)||M.kind==="variableAnchorOffsetCollection"&&["value","array"].includes(A.kind))E=p(E,M,a.typeAnnotation||"coerce");else if(this.checkSubtype(M,A))return null}else E=p(E,M,a.typeAnnotation||"assert")}if(!(E instanceof hn)&&E.type.kind!=="resolvedImage"&&this._isConstant(E)){const M=new Xo;try{E=new hn(E.type,E.evaluate(M))}catch(A){return this.error(A.message),null}}return E}return this.error(`Unknown expression "${y}". If you wanted a literal array, use ["literal", [...]].`,0)}return this.error(n===void 0?"'undefined' value invalid. Use null instead.":typeof n=="object"?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof n} instead.`)}concat(n,a,p){const y=typeof n=="number"?this.path.concat(n):this.path,T=p?this.scope.concat(p):this.scope;return new Ho(this.registry,this._isConstant,y,a||null,T,this.errors)}error(n,...a){const p=`${this.key}${a.map(y=>`[${y}]`).join("")}`;this.errors.push(new Sr(p,n))}checkSubtype(n,a){const p=$n(n,a);return p&&this.error(p),p}}class kn{constructor(n,a){this.type=a.type,this.bindings=[].concat(n),this.result=a}evaluate(n){return this.result.evaluate(n)}eachChild(n){for(const a of this.bindings)n(a[1]);n(this.result)}static parse(n,a){if(n.length<4)return a.error(`Expected at least 3 arguments, but found ${n.length-1} instead.`);const p=[];for(let T=1;T<n.length-1;T+=2){const E=n[T];if(typeof E!="string")return a.error(`Expected string, but found ${typeof E} instead.`,T);if(/[^a-zA-Z0-9_]/.test(E))return a.error("Variable names must contain only alphanumeric characters or '_'.",T);const M=a.parse(n[T+1],T+1);if(!M)return null;p.push([E,M])}const y=a.parse(n[n.length-1],n.length-1,a.expectedType,p);return y?new kn(p,y):null}outputDefined(){return this.result.outputDefined()}}class Fn{constructor(n,a){this.type=a.type,this.name=n,this.boundExpression=a}static parse(n,a){if(n.length!==2||typeof n[1]!="string")return a.error("'var' expression requires exactly one string literal argument.");const p=n[1];return a.scope.has(p)?new Fn(p,a.scope.get(p)):a.error(`Unknown variable "${p}". Make sure "${p}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(n){return this.boundExpression.evaluate(n)}eachChild(){}outputDefined(){return!1}}class bn{constructor(n,a,p){this.type=n,this.index=a,this.input=p}static parse(n,a){if(n.length!==3)return a.error(`Expected 2 arguments, but found ${n.length-1} instead.`);const p=a.parse(n[1],1,Bt),y=a.parse(n[2],2,Mn(a.expectedType||ri));return p&&y?new bn(y.type.itemType,p,y):null}evaluate(n){const a=this.index.evaluate(n),p=this.input.evaluate(n);if(a<0)throw new Ar(`Array index out of bounds: ${a} < 0.`);if(a>=p.length)throw new Ar(`Array index out of bounds: ${a} > ${p.length-1}.`);if(a!==Math.floor(a))throw new Ar(`Array index must be an integer, but found ${a} instead.`);return p[a]}eachChild(n){n(this.index),n(this.input)}outputDefined(){return!1}}class Hn{constructor(n,a){this.type=it,this.needle=n,this.haystack=a}static parse(n,a){if(n.length!==3)return a.error(`Expected 2 arguments, but found ${n.length-1} instead.`);const p=a.parse(n[1],1,ri),y=a.parse(n[2],2,ri);return p&&y?Jr(p.type,[it,xi,Bt,Ps,ri])?new Hn(p,y):a.error(`Expected first argument to be of type boolean, string, number or null, but found ${qi(p.type)} instead`):null}evaluate(n){const a=this.needle.evaluate(n),p=this.haystack.evaluate(n);if(!p)return!1;if(!vr(a,["boolean","string","number","null"]))throw new Ar(`Expected first argument to be of type boolean, string, number or null, but found ${qi(fi(a))} instead.`);if(!vr(p,["string","array"]))throw new Ar(`Expected second argument to be of type array or string, but found ${qi(fi(p))} instead.`);return p.indexOf(a)>=0}eachChild(n){n(this.needle),n(this.haystack)}outputDefined(){return!0}}class fo{constructor(n,a,p){this.type=Bt,this.needle=n,this.haystack=a,this.fromIndex=p}static parse(n,a){if(n.length<=2||n.length>=5)return a.error(`Expected 3 or 4 arguments, but found ${n.length-1} instead.`);const p=a.parse(n[1],1,ri),y=a.parse(n[2],2,ri);if(!p||!y)return null;if(!Jr(p.type,[it,xi,Bt,Ps,ri]))return a.error(`Expected first argument to be of type boolean, string, number or null, but found ${qi(p.type)} instead`);if(n.length===4){const T=a.parse(n[3],3,Bt);return T?new fo(p,y,T):null}return new fo(p,y)}evaluate(n){const a=this.needle.evaluate(n),p=this.haystack.evaluate(n);if(!vr(a,["boolean","string","number","null"]))throw new Ar(`Expected first argument to be of type boolean, string, number or null, but found ${qi(fi(a))} instead.`);let y;if(this.fromIndex&&(y=this.fromIndex.evaluate(n)),vr(p,["string"])){const T=p.indexOf(a,y);return T===-1?-1:[...p.slice(0,T)].length}if(vr(p,["array"]))return p.indexOf(a,y);throw new Ar(`Expected second argument to be of type array or string, but found ${qi(fi(p))} instead.`)}eachChild(n){n(this.needle),n(this.haystack),this.fromIndex&&n(this.fromIndex)}outputDefined(){return!1}}class bs{constructor(n,a,p,y,T,E){this.inputType=n,this.type=a,this.input=p,this.cases=y,this.outputs=T,this.otherwise=E}static parse(n,a){if(n.length<5)return a.error(`Expected at least 4 arguments, but found only ${n.length-1}.`);if(n.length%2!=1)return a.error("Expected an even number of arguments.");let p,y;a.expectedType&&a.expectedType.kind!=="value"&&(y=a.expectedType);const T={},E=[];for(let O=2;O<n.length-1;O+=2){let B=n[O];const q=n[O+1];Array.isArray(B)||(B=[B]);const ee=a.concat(O);if(B.length===0)return ee.error("Expected at least one branch label.");for(const se of B){if(typeof se!="number"&&typeof se!="string")return ee.error("Branch labels must be numbers or strings.");if(typeof se=="number"&&Math.abs(se)>Number.MAX_SAFE_INTEGER)return ee.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if(typeof se=="number"&&Math.floor(se)!==se)return ee.error("Numeric branch labels must be integer values.");if(p){if(ee.checkSubtype(p,fi(se)))return null}else p=fi(se);if(T[String(se)]!==void 0)return ee.error("Branch labels must be unique.");T[String(se)]=E.length}const re=a.parse(q,O,y);if(!re)return null;y=y||re.type,E.push(re)}const M=a.parse(n[1],1,ri);if(!M)return null;const A=a.parse(n[n.length-1],n.length-1,y);return A?M.type.kind!=="value"&&a.concat(1).checkSubtype(p,M.type)?null:new bs(p,y,M,T,E,A):null}evaluate(n){const a=this.input.evaluate(n);return(fi(a)===this.inputType&&this.outputs[this.cases[a]]||this.otherwise).evaluate(n)}eachChild(n){n(this.input),this.outputs.forEach(n),n(this.otherwise)}outputDefined(){return this.outputs.every(n=>n.outputDefined())&&this.otherwise.outputDefined()}}class Mr{constructor(n,a,p){this.type=n,this.branches=a,this.otherwise=p}static parse(n,a){if(n.length<4)return a.error(`Expected at least 3 arguments, but found only ${n.length-1}.`);if(n.length%2!=0)return a.error("Expected an odd number of arguments.");let p;a.expectedType&&a.expectedType.kind!=="value"&&(p=a.expectedType);const y=[];for(let E=1;E<n.length-1;E+=2){const M=a.parse(n[E],E,it);if(!M)return null;const A=a.parse(n[E+1],E+1,p);if(!A)return null;y.push([M,A]),p=p||A.type}const T=a.parse(n[n.length-1],n.length-1,p);if(!T)return null;if(!p)throw new Error("Can't infer output type");return new Mr(p,y,T)}evaluate(n){for(const[a,p]of this.branches)if(a.evaluate(n))return p.evaluate(n);return this.otherwise.evaluate(n)}eachChild(n){for(const[a,p]of this.branches)n(a),n(p);n(this.otherwise)}outputDefined(){return this.branches.every(([n,a])=>a.outputDefined())&&this.otherwise.outputDefined()}}class jn{constructor(n,a,p,y){this.type=n,this.input=a,this.beginIndex=p,this.endIndex=y}static parse(n,a){if(n.length<=2||n.length>=5)return a.error(`Expected 3 or 4 arguments, but found ${n.length-1} instead.`);const p=a.parse(n[1],1,ri),y=a.parse(n[2],2,Bt);if(!p||!y)return null;if(!Jr(p.type,[Mn(ri),xi,ri]))return a.error(`Expected first argument to be of type array or string, but found ${qi(p.type)} instead`);if(n.length===4){const T=a.parse(n[3],3,Bt);return T?new jn(p.type,p,y,T):null}return new jn(p.type,p,y)}evaluate(n){const a=this.input.evaluate(n),p=this.beginIndex.evaluate(n);let y;if(this.endIndex&&(y=this.endIndex.evaluate(n)),vr(a,["string"]))return[...a].slice(p,y).join("");if(vr(a,["array"]))return a.slice(p,y);throw new Ar(`Expected first argument to be of type array or string, but found ${qi(fi(a))} instead.`)}eachChild(n){n(this.input),n(this.beginIndex),this.endIndex&&n(this.endIndex)}outputDefined(){return!1}}function mo(u,n){const a=u.length-1;let p,y,T=0,E=a,M=0;for(;T<=E;)if(M=Math.floor((T+E)/2),p=u[M],y=u[M+1],p<=n){if(M===a||n<y)return M;T=M+1}else{if(!(p>n))throw new Ar("Input is not a number.");E=M-1}return 0}class Ko{constructor(n,a,p){this.type=n,this.input=a,this.labels=[],this.outputs=[];for(const[y,T]of p)this.labels.push(y),this.outputs.push(T)}static parse(n,a){if(n.length-1<4)return a.error(`Expected at least 4 arguments, but found only ${n.length-1}.`);if((n.length-1)%2!=0)return a.error("Expected an even number of arguments.");const p=a.parse(n[1],1,Bt);if(!p)return null;const y=[];let T=null;a.expectedType&&a.expectedType.kind!=="value"&&(T=a.expectedType);for(let E=1;E<n.length;E+=2){const M=E===1?-1/0:n[E],A=n[E+1],O=E,B=E+1;if(typeof M!="number")return a.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',O);if(y.length&&y[y.length-1][0]>=M)return a.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',O);const q=a.parse(A,B,T);if(!q)return null;T=T||q.type,y.push([M,q])}return new Ko(T,p,y)}evaluate(n){const a=this.labels,p=this.outputs;if(a.length===1)return p[0].evaluate(n);const y=this.input.evaluate(n);if(y<=a[0])return p[0].evaluate(n);const T=a.length;return y>=a[T-1]?p[T-1].evaluate(n):p[mo(a,y)].evaluate(n)}eachChild(n){n(this.input);for(const a of this.outputs)n(a)}outputDefined(){return this.outputs.every(n=>n.outputDefined())}}function Hl(u){return u&&u.__esModule&&Object.prototype.hasOwnProperty.call(u,"default")?u.default:u}var As,Jo,Oa=function(){if(Jo)return As;function u(n,a,p,y){this.cx=3*n,this.bx=3*(p-n)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*a,this.by=3*(y-a)-this.cy,this.ay=1-this.cy-this.by,this.p1x=n,this.p1y=a,this.p2x=p,this.p2y=y}return Jo=1,As=u,u.prototype={sampleCurveX:function(n){return((this.ax*n+this.bx)*n+this.cx)*n},sampleCurveY:function(n){return((this.ay*n+this.by)*n+this.cy)*n},sampleCurveDerivativeX:function(n){return(3*this.ax*n+2*this.bx)*n+this.cx},solveCurveX:function(n,a){if(a===void 0&&(a=1e-6),n<0)return 0;if(n>1)return 1;for(var p=n,y=0;y<8;y++){var T=this.sampleCurveX(p)-n;if(Math.abs(T)<a)return p;var E=this.sampleCurveDerivativeX(p);if(Math.abs(E)<1e-6)break;p-=T/E}var M=0,A=1;for(p=n,y=0;y<20&&(T=this.sampleCurveX(p),!(Math.abs(T-n)<a));y++)n>T?M=p:A=p,p=.5*(A-M)+M;return p},solve:function(n,a){return this.sampleCurveY(this.solveCurveX(n,a))}},As}(),Fu=Hl(Oa);class Qr{constructor(n,a,p,y,T){this.type=n,this.operator=a,this.interpolation=p,this.input=y,this.labels=[],this.outputs=[];for(const[E,M]of T)this.labels.push(E),this.outputs.push(M)}static interpolationFactor(n,a,p,y){let T=0;if(n.name==="exponential")T=ls(a,n.base,p,y);else if(n.name==="linear")T=ls(a,1,p,y);else if(n.name==="cubic-bezier"){const E=n.controlPoints;T=new Fu(E[0],E[1],E[2],E[3]).solve(ls(a,1,p,y))}return T}static parse(n,a){let[p,y,T,...E]=n;if(!Array.isArray(y)||y.length===0)return a.error("Expected an interpolation type expression.",1);if(y[0]==="linear")y={name:"linear"};else if(y[0]==="exponential"){const O=y[1];if(typeof O!="number")return a.error("Exponential interpolation requires a numeric base.",1,1);y={name:"exponential",base:O}}else{if(y[0]!=="cubic-bezier")return a.error(`Unknown interpolation type ${String(y[0])}`,1,0);{const O=y.slice(1);if(O.length!==4||O.some(B=>typeof B!="number"||B<0||B>1))return a.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);y={name:"cubic-bezier",controlPoints:O}}}if(n.length-1<4)return a.error(`Expected at least 4 arguments, but found only ${n.length-1}.`);if((n.length-1)%2!=0)return a.error("Expected an even number of arguments.");if(T=a.parse(T,2,Bt),!T)return null;const M=[];let A=null;p!=="interpolate-hcl"&&p!=="interpolate-lab"||a.expectedType==Sn?a.expectedType&&a.expectedType.kind!=="value"&&(A=a.expectedType):A=Wi;for(let O=0;O<E.length;O+=2){const B=E[O],q=E[O+1],ee=O+3,re=O+4;if(typeof B!="number")return a.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',ee);if(M.length&&M[M.length-1][0]>=B)return a.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',ee);const se=a.parse(q,re,A);if(!se)return null;A=A||se.type,M.push([B,se])}return Qs(A,Bt)||Qs(A,Dr)||Qs(A,Wi)||Qs(A,Ai)||Qs(A,Yr)||Qs(A,Sn)||Qs(A,Xn)||Qs(A,Mn(Bt))?new Qr(A,p,y,T,M):a.error(`Type ${qi(A)} is not interpolatable.`)}evaluate(n){const a=this.labels,p=this.outputs;if(a.length===1)return p[0].evaluate(n);const y=this.input.evaluate(n);if(y<=a[0])return p[0].evaluate(n);const T=a.length;if(y>=a[T-1])return p[T-1].evaluate(n);const E=mo(a,y),M=Qr.interpolationFactor(this.interpolation,y,a[E],a[E+1]),A=p[E].evaluate(n),O=p[E+1].evaluate(n);switch(this.operator){case"interpolate":switch(this.type.kind){case"number":return jt(A,O,M);case"color":return si.interpolate(A,O,M);case"padding":return ji.interpolate(A,O,M);case"colorArray":return rr.interpolate(A,O,M);case"numberArray":return or.interpolate(A,O,M);case"variableAnchorOffsetCollection":return ui.interpolate(A,O,M);case"array":return ki(A,O,M);case"projectionDefinition":return Vi.interpolate(A,O,M)}case"interpolate-hcl":switch(this.type.kind){case"color":return si.interpolate(A,O,M,"hcl");case"colorArray":return rr.interpolate(A,O,M,"hcl")}case"interpolate-lab":switch(this.type.kind){case"color":return si.interpolate(A,O,M,"lab");case"colorArray":return rr.interpolate(A,O,M,"lab")}}}eachChild(n){n(this.input);for(const a of this.outputs)n(a)}outputDefined(){return this.outputs.every(n=>n.outputDefined())}}function ls(u,n,a,p){const y=p-a,T=u-a;return y===0?0:n===1?T/y:(Math.pow(n,T)-1)/(Math.pow(n,y)-1)}const Fr={color:si.interpolate,number:jt,padding:ji.interpolate,numberArray:or.interpolate,colorArray:rr.interpolate,variableAnchorOffsetCollection:ui.interpolate,array:ki};class Kn{constructor(n,a){this.type=n,this.args=a}static parse(n,a){if(n.length<2)return a.error("Expected at least one argument.");let p=null;const y=a.expectedType;y&&y.kind!=="value"&&(p=y);const T=[];for(const M of n.slice(1)){const A=a.parse(M,1+T.length,p,void 0,{typeAnnotation:"omit"});if(!A)return null;p=p||A.type,T.push(A)}if(!p)throw new Error("No output type");const E=y&&T.some(M=>$n(y,M.type));return new Kn(E?ri:p,T)}evaluate(n){let a,p=null,y=0;for(const T of this.args)if(y++,p=T.evaluate(n),p&&p instanceof Pn&&!p.available&&(a||(a=p.name),p=null,y===this.args.length&&(p=a)),p!==null)break;return p}eachChild(n){this.args.forEach(n)}outputDefined(){return this.args.every(n=>n.outputDefined())}}function Qo(u,n){return u==="=="||u==="!="?n.kind==="boolean"||n.kind==="string"||n.kind==="number"||n.kind==="null"||n.kind==="value":n.kind==="string"||n.kind==="number"||n.kind==="value"}function io(u,n,a,p){return p.compare(n,a)===0}function Gs(u,n,a){const p=u!=="=="&&u!=="!=";return class H1{constructor(T,E,M){this.type=it,this.lhs=T,this.rhs=E,this.collator=M,this.hasUntypedArgument=T.type.kind==="value"||E.type.kind==="value"}static parse(T,E){if(T.length!==3&&T.length!==4)return E.error("Expected two or three arguments.");const M=T[0];let A=E.parse(T[1],1,ri);if(!A)return null;if(!Qo(M,A.type))return E.concat(1).error(`"${M}" comparisons are not supported for type '${qi(A.type)}'.`);let O=E.parse(T[2],2,ri);if(!O)return null;if(!Qo(M,O.type))return E.concat(2).error(`"${M}" comparisons are not supported for type '${qi(O.type)}'.`);if(A.type.kind!==O.type.kind&&A.type.kind!=="value"&&O.type.kind!=="value")return E.error(`Cannot compare types '${qi(A.type)}' and '${qi(O.type)}'.`);p&&(A.type.kind==="value"&&O.type.kind!=="value"?A=new Dn(O.type,[A]):A.type.kind!=="value"&&O.type.kind==="value"&&(O=new Dn(A.type,[O])));let B=null;if(T.length===4){if(A.type.kind!=="string"&&O.type.kind!=="string"&&A.type.kind!=="value"&&O.type.kind!=="value")return E.error("Cannot use collator to compare non-string types.");if(B=E.parse(T[3],3,Wr),!B)return null}return new H1(A,O,B)}evaluate(T){const E=this.lhs.evaluate(T),M=this.rhs.evaluate(T);if(p&&this.hasUntypedArgument){const A=fi(E),O=fi(M);if(A.kind!==O.kind||A.kind!=="string"&&A.kind!=="number")throw new Ar(`Expected arguments for "${u}" to be (string, string) or (number, number), but found (${A.kind}, ${O.kind}) instead.`)}if(this.collator&&!p&&this.hasUntypedArgument){const A=fi(E),O=fi(M);if(A.kind!=="string"||O.kind!=="string")return n(T,E,M)}return this.collator?a(T,E,M,this.collator.evaluate(T)):n(T,E,M)}eachChild(T){T(this.lhs),T(this.rhs),this.collator&&T(this.collator)}outputDefined(){return!0}}}const ea=Gs("==",function(u,n,a){return n===a},io),_a=Gs("!=",function(u,n,a){return n!==a},function(u,n,a,p){return!io(0,n,a,p)}),ta=Gs("<",function(u,n,a){return n<a},function(u,n,a,p){return p.compare(n,a)<0}),Ls=Gs(">",function(u,n,a){return n>a},function(u,n,a,p){return p.compare(n,a)>0}),Kl=Gs("<=",function(u,n,a){return n<=a},function(u,n,a,p){return p.compare(n,a)<=0}),zn=Gs(">=",function(u,n,a){return n>=a},function(u,n,a,p){return p.compare(n,a)>=0});class go{constructor(n,a,p){this.type=Wr,this.locale=p,this.caseSensitive=n,this.diacriticSensitive=a}static parse(n,a){if(n.length!==2)return a.error("Expected one argument.");const p=n[1];if(typeof p!="object"||Array.isArray(p))return a.error("Collator options argument must be an object.");const y=a.parse(p["case-sensitive"]!==void 0&&p["case-sensitive"],1,it);if(!y)return null;const T=a.parse(p["diacritic-sensitive"]!==void 0&&p["diacritic-sensitive"],1,it);if(!T)return null;let E=null;return p.locale&&(E=a.parse(p.locale,1,xi),!E)?null:new go(y,T,E)}evaluate(n){return new Pi(this.caseSensitive.evaluate(n),this.diacriticSensitive.evaluate(n),this.locale?this.locale.evaluate(n):null)}eachChild(n){n(this.caseSensitive),n(this.diacriticSensitive),this.locale&&n(this.locale)}outputDefined(){return!1}}class Da{constructor(n,a,p,y,T){this.type=xi,this.number=n,this.locale=a,this.currency=p,this.minFractionDigits=y,this.maxFractionDigits=T}static parse(n,a){if(n.length!==3)return a.error("Expected two arguments.");const p=a.parse(n[1],1,Bt);if(!p)return null;const y=n[2];if(typeof y!="object"||Array.isArray(y))return a.error("NumberFormat options argument must be an object.");let T=null;if(y.locale&&(T=a.parse(y.locale,1,xi),!T))return null;let E=null;if(y.currency&&(E=a.parse(y.currency,1,xi),!E))return null;let M=null;if(y["min-fraction-digits"]&&(M=a.parse(y["min-fraction-digits"],1,Bt),!M))return null;let A=null;return y["max-fraction-digits"]&&(A=a.parse(y["max-fraction-digits"],1,Bt),!A)?null:new Da(p,T,E,M,A)}evaluate(n){return new Intl.NumberFormat(this.locale?this.locale.evaluate(n):[],{style:this.currency?"currency":"decimal",currency:this.currency?this.currency.evaluate(n):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(n):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(n):void 0}).format(this.number.evaluate(n))}eachChild(n){n(this.number),this.locale&&n(this.locale),this.currency&&n(this.currency),this.minFractionDigits&&n(this.minFractionDigits),this.maxFractionDigits&&n(this.maxFractionDigits)}outputDefined(){return!1}}class Co{constructor(n){this.type=vn,this.sections=n}static parse(n,a){if(n.length<2)return a.error("Expected at least one argument.");const p=n[1];if(!Array.isArray(p)&&typeof p=="object")return a.error("First argument must be an image or text section.");const y=[];let T=!1;for(let E=1;E<=n.length-1;++E){const M=n[E];if(T&&typeof M=="object"&&!Array.isArray(M)){T=!1;let A=null;if(M["font-scale"]&&(A=a.parse(M["font-scale"],1,Bt),!A))return null;let O=null;if(M["text-font"]&&(O=a.parse(M["text-font"],1,Mn(xi)),!O))return null;let B=null;if(M["text-color"]&&(B=a.parse(M["text-color"],1,Wi),!B))return null;let q=null;if(M["vertical-align"]){if(typeof M["vertical-align"]=="string"&&!Rr.includes(M["vertical-align"]))return a.error(`'vertical-align' must be one of: 'bottom', 'center', 'top' but found '${M["vertical-align"]}' instead.`);if(q=a.parse(M["vertical-align"],1,xi),!q)return null}const ee=y[y.length-1];ee.scale=A,ee.font=O,ee.textColor=B,ee.verticalAlign=q}else{const A=a.parse(n[E],1,ri);if(!A)return null;const O=A.type.kind;if(O!=="string"&&O!=="value"&&O!=="null"&&O!=="resolvedImage")return a.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");T=!0,y.push({content:A,scale:null,font:null,textColor:null,verticalAlign:null})}}return new Co(y)}evaluate(n){return new ei(this.sections.map(a=>{const p=a.content.evaluate(n);return fi(p)===gr?new Mt("",p,null,null,null,a.verticalAlign?a.verticalAlign.evaluate(n):null):new Mt(to(p),null,a.scale?a.scale.evaluate(n):null,a.font?a.font.evaluate(n).join(","):null,a.textColor?a.textColor.evaluate(n):null,a.verticalAlign?a.verticalAlign.evaluate(n):null)}))}eachChild(n){for(const a of this.sections)n(a.content),a.scale&&n(a.scale),a.font&&n(a.font),a.textColor&&n(a.textColor),a.verticalAlign&&n(a.verticalAlign)}outputDefined(){return!1}}class ia{constructor(n){this.type=gr,this.input=n}static parse(n,a){if(n.length!==2)return a.error("Expected two arguments.");const p=a.parse(n[1],1,xi);return p?new ia(p):a.error("No image name provided.")}evaluate(n){const a=this.input.evaluate(n),p=Pn.fromString(a);return p&&n.availableImages&&(p.available=n.availableImages.indexOf(a)>-1),p}eachChild(n){n(this.input)}outputDefined(){return!1}}class Rs{constructor(n){this.type=Bt,this.input=n}static parse(n,a){if(n.length!==2)return a.error(`Expected 1 argument, but found ${n.length-1} instead.`);const p=a.parse(n[1],1);return p?p.type.kind!=="array"&&p.type.kind!=="string"&&p.type.kind!=="value"?a.error(`Expected argument of type string or array, but found ${qi(p.type)} instead.`):new Rs(p):null}evaluate(n){const a=this.input.evaluate(n);if(typeof a=="string")return[...a].length;if(Array.isArray(a))return a.length;throw new Ar(`Expected value to be of type string or array, but found ${qi(fi(a))} instead.`)}eachChild(n){n(this.input)}outputDefined(){return!1}}const nn=8192;function Ao(u,n){const a=(180+u[0])/360,p=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+u[1]*Math.PI/360)))/360,y=Math.pow(2,n.z);return[Math.round(a*y*nn),Math.round(p*y*nn)]}function ra(u,n){const a=Math.pow(2,n.z);return[(y=(u[0]/nn+n.x)/a,360*y-180),(p=(u[1]/nn+n.y)/a,360/Math.PI*Math.atan(Math.exp((180-360*p)*Math.PI/180))-90)];var p,y}function ws(u,n){u[0]=Math.min(u[0],n[0]),u[1]=Math.min(u[1],n[1]),u[2]=Math.max(u[2],n[0]),u[3]=Math.max(u[3],n[1])}function va(u,n){return!(u[0]<=n[0]||u[2]>=n[2]||u[1]<=n[1]||u[3]>=n[3])}function xa(u,n,a){const p=u[0]-n[0],y=u[1]-n[1],T=u[0]-a[0],E=u[1]-a[1];return p*E-T*y==0&&p*T<=0&&y*E<=0}function ro(u,n,a,p){return(y=[p[0]-a[0],p[1]-a[1]])[0]*(T=[n[0]-u[0],n[1]-u[1]])[1]-y[1]*T[0]!=0&&!(!ba(u,n,a,p)||!ba(a,p,u,n));var y,T}function fl(u,n,a){for(const p of a)for(let y=0;y<p.length-1;++y)if(ro(u,n,p[y],p[y+1]))return!0;return!1}function Lo(u,n,a=!1){let p=!1;for(const M of n)for(let A=0;A<M.length-1;A++){if(xa(u,M[A],M[A+1]))return a;(T=M[A])[1]>(y=u)[1]!=(E=M[A+1])[1]>y[1]&&y[0]<(E[0]-T[0])*(y[1]-T[1])/(E[1]-T[1])+T[0]&&(p=!p)}var y,T,E;return p}function Jl(u,n){for(const a of n)if(Lo(u,a))return!0;return!1}function Ql(u,n){for(const a of u)if(!Lo(a,n))return!1;for(let a=0;a<u.length-1;++a)if(fl(u[a],u[a+1],n))return!1;return!0}function ml(u,n){for(const a of n)if(Ql(u,a))return!0;return!1}function ba(u,n,a,p){const y=p[0]-a[0],T=p[1]-a[1],E=(u[0]-a[0])*T-y*(u[1]-a[1]),M=(n[0]-a[0])*T-y*(n[1]-a[1]);return E>0&&M<0||E<0&&M>0}function na(u,n,a){const p=[];for(let y=0;y<u.length;y++){const T=[];for(let E=0;E<u[y].length;E++){const M=Ao(u[y][E],a);ws(n,M),T.push(M)}p.push(T)}return p}function Ro(u,n,a){const p=[];for(let y=0;y<u.length;y++){const T=na(u[y],n,a);p.push(T)}return p}function eu(u,n,a,p){if(u[0]<a[0]||u[0]>a[2]){const y=.5*p;let T=u[0]-a[0]>y?-p:a[0]-u[0]>y?p:0;T===0&&(T=u[0]-a[2]>y?-p:a[2]-u[0]>y?p:0),u[0]+=T}ws(n,u)}function Us(u,n,a,p){const y=Math.pow(2,p.z)*nn,T=[p.x*nn,p.y*nn],E=[];for(const M of u)for(const A of M){const O=[A.x+T[0],A.y+T[1]];eu(O,n,a,y),E.push(O)}return E}function gl(u,n,a,p){const y=Math.pow(2,p.z)*nn,T=[p.x*nn,p.y*nn],E=[];for(const A of u){const O=[];for(const B of A){const q=[B.x+T[0],B.y+T[1]];ws(n,q),O.push(q)}E.push(O)}if(n[2]-n[0]<=y/2){(M=n)[0]=M[1]=1/0,M[2]=M[3]=-1/0;for(const A of E)for(const O of A)eu(O,n,a,y)}var M;return E}class us{constructor(n,a){this.type=it,this.geojson=n,this.geometries=a}static parse(n,a){if(n.length!==2)return a.error(`'within' expression requires exactly one argument, but found ${n.length-1} instead.`);if(eo(n[1])){const p=n[1];if(p.type==="FeatureCollection"){const y=[];for(const T of p.features){const{type:E,coordinates:M}=T.geometry;E==="Polygon"&&y.push(M),E==="MultiPolygon"&&y.push(...M)}if(y.length)return new us(p,{type:"MultiPolygon",coordinates:y})}else if(p.type==="Feature"){const y=p.geometry.type;if(y==="Polygon"||y==="MultiPolygon")return new us(p,p.geometry)}else if(p.type==="Polygon"||p.type==="MultiPolygon")return new us(p,p)}return a.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(n){if(n.geometry()!=null&&n.canonicalID()!=null){if(n.geometryType()==="Point")return function(a,p){const y=[1/0,1/0,-1/0,-1/0],T=[1/0,1/0,-1/0,-1/0],E=a.canonicalID();if(p.type==="Polygon"){const M=na(p.coordinates,T,E),A=Us(a.geometry(),y,T,E);if(!va(y,T))return!1;for(const O of A)if(!Lo(O,M))return!1}if(p.type==="MultiPolygon"){const M=Ro(p.coordinates,T,E),A=Us(a.geometry(),y,T,E);if(!va(y,T))return!1;for(const O of A)if(!Jl(O,M))return!1}return!0}(n,this.geometries);if(n.geometryType()==="LineString")return function(a,p){const y=[1/0,1/0,-1/0,-1/0],T=[1/0,1/0,-1/0,-1/0],E=a.canonicalID();if(p.type==="Polygon"){const M=na(p.coordinates,T,E),A=gl(a.geometry(),y,T,E);if(!va(y,T))return!1;for(const O of A)if(!Ql(O,M))return!1}if(p.type==="MultiPolygon"){const M=Ro(p.coordinates,T,E),A=gl(a.geometry(),y,T,E);if(!va(y,T))return!1;for(const O of A)if(!ml(O,M))return!1}return!0}(n,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}}let Fa=class{constructor(u=[],n=(a,p)=>a<p?-1:a>p?1:0){if(this.data=u,this.length=this.data.length,this.compare=n,this.length>0)for(let a=(this.length>>1)-1;a>=0;a--)this._down(a)}push(u){this.data.push(u),this._up(this.length++)}pop(){if(this.length===0)return;const u=this.data[0],n=this.data.pop();return--this.length>0&&(this.data[0]=n,this._down(0)),u}peek(){return this.data[0]}_up(u){const{data:n,compare:a}=this,p=n[u];for(;u>0;){const y=u-1>>1,T=n[y];if(a(p,T)>=0)break;n[u]=T,u=y}n[u]=p}_down(u){const{data:n,compare:a}=this,p=this.length>>1,y=n[u];for(;u<p;){let T=1+(u<<1);const E=T+1;if(E<this.length&&a(n[E],n[T])<0&&(T=E),a(n[T],y)>=0)break;n[u]=n[T],u=T}n[u]=y}};function za(u,n,a=0,p=u.length-1,y=yl){for(;p>a;){if(p-a>600){const A=p-a+1,O=n-a+1,B=Math.log(A),q=.5*Math.exp(2*B/3),ee=.5*Math.sqrt(B*q*(A-q)/A)*(O-A/2<0?-1:1);za(u,n,Math.max(a,Math.floor(n-O*q/A+ee)),Math.min(p,Math.floor(n+(A-O)*q/A+ee)),y)}const T=u[n];let E=a,M=p;for(Vs(u,a,n),y(u[p],T)>0&&Vs(u,a,p);E<M;){for(Vs(u,E,M),E++,M--;y(u[E],T)<0;)E++;for(;y(u[M],T)>0;)M--}y(u[a],T)===0?Vs(u,a,M):(M++,Vs(u,M,p)),M<=n&&(a=M+1),n<=M&&(p=M-1)}}function Vs(u,n,a){const p=u[n];u[n]=u[a],u[a]=p}function yl(u,n){return u<n?-1:u>n?1:0}function sa(u,n){if(u.length<=1)return[u];const a=[];let p,y;for(const T of u){const E=_l(T);E!==0&&(T.area=Math.abs(E),y===void 0&&(y=E<0),y===E<0?(p&&a.push(p),p=[T]):p.push(T))}if(p&&a.push(p),n>1)for(let T=0;T<a.length;T++)a[T].length<=n||(za(a[T],n,1,a[T].length-1,Ba),a[T]=a[T].slice(0,n));return a}function Ba(u,n){return n.area-u.area}function _l(u){let n=0;for(let a,p,y=0,T=u.length,E=T-1;y<T;E=y++)a=u[y],p=u[E],n+=(p.x-a.x)*(a.y+p.y);return n}const No=1/298.257223563,$a=No*(2-No),tu=Math.PI/180;class ot{constructor(n){const a=6378.137*tu*1e3,p=Math.cos(n*tu),y=1/(1-$a*(1-p*p)),T=Math.sqrt(y);this.kx=a*T*p,this.ky=a*T*y*(1-$a)}distance(n,a){const p=this.wrap(n[0]-a[0])*this.kx,y=(n[1]-a[1])*this.ky;return Math.sqrt(p*p+y*y)}pointOnLine(n,a){let p,y,T,E,M=1/0;for(let A=0;A<n.length-1;A++){let O=n[A][0],B=n[A][1],q=this.wrap(n[A+1][0]-O)*this.kx,ee=(n[A+1][1]-B)*this.ky,re=0;q===0&&ee===0||(re=(this.wrap(a[0]-O)*this.kx*q+(a[1]-B)*this.ky*ee)/(q*q+ee*ee),re>1?(O=n[A+1][0],B=n[A+1][1]):re>0&&(O+=q/this.kx*re,B+=ee/this.ky*re)),q=this.wrap(a[0]-O)*this.kx,ee=(a[1]-B)*this.ky;const se=q*q+ee*ee;se<M&&(M=se,p=O,y=B,T=A,E=re)}return{point:[p,y],index:T,t:Math.max(0,Math.min(1,E))}}wrap(n){for(;n<-180;)n+=360;for(;n>180;)n-=360;return n}}function ut(u,n){return n[0]-u[0]}function Kt(u){return u[1]-u[0]+1}function bi(u,n){return u[1]>=u[0]&&u[1]<n}function ir(u,n){if(u[0]>u[1])return[null,null];const a=Kt(u);if(n){if(a===2)return[u,null];const y=Math.floor(a/2);return[[u[0],u[0]+y],[u[0]+y,u[1]]]}if(a===1)return[u,null];const p=Math.floor(a/2)-1;return[[u[0],u[0]+p],[u[0]+p+1,u[1]]]}function Zi(u,n){if(!bi(n,u.length))return[1/0,1/0,-1/0,-1/0];const a=[1/0,1/0,-1/0,-1/0];for(let p=n[0];p<=n[1];++p)ws(a,u[p]);return a}function v(u){const n=[1/0,1/0,-1/0,-1/0];for(const a of u)for(const p of a)ws(n,p);return n}function c(u){return u[0]!==-1/0&&u[1]!==-1/0&&u[2]!==1/0&&u[3]!==1/0}function d(u,n,a){if(!c(u)||!c(n))return NaN;let p=0,y=0;return u[2]<n[0]&&(p=n[0]-u[2]),u[0]>n[2]&&(p=u[0]-n[2]),u[1]>n[3]&&(y=u[1]-n[3]),u[3]<n[1]&&(y=n[1]-u[3]),a.distance([0,0],[p,y])}function _(u,n,a){const p=a.pointOnLine(n,u);return a.distance(u,p.point)}function S(u,n,a,p,y){const T=Math.min(_(u,[a,p],y),_(n,[a,p],y)),E=Math.min(_(a,[u,n],y),_(p,[u,n],y));return Math.min(T,E)}function N(u,n,a,p,y){if(!bi(n,u.length)||!bi(p,a.length))return 1/0;let T=1/0;for(let E=n[0];E<n[1];++E){const M=u[E],A=u[E+1];for(let O=p[0];O<p[1];++O){const B=a[O],q=a[O+1];if(ro(M,A,B,q))return 0;T=Math.min(T,S(M,A,B,q,y))}}return T}function U(u,n,a,p,y){if(!bi(n,u.length)||!bi(p,a.length))return NaN;let T=1/0;for(let E=n[0];E<=n[1];++E)for(let M=p[0];M<=p[1];++M)if(T=Math.min(T,y.distance(u[E],a[M])),T===0)return T;return T}function J(u,n,a){if(Lo(u,n,!0))return 0;let p=1/0;for(const y of n){const T=y[0],E=y[y.length-1];if(T!==E&&(p=Math.min(p,_(u,[E,T],a)),p===0))return p;const M=a.pointOnLine(y,u);if(p=Math.min(p,a.distance(u,M.point)),p===0)return p}return p}function ge(u,n,a,p){if(!bi(n,u.length))return NaN;for(let T=n[0];T<=n[1];++T)if(Lo(u[T],a,!0))return 0;let y=1/0;for(let T=n[0];T<n[1];++T){const E=u[T],M=u[T+1];for(const A of a)for(let O=0,B=A.length,q=B-1;O<B;q=O++){const ee=A[q],re=A[O];if(ro(E,M,ee,re))return 0;y=Math.min(y,S(E,M,ee,re,p))}}return y}function Ie(u,n){for(const a of u)for(const p of a)if(Lo(p,n,!0))return!0;return!1}function st(u,n,a,p=1/0){const y=v(u),T=v(n);if(p!==1/0&&d(y,T,a)>=p)return p;if(va(y,T)){if(Ie(u,n))return 0}else if(Ie(n,u))return 0;let E=1/0;for(const M of u)for(let A=0,O=M.length,B=O-1;A<O;B=A++){const q=M[B],ee=M[A];for(const re of n)for(let se=0,ce=re.length,be=ce-1;se<ce;be=se++){const Me=re[be],Xe=re[se];if(ro(q,ee,Me,Xe))return 0;E=Math.min(E,S(q,ee,Me,Xe,a))}}return E}function ht(u,n,a,p,y,T){if(!T)return;const E=d(Zi(p,T),y,a);E<n&&u.push([E,T,[0,0]])}function Pt(u,n,a,p,y,T,E){if(!T||!E)return;const M=d(Zi(p,T),Zi(y,E),a);M<n&&u.push([M,T,E])}function Qt(u,n,a,p,y=1/0){let T=Math.min(p.distance(u[0],a[0][0]),y);if(T===0)return T;const E=new Fa([[0,[0,u.length-1],[0,0]]],ut),M=v(a);for(;E.length>0;){const A=E.pop();if(A[0]>=T)continue;const O=A[1],B=n?50:100;if(Kt(O)<=B){if(!bi(O,u.length))return NaN;if(n){const q=ge(u,O,a,p);if(isNaN(q)||q===0)return q;T=Math.min(T,q)}else for(let q=O[0];q<=O[1];++q){const ee=J(u[q],a,p);if(T=Math.min(T,ee),T===0)return 0}}else{const q=ir(O,n);ht(E,T,p,u,M,q[0]),ht(E,T,p,u,M,q[1])}}return T}function wi(u,n,a,p,y,T=1/0){let E=Math.min(T,y.distance(u[0],a[0]));if(E===0)return E;const M=new Fa([[0,[0,u.length-1],[0,a.length-1]]],ut);for(;M.length>0;){const A=M.pop();if(A[0]>=E)continue;const O=A[1],B=A[2],q=n?50:100,ee=p?50:100;if(Kt(O)<=q&&Kt(B)<=ee){if(!bi(O,u.length)&&bi(B,a.length))return NaN;let re;if(n&&p)re=N(u,O,a,B,y),E=Math.min(E,re);else if(n&&!p){const se=u.slice(O[0],O[1]+1);for(let ce=B[0];ce<=B[1];++ce)if(re=_(a[ce],se,y),E=Math.min(E,re),E===0)return E}else if(!n&&p){const se=a.slice(B[0],B[1]+1);for(let ce=O[0];ce<=O[1];++ce)if(re=_(u[ce],se,y),E=Math.min(E,re),E===0)return E}else re=U(u,O,a,B,y),E=Math.min(E,re)}else{const re=ir(O,n),se=ir(B,p);Pt(M,E,y,u,a,re[0],se[0]),Pt(M,E,y,u,a,re[0],se[1]),Pt(M,E,y,u,a,re[1],se[0]),Pt(M,E,y,u,a,re[1],se[1])}}return E}function Ni(u){return u.type==="MultiPolygon"?u.coordinates.map(n=>({type:"Polygon",coordinates:n})):u.type==="MultiLineString"?u.coordinates.map(n=>({type:"LineString",coordinates:n})):u.type==="MultiPoint"?u.coordinates.map(n=>({type:"Point",coordinates:n})):[u]}class _i{constructor(n,a){this.type=Bt,this.geojson=n,this.geometries=a}static parse(n,a){if(n.length!==2)return a.error(`'distance' expression requires exactly one argument, but found ${n.length-1} instead.`);if(eo(n[1])){const p=n[1];if(p.type==="FeatureCollection")return new _i(p,p.features.map(y=>Ni(y.geometry)).flat());if(p.type==="Feature")return new _i(p,Ni(p.geometry));if("type"in p&&"coordinates"in p)return new _i(p,Ni(p))}return a.error("'distance' expression requires valid geojson object that contains polygon geometry type.")}evaluate(n){if(n.geometry()!=null&&n.canonicalID()!=null){if(n.geometryType()==="Point")return function(a,p){const y=a.geometry(),T=y.flat().map(A=>ra([A.x,A.y],a.canonical));if(y.length===0)return NaN;const E=new ot(T[0][1]);let M=1/0;for(const A of p){switch(A.type){case"Point":M=Math.min(M,wi(T,!1,[A.coordinates],!1,E,M));break;case"LineString":M=Math.min(M,wi(T,!1,A.coordinates,!0,E,M));break;case"Polygon":M=Math.min(M,Qt(T,!1,A.coordinates,E,M))}if(M===0)return M}return M}(n,this.geometries);if(n.geometryType()==="LineString")return function(a,p){const y=a.geometry(),T=y.flat().map(A=>ra([A.x,A.y],a.canonical));if(y.length===0)return NaN;const E=new ot(T[0][1]);let M=1/0;for(const A of p){switch(A.type){case"Point":M=Math.min(M,wi(T,!0,[A.coordinates],!1,E,M));break;case"LineString":M=Math.min(M,wi(T,!0,A.coordinates,!0,E,M));break;case"Polygon":M=Math.min(M,Qt(T,!0,A.coordinates,E,M))}if(M===0)return M}return M}(n,this.geometries);if(n.geometryType()==="Polygon")return function(a,p){const y=a.geometry();if(y.length===0||y[0].length===0)return NaN;const T=sa(y,0).map(A=>A.map(O=>O.map(B=>ra([B.x,B.y],a.canonical)))),E=new ot(T[0][0][0][1]);let M=1/0;for(const A of p)for(const O of T){switch(A.type){case"Point":M=Math.min(M,Qt([A.coordinates],!1,O,E,M));break;case"LineString":M=Math.min(M,Qt(A.coordinates,!0,O,E,M));break;case"Polygon":M=Math.min(M,st(O,A.coordinates,E,M))}if(M===0)return M}return M}(n,this.geometries)}return NaN}eachChild(){}outputDefined(){return!0}}class yi{constructor(n){this.type=ri,this.key=n}static parse(n,a){if(n.length!==2)return a.error(`Expected 1 argument, but found ${n.length-1} instead.`);const p=n[1];return p==null?a.error("Global state property must be defined."):typeof p!="string"?a.error(`Global state property must be string, but found ${typeof n[1]} instead.`):new yi(p)}evaluate(n){var a;const p=(a=n.globals)===null||a===void 0?void 0:a.globalState;return p&&Object.keys(p).length!==0?je(p,this.key):null}eachChild(){}outputDefined(){return!1}}const cr={"==":ea,"!=":_a,">":Ls,"<":ta,">=":zn,"<=":Kl,array:Dn,at:bn,boolean:Dn,case:Mr,coalesce:Kn,collator:go,format:Co,image:ia,in:Hn,"index-of":fo,interpolate:Qr,"interpolate-hcl":Qr,"interpolate-lab":Qr,length:Rs,let:kn,literal:hn,match:bs,number:Dn,"number-format":Da,object:Dn,slice:jn,step:Ko,string:Dn,"to-boolean":Cs,"to-color":Cs,"to-number":Cs,"to-string":Cs,var:Fn,within:us,distance:_i,"global-state":yi};class hr{constructor(n,a,p,y){this.name=n,this.type=a,this._evaluate=p,this.args=y}evaluate(n){return this._evaluate(n,this.args)}eachChild(n){this.args.forEach(n)}outputDefined(){return!1}static parse(n,a){const p=n[0],y=hr.definitions[p];if(!y)return a.error(`Unknown expression "${p}". If you wanted a literal array, use ["literal", [...]].`,0);const T=Array.isArray(y)?y[0]:y.type,E=Array.isArray(y)?[[y[1],y[2]]]:y.overloads,M=E.filter(([O])=>!Array.isArray(O)||O.length===n.length-1);let A=null;for(const[O,B]of M){A=new Ho(a.registry,no,a.path,null,a.scope);const q=[];let ee=!1;for(let re=1;re<n.length;re++){const se=n[re],ce=Array.isArray(O)?O[re-1]:O.type,be=A.parse(se,1+q.length,ce);if(!be){ee=!0;break}q.push(be)}if(!ee)if(Array.isArray(O)&&O.length!==q.length)A.error(`Expected ${O.length} arguments, but found ${q.length} instead.`);else{for(let re=0;re<q.length;re++){const se=Array.isArray(O)?O[re]:O.type,ce=q[re];A.concat(re+1).checkSubtype(se,ce.type)}if(A.errors.length===0)return new hr(p,T,B,q)}}if(M.length===1)a.errors.push(...A.errors);else{const O=(M.length?M:E).map(([q])=>{return ee=q,Array.isArray(ee)?`(${ee.map(qi).join(", ")})`:`(${qi(ee.type)}...)`;var ee}).join(" | "),B=[];for(let q=1;q<n.length;q++){const ee=a.parse(n[q],1+B.length);if(!ee)return null;B.push(qi(ee.type))}a.error(`Expected arguments of type ${O}, but found (${B.join(", ")}) instead.`)}return null}static register(n,a){hr.definitions=a;for(const p in a)n[p]=hr}}function dn(u,[n,a,p,y]){n=n.evaluate(u),a=a.evaluate(u),p=p.evaluate(u);const T=y?y.evaluate(u):1,E=Ri(n,a,p,T);if(E)throw new Ar(E);return new si(n/255,a/255,p/255,T,!1)}function pn(u,n){return u in n}function Gn(u,n){const a=n[u];return a===void 0?null:a}function Un(u){return{type:u}}function no(u){if(u instanceof Fn)return no(u.boundExpression);if(u instanceof hr&&u.name==="error"||u instanceof go||u instanceof us||u instanceof _i||u instanceof yi)return!1;const n=u instanceof Cs||u instanceof Dn;let a=!0;return u.eachChild(p=>{a=n?a&&no(p):a&&p instanceof hn}),!!a&&yo(u)&&cs(u,["zoom","heatmap-density","elevation","line-progress","accumulated","is-supported-script"])}function yo(u){if(u instanceof hr&&(u.name==="get"&&u.args.length===1||u.name==="feature-state"||u.name==="has"&&u.args.length===1||u.name==="properties"||u.name==="geometry-type"||u.name==="id"||/^filter-/.test(u.name))||u instanceof us||u instanceof _i)return!1;let n=!0;return u.eachChild(a=>{n&&!yo(a)&&(n=!1)}),n}function Ns(u){if(u instanceof hr&&u.name==="feature-state")return!1;let n=!0;return u.eachChild(a=>{n&&!Ns(a)&&(n=!1)}),n}function cs(u,n){if(u instanceof hr&&n.indexOf(u.name)>=0)return!1;let a=!0;return u.eachChild(p=>{a&&!cs(p,n)&&(a=!1)}),a}function ja(u){return{result:"success",value:u}}function Os(u){return{result:"error",value:u}}function qs(u){return u["property-type"]==="data-driven"||u["property-type"]==="cross-faded-data-driven"}function Ga(u){return!!u.expression&&u.expression.parameters.indexOf("zoom")>-1}function Ua(u){return!!u.expression&&u.expression.interpolated}function tr(u){return u instanceof Number?"number":u instanceof String?"string":u instanceof Boolean?"boolean":Array.isArray(u)?"array":u===null?"null":typeof u}function _o(u){return typeof u=="object"&&u!==null&&!Array.isArray(u)&&fi(u)===Er}function vl(u){return u}function _p(u,n){const a=u.stops&&typeof u.stops[0][0]=="object",p=a||!(a||u.property!==void 0),y=u.type||(Ua(n)?"exponential":"interval"),T=function(B){switch(B.type){case"color":return si.parse;case"padding":return ji.parse;case"numberArray":return or.parse;case"colorArray":return rr.parse;default:return null}}(n);if(T&&((u=Kr({},u)).stops&&(u.stops=u.stops.map(B=>[B[0],T(B[1])])),u.default=T(u.default?u.default:n.default)),u.colorSpace&&(E=u.colorSpace)!=="rgb"&&E!=="hcl"&&E!=="lab")throw new Error(`Unknown color space: "${u.colorSpace}"`);var E;const M=function(B){switch(B){case"exponential":return vp;case"interval":return Km;case"categorical":return Hm;case"identity":return xp;default:throw new Error(`Unknown function type "${B}"`)}}(y);let A,O;if(y==="categorical"){A=Object.create(null);for(const B of u.stops)A[B[0]]=B[1];O=typeof u.stops[0][0]}if(a){const B={},q=[];for(let se=0;se<u.stops.length;se++){const ce=u.stops[se],be=ce[0].zoom;B[be]===void 0&&(B[be]={zoom:be,type:u.type,property:u.property,default:u.default,stops:[]},q.push(be)),B[be].stops.push([ce[0].value,ce[1]])}const ee=[];for(const se of q)ee.push([B[se].zoom,_p(B[se],n)]);const re={name:"linear"};return{kind:"composite",interpolationType:re,interpolationFactor:Qr.interpolationFactor.bind(void 0,re),zoomStops:ee.map(se=>se[0]),evaluate:({zoom:se},ce)=>vp({stops:ee,base:u.base},n,se).evaluate(se,ce)}}if(p){const B=y==="exponential"?{name:"exponential",base:u.base!==void 0?u.base:1}:null;return{kind:"camera",interpolationType:B,interpolationFactor:Qr.interpolationFactor.bind(void 0,B),zoomStops:u.stops.map(q=>q[0]),evaluate:({zoom:q})=>M(u,n,q,A,O)}}return{kind:"source",evaluate(B,q){const ee=q&&q.properties?q.properties[u.property]:void 0;return ee===void 0?zu(u.default,n.default):M(u,n,ee,A,O)}}}function zu(u,n,a){return u!==void 0?u:n!==void 0?n:a!==void 0?a:void 0}function Hm(u,n,a,p,y){return zu(typeof a===y?p[a]:void 0,u.default,n.default)}function Km(u,n,a){if(tr(a)!=="number")return zu(u.default,n.default);const p=u.stops.length;if(p===1||a<=u.stops[0][0])return u.stops[0][1];if(a>=u.stops[p-1][0])return u.stops[p-1][1];const y=mo(u.stops.map(T=>T[0]),a);return u.stops[y][1]}function vp(u,n,a){const p=u.base!==void 0?u.base:1;if(tr(a)!=="number")return zu(u.default,n.default);const y=u.stops.length;if(y===1||a<=u.stops[0][0])return u.stops[0][1];if(a>=u.stops[y-1][0])return u.stops[y-1][1];const T=mo(u.stops.map(B=>B[0]),a),E=function(B,q,ee,re){const se=re-ee,ce=B-ee;return se===0?0:q===1?ce/se:(Math.pow(q,ce)-1)/(Math.pow(q,se)-1)}(a,p,u.stops[T][0],u.stops[T+1][0]),M=u.stops[T][1],A=u.stops[T+1][1],O=Fr[n.type]||vl;return typeof M.evaluate=="function"?{evaluate(...B){const q=M.evaluate.apply(void 0,B),ee=A.evaluate.apply(void 0,B);if(q!==void 0&&ee!==void 0)return O(q,ee,E,u.colorSpace)}}:O(M,A,E,u.colorSpace)}function xp(u,n,a){switch(n.type){case"color":a=si.parse(a);break;case"formatted":a=ei.fromString(a.toString());break;case"resolvedImage":a=Pn.fromString(a.toString());break;case"padding":a=ji.parse(a);break;case"colorArray":a=rr.parse(a);break;case"numberArray":a=or.parse(a);break;default:tr(a)===n.type||n.type==="enum"&&n.values[a]||(a=void 0)}return zu(a,u.default,n.default)}hr.register(cr,{error:[{kind:"error"},[xi],(u,[n])=>{throw new Ar(n.evaluate(u))}],typeof:[xi,[ri],(u,[n])=>qi(fi(n.evaluate(u)))],"to-rgba":[Mn(Bt,4),[Wi],(u,[n])=>{const[a,p,y,T]=n.evaluate(u).rgb;return[255*a,255*p,255*y,T]}],rgb:[Wi,[Bt,Bt,Bt],dn],rgba:[Wi,[Bt,Bt,Bt,Bt],dn],has:{type:it,overloads:[[[xi],(u,[n])=>pn(n.evaluate(u),u.properties())],[[xi,Er],(u,[n,a])=>pn(n.evaluate(u),a.evaluate(u))]]},get:{type:ri,overloads:[[[xi],(u,[n])=>Gn(n.evaluate(u),u.properties())],[[xi,Er],(u,[n,a])=>Gn(n.evaluate(u),a.evaluate(u))]]},"feature-state":[ri,[xi],(u,[n])=>Gn(n.evaluate(u),u.featureState||{})],properties:[Er,[],u=>u.properties()],"geometry-type":[xi,[],u=>u.geometryType()],id:[ri,[],u=>u.id()],zoom:[Bt,[],u=>u.globals.zoom],"heatmap-density":[Bt,[],u=>u.globals.heatmapDensity||0],elevation:[Bt,[],u=>u.globals.elevation||0],"line-progress":[Bt,[],u=>u.globals.lineProgress||0],accumulated:[ri,[],u=>u.globals.accumulated===void 0?null:u.globals.accumulated],"+":[Bt,Un(Bt),(u,n)=>{let a=0;for(const p of n)a+=p.evaluate(u);return a}],"*":[Bt,Un(Bt),(u,n)=>{let a=1;for(const p of n)a*=p.evaluate(u);return a}],"-":{type:Bt,overloads:[[[Bt,Bt],(u,[n,a])=>n.evaluate(u)-a.evaluate(u)],[[Bt],(u,[n])=>-n.evaluate(u)]]},"/":[Bt,[Bt,Bt],(u,[n,a])=>n.evaluate(u)/a.evaluate(u)],"%":[Bt,[Bt,Bt],(u,[n,a])=>n.evaluate(u)%a.evaluate(u)],ln2:[Bt,[],()=>Math.LN2],pi:[Bt,[],()=>Math.PI],e:[Bt,[],()=>Math.E],"^":[Bt,[Bt,Bt],(u,[n,a])=>Math.pow(n.evaluate(u),a.evaluate(u))],sqrt:[Bt,[Bt],(u,[n])=>Math.sqrt(n.evaluate(u))],log10:[Bt,[Bt],(u,[n])=>Math.log(n.evaluate(u))/Math.LN10],ln:[Bt,[Bt],(u,[n])=>Math.log(n.evaluate(u))],log2:[Bt,[Bt],(u,[n])=>Math.log(n.evaluate(u))/Math.LN2],sin:[Bt,[Bt],(u,[n])=>Math.sin(n.evaluate(u))],cos:[Bt,[Bt],(u,[n])=>Math.cos(n.evaluate(u))],tan:[Bt,[Bt],(u,[n])=>Math.tan(n.evaluate(u))],asin:[Bt,[Bt],(u,[n])=>Math.asin(n.evaluate(u))],acos:[Bt,[Bt],(u,[n])=>Math.acos(n.evaluate(u))],atan:[Bt,[Bt],(u,[n])=>Math.atan(n.evaluate(u))],min:[Bt,Un(Bt),(u,n)=>Math.min(...n.map(a=>a.evaluate(u)))],max:[Bt,Un(Bt),(u,n)=>Math.max(...n.map(a=>a.evaluate(u)))],abs:[Bt,[Bt],(u,[n])=>Math.abs(n.evaluate(u))],round:[Bt,[Bt],(u,[n])=>{const a=n.evaluate(u);return a<0?-Math.round(-a):Math.round(a)}],floor:[Bt,[Bt],(u,[n])=>Math.floor(n.evaluate(u))],ceil:[Bt,[Bt],(u,[n])=>Math.ceil(n.evaluate(u))],"filter-==":[it,[xi,ri],(u,[n,a])=>u.properties()[n.value]===a.value],"filter-id-==":[it,[ri],(u,[n])=>u.id()===n.value],"filter-type-==":[it,[xi],(u,[n])=>u.geometryType()===n.value],"filter-<":[it,[xi,ri],(u,[n,a])=>{const p=u.properties()[n.value],y=a.value;return typeof p==typeof y&&p<y}],"filter-id-<":[it,[ri],(u,[n])=>{const a=u.id(),p=n.value;return typeof a==typeof p&&a<p}],"filter->":[it,[xi,ri],(u,[n,a])=>{const p=u.properties()[n.value],y=a.value;return typeof p==typeof y&&p>y}],"filter-id->":[it,[ri],(u,[n])=>{const a=u.id(),p=n.value;return typeof a==typeof p&&a>p}],"filter-<=":[it,[xi,ri],(u,[n,a])=>{const p=u.properties()[n.value],y=a.value;return typeof p==typeof y&&p<=y}],"filter-id-<=":[it,[ri],(u,[n])=>{const a=u.id(),p=n.value;return typeof a==typeof p&&a<=p}],"filter->=":[it,[xi,ri],(u,[n,a])=>{const p=u.properties()[n.value],y=a.value;return typeof p==typeof y&&p>=y}],"filter-id->=":[it,[ri],(u,[n])=>{const a=u.id(),p=n.value;return typeof a==typeof p&&a>=p}],"filter-has":[it,[ri],(u,[n])=>n.value in u.properties()],"filter-has-id":[it,[],u=>u.id()!==null&&u.id()!==void 0],"filter-type-in":[it,[Mn(xi)],(u,[n])=>n.value.indexOf(u.geometryType())>=0],"filter-id-in":[it,[Mn(ri)],(u,[n])=>n.value.indexOf(u.id())>=0],"filter-in-small":[it,[xi,Mn(ri)],(u,[n,a])=>a.value.indexOf(u.properties()[n.value])>=0],"filter-in-large":[it,[xi,Mn(ri)],(u,[n,a])=>function(p,y,T,E){for(;T<=E;){const M=T+E>>1;if(y[M]===p)return!0;y[M]>p?E=M-1:T=M+1}return!1}(u.properties()[n.value],a.value,0,a.value.length-1)],all:{type:it,overloads:[[[it,it],(u,[n,a])=>n.evaluate(u)&&a.evaluate(u)],[Un(it),(u,n)=>{for(const a of n)if(!a.evaluate(u))return!1;return!0}]]},any:{type:it,overloads:[[[it,it],(u,[n,a])=>n.evaluate(u)||a.evaluate(u)],[Un(it),(u,n)=>{for(const a of n)if(a.evaluate(u))return!0;return!1}]]},"!":[it,[it],(u,[n])=>!n.evaluate(u)],"is-supported-script":[it,[xi],(u,[n])=>{const a=u.globals&&u.globals.isSupportedScript;return!a||a(n.evaluate(u))}],upcase:[xi,[xi],(u,[n])=>n.evaluate(u).toUpperCase()],downcase:[xi,[xi],(u,[n])=>n.evaluate(u).toLowerCase()],concat:[xi,Un(ri),(u,n)=>n.map(a=>to(a.evaluate(u))).join("")],"resolved-locale":[xi,[Wr],(u,[n])=>n.evaluate(u).resolvedLocale()]});class wc{constructor(n,a){this.expression=n,this._warningHistory={},this._evaluator=new Xo,this._defaultValue=a?function(p){if(p.type==="color"&&_o(p.default))return new si(0,0,0,0);switch(p.type){case"color":return si.parse(p.default)||null;case"padding":return ji.parse(p.default)||null;case"numberArray":return or.parse(p.default)||null;case"colorArray":return rr.parse(p.default)||null;case"variableAnchorOffsetCollection":return ui.parse(p.default)||null;case"projectionDefinition":return Vi.parse(p.default)||null;default:return p.default===void 0?null:p.default}}(a):null,this._enumValues=a&&a.type==="enum"?a.values:null}evaluateWithoutErrorHandling(n,a,p,y,T,E){return this._evaluator.globals=n,this._evaluator.feature=a,this._evaluator.featureState=p,this._evaluator.canonical=y,this._evaluator.availableImages=T||null,this._evaluator.formattedSection=E,this.expression.evaluate(this._evaluator)}evaluate(n,a,p,y,T,E){this._evaluator.globals=n,this._evaluator.feature=a||null,this._evaluator.featureState=p||null,this._evaluator.canonical=y,this._evaluator.availableImages=T||null,this._evaluator.formattedSection=E||null;try{const M=this.expression.evaluate(this._evaluator);if(M==null||typeof M=="number"&&M!=M)return this._defaultValue;if(this._enumValues&&!(M in this._enumValues))throw new Ar(`Expected value to be one of ${Object.keys(this._enumValues).map(A=>JSON.stringify(A)).join(", ")}, but found ${JSON.stringify(M)} instead.`);return M}catch(M){return this._warningHistory[M.message]||(this._warningHistory[M.message]=!0,typeof console<"u"&&console.warn(M.message)),this._defaultValue}}}function Tc(u){return Array.isArray(u)&&u.length>0&&typeof u[0]=="string"&&u[0]in cr}function Ec(u,n){const a=new Ho(cr,no,[],n?function(y){const T={color:Wi,string:xi,number:Bt,enum:xi,boolean:it,formatted:vn,padding:Ai,numberArray:Yr,colorArray:Sn,projectionDefinition:Dr,resolvedImage:gr,variableAnchorOffsetCollection:Xn};return y.type==="array"?Mn(T[y.value]||ri,y.length):T[y.type]}(n):void 0),p=a.parse(u,void 0,void 0,void 0,n&&n.type==="string"?{typeAnnotation:"coerce"}:void 0);return p?ja(new wc(p,n)):Os(a.errors)}class Bu{constructor(n,a){this.kind=n,this._styleExpression=a,this.isStateDependent=n!=="constant"&&!Ns(a.expression),this.globalStateRefs=ru(a.expression)}evaluateWithoutErrorHandling(n,a,p,y,T,E){return this._styleExpression.evaluateWithoutErrorHandling(n,a,p,y,T,E)}evaluate(n,a,p,y,T,E){return this._styleExpression.evaluate(n,a,p,y,T,E)}}class Ic{constructor(n,a,p,y){this.kind=n,this.zoomStops=p,this._styleExpression=a,this.isStateDependent=n!=="camera"&&!Ns(a.expression),this.globalStateRefs=ru(a.expression),this.interpolationType=y}evaluateWithoutErrorHandling(n,a,p,y,T,E){return this._styleExpression.evaluateWithoutErrorHandling(n,a,p,y,T,E)}evaluate(n,a,p,y,T,E){return this._styleExpression.evaluate(n,a,p,y,T,E)}interpolationFactor(n,a,p){return this.interpolationType?Qr.interpolationFactor(this.interpolationType,n,a,p):0}}function kh(u,n){const a=Ec(u,n);if(a.result==="error")return a;const p=a.value.expression,y=yo(p);if(!y&&!qs(n))return Os([new Sr("","data expressions not supported")]);const T=cs(p,["zoom"]);if(!T&&!Ga(n))return Os([new Sr("","zoom expressions not supported")]);const E=iu(p);return E||T?E instanceof Sr?Os([E]):E instanceof Qr&&!Ua(n)?Os([new Sr("",'"interpolate" expressions cannot be used with this property')]):ja(E?new Ic(y?"camera":"composite",a.value,E.labels,E instanceof Qr?E.interpolation:void 0):new Bu(y?"constant":"source",a.value)):Os([new Sr("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')])}class $u{constructor(n,a){this._parameters=n,this._specification=a,Kr(this,_p(this._parameters,this._specification))}static deserialize(n){return new $u(n._parameters,n._specification)}static serialize(n){return{_parameters:n._parameters,_specification:n._specification}}}function iu(u){let n=null;if(u instanceof kn)n=iu(u.result);else if(u instanceof Kn){for(const a of u.args)if(n=iu(a),n)break}else(u instanceof Ko||u instanceof Qr)&&u.input instanceof hr&&u.input.name==="zoom"&&(n=u);return n instanceof Sr||u.eachChild(a=>{const p=iu(a);p instanceof Sr?n=p:!n&&p?n=new Sr("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):n&&p&&n!==p&&(n=new Sr("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),n}function ru(u,n=new Set){return u instanceof yi&&n.add(u.key),u.eachChild(a=>{ru(a,n)}),n}function ju(u){if(u===!0||u===!1)return!0;if(!Array.isArray(u)||u.length===0)return!1;switch(u[0]){case"has":return u.length>=2&&u[1]!=="$id"&&u[1]!=="$type";case"in":return u.length>=3&&(typeof u[1]!="string"||Array.isArray(u[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return u.length!==3||Array.isArray(u[1])||Array.isArray(u[2]);case"any":case"all":for(const n of u.slice(1))if(!ju(n)&&typeof n!="boolean")return!1;return!0;default:return!0}}const Ch={type:"boolean",default:!1,transition:!1,"property-type":"data-driven",expression:{interpolated:!1,parameters:["zoom","feature"]}};function Va(u){if(u==null)return{filter:()=>!0,needGeometry:!1,getGlobalStateRefs:()=>new Set};ju(u)||(u=Sc(u));const n=Ec(u,Ch);if(n.result==="error")throw new Error(n.value.map(a=>`${a.key}: ${a.message}`).join(", "));return{filter:(a,p,y)=>n.value.evaluate(a,p,{},y),needGeometry:bp(u),getGlobalStateRefs:()=>ru(n.value.expression)}}function Jm(u,n){return u<n?-1:u>n?1:0}function bp(u){if(!Array.isArray(u))return!1;if(u[0]==="within"||u[0]==="distance")return!0;for(let n=1;n<u.length;n++)if(bp(u[n]))return!0;return!1}function Sc(u){if(!u)return!0;const n=u[0];return u.length<=1?n!=="any":n==="=="?Ah(u[1],u[2],"=="):n==="!="?Gu(Ah(u[1],u[2],"==")):n==="<"||n===">"||n==="<="||n===">="?Ah(u[1],u[2],n):n==="any"?(a=u.slice(1),["any"].concat(a.map(Sc))):n==="all"?["all"].concat(u.slice(1).map(Sc)):n==="none"?["all"].concat(u.slice(1).map(Sc).map(Gu)):n==="in"?wp(u[1],u.slice(2)):n==="!in"?Gu(wp(u[1],u.slice(2))):n==="has"?Tp(u[1]):n!=="!has"||Gu(Tp(u[1]));var a}function Ah(u,n,a){switch(u){case"$type":return[`filter-type-${a}`,n];case"$id":return[`filter-id-${a}`,n];default:return[`filter-${a}`,u,n]}}function wp(u,n){if(n.length===0)return!1;switch(u){case"$type":return["filter-type-in",["literal",n]];case"$id":return["filter-id-in",["literal",n]];default:return n.length>200&&!n.some(a=>typeof a!=typeof n[0])?["filter-in-large",u,["literal",n.sort(Jm)]]:["filter-in-small",u,["literal",n]]}}function Tp(u){switch(u){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",u]}}function Gu(u){return["!",u]}function Mc(u){const n=typeof u;if(n==="number"||n==="boolean"||n==="string"||u==null)return JSON.stringify(u);if(Array.isArray(u)){let y="[";for(const T of u)y+=`${Mc(T)},`;return`${y}]`}const a=Object.keys(u).sort();let p="{";for(let y=0;y<a.length;y++)p+=`${JSON.stringify(a[y])}:${Mc(u[a[y]])},`;return`${p}}`}function Pc(u){let n="";for(const a of Ut)n+=`/${Mc(u[a])}`;return n}function Ep(u){const n=u.value;return n?[new Rt(u.key,n,"constants have been deprecated as of v8")]:[]}function fn(u){return u instanceof Number||u instanceof String||u instanceof Boolean?u.valueOf():u}function qa(u){if(Array.isArray(u))return u.map(qa);if(u instanceof Object&&!(u instanceof Number||u instanceof String||u instanceof Boolean)){const n={};for(const a in u)n[a]=qa(u[a]);return n}return fn(u)}function vo(u){const n=u.key,a=u.value,p=u.valueSpec||{},y=u.objectElementValidators||{},T=u.style,E=u.styleSpec,M=u.validateSpec;let A=[];const O=tr(a);if(O!=="object")return[new Rt(n,a,`object expected, ${O} found`)];for(const B in a){const q=B.split(".")[0],ee=je(p,q)||p["*"];let re;if(je(y,q))re=y[q];else if(je(p,q))re=M;else if(y["*"])re=y["*"];else{if(!p["*"]){A.push(new Rt(n,a[B],`unknown property "${B}"`));continue}re=M}A=A.concat(re({key:(n&&`${n}.`)+B,value:a[B],valueSpec:ee,style:T,styleSpec:E,object:a,objectKey:B,validateSpec:M},a))}for(const B in p)y[B]||p[B].required&&p[B].default===void 0&&a[B]===void 0&&A.push(new Rt(n,a,`missing required property "${B}"`));return A}function kc(u){const n=u.value,a=u.valueSpec,p=u.style,y=u.styleSpec,T=u.key,E=u.arrayElementValidator||u.validateSpec;if(tr(n)!=="array")return[new Rt(T,n,`array expected, ${tr(n)} found`)];if(a.length&&n.length!==a.length)return[new Rt(T,n,`array length ${a.length} expected, length ${n.length} found`)];if(a["min-length"]&&n.length<a["min-length"])return[new Rt(T,n,`array length at least ${a["min-length"]} expected, length ${n.length} found`)];let M={type:a.value,values:a.values};y.$version<7&&(M.function=a.function),tr(a.value)==="object"&&(M=a.value);let A=[];for(let O=0;O<n.length;O++)A=A.concat(E({array:n,arrayIndex:O,value:n[O],valueSpec:M,validateSpec:u.validateSpec,style:p,styleSpec:y,key:`${T}[${O}]`}));return A}function Uu(u){const n=u.key,a=u.value,p=u.valueSpec;let y=tr(a);return y==="number"&&a!=a&&(y="NaN"),y!=="number"?[new Rt(n,a,`number expected, ${y} found`)]:"minimum"in p&&a<p.minimum?[new Rt(n,a,`${a} is less than the minimum value ${p.minimum}`)]:"maximum"in p&&a>p.maximum?[new Rt(n,a,`${a} is greater than the maximum value ${p.maximum}`)]:[]}function nu(u){const n=u.valueSpec,a=fn(u.value.type);let p,y,T,E={};const M=a!=="categorical"&&u.value.property===void 0,A=!M,O=tr(u.value.stops)==="array"&&tr(u.value.stops[0])==="array"&&tr(u.value.stops[0][0])==="object",B=vo({key:u.key,value:u.value,valueSpec:u.styleSpec.function,validateSpec:u.validateSpec,style:u.style,styleSpec:u.styleSpec,objectElementValidators:{stops:function(re){if(a==="identity")return[new Rt(re.key,re.value,'identity function may not have a "stops" property')];let se=[];const ce=re.value;return se=se.concat(kc({key:re.key,value:ce,valueSpec:re.valueSpec,validateSpec:re.validateSpec,style:re.style,styleSpec:re.styleSpec,arrayElementValidator:q})),tr(ce)==="array"&&ce.length===0&&se.push(new Rt(re.key,ce,"array must have at least one stop")),se},default:function(re){return re.validateSpec({key:re.key,value:re.value,valueSpec:n,validateSpec:re.validateSpec,style:re.style,styleSpec:re.styleSpec})}}});return a==="identity"&&M&&B.push(new Rt(u.key,u.value,'missing required property "property"')),a==="identity"||u.value.stops||B.push(new Rt(u.key,u.value,'missing required property "stops"')),a==="exponential"&&u.valueSpec.expression&&!Ua(u.valueSpec)&&B.push(new Rt(u.key,u.value,"exponential functions not supported")),u.styleSpec.$version>=8&&(A&&!qs(u.valueSpec)?B.push(new Rt(u.key,u.value,"property functions not supported")):M&&!Ga(u.valueSpec)&&B.push(new Rt(u.key,u.value,"zoom functions not supported"))),a!=="categorical"&&!O||u.value.property!==void 0||B.push(new Rt(u.key,u.value,'"property" property is required')),B;function q(re){let se=[];const ce=re.value,be=re.key;if(tr(ce)!=="array")return[new Rt(be,ce,`array expected, ${tr(ce)} found`)];if(ce.length!==2)return[new Rt(be,ce,`array length 2 expected, length ${ce.length} found`)];if(O){if(tr(ce[0])!=="object")return[new Rt(be,ce,`object expected, ${tr(ce[0])} found`)];if(ce[0].zoom===void 0)return[new Rt(be,ce,"object stop key must have zoom")];if(ce[0].value===void 0)return[new Rt(be,ce,"object stop key must have value")];if(T&&T>fn(ce[0].zoom))return[new Rt(be,ce[0].zoom,"stop zoom values must appear in ascending order")];fn(ce[0].zoom)!==T&&(T=fn(ce[0].zoom),y=void 0,E={}),se=se.concat(vo({key:`${be}[0]`,value:ce[0],valueSpec:{zoom:{}},validateSpec:re.validateSpec,style:re.style,styleSpec:re.styleSpec,objectElementValidators:{zoom:Uu,value:ee}}))}else se=se.concat(ee({key:`${be}[0]`,value:ce[0],validateSpec:re.validateSpec,style:re.style,styleSpec:re.styleSpec},ce));return Tc(qa(ce[1]))?se.concat([new Rt(`${be}[1]`,ce[1],"expressions are not allowed in function stops.")]):se.concat(re.validateSpec({key:`${be}[1]`,value:ce[1],valueSpec:n,validateSpec:re.validateSpec,style:re.style,styleSpec:re.styleSpec}))}function ee(re,se){const ce=tr(re.value),be=fn(re.value),Me=re.value!==null?re.value:se;if(p){if(ce!==p)return[new Rt(re.key,Me,`${ce} stop domain type must match previous stop domain type ${p}`)]}else p=ce;if(ce!=="number"&&ce!=="string"&&ce!=="boolean")return[new Rt(re.key,Me,"stop domain value must be a number, string, or boolean")];if(ce!=="number"&&a!=="categorical"){let Xe=`number expected, ${ce} found`;return qs(n)&&a===void 0&&(Xe+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new Rt(re.key,Me,Xe)]}return a!=="categorical"||ce!=="number"||isFinite(be)&&Math.floor(be)===be?a!=="categorical"&&ce==="number"&&y!==void 0&&be<y?[new Rt(re.key,Me,"stop domain values must appear in ascending order")]:(y=be,a==="categorical"&&be in E?[new Rt(re.key,Me,"stop domain values must be unique")]:(E[be]=!0,[])):[new Rt(re.key,Me,`integer expected, found ${be}`)]}}function su(u){const n=(u.expressionContext==="property"?kh:Ec)(qa(u.value),u.valueSpec);if(n.result==="error")return n.value.map(p=>new Rt(`${u.key}${p.key}`,u.value,p.message));const a=n.value.expression||n.value._styleExpression.expression;if(u.expressionContext==="property"&&u.propertyKey==="text-font"&&!a.outputDefined())return[new Rt(u.key,u.value,`Invalid data expression for "${u.propertyKey}". Output values must be contained as literals within the expression.`)];if(u.expressionContext==="property"&&u.propertyType==="layout"&&!Ns(a))return[new Rt(u.key,u.value,'"feature-state" data expressions are not supported with layout properties.')];if(u.expressionContext==="filter"&&!Ns(a))return[new Rt(u.key,u.value,'"feature-state" data expressions are not supported with filters.')];if(u.expressionContext&&u.expressionContext.indexOf("cluster")===0){if(!cs(a,["zoom","feature-state"]))return[new Rt(u.key,u.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(u.expressionContext==="cluster-initial"&&!yo(a))return[new Rt(u.key,u.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function Lh(u){const n=u.key,a=u.value,p=tr(a);return p!=="string"?[new Rt(n,a,`color expected, ${p} found`)]:si.parse(String(a))?[]:[new Rt(n,a,`color expected, "${a}" found`)]}function Vu(u){const n=u.key,a=u.value,p=u.valueSpec,y=[];return Array.isArray(p.values)?p.values.indexOf(fn(a))===-1&&y.push(new Rt(n,a,`expected one of [${p.values.join(", ")}], ${JSON.stringify(a)} found`)):Object.keys(p.values).indexOf(fn(a))===-1&&y.push(new Rt(n,a,`expected one of [${Object.keys(p.values).join(", ")}], ${JSON.stringify(a)} found`)),y}function Rh(u){return ju(qa(u.value))?su(Kr({},u,{expressionContext:"filter",valueSpec:{value:"boolean"}})):Ip(u)}function Ip(u){const n=u.value,a=u.key;if(tr(n)!=="array")return[new Rt(a,n,`array expected, ${tr(n)} found`)];const p=u.styleSpec;let y,T=[];if(n.length<1)return[new Rt(a,n,"filter array must have at least 1 element")];switch(T=T.concat(Vu({key:`${a}[0]`,value:n[0],valueSpec:p.filter_operator,style:u.style,styleSpec:u.styleSpec})),fn(n[0])){case"<":case"<=":case">":case">=":n.length>=2&&fn(n[1])==="$type"&&T.push(new Rt(a,n,`"$type" cannot be use with operator "${n[0]}"`));case"==":case"!=":n.length!==3&&T.push(new Rt(a,n,`filter array for operator "${n[0]}" must have 3 elements`));case"in":case"!in":n.length>=2&&(y=tr(n[1]),y!=="string"&&T.push(new Rt(`${a}[1]`,n[1],`string expected, ${y} found`)));for(let E=2;E<n.length;E++)y=tr(n[E]),fn(n[1])==="$type"?T=T.concat(Vu({key:`${a}[${E}]`,value:n[E],valueSpec:p.geometry_type,style:u.style,styleSpec:u.styleSpec})):y!=="string"&&y!=="number"&&y!=="boolean"&&T.push(new Rt(`${a}[${E}]`,n[E],`string, number, or boolean expected, ${y} found`));break;case"any":case"all":case"none":for(let E=1;E<n.length;E++)T=T.concat(Ip({key:`${a}[${E}]`,value:n[E],style:u.style,styleSpec:u.styleSpec}));break;case"has":case"!has":y=tr(n[1]),n.length!==2?T.push(new Rt(a,n,`filter array for "${n[0]}" operator must have 2 elements`)):y!=="string"&&T.push(new Rt(`${a}[1]`,n[1],`string expected, ${y} found`))}return T}function Sp(u,n){const a=u.key,p=u.validateSpec,y=u.style,T=u.styleSpec,E=u.value,M=u.objectKey,A=T[`${n}_${u.layerType}`];if(!A)return[];const O=M.match(/^(.*)-transition$/);if(n==="paint"&&O&&A[O[1]]&&A[O[1]].transition)return p({key:a,value:E,valueSpec:T.transition,style:y,styleSpec:T});const B=u.valueSpec||A[M];if(!B)return[new Rt(a,E,`unknown property "${M}"`)];let q;if(tr(E)==="string"&&qs(B)&&!B.tokens&&(q=/^{([^}]+)}$/.exec(E)))return[new Rt(a,E,`"${M}" does not support interpolation syntax
Use an identity property function instead: \`{ "type": "identity", "property": ${JSON.stringify(q[1])} }\`.`)];const ee=[];return u.layerType==="symbol"&&(M==="text-field"&&y&&!y.glyphs&&ee.push(new Rt(a,E,'use of "text-field" requires a style "glyphs" property')),M==="text-font"&&_o(qa(E))&&fn(E.type)==="identity"&&ee.push(new Rt(a,E,'"text-font" does not support identity functions'))),ee.concat(p({key:u.key,value:E,valueSpec:B,style:y,styleSpec:T,expressionContext:"property",propertyType:n,propertyKey:M}))}function ou(u){return Sp(u,"paint")}function au(u){return Sp(u,"layout")}function Zs(u){let n=[];const a=u.value,p=u.key,y=u.style,T=u.styleSpec;if(tr(a)!=="object")return[new Rt(p,a,`object expected, ${tr(a)} found`)];a.type||a.ref||n.push(new Rt(p,a,'either "type" or "ref" is required'));let E=fn(a.type);const M=fn(a.ref);if(a.id){const A=fn(a.id);for(let O=0;O<u.arrayIndex;O++){const B=y.layers[O];fn(B.id)===A&&n.push(new Rt(p,a.id,`duplicate layer id "${a.id}", previously used at line ${B.id.__line__}`))}}if("ref"in a){let A;["type","source","source-layer","filter","layout"].forEach(O=>{O in a&&n.push(new Rt(p,a[O],`"${O}" is prohibited for ref layers`))}),y.layers.forEach(O=>{fn(O.id)===M&&(A=O)}),A?A.ref?n.push(new Rt(p,a.ref,"ref cannot reference another ref layer")):E=fn(A.type):n.push(new Rt(p,a.ref,`ref layer "${M}" not found`))}else if(E!=="background")if(a.source){const A=y.sources&&y.sources[a.source],O=A&&fn(A.type);A?O==="vector"&&E==="raster"?n.push(new Rt(p,a.source,`layer "${a.id}" requires a raster source`)):O!=="raster-dem"&&E==="hillshade"||O!=="raster-dem"&&E==="color-relief"?n.push(new Rt(p,a.source,`layer "${a.id}" requires a raster-dem source`)):O==="raster"&&E!=="raster"?n.push(new Rt(p,a.source,`layer "${a.id}" requires a vector source`)):O!=="vector"||a["source-layer"]?O==="raster-dem"&&E!=="hillshade"&&E!=="color-relief"?n.push(new Rt(p,a.source,"raster-dem source can only be used with layer type 'hillshade' or 'color-relief'.")):E!=="line"||!a.paint||!a.paint["line-gradient"]||O==="geojson"&&A.lineMetrics||n.push(new Rt(p,a,`layer "${a.id}" specifies a line-gradient, which requires a GeoJSON source with \`lineMetrics\` enabled.`)):n.push(new Rt(p,a,`layer "${a.id}" must specify a "source-layer"`)):n.push(new Rt(p,a.source,`source "${a.source}" not found`))}else n.push(new Rt(p,a,'missing required property "source"'));return n=n.concat(vo({key:p,value:a,valueSpec:T.layer,style:u.style,styleSpec:u.styleSpec,validateSpec:u.validateSpec,objectElementValidators:{"*":()=>[],type:()=>u.validateSpec({key:`${p}.type`,value:a.type,valueSpec:T.layer.type,style:u.style,styleSpec:u.styleSpec,validateSpec:u.validateSpec,object:a,objectKey:"type"}),filter:Rh,layout:A=>vo({layer:a,key:A.key,value:A.value,style:A.style,styleSpec:A.styleSpec,validateSpec:A.validateSpec,objectElementValidators:{"*":O=>au(Kr({layerType:E},O))}}),paint:A=>vo({layer:a,key:A.key,value:A.value,style:A.style,styleSpec:A.styleSpec,validateSpec:A.validateSpec,objectElementValidators:{"*":O=>ou(Kr({layerType:E},O))}})}})),n}function Oo(u){const n=u.value,a=u.key,p=tr(n);return p!=="string"?[new Rt(a,n,`string expected, ${p} found`)]:[]}const Nh={promoteId:function({key:u,value:n}){if(tr(n)==="string")return Oo({key:u,value:n});{const a=[];for(const p in n)a.push(...Oo({key:`${u}.${p}`,value:n[p]}));return a}}};function Mp(u){const n=u.value,a=u.key,p=u.styleSpec,y=u.style,T=u.validateSpec;if(!n.type)return[new Rt(a,n,'"type" is required')];const E=fn(n.type);let M;switch(E){case"vector":case"raster":return M=vo({key:a,value:n,valueSpec:p[`source_${E.replace("-","_")}`],style:u.style,styleSpec:p,objectElementValidators:Nh,validateSpec:T}),M;case"raster-dem":return M=function(A){var O;const B=(O=A.sourceName)!==null&&O!==void 0?O:"",q=A.value,ee=A.styleSpec,re=ee.source_raster_dem,se=A.style;let ce=[];const be=tr(q);if(q===void 0)return ce;if(be!=="object")return ce.push(new Rt("source_raster_dem",q,`object expected, ${be} found`)),ce;const Me=fn(q.encoding)==="custom",Xe=["redFactor","greenFactor","blueFactor","baseShift"],ze=A.value.encoding?`"${A.value.encoding}"`:"Default";for(const ie in q)!Me&&Xe.includes(ie)?ce.push(new Rt(ie,q[ie],`In "${B}": "${ie}" is only valid when "encoding" is set to "custom". ${ze} encoding found`)):re[ie]?ce=ce.concat(A.validateSpec({key:ie,value:q[ie],valueSpec:re[ie],validateSpec:A.validateSpec,style:se,styleSpec:ee})):ce.push(new Rt(ie,q[ie],`unknown property "${ie}"`));return ce}({sourceName:a,value:n,style:u.style,styleSpec:p,validateSpec:T}),M;case"geojson":if(M=vo({key:a,value:n,valueSpec:p.source_geojson,style:y,styleSpec:p,validateSpec:T,objectElementValidators:Nh}),n.cluster)for(const A in n.clusterProperties){const[O,B]=n.clusterProperties[A],q=typeof O=="string"?[O,["accumulated"],["get",A]]:O;M.push(...su({key:`${a}.${A}.map`,value:B,expressionContext:"cluster-map"})),M.push(...su({key:`${a}.${A}.reduce`,value:q,expressionContext:"cluster-reduce"}))}return M;case"video":return vo({key:a,value:n,valueSpec:p.source_video,style:y,validateSpec:T,styleSpec:p});case"image":return vo({key:a,value:n,valueSpec:p.source_image,style:y,validateSpec:T,styleSpec:p});case"canvas":return[new Rt(a,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return Vu({key:`${a}.type`,value:n.type,valueSpec:{values:["vector","raster","raster-dem","geojson","video","image"]}})}}function Pp(u){const n=u.value,a=u.styleSpec,p=a.light,y=u.style;let T=[];const E=tr(n);if(n===void 0)return T;if(E!=="object")return T=T.concat([new Rt("light",n,`object expected, ${E} found`)]),T;for(const M in n){const A=M.match(/^(.*)-transition$/);T=T.concat(A&&p[A[1]]&&p[A[1]].transition?u.validateSpec({key:M,value:n[M],valueSpec:a.transition,validateSpec:u.validateSpec,style:y,styleSpec:a}):p[M]?u.validateSpec({key:M,value:n[M],valueSpec:p[M],validateSpec:u.validateSpec,style:y,styleSpec:a}):[new Rt(M,n[M],`unknown property "${M}"`)])}return T}function lu(u){const n=u.value,a=u.styleSpec,p=a.sky,y=u.style,T=tr(n);if(n===void 0)return[];if(T!=="object")return[new Rt("sky",n,`object expected, ${T} found`)];let E=[];for(const M in n)E=E.concat(p[M]?u.validateSpec({key:M,value:n[M],valueSpec:p[M],style:y,styleSpec:a}):[new Rt(M,n[M],`unknown property "${M}"`)]);return E}function Oh(u){const n=u.value,a=u.styleSpec,p=a.terrain,y=u.style;let T=[];const E=tr(n);if(n===void 0)return T;if(E!=="object")return T=T.concat([new Rt("terrain",n,`object expected, ${E} found`)]),T;for(const M in n)T=T.concat(p[M]?u.validateSpec({key:M,value:n[M],valueSpec:p[M],validateSpec:u.validateSpec,style:y,styleSpec:a}):[new Rt(M,n[M],`unknown property "${M}"`)]);return T}function Cc(u){let n=[];const a=u.value,p=u.key;if(Array.isArray(a)){const y=[],T=[];for(const E in a)a[E].id&&y.includes(a[E].id)&&n.push(new Rt(p,a,`all the sprites' ids must be unique, but ${a[E].id} is duplicated`)),y.push(a[E].id),a[E].url&&T.includes(a[E].url)&&n.push(new Rt(p,a,`all the sprites' URLs must be unique, but ${a[E].url} is duplicated`)),T.push(a[E].url),n=n.concat(vo({key:`${p}[${E}]`,value:a[E],valueSpec:{id:{type:"string",required:!0},url:{type:"string",required:!0}},validateSpec:u.validateSpec}));return n}return Oo({key:p,value:a})}function kp(u){return n=u.value,n&&n.constructor===Object?[]:[new Rt(u.key,u.value,`object expected, ${tr(u.value)} found`)];var n}const Ac={"*":()=>[],array:kc,boolean:function(u){const n=u.value,a=u.key,p=tr(n);return p!=="boolean"?[new Rt(a,n,`boolean expected, ${p} found`)]:[]},number:Uu,color:Lh,constants:Ep,enum:Vu,filter:Rh,function:nu,layer:Zs,object:vo,source:Mp,light:Pp,sky:lu,terrain:Oh,projection:function(u){const n=u.value,a=u.styleSpec,p=a.projection,y=u.style,T=tr(n);if(n===void 0)return[];if(T!=="object")return[new Rt("projection",n,`object expected, ${T} found`)];let E=[];for(const M in n)E=E.concat(p[M]?u.validateSpec({key:M,value:n[M],valueSpec:p[M],style:y,styleSpec:a}):[new Rt(M,n[M],`unknown property "${M}"`)]);return E},projectionDefinition:function(u){const n=u.key;let a=u.value;a=a instanceof String?a.valueOf():a;const p=tr(a);return p!=="array"||function(y){return Array.isArray(y)&&y.length===3&&typeof y[0]=="string"&&typeof y[1]=="string"&&typeof y[2]=="number"}(a)||function(y){return!!["interpolate","step","literal"].includes(y[0])}(a)?["array","string"].includes(p)?[]:[new Rt(n,a,`projection expected, invalid type "${p}" found`)]:[new Rt(n,a,`projection expected, invalid array ${JSON.stringify(a)} found`)]},string:Oo,formatted:function(u){return Oo(u).length===0?[]:su(u)},resolvedImage:function(u){return Oo(u).length===0?[]:su(u)},padding:function(u){const n=u.key,a=u.value;if(tr(a)==="array"){if(a.length<1||a.length>4)return[new Rt(n,a,`padding requires 1 to 4 values; ${a.length} values found`)];const p={type:"number"};let y=[];for(let T=0;T<a.length;T++)y=y.concat(u.validateSpec({key:`${n}[${T}]`,value:a[T],validateSpec:u.validateSpec,valueSpec:p}));return y}return Uu({key:n,value:a,valueSpec:{}})},numberArray:function(u){const n=u.key,a=u.value;if(tr(a)==="array"){const p={type:"number"};if(a.length<1)return[new Rt(n,a,"array length at least 1 expected, length 0 found")];let y=[];for(let T=0;T<a.length;T++)y=y.concat(u.validateSpec({key:`${n}[${T}]`,value:a[T],validateSpec:u.validateSpec,valueSpec:p}));return y}return Uu({key:n,value:a,valueSpec:{}})},colorArray:function(u){const n=u.key,a=u.value;if(tr(a)==="array"){if(a.length<1)return[new Rt(n,a,"array length at least 1 expected, length 0 found")];let p=[];for(let y=0;y<a.length;y++)p=p.concat(Lh({key:`${n}[${y}]`,value:a[y]}));return p}return Lh({key:n,value:a})},variableAnchorOffsetCollection:function(u){const n=u.key,a=u.value,p=tr(a),y=u.styleSpec;if(p!=="array"||a.length<1||a.length%2!=0)return[new Rt(n,a,"variableAnchorOffsetCollection requires a non-empty array of even length")];let T=[];for(let E=0;E<a.length;E+=2)T=T.concat(Vu({key:`${n}[${E}]`,value:a[E],valueSpec:y.layout_symbol["text-anchor"]})),T=T.concat(kc({key:`${n}[${E+1}]`,value:a[E+1],valueSpec:{length:2,value:"number"},validateSpec:u.validateSpec,style:u.style,styleSpec:y}));return T},sprite:Cc,state:kp};function Lc(u){const n=u.value,a=u.valueSpec,p=u.styleSpec;return u.validateSpec=Lc,a.expression&&_o(fn(n))?nu(u):a.expression&&Tc(qa(n))?su(u):a.type&&Ac[a.type]?Ac[a.type](u):vo(Kr({},u,{valueSpec:a.type?p[a.type]:a}))}function uu(u){const n=u.value,a=u.key,p=Oo(u);return p.length||(n.indexOf("{fontstack}")===-1&&p.push(new Rt(a,n,'"glyphs" url must include a "{fontstack}" token')),n.indexOf("{range}")===-1&&p.push(new Rt(a,n,'"glyphs" url must include a "{range}" token'))),p}function xo(u,n=Ve){let a=[];return a=a.concat(Lc({key:"",value:u,valueSpec:n.$root,styleSpec:n,style:u,validateSpec:Lc,objectElementValidators:{glyphs:uu,"*":()=>[]}})),u.constants&&(a=a.concat(Ep({key:"constants",value:u.constants}))),Cp(a)}function Do(u){return function(n){return u({...n,validateSpec:Lc})}}function Cp(u){return[].concat(u).sort((n,a)=>n.line-a.line)}function Ds(u){return function(...n){return Cp(u.apply(this,n))}}xo.source=Ds(Do(Mp)),xo.sprite=Ds(Do(Cc)),xo.glyphs=Ds(Do(uu)),xo.light=Ds(Do(Pp)),xo.sky=Ds(Do(lu)),xo.terrain=Ds(Do(Oh)),xo.state=Ds(Do(kp)),xo.layer=Ds(Do(Zs)),xo.filter=Ds(Do(Rh)),xo.paintProperty=Ds(Do(ou)),xo.layoutProperty=Ds(Do(au));const cu=xo,Qm=cu.light,Rc=cu.sky,eg=cu.paintProperty,Dh=cu.layoutProperty;function qu(u,n){let a=!1;if(n&&n.length)for(const p of n)u.fire(new nt(new Error(p.message))),a=!0;return a}class hu{constructor(n,a,p){const y=this.cells=[];if(n instanceof ArrayBuffer){this.arrayBuffer=n;const E=new Int32Array(this.arrayBuffer);n=E[0],this.d=(a=E[1])+2*(p=E[2]);for(let A=0;A<this.d*this.d;A++){const O=E[3+A],B=E[3+A+1];y.push(O===B?null:E.subarray(O,B))}const M=E[3+y.length+1];this.keys=E.subarray(E[3+y.length],M),this.bboxes=E.subarray(M),this.insert=this._insertReadonly}else{this.d=a+2*p;for(let E=0;E<this.d*this.d;E++)y.push([]);this.keys=[],this.bboxes=[]}this.n=a,this.extent=n,this.padding=p,this.scale=a/n,this.uid=0;const T=p/a*n;this.min=-T,this.max=n+T}insert(n,a,p,y,T){this._forEachCell(a,p,y,T,this._insertCell,this.uid++,void 0,void 0),this.keys.push(n),this.bboxes.push(a),this.bboxes.push(p),this.bboxes.push(y),this.bboxes.push(T)}_insertReadonly(){throw new Error("Cannot insert into a GridIndex created from an ArrayBuffer.")}_insertCell(n,a,p,y,T,E){this.cells[T].push(E)}query(n,a,p,y,T){const E=this.min,M=this.max;if(n<=E&&a<=E&&M<=p&&M<=y&&!T)return Array.prototype.slice.call(this.keys);{const A=[];return this._forEachCell(n,a,p,y,this._queryCell,A,{},T),A}}_queryCell(n,a,p,y,T,E,M,A){const O=this.cells[T];if(O!==null){const B=this.keys,q=this.bboxes;for(let ee=0;ee<O.length;ee++){const re=O[ee];if(M[re]===void 0){const se=4*re;(A?A(q[se+0],q[se+1],q[se+2],q[se+3]):n<=q[se+2]&&a<=q[se+3]&&p>=q[se+0]&&y>=q[se+1])?(M[re]=!0,E.push(B[re])):M[re]=!1}}}}_forEachCell(n,a,p,y,T,E,M,A){const O=this._convertToCellCoord(n),B=this._convertToCellCoord(a),q=this._convertToCellCoord(p),ee=this._convertToCellCoord(y);for(let re=O;re<=q;re++)for(let se=B;se<=ee;se++){const ce=this.d*se+re;if((!A||A(this._convertFromCellCoord(re),this._convertFromCellCoord(se),this._convertFromCellCoord(re+1),this._convertFromCellCoord(se+1)))&&T.call(this,n,a,p,y,ce,E,M,A))return}}_convertFromCellCoord(n){return(n-this.padding)/this.scale}_convertToCellCoord(n){return Math.max(0,Math.min(this.d-1,Math.floor(n*this.scale)+this.padding))}toArrayBuffer(){if(this.arrayBuffer)return this.arrayBuffer;const n=this.cells,a=3+this.cells.length+1+1;let p=0;for(let E=0;E<this.cells.length;E++)p+=this.cells[E].length;const y=new Int32Array(a+p+this.keys.length+this.bboxes.length);y[0]=this.extent,y[1]=this.n,y[2]=this.padding;let T=a;for(let E=0;E<n.length;E++){const M=n[E];y[3+E]=T,y.set(M,T),T+=M.length}return y[3+n.length]=T,y.set(this.keys,T),T+=this.keys.length,y[3+n.length+1]=T,y.set(this.bboxes,T),T+=this.bboxes.length,y.buffer}static serialize(n,a){const p=n.toArrayBuffer();return a&&a.push(p),{buffer:p}}static deserialize(n){return new hu(n.buffer)}}const oa={};function ni(u,n,a={}){if(oa[u])throw new Error(`${u} is already registered.`);Object.defineProperty(n,"_classRegistryKey",{value:u,writeable:!1}),oa[u]={klass:n,omit:a.omit||[],shallow:a.shallow||[]}}ni("Object",Object),ni("Set",Set),ni("TransferableGridIndex",hu),ni("Color",si),ni("Error",Error),ni("AJAXError",Le),ni("ResolvedImage",Pn),ni("StylePropertyFunction",$u),ni("StyleExpression",wc,{omit:["_evaluator"]}),ni("ZoomDependentExpression",Ic),ni("ZoomConstantExpression",Bu),ni("CompoundExpression",hr,{omit:["_evaluate"]});for(const u in cr)cr[u]._classRegistryKey||ni(`Expression_${u}`,cr[u]);function Fh(u){return u&&typeof ArrayBuffer<"u"&&(u instanceof ArrayBuffer||u.constructor&&u.constructor.name==="ArrayBuffer")}function Zu(u){return u.$name||u.constructor._classRegistryKey}function zh(u){return!function(n){if(n===null||typeof n!="object")return!1;const a=Zu(n);return!(!a||a==="Object")}(u)&&(u==null||typeof u=="boolean"||typeof u=="number"||typeof u=="string"||u instanceof Boolean||u instanceof Number||u instanceof String||u instanceof Date||u instanceof RegExp||u instanceof Blob||u instanceof Error||Fh(u)||xs(u)||ArrayBuffer.isView(u)||u instanceof ImageData)}function Wu(u,n){if(zh(u))return(Fh(u)||xs(u))&&n&&n.push(u),ArrayBuffer.isView(u)&&n&&n.push(u.buffer),u instanceof ImageData&&n&&n.push(u.data.buffer),u;if(Array.isArray(u)){const T=[];for(const E of u)T.push(Wu(E,n));return T}if(typeof u!="object")throw new Error("can't serialize object of type "+typeof u);const a=Zu(u);if(!a)throw new Error(`can't serialize object of unregistered class ${u.constructor.name}`);if(!oa[a])throw new Error(`${a} is not registered.`);const{klass:p}=oa[a],y=p.serialize?p.serialize(u,n):{};if(p.serialize){if(n&&y===n[n.length-1])throw new Error("statically serialized object won't survive transfer of $name property")}else{for(const T in u){if(!u.hasOwnProperty(T)||oa[a].omit.indexOf(T)>=0)continue;const E=u[T];y[T]=oa[a].shallow.indexOf(T)>=0?E:Wu(E,n)}u instanceof Error&&(y.message=u.message)}if(y.$name)throw new Error("$name property is reserved for worker serialization logic.");return a!=="Object"&&(y.$name=a),y}function du(u){if(zh(u))return u;if(Array.isArray(u))return u.map(du);if(typeof u!="object")throw new Error("can't deserialize object of type "+typeof u);const n=Zu(u)||"Object";if(!oa[n])throw new Error(`can't deserialize unregistered class ${n}`);const{klass:a}=oa[n];if(!a)throw new Error(`can't deserialize unregistered class ${n}`);if(a.deserialize)return a.deserialize(u);const p=Object.create(a.prototype);for(const y of Object.keys(u)){if(y==="$name")continue;const T=u[y];p[y]=oa[n].shallow.indexOf(y)>=0?T:du(T)}return p}class Bh{constructor(){this.first=!0}update(n,a){const p=Math.floor(n);return this.first?(this.first=!1,this.lastIntegerZoom=p,this.lastIntegerZoomTime=0,this.lastZoom=n,this.lastFloorZoom=p,!0):(this.lastFloorZoom>p?(this.lastIntegerZoom=p+1,this.lastIntegerZoomTime=a):this.lastFloorZoom<p&&(this.lastIntegerZoom=p,this.lastIntegerZoomTime=a),n!==this.lastZoom&&(this.lastZoom=n,this.lastFloorZoom=p,!0))}}const ar={"Latin-1 Supplement":u=>u>=128&&u<=255,"Hangul Jamo":u=>u>=4352&&u<=4607,Khmer:u=>u>=6016&&u<=6143,"General Punctuation":u=>u>=8192&&u<=8303,"Letterlike Symbols":u=>u>=8448&&u<=8527,"Number Forms":u=>u>=8528&&u<=8591,"Miscellaneous Technical":u=>u>=8960&&u<=9215,"Control Pictures":u=>u>=9216&&u<=9279,"Optical Character Recognition":u=>u>=9280&&u<=9311,"Enclosed Alphanumerics":u=>u>=9312&&u<=9471,"Geometric Shapes":u=>u>=9632&&u<=9727,"Miscellaneous Symbols":u=>u>=9728&&u<=9983,"Miscellaneous Symbols and Arrows":u=>u>=11008&&u<=11263,"Ideographic Description Characters":u=>u>=12272&&u<=12287,"CJK Symbols and Punctuation":u=>u>=12288&&u<=12351,Hiragana:u=>u>=12352&&u<=12447,Katakana:u=>u>=12448&&u<=12543,Kanbun:u=>u>=12688&&u<=12703,"CJK Strokes":u=>u>=12736&&u<=12783,"Enclosed CJK Letters and Months":u=>u>=12800&&u<=13055,"CJK Compatibility":u=>u>=13056&&u<=13311,"Yijing Hexagram Symbols":u=>u>=19904&&u<=19967,"CJK Unified Ideographs":u=>u>=19968&&u<=40959,"Hangul Syllables":u=>u>=44032&&u<=55215,"Private Use Area":u=>u>=57344&&u<=63743,"Vertical Forms":u=>u>=65040&&u<=65055,"CJK Compatibility Forms":u=>u>=65072&&u<=65103,"Small Form Variants":u=>u>=65104&&u<=65135,"Halfwidth and Fullwidth Forms":u=>u>=65280&&u<=65519};function $h(u){for(const n of u)if(Oc(n.charCodeAt(0)))return!0;return!1}function Ap(u){for(const n of u)if(!ig(n.charCodeAt(0)))return!1;return!0}function Nc(u){const n=u.map(a=>{try{return new RegExp(`\\p{sc=${a}}`,"u").source}catch{return null}}).filter(a=>a);return new RegExp(n.join("|"),"u")}const tg=Nc(["Arab","Dupl","Mong","Ougr","Syrc"]);function ig(u){return!tg.test(String.fromCodePoint(u))}const jh=Nc(["Bopo","Hani","Hira","Kana","Kits","Nshu","Tang","Yiii"]);function Oc(u){return!(u!==746&&u!==747&&(u<4352||!(ar["CJK Compatibility Forms"](u)&&!(u>=65097&&u<=65103)||ar["CJK Compatibility"](u)||ar["CJK Strokes"](u)||!(!ar["CJK Symbols and Punctuation"](u)||u>=12296&&u<=12305||u>=12308&&u<=12319||u===12336)||ar["Enclosed CJK Letters and Months"](u)||ar["Ideographic Description Characters"](u)||ar.Kanbun(u)||ar.Katakana(u)&&u!==12540||!(!ar["Halfwidth and Fullwidth Forms"](u)||u===65288||u===65289||u===65293||u>=65306&&u<=65310||u===65339||u===65341||u===65343||u>=65371&&u<=65503||u===65507||u>=65512&&u<=65519)||!(!ar["Small Form Variants"](u)||u>=65112&&u<=65118||u>=65123&&u<=65126)||ar["Vertical Forms"](u)||ar["Yijing Hexagram Symbols"](u)||new RegExp("\\p{sc=Cans}","u").test(String.fromCodePoint(u))||new RegExp("\\p{sc=Hang}","u").test(String.fromCodePoint(u))||jh.test(String.fromCodePoint(u)))))}function Gh(u){return!(Oc(u)||function(n){return!!(ar["Latin-1 Supplement"](n)&&(n===167||n===169||n===174||n===177||n===188||n===189||n===190||n===215||n===247)||ar["General Punctuation"](n)&&(n===8214||n===8224||n===8225||n===8240||n===8241||n===8251||n===8252||n===8258||n===8263||n===8264||n===8265||n===8273)||ar["Letterlike Symbols"](n)||ar["Number Forms"](n)||ar["Miscellaneous Technical"](n)&&(n>=8960&&n<=8967||n>=8972&&n<=8991||n>=8996&&n<=9e3||n===9003||n>=9085&&n<=9114||n>=9150&&n<=9165||n===9167||n>=9169&&n<=9179||n>=9186&&n<=9215)||ar["Control Pictures"](n)&&n!==9251||ar["Optical Character Recognition"](n)||ar["Enclosed Alphanumerics"](n)||ar["Geometric Shapes"](n)||ar["Miscellaneous Symbols"](n)&&!(n>=9754&&n<=9759)||ar["Miscellaneous Symbols and Arrows"](n)&&(n>=11026&&n<=11055||n>=11088&&n<=11097||n>=11192&&n<=11243)||ar["CJK Symbols and Punctuation"](n)||ar.Katakana(n)||ar["Private Use Area"](n)||ar["CJK Compatibility Forms"](n)||ar["Small Form Variants"](n)||ar["Halfwidth and Fullwidth Forms"](n)||n===8734||n===8756||n===8757||n>=9984&&n<=10087||n>=10102&&n<=10131||n===65532||n===65533)}(u))}const Lp=Nc(["Adlm","Arab","Armi","Avst","Chrs","Cprt","Egyp","Elym","Gara","Hatr","Hebr","Hung","Khar","Lydi","Mand","Mani","Mend","Merc","Mero","Narb","Nbat","Nkoo","Orkh","Palm","Phli","Phlp","Phnx","Prti","Rohg","Samr","Sarb","Sogo","Syrc","Thaa","Todr","Yezi"]);function Yu(u){return Lp.test(String.fromCodePoint(u))}function rg(u,n){return!(!n&&Yu(u)||u>=2304&&u<=3583||u>=3840&&u<=4255||ar.Khmer(u))}function Uh(u){for(const n of u)if(Yu(n.charCodeAt(0)))return!0;return!1}const Za=new class{constructor(){this.TIMEOUT=5e3,this.applyArabicShaping=null,this.processBidirectionalText=null,this.processStyledBidirectionalText=null,this.pluginStatus="unavailable",this.pluginURL=null,this.loadScriptResolve=()=>{}}setState(u){this.pluginStatus=u.pluginStatus,this.pluginURL=u.pluginURL}getState(){return{pluginStatus:this.pluginStatus,pluginURL:this.pluginURL}}setMethods(u){if(Za.isParsed())throw new Error("RTL text plugin already registered.");this.applyArabicShaping=u.applyArabicShaping,this.processBidirectionalText=u.processBidirectionalText,this.processStyledBidirectionalText=u.processStyledBidirectionalText,this.loadScriptResolve()}isParsed(){return this.applyArabicShaping!=null&&this.processBidirectionalText!=null&&this.processStyledBidirectionalText!=null}getRTLTextPluginStatus(){return this.pluginStatus}syncState(u,n){return o(this,void 0,void 0,function*(){if(this.isParsed())return this.getState();if(u.pluginStatus!=="loading")return this.setState(u),u;const a=u.pluginURL,p=new Promise(T=>{this.loadScriptResolve=T});n(a);const y=new Promise(T=>setTimeout(()=>T(),this.TIMEOUT));if(yield Promise.race([p,y]),this.isParsed()){const T={pluginStatus:"loaded",pluginURL:a};return this.setState(T),T}throw this.setState({pluginStatus:"error",pluginURL:""}),new Error(`RTL Text Plugin failed to import scripts from ${a}`)})}};class en{constructor(n,a){this.zoom=n,a?(this.now=a.now||0,this.fadeDuration=a.fadeDuration||0,this.zoomHistory=a.zoomHistory||new Bh,this.transition=a.transition||{},this.globalState=a.globalState||{}):(this.now=0,this.fadeDuration=0,this.zoomHistory=new Bh,this.transition={},this.globalState={})}isSupportedScript(n){return function(a,p){for(const y of a)if(!rg(y.charCodeAt(0),p))return!1;return!0}(n,Za.getRTLTextPluginStatus()==="loaded")}crossFadingFactor(){return this.fadeDuration===0?1:Math.min((this.now-this.zoomHistory.lastIntegerZoomTime)/this.fadeDuration,1)}getCrossfadeParameters(){const n=this.zoom,a=n-Math.floor(n),p=this.crossFadingFactor();return n>this.zoomHistory.lastIntegerZoom?{fromScale:2,toScale:1,t:a+(1-a)*p}:{fromScale:.5,toScale:1,t:1-(1-p)*a}}}class Xu{constructor(n,a){this.property=n,this.value=a,this.expression=function(p,y){if(_o(p))return new $u(p,y);if(Tc(p)){const T=kh(p,y);if(T.result==="error")throw new Error(T.value.map(E=>`${E.key}: ${E.message}`).join(", "));return T.value}{let T=p;return y.type==="color"&&typeof p=="string"?T=si.parse(p):y.type!=="padding"||typeof p!="number"&&!Array.isArray(p)?y.type!=="numberArray"||typeof p!="number"&&!Array.isArray(p)?y.type!=="colorArray"||typeof p!="string"&&!Array.isArray(p)?y.type==="variableAnchorOffsetCollection"&&Array.isArray(p)?T=ui.parse(p):y.type==="projectionDefinition"&&typeof p=="string"&&(T=Vi.parse(p)):T=rr.parse(p):T=or.parse(p):T=ji.parse(p),{globalStateRefs:new Set,kind:"constant",evaluate:()=>T}}}(a===void 0?n.specification.default:a,n.specification)}isDataDriven(){return this.expression.kind==="source"||this.expression.kind==="composite"}getGlobalStateRefs(){return this.expression.globalStateRefs||new Set}possiblyEvaluate(n,a,p){return this.property.possiblyEvaluate(this,n,a,p)}}class Dc{constructor(n){this.property=n,this.value=new Xu(n,void 0)}transitioned(n,a){return new Rp(this.property,this.value,a,Jt({},n.transition,this.transition),n.now)}untransitioned(){return new Rp(this.property,this.value,null,{},0)}}class Vh{constructor(n){this._properties=n,this._values=Object.create(n.defaultTransitionablePropertyValues)}getValue(n){return Gi(this._values[n].value.value)}setValue(n,a){Object.prototype.hasOwnProperty.call(this._values,n)||(this._values[n]=new Dc(this._values[n].property)),this._values[n].value=new Xu(this._values[n].property,a===null?void 0:Gi(a))}getTransition(n){return Gi(this._values[n].transition)}setTransition(n,a){Object.prototype.hasOwnProperty.call(this._values,n)||(this._values[n]=new Dc(this._values[n].property)),this._values[n].transition=Gi(a)||void 0}serialize(){const n={};for(const a of Object.keys(this._values)){const p=this.getValue(a);p!==void 0&&(n[a]=p);const y=this.getTransition(a);y!==void 0&&(n[`${a}-transition`]=y)}return n}transitioned(n,a){const p=new Np(this._properties);for(const y of Object.keys(this._values))p._values[y]=this._values[y].transitioned(n,a._values[y]);return p}untransitioned(){const n=new Np(this._properties);for(const a of Object.keys(this._values))n._values[a]=this._values[a].untransitioned();return n}}class Rp{constructor(n,a,p,y,T){this.property=n,this.value=a,this.begin=T+y.delay||0,this.end=this.begin+y.duration||0,n.specification.transition&&(y.delay||y.duration)&&(this.prior=p)}possiblyEvaluate(n,a,p){const y=n.now||0,T=this.value.possiblyEvaluate(n,a,p),E=this.prior;if(E){if(y>this.end)return this.prior=null,T;if(this.value.isDataDriven())return this.prior=null,T;if(y<this.begin)return E.possiblyEvaluate(n,a,p);{const M=(y-this.begin)/(this.end-this.begin);return this.property.interpolate(E.possiblyEvaluate(n,a,p),T,ai(M))}}return T}}class Np{constructor(n){this._properties=n,this._values=Object.create(n.defaultTransitioningPropertyValues)}possiblyEvaluate(n,a,p){const y=new Fc(this._properties);for(const T of Object.keys(this._values))y._values[T]=this._values[T].possiblyEvaluate(n,a,p);return y}hasTransition(){for(const n of Object.keys(this._values))if(this._values[n].prior)return!0;return!1}}class ng{constructor(n){this._properties=n,this._values=Object.create(n.defaultPropertyValues)}hasValue(n){return this._values[n].value!==void 0}getValue(n){return Gi(this._values[n].value)}setValue(n,a){this._values[n]=new Xu(this._values[n].property,a===null?void 0:Gi(a))}serialize(){const n={};for(const a of Object.keys(this._values)){const p=this.getValue(a);p!==void 0&&(n[a]=p)}return n}possiblyEvaluate(n,a,p){const y=new Fc(this._properties);for(const T of Object.keys(this._values))y._values[T]=this._values[T].possiblyEvaluate(n,a,p);return y}}class aa{constructor(n,a,p){this.property=n,this.value=a,this.parameters=p}isConstant(){return this.value.kind==="constant"}constantOr(n){return this.value.kind==="constant"?this.value.value:n}evaluate(n,a,p,y){return this.property.evaluate(this.value,this.parameters,n,a,p,y)}}class Fc{constructor(n){this._properties=n,this._values=Object.create(n.defaultPossiblyEvaluatedValues)}get(n){return this._values[n]}}class mi{constructor(n){this.specification=n}possiblyEvaluate(n,a){if(n.isDataDriven())throw new Error("Value should not be data driven");return n.expression.evaluate(a)}interpolate(n,a,p){const y=Fr[this.specification.type];return y?y(n,a,p):n}}class Fi{constructor(n,a){this.specification=n,this.overrides=a}possiblyEvaluate(n,a,p,y){return new aa(this,n.expression.kind==="constant"||n.expression.kind==="camera"?{kind:"constant",value:n.expression.evaluate(a,null,{},p,y)}:n.expression,a)}interpolate(n,a,p){if(n.value.kind!=="constant"||a.value.kind!=="constant")return n;if(n.value.value===void 0||a.value.value===void 0)return new aa(this,{kind:"constant",value:void 0},n.parameters);const y=Fr[this.specification.type];if(y){const T=y(n.value.value,a.value.value,p);return new aa(this,{kind:"constant",value:T},n.parameters)}return n}evaluate(n,a,p,y,T,E){return n.kind==="constant"?n.value:n.evaluate(a,p,y,T,E)}}class zc extends Fi{possiblyEvaluate(n,a,p,y){if(n.value===void 0)return new aa(this,{kind:"constant",value:void 0},a);if(n.expression.kind==="constant"){const T=n.expression.evaluate(a,null,{},p,y),E=n.property.specification.type==="resolvedImage"&&typeof T!="string"?T.name:T,M=this._calculate(E,E,E,a);return new aa(this,{kind:"constant",value:M},a)}if(n.expression.kind==="camera"){const T=this._calculate(n.expression.evaluate({zoom:a.zoom-1}),n.expression.evaluate({zoom:a.zoom}),n.expression.evaluate({zoom:a.zoom+1}),a);return new aa(this,{kind:"constant",value:T},a)}return new aa(this,n.expression,a)}evaluate(n,a,p,y,T,E){if(n.kind==="source"){const M=n.evaluate(a,p,y,T,E);return this._calculate(M,M,M,a)}return n.kind==="composite"?this._calculate(n.evaluate({zoom:Math.floor(a.zoom)-1},p,y),n.evaluate({zoom:Math.floor(a.zoom)},p,y),n.evaluate({zoom:Math.floor(a.zoom)+1},p,y),a):n.value}_calculate(n,a,p,y){return y.zoom>y.zoomHistory.lastIntegerZoom?{from:n,to:a}:{from:p,to:a}}interpolate(n){return n}}class qh{constructor(n){this.specification=n}possiblyEvaluate(n,a,p,y){if(n.value!==void 0){if(n.expression.kind==="constant"){const T=n.expression.evaluate(a,null,{},p,y);return this._calculate(T,T,T,a)}return this._calculate(n.expression.evaluate(new en(Math.floor(a.zoom-1),a)),n.expression.evaluate(new en(Math.floor(a.zoom),a)),n.expression.evaluate(new en(Math.floor(a.zoom+1),a)),a)}}_calculate(n,a,p,y){return y.zoom>y.zoomHistory.lastIntegerZoom?{from:n,to:a}:{from:p,to:a}}interpolate(n){return n}}class Hu{constructor(n){this.specification=n}possiblyEvaluate(n,a,p,y){return!!n.expression.evaluate(a,null,{},p,y)}interpolate(){return!1}}class Fs{constructor(n){this.properties=n,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];for(const a in n){const p=n[a];p.specification.overridable&&this.overridableProperties.push(a);const y=this.defaultPropertyValues[a]=new Xu(p,void 0),T=this.defaultTransitionablePropertyValues[a]=new Dc(p);this.defaultTransitioningPropertyValues[a]=T.untransitioned(),this.defaultPossiblyEvaluatedValues[a]=y.possiblyEvaluate({})}}}ni("DataDrivenProperty",Fi),ni("DataConstantProperty",mi),ni("CrossFadedDataDrivenProperty",zc),ni("CrossFadedProperty",qh),ni("ColorRampProperty",Hu);const Op="-transition";class hs extends Tt{constructor(n,a){if(super(),this.id=n.id,this.type=n.type,this._featureFilter={filter:()=>!0,needGeometry:!1,getGlobalStateRefs:()=>new Set},n.type!=="custom"&&(this.metadata=n.metadata,this.minzoom=n.minzoom,this.maxzoom=n.maxzoom,n.type!=="background"&&(this.source=n.source,this.sourceLayer=n["source-layer"],this.filter=n.filter,this._featureFilter=Va(n.filter)),a.layout&&(this._unevaluatedLayout=new ng(a.layout)),a.paint)){this._transitionablePaint=new Vh(a.paint);for(const p in n.paint)this.setPaintProperty(p,n.paint[p],{validate:!1});for(const p in n.layout)this.setLayoutProperty(p,n.layout[p],{validate:!1});this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new Fc(a.paint)}}setFilter(n){this.filter=n,this._featureFilter=Va(n)}getCrossfadeParameters(){return this._crossfadeParameters}getLayoutProperty(n){return n==="visibility"?this.visibility:this._unevaluatedLayout.getValue(n)}getLayoutAffectingGlobalStateRefs(){const n=new Set;if(this._unevaluatedLayout)for(const a in this._unevaluatedLayout._values){const p=this._unevaluatedLayout._values[a];for(const y of p.getGlobalStateRefs())n.add(y)}for(const a of this._featureFilter.getGlobalStateRefs())n.add(a);return n}setLayoutProperty(n,a,p={}){a!=null&&this._validate(Dh,`layers.${this.id}.layout.${n}`,n,a,p)||(n!=="visibility"?this._unevaluatedLayout.setValue(n,a):this.visibility=a)}getPaintProperty(n){return n.endsWith(Op)?this._transitionablePaint.getTransition(n.slice(0,-11)):this._transitionablePaint.getValue(n)}setPaintProperty(n,a,p={}){if(a!=null&&this._validate(eg,`layers.${this.id}.paint.${n}`,n,a,p))return!1;if(n.endsWith(Op))return this._transitionablePaint.setTransition(n.slice(0,-11),a||void 0),!1;{const y=this._transitionablePaint._values[n],T=y.property.specification["property-type"]==="cross-faded-data-driven",E=y.value.isDataDriven(),M=y.value;this._transitionablePaint.setValue(n,a),this._handleSpecialPaintPropertyUpdate(n);const A=this._transitionablePaint._values[n].value;return A.isDataDriven()||E||T||this._handleOverridablePaintPropertyUpdate(n,M,A)}}_handleSpecialPaintPropertyUpdate(n){}_handleOverridablePaintPropertyUpdate(n,a,p){return!1}isHidden(n){return!!(this.minzoom&&n<this.minzoom)||!!(this.maxzoom&&n>=this.maxzoom)||this.visibility==="none"}updateTransitions(n){this._transitioningPaint=this._transitionablePaint.transitioned(n,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(n,a){n.getCrossfadeParameters&&(this._crossfadeParameters=n.getCrossfadeParameters()),this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(n,void 0,a)),this.paint=this._transitioningPaint.possiblyEvaluate(n,void 0,a)}serialize(){const n={id:this.id,type:this.type,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.visibility&&(n.layout=n.layout||{},n.layout.visibility=this.visibility),Qi(n,(a,p)=>!(a===void 0||p==="layout"&&!Object.keys(a).length||p==="paint"&&!Object.keys(a).length))}_validate(n,a,p,y,T={}){return(!T||T.validate!==!1)&&qu(this,n.call(cu,{key:a,layerType:this.type,objectKey:p,value:y,styleSpec:Ve,style:{glyphs:!0,sprite:!0}}))}is3D(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}resize(){}isStateDependent(){for(const n in this.paint._values){const a=this.paint.get(n);if(a instanceof aa&&qs(a.property.specification)&&(a.value.kind==="source"||a.value.kind==="composite")&&a.value.isStateDependent)return!0}return!1}}const Dp={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class xl{constructor(n,a){this._structArray=n,this._pos1=a*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class sn{constructor(){this.isTransferred=!1,this.capacity=-1,this.resize(0)}static serialize(n,a){return n._trim(),a&&(n.isTransferred=!0,a.push(n.arrayBuffer)),{length:n.length,arrayBuffer:n.arrayBuffer}}static deserialize(n){const a=Object.create(this.prototype);return a.arrayBuffer=n.arrayBuffer,a.length=n.length,a.capacity=n.arrayBuffer.byteLength/a.bytesPerElement,a._refreshViews(),a}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(n){this.reserve(n),this.length=n}reserve(n){if(n>this.capacity){this.capacity=Math.max(n,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const a=this.uint8;this._refreshViews(),a&&this.uint8.set(a)}}_refreshViews(){throw new Error("_refreshViews() must be implemented by each concrete StructArray layout")}}function mn(u,n=1){let a=0,p=0;return{members:u.map(y=>{const T=Dp[y.type].BYTES_PER_ELEMENT,E=a=Fp(a,Math.max(n,T)),M=y.components||1;return p=Math.max(p,T),a+=T*M,{name:y.name,type:y.type,components:M,offset:E}}),size:Fp(a,Math.max(p,n)),alignment:n}}function Fp(u,n){return Math.ceil(u/n)*n}class Wa extends sn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(n,a){const p=this.length;return this.resize(p+1),this.emplace(p,n,a)}emplace(n,a,p){const y=2*n;return this.int16[y+0]=a,this.int16[y+1]=p,n}}Wa.prototype.bytesPerElement=4,ni("StructArrayLayout2i4",Wa);class Ya extends sn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(n,a,p){const y=this.length;return this.resize(y+1),this.emplace(y,n,a,p)}emplace(n,a,p,y){const T=3*n;return this.int16[T+0]=a,this.int16[T+1]=p,this.int16[T+2]=y,n}}Ya.prototype.bytesPerElement=6,ni("StructArrayLayout3i6",Ya);class Zh extends sn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(n,a,p,y){const T=this.length;return this.resize(T+1),this.emplace(T,n,a,p,y)}emplace(n,a,p,y,T){const E=4*n;return this.int16[E+0]=a,this.int16[E+1]=p,this.int16[E+2]=y,this.int16[E+3]=T,n}}Zh.prototype.bytesPerElement=8,ni("StructArrayLayout4i8",Zh);class Bc extends sn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(n,a,p,y,T,E){const M=this.length;return this.resize(M+1),this.emplace(M,n,a,p,y,T,E)}emplace(n,a,p,y,T,E,M){const A=6*n;return this.int16[A+0]=a,this.int16[A+1]=p,this.int16[A+2]=y,this.int16[A+3]=T,this.int16[A+4]=E,this.int16[A+5]=M,n}}Bc.prototype.bytesPerElement=12,ni("StructArrayLayout2i4i12",Bc);class bl extends sn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(n,a,p,y,T,E){const M=this.length;return this.resize(M+1),this.emplace(M,n,a,p,y,T,E)}emplace(n,a,p,y,T,E,M){const A=4*n,O=8*n;return this.int16[A+0]=a,this.int16[A+1]=p,this.uint8[O+4]=y,this.uint8[O+5]=T,this.uint8[O+6]=E,this.uint8[O+7]=M,n}}bl.prototype.bytesPerElement=8,ni("StructArrayLayout2i4ub8",bl);class Ku extends sn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(n,a){const p=this.length;return this.resize(p+1),this.emplace(p,n,a)}emplace(n,a,p){const y=2*n;return this.float32[y+0]=a,this.float32[y+1]=p,n}}Ku.prototype.bytesPerElement=8,ni("StructArrayLayout2f8",Ku);class Wh extends sn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(n,a,p,y,T,E,M,A,O,B){const q=this.length;return this.resize(q+1),this.emplace(q,n,a,p,y,T,E,M,A,O,B)}emplace(n,a,p,y,T,E,M,A,O,B,q){const ee=10*n;return this.uint16[ee+0]=a,this.uint16[ee+1]=p,this.uint16[ee+2]=y,this.uint16[ee+3]=T,this.uint16[ee+4]=E,this.uint16[ee+5]=M,this.uint16[ee+6]=A,this.uint16[ee+7]=O,this.uint16[ee+8]=B,this.uint16[ee+9]=q,n}}Wh.prototype.bytesPerElement=20,ni("StructArrayLayout10ui20",Wh);class $c extends sn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(n,a,p,y,T,E,M,A,O,B,q,ee){const re=this.length;return this.resize(re+1),this.emplace(re,n,a,p,y,T,E,M,A,O,B,q,ee)}emplace(n,a,p,y,T,E,M,A,O,B,q,ee,re){const se=12*n;return this.int16[se+0]=a,this.int16[se+1]=p,this.int16[se+2]=y,this.int16[se+3]=T,this.uint16[se+4]=E,this.uint16[se+5]=M,this.uint16[se+6]=A,this.uint16[se+7]=O,this.int16[se+8]=B,this.int16[se+9]=q,this.int16[se+10]=ee,this.int16[se+11]=re,n}}$c.prototype.bytesPerElement=24,ni("StructArrayLayout4i4ui4i24",$c);class Yh extends sn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(n,a,p){const y=this.length;return this.resize(y+1),this.emplace(y,n,a,p)}emplace(n,a,p,y){const T=3*n;return this.float32[T+0]=a,this.float32[T+1]=p,this.float32[T+2]=y,n}}Yh.prototype.bytesPerElement=12,ni("StructArrayLayout3f12",Yh);class b extends sn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(n){const a=this.length;return this.resize(a+1),this.emplace(a,n)}emplace(n,a){return this.uint32[1*n+0]=a,n}}b.prototype.bytesPerElement=4,ni("StructArrayLayout1ul4",b);class t extends sn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(n,a,p,y,T,E,M,A,O){const B=this.length;return this.resize(B+1),this.emplace(B,n,a,p,y,T,E,M,A,O)}emplace(n,a,p,y,T,E,M,A,O,B){const q=10*n,ee=5*n;return this.int16[q+0]=a,this.int16[q+1]=p,this.int16[q+2]=y,this.int16[q+3]=T,this.int16[q+4]=E,this.int16[q+5]=M,this.uint32[ee+3]=A,this.uint16[q+8]=O,this.uint16[q+9]=B,n}}t.prototype.bytesPerElement=20,ni("StructArrayLayout6i1ul2ui20",t);class l extends sn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(n,a,p,y,T,E){const M=this.length;return this.resize(M+1),this.emplace(M,n,a,p,y,T,E)}emplace(n,a,p,y,T,E,M){const A=6*n;return this.int16[A+0]=a,this.int16[A+1]=p,this.int16[A+2]=y,this.int16[A+3]=T,this.int16[A+4]=E,this.int16[A+5]=M,n}}l.prototype.bytesPerElement=12,ni("StructArrayLayout2i2i2i12",l);class f extends sn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(n,a,p,y,T){const E=this.length;return this.resize(E+1),this.emplace(E,n,a,p,y,T)}emplace(n,a,p,y,T,E){const M=4*n,A=8*n;return this.float32[M+0]=a,this.float32[M+1]=p,this.float32[M+2]=y,this.int16[A+6]=T,this.int16[A+7]=E,n}}f.prototype.bytesPerElement=16,ni("StructArrayLayout2f1f2i16",f);class g extends sn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(n,a,p,y,T,E){const M=this.length;return this.resize(M+1),this.emplace(M,n,a,p,y,T,E)}emplace(n,a,p,y,T,E,M){const A=16*n,O=4*n,B=8*n;return this.uint8[A+0]=a,this.uint8[A+1]=p,this.float32[O+1]=y,this.float32[O+2]=T,this.int16[B+6]=E,this.int16[B+7]=M,n}}g.prototype.bytesPerElement=16,ni("StructArrayLayout2ub2f2i16",g);class w extends sn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(n,a,p){const y=this.length;return this.resize(y+1),this.emplace(y,n,a,p)}emplace(n,a,p,y){const T=3*n;return this.uint16[T+0]=a,this.uint16[T+1]=p,this.uint16[T+2]=y,n}}w.prototype.bytesPerElement=6,ni("StructArrayLayout3ui6",w);class I extends sn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(n,a,p,y,T,E,M,A,O,B,q,ee,re,se,ce,be,Me){const Xe=this.length;return this.resize(Xe+1),this.emplace(Xe,n,a,p,y,T,E,M,A,O,B,q,ee,re,se,ce,be,Me)}emplace(n,a,p,y,T,E,M,A,O,B,q,ee,re,se,ce,be,Me,Xe){const ze=24*n,ie=12*n,xe=48*n;return this.int16[ze+0]=a,this.int16[ze+1]=p,this.uint16[ze+2]=y,this.uint16[ze+3]=T,this.uint32[ie+2]=E,this.uint32[ie+3]=M,this.uint32[ie+4]=A,this.uint16[ze+10]=O,this.uint16[ze+11]=B,this.uint16[ze+12]=q,this.float32[ie+7]=ee,this.float32[ie+8]=re,this.uint8[xe+36]=se,this.uint8[xe+37]=ce,this.uint8[xe+38]=be,this.uint32[ie+10]=Me,this.int16[ze+22]=Xe,n}}I.prototype.bytesPerElement=48,ni("StructArrayLayout2i2ui3ul3ui2f3ub1ul1i48",I);class k extends sn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(n,a,p,y,T,E,M,A,O,B,q,ee,re,se,ce,be,Me,Xe,ze,ie,xe,Ge,mt,Lt,xt,wt,Gt,At){const $t=this.length;return this.resize($t+1),this.emplace($t,n,a,p,y,T,E,M,A,O,B,q,ee,re,se,ce,be,Me,Xe,ze,ie,xe,Ge,mt,Lt,xt,wt,Gt,At)}emplace(n,a,p,y,T,E,M,A,O,B,q,ee,re,se,ce,be,Me,Xe,ze,ie,xe,Ge,mt,Lt,xt,wt,Gt,At,$t){const Et=32*n,di=16*n;return this.int16[Et+0]=a,this.int16[Et+1]=p,this.int16[Et+2]=y,this.int16[Et+3]=T,this.int16[Et+4]=E,this.int16[Et+5]=M,this.int16[Et+6]=A,this.int16[Et+7]=O,this.uint16[Et+8]=B,this.uint16[Et+9]=q,this.uint16[Et+10]=ee,this.uint16[Et+11]=re,this.uint16[Et+12]=se,this.uint16[Et+13]=ce,this.uint16[Et+14]=be,this.uint16[Et+15]=Me,this.uint16[Et+16]=Xe,this.uint16[Et+17]=ze,this.uint16[Et+18]=ie,this.uint16[Et+19]=xe,this.uint16[Et+20]=Ge,this.uint16[Et+21]=mt,this.uint16[Et+22]=Lt,this.uint32[di+12]=xt,this.float32[di+13]=wt,this.float32[di+14]=Gt,this.uint16[Et+30]=At,this.uint16[Et+31]=$t,n}}k.prototype.bytesPerElement=64,ni("StructArrayLayout8i15ui1ul2f2ui64",k);class R extends sn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(n){const a=this.length;return this.resize(a+1),this.emplace(a,n)}emplace(n,a){return this.float32[1*n+0]=a,n}}R.prototype.bytesPerElement=4,ni("StructArrayLayout1f4",R);class z extends sn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(n,a,p){const y=this.length;return this.resize(y+1),this.emplace(y,n,a,p)}emplace(n,a,p,y){const T=3*n;return this.uint16[6*n+0]=a,this.float32[T+1]=p,this.float32[T+2]=y,n}}z.prototype.bytesPerElement=12,ni("StructArrayLayout1ui2f12",z);class G extends sn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(n,a,p){const y=this.length;return this.resize(y+1),this.emplace(y,n,a,p)}emplace(n,a,p,y){const T=4*n;return this.uint32[2*n+0]=a,this.uint16[T+2]=p,this.uint16[T+3]=y,n}}G.prototype.bytesPerElement=8,ni("StructArrayLayout1ul2ui8",G);class X extends sn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(n,a){const p=this.length;return this.resize(p+1),this.emplace(p,n,a)}emplace(n,a,p){const y=2*n;return this.uint16[y+0]=a,this.uint16[y+1]=p,n}}X.prototype.bytesPerElement=4,ni("StructArrayLayout2ui4",X);class W extends sn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(n){const a=this.length;return this.resize(a+1),this.emplace(a,n)}emplace(n,a){return this.uint16[1*n+0]=a,n}}W.prototype.bytesPerElement=2,ni("StructArrayLayout1ui2",W);class te extends sn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(n,a,p,y){const T=this.length;return this.resize(T+1),this.emplace(T,n,a,p,y)}emplace(n,a,p,y,T){const E=4*n;return this.float32[E+0]=a,this.float32[E+1]=p,this.float32[E+2]=y,this.float32[E+3]=T,n}}te.prototype.bytesPerElement=16,ni("StructArrayLayout4f16",te);class ae extends xl{get anchorPointX(){return this._structArray.int16[this._pos2+0]}get anchorPointY(){return this._structArray.int16[this._pos2+1]}get x1(){return this._structArray.int16[this._pos2+2]}get y1(){return this._structArray.int16[this._pos2+3]}get x2(){return this._structArray.int16[this._pos2+4]}get y2(){return this._structArray.int16[this._pos2+5]}get featureIndex(){return this._structArray.uint32[this._pos4+3]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+8]}get bucketIndex(){return this._structArray.uint16[this._pos2+9]}get anchorPoint(){return new H(this.anchorPointX,this.anchorPointY)}}ae.prototype.size=20;class Te extends t{get(n){return new ae(this,n)}}ni("CollisionBoxArray",Te);class we extends xl{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+2]}get numGlyphs(){return this._structArray.uint16[this._pos2+3]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+2]}get lineStartIndex(){return this._structArray.uint32[this._pos4+3]}get lineLength(){return this._structArray.uint32[this._pos4+4]}get segment(){return this._structArray.uint16[this._pos2+10]}get lowerSize(){return this._structArray.uint16[this._pos2+11]}get upperSize(){return this._structArray.uint16[this._pos2+12]}get lineOffsetX(){return this._structArray.float32[this._pos4+7]}get lineOffsetY(){return this._structArray.float32[this._pos4+8]}get writingMode(){return this._structArray.uint8[this._pos1+36]}get placedOrientation(){return this._structArray.uint8[this._pos1+37]}set placedOrientation(n){this._structArray.uint8[this._pos1+37]=n}get hidden(){return this._structArray.uint8[this._pos1+38]}set hidden(n){this._structArray.uint8[this._pos1+38]=n}get crossTileID(){return this._structArray.uint32[this._pos4+10]}set crossTileID(n){this._structArray.uint32[this._pos4+10]=n}get associatedIconIndex(){return this._structArray.int16[this._pos2+22]}}we.prototype.size=48;class Ee extends I{get(n){return new we(this,n)}}ni("PlacedSymbolArray",Ee);class Ce extends xl{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+2]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+3]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+4]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+5]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+6]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+7]}get key(){return this._structArray.uint16[this._pos2+8]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+9]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+10]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+11]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+12]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+13]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+14]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+15]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+16]}get featureIndex(){return this._structArray.uint16[this._pos2+17]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+18]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+19]}get numIconVertices(){return this._structArray.uint16[this._pos2+20]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+21]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+22]}get crossTileID(){return this._structArray.uint32[this._pos4+12]}set crossTileID(n){this._structArray.uint32[this._pos4+12]=n}get textBoxScale(){return this._structArray.float32[this._pos4+13]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+14]}get textAnchorOffsetStartIndex(){return this._structArray.uint16[this._pos2+30]}get textAnchorOffsetEndIndex(){return this._structArray.uint16[this._pos2+31]}}Ce.prototype.size=64;class Fe extends k{get(n){return new Ce(this,n)}}ni("SymbolInstanceArray",Fe);class Oe extends R{getoffsetX(n){return this.float32[1*n+0]}}ni("GlyphOffsetArray",Oe);class Ue extends Ya{getx(n){return this.int16[3*n+0]}gety(n){return this.int16[3*n+1]}gettileUnitDistanceFromAnchor(n){return this.int16[3*n+2]}}ni("SymbolLineVertexArray",Ue);class We extends xl{get textAnchor(){return this._structArray.uint16[this._pos2+0]}get textOffset0(){return this._structArray.float32[this._pos4+1]}get textOffset1(){return this._structArray.float32[this._pos4+2]}}We.prototype.size=12;class De extends z{get(n){return new We(this,n)}}ni("TextAnchorOffsetArray",De);class Qe extends xl{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}}Qe.prototype.size=8;class yt extends G{get(n){return new Qe(this,n)}}ni("FeatureIndexArray",yt);class ct extends Wa{}class dt extends Wa{}class _t extends Wa{}class qt extends Bc{}class Vt extends bl{}class kt extends Ku{}class hi extends Wh{}class Ji extends $c{}class Pr extends Yh{}class on extends b{}class zr extends l{}class an extends g{}class Gr extends w{}class Br extends X{}const Ur=mn([{name:"a_pos",components:2,type:"Int16"}],4),{members:ds}=Ur;class xr{constructor(n=[]){this._forceNewSegmentOnNextPrepare=!1,this.segments=n}prepareSegment(n,a,p,y){const T=this.segments[this.segments.length-1];return n>xr.MAX_VERTEX_ARRAY_LENGTH&&jr(`Max vertices per segment is ${xr.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${n}. Consider using the \`fillLargeMeshArrays\` function if you require meshes with more than ${xr.MAX_VERTEX_ARRAY_LENGTH} vertices.`),this._forceNewSegmentOnNextPrepare||!T||T.vertexLength+n>xr.MAX_VERTEX_ARRAY_LENGTH||T.sortKey!==y?this.createNewSegment(a,p,y):T}createNewSegment(n,a,p){const y={vertexOffset:n.length,primitiveOffset:a.length,vertexLength:0,primitiveLength:0,vaos:{}};return p!==void 0&&(y.sortKey=p),this._forceNewSegmentOnNextPrepare=!1,this.segments.push(y),y}getOrCreateLatestSegment(n,a,p){return this.prepareSegment(0,n,a,p)}forceNewSegmentOnNextPrepare(){this._forceNewSegmentOnNextPrepare=!0}get(){return this.segments}destroy(){for(const n of this.segments)for(const a in n.vaos)n.vaos[a].destroy()}static simpleSegment(n,a,p,y){return new xr([{vertexOffset:n,primitiveOffset:a,vertexLength:p,primitiveLength:y,vaos:{},sortKey:0}])}}function Jn(u,n){return 256*(u=Xi(Math.floor(u),0,255))+Xi(Math.floor(n),0,255)}xr.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,ni("SegmentVector",xr);const Ts=mn([{name:"a_pattern_from",components:4,type:"Uint16"},{name:"a_pattern_to",components:4,type:"Uint16"},{name:"a_pixel_ratio_from",components:1,type:"Uint16"},{name:"a_pixel_ratio_to",components:1,type:"Uint16"}]);var Xa,Ha,Ka,la={exports:{}},Ju={exports:{}},Qu={exports:{}},pu=function(){if(Ka)return la.exports;Ka=1;var u=(Xa||(Xa=1,Ju.exports=function(a,p){var y,T,E,M,A,O,B,q;for(T=a.length-(y=3&a.length),E=p,A=3432918353,O=461845907,q=0;q<T;)B=255&a.charCodeAt(q)|(255&a.charCodeAt(++q))<<8|(255&a.charCodeAt(++q))<<16|(255&a.charCodeAt(++q))<<24,++q,E=27492+(65535&(M=5*(65535&(E=(E^=B=(65535&(B=(B=(65535&B)*A+(((B>>>16)*A&65535)<<16)&4294967295)<<15|B>>>17))*O+(((B>>>16)*O&65535)<<16)&4294967295)<<13|E>>>19))+((5*(E>>>16)&65535)<<16)&4294967295))+((58964+(M>>>16)&65535)<<16);switch(B=0,y){case 3:B^=(255&a.charCodeAt(q+2))<<16;case 2:B^=(255&a.charCodeAt(q+1))<<8;case 1:E^=B=(65535&(B=(B=(65535&(B^=255&a.charCodeAt(q)))*A+(((B>>>16)*A&65535)<<16)&4294967295)<<15|B>>>17))*O+(((B>>>16)*O&65535)<<16)&4294967295}return E^=a.length,E=2246822507*(65535&(E^=E>>>16))+((2246822507*(E>>>16)&65535)<<16)&4294967295,E=3266489909*(65535&(E^=E>>>13))+((3266489909*(E>>>16)&65535)<<16)&4294967295,(E^=E>>>16)>>>0}),Ju.exports),n=(Ha||(Ha=1,Qu.exports=function(a,p){for(var y,T=a.length,E=p^T,M=0;T>=4;)y=1540483477*(65535&(y=255&a.charCodeAt(M)|(255&a.charCodeAt(++M))<<8|(255&a.charCodeAt(++M))<<16|(255&a.charCodeAt(++M))<<24))+((1540483477*(y>>>16)&65535)<<16),E=1540483477*(65535&E)+((1540483477*(E>>>16)&65535)<<16)^(y=1540483477*(65535&(y^=y>>>24))+((1540483477*(y>>>16)&65535)<<16)),T-=4,++M;switch(T){case 3:E^=(255&a.charCodeAt(M+2))<<16;case 2:E^=(255&a.charCodeAt(M+1))<<8;case 1:E=1540483477*(65535&(E^=255&a.charCodeAt(M)))+((1540483477*(E>>>16)&65535)<<16)}return E=1540483477*(65535&(E^=E>>>13))+((1540483477*(E>>>16)&65535)<<16),(E^=E>>>15)>>>0}),Qu.exports);return la.exports=u,la.exports.murmur3=u,la.exports.murmur2=n,la.exports}(),Ws=P(pu);class Fo{constructor(){this.ids=[],this.positions=[],this.indexed=!1}add(n,a,p,y){this.ids.push(Ja(n)),this.positions.push(a,p,y)}getPositions(n){if(!this.indexed)throw new Error("Trying to get index, but feature positions are not indexed");const a=Ja(n);let p=0,y=this.ids.length-1;for(;p<y;){const E=p+y>>1;this.ids[E]>=a?y=E:p=E+1}const T=[];for(;this.ids[p]===a;)T.push({index:this.positions[3*p],start:this.positions[3*p+1],end:this.positions[3*p+2]}),p++;return T}static serialize(n,a){const p=new Float64Array(n.ids),y=new Uint32Array(n.positions);return wl(p,y,0,p.length-1),a&&a.push(p.buffer,y.buffer),{ids:p,positions:y}}static deserialize(n){const a=new Fo;return a.ids=n.ids,a.positions=n.positions,a.indexed=!0,a}}function Ja(u){const n=+u;return!isNaN(n)&&n<=Number.MAX_SAFE_INTEGER?n:Ws(String(u))}function wl(u,n,a,p){for(;a<p;){const y=u[a+p>>1];let T=a-1,E=p+1;for(;;){do T++;while(u[T]<y);do E--;while(u[E]>y);if(T>=E)break;wn(u,T,E),wn(n,3*T,3*E),wn(n,3*T+1,3*E+1),wn(n,3*T+2,3*E+2)}E-a<p-E?(wl(u,n,a,E),a=E+1):(wl(u,n,E+1,p),p=E)}}function wn(u,n,a){const p=u[n];u[n]=u[a],u[a]=p}ni("FeaturePositionMap",Fo);class Xr{constructor(n,a){this.gl=n.gl,this.location=a}}class zs extends Xr{constructor(n,a){super(n,a),this.current=0}set(n){this.current!==n&&(this.current=n,this.gl.uniform1f(this.location,n))}}class Vn extends Xr{constructor(n,a){super(n,a),this.current=[0,0,0,0]}set(n){n[0]===this.current[0]&&n[1]===this.current[1]&&n[2]===this.current[2]&&n[3]===this.current[3]||(this.current=n,this.gl.uniform4f(this.location,n[0],n[1],n[2],n[3]))}}class zp extends Xr{constructor(n,a){super(n,a),this.current=si.transparent}set(n){n.r===this.current.r&&n.g===this.current.g&&n.b===this.current.b&&n.a===this.current.a||(this.current=n,this.gl.uniform4f(this.location,n.r,n.g,n.b,n.a))}}const sg=new Float32Array(16);function Xh(u){return[Jn(255*u.r,255*u.g),Jn(255*u.b,255*u.a)]}class ec{constructor(n,a,p){this.value=n,this.uniformNames=a.map(y=>`u_${y}`),this.type=p}setUniform(n,a,p){n.set(p.constantOr(this.value))}getBinding(n,a,p){return this.type==="color"?new zp(n,a):new zs(n,a)}}class fu{constructor(n,a){this.uniformNames=a.map(p=>`u_${p}`),this.patternFrom=null,this.patternTo=null,this.pixelRatioFrom=1,this.pixelRatioTo=1}setConstantPatternPositions(n,a){this.pixelRatioFrom=a.pixelRatio,this.pixelRatioTo=n.pixelRatio,this.patternFrom=a.tlbr,this.patternTo=n.tlbr}setUniform(n,a,p,y){const T=y==="u_pattern_to"?this.patternTo:y==="u_pattern_from"?this.patternFrom:y==="u_pixel_ratio_to"?this.pixelRatioTo:y==="u_pixel_ratio_from"?this.pixelRatioFrom:null;T&&n.set(T)}getBinding(n,a,p){return p.substr(0,9)==="u_pattern"?new Vn(n,a):new zs(n,a)}}class wa{constructor(n,a,p,y){this.expression=n,this.type=p,this.maxValue=0,this.paintVertexAttributes=a.map(T=>({name:`a_${T}`,type:"Float32",components:p==="color"?2:1,offset:0})),this.paintVertexArray=new y}populatePaintArray(n,a,p,y,T){const E=this.paintVertexArray.length,M=this.expression.evaluate(new en(0),a,{},y,[],T);this.paintVertexArray.resize(n),this._setPaintValue(E,n,M)}updatePaintArray(n,a,p,y){const T=this.expression.evaluate({zoom:0},p,y);this._setPaintValue(n,a,T)}_setPaintValue(n,a,p){if(this.type==="color"){const y=Xh(p);for(let T=n;T<a;T++)this.paintVertexArray.emplace(T,y[0],y[1])}else{for(let y=n;y<a;y++)this.paintVertexArray.emplace(y,p);this.maxValue=Math.max(this.maxValue,Math.abs(p))}}upload(n){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=n.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class ps{constructor(n,a,p,y,T,E){this.expression=n,this.uniformNames=a.map(M=>`u_${M}_t`),this.type=p,this.useIntegerZoom=y,this.zoom=T,this.maxValue=0,this.paintVertexAttributes=a.map(M=>({name:`a_${M}`,type:"Float32",components:p==="color"?4:2,offset:0})),this.paintVertexArray=new E}populatePaintArray(n,a,p,y,T){const E=this.expression.evaluate(new en(this.zoom),a,{},y,[],T),M=this.expression.evaluate(new en(this.zoom+1),a,{},y,[],T),A=this.paintVertexArray.length;this.paintVertexArray.resize(n),this._setPaintValue(A,n,E,M)}updatePaintArray(n,a,p,y){const T=this.expression.evaluate({zoom:this.zoom},p,y),E=this.expression.evaluate({zoom:this.zoom+1},p,y);this._setPaintValue(n,a,T,E)}_setPaintValue(n,a,p,y){if(this.type==="color"){const T=Xh(p),E=Xh(y);for(let M=n;M<a;M++)this.paintVertexArray.emplace(M,T[0],T[1],E[0],E[1])}else{for(let T=n;T<a;T++)this.paintVertexArray.emplace(T,p,y);this.maxValue=Math.max(this.maxValue,Math.abs(p),Math.abs(y))}}upload(n){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=n.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(n,a){const p=this.useIntegerZoom?Math.floor(a.zoom):a.zoom,y=Xi(this.expression.interpolationFactor(p,this.zoom,this.zoom+1),0,1);n.set(y)}getBinding(n,a,p){return new zs(n,a)}}class Ta{constructor(n,a,p,y,T,E){this.expression=n,this.type=a,this.useIntegerZoom=p,this.zoom=y,this.layerId=E,this.zoomInPaintVertexArray=new T,this.zoomOutPaintVertexArray=new T}populatePaintArray(n,a,p){const y=this.zoomInPaintVertexArray.length;this.zoomInPaintVertexArray.resize(n),this.zoomOutPaintVertexArray.resize(n),this._setPaintValues(y,n,a.patterns&&a.patterns[this.layerId],p)}updatePaintArray(n,a,p,y,T){this._setPaintValues(n,a,p.patterns&&p.patterns[this.layerId],T)}_setPaintValues(n,a,p,y){if(!y||!p)return;const{min:T,mid:E,max:M}=p,A=y[T],O=y[E],B=y[M];if(A&&O&&B)for(let q=n;q<a;q++)this.zoomInPaintVertexArray.emplace(q,O.tl[0],O.tl[1],O.br[0],O.br[1],A.tl[0],A.tl[1],A.br[0],A.br[1],O.pixelRatio,A.pixelRatio),this.zoomOutPaintVertexArray.emplace(q,O.tl[0],O.tl[1],O.br[0],O.br[1],B.tl[0],B.tl[1],B.br[0],B.br[1],O.pixelRatio,B.pixelRatio)}upload(n){this.zoomInPaintVertexArray&&this.zoomInPaintVertexArray.arrayBuffer&&this.zoomOutPaintVertexArray&&this.zoomOutPaintVertexArray.arrayBuffer&&(this.zoomInPaintVertexBuffer=n.createVertexBuffer(this.zoomInPaintVertexArray,Ts.members,this.expression.isStateDependent),this.zoomOutPaintVertexBuffer=n.createVertexBuffer(this.zoomOutPaintVertexArray,Ts.members,this.expression.isStateDependent))}destroy(){this.zoomOutPaintVertexBuffer&&this.zoomOutPaintVertexBuffer.destroy(),this.zoomInPaintVertexBuffer&&this.zoomInPaintVertexBuffer.destroy()}}class Hh{constructor(n,a,p){this.binders={},this._buffers=[];const y=[];for(const T in n.paint._values){if(!p(T))continue;const E=n.paint.get(T);if(!(E instanceof aa&&qs(E.property.specification)))continue;const M=Kh(T,n.type),A=E.value,O=E.property.specification.type,B=E.property.useIntegerZoom,q=E.property.specification["property-type"],ee=q==="cross-faded"||q==="cross-faded-data-driven";if(A.kind==="constant")this.binders[T]=ee?new fu(A.value,M):new ec(A.value,M,O),y.push(`/u_${T}`);else if(A.kind==="source"||ee){const re=Jh(T,O,"source");this.binders[T]=ee?new Ta(A,O,B,a,re,n.id):new wa(A,M,O,re),y.push(`/a_${T}`)}else{const re=Jh(T,O,"composite");this.binders[T]=new ps(A,M,O,B,a,re),y.push(`/z_${T}`)}}this.cacheKey=y.sort().join("")}getMaxValue(n){const a=this.binders[n];return a instanceof wa||a instanceof ps?a.maxValue:0}populatePaintArrays(n,a,p,y,T){for(const E in this.binders){const M=this.binders[E];(M instanceof wa||M instanceof ps||M instanceof Ta)&&M.populatePaintArray(n,a,p,y,T)}}setConstantPatternPositions(n,a){for(const p in this.binders){const y=this.binders[p];y instanceof fu&&y.setConstantPatternPositions(n,a)}}updatePaintArrays(n,a,p,y,T){let E=!1;for(const M in n){const A=a.getPositions(M);for(const O of A){const B=p.feature(O.index);for(const q in this.binders){const ee=this.binders[q];if((ee instanceof wa||ee instanceof ps||ee instanceof Ta)&&ee.expression.isStateDependent===!0){const re=y.paint.get(q);ee.expression=re.value,ee.updatePaintArray(O.start,O.end,B,n[M],T),E=!0}}}}return E}defines(){const n=[];for(const a in this.binders){const p=this.binders[a];(p instanceof ec||p instanceof fu)&&n.push(...p.uniformNames.map(y=>`#define HAS_UNIFORM_${y}`))}return n}getBinderAttributes(){const n=[];for(const a in this.binders){const p=this.binders[a];if(p instanceof wa||p instanceof ps)for(let y=0;y<p.paintVertexAttributes.length;y++)n.push(p.paintVertexAttributes[y].name);else if(p instanceof Ta)for(let y=0;y<Ts.members.length;y++)n.push(Ts.members[y].name)}return n}getBinderUniforms(){const n=[];for(const a in this.binders){const p=this.binders[a];if(p instanceof ec||p instanceof fu||p instanceof ps)for(const y of p.uniformNames)n.push(y)}return n}getPaintVertexBuffers(){return this._buffers}getUniforms(n,a){const p=[];for(const y in this.binders){const T=this.binders[y];if(T instanceof ec||T instanceof fu||T instanceof ps){for(const E of T.uniformNames)if(a[E]){const M=T.getBinding(n,a[E],E);p.push({name:E,property:y,binding:M})}}}return p}setUniforms(n,a,p,y){for(const{name:T,property:E,binding:M}of a)this.binders[E].setUniform(M,y,p.get(E),T)}updatePaintBuffers(n){this._buffers=[];for(const a in this.binders){const p=this.binders[a];if(n&&p instanceof Ta){const y=n.fromScale===2?p.zoomInPaintVertexBuffer:p.zoomOutPaintVertexBuffer;y&&this._buffers.push(y)}else(p instanceof wa||p instanceof ps)&&p.paintVertexBuffer&&this._buffers.push(p.paintVertexBuffer)}}upload(n){for(const a in this.binders){const p=this.binders[a];(p instanceof wa||p instanceof ps||p instanceof Ta)&&p.upload(n)}this.updatePaintBuffers()}destroy(){for(const n in this.binders){const a=this.binders[n];(a instanceof wa||a instanceof ps||a instanceof Ta)&&a.destroy()}}}class Qa{constructor(n,a,p=()=>!0){this.programConfigurations={};for(const y of n)this.programConfigurations[y.id]=new Hh(y,a,p);this.needsUpload=!1,this._featureMap=new Fo,this._bufferOffset=0}populatePaintArrays(n,a,p,y,T,E){for(const M in this.programConfigurations)this.programConfigurations[M].populatePaintArrays(n,a,y,T,E);a.id!==void 0&&this._featureMap.add(a.id,p,this._bufferOffset,n),this._bufferOffset=n,this.needsUpload=!0}updatePaintArrays(n,a,p,y){for(const T of p)this.needsUpload=this.programConfigurations[T.id].updatePaintArrays(n,this._featureMap,a,T,y)||this.needsUpload}get(n){return this.programConfigurations[n]}upload(n){if(this.needsUpload){for(const a in this.programConfigurations)this.programConfigurations[a].upload(n);this.needsUpload=!1}}destroy(){for(const n in this.programConfigurations)this.programConfigurations[n].destroy()}}function Kh(u,n){return{"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-extrusion-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"]}[u]||[u.replace(`${n}-`,"").replace(/-/g,"_")]}function Jh(u,n,a){const p={color:{source:Ku,composite:te},number:{source:R,composite:Ku}},y=function(T){return{"line-pattern":{source:hi,composite:hi},"fill-pattern":{source:hi,composite:hi},"fill-extrusion-pattern":{source:hi,composite:hi}}[T]}(u);return y&&y[a]||p[n][a]}ni("ConstantBinder",ec),ni("CrossFadedConstantBinder",fu),ni("SourceExpressionBinder",wa),ni("CrossFadedCompositeBinder",Ta),ni("CompositeExpressionBinder",ps),ni("ProgramConfiguration",Hh,{omit:["_buffers"]}),ni("ProgramConfigurationSet",Qa);const tc=Math.pow(2,14)-1,iv=-tc-1;function ic(u){const n=It/u.extent,a=u.loadGeometry();for(let p=0;p<a.length;p++){const y=a[p];for(let T=0;T<y.length;T++){const E=y[T],M=Math.round(E.x*n),A=Math.round(E.y*n);E.x=Xi(M,iv,tc),E.y=Xi(A,iv,tc),(M<E.x||M>E.x+1||A<E.y||A>E.y+1)&&jr("Geometry exceeds allowed extent, reduce your vector tile buffer size")}}return a}function rc(u,n){return{type:u.type,id:u.id,properties:u.properties,geometry:n?ic(u):[]}}const rv=-32768;function d2(u,n,a,p,y){u.emplaceBack(rv+8*n+p,rv+8*a+y)}class og{constructor(n){this.zoom=n.zoom,this.globalState=n.globalState,this.overscaling=n.overscaling,this.layers=n.layers,this.layerIds=this.layers.map(a=>a.id),this.index=n.index,this.hasPattern=!1,this.layoutVertexArray=new dt,this.indexArray=new Gr,this.segments=new xr,this.programConfigurations=new Qa(n.layers,n.zoom),this.stateDependentLayerIds=this.layers.filter(a=>a.isStateDependent()).map(a=>a.id)}populate(n,a,p){const y=this.layers[0],T=[];let E=null,M=!1,A=y.type==="heatmap";if(y.type==="circle"){const B=y;E=B.layout.get("circle-sort-key"),M=!E.isConstant(),A=A||B.paint.get("circle-pitch-alignment")==="map"}const O=A?a.subdivisionGranularity.circle:1;for(const{feature:B,id:q,index:ee,sourceLayerIndex:re}of n){const se=this.layers[0]._featureFilter.needGeometry,ce=rc(B,se);if(!this.layers[0]._featureFilter.filter(new en(this.zoom,{globalState:this.globalState}),ce,p))continue;const be=M?E.evaluate(ce,{},p):void 0,Me={id:q,properties:B.properties,type:B.type,sourceLayerIndex:re,index:ee,geometry:se?ce.geometry:ic(B),patterns:{},sortKey:be};T.push(Me)}M&&T.sort((B,q)=>B.sortKey-q.sortKey);for(const B of T){const{geometry:q,index:ee,sourceLayerIndex:re}=B,se=n[ee].feature;this.addFeature(B,q,ee,p,O),a.featureIndex.insert(se,q,ee,re,this.index)}}update(n,a,p){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(n,a,this.stateDependentLayers,p)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(n){this.uploaded||(this.layoutVertexBuffer=n.createVertexBuffer(this.layoutVertexArray,ds),this.indexBuffer=n.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(n),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(n,a,p,y,T=1){let E;switch(T){case 1:E=[0,7];break;case 3:E=[0,2,5,7];break;case 5:E=[0,1,3,4,6,7];break;case 7:E=[0,1,2,3,4,5,6,7];break;default:throw new Error(`Invalid circle bucket granularity: ${T}; valid values are 1, 3, 5, 7.`)}const M=E.length;for(const A of a)for(const O of A){const B=O.x,q=O.y;if(B<0||B>=It||q<0||q>=It)continue;const ee=this.segments.prepareSegment(M*M,this.layoutVertexArray,this.indexArray,n.sortKey),re=ee.vertexLength;for(let se=0;se<M;se++)for(let ce=0;ce<M;ce++)d2(this.layoutVertexArray,B,q,E[ce],E[se]);for(let se=0;se<M-1;se++)for(let ce=0;ce<M-1;ce++){const be=re+se*M+ce,Me=re+(se+1)*M+ce;this.indexArray.emplaceBack(be,Me+1,be+1),this.indexArray.emplaceBack(be,Me,Me+1)}ee.vertexLength+=M*M,ee.primitiveLength+=(M-1)*(M-1)*2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,n,p,{},y)}}function nv(u,n){for(let a=0;a<u.length;a++)if(jc(n,u[a]))return!0;for(let a=0;a<n.length;a++)if(jc(u,n[a]))return!0;return!!ag(u,n)}function p2(u,n,a){return!!jc(u,n)||!!lg(n,u,a)}function sv(u,n){if(u.length===1)return av(n,u[0]);for(let a=0;a<n.length;a++){const p=n[a];for(let y=0;y<p.length;y++)if(jc(u,p[y]))return!0}for(let a=0;a<u.length;a++)if(av(n,u[a]))return!0;for(let a=0;a<n.length;a++)if(ag(u,n[a]))return!0;return!1}function f2(u,n,a){if(u.length>1){if(ag(u,n))return!0;for(let p=0;p<n.length;p++)if(lg(n[p],u,a))return!0}for(let p=0;p<u.length;p++)if(lg(u[p],n,a))return!0;return!1}function ag(u,n){if(u.length===0||n.length===0)return!1;for(let a=0;a<u.length-1;a++){const p=u[a],y=u[a+1];for(let T=0;T<n.length-1;T++)if(m2(p,y,n[T],n[T+1]))return!0}return!1}function m2(u,n,a,p){return En(u,a,p)!==En(n,a,p)&&En(u,n,a)!==En(u,n,p)}function lg(u,n,a){const p=a*a;if(n.length===1)return u.distSqr(n[0])<p;for(let y=1;y<n.length;y++)if(ov(u,n[y-1],n[y])<p)return!0;return!1}function ov(u,n,a){const p=n.distSqr(a);if(p===0)return u.distSqr(n);const y=((u.x-n.x)*(a.x-n.x)+(u.y-n.y)*(a.y-n.y))/p;return u.distSqr(y<0?n:y>1?a:a.sub(n)._mult(y)._add(n))}function av(u,n){let a,p,y,T=!1;for(let E=0;E<u.length;E++){a=u[E];for(let M=0,A=a.length-1;M<a.length;A=M++)p=a[M],y=a[A],p.y>n.y!=y.y>n.y&&n.x<(y.x-p.x)*(n.y-p.y)/(y.y-p.y)+p.x&&(T=!T)}return T}function jc(u,n){let a=!1;for(let p=0,y=u.length-1;p<u.length;y=p++){const T=u[p],E=u[y];T.y>n.y!=E.y>n.y&&n.x<(E.x-T.x)*(n.y-T.y)/(E.y-T.y)+T.x&&(a=!a)}return a}function g2(u,n,a){const p=a[0],y=a[2];if(u.x<p.x&&n.x<p.x||u.x>y.x&&n.x>y.x||u.y<p.y&&n.y<p.y||u.y>y.y&&n.y>y.y)return!1;const T=En(u,n,a[0]);return T!==En(u,n,a[1])||T!==En(u,n,a[2])||T!==En(u,n,a[3])}function Qh(u,n,a){const p=n.paint.get(u).value;return p.kind==="constant"?p.value:a.programConfigurations.get(n.id).getMaxValue(u)}function Bp(u){return Math.sqrt(u[0]*u[0]+u[1]*u[1])}function $p(u,n,a,p,y){if(!n[0]&&!n[1])return u;const T=H.convert(n)._mult(y);a==="viewport"&&T._rotate(-p);const E=[];for(let M=0;M<u.length;M++)E.push(u[M].sub(T));return E}let lv,uv;ni("CircleBucket",og,{omit:["layers"]});var y2={get paint(){return uv=uv||new Fs({"circle-radius":new Fi(Ve.paint_circle["circle-radius"]),"circle-color":new Fi(Ve.paint_circle["circle-color"]),"circle-blur":new Fi(Ve.paint_circle["circle-blur"]),"circle-opacity":new Fi(Ve.paint_circle["circle-opacity"]),"circle-translate":new mi(Ve.paint_circle["circle-translate"]),"circle-translate-anchor":new mi(Ve.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new mi(Ve.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new mi(Ve.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new Fi(Ve.paint_circle["circle-stroke-width"]),"circle-stroke-color":new Fi(Ve.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new Fi(Ve.paint_circle["circle-stroke-opacity"])})},get layout(){return lv=lv||new Fs({"circle-sort-key":new Fi(Ve.layout_circle["circle-sort-key"])})}};class _2 extends hs{constructor(n){super(n,y2)}createBucket(n){return new og(n)}queryRadius(n){const a=n;return Qh("circle-radius",this,a)+Qh("circle-stroke-width",this,a)+Bp(this.paint.get("circle-translate"))}queryIntersectsFeature({queryGeometry:n,feature:a,featureState:p,geometry:y,transform:T,pixelsToTileUnits:E,unwrappedTileID:M,getElevation:A}){const O=$p(n,this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),-T.bearingInRadians,E),B=this.paint.get("circle-radius").evaluate(a,p)+this.paint.get("circle-stroke-width").evaluate(a,p),q=this.paint.get("circle-pitch-alignment")==="map",ee=q?O:function(se,ce,be,Me){return se.map(Xe=>cv(Xe,ce,be,Me))}(O,T,M,A),re=q?B*E:B;for(const se of y)for(const ce of se){const be=q?ce:cv(ce,T,M,A);let Me=re;const Xe=T.projectTileCoordinates(ce.x,ce.y,M,A).signedDistanceFromCamera;if(this.paint.get("circle-pitch-scale")==="viewport"&&this.paint.get("circle-pitch-alignment")==="map"?Me*=Xe/T.cameraToCenterDistance:this.paint.get("circle-pitch-scale")==="map"&&this.paint.get("circle-pitch-alignment")==="viewport"&&(Me*=T.cameraToCenterDistance/Xe),p2(ee,be,Me))return!0}return!1}}function cv(u,n,a,p){const y=n.projectTileCoordinates(u.x,u.y,a,p).point;return new H((.5*y.x+.5)*n.width,(.5*-y.y+.5)*n.height)}class hv extends og{}let dv;ni("HeatmapBucket",hv,{omit:["layers"]});var v2={get paint(){return dv=dv||new Fs({"heatmap-radius":new Fi(Ve.paint_heatmap["heatmap-radius"]),"heatmap-weight":new Fi(Ve.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new mi(Ve.paint_heatmap["heatmap-intensity"]),"heatmap-color":new Hu(Ve.paint_heatmap["heatmap-color"]),"heatmap-opacity":new mi(Ve.paint_heatmap["heatmap-opacity"])})}};function ug(u,{width:n,height:a},p,y){if(y){if(y instanceof Uint8ClampedArray)y=new Uint8Array(y.buffer);else if(y.length!==n*a*p)throw new RangeError(`mismatched image size. expected: ${y.length} but got: ${n*a*p}`)}else y=new Uint8Array(n*a*p);return u.width=n,u.height=a,u.data=y,u}function pv(u,{width:n,height:a},p){if(n===u.width&&a===u.height)return;const y=ug({},{width:n,height:a},p);cg(u,y,{x:0,y:0},{x:0,y:0},{width:Math.min(u.width,n),height:Math.min(u.height,a)},p),u.width=n,u.height=a,u.data=y.data}function cg(u,n,a,p,y,T){if(y.width===0||y.height===0)return n;if(y.width>u.width||y.height>u.height||a.x>u.width-y.width||a.y>u.height-y.height)throw new RangeError("out of range source coordinates for image copy");if(y.width>n.width||y.height>n.height||p.x>n.width-y.width||p.y>n.height-y.height)throw new RangeError("out of range destination coordinates for image copy");const E=u.data,M=n.data;if(E===M)throw new Error("srcData equals dstData, so image is already copied");for(let A=0;A<y.height;A++){const O=((a.y+A)*u.width+a.x)*T,B=((p.y+A)*n.width+p.x)*T;for(let q=0;q<y.width*T;q++)M[B+q]=E[O+q]}return n}class ed{constructor(n,a){ug(this,n,1,a)}resize(n){pv(this,n,1)}clone(){return new ed({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(n,a,p,y,T){cg(n,a,p,y,T,1)}}class so{constructor(n,a){ug(this,n,4,a)}resize(n){pv(this,n,4)}replace(n,a){a?this.data.set(n):this.data=n instanceof Uint8ClampedArray?new Uint8Array(n.buffer):n}clone(){return new so({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(n,a,p,y,T){cg(n,a,p,y,T,4)}setPixel(n,a,p){const y=4*(n*this.width+a);this.data[y+0]=Math.round(255*p.r/p.a),this.data[y+1]=Math.round(255*p.g/p.a),this.data[y+2]=Math.round(255*p.b/p.a),this.data[y+3]=Math.round(255*p.a)}}function fv(u){const n={},a=u.resolution||256,p=u.clips?u.clips.length:1,y=u.image||new so({width:a,height:p});if(Math.log(a)/Math.LN2%1!=0)throw new Error(`width is not a power of 2 - ${a}`);const T=(E,M,A)=>{n[u.evaluationKey]=A;const O=u.expression.evaluate(n);y.setPixel(E/4/a,M/4,O)};if(u.clips)for(let E=0,M=0;E<p;++E,M+=4*a)for(let A=0,O=0;A<a;A++,O+=4){const B=A/(a-1),{start:q,end:ee}=u.clips[E];T(M,O,q*(1-B)+ee*B)}else for(let E=0,M=0;E<a;E++,M+=4)T(0,M,E/(a-1));return y}ni("AlphaImage",ed),ni("RGBAImage",so);const hg="big-fb";class x2 extends hs{createBucket(n){return new hv(n)}constructor(n){super(n,v2),this.heatmapFbos=new Map,this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(n){n==="heatmap-color"&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=fv({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbos.has(hg)&&this.heatmapFbos.delete(hg)}queryRadius(){return 0}queryIntersectsFeature(){return!1}hasOffscreenPass(){return this.paint.get("heatmap-opacity")!==0&&this.visibility!=="none"}}let mv;var b2={get paint(){return mv=mv||new Fs({"hillshade-illumination-direction":new mi(Ve.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-altitude":new mi(Ve.paint_hillshade["hillshade-illumination-altitude"]),"hillshade-illumination-anchor":new mi(Ve.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new mi(Ve.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new mi(Ve.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new mi(Ve.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new mi(Ve.paint_hillshade["hillshade-accent-color"]),"hillshade-method":new mi(Ve.paint_hillshade["hillshade-method"])})}};class w2 extends hs{constructor(n){super(n,b2),this.recalculate({zoom:0,zoomHistory:{}},void 0)}getIlluminationProperties(){let n=this.paint.get("hillshade-illumination-direction").values,a=this.paint.get("hillshade-illumination-altitude").values,p=this.paint.get("hillshade-highlight-color").values,y=this.paint.get("hillshade-shadow-color").values;const T=Math.max(n.length,a.length,p.length,y.length);n=n.concat(Array(T-n.length).fill(n.at(-1))),a=a.concat(Array(T-a.length).fill(a.at(-1))),p=p.concat(Array(T-p.length).fill(p.at(-1))),y=y.concat(Array(T-y.length).fill(y.at(-1)));const E=a.map(rn);return{directionRadians:n.map(rn),altitudeRadians:E,shadowColor:y,highlightColor:p}}hasOffscreenPass(){return this.paint.get("hillshade-exaggeration")!==0&&this.visibility!=="none"}}let gv;var T2={get paint(){return gv=gv||new Fs({"color-relief-opacity":new mi(Ve["paint_color-relief"]["color-relief-opacity"]),"color-relief-color":new Hu(Ve["paint_color-relief"]["color-relief-color"])})}};class dg{constructor(n,a,p,y){this.context=n,this.format=p,this.texture=n.gl.createTexture(),this.update(a,y)}update(n,a,p){const{width:y,height:T}=n,E=!(this.size&&this.size[0]===y&&this.size[1]===T||p),{context:M}=this,{gl:A}=M;if(this.useMipmap=!!(a&&a.useMipmap),A.bindTexture(A.TEXTURE_2D,this.texture),M.pixelStoreUnpackFlipY.set(!1),M.pixelStoreUnpack.set(1),M.pixelStoreUnpackPremultiplyAlpha.set(this.format===A.RGBA&&(!a||a.premultiply!==!1)),E)this.size=[y,T],n instanceof HTMLImageElement||n instanceof HTMLCanvasElement||n instanceof HTMLVideoElement||n instanceof ImageData||xs(n)?A.texImage2D(A.TEXTURE_2D,0,this.format,this.format,A.UNSIGNED_BYTE,n):A.texImage2D(A.TEXTURE_2D,0,this.format,y,T,0,this.format,A.UNSIGNED_BYTE,n.data);else{const{x:O,y:B}=p||{x:0,y:0};n instanceof HTMLImageElement||n instanceof HTMLCanvasElement||n instanceof HTMLVideoElement||n instanceof ImageData||xs(n)?A.texSubImage2D(A.TEXTURE_2D,0,O,B,A.RGBA,A.UNSIGNED_BYTE,n):A.texSubImage2D(A.TEXTURE_2D,0,O,B,y,T,A.RGBA,A.UNSIGNED_BYTE,n.data)}this.useMipmap&&this.isSizePowerOfTwo()&&A.generateMipmap(A.TEXTURE_2D),M.pixelStoreUnpackFlipY.setDefault(),M.pixelStoreUnpack.setDefault(),M.pixelStoreUnpackPremultiplyAlpha.setDefault()}bind(n,a,p){const{context:y}=this,{gl:T}=y;T.bindTexture(T.TEXTURE_2D,this.texture),p!==T.LINEAR_MIPMAP_NEAREST||this.isSizePowerOfTwo()||(p=T.LINEAR),n!==this.filter&&(T.texParameteri(T.TEXTURE_2D,T.TEXTURE_MAG_FILTER,n),T.texParameteri(T.TEXTURE_2D,T.TEXTURE_MIN_FILTER,p||n),this.filter=n),a!==this.wrap&&(T.texParameteri(T.TEXTURE_2D,T.TEXTURE_WRAP_S,a),T.texParameteri(T.TEXTURE_2D,T.TEXTURE_WRAP_T,a),this.wrap=a)}isSizePowerOfTwo(){return this.size[0]===this.size[1]&&Math.log(this.size[0])/Math.LN2%1==0}destroy(){const{gl:n}=this.context;n.deleteTexture(this.texture),this.texture=null}}class yv{constructor(n,a,p,y=1,T=1,E=1,M=0){if(this.uid=n,a.height!==a.width)throw new RangeError("DEM tiles must be square");if(p&&!["mapbox","terrarium","custom"].includes(p))return void jr(`"${p}" is not a valid encoding type. Valid types include "mapbox", "terrarium" and "custom".`);this.stride=a.height;const A=this.dim=a.height-2;switch(this.data=new Uint32Array(a.data.buffer),p){case"terrarium":this.redFactor=256,this.greenFactor=1,this.blueFactor=1/256,this.baseShift=32768;break;case"custom":this.redFactor=y,this.greenFactor=T,this.blueFactor=E,this.baseShift=M;break;default:this.redFactor=6553.6,this.greenFactor=25.6,this.blueFactor=.1,this.baseShift=1e4}for(let O=0;O<A;O++)this.data[this._idx(-1,O)]=this.data[this._idx(0,O)],this.data[this._idx(A,O)]=this.data[this._idx(A-1,O)],this.data[this._idx(O,-1)]=this.data[this._idx(O,0)],this.data[this._idx(O,A)]=this.data[this._idx(O,A-1)];this.data[this._idx(-1,-1)]=this.data[this._idx(0,0)],this.data[this._idx(A,-1)]=this.data[this._idx(A-1,0)],this.data[this._idx(-1,A)]=this.data[this._idx(0,A-1)],this.data[this._idx(A,A)]=this.data[this._idx(A-1,A-1)],this.min=Number.MAX_SAFE_INTEGER,this.max=Number.MIN_SAFE_INTEGER;for(let O=0;O<A;O++)for(let B=0;B<A;B++){const q=this.get(O,B);q>this.max&&(this.max=q),q<this.min&&(this.min=q)}}get(n,a){const p=new Uint8Array(this.data.buffer),y=4*this._idx(n,a);return this.unpack(p[y],p[y+1],p[y+2])}getUnpackVector(){return[this.redFactor,this.greenFactor,this.blueFactor,this.baseShift]}_idx(n,a){if(n<-1||n>=this.dim+1||a<-1||a>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(a+1)*this.stride+(n+1)}unpack(n,a,p){return n*this.redFactor+a*this.greenFactor+p*this.blueFactor-this.baseShift}pack(n){return _v(n,this.getUnpackVector())}getPixels(){return new so({width:this.stride,height:this.stride},new Uint8Array(this.data.buffer))}backfillBorder(n,a,p){if(this.dim!==n.dim)throw new Error("dem dimension mismatch");let y=a*this.dim,T=a*this.dim+this.dim,E=p*this.dim,M=p*this.dim+this.dim;switch(a){case-1:y=T-1;break;case 1:T=y+1}switch(p){case-1:E=M-1;break;case 1:M=E+1}const A=-a*this.dim,O=-p*this.dim;for(let B=E;B<M;B++)for(let q=y;q<T;q++)this.data[this._idx(q,B)]=n.data[this._idx(q+A,B+O)]}}function _v(u,n){const a=n[0],p=n[1],y=n[2],T=n[3],E=Math.min(a,p,y),M=Math.round((u+T)/E);return{r:Math.floor(M*E/a)%256,g:Math.floor(M*E/p)%256,b:Math.floor(M*E/y)%256}}ni("DEMData",yv);class E2 extends hs{constructor(n){super(n,T2)}_createColorRamp(n){const a={elevationStops:[],colorStops:[]},p=this._transitionablePaint._values["color-relief-color"].value.expression;if(p instanceof Bu&&p._styleExpression.expression instanceof Qr){this.colorRampExpression=p;const E=p._styleExpression.expression;a.elevationStops=E.labels,a.colorStops=[];for(const M of a.elevationStops)a.colorStops.push(E.evaluate({globals:{elevation:M}}))}if(a.elevationStops.length<1&&(a.elevationStops=[0],a.colorStops=[si.transparent]),a.elevationStops.length<2&&(a.elevationStops.push(a.elevationStops[0]+1),a.colorStops.push(a.colorStops[0])),a.elevationStops.length<=n)return a;const y={elevationStops:[],colorStops:[]},T=(a.elevationStops.length-1)/(n-1);for(let E=0;E<a.elevationStops.length-.5;E+=T)y.elevationStops.push(a.elevationStops[Math.round(E)]),y.colorStops.push(a.colorStops[Math.round(E)]);return jr(`Too many colors in specification of ${this.id} color-relief layer, may not render properly.`),y}_colorRampChanged(){return this.colorRampExpression!=this._transitionablePaint._values["color-relief-color"].value.expression}getColorRampTextures(n,a,p){if(this.colorRampTextures&&!this._colorRampChanged())return this.colorRampTextures;const y=this._createColorRamp(a),T=new so({width:y.colorStops.length,height:1}),E=new so({width:y.colorStops.length,height:1});for(let M=0;M<y.elevationStops.length;M++){const A=_v(y.elevationStops[M],p);E.setPixel(0,M,new si(A.r/255,A.g/255,A.b/255,1)),T.setPixel(0,M,y.colorStops[M])}return this.colorRampTextures={elevationTexture:new dg(n,E,n.gl.RGBA),colorTexture:new dg(n,T,n.gl.RGBA)},this.colorRampTextures}hasOffscreenPass(){return this.visibility!=="none"&&!!this.colorRampTextures}}const I2=mn([{name:"a_pos",components:2,type:"Int16"}],4),{members:S2}=I2;function pg(u,n,a){const p=a.patternDependencies;let y=!1;for(const T of n){const E=T.paint.get(`${u}-pattern`);E.isConstant()||(y=!0);const M=E.constantOr(null);M&&(y=!0,p[M.to]=!0,p[M.from]=!0)}return y}function fg(u,n,a,p,y){const T=y.patternDependencies;for(const E of n){const M=E.paint.get(`${u}-pattern`).value;if(M.kind!=="constant"){let A=M.evaluate({zoom:p-1},a,{},y.availableImages),O=M.evaluate({zoom:p},a,{},y.availableImages),B=M.evaluate({zoom:p+1},a,{},y.availableImages);A=A&&A.name?A.name:A,O=O&&O.name?O.name:O,B=B&&B.name?B.name:B,T[A]=!0,T[O]=!0,T[B]=!0,a.patterns[E.id]={min:A,mid:O,max:B}}}return a}function vv(u,n,a,p,y){let T;if(y===function(E,M,A,O){let B=0;for(let q=M,ee=A-O;q<A;q+=O)B+=(E[ee]-E[q])*(E[q+1]+E[ee+1]),ee=q;return B}(u,n,a,p)>0)for(let E=n;E<a;E+=p)T=Tv(E/p|0,u[E],u[E+1],T);else for(let E=a-p;E>=n;E-=p)T=Tv(E/p|0,u[E],u[E+1],T);return T&&Gc(T,T.next)&&(nd(T),T=T.next),T}function nc(u,n){if(!u)return u;n||(n=u);let a,p=u;do if(a=!1,p.steiner||!Gc(p,p.next)&&Cn(p.prev,p,p.next)!==0)p=p.next;else{if(nd(p),p=n=p.prev,p===p.next)break;a=!0}while(a||p!==n);return n}function td(u,n,a,p,y,T,E){if(!u)return;!E&&T&&function(A,O,B,q){let ee=A;do ee.z===0&&(ee.z=mg(ee.x,ee.y,O,B,q)),ee.prevZ=ee.prev,ee.nextZ=ee.next,ee=ee.next;while(ee!==A);ee.prevZ.nextZ=null,ee.prevZ=null,function(re){let se,ce=1;do{let be,Me=re;re=null;let Xe=null;for(se=0;Me;){se++;let ze=Me,ie=0;for(let Ge=0;Ge<ce&&(ie++,ze=ze.nextZ,ze);Ge++);let xe=ce;for(;ie>0||xe>0&&ze;)ie!==0&&(xe===0||!ze||Me.z<=ze.z)?(be=Me,Me=Me.nextZ,ie--):(be=ze,ze=ze.nextZ,xe--),Xe?Xe.nextZ=be:re=be,be.prevZ=Xe,Xe=be;Me=ze}Xe.nextZ=null,ce*=2}while(se>1)}(ee)}(u,p,y,T);let M=u;for(;u.prev!==u.next;){const A=u.prev,O=u.next;if(T?P2(u,p,y,T):M2(u))n.push(A.i,u.i,O.i),nd(u),u=O.next,M=O.next;else if((u=O)===M){E?E===1?td(u=k2(nc(u),n),n,a,p,y,T,2):E===2&&C2(u,n,a,p,y,T):td(nc(u),n,a,p,y,T,1);break}}}function M2(u){const n=u.prev,a=u,p=u.next;if(Cn(n,a,p)>=0)return!1;const y=n.x,T=a.x,E=p.x,M=n.y,A=a.y,O=p.y,B=Math.min(y,T,E),q=Math.min(M,A,O),ee=Math.max(y,T,E),re=Math.max(M,A,O);let se=p.next;for(;se!==n;){if(se.x>=B&&se.x<=ee&&se.y>=q&&se.y<=re&&id(y,M,T,A,E,O,se.x,se.y)&&Cn(se.prev,se,se.next)>=0)return!1;se=se.next}return!0}function P2(u,n,a,p){const y=u.prev,T=u,E=u.next;if(Cn(y,T,E)>=0)return!1;const M=y.x,A=T.x,O=E.x,B=y.y,q=T.y,ee=E.y,re=Math.min(M,A,O),se=Math.min(B,q,ee),ce=Math.max(M,A,O),be=Math.max(B,q,ee),Me=mg(re,se,n,a,p),Xe=mg(ce,be,n,a,p);let ze=u.prevZ,ie=u.nextZ;for(;ze&&ze.z>=Me&&ie&&ie.z<=Xe;){if(ze.x>=re&&ze.x<=ce&&ze.y>=se&&ze.y<=be&&ze!==y&&ze!==E&&id(M,B,A,q,O,ee,ze.x,ze.y)&&Cn(ze.prev,ze,ze.next)>=0||(ze=ze.prevZ,ie.x>=re&&ie.x<=ce&&ie.y>=se&&ie.y<=be&&ie!==y&&ie!==E&&id(M,B,A,q,O,ee,ie.x,ie.y)&&Cn(ie.prev,ie,ie.next)>=0))return!1;ie=ie.nextZ}for(;ze&&ze.z>=Me;){if(ze.x>=re&&ze.x<=ce&&ze.y>=se&&ze.y<=be&&ze!==y&&ze!==E&&id(M,B,A,q,O,ee,ze.x,ze.y)&&Cn(ze.prev,ze,ze.next)>=0)return!1;ze=ze.prevZ}for(;ie&&ie.z<=Xe;){if(ie.x>=re&&ie.x<=ce&&ie.y>=se&&ie.y<=be&&ie!==y&&ie!==E&&id(M,B,A,q,O,ee,ie.x,ie.y)&&Cn(ie.prev,ie,ie.next)>=0)return!1;ie=ie.nextZ}return!0}function k2(u,n){let a=u;do{const p=a.prev,y=a.next.next;!Gc(p,y)&&bv(p,a,a.next,y)&&rd(p,y)&&rd(y,p)&&(n.push(p.i,a.i,y.i),nd(a),nd(a.next),a=u=y),a=a.next}while(a!==u);return nc(a)}function C2(u,n,a,p,y,T){let E=u;do{let M=E.next.next;for(;M!==E.prev;){if(E.i!==M.i&&O2(E,M)){let A=wv(E,M);return E=nc(E,E.next),A=nc(A,A.next),td(E,n,a,p,y,T,0),void td(A,n,a,p,y,T,0)}M=M.next}E=E.next}while(E!==u)}function A2(u,n){let a=u.x-n.x;return a===0&&(a=u.y-n.y,a===0)&&(a=(u.next.y-u.y)/(u.next.x-u.x)-(n.next.y-n.y)/(n.next.x-n.x)),a}function L2(u,n){const a=function(y,T){let E=T;const M=y.x,A=y.y;let O,B=-1/0;if(Gc(y,E))return E;do{if(Gc(y,E.next))return E.next;if(A<=E.y&&A>=E.next.y&&E.next.y!==E.y){const ce=E.x+(A-E.y)*(E.next.x-E.x)/(E.next.y-E.y);if(ce<=M&&ce>B&&(B=ce,O=E.x<E.next.x?E:E.next,ce===M))return O}E=E.next}while(E!==T);if(!O)return null;const q=O,ee=O.x,re=O.y;let se=1/0;E=O;do{if(M>=E.x&&E.x>=ee&&M!==E.x&&xv(A<re?M:B,A,ee,re,A<re?B:M,A,E.x,E.y)){const ce=Math.abs(A-E.y)/(M-E.x);rd(E,y)&&(ce<se||ce===se&&(E.x>O.x||E.x===O.x&&R2(O,E)))&&(O=E,se=ce)}E=E.next}while(E!==q);return O}(u,n);if(!a)return n;const p=wv(a,u);return nc(p,p.next),nc(a,a.next)}function R2(u,n){return Cn(u.prev,u,n.prev)<0&&Cn(n.next,u,u.next)<0}function mg(u,n,a,p,y){return(u=1431655765&((u=858993459&((u=252645135&((u=16711935&((u=(u-a)*y|0)|u<<8))|u<<4))|u<<2))|u<<1))|(n=1431655765&((n=858993459&((n=252645135&((n=16711935&((n=(n-p)*y|0)|n<<8))|n<<4))|n<<2))|n<<1))<<1}function N2(u){let n=u,a=u;do(n.x<a.x||n.x===a.x&&n.y<a.y)&&(a=n),n=n.next;while(n!==u);return a}function xv(u,n,a,p,y,T,E,M){return(y-E)*(n-M)>=(u-E)*(T-M)&&(u-E)*(p-M)>=(a-E)*(n-M)&&(a-E)*(T-M)>=(y-E)*(p-M)}function id(u,n,a,p,y,T,E,M){return!(u===E&&n===M)&&xv(u,n,a,p,y,T,E,M)}function O2(u,n){return u.next.i!==n.i&&u.prev.i!==n.i&&!function(a,p){let y=a;do{if(y.i!==a.i&&y.next.i!==a.i&&y.i!==p.i&&y.next.i!==p.i&&bv(y,y.next,a,p))return!0;y=y.next}while(y!==a);return!1}(u,n)&&(rd(u,n)&&rd(n,u)&&function(a,p){let y=a,T=!1;const E=(a.x+p.x)/2,M=(a.y+p.y)/2;do y.y>M!=y.next.y>M&&y.next.y!==y.y&&E<(y.next.x-y.x)*(M-y.y)/(y.next.y-y.y)+y.x&&(T=!T),y=y.next;while(y!==a);return T}(u,n)&&(Cn(u.prev,u,n.prev)||Cn(u,n.prev,n))||Gc(u,n)&&Cn(u.prev,u,u.next)>0&&Cn(n.prev,n,n.next)>0)}function Cn(u,n,a){return(n.y-u.y)*(a.x-n.x)-(n.x-u.x)*(a.y-n.y)}function Gc(u,n){return u.x===n.x&&u.y===n.y}function bv(u,n,a,p){const y=Gp(Cn(u,n,a)),T=Gp(Cn(u,n,p)),E=Gp(Cn(a,p,u)),M=Gp(Cn(a,p,n));return y!==T&&E!==M||!(y!==0||!jp(u,a,n))||!(T!==0||!jp(u,p,n))||!(E!==0||!jp(a,u,p))||!(M!==0||!jp(a,n,p))}function jp(u,n,a){return n.x<=Math.max(u.x,a.x)&&n.x>=Math.min(u.x,a.x)&&n.y<=Math.max(u.y,a.y)&&n.y>=Math.min(u.y,a.y)}function Gp(u){return u>0?1:u<0?-1:0}function rd(u,n){return Cn(u.prev,u,u.next)<0?Cn(u,n,u.next)>=0&&Cn(u,u.prev,n)>=0:Cn(u,n,u.prev)<0||Cn(u,u.next,n)<0}function wv(u,n){const a=gg(u.i,u.x,u.y),p=gg(n.i,n.x,n.y),y=u.next,T=n.prev;return u.next=n,n.prev=u,a.next=y,y.prev=a,p.next=a,a.prev=p,T.next=p,p.prev=T,p}function Tv(u,n,a,p){const y=gg(u,n,a);return p?(y.next=p.next,y.prev=p,p.next.prev=y,p.next=y):(y.prev=y,y.next=y),y}function nd(u){u.next.prev=u.prev,u.prev.next=u.next,u.prevZ&&(u.prevZ.nextZ=u.nextZ),u.nextZ&&(u.nextZ.prevZ=u.prevZ)}function gg(u,n,a){return{i:u,x:n,y:a,prev:null,next:null,z:0,prevZ:null,nextZ:null,steiner:!1}}class Uc{constructor(n,a){if(a>n)throw new Error("Min granularity must not be greater than base granularity.");this._baseZoomGranularity=n,this._minGranularity=a}getGranularityForZoomLevel(n){return Math.max(Math.floor(this._baseZoomGranularity/(1<<n)),this._minGranularity,1)}}class Up{constructor(n){this.fill=n.fill,this.line=n.line,this.tile=n.tile,this.stencil=n.stencil,this.circle=n.circle}}Up.noSubdivision=new Up({fill:new Uc(0,0),line:new Uc(0,0),tile:new Uc(0,0),stencil:new Uc(0,0),circle:1}),ni("SubdivisionGranularityExpression",Uc),ni("SubdivisionGranularitySetting",Up);const Vc=-32768,sd=32767;class D2{constructor(n,a){this._vertexBuffer=[],this._vertexDictionary=new Map,this._used=!1,this._granularity=n,this._granularityCellSize=It/n,this._canonical=a}_getKey(n,a){return(n+=32768)<<16|a+32768}_vertexToIndex(n,a){if(n<-32768||a<-32768||n>32767||a>32767)throw new Error("Vertex coordinates are out of signed 16 bit integer range.");const p=0|Math.round(n),y=0|Math.round(a),T=this._getKey(p,y);if(this._vertexDictionary.has(T))return this._vertexDictionary.get(T);const E=this._vertexBuffer.length/2;return this._vertexDictionary.set(T,E),this._vertexBuffer.push(p,y),E}_subdivideTrianglesScanline(n){if(this._granularity<2)return function(y,T){const E=[];for(let M=0;M<T.length;M+=3){const A=T[M],O=T[M+1],B=T[M+2],q=y[2*A],ee=y[2*A+1];(y[2*O]-q)*(y[2*B+1]-ee)-(y[2*O+1]-ee)*(y[2*B]-q)>0?(E.push(A),E.push(B),E.push(O)):(E.push(A),E.push(O),E.push(B))}return E}(this._vertexBuffer,n);const a=[],p=n.length;for(let y=0;y<p;y+=3){const T=[n[y+0],n[y+1],n[y+2]],E=[this._vertexBuffer[2*n[y+0]+0],this._vertexBuffer[2*n[y+0]+1],this._vertexBuffer[2*n[y+1]+0],this._vertexBuffer[2*n[y+1]+1],this._vertexBuffer[2*n[y+2]+0],this._vertexBuffer[2*n[y+2]+1]];let M=1/0,A=1/0,O=-1/0,B=-1/0;for(let ce=0;ce<3;ce++){const be=E[2*ce],Me=E[2*ce+1];M=Math.min(M,be),O=Math.max(O,be),A=Math.min(A,Me),B=Math.max(B,Me)}if(M===O||A===B)continue;const q=Math.floor(M/this._granularityCellSize),ee=Math.ceil(O/this._granularityCellSize),re=Math.floor(A/this._granularityCellSize),se=Math.ceil(B/this._granularityCellSize);if(q!==ee||re!==se)for(let ce=re;ce<se;ce++){const be=this._scanlineGenerateVertexRingForCellRow(ce,E,T);F2(this._vertexBuffer,be,a)}else a.push(...T)}return a}_scanlineGenerateVertexRingForCellRow(n,a,p){const y=n*this._granularityCellSize,T=y+this._granularityCellSize,E=[];for(let M=0;M<3;M++){const A=a[2*M],O=a[2*M+1],B=a[2*(M+1)%6],q=a[(2*(M+1)+1)%6],ee=a[2*(M+2)%6],re=a[(2*(M+2)+1)%6],se=B-A,ce=q-O,be=se===0,Me=ce===0,Xe=(y-O)/ce,ze=(T-O)/ce,ie=Math.min(Xe,ze),xe=Math.max(Xe,ze);if(!Me&&(ie>=1||xe<=0)||Me&&(O<y||O>T)){q>=y&&q<=T&&E.push(p[(M+1)%3]);continue}!Me&&ie>0&&E.push(this._vertexToIndex(A+se*ie,O+ce*ie));const Ge=A+se*Math.max(ie,0),mt=A+se*Math.min(xe,1);be||this._generateIntraEdgeVertices(E,A,O,B,q,Ge,mt),!Me&&xe<1&&E.push(this._vertexToIndex(A+se*xe,O+ce*xe)),(Me||q>=y&&q<=T)&&E.push(p[(M+1)%3]),!Me&&(q<=y||q>=T)&&this._generateInterEdgeVertices(E,A,O,B,q,ee,re,mt,y,T)}return E}_generateIntraEdgeVertices(n,a,p,y,T,E,M){const A=y-a,O=T-p,B=O===0,q=B?Math.min(a,y):Math.min(E,M),ee=B?Math.max(a,y):Math.max(E,M),re=Math.floor(q/this._granularityCellSize)+1,se=Math.ceil(ee/this._granularityCellSize)-1;if(B?a<y:E<M)for(let ce=re;ce<=se;ce++){const be=ce*this._granularityCellSize;n.push(this._vertexToIndex(be,p+O*(be-a)/A))}else for(let ce=se;ce>=re;ce--){const be=ce*this._granularityCellSize;n.push(this._vertexToIndex(be,p+O*(be-a)/A))}}_generateInterEdgeVertices(n,a,p,y,T,E,M,A,O,B){const q=T-p,ee=E-y,re=M-T,se=(O-T)/re,ce=(B-T)/re,be=Math.min(se,ce),Me=Math.max(se,ce),Xe=y+ee*be;let ze=Math.floor(Math.min(Xe,A)/this._granularityCellSize)+1,ie=Math.ceil(Math.max(Xe,A)/this._granularityCellSize)-1,xe=A<Xe;const Ge=re===0;if(Ge&&(M===O||M===B))return;if(Ge||be>=1||Me<=0){const Lt=p-M,xt=E+(a-E)*Math.min((O-M)/Lt,(B-M)/Lt);ze=Math.floor(Math.min(xt,A)/this._granularityCellSize)+1,ie=Math.ceil(Math.max(xt,A)/this._granularityCellSize)-1,xe=A<xt}const mt=q>0?B:O;if(xe)for(let Lt=ze;Lt<=ie;Lt++)n.push(this._vertexToIndex(Lt*this._granularityCellSize,mt));else for(let Lt=ie;Lt>=ze;Lt--)n.push(this._vertexToIndex(Lt*this._granularityCellSize,mt))}_generateOutline(n){const a=[];for(const p of n){const y=sc(p,this._granularity,!0),T=this._pointArrayToIndices(y),E=[];for(let M=1;M<T.length;M++)E.push(T[M-1]),E.push(T[M]);a.push(E)}return a}_handlePoles(n){let a=!1,p=!1;this._canonical&&(this._canonical.y===0&&(a=!0),this._canonical.y===(1<<this._canonical.z)-1&&(p=!0)),(a||p)&&this._fillPoles(n,a,p)}_ensureNoPoleVertices(){const n=this._vertexBuffer;for(let a=0;a<n.length;a+=2){const p=n[a+1];p===Vc&&(n[a+1]=-32767),p===sd&&(n[a+1]=32766)}}_generatePoleQuad(n,a,p,y,T,E){y>T!=(E===Vc)?(n.push(a),n.push(p),n.push(this._vertexToIndex(y,E)),n.push(p),n.push(this._vertexToIndex(T,E)),n.push(this._vertexToIndex(y,E))):(n.push(p),n.push(a),n.push(this._vertexToIndex(y,E)),n.push(this._vertexToIndex(T,E)),n.push(p),n.push(this._vertexToIndex(y,E)))}_fillPoles(n,a,p){const y=this._vertexBuffer,T=It,E=n.length;for(let M=2;M<E;M+=3){const A=n[M-2],O=n[M-1],B=n[M],q=y[2*A],ee=y[2*A+1],re=y[2*O],se=y[2*O+1],ce=y[2*B],be=y[2*B+1];a&&(ee===0&&se===0&&this._generatePoleQuad(n,A,O,q,re,Vc),se===0&&be===0&&this._generatePoleQuad(n,O,B,re,ce,Vc),be===0&&ee===0&&this._generatePoleQuad(n,B,A,ce,q,Vc)),p&&(ee===T&&se===T&&this._generatePoleQuad(n,A,O,q,re,sd),se===T&&be===T&&this._generatePoleQuad(n,O,B,re,ce,sd),be===T&&ee===T&&this._generatePoleQuad(n,B,A,ce,q,sd))}}_initializeVertices(n){for(let a=0;a<n.length;a+=2)this._vertexToIndex(n[a],n[a+1])}subdividePolygonInternal(n,a){if(this._used)throw new Error("Subdivision: multiple use not allowed.");this._used=!0;const{flattened:p,holeIndices:y}=function(M){const A=[],O=[];for(const B of M)if(B.length!==0){B!==M[0]&&A.push(O.length/2);for(let q=0;q<B.length;q++)O.push(B[q].x),O.push(B[q].y)}return{flattened:O,holeIndices:A}}(n);let T;this._initializeVertices(p);try{const M=function(O,B,q=2){const ee=B&&B.length,re=ee?B[0]*q:O.length;let se=vv(O,0,re,q,!0);const ce=[];if(!se||se.next===se.prev)return ce;let be,Me,Xe;if(ee&&(se=function(ze,ie,xe,Ge){const mt=[];for(let Lt=0,xt=ie.length;Lt<xt;Lt++){const wt=vv(ze,ie[Lt]*Ge,Lt<xt-1?ie[Lt+1]*Ge:ze.length,Ge,!1);wt===wt.next&&(wt.steiner=!0),mt.push(N2(wt))}mt.sort(A2);for(let Lt=0;Lt<mt.length;Lt++)xe=L2(mt[Lt],xe);return xe}(O,B,se,q)),O.length>80*q){be=1/0,Me=1/0;let ze=-1/0,ie=-1/0;for(let xe=q;xe<re;xe+=q){const Ge=O[xe],mt=O[xe+1];Ge<be&&(be=Ge),mt<Me&&(Me=mt),Ge>ze&&(ze=Ge),mt>ie&&(ie=mt)}Xe=Math.max(ze-be,ie-Me),Xe=Xe!==0?32767/Xe:0}return td(se,ce,q,be,Me,Xe,0),ce}(p,y),A=this._convertIndices(p,M);T=this._subdivideTrianglesScanline(A)}catch(M){console.error(M)}let E=[];return a&&(E=this._generateOutline(n)),this._ensureNoPoleVertices(),this._handlePoles(T),{verticesFlattened:this._vertexBuffer,indicesTriangles:T,indicesLineList:E}}_convertIndices(n,a){const p=[];for(let y=0;y<a.length;y++)p.push(this._vertexToIndex(n[2*a[y]],n[2*a[y]+1]));return p}_pointArrayToIndices(n){const a=[];for(let p=0;p<n.length;p++){const y=n[p];a.push(this._vertexToIndex(y.x,y.y))}return a}}function Ev(u,n,a,p=!0){return new D2(a,n).subdividePolygonInternal(u,p)}function sc(u,n,a=!1){if(!u||u.length<1)return[];if(u.length<2)return[];const p=u[0],y=u[u.length-1],T=a&&(p.x!==y.x||p.y!==y.y);if(n<2)return T?[...u,u[0]]:[...u];const E=Math.floor(It/n),M=[];M.push(new H(u[0].x,u[0].y));const A=u.length,O=T?A:A-1;for(let B=0;B<O;B++){const q=u[B],ee=B<A-1?u[B+1]:u[0],re=q.x,se=q.y,ce=ee.x,be=ee.y,Me=re!==ce,Xe=se!==be;if(!Me&&!Xe)continue;const ze=ce-re,ie=be-se,xe=Math.abs(ze),Ge=Math.abs(ie);let mt=re,Lt=se;for(;;){const wt=ze>0?(Math.floor(mt/E)+1)*E:(Math.ceil(mt/E)-1)*E,Gt=ie>0?(Math.floor(Lt/E)+1)*E:(Math.ceil(Lt/E)-1)*E,At=Math.abs(mt-wt),$t=Math.abs(Lt-Gt),Et=Math.abs(mt-ce),di=Math.abs(Lt-be),Oi=Me?At/xe:Number.POSITIVE_INFINITY,Li=Xe?$t/Ge:Number.POSITIVE_INFINITY;if((Et<=At||!Me)&&(di<=$t||!Xe))break;if(Oi<Li&&Me||!Xe){mt=wt,Lt+=ie*Oi;const Ti=new H(mt,Math.round(Lt));M[M.length-1].x===Ti.x&&M[M.length-1].y===Ti.y||M.push(Ti)}else{mt+=ze*Li,Lt=Gt;const Ti=new H(Math.round(mt),Lt);M[M.length-1].x===Ti.x&&M[M.length-1].y===Ti.y||M.push(Ti)}}const xt=new H(ce,be);M[M.length-1].x===xt.x&&M[M.length-1].y===xt.y||M.push(xt)}return M}function F2(u,n,a){if(n.length===0)throw new Error("Subdivision vertex ring is empty.");let p=0,y=u[2*n[0]];for(let A=1;A<n.length;A++){const O=u[2*n[A]];O<y&&(y=O,p=A)}const T=n.length;let E=p,M=(E+1)%T;for(;;){const A=E-1>=0?E-1:T-1,O=(M+1)%T,B=u[2*n[A]],q=u[2*n[O]],ee=u[2*n[E]],re=u[2*n[E]+1],se=u[2*n[M]+1];let ce=!1;if(B<q)ce=!0;else if(B>q)ce=!1;else{const be=se-re,Me=-(u[2*n[M]]-ee),Xe=re<se?1:-1;((B-ee)*be+(u[2*n[A]+1]-re)*Me)*Xe>((q-ee)*be+(u[2*n[O]+1]-re)*Me)*Xe&&(ce=!0)}if(ce){const be=n[A],Me=n[E],Xe=n[M];be!==Me&&be!==Xe&&Me!==Xe&&a.push(Xe,Me,be),E--,E<0&&(E=T-1)}else{const be=n[O],Me=n[E],Xe=n[M];be!==Me&&be!==Xe&&Me!==Xe&&a.push(Xe,Me,be),M++,M>=T&&(M=0)}if(A===O)break}}function Iv(u,n,a,p,y,T,E,M,A){const O=y.length/2,B=E&&M&&A;if(O<xr.MAX_VERTEX_ARRAY_LENGTH){const q=n.prepareSegment(O,a,p),ee=q.vertexLength;for(let ce=0;ce<T.length;ce+=3)p.emplaceBack(ee+T[ce],ee+T[ce+1],ee+T[ce+2]);let re,se;q.vertexLength+=O,q.primitiveLength+=T.length/3,B&&(se=E.prepareSegment(O,a,M),re=se.vertexLength,se.vertexLength+=O);for(let ce=0;ce<y.length;ce+=2)u(y[ce],y[ce+1]);if(B)for(let ce=0;ce<A.length;ce++){const be=A[ce];for(let Me=1;Me<be.length;Me+=2)M.emplaceBack(re+be[Me-1],re+be[Me]);se.primitiveLength+=be.length/2}}else(function(q,ee,re,se,ce,be){const Me=[];for(let Ge=0;Ge<se.length/2;Ge++)Me.push(-1);const Xe={count:0};let ze=0,ie=q.getOrCreateLatestSegment(ee,re),xe=ie.vertexLength;for(let Ge=2;Ge<ce.length;Ge+=3){const mt=ce[Ge-2],Lt=ce[Ge-1],xt=ce[Ge];let wt=Me[mt]<ze,Gt=Me[Lt]<ze,At=Me[xt]<ze;ie.vertexLength+((wt?1:0)+(Gt?1:0)+(At?1:0))>xr.MAX_VERTEX_ARRAY_LENGTH&&(ie=q.createNewSegment(ee,re),ze=Xe.count,wt=!0,Gt=!0,At=!0,xe=0);const $t=od(Me,se,be,Xe,mt,wt,ie),Et=od(Me,se,be,Xe,Lt,Gt,ie),di=od(Me,se,be,Xe,xt,At,ie);re.emplaceBack(xe+$t-ze,xe+Et-ze,xe+di-ze),ie.primitiveLength++}})(n,a,p,y,T,u),B&&function(q,ee,re,se,ce,be){const Me=[];for(let Ge=0;Ge<se.length/2;Ge++)Me.push(-1);const Xe={count:0};let ze=0,ie=q.getOrCreateLatestSegment(ee,re),xe=ie.vertexLength;for(let Ge=0;Ge<ce.length;Ge++){const mt=ce[Ge];for(let Lt=1;Lt<ce[Ge].length;Lt+=2){const xt=mt[Lt-1],wt=mt[Lt];let Gt=Me[xt]<ze,At=Me[wt]<ze;ie.vertexLength+((Gt?1:0)+(At?1:0))>xr.MAX_VERTEX_ARRAY_LENGTH&&(ie=q.createNewSegment(ee,re),ze=Xe.count,Gt=!0,At=!0,xe=0);const $t=od(Me,se,be,Xe,xt,Gt,ie),Et=od(Me,se,be,Xe,wt,At,ie);re.emplaceBack(xe+$t-ze,xe+Et-ze),ie.primitiveLength++}}}(E,a,M,y,A,u),n.forceNewSegmentOnNextPrepare(),E?.forceNewSegmentOnNextPrepare()}function od(u,n,a,p,y,T,E){if(T){const M=p.count;return a(n[2*y],n[2*y+1]),u[y]=p.count,p.count++,E.vertexLength++,M}return u[y]}class yg{constructor(n){this.zoom=n.zoom,this.globalState=n.globalState,this.overscaling=n.overscaling,this.layers=n.layers,this.layerIds=this.layers.map(a=>a.id),this.index=n.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new _t,this.indexArray=new Gr,this.indexArray2=new Br,this.programConfigurations=new Qa(n.layers,n.zoom),this.segments=new xr,this.segments2=new xr,this.stateDependentLayerIds=this.layers.filter(a=>a.isStateDependent()).map(a=>a.id)}populate(n,a,p){this.hasPattern=pg("fill",this.layers,a);const y=this.layers[0].layout.get("fill-sort-key"),T=!y.isConstant(),E=[];for(const{feature:M,id:A,index:O,sourceLayerIndex:B}of n){const q=this.layers[0]._featureFilter.needGeometry,ee=rc(M,q);if(!this.layers[0]._featureFilter.filter(new en(this.zoom,{globalState:this.globalState}),ee,p))continue;const re=T?y.evaluate(ee,{},p,a.availableImages):void 0,se={id:A,properties:M.properties,type:M.type,sourceLayerIndex:B,index:O,geometry:q?ee.geometry:ic(M),patterns:{},sortKey:re};E.push(se)}T&&E.sort((M,A)=>M.sortKey-A.sortKey);for(const M of E){const{geometry:A,index:O,sourceLayerIndex:B}=M;if(this.hasPattern){const q=fg("fill",this.layers,M,this.zoom,a);this.patternFeatures.push(q)}else this.addFeature(M,A,O,p,{},a.subdivisionGranularity);a.featureIndex.insert(n[O].feature,A,O,B,this.index)}}update(n,a,p){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(n,a,this.stateDependentLayers,p)}addFeatures(n,a,p){for(const y of this.patternFeatures)this.addFeature(y,y.geometry,y.index,a,p,n.subdivisionGranularity)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(n){this.uploaded||(this.layoutVertexBuffer=n.createVertexBuffer(this.layoutVertexArray,S2),this.indexBuffer=n.createIndexBuffer(this.indexArray),this.indexBuffer2=n.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(n),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())}addFeature(n,a,p,y,T,E){for(const M of sa(a,500)){const A=Ev(M,y,E.fill.getGranularityForZoomLevel(y.z)),O=this.layoutVertexArray;Iv((B,q)=>{O.emplaceBack(B,q)},this.segments,this.layoutVertexArray,this.indexArray,A.verticesFlattened,A.indicesTriangles,this.segments2,this.indexArray2,A.indicesLineList)}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,n,p,T,y)}}let Sv,Mv;ni("FillBucket",yg,{omit:["layers","patternFeatures"]});var z2={get paint(){return Mv=Mv||new Fs({"fill-antialias":new mi(Ve.paint_fill["fill-antialias"]),"fill-opacity":new Fi(Ve.paint_fill["fill-opacity"]),"fill-color":new Fi(Ve.paint_fill["fill-color"]),"fill-outline-color":new Fi(Ve.paint_fill["fill-outline-color"]),"fill-translate":new mi(Ve.paint_fill["fill-translate"]),"fill-translate-anchor":new mi(Ve.paint_fill["fill-translate-anchor"]),"fill-pattern":new zc(Ve.paint_fill["fill-pattern"])})},get layout(){return Sv=Sv||new Fs({"fill-sort-key":new Fi(Ve.layout_fill["fill-sort-key"])})}};class B2 extends hs{constructor(n){super(n,z2)}recalculate(n,a){super.recalculate(n,a);const p=this.paint._values["fill-outline-color"];p.value.kind==="constant"&&p.value.value===void 0&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(n){return new yg(n)}queryRadius(){return Bp(this.paint.get("fill-translate"))}queryIntersectsFeature({queryGeometry:n,geometry:a,transform:p,pixelsToTileUnits:y}){return sv($p(n,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),-p.bearingInRadians,y),a)}isTileClipped(){return!0}}const $2=mn([{name:"a_pos",components:2,type:"Int16"},{name:"a_normal_ed",components:4,type:"Int16"}],4),j2=mn([{name:"a_centroid",components:2,type:"Int16"}],4),{members:G2}=$2;var _g,Pv,vg,kv,xg,Cv,Av,Vp={};function Lv(){if(Pv)return _g;Pv=1;var u=F();function n(y,T,E,M,A){this.properties={},this.extent=E,this.type=0,this._pbf=y,this._geometry=-1,this._keys=M,this._values=A,y.readFields(a,this,T)}function a(y,T,E){y==1?T.id=E.readVarint():y==2?function(M,A){for(var O=M.readVarint()+M.pos;M.pos<O;){var B=A._keys[M.readVarint()],q=A._values[M.readVarint()];A.properties[B]=q}}(E,T):y==3?T.type=E.readVarint():y==4&&(T._geometry=E.pos)}function p(y){for(var T,E,M=0,A=0,O=y.length,B=O-1;A<O;B=A++)M+=((E=y[B]).x-(T=y[A]).x)*(T.y+E.y);return M}return _g=n,n.types=["Unknown","Point","LineString","Polygon"],n.prototype.loadGeometry=function(){var y=this._pbf;y.pos=this._geometry;for(var T,E=y.readVarint()+y.pos,M=1,A=0,O=0,B=0,q=[];y.pos<E;){if(A<=0){var ee=y.readVarint();M=7&ee,A=ee>>3}if(A--,M===1||M===2)O+=y.readSVarint(),B+=y.readSVarint(),M===1&&(T&&q.push(T),T=[]),T.push(new u(O,B));else{if(M!==7)throw new Error("unknown command "+M);T&&T.push(T[0].clone())}}return T&&q.push(T),q},n.prototype.bbox=function(){var y=this._pbf;y.pos=this._geometry;for(var T=y.readVarint()+y.pos,E=1,M=0,A=0,O=0,B=1/0,q=-1/0,ee=1/0,re=-1/0;y.pos<T;){if(M<=0){var se=y.readVarint();E=7&se,M=se>>3}if(M--,E===1||E===2)(A+=y.readSVarint())<B&&(B=A),A>q&&(q=A),(O+=y.readSVarint())<ee&&(ee=O),O>re&&(re=O);else if(E!==7)throw new Error("unknown command "+E)}return[B,ee,q,re]},n.prototype.toGeoJSON=function(y,T,E){var M,A,O=this.extent*Math.pow(2,E),B=this.extent*y,q=this.extent*T,ee=this.loadGeometry(),re=n.types[this.type];function se(Me){for(var Xe=0;Xe<Me.length;Xe++){var ze=Me[Xe];Me[Xe]=[360*(ze.x+B)/O-180,360/Math.PI*Math.atan(Math.exp((180-360*(ze.y+q)/O)*Math.PI/180))-90]}}switch(this.type){case 1:var ce=[];for(M=0;M<ee.length;M++)ce[M]=ee[M][0];se(ee=ce);break;case 2:for(M=0;M<ee.length;M++)se(ee[M]);break;case 3:for(ee=function(Me){var Xe=Me.length;if(Xe<=1)return[Me];for(var ze,ie,xe=[],Ge=0;Ge<Xe;Ge++){var mt=p(Me[Ge]);mt!==0&&(ie===void 0&&(ie=mt<0),ie===mt<0?(ze&&xe.push(ze),ze=[Me[Ge]]):ze.push(Me[Ge]))}return ze&&xe.push(ze),xe}(ee),M=0;M<ee.length;M++)for(A=0;A<ee[M].length;A++)se(ee[M][A])}ee.length===1?ee=ee[0]:re="Multi"+re;var be={type:"Feature",geometry:{type:re,coordinates:ee},properties:this.properties};return"id"in this&&(be.id=this.id),be},_g}function Rv(){if(kv)return vg;kv=1;var u=Lv();function n(p,y){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=p,this._keys=[],this._values=[],this._features=[],p.readFields(a,this,y),this.length=this._features.length}function a(p,y,T){p===15?y.version=T.readVarint():p===1?y.name=T.readString():p===5?y.extent=T.readVarint():p===2?y._features.push(T.pos):p===3?y._keys.push(T.readString()):p===4&&y._values.push(function(E){for(var M=null,A=E.readVarint()+E.pos;E.pos<A;){var O=E.readVarint()>>3;M=O===1?E.readString():O===2?E.readFloat():O===3?E.readDouble():O===4?E.readVarint64():O===5?E.readVarint():O===6?E.readSVarint():O===7?E.readBoolean():null}return M}(T))}return vg=n,n.prototype.feature=function(p){if(p<0||p>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[p];var y=this._pbf.readVarint()+this._pbf.pos;return new u(this._pbf,y,this.extent,this._keys,this._values)},vg}function Nv(){return Av||(Av=1,Vp.VectorTile=function(){if(Cv)return xg;Cv=1;var u=Rv();function n(a,p,y){if(a===3){var T=new u(y,y.readVarint()+y.pos);T.length&&(p[T.name]=T)}}return xg=function(a,p){this.layers=a.readFields(n,{},p)},xg}(),Vp.VectorTileFeature=Lv(),Vp.VectorTileLayer=Rv()),Vp}var ad=P(Nv());const U2=ad.VectorTileFeature.types,bg=Math.pow(2,13);function ld(u,n,a,p,y,T,E,M){u.emplaceBack(n,a,2*Math.floor(p*bg)+E,y*bg*2,T*bg*2,Math.round(M))}class wg{constructor(n){this.zoom=n.zoom,this.globalState=n.globalState,this.overscaling=n.overscaling,this.layers=n.layers,this.layerIds=this.layers.map(a=>a.id),this.index=n.index,this.hasPattern=!1,this.layoutVertexArray=new qt,this.centroidVertexArray=new ct,this.indexArray=new Gr,this.programConfigurations=new Qa(n.layers,n.zoom),this.segments=new xr,this.stateDependentLayerIds=this.layers.filter(a=>a.isStateDependent()).map(a=>a.id)}populate(n,a,p){this.features=[],this.hasPattern=pg("fill-extrusion",this.layers,a);for(const{feature:y,id:T,index:E,sourceLayerIndex:M}of n){const A=this.layers[0]._featureFilter.needGeometry,O=rc(y,A);if(!this.layers[0]._featureFilter.filter(new en(this.zoom,{globalState:this.globalState}),O,p))continue;const B={id:T,sourceLayerIndex:M,index:E,geometry:A?O.geometry:ic(y),properties:y.properties,type:y.type,patterns:{}};this.hasPattern?this.features.push(fg("fill-extrusion",this.layers,B,this.zoom,a)):this.addFeature(B,B.geometry,E,p,{},a.subdivisionGranularity),a.featureIndex.insert(y,B.geometry,E,M,this.index,!0)}}addFeatures(n,a,p){for(const y of this.features){const{geometry:T}=y;this.addFeature(y,T,y.index,a,p,n.subdivisionGranularity)}}update(n,a,p){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(n,a,this.stateDependentLayers,p)}isEmpty(){return this.layoutVertexArray.length===0&&this.centroidVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(n){this.uploaded||(this.layoutVertexBuffer=n.createVertexBuffer(this.layoutVertexArray,G2),this.centroidVertexBuffer=n.createVertexBuffer(this.centroidVertexArray,j2.members,!0),this.indexBuffer=n.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(n),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.centroidVertexBuffer.destroy())}addFeature(n,a,p,y,T,E){for(const M of sa(a,500)){const A={x:0,y:0,sampleCount:0},O=this.layoutVertexArray.length;this.processPolygon(A,y,n,M,E);const B=this.layoutVertexArray.length-O,q=Math.floor(A.x/A.sampleCount),ee=Math.floor(A.y/A.sampleCount);for(let re=0;re<B;re++)this.centroidVertexArray.emplaceBack(q,ee)}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,n,p,T,y)}processPolygon(n,a,p,y,T){if(y.length<1||Ov(y[0]))return;for(const q of y)q.length!==0&&V2(n,q);const E={segment:this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray)},M=T.fill.getGranularityForZoomLevel(a.z),A=U2[p.type]==="Polygon";for(const q of y){if(q.length===0||Ov(q))continue;const ee=sc(q,M,A);this._generateSideFaces(ee,E)}if(!A)return;const O=Ev(y,a,M,!1),B=this.layoutVertexArray;Iv((q,ee)=>{ld(B,q,ee,0,0,1,1,0)},this.segments,this.layoutVertexArray,this.indexArray,O.verticesFlattened,O.indicesTriangles)}_generateSideFaces(n,a){let p=0;for(let y=1;y<n.length;y++){const T=n[y],E=n[y-1];if(q2(T,E))continue;a.segment.vertexLength+4>xr.MAX_VERTEX_ARRAY_LENGTH&&(a.segment=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray));const M=T.sub(E)._perp()._unit(),A=E.dist(T);p+A>32768&&(p=0),ld(this.layoutVertexArray,T.x,T.y,M.x,M.y,0,0,p),ld(this.layoutVertexArray,T.x,T.y,M.x,M.y,0,1,p),p+=A,ld(this.layoutVertexArray,E.x,E.y,M.x,M.y,0,0,p),ld(this.layoutVertexArray,E.x,E.y,M.x,M.y,0,1,p);const O=a.segment.vertexLength;this.indexArray.emplaceBack(O,O+2,O+1),this.indexArray.emplaceBack(O+1,O+2,O+3),a.segment.vertexLength+=4,a.segment.primitiveLength+=2}}}function V2(u,n){for(let a=0;a<n.length;a++){const p=n[a];a===n.length-1&&n[0].x===p.x&&n[0].y===p.y||(u.x+=p.x,u.y+=p.y,u.sampleCount++)}}function q2(u,n){return u.x===n.x&&(u.x<0||u.x>It)||u.y===n.y&&(u.y<0||u.y>It)}function Ov(u){return u.every(n=>n.x<0)||u.every(n=>n.x>It)||u.every(n=>n.y<0)||u.every(n=>n.y>It)}let Dv;ni("FillExtrusionBucket",wg,{omit:["layers","features"]});var Z2={get paint(){return Dv=Dv||new Fs({"fill-extrusion-opacity":new mi(Ve["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new Fi(Ve["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new mi(Ve["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new mi(Ve["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new zc(Ve["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new Fi(Ve["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new Fi(Ve["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new mi(Ve["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"])})}};class W2 extends hs{constructor(n){super(n,Z2)}createBucket(n){return new wg(n)}queryRadius(){return Bp(this.paint.get("fill-extrusion-translate"))}is3D(){return!0}queryIntersectsFeature({queryGeometry:n,feature:a,featureState:p,geometry:y,transform:T,pixelsToTileUnits:E,pixelPosMatrix:M}){const A=$p(n,this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),-T.bearingInRadians,E),O=this.paint.get("fill-extrusion-height").evaluate(a,p),B=this.paint.get("fill-extrusion-base").evaluate(a,p),q=function(re,se){const ce=[];for(const be of re){const Me=[be.x,be.y,0,1];Ke(Me,Me,se),ce.push(new H(Me[0]/Me[3],Me[1]/Me[3]))}return ce}(A,M),ee=function(re,se,ce,be){const Me=[],Xe=[],ze=be[8]*se,ie=be[9]*se,xe=be[10]*se,Ge=be[11]*se,mt=be[8]*ce,Lt=be[9]*ce,xt=be[10]*ce,wt=be[11]*ce;for(const Gt of re){const At=[],$t=[];for(const Et of Gt){const di=Et.x,Oi=Et.y,Li=be[0]*di+be[4]*Oi+be[12],Ti=be[1]*di+be[5]*Oi+be[13],dr=be[2]*di+be[6]*Oi+be[14],gn=be[3]*di+be[7]*Oi+be[15],qn=dr+xe,Is=gn+Ge,Bo=Li+mt,oo=Ti+Lt,fs=dr+xt,ln=gn+wt,es=new H((Li+ze)/Is,(Ti+ie)/Is);es.z=qn/Is,At.push(es);const ms=new H(Bo/ln,oo/ln);ms.z=fs/ln,$t.push(ms)}Me.push(At),Xe.push($t)}return[Me,Xe]}(y,B,O,M);return function(re,se,ce){let be=1/0;sv(ce,se)&&(be=Fv(ce,se[0]));for(let Me=0;Me<se.length;Me++){const Xe=se[Me],ze=re[Me];for(let ie=0;ie<Xe.length-1;ie++){const xe=Xe[ie],Ge=[xe,Xe[ie+1],ze[ie+1],ze[ie],xe];nv(ce,Ge)&&(be=Math.min(be,Fv(ce,Ge)))}}return be!==1/0&&be}(ee[0],ee[1],q)}}function ud(u,n){return u.x*n.x+u.y*n.y}function Fv(u,n){if(u.length===1){let a=0;const p=n[a++];let y;for(;!y||p.equals(y);)if(y=n[a++],!y)return 1/0;for(;a<n.length;a++){const T=n[a],E=u[0],M=y.sub(p),A=T.sub(p),O=E.sub(p),B=ud(M,M),q=ud(M,A),ee=ud(A,A),re=ud(O,M),se=ud(O,A),ce=B*ee-q*q,be=(ee*re-q*se)/ce,Me=(B*se-q*re)/ce,Xe=p.z*(1-be-Me)+y.z*be+T.z*Me;if(isFinite(Xe))return Xe}return 1/0}{let a=1/0;for(const p of n)a=Math.min(a,p.z);return a}}const Y2=mn([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"}],4),{members:X2}=Y2,H2=mn([{name:"a_uv_x",components:1,type:"Float32"},{name:"a_split_index",components:1,type:"Float32"}]),{members:K2}=H2,J2=ad.VectorTileFeature.types,Q2=Math.cos(Math.PI/180*37.5),zv=Math.pow(2,14)/.5;class Tg{constructor(n){this.zoom=n.zoom,this.globalState=n.globalState,this.overscaling=n.overscaling,this.layers=n.layers,this.layerIds=this.layers.map(a=>a.id),this.index=n.index,this.hasPattern=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(a=>{this.gradients[a.id]={}}),this.layoutVertexArray=new Vt,this.layoutVertexArray2=new kt,this.indexArray=new Gr,this.programConfigurations=new Qa(n.layers,n.zoom),this.segments=new xr,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter(a=>a.isStateDependent()).map(a=>a.id)}populate(n,a,p){this.hasPattern=pg("line",this.layers,a);const y=this.layers[0].layout.get("line-sort-key"),T=!y.isConstant(),E=[];for(const{feature:M,id:A,index:O,sourceLayerIndex:B}of n){const q=this.layers[0]._featureFilter.needGeometry,ee=rc(M,q);if(!this.layers[0]._featureFilter.filter(new en(this.zoom,{globalState:this.globalState}),ee,p))continue;const re=T?y.evaluate(ee,{},p):void 0,se={id:A,properties:M.properties,type:M.type,sourceLayerIndex:B,index:O,geometry:q?ee.geometry:ic(M),patterns:{},sortKey:re};E.push(se)}T&&E.sort((M,A)=>M.sortKey-A.sortKey);for(const M of E){const{geometry:A,index:O,sourceLayerIndex:B}=M;if(this.hasPattern){const q=fg("line",this.layers,M,this.zoom,a);this.patternFeatures.push(q)}else this.addFeature(M,A,O,p,{},a.subdivisionGranularity);a.featureIndex.insert(n[O].feature,A,O,B,this.index)}}update(n,a,p){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(n,a,this.stateDependentLayers,p)}addFeatures(n,a,p){for(const y of this.patternFeatures)this.addFeature(y,y.geometry,y.index,a,p,n.subdivisionGranularity)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(n){this.uploaded||(this.layoutVertexArray2.length!==0&&(this.layoutVertexBuffer2=n.createVertexBuffer(this.layoutVertexArray2,K2)),this.layoutVertexBuffer=n.createVertexBuffer(this.layoutVertexArray,X2),this.indexBuffer=n.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(n),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(n){if(n.properties&&Object.prototype.hasOwnProperty.call(n.properties,"mapbox_clip_start")&&Object.prototype.hasOwnProperty.call(n.properties,"mapbox_clip_end"))return{start:+n.properties.mapbox_clip_start,end:+n.properties.mapbox_clip_end}}addFeature(n,a,p,y,T,E){const M=this.layers[0].layout,A=M.get("line-join").evaluate(n,{}),O=M.get("line-cap"),B=M.get("line-miter-limit"),q=M.get("line-round-limit");this.lineClips=this.lineFeatureClips(n);for(const ee of a)this.addLine(ee,n,A,O,B,q,y,E);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,n,p,T,y)}addLine(n,a,p,y,T,E,M,A){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,n=sc(n,M?A.line.getGranularityForZoomLevel(M.z):1),this.lineClips){this.lineClipsArray.push(this.lineClips);for(let ze=0;ze<n.length-1;ze++)this.totalDistance+=n[ze].dist(n[ze+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}const O=J2[a.type]==="Polygon";let B=n.length;for(;B>=2&&n[B-1].equals(n[B-2]);)B--;let q=0;for(;q<B-1&&n[q].equals(n[q+1]);)q++;if(B<(O?3:2))return;p==="bevel"&&(T=1.05);const ee=this.overscaling<=16?122880/(512*this.overscaling):0,re=this.segments.prepareSegment(10*B,this.layoutVertexArray,this.indexArray);let se,ce,be,Me,Xe;this.e1=this.e2=-1,O&&(se=n[B-2],Xe=n[q].sub(se)._unit()._perp());for(let ze=q;ze<B;ze++){if(be=ze===B-1?O?n[q+1]:void 0:n[ze+1],be&&n[ze].equals(be))continue;Xe&&(Me=Xe),se&&(ce=se),se=n[ze],Xe=be?be.sub(se)._unit()._perp():Me,Me=Me||Xe;let ie=Me.add(Xe);ie.x===0&&ie.y===0||ie._unit();const xe=Me.x*Xe.x+Me.y*Xe.y,Ge=ie.x*Xe.x+ie.y*Xe.y,mt=Ge!==0?1/Ge:1/0,Lt=2*Math.sqrt(2-2*Ge),xt=Ge<Q2&&ce&&be,wt=Me.x*Xe.y-Me.y*Xe.x>0;if(xt&&ze>q){const $t=se.dist(ce);if($t>2*ee){const Et=se.sub(se.sub(ce)._mult(ee/$t)._round());this.updateDistance(ce,Et),this.addCurrentVertex(Et,Me,0,0,re),ce=Et}}const Gt=ce&&be;let At=Gt?p:O?"butt":y;if(Gt&&At==="round"&&(mt<E?At="miter":mt<=2&&(At="fakeround")),At==="miter"&&mt>T&&(At="bevel"),At==="bevel"&&(mt>2&&(At="flipbevel"),mt<T&&(At="miter")),ce&&this.updateDistance(ce,se),At==="miter")ie._mult(mt),this.addCurrentVertex(se,ie,0,0,re);else if(At==="flipbevel"){if(mt>100)ie=Xe.mult(-1);else{const $t=mt*Me.add(Xe).mag()/Me.sub(Xe).mag();ie._perp()._mult($t*(wt?-1:1))}this.addCurrentVertex(se,ie,0,0,re),this.addCurrentVertex(se,ie.mult(-1),0,0,re)}else if(At==="bevel"||At==="fakeround"){const $t=-Math.sqrt(mt*mt-1),Et=wt?$t:0,di=wt?0:$t;if(ce&&this.addCurrentVertex(se,Me,Et,di,re),At==="fakeround"){const Oi=Math.round(180*Lt/Math.PI/20);for(let Li=1;Li<Oi;Li++){let Ti=Li/Oi;if(Ti!==.5){const gn=Ti-.5;Ti+=Ti*gn*(Ti-1)*((1.0904+xe*(xe*(3.55645-1.43519*xe)-3.2452))*gn*gn+(.848013+xe*(.215638*xe-1.06021)))}const dr=Xe.sub(Me)._mult(Ti)._add(Me)._unit()._mult(wt?-1:1);this.addHalfVertex(se,dr.x,dr.y,!1,wt,0,re)}}be&&this.addCurrentVertex(se,Xe,-Et,-di,re)}else if(At==="butt")this.addCurrentVertex(se,ie,0,0,re);else if(At==="square"){const $t=ce?1:-1;this.addCurrentVertex(se,ie,$t,$t,re)}else At==="round"&&(ce&&(this.addCurrentVertex(se,Me,0,0,re),this.addCurrentVertex(se,Me,1,1,re,!0)),be&&(this.addCurrentVertex(se,Xe,-1,-1,re,!0),this.addCurrentVertex(se,Xe,0,0,re)));if(xt&&ze<B-1){const $t=se.dist(be);if($t>2*ee){const Et=se.add(be.sub(se)._mult(ee/$t)._round());this.updateDistance(se,Et),this.addCurrentVertex(Et,Xe,0,0,re),se=Et}}}}addCurrentVertex(n,a,p,y,T,E=!1){const M=a.y*y-a.x,A=-a.y-a.x*y;this.addHalfVertex(n,a.x+a.y*p,a.y-a.x*p,E,!1,p,T),this.addHalfVertex(n,M,A,E,!0,-y,T),this.distance>zv/2&&this.totalDistance===0&&(this.distance=0,this.updateScaledDistance(),this.addCurrentVertex(n,a,p,y,T,E))}addHalfVertex({x:n,y:a},p,y,T,E,M,A){const O=.5*(this.lineClips?this.scaledDistance*(zv-1):this.scaledDistance);this.layoutVertexArray.emplaceBack((n<<1)+(T?1:0),(a<<1)+(E?1:0),Math.round(63*p)+128,Math.round(63*y)+128,1+(M===0?0:M<0?-1:1)|(63&O)<<2,O>>6),this.lineClips&&this.layoutVertexArray2.emplaceBack((this.scaledDistance-this.lineClips.start)/(this.lineClips.end-this.lineClips.start),this.lineClipsArray.length);const B=A.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,B,this.e2),A.primitiveLength++),E?this.e2=B:this.e1=B}updateScaledDistance(){this.scaledDistance=this.lineClips?this.lineClips.start+(this.lineClips.end-this.lineClips.start)*this.distance/this.totalDistance:this.distance}updateDistance(n,a){this.distance+=n.dist(a),this.updateScaledDistance()}}let Bv,$v;ni("LineBucket",Tg,{omit:["layers","patternFeatures"]});var jv={get paint(){return $v=$v||new Fs({"line-opacity":new Fi(Ve.paint_line["line-opacity"]),"line-color":new Fi(Ve.paint_line["line-color"]),"line-translate":new mi(Ve.paint_line["line-translate"]),"line-translate-anchor":new mi(Ve.paint_line["line-translate-anchor"]),"line-width":new Fi(Ve.paint_line["line-width"]),"line-gap-width":new Fi(Ve.paint_line["line-gap-width"]),"line-offset":new Fi(Ve.paint_line["line-offset"]),"line-blur":new Fi(Ve.paint_line["line-blur"]),"line-dasharray":new qh(Ve.paint_line["line-dasharray"]),"line-pattern":new zc(Ve.paint_line["line-pattern"]),"line-gradient":new Hu(Ve.paint_line["line-gradient"])})},get layout(){return Bv=Bv||new Fs({"line-cap":new mi(Ve.layout_line["line-cap"]),"line-join":new Fi(Ve.layout_line["line-join"]),"line-miter-limit":new mi(Ve.layout_line["line-miter-limit"]),"line-round-limit":new mi(Ve.layout_line["line-round-limit"]),"line-sort-key":new Fi(Ve.layout_line["line-sort-key"])})}};class eE extends Fi{possiblyEvaluate(n,a){return a=new en(Math.floor(a.zoom),{now:a.now,fadeDuration:a.fadeDuration,zoomHistory:a.zoomHistory,transition:a.transition}),super.possiblyEvaluate(n,a)}evaluate(n,a,p,y){return a=Jt({},a,{zoom:Math.floor(a.zoom)}),super.evaluate(n,a,p,y)}}let qp;class tE extends hs{constructor(n){super(n,jv),this.gradientVersion=0,qp||(qp=new eE(jv.paint.properties["line-width"].specification),qp.useIntegerZoom=!0)}_handleSpecialPaintPropertyUpdate(n){if(n==="line-gradient"){const a=this.gradientExpression();this.stepInterpolant=!!function(p){return p._styleExpression!==void 0}(a)&&a._styleExpression.expression instanceof Ko,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}recalculate(n,a){super.recalculate(n,a),this.paint._values["line-floorwidth"]=qp.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,n)}createBucket(n){return new Tg(n)}queryRadius(n){const a=n,p=Gv(Qh("line-width",this,a),Qh("line-gap-width",this,a)),y=Qh("line-offset",this,a);return p/2+Math.abs(y)+Bp(this.paint.get("line-translate"))}queryIntersectsFeature({queryGeometry:n,feature:a,featureState:p,geometry:y,transform:T,pixelsToTileUnits:E}){const M=$p(n,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),-T.bearingInRadians,E),A=E/2*Gv(this.paint.get("line-width").evaluate(a,p),this.paint.get("line-gap-width").evaluate(a,p)),O=this.paint.get("line-offset").evaluate(a,p);return O&&(y=function(B,q){const ee=[];for(let re=0;re<B.length;re++){const se=B[re],ce=[];for(let be=0;be<se.length;be++){const Me=se[be-1],Xe=se[be],ze=se[be+1],ie=be===0?new H(0,0):Xe.sub(Me)._unit()._perp(),xe=be===se.length-1?new H(0,0):ze.sub(Xe)._unit()._perp(),Ge=ie._add(xe)._unit(),mt=Ge.x*xe.x+Ge.y*xe.y;mt!==0&&Ge._mult(1/mt),ce.push(Ge._mult(q)._add(Xe))}ee.push(ce)}return ee}(y,O*E)),function(B,q,ee){for(let re=0;re<q.length;re++){const se=q[re];if(B.length>=3){for(let ce=0;ce<se.length;ce++)if(jc(B,se[ce]))return!0}if(f2(B,se,ee))return!0}return!1}(M,y,A)}isTileClipped(){return!0}}function Gv(u,n){return n>0?n+2*u:u}const iE=mn([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_data",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),rE=mn([{name:"a_projected_pos",components:3,type:"Float32"}],4);mn([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const nE=mn([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"},{name:"a_box_real",components:2,type:"Int16"}]);mn([{type:"Int16",name:"anchorPointX"},{type:"Int16",name:"anchorPointY"},{type:"Int16",name:"x1"},{type:"Int16",name:"y1"},{type:"Int16",name:"x2"},{type:"Int16",name:"y2"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const Uv=mn([{name:"a_pos",components:2,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),sE=mn([{name:"a_pos",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);function oE(u,n,a){return u.sections.forEach(p=>{p.text=function(y,T,E){const M=T.layout.get("text-transform").evaluate(E,{});return M==="uppercase"?y=y.toLocaleUpperCase():M==="lowercase"&&(y=y.toLocaleLowerCase()),Za.applyArabicShaping&&(y=Za.applyArabicShaping(y)),y}(p.text,n,a)}),u}mn([{name:"triangle",components:3,type:"Uint16"}]),mn([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"}]),mn([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",name:"textBoxScale"},{type:"Float32",name:"collisionCircleDiameter"},{type:"Uint16",name:"textAnchorOffsetStartIndex"},{type:"Uint16",name:"textAnchorOffsetEndIndex"}]),mn([{type:"Float32",name:"offsetX"}]),mn([{type:"Int16",name:"x"},{type:"Int16",name:"y"},{type:"Int16",name:"tileUnitDistanceFromAnchor"}]),mn([{type:"Uint16",name:"textAnchor"},{type:"Float32",components:2,name:"textOffset"}]);const cd={"!":"","#":"",$:"","%":"","&":"","(":"",")":"","*":"","+":"",",":"","-":"",".":"","/":"",":":"",";":"","<":"","=":"",">":"","?":"","@":"","[":"","\\":"","]":"","^":"",_:"","`":"","{":"","|":"","}":"","~":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":""};var Vv,Eg,qv,Qn=24,Ig={};function aE(){return Vv||(Vv=1,Ig.read=function(u,n,a,p,y){var T,E,M=8*y-p-1,A=(1<<M)-1,O=A>>1,B=-7,q=a?y-1:0,ee=a?-1:1,re=u[n+q];for(q+=ee,T=re&(1<<-B)-1,re>>=-B,B+=M;B>0;T=256*T+u[n+q],q+=ee,B-=8);for(E=T&(1<<-B)-1,T>>=-B,B+=p;B>0;E=256*E+u[n+q],q+=ee,B-=8);if(T===0)T=1-O;else{if(T===A)return E?NaN:1/0*(re?-1:1);E+=Math.pow(2,p),T-=O}return(re?-1:1)*E*Math.pow(2,T-p)},Ig.write=function(u,n,a,p,y,T){var E,M,A,O=8*T-y-1,B=(1<<O)-1,q=B>>1,ee=y===23?Math.pow(2,-24)-Math.pow(2,-77):0,re=p?0:T-1,se=p?1:-1,ce=n<0||n===0&&1/n<0?1:0;for(n=Math.abs(n),isNaN(n)||n===1/0?(M=isNaN(n)?1:0,E=B):(E=Math.floor(Math.log(n)/Math.LN2),n*(A=Math.pow(2,-E))<1&&(E--,A*=2),(n+=E+q>=1?ee/A:ee*Math.pow(2,1-q))*A>=2&&(E++,A/=2),E+q>=B?(M=0,E=B):E+q>=1?(M=(n*A-1)*Math.pow(2,y),E+=q):(M=n*Math.pow(2,q-1)*Math.pow(2,y),E=0));y>=8;u[a+re]=255&M,re+=se,M/=256,y-=8);for(E=E<<y|M,O+=y;O>0;u[a+re]=255&E,re+=se,E/=256,O-=8);u[a+re-se]|=128*ce}),Ig}function Zv(){if(qv)return Eg;qv=1,Eg=n;var u=aE();function n(ie){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(ie)?ie:new Uint8Array(ie||0),this.pos=0,this.type=0,this.length=this.buf.length}n.Varint=0,n.Fixed64=1,n.Bytes=2,n.Fixed32=5;var a=4294967296,p=1/a,y=typeof TextDecoder>"u"?null:new TextDecoder("utf-8");function T(ie){return ie.type===n.Bytes?ie.readVarint()+ie.pos:ie.pos+1}function E(ie,xe,Ge){return Ge?4294967296*xe+(ie>>>0):4294967296*(xe>>>0)+(ie>>>0)}function M(ie,xe,Ge){var mt=xe<=16383?1:xe<=2097151?2:xe<=268435455?3:Math.floor(Math.log(xe)/(7*Math.LN2));Ge.realloc(mt);for(var Lt=Ge.pos-1;Lt>=ie;Lt--)Ge.buf[Lt+mt]=Ge.buf[Lt]}function A(ie,xe){for(var Ge=0;Ge<ie.length;Ge++)xe.writeVarint(ie[Ge])}function O(ie,xe){for(var Ge=0;Ge<ie.length;Ge++)xe.writeSVarint(ie[Ge])}function B(ie,xe){for(var Ge=0;Ge<ie.length;Ge++)xe.writeFloat(ie[Ge])}function q(ie,xe){for(var Ge=0;Ge<ie.length;Ge++)xe.writeDouble(ie[Ge])}function ee(ie,xe){for(var Ge=0;Ge<ie.length;Ge++)xe.writeBoolean(ie[Ge])}function re(ie,xe){for(var Ge=0;Ge<ie.length;Ge++)xe.writeFixed32(ie[Ge])}function se(ie,xe){for(var Ge=0;Ge<ie.length;Ge++)xe.writeSFixed32(ie[Ge])}function ce(ie,xe){for(var Ge=0;Ge<ie.length;Ge++)xe.writeFixed64(ie[Ge])}function be(ie,xe){for(var Ge=0;Ge<ie.length;Ge++)xe.writeSFixed64(ie[Ge])}function Me(ie,xe){return(ie[xe]|ie[xe+1]<<8|ie[xe+2]<<16)+16777216*ie[xe+3]}function Xe(ie,xe,Ge){ie[Ge]=xe,ie[Ge+1]=xe>>>8,ie[Ge+2]=xe>>>16,ie[Ge+3]=xe>>>24}function ze(ie,xe){return(ie[xe]|ie[xe+1]<<8|ie[xe+2]<<16)+(ie[xe+3]<<24)}return n.prototype={destroy:function(){this.buf=null},readFields:function(ie,xe,Ge){for(Ge=Ge||this.length;this.pos<Ge;){var mt=this.readVarint(),Lt=mt>>3,xt=this.pos;this.type=7&mt,ie(Lt,xe,this),this.pos===xt&&this.skip(mt)}return xe},readMessage:function(ie,xe){return this.readFields(ie,xe,this.readVarint()+this.pos)},readFixed32:function(){var ie=Me(this.buf,this.pos);return this.pos+=4,ie},readSFixed32:function(){var ie=ze(this.buf,this.pos);return this.pos+=4,ie},readFixed64:function(){var ie=Me(this.buf,this.pos)+Me(this.buf,this.pos+4)*a;return this.pos+=8,ie},readSFixed64:function(){var ie=Me(this.buf,this.pos)+ze(this.buf,this.pos+4)*a;return this.pos+=8,ie},readFloat:function(){var ie=u.read(this.buf,this.pos,!0,23,4);return this.pos+=4,ie},readDouble:function(){var ie=u.read(this.buf,this.pos,!0,52,8);return this.pos+=8,ie},readVarint:function(ie){var xe,Ge,mt=this.buf;return xe=127&(Ge=mt[this.pos++]),Ge<128?xe:(xe|=(127&(Ge=mt[this.pos++]))<<7,Ge<128?xe:(xe|=(127&(Ge=mt[this.pos++]))<<14,Ge<128?xe:(xe|=(127&(Ge=mt[this.pos++]))<<21,Ge<128?xe:function(Lt,xt,wt){var Gt,At,$t=wt.buf;if(Gt=(112&(At=$t[wt.pos++]))>>4,At<128||(Gt|=(127&(At=$t[wt.pos++]))<<3,At<128)||(Gt|=(127&(At=$t[wt.pos++]))<<10,At<128)||(Gt|=(127&(At=$t[wt.pos++]))<<17,At<128)||(Gt|=(127&(At=$t[wt.pos++]))<<24,At<128)||(Gt|=(1&(At=$t[wt.pos++]))<<31,At<128))return E(Lt,Gt,xt);throw new Error("Expected varint not more than 10 bytes")}(xe|=(15&(Ge=mt[this.pos]))<<28,ie,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var ie=this.readVarint();return ie%2==1?(ie+1)/-2:ie/2},readBoolean:function(){return!!this.readVarint()},readString:function(){var ie=this.readVarint()+this.pos,xe=this.pos;return this.pos=ie,ie-xe>=12&&y?function(Ge,mt,Lt){return y.decode(Ge.subarray(mt,Lt))}(this.buf,xe,ie):function(Ge,mt,Lt){for(var xt="",wt=mt;wt<Lt;){var Gt,At,$t,Et=Ge[wt],di=null,Oi=Et>239?4:Et>223?3:Et>191?2:1;if(wt+Oi>Lt)break;Oi===1?Et<128&&(di=Et):Oi===2?(192&(Gt=Ge[wt+1]))==128&&(di=(31&Et)<<6|63&Gt)<=127&&(di=null):Oi===3?(At=Ge[wt+2],(192&(Gt=Ge[wt+1]))==128&&(192&At)==128&&((di=(15&Et)<<12|(63&Gt)<<6|63&At)<=2047||di>=55296&&di<=57343)&&(di=null)):Oi===4&&(At=Ge[wt+2],$t=Ge[wt+3],(192&(Gt=Ge[wt+1]))==128&&(192&At)==128&&(192&$t)==128&&((di=(15&Et)<<18|(63&Gt)<<12|(63&At)<<6|63&$t)<=65535||di>=1114112)&&(di=null)),di===null?(di=65533,Oi=1):di>65535&&(di-=65536,xt+=String.fromCharCode(di>>>10&1023|55296),di=56320|1023&di),xt+=String.fromCharCode(di),wt+=Oi}return xt}(this.buf,xe,ie)},readBytes:function(){var ie=this.readVarint()+this.pos,xe=this.buf.subarray(this.pos,ie);return this.pos=ie,xe},readPackedVarint:function(ie,xe){if(this.type!==n.Bytes)return ie.push(this.readVarint(xe));var Ge=T(this);for(ie=ie||[];this.pos<Ge;)ie.push(this.readVarint(xe));return ie},readPackedSVarint:function(ie){if(this.type!==n.Bytes)return ie.push(this.readSVarint());var xe=T(this);for(ie=ie||[];this.pos<xe;)ie.push(this.readSVarint());return ie},readPackedBoolean:function(ie){if(this.type!==n.Bytes)return ie.push(this.readBoolean());var xe=T(this);for(ie=ie||[];this.pos<xe;)ie.push(this.readBoolean());return ie},readPackedFloat:function(ie){if(this.type!==n.Bytes)return ie.push(this.readFloat());var xe=T(this);for(ie=ie||[];this.pos<xe;)ie.push(this.readFloat());return ie},readPackedDouble:function(ie){if(this.type!==n.Bytes)return ie.push(this.readDouble());var xe=T(this);for(ie=ie||[];this.pos<xe;)ie.push(this.readDouble());return ie},readPackedFixed32:function(ie){if(this.type!==n.Bytes)return ie.push(this.readFixed32());var xe=T(this);for(ie=ie||[];this.pos<xe;)ie.push(this.readFixed32());return ie},readPackedSFixed32:function(ie){if(this.type!==n.Bytes)return ie.push(this.readSFixed32());var xe=T(this);for(ie=ie||[];this.pos<xe;)ie.push(this.readSFixed32());return ie},readPackedFixed64:function(ie){if(this.type!==n.Bytes)return ie.push(this.readFixed64());var xe=T(this);for(ie=ie||[];this.pos<xe;)ie.push(this.readFixed64());return ie},readPackedSFixed64:function(ie){if(this.type!==n.Bytes)return ie.push(this.readSFixed64());var xe=T(this);for(ie=ie||[];this.pos<xe;)ie.push(this.readSFixed64());return ie},skip:function(ie){var xe=7&ie;if(xe===n.Varint)for(;this.buf[this.pos++]>127;);else if(xe===n.Bytes)this.pos=this.readVarint()+this.pos;else if(xe===n.Fixed32)this.pos+=4;else{if(xe!==n.Fixed64)throw new Error("Unimplemented type: "+xe);this.pos+=8}},writeTag:function(ie,xe){this.writeVarint(ie<<3|xe)},realloc:function(ie){for(var xe=this.length||16;xe<this.pos+ie;)xe*=2;if(xe!==this.length){var Ge=new Uint8Array(xe);Ge.set(this.buf),this.buf=Ge,this.length=xe}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(ie){this.realloc(4),Xe(this.buf,ie,this.pos),this.pos+=4},writeSFixed32:function(ie){this.realloc(4),Xe(this.buf,ie,this.pos),this.pos+=4},writeFixed64:function(ie){this.realloc(8),Xe(this.buf,-1&ie,this.pos),Xe(this.buf,Math.floor(ie*p),this.pos+4),this.pos+=8},writeSFixed64:function(ie){this.realloc(8),Xe(this.buf,-1&ie,this.pos),Xe(this.buf,Math.floor(ie*p),this.pos+4),this.pos+=8},writeVarint:function(ie){(ie=+ie||0)>268435455||ie<0?function(xe,Ge){var mt,Lt;if(xe>=0?(mt=xe%4294967296|0,Lt=xe/4294967296|0):(Lt=~(-xe/4294967296),4294967295^(mt=~(-xe%4294967296))?mt=mt+1|0:(mt=0,Lt=Lt+1|0)),xe>=18446744073709552e3||xe<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");Ge.realloc(10),function(xt,wt,Gt){Gt.buf[Gt.pos++]=127&xt|128,xt>>>=7,Gt.buf[Gt.pos++]=127&xt|128,xt>>>=7,Gt.buf[Gt.pos++]=127&xt|128,xt>>>=7,Gt.buf[Gt.pos++]=127&xt|128,Gt.buf[Gt.pos]=127&(xt>>>=7)}(mt,0,Ge),function(xt,wt){var Gt=(7&xt)<<4;wt.buf[wt.pos++]|=Gt|((xt>>>=3)?128:0),xt&&(wt.buf[wt.pos++]=127&xt|((xt>>>=7)?128:0),xt&&(wt.buf[wt.pos++]=127&xt|((xt>>>=7)?128:0),xt&&(wt.buf[wt.pos++]=127&xt|((xt>>>=7)?128:0),xt&&(wt.buf[wt.pos++]=127&xt|((xt>>>=7)?128:0),xt&&(wt.buf[wt.pos++]=127&xt)))))}(Lt,Ge)}(ie,this):(this.realloc(4),this.buf[this.pos++]=127&ie|(ie>127?128:0),ie<=127||(this.buf[this.pos++]=127&(ie>>>=7)|(ie>127?128:0),ie<=127||(this.buf[this.pos++]=127&(ie>>>=7)|(ie>127?128:0),ie<=127||(this.buf[this.pos++]=ie>>>7&127))))},writeSVarint:function(ie){this.writeVarint(ie<0?2*-ie-1:2*ie)},writeBoolean:function(ie){this.writeVarint(!!ie)},writeString:function(ie){ie=String(ie),this.realloc(4*ie.length),this.pos++;var xe=this.pos;this.pos=function(mt,Lt,xt){for(var wt,Gt,At=0;At<Lt.length;At++){if((wt=Lt.charCodeAt(At))>55295&&wt<57344){if(!Gt){wt>56319||At+1===Lt.length?(mt[xt++]=239,mt[xt++]=191,mt[xt++]=189):Gt=wt;continue}if(wt<56320){mt[xt++]=239,mt[xt++]=191,mt[xt++]=189,Gt=wt;continue}wt=Gt-55296<<10|wt-56320|65536,Gt=null}else Gt&&(mt[xt++]=239,mt[xt++]=191,mt[xt++]=189,Gt=null);wt<128?mt[xt++]=wt:(wt<2048?mt[xt++]=wt>>6|192:(wt<65536?mt[xt++]=wt>>12|224:(mt[xt++]=wt>>18|240,mt[xt++]=wt>>12&63|128),mt[xt++]=wt>>6&63|128),mt[xt++]=63&wt|128)}return xt}(this.buf,ie,this.pos);var Ge=this.pos-xe;Ge>=128&&M(xe,Ge,this),this.pos=xe-1,this.writeVarint(Ge),this.pos+=Ge},writeFloat:function(ie){this.realloc(4),u.write(this.buf,ie,this.pos,!0,23,4),this.pos+=4},writeDouble:function(ie){this.realloc(8),u.write(this.buf,ie,this.pos,!0,52,8),this.pos+=8},writeBytes:function(ie){var xe=ie.length;this.writeVarint(xe),this.realloc(xe);for(var Ge=0;Ge<xe;Ge++)this.buf[this.pos++]=ie[Ge]},writeRawMessage:function(ie,xe){this.pos++;var Ge=this.pos;ie(xe,this);var mt=this.pos-Ge;mt>=128&&M(Ge,mt,this),this.pos=Ge-1,this.writeVarint(mt),this.pos+=mt},writeMessage:function(ie,xe,Ge){this.writeTag(ie,n.Bytes),this.writeRawMessage(xe,Ge)},writePackedVarint:function(ie,xe){xe.length&&this.writeMessage(ie,A,xe)},writePackedSVarint:function(ie,xe){xe.length&&this.writeMessage(ie,O,xe)},writePackedBoolean:function(ie,xe){xe.length&&this.writeMessage(ie,ee,xe)},writePackedFloat:function(ie,xe){xe.length&&this.writeMessage(ie,B,xe)},writePackedDouble:function(ie,xe){xe.length&&this.writeMessage(ie,q,xe)},writePackedFixed32:function(ie,xe){xe.length&&this.writeMessage(ie,re,xe)},writePackedSFixed32:function(ie,xe){xe.length&&this.writeMessage(ie,se,xe)},writePackedFixed64:function(ie,xe){xe.length&&this.writeMessage(ie,ce,xe)},writePackedSFixed64:function(ie,xe){xe.length&&this.writeMessage(ie,be,xe)},writeBytesField:function(ie,xe){this.writeTag(ie,n.Bytes),this.writeBytes(xe)},writeFixed32Field:function(ie,xe){this.writeTag(ie,n.Fixed32),this.writeFixed32(xe)},writeSFixed32Field:function(ie,xe){this.writeTag(ie,n.Fixed32),this.writeSFixed32(xe)},writeFixed64Field:function(ie,xe){this.writeTag(ie,n.Fixed64),this.writeFixed64(xe)},writeSFixed64Field:function(ie,xe){this.writeTag(ie,n.Fixed64),this.writeSFixed64(xe)},writeVarintField:function(ie,xe){this.writeTag(ie,n.Varint),this.writeVarint(xe)},writeSVarintField:function(ie,xe){this.writeTag(ie,n.Varint),this.writeSVarint(xe)},writeStringField:function(ie,xe){this.writeTag(ie,n.Bytes),this.writeString(xe)},writeFloatField:function(ie,xe){this.writeTag(ie,n.Fixed32),this.writeFloat(xe)},writeDoubleField:function(ie,xe){this.writeTag(ie,n.Fixed64),this.writeDouble(xe)},writeBooleanField:function(ie,xe){this.writeVarintField(ie,!!xe)}},Eg}var mu,Sg=P(Zv());function lE(u,n,a){u===1&&a.readMessage(uE,n)}function uE(u,n,a){if(u===3){const{id:p,bitmap:y,width:T,height:E,left:M,top:A,advance:O}=a.readMessage(cE,{});n.push({id:p,bitmap:new ed({width:T+6,height:E+6},y),metrics:{width:T,height:E,left:M,top:A,advance:O}})}}function cE(u,n,a){u===1?n.id=a.readVarint():u===2?n.bitmap=a.readBytes():u===3?n.width=a.readVarint():u===4?n.height=a.readVarint():u===5?n.left=a.readSVarint():u===6?n.top=a.readSVarint():u===7&&(n.advance=a.readVarint())}function Wv(u){let n=0,a=0;for(const E of u)n+=E.w*E.h,a=Math.max(a,E.w);u.sort((E,M)=>M.h-E.h);const p=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(n/.95)),a),h:1/0}];let y=0,T=0;for(const E of u)for(let M=p.length-1;M>=0;M--){const A=p[M];if(!(E.w>A.w||E.h>A.h)){if(E.x=A.x,E.y=A.y,T=Math.max(T,E.y+E.h),y=Math.max(y,E.x+E.w),E.w===A.w&&E.h===A.h){const O=p.pop();M<p.length&&(p[M]=O)}else E.h===A.h?(A.x+=E.w,A.w-=E.w):E.w===A.w?(A.y+=E.h,A.h-=E.h):(p.push({x:A.x+E.w,y:A.y,w:A.w-E.w,h:E.h}),A.y+=E.h,A.h-=E.h);break}}return{w:y,h:T,fill:n/(y*T)||0}}class Mg{constructor(n,{pixelRatio:a,version:p,stretchX:y,stretchY:T,content:E,textFitWidth:M,textFitHeight:A}){this.paddedRect=n,this.pixelRatio=a,this.stretchX=y,this.stretchY=T,this.content=E,this.version=p,this.textFitWidth=M,this.textFitHeight=A}get tl(){return[this.paddedRect.x+1,this.paddedRect.y+1]}get br(){return[this.paddedRect.x+this.paddedRect.w-1,this.paddedRect.y+this.paddedRect.h-1]}get tlbr(){return this.tl.concat(this.br)}get displaySize(){return[(this.paddedRect.w-2)/this.pixelRatio,(this.paddedRect.h-2)/this.pixelRatio]}}class Yv{constructor(n,a){const p={},y={};this.haveRenderCallbacks=[];const T=[];this.addImages(n,p,T),this.addImages(a,y,T);const{w:E,h:M}=Wv(T),A=new so({width:E||1,height:M||1});for(const O in n){const B=n[O],q=p[O].paddedRect;so.copy(B.data,A,{x:0,y:0},{x:q.x+1,y:q.y+1},B.data)}for(const O in a){const B=a[O],q=y[O].paddedRect,ee=q.x+1,re=q.y+1,se=B.data.width,ce=B.data.height;so.copy(B.data,A,{x:0,y:0},{x:ee,y:re},B.data),so.copy(B.data,A,{x:0,y:ce-1},{x:ee,y:re-1},{width:se,height:1}),so.copy(B.data,A,{x:0,y:0},{x:ee,y:re+ce},{width:se,height:1}),so.copy(B.data,A,{x:se-1,y:0},{x:ee-1,y:re},{width:1,height:ce}),so.copy(B.data,A,{x:0,y:0},{x:ee+se,y:re},{width:1,height:ce})}this.image=A,this.iconPositions=p,this.patternPositions=y}addImages(n,a,p){for(const y in n){const T=n[y],E={x:0,y:0,w:T.data.width+2,h:T.data.height+2};p.push(E),a[y]=new Mg(E,T),T.hasRenderCallback&&this.haveRenderCallbacks.push(y)}}patchUpdatedImages(n,a){n.dispatchRenderCallbacks(this.haveRenderCallbacks);for(const p in n.updatedImages)this.patchUpdatedImage(this.iconPositions[p],n.getImage(p),a),this.patchUpdatedImage(this.patternPositions[p],n.getImage(p),a)}patchUpdatedImage(n,a,p){if(!n||!a||n.version===a.version)return;n.version=a.version;const[y,T]=n.tl;p.update(a.data,void 0,{x:y,y:T})}}ni("ImagePosition",Mg),ni("ImageAtlas",Yv),m.an=void 0,(mu=m.an||(m.an={}))[mu.none=0]="none",mu[mu.horizontal=1]="horizontal",mu[mu.vertical=2]="vertical",mu[mu.horizontalOnly=3]="horizontalOnly";class hd{constructor(){this.scale=1,this.fontStack="",this.imageName=null,this.verticalAlign="bottom"}static forText(n,a,p){const y=new hd;return y.scale=n||1,y.fontStack=a,y.verticalAlign=p||"bottom",y}static forImage(n,a){const p=new hd;return p.imageName=n,p.verticalAlign=a||"bottom",p}}class qc{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(n,a){const p=new qc;for(let y=0;y<n.sections.length;y++){const T=n.sections[y];T.image?p.addImageSection(T):p.addTextSection(T,a)}return p}length(){return this.text.length}getSection(n){return this.sections[this.sectionIndex[n]]}getSectionIndex(n){return this.sectionIndex[n]}getCharCode(n){return this.text.charCodeAt(n)}verticalizePunctuation(){this.text=function(n){let a="";for(let p=0;p<n.length;p++){const y=n.charCodeAt(p+1)||null,T=n.charCodeAt(p-1)||null;a+=y&&Gh(y)&&!cd[n[p+1]]||T&&Gh(T)&&!cd[n[p-1]]||!cd[n[p]]?n[p]:cd[n[p]]}return a}(this.text)}trim(){let n=0;for(let p=0;p<this.text.length&&Wp[this.text.charCodeAt(p)];p++)n++;let a=this.text.length;for(let p=this.text.length-1;p>=0&&p>=n&&Wp[this.text.charCodeAt(p)];p--)a--;this.text=this.text.substring(n,a),this.sectionIndex=this.sectionIndex.slice(n,a)}substring(n,a){const p=new qc;return p.text=this.text.substring(n,a),p.sectionIndex=this.sectionIndex.slice(n,a),p.sections=this.sections,p}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce((n,a)=>Math.max(n,this.sections[a].scale),0)}getMaxImageSize(n){let a=0,p=0;for(let y=0;y<this.length();y++){const T=this.getSection(y);if(T.imageName){const E=n[T.imageName];if(!E)continue;const M=E.displaySize;a=Math.max(a,M[0]),p=Math.max(p,M[1])}}return{maxImageWidth:a,maxImageHeight:p}}addTextSection(n,a){this.text+=n.text,this.sections.push(hd.forText(n.scale,n.fontStack||a,n.verticalAlign));const p=this.sections.length-1;for(let y=0;y<n.text.length;++y)this.sectionIndex.push(p)}addImageSection(n){const a=n.image?n.image.name:"";if(a.length===0)return void jr("Can't add FormattedSection with an empty image.");const p=this.getNextImageSectionCharCode();p?(this.text+=String.fromCharCode(p),this.sections.push(hd.forImage(a,n.verticalAlign)),this.sectionIndex.push(this.sections.length-1)):jr("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function Zp(u,n,a,p,y,T,E,M,A,O,B,q,ee,re,se){const ce=qc.fromFeature(u,y);let be;q===m.an.vertical&&ce.verticalizePunctuation();const{processBidirectionalText:Me,processStyledBidirectionalText:Xe}=Za;if(Me&&ce.sections.length===1){be=[];const xe=Me(ce.toString(),Pg(ce,O,T,n,p,re));for(const Ge of xe){const mt=new qc;mt.text=Ge,mt.sections=ce.sections;for(let Lt=0;Lt<Ge.length;Lt++)mt.sectionIndex.push(0);be.push(mt)}}else if(Xe){be=[];const xe=Xe(ce.text,ce.sectionIndex,Pg(ce,O,T,n,p,re));for(const Ge of xe){const mt=new qc;mt.text=Ge[0],mt.sectionIndex=Ge[1],mt.sections=ce.sections,be.push(mt)}}else be=function(xe,Ge){const mt=[],Lt=xe.text;let xt=0;for(const wt of Ge)mt.push(xe.substring(xt,wt)),xt=wt;return xt<Lt.length&&mt.push(xe.substring(xt,Lt.length)),mt}(ce,Pg(ce,O,T,n,p,re));const ze=[],ie={positionedLines:ze,text:ce.toString(),top:B[1],bottom:B[1],left:B[0],right:B[0],writingMode:q,iconsInText:!1,verticalizable:!1};return function(xe,Ge,mt,Lt,xt,wt,Gt,At,$t,Et,di,Oi){let Li=0,Ti=0,dr=0,gn=0;const qn=At==="right"?1:At==="left"?0:.5,Is=Qn/Oi;let Bo=0;for(const ln of xt){ln.trim();const es=ln.getMaxScale(),ms={positionedGlyphs:[],lineOffset:0};xe.positionedLines[Bo]=ms;const gs=ms.positionedGlyphs;let Ys=0;if(!ln.length()){Ti+=wt,++Bo;continue}const $o=fE(Lt,ln,Is);for(let ao=0;ao<ln.length();ao++){const Zn=ln.getSection(ao),is=ln.getSectionIndex(ao),rs=ln.getCharCode(ao),Bn=mE($t,di,rs);let Hr;if(Zn.imageName){if(xe.iconsInText=!0,Zn.scale=Zn.scale*Is,Hr=yE(Zn,Bn,es,$o,Lt),!Hr)continue;Ys=Math.max(Ys,Hr.imageOffset)}else if(Hr=gE(Zn,rs,Bn,$o,Ge,mt),!Hr)continue;const{rect:Ea,metrics:Xc,baselineOffset:Ia}=Hr;gs.push({glyph:rs,imageName:Zn.imageName,x:Li,y:Ti+Ia+-17,vertical:Bn,scale:Zn.scale,fontStack:Zn.fontStack,sectionIndex:is,metrics:Xc,rect:Ea}),Bn?(xe.verticalizable=!0,Li+=(Zn.imageName?Xc.advance:Qn)*Zn.scale+Et):Li+=Xc.advance*Zn.scale+Et}gs.length!==0&&(dr=Math.max(Li-Et,dr),_E(gs,0,gs.length-1,qn)),Li=0,ms.lineOffset=Math.max(Ys,(es-1)*Qn);const ts=wt*es+Ys;Ti+=ts,gn=Math.max(ts,gn),++Bo}const{horizontalAlign:oo,verticalAlign:fs}=kg(Gt);(function(ln,es,ms,gs,Ys,$o,ts,ao,Zn){const is=(es-ms)*Ys;let rs=0;rs=$o!==ts?-ao*gs- -17:-gs*Zn*ts+.5*ts;for(const Bn of ln)for(const Hr of Bn.positionedGlyphs)Hr.x+=is,Hr.y+=rs})(xe.positionedLines,qn,oo,fs,dr,gn,wt,Ti,xt.length),xe.top+=-fs*Ti,xe.bottom=xe.top+Ti,xe.left+=-oo*dr,xe.right=xe.left+dr}(ie,n,a,p,be,E,M,A,q,O,ee,se),!function(xe){for(const Ge of xe)if(Ge.positionedGlyphs.length!==0)return!1;return!0}(ze)&&ie}const Wp={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},hE={10:!0,32:!0,38:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0},dE={40:!0};function Xv(u,n,a,p,y,T){if(n.imageName){const E=p[n.imageName];return E?E.displaySize[0]*n.scale*Qn/T+y:0}{const E=a[n.fontStack],M=E&&E[u];return M?M.metrics.advance*n.scale+y:0}}function Hv(u,n,a,p){const y=Math.pow(u-n,2);return p?u<n?y/2:2*y:y+Math.abs(a)*a}function pE(u,n,a){let p=0;return u===10&&(p-=1e4),a&&(p+=150),u!==40&&u!==65288||(p+=50),n!==41&&n!==65289||(p+=50),p}function Kv(u,n,a,p,y,T){let E=null,M=Hv(n,a,y,T);for(const A of p){const O=Hv(n-A.x,a,y,T)+A.badness;O<=M&&(E=A,M=O)}return{index:u,x:n,priorBreak:E,badness:M}}function Jv(u){return u?Jv(u.priorBreak).concat(u.index):[]}function Pg(u,n,a,p,y,T){if(!u)return[];const E=[],M=function(q,ee,re,se,ce,be){let Me=0;for(let Xe=0;Xe<q.length();Xe++){const ze=q.getSection(Xe);Me+=Xv(q.getCharCode(Xe),ze,se,ce,ee,be)}return Me/Math.max(1,Math.ceil(Me/re))}(u,n,a,p,y,T),A=u.text.indexOf("")>=0;let O=0;for(let q=0;q<u.length();q++){const ee=u.getSection(q),re=u.getCharCode(q);if(Wp[re]||(O+=Xv(re,ee,p,y,n,T)),q<u.length()-1){const se=!((B=re)<11904)&&(!!ar["CJK Compatibility Forms"](B)||!!ar["CJK Compatibility"](B)||!!ar["CJK Strokes"](B)||!!ar["CJK Symbols and Punctuation"](B)||!!ar["Enclosed CJK Letters and Months"](B)||!!ar["Halfwidth and Fullwidth Forms"](B)||!!ar["Ideographic Description Characters"](B)||!!ar["Vertical Forms"](B)||jh.test(String.fromCodePoint(B)));(hE[re]||se||ee.imageName||q!==u.length()-2&&dE[u.getCharCode(q+1)])&&E.push(Kv(q+1,O,M,E,pE(re,u.getCharCode(q+1),se&&A),!1))}}var B;return Jv(Kv(u.length(),O,M,E,0,!0))}function kg(u){let n=.5,a=.5;switch(u){case"right":case"top-right":case"bottom-right":n=1;break;case"left":case"top-left":case"bottom-left":n=0}switch(u){case"bottom":case"bottom-right":case"bottom-left":a=1;break;case"top":case"top-right":case"top-left":a=0}return{horizontalAlign:n,verticalAlign:a}}function fE(u,n,a){const p=n.getMaxScale()*Qn,{maxImageWidth:y,maxImageHeight:T}=n.getMaxImageSize(u),E=Math.max(p,T*a);return{verticalLineContentWidth:Math.max(p,y*a),horizontalLineContentHeight:E}}function Qv(u){switch(u){case"top":return 0;case"center":return .5;default:return 1}}function mE(u,n,a){return!(u===m.an.horizontal||!n&&!Oc(a)||n&&(Wp[a]||(p=a,new RegExp("\\p{sc=Arab}","u").test(String.fromCodePoint(p)))));var p}function gE(u,n,a,p,y,T){const E=T[u.fontStack],M=function(O,B,q,ee){if(O&&O.rect)return O;const re=B[q.fontStack],se=re&&re[ee];return se?{rect:null,metrics:se.metrics}:null}(E&&E[n],y,u,n);if(M===null)return null;let A;if(a)A=p.verticalLineContentWidth-u.scale*Qn;else{const O=Qv(u.verticalAlign);A=(p.horizontalLineContentHeight-u.scale*Qn)*O}return{rect:M.rect,metrics:M.metrics,baselineOffset:A}}function yE(u,n,a,p,y){const T=y[u.imageName];if(!T)return null;const E=T.paddedRect,M=T.displaySize,A={width:M[0],height:M[1],left:1,top:-3,advance:n?M[1]:M[0]};let O;if(n)O=p.verticalLineContentWidth-M[1]*u.scale;else{const B=Qv(u.verticalAlign);O=(p.horizontalLineContentHeight-M[1]*u.scale)*B}return{rect:E,metrics:A,baselineOffset:O,imageOffset:(n?M[0]:M[1])*u.scale-Qn*a}}function _E(u,n,a,p){if(p===0)return;const y=u[a],T=(u[a].x+y.metrics.advance*y.scale)*p;for(let E=n;E<=a;E++)u[E].x-=T}function vE(u,n,a){const{horizontalAlign:p,verticalAlign:y}=kg(a),T=n[0]-u.displaySize[0]*p,E=n[1]-u.displaySize[1]*y;return{image:u,top:E,bottom:E+u.displaySize[1],left:T,right:T+u.displaySize[0]}}function e0(u){var n,a;let p=u.left,y=u.top,T=u.right-p,E=u.bottom-y;const M=(n=u.image.textFitWidth)!==null&&n!==void 0?n:"stretchOrShrink",A=(a=u.image.textFitHeight)!==null&&a!==void 0?a:"stretchOrShrink",O=(u.image.content[2]-u.image.content[0])/(u.image.content[3]-u.image.content[1]);if(A==="proportional"){if(M==="stretchOnly"&&T/E<O||M==="proportional"){const B=Math.ceil(E*O);p*=B/T,T=B}}else if(M==="proportional"&&A==="stretchOnly"&&O!==0&&T/E>O){const B=Math.ceil(T/O);y*=B/E,E=B}return{x1:p,y1:y,x2:p+T,y2:y+E}}function t0(u,n,a,p,y,T){const E=u.image;let M;if(E.content){const be=E.content,Me=E.pixelRatio||1;M=[be[0]/Me,be[1]/Me,E.displaySize[0]-be[2]/Me,E.displaySize[1]-be[3]/Me]}const A=n.left*T,O=n.right*T;let B,q,ee,re;a==="width"||a==="both"?(re=y[0]+A-p[3],q=y[0]+O+p[1]):(re=y[0]+(A+O-E.displaySize[0])/2,q=re+E.displaySize[0]);const se=n.top*T,ce=n.bottom*T;return a==="height"||a==="both"?(B=y[1]+se-p[0],ee=y[1]+ce+p[2]):(B=y[1]+(se+ce-E.displaySize[1])/2,ee=B+E.displaySize[1]),{image:E,top:B,right:q,bottom:ee,left:re,collisionPadding:M}}const Tl=128,gu=32640;function i0(u,n){const{expression:a}=n;if(a.kind==="constant")return{kind:"constant",layoutSize:a.evaluate(new en(u+1))};if(a.kind==="source")return{kind:"source"};{const{zoomStops:p,interpolationType:y}=a;let T=0;for(;T<p.length&&p[T]<=u;)T++;T=Math.max(0,T-1);let E=T;for(;E<p.length&&p[E]<u+1;)E++;E=Math.min(p.length-1,E);const M=p[T],A=p[E];return a.kind==="composite"?{kind:"composite",minZoom:M,maxZoom:A,interpolationType:y}:{kind:"camera",minZoom:M,maxZoom:A,minSize:a.evaluate(new en(M)),maxSize:a.evaluate(new en(A)),interpolationType:y}}}function Cg(u,n,a){let p="never";const y=u.get(n);return y?p=y:u.get(a)&&(p="always"),p}const xE=ad.VectorTileFeature.types,bE=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function Yp(u,n,a,p,y,T,E,M,A,O,B,q,ee){const re=M?Math.min(gu,Math.round(M[0])):0,se=M?Math.min(gu,Math.round(M[1])):0;u.emplaceBack(n,a,Math.round(32*p),Math.round(32*y),T,E,(re<<1)+(A?1:0),se,16*O,16*B,256*q,256*ee)}function Ag(u,n,a){u.emplaceBack(n.x,n.y,a),u.emplaceBack(n.x,n.y,a),u.emplaceBack(n.x,n.y,a),u.emplaceBack(n.x,n.y,a)}function wE(u){for(const n of u.sections)if(Uh(n.text))return!0;return!1}class Lg{constructor(n){this.layoutVertexArray=new Ji,this.indexArray=new Gr,this.programConfigurations=n,this.segments=new xr,this.dynamicLayoutVertexArray=new Pr,this.opacityVertexArray=new on,this.hasVisibleVertices=!1,this.placedSymbolArray=new Ee}isEmpty(){return this.layoutVertexArray.length===0&&this.indexArray.length===0&&this.dynamicLayoutVertexArray.length===0&&this.opacityVertexArray.length===0}upload(n,a,p,y){this.isEmpty()||(p&&(this.layoutVertexBuffer=n.createVertexBuffer(this.layoutVertexArray,iE.members),this.indexBuffer=n.createIndexBuffer(this.indexArray,a),this.dynamicLayoutVertexBuffer=n.createVertexBuffer(this.dynamicLayoutVertexArray,rE.members,!0),this.opacityVertexBuffer=n.createVertexBuffer(this.opacityVertexArray,bE,!0),this.opacityVertexBuffer.itemSize=1),(p||y)&&this.programConfigurations.upload(n))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy())}}ni("SymbolBuffers",Lg);class Rg{constructor(n,a,p){this.layoutVertexArray=new n,this.layoutAttributes=a,this.indexArray=new p,this.segments=new xr,this.collisionVertexArray=new an}upload(n){this.layoutVertexBuffer=n.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=n.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=n.createVertexBuffer(this.collisionVertexArray,nE.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy())}}ni("CollisionBuffers",Rg);class Zc{constructor(n){this.collisionBoxArray=n.collisionBoxArray,this.zoom=n.zoom,this.globalState=n.globalState,this.overscaling=n.overscaling,this.layers=n.layers,this.layerIds=this.layers.map(E=>E.id),this.index=n.index,this.pixelRatio=n.pixelRatio,this.sourceLayerIndex=n.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.sortKeyRanges=[],this.collisionCircleArray=[];const a=this.layers[0]._unevaluatedLayout._values;this.textSizeData=i0(this.zoom,a["text-size"]),this.iconSizeData=i0(this.zoom,a["icon-size"]);const p=this.layers[0].layout,y=p.get("symbol-sort-key"),T=p.get("symbol-z-order");this.canOverlap=Cg(p,"text-overlap","text-allow-overlap")!=="never"||Cg(p,"icon-overlap","icon-allow-overlap")!=="never"||p.get("text-ignore-placement")||p.get("icon-ignore-placement"),this.sortFeaturesByKey=T!=="viewport-y"&&!y.isConstant(),this.sortFeaturesByY=(T==="viewport-y"||T==="auto"&&!this.sortFeaturesByKey)&&this.canOverlap,p.get("symbol-placement")==="point"&&(this.writingModes=p.get("text-writing-mode").map(E=>m.an[E])),this.stateDependentLayerIds=this.layers.filter(E=>E.isStateDependent()).map(E=>E.id),this.sourceID=n.sourceID}createArrays(){this.text=new Lg(new Qa(this.layers,this.zoom,n=>/^text/.test(n))),this.icon=new Lg(new Qa(this.layers,this.zoom,n=>/^icon/.test(n))),this.glyphOffsetArray=new Oe,this.lineVertexArray=new Ue,this.symbolInstances=new Fe,this.textAnchorOffsets=new De}calculateGlyphDependencies(n,a,p,y,T){for(let E=0;E<n.length;E++)if(a[n.charCodeAt(E)]=!0,(p||y)&&T){const M=cd[n.charAt(E)];M&&(a[M.charCodeAt(0)]=!0)}}populate(n,a,p){const y=this.layers[0],T=y.layout,E=T.get("text-font"),M=T.get("text-field"),A=T.get("icon-image"),O=(M.value.kind!=="constant"||M.value.value instanceof ei&&!M.value.value.isEmpty()||M.value.value.toString().length>0)&&(E.value.kind!=="constant"||E.value.value.length>0),B=A.value.kind!=="constant"||!!A.value.value||Object.keys(A.parameters).length>0,q=T.get("symbol-sort-key");if(this.features=[],!O&&!B)return;const ee=a.iconDependencies,re=a.glyphDependencies,se=a.availableImages,ce=new en(this.zoom,{globalState:this.globalState});for(const{feature:be,id:Me,index:Xe,sourceLayerIndex:ze}of n){const ie=y._featureFilter.needGeometry,xe=rc(be,ie);if(!y._featureFilter.filter(ce,xe,p))continue;let Ge,mt;if(ie||(xe.geometry=ic(be)),O){const xt=y.getValueAndResolveTokens("text-field",xe,p,se),wt=ei.factory(xt),Gt=this.hasRTLText=this.hasRTLText||wE(wt);(!Gt||Za.getRTLTextPluginStatus()==="unavailable"||Gt&&Za.isParsed())&&(Ge=oE(wt,y,xe))}if(B){const xt=y.getValueAndResolveTokens("icon-image",xe,p,se);mt=xt instanceof Pn?xt:Pn.fromString(xt)}if(!Ge&&!mt)continue;const Lt=this.sortFeaturesByKey?q.evaluate(xe,{},p):void 0;if(this.features.push({id:Me,text:Ge,icon:mt,index:Xe,sourceLayerIndex:ze,geometry:xe.geometry,properties:be.properties,type:xE[be.type],sortKey:Lt}),mt&&(ee[mt.name]=!0),Ge){const xt=E.evaluate(xe,{},p).join(","),wt=T.get("text-rotation-alignment")!=="viewport"&&T.get("symbol-placement")!=="point";this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(m.an.vertical)>=0;for(const Gt of Ge.sections)if(Gt.image)ee[Gt.image.name]=!0;else{const At=$h(Ge.toString()),$t=Gt.fontStack||xt,Et=re[$t]=re[$t]||{};this.calculateGlyphDependencies(Gt.text,Et,wt,this.allowVerticalPlacement,At)}}}T.get("symbol-placement")==="line"&&(this.features=function(be){const Me={},Xe={},ze=[];let ie=0;function xe(xt){ze.push(be[xt]),ie++}function Ge(xt,wt,Gt){const At=Xe[xt];return delete Xe[xt],Xe[wt]=At,ze[At].geometry[0].pop(),ze[At].geometry[0]=ze[At].geometry[0].concat(Gt[0]),At}function mt(xt,wt,Gt){const At=Me[wt];return delete Me[wt],Me[xt]=At,ze[At].geometry[0].shift(),ze[At].geometry[0]=Gt[0].concat(ze[At].geometry[0]),At}function Lt(xt,wt,Gt){const At=Gt?wt[0][wt[0].length-1]:wt[0][0];return`${xt}:${At.x}:${At.y}`}for(let xt=0;xt<be.length;xt++){const wt=be[xt],Gt=wt.geometry,At=wt.text?wt.text.toString():null;if(!At){xe(xt);continue}const $t=Lt(At,Gt),Et=Lt(At,Gt,!0);if($t in Xe&&Et in Me&&Xe[$t]!==Me[Et]){const di=mt($t,Et,Gt),Oi=Ge($t,Et,ze[di].geometry);delete Me[$t],delete Xe[Et],Xe[Lt(At,ze[Oi].geometry,!0)]=Oi,ze[di].geometry=null}else $t in Xe?Ge($t,Et,Gt):Et in Me?mt($t,Et,Gt):(xe(xt),Me[$t]=ie-1,Xe[Et]=ie-1)}return ze.filter(xt=>xt.geometry)}(this.features)),this.sortFeaturesByKey&&this.features.sort((be,Me)=>be.sortKey-Me.sortKey)}update(n,a,p){this.stateDependentLayers.length&&(this.text.programConfigurations.updatePaintArrays(n,a,this.layers,p),this.icon.programConfigurations.updatePaintArrays(n,a,this.layers,p))}isEmpty(){return this.symbolInstances.length===0&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(n){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(n),this.iconCollisionBox.upload(n)),this.text.upload(n,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload),this.icon.upload(n,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(n,a){const p=this.lineVertexArray.length;if(n.segment!==void 0){let y=n.dist(a[n.segment+1]),T=n.dist(a[n.segment]);const E={};for(let M=n.segment+1;M<a.length;M++)E[M]={x:a[M].x,y:a[M].y,tileUnitDistanceFromAnchor:y},M<a.length-1&&(y+=a[M+1].dist(a[M]));for(let M=n.segment||0;M>=0;M--)E[M]={x:a[M].x,y:a[M].y,tileUnitDistanceFromAnchor:T},M>0&&(T+=a[M-1].dist(a[M]));for(let M=0;M<a.length;M++){const A=E[M];this.lineVertexArray.emplaceBack(A.x,A.y,A.tileUnitDistanceFromAnchor)}}return{lineStartIndex:p,lineLength:this.lineVertexArray.length-p}}addSymbols(n,a,p,y,T,E,M,A,O,B,q,ee){const re=n.indexArray,se=n.layoutVertexArray,ce=n.segments.prepareSegment(4*a.length,se,re,this.canOverlap?E.sortKey:void 0),be=this.glyphOffsetArray.length,Me=ce.vertexLength,Xe=this.allowVerticalPlacement&&M===m.an.vertical?Math.PI/2:0,ze=E.text&&E.text.sections;for(let ie=0;ie<a.length;ie++){const{tl:xe,tr:Ge,bl:mt,br:Lt,tex:xt,pixelOffsetTL:wt,pixelOffsetBR:Gt,minFontScaleX:At,minFontScaleY:$t,glyphOffset:Et,isSDF:di,sectionIndex:Oi}=a[ie],Li=ce.vertexLength,Ti=Et[1];Yp(se,A.x,A.y,xe.x,Ti+xe.y,xt.x,xt.y,p,di,wt.x,wt.y,At,$t),Yp(se,A.x,A.y,Ge.x,Ti+Ge.y,xt.x+xt.w,xt.y,p,di,Gt.x,wt.y,At,$t),Yp(se,A.x,A.y,mt.x,Ti+mt.y,xt.x,xt.y+xt.h,p,di,wt.x,Gt.y,At,$t),Yp(se,A.x,A.y,Lt.x,Ti+Lt.y,xt.x+xt.w,xt.y+xt.h,p,di,Gt.x,Gt.y,At,$t),Ag(n.dynamicLayoutVertexArray,A,Xe),re.emplaceBack(Li,Li+2,Li+1),re.emplaceBack(Li+1,Li+2,Li+3),ce.vertexLength+=4,ce.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(Et[0]),ie!==a.length-1&&Oi===a[ie+1].sectionIndex||n.programConfigurations.populatePaintArrays(se.length,E,E.index,{},ee,ze&&ze[Oi])}n.placedSymbolArray.emplaceBack(A.x,A.y,be,this.glyphOffsetArray.length-be,Me,O,B,A.segment,p?p[0]:0,p?p[1]:0,y[0],y[1],M,0,!1,0,q)}_addCollisionDebugVertex(n,a,p,y,T,E){return a.emplaceBack(0,0),n.emplaceBack(p.x,p.y,y,T,Math.round(E.x),Math.round(E.y))}addCollisionDebugVertices(n,a,p,y,T,E,M){const A=T.segments.prepareSegment(4,T.layoutVertexArray,T.indexArray),O=A.vertexLength,B=T.layoutVertexArray,q=T.collisionVertexArray,ee=M.anchorX,re=M.anchorY;this._addCollisionDebugVertex(B,q,E,ee,re,new H(n,a)),this._addCollisionDebugVertex(B,q,E,ee,re,new H(p,a)),this._addCollisionDebugVertex(B,q,E,ee,re,new H(p,y)),this._addCollisionDebugVertex(B,q,E,ee,re,new H(n,y)),A.vertexLength+=4;const se=T.indexArray;se.emplaceBack(O,O+1),se.emplaceBack(O+1,O+2),se.emplaceBack(O+2,O+3),se.emplaceBack(O+3,O),A.primitiveLength+=4}addDebugCollisionBoxes(n,a,p,y){for(let T=n;T<a;T++){const E=this.collisionBoxArray.get(T);this.addCollisionDebugVertices(E.x1,E.y1,E.x2,E.y2,y?this.textCollisionBox:this.iconCollisionBox,E.anchorPoint,p)}}generateCollisionDebugBuffers(){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new Rg(zr,Uv.members,Br),this.iconCollisionBox=new Rg(zr,Uv.members,Br);for(let n=0;n<this.symbolInstances.length;n++){const a=this.symbolInstances.get(n);this.addDebugCollisionBoxes(a.textBoxStartIndex,a.textBoxEndIndex,a,!0),this.addDebugCollisionBoxes(a.verticalTextBoxStartIndex,a.verticalTextBoxEndIndex,a,!0),this.addDebugCollisionBoxes(a.iconBoxStartIndex,a.iconBoxEndIndex,a,!1),this.addDebugCollisionBoxes(a.verticalIconBoxStartIndex,a.verticalIconBoxEndIndex,a,!1)}}_deserializeCollisionBoxesForSymbol(n,a,p,y,T,E,M,A,O){const B={};for(let q=a;q<p;q++){const ee=n.get(q);B.textBox={x1:ee.x1,y1:ee.y1,x2:ee.x2,y2:ee.y2,anchorPointX:ee.anchorPointX,anchorPointY:ee.anchorPointY},B.textFeatureIndex=ee.featureIndex;break}for(let q=y;q<T;q++){const ee=n.get(q);B.verticalTextBox={x1:ee.x1,y1:ee.y1,x2:ee.x2,y2:ee.y2,anchorPointX:ee.anchorPointX,anchorPointY:ee.anchorPointY},B.verticalTextFeatureIndex=ee.featureIndex;break}for(let q=E;q<M;q++){const ee=n.get(q);B.iconBox={x1:ee.x1,y1:ee.y1,x2:ee.x2,y2:ee.y2,anchorPointX:ee.anchorPointX,anchorPointY:ee.anchorPointY},B.iconFeatureIndex=ee.featureIndex;break}for(let q=A;q<O;q++){const ee=n.get(q);B.verticalIconBox={x1:ee.x1,y1:ee.y1,x2:ee.x2,y2:ee.y2,anchorPointX:ee.anchorPointX,anchorPointY:ee.anchorPointY},B.verticalIconFeatureIndex=ee.featureIndex;break}return B}deserializeCollisionBoxes(n){this.collisionArrays=[];for(let a=0;a<this.symbolInstances.length;a++){const p=this.symbolInstances.get(a);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(n,p.textBoxStartIndex,p.textBoxEndIndex,p.verticalTextBoxStartIndex,p.verticalTextBoxEndIndex,p.iconBoxStartIndex,p.iconBoxEndIndex,p.verticalIconBoxStartIndex,p.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}addIndicesForPlacedSymbol(n,a){const p=n.placedSymbolArray.get(a),y=p.vertexStartIndex+4*p.numGlyphs;for(let T=p.vertexStartIndex;T<y;T+=4)n.indexArray.emplaceBack(T,T+2,T+1),n.indexArray.emplaceBack(T+1,T+2,T+3)}getSortedSymbolIndexes(n){if(this.sortedAngle===n&&this.symbolInstanceIndexes!==void 0)return this.symbolInstanceIndexes;const a=Math.sin(n),p=Math.cos(n),y=[],T=[],E=[];for(let M=0;M<this.symbolInstances.length;++M){E.push(M);const A=this.symbolInstances.get(M);y.push(0|Math.round(a*A.anchorX+p*A.anchorY)),T.push(A.featureIndex)}return E.sort((M,A)=>y[M]-y[A]||T[A]-T[M]),E}addToSortKeyRanges(n,a){const p=this.sortKeyRanges[this.sortKeyRanges.length-1];p&&p.sortKey===a?p.symbolInstanceEnd=n+1:this.sortKeyRanges.push({sortKey:a,symbolInstanceStart:n,symbolInstanceEnd:n+1})}sortFeatures(n){if(this.sortFeaturesByY&&this.sortedAngle!==n&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(n),this.sortedAngle=n,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const a of this.symbolInstanceIndexes){const p=this.symbolInstances.get(a);this.featureSortOrder.push(p.featureIndex),[p.rightJustifiedTextSymbolIndex,p.centerJustifiedTextSymbolIndex,p.leftJustifiedTextSymbolIndex].forEach((y,T,E)=>{y>=0&&E.indexOf(y)===T&&this.addIndicesForPlacedSymbol(this.text,y)}),p.verticalPlacedTextSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.text,p.verticalPlacedTextSymbolIndex),p.placedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,p.placedIconSymbolIndex),p.verticalPlacedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,p.verticalPlacedIconSymbolIndex)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}let r0,n0;ni("SymbolBucket",Zc,{omit:["layers","collisionBoxArray","features","compareText"]}),Zc.MAX_GLYPHS=65535,Zc.addDynamicAttributes=Ag;var Ng={get paint(){return n0=n0||new Fs({"icon-opacity":new Fi(Ve.paint_symbol["icon-opacity"]),"icon-color":new Fi(Ve.paint_symbol["icon-color"]),"icon-halo-color":new Fi(Ve.paint_symbol["icon-halo-color"]),"icon-halo-width":new Fi(Ve.paint_symbol["icon-halo-width"]),"icon-halo-blur":new Fi(Ve.paint_symbol["icon-halo-blur"]),"icon-translate":new mi(Ve.paint_symbol["icon-translate"]),"icon-translate-anchor":new mi(Ve.paint_symbol["icon-translate-anchor"]),"text-opacity":new Fi(Ve.paint_symbol["text-opacity"]),"text-color":new Fi(Ve.paint_symbol["text-color"],{runtimeType:Wi,getOverride:u=>u.textColor,hasOverride:u=>!!u.textColor}),"text-halo-color":new Fi(Ve.paint_symbol["text-halo-color"]),"text-halo-width":new Fi(Ve.paint_symbol["text-halo-width"]),"text-halo-blur":new Fi(Ve.paint_symbol["text-halo-blur"]),"text-translate":new mi(Ve.paint_symbol["text-translate"]),"text-translate-anchor":new mi(Ve.paint_symbol["text-translate-anchor"])})},get layout(){return r0=r0||new Fs({"symbol-placement":new mi(Ve.layout_symbol["symbol-placement"]),"symbol-spacing":new mi(Ve.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new mi(Ve.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new Fi(Ve.layout_symbol["symbol-sort-key"]),"symbol-z-order":new mi(Ve.layout_symbol["symbol-z-order"]),"icon-allow-overlap":new mi(Ve.layout_symbol["icon-allow-overlap"]),"icon-overlap":new mi(Ve.layout_symbol["icon-overlap"]),"icon-ignore-placement":new mi(Ve.layout_symbol["icon-ignore-placement"]),"icon-optional":new mi(Ve.layout_symbol["icon-optional"]),"icon-rotation-alignment":new mi(Ve.layout_symbol["icon-rotation-alignment"]),"icon-size":new Fi(Ve.layout_symbol["icon-size"]),"icon-text-fit":new mi(Ve.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new mi(Ve.layout_symbol["icon-text-fit-padding"]),"icon-image":new Fi(Ve.layout_symbol["icon-image"]),"icon-rotate":new Fi(Ve.layout_symbol["icon-rotate"]),"icon-padding":new Fi(Ve.layout_symbol["icon-padding"]),"icon-keep-upright":new mi(Ve.layout_symbol["icon-keep-upright"]),"icon-offset":new Fi(Ve.layout_symbol["icon-offset"]),"icon-anchor":new Fi(Ve.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new mi(Ve.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new mi(Ve.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new mi(Ve.layout_symbol["text-rotation-alignment"]),"text-field":new Fi(Ve.layout_symbol["text-field"]),"text-font":new Fi(Ve.layout_symbol["text-font"]),"text-size":new Fi(Ve.layout_symbol["text-size"]),"text-max-width":new Fi(Ve.layout_symbol["text-max-width"]),"text-line-height":new mi(Ve.layout_symbol["text-line-height"]),"text-letter-spacing":new Fi(Ve.layout_symbol["text-letter-spacing"]),"text-justify":new Fi(Ve.layout_symbol["text-justify"]),"text-radial-offset":new Fi(Ve.layout_symbol["text-radial-offset"]),"text-variable-anchor":new mi(Ve.layout_symbol["text-variable-anchor"]),"text-variable-anchor-offset":new Fi(Ve.layout_symbol["text-variable-anchor-offset"]),"text-anchor":new Fi(Ve.layout_symbol["text-anchor"]),"text-max-angle":new mi(Ve.layout_symbol["text-max-angle"]),"text-writing-mode":new mi(Ve.layout_symbol["text-writing-mode"]),"text-rotate":new Fi(Ve.layout_symbol["text-rotate"]),"text-padding":new mi(Ve.layout_symbol["text-padding"]),"text-keep-upright":new mi(Ve.layout_symbol["text-keep-upright"]),"text-transform":new Fi(Ve.layout_symbol["text-transform"]),"text-offset":new Fi(Ve.layout_symbol["text-offset"]),"text-allow-overlap":new mi(Ve.layout_symbol["text-allow-overlap"]),"text-overlap":new mi(Ve.layout_symbol["text-overlap"]),"text-ignore-placement":new mi(Ve.layout_symbol["text-ignore-placement"]),"text-optional":new mi(Ve.layout_symbol["text-optional"])})}};class s0{constructor(n){if(n.property.overrides===void 0)throw new Error("overrides must be provided to instantiate FormatSectionOverride class");this.type=n.property.overrides?n.property.overrides.runtimeType:Ps,this.defaultValue=n}evaluate(n){if(n.formattedSection){const a=this.defaultValue.property.overrides;if(a&&a.hasOverride(n.formattedSection))return a.getOverride(n.formattedSection)}return n.feature&&n.featureState?this.defaultValue.evaluate(n.feature,n.featureState):this.defaultValue.property.specification.default}eachChild(n){this.defaultValue.isConstant()||n(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}ni("FormatSectionOverride",s0,{omit:["defaultValue"]});class Xp extends hs{constructor(n){super(n,Ng)}recalculate(n,a){if(super.recalculate(n,a),this.layout.get("icon-rotation-alignment")==="auto"&&(this.layout._values["icon-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-rotation-alignment")==="auto"&&(this.layout._values["text-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-pitch-alignment")==="auto"&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")==="map"?"map":"viewport"),this.layout.get("icon-pitch-alignment")==="auto"&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment")),this.layout.get("symbol-placement")==="point"){const p=this.layout.get("text-writing-mode");if(p){const y=[];for(const T of p)y.indexOf(T)<0&&y.push(T);this.layout._values["text-writing-mode"]=y}else this.layout._values["text-writing-mode"]=["horizontal"]}this._setPaintOverrides()}getValueAndResolveTokens(n,a,p,y){const T=this.layout.get(n).evaluate(a,{},p,y),E=this._unevaluatedLayout._values[n];return E.isDataDriven()||Tc(E.value)||!T?T:function(M,A){return A.replace(/{([^{}]+)}/g,(O,B)=>M&&B in M?String(M[B]):"")}(a.properties,T)}createBucket(n){return new Zc(n)}queryRadius(){return 0}queryIntersectsFeature(){throw new Error("Should take a different path in FeatureIndex")}_setPaintOverrides(){for(const n of Ng.paint.overridableProperties){if(!Xp.hasPaintOverride(this.layout,n))continue;const a=this.paint.get(n),p=new s0(a),y=new wc(p,a.property.specification);let T=null;T=a.value.kind==="constant"||a.value.kind==="source"?new Bu("source",y):new Ic("composite",y,a.value.zoomStops),this.paint._values[n]=new aa(a.property,T,a.parameters)}}_handleOverridablePaintPropertyUpdate(n,a,p){return!(!this.layout||a.isDataDriven()||p.isDataDriven())&&Xp.hasPaintOverride(this.layout,n)}static hasPaintOverride(n,a){const p=n.get("text-field"),y=Ng.paint.properties[a];let T=!1;const E=M=>{for(const A of M)if(y.overrides&&y.overrides.hasOverride(A))return void(T=!0)};if(p.value.kind==="constant"&&p.value.value instanceof ei)E(p.value.value.sections);else if(p.value.kind==="source"){const M=O=>{T||(O instanceof hn&&fi(O.value)===vn?E(O.value.sections):O instanceof Co?E(O.sections):O.eachChild(M))},A=p.value;A._styleExpression&&M(A._styleExpression.expression)}return T}}let o0;var TE={get paint(){return o0=o0||new Fs({"background-color":new mi(Ve.paint_background["background-color"]),"background-pattern":new qh(Ve.paint_background["background-pattern"]),"background-opacity":new mi(Ve.paint_background["background-opacity"])})}};class EE extends hs{constructor(n){super(n,TE)}}let a0;var IE={get paint(){return a0=a0||new Fs({"raster-opacity":new mi(Ve.paint_raster["raster-opacity"]),"raster-hue-rotate":new mi(Ve.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new mi(Ve.paint_raster["raster-brightness-min"]),"raster-brightness-max":new mi(Ve.paint_raster["raster-brightness-max"]),"raster-saturation":new mi(Ve.paint_raster["raster-saturation"]),"raster-contrast":new mi(Ve.paint_raster["raster-contrast"]),"raster-resampling":new mi(Ve.paint_raster["raster-resampling"]),"raster-fade-duration":new mi(Ve.paint_raster["raster-fade-duration"])})}};class SE extends hs{constructor(n){super(n,IE)}}class ME extends hs{constructor(n){super(n,{}),this.onAdd=a=>{this.implementation.onAdd&&this.implementation.onAdd(a,a.painter.context.gl)},this.onRemove=a=>{this.implementation.onRemove&&this.implementation.onRemove(a,a.painter.context.gl)},this.implementation=n}is3D(){return this.implementation.renderingMode==="3d"}hasOffscreenPass(){return this.implementation.prerender!==void 0}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){throw new Error("Custom layers cannot be serialized")}}class PE{constructor(n){this._methodToThrottle=n,this._triggered=!1,typeof MessageChannel<"u"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._methodToThrottle()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(()=>{this._triggered=!1,this._methodToThrottle()},0))}remove(){delete this._channel,this._methodToThrottle=()=>{}}}const kE={once:!0},Og=63710088e-1;class yu{constructor(n,a){if(isNaN(n)||isNaN(a))throw new Error(`Invalid LngLat object: (${n}, ${a})`);if(this.lng=+n,this.lat=+a,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new yu(ii(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(n){const a=Math.PI/180,p=this.lat*a,y=n.lat*a,T=Math.sin(p)*Math.sin(y)+Math.cos(p)*Math.cos(y)*Math.cos((n.lng-this.lng)*a);return Og*Math.acos(Math.min(T,1))}static convert(n){if(n instanceof yu)return n;if(Array.isArray(n)&&(n.length===2||n.length===3))return new yu(Number(n[0]),Number(n[1]));if(!Array.isArray(n)&&typeof n=="object"&&n!==null)return new yu(Number("lng"in n?n.lng:n.lon),Number(n.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}const l0=2*Math.PI*Og;function u0(u){return l0*Math.cos(u*Math.PI/180)}function c0(u){return(180+u)/360}function h0(u){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+u*Math.PI/360)))/360}function d0(u,n){return u/u0(n)}function Dg(u){return 360/Math.PI*Math.atan(Math.exp((180-360*u)*Math.PI/180))-90}function p0(u,n){return u*u0(Dg(n))}class dd{constructor(n,a,p=0){this.x=+n,this.y=+a,this.z=+p}static fromLngLat(n,a=0){const p=yu.convert(n);return new dd(c0(p.lng),h0(p.lat),d0(a,p.lat))}toLngLat(){return new yu(360*this.x-180,Dg(this.y))}toAltitude(){return p0(this.z,this.y)}meterInMercatorCoordinateUnits(){return 1/l0*(n=Dg(this.y),1/Math.cos(n*Math.PI/180));var n}}function f0(u,n,a){var p=2*Math.PI*6378137/256/Math.pow(2,a);return[u*p-2*Math.PI*6378137/2,n*p-2*Math.PI*6378137/2]}class Fg{constructor(n,a,p){if(!function(y,T,E){return!(y<0||y>25||E<0||E>=Math.pow(2,y)||T<0||T>=Math.pow(2,y))}(n,a,p))throw new Error(`x=${a}, y=${p}, z=${n} outside of bounds. 0<=x<${Math.pow(2,n)}, 0<=y<${Math.pow(2,n)} 0<=z<=25 `);this.z=n,this.x=a,this.y=p,this.key=Wc(0,n,n,a,p)}equals(n){return this.z===n.z&&this.x===n.x&&this.y===n.y}url(n,a,p){const y=(E=this.y,M=this.z,A=f0(256*(T=this.x),256*(E=Math.pow(2,M)-E-1),M),O=f0(256*(T+1),256*(E+1),M),A[0]+","+A[1]+","+O[0]+","+O[1]);var T,E,M,A,O;const B=function(q,ee,re){let se,ce="";for(let be=q;be>0;be--)se=1<<be-1,ce+=(ee&se?1:0)+(re&se?2:0);return ce}(this.z,this.x,this.y);return n[(this.x+this.y)%n.length].replace(/{prefix}/g,(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String(p==="tms"?Math.pow(2,this.z)-this.y-1:this.y)).replace(/{ratio}/g,a>1?"@2x":"").replace(/{quadkey}/g,B).replace(/{bbox-epsg-3857}/g,y)}isChildOf(n){const a=this.z-n.z;return a>0&&n.x===this.x>>a&&n.y===this.y>>a}getTilePoint(n){const a=Math.pow(2,this.z);return new H((n.x*a-this.x)*It,(n.y*a-this.y)*It)}toString(){return`${this.z}/${this.x}/${this.y}`}}class m0{constructor(n,a){this.wrap=n,this.canonical=a,this.key=Wc(n,a.z,a.z,a.x,a.y)}}class zo{constructor(n,a,p,y,T){if(this.terrainRttPosMatrix32f=null,n<p)throw new Error(`overscaledZ should be >= z; overscaledZ = ${n}; z = ${p}`);this.overscaledZ=n,this.wrap=a,this.canonical=new Fg(p,+y,+T),this.key=Wc(a,n,p,y,T)}clone(){return new zo(this.overscaledZ,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)}equals(n){return this.overscaledZ===n.overscaledZ&&this.wrap===n.wrap&&this.canonical.equals(n.canonical)}scaledTo(n){if(n>this.overscaledZ)throw new Error(`targetZ > this.overscaledZ; targetZ = ${n}; overscaledZ = ${this.overscaledZ}`);const a=this.canonical.z-n;return n>this.canonical.z?new zo(n,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new zo(n,this.wrap,n,this.canonical.x>>a,this.canonical.y>>a)}calculateScaledKey(n,a){if(n>this.overscaledZ)throw new Error(`targetZ > this.overscaledZ; targetZ = ${n}; overscaledZ = ${this.overscaledZ}`);const p=this.canonical.z-n;return n>this.canonical.z?Wc(this.wrap*+a,n,this.canonical.z,this.canonical.x,this.canonical.y):Wc(this.wrap*+a,n,n,this.canonical.x>>p,this.canonical.y>>p)}isChildOf(n){if(n.wrap!==this.wrap)return!1;const a=this.canonical.z-n.canonical.z;return n.overscaledZ===0||n.overscaledZ<this.overscaledZ&&n.canonical.x===this.canonical.x>>a&&n.canonical.y===this.canonical.y>>a}children(n){if(this.overscaledZ>=n)return[new zo(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];const a=this.canonical.z+1,p=2*this.canonical.x,y=2*this.canonical.y;return[new zo(a,this.wrap,a,p,y),new zo(a,this.wrap,a,p+1,y),new zo(a,this.wrap,a,p,y+1),new zo(a,this.wrap,a,p+1,y+1)]}isLessThan(n){return this.wrap<n.wrap||!(this.wrap>n.wrap)&&(this.overscaledZ<n.overscaledZ||!(this.overscaledZ>n.overscaledZ)&&(this.canonical.x<n.canonical.x||!(this.canonical.x>n.canonical.x)&&this.canonical.y<n.canonical.y))}wrapped(){return new zo(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(n){return new zo(this.overscaledZ,n,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new m0(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}getTilePoint(n){return this.canonical.getTilePoint(new dd(n.x-this.wrap,n.y))}}function Wc(u,n,a,p,y){(u*=2)<0&&(u=-1*u-1);const T=1<<a;return(T*T*u+T*y+p).toString(36)+a.toString(36)+n.toString(36)}ni("CanonicalTileID",Fg),ni("OverscaledTileID",zo,{omit:["terrainRttPosMatrix32f"]});class oc{constructor(){this.minX=1/0,this.maxX=-1/0,this.minY=1/0,this.maxY=-1/0}extend(n){return this.minX=Math.min(this.minX,n.x),this.minY=Math.min(this.minY,n.y),this.maxX=Math.max(this.maxX,n.x),this.maxY=Math.max(this.maxY,n.y),this}expandBy(n){return this.minX-=n,this.minY-=n,this.maxX+=n,this.maxY+=n,(this.minX>this.maxX||this.minY>this.maxY)&&(this.minX=1/0,this.maxX=-1/0,this.minY=1/0,this.maxY=-1/0),this}shrinkBy(n){return this.expandBy(-n)}map(n){const a=new oc;return a.extend(n(new H(this.minX,this.minY))),a.extend(n(new H(this.maxX,this.minY))),a.extend(n(new H(this.minX,this.maxY))),a.extend(n(new H(this.maxX,this.maxY))),a}static fromPoints(n){const a=new oc;for(const p of n)a.extend(p);return a}contains(n){return n.x>=this.minX&&n.x<=this.maxX&&n.y>=this.minY&&n.y<=this.maxY}empty(){return this.minX>this.maxX}width(){return this.maxX-this.minX}height(){return this.maxY-this.minY}covers(n){return!this.empty()&&!n.empty()&&n.minX>=this.minX&&n.maxX<=this.maxX&&n.minY>=this.minY&&n.maxY<=this.maxY}intersects(n){return!this.empty()&&!n.empty()&&n.minX<=this.maxX&&n.maxX>=this.minX&&n.minY<=this.maxY&&n.maxY>=this.minY}}class g0{constructor(n){this._stringToNumber={},this._numberToString=[];for(let a=0;a<n.length;a++){const p=n[a];this._stringToNumber[p]=a,this._numberToString[a]=p}}encode(n){return this._stringToNumber[n]}decode(n){if(n>=this._numberToString.length)throw new Error(`Out of bounds. Index requested n=${n} can't be >= this._numberToString.length ${this._numberToString.length}`);return this._numberToString[n]}}class y0{constructor(n,a,p,y,T){this.type="Feature",this._vectorTileFeature=n,n._z=a,n._x=p,n._y=y,this.properties=n.properties,this.id=T}get geometry(){return this._geometry===void 0&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._vectorTileFeature._x,this._vectorTileFeature._y,this._vectorTileFeature._z).geometry),this._geometry}set geometry(n){this._geometry=n}toJSON(){const n={geometry:this.geometry};for(const a in this)a!=="_geometry"&&a!=="_vectorTileFeature"&&(n[a]=this[a]);return n}}class _0{constructor(n,a){this.tileID=n,this.x=n.canonical.x,this.y=n.canonical.y,this.z=n.canonical.z,this.grid=new hu(It,16,0),this.grid3D=new hu(It,16,0),this.featureIndexArray=new yt,this.promoteId=a}insert(n,a,p,y,T,E){const M=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(p,y,T);const A=E?this.grid3D:this.grid;for(let O=0;O<a.length;O++){const B=a[O],q=[1/0,1/0,-1/0,-1/0];for(let ee=0;ee<B.length;ee++){const re=B[ee];q[0]=Math.min(q[0],re.x),q[1]=Math.min(q[1],re.y),q[2]=Math.max(q[2],re.x),q[3]=Math.max(q[3],re.y)}q[0]<It&&q[1]<It&&q[2]>=0&&q[3]>=0&&A.insert(M,q[0],q[1],q[2],q[3])}}loadVTLayers(){return this.vtLayers||(this.vtLayers=new ad.VectorTile(new Sg(this.rawTileData)).layers,this.sourceLayerCoder=new g0(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"])),this.vtLayers}query(n,a,p,y){this.loadVTLayers();const T=n.params,E=It/n.tileSize/n.scale,M=Va(T.filter),A=n.queryGeometry,O=n.queryPadding*E,B=oc.fromPoints(A),q=this.grid.query(B.minX-O,B.minY-O,B.maxX+O,B.maxY+O),ee=oc.fromPoints(n.cameraQueryGeometry).expandBy(O),re=this.grid3D.query(ee.minX,ee.minY,ee.maxX,ee.maxY,(be,Me,Xe,ze)=>function(ie,xe,Ge,mt,Lt){for(const wt of ie)if(xe<=wt.x&&Ge<=wt.y&&mt>=wt.x&&Lt>=wt.y)return!0;const xt=[new H(xe,Ge),new H(xe,Lt),new H(mt,Lt),new H(mt,Ge)];if(ie.length>2){for(const wt of xt)if(jc(ie,wt))return!0}for(let wt=0;wt<ie.length-1;wt++)if(g2(ie[wt],ie[wt+1],xt))return!0;return!1}(n.cameraQueryGeometry,be-O,Me-O,Xe+O,ze+O));for(const be of re)q.push(be);q.sort(CE);const se={};let ce;for(let be=0;be<q.length;be++){const Me=q[be];if(Me===ce)continue;ce=Me;const Xe=this.featureIndexArray.get(Me);let ze=null;this.loadMatchingFeature(se,Xe.bucketIndex,Xe.sourceLayerIndex,Xe.featureIndex,M,T.layers,T.availableImages,a,p,y,(ie,xe,Ge)=>(ze||(ze=ic(ie)),xe.queryIntersectsFeature({queryGeometry:A,feature:ie,featureState:Ge,geometry:ze,zoom:this.z,transform:n.transform,pixelsToTileUnits:E,pixelPosMatrix:n.pixelPosMatrix,unwrappedTileID:this.tileID.toUnwrapped(),getElevation:n.getElevation})))}return se}loadMatchingFeature(n,a,p,y,T,E,M,A,O,B,q){const ee=this.bucketLayerIDs[a];if(E&&!ee.some(be=>E.has(be)))return;const re=this.sourceLayerCoder.decode(p),se=this.vtLayers[re].feature(y);if(T.needGeometry){const be=rc(se,!0);if(!T.filter(new en(this.tileID.overscaledZ),be,this.tileID.canonical))return}else if(!T.filter(new en(this.tileID.overscaledZ),se))return;const ce=this.getId(se,re);for(let be=0;be<ee.length;be++){const Me=ee[be];if(E&&!E.has(Me))continue;const Xe=A[Me];if(!Xe)continue;let ze={};ce&&B&&(ze=B.getState(Xe.sourceLayer||"_geojsonTileLayer",ce));const ie=Jt({},O[Me]);ie.paint=v0(ie.paint,Xe.paint,se,ze,M),ie.layout=v0(ie.layout,Xe.layout,se,ze,M);const xe=!q||q(se,Xe,ze);if(!xe)continue;const Ge=new y0(se,this.z,this.x,this.y,ce);Ge.layer=ie;let mt=n[Me];mt===void 0&&(mt=n[Me]=[]),mt.push({featureIndex:y,feature:Ge,intersectionZ:xe})}}lookupSymbolFeatures(n,a,p,y,T,E,M,A){const O={};this.loadVTLayers();const B=Va(T);for(const q of n)this.loadMatchingFeature(O,p,y,q,B,E,M,A,a);return O}hasLayer(n){for(const a of this.bucketLayerIDs)for(const p of a)if(n===p)return!0;return!1}getId(n,a){var p;let y=n.id;return this.promoteId&&(y=n.properties[typeof this.promoteId=="string"?this.promoteId:this.promoteId[a]],typeof y=="boolean"&&(y=Number(y)),y===void 0&&!((p=n.properties)===null||p===void 0)&&p.cluster&&this.promoteId&&(y=Number(n.properties.cluster_id))),y}}function v0(u,n,a,p,y){return zi(u,(T,E)=>{const M=n instanceof Fc?n.get(E):null;return M&&M.evaluate?M.evaluate(a,p,y):M})}function CE(u,n){return n-u}function x0(u,n,a,p,y){const T=[];for(let E=0;E<u.length;E++){const M=u[E];let A;for(let O=0;O<M.length-1;O++){let B=M[O],q=M[O+1];B.x<n&&q.x<n||(B.x<n?B=new H(n,B.y+(n-B.x)/(q.x-B.x)*(q.y-B.y))._round():q.x<n&&(q=new H(n,B.y+(n-B.x)/(q.x-B.x)*(q.y-B.y))._round()),B.y<a&&q.y<a||(B.y<a?B=new H(B.x+(a-B.y)/(q.y-B.y)*(q.x-B.x),a)._round():q.y<a&&(q=new H(B.x+(a-B.y)/(q.y-B.y)*(q.x-B.x),a)._round()),B.x>=p&&q.x>=p||(B.x>=p?B=new H(p,B.y+(p-B.x)/(q.x-B.x)*(q.y-B.y))._round():q.x>=p&&(q=new H(p,B.y+(p-B.x)/(q.x-B.x)*(q.y-B.y))._round()),B.y>=y&&q.y>=y||(B.y>=y?B=new H(B.x+(y-B.y)/(q.y-B.y)*(q.x-B.x),y)._round():q.y>=y&&(q=new H(B.x+(y-B.y)/(q.y-B.y)*(q.x-B.x),y)._round()),A&&B.equals(A[A.length-1])||(A=[B],T.push(A)),A.push(q)))))}}return T}ni("FeatureIndex",_0,{omit:["rawTileData","sourceLayerCoder"]});class _u extends H{constructor(n,a,p,y){super(n,a),this.angle=p,y!==void 0&&(this.segment=y)}clone(){return new _u(this.x,this.y,this.angle,this.segment)}}function b0(u,n,a,p,y){if(n.segment===void 0||a===0)return!0;let T=n,E=n.segment+1,M=0;for(;M>-a/2;){if(E--,E<0)return!1;M-=u[E].dist(T),T=u[E]}M+=u[E].dist(u[E+1]),E++;const A=[];let O=0;for(;M<a/2;){const B=u[E],q=u[E+1];if(!q)return!1;let ee=u[E-1].angleTo(B)-B.angleTo(q);for(ee=Math.abs((ee+3*Math.PI)%(2*Math.PI)-Math.PI),A.push({distance:M,angleDelta:ee}),O+=ee;M-A[0].distance>p;)O-=A.shift().angleDelta;if(O>y)return!1;E++,M+=B.dist(q)}return!0}function w0(u){let n=0;for(let a=0;a<u.length-1;a++)n+=u[a].dist(u[a+1]);return n}function T0(u,n,a){return u?.6*n*a:0}function E0(u,n){return Math.max(u?u.right-u.left:0,n?n.right-n.left:0)}function AE(u,n,a,p,y,T){const E=T0(a,y,T),M=E0(a,p)*T;let A=0;const O=w0(u)/2;for(let B=0;B<u.length-1;B++){const q=u[B],ee=u[B+1],re=q.dist(ee);if(A+re>O){const se=(O-A)/re,ce=Fr.number(q.x,ee.x,se),be=Fr.number(q.y,ee.y,se),Me=new _u(ce,be,ee.angleTo(q),B);return Me._round(),!E||b0(u,Me,M,E,n)?Me:void 0}A+=re}}function LE(u,n,a,p,y,T,E,M,A){const O=T0(p,T,E),B=E0(p,y),q=B*E,ee=u[0].x===0||u[0].x===A||u[0].y===0||u[0].y===A;return n-q<n/4&&(n=q+n/4),I0(u,ee?n/2*M%n:(B/2+2*T)*E*M%n,n,O,a,q,ee,!1,A)}function I0(u,n,a,p,y,T,E,M,A){const O=T/2,B=w0(u);let q=0,ee=n-a,re=[];for(let se=0;se<u.length-1;se++){const ce=u[se],be=u[se+1],Me=ce.dist(be),Xe=be.angleTo(ce);for(;ee+a<q+Me;){ee+=a;const ze=(ee-q)/Me,ie=Fr.number(ce.x,be.x,ze),xe=Fr.number(ce.y,be.y,ze);if(ie>=0&&ie<A&&xe>=0&&xe<A&&ee-O>=0&&ee+O<=B){const Ge=new _u(ie,xe,Xe,se);Ge._round(),p&&!b0(u,Ge,T,p,y)||re.push(Ge)}}q+=Me}return M||re.length||E||(re=I0(u,q/2,a,p,y,T,E,!0,A)),re}function S0(u,n,a,p){const y=[],T=u.image,E=T.pixelRatio,M=T.paddedRect.w-2,A=T.paddedRect.h-2;let O={x1:u.left,y1:u.top,x2:u.right,y2:u.bottom};const B=T.stretchX||[[0,M]],q=T.stretchY||[[0,A]],ee=(Et,di)=>Et+di[1]-di[0],re=B.reduce(ee,0),se=q.reduce(ee,0),ce=M-re,be=A-se;let Me=0,Xe=re,ze=0,ie=se,xe=0,Ge=ce,mt=0,Lt=be;if(T.content&&p){const Et=T.content,di=Et[2]-Et[0],Oi=Et[3]-Et[1];(T.textFitWidth||T.textFitHeight)&&(O=e0(u)),Me=Hp(B,0,Et[0]),ze=Hp(q,0,Et[1]),Xe=Hp(B,Et[0],Et[2]),ie=Hp(q,Et[1],Et[3]),xe=Et[0]-Me,mt=Et[1]-ze,Ge=di-Xe,Lt=Oi-ie}const xt=O.x1,wt=O.y1,Gt=O.x2-xt,At=O.y2-wt,$t=(Et,di,Oi,Li)=>{const Ti=Kp(Et.stretch-Me,Xe,Gt,xt),dr=Jp(Et.fixed-xe,Ge,Et.stretch,re),gn=Kp(di.stretch-ze,ie,At,wt),qn=Jp(di.fixed-mt,Lt,di.stretch,se),Is=Kp(Oi.stretch-Me,Xe,Gt,xt),Bo=Jp(Oi.fixed-xe,Ge,Oi.stretch,re),oo=Kp(Li.stretch-ze,ie,At,wt),fs=Jp(Li.fixed-mt,Lt,Li.stretch,se),ln=new H(Ti,gn),es=new H(Is,gn),ms=new H(Is,oo),gs=new H(Ti,oo),Ys=new H(dr/E,qn/E),$o=new H(Bo/E,fs/E),ts=n*Math.PI/180;if(ts){const is=Math.sin(ts),rs=Math.cos(ts),Bn=[rs,-is,is,rs];ln._matMult(Bn),es._matMult(Bn),gs._matMult(Bn),ms._matMult(Bn)}const ao=Et.stretch+Et.fixed,Zn=di.stretch+di.fixed;return{tl:ln,tr:es,bl:gs,br:ms,tex:{x:T.paddedRect.x+1+ao,y:T.paddedRect.y+1+Zn,w:Oi.stretch+Oi.fixed-ao,h:Li.stretch+Li.fixed-Zn},writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:Ys,pixelOffsetBR:$o,minFontScaleX:Ge/E/Gt,minFontScaleY:Lt/E/At,isSDF:a}};if(p&&(T.stretchX||T.stretchY)){const Et=M0(B,ce,re),di=M0(q,be,se);for(let Oi=0;Oi<Et.length-1;Oi++){const Li=Et[Oi],Ti=Et[Oi+1];for(let dr=0;dr<di.length-1;dr++)y.push($t(Li,di[dr],Ti,di[dr+1]))}}else y.push($t({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:M+1},{fixed:0,stretch:A+1}));return y}function Hp(u,n,a){let p=0;for(const y of u)p+=Math.max(n,Math.min(a,y[1]))-Math.max(n,Math.min(a,y[0]));return p}function M0(u,n,a){const p=[{fixed:-1,stretch:0}];for(const[y,T]of u){const E=p[p.length-1];p.push({fixed:y-E.stretch,stretch:E.stretch}),p.push({fixed:y-E.stretch,stretch:E.stretch+(T-y)})}return p.push({fixed:n+1,stretch:a}),p}function Kp(u,n,a,p){return u/n*a+p}function Jp(u,n,a,p){return u-n*a/p}ni("Anchor",_u);class Qp{constructor(n,a,p,y,T,E,M,A,O,B){var q;if(this.boxStartIndex=n.length,O){let ee=E.top,re=E.bottom;const se=E.collisionPadding;se&&(ee-=se[1],re+=se[3]);let ce=re-ee;ce>0&&(ce=Math.max(10,ce),this.circleDiameter=ce)}else{const ee=!((q=E.image)===null||q===void 0)&&q.content&&(E.image.textFitWidth||E.image.textFitHeight)?e0(E):{x1:E.left,y1:E.top,x2:E.right,y2:E.bottom};ee.y1=ee.y1*M-A[0],ee.y2=ee.y2*M+A[2],ee.x1=ee.x1*M-A[3],ee.x2=ee.x2*M+A[1];const re=E.collisionPadding;if(re&&(ee.x1-=re[0]*M,ee.y1-=re[1]*M,ee.x2+=re[2]*M,ee.y2+=re[3]*M),B){const se=new H(ee.x1,ee.y1),ce=new H(ee.x2,ee.y1),be=new H(ee.x1,ee.y2),Me=new H(ee.x2,ee.y2),Xe=B*Math.PI/180;se._rotate(Xe),ce._rotate(Xe),be._rotate(Xe),Me._rotate(Xe),ee.x1=Math.min(se.x,ce.x,be.x,Me.x),ee.x2=Math.max(se.x,ce.x,be.x,Me.x),ee.y1=Math.min(se.y,ce.y,be.y,Me.y),ee.y2=Math.max(se.y,ce.y,be.y,Me.y)}n.emplaceBack(a.x,a.y,ee.x1,ee.y1,ee.x2,ee.y2,p,y,T)}this.boxEndIndex=n.length}}class RE{constructor(n=[],a=(p,y)=>p<y?-1:p>y?1:0){if(this.data=n,this.length=this.data.length,this.compare=a,this.length>0)for(let p=(this.length>>1)-1;p>=0;p--)this._down(p)}push(n){this.data.push(n),this._up(this.length++)}pop(){if(this.length===0)return;const n=this.data[0],a=this.data.pop();return--this.length>0&&(this.data[0]=a,this._down(0)),n}peek(){return this.data[0]}_up(n){const{data:a,compare:p}=this,y=a[n];for(;n>0;){const T=n-1>>1,E=a[T];if(p(y,E)>=0)break;a[n]=E,n=T}a[n]=y}_down(n){const{data:a,compare:p}=this,y=this.length>>1,T=a[n];for(;n<y;){let E=1+(n<<1);const M=E+1;if(M<this.length&&p(a[M],a[E])<0&&(E=M),p(a[E],T)>=0)break;a[n]=a[E],n=E}a[n]=T}}function NE(u,n=1,a=!1){const p=oc.fromPoints(u[0]),y=Math.min(p.width(),p.height());let T=y/2;const E=new RE([],OE),{minX:M,minY:A,maxX:O,maxY:B}=p;if(y===0)return new H(M,A);for(let re=M;re<O;re+=y)for(let se=A;se<B;se+=y)E.push(new Yc(re+T,se+T,T,u));let q=function(re){let se=0,ce=0,be=0;const Me=re[0];for(let Xe=0,ze=Me.length,ie=ze-1;Xe<ze;ie=Xe++){const xe=Me[Xe],Ge=Me[ie],mt=xe.x*Ge.y-Ge.x*xe.y;ce+=(xe.x+Ge.x)*mt,be+=(xe.y+Ge.y)*mt,se+=3*mt}return new Yc(ce/se,be/se,0,re)}(u),ee=E.length;for(;E.length;){const re=E.pop();(re.d>q.d||!q.d)&&(q=re,a&&console.log("found best %d after %d probes",Math.round(1e4*re.d)/1e4,ee)),re.max-q.d<=n||(T=re.h/2,E.push(new Yc(re.p.x-T,re.p.y-T,T,u)),E.push(new Yc(re.p.x+T,re.p.y-T,T,u)),E.push(new Yc(re.p.x-T,re.p.y+T,T,u)),E.push(new Yc(re.p.x+T,re.p.y+T,T,u)),ee+=4)}return a&&(console.log(`num probes: ${ee}`),console.log(`best distance: ${q.d}`)),q.p}function OE(u,n){return n.max-u.max}function Yc(u,n,a,p){this.p=new H(u,n),this.h=a,this.d=function(y,T){let E=!1,M=1/0;for(let A=0;A<T.length;A++){const O=T[A];for(let B=0,q=O.length,ee=q-1;B<q;ee=B++){const re=O[B],se=O[ee];re.y>y.y!=se.y>y.y&&y.x<(se.x-re.x)*(y.y-re.y)/(se.y-re.y)+re.x&&(E=!E),M=Math.min(M,ov(y,re,se))}}return(E?1:-1)*Math.sqrt(M)}(this.p,p),this.max=this.d+this.h*Math.SQRT2}var Es;m.aD=void 0,(Es=m.aD||(m.aD={}))[Es.center=1]="center",Es[Es.left=2]="left",Es[Es.right=3]="right",Es[Es.top=4]="top",Es[Es.bottom=5]="bottom",Es[Es["top-left"]=6]="top-left",Es[Es["top-right"]=7]="top-right",Es[Es["bottom-left"]=8]="bottom-left",Es[Es["bottom-right"]=9]="bottom-right";const zg=Number.POSITIVE_INFINITY;function P0(u,n){return n[1]!==zg?function(a,p,y){let T=0,E=0;switch(p=Math.abs(p),y=Math.abs(y),a){case"top-right":case"top-left":case"top":E=y-7;break;case"bottom-right":case"bottom-left":case"bottom":E=7-y}switch(a){case"top-right":case"bottom-right":case"right":T=-p;break;case"top-left":case"bottom-left":case"left":T=p}return[T,E]}(u,n[0],n[1]):function(a,p){let y=0,T=0;p<0&&(p=0);const E=p/Math.SQRT2;switch(a){case"top-right":case"top-left":T=E-7;break;case"bottom-right":case"bottom-left":T=7-E;break;case"bottom":T=7-p;break;case"top":T=p-7}switch(a){case"top-right":case"bottom-right":y=-E;break;case"top-left":case"bottom-left":y=E;break;case"left":y=p;break;case"right":y=-p}return[y,T]}(u,n[0])}function k0(u,n,a){var p;const y=u.layout,T=(p=y.get("text-variable-anchor-offset"))===null||p===void 0?void 0:p.evaluate(n,{},a);if(T){const M=T.values,A=[];for(let O=0;O<M.length;O+=2){const B=A[O]=M[O],q=M[O+1].map(ee=>ee*Qn);B.startsWith("top")?q[1]-=7:B.startsWith("bottom")&&(q[1]+=7),A[O+1]=q}return new ui(A)}const E=y.get("text-variable-anchor");if(E){let M;M=u._unevaluatedLayout.getValue("text-radial-offset")!==void 0?[y.get("text-radial-offset").evaluate(n,{},a)*Qn,zg]:y.get("text-offset").evaluate(n,{},a).map(O=>O*Qn);const A=[];for(const O of E)A.push(O,P0(O,M));return new ui(A)}return null}function Bg(u){switch(u){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function DE(u,n,a,p,y,T,E,M,A,O,B,q){let ee=T.textMaxSize.evaluate(n,{});ee===void 0&&(ee=E);const re=u.layers[0].layout,se=re.get("icon-offset").evaluate(n,{},B),ce=A0(a.horizontal),be=E/24,Me=u.tilePixelRatio*be,Xe=u.tilePixelRatio*ee/24,ze=u.tilePixelRatio*M,ie=u.tilePixelRatio*re.get("symbol-spacing"),xe=re.get("text-padding")*u.tilePixelRatio,Ge=function(Oi,Li,Ti,dr=1){const gn=Oi.get("icon-padding").evaluate(Li,{},Ti),qn=gn&&gn.values;return[qn[0]*dr,qn[1]*dr,qn[2]*dr,qn[3]*dr]}(re,n,B,u.tilePixelRatio),mt=re.get("text-max-angle")/180*Math.PI,Lt=re.get("text-rotation-alignment")!=="viewport"&&re.get("symbol-placement")!=="point",xt=re.get("icon-rotation-alignment")==="map"&&re.get("symbol-placement")!=="point",wt=re.get("symbol-placement"),Gt=ie/2,At=re.get("icon-text-fit");let $t;p&&At!=="none"&&(u.allowVerticalPlacement&&a.vertical&&($t=t0(p,a.vertical,At,re.get("icon-text-fit-padding"),se,be)),ce&&(p=t0(p,ce,At,re.get("icon-text-fit-padding"),se,be)));const Et=B?q.line.getGranularityForZoomLevel(B.z):1,di=(Oi,Li)=>{Li.x<0||Li.x>=It||Li.y<0||Li.y>=It||function(Ti,dr,gn,qn,Is,Bo,oo,fs,ln,es,ms,gs,Ys,$o,ts,ao,Zn,is,rs,Bn,Hr,Ea,Xc,Ia,BE){const Hc=Ti.addToLineVertexArray(dr,gn);let ac,Kc,Jc,Qc,O0=0,D0=0,F0=0,z0=0,Wg=-1,Yg=-1;const El={};let B0=Ws("");if(Ti.allowVerticalPlacement&&qn.vertical){const Bs=fs.layout.get("text-rotate").evaluate(Hr,{},Ia)+90;Jc=new Qp(ln,dr,es,ms,gs,qn.vertical,Ys,$o,ts,Bs),oo&&(Qc=new Qp(ln,dr,es,ms,gs,oo,Zn,is,ts,Bs))}if(Is){const Bs=fs.layout.get("icon-rotate").evaluate(Hr,{}),ua=fs.layout.get("icon-text-fit")!=="none",lc=S0(Is,Bs,Xc,ua),el=oo?S0(oo,Bs,Xc,ua):void 0;Kc=new Qp(ln,dr,es,ms,gs,Is,Zn,is,!1,Bs),O0=4*lc.length;const uc=Ti.iconSizeData;let tl=null;uc.kind==="source"?(tl=[Tl*fs.layout.get("icon-size").evaluate(Hr,{})],tl[0]>gu&&jr(`${Ti.layerIds[0]}: Value for "icon-size" is >= 255. Reduce your "icon-size".`)):uc.kind==="composite"&&(tl=[Tl*Ea.compositeIconSizes[0].evaluate(Hr,{},Ia),Tl*Ea.compositeIconSizes[1].evaluate(Hr,{},Ia)],(tl[0]>gu||tl[1]>gu)&&jr(`${Ti.layerIds[0]}: Value for "icon-size" is >= 255. Reduce your "icon-size".`)),Ti.addSymbols(Ti.icon,lc,tl,Bn,rs,Hr,m.an.none,dr,Hc.lineStartIndex,Hc.lineLength,-1,Ia),Wg=Ti.icon.placedSymbolArray.length-1,el&&(D0=4*el.length,Ti.addSymbols(Ti.icon,el,tl,Bn,rs,Hr,m.an.vertical,dr,Hc.lineStartIndex,Hc.lineLength,-1,Ia),Yg=Ti.icon.placedSymbolArray.length-1)}const $0=Object.keys(qn.horizontal);for(const Bs of $0){const ua=qn.horizontal[Bs];if(!ac){B0=Ws(ua.text);const el=fs.layout.get("text-rotate").evaluate(Hr,{},Ia);ac=new Qp(ln,dr,es,ms,gs,ua,Ys,$o,ts,el)}const lc=ua.positionedLines.length===1;if(F0+=C0(Ti,dr,ua,Bo,fs,ts,Hr,ao,Hc,qn.vertical?m.an.horizontal:m.an.horizontalOnly,lc?$0:[Bs],El,Wg,Ea,Ia),lc)break}qn.vertical&&(z0+=C0(Ti,dr,qn.vertical,Bo,fs,ts,Hr,ao,Hc,m.an.vertical,["vertical"],El,Yg,Ea,Ia));const $E=ac?ac.boxStartIndex:Ti.collisionBoxArray.length,jE=ac?ac.boxEndIndex:Ti.collisionBoxArray.length,GE=Jc?Jc.boxStartIndex:Ti.collisionBoxArray.length,UE=Jc?Jc.boxEndIndex:Ti.collisionBoxArray.length,VE=Kc?Kc.boxStartIndex:Ti.collisionBoxArray.length,qE=Kc?Kc.boxEndIndex:Ti.collisionBoxArray.length,ZE=Qc?Qc.boxStartIndex:Ti.collisionBoxArray.length,WE=Qc?Qc.boxEndIndex:Ti.collisionBoxArray.length;let Sa=-1;const tf=(Bs,ua)=>Bs&&Bs.circleDiameter?Math.max(Bs.circleDiameter,ua):ua;Sa=tf(ac,Sa),Sa=tf(Jc,Sa),Sa=tf(Kc,Sa),Sa=tf(Qc,Sa);const j0=Sa>-1?1:0;j0&&(Sa*=BE/Qn),Ti.glyphOffsetArray.length>=Zc.MAX_GLYPHS&&jr("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),Hr.sortKey!==void 0&&Ti.addToSortKeyRanges(Ti.symbolInstances.length,Hr.sortKey);const YE=k0(fs,Hr,Ia),[XE,HE]=function(Bs,ua){const lc=Bs.length,el=ua?.values;if(el?.length>0)for(let uc=0;uc<el.length;uc+=2){const tl=el[uc+1];Bs.emplaceBack(m.aD[el[uc]],tl[0],tl[1])}return[lc,Bs.length]}(Ti.textAnchorOffsets,YE);Ti.symbolInstances.emplaceBack(dr.x,dr.y,El.right>=0?El.right:-1,El.center>=0?El.center:-1,El.left>=0?El.left:-1,El.vertical||-1,Wg,Yg,B0,$E,jE,GE,UE,VE,qE,ZE,WE,es,F0,z0,O0,D0,j0,0,Ys,Sa,XE,HE)}(u,Li,Oi,a,p,y,$t,u.layers[0],u.collisionBoxArray,n.index,n.sourceLayerIndex,u.index,Me,[xe,xe,xe,xe],Lt,A,ze,Ge,xt,se,n,T,O,B,E)};if(wt==="line")for(const Oi of x0(n.geometry,0,0,It,It)){const Li=sc(Oi,Et),Ti=LE(Li,ie,mt,a.vertical||ce,p,24,Xe,u.overscaling,It);for(const dr of Ti)ce&&FE(u,ce.text,Gt,dr)||di(Li,dr)}else if(wt==="line-center"){for(const Oi of n.geometry)if(Oi.length>1){const Li=sc(Oi,Et),Ti=AE(Li,mt,a.vertical||ce,p,24,Xe);Ti&&di(Li,Ti)}}else if(n.type==="Polygon")for(const Oi of sa(n.geometry,0)){const Li=NE(Oi,16);di(sc(Oi[0],Et,!0),new _u(Li.x,Li.y,0))}else if(n.type==="LineString")for(const Oi of n.geometry){const Li=sc(Oi,Et);di(Li,new _u(Li[0].x,Li[0].y,0))}else if(n.type==="Point")for(const Oi of n.geometry)for(const Li of Oi)di([Li],new _u(Li.x,Li.y,0))}function C0(u,n,a,p,y,T,E,M,A,O,B,q,ee,re,se){const ce=function(Xe,ze,ie,xe,Ge,mt,Lt,xt){const wt=xe.layout.get("text-rotate").evaluate(mt,{})*Math.PI/180,Gt=[];for(const At of ze.positionedLines)for(const $t of At.positionedGlyphs){if(!$t.rect)continue;const Et=$t.rect||{};let di=4,Oi=!0,Li=1,Ti=0;const dr=(Ge||xt)&&$t.vertical,gn=$t.metrics.advance*$t.scale/2;if(xt&&ze.verticalizable&&(Ti=At.lineOffset/2-($t.imageName?-(Qn-$t.metrics.width*$t.scale)/2:($t.scale-1)*Qn)),$t.imageName){const is=Lt[$t.imageName];Oi=is.sdf,Li=is.pixelRatio,di=1/Li}const qn=Ge?[$t.x+gn,$t.y]:[0,0];let Is=Ge?[0,0]:[$t.x+gn+ie[0],$t.y+ie[1]-Ti],Bo=[0,0];dr&&(Bo=Is,Is=[0,0]);const oo=$t.metrics.isDoubleResolution?2:1,fs=($t.metrics.left-di)*$t.scale-gn+Is[0],ln=(-$t.metrics.top-di)*$t.scale+Is[1],es=fs+Et.w/oo*$t.scale/Li,ms=ln+Et.h/oo*$t.scale/Li,gs=new H(fs,ln),Ys=new H(es,ln),$o=new H(fs,ms),ts=new H(es,ms);if(dr){const is=new H(-gn,gn- -17),rs=-Math.PI/2,Bn=12-gn,Hr=new H(22-Bn,-($t.imageName?Bn:0)),Ea=new H(...Bo);gs._rotateAround(rs,is)._add(Hr)._add(Ea),Ys._rotateAround(rs,is)._add(Hr)._add(Ea),$o._rotateAround(rs,is)._add(Hr)._add(Ea),ts._rotateAround(rs,is)._add(Hr)._add(Ea)}if(wt){const is=Math.sin(wt),rs=Math.cos(wt),Bn=[rs,-is,is,rs];gs._matMult(Bn),Ys._matMult(Bn),$o._matMult(Bn),ts._matMult(Bn)}const ao=new H(0,0),Zn=new H(0,0);Gt.push({tl:gs,tr:Ys,bl:$o,br:ts,tex:Et,writingMode:ze.writingMode,glyphOffset:qn,sectionIndex:$t.sectionIndex,isSDF:Oi,pixelOffsetTL:ao,pixelOffsetBR:Zn,minFontScaleX:0,minFontScaleY:0})}return Gt}(0,a,M,y,T,E,p,u.allowVerticalPlacement),be=u.textSizeData;let Me=null;be.kind==="source"?(Me=[Tl*y.layout.get("text-size").evaluate(E,{})],Me[0]>gu&&jr(`${u.layerIds[0]}: Value for "text-size" is >= 255. Reduce your "text-size".`)):be.kind==="composite"&&(Me=[Tl*re.compositeTextSizes[0].evaluate(E,{},se),Tl*re.compositeTextSizes[1].evaluate(E,{},se)],(Me[0]>gu||Me[1]>gu)&&jr(`${u.layerIds[0]}: Value for "text-size" is >= 255. Reduce your "text-size".`)),u.addSymbols(u.text,ce,Me,M,T,E,O,n,A.lineStartIndex,A.lineLength,ee,se);for(const Xe of B)q[Xe]=u.text.placedSymbolArray.length-1;return 4*ce.length}function A0(u){for(const n in u)return u[n];return null}function FE(u,n,a,p){const y=u.compareText;if(n in y){const T=y[n];for(let E=T.length-1;E>=0;E--)if(p.dist(T[E])<a)return!0}else y[n]=[];return y[n].push(p),!1}const L0=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array];class $g{static from(n){if(!(n instanceof ArrayBuffer))throw new Error("Data must be an instance of ArrayBuffer.");const[a,p]=new Uint8Array(n,0,2);if(a!==219)throw new Error("Data does not appear to be in a KDBush format.");const y=p>>4;if(y!==1)throw new Error(`Got v${y} data when expected v1.`);const T=L0[15&p];if(!T)throw new Error("Unrecognized array type.");const[E]=new Uint16Array(n,2,1),[M]=new Uint32Array(n,4,1);return new $g(M,E,T,n)}constructor(n,a=64,p=Float64Array,y){if(isNaN(n)||n<0)throw new Error(`Unpexpected numItems value: ${n}.`);this.numItems=+n,this.nodeSize=Math.min(Math.max(+a,2),65535),this.ArrayType=p,this.IndexArrayType=n<65536?Uint16Array:Uint32Array;const T=L0.indexOf(this.ArrayType),E=2*n*this.ArrayType.BYTES_PER_ELEMENT,M=n*this.IndexArrayType.BYTES_PER_ELEMENT,A=(8-M%8)%8;if(T<0)throw new Error(`Unexpected typed array class: ${p}.`);y&&y instanceof ArrayBuffer?(this.data=y,this.ids=new this.IndexArrayType(this.data,8,n),this.coords=new this.ArrayType(this.data,8+M+A,2*n),this._pos=2*n,this._finished=!0):(this.data=new ArrayBuffer(8+E+M+A),this.ids=new this.IndexArrayType(this.data,8,n),this.coords=new this.ArrayType(this.data,8+M+A,2*n),this._pos=0,this._finished=!1,new Uint8Array(this.data,0,2).set([219,16+T]),new Uint16Array(this.data,2,1)[0]=a,new Uint32Array(this.data,4,1)[0]=n)}add(n,a){const p=this._pos>>1;return this.ids[p]=p,this.coords[this._pos++]=n,this.coords[this._pos++]=a,p}finish(){const n=this._pos>>1;if(n!==this.numItems)throw new Error(`Added ${n} items when expected ${this.numItems}.`);return jg(this.ids,this.coords,this.nodeSize,0,this.numItems-1,0),this._finished=!0,this}range(n,a,p,y){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:T,coords:E,nodeSize:M}=this,A=[0,T.length-1,0],O=[];for(;A.length;){const B=A.pop()||0,q=A.pop()||0,ee=A.pop()||0;if(q-ee<=M){for(let be=ee;be<=q;be++){const Me=E[2*be],Xe=E[2*be+1];Me>=n&&Me<=p&&Xe>=a&&Xe<=y&&O.push(T[be])}continue}const re=ee+q>>1,se=E[2*re],ce=E[2*re+1];se>=n&&se<=p&&ce>=a&&ce<=y&&O.push(T[re]),(B===0?n<=se:a<=ce)&&(A.push(ee),A.push(re-1),A.push(1-B)),(B===0?p>=se:y>=ce)&&(A.push(re+1),A.push(q),A.push(1-B))}return O}within(n,a,p){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:y,coords:T,nodeSize:E}=this,M=[0,y.length-1,0],A=[],O=p*p;for(;M.length;){const B=M.pop()||0,q=M.pop()||0,ee=M.pop()||0;if(q-ee<=E){for(let be=ee;be<=q;be++)N0(T[2*be],T[2*be+1],n,a)<=O&&A.push(y[be]);continue}const re=ee+q>>1,se=T[2*re],ce=T[2*re+1];N0(se,ce,n,a)<=O&&A.push(y[re]),(B===0?n-p<=se:a-p<=ce)&&(M.push(ee),M.push(re-1),M.push(1-B)),(B===0?n+p>=se:a+p>=ce)&&(M.push(re+1),M.push(q),M.push(1-B))}return A}}function jg(u,n,a,p,y,T){if(y-p<=a)return;const E=p+y>>1;R0(u,n,E,p,y,T),jg(u,n,a,p,E-1,1-T),jg(u,n,a,E+1,y,1-T)}function R0(u,n,a,p,y,T){for(;y>p;){if(y-p>600){const O=y-p+1,B=a-p+1,q=Math.log(O),ee=.5*Math.exp(2*q/3),re=.5*Math.sqrt(q*ee*(O-ee)/O)*(B-O/2<0?-1:1);R0(u,n,a,Math.max(p,Math.floor(a-B*ee/O+re)),Math.min(y,Math.floor(a+(O-B)*ee/O+re)),T)}const E=n[2*a+T];let M=p,A=y;for(pd(u,n,p,a),n[2*y+T]>E&&pd(u,n,p,y);M<A;){for(pd(u,n,M,A),M++,A--;n[2*M+T]<E;)M++;for(;n[2*A+T]>E;)A--}n[2*p+T]===E?pd(u,n,p,A):(A++,pd(u,n,A,y)),A<=a&&(p=A+1),a<=A&&(y=A-1)}}function pd(u,n,a,p){Gg(u,a,p),Gg(n,2*a,2*p),Gg(n,2*a+1,2*p+1)}function Gg(u,n,a){const p=u[n];u[n]=u[a],u[a]=p}function N0(u,n,a,p){const y=u-a,T=n-p;return y*y+T*T}var Ug;m.cw=void 0,(Ug=m.cw||(m.cw={})).create="create",Ug.load="load",Ug.fullLoad="fullLoad";let ef=null,fd=[];const Vg=1e3/60,qg="loadTime",Zg="fullLoadTime",zE={mark(u){performance.mark(u)},frame(u){const n=u;ef!=null&&fd.push(n-ef),ef=n},clearMetrics(){ef=null,fd=[],performance.clearMeasures(qg),performance.clearMeasures(Zg);for(const u in m.cw)performance.clearMarks(m.cw[u])},getPerformanceMetrics(){performance.measure(qg,m.cw.create,m.cw.load),performance.measure(Zg,m.cw.create,m.cw.fullLoad);const u=performance.getEntriesByName(qg)[0].duration,n=performance.getEntriesByName(Zg)[0].duration,a=fd.length,p=1/(fd.reduce((T,E)=>T+E,0)/a/1e3),y=fd.filter(T=>T>Vg).reduce((T,E)=>T+(E-Vg)/Vg,0);return{loadTime:u,fullLoadTime:n,fps:p,percentDroppedFrames:y/(a+y)*100,totalFrames:a}}};m.$=It,m.A=Re,m.B=function([u,n,a]){return n+=90,n*=Math.PI/180,a*=Math.PI/180,{x:u*Math.cos(n)*Math.sin(a),y:u*Math.sin(n)*Math.sin(a),z:u*Math.cos(a)}},m.C=Fr,m.D=mi,m.E=Tt,m.F=en,m.G=Rc,m.H=function(u){if(In==null){const n=u.navigator?u.navigator.userAgent:null;In=!!u.safari||!(!n||!(/\b(iPad|iPhone|iPod)\b/.test(n)||n.match("Safari")&&!n.match("Chrome")))}return In},m.I=Mg,m.J=class{constructor(u,n){this.target=u,this.mapId=n,this.resolveRejects={},this.tasks={},this.taskQueue=[],this.abortControllers={},this.messageHandlers={},this.invoker=new PE(()=>this.process()),this.subscription=gi(this.target,"message",a=>this.receive(a),!1),this.globalScope=Ot(self)?u:window}registerMessageHandler(u,n){this.messageHandlers[u]=n}sendAsync(u,n){return new Promise((a,p)=>{const y=Math.round(1e18*Math.random()).toString(36).substring(0,10),T=n?gi(n.signal,"abort",()=>{T?.unsubscribe(),delete this.resolveRejects[y];const A={id:y,type:"<cancel>",origin:location.origin,targetMapId:u.targetMapId,sourceMapId:this.mapId};this.target.postMessage(A)},kE):null;this.resolveRejects[y]={resolve:A=>{T?.unsubscribe(),a(A)},reject:A=>{T?.unsubscribe(),p(A)}};const E=[],M=Object.assign(Object.assign({},u),{id:y,sourceMapId:this.mapId,origin:location.origin,data:Wu(u.data,E)});this.target.postMessage(M,{transfer:E})})}receive(u){const n=u.data,a=n.id;if(!(n.origin!=="file://"&&location.origin!=="file://"&&n.origin!=="resource://android"&&location.origin!=="resource://android"&&n.origin!==location.origin||n.targetMapId&&this.mapId!==n.targetMapId)){if(n.type==="<cancel>"){delete this.tasks[a];const p=this.abortControllers[a];return delete this.abortControllers[a],void(p&&p.abort())}if(Ot(self)||n.mustQueue)return this.tasks[a]=n,this.taskQueue.push(a),void this.invoker.trigger();this.processTask(a,n)}}process(){if(this.taskQueue.length===0)return;const u=this.taskQueue.shift(),n=this.tasks[u];delete this.tasks[u],this.taskQueue.length>0&&this.invoker.trigger(),n&&this.processTask(u,n)}processTask(u,n){return o(this,void 0,void 0,function*(){if(n.type==="<response>"){const y=this.resolveRejects[u];return delete this.resolveRejects[u],y?void(n.error?y.reject(du(n.error)):y.resolve(du(n.data))):void 0}if(!this.messageHandlers[n.type])return void this.completeTask(u,new Error(`Could not find a registered handler for ${n.type}, map ID: ${this.mapId}, available handlers: ${Object.keys(this.messageHandlers).join(", ")}`));const a=du(n.data),p=new AbortController;this.abortControllers[u]=p;try{const y=yield this.messageHandlers[n.type](n.sourceMapId,a,p);this.completeTask(u,null,y)}catch(y){this.completeTask(u,y)}})}completeTask(u,n,a){const p=[];delete this.abortControllers[u];const y={id:u,type:"<response>",sourceMapId:this.mapId,origin:location.origin,error:n?Wu(n):null,data:Wu(a,p)};this.target.postMessage(y,{transfer:p})}remove(){this.invoker.remove(),this.subscription.unsubscribe()}},m.K=me,m.L=function(){var u=new Re(16);return Re!=Float32Array&&(u[1]=0,u[2]=0,u[3]=0,u[4]=0,u[6]=0,u[7]=0,u[8]=0,u[9]=0,u[11]=0,u[12]=0,u[13]=0,u[14]=0),u[0]=1,u[5]=1,u[10]=1,u[15]=1,u},m.M=function(u,n,a){var p,y,T,E,M,A,O,B,q,ee,re,se,ce=a[0],be=a[1],Me=a[2];return n===u?(u[12]=n[0]*ce+n[4]*be+n[8]*Me+n[12],u[13]=n[1]*ce+n[5]*be+n[9]*Me+n[13],u[14]=n[2]*ce+n[6]*be+n[10]*Me+n[14],u[15]=n[3]*ce+n[7]*be+n[11]*Me+n[15]):(y=n[1],T=n[2],E=n[3],M=n[4],A=n[5],O=n[6],B=n[7],q=n[8],ee=n[9],re=n[10],se=n[11],u[0]=p=n[0],u[1]=y,u[2]=T,u[3]=E,u[4]=M,u[5]=A,u[6]=O,u[7]=B,u[8]=q,u[9]=ee,u[10]=re,u[11]=se,u[12]=p*ce+M*be+q*Me+n[12],u[13]=y*ce+A*be+ee*Me+n[13],u[14]=T*ce+O*be+re*Me+n[14],u[15]=E*ce+B*be+se*Me+n[15]),u},m.N=function(u,n,a){var p=a[0],y=a[1],T=a[2];return u[0]=n[0]*p,u[1]=n[1]*p,u[2]=n[2]*p,u[3]=n[3]*p,u[4]=n[4]*y,u[5]=n[5]*y,u[6]=n[6]*y,u[7]=n[7]*y,u[8]=n[8]*T,u[9]=n[9]*T,u[10]=n[10]*T,u[11]=n[11]*T,u[12]=n[12],u[13]=n[13],u[14]=n[14],u[15]=n[15],u},m.O=function(u,n,a){var p=n[0],y=n[1],T=n[2],E=n[3],M=n[4],A=n[5],O=n[6],B=n[7],q=n[8],ee=n[9],re=n[10],se=n[11],ce=n[12],be=n[13],Me=n[14],Xe=n[15],ze=a[0],ie=a[1],xe=a[2],Ge=a[3];return u[0]=ze*p+ie*M+xe*q+Ge*ce,u[1]=ze*y+ie*A+xe*ee+Ge*be,u[2]=ze*T+ie*O+xe*re+Ge*Me,u[3]=ze*E+ie*B+xe*se+Ge*Xe,u[4]=(ze=a[4])*p+(ie=a[5])*M+(xe=a[6])*q+(Ge=a[7])*ce,u[5]=ze*y+ie*A+xe*ee+Ge*be,u[6]=ze*T+ie*O+xe*re+Ge*Me,u[7]=ze*E+ie*B+xe*se+Ge*Xe,u[8]=(ze=a[8])*p+(ie=a[9])*M+(xe=a[10])*q+(Ge=a[11])*ce,u[9]=ze*y+ie*A+xe*ee+Ge*be,u[10]=ze*T+ie*O+xe*re+Ge*Me,u[11]=ze*E+ie*B+xe*se+Ge*Xe,u[12]=(ze=a[12])*p+(ie=a[13])*M+(xe=a[14])*q+(Ge=a[15])*ce,u[13]=ze*y+ie*A+xe*ee+Ge*be,u[14]=ze*T+ie*O+xe*re+Ge*Me,u[15]=ze*E+ie*B+xe*se+Ge*Xe,u},m.P=H,m.Q=function(u,n){const a={};for(let p=0;p<n.length;p++){const y=n[p];y in u&&(a[y]=u[y])}return a},m.R=so,m.S=yu,m.T=dg,m.U=h0,m.V=c0,m.W=K,m.X=ne,m.Y=$s,m.Z=zo,m._=o,m.a=le,m.a$=function(u,n,a){return u[0]=n[0]*a,u[1]=n[1]*a,u[2]=n[2]*a,u[3]=n[3]*a,u},m.a0=dd,m.a1=oc,m.a2=25,m.a3=Fg,m.a4=u=>{const n=window.document.createElement("video");return n.muted=!0,new Promise(a=>{n.onloadstart=()=>{a(n)};for(const p of u){const y=window.document.createElement("source");at(p)||(n.crossOrigin="Anonymous"),y.src=p,n.appendChild(y)}})},m.a5=Rt,m.a6=function(){return $e++},m.a7=Te,m.a8=Zc,m.a9=Va,m.aA=Qn,m.aB=Zt,m.aC=function(u,n,a,p,y=!1){if(!a[0]&&!a[1])return[0,0];const T=y?p==="map"?-u.bearingInRadians:0:p==="viewport"?u.bearingInRadians:0;if(T){const E=Math.sin(T),M=Math.cos(T);a=[a[0]*M-a[1]*E,a[0]*E+a[1]*M]}return[y?a[0]:Zt(n,a[0],u.zoom),y?a[1]:Zt(n,a[1],u.zoom)]},m.aE=Cg,m.aF=Bg,m.aG=kg,m.aH=$g,m.aI=mn,m.aJ=Up,m.aK=ct,m.aL=xr,m.aM=Gr,m.aN=ii,m.aO=oi,m.aP=p0,m.aQ=Pe,m.aR=he,m.aS=function(u){var n=new Re(3);return n[0]=u[0],n[1]=u[1],n[2]=u[2],n},m.aT=function(u,n,a){return u[0]=n[0]-a[0],u[1]=n[1]-a[1],u[2]=n[2]-a[2],u},m.aU=function(u,n){var a=n[0],p=n[1],y=n[2],T=a*a+p*p+y*y;return T>0&&(T=1/Math.sqrt(T)),u[0]=n[0]*T,u[1]=n[1]*T,u[2]=n[2]*T,u},m.aV=Ae,m.aW=function(u,n){return u[0]*n[0]+u[1]*n[1]+u[2]*n[2]},m.aX=function(u,n,a){return u[0]=n[0]*a[0],u[1]=n[1]*a[1],u[2]=n[2]*a[2],u[3]=n[3]*a[3],u},m.aY=Q,m.aZ=function(u,n,a){const p=n[0]*a[0]+n[1]*a[1]+n[2]*a[2];return p===0?null:(-(u[0]*a[0]+u[1]*a[1]+u[2]*a[2])-a[3])/p},m.a_=Be,m.aa=rc,m.ab=y0,m.ac=function(u){const n={};if(u.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,(a,p,y,T)=>{const E=y||T;return n[p]=!E||E.toLowerCase(),""}),n["max-age"]){const a=parseInt(n["max-age"],10);isNaN(a)?delete n["max-age"]:n["max-age"]=a}return n},m.ad=rn,m.ae=function(u){return Math.pow(2,u)},m.af=Z,m.ag=Xi,m.ah=85.051129,m.ai=d0,m.aj=function(u){return Math.log(u)/Math.LN2},m.ak=function(u){var n=u[0],a=u[1];return n*n+a*a},m.al=function(u,n){const a=[];for(const p in u)p in n||a.push(p);return a},m.am=function(u,n){let a=0,p=0;if(u.kind==="constant")p=u.layoutSize;else if(u.kind!=="source"){const{interpolationType:y,minZoom:T,maxZoom:E}=u,M=y?Xi(Qr.interpolationFactor(y,n,T,E),0,1):0;u.kind==="camera"?p=Fr.number(u.minSize,u.maxSize,M):a=M}return{uSizeT:a,uSize:p}},m.ao=function(u,{uSize:n,uSizeT:a},{lowerSize:p,upperSize:y}){return u.kind==="source"?p/Tl:u.kind==="composite"?Fr.number(p/Tl,y/Tl,a):n},m.ap=function(u,n){var a=n[0],p=n[1],y=n[2],T=n[3],E=n[4],M=n[5],A=n[6],O=n[7],B=n[8],q=n[9],ee=n[10],re=n[11],se=n[12],ce=n[13],be=n[14],Me=n[15],Xe=a*M-p*E,ze=a*A-y*E,ie=a*O-T*E,xe=p*A-y*M,Ge=p*O-T*M,mt=y*O-T*A,Lt=B*ce-q*se,xt=B*be-ee*se,wt=B*Me-re*se,Gt=q*be-ee*ce,At=q*Me-re*ce,$t=ee*Me-re*be,Et=Xe*$t-ze*At+ie*Gt+xe*wt-Ge*xt+mt*Lt;return Et?(u[0]=(M*$t-A*At+O*Gt)*(Et=1/Et),u[1]=(y*At-p*$t-T*Gt)*Et,u[2]=(ce*mt-be*Ge+Me*xe)*Et,u[3]=(ee*Ge-q*mt-re*xe)*Et,u[4]=(A*wt-E*$t-O*xt)*Et,u[5]=(a*$t-y*wt+T*xt)*Et,u[6]=(be*ie-se*mt-Me*ze)*Et,u[7]=(B*mt-ee*ie+re*ze)*Et,u[8]=(E*At-M*wt+O*Lt)*Et,u[9]=(p*wt-a*At-T*Lt)*Et,u[10]=(se*Ge-ce*ie+Me*Xe)*Et,u[11]=(q*ie-B*Ge-re*Xe)*Et,u[12]=(M*xt-E*Gt-A*Lt)*Et,u[13]=(a*Gt-p*xt+y*Lt)*Et,u[14]=(ce*ze-se*xe-be*Xe)*Et,u[15]=(B*xe-q*ze+ee*Xe)*Et,u):null},m.aq=vt,m.ar=function(u){return Math.hypot(u[0],u[1])},m.as=function(u){return u[0]=0,u[1]=0,u},m.at=function(u,n,a){return u[0]=n[0]*a,u[1]=n[1]*a,u},m.au=Ag,m.av=Ke,m.aw=function(u,n,a,p){const y=n.y-u.y,T=n.x-u.x,E=p.y-a.y,M=p.x-a.x,A=E*T-M*y;if(A===0)return null;const O=(M*(u.y-a.y)-E*(u.x-a.x))/A;return new H(u.x+O*T,u.y+O*y)},m.ax=x0,m.ay=nv,m.az=function(u){let n=1/0,a=1/0,p=-1/0,y=-1/0;for(const T of u)n=Math.min(n,T.x),a=Math.min(a,T.y),p=Math.max(p,T.x),y=Math.max(y,T.y);return[n,a,p,y]},m.b=xs,m.b$=sE,m.b0=function(u,n){return u[0]*n[0]+u[1]*n[1]+u[2]*n[2]+u[3]},m.b1=m0,m.b2=Wc,m.b3=function(u,n,a,p,y){var T,E=1/Math.tan(n/2);return u[0]=E/a,u[1]=0,u[2]=0,u[3]=0,u[4]=0,u[5]=E,u[6]=0,u[7]=0,u[8]=0,u[9]=0,u[11]=-1,u[12]=0,u[13]=0,u[15]=0,y!=null&&y!==1/0?(u[10]=(y+p)*(T=1/(p-y)),u[14]=2*y*p*T):(u[10]=-1,u[14]=-2*p),u},m.b4=function(u){var n=new Re(16);return n[0]=u[0],n[1]=u[1],n[2]=u[2],n[3]=u[3],n[4]=u[4],n[5]=u[5],n[6]=u[6],n[7]=u[7],n[8]=u[8],n[9]=u[9],n[10]=u[10],n[11]=u[11],n[12]=u[12],n[13]=u[13],n[14]=u[14],n[15]=u[15],n},m.b5=function(u,n,a){var p=Math.sin(a),y=Math.cos(a),T=n[0],E=n[1],M=n[2],A=n[3],O=n[4],B=n[5],q=n[6],ee=n[7];return n!==u&&(u[8]=n[8],u[9]=n[9],u[10]=n[10],u[11]=n[11],u[12]=n[12],u[13]=n[13],u[14]=n[14],u[15]=n[15]),u[0]=T*y+O*p,u[1]=E*y+B*p,u[2]=M*y+q*p,u[3]=A*y+ee*p,u[4]=O*y-T*p,u[5]=B*y-E*p,u[6]=q*y-M*p,u[7]=ee*y-A*p,u},m.b6=function(u,n,a){var p=Math.sin(a),y=Math.cos(a),T=n[4],E=n[5],M=n[6],A=n[7],O=n[8],B=n[9],q=n[10],ee=n[11];return n!==u&&(u[0]=n[0],u[1]=n[1],u[2]=n[2],u[3]=n[3],u[12]=n[12],u[13]=n[13],u[14]=n[14],u[15]=n[15]),u[4]=T*y+O*p,u[5]=E*y+B*p,u[6]=M*y+q*p,u[7]=A*y+ee*p,u[8]=O*y-T*p,u[9]=B*y-E*p,u[10]=q*y-M*p,u[11]=ee*y-A*p,u},m.b7=function(){const u=new Float32Array(16);return Z(u),u},m.b8=function(){const u=new Float64Array(16);return Z(u),u},m.b9=function(){return new Float64Array(16)},m.bA=function(u){return u[0]=0,u[1]=0,u[2]=0,u},m.bB=function(u,n,a,p){const y=Math.sqrt(u*u+n*n),T=Math.sqrt(a*a+p*p);u/=y,n/=y,a/=T,p/=T;const E=Math.acos(u*a+n*p);return-n*a+u*p>0?E:-E},m.bC=function(u,n){const a=zt(u,2*Math.PI),p=zt(n,2*Math.PI);return Math.min(Math.abs(a-p),Math.abs(a-p+2*Math.PI),Math.abs(a-p-2*Math.PI))},m.bD=function(){const u={},n=Ve.$version;for(const a in Ve.$root){const p=Ve.$root[a];if(p.required){let y=null;y=a==="version"?n:p.type==="array"?[]:{},y!=null&&(u[a]=y)}}return u},m.bE=Bh,m.bF=Ze,m.bG=function u(n,a){if(Array.isArray(n)){if(!Array.isArray(a)||n.length!==a.length)return!1;for(let p=0;p<n.length;p++)if(!u(n[p],a[p]))return!1;return!0}if(typeof n=="object"&&n!==null&&a!==null){if(typeof a!="object"||Object.keys(n).length!==Object.keys(a).length)return!1;for(const p in n)if(!u(n[p],a[p]))return!1;return!0}return n===a},m.bH=function(u){u=u.slice();const n=Object.create(null);for(let a=0;a<u.length;a++)n[u[a].id]=u[a];for(let a=0;a<u.length;a++)"ref"in u[a]&&(u[a]=bt(u[a],n[u[a].ref]));return u},m.bI=function(u){if(u.type==="custom")return new ME(u);switch(u.type){case"background":return new EE(u);case"circle":return new _2(u);case"color-relief":return new E2(u);case"fill":return new B2(u);case"fill-extrusion":return new W2(u);case"heatmap":return new x2(u);case"hillshade":return new w2(u);case"line":return new tE(u);case"raster":return new SE(u);case"symbol":return new Xp(u)}},m.bJ=Gi,m.bK=function(u,n){if(!u)return[{command:"setStyle",args:[n]}];let a=[];try{if(!Ht(u.version,n.version))return[{command:"setStyle",args:[n]}];Ht(u.center,n.center)||a.push({command:"setCenter",args:[n.center]}),Ht(u.state,n.state)||a.push({command:"setGlobalState",args:[n.state]}),Ht(u.centerAltitude,n.centerAltitude)||a.push({command:"setCenterAltitude",args:[n.centerAltitude]}),Ht(u.zoom,n.zoom)||a.push({command:"setZoom",args:[n.zoom]}),Ht(u.bearing,n.bearing)||a.push({command:"setBearing",args:[n.bearing]}),Ht(u.pitch,n.pitch)||a.push({command:"setPitch",args:[n.pitch]}),Ht(u.roll,n.roll)||a.push({command:"setRoll",args:[n.roll]}),Ht(u.sprite,n.sprite)||a.push({command:"setSprite",args:[n.sprite]}),Ht(u.glyphs,n.glyphs)||a.push({command:"setGlyphs",args:[n.glyphs]}),Ht(u.transition,n.transition)||a.push({command:"setTransition",args:[n.transition]}),Ht(u.light,n.light)||a.push({command:"setLight",args:[n.light]}),Ht(u.terrain,n.terrain)||a.push({command:"setTerrain",args:[n.terrain]}),Ht(u.sky,n.sky)||a.push({command:"setSky",args:[n.sky]}),Ht(u.projection,n.projection)||a.push({command:"setProjection",args:[n.projection]});const p={},y=[];(function(E,M,A,O){let B;for(B in M=M||{},E=E||{})Object.prototype.hasOwnProperty.call(E,B)&&(Object.prototype.hasOwnProperty.call(M,B)||br(B,A,O));for(B in M)Object.prototype.hasOwnProperty.call(M,B)&&(Object.prototype.hasOwnProperty.call(E,B)?Ht(E[B],M[B])||(E[B].type==="geojson"&&M[B].type==="geojson"&&Ui(E,M,B)?li(A,{command:"setGeoJSONSourceData",args:[B,M[B].data]}):ur(B,M,A,O)):Ci(B,M,A))})(u.sources,n.sources,y,p);const T=[];u.layers&&u.layers.forEach(E=>{"source"in E&&p[E.source]?a.push({command:"removeLayer",args:[E.id]}):T.push(E)}),a=a.concat(y),function(E,M,A){M=M||[];const O=(E=E||[]).map(Hi),B=M.map(Hi),q=E.reduce(Lr,{}),ee=M.reduce(Lr,{}),re=O.slice(),se=Object.create(null);let ce,be,Me,Xe,ze;for(let ie=0,xe=0;ie<O.length;ie++)ce=O[ie],Object.prototype.hasOwnProperty.call(ee,ce)?xe++:(li(A,{command:"removeLayer",args:[ce]}),re.splice(re.indexOf(ce,xe),1));for(let ie=0,xe=0;ie<B.length;ie++)ce=B[B.length-1-ie],re[re.length-1-ie]!==ce&&(Object.prototype.hasOwnProperty.call(q,ce)?(li(A,{command:"removeLayer",args:[ce]}),re.splice(re.lastIndexOf(ce,re.length-xe),1)):xe++,Xe=re[re.length-ie],li(A,{command:"addLayer",args:[ee[ce],Xe]}),re.splice(re.length-ie,0,ce),se[ce]=!0);for(let ie=0;ie<B.length;ie++)if(ce=B[ie],be=q[ce],Me=ee[ce],!se[ce]&&!Ht(be,Me))if(Ht(be.source,Me.source)&&Ht(be["source-layer"],Me["source-layer"])&&Ht(be.type,Me.type)){for(ze in Mi(be.layout,Me.layout,A,ce,null,"setLayoutProperty"),Mi(be.paint,Me.paint,A,ce,null,"setPaintProperty"),Ht(be.filter,Me.filter)||li(A,{command:"setFilter",args:[ce,Me.filter]}),Ht(be.minzoom,Me.minzoom)&&Ht(be.maxzoom,Me.maxzoom)||li(A,{command:"setLayerZoomRange",args:[ce,Me.minzoom,Me.maxzoom]}),be)Object.prototype.hasOwnProperty.call(be,ze)&&ze!=="layout"&&ze!=="paint"&&ze!=="filter"&&ze!=="metadata"&&ze!=="minzoom"&&ze!=="maxzoom"&&(ze.indexOf("paint.")===0?Mi(be[ze],Me[ze],A,ce,ze.slice(6),"setPaintProperty"):Ht(be[ze],Me[ze])||li(A,{command:"setLayerProperty",args:[ce,ze,Me[ze]]}));for(ze in Me)Object.prototype.hasOwnProperty.call(Me,ze)&&!Object.prototype.hasOwnProperty.call(be,ze)&&ze!=="layout"&&ze!=="paint"&&ze!=="filter"&&ze!=="metadata"&&ze!=="minzoom"&&ze!=="maxzoom"&&(ze.indexOf("paint.")===0?Mi(be[ze],Me[ze],A,ce,ze.slice(6),"setPaintProperty"):Ht(be[ze],Me[ze])||li(A,{command:"setLayerProperty",args:[ce,ze,Me[ze]]}))}else li(A,{command:"removeLayer",args:[ce]}),Xe=re[re.lastIndexOf(ce)+1],li(A,{command:"addLayer",args:[Me,Xe]})}(T,n.layers,a)}catch(p){console.warn("Unable to compute style diff:",p),a=[{command:"setStyle",args:[n]}]}return a},m.bL=function(u){const n=[],a=u.id;return a===void 0&&n.push({message:`layers.${a}: missing required property "id"`}),u.render===void 0&&n.push({message:`layers.${a}: missing required method "render"`}),u.renderingMode&&u.renderingMode!=="2d"&&u.renderingMode!=="3d"&&n.push({message:`layers.${a}: property "renderingMode" must be either "2d" or "3d"`}),n},m.bM=zi,m.bN=Qi,m.bO=class extends Xr{constructor(u,n){super(u,n),this.current=0}set(u){this.current!==u&&(this.current=u,this.gl.uniform1i(this.location,u))}},m.bP=zp,m.bQ=class extends Xr{constructor(u,n){super(u,n),this.current=sg}set(u){if(u[12]!==this.current[12]||u[0]!==this.current[0])return this.current=u,void this.gl.uniformMatrix4fv(this.location,!1,u);for(let n=1;n<16;n++)if(u[n]!==this.current[n]){this.current=u,this.gl.uniformMatrix4fv(this.location,!1,u);break}}},m.bR=Vn,m.bS=class extends Xr{constructor(u,n){super(u,n),this.current=[0,0,0]}set(u){u[0]===this.current[0]&&u[1]===this.current[1]&&u[2]===this.current[2]||(this.current=u,this.gl.uniform3f(this.location,u[0],u[1],u[2]))}},m.bT=class extends Xr{constructor(u,n){super(u,n),this.current=[0,0]}set(u){u[0]===this.current[0]&&u[1]===this.current[1]||(this.current=u,this.gl.uniform2f(this.location,u[0],u[1]))}},m.bU=Se,m.bV=function(u,n){var a=Math.sin(n),p=Math.cos(n);return u[0]=p,u[1]=a,u[2]=0,u[3]=-a,u[4]=p,u[5]=0,u[6]=0,u[7]=0,u[8]=1,u},m.bW=function(u,n,a){var p=n[0],y=n[1],T=n[2];return u[0]=p*a[0]+y*a[3]+T*a[6],u[1]=p*a[1]+y*a[4]+T*a[7],u[2]=p*a[2]+y*a[5]+T*a[8],u},m.bX=function(u,n,a,p,y,T,E){var M=1/(n-a),A=1/(p-y),O=1/(T-E);return u[0]=-2*M,u[1]=0,u[2]=0,u[3]=0,u[4]=0,u[5]=-2*A,u[6]=0,u[7]=0,u[8]=0,u[9]=0,u[10]=2*O,u[11]=0,u[12]=(n+a)*M,u[13]=(y+p)*A,u[14]=(E+T)*O,u[15]=1,u},m.bY=class extends Xr{constructor(u,n){super(u,n),this.current=new Array}set(u){if(u!=this.current){this.current=u;const n=new Float32Array(4*u.length);for(let a=0;a<u.length;a++)n[4*a]=u[a].r,n[4*a+1]=u[a].g,n[4*a+2]=u[a].b,n[4*a+3]=u[a].a;this.gl.uniform4fv(this.location,n)}}},m.bZ=class extends Xr{constructor(u,n){super(u,n),this.current=new Array}set(u){if(u!=this.current){this.current=u;const n=new Float32Array(u);this.gl.uniform1fv(this.location,n)}}},m.b_=class extends f{},m.ba=function(u,n,a){const p=new Float64Array(4);return pt(p,u,n-90,a),p},m.bb=function(u,n,a,p){var y,T,E,M,A,O=n[0],B=n[1],q=n[2],ee=n[3],re=a[0],se=a[1],ce=a[2],be=a[3];return(T=O*re+B*se+q*ce+ee*be)<0&&(T=-T,re=-re,se=-se,ce=-ce,be=-be),1-T>ye?(y=Math.acos(T),E=Math.sin(y),M=Math.sin((1-p)*y)/E,A=Math.sin(p*y)/E):(M=1-p,A=p),u[0]=M*O+A*re,u[1]=M*B+A*se,u[2]=M*q+A*ce,u[3]=M*ee+A*be,u},m.bc=function(u){const n=new Float64Array(9);var a,p,y,T,E,M,A,O,B,q,ee,re,se,ce,be,Me,Xe,ze;q=(y=(p=u)[0])*(A=y+y),ee=(T=p[1])*A,se=(E=p[2])*A,ce=E*(O=T+T),Me=(M=p[3])*A,Xe=M*O,ze=M*(B=E+E),(a=n)[0]=1-(re=T*O)-(be=E*B),a[3]=ee-ze,a[6]=se+Xe,a[1]=ee+ze,a[4]=1-q-be,a[7]=ce-Me,a[2]=se-Xe,a[5]=ce+Me,a[8]=1-q-re;const ie=oi(-Math.asin(Xi(n[2],-1,1)));let xe,Ge;return Math.hypot(n[5],n[8])<.001?(xe=0,Ge=-oi(Math.atan2(n[3],n[4]))):(xe=oi(n[5]===0&&n[8]===0?0:Math.atan2(n[5],n[8])),Ge=oi(n[1]===0&&n[0]===0?0:Math.atan2(n[1],n[0]))),{roll:xe,pitch:ie+90,bearing:Ge}},m.bd=function(u,n){return u.roll==n.roll&&u.pitch==n.pitch&&u.bearing==n.bearing},m.be=si,m.bf=zs,m.bg=Vc,m.bh=sd,m.bi=Uc,m.bj=ti,m.bk=ai,m.bl=Vi,m.bm=function(u,n,a,p,y){return ti(p,y,Xi((u-n)/(a-n),0,1))},m.bn=zt,m.bo=function(){return new Float64Array(3)},m.bp=function(u,n,a,p){return u[0]=n[0]+a[0]*p,u[1]=n[1]+a[1]*p,u[2]=n[2]+a[2]*p,u},m.bq=pt,m.br=function(u,n,a){var p=a[0],y=a[1],T=a[2],E=n[0],M=n[1],A=n[2],O=y*A-T*M,B=T*E-p*A,q=p*M-y*E,ee=y*q-T*B,re=T*O-p*q,se=p*B-y*O,ce=2*a[3];return B*=ce,q*=ce,re*=2,se*=2,u[0]=E+(O*=ce)+(ee*=2),u[1]=M+B+re,u[2]=A+q+se,u},m.bs=function(u,n,a){const p=(y=[u[0],u[1],u[2],n[0],n[1],n[2],a[0],a[1],a[2]])[0]*((B=y[8])*(E=y[4])-(M=y[5])*(O=y[7]))+y[1]*(-B*(T=y[3])+M*(A=y[6]))+y[2]*(O*T-E*A);var y,T,E,M,A,O,B;if(p===0)return null;const q=Ae([],[n[0],n[1],n[2]],[a[0],a[1],a[2]]),ee=Ae([],[a[0],a[1],a[2]],[u[0],u[1],u[2]]),re=Ae([],[u[0],u[1],u[2]],[n[0],n[1],n[2]]),se=Pe([],q,-u[3]);return he(se,se,Pe([],ee,-n[3])),he(se,se,Pe([],re,-a[3])),Pe(se,se,1/p),se},m.bt=Og,m.bu=function(){return new Float64Array(4)},m.bv=function(u,n,a,p){var y=[],T=[];return y[0]=n[0]-a[0],y[1]=n[1]-a[1],y[2]=n[2]-a[2],T[0]=y[0]*Math.cos(p)-y[1]*Math.sin(p),T[1]=y[0]*Math.sin(p)+y[1]*Math.cos(p),T[2]=y[2],u[0]=T[0]+a[0],u[1]=T[1]+a[1],u[2]=T[2]+a[2],u},m.bw=function(u,n,a,p){var y=[],T=[];return y[0]=n[0]-a[0],y[1]=n[1]-a[1],y[2]=n[2]-a[2],T[0]=y[0],T[1]=y[1]*Math.cos(p)-y[2]*Math.sin(p),T[2]=y[1]*Math.sin(p)+y[2]*Math.cos(p),u[0]=T[0]+a[0],u[1]=T[1]+a[1],u[2]=T[2]+a[2],u},m.bx=function(u,n,a,p){var y=[],T=[];return y[0]=n[0]-a[0],y[1]=n[1]-a[1],y[2]=n[2]-a[2],T[0]=y[2]*Math.sin(p)+y[0]*Math.cos(p),T[1]=y[1],T[2]=y[2]*Math.cos(p)-y[0]*Math.sin(p),u[0]=T[0]+a[0],u[1]=T[1]+a[1],u[2]=T[2]+a[2],u},m.by=function(u,n,a){var p=Math.sin(a),y=Math.cos(a),T=n[0],E=n[1],M=n[2],A=n[3],O=n[8],B=n[9],q=n[10],ee=n[11];return n!==u&&(u[4]=n[4],u[5]=n[5],u[6]=n[6],u[7]=n[7],u[12]=n[12],u[13]=n[13],u[14]=n[14],u[15]=n[15]),u[0]=T*y-O*p,u[1]=E*y-B*p,u[2]=M*y-q*p,u[3]=A*y-ee*p,u[8]=T*p+O*y,u[9]=E*p+B*y,u[10]=M*p+q*y,u[11]=A*p+ee*y,u},m.bz=function(u,n){const a=zt(u,360),p=zt(n,360),y=p-a,T=p>a?y-360:y+360;return Math.abs(y)<Math.abs(T)?y:T},m.c=et,m.c0=class extends w{},m.c1=hg,m.c2=function(u){return u<=1?1:Math.pow(2,Math.ceil(Math.log(u)/Math.LN2))},m.c3=fv,m.c4=function(u,n,a){var p=n[0],y=n[1],T=n[2],E=a[3]*p+a[7]*y+a[11]*T+a[15];return u[0]=(a[0]*p+a[4]*y+a[8]*T+a[12])/(E=E||1),u[1]=(a[1]*p+a[5]*y+a[9]*T+a[13])/E,u[2]=(a[2]*p+a[6]*y+a[10]*T+a[14])/E,u},m.c5=class extends Zh{},m.c6=class extends W{},m.c7=function(u,n){return u[0]===n[0]&&u[1]===n[1]&&u[2]===n[2]&&u[3]===n[3]&&u[4]===n[4]&&u[5]===n[5]&&u[6]===n[6]&&u[7]===n[7]&&u[8]===n[8]&&u[9]===n[9]&&u[10]===n[10]&&u[11]===n[11]&&u[12]===n[12]&&u[13]===n[13]&&u[14]===n[14]&&u[15]===n[15]},m.c8=function(u,n){var a=u[0],p=u[1],y=u[2],T=u[3],E=u[4],M=u[5],A=u[6],O=u[7],B=u[8],q=u[9],ee=u[10],re=u[11],se=u[12],ce=u[13],be=u[14],Me=u[15],Xe=n[0],ze=n[1],ie=n[2],xe=n[3],Ge=n[4],mt=n[5],Lt=n[6],xt=n[7],wt=n[8],Gt=n[9],At=n[10],$t=n[11],Et=n[12],di=n[13],Oi=n[14],Li=n[15];return Math.abs(a-Xe)<=ye*Math.max(1,Math.abs(a),Math.abs(Xe))&&Math.abs(p-ze)<=ye*Math.max(1,Math.abs(p),Math.abs(ze))&&Math.abs(y-ie)<=ye*Math.max(1,Math.abs(y),Math.abs(ie))&&Math.abs(T-xe)<=ye*Math.max(1,Math.abs(T),Math.abs(xe))&&Math.abs(E-Ge)<=ye*Math.max(1,Math.abs(E),Math.abs(Ge))&&Math.abs(M-mt)<=ye*Math.max(1,Math.abs(M),Math.abs(mt))&&Math.abs(A-Lt)<=ye*Math.max(1,Math.abs(A),Math.abs(Lt))&&Math.abs(O-xt)<=ye*Math.max(1,Math.abs(O),Math.abs(xt))&&Math.abs(B-wt)<=ye*Math.max(1,Math.abs(B),Math.abs(wt))&&Math.abs(q-Gt)<=ye*Math.max(1,Math.abs(q),Math.abs(Gt))&&Math.abs(ee-At)<=ye*Math.max(1,Math.abs(ee),Math.abs(At))&&Math.abs(re-$t)<=ye*Math.max(1,Math.abs(re),Math.abs($t))&&Math.abs(se-Et)<=ye*Math.max(1,Math.abs(se),Math.abs(Et))&&Math.abs(ce-di)<=ye*Math.max(1,Math.abs(ce),Math.abs(di))&&Math.abs(be-Oi)<=ye*Math.max(1,Math.abs(be),Math.abs(Oi))&&Math.abs(Me-Li)<=ye*Math.max(1,Math.abs(Me),Math.abs(Li))},m.c9=function(u,n){return u[0]=n[0],u[1]=n[1],u[2]=n[2],u[3]=n[3],u[4]=n[4],u[5]=n[5],u[6]=n[6],u[7]=n[7],u[8]=n[8],u[9]=n[9],u[10]=n[10],u[11]=n[11],u[12]=n[12],u[13]=n[13],u[14]=n[14],u[15]=n[15],u},m.cA=function(u){delete le.REGISTERED_PROTOCOLS[u]},m.cB=function(u,n){const a={};for(let y=0;y<u.length;y++){const T=n&&n[u[y].id]||Pc(u[y]);n&&(n[u[y].id]=T);let E=a[T];E||(E=a[T]=[]),E.push(u[y])}const p=[];for(const y in a)p.push(a[y]);return p},m.cC=ni,m.cD=g0,m.cE=_0,m.cF=Yv,m.cG=function(u){u.bucket.createArrays(),u.bucket.tilePixelRatio=It/(512*u.bucket.overscaling),u.bucket.compareText={},u.bucket.iconsNeedLinear=!1;const n=u.bucket.layers[0],a=n.layout,p=n._unevaluatedLayout._values,y={layoutIconSize:p["icon-size"].possiblyEvaluate(new en(u.bucket.zoom+1),u.canonical),layoutTextSize:p["text-size"].possiblyEvaluate(new en(u.bucket.zoom+1),u.canonical),textMaxSize:p["text-size"].possiblyEvaluate(new en(18))};if(u.bucket.textSizeData.kind==="composite"){const{minZoom:O,maxZoom:B}=u.bucket.textSizeData;y.compositeTextSizes=[p["text-size"].possiblyEvaluate(new en(O),u.canonical),p["text-size"].possiblyEvaluate(new en(B),u.canonical)]}if(u.bucket.iconSizeData.kind==="composite"){const{minZoom:O,maxZoom:B}=u.bucket.iconSizeData;y.compositeIconSizes=[p["icon-size"].possiblyEvaluate(new en(O),u.canonical),p["icon-size"].possiblyEvaluate(new en(B),u.canonical)]}const T=a.get("text-line-height")*Qn,E=a.get("text-rotation-alignment")!=="viewport"&&a.get("symbol-placement")!=="point",M=a.get("text-keep-upright"),A=a.get("text-size");for(const O of u.bucket.features){const B=a.get("text-font").evaluate(O,{},u.canonical).join(","),q=A.evaluate(O,{},u.canonical),ee=y.layoutTextSize.evaluate(O,{},u.canonical),re=y.layoutIconSize.evaluate(O,{},u.canonical),se={horizontal:{},vertical:void 0},ce=O.text;let be,Me=[0,0];if(ce){const ie=ce.toString(),xe=a.get("text-letter-spacing").evaluate(O,{},u.canonical)*Qn,Ge=Ap(ie)?xe:0,mt=a.get("text-anchor").evaluate(O,{},u.canonical),Lt=k0(n,O,u.canonical);if(!Lt){const At=a.get("text-radial-offset").evaluate(O,{},u.canonical);Me=At?P0(mt,[At*Qn,zg]):a.get("text-offset").evaluate(O,{},u.canonical).map($t=>$t*Qn)}let xt=E?"center":a.get("text-justify").evaluate(O,{},u.canonical);const wt=a.get("symbol-placement")==="point"?a.get("text-max-width").evaluate(O,{},u.canonical)*Qn:1/0,Gt=()=>{u.bucket.allowVerticalPlacement&&$h(ie)&&(se.vertical=Zp(ce,u.glyphMap,u.glyphPositions,u.imagePositions,B,wt,T,mt,"left",Ge,Me,m.an.vertical,!0,ee,q))};if(!E&&Lt){const At=new Set;if(xt==="auto")for(let Et=0;Et<Lt.values.length;Et+=2)At.add(Bg(Lt.values[Et]));else At.add(xt);let $t=!1;for(const Et of At)if(!se.horizontal[Et])if($t)se.horizontal[Et]=se.horizontal[0];else{const di=Zp(ce,u.glyphMap,u.glyphPositions,u.imagePositions,B,wt,T,"center",Et,Ge,Me,m.an.horizontal,!1,ee,q);di&&(se.horizontal[Et]=di,$t=di.positionedLines.length===1)}Gt()}else{xt==="auto"&&(xt=Bg(mt));const At=Zp(ce,u.glyphMap,u.glyphPositions,u.imagePositions,B,wt,T,mt,xt,Ge,Me,m.an.horizontal,!1,ee,q);At&&(se.horizontal[xt]=At),Gt(),$h(ie)&&E&&M&&(se.vertical=Zp(ce,u.glyphMap,u.glyphPositions,u.imagePositions,B,wt,T,mt,xt,Ge,Me,m.an.vertical,!1,ee,q))}}let Xe=!1;if(O.icon&&O.icon.name){const ie=u.imageMap[O.icon.name];ie&&(be=vE(u.imagePositions[O.icon.name],a.get("icon-offset").evaluate(O,{},u.canonical),a.get("icon-anchor").evaluate(O,{},u.canonical)),Xe=!!ie.sdf,u.bucket.sdfIcons===void 0?u.bucket.sdfIcons=Xe:u.bucket.sdfIcons!==Xe&&jr("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(ie.pixelRatio!==u.bucket.pixelRatio||a.get("icon-rotate").constantOr(1)!==0)&&(u.bucket.iconsNeedLinear=!0))}const ze=A0(se.horizontal)||se.vertical;u.bucket.iconsInText=!!ze&&ze.iconsInText,(ze||be)&&DE(u.bucket,O,se,be,u.imageMap,y,ee,re,Me,Xe,u.canonical,u.subdivisionGranularity)}u.showCollisionBoxes&&u.bucket.generateCollisionDebugBuffers()},m.cH=Tg,m.cI=yg,m.cJ=wg,m.cK=ad,m.cL=Sg,m.cM=class{constructor(u){this._marks={start:[u.url,"start"].join("#"),end:[u.url,"end"].join("#"),measure:u.url.toString()},performance.mark(this._marks.start)}finish(){performance.mark(this._marks.end);let u=performance.getEntriesByName(this._marks.measure);return u.length===0&&(performance.measure(this._marks.measure,this._marks.start,this._marks.end),u=performance.getEntriesByName(this._marks.measure),performance.clearMarks(this._marks.start),performance.clearMarks(this._marks.end),performance.clearMeasures(this._marks.measure)),u}},m.cN=function(u,n,a,p,y){return o(this,void 0,void 0,function*(){if(ne())try{return yield $s(u,n,a,p,y)}catch{}return function(T,E,M,A,O){const B=T.width,q=T.height;Xt&&_r||(Xt=new OffscreenCanvas(B,q),_r=Xt.getContext("2d",{willReadFrequently:!0})),Xt.width=B,Xt.height=q,_r.drawImage(T,0,0,B,q);const ee=_r.getImageData(E,M,A,O);return _r.clearRect(0,0,B,q),ee.data}(u,n,a,p,y)})},m.cO=yv,m.cP=P,m.cQ=F,m.cR=Nv,m.cS=Zv,m.cT=Ec,m.cU=Za,m.ca=u=>u.type==="symbol",m.cb=u=>u.type==="circle",m.cc=u=>u.type==="heatmap",m.cd=u=>u.type==="line",m.ce=u=>u.type==="fill",m.cf=u=>u.type==="fill-extrusion",m.cg=u=>u.type==="hillshade",m.ch=u=>u.type==="color-relief",m.ci=u=>u.type==="raster",m.cj=u=>u.type==="background",m.ck=u=>u.type==="custom",m.cl=Ir,m.cm=function(u,n,a){const p=Ft(n.x-a.x,n.y-a.y),y=Ft(u.x-a.x,u.y-a.y);var T,E;return oi(Math.atan2(p[0]*y[1]-p[1]*y[0],(T=p)[0]*(E=y)[0]+T[1]*E[1]))},m.cn=lt,m.co=function(u,n){return Bi[n]&&(u instanceof MouseEvent||u instanceof WheelEvent)},m.cp=function(u,n){return er[n]&&"touches"in u},m.cq=function(u){return er[u]||Bi[u]},m.cr=function(u,n,a){var p=n[0],y=n[1];return u[0]=a[0]*p+a[4]*y+a[12],u[1]=a[1]*p+a[5]*y+a[13],u},m.cs=function(u,n){const{x:a,y:p}=dd.fromLngLat(n);return!(u<0||u>25||p<0||p>=1||a<0||a>=1)},m.ct=function(u,n){return u[0]=n[0],u[1]=0,u[2]=0,u[3]=0,u[4]=0,u[5]=n[1],u[6]=0,u[7]=0,u[8]=0,u[9]=0,u[10]=n[2],u[11]=0,u[12]=0,u[13]=0,u[14]=0,u[15]=1,u},m.cu=class extends Ya{},m.cv=zE,m.cx=function(u){return u.message===Ii},m.cy=Le,m.cz=function(u,n){le.REGISTERED_PROTOCOLS[u]=n},m.d=at,m.e=Jt,m.f=u=>o(void 0,void 0,void 0,function*(){if(u.byteLength===0)return createImageBitmap(new ImageData(1,1));const n=new Blob([new Uint8Array(u)],{type:"image/png"});try{return createImageBitmap(n)}catch(a){throw new Error(`Could not load image because of ${a.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`)}}),m.g=pe,m.h=u=>new Promise((n,a)=>{const p=new Image;p.onload=()=>{n(p),URL.revokeObjectURL(p.src),p.onload=null,window.requestAnimationFrame(()=>{p.src=os})},p.onerror=()=>a(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));const y=new Blob([new Uint8Array(u)],{type:"image/png"});p.src=u.byteLength?URL.createObjectURL(y):os}),m.i=Ot,m.j=(u,n)=>Je(Jt(u,{type:"json"}),n),m.k=nt,m.l=ft,m.m=Je,m.n=(u,n)=>Je(Jt(u,{type:"arrayBuffer"}),n),m.o=function(u){return new Sg(u).readFields(lE,[])},m.p=Wv,m.q=ed,m.r=Fs,m.s=gi,m.t=Vh,m.u=ar,m.v=Ve,m.w=jr,m.x=Qm,m.y=qu,m.z=cu}),h("worker",["./shared"],function(m){class o{constructor(le){this.keyCache={},le&&this.replace(le)}replace(le){this._layerConfigs={},this._layers={},this.update(le,[])}update(le,pe){for(const Le of le){this._layerConfigs[Le.id]=Le;const Ze=this._layers[Le.id]=m.bI(Le);Ze._featureFilter=m.a9(Ze.filter),this.keyCache[Le.id]&&delete this.keyCache[Le.id]}for(const Le of pe)delete this.keyCache[Le],delete this._layerConfigs[Le],delete this._layers[Le];this.familiesBySource={};const me=m.cB(Object.values(this._layerConfigs),this.keyCache);for(const Le of me){const Ze=Le.map(nt=>this._layers[nt.id]),Je=Ze[0];if(Je.visibility==="none")continue;const at=Je.source||"";let He=this.familiesBySource[at];He||(He=this.familiesBySource[at]={});const gt=Je.sourceLayer||"_geojsonTileLayer";let ft=He[gt];ft||(ft=He[gt]=[]),ft.push(Ze)}}}class P{constructor(le){const pe={},me=[];for(const at in le){const He=le[at],gt=pe[at]={};for(const ft in He){const nt=He[+ft];if(!nt||nt.bitmap.width===0||nt.bitmap.height===0)continue;const Tt={x:0,y:0,w:nt.bitmap.width+2,h:nt.bitmap.height+2};me.push(Tt),gt[ft]={rect:Tt,metrics:nt.metrics}}}const{w:Le,h:Ze}=m.p(me),Je=new m.q({width:Le||1,height:Ze||1});for(const at in le){const He=le[at];for(const gt in He){const ft=He[+gt];if(!ft||ft.bitmap.width===0||ft.bitmap.height===0)continue;const nt=pe[at][gt].rect;m.q.copy(ft.bitmap,Je,{x:0,y:0},{x:nt.x+1,y:nt.y+1},ft.bitmap)}}this.image=Je,this.positions=pe}}m.cC("GlyphAtlas",P);class L{constructor(le){this.tileID=new m.Z(le.tileID.overscaledZ,le.tileID.wrap,le.tileID.canonical.z,le.tileID.canonical.x,le.tileID.canonical.y),this.uid=le.uid,this.zoom=le.zoom,this.pixelRatio=le.pixelRatio,this.tileSize=le.tileSize,this.source=le.source,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=le.showCollisionBoxes,this.collectResourceTiming=!!le.collectResourceTiming,this.returnDependencies=!!le.returnDependencies,this.promoteId=le.promoteId,this.inFlightDependencies=[],this.globalState=le.globalState}parse(le,pe,me,Le,Ze){return m._(this,void 0,void 0,function*(){this.status="parsing",this.data=le,this.collisionBoxArray=new m.a7;const Je=new m.cD(Object.keys(le.layers).sort()),at=new m.cE(this.tileID,this.promoteId);at.bucketLayerIDs=[];const He={},gt={featureIndex:at,iconDependencies:{},patternDependencies:{},glyphDependencies:{},availableImages:me,subdivisionGranularity:Ze},ft=pe.familiesBySource[this.source];for(const Mi in ft){const Hi=le.layers[Mi];if(!Hi)continue;Hi.version===1&&m.w(`Vector tile source "${this.source}" layer "${Mi}" does not use vector tile spec v2 and therefore may have some rendering errors.`);const Lr=Je.encode(Mi),Rt=[];for(let Kr=0;Kr<Hi.length;Kr++){const Sr=Hi.feature(Kr),Or=at.getId(Sr,Mi);Rt.push({feature:Sr,id:Or,index:Kr,sourceLayerIndex:Lr})}for(const Kr of ft[Mi]){const Sr=Kr[0];Sr.source!==this.source&&m.w(`layer.source = ${Sr.source} does not equal this.source = ${this.source}`),Sr.minzoom&&this.zoom<Math.floor(Sr.minzoom)||Sr.maxzoom&&this.zoom>=Sr.maxzoom||Sr.visibility!=="none"&&(D(Kr,this.zoom,me),(He[Sr.id]=Sr.createBucket({index:at.bucketLayerIDs.length,layers:Kr,zoom:this.zoom,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:Lr,sourceID:this.source,globalState:this.globalState})).populate(Rt,gt,this.tileID.canonical),at.bucketLayerIDs.push(Kr.map(Or=>Or.id)))}}const nt=m.bM(gt.glyphDependencies,Mi=>Object.keys(Mi).map(Number));this.inFlightDependencies.forEach(Mi=>Mi?.abort()),this.inFlightDependencies=[];let Tt=Promise.resolve({});if(Object.keys(nt).length){const Mi=new AbortController;this.inFlightDependencies.push(Mi),Tt=Le.sendAsync({type:"GG",data:{stacks:nt,source:this.source,tileID:this.tileID,type:"glyphs"}},Mi)}const Ve=Object.keys(gt.iconDependencies);let Ut=Promise.resolve({});if(Ve.length){const Mi=new AbortController;this.inFlightDependencies.push(Mi),Ut=Le.sendAsync({type:"GI",data:{icons:Ve,source:this.source,tileID:this.tileID,type:"icons"}},Mi)}const bt=Object.keys(gt.patternDependencies);let Ht=Promise.resolve({});if(bt.length){const Mi=new AbortController;this.inFlightDependencies.push(Mi),Ht=Le.sendAsync({type:"GI",data:{icons:bt,source:this.source,tileID:this.tileID,type:"patterns"}},Mi)}const[li,Ci,br]=yield Promise.all([Tt,Ut,Ht]),ur=new P(li),Ui=new m.cF(Ci,br);for(const Mi in He){const Hi=He[Mi];Hi instanceof m.a8?(D(Hi.layers,this.zoom,me),m.cG({bucket:Hi,glyphMap:li,glyphPositions:ur.positions,imageMap:Ci,imagePositions:Ui.iconPositions,showCollisionBoxes:this.showCollisionBoxes,canonical:this.tileID.canonical,subdivisionGranularity:gt.subdivisionGranularity})):Hi.hasPattern&&(Hi instanceof m.cH||Hi instanceof m.cI||Hi instanceof m.cJ)&&(D(Hi.layers,this.zoom,me),Hi.addFeatures(gt,this.tileID.canonical,Ui.patternPositions))}return this.status="done",{buckets:Object.values(He).filter(Mi=>!Mi.isEmpty()),featureIndex:at,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:ur.image,imageAtlas:Ui,glyphMap:this.returnDependencies?li:null,iconMap:this.returnDependencies?Ci:null,glyphPositions:this.returnDependencies?ur.positions:null}})}}function D(et,le,pe){const me=new m.F(le);for(const Le of et)Le.recalculate(me,pe)}class F{constructor(le,pe,me){this.actor=le,this.layerIndex=pe,this.availableImages=me,this.fetching={},this.loading={},this.loaded={}}loadVectorTile(le,pe){return m._(this,void 0,void 0,function*(){const me=yield m.n(le.request,pe);try{return{vectorTile:new m.cK.VectorTile(new m.cL(me.data)),rawData:me.data,cacheControl:me.cacheControl,expires:me.expires}}catch(Le){const Ze=new Uint8Array(me.data);let Je=`Unable to parse the tile at ${le.request.url}, `;throw Je+=Ze[0]===31&&Ze[1]===139?"please make sure the data is not gzipped and that you have configured the relevant header in the server":`got error: ${Le.message}`,new Error(Je)}})}loadTile(le){return m._(this,void 0,void 0,function*(){const pe=le.uid,me=!!(le&&le.request&&le.request.collectResourceTiming)&&new m.cM(le.request),Le=new L(le);this.loading[pe]=Le;const Ze=new AbortController;Le.abort=Ze;try{const Je=yield this.loadVectorTile(le,Ze);if(delete this.loading[pe],!Je)return null;const at=Je.rawData,He={};Je.expires&&(He.expires=Je.expires),Je.cacheControl&&(He.cacheControl=Je.cacheControl);const gt={};if(me){const nt=me.finish();nt&&(gt.resourceTiming=JSON.parse(JSON.stringify(nt)))}Le.vectorTile=Je.vectorTile;const ft=Le.parse(Je.vectorTile,this.layerIndex,this.availableImages,this.actor,le.subdivisionGranularity);this.loaded[pe]=Le,this.fetching[pe]={rawTileData:at,cacheControl:He,resourceTiming:gt};try{const nt=yield ft;return m.e({rawTileData:at.slice(0)},nt,He,gt)}finally{delete this.fetching[pe]}}catch(Je){throw delete this.loading[pe],Le.status="done",this.loaded[pe]=Le,Je}})}reloadTile(le){return m._(this,void 0,void 0,function*(){const pe=le.uid;if(!this.loaded||!this.loaded[pe])throw new Error("Should not be trying to reload a tile that was never loaded or has been removed");const me=this.loaded[pe];if(me.showCollisionBoxes=le.showCollisionBoxes,me.globalState=le.globalState,me.status==="parsing"){const Le=yield me.parse(me.vectorTile,this.layerIndex,this.availableImages,this.actor,le.subdivisionGranularity);let Ze;if(this.fetching[pe]){const{rawTileData:Je,cacheControl:at,resourceTiming:He}=this.fetching[pe];delete this.fetching[pe],Ze=m.e({rawTileData:Je.slice(0)},Le,at,He)}else Ze=Le;return Ze}if(me.status==="done"&&me.vectorTile)return me.parse(me.vectorTile,this.layerIndex,this.availableImages,this.actor,le.subdivisionGranularity)})}abortTile(le){return m._(this,void 0,void 0,function*(){const pe=this.loading,me=le.uid;pe&&pe[me]&&pe[me].abort&&(pe[me].abort.abort(),delete pe[me])})}removeTile(le){return m._(this,void 0,void 0,function*(){this.loaded&&this.loaded[le.uid]&&delete this.loaded[le.uid]})}}class Y{constructor(){this.loaded={}}loadTile(le){return m._(this,void 0,void 0,function*(){const{uid:pe,encoding:me,rawImageData:Le,redFactor:Ze,greenFactor:Je,blueFactor:at,baseShift:He}=le,gt=Le.width+2,ft=Le.height+2,nt=m.b(Le)?new m.R({width:gt,height:ft},yield m.cN(Le,-1,-1,gt,ft)):Le,Tt=new m.cO(pe,nt,me,Ze,Je,at,He);return this.loaded=this.loaded||{},this.loaded[pe]=Tt,Tt})}removeTile(le){const pe=this.loaded,me=le.uid;pe&&pe[me]&&delete pe[me]}}var V,H,ve=function(){if(H)return V;function et(pe,me){if(pe.length!==0){le(pe[0],me);for(var Le=1;Le<pe.length;Le++)le(pe[Le],!me)}}function le(pe,me){for(var Le=0,Ze=0,Je=0,at=pe.length,He=at-1;Je<at;He=Je++){var gt=(pe[Je][0]-pe[He][0])*(pe[He][1]+pe[Je][1]),ft=Le+gt;Ze+=Math.abs(Le)>=Math.abs(gt)?Le-ft+gt:gt-ft+Le,Le=ft}Le+Ze>=0!=!!me&&pe.reverse()}return H=1,V=function pe(me,Le){var Ze,Je=me&&me.type;if(Je==="FeatureCollection")for(Ze=0;Ze<me.features.length;Ze++)pe(me.features[Ze],Le);else if(Je==="GeometryCollection")for(Ze=0;Ze<me.geometries.length;Ze++)pe(me.geometries[Ze],Le);else if(Je==="Feature")pe(me.geometry,Le);else if(Je==="Polygon")et(me.coordinates,Le);else if(Je==="MultiPolygon")for(Ze=0;Ze<me.coordinates.length;Ze++)et(me.coordinates[Ze],Le);return me}}(),_e=m.cP(ve);const oe=m.cK.VectorTileFeature.prototype.toGeoJSON;class fe{constructor(le){this._feature=le,this.extent=m.$,this.type=le.type,this.properties=le.tags,"id"in le&&!isNaN(le.id)&&(this.id=parseInt(le.id,10))}loadGeometry(){if(this._feature.type===1){const le=[];for(const pe of this._feature.geometry)le.push([new m.P(pe[0],pe[1])]);return le}{const le=[];for(const pe of this._feature.geometry){const me=[];for(const Le of pe)me.push(new m.P(Le[0],Le[1]));le.push(me)}return le}}toGeoJSON(le,pe,me){return oe.call(this,le,pe,me)}}class K{constructor(le){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=m.$,this.length=le.length,this._features=le}feature(le){return new fe(this._features[le])}}var ne,ye,Re,Se={exports:{}},Z=function(){if(Re)return Se.exports;Re=1;var et=m.cS(),le=function(){if(ye)return ne;ye=1;var ft=m.cQ(),nt=m.cR().VectorTileFeature;function Tt(Ut,bt){this.options=bt||{},this.features=Ut,this.length=Ut.length}function Ve(Ut,bt){this.id=typeof Ut.id=="number"?Ut.id:void 0,this.type=Ut.type,this.rawGeometry=Ut.type===1?[Ut.geometry]:Ut.geometry,this.properties=Ut.tags,this.extent=bt||4096}return ne=Tt,Tt.prototype.feature=function(Ut){return new Ve(this.features[Ut],this.options.extent)},Ve.prototype.loadGeometry=function(){var Ut=this.rawGeometry;this.geometry=[];for(var bt=0;bt<Ut.length;bt++){for(var Ht=Ut[bt],li=[],Ci=0;Ci<Ht.length;Ci++)li.push(new ft(Ht[Ci][0],Ht[Ci][1]));this.geometry.push(li)}return this.geometry},Ve.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var Ut=this.geometry,bt=1/0,Ht=-1/0,li=1/0,Ci=-1/0,br=0;br<Ut.length;br++)for(var ur=Ut[br],Ui=0;Ui<ur.length;Ui++){var Mi=ur[Ui];bt=Math.min(bt,Mi.x),Ht=Math.max(Ht,Mi.x),li=Math.min(li,Mi.y),Ci=Math.max(Ci,Mi.y)}return[bt,li,Ht,Ci]},Ve.prototype.toGeoJSON=nt.prototype.toGeoJSON,ne}();function pe(ft){var nt=new et;return function(Tt,Ve){for(var Ut in Tt.layers)Ve.writeMessage(3,me,Tt.layers[Ut])}(ft,nt),nt.finish()}function me(ft,nt){var Tt;nt.writeVarintField(15,ft.version||1),nt.writeStringField(1,ft.name||""),nt.writeVarintField(5,ft.extent||4096);var Ve={keys:[],values:[],keycache:{},valuecache:{}};for(Tt=0;Tt<ft.length;Tt++)Ve.feature=ft.feature(Tt),nt.writeMessage(2,Le,Ve);var Ut=Ve.keys;for(Tt=0;Tt<Ut.length;Tt++)nt.writeStringField(3,Ut[Tt]);var bt=Ve.values;for(Tt=0;Tt<bt.length;Tt++)nt.writeMessage(4,gt,bt[Tt])}function Le(ft,nt){var Tt=ft.feature;Tt.id!==void 0&&nt.writeVarintField(1,Tt.id),nt.writeMessage(2,Ze,ft),nt.writeVarintField(3,Tt.type),nt.writeMessage(4,He,Tt)}function Ze(ft,nt){var Tt=ft.feature,Ve=ft.keys,Ut=ft.values,bt=ft.keycache,Ht=ft.valuecache;for(var li in Tt.properties){var Ci=Tt.properties[li],br=bt[li];if(Ci!==null){br===void 0&&(Ve.push(li),bt[li]=br=Ve.length-1),nt.writeVarint(br);var ur=typeof Ci;ur!=="string"&&ur!=="boolean"&&ur!=="number"&&(Ci=JSON.stringify(Ci));var Ui=ur+":"+Ci,Mi=Ht[Ui];Mi===void 0&&(Ut.push(Ci),Ht[Ui]=Mi=Ut.length-1),nt.writeVarint(Mi)}}}function Je(ft,nt){return(nt<<3)+(7&ft)}function at(ft){return ft<<1^ft>>31}function He(ft,nt){for(var Tt=ft.loadGeometry(),Ve=ft.type,Ut=0,bt=0,Ht=Tt.length,li=0;li<Ht;li++){var Ci=Tt[li],br=1;Ve===1&&(br=Ci.length),nt.writeVarint(Je(1,br));for(var ur=Ve===3?Ci.length-1:Ci.length,Ui=0;Ui<ur;Ui++){Ui===1&&Ve!==1&&nt.writeVarint(Je(2,ur-1));var Mi=Ci[Ui].x-Ut,Hi=Ci[Ui].y-bt;nt.writeVarint(at(Mi)),nt.writeVarint(at(Hi)),Ut+=Mi,bt+=Hi}Ve===3&&nt.writeVarint(Je(7,1))}}function gt(ft,nt){var Tt=typeof ft;Tt==="string"?nt.writeStringField(1,ft):Tt==="boolean"?nt.writeBooleanField(7,ft):Tt==="number"&&(ft%1!=0?nt.writeDoubleField(3,ft):ft<0?nt.writeSVarintField(6,ft):nt.writeVarintField(5,ft))}return Se.exports=pe,Se.exports.fromVectorTileJs=pe,Se.exports.fromGeojsonVt=function(ft,nt){nt=nt||{};var Tt={};for(var Ve in ft)Tt[Ve]=new le(ft[Ve].features,nt),Tt[Ve].name=Ve,Tt[Ve].version=nt.version,Tt[Ve].extent=nt.extent;return pe({layers:Tt})},Se.exports.GeoJSONWrapper=le,Se.exports}(),$=m.cP(Z);const Q={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:et=>et},ue=Math.fround||(he=new Float32Array(1),et=>(he[0]=+et,he[0]));var he;class Pe{constructor(le){this.options=Object.assign(Object.create(Q),le),this.trees=new Array(this.options.maxZoom+1),this.stride=this.options.reduce?7:6,this.clusterProps=[]}load(le){const{log:pe,minZoom:me,maxZoom:Le}=this.options;pe&&console.time("total time");const Ze=`prepare ${le.length} points`;pe&&console.time(Ze),this.points=le;const Je=[];for(let He=0;He<le.length;He++){const gt=le[He];if(!gt.geometry)continue;const[ft,nt]=gt.geometry.coordinates,Tt=ue(Be(ft)),Ve=ue(Ke(nt));Je.push(Tt,Ve,1/0,He,-1,1),this.options.reduce&&Je.push(0)}let at=this.trees[Le+1]=this._createTree(Je);pe&&console.timeEnd(Ze);for(let He=Le;He>=me;He--){const gt=+Date.now();at=this.trees[He]=this._createTree(this._cluster(at,He)),pe&&console.log("z%d: %d clusters in %dms",He,at.numItems,+Date.now()-gt)}return pe&&console.timeEnd("total time"),this}getClusters(le,pe){let me=((le[0]+180)%360+360)%360-180;const Le=Math.max(-90,Math.min(90,le[1]));let Ze=le[2]===180?180:((le[2]+180)%360+360)%360-180;const Je=Math.max(-90,Math.min(90,le[3]));if(le[2]-le[0]>=360)me=-180,Ze=180;else if(me>Ze){const nt=this.getClusters([me,Le,180,Je],pe),Tt=this.getClusters([-180,Le,Ze,Je],pe);return nt.concat(Tt)}const at=this.trees[this._limitZoom(pe)],He=at.range(Be(me),Ke(Je),Be(Ze),Ke(Le)),gt=at.data,ft=[];for(const nt of He){const Tt=this.stride*nt;ft.push(gt[Tt+5]>1?Ae(gt,Tt,this.clusterProps):this.points[gt[Tt+3]])}return ft}getChildren(le){const pe=this._getOriginId(le),me=this._getOriginZoom(le),Le="No cluster with the specified id.",Ze=this.trees[me];if(!Ze)throw new Error(Le);const Je=Ze.data;if(pe*this.stride>=Je.length)throw new Error(Le);const at=this.options.radius/(this.options.extent*Math.pow(2,me-1)),He=Ze.within(Je[pe*this.stride],Je[pe*this.stride+1],at),gt=[];for(const ft of He){const nt=ft*this.stride;Je[nt+4]===le&&gt.push(Je[nt+5]>1?Ae(Je,nt,this.clusterProps):this.points[Je[nt+3]])}if(gt.length===0)throw new Error(Le);return gt}getLeaves(le,pe,me){const Le=[];return this._appendLeaves(Le,le,pe=pe||10,me=me||0,0),Le}getTile(le,pe,me){const Le=this.trees[this._limitZoom(le)],Ze=Math.pow(2,le),{extent:Je,radius:at}=this.options,He=at/Je,gt=(me-He)/Ze,ft=(me+1+He)/Ze,nt={features:[]};return this._addTileFeatures(Le.range((pe-He)/Ze,gt,(pe+1+He)/Ze,ft),Le.data,pe,me,Ze,nt),pe===0&&this._addTileFeatures(Le.range(1-He/Ze,gt,1,ft),Le.data,Ze,me,Ze,nt),pe===Ze-1&&this._addTileFeatures(Le.range(0,gt,He/Ze,ft),Le.data,-1,me,Ze,nt),nt.features.length?nt:null}getClusterExpansionZoom(le){let pe=this._getOriginZoom(le)-1;for(;pe<=this.options.maxZoom;){const me=this.getChildren(le);if(pe++,me.length!==1)break;le=me[0].properties.cluster_id}return pe}_appendLeaves(le,pe,me,Le,Ze){const Je=this.getChildren(pe);for(const at of Je){const He=at.properties;if(He&&He.cluster?Ze+He.point_count<=Le?Ze+=He.point_count:Ze=this._appendLeaves(le,He.cluster_id,me,Le,Ze):Ze<Le?Ze++:le.push(at),le.length===me)break}return Ze}_createTree(le){const pe=new m.aH(le.length/this.stride|0,this.options.nodeSize,Float32Array);for(let me=0;me<le.length;me+=this.stride)pe.add(le[me],le[me+1]);return pe.finish(),pe.data=le,pe}_addTileFeatures(le,pe,me,Le,Ze,Je){for(const at of le){const He=at*this.stride,gt=pe[He+5]>1;let ft,nt,Tt;if(gt)ft=ke(pe,He,this.clusterProps),nt=pe[He],Tt=pe[He+1];else{const bt=this.points[pe[He+3]];ft=bt.properties;const[Ht,li]=bt.geometry.coordinates;nt=Be(Ht),Tt=Ke(li)}const Ve={type:1,geometry:[[Math.round(this.options.extent*(nt*Ze-me)),Math.round(this.options.extent*(Tt*Ze-Le))]],tags:ft};let Ut;Ut=gt||this.options.generateId?pe[He+3]:this.points[pe[He+3]].id,Ut!==void 0&&(Ve.id=Ut),Je.features.push(Ve)}}_limitZoom(le){return Math.max(this.options.minZoom,Math.min(Math.floor(+le),this.options.maxZoom+1))}_cluster(le,pe){const{radius:me,extent:Le,reduce:Ze,minPoints:Je}=this.options,at=me/(Le*Math.pow(2,pe)),He=le.data,gt=[],ft=this.stride;for(let nt=0;nt<He.length;nt+=ft){if(He[nt+2]<=pe)continue;He[nt+2]=pe;const Tt=He[nt],Ve=He[nt+1],Ut=le.within(He[nt],He[nt+1],at),bt=He[nt+5];let Ht=bt;for(const li of Ut){const Ci=li*ft;He[Ci+2]>pe&&(Ht+=He[Ci+5])}if(Ht>bt&&Ht>=Je){let li,Ci=Tt*bt,br=Ve*bt,ur=-1;const Ui=(nt/ft<<5)+(pe+1)+this.points.length;for(const Mi of Ut){const Hi=Mi*ft;if(He[Hi+2]<=pe)continue;He[Hi+2]=pe;const Lr=He[Hi+5];Ci+=He[Hi]*Lr,br+=He[Hi+1]*Lr,He[Hi+4]=Ui,Ze&&(li||(li=this._map(He,nt,!0),ur=this.clusterProps.length,this.clusterProps.push(li)),Ze(li,this._map(He,Hi)))}He[nt+4]=Ui,gt.push(Ci/Ht,br/Ht,1/0,Ui,-1,Ht),Ze&&gt.push(ur)}else{for(let li=0;li<ft;li++)gt.push(He[nt+li]);if(Ht>1)for(const li of Ut){const Ci=li*ft;if(!(He[Ci+2]<=pe)){He[Ci+2]=pe;for(let br=0;br<ft;br++)gt.push(He[Ci+br])}}}}return gt}_getOriginId(le){return le-this.points.length>>5}_getOriginZoom(le){return(le-this.points.length)%32}_map(le,pe,me){if(le[pe+5]>1){const Je=this.clusterProps[le[pe+6]];return me?Object.assign({},Je):Je}const Le=this.points[le[pe+3]].properties,Ze=this.options.map(Le);return me&&Ze===Le?Object.assign({},Ze):Ze}}function Ae(et,le,pe){return{type:"Feature",id:et[le+3],properties:ke(et,le,pe),geometry:{type:"Point",coordinates:[(me=et[le],360*(me-.5)),tt(et[le+1])]}};var me}function ke(et,le,pe){const me=et[le+5],Le=me>=1e4?`${Math.round(me/1e3)}k`:me>=1e3?Math.round(me/100)/10+"k":me,Ze=et[le+6],Je=Ze===-1?{}:Object.assign({},pe[Ze]);return Object.assign(Je,{cluster:!0,cluster_id:et[le+3],point_count:me,point_count_abbreviated:Le})}function Be(et){return et/360+.5}function Ke(et){const le=Math.sin(et*Math.PI/180),pe=.5-.25*Math.log((1+le)/(1-le))/Math.PI;return pe<0?0:pe>1?1:pe}function tt(et){const le=(180-360*et)*Math.PI/180;return 360*Math.atan(Math.exp(le))/Math.PI-90}function pt(et,le,pe,me){let Le=me;const Ze=le+(pe-le>>1);let Je,at=pe-le;const He=et[le],gt=et[le+1],ft=et[pe],nt=et[pe+1];for(let Tt=le+3;Tt<pe;Tt+=3){const Ve=vt(et[Tt],et[Tt+1],He,gt,ft,nt);if(Ve>Le)Je=Tt,Le=Ve;else if(Ve===Le){const Ut=Math.abs(Tt-Ze);Ut<at&&(Je=Tt,at=Ut)}}Le>me&&(Je-le>3&&pt(et,le,Je,me),et[Je+2]=Le,pe-Je>3&&pt(et,Je,pe,me))}function vt(et,le,pe,me,Le,Ze){let Je=Le-pe,at=Ze-me;if(Je!==0||at!==0){const He=((et-pe)*Je+(le-me)*at)/(Je*Je+at*at);He>1?(pe=Le,me=Ze):He>0&&(pe+=Je*He,me+=at*He)}return Je=et-pe,at=le-me,Je*Je+at*at}function Ft(et,le,pe,me){const Le={id:et??null,type:le,geometry:pe,tags:me,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};if(le==="Point"||le==="MultiPoint"||le==="LineString")It(Le,pe);else if(le==="Polygon")It(Le,pe[0]);else if(le==="MultiLineString")for(const Ze of pe)It(Le,Ze);else if(le==="MultiPolygon")for(const Ze of pe)It(Le,Ze[0]);return Le}function It(et,le){for(let pe=0;pe<le.length;pe+=3)et.minX=Math.min(et.minX,le[pe]),et.minY=Math.min(et.minY,le[pe+1]),et.maxX=Math.max(et.maxX,le[pe]),et.maxY=Math.max(et.maxY,le[pe+1])}function Zt(et,le,pe,me){if(!le.geometry)return;const Le=le.geometry.coordinates;if(Le&&Le.length===0)return;const Ze=le.geometry.type,Je=Math.pow(pe.tolerance/((1<<pe.maxZoom)*pe.extent),2);let at=[],He=le.id;if(pe.promoteId?He=le.properties[pe.promoteId]:pe.generateId&&(He=me||0),Ze==="Point")zt(Le,at);else if(Ze==="MultiPoint")for(const gt of Le)zt(gt,at);else if(Ze==="LineString")ti(Le,at,Je,!1);else if(Ze==="MultiLineString"){if(pe.lineMetrics){for(const gt of Le)at=[],ti(gt,at,Je,!1),et.push(Ft(He,"LineString",at,le.properties));return}ai(Le,at,Je,!1)}else if(Ze==="Polygon")ai(Le,at,Je,!0);else{if(Ze!=="MultiPolygon"){if(Ze==="GeometryCollection"){for(const gt of le.geometry.geometries)Zt(et,{id:He,geometry:gt,properties:le.properties},pe,me);return}throw new Error("Input data is not a valid GeoJSON object.")}for(const gt of Le){const ft=[];ai(gt,ft,Je,!0),at.push(ft)}}et.push(Ft(He,Ze,at,le.properties))}function zt(et,le){le.push(Ir(et[0]),lt(et[1]),0)}function ti(et,le,pe,me){let Le,Ze,Je=0;for(let He=0;He<et.length;He++){const gt=Ir(et[He][0]),ft=lt(et[He][1]);le.push(gt,ft,0),He>0&&(Je+=me?(Le*ft-gt*Ze)/2:Math.sqrt(Math.pow(gt-Le,2)+Math.pow(ft-Ze,2))),Le=gt,Ze=ft}const at=le.length-3;le[2]=1,pt(le,0,at,pe),le[at+2]=1,le.size=Math.abs(Je),le.start=0,le.end=le.size}function ai(et,le,pe,me){for(let Le=0;Le<et.length;Le++){const Ze=[];ti(et[Le],Ze,pe,me),le.push(Ze)}}function Ir(et){return et/360+.5}function lt(et){const le=Math.sin(et*Math.PI/180),pe=.5-.25*Math.log((1+le)/(1-le))/Math.PI;return pe<0?0:pe>1?1:pe}function Xi(et,le,pe,me,Le,Ze,Je,at){if(me/=le,Ze>=(pe/=le)&&Je<me)return et;if(Je<pe||Ze>=me)return null;const He=[];for(const gt of et){const ft=gt.geometry;let nt=gt.type;const Tt=Le===0?gt.minX:gt.minY,Ve=Le===0?gt.maxX:gt.maxY;if(Tt>=pe&&Ve<me){He.push(gt);continue}if(Ve<pe||Tt>=me)continue;let Ut=[];if(nt==="Point"||nt==="MultiPoint")ii(ft,Ut,pe,me,Le);else if(nt==="LineString")Jt(ft,Ut,pe,me,Le,!1,at.lineMetrics);else if(nt==="MultiLineString")zi(ft,Ut,pe,me,Le,!1);else if(nt==="Polygon")zi(ft,Ut,pe,me,Le,!0);else if(nt==="MultiPolygon")for(const bt of ft){const Ht=[];zi(bt,Ht,pe,me,Le,!0),Ht.length&&Ut.push(Ht)}if(Ut.length){if(at.lineMetrics&&nt==="LineString"){for(const bt of Ut)He.push(Ft(gt.id,nt,bt,gt.tags));continue}nt!=="LineString"&&nt!=="MultiLineString"||(Ut.length===1?(nt="LineString",Ut=Ut[0]):nt="MultiLineString"),nt!=="Point"&&nt!=="MultiPoint"||(nt=Ut.length===3?"Point":"MultiPoint"),He.push(Ft(gt.id,nt,Ut,gt.tags))}}return He.length?He:null}function ii(et,le,pe,me,Le){for(let Ze=0;Ze<et.length;Ze+=3){const Je=et[Ze+Le];Je>=pe&&Je<=me&&Qi(le,et[Ze],et[Ze+1],et[Ze+2])}}function Jt(et,le,pe,me,Le,Ze,Je){let at=$e(et);const He=Le===0?Gi:sr;let gt,ft,nt=et.start;for(let Ht=0;Ht<et.length-3;Ht+=3){const li=et[Ht],Ci=et[Ht+1],br=et[Ht+2],ur=et[Ht+3],Ui=et[Ht+4],Mi=Le===0?li:Ci,Hi=Le===0?ur:Ui;let Lr=!1;Je&&(gt=Math.sqrt(Math.pow(li-ur,2)+Math.pow(Ci-Ui,2))),Mi<pe?Hi>pe&&(ft=He(at,li,Ci,ur,Ui,pe),Je&&(at.start=nt+gt*ft)):Mi>me?Hi<me&&(ft=He(at,li,Ci,ur,Ui,me),Je&&(at.start=nt+gt*ft)):Qi(at,li,Ci,br),Hi<pe&&Mi>=pe&&(ft=He(at,li,Ci,ur,Ui,pe),Lr=!0),Hi>me&&Mi<=me&&(ft=He(at,li,Ci,ur,Ui,me),Lr=!0),!Ze&&Lr&&(Je&&(at.end=nt+gt*ft),le.push(at),at=$e(et)),Je&&(nt+=gt)}let Tt=et.length-3;const Ve=et[Tt],Ut=et[Tt+1],bt=Le===0?Ve:Ut;bt>=pe&&bt<=me&&Qi(at,Ve,Ut,et[Tt+2]),Tt=at.length-3,Ze&&Tt>=3&&(at[Tt]!==at[0]||at[Tt+1]!==at[1])&&Qi(at,at[0],at[1],at[2]),at.length&&le.push(at)}function $e(et){const le=[];return le.size=et.size,le.start=et.start,le.end=et.end,le}function zi(et,le,pe,me,Le,Ze){for(const Je of et)Jt(Je,le,pe,me,Le,Ze,!1)}function Qi(et,le,pe,me){et.push(le,pe,me)}function Gi(et,le,pe,me,Le,Ze){const Je=(Ze-le)/(me-le);return Qi(et,Ze,pe+(Le-pe)*Je,1),Je}function sr(et,le,pe,me,Le,Ze){const Je=(Ze-pe)/(Le-pe);return Qi(et,le+(me-le)*Je,Ze,1),Je}function jr(et,le){const pe=[];for(let me=0;me<et.length;me++){const Le=et[me],Ze=Le.type;let Je;if(Ze==="Point"||Ze==="MultiPoint"||Ze==="LineString")Je=En(Le.geometry,le);else if(Ze==="MultiLineString"||Ze==="Polygon"){Je=[];for(const at of Le.geometry)Je.push(En(at,le))}else if(Ze==="MultiPolygon"){Je=[];for(const at of Le.geometry){const He=[];for(const gt of at)He.push(En(gt,le));Je.push(He)}}pe.push(Ft(Le.id,Ze,Je,Le.tags))}return pe}function En(et,le){const pe=[];pe.size=et.size,et.start!==void 0&&(pe.start=et.start,pe.end=et.end);for(let me=0;me<et.length;me+=3)pe.push(et[me]+le,et[me+1],et[me+2]);return pe}function Ot(et,le){if(et.transformed)return et;const pe=1<<et.z,me=et.x,Le=et.y;for(const Ze of et.features){const Je=Ze.geometry,at=Ze.type;if(Ze.geometry=[],at===1)for(let He=0;He<Je.length;He+=2)Ze.geometry.push(In(Je[He],Je[He+1],le,pe,me,Le));else for(let He=0;He<Je.length;He++){const gt=[];for(let ft=0;ft<Je[He].length;ft+=2)gt.push(In(Je[He][ft],Je[He][ft+1],le,pe,me,Le));Ze.geometry.push(gt)}}return et.transformed=!0,et}function In(et,le,pe,me,Le,Ze){return[Math.round(pe*(et*me-Le)),Math.round(pe*(le*me-Ze))]}function xs(et,le,pe,me,Le){const Ze=le===Le.maxZoom?0:Le.tolerance/((1<<le)*Le.extent),Je={features:[],numPoints:0,numSimplified:0,numFeatures:et.length,source:null,x:pe,y:me,z:le,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0};for(const at of et)os(Je,at,Ze,Le);return Je}function os(et,le,pe,me){const Le=le.geometry,Ze=le.type,Je=[];if(et.minX=Math.min(et.minX,le.minX),et.minY=Math.min(et.minY,le.minY),et.maxX=Math.max(et.maxX,le.maxX),et.maxY=Math.max(et.maxY,le.maxY),Ze==="Point"||Ze==="MultiPoint")for(let at=0;at<Le.length;at+=3)Je.push(Le[at],Le[at+1]),et.numPoints++,et.numSimplified++;else if(Ze==="LineString")$s(Je,Le,et,pe,!1,!1);else if(Ze==="MultiLineString"||Ze==="Polygon")for(let at=0;at<Le.length;at++)$s(Je,Le[at],et,pe,Ze==="Polygon",at===0);else if(Ze==="MultiPolygon")for(let at=0;at<Le.length;at++){const He=Le[at];for(let gt=0;gt<He.length;gt++)$s(Je,He[gt],et,pe,!0,gt===0)}if(Je.length){let at=le.tags||null;if(Ze==="LineString"&&me.lineMetrics){at={};for(const gt in le.tags)at[gt]=le.tags[gt];at.mapbox_clip_start=Le.start/Le.size,at.mapbox_clip_end=Le.end/Le.size}const He={geometry:Je,type:Ze==="Polygon"||Ze==="MultiPolygon"?3:Ze==="LineString"||Ze==="MultiLineString"?2:1,tags:at};le.id!==null&&(He.id=le.id),et.features.push(He)}}function $s(et,le,pe,me,Le,Ze){const Je=me*me;if(me>0&&le.size<(Le?Je:me))return void(pe.numPoints+=le.length/3);const at=[];for(let He=0;He<le.length;He+=3)(me===0||le[He+2]>Je)&&(pe.numSimplified++,at.push(le[He],le[He+1])),pe.numPoints++;Le&&function(He,gt){let ft=0;for(let nt=0,Tt=He.length,Ve=Tt-2;nt<Tt;Ve=nt,nt+=2)ft+=(He[nt]-He[Ve])*(He[nt+1]+He[Ve+1]);if(ft>0===gt)for(let nt=0,Tt=He.length;nt<Tt/2;nt+=2){const Ve=He[nt],Ut=He[nt+1];He[nt]=He[Tt-2-nt],He[nt+1]=He[Tt-1-nt],He[Tt-2-nt]=Ve,He[Tt-1-nt]=Ut}}(at,Ze),et.push(at)}const Xt={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0};class _r{constructor(le,pe){const me=(pe=this.options=function(Ze,Je){for(const at in Je)Ze[at]=Je[at];return Ze}(Object.create(Xt),pe)).debug;if(me&&console.time("preprocess data"),pe.maxZoom<0||pe.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(pe.promoteId&&pe.generateId)throw new Error("promoteId and generateId cannot be used together.");let Le=function(Ze,Je){const at=[];if(Ze.type==="FeatureCollection")for(let He=0;He<Ze.features.length;He++)Zt(at,Ze.features[He],Je,He);else Zt(at,Ze.type==="Feature"?Ze:{geometry:Ze},Je);return at}(le,pe);this.tiles={},this.tileCoords=[],me&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",pe.indexMaxZoom,pe.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),Le=function(Ze,Je){const at=Je.buffer/Je.extent;let He=Ze;const gt=Xi(Ze,1,-1-at,at,0,-1,2,Je),ft=Xi(Ze,1,1-at,2+at,0,-1,2,Je);return(gt||ft)&&(He=Xi(Ze,1,-at,1+at,0,-1,2,Je)||[],gt&&(He=jr(gt,1).concat(He)),ft&&(He=He.concat(jr(ft,-1)))),He}(Le,pe),Le.length&&this.splitTile(Le,0,0,0),me&&(Le.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}splitTile(le,pe,me,Le,Ze,Je,at){const He=[le,pe,me,Le],gt=this.options,ft=gt.debug;for(;He.length;){Le=He.pop(),me=He.pop(),pe=He.pop(),le=He.pop();const nt=1<<pe,Tt=gi(pe,me,Le);let Ve=this.tiles[Tt];if(!Ve&&(ft>1&&console.time("creation"),Ve=this.tiles[Tt]=xs(le,pe,me,Le,gt),this.tileCoords.push({z:pe,x:me,y:Le}),ft)){ft>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",pe,me,Le,Ve.numFeatures,Ve.numPoints,Ve.numSimplified),console.timeEnd("creation"));const Lr=`z${pe}`;this.stats[Lr]=(this.stats[Lr]||0)+1,this.total++}if(Ve.source=le,Ze==null){if(pe===gt.indexMaxZoom||Ve.numPoints<=gt.indexMaxPoints)continue}else{if(pe===gt.maxZoom||pe===Ze)continue;if(Ze!=null){const Lr=Ze-pe;if(me!==Je>>Lr||Le!==at>>Lr)continue}}if(Ve.source=null,le.length===0)continue;ft>1&&console.time("clipping");const Ut=.5*gt.buffer/gt.extent,bt=.5-Ut,Ht=.5+Ut,li=1+Ut;let Ci=null,br=null,ur=null,Ui=null,Mi=Xi(le,nt,me-Ut,me+Ht,0,Ve.minX,Ve.maxX,gt),Hi=Xi(le,nt,me+bt,me+li,0,Ve.minX,Ve.maxX,gt);le=null,Mi&&(Ci=Xi(Mi,nt,Le-Ut,Le+Ht,1,Ve.minY,Ve.maxY,gt),br=Xi(Mi,nt,Le+bt,Le+li,1,Ve.minY,Ve.maxY,gt),Mi=null),Hi&&(ur=Xi(Hi,nt,Le-Ut,Le+Ht,1,Ve.minY,Ve.maxY,gt),Ui=Xi(Hi,nt,Le+bt,Le+li,1,Ve.minY,Ve.maxY,gt),Hi=null),ft>1&&console.timeEnd("clipping"),He.push(Ci||[],pe+1,2*me,2*Le),He.push(br||[],pe+1,2*me,2*Le+1),He.push(ur||[],pe+1,2*me+1,2*Le),He.push(Ui||[],pe+1,2*me+1,2*Le+1)}}getTile(le,pe,me){le=+le,pe=+pe,me=+me;const Le=this.options,{extent:Ze,debug:Je}=Le;if(le<0||le>24)return null;const at=1<<le,He=gi(le,pe=pe+at&at-1,me);if(this.tiles[He])return Ot(this.tiles[He],Ze);Je>1&&console.log("drilling down to z%d-%d-%d",le,pe,me);let gt,ft=le,nt=pe,Tt=me;for(;!gt&&ft>0;)ft--,nt>>=1,Tt>>=1,gt=this.tiles[gi(ft,nt,Tt)];return gt&&gt.source?(Je>1&&(console.log("found parent tile z%d-%d-%d",ft,nt,Tt),console.time("drilling down")),this.splitTile(gt.source,ft,nt,Tt,le,pe,me),Je>1&&console.timeEnd("drilling down"),this.tiles[He]?Ot(this.tiles[He],Ze):null):null}}function gi(et,le,pe){return 32*((1<<et)*pe+le)+et}function rn(et,le){return le?et.properties[le]:et.id}function oi(et,le){if(et==null)return!0;if(et.type==="Feature")return rn(et,le)!=null;if(et.type==="FeatureCollection"){const pe=new Set;for(const me of et.features){const Le=rn(me,le);if(Le==null||pe.has(Le))return!1;pe.add(Le)}return!0}return!1}function er(et,le){const pe=new Map;if(et!=null)if(et.type==="Feature")pe.set(rn(et,le),et);else for(const me of et.features)pe.set(rn(me,le),me);return pe}class Bi extends F{constructor(){super(...arguments),this._dataUpdateable=new Map}loadVectorTile(le,pe){return m._(this,void 0,void 0,function*(){const me=le.tileID.canonical;if(!this._geoJSONIndex)throw new Error("Unable to parse the data into a cluster or geojson");const Le=this._geoJSONIndex.getTile(me.z,me.x,me.y);if(!Le)return null;const Ze=new K(Le.features);let Je=$(Ze);return Je.byteOffset===0&&Je.byteLength===Je.buffer.byteLength||(Je=new Uint8Array(Je)),{vectorTile:Ze,rawData:Je.buffer}})}loadData(le){return m._(this,void 0,void 0,function*(){var pe;(pe=this._pendingRequest)===null||pe===void 0||pe.abort();const me=!!(le&&le.request&&le.request.collectResourceTiming)&&new m.cM(le.request);this._pendingRequest=new AbortController;try{this._pendingData=this.loadAndProcessGeoJSON(le,this._pendingRequest),this._geoJSONIndex=le.cluster?new Pe(function({superclusterOptions:Je,clusterProperties:at}){if(!at||!Je)return Je;const He={},gt={},ft={accumulated:null,zoom:0},nt={properties:null},Tt=Object.keys(at);for(const Ve of Tt){const[Ut,bt]=at[Ve],Ht=m.cT(bt),li=m.cT(typeof Ut=="string"?[Ut,["accumulated"],["get",Ve]]:Ut);He[Ve]=Ht.value,gt[Ve]=li.value}return Je.map=Ve=>{nt.properties=Ve;const Ut={};for(const bt of Tt)Ut[bt]=He[bt].evaluate(ft,nt);return Ut},Je.reduce=(Ve,Ut)=>{nt.properties=Ut;for(const bt of Tt)ft.accumulated=Ve[bt],Ve[bt]=gt[bt].evaluate(ft,nt)},Je}(le)).load((yield this._pendingData).features):(Le=yield this._pendingData,new _r(Le,le.geojsonVtOptions)),this.loaded={};const Ze={};if(me){const Je=me.finish();Je&&(Ze.resourceTiming={},Ze.resourceTiming[le.source]=JSON.parse(JSON.stringify(Je)))}return Ze}catch(Ze){if(delete this._pendingRequest,m.cx(Ze))return{abandoned:!0};throw Ze}var Le})}getData(){return m._(this,void 0,void 0,function*(){return this._pendingData})}reloadTile(le){const pe=this.loaded;return pe&&pe[le.uid]?super.reloadTile(le):this.loadTile(le)}loadAndProcessGeoJSON(le,pe){return m._(this,void 0,void 0,function*(){let me=yield this.loadGeoJSON(le,pe);if(delete this._pendingRequest,typeof me!="object")throw new Error(`Input data given to '${le.source}' is not a valid GeoJSON object.`);if(_e(me,!0),le.filter){const Le=m.cT(le.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if(Le.result==="error")throw new Error(Le.value.map(Ze=>`${Ze.key}: ${Ze.message}`).join(", "));me={type:"FeatureCollection",features:me.features.filter(Ze=>Le.value.evaluate({zoom:0},Ze))}}return me})}loadGeoJSON(le,pe){return m._(this,void 0,void 0,function*(){const{promoteId:me}=le;if(le.request){const Le=yield m.j(le.request,pe);return this._dataUpdateable=oi(Le.data,me)?er(Le.data,me):void 0,Le.data}if(typeof le.data=="string")try{const Le=JSON.parse(le.data);return this._dataUpdateable=oi(Le,me)?er(Le,me):void 0,Le}catch{throw new Error(`Input data given to '${le.source}' is not a valid GeoJSON object.`)}if(!le.dataDiff)throw new Error(`Input data given to '${le.source}' is not a valid GeoJSON object.`);if(!this._dataUpdateable)throw new Error(`Cannot update existing geojson data in ${le.source}`);return function(Le,Ze,Je){var at,He,gt,ft;if(Ze.removeAll&&Le.clear(),Ze.remove)for(const nt of Ze.remove)Le.delete(nt);if(Ze.add)for(const nt of Ze.add){const Tt=rn(nt,Je);Tt!=null&&Le.set(Tt,nt)}if(Ze.update)for(const nt of Ze.update){let Tt=Le.get(nt.id);if(Tt==null)continue;const Ve=!nt.removeAllProperties&&(((at=nt.removeProperties)===null||at===void 0?void 0:at.length)>0||((He=nt.addOrUpdateProperties)===null||He===void 0?void 0:He.length)>0);if((nt.newGeometry||nt.removeAllProperties||Ve)&&(Tt=Object.assign({},Tt),Le.set(nt.id,Tt),Ve&&(Tt.properties=Object.assign({},Tt.properties))),nt.newGeometry&&(Tt.geometry=nt.newGeometry),nt.removeAllProperties)Tt.properties={};else if(((gt=nt.removeProperties)===null||gt===void 0?void 0:gt.length)>0)for(const Ut of nt.removeProperties)Object.prototype.hasOwnProperty.call(Tt.properties,Ut)&&delete Tt.properties[Ut];if(((ft=nt.addOrUpdateProperties)===null||ft===void 0?void 0:ft.length)>0)for(const{key:Ut,value:bt}of nt.addOrUpdateProperties)Tt.properties[Ut]=bt}}(this._dataUpdateable,le.dataDiff,me),{type:"FeatureCollection",features:Array.from(this._dataUpdateable.values())}})}removeSource(le){return m._(this,void 0,void 0,function*(){this._pendingRequest&&this._pendingRequest.abort()})}getClusterExpansionZoom(le){return this._geoJSONIndex.getClusterExpansionZoom(le.clusterId)}getClusterChildren(le){return this._geoJSONIndex.getChildren(le.clusterId)}getClusterLeaves(le){return this._geoJSONIndex.getLeaves(le.clusterId,le.limit,le.offset)}}class Ii{constructor(le){this.self=le,this.actor=new m.J(le),this.layerIndexes={},this.availableImages={},this.workerSources={},this.demWorkerSources={},this.externalWorkerSourceTypes={},this.self.registerWorkerSource=(pe,me)=>{if(this.externalWorkerSourceTypes[pe])throw new Error(`Worker source with name "${pe}" already registered.`);this.externalWorkerSourceTypes[pe]=me},this.self.addProtocol=m.cz,this.self.removeProtocol=m.cA,this.self.registerRTLTextPlugin=pe=>{m.cU.setMethods(pe)},this.actor.registerMessageHandler("LDT",(pe,me)=>this._getDEMWorkerSource(pe,me.source).loadTile(me)),this.actor.registerMessageHandler("RDT",(pe,me)=>m._(this,void 0,void 0,function*(){this._getDEMWorkerSource(pe,me.source).removeTile(me)})),this.actor.registerMessageHandler("GCEZ",(pe,me)=>m._(this,void 0,void 0,function*(){return this._getWorkerSource(pe,me.type,me.source).getClusterExpansionZoom(me)})),this.actor.registerMessageHandler("GCC",(pe,me)=>m._(this,void 0,void 0,function*(){return this._getWorkerSource(pe,me.type,me.source).getClusterChildren(me)})),this.actor.registerMessageHandler("GCL",(pe,me)=>m._(this,void 0,void 0,function*(){return this._getWorkerSource(pe,me.type,me.source).getClusterLeaves(me)})),this.actor.registerMessageHandler("LD",(pe,me)=>this._getWorkerSource(pe,me.type,me.source).loadData(me)),this.actor.registerMessageHandler("GD",(pe,me)=>this._getWorkerSource(pe,me.type,me.source).getData()),this.actor.registerMessageHandler("LT",(pe,me)=>this._getWorkerSource(pe,me.type,me.source).loadTile(me)),this.actor.registerMessageHandler("RT",(pe,me)=>this._getWorkerSource(pe,me.type,me.source).reloadTile(me)),this.actor.registerMessageHandler("AT",(pe,me)=>this._getWorkerSource(pe,me.type,me.source).abortTile(me)),this.actor.registerMessageHandler("RMT",(pe,me)=>this._getWorkerSource(pe,me.type,me.source).removeTile(me)),this.actor.registerMessageHandler("RS",(pe,me)=>m._(this,void 0,void 0,function*(){if(!this.workerSources[pe]||!this.workerSources[pe][me.type]||!this.workerSources[pe][me.type][me.source])return;const Le=this.workerSources[pe][me.type][me.source];delete this.workerSources[pe][me.type][me.source],Le.removeSource!==void 0&&Le.removeSource(me)})),this.actor.registerMessageHandler("RM",pe=>m._(this,void 0,void 0,function*(){delete this.layerIndexes[pe],delete this.availableImages[pe],delete this.workerSources[pe],delete this.demWorkerSources[pe]})),this.actor.registerMessageHandler("SR",(pe,me)=>m._(this,void 0,void 0,function*(){this.referrer=me})),this.actor.registerMessageHandler("SRPS",(pe,me)=>this._syncRTLPluginState(pe,me)),this.actor.registerMessageHandler("IS",(pe,me)=>m._(this,void 0,void 0,function*(){this.self.importScripts(me)})),this.actor.registerMessageHandler("SI",(pe,me)=>this._setImages(pe,me)),this.actor.registerMessageHandler("UL",(pe,me)=>m._(this,void 0,void 0,function*(){this._getLayerIndex(pe).update(me.layers,me.removedIds)})),this.actor.registerMessageHandler("SL",(pe,me)=>m._(this,void 0,void 0,function*(){this._getLayerIndex(pe).replace(me)}))}_setImages(le,pe){return m._(this,void 0,void 0,function*(){this.availableImages[le]=pe;for(const me in this.workerSources[le]){const Le=this.workerSources[le][me];for(const Ze in Le)Le[Ze].availableImages=pe}})}_syncRTLPluginState(le,pe){return m._(this,void 0,void 0,function*(){return yield m.cU.syncState(pe,this.self.importScripts)})}_getAvailableImages(le){let pe=this.availableImages[le];return pe||(pe=[]),pe}_getLayerIndex(le){let pe=this.layerIndexes[le];return pe||(pe=this.layerIndexes[le]=new o),pe}_getWorkerSource(le,pe,me){if(this.workerSources[le]||(this.workerSources[le]={}),this.workerSources[le][pe]||(this.workerSources[le][pe]={}),!this.workerSources[le][pe][me]){const Le={sendAsync:(Ze,Je)=>(Ze.targetMapId=le,this.actor.sendAsync(Ze,Je))};switch(pe){case"vector":this.workerSources[le][pe][me]=new F(Le,this._getLayerIndex(le),this._getAvailableImages(le));break;case"geojson":this.workerSources[le][pe][me]=new Bi(Le,this._getLayerIndex(le),this._getAvailableImages(le));break;default:this.workerSources[le][pe][me]=new this.externalWorkerSourceTypes[pe](Le,this._getLayerIndex(le),this._getAvailableImages(le))}}return this.workerSources[le][pe][me]}_getDEMWorkerSource(le,pe){return this.demWorkerSources[le]||(this.demWorkerSources[le]={}),this.demWorkerSources[le][pe]||(this.demWorkerSources[le][pe]=new Y),this.demWorkerSources[le][pe]}}return m.i(self)&&(self.worker=new Ii(self)),Ii}),h("index",["exports","./shared"],function(m,o){var P="5.6.1";function L(){var b=new o.A(4);return o.A!=Float32Array&&(b[1]=0,b[2]=0),b[0]=1,b[3]=1,b}let D,F;const Y={now:typeof performance<"u"&&performance&&performance.now?performance.now.bind(performance):Date.now.bind(Date),frame(b,t,l){const f=requestAnimationFrame(w=>{g(),t(w)}),{unsubscribe:g}=o.s(b.signal,"abort",()=>{g(),cancelAnimationFrame(f),l(o.c())},!1)},frameAsync(b){return new Promise((t,l)=>{this.frame(b,t,l)})},getImageData(b,t=0){return this.getImageCanvasContext(b).getImageData(-t,-t,b.width+2*t,b.height+2*t)},getImageCanvasContext(b){const t=window.document.createElement("canvas"),l=t.getContext("2d",{willReadFrequently:!0});if(!l)throw new Error("failed to create canvas 2d context");return t.width=b.width,t.height=b.height,l.drawImage(b,0,0,b.width,b.height),l},resolveURL:b=>(D||(D=document.createElement("a")),D.href=b,D.href),hardwareConcurrency:typeof navigator<"u"&&navigator.hardwareConcurrency||4,get prefersReducedMotion(){return!!matchMedia&&(F==null&&(F=matchMedia("(prefers-reduced-motion: reduce)")),F.matches)}};class V{static testProp(t){if(!V.docStyle)return t[0];for(let l=0;l<t.length;l++)if(t[l]in V.docStyle)return t[l];return t[0]}static create(t,l,f){const g=window.document.createElement(t);return l!==void 0&&(g.className=l),f&&f.appendChild(g),g}static createNS(t,l){return window.document.createElementNS(t,l)}static disableDrag(){V.docStyle&&V.selectProp&&(V.userSelect=V.docStyle[V.selectProp],V.docStyle[V.selectProp]="none")}static enableDrag(){V.docStyle&&V.selectProp&&(V.docStyle[V.selectProp]=V.userSelect)}static setTransform(t,l){t.style[V.transformProp]=l}static addEventListener(t,l,f,g={}){t.addEventListener(l,f,"passive"in g?g:g.capture)}static removeEventListener(t,l,f,g={}){t.removeEventListener(l,f,"passive"in g?g:g.capture)}static suppressClickInternal(t){t.preventDefault(),t.stopPropagation(),window.removeEventListener("click",V.suppressClickInternal,!0)}static suppressClick(){window.addEventListener("click",V.suppressClickInternal,!0),window.setTimeout(()=>{window.removeEventListener("click",V.suppressClickInternal,!0)},0)}static getScale(t){const l=t.getBoundingClientRect();return{x:l.width/t.offsetWidth||1,y:l.height/t.offsetHeight||1,boundingClientRect:l}}static getPoint(t,l,f){const g=l.boundingClientRect;return new o.P((f.clientX-g.left)/l.x-t.clientLeft,(f.clientY-g.top)/l.y-t.clientTop)}static mousePos(t,l){const f=V.getScale(t);return V.getPoint(t,f,l)}static touchPos(t,l){const f=[],g=V.getScale(t);for(let w=0;w<l.length;w++)f.push(V.getPoint(t,g,l[w]));return f}static mouseButton(t){return t.button}static remove(t){t.parentNode&&t.parentNode.removeChild(t)}static sanitize(t){const l=new DOMParser().parseFromString(t,"text/html").body||document.createElement("body"),f=l.querySelectorAll("script");for(const g of f)g.remove();return V.clean(l),l.innerHTML}static isPossiblyDangerous(t,l){const f=l.replace(/\s+/g,"").toLowerCase();return!(!["src","href","xlink:href"].includes(t)||!f.includes("javascript:")&&!f.includes("data:"))||!!t.startsWith("on")||void 0}static clean(t){const l=t.children;for(const f of l)V.removeAttributes(f),V.clean(f)}static removeAttributes(t){for(const{name:l,value:f}of t.attributes)V.isPossiblyDangerous(l,f)&&t.removeAttribute(l)}}V.docStyle=typeof window<"u"&&window.document&&window.document.documentElement.style,V.selectProp=V.testProp(["userSelect","MozUserSelect","WebkitUserSelect","msUserSelect"]),V.transformProp=V.testProp(["transform","WebkitTransform"]);const H={supported:!1,testSupport:function(b){!oe&&_e&&(fe?K(b):ve=b)}};let ve,_e,oe=!1,fe=!1;function K(b){const t=b.createTexture();b.bindTexture(b.TEXTURE_2D,t);try{if(b.texImage2D(b.TEXTURE_2D,0,b.RGBA,b.RGBA,b.UNSIGNED_BYTE,_e),b.isContextLost())return;H.supported=!0}catch{}b.deleteTexture(t),oe=!0}var ne;typeof document<"u"&&(_e=document.createElement("img"),_e.onload=()=>{ve&&K(ve),ve=null,fe=!0},_e.onerror=()=>{oe=!0,ve=null},_e.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA="),function(b){let t,l,f,g;b.resetRequestQueue=()=>{t=[],l=0,f=0,g={}},b.addThrottleControl=R=>{const z=f++;return g[z]=R,z},b.removeThrottleControl=R=>{delete g[R],I()},b.getImage=(R,z,G=!0)=>new Promise((X,W)=>{H.supported&&(R.headers||(R.headers={}),R.headers.accept="image/webp,*/*"),o.e(R,{type:"image"}),t.push({abortController:z,requestParameters:R,supportImageRefresh:G,state:"queued",onError:te=>{W(te)},onSuccess:te=>{X(te)}}),I()});const w=R=>o._(this,void 0,void 0,function*(){R.state="running";const{requestParameters:z,supportImageRefresh:G,onError:X,onSuccess:W,abortController:te}=R,ae=G===!1&&!o.i(self)&&!o.g(z.url)&&(!z.headers||Object.keys(z.headers).reduce((Ee,Ce)=>Ee&&Ce==="accept",!0));l++;const Te=ae?k(z,te):o.m(z,te);try{const Ee=yield Te;delete R.abortController,R.state="completed",Ee.data instanceof HTMLImageElement||o.b(Ee.data)?W(Ee):Ee.data&&W({data:yield(we=Ee.data,typeof createImageBitmap=="function"?o.f(we):o.h(we)),cacheControl:Ee.cacheControl,expires:Ee.expires})}catch(Ee){delete R.abortController,X(Ee)}finally{l--,I()}var we}),I=()=>{const R=(()=>{for(const z of Object.keys(g))if(g[z]())return!0;return!1})()?o.a.MAX_PARALLEL_IMAGE_REQUESTS_PER_FRAME:o.a.MAX_PARALLEL_IMAGE_REQUESTS;for(let z=l;z<R&&t.length>0;z++){const G=t.shift();G.abortController.signal.aborted?z--:w(G)}},k=(R,z)=>new Promise((G,X)=>{const W=new Image,te=R.url,ae=R.credentials;ae&&ae==="include"?W.crossOrigin="use-credentials":(ae&&ae==="same-origin"||!o.d(te))&&(W.crossOrigin="anonymous"),z.signal.addEventListener("abort",()=>{W.src="",X(o.c())}),W.fetchPriority="high",W.onload=()=>{W.onerror=W.onload=null,G({data:W})},W.onerror=()=>{W.onerror=W.onload=null,z.signal.aborted||X(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."))},W.src=te})}(ne||(ne={})),ne.resetRequestQueue();class ye{constructor(t){this._transformRequestFn=t}transformRequest(t,l){return this._transformRequestFn&&this._transformRequestFn(t,l)||{url:t}}setTransformRequest(t){this._transformRequestFn=t}}function Re(b){const t=[];if(typeof b=="string")t.push({id:"default",url:b});else if(b&&b.length>0){const l=[];for(const{id:f,url:g}of b){const w=`${f}${g}`;l.indexOf(w)===-1&&(l.push(w),t.push({id:f,url:g}))}}return t}function Se(b,t,l){try{const f=new URL(b);return f.pathname+=`${t}${l}`,f.toString()}catch{throw new Error(`Invalid sprite URL "${b}", must be absolute. Modify style specification directly or use TransformStyleFunction to correct the issue dynamically`)}}function Z(b){const{userImage:t}=b;return!!(t&&t.render&&t.render())&&(b.data.replace(new Uint8Array(t.data.buffer)),!0)}class $ extends o.E{constructor(){super(),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded=!1,this.requestors=[],this.patterns={},this.atlasImage=new o.R({width:1,height:1}),this.dirty=!0}isLoaded(){return this.loaded}setLoaded(t){if(this.loaded!==t&&(this.loaded=t,t)){for(const{ids:l,promiseResolve:f}of this.requestors)f(this._getImagesForIds(l));this.requestors=[]}}getImage(t){const l=this.images[t];if(l&&!l.data&&l.spriteData){const f=l.spriteData;l.data=new o.R({width:f.width,height:f.height},f.context.getImageData(f.x,f.y,f.width,f.height).data),l.spriteData=null}return l}addImage(t,l){if(this.images[t])throw new Error(`Image id ${t} already exist, use updateImage instead`);this._validate(t,l)&&(this.images[t]=l)}_validate(t,l){let f=!0;const g=l.data||l.spriteData;return this._validateStretch(l.stretchX,g&&g.width)||(this.fire(new o.k(new Error(`Image "${t}" has invalid "stretchX" value`))),f=!1),this._validateStretch(l.stretchY,g&&g.height)||(this.fire(new o.k(new Error(`Image "${t}" has invalid "stretchY" value`))),f=!1),this._validateContent(l.content,l)||(this.fire(new o.k(new Error(`Image "${t}" has invalid "content" value`))),f=!1),f}_validateStretch(t,l){if(!t)return!0;let f=0;for(const g of t){if(g[0]<f||g[1]<g[0]||l<g[1])return!1;f=g[1]}return!0}_validateContent(t,l){if(!t)return!0;if(t.length!==4)return!1;const f=l.spriteData,g=f&&f.width||l.data.width,w=f&&f.height||l.data.height;return!(t[0]<0||g<t[0]||t[1]<0||w<t[1]||t[2]<0||g<t[2]||t[3]<0||w<t[3]||t[2]<t[0]||t[3]<t[1])}updateImage(t,l,f=!0){const g=this.getImage(t);if(f&&(g.data.width!==l.data.width||g.data.height!==l.data.height))throw new Error(`size mismatch between old image (${g.data.width}x${g.data.height}) and new image (${l.data.width}x${l.data.height}).`);l.version=g.version+1,this.images[t]=l,this.updatedImages[t]=!0}removeImage(t){const l=this.images[t];delete this.images[t],delete this.patterns[t],l.userImage&&l.userImage.onRemove&&l.userImage.onRemove()}listImages(){return Object.keys(this.images)}getImages(t){return new Promise((l,f)=>{let g=!0;if(!this.isLoaded())for(const w of t)this.images[w]||(g=!1);this.isLoaded()||g?l(this._getImagesForIds(t)):this.requestors.push({ids:t,promiseResolve:l})})}_getImagesForIds(t){const l={};for(const f of t){let g=this.getImage(f);g||(this.fire(new o.l("styleimagemissing",{id:f})),g=this.getImage(f)),g?l[f]={data:g.data.clone(),pixelRatio:g.pixelRatio,sdf:g.sdf,version:g.version,stretchX:g.stretchX,stretchY:g.stretchY,content:g.content,textFitWidth:g.textFitWidth,textFitHeight:g.textFitHeight,hasRenderCallback:!!(g.userImage&&g.userImage.render)}:o.w(`Image "${f}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`)}return l}getPixelSize(){const{width:t,height:l}=this.atlasImage;return{width:t,height:l}}getPattern(t){const l=this.patterns[t],f=this.getImage(t);if(!f)return null;if(l&&l.position.version===f.version)return l.position;if(l)l.position.version=f.version;else{const g={w:f.data.width+2,h:f.data.height+2,x:0,y:0},w=new o.I(g,f);this.patterns[t]={bin:g,position:w}}return this._updatePatternAtlas(),this.patterns[t].position}bind(t){const l=t.gl;this.atlasTexture?this.dirty&&(this.atlasTexture.update(this.atlasImage),this.dirty=!1):this.atlasTexture=new o.T(t,this.atlasImage,l.RGBA),this.atlasTexture.bind(l.LINEAR,l.CLAMP_TO_EDGE)}_updatePatternAtlas(){const t=[];for(const w in this.patterns)t.push(this.patterns[w].bin);const{w:l,h:f}=o.p(t),g=this.atlasImage;g.resize({width:l||1,height:f||1});for(const w in this.patterns){const{bin:I}=this.patterns[w],k=I.x+1,R=I.y+1,z=this.getImage(w).data,G=z.width,X=z.height;o.R.copy(z,g,{x:0,y:0},{x:k,y:R},{width:G,height:X}),o.R.copy(z,g,{x:0,y:X-1},{x:k,y:R-1},{width:G,height:1}),o.R.copy(z,g,{x:0,y:0},{x:k,y:R+X},{width:G,height:1}),o.R.copy(z,g,{x:G-1,y:0},{x:k-1,y:R},{width:1,height:X}),o.R.copy(z,g,{x:0,y:0},{x:k+G,y:R},{width:1,height:X})}this.dirty=!0}beginFrame(){this.callbackDispatchedThisFrame={}}dispatchRenderCallbacks(t){for(const l of t){if(this.callbackDispatchedThisFrame[l])continue;this.callbackDispatchedThisFrame[l]=!0;const f=this.getImage(l);f||o.w(`Image with ID: "${l}" was not found`),Z(f)&&this.updateImage(l,f)}}}const Q=1e20;function ue(b,t,l,f,g,w,I,k,R){for(let z=t;z<t+f;z++)he(b,l*w+z,w,g,I,k,R);for(let z=l;z<l+g;z++)he(b,z*w+t,1,f,I,k,R)}function he(b,t,l,f,g,w,I){w[0]=0,I[0]=-Q,I[1]=Q,g[0]=b[t];for(let k=1,R=0,z=0;k<f;k++){g[k]=b[t+k*l];const G=k*k;do{const X=w[R];z=(g[k]-g[X]+G-X*X)/(k-X)/2}while(z<=I[R]&&--R>-1);R++,w[R]=k,I[R]=z,I[R+1]=Q}for(let k=0,R=0;k<f;k++){for(;I[R+1]<k;)R++;const z=w[R],G=k-z;b[t+k*l]=g[z]+G*G}}class Pe{constructor(t,l){this.requestManager=t,this.localIdeographFontFamily=l,this.entries={}}setURL(t){this.url=t}getGlyphs(t){return o._(this,void 0,void 0,function*(){const l=[];for(const w in t)for(const I of t[w])l.push(this._getAndCacheGlyphsPromise(w,I));const f=yield Promise.all(l),g={};for(const{stack:w,id:I,glyph:k}of f)g[w]||(g[w]={}),g[w][I]=k&&{id:k.id,bitmap:k.bitmap.clone(),metrics:k.metrics};return g})}_getAndCacheGlyphsPromise(t,l){return o._(this,void 0,void 0,function*(){let f=this.entries[t];f||(f=this.entries[t]={glyphs:{},requests:{},ranges:{}});let g=f.glyphs[l];if(g!==void 0)return{stack:t,id:l,glyph:g};if(g=this._tinySDF(f,t,l),g)return f.glyphs[l]=g,{stack:t,id:l,glyph:g};const w=Math.floor(l/256);if(256*w>65535)throw new Error("glyphs > 65535 not supported");if(f.ranges[w])return{stack:t,id:l,glyph:g};if(!this.url)throw new Error("glyphsUrl is not set");if(!f.requests[w]){const k=Pe.loadGlyphRange(t,w,this.url,this.requestManager);f.requests[w]=k}const I=yield f.requests[w];for(const k in I)this._doesCharSupportLocalGlyph(+k)||(f.glyphs[+k]=I[+k]);return f.ranges[w]=!0,{stack:t,id:l,glyph:I[l]||null}})}_doesCharSupportLocalGlyph(t){return!!this.localIdeographFontFamily&&(new RegExp("\\p{Ideo}|\\p{sc=Hang}|\\p{sc=Hira}|\\p{sc=Kana}","u").test(String.fromCodePoint(t))||o.u["CJK Unified Ideographs"](t)||o.u["Hangul Syllables"](t)||o.u.Hiragana(t)||o.u.Katakana(t)||o.u["CJK Symbols and Punctuation"](t)||o.u["Halfwidth and Fullwidth Forms"](t))}_tinySDF(t,l,f){const g=this.localIdeographFontFamily;if(!g||!this._doesCharSupportLocalGlyph(f))return;let w=t.tinySDF;if(!w){let k="400";/bold/i.test(l)?k="900":/medium/i.test(l)?k="500":/light/i.test(l)&&(k="200"),w=t.tinySDF=new Pe.TinySDF({fontSize:48,buffer:6,radius:16,cutoff:.25,fontFamily:g,fontWeight:k})}const I=w.draw(String.fromCharCode(f));return{id:f,bitmap:new o.q({width:I.width||60,height:I.height||60},I.data),metrics:{width:I.glyphWidth/2||24,height:I.glyphHeight/2||24,left:I.glyphLeft/2+.5||0,top:I.glyphTop/2-27.5||-8,advance:I.glyphAdvance/2||24,isDoubleResolution:!0}}}}Pe.loadGlyphRange=function(b,t,l,f){return o._(this,void 0,void 0,function*(){const g=256*t,w=g+255,I=f.transformRequest(l.replace("{fontstack}",b).replace("{range}",`${g}-${w}`),"Glyphs"),k=yield o.n(I,new AbortController);if(!k||!k.data)throw new Error(`Could not load glyph range. range: ${t}, ${g}-${w}`);const R={};for(const z of o.o(k.data))R[z.id]=z;return R})},Pe.TinySDF=class{constructor({fontSize:b=24,buffer:t=3,radius:l=8,cutoff:f=.25,fontFamily:g="sans-serif",fontWeight:w="normal",fontStyle:I="normal"}={}){this.buffer=t,this.cutoff=f,this.radius=l;const k=this.size=b+4*t,R=this._createCanvas(k),z=this.ctx=R.getContext("2d",{willReadFrequently:!0});z.font=`${I} ${w} ${b}px ${g}`,z.textBaseline="alphabetic",z.textAlign="left",z.fillStyle="black",this.gridOuter=new Float64Array(k*k),this.gridInner=new Float64Array(k*k),this.f=new Float64Array(k),this.z=new Float64Array(k+1),this.v=new Uint16Array(k)}_createCanvas(b){const t=document.createElement("canvas");return t.width=t.height=b,t}draw(b){const{width:t,actualBoundingBoxAscent:l,actualBoundingBoxDescent:f,actualBoundingBoxLeft:g,actualBoundingBoxRight:w}=this.ctx.measureText(b),I=Math.ceil(l),k=Math.max(0,Math.min(this.size-this.buffer,Math.ceil(w-g))),R=Math.min(this.size-this.buffer,I+Math.ceil(f)),z=k+2*this.buffer,G=R+2*this.buffer,X=Math.max(z*G,0),W=new Uint8ClampedArray(X),te={data:W,width:z,height:G,glyphWidth:k,glyphHeight:R,glyphTop:I,glyphLeft:0,glyphAdvance:t};if(k===0||R===0)return te;const{ctx:ae,buffer:Te,gridInner:we,gridOuter:Ee}=this;ae.clearRect(Te,Te,k,R),ae.fillText(b,Te,Te+I);const Ce=ae.getImageData(Te,Te,k,R);Ee.fill(Q,0,X),we.fill(0,0,X);for(let Fe=0;Fe<R;Fe++)for(let Oe=0;Oe<k;Oe++){const Ue=Ce.data[4*(Fe*k+Oe)+3]/255;if(Ue===0)continue;const We=(Fe+Te)*z+Oe+Te;if(Ue===1)Ee[We]=0,we[We]=Q;else{const De=.5-Ue;Ee[We]=De>0?De*De:0,we[We]=De<0?De*De:0}}ue(Ee,0,0,z,G,z,this.f,this.v,this.z),ue(we,Te,Te,k,R,z,this.f,this.v,this.z);for(let Fe=0;Fe<X;Fe++){const Oe=Math.sqrt(Ee[Fe])-Math.sqrt(we[Fe]);W[Fe]=Math.round(255-255*(Oe/this.radius+this.cutoff))}return te}};class Ae{constructor(){this.specification=o.v.light.position}possiblyEvaluate(t,l){return o.B(t.expression.evaluate(l))}interpolate(t,l,f){return{x:o.C.number(t.x,l.x,f),y:o.C.number(t.y,l.y,f),z:o.C.number(t.z,l.z,f)}}}let ke;class Be extends o.E{constructor(t){super(),ke=ke||new o.r({anchor:new o.D(o.v.light.anchor),position:new Ae,color:new o.D(o.v.light.color),intensity:new o.D(o.v.light.intensity)}),this._transitionable=new o.t(ke),this.setLight(t),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(t,l={}){if(!this._validate(o.x,t,l))for(const f in t){const g=t[f];f.endsWith("-transition")?this._transitionable.setTransition(f.slice(0,-11),g):this._transitionable.setValue(f,g)}}updateTransitions(t){this._transitioning=this._transitionable.transitioned(t,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(t){this.properties=this._transitioning.possiblyEvaluate(t)}_validate(t,l,f){return(!f||f.validate!==!1)&&o.y(this,t.call(o.z,{value:l,style:{glyphs:!0,sprite:!0},styleSpec:o.v}))}}const Ke=new o.r({"sky-color":new o.D(o.v.sky["sky-color"]),"horizon-color":new o.D(o.v.sky["horizon-color"]),"fog-color":new o.D(o.v.sky["fog-color"]),"fog-ground-blend":new o.D(o.v.sky["fog-ground-blend"]),"horizon-fog-blend":new o.D(o.v.sky["horizon-fog-blend"]),"sky-horizon-blend":new o.D(o.v.sky["sky-horizon-blend"]),"atmosphere-blend":new o.D(o.v.sky["atmosphere-blend"])});class tt extends o.E{constructor(t){super(),this._transitionable=new o.t(Ke),this.setSky(t),this._transitioning=this._transitionable.untransitioned(),this.recalculate(new o.F(0))}setSky(t,l={}){if(!this._validate(o.G,t,l)){t||(t={"sky-color":"transparent","horizon-color":"transparent","fog-color":"transparent","fog-ground-blend":1,"atmosphere-blend":0});for(const f in t){const g=t[f];f.endsWith("-transition")?this._transitionable.setTransition(f.slice(0,-11),g):this._transitionable.setValue(f,g)}}}getSky(){return this._transitionable.serialize()}updateTransitions(t){this._transitioning=this._transitionable.transitioned(t,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(t){this.properties=this._transitioning.possiblyEvaluate(t)}_validate(t,l,f={}){return f?.validate!==!1&&o.y(this,t.call(o.z,o.e({value:l,style:{glyphs:!0,sprite:!0},styleSpec:o.v})))}calculateFogBlendOpacity(t){return t<60?0:t<70?(t-60)/10:1}}class pt{constructor(t,l){this.width=t,this.height=l,this.nextRow=0,this.data=new Uint8Array(this.width*this.height),this.dashEntry={}}getDash(t,l){const f=t.join(",")+String(l);return this.dashEntry[f]||(this.dashEntry[f]=this.addDash(t,l)),this.dashEntry[f]}getDashRanges(t,l,f){const g=[];let w=t.length%2==1?-t[t.length-1]*f:0,I=t[0]*f,k=!0;g.push({left:w,right:I,isDash:k,zeroLength:t[0]===0});let R=t[0];for(let z=1;z<t.length;z++){k=!k;const G=t[z];w=R*f,R+=G,I=R*f,g.push({left:w,right:I,isDash:k,zeroLength:G===0})}return g}addRoundDash(t,l,f){const g=l/2;for(let w=-f;w<=f;w++){const I=this.width*(this.nextRow+f+w);let k=0,R=t[k];for(let z=0;z<this.width;z++){z/R.right>1&&(R=t[++k]);const G=Math.abs(z-R.left),X=Math.abs(z-R.right),W=Math.min(G,X);let te;const ae=w/f*(g+1);if(R.isDash){const Te=g-Math.abs(ae);te=Math.sqrt(W*W+Te*Te)}else te=g-Math.sqrt(W*W+ae*ae);this.data[I+z]=Math.max(0,Math.min(255,te+128))}}}addRegularDash(t){for(let k=t.length-1;k>=0;--k){const R=t[k],z=t[k+1];R.zeroLength?t.splice(k,1):z&&z.isDash===R.isDash&&(z.left=R.left,t.splice(k,1))}const l=t[0],f=t[t.length-1];l.isDash===f.isDash&&(l.left=f.left-this.width,f.right=l.right+this.width);const g=this.width*this.nextRow;let w=0,I=t[w];for(let k=0;k<this.width;k++){k/I.right>1&&(I=t[++w]);const R=Math.abs(k-I.left),z=Math.abs(k-I.right),G=Math.min(R,z);this.data[g+k]=Math.max(0,Math.min(255,(I.isDash?G:-G)+128))}}addDash(t,l){const f=l?7:0,g=2*f+1;if(this.nextRow+g>this.height)return o.w("LineAtlas out of space"),null;let w=0;for(let k=0;k<t.length;k++)w+=t[k];if(w!==0){const k=this.width/w,R=this.getDashRanges(t,this.width,k);l?this.addRoundDash(R,k,f):this.addRegularDash(R)}const I={y:(this.nextRow+f+.5)/this.height,height:2*f/this.height,width:w};return this.nextRow+=g,this.dirty=!0,I}bind(t){const l=t.gl;this.texture?(l.bindTexture(l.TEXTURE_2D,this.texture),this.dirty&&(this.dirty=!1,l.texSubImage2D(l.TEXTURE_2D,0,0,0,this.width,this.height,l.ALPHA,l.UNSIGNED_BYTE,this.data))):(this.texture=l.createTexture(),l.bindTexture(l.TEXTURE_2D,this.texture),l.texParameteri(l.TEXTURE_2D,l.TEXTURE_WRAP_S,l.REPEAT),l.texParameteri(l.TEXTURE_2D,l.TEXTURE_WRAP_T,l.REPEAT),l.texParameteri(l.TEXTURE_2D,l.TEXTURE_MIN_FILTER,l.LINEAR),l.texParameteri(l.TEXTURE_2D,l.TEXTURE_MAG_FILTER,l.LINEAR),l.texImage2D(l.TEXTURE_2D,0,l.ALPHA,this.width,this.height,0,l.ALPHA,l.UNSIGNED_BYTE,this.data))}}const vt="maplibre_preloaded_worker_pool";class Ft{constructor(){this.active={}}acquire(t){if(!this.workers)for(this.workers=[];this.workers.length<Ft.workerCount;)this.workers.push(new Worker(o.a.WORKER_URL));return this.active[t]=!0,this.workers.slice()}release(t){delete this.active[t],this.numActive()===0&&(this.workers.forEach(l=>{l.terminate()}),this.workers=null)}isPreloaded(){return!!this.active[vt]}numActive(){return Object.keys(this.active).length}}const It=Math.floor(Y.hardwareConcurrency/2);let Zt,zt;function ti(){return Zt||(Zt=new Ft),Zt}Ft.workerCount=o.H(globalThis)?Math.max(Math.min(It,3),1):1;class ai{constructor(t,l){this.workerPool=t,this.actors=[],this.currentActor=0,this.id=l;const f=this.workerPool.acquire(l);for(let g=0;g<f.length;g++){const w=new o.J(f[g],l);w.name=`Worker ${g}`,this.actors.push(w)}if(!this.actors.length)throw new Error("No actors found")}broadcast(t,l){const f=[];for(const g of this.actors)f.push(g.sendAsync({type:t,data:l}));return Promise.all(f)}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(t=!0){this.actors.forEach(l=>{l.remove()}),this.actors=[],t&&this.workerPool.release(this.id)}registerMessageHandler(t,l){for(const f of this.actors)f.registerMessageHandler(t,l)}}function Ir(){return zt||(zt=new ai(ti(),o.K),zt.registerMessageHandler("GR",(b,t,l)=>o.m(t,l))),zt}function lt(b,t){const l=o.L();return o.M(l,l,[1,1,0]),o.N(l,l,[.5*b.width,.5*b.height,1]),b.calculatePosMatrix?o.O(l,l,b.calculatePosMatrix(t.toUnwrapped())):l}function Xi(b,t,l,f,g,w,I){var k;const R=function(W,te,ae){if(W)for(const Te of W){const we=te[Te];if(we&&we.source===ae&&we.type==="fill-extrusion")return!0}else for(const Te in te){const we=te[Te];if(we.source===ae&&we.type==="fill-extrusion")return!0}return!1}((k=g?.layers)!==null&&k!==void 0?k:null,t,b.id),z=w.maxPitchScaleFactor(),G=b.tilesIn(f,z,R);G.sort(ii);const X=[];for(const W of G)X.push({wrappedTileID:W.tileID.wrapped().key,queryResults:W.tile.queryRenderedFeatures(t,l,b._state,W.queryGeometry,W.cameraQueryGeometry,W.scale,g,w,z,lt(b.transform,W.tileID),I?(te,ae)=>I(W.tileID,te,ae):void 0)});return function(W,te){for(const ae in W)for(const Te of W[ae])Jt(Te,te);return W}(function(W){const te={},ae={};for(const Te of W){const we=Te.queryResults,Ee=Te.wrappedTileID,Ce=ae[Ee]=ae[Ee]||{};for(const Fe in we){const Oe=we[Fe],Ue=Ce[Fe]=Ce[Fe]||{},We=te[Fe]=te[Fe]||[];for(const De of Oe)Ue[De.featureIndex]||(Ue[De.featureIndex]=!0,We.push(De))}}return te}(X),b)}function ii(b,t){const l=b.tileID,f=t.tileID;return l.overscaledZ-f.overscaledZ||l.canonical.y-f.canonical.y||l.wrap-f.wrap||l.canonical.x-f.canonical.x}function Jt(b,t){const l=b.feature,f=t.getFeatureState(l.layer["source-layer"],l.id);l.source=l.layer.source,l.layer["source-layer"]&&(l.sourceLayer=l.layer["source-layer"]),l.state=f}function $e(b,t,l){return o._(this,void 0,void 0,function*(){let f=b;if(b.url?f=(yield o.j(t.transformRequest(b.url,"Source"),l)).data:yield Y.frameAsync(l),!f)return null;const g=o.Q(o.e(f,b),["tiles","minzoom","maxzoom","attribution","bounds","scheme","tileSize","encoding"]);return"vector_layers"in f&&f.vector_layers&&(g.vectorLayerIds=f.vector_layers.map(w=>w.id)),g})}class zi{constructor(t,l){t&&(l?this.setSouthWest(t).setNorthEast(l):Array.isArray(t)&&(t.length===4?this.setSouthWest([t[0],t[1]]).setNorthEast([t[2],t[3]]):this.setSouthWest(t[0]).setNorthEast(t[1])))}setNorthEast(t){return this._ne=t instanceof o.S?new o.S(t.lng,t.lat):o.S.convert(t),this}setSouthWest(t){return this._sw=t instanceof o.S?new o.S(t.lng,t.lat):o.S.convert(t),this}extend(t){const l=this._sw,f=this._ne;let g,w;if(t instanceof o.S)g=t,w=t;else{if(!(t instanceof zi))return Array.isArray(t)?t.length===4||t.every(Array.isArray)?this.extend(zi.convert(t)):this.extend(o.S.convert(t)):t&&("lng"in t||"lon"in t)&&"lat"in t?this.extend(o.S.convert(t)):this;if(g=t._sw,w=t._ne,!g||!w)return this}return l||f?(l.lng=Math.min(g.lng,l.lng),l.lat=Math.min(g.lat,l.lat),f.lng=Math.max(w.lng,f.lng),f.lat=Math.max(w.lat,f.lat)):(this._sw=new o.S(g.lng,g.lat),this._ne=new o.S(w.lng,w.lat)),this}getCenter(){return new o.S((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new o.S(this.getWest(),this.getNorth())}getSouthEast(){return new o.S(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(t){const{lng:l,lat:f}=o.S.convert(t);let g=this._sw.lng<=l&&l<=this._ne.lng;return this._sw.lng>this._ne.lng&&(g=this._sw.lng>=l&&l>=this._ne.lng),this._sw.lat<=f&&f<=this._ne.lat&&g}static convert(t){return t instanceof zi?t:t&&new zi(t)}static fromLngLat(t,l=0){const f=360*l/40075017,g=f/Math.cos(Math.PI/180*t.lat);return new zi(new o.S(t.lng-g,t.lat-f),new o.S(t.lng+g,t.lat+f))}adjustAntiMeridian(){const t=new o.S(this._sw.lng,this._sw.lat),l=new o.S(this._ne.lng,this._ne.lat);return new zi(t,t.lng>l.lng?new o.S(l.lng+360,l.lat):l)}}class Qi{constructor(t,l,f){this.bounds=zi.convert(this.validateBounds(t)),this.minzoom=l||0,this.maxzoom=f||24}validateBounds(t){return Array.isArray(t)&&t.length===4?[Math.max(-180,t[0]),Math.max(-90,t[1]),Math.min(180,t[2]),Math.min(90,t[3])]:[-180,-90,180,90]}contains(t){const l=Math.pow(2,t.z),f=Math.floor(o.V(this.bounds.getWest())*l),g=Math.floor(o.U(this.bounds.getNorth())*l),w=Math.ceil(o.V(this.bounds.getEast())*l),I=Math.ceil(o.U(this.bounds.getSouth())*l);return t.x>=f&&t.x<w&&t.y>=g&&t.y<I}}class Gi extends o.E{constructor(t,l,f,g){if(super(),this.id=t,this.dispatcher=f,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,o.e(this,o.Q(l,["url","scheme","tileSize","promoteId"])),this._options=o.e({type:"vector"},l),this._collectResourceTiming=l.collectResourceTiming,this.tileSize!==512)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(g)}load(){return o._(this,void 0,void 0,function*(){this._loaded=!1,this.fire(new o.l("dataloading",{dataType:"source"})),this._tileJSONRequest=new AbortController;try{const t=yield $e(this._options,this.map._requestManager,this._tileJSONRequest);this._tileJSONRequest=null,this._loaded=!0,this.map.style.sourceCaches[this.id].clearTiles(),t&&(o.e(this,t),t.bounds&&(this.tileBounds=new Qi(t.bounds,this.minzoom,this.maxzoom)),this.fire(new o.l("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new o.l("data",{dataType:"source",sourceDataType:"content"})))}catch(t){this._tileJSONRequest=null,this.fire(new o.k(t))}})}loaded(){return this._loaded}hasTile(t){return!this.tileBounds||this.tileBounds.contains(t.canonical)}onAdd(t){this.map=t,this.load()}setSourceProperty(t){this._tileJSONRequest&&this._tileJSONRequest.abort(),t(),this.load()}setTiles(t){return this.setSourceProperty(()=>{this._options.tiles=t}),this}setUrl(t){return this.setSourceProperty(()=>{this.url=t,this._options.url=t}),this}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null)}serialize(){return o.e({},this._options)}loadTile(t){return o._(this,void 0,void 0,function*(){const l=t.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme),f={request:this.map._requestManager.transformRequest(l,"Tile"),uid:t.uid,tileID:t.tileID,zoom:t.tileID.overscaledZ,tileSize:this.tileSize*t.tileID.overscaleFactor(),type:this.type,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,subdivisionGranularity:this.map.style.projection.subdivisionGranularity,globalState:this.map.getGlobalState()};f.request.collectResourceTiming=this._collectResourceTiming;let g="RT";if(t.actor&&t.state!=="expired"){if(t.state==="loading")return new Promise((w,I)=>{t.reloadPromise={resolve:w,reject:I}})}else t.actor=this.dispatcher.getActor(),g="LT";t.abortController=new AbortController;try{const w=yield t.actor.sendAsync({type:g,data:f},t.abortController);if(delete t.abortController,t.aborted)return;this._afterTileLoadWorkerResponse(t,w)}catch(w){if(delete t.abortController,t.aborted)return;if(w&&w.status!==404)throw w;this._afterTileLoadWorkerResponse(t,null)}})}_afterTileLoadWorkerResponse(t,l){if(l&&l.resourceTiming&&(t.resourceTiming=l.resourceTiming),l&&this.map._refreshExpiredTiles&&t.setExpiryData(l),t.loadVectorData(l,this.map.painter),t.reloadPromise){const f=t.reloadPromise;t.reloadPromise=null,this.loadTile(t).then(f.resolve).catch(f.reject)}}abortTile(t){return o._(this,void 0,void 0,function*(){t.abortController&&(t.abortController.abort(),delete t.abortController),t.actor&&(yield t.actor.sendAsync({type:"AT",data:{uid:t.uid,type:this.type,source:this.id}}))})}unloadTile(t){return o._(this,void 0,void 0,function*(){t.unloadVectorData(),t.actor&&(yield t.actor.sendAsync({type:"RMT",data:{uid:t.uid,type:this.type,source:this.id}}))})}hasTransition(){return!1}}class sr extends o.E{constructor(t,l,f,g){super(),this.id=t,this.dispatcher=f,this.setEventedParent(g),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=o.e({type:"raster"},l),o.e(this,o.Q(l,["url","scheme","tileSize"]))}load(){return o._(this,arguments,void 0,function*(t=!1){this._loaded=!1,this.fire(new o.l("dataloading",{dataType:"source"})),this._tileJSONRequest=new AbortController;try{const l=yield $e(this._options,this.map._requestManager,this._tileJSONRequest);this._tileJSONRequest=null,this._loaded=!0,l&&(o.e(this,l),l.bounds&&(this.tileBounds=new Qi(l.bounds,this.minzoom,this.maxzoom)),this.fire(new o.l("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new o.l("data",{dataType:"source",sourceDataType:"content",sourceDataChanged:t})))}catch(l){this._tileJSONRequest=null,this.fire(new o.k(l))}})}loaded(){return this._loaded}onAdd(t){this.map=t,this.load()}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null)}setSourceProperty(t){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null),t(),this.load(!0)}setTiles(t){return this.setSourceProperty(()=>{this._options.tiles=t}),this}setUrl(t){return this.setSourceProperty(()=>{this.url=t,this._options.url=t}),this}serialize(){return o.e({},this._options)}hasTile(t){return!this.tileBounds||this.tileBounds.contains(t.canonical)}loadTile(t){return o._(this,void 0,void 0,function*(){const l=t.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme);t.abortController=new AbortController;try{const f=yield ne.getImage(this.map._requestManager.transformRequest(l,"Tile"),t.abortController,this.map._refreshExpiredTiles);if(delete t.abortController,t.aborted)return void(t.state="unloaded");if(f&&f.data){this.map._refreshExpiredTiles&&(f.cacheControl||f.expires)&&t.setExpiryData({cacheControl:f.cacheControl,expires:f.expires});const g=this.map.painter.context,w=g.gl,I=f.data;t.texture=this.map.painter.getTileTexture(I.width),t.texture?t.texture.update(I,{useMipmap:!0}):(t.texture=new o.T(g,I,w.RGBA,{useMipmap:!0}),t.texture.bind(w.LINEAR,w.CLAMP_TO_EDGE,w.LINEAR_MIPMAP_NEAREST)),t.state="loaded"}}catch(f){if(delete t.abortController,t.aborted)t.state="unloaded";else if(f)throw t.state="errored",f}})}abortTile(t){return o._(this,void 0,void 0,function*(){t.abortController&&(t.abortController.abort(),delete t.abortController)})}unloadTile(t){return o._(this,void 0,void 0,function*(){t.texture&&this.map.painter.saveTileTexture(t.texture)})}hasTransition(){return!1}}class jr extends sr{constructor(t,l,f,g){super(t,l,f,g),this.type="raster-dem",this.maxzoom=22,this._options=o.e({type:"raster-dem"},l),this.encoding=l.encoding||"mapbox",this.redFactor=l.redFactor,this.greenFactor=l.greenFactor,this.blueFactor=l.blueFactor,this.baseShift=l.baseShift}loadTile(t){return o._(this,void 0,void 0,function*(){const l=t.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme),f=this.map._requestManager.transformRequest(l,"Tile");t.neighboringTiles=this._getNeighboringTiles(t.tileID),t.abortController=new AbortController;try{const g=yield ne.getImage(f,t.abortController,this.map._refreshExpiredTiles);if(delete t.abortController,t.aborted)return void(t.state="unloaded");if(g&&g.data){const w=g.data;this.map._refreshExpiredTiles&&(g.cacheControl||g.expires)&&t.setExpiryData({cacheControl:g.cacheControl,expires:g.expires});const I=o.b(w)&&o.W()?w:yield this.readImageNow(w),k={type:this.type,uid:t.uid,source:this.id,rawImageData:I,encoding:this.encoding,redFactor:this.redFactor,greenFactor:this.greenFactor,blueFactor:this.blueFactor,baseShift:this.baseShift};if(!t.actor||t.state==="expired"){t.actor=this.dispatcher.getActor();const R=yield t.actor.sendAsync({type:"LDT",data:k});t.dem=R,t.needsHillshadePrepare=!0,t.needsTerrainPrepare=!0,t.state="loaded"}}}catch(g){if(delete t.abortController,t.aborted)t.state="unloaded";else if(g)throw t.state="errored",g}})}readImageNow(t){return o._(this,void 0,void 0,function*(){if(typeof VideoFrame<"u"&&o.X()){const l=t.width+2,f=t.height+2;try{return new o.R({width:l,height:f},yield o.Y(t,-1,-1,l,f))}catch{}}return Y.getImageData(t,1)})}_getNeighboringTiles(t){const l=t.canonical,f=Math.pow(2,l.z),g=(l.x-1+f)%f,w=l.x===0?t.wrap-1:t.wrap,I=(l.x+1+f)%f,k=l.x+1===f?t.wrap+1:t.wrap,R={};return R[new o.Z(t.overscaledZ,w,l.z,g,l.y).key]={backfilled:!1},R[new o.Z(t.overscaledZ,k,l.z,I,l.y).key]={backfilled:!1},l.y>0&&(R[new o.Z(t.overscaledZ,w,l.z,g,l.y-1).key]={backfilled:!1},R[new o.Z(t.overscaledZ,t.wrap,l.z,l.x,l.y-1).key]={backfilled:!1},R[new o.Z(t.overscaledZ,k,l.z,I,l.y-1).key]={backfilled:!1}),l.y+1<f&&(R[new o.Z(t.overscaledZ,w,l.z,g,l.y+1).key]={backfilled:!1},R[new o.Z(t.overscaledZ,t.wrap,l.z,l.x,l.y+1).key]={backfilled:!1},R[new o.Z(t.overscaledZ,k,l.z,I,l.y+1).key]={backfilled:!1}),R}unloadTile(t){return o._(this,void 0,void 0,function*(){t.demTexture&&this.map.painter.saveTileTexture(t.demTexture),t.fbo&&(t.fbo.destroy(),delete t.fbo),t.dem&&delete t.dem,delete t.neighboringTiles,t.state="unloaded",t.actor&&(yield t.actor.sendAsync({type:"RDT",data:{type:this.type,uid:t.uid,source:this.id}}))})}}class En extends o.E{constructor(t,l,f,g){super(),this.id=t,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._removed=!1,this._pendingLoads=0,this.actor=f.getActor(),this.setEventedParent(g),this._data=l.data,this._options=o.e({},l),this._collectResourceTiming=l.collectResourceTiming,l.maxzoom!==void 0&&(this.maxzoom=l.maxzoom),l.type&&(this.type=l.type),l.attribution&&(this.attribution=l.attribution),this.promoteId=l.promoteId,l.clusterMaxZoom!==void 0&&this.maxzoom<=l.clusterMaxZoom&&o.w(`The maxzoom value "${this.maxzoom}" is expected to be greater than the clusterMaxZoom value "${l.clusterMaxZoom}".`),this.workerOptions=o.e({source:this.id,cluster:l.cluster||!1,geojsonVtOptions:{buffer:this._pixelsToTileUnits(l.buffer!==void 0?l.buffer:128),tolerance:this._pixelsToTileUnits(l.tolerance!==void 0?l.tolerance:.375),extent:o.$,maxZoom:this.maxzoom,lineMetrics:l.lineMetrics||!1,generateId:l.generateId||!1},superclusterOptions:{maxZoom:this._getClusterMaxZoom(l.clusterMaxZoom),minPoints:Math.max(2,l.clusterMinPoints||2),extent:o.$,radius:this._pixelsToTileUnits(l.clusterRadius||50),log:!1,generateId:l.generateId||!1},clusterProperties:l.clusterProperties,filter:l.filter},l.workerOptions),typeof this.promoteId=="string"&&(this.workerOptions.promoteId=this.promoteId)}_pixelsToTileUnits(t){return t*(o.$/this.tileSize)}_getClusterMaxZoom(t){const l=t?Math.round(t):this.maxzoom-1;return Number.isInteger(t)||t===void 0||o.w(`Integer expected for option 'clusterMaxZoom': provided value "${t}" rounded to "${l}"`),l}load(){return o._(this,void 0,void 0,function*(){yield this._updateWorkerData()})}onAdd(t){this.map=t,this.load()}setData(t){return this._data=t,this._updateWorkerData(),this}updateData(t){return this._updateWorkerData(t),this}getData(){return o._(this,void 0,void 0,function*(){const t=o.e({type:this.type},this.workerOptions);return this.actor.sendAsync({type:"GD",data:t})})}getCoordinatesFromGeometry(t){return t.type==="GeometryCollection"?t.geometries.map(l=>l.coordinates).flat(1/0):t.coordinates.flat(1/0)}getBounds(){return o._(this,void 0,void 0,function*(){const t=new zi,l=yield this.getData();let f;switch(l.type){case"FeatureCollection":f=l.features.map(g=>this.getCoordinatesFromGeometry(g.geometry)).flat(1/0);break;case"Feature":f=this.getCoordinatesFromGeometry(l.geometry);break;default:f=this.getCoordinatesFromGeometry(l)}if(f.length==0)return t;for(let g=0;g<f.length-1;g+=2)t.extend([f[g],f[g+1]]);return t})}setClusterOptions(t){return this.workerOptions.cluster=t.cluster,t&&(t.clusterRadius!==void 0&&(this.workerOptions.superclusterOptions.radius=this._pixelsToTileUnits(t.clusterRadius)),t.clusterMaxZoom!==void 0&&(this.workerOptions.superclusterOptions.maxZoom=this._getClusterMaxZoom(t.clusterMaxZoom))),this._updateWorkerData(),this}getClusterExpansionZoom(t){return this.actor.sendAsync({type:"GCEZ",data:{type:this.type,clusterId:t,source:this.id}})}getClusterChildren(t){return this.actor.sendAsync({type:"GCC",data:{type:this.type,clusterId:t,source:this.id}})}getClusterLeaves(t,l,f){return this.actor.sendAsync({type:"GCL",data:{type:this.type,source:this.id,clusterId:t,limit:l,offset:f}})}_updateWorkerData(t){return o._(this,void 0,void 0,function*(){const l=o.e({type:this.type},this.workerOptions);t?l.dataDiff=t:typeof this._data=="string"?(l.request=this.map._requestManager.transformRequest(Y.resolveURL(this._data),"Source"),l.request.collectResourceTiming=this._collectResourceTiming):l.data=JSON.stringify(this._data),this._pendingLoads++,this.fire(new o.l("dataloading",{dataType:"source"}));try{const f=yield this.actor.sendAsync({type:"LD",data:l});if(this._pendingLoads--,this._removed||f.abandoned)return void this.fire(new o.l("dataabort",{dataType:"source"}));let g=null;f.resourceTiming&&f.resourceTiming[this.id]&&(g=f.resourceTiming[this.id].slice(0));const w={dataType:"source"};this._collectResourceTiming&&g&&g.length>0&&o.e(w,{resourceTiming:g}),this.fire(new o.l("data",Object.assign(Object.assign({},w),{sourceDataType:"metadata"}))),this.fire(new o.l("data",Object.assign(Object.assign({},w),{sourceDataType:"content"})))}catch(f){if(this._pendingLoads--,this._removed)return void this.fire(new o.l("dataabort",{dataType:"source"}));this.fire(new o.k(f))}})}loaded(){return this._pendingLoads===0}loadTile(t){return o._(this,void 0,void 0,function*(){const l=t.actor?"RT":"LT";t.actor=this.actor;const f={type:this.type,uid:t.uid,tileID:t.tileID,zoom:t.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,subdivisionGranularity:this.map.style.projection.subdivisionGranularity,globalState:this.map.getGlobalState()};t.abortController=new AbortController;const g=yield this.actor.sendAsync({type:l,data:f},t.abortController);delete t.abortController,t.unloadVectorData(),t.aborted||t.loadVectorData(g,this.map.painter,l==="RT")})}abortTile(t){return o._(this,void 0,void 0,function*(){t.abortController&&(t.abortController.abort(),delete t.abortController),t.aborted=!0})}unloadTile(t){return o._(this,void 0,void 0,function*(){t.unloadVectorData(),yield this.actor.sendAsync({type:"RMT",data:{uid:t.uid,type:this.type,source:this.id}})})}onRemove(){this._removed=!0,this.actor.sendAsync({type:"RS",data:{type:this.type,source:this.id}})}serialize(){return o.e({},this._options,{type:this.type,data:this._data})}hasTransition(){return!1}}class Ot extends o.E{constructor(t,l,f,g){super(),this.flippedWindingOrder=!1,this.id=t,this.dispatcher=f,this.coordinates=l.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.setEventedParent(g),this.options=l}load(t){return o._(this,void 0,void 0,function*(){this._loaded=!1,this.fire(new o.l("dataloading",{dataType:"source"})),this.url=this.options.url,this._request=new AbortController;try{const l=yield ne.getImage(this.map._requestManager.transformRequest(this.url,"Image"),this._request);this._request=null,this._loaded=!0,l&&l.data&&(this.image=l.data,t&&(this.coordinates=t),this._finishLoading())}catch(l){this._request=null,this._loaded=!0,this.fire(new o.k(l))}})}loaded(){return this._loaded}updateImage(t){return t.url?(this._request&&(this._request.abort(),this._request=null),this.options.url=t.url,this.load(t.coordinates).finally(()=>{this.texture=null}),this):this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new o.l("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(t){this.map=t,this.load()}onRemove(){this._request&&(this._request.abort(),this._request=null)}setCoordinates(t){this.coordinates=t;const l=t.map(o.a0.fromLngLat);var f;return this.tileID=function(g){const w=o.a1.fromPoints(g),I=w.width(),k=w.height(),R=Math.max(I,k),z=Math.max(0,Math.floor(-Math.log(R)/Math.LN2)),G=Math.pow(2,z);return new o.a3(z,Math.floor((w.minX+w.maxX)/2*G),Math.floor((w.minY+w.maxY)/2*G))}(l),this.terrainTileRanges=this._getOverlappingTileRanges(l),this.minzoom=this.maxzoom=this.tileID.z,this.tileCoords=l.map(g=>this.tileID.getTilePoint(g)._round()),this.flippedWindingOrder=((f=this.tileCoords)[1].x-f[0].x)*(f[2].y-f[0].y)-(f[1].y-f[0].y)*(f[2].x-f[0].x)<0,this.fire(new o.l("data",{dataType:"source",sourceDataType:"content"})),this}prepare(){if(Object.keys(this.tiles).length===0||!this.image)return;const t=this.map.painter.context,l=t.gl;this.texture||(this.texture=new o.T(t,this.image,l.RGBA),this.texture.bind(l.LINEAR,l.CLAMP_TO_EDGE));let f=!1;for(const g in this.tiles){const w=this.tiles[g];w.state!=="loaded"&&(w.state="loaded",w.texture=this.texture,f=!0)}f&&this.fire(new o.l("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}loadTile(t){return o._(this,void 0,void 0,function*(){this.tileID&&this.tileID.equals(t.tileID.canonical)?(this.tiles[String(t.tileID.wrap)]=t,t.buckets={}):t.state="errored"})}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}_getOverlappingTileRanges(t){const{minX:l,minY:f,maxX:g,maxY:w}=o.a1.fromPoints(t),I={};for(let k=0;k<=o.a2;k++){const R=Math.pow(2,k),z=Math.floor(l*R),G=Math.floor(f*R),X=Math.floor(g*R),W=Math.floor(w*R);I[k]={minTileX:z,minTileY:G,maxTileX:X,maxTileY:W}}return I}}class In extends Ot{constructor(t,l,f,g){super(t,l,f,g),this.roundZoom=!0,this.type="video",this.options=l}load(){return o._(this,void 0,void 0,function*(){this._loaded=!1;const t=this.options;this.urls=[];for(const l of t.urls)this.urls.push(this.map._requestManager.transformRequest(l,"Source").url);try{const l=yield o.a4(this.urls);if(this._loaded=!0,!l)return;this.video=l,this.video.loop=!0,this.video.addEventListener("playing",()=>{this.map.triggerRepaint()}),this.map&&this.video.play(),this._finishLoading()}catch(l){this.fire(new o.k(l))}})}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(t){if(this.video){const l=this.video.seekable;t<l.start(0)||t>l.end(0)?this.fire(new o.k(new o.a5(`sources.${this.id}`,null,`Playback for this video can be set only between the ${l.start(0)} and ${l.end(0)}-second mark.`))):this.video.currentTime=t}}getVideo(){return this.video}onAdd(t){this.map||(this.map=t,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(Object.keys(this.tiles).length===0||this.video.readyState<2)return;const t=this.map.painter.context,l=t.gl;this.texture?this.video.paused||(this.texture.bind(l.LINEAR,l.CLAMP_TO_EDGE),l.texSubImage2D(l.TEXTURE_2D,0,0,0,l.RGBA,l.UNSIGNED_BYTE,this.video)):(this.texture=new o.T(t,this.video,l.RGBA),this.texture.bind(l.LINEAR,l.CLAMP_TO_EDGE));let f=!1;for(const g in this.tiles){const w=this.tiles[g];w.state!=="loaded"&&(w.state="loaded",w.texture=this.texture,f=!0)}f&&this.fire(new o.l("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}}class xs extends Ot{constructor(t,l,f,g){super(t,l,f,g),l.coordinates?Array.isArray(l.coordinates)&&l.coordinates.length===4&&!l.coordinates.some(w=>!Array.isArray(w)||w.length!==2||w.some(I=>typeof I!="number"))||this.fire(new o.k(new o.a5(`sources.${t}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new o.k(new o.a5(`sources.${t}`,null,'missing required property "coordinates"'))),l.animate&&typeof l.animate!="boolean"&&this.fire(new o.k(new o.a5(`sources.${t}`,null,'optional "animate" property must be a boolean value'))),l.canvas?typeof l.canvas=="string"||l.canvas instanceof HTMLCanvasElement||this.fire(new o.k(new o.a5(`sources.${t}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new o.k(new o.a5(`sources.${t}`,null,'missing required property "canvas"'))),this.options=l,this.animate=l.animate===void 0||l.animate}load(){return o._(this,void 0,void 0,function*(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof HTMLCanvasElement?this.options.canvas:document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new o.k(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())})}getCanvas(){return this.canvas}onAdd(t){this.map=t,this.load(),this.canvas&&this.animate&&this.play()}onRemove(){this.pause()}prepare(){let t=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,t=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,t=!0),this._hasInvalidDimensions()||Object.keys(this.tiles).length===0)return;const l=this.map.painter.context,f=l.gl;this.texture?(t||this._playing)&&this.texture.update(this.canvas,{premultiply:!0}):this.texture=new o.T(l,this.canvas,f.RGBA,{premultiply:!0});let g=!1;for(const w in this.tiles){const I=this.tiles[w];I.state!=="loaded"&&(I.state="loaded",I.texture=this.texture,g=!0)}g&&this.fire(new o.l("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}serialize(){return{type:"canvas",coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const t of[this.canvas.width,this.canvas.height])if(isNaN(t)||t<=0)return!0;return!1}}const os={},$s=b=>{switch(b){case"geojson":return En;case"image":return Ot;case"raster":return sr;case"raster-dem":return jr;case"vector":return Gi;case"video":return In;case"canvas":return xs}return os[b]},Xt="RTLPluginLoaded";class _r extends o.E{constructor(){super(...arguments),this.status="unavailable",this.url=null,this.dispatcher=Ir()}_syncState(t){return this.status=t,this.dispatcher.broadcast("SRPS",{pluginStatus:t,pluginURL:this.url}).catch(l=>{throw this.status="error",l})}getRTLTextPluginStatus(){return this.status}clearRTLTextPlugin(){this.status="unavailable",this.url=null}setRTLTextPlugin(t){return o._(this,arguments,void 0,function*(l,f=!1){if(this.url)throw new Error("setRTLTextPlugin cannot be called multiple times.");if(this.url=Y.resolveURL(l),!this.url)throw new Error(`requested url ${l} is invalid`);if(this.status==="unavailable"){if(!f)return this._requestImport();this.status="deferred",this._syncState(this.status)}else if(this.status==="requested")return this._requestImport()})}_requestImport(){return o._(this,void 0,void 0,function*(){yield this._syncState("loading"),this.status="loaded",this.fire(new o.l(Xt))})}lazyLoad(){this.status==="unavailable"?this.status="requested":this.status==="deferred"&&this._requestImport()}}let gi=null;function rn(){return gi||(gi=new _r),gi}class oi{constructor(t,l){this.timeAdded=0,this.fadeEndTime=0,this.tileID=t,this.uid=o.a6(),this.uses=0,this.tileSize=l,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.rtt=[],this.rttCoords={},this.expiredRequestCount=0,this.state="loading"}registerFadeDuration(t){const l=t+this.timeAdded;l<this.fadeEndTime||(this.fadeEndTime=l)}wasRequested(){return this.state==="errored"||this.state==="loaded"||this.state==="reloading"}clearTextures(t){this.demTexture&&t.saveTileTexture(this.demTexture),this.demTexture=null}loadVectorData(t,l,f){if(this.hasData()&&this.unloadVectorData(),this.state="loaded",t){t.featureIndex&&(this.latestFeatureIndex=t.featureIndex,t.rawTileData?(this.latestRawTileData=t.rawTileData,this.latestFeatureIndex.rawTileData=t.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=t.collisionBoxArray,this.buckets=function(g,w){const I={};if(!w)return I;for(const k of g){const R=k.layerIds.map(z=>w.getLayer(z)).filter(Boolean);if(R.length!==0){k.layers=R,k.stateDependentLayerIds&&(k.stateDependentLayers=k.stateDependentLayerIds.map(z=>R.filter(G=>G.id===z)[0]));for(const z of R)I[z.id]=k}}return I}(t.buckets,l?.style),this.hasSymbolBuckets=!1;for(const g in this.buckets){const w=this.buckets[g];if(w instanceof o.a8){if(this.hasSymbolBuckets=!0,!f)break;w.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const g in this.buckets){const w=this.buckets[g];if(w instanceof o.a8&&w.hasRTLText){this.hasRTLText=!0,rn().lazyLoad();break}}this.queryPadding=0;for(const g in this.buckets){const w=this.buckets[g];this.queryPadding=Math.max(this.queryPadding,l.style.getLayer(g).queryRadius(w))}t.imageAtlas&&(this.imageAtlas=t.imageAtlas),t.glyphAtlasImage&&(this.glyphAtlasImage=t.glyphAtlasImage)}else this.collisionBoxArray=new o.a7}unloadVectorData(){for(const t in this.buckets)this.buckets[t].destroy();this.buckets={},this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.imageAtlas&&(this.imageAtlas=null),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.latestFeatureIndex=null,this.state="unloaded"}getBucket(t){return this.buckets[t.id]}upload(t){for(const f in this.buckets){const g=this.buckets[f];g.uploadPending()&&g.upload(t)}const l=t.gl;this.imageAtlas&&!this.imageAtlas.uploaded&&(this.imageAtlasTexture=new o.T(t,this.imageAtlas.image,l.RGBA),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new o.T(t,this.glyphAtlasImage,l.ALPHA),this.glyphAtlasImage=null)}prepare(t){this.imageAtlas&&this.imageAtlas.patchUpdatedImages(t,this.imageAtlasTexture)}queryRenderedFeatures(t,l,f,g,w,I,k,R,z,G,X){return this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData?this.latestFeatureIndex.query({queryGeometry:g,cameraQueryGeometry:w,scale:I,tileSize:this.tileSize,pixelPosMatrix:G,transform:R,params:k,queryPadding:this.queryPadding*z,getElevation:X},t,l,f):{}}querySourceFeatures(t,l){const f=this.latestFeatureIndex;if(!f||!f.rawTileData)return;const g=f.loadVTLayers(),w=l&&l.sourceLayer?l.sourceLayer:"",I=g._geojsonTileLayer||g[w];if(!I)return;const k=o.a9(l&&l.filter),{z:R,x:z,y:G}=this.tileID.canonical,X={z:R,x:z,y:G};for(let W=0;W<I.length;W++){const te=I.feature(W);if(k.needGeometry){const we=o.aa(te,!0);if(!k.filter(new o.F(this.tileID.overscaledZ),we,this.tileID.canonical))continue}else if(!k.filter(new o.F(this.tileID.overscaledZ),te))continue;const ae=f.getId(te,w),Te=new o.ab(te,R,z,G,ae);Te.tile=X,t.push(Te)}}hasData(){return this.state==="loaded"||this.state==="reloading"||this.state==="expired"}patternsLoaded(){return this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length}setExpiryData(t){const l=this.expirationTime;if(t.cacheControl){const f=o.ac(t.cacheControl);f["max-age"]&&(this.expirationTime=Date.now()+1e3*f["max-age"])}else t.expires&&(this.expirationTime=new Date(t.expires).getTime());if(this.expirationTime){const f=Date.now();let g=!1;if(this.expirationTime>f)g=!1;else if(l)if(this.expirationTime<l)g=!0;else{const w=this.expirationTime-l;w?this.expirationTime=f+Math.max(w,3e4):g=!0}else g=!0;g?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-new Date().getTime(),Math.pow(2,31)-1)}setFeatureState(t,l){if(!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData||Object.keys(t).length===0)return;const f=this.latestFeatureIndex.loadVTLayers();for(const g in this.buckets){if(!l.style.hasLayer(g))continue;const w=this.buckets[g],I=w.layers[0].sourceLayer||"_geojsonTileLayer",k=f[I],R=t[I];if(!k||!R||Object.keys(R).length===0)continue;w.update(R,k,this.imageAtlas&&this.imageAtlas.patternPositions||{});const z=l&&l.style&&l.style.getLayer(g);z&&(this.queryPadding=Math.max(this.queryPadding,z.queryRadius(w)))}}holdingForFade(){return this.symbolFadeHoldUntil!==void 0}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<Y.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(t){this.symbolFadeHoldUntil=Y.now()+t}setDependencies(t,l){const f={};for(const g of l)f[g]=!0;this.dependencies[t]=f}hasDependency(t,l){for(const f of t){const g=this.dependencies[f];if(g){for(const w of l)if(g[w])return!0}}return!1}}class er{constructor(t,l){this.max=t,this.onRemove=l,this.reset()}reset(){for(const t in this.data)for(const l of this.data[t])l.timeout&&clearTimeout(l.timeout),this.onRemove(l.value);return this.data={},this.order=[],this}add(t,l,f){const g=t.wrapped().key;this.data[g]===void 0&&(this.data[g]=[]);const w={value:l,timeout:void 0};if(f!==void 0&&(w.timeout=setTimeout(()=>{this.remove(t,w)},f)),this.data[g].push(w),this.order.push(g),this.order.length>this.max){const I=this._getAndRemoveByKey(this.order[0]);I&&this.onRemove(I)}return this}has(t){return t.wrapped().key in this.data}getAndRemove(t){return this.has(t)?this._getAndRemoveByKey(t.wrapped().key):null}_getAndRemoveByKey(t){const l=this.data[t].shift();return l.timeout&&clearTimeout(l.timeout),this.data[t].length===0&&delete this.data[t],this.order.splice(this.order.indexOf(t),1),l.value}getByKey(t){const l=this.data[t];return l?l[0].value:null}get(t){return this.has(t)?this.data[t.wrapped().key][0].value:null}remove(t,l){if(!this.has(t))return this;const f=t.wrapped().key,g=l===void 0?0:this.data[f].indexOf(l),w=this.data[f][g];return this.data[f].splice(g,1),w.timeout&&clearTimeout(w.timeout),this.data[f].length===0&&delete this.data[f],this.onRemove(w.value),this.order.splice(this.order.indexOf(f),1),this}setMaxSize(t){for(this.max=t;this.order.length>this.max;){const l=this._getAndRemoveByKey(this.order[0]);l&&this.onRemove(l)}return this}filter(t){const l=[];for(const f in this.data)for(const g of this.data[f])t(g.value)||l.push(g);for(const f of l)this.remove(f.value.tileID,f)}}class Bi{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(t,l,f){const g=String(l);if(this.stateChanges[t]=this.stateChanges[t]||{},this.stateChanges[t][g]=this.stateChanges[t][g]||{},o.e(this.stateChanges[t][g],f),this.deletedStates[t]===null){this.deletedStates[t]={};for(const w in this.state[t])w!==g&&(this.deletedStates[t][w]=null)}else if(this.deletedStates[t]&&this.deletedStates[t][g]===null){this.deletedStates[t][g]={};for(const w in this.state[t][g])f[w]||(this.deletedStates[t][g][w]=null)}else for(const w in f)this.deletedStates[t]&&this.deletedStates[t][g]&&this.deletedStates[t][g][w]===null&&delete this.deletedStates[t][g][w]}removeFeatureState(t,l,f){if(this.deletedStates[t]===null)return;const g=String(l);if(this.deletedStates[t]=this.deletedStates[t]||{},f&&l!==void 0)this.deletedStates[t][g]!==null&&(this.deletedStates[t][g]=this.deletedStates[t][g]||{},this.deletedStates[t][g][f]=null);else if(l!==void 0)if(this.stateChanges[t]&&this.stateChanges[t][g])for(f in this.deletedStates[t][g]={},this.stateChanges[t][g])this.deletedStates[t][g][f]=null;else this.deletedStates[t][g]=null;else this.deletedStates[t]=null}getState(t,l){const f=String(l),g=o.e({},(this.state[t]||{})[f],(this.stateChanges[t]||{})[f]);if(this.deletedStates[t]===null)return{};if(this.deletedStates[t]){const w=this.deletedStates[t][l];if(w===null)return{};for(const I in w)delete g[I]}return g}initializeTileState(t,l){t.setFeatureState(this.state,l)}coalesceChanges(t,l){const f={};for(const g in this.stateChanges){this.state[g]=this.state[g]||{};const w={};for(const I in this.stateChanges[g])this.state[g][I]||(this.state[g][I]={}),o.e(this.state[g][I],this.stateChanges[g][I]),w[I]=this.state[g][I];f[g]=w}for(const g in this.deletedStates){this.state[g]=this.state[g]||{};const w={};if(this.deletedStates[g]===null)for(const I in this.state[g])w[I]={},this.state[g][I]={};else for(const I in this.deletedStates[g]){if(this.deletedStates[g][I]===null)this.state[g][I]={};else for(const k of Object.keys(this.deletedStates[g][I]))delete this.state[g][I][k];w[I]=this.state[g][I]}f[g]=f[g]||{},o.e(f[g],w)}if(this.stateChanges={},this.deletedStates={},Object.keys(f).length!==0)for(const g in t)t[g].setFeatureState(f,l)}}const Ii=89.25;function et(b,t){const l=o.ag(t.lat,-o.ah,o.ah);return new o.P(o.V(t.lng)*b,o.U(l)*b)}function le(b,t){return new o.a0(t.x/b,t.y/b).toLngLat()}function pe(b){return b.cameraToCenterDistance*Math.min(.85*Math.tan(o.ad(90-b.pitch)),Math.tan(o.ad(Ii-b.pitch)))}function me(b,t){const l=b.canonical,f=t/o.ae(l.z),g=l.x+Math.pow(2,l.z)*b.wrap,w=o.af(new Float64Array(16));return o.M(w,w,[g*f,l.y*f,0]),o.N(w,w,[f/o.$,f/o.$,1]),w}function Le(b,t,l,f,g){const w=o.a0.fromLngLat(b,t),I=g*o.ai(1,b.lat),k=I*Math.cos(o.ad(l)),R=Math.sqrt(I*I-k*k),z=R*Math.sin(o.ad(-f)),G=R*Math.cos(o.ad(-f));return new o.a0(w.x+z,w.y+G,w.z+k)}function Ze(b,t,l){const f=t.intersectsFrustum(b);if(!l||f===0)return f;const g=t.intersectsPlane(l);return g===0?0:f===2&&g===2?2:1}function Je(b,t,l){let f=0;const g=(l-t)/10;for(let w=0;w<10;w++)f+=g*Math.pow(Math.cos(t+(w+.5)/10*(l-t)),b);return f}function at(b,t){return function(l,f,g,w,I){const k=2*((b-1)/o.aj(Math.cos(o.ad(Ii-I))/Math.cos(o.ad(Ii)))-1),R=Math.acos(g/w),z=2*Je(k-1,0,o.ad(I/2)),G=Math.min(o.ad(Ii),R+o.ad(I/2)),X=Je(k-1,Math.min(G,R-o.ad(I/2)),G),W=Math.atan(f/g),te=Math.hypot(f,g);let ae=l;return ae+=o.aj(w/te/Math.max(.5,Math.cos(o.ad(I/2)))),ae+=k*o.aj(Math.cos(W))/2,ae-=o.aj(Math.max(1,X/z/t))/2,ae}}const He=at(9.314,3);function gt(b,t){const l=(t.roundZoom?Math.round:Math.floor)(b.zoom+o.aj(b.tileSize/t.tileSize));return Math.max(0,l)}function ft(b,t){const l=b.getCameraFrustum(),f=b.getClippingPlane(),g=b.screenPointToMercatorCoordinate(b.getCameraPoint()),w=o.a0.fromLngLat(b.center,b.elevation);g.z=w.z+Math.cos(b.pitchInRadians)*b.cameraToCenterDistance/b.worldSize;const I=b.getCoveringTilesDetailsProvider(),k=I.allowVariableZoom(b,t),R=gt(b,t),z=t.minzoom||0,G=t.maxzoom!==void 0?t.maxzoom:b.maxZoom,X=Math.min(Math.max(0,R),G),W=Math.pow(2,X),te=[W*g.x,W*g.y,0],ae=[W*w.x,W*w.y,0],Te=Math.hypot(w.x-g.x,w.y-g.y),we=Math.abs(w.z-g.z),Ee=Math.hypot(Te,we),Ce=Ue=>({zoom:0,x:0,y:0,wrap:Ue,fullyVisible:!1}),Fe=[],Oe=[];if(b.renderWorldCopies&&I.allowWorldCopies())for(let Ue=1;Ue<=3;Ue++)Fe.push(Ce(-Ue)),Fe.push(Ce(Ue));for(Fe.push(Ce(0));Fe.length>0;){const Ue=Fe.pop(),We=Ue.x,De=Ue.y;let Qe=Ue.fullyVisible;const yt={x:We,y:De,z:Ue.zoom},ct=I.getTileBoundingVolume(yt,Ue.wrap,b.elevation,t);if(!Qe){const Vt=Ze(l,ct,f);if(Vt===0)continue;Qe=Vt===2}const dt=I.distanceToTile2d(g.x,g.y,yt,ct);let _t=R;k&&(_t=(t.calculateTileZoom||He)(b.zoom+o.aj(b.tileSize/t.tileSize),dt,we,Ee,b.fov)),_t=(t.roundZoom?Math.round:Math.floor)(_t),_t=Math.max(0,_t);const qt=Math.min(_t,G);if(Ue.wrap=I.getWrap(w,yt,Ue.wrap),Ue.zoom>=qt){if(Ue.zoom<z)continue;const Vt=X-Ue.zoom,kt=te[0]-.5-(We<<Vt),hi=te[1]-.5-(De<<Vt),Ji=t.reparseOverscaled?Math.max(Ue.zoom,_t):Ue.zoom;Oe.push({tileID:new o.Z(Ue.zoom===G?Ji:Ue.zoom,Ue.wrap,Ue.zoom,We,De),distanceSq:o.ak([ae[0]-.5-We,ae[1]-.5-De]),tileDistanceToCamera:Math.sqrt(kt*kt+hi*hi)})}else for(let Vt=0;Vt<4;Vt++)Fe.push({zoom:Ue.zoom+1,x:(We<<1)+Vt%2,y:(De<<1)+(Vt>>1),wrap:Ue.wrap,fullyVisible:Qe})}return Oe.sort((Ue,We)=>Ue.distanceSq-We.distanceSq).map(Ue=>Ue.tileID)}const nt=o.a1.fromPoints([new o.P(0,0),new o.P(o.$,o.$)]);class Tt extends o.E{constructor(t,l,f){super(),this.id=t,this.dispatcher=f,this.on("data",g=>this._dataHandler(g)),this.on("dataloading",()=>{this._sourceErrored=!1}),this.on("error",()=>{this._sourceErrored=this._source.loaded()}),this._source=((g,w,I,k)=>{const R=new($s(w.type))(g,w,I,k);if(R.id!==g)throw new Error(`Expected Source id to be ${g} instead of ${R.id}`);return R})(t,l,f,this),this._tiles={},this._cache=new er(0,g=>this._unloadTile(g)),this._timers={},this._cacheTimers={},this._maxTileCacheSize=null,this._maxTileCacheZoomLevels=null,this._loadedParentTiles={},this._coveredTiles={},this._state=new Bi,this._didEmitContent=!1,this._updated=!1}onAdd(t){this.map=t,this._maxTileCacheSize=t?t._maxTileCacheSize:null,this._maxTileCacheZoomLevels=t?t._maxTileCacheZoomLevels:null,this._source&&this._source.onAdd&&this._source.onAdd(t)}onRemove(t){this.clearTiles(),this._source&&this._source.onRemove&&this._source.onRemove(t)}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;if(!(this.used===void 0&&this.usedForTerrain===void 0||this.used||this.usedForTerrain))return!0;if(!this._updated)return!1;for(const t in this._tiles){const l=this._tiles[t];if(l.state!=="loaded"&&l.state!=="errored")return!1}return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;const t=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,t&&this.reload(),this.transform&&this.update(this.transform,this.terrain)}_loadTile(t,l,f){return o._(this,void 0,void 0,function*(){try{yield this._source.loadTile(t),this._tileLoaded(t,l,f)}catch(g){t.state="errored",g.status!==404?this._source.fire(new o.k(g,{tile:t})):this.update(this.transform,this.terrain)}})}_unloadTile(t){this._source.unloadTile&&this._source.unloadTile(t)}_abortTile(t){this._source.abortTile&&this._source.abortTile(t),this._source.fire(new o.l("dataabort",{tile:t,coord:t.tileID,dataType:"source"}))}serialize(){return this._source.serialize()}prepare(t){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null);for(const l in this._tiles){const f=this._tiles[l];f.upload(t),f.prepare(this.map.style.imageManager)}}getIds(){return Object.values(this._tiles).map(t=>t.tileID).sort(Ve).map(t=>t.key)}getRenderableIds(t){const l=[];for(const f in this._tiles)this._isIdRenderable(f,t)&&l.push(this._tiles[f]);return t?l.sort((f,g)=>{const w=f.tileID,I=g.tileID,k=new o.P(w.canonical.x,w.canonical.y)._rotate(-this.transform.bearingInRadians),R=new o.P(I.canonical.x,I.canonical.y)._rotate(-this.transform.bearingInRadians);return w.overscaledZ-I.overscaledZ||R.y-k.y||R.x-k.x}).map(f=>f.tileID.key):l.map(f=>f.tileID).sort(Ve).map(f=>f.key)}hasRenderableParent(t){const l=this.findLoadedParent(t,0);return!!l&&this._isIdRenderable(l.tileID.key)}_isIdRenderable(t,l){return this._tiles[t]&&this._tiles[t].hasData()&&!this._coveredTiles[t]&&(l||!this._tiles[t].holdingForFade())}reload(t){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(const l in this._tiles)t?this._reloadTile(l,"expired"):this._tiles[l].state!=="errored"&&this._reloadTile(l,"reloading")}}_reloadTile(t,l){return o._(this,void 0,void 0,function*(){const f=this._tiles[t];f&&(f.state!=="loading"&&(f.state=l),yield this._loadTile(f,t,l))})}_tileLoaded(t,l,f){t.timeAdded=Y.now(),f==="expired"&&(t.refreshedUponExpiration=!0),this._setTileReloadTimer(l,t),this.getSource().type==="raster-dem"&&t.dem&&this._backfillDEM(t),this._state.initializeTileState(t,this.map?this.map.painter:null),t.aborted||this._source.fire(new o.l("data",{dataType:"source",tile:t,coord:t.tileID}))}_backfillDEM(t){const l=this.getRenderableIds();for(let g=0;g<l.length;g++){const w=l[g];if(t.neighboringTiles&&t.neighboringTiles[w]){const I=this.getTileByID(w);f(t,I),f(I,t)}}function f(g,w){g.needsHillshadePrepare=!0,g.needsTerrainPrepare=!0;let I=w.tileID.canonical.x-g.tileID.canonical.x;const k=w.tileID.canonical.y-g.tileID.canonical.y,R=Math.pow(2,g.tileID.canonical.z),z=w.tileID.key;I===0&&k===0||Math.abs(k)>1||(Math.abs(I)>1&&(Math.abs(I+R)===1?I+=R:Math.abs(I-R)===1&&(I-=R)),w.dem&&g.dem&&(g.dem.backfillBorder(w.dem,I,k),g.neighboringTiles&&g.neighboringTiles[z]&&(g.neighboringTiles[z].backfilled=!0)))}}getTile(t){return this.getTileByID(t.key)}getTileByID(t){return this._tiles[t]}_retainLoadedChildren(t,l,f,g){for(const w in this._tiles){let I=this._tiles[w];if(g[w]||!I.hasData()||I.tileID.overscaledZ<=l||I.tileID.overscaledZ>f)continue;let k=I.tileID;for(;I&&I.tileID.overscaledZ>l+1;){const z=I.tileID.scaledTo(I.tileID.overscaledZ-1);I=this._tiles[z.key],I&&I.hasData()&&(k=z)}let R=k;for(;R.overscaledZ>l;)if(R=R.scaledTo(R.overscaledZ-1),t[R.key]||t[R.canonical.key]){g[k.key]=k;break}}}findLoadedParent(t,l){if(t.key in this._loadedParentTiles){const f=this._loadedParentTiles[t.key];return f&&f.tileID.overscaledZ>=l?f:null}for(let f=t.overscaledZ-1;f>=l;f--){const g=t.scaledTo(f),w=this._getLoadedTile(g);if(w)return w}}findLoadedSibling(t){return this._getLoadedTile(t)}_getLoadedTile(t){const l=this._tiles[t.key];return l&&l.hasData()?l:this._cache.getByKey(t.wrapped().key)}updateCacheSize(t){const l=Math.ceil(t.width/this._source.tileSize)+1,f=Math.ceil(t.height/this._source.tileSize)+1,g=Math.floor(l*f*(this._maxTileCacheZoomLevels===null?o.a.MAX_TILE_CACHE_ZOOM_LEVELS:this._maxTileCacheZoomLevels)),w=typeof this._maxTileCacheSize=="number"?Math.min(this._maxTileCacheSize,g):g;this._cache.setMaxSize(w)}handleWrapJump(t){const l=Math.round((t-(this._prevLng===void 0?t:this._prevLng))/360);if(this._prevLng=t,l){const f={};for(const g in this._tiles){const w=this._tiles[g];w.tileID=w.tileID.unwrapTo(w.tileID.wrap+l),f[w.tileID.key]=w}this._tiles=f;for(const g in this._timers)clearTimeout(this._timers[g]),delete this._timers[g];for(const g in this._tiles)this._setTileReloadTimer(g,this._tiles[g])}}_updateCoveredAndRetainedTiles(t,l,f,g,w,I){const k={},R={},z=Object.keys(t),G=Y.now();for(const X of z){const W=t[X],te=this._tiles[X];if(!te||te.fadeEndTime!==0&&te.fadeEndTime<=G)continue;const ae=this.findLoadedParent(W,l),Te=this.findLoadedSibling(W),we=ae||Te||null;we&&(this._addTile(we.tileID),k[we.tileID.key]=we.tileID),R[X]=W}this._retainLoadedChildren(R,g,f,t);for(const X in k)t[X]||(this._coveredTiles[X]=!0,t[X]=k[X]);if(I){const X={},W={};for(const te of w)this._tiles[te.key].hasData()?X[te.key]=te:W[te.key]=te;for(const te in W){const ae=W[te].children(this._source.maxzoom);this._tiles[ae[0].key]&&this._tiles[ae[1].key]&&this._tiles[ae[2].key]&&this._tiles[ae[3].key]&&(X[ae[0].key]=t[ae[0].key]=ae[0],X[ae[1].key]=t[ae[1].key]=ae[1],X[ae[2].key]=t[ae[2].key]=ae[2],X[ae[3].key]=t[ae[3].key]=ae[3],delete W[te])}for(const te in W){const ae=W[te],Te=this.findLoadedParent(ae,this._source.minzoom),we=this.findLoadedSibling(ae),Ee=Te||we||null;if(Ee){X[Ee.tileID.key]=t[Ee.tileID.key]=Ee.tileID;for(const Ce in X)X[Ce].isChildOf(Ee.tileID)&&delete X[Ce]}}for(const te in this._tiles)X[te]||(this._coveredTiles[te]=!0)}}update(t,l){if(!this._sourceLoaded||this._paused)return;let f;this.transform=t,this.terrain=l,this.updateCacheSize(t),this.handleWrapJump(this.transform.center.lng),this._coveredTiles={},this.used||this.usedForTerrain?this._source.tileID?f=t.getVisibleUnwrappedCoordinates(this._source.tileID).map(G=>new o.Z(G.canonical.z,G.wrap,G.canonical.z,G.canonical.x,G.canonical.y)):(f=ft(t,{tileSize:this.usedForTerrain?this.tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:!this.usedForTerrain&&this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled,terrain:l,calculateTileZoom:this._source.calculateTileZoom}),this._source.hasTile&&(f=f.filter(G=>this._source.hasTile(G)))):f=[];const g=gt(t,this._source),w=Math.max(g-Tt.maxOverzooming,this._source.minzoom),I=Math.max(g+Tt.maxUnderzooming,this._source.minzoom);if(this.usedForTerrain){const G={};for(const X of f)if(X.canonical.z>this._source.minzoom){const W=X.scaledTo(X.canonical.z-1);G[W.key]=W;const te=X.scaledTo(Math.max(this._source.minzoom,Math.min(X.canonical.z,5)));G[te.key]=te}f=f.concat(Object.values(G))}const k=f.length===0&&!this._updated&&this._didEmitContent;this._updated=!0,k&&this.fire(new o.l("data",{sourceDataType:"idle",dataType:"source",sourceId:this.id}));const R=this._updateRetainedTiles(f,g);Ut(this._source.type)&&this._updateCoveredAndRetainedTiles(R,w,I,g,f,l);for(const G in R)this._tiles[G].clearFadeHold();const z=o.al(this._tiles,R);for(const G of z){const X=this._tiles[G];X.hasSymbolBuckets&&!X.holdingForFade()?X.setHoldDuration(this.map._fadeDuration):X.hasSymbolBuckets&&!X.symbolFadeFinished()||this._removeTile(G)}this._updateLoadedParentTileCache(),this._updateLoadedSiblingTileCache()}releaseSymbolFadeTiles(){for(const t in this._tiles)this._tiles[t].holdingForFade()&&this._removeTile(t)}_updateRetainedTiles(t,l){var f;const g={},w={},I=Math.max(l-Tt.maxOverzooming,this._source.minzoom),k=Math.max(l+Tt.maxUnderzooming,this._source.minzoom),R={};for(const z of t){const G=this._addTile(z);g[z.key]=z,G.hasData()||l<this._source.maxzoom&&(R[z.key]=z)}this._retainLoadedChildren(R,l,k,g);for(const z of t){let G=this._tiles[z.key];if(G.hasData())continue;if(l+1>this._source.maxzoom){const W=z.children(this._source.maxzoom)[0],te=this.getTile(W);if(te&&te.hasData()){g[W.key]=W;continue}}else{const W=z.children(this._source.maxzoom);if(g[W[0].key]&&g[W[1].key]&&g[W[2].key]&&g[W[3].key])continue}let X=G.wasRequested();for(let W=z.overscaledZ-1;W>=I;--W){const te=z.scaledTo(W);if(w[te.key])break;if(w[te.key]=!0,G=this.getTile(te),!G&&X&&(G=this._addTile(te)),G){const ae=G.hasData();if((ae||!(!((f=this.map)===null||f===void 0)&&f.cancelPendingTileRequestsWhileZooming)||X)&&(g[te.key]=te),X=G.wasRequested(),ae)break}}}return g}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(const t in this._tiles){const l=[];let f,g=this._tiles[t].tileID;for(;g.overscaledZ>0;){if(g.key in this._loadedParentTiles){f=this._loadedParentTiles[g.key];break}l.push(g.key);const w=g.scaledTo(g.overscaledZ-1);if(f=this._getLoadedTile(w),f)break;g=w}for(const w of l)this._loadedParentTiles[w]=f}}_updateLoadedSiblingTileCache(){this._loadedSiblingTiles={};for(const t in this._tiles){const l=this._tiles[t].tileID,f=this._getLoadedTile(l);this._loadedSiblingTiles[l.key]=f}}_addTile(t){let l=this._tiles[t.key];if(l)return l;l=this._cache.getAndRemove(t),l&&(this._setTileReloadTimer(t.key,l),l.tileID=t,this._state.initializeTileState(l,this.map?this.map.painter:null),this._cacheTimers[t.key]&&(clearTimeout(this._cacheTimers[t.key]),delete this._cacheTimers[t.key],this._setTileReloadTimer(t.key,l)));const f=l;return l||(l=new oi(t,this._source.tileSize*t.overscaleFactor()),this._loadTile(l,t.key,l.state)),l.uses++,this._tiles[t.key]=l,f||this._source.fire(new o.l("dataloading",{tile:l,coord:l.tileID,dataType:"source"})),l}_setTileReloadTimer(t,l){t in this._timers&&(clearTimeout(this._timers[t]),delete this._timers[t]);const f=l.getExpiryTimeout();f&&(this._timers[t]=setTimeout(()=>{this._reloadTile(t,"expired"),delete this._timers[t]},f))}refreshTiles(t){for(const l in this._tiles)(this._isIdRenderable(l)||this._tiles[l].state=="errored")&&t.some(f=>f.equals(this._tiles[l].tileID.canonical))&&this._reloadTile(l,"expired")}_removeTile(t){const l=this._tiles[t];l&&(l.uses--,delete this._tiles[t],this._timers[t]&&(clearTimeout(this._timers[t]),delete this._timers[t]),l.uses>0||(l.hasData()&&l.state!=="reloading"?this._cache.add(l.tileID,l,l.getExpiryTimeout()):(l.aborted=!0,this._abortTile(l),this._unloadTile(l))))}_dataHandler(t){const l=t.sourceDataType;t.dataType==="source"&&l==="metadata"&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&t.dataType==="source"&&l==="content"&&(this.reload(t.sourceDataChanged),this.transform&&this.update(this.transform,this.terrain),this._didEmitContent=!0)}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const t in this._tiles)this._removeTile(t);this._cache.reset()}tilesIn(t,l,f){const g=[],w=this.transform;if(!w)return g;const I=w.getCoveringTilesDetailsProvider().allowWorldCopies(),k=f?w.getCameraQueryGeometry(t):t,R=te=>w.screenPointToMercatorCoordinate(te,this.terrain),z=this.transformBbox(t,R,!I),G=this.transformBbox(k,R,!I),X=this.getIds(),W=o.a1.fromPoints(G);for(let te=0;te<X.length;te++){const ae=this._tiles[X[te]];if(ae.holdingForFade())continue;const Te=I?[ae.tileID]:[ae.tileID.unwrapTo(-1),ae.tileID.unwrapTo(0)],we=Math.pow(2,w.zoom-ae.tileID.overscaledZ),Ee=l*ae.queryPadding*o.$/ae.tileSize/we;for(const Ce of Te){const Fe=W.map(Oe=>Ce.getTilePoint(new o.a0(Oe.x,Oe.y)));if(Fe.expandBy(Ee),Fe.intersects(nt)){const Oe=z.map(We=>Ce.getTilePoint(We)),Ue=G.map(We=>Ce.getTilePoint(We));g.push({tile:ae,tileID:I?Ce:Ce.unwrapTo(0),queryGeometry:Oe,cameraQueryGeometry:Ue,scale:we})}}}return g}transformBbox(t,l,f){let g=t.map(l);if(f){const w=o.a1.fromPoints(t);w.shrinkBy(.001*Math.min(w.width(),w.height()));const I=w.map(l);o.a1.fromPoints(g).covers(I)||(g=g.map(k=>k.x>.5?new o.a0(k.x-1,k.y,k.z):k))}return g}getVisibleCoordinates(t){const l=this.getRenderableIds(t).map(f=>this._tiles[f].tileID);return this.transform&&this.transform.populateCache(l),l}hasTransition(){if(this._source.hasTransition())return!0;if(Ut(this._source.type)){const t=Y.now();for(const l in this._tiles)if(this._tiles[l].fadeEndTime>=t)return!0}return!1}setFeatureState(t,l,f){this._state.updateState(t=t||"_geojsonTileLayer",l,f)}removeFeatureState(t,l,f){this._state.removeFeatureState(t=t||"_geojsonTileLayer",l,f)}getFeatureState(t,l){return this._state.getState(t=t||"_geojsonTileLayer",l)}setDependencies(t,l,f){const g=this._tiles[t];g&&g.setDependencies(l,f)}reloadTilesForDependencies(t,l){for(const f in this._tiles)this._tiles[f].hasDependency(t,l)&&this._reloadTile(f,"reloading");this._cache.filter(f=>!f.hasDependency(t,l))}}function Ve(b,t){const l=Math.abs(2*b.wrap)-+(b.wrap<0),f=Math.abs(2*t.wrap)-+(t.wrap<0);return b.overscaledZ-t.overscaledZ||f-l||t.canonical.y-b.canonical.y||t.canonical.x-b.canonical.x}function Ut(b){return b==="raster"||b==="image"||b==="video"}Tt.maxOverzooming=10,Tt.maxUnderzooming=3;class bt{constructor(t,l){this.reset(t,l)}reset(t,l){this.points=t||[],this._distances=[0];for(let f=1;f<this.points.length;f++)this._distances[f]=this._distances[f-1]+this.points[f].dist(this.points[f-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(l||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(t){if(this.points.length===1)return this.points[0];t=o.ag(t,0,1);let l=1,f=this._distances[l];const g=t*this.paddedLength+this.padding;for(;f<g&&l<this._distances.length;)f=this._distances[++l];const w=l-1,I=this._distances[w],k=f-I,R=k>0?(g-I)/k:0;return this.points[w].mult(1-R).add(this.points[l].mult(R))}}function Ht(b,t){let l=!0;return b==="always"||b!=="never"&&t!=="never"||(l=!1),l}class li{constructor(t,l,f){const g=this.boxCells=[],w=this.circleCells=[];this.xCellCount=Math.ceil(t/f),this.yCellCount=Math.ceil(l/f);for(let I=0;I<this.xCellCount*this.yCellCount;I++)g.push([]),w.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=t,this.height=l,this.xScale=this.xCellCount/t,this.yScale=this.yCellCount/l,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(t,l,f,g,w){this._forEachCell(l,f,g,w,this._insertBoxCell,this.boxUid++),this.boxKeys.push(t),this.bboxes.push(l),this.bboxes.push(f),this.bboxes.push(g),this.bboxes.push(w)}insertCircle(t,l,f,g){this._forEachCell(l-g,f-g,l+g,f+g,this._insertCircleCell,this.circleUid++),this.circleKeys.push(t),this.circles.push(l),this.circles.push(f),this.circles.push(g)}_insertBoxCell(t,l,f,g,w,I){this.boxCells[w].push(I)}_insertCircleCell(t,l,f,g,w,I){this.circleCells[w].push(I)}_query(t,l,f,g,w,I,k){if(f<0||t>this.width||g<0||l>this.height)return[];const R=[];if(t<=0&&l<=0&&this.width<=f&&this.height<=g){if(w)return[{key:null,x1:t,y1:l,x2:f,y2:g}];for(let z=0;z<this.boxKeys.length;z++)R.push({key:this.boxKeys[z],x1:this.bboxes[4*z],y1:this.bboxes[4*z+1],x2:this.bboxes[4*z+2],y2:this.bboxes[4*z+3]});for(let z=0;z<this.circleKeys.length;z++){const G=this.circles[3*z],X=this.circles[3*z+1],W=this.circles[3*z+2];R.push({key:this.circleKeys[z],x1:G-W,y1:X-W,x2:G+W,y2:X+W})}}else this._forEachCell(t,l,f,g,this._queryCell,R,{hitTest:w,overlapMode:I,seenUids:{box:{},circle:{}}},k);return R}query(t,l,f,g){return this._query(t,l,f,g,!1,null)}hitTest(t,l,f,g,w,I){return this._query(t,l,f,g,!0,w,I).length>0}hitTestCircle(t,l,f,g,w){const I=t-f,k=t+f,R=l-f,z=l+f;if(k<0||I>this.width||z<0||R>this.height)return!1;const G=[];return this._forEachCell(I,R,k,z,this._queryCellCircle,G,{hitTest:!0,overlapMode:g,circle:{x:t,y:l,radius:f},seenUids:{box:{},circle:{}}},w),G.length>0}_queryCell(t,l,f,g,w,I,k,R){const{seenUids:z,hitTest:G,overlapMode:X}=k,W=this.boxCells[w];if(W!==null){const ae=this.bboxes;for(const Te of W)if(!z.box[Te]){z.box[Te]=!0;const we=4*Te,Ee=this.boxKeys[Te];if(t<=ae[we+2]&&l<=ae[we+3]&&f>=ae[we+0]&&g>=ae[we+1]&&(!R||R(Ee))&&(!G||!Ht(X,Ee.overlapMode))&&(I.push({key:Ee,x1:ae[we],y1:ae[we+1],x2:ae[we+2],y2:ae[we+3]}),G))return!0}}const te=this.circleCells[w];if(te!==null){const ae=this.circles;for(const Te of te)if(!z.circle[Te]){z.circle[Te]=!0;const we=3*Te,Ee=this.circleKeys[Te];if(this._circleAndRectCollide(ae[we],ae[we+1],ae[we+2],t,l,f,g)&&(!R||R(Ee))&&(!G||!Ht(X,Ee.overlapMode))){const Ce=ae[we],Fe=ae[we+1],Oe=ae[we+2];if(I.push({key:Ee,x1:Ce-Oe,y1:Fe-Oe,x2:Ce+Oe,y2:Fe+Oe}),G)return!0}}}return!1}_queryCellCircle(t,l,f,g,w,I,k,R){const{circle:z,seenUids:G,overlapMode:X}=k,W=this.boxCells[w];if(W!==null){const ae=this.bboxes;for(const Te of W)if(!G.box[Te]){G.box[Te]=!0;const we=4*Te,Ee=this.boxKeys[Te];if(this._circleAndRectCollide(z.x,z.y,z.radius,ae[we+0],ae[we+1],ae[we+2],ae[we+3])&&(!R||R(Ee))&&!Ht(X,Ee.overlapMode))return I.push(!0),!0}}const te=this.circleCells[w];if(te!==null){const ae=this.circles;for(const Te of te)if(!G.circle[Te]){G.circle[Te]=!0;const we=3*Te,Ee=this.circleKeys[Te];if(this._circlesCollide(ae[we],ae[we+1],ae[we+2],z.x,z.y,z.radius)&&(!R||R(Ee))&&!Ht(X,Ee.overlapMode))return I.push(!0),!0}}}_forEachCell(t,l,f,g,w,I,k,R){const z=this._convertToXCellCoord(t),G=this._convertToYCellCoord(l),X=this._convertToXCellCoord(f),W=this._convertToYCellCoord(g);for(let te=z;te<=X;te++)for(let ae=G;ae<=W;ae++)if(w.call(this,t,l,f,g,this.xCellCount*ae+te,I,k,R))return}_convertToXCellCoord(t){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(t*this.xScale)))}_convertToYCellCoord(t){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(t*this.yScale)))}_circlesCollide(t,l,f,g,w,I){const k=g-t,R=w-l,z=f+I;return z*z>k*k+R*R}_circleAndRectCollide(t,l,f,g,w,I,k){const R=(I-g)/2,z=Math.abs(t-(g+R));if(z>R+f)return!1;const G=(k-w)/2,X=Math.abs(l-(w+G));if(X>G+f)return!1;if(z<=R||X<=G)return!0;const W=z-R,te=X-G;return W*W+te*te<=f*f}}function Ci(b,t,l){const f=o.L();if(!b){const{vecSouth:X,vecEast:W}=ur(t),te=L();te[0]=W[0],te[1]=W[1],te[2]=X[0],te[3]=X[1],g=te,(G=(I=(w=te)[0])*(z=w[3])-(R=w[2])*(k=w[1]))&&(g[0]=z*(G=1/G),g[1]=-k*G,g[2]=-R*G,g[3]=I*G),f[0]=te[0],f[1]=te[1],f[4]=te[2],f[5]=te[3]}var g,w,I,k,R,z,G;return o.N(f,f,[1/l,1/l,1]),f}function br(b,t,l,f){if(b){const g=o.L();if(!t){const{vecSouth:w,vecEast:I}=ur(l);g[0]=I[0],g[1]=I[1],g[4]=w[0],g[5]=w[1]}return o.N(g,g,[f,f,1]),g}return l.pixelsToClipSpaceMatrix}function ur(b){const t=Math.cos(b.rollInRadians),l=Math.sin(b.rollInRadians),f=Math.cos(b.pitchInRadians),g=Math.cos(b.bearingInRadians),w=Math.sin(b.bearingInRadians),I=o.aq();I[0]=-g*f*l-w*t,I[1]=-w*f*l+g*t;const k=o.ar(I);k<1e-9?o.as(I):o.at(I,I,1/k);const R=o.aq();R[0]=g*f*t-w*l,R[1]=w*f*t+g*l;const z=o.ar(R);return z<1e-9?o.as(R):o.at(R,R,1/z),{vecEast:R,vecSouth:I}}function Ui(b,t,l,f){let g;f?(g=[b,t,f(b,t),1],o.av(g,g,l)):(g=[b,t,0,1],vn(g,g,l));const w=g[3];return{point:new o.P(g[0]/w,g[1]/w),signedDistanceFromCamera:w,isOccluded:!1}}function Mi(b,t){return .5+b/t*.5}function Hi(b,t){return b.x>=-t[0]&&b.x<=t[0]&&b.y>=-t[1]&&b.y<=t[1]}function Lr(b,t,l,f,g,w,I,k,R,z,G,X,W){const te=l?b.textSizeData:b.iconSizeData,ae=o.am(te,t.transform.zoom),Te=[256/t.width*2+1,256/t.height*2+1],we=l?b.text.dynamicLayoutVertexArray:b.icon.dynamicLayoutVertexArray;we.clear();const Ee=b.lineVertexArray,Ce=l?b.text.placedSymbolArray:b.icon.placedSymbolArray,Fe=t.transform.width/t.transform.height;let Oe=!1;for(let Ue=0;Ue<Ce.length;Ue++){const We=Ce.get(Ue);if(We.hidden||We.writingMode===o.an.vertical&&!Oe){Wr(We.numGlyphs,we);continue}Oe=!1;const De=new o.P(We.anchorX,We.anchorY),Qe={getElevation:W,pitchedLabelPlaneMatrix:f,lineVertexArray:Ee,pitchWithMap:w,projectionCache:{projections:{},offsets:{},cachedAnchorPoint:void 0,anyProjectionOccluded:!1},transform:t.transform,tileAnchorPoint:De,unwrappedTileID:R,width:z,height:G,translation:X},yt=it(We.anchorX,We.anchorY,Qe);if(!Hi(yt.point,Te)){Wr(We.numGlyphs,we);continue}const ct=Mi(t.transform.cameraToCenterDistance,yt.signedDistanceFromCamera),dt=o.ao(te,ae,We),_t=w?dt*t.transform.getPitchedTextCorrection(We.anchorX,We.anchorY,R)/ct:dt*ct,qt=Sr({projectionContext:Qe,pitchedLabelPlaneMatrixInverse:g,symbol:We,fontSize:_t,flip:!1,keepUpright:I,glyphOffsetArray:b.glyphOffsetArray,dynamicLayoutVertexArray:we,aspectRatio:Fe,rotateToLine:k});Oe=qt.useVertical,(qt.notEnoughRoom||Oe||qt.needsFlipping&&Sr({projectionContext:Qe,pitchedLabelPlaneMatrixInverse:g,symbol:We,fontSize:_t,flip:!0,keepUpright:I,glyphOffsetArray:b.glyphOffsetArray,dynamicLayoutVertexArray:we,aspectRatio:Fe,rotateToLine:k}).notEnoughRoom)&&Wr(We.numGlyphs,we)}l?b.text.dynamicLayoutVertexBuffer.updateData(we):b.icon.dynamicLayoutVertexBuffer.updateData(we)}function Rt(b,t,l,f,g,w,I,k){const R=w.glyphStartIndex+w.numGlyphs,z=w.lineStartIndex,G=w.lineStartIndex+w.lineLength,X=t.getoffsetX(w.glyphStartIndex),W=t.getoffsetX(R-1),te=Er(b*X,l,f,g,w.segment,z,G,k,I);if(!te)return null;const ae=Er(b*W,l,f,g,w.segment,z,G,k,I);return ae?k.projectionCache.anyProjectionOccluded?null:{first:te,last:ae}:null}function Kr(b,t,l,f){return b===o.an.horizontal&&Math.abs(l.y-t.y)>Math.abs(l.x-t.x)*f?{useVertical:!0}:(b===o.an.vertical?t.y<l.y:t.x>l.x)?{needsFlipping:!0}:null}function Sr(b){const{projectionContext:t,pitchedLabelPlaneMatrixInverse:l,symbol:f,fontSize:g,flip:w,keepUpright:I,glyphOffsetArray:k,dynamicLayoutVertexArray:R,aspectRatio:z,rotateToLine:G}=b,X=g/24,W=f.lineOffsetX*X,te=f.lineOffsetY*X;let ae;if(f.numGlyphs>1){const Te=f.glyphStartIndex+f.numGlyphs,we=f.lineStartIndex,Ee=f.lineStartIndex+f.lineLength,Ce=Rt(X,k,W,te,w,f,G,t);if(!Ce)return{notEnoughRoom:!0};const Fe=xi(Ce.first.point.x,Ce.first.point.y,t,l),Oe=xi(Ce.last.point.x,Ce.last.point.y,t,l);if(I&&!w){const Ue=Kr(f.writingMode,Fe,Oe,z);if(Ue)return Ue}ae=[Ce.first];for(let Ue=f.glyphStartIndex+1;Ue<Te-1;Ue++){const We=Er(X*k.getoffsetX(Ue),W,te,w,f.segment,we,Ee,t,G);if(!We)return{notEnoughRoom:!0};ae.push(We)}ae.push(Ce.last)}else{if(I&&!w){const we=Bt(t.tileAnchorPoint.x,t.tileAnchorPoint.y,t).point,Ee=f.lineStartIndex+f.segment+1,Ce=new o.P(t.lineVertexArray.getx(Ee),t.lineVertexArray.gety(Ee)),Fe=Bt(Ce.x,Ce.y,t),Oe=Fe.signedDistanceFromCamera>0?Fe.point:Or(t.tileAnchorPoint,Ce,we,1,t),Ue=xi(we.x,we.y,t,l),We=xi(Oe.x,Oe.y,t,l),De=Kr(f.writingMode,Ue,We,z);if(De)return De}const Te=Er(X*k.getoffsetX(f.glyphStartIndex),W,te,w,f.segment,f.lineStartIndex,f.lineStartIndex+f.lineLength,t,G);if(!Te||t.projectionCache.anyProjectionOccluded)return{notEnoughRoom:!0};ae=[Te]}for(const Te of ae)o.au(R,Te.point,Te.angle);return{}}function Or(b,t,l,f,g){const w=b.add(b.sub(t)._unit()),I=Bt(w.x,w.y,g).point,k=l.sub(I);return l.add(k._mult(f/k.mag()))}function Ps(b,t,l){const f=t.projectionCache;if(f.projections[b])return f.projections[b];const g=new o.P(t.lineVertexArray.getx(b),t.lineVertexArray.gety(b)),w=Bt(g.x,g.y,t);if(w.signedDistanceFromCamera>0)return f.projections[b]=w.point,f.anyProjectionOccluded=f.anyProjectionOccluded||w.isOccluded,w.point;const I=b-l.direction;return Or(l.distanceFromAnchor===0?t.tileAnchorPoint:new o.P(t.lineVertexArray.getx(I),t.lineVertexArray.gety(I)),g,l.previousVertex,l.absOffsetX-l.distanceFromAnchor+1,t)}function Bt(b,t,l){const f=b+l.translation[0],g=t+l.translation[1];let w;return l.pitchWithMap?(w=Ui(f,g,l.pitchedLabelPlaneMatrix,l.getElevation),w.isOccluded=!1):(w=l.transform.projectTileCoordinates(f,g,l.unwrappedTileID,l.getElevation),w.point.x=(.5*w.point.x+.5)*l.width,w.point.y=(.5*-w.point.y+.5)*l.height),w}function xi(b,t,l,f){if(l.pitchWithMap){const g=[b,t,0,1];return o.av(g,g,f),l.transform.projectTileCoordinates(g[0]/g[3],g[1]/g[3],l.unwrappedTileID,l.getElevation).point}return{x:b/l.width*2-1,y:1-t/l.height*2}}function it(b,t,l){return l.transform.projectTileCoordinates(b,t,l.unwrappedTileID,l.getElevation)}function Wi(b,t,l){return b._unit()._perp()._mult(t*l)}function Dr(b,t,l,f,g,w,I,k,R){if(k.projectionCache.offsets[b])return k.projectionCache.offsets[b];const z=l.add(t);if(b+R.direction<f||b+R.direction>=g)return k.projectionCache.offsets[b]=z,z;const G=Ps(b+R.direction,k,R),X=Wi(G.sub(l),I,R.direction),W=l.add(X),te=G.add(X);return k.projectionCache.offsets[b]=o.aw(w,z,W,te)||z,k.projectionCache.offsets[b]}function Er(b,t,l,f,g,w,I,k,R){const z=f?b-t:b+t;let G=z>0?1:-1,X=0;f&&(G*=-1,X=Math.PI),G<0&&(X+=Math.PI);let W,te=G>0?w+g:w+g+1;k.projectionCache.cachedAnchorPoint?W=k.projectionCache.cachedAnchorPoint:(W=Bt(k.tileAnchorPoint.x,k.tileAnchorPoint.y,k).point,k.projectionCache.cachedAnchorPoint=W);let ae,Te,we=W,Ee=W,Ce=0,Fe=0;const Oe=Math.abs(z),Ue=[];let We;for(;Ce+Fe<=Oe;){if(te+=G,te<w||te>=I)return null;Ce+=Fe,Ee=we,Te=ae;const yt={absOffsetX:Oe,direction:G,distanceFromAnchor:Ce,previousVertex:Ee};if(we=Ps(te,k,yt),l===0)Ue.push(Ee),We=we.sub(Ee);else{let ct;const dt=we.sub(Ee);ct=dt.mag()===0?Wi(Ps(te+G,k,yt).sub(we),l,G):Wi(dt,l,G),Te||(Te=Ee.add(ct)),ae=Dr(te,ct,we,w,I,Te,l,k,yt),Ue.push(Te),We=ae.sub(Te)}Fe=We.mag()}const De=We._mult((Oe-Ce)/Fe)._add(Te||Ee),Qe=X+Math.atan2(we.y-Ee.y,we.x-Ee.x);return Ue.push(De),{point:De,angle:R?Qe:0,path:Ue}}const ri=new Float32Array([-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0]);function Wr(b,t){for(let l=0;l<b;l++){const f=t.length;t.resize(f+4),t.float32.set(ri,3*f)}}function vn(b,t,l){const f=t[0],g=t[1];return b[0]=l[0]*f+l[4]*g+l[12],b[1]=l[1]*f+l[5]*g+l[13],b[3]=l[3]*f+l[7]*g+l[15],b}const Ai=100;class Sn{constructor(t,l=new li(t.width+200,t.height+200,25),f=new li(t.width+200,t.height+200,25)){this.transform=t,this.grid=l,this.ignoredGrid=f,this.pitchFactor=Math.cos(t.pitch*Math.PI/180)*t.cameraToCenterDistance,this.screenRightBoundary=t.width+Ai,this.screenBottomBoundary=t.height+Ai,this.gridRightBoundary=t.width+200,this.gridBottomBoundary=t.height+200,this.perspectiveRatioCutoff=.6}placeCollisionBox(t,l,f,g,w,I,k,R,z,G,X,W){const te=this.projectAndGetPerspectiveRatio(t.anchorPointX+R[0],t.anchorPointY+R[1],w,G,W),ae=f*te.perspectiveRatio;let Te;if(I||k)Te=this._projectCollisionBox(t,ae,g,w,I,k,R,te,G,X,W);else{const We=te.x+(X?X.x*ae:0),De=te.y+(X?X.y*ae:0);Te={allPointsOccluded:!1,box:[We+t.x1*ae,De+t.y1*ae,We+t.x2*ae,De+t.y2*ae]}}const[we,Ee,Ce,Fe]=Te.box,Oe=I?Te.allPointsOccluded:te.isOccluded;let Ue=Oe;return Ue||(Ue=te.perspectiveRatio<this.perspectiveRatioCutoff),Ue||(Ue=!this.isInsideGrid(we,Ee,Ce,Fe)),Ue||l!=="always"&&this.grid.hitTest(we,Ee,Ce,Fe,l,z)?{box:[we,Ee,Ce,Fe],placeable:!1,offscreen:!1,occluded:Oe}:{box:[we,Ee,Ce,Fe],placeable:!0,offscreen:this.isOffscreen(we,Ee,Ce,Fe),occluded:Oe}}placeCollisionCircles(t,l,f,g,w,I,k,R,z,G,X,W,te,ae){const Te=[],we=new o.P(l.anchorX,l.anchorY),Ee=this.getPerspectiveRatio(we.x,we.y,I,ae),Ce=(z?w*this.transform.getPitchedTextCorrection(l.anchorX,l.anchorY,I)/Ee:w*Ee)/o.aA,Fe={getElevation:ae,pitchedLabelPlaneMatrix:k,lineVertexArray:f,pitchWithMap:z,projectionCache:{projections:{},offsets:{},cachedAnchorPoint:void 0,anyProjectionOccluded:!1},transform:this.transform,tileAnchorPoint:we,unwrappedTileID:I,width:this.transform.width,height:this.transform.height,translation:te},Oe=Rt(Ce,g,l.lineOffsetX*Ce,l.lineOffsetY*Ce,!1,l,!1,Fe);let Ue=!1,We=!1,De=!0;if(Oe){const Qe=.5*X*Ee+W,yt=new o.P(-100,-100),ct=new o.P(this.screenRightBoundary,this.screenBottomBoundary),dt=new bt,_t=Oe.first,qt=Oe.last;let Vt=[];for(let Ji=_t.path.length-1;Ji>=1;Ji--)Vt.push(_t.path[Ji]);for(let Ji=1;Ji<qt.path.length;Ji++)Vt.push(qt.path[Ji]);const kt=2.5*Qe;if(z){const Ji=this.projectPathToScreenSpace(Vt,Fe);Vt=Ji.some(Pr=>Pr.signedDistanceFromCamera<=0)?[]:Ji.map(Pr=>Pr.point)}let hi=[];if(Vt.length>0){const Ji=Vt[0].clone(),Pr=Vt[0].clone();for(let on=1;on<Vt.length;on++)Ji.x=Math.min(Ji.x,Vt[on].x),Ji.y=Math.min(Ji.y,Vt[on].y),Pr.x=Math.max(Pr.x,Vt[on].x),Pr.y=Math.max(Pr.y,Vt[on].y);hi=Ji.x>=yt.x&&Pr.x<=ct.x&&Ji.y>=yt.y&&Pr.y<=ct.y?[Vt]:Pr.x<yt.x||Ji.x>ct.x||Pr.y<yt.y||Ji.y>ct.y?[]:o.ax([Vt],yt.x,yt.y,ct.x,ct.y)}for(const Ji of hi){dt.reset(Ji,.25*Qe);let Pr=0;Pr=dt.length<=.5*Qe?1:Math.ceil(dt.paddedLength/kt)+1;for(let on=0;on<Pr;on++){const zr=on/Math.max(Pr-1,1),an=dt.lerp(zr),Gr=an.x+Ai,Br=an.y+Ai;Te.push(Gr,Br,Qe,0);const Ur=Gr-Qe,ds=Br-Qe,xr=Gr+Qe,Jn=Br+Qe;if(De=De&&this.isOffscreen(Ur,ds,xr,Jn),We=We||this.isInsideGrid(Ur,ds,xr,Jn),t!=="always"&&this.grid.hitTestCircle(Gr,Br,Qe,t,G)&&(Ue=!0,!R))return{circles:[],offscreen:!1,collisionDetected:Ue}}}}return{circles:!R&&Ue||!We||Ee<this.perspectiveRatioCutoff?[]:Te,offscreen:De,collisionDetected:Ue}}projectPathToScreenSpace(t,l){const f=function(g,w){const I=o.L();return o.ap(I,w.pitchedLabelPlaneMatrix),g.map(k=>{const R=Ui(k.x,k.y,I,w.getElevation),z=w.transform.projectTileCoordinates(R.point.x,R.point.y,w.unwrappedTileID,w.getElevation);return z.point.x=(.5*z.point.x+.5)*w.width,z.point.y=(.5*-z.point.y+.5)*w.height,z})}(t,l);return function(g){let w=0,I=0,k=0,R=0;for(let z=0;z<g.length;z++)g[z].isOccluded?(k=z+1,R=0):(R++,R>I&&(I=R,w=k));return g.slice(w,w+I)}(f)}queryRenderedSymbols(t){if(t.length===0||this.grid.keysLength()===0&&this.ignoredGrid.keysLength()===0)return{};const l=[],f=new o.a1;for(const X of t){const W=new o.P(X.x+Ai,X.y+Ai);f.extend(W),l.push(W)}const{minX:g,minY:w,maxX:I,maxY:k}=f,R=this.grid.query(g,w,I,k).concat(this.ignoredGrid.query(g,w,I,k)),z={},G={};for(const X of R){const W=X.key;if(z[W.bucketInstanceId]===void 0&&(z[W.bucketInstanceId]={}),z[W.bucketInstanceId][W.featureIndex])continue;const te=[new o.P(X.x1,X.y1),new o.P(X.x2,X.y1),new o.P(X.x2,X.y2),new o.P(X.x1,X.y2)];o.ay(l,te)&&(z[W.bucketInstanceId][W.featureIndex]=!0,G[W.bucketInstanceId]===void 0&&(G[W.bucketInstanceId]=[]),G[W.bucketInstanceId].push(W.featureIndex))}return G}insertCollisionBox(t,l,f,g,w,I){(f?this.ignoredGrid:this.grid).insert({bucketInstanceId:g,featureIndex:w,collisionGroupID:I,overlapMode:l},t[0],t[1],t[2],t[3])}insertCollisionCircles(t,l,f,g,w,I){const k=f?this.ignoredGrid:this.grid,R={bucketInstanceId:g,featureIndex:w,collisionGroupID:I,overlapMode:l};for(let z=0;z<t.length;z+=4)k.insertCircle(R,t[z],t[z+1],t[z+2])}projectAndGetPerspectiveRatio(t,l,f,g,w){if(w){let I;g?(I=[t,l,g(t,l),1],o.av(I,I,w)):(I=[t,l,0,1],vn(I,I,w));const k=I[3];return{x:(I[0]/k+1)/2*this.transform.width+Ai,y:(-I[1]/k+1)/2*this.transform.height+Ai,perspectiveRatio:.5+this.transform.cameraToCenterDistance/k*.5,isOccluded:!1,signedDistanceFromCamera:k}}{const I=this.transform.projectTileCoordinates(t,l,f,g);return{x:(I.point.x+1)/2*this.transform.width+Ai,y:(1-I.point.y)/2*this.transform.height+Ai,perspectiveRatio:.5+this.transform.cameraToCenterDistance/I.signedDistanceFromCamera*.5,isOccluded:I.isOccluded,signedDistanceFromCamera:I.signedDistanceFromCamera}}}getPerspectiveRatio(t,l,f,g){const w=this.transform.projectTileCoordinates(t,l,f,g);return .5+this.transform.cameraToCenterDistance/w.signedDistanceFromCamera*.5}isOffscreen(t,l,f,g){return f<Ai||t>=this.screenRightBoundary||g<Ai||l>this.screenBottomBoundary}isInsideGrid(t,l,f,g){return f>=0&&t<this.gridRightBoundary&&g>=0&&l<this.gridBottomBoundary}getViewportMatrix(){const t=o.af([]);return o.M(t,t,[-100,-100,0]),t}_projectCollisionBox(t,l,f,g,w,I,k,R,z,G,X){let W=1,te=0,ae=0,Te=1;const we=t.anchorPointX+k[0],Ee=t.anchorPointY+k[1];if(I&&!w){const Vt=this.projectAndGetPerspectiveRatio(we+1,Ee,g,z,X),kt=Vt.x-R.x,hi=Math.atan((Vt.y-R.y)/kt)+(kt<0?Math.PI:0),Ji=Math.sin(hi),Pr=Math.cos(hi);W=Pr,te=Ji,ae=-Ji,Te=Pr}else if(!I&&w){const Vt=ur(this.transform);W=Vt.vecEast[0],te=Vt.vecEast[1],ae=Vt.vecSouth[0],Te=Vt.vecSouth[1]}let Ce=R.x,Fe=R.y,Oe=l;w&&(Ce=we,Fe=Ee,Oe=Math.pow(2,-(this.transform.zoom-f.overscaledZ)),Oe*=this.transform.getPitchedTextCorrection(we,Ee,g),G||(Oe*=o.ag(.5+R.signedDistanceFromCamera/this.transform.cameraToCenterDistance*.5,0,4))),G&&(Ce+=W*G.x*Oe+ae*G.y*Oe,Fe+=te*G.x*Oe+Te*G.y*Oe);const Ue=t.x1*Oe,We=t.x2*Oe,De=(Ue+We)/2,Qe=t.y1*Oe,yt=t.y2*Oe,ct=(Qe+yt)/2,dt=[{offsetX:Ue,offsetY:Qe},{offsetX:De,offsetY:Qe},{offsetX:We,offsetY:Qe},{offsetX:We,offsetY:ct},{offsetX:We,offsetY:yt},{offsetX:De,offsetY:yt},{offsetX:Ue,offsetY:yt},{offsetX:Ue,offsetY:ct}];let _t=[];for(const{offsetX:Vt,offsetY:kt}of dt)_t.push(new o.P(Ce+W*Vt+ae*kt,Fe+te*Vt+Te*kt));let qt=!1;if(w){const Vt=_t.map(kt=>this.projectAndGetPerspectiveRatio(kt.x,kt.y,g,z,X));qt=Vt.some(kt=>!kt.isOccluded),_t=Vt.map(kt=>new o.P(kt.x,kt.y))}else qt=!0;return{box:o.az(_t),allPointsOccluded:!qt}}}class Yr{constructor(t,l,f,g){this.opacity=t?Math.max(0,Math.min(1,t.opacity+(t.placed?l:-l))):g&&f?1:0,this.placed=f}isHidden(){return this.opacity===0&&!this.placed}}class gr{constructor(t,l,f,g,w){this.text=new Yr(t?t.text:null,l,f,w),this.icon=new Yr(t?t.icon:null,l,g,w)}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class Xn{constructor(t,l,f){this.text=t,this.icon=l,this.skipFade=f}}class Mn{constructor(t,l,f,g,w){this.bucketInstanceId=t,this.featureIndex=l,this.sourceLayerIndex=f,this.bucketIndex=g,this.tileID=w}}class qi{constructor(t){this.crossSourceCollisions=t,this.maxGroupID=0,this.collisionGroups={}}get(t){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[t]){const l=++this.maxGroupID;this.collisionGroups[t]={ID:l,predicate:f=>f.collisionGroupID===l}}return this.collisionGroups[t]}}function xn(b,t,l,f,g){const{horizontalAlign:w,verticalAlign:I}=o.aG(b);return new o.P(-(w-.5)*t+f[0]*g,-(I-.5)*l+f[1]*g)}class $n{constructor(t,l,f,g,w){this.transform=t.clone(),this.terrain=l,this.collisionIndex=new Sn(this.transform),this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=f,this.retainedQueryData={},this.collisionGroups=new qi(g),this.collisionCircleArrays={},this.collisionBoxArrays=new Map,this.prevPlacement=w,w&&(w.prevPlacement=void 0),this.placedOrientations={}}_getTerrainElevationFunc(t){const l=this.terrain;return l?(f,g)=>l.getElevation(t,f,g):null}getBucketParts(t,l,f,g){const w=f.getBucket(l),I=f.latestFeatureIndex;if(!w||!I||l.id!==w.layerIds[0])return;const k=f.collisionBoxArray,R=w.layers[0].layout,z=w.layers[0].paint,G=Math.pow(2,this.transform.zoom-f.tileID.overscaledZ),X=f.tileSize/o.$,W=f.tileID.toUnwrapped(),te=R.get("text-rotation-alignment")==="map",ae=o.aB(f,1,this.transform.zoom),Te=o.aC(this.collisionIndex.transform,f,z.get("text-translate"),z.get("text-translate-anchor")),we=o.aC(this.collisionIndex.transform,f,z.get("icon-translate"),z.get("icon-translate-anchor")),Ee=Ci(te,this.transform,ae);this.retainedQueryData[w.bucketInstanceId]=new Mn(w.bucketInstanceId,I,w.sourceLayerIndex,w.index,f.tileID);const Ce={bucket:w,layout:R,translationText:Te,translationIcon:we,unwrappedTileID:W,pitchedLabelPlaneMatrix:Ee,scale:G,textPixelRatio:X,holdingForFade:f.holdingForFade(),collisionBoxArray:k,partiallyEvaluatedTextSize:o.am(w.textSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(w.sourceID)};if(g)for(const Fe of w.sortKeyRanges){const{sortKey:Oe,symbolInstanceStart:Ue,symbolInstanceEnd:We}=Fe;t.push({sortKey:Oe,symbolInstanceStart:Ue,symbolInstanceEnd:We,parameters:Ce})}else t.push({symbolInstanceStart:0,symbolInstanceEnd:w.symbolInstances.length,parameters:Ce})}attemptAnchorPlacement(t,l,f,g,w,I,k,R,z,G,X,W,te,ae,Te,we,Ee,Ce,Fe,Oe){const Ue=o.aD[t.textAnchor],We=[t.textOffset0,t.textOffset1],De=xn(Ue,f,g,We,w),Qe=this.collisionIndex.placeCollisionBox(l,W,R,z,G,k,I,we,X.predicate,Fe,De,Oe);if((!Ce||this.collisionIndex.placeCollisionBox(Ce,W,R,z,G,k,I,Ee,X.predicate,Fe,De,Oe).placeable)&&Qe.placeable){let yt;if(this.prevPlacement&&this.prevPlacement.variableOffsets[te.crossTileID]&&this.prevPlacement.placements[te.crossTileID]&&this.prevPlacement.placements[te.crossTileID].text&&(yt=this.prevPlacement.variableOffsets[te.crossTileID].anchor),te.crossTileID===0)throw new Error("symbolInstance.crossTileID can't be 0");return this.variableOffsets[te.crossTileID]={textOffset:We,width:f,height:g,anchor:Ue,textBoxScale:w,prevAnchor:yt},this.markUsedJustification(ae,Ue,te,Te),ae.allowVerticalPlacement&&(this.markUsedOrientation(ae,Te,te),this.placedOrientations[te.crossTileID]=Te),{shift:De,placedGlyphBoxes:Qe}}}placeLayerBucketPart(t,l,f){const{bucket:g,layout:w,translationText:I,translationIcon:k,unwrappedTileID:R,pitchedLabelPlaneMatrix:z,textPixelRatio:G,holdingForFade:X,collisionBoxArray:W,partiallyEvaluatedTextSize:te,collisionGroup:ae}=t.parameters,Te=w.get("text-optional"),we=w.get("icon-optional"),Ee=o.aE(w,"text-overlap","text-allow-overlap"),Ce=Ee==="always",Fe=o.aE(w,"icon-overlap","icon-allow-overlap"),Oe=Fe==="always",Ue=w.get("text-rotation-alignment")==="map",We=w.get("text-pitch-alignment")==="map",De=w.get("icon-text-fit")!=="none",Qe=w.get("symbol-z-order")==="viewport-y",yt=Ce&&(Oe||!g.hasIconData()||we),ct=Oe&&(Ce||!g.hasTextData()||Te);!g.collisionArrays&&W&&g.deserializeCollisionBoxes(W);const dt=this.retainedQueryData[g.bucketInstanceId].tileID,_t=this._getTerrainElevationFunc(dt),qt=this.transform.getFastPathSimpleProjectionMatrix(dt),Vt=(kt,hi,Ji)=>{var Pr,on;if(l[kt.crossTileID])return;if(X)return void(this.placements[kt.crossTileID]=new Xn(!1,!1,!1));let zr=!1,an=!1,Gr=!0,Br=null,Ur={box:null,placeable:!1,offscreen:null,occluded:!1},ds={placeable:!1},xr=null,Jn=null,Ts=null,Xa=0,Ha=0,Ka=0;hi.textFeatureIndex?Xa=hi.textFeatureIndex:kt.useRuntimeCollisionCircles&&(Xa=kt.featureIndex),hi.verticalTextFeatureIndex&&(Ha=hi.verticalTextFeatureIndex);const la=hi.textBox;if(la){const Ws=wn=>{let Xr=o.an.horizontal;if(g.allowVerticalPlacement&&!wn&&this.prevPlacement){const zs=this.prevPlacement.placedOrientations[kt.crossTileID];zs&&(this.placedOrientations[kt.crossTileID]=zs,Xr=zs,this.markUsedOrientation(g,Xr,kt))}return Xr},Fo=(wn,Xr)=>{if(g.allowVerticalPlacement&&kt.numVerticalGlyphVertices>0&&hi.verticalTextBox){for(const zs of g.writingModes)if(zs===o.an.vertical?(Ur=Xr(),ds=Ur):Ur=wn(),Ur&&Ur.placeable)break}else Ur=wn()},Ja=kt.textAnchorOffsetStartIndex,wl=kt.textAnchorOffsetEndIndex;if(wl===Ja){const wn=(Xr,zs)=>{const Vn=this.collisionIndex.placeCollisionBox(Xr,Ee,G,dt,R,We,Ue,I,ae.predicate,_t,void 0,qt);return Vn&&Vn.placeable&&(this.markUsedOrientation(g,zs,kt),this.placedOrientations[kt.crossTileID]=zs),Vn};Fo(()=>wn(la,o.an.horizontal),()=>{const Xr=hi.verticalTextBox;return g.allowVerticalPlacement&&kt.numVerticalGlyphVertices>0&&Xr?wn(Xr,o.an.vertical):{box:null,offscreen:null}}),Ws(Ur&&Ur.placeable)}else{let wn=o.aD[(on=(Pr=this.prevPlacement)===null||Pr===void 0?void 0:Pr.variableOffsets[kt.crossTileID])===null||on===void 0?void 0:on.anchor];const Xr=(Vn,zp,sg)=>{const Xh=Vn.x2-Vn.x1,ec=Vn.y2-Vn.y1,fu=kt.textBoxScale,wa=De&&Fe==="never"?zp:null;let ps=null,Ta=Ee==="never"?1:2,Hh="never";wn&&Ta++;for(let Qa=0;Qa<Ta;Qa++){for(let Kh=Ja;Kh<wl;Kh++){const Jh=g.textAnchorOffsets.get(Kh);if(wn&&Jh.textAnchor!==wn)continue;const tc=this.attemptAnchorPlacement(Jh,Vn,Xh,ec,fu,Ue,We,G,dt,R,ae,Hh,kt,g,sg,I,k,wa,_t);if(tc&&(ps=tc.placedGlyphBoxes,ps&&ps.placeable))return zr=!0,Br=tc.shift,ps}wn?wn=null:Hh=Ee}return f&&!ps&&(ps={box:this.collisionIndex.placeCollisionBox(la,"always",G,dt,R,We,Ue,I,ae.predicate,_t,void 0,qt).box,offscreen:!1,placeable:!1,occluded:!1}),ps};Fo(()=>Xr(la,hi.iconBox,o.an.horizontal),()=>{const Vn=hi.verticalTextBox;return g.allowVerticalPlacement&&(!Ur||!Ur.placeable)&&kt.numVerticalGlyphVertices>0&&Vn?Xr(Vn,hi.verticalIconBox,o.an.vertical):{box:null,occluded:!0,offscreen:null}}),Ur&&(zr=Ur.placeable,Gr=Ur.offscreen);const zs=Ws(Ur&&Ur.placeable);if(!zr&&this.prevPlacement){const Vn=this.prevPlacement.variableOffsets[kt.crossTileID];Vn&&(this.variableOffsets[kt.crossTileID]=Vn,this.markUsedJustification(g,Vn.anchor,kt,zs))}}}if(xr=Ur,zr=xr&&xr.placeable,Gr=xr&&xr.offscreen,kt.useRuntimeCollisionCircles){const Ws=g.text.placedSymbolArray.get(kt.centerJustifiedTextSymbolIndex),Fo=o.ao(g.textSizeData,te,Ws),Ja=w.get("text-padding");Jn=this.collisionIndex.placeCollisionCircles(Ee,Ws,g.lineVertexArray,g.glyphOffsetArray,Fo,R,z,f,We,ae.predicate,kt.collisionCircleDiameter,Ja,I,_t),Jn.circles.length&&Jn.collisionDetected&&!f&&o.w("Collisions detected, but collision boxes are not shown"),zr=Ce||Jn.circles.length>0&&!Jn.collisionDetected,Gr=Gr&&Jn.offscreen}if(hi.iconFeatureIndex&&(Ka=hi.iconFeatureIndex),hi.iconBox){const Ws=Fo=>this.collisionIndex.placeCollisionBox(Fo,Fe,G,dt,R,We,Ue,k,ae.predicate,_t,De&&Br?Br:void 0,qt);ds&&ds.placeable&&hi.verticalIconBox?(Ts=Ws(hi.verticalIconBox),an=Ts.placeable):(Ts=Ws(hi.iconBox),an=Ts.placeable),Gr=Gr&&Ts.offscreen}const Ju=Te||kt.numHorizontalGlyphVertices===0&&kt.numVerticalGlyphVertices===0,Qu=we||kt.numIconVertices===0;Ju||Qu?Qu?Ju||(an=an&&zr):zr=an&&zr:an=zr=an&&zr;const pu=an&&Ts.placeable;if(zr&&xr.placeable&&this.collisionIndex.insertCollisionBox(xr.box,Ee,w.get("text-ignore-placement"),g.bucketInstanceId,ds&&ds.placeable&&Ha?Ha:Xa,ae.ID),pu&&this.collisionIndex.insertCollisionBox(Ts.box,Fe,w.get("icon-ignore-placement"),g.bucketInstanceId,Ka,ae.ID),Jn&&zr&&this.collisionIndex.insertCollisionCircles(Jn.circles,Ee,w.get("text-ignore-placement"),g.bucketInstanceId,Xa,ae.ID),f&&this.storeCollisionData(g.bucketInstanceId,Ji,hi,xr,Ts,Jn),kt.crossTileID===0)throw new Error("symbolInstance.crossTileID can't be 0");if(g.bucketInstanceId===0)throw new Error("bucket.bucketInstanceId can't be 0");this.placements[kt.crossTileID]=new Xn((zr||yt)&&!xr?.occluded,(an||ct)&&!Ts?.occluded,Gr||g.justReloaded),l[kt.crossTileID]=!0};if(Qe){if(t.symbolInstanceStart!==0)throw new Error("bucket.bucketInstanceId should be 0");const kt=g.getSortedSymbolIndexes(-this.transform.bearingInRadians);for(let hi=kt.length-1;hi>=0;--hi){const Ji=kt[hi];Vt(g.symbolInstances.get(Ji),g.collisionArrays[Ji],Ji)}}else for(let kt=t.symbolInstanceStart;kt<t.symbolInstanceEnd;kt++)Vt(g.symbolInstances.get(kt),g.collisionArrays[kt],kt);g.justReloaded=!1}storeCollisionData(t,l,f,g,w,I){if(f.textBox||f.iconBox){let k,R;this.collisionBoxArrays.has(t)?k=this.collisionBoxArrays.get(t):(k=new Map,this.collisionBoxArrays.set(t,k)),k.has(l)?R=k.get(l):(R={text:null,icon:null},k.set(l,R)),f.textBox&&(R.text=g.box),f.iconBox&&(R.icon=w.box)}if(I){let k=this.collisionCircleArrays[t];k===void 0&&(k=this.collisionCircleArrays[t]=[]);for(let R=0;R<I.circles.length;R+=4)k.push(I.circles[R+0]-Ai),k.push(I.circles[R+1]-Ai),k.push(I.circles[R+2]),k.push(I.collisionDetected?1:0)}}markUsedJustification(t,l,f,g){let w;w=g===o.an.vertical?f.verticalPlacedTextSymbolIndex:{left:f.leftJustifiedTextSymbolIndex,center:f.centerJustifiedTextSymbolIndex,right:f.rightJustifiedTextSymbolIndex}[o.aF(l)];const I=[f.leftJustifiedTextSymbolIndex,f.centerJustifiedTextSymbolIndex,f.rightJustifiedTextSymbolIndex,f.verticalPlacedTextSymbolIndex];for(const k of I)k>=0&&(t.text.placedSymbolArray.get(k).crossTileID=w>=0&&k!==w?0:f.crossTileID)}markUsedOrientation(t,l,f){const g=l===o.an.horizontal||l===o.an.horizontalOnly?l:0,w=l===o.an.vertical?l:0,I=[f.leftJustifiedTextSymbolIndex,f.centerJustifiedTextSymbolIndex,f.rightJustifiedTextSymbolIndex];for(const k of I)t.text.placedSymbolArray.get(k).placedOrientation=g;f.verticalPlacedTextSymbolIndex&&(t.text.placedSymbolArray.get(f.verticalPlacedTextSymbolIndex).placedOrientation=w)}commit(t){this.commitTime=t,this.zoomAtLastRecencyCheck=this.transform.zoom;const l=this.prevPlacement;let f=!1;this.prevZoomAdjustment=l?l.zoomAdjustment(this.transform.zoom):0;const g=l?l.symbolFadeChange(t):1,w=l?l.opacities:{},I=l?l.variableOffsets:{},k=l?l.placedOrientations:{};for(const R in this.placements){const z=this.placements[R],G=w[R];G?(this.opacities[R]=new gr(G,g,z.text,z.icon),f=f||z.text!==G.text.placed||z.icon!==G.icon.placed):(this.opacities[R]=new gr(null,g,z.text,z.icon,z.skipFade),f=f||z.text||z.icon)}for(const R in w){const z=w[R];if(!this.opacities[R]){const G=new gr(z,g,!1,!1);G.isHidden()||(this.opacities[R]=G,f=f||z.text.placed||z.icon.placed)}}for(const R in I)this.variableOffsets[R]||!this.opacities[R]||this.opacities[R].isHidden()||(this.variableOffsets[R]=I[R]);for(const R in k)this.placedOrientations[R]||!this.opacities[R]||this.opacities[R].isHidden()||(this.placedOrientations[R]=k[R]);if(l&&l.lastPlacementChangeTime===void 0)throw new Error("Last placement time for previous placement is not defined");f?this.lastPlacementChangeTime=t:typeof this.lastPlacementChangeTime!="number"&&(this.lastPlacementChangeTime=l?l.lastPlacementChangeTime:t)}updateLayerOpacities(t,l){const f={};for(const g of l){const w=g.getBucket(t);w&&g.latestFeatureIndex&&t.id===w.layerIds[0]&&this.updateBucketOpacities(w,g.tileID,f,g.collisionBoxArray)}}updateBucketOpacities(t,l,f,g){t.hasTextData()&&(t.text.opacityVertexArray.clear(),t.text.hasVisibleVertices=!1),t.hasIconData()&&(t.icon.opacityVertexArray.clear(),t.icon.hasVisibleVertices=!1),t.hasIconCollisionBoxData()&&t.iconCollisionBox.collisionVertexArray.clear(),t.hasTextCollisionBoxData()&&t.textCollisionBox.collisionVertexArray.clear();const w=t.layers[0],I=w.layout,k=new gr(null,0,!1,!1,!0),R=I.get("text-allow-overlap"),z=I.get("icon-allow-overlap"),G=w._unevaluatedLayout.hasValue("text-variable-anchor")||w._unevaluatedLayout.hasValue("text-variable-anchor-offset"),X=I.get("text-rotation-alignment")==="map",W=I.get("text-pitch-alignment")==="map",te=I.get("icon-text-fit")!=="none",ae=new gr(null,0,R&&(z||!t.hasIconData()||I.get("icon-optional")),z&&(R||!t.hasTextData()||I.get("text-optional")),!0);!t.collisionArrays&&g&&(t.hasIconCollisionBoxData()||t.hasTextCollisionBoxData())&&t.deserializeCollisionBoxes(g);const Te=(Ee,Ce,Fe)=>{for(let Oe=0;Oe<Ce/4;Oe++)Ee.opacityVertexArray.emplaceBack(Fe);Ee.hasVisibleVertices=Ee.hasVisibleVertices||Fe!==as},we=this.collisionBoxArrays.get(t.bucketInstanceId);for(let Ee=0;Ee<t.symbolInstances.length;Ee++){const Ce=t.symbolInstances.get(Ee),{numHorizontalGlyphVertices:Fe,numVerticalGlyphVertices:Oe,crossTileID:Ue}=Ce;let We=this.opacities[Ue];f[Ue]?We=k:We||(We=ae,this.opacities[Ue]=We),f[Ue]=!0;const De=Ce.numIconVertices>0,Qe=this.placedOrientations[Ce.crossTileID],yt=Qe===o.an.vertical,ct=Qe===o.an.horizontal||Qe===o.an.horizontalOnly;if(Fe>0||Oe>0){const _t=ks(We.text);Te(t.text,Fe,yt?as:_t),Te(t.text,Oe,ct?as:_t);const qt=We.text.isHidden();[Ce.rightJustifiedTextSymbolIndex,Ce.centerJustifiedTextSymbolIndex,Ce.leftJustifiedTextSymbolIndex].forEach(hi=>{hi>=0&&(t.text.placedSymbolArray.get(hi).hidden=qt||yt?1:0)}),Ce.verticalPlacedTextSymbolIndex>=0&&(t.text.placedSymbolArray.get(Ce.verticalPlacedTextSymbolIndex).hidden=qt||ct?1:0);const Vt=this.variableOffsets[Ce.crossTileID];Vt&&this.markUsedJustification(t,Vt.anchor,Ce,Qe);const kt=this.placedOrientations[Ce.crossTileID];kt&&(this.markUsedJustification(t,"left",Ce,kt),this.markUsedOrientation(t,kt,Ce))}if(De){const _t=ks(We.icon),qt=!(te&&Ce.verticalPlacedIconSymbolIndex&&yt);Ce.placedIconSymbolIndex>=0&&(Te(t.icon,Ce.numIconVertices,qt?_t:as),t.icon.placedSymbolArray.get(Ce.placedIconSymbolIndex).hidden=We.icon.isHidden()),Ce.verticalPlacedIconSymbolIndex>=0&&(Te(t.icon,Ce.numVerticalIconVertices,qt?as:_t),t.icon.placedSymbolArray.get(Ce.verticalPlacedIconSymbolIndex).hidden=We.icon.isHidden())}const dt=we&&we.has(Ee)?we.get(Ee):{text:null,icon:null};if(t.hasIconCollisionBoxData()||t.hasTextCollisionBoxData()){const _t=t.collisionArrays[Ee];if(_t){let qt=new o.P(0,0);if(_t.textBox||_t.verticalTextBox){let Vt=!0;if(G){const kt=this.variableOffsets[Ue];kt?(qt=xn(kt.anchor,kt.width,kt.height,kt.textOffset,kt.textBoxScale),X&&qt._rotate(W?-this.transform.bearingInRadians:this.transform.bearingInRadians)):Vt=!1}if(_t.textBox||_t.verticalTextBox){let kt;_t.textBox&&(kt=yt),_t.verticalTextBox&&(kt=ct),Jr(t.textCollisionBox.collisionVertexArray,We.text.placed,!Vt||kt,dt.text,qt.x,qt.y)}}if(_t.iconBox||_t.verticalIconBox){const Vt=!!(!ct&&_t.verticalIconBox);let kt;_t.iconBox&&(kt=Vt),_t.verticalIconBox&&(kt=!Vt),Jr(t.iconCollisionBox.collisionVertexArray,We.icon.placed,kt,dt.icon,te?qt.x:0,te?qt.y:0)}}}}if(t.sortFeatures(-this.transform.bearingInRadians),this.retainedQueryData[t.bucketInstanceId]&&(this.retainedQueryData[t.bucketInstanceId].featureSortOrder=t.featureSortOrder),t.hasTextData()&&t.text.opacityVertexBuffer&&t.text.opacityVertexBuffer.updateData(t.text.opacityVertexArray),t.hasIconData()&&t.icon.opacityVertexBuffer&&t.icon.opacityVertexBuffer.updateData(t.icon.opacityVertexArray),t.hasIconCollisionBoxData()&&t.iconCollisionBox.collisionVertexBuffer&&t.iconCollisionBox.collisionVertexBuffer.updateData(t.iconCollisionBox.collisionVertexArray),t.hasTextCollisionBoxData()&&t.textCollisionBox.collisionVertexBuffer&&t.textCollisionBox.collisionVertexBuffer.updateData(t.textCollisionBox.collisionVertexArray),t.text.opacityVertexArray.length!==t.text.layoutVertexArray.length/4)throw new Error(`bucket.text.opacityVertexArray.length (= ${t.text.opacityVertexArray.length}) !== bucket.text.layoutVertexArray.length (= ${t.text.layoutVertexArray.length}) / 4`);if(t.icon.opacityVertexArray.length!==t.icon.layoutVertexArray.length/4)throw new Error(`bucket.icon.opacityVertexArray.length (= ${t.icon.opacityVertexArray.length}) !== bucket.icon.layoutVertexArray.length (= ${t.icon.layoutVertexArray.length}) / 4`);t.bucketInstanceId in this.collisionCircleArrays&&(t.collisionCircleArray=this.collisionCircleArrays[t.bucketInstanceId],delete this.collisionCircleArrays[t.bucketInstanceId])}symbolFadeChange(t){return this.fadeDuration===0?1:(t-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(t){return Math.max(0,(this.transform.zoom-t)/1.5)}hasTransitions(t){return this.stale||t-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(t,l){const f=this.zoomAtLastRecencyCheck===l?1-this.zoomAdjustment(l):1;return this.zoomAtLastRecencyCheck=l,this.commitTime+this.fadeDuration*f>t}setStale(){this.stale=!0}}function Jr(b,t,l,f,g,w){f&&f.length!==0||(f=[0,0,0,0]);const I=f[0]-Ai,k=f[1]-Ai,R=f[2]-Ai,z=f[3]-Ai;b.emplaceBack(t?1:0,l?1:0,g||0,w||0,I,k),b.emplaceBack(t?1:0,l?1:0,g||0,w||0,R,k),b.emplaceBack(t?1:0,l?1:0,g||0,w||0,R,z),b.emplaceBack(t?1:0,l?1:0,g||0,w||0,I,z)}const vr=Math.pow(2,25),Qs=Math.pow(2,24),Wl=Math.pow(2,17),Yl=Math.pow(2,16),dl=Math.pow(2,9),ho=Math.pow(2,8),Po=Math.pow(2,1);function ks(b){if(b.opacity===0&&!b.placed)return 0;if(b.opacity===1&&b.placed)return 4294967295;const t=b.placed?1:0,l=Math.floor(127*b.opacity);return l*vr+t*Qs+l*Wl+t*Yl+l*dl+t*ho+l*Po+t}const as=0;class Xl{constructor(t){this._sortAcrossTiles=t.layout.get("symbol-z-order")!=="viewport-y"&&!t.layout.get("symbol-sort-key").isConstant(),this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs={},this._bucketParts=[]}continuePlacement(t,l,f,g,w){const I=this._bucketParts;for(;this._currentTileIndex<t.length;)if(l.getBucketParts(I,g,t[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,w())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,I.sort((k,R)=>k.sortKey-R.sortKey));this._currentPartIndex<I.length;)if(l.placeLayerBucketPart(I[this._currentPartIndex],this._seenCrossTileIDs,f),this._currentPartIndex++,w())return!0;return!1}}class ko{constructor(t,l,f,g,w,I,k,R){this.placement=new $n(t,l,I,k,R),this._currentPlacementIndex=f.length-1,this._forceFullPlacement=g,this._showCollisionBoxes=w,this._done=!1}isDone(){return this._done}continuePlacement(t,l,f){const g=Y.now(),w=()=>!this._forceFullPlacement&&Y.now()-g>2;for(;this._currentPlacementIndex>=0;){const I=l[t[this._currentPlacementIndex]],k=this.placement.collisionIndex.transform.zoom;if(I.type==="symbol"&&(!I.minzoom||I.minzoom<=k)&&(!I.maxzoom||I.maxzoom>k)){if(this._inProgressLayer||(this._inProgressLayer=new Xl(I)),this._inProgressLayer.continuePlacement(f[I.source],this.placement,this._showCollisionBoxes,I,w))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(t){return this.placement.commit(t),this.placement}}const Wo=512/o.$/2;class Yo{constructor(t,l,f){this.tileID=t,this.bucketInstanceId=f,this._symbolsByKey={};const g=new Map;for(let w=0;w<l.length;w++){const I=l.get(w),k=I.key,R=g.get(k);R?R.push(I):g.set(k,[I])}for(const[w,I]of g){const k={positions:I.map(R=>({x:Math.floor(R.anchorX*Wo),y:Math.floor(R.anchorY*Wo)})),crossTileIDs:I.map(R=>R.crossTileID)};if(k.positions.length>128){const R=new o.aH(k.positions.length,16,Uint16Array);for(const{x:z,y:G}of k.positions)R.add(z,G);R.finish(),delete k.positions,k.index=R}this._symbolsByKey[w]=k}}getScaledCoordinates(t,l){const{x:f,y:g,z:w}=this.tileID.canonical,{x:I,y:k,z:R}=l.canonical,z=Wo/Math.pow(2,R-w),G=(k*o.$+t.anchorY)*z,X=g*o.$*Wo;return{x:Math.floor((I*o.$+t.anchorX)*z-f*o.$*Wo),y:Math.floor(G-X)}}findMatches(t,l,f){const g=this.tileID.canonical.z<l.canonical.z?1:Math.pow(2,this.tileID.canonical.z-l.canonical.z);for(let w=0;w<t.length;w++){const I=t.get(w);if(I.crossTileID)continue;const k=this._symbolsByKey[I.key];if(!k)continue;const R=this.getScaledCoordinates(I,l);if(k.index){const z=k.index.range(R.x-g,R.y-g,R.x+g,R.y+g).sort();for(const G of z){const X=k.crossTileIDs[G];if(!f[X]){f[X]=!0,I.crossTileID=X;break}}}else if(k.positions)for(let z=0;z<k.positions.length;z++){const G=k.positions[z],X=k.crossTileIDs[z];if(Math.abs(G.x-R.x)<=g&&Math.abs(G.y-R.y)<=g&&!f[X]){f[X]=!0,I.crossTileID=X;break}}}}getCrossTileIDsLists(){return Object.values(this._symbolsByKey).map(({crossTileIDs:t})=>t)}}class C{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class j{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(t){const l=Math.round((t-this.lng)/360);if(l!==0)for(const f in this.indexes){const g=this.indexes[f],w={};for(const I in g){const k=g[I];k.tileID=k.tileID.unwrapTo(k.tileID.wrap+l),w[k.tileID.key]=k}this.indexes[f]=w}this.lng=t}addBucket(t,l,f){if(this.indexes[t.overscaledZ]&&this.indexes[t.overscaledZ][t.key]){if(this.indexes[t.overscaledZ][t.key].bucketInstanceId===l.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(t.overscaledZ,this.indexes[t.overscaledZ][t.key])}for(let w=0;w<l.symbolInstances.length;w++)l.symbolInstances.get(w).crossTileID=0;this.usedCrossTileIDs[t.overscaledZ]||(this.usedCrossTileIDs[t.overscaledZ]={});const g=this.usedCrossTileIDs[t.overscaledZ];for(const w in this.indexes){const I=this.indexes[w];if(Number(w)>t.overscaledZ)for(const k in I){const R=I[k];R.tileID.isChildOf(t)&&R.findMatches(l.symbolInstances,t,g)}else{const k=I[t.scaledTo(Number(w)).key];k&&k.findMatches(l.symbolInstances,t,g)}}for(let w=0;w<l.symbolInstances.length;w++){const I=l.symbolInstances.get(w);I.crossTileID||(I.crossTileID=f.generate(),g[I.crossTileID]=!0)}return this.indexes[t.overscaledZ]===void 0&&(this.indexes[t.overscaledZ]={}),this.indexes[t.overscaledZ][t.key]=new Yo(t,l.symbolInstances,l.bucketInstanceId),!0}removeBucketCrossTileIDs(t,l){for(const f of l.getCrossTileIDsLists())for(const g of f)delete this.usedCrossTileIDs[t][g]}removeStaleBuckets(t){let l=!1;for(const f in this.indexes){const g=this.indexes[f];for(const w in g)t[g[w].bucketInstanceId]||(this.removeBucketCrossTileIDs(f,g[w]),delete g[w],l=!0)}return l}}class de{constructor(){this.layerIndexes={},this.crossTileIDs=new C,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(t,l,f){let g=this.layerIndexes[t.id];g===void 0&&(g=this.layerIndexes[t.id]=new j);let w=!1;const I={};g.handleWrapJump(f);for(const k of l){const R=k.getBucket(t);R&&t.id===R.layerIds[0]&&(R.bucketInstanceId||(R.bucketInstanceId=++this.maxBucketInstanceId),g.addBucket(k.tileID,R,this.crossTileIDs)&&(w=!0),I[R.bucketInstanceId]=!0)}return g.removeStaleBuckets(I)&&(w=!0),w}pruneUnusedLayers(t){const l={};t.forEach(f=>{l[f]=!0});for(const f in this.layerIndexes)l[f]||delete this.layerIndexes[f]}}var Ne="void main() {fragColor=vec4(1.0);}";const qe={prelude:je(`#ifdef GL_ES
precision mediump float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif
out highp vec4 fragColor;`,`#ifdef GL_ES
precision highp float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif
vec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0
);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}mat3 rotationMatrixFromAxisAngle(vec3 u,float angle) {float c=cos(angle);float s=sin(angle);float c2=1.0-c;return mat3(u.x*u.x*c2+      c,u.x*u.y*c2-u.z*s,u.x*u.z*c2+u.y*s,u.y*u.x*c2+u.z*s,u.y*u.y*c2+    c,u.y*u.z*c2-u.x*s,u.z*u.x*c2-u.y*s,u.z*u.y*c2+u.x*s,u.z*u.z*c2+    c
);}
#ifdef TERRAIN3D
uniform sampler2D u_terrain;uniform float u_terrain_dim;uniform mat4 u_terrain_matrix;uniform vec4 u_terrain_unpack;uniform float u_terrain_exaggeration;uniform highp sampler2D u_depth;
#endif
const highp vec4 bitSh=vec4(256.*256.*256.,256.*256.,256.,1.);const highp vec4 bitShifts=vec4(1.)/bitSh;highp float unpack(highp vec4 color) {return dot(color,bitShifts);}highp float depthOpacity(vec3 frag) {
#ifdef TERRAIN3D
highp float d=unpack(texture(u_depth,frag.xy*0.5+0.5))+0.0001-frag.z;return 1.0-max(0.0,min(1.0,-d*500.0));
#else
return 1.0;
#endif
}float calculate_visibility(vec4 pos) {
#ifdef TERRAIN3D
vec3 frag=pos.xyz/pos.w;highp float d=depthOpacity(frag);if (d > 0.95) return 1.0;return (d+depthOpacity(frag+vec3(0.0,0.01,0.0)))/2.0;
#else
return 1.0;
#endif
}float ele(vec2 pos) {
#ifdef TERRAIN3D
vec4 rgb=(texture(u_terrain,pos)*255.0)*u_terrain_unpack;return rgb.r+rgb.g+rgb.b-u_terrain_unpack.a;
#else
return 0.0;
#endif
}float get_elevation(vec2 pos) {
#ifdef TERRAIN3D
#ifdef GLOBE
if ((pos.y <-32767.5) || (pos.y > 32766.5)) {return 0.0;}
#endif
vec2 coord=(u_terrain_matrix*vec4(pos,0.0,1.0)).xy*u_terrain_dim+1.0;vec2 f=fract(coord);vec2 c=(floor(coord)+0.5)/(u_terrain_dim+2.0);float d=1.0/(u_terrain_dim+2.0);float tl=ele(c);float tr=ele(c+vec2(d,0.0));float bl=ele(c+vec2(0.0,d));float br=ele(c+vec2(d,d));float elevation=mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);return elevation*u_terrain_exaggeration;
#else
return 0.0;
#endif
}const float PI=3.141592653589793;uniform mat4 u_projection_matrix;`),projectionMercator:je("","float projectLineThickness(float tileY) {return 1.0;}float projectCircleRadius(float tileY) {return 1.0;}vec4 projectTile(vec2 p) {vec4 result=u_projection_matrix*vec4(p,0.0,1.0);return result;}vec4 projectTile(vec2 p,vec2 rawPos) {vec4 result=u_projection_matrix*vec4(p,0.0,1.0);if (rawPos.y <-32767.5 || rawPos.y > 32766.5) {result.z=-10000000.0;}return result;}vec4 projectTileWithElevation(vec2 posInTile,float elevation) {return u_projection_matrix*vec4(posInTile,elevation,1.0);}vec4 projectTileFor3D(vec2 posInTile,float elevation) {return projectTileWithElevation(posInTile,elevation);}"),projectionGlobe:je("",`#define GLOBE_RADIUS 6371008.8
uniform highp vec4 u_projection_tile_mercator_coords;uniform highp vec4 u_projection_clipping_plane;uniform highp float u_projection_transition;uniform mat4 u_projection_fallback_matrix;vec3 globeRotateVector(vec3 vec,vec2 angles) {vec3 axisRight=vec3(vec.z,0.0,-vec.x);vec3 axisUp=cross(axisRight,vec);axisRight=normalize(axisRight);axisUp=normalize(axisUp);vec2 t=tan(angles);return normalize(vec+axisRight*t.x+axisUp*t.y);}mat3 globeGetRotationMatrix(vec3 spherePos) {vec3 axisRight=vec3(spherePos.z,0.0,-spherePos.x);vec3 axisDown=cross(axisRight,spherePos);axisRight=normalize(axisRight);axisDown=normalize(axisDown);return mat3(axisRight,axisDown,spherePos
);}float circumferenceRatioAtTileY(float tileY) {float mercator_pos_y=u_projection_tile_mercator_coords.y+u_projection_tile_mercator_coords.w*tileY;float spherical_y=2.0*atan(exp(PI-(mercator_pos_y*PI*2.0)))-PI*0.5;return cos(spherical_y);}float projectLineThickness(float tileY) {float thickness=1.0/circumferenceRatioAtTileY(tileY); 
if (u_projection_transition < 0.999) {return mix(1.0,thickness,u_projection_transition);} else {return thickness;}}vec3 projectToSphere(vec2 translatedPos,vec2 rawPos) {vec2 mercator_pos=u_projection_tile_mercator_coords.xy+u_projection_tile_mercator_coords.zw*translatedPos;vec2 spherical;spherical.x=mercator_pos.x*PI*2.0+PI;spherical.y=2.0*atan(exp(PI-(mercator_pos.y*PI*2.0)))-PI*0.5;float len=cos(spherical.y);vec3 pos=vec3(sin(spherical.x)*len,sin(spherical.y),cos(spherical.x)*len
);if (rawPos.y <-32767.5) {pos=vec3(0.0,1.0,0.0);}if (rawPos.y > 32766.5) {pos=vec3(0.0,-1.0,0.0);}return pos;}vec3 projectToSphere(vec2 posInTile) {return projectToSphere(posInTile,vec2(0.0,0.0));}float globeComputeClippingZ(vec3 spherePos) {return (1.0-(dot(spherePos,u_projection_clipping_plane.xyz)+u_projection_clipping_plane.w));}vec4 interpolateProjection(vec2 posInTile,vec3 spherePos,float elevation) {vec3 elevatedPos=spherePos*(1.0+elevation/GLOBE_RADIUS);vec4 globePosition=u_projection_matrix*vec4(elevatedPos,1.0);globePosition.z=globeComputeClippingZ(elevatedPos)*globePosition.w;if (u_projection_transition > 0.999) {return globePosition;}vec4 flatPosition=u_projection_fallback_matrix*vec4(posInTile,elevation,1.0);const float z_globeness_threshold=0.2;vec4 result=globePosition;result.z=mix(0.0,globePosition.z,clamp((u_projection_transition-z_globeness_threshold)/(1.0-z_globeness_threshold),0.0,1.0));result.xyw=mix(flatPosition.xyw,globePosition.xyw,u_projection_transition);if ((posInTile.y <-32767.5) || (posInTile.y > 32766.5)) {result=globePosition;const float poles_hidden_anim_percentage=0.02;result.z=mix(globePosition.z,100.0,pow(max((1.0-u_projection_transition)/poles_hidden_anim_percentage,0.0),8.0));}return result;}vec4 interpolateProjectionFor3D(vec2 posInTile,vec3 spherePos,float elevation) {vec3 elevatedPos=spherePos*(1.0+elevation/GLOBE_RADIUS);vec4 globePosition=u_projection_matrix*vec4(elevatedPos,1.0);if (u_projection_transition > 0.999) {return globePosition;}vec4 fallbackPosition=u_projection_fallback_matrix*vec4(posInTile,elevation,1.0);return mix(fallbackPosition,globePosition,u_projection_transition);}vec4 projectTile(vec2 posInTile) {return interpolateProjection(posInTile,projectToSphere(posInTile),0.0);}vec4 projectTile(vec2 posInTile,vec2 rawPos) {return interpolateProjection(posInTile,projectToSphere(posInTile,rawPos),0.0);}vec4 projectTileWithElevation(vec2 posInTile,float elevation) {return interpolateProjection(posInTile,projectToSphere(posInTile),elevation);}vec4 projectTileFor3D(vec2 posInTile,float elevation) {vec3 spherePos=projectToSphere(posInTile,posInTile);return interpolateProjectionFor3D(posInTile,spherePos,elevation);}`),background:je(`uniform vec4 u_color;uniform float u_opacity;void main() {fragColor=u_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,"in vec2 a_pos;void main() {gl_Position=projectTile(a_pos);}"),backgroundPattern:je(`uniform vec2 u_pattern_tl_a;uniform vec2 u_pattern_br_a;uniform vec2 u_pattern_tl_b;uniform vec2 u_pattern_br_b;uniform vec2 u_texsize;uniform float u_mix;uniform float u_opacity;uniform sampler2D u_image;in vec2 v_pos_a;in vec2 v_pos_b;void main() {vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(u_pattern_tl_a/u_texsize,u_pattern_br_a/u_texsize,imagecoord);vec4 color1=texture(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(u_pattern_tl_b/u_texsize,u_pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture(u_image,pos2);fragColor=mix(color1,color2,u_mix)*u_opacity;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,"uniform vec2 u_pattern_size_a;uniform vec2 u_pattern_size_b;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_scale_a;uniform float u_scale_b;uniform float u_tile_units_to_pixels;in vec2 a_pos;out vec2 v_pos_a;out vec2 v_pos_b;void main() {gl_Position=projectTile(a_pos);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_a*u_pattern_size_a,u_tile_units_to_pixels,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_b*u_pattern_size_b,u_tile_units_to_pixels,a_pos);}"),circle:je(`in vec3 v_data;in float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=v_data.xy;float extrude_length=length(extrude);float antialiased_blur=v_data.z;float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width));fragColor=v_visibility*opacity_t*mix(color*opacity,stroke_color*stroke_opacity,color_t);const float epsilon=0.5/255.0;if (fragColor.r < epsilon && fragColor.g < epsilon && fragColor.b < epsilon && fragColor.a < epsilon) {discard;}
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform bool u_scale_with_map;uniform bool u_pitch_with_map;uniform vec2 u_extrude_scale;uniform highp float u_globe_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;uniform vec2 u_translate;in vec2 a_pos;out vec3 v_data;out float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main(void) {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 pos_raw=a_pos+32768.0;vec2 extrude=vec2(mod(pos_raw,8.0)/7.0*2.0-1.0);vec2 circle_center=floor(pos_raw/8.0)+u_translate;float ele=get_elevation(circle_center);v_visibility=calculate_visibility(projectTileWithElevation(circle_center,ele));if (u_pitch_with_map) {
#ifdef GLOBE
vec3 center_vector=projectToSphere(circle_center);
#endif
float angle_scale=u_globe_extrude_scale;vec2 corner_position=circle_center;if (u_scale_with_map) {angle_scale*=(radius+stroke_width);corner_position+=extrude*u_extrude_scale*(radius+stroke_width);} else {
#ifdef GLOBE
vec4 projected_center=interpolateProjection(circle_center,center_vector,ele);
#else
vec4 projected_center=projectTileWithElevation(circle_center,ele);
#endif
corner_position+=extrude*u_extrude_scale*(radius+stroke_width)*(projected_center.w/u_camera_to_center_distance);angle_scale*=(radius+stroke_width)*(projected_center.w/u_camera_to_center_distance);}
#ifdef GLOBE
vec2 angles=extrude*angle_scale;vec3 corner_vector=globeRotateVector(center_vector,angles);gl_Position=interpolateProjection(corner_position,corner_vector,ele);
#else
gl_Position=projectTileWithElevation(corner_position,ele);
#endif
} else {gl_Position=projectTileWithElevation(circle_center,ele);if (gl_Position.z/gl_Position.w > 1.0) {gl_Position.xy=vec2(10000.0);}if (u_scale_with_map) {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*u_camera_to_center_distance;} else {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*gl_Position.w;}}float antialiasblur=-max(1.0/u_device_pixel_ratio/(radius+stroke_width),blur);v_data=vec3(extrude.x,extrude.y,antialiasblur);}`),clippingMask:je(Ne,"in vec2 a_pos;void main() {gl_Position=projectTile(a_pos);}"),heatmap:je(`uniform highp float u_intensity;in vec2 v_extrude;
#pragma mapbox: define highp float weight
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
float d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);fragColor=vec4(val,1.0,1.0,1.0);
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;uniform highp float u_globe_extrude_scale;in vec2 a_pos;out vec2 v_extrude;
#pragma mapbox: define highp float weight
#pragma mapbox: define mediump float radius
const highp float ZERO=1.0/255.0/16.0;
#define GAUSS_COEF 0.3989422804014327
void main(void) {
#pragma mapbox: initialize highp float weight
#pragma mapbox: initialize mediump float radius
vec2 pos_raw=a_pos+32768.0;vec2 unscaled_extrude=vec2(mod(pos_raw,8.0)/7.0*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec2 circle_center=floor(pos_raw/8.0);
#ifdef GLOBE
vec2 angles=v_extrude*radius*u_globe_extrude_scale;vec3 center_vector=projectToSphere(circle_center);vec3 corner_vector=globeRotateVector(center_vector,angles);gl_Position=interpolateProjection(circle_center+extrude,corner_vector,0.0);
#else
gl_Position=projectTileFor3D(circle_center+extrude,get_elevation(circle_center));
#endif
}`),heatmapTexture:je(`uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;in vec2 v_pos;void main() {float t=texture(u_image,v_pos).r;vec4 color=texture(u_color_ramp,vec2(t,0.5));fragColor=color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(0.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_world;in vec2 a_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos*u_world,0,1);v_pos.x=a_pos.x;v_pos.y=1.0-a_pos.y;}"),collisionBox:je("in float v_placed;in float v_notUsed;void main() {float alpha=0.5;fragColor=vec4(1.0,0.0,0.0,1.0)*alpha;if (v_placed > 0.5) {fragColor=vec4(0.0,0.0,1.0,0.5)*alpha;}if (v_notUsed > 0.5) {fragColor*=.1;}}","in vec2 a_anchor_pos;in vec2 a_placed;in vec2 a_box_real;uniform vec2 u_pixel_extrude_scale;out float v_placed;out float v_notUsed;void main() {gl_Position=projectTileWithElevation(a_anchor_pos,get_elevation(a_anchor_pos));gl_Position.xy=((a_box_real+0.5)*u_pixel_extrude_scale*2.0-1.0)*vec2(1.0,-1.0)*gl_Position.w;if (gl_Position.z/gl_Position.w < 1.1) {gl_Position.z=0.5;}v_placed=a_placed.x;v_notUsed=a_placed.y;}"),collisionCircle:je("in float v_radius;in vec2 v_extrude;in float v_collision;void main() {float alpha=0.5;float stroke_radius=0.9;float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);fragColor=color*alpha*opacity_t;}","in vec2 a_pos;in float a_radius;in vec2 a_flags;uniform vec2 u_viewport_size;out float v_radius;out vec2 v_extrude;out float v_collision;void main() {float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_collision=collision;gl_Position=vec4((a_pos/u_viewport_size*2.0-1.0)*vec2(1.0,-1.0),0.0,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}"),colorRelief:je(`#ifdef GL_ES
precision highp float;
#endif
uniform sampler2D u_image;uniform vec4 u_unpack;uniform sampler2D u_elevation_stops;uniform sampler2D u_color_stops;uniform int u_color_ramp_size;uniform float u_opacity;in vec2 v_pos;float getElevation(vec2 coord) {vec4 data=texture(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack);}float getElevationStop(int stop) {float x=(float(stop)+0.5)/float(u_color_ramp_size);vec4 data=texture(u_elevation_stops,vec2(x,0))*255.0;data.a=-1.0;return dot(data,u_unpack);}void main() {float el=getElevation(v_pos);int r=(u_color_ramp_size-1);int l=0;float el_l=getElevationStop(l);float el_r=getElevationStop(r);while(r-l > 1){int m=(r+l)/2;float el_m=getElevationStop(m);if(el < el_m){r=m;el_r=el_m;}else
{l=m;el_l=el_m;}}float x=(float(l)+(el-el_l)/(el_r-el_l)+0.5)/float(u_color_ramp_size);fragColor=u_opacity*texture(u_color_stops,vec2(x,0));
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,"uniform vec2 u_dimension;in vec2 a_pos;out vec2 v_pos;void main() {gl_Position=projectTile(a_pos,a_pos);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_pos/8192.0)*scale+epsilon;if (a_pos.y <-32767.5) {v_pos.y=0.0;}if (a_pos.y > 32766.5) {v_pos.y=1.0;}}"),debug:je("uniform highp vec4 u_color;uniform sampler2D u_overlay;in vec2 v_uv;void main() {vec4 overlay_color=texture(u_overlay,v_uv);fragColor=mix(u_color,overlay_color,overlay_color.a);}","in vec2 a_pos;out vec2 v_uv;uniform float u_overlay_scale;void main() {v_uv=a_pos/8192.0;gl_Position=projectTileWithElevation(a_pos*u_overlay_scale,get_elevation(a_pos));}"),depth:je(Ne,`in vec2 a_pos;void main() {
#ifdef GLOBE
gl_Position=projectTileFor3D(a_pos,0.0);
#else
gl_Position=u_projection_matrix*vec4(a_pos,0.0,1.0);
#endif
}`),fill:je(`#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
fragColor=color*opacity;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec2 u_fill_translate;in vec2 a_pos;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_Position=projectTile(a_pos+u_fill_translate,a_pos);}`),fillOutline:je(`in vec2 v_pos;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);fragColor=outline_color*(alpha*opacity);
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec2 u_world;uniform vec2 u_fill_translate;in vec2 a_pos;out vec2 v_pos;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
gl_Position=projectTile(a_pos+u_fill_translate,a_pos);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
}`),fillOutlinePattern:je(`uniform vec2 u_texsize;uniform sampler2D u_image;uniform float u_fade;in vec2 v_pos_a;in vec2 v_pos_b;in vec2 v_pos;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture(u_image,pos2);float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);fragColor=mix(color1,color2,u_fade)*alpha*opacity;
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;uniform vec2 u_fill_translate;in vec2 a_pos;out vec2 v_pos_a;out vec2 v_pos_b;out vec2 v_pos;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;gl_Position=projectTile(a_pos+u_fill_translate,a_pos);vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,a_pos);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
}`),fillPattern:je(`#ifdef GL_ES
precision highp float;
#endif
uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;in vec2 v_pos_a;in vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture(u_image,pos2);fragColor=mix(color1,color2,u_fade)*opacity;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;uniform vec2 u_fill_translate;in vec2 a_pos;out vec2 v_pos_a;out vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;gl_Position=projectTile(a_pos+u_fill_translate,a_pos);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileZoomRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileZoomRatio,a_pos);}`),fillExtrusion:je(`in vec4 v_color;void main() {fragColor=v_color;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp vec3 u_lightpos_globe;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec2 u_fill_translate;in vec2 a_pos;in vec4 a_normal_ed;
#ifdef TERRAIN3D
in vec2 a_centroid;
#endif
out vec4 v_color;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
vec3 normal=a_normal_ed.xyz;
#ifdef TERRAIN3D
float height_terrain3d_offset=get_elevation(a_centroid);float base_terrain3d_offset=height_terrain3d_offset-(base > 0.0 ? 0.0 : 10.0);
#else
float height_terrain3d_offset=0.0;float base_terrain3d_offset=0.0;
#endif
base=max(0.0,base)+base_terrain3d_offset;height=max(0.0,height)+height_terrain3d_offset;float t=mod(normal.x,2.0);float elevation=t > 0.0 ? height : base;vec2 posInTile=a_pos+u_fill_translate;
#ifdef GLOBE
vec3 spherePos=projectToSphere(posInTile,a_pos);gl_Position=interpolateProjectionFor3D(posInTile,spherePos,elevation);
#else
gl_Position=u_projection_matrix*vec4(posInTile,elevation,1.0);
#endif
float colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;v_color=vec4(0.0,0.0,0.0,1.0);vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;vec3 normalForLighting=normal/16384.0;float directional=clamp(dot(normalForLighting,u_lightpos),0.0,1.0);
#ifdef GLOBE
mat3 rotMatrix=globeGetRotationMatrix(spherePos);normalForLighting=rotMatrix*normalForLighting;directional=mix(directional,clamp(dot(normalForLighting,u_lightpos_globe),0.0,1.0),u_projection_transition);
#endif
directional=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_color.r+=clamp(color.r*directional*u_lightcolor.r,mix(0.0,0.3,1.0-u_lightcolor.r),1.0);v_color.g+=clamp(color.g*directional*u_lightcolor.g,mix(0.0,0.3,1.0-u_lightcolor.g),1.0);v_color.b+=clamp(color.b*directional*u_lightcolor.b,mix(0.0,0.3,1.0-u_lightcolor.b),1.0);v_color*=u_opacity;}`),fillExtrusionPattern:je(`uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;in vec2 v_pos_a;in vec2 v_pos_b;in vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture(u_image,pos2);vec4 mixedColor=mix(color1,color2,u_fade);fragColor=mixedColor*v_lighting;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform vec3 u_scale;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec2 u_fill_translate;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp vec3 u_lightpos_globe;uniform lowp float u_lightintensity;in vec2 a_pos;in vec4 a_normal_ed;
#ifdef TERRAIN3D
in vec2 a_centroid;
#endif
#ifdef GLOBE
out vec3 v_sphere_pos;
#endif
out vec2 v_pos_a;out vec2 v_pos_b;out vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec3 normal=a_normal_ed.xyz;float edgedistance=a_normal_ed.w;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;
#ifdef TERRAIN3D
float height_terrain3d_offset=get_elevation(a_centroid);float base_terrain3d_offset=height_terrain3d_offset-(base > 0.0 ? 0.0 : 10.0);
#else
float height_terrain3d_offset=0.0;float base_terrain3d_offset=0.0;
#endif
base=max(0.0,base)+base_terrain3d_offset;height=max(0.0,height)+height_terrain3d_offset;float t=mod(normal.x,2.0);float elevation=t > 0.0 ? height : base;vec2 posInTile=a_pos+u_fill_translate;
#ifdef GLOBE
vec3 spherePos=projectToSphere(posInTile,a_pos);vec3 elevatedPos=spherePos*(1.0+elevation/GLOBE_RADIUS);v_sphere_pos=elevatedPos;gl_Position=interpolateProjectionFor3D(posInTile,spherePos,elevation);
#else
gl_Position=u_projection_matrix*vec4(posInTile,elevation,1.0);
#endif
vec2 pos=normal.x==1.0 && normal.y==0.0 && normal.z==16384.0
? a_pos
: vec2(edgedistance,elevation*u_height_factor);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float directional=clamp(dot(normal/16383.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_lighting.rgb+=clamp(directional*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;}`),hillshadePrepare:je(`#ifdef GL_ES
precision highp float;
#endif
uniform sampler2D u_image;in vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;uniform vec4 u_unpack;float getElevation(vec2 coord,float bias) {vec4 data=texture(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack);}void main() {vec2 epsilon=1.0/u_dimension;float tileSize=u_dimension.x-2.0;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y),0.0);float b=getElevation(v_pos+vec2(0,-epsilon.y),0.0);float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y),0.0);float d=getElevation(v_pos+vec2(-epsilon.x,0),0.0);float e=getElevation(v_pos,0.0);float f=getElevation(v_pos+vec2(epsilon.x,0),0.0);float g=getElevation(v_pos+vec2(-epsilon.x,epsilon.y),0.0);float h=getElevation(v_pos+vec2(0,epsilon.y),0.0);float i=getElevation(v_pos+vec2(epsilon.x,epsilon.y),0.0);float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2((c+f+f+i)-(a+d+d+g),(g+h+h+i)-(a+b+b+c))*tileSize/pow(2.0,exaggeration+(28.2562-u_zoom));fragColor=clamp(vec4(deriv.x/8.0+0.5,deriv.y/8.0+0.5,1.0,1.0),0.0,1.0);
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_dimension;in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:je(`uniform sampler2D u_image;in vec2 v_pos;uniform vec2 u_latrange;uniform float u_exaggeration;uniform vec4 u_accent;uniform int u_method;uniform float u_altitudes[NUM_ILLUMINATION_SOURCES];uniform float u_azimuths[NUM_ILLUMINATION_SOURCES];uniform vec4 u_shadows[NUM_ILLUMINATION_SOURCES];uniform vec4 u_highlights[NUM_ILLUMINATION_SOURCES];
#define PI 3.141592653589793
#define STANDARD 0
#define COMBINED 1
#define IGOR 2
#define MULTIDIRECTIONAL 3
#define BASIC 4
float get_aspect(vec2 deriv){return deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);}void igor_hillshade(vec2 deriv){deriv=deriv*u_exaggeration*2.0;float aspect=get_aspect(deriv);float azimuth=u_azimuths[0]+PI;float slope_stength=atan(length(deriv))*2.0/PI;float aspect_strength=1.0-abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);float shadow_strength=slope_stength*aspect_strength;float highlight_strength=slope_stength*(1.0-aspect_strength);fragColor=u_shadows[0]*shadow_strength+u_highlights[0]*highlight_strength;}void standard_hillshade(vec2 deriv){float azimuth=u_azimuths[0]+PI;float slope=atan(0.625*length(deriv));float aspect=get_aspect(deriv);float intensity=u_exaggeration;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadows[0],u_highlights[0],shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);fragColor=accent_color*(1.0-shade_color.a)+shade_color;}void basic_hillshade(vec2 deriv){deriv=deriv*u_exaggeration*2.0;float azimuth=u_azimuths[0]+PI;float cos_az=cos(azimuth);float sin_az=sin(azimuth);float cos_alt=cos(u_altitudes[0]);float sin_alt=sin(u_altitudes[0]);float cang=(sin_alt-(deriv.y*cos_az*cos_alt-deriv.x*sin_az*cos_alt))/sqrt(1.0+dot(deriv,deriv));float shade=clamp(cang,0.0,1.0);if(shade > 0.5){fragColor=u_highlights[0]*(2.0*shade-1.0);}else
{fragColor=u_shadows[0]*(1.0-2.0*shade);}}void multidirectional_hillshade(vec2 deriv){deriv=deriv*u_exaggeration*2.0;fragColor=vec4(0,0,0,0);for(int i=0; i < NUM_ILLUMINATION_SOURCES; i++){float cos_alt=cos(u_altitudes[i]);float sin_alt=sin(u_altitudes[i]);float cos_az=-cos(u_azimuths[i]);float sin_az=-sin(u_azimuths[i]);float cang=(sin_alt-(deriv.y*cos_az*cos_alt-deriv.x*sin_az*cos_alt))/sqrt(1.0+dot(deriv,deriv));float shade=clamp(cang,0.0,1.0);if(shade > 0.5){fragColor+=u_highlights[i]*(2.0*shade-1.0)/float(NUM_ILLUMINATION_SOURCES);}else
{fragColor+=u_shadows[i]*(1.0-2.0*shade)/float(NUM_ILLUMINATION_SOURCES);}}}void combined_hillshade(vec2 deriv){deriv=deriv*u_exaggeration*2.0;float azimuth=u_azimuths[0]+PI;float cos_az=cos(azimuth);float sin_az=sin(azimuth);float cos_alt=cos(u_altitudes[0]);float sin_alt=sin(u_altitudes[0]);float cang=acos((sin_alt-(deriv.y*cos_az*cos_alt-deriv.x*sin_az*cos_alt))/sqrt(1.0+dot(deriv,deriv)));cang=clamp(cang,0.0,PI/2.0);float shade=cang*atan(length(deriv))*4.0/PI/PI;float highlight=(PI/2.0-cang)*atan(length(deriv))*4.0/PI/PI;fragColor=u_shadows[0]*shade+u_highlights[0]*highlight;}void main() {vec4 pixel=texture(u_image,v_pos);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));vec2 deriv=((pixel.rg*8.0)-4.0)/scaleFactor;if (u_method==BASIC) {basic_hillshade(deriv);} else if (u_method==COMBINED) {combined_hillshade(deriv);} else if (u_method==IGOR) {igor_hillshade(deriv);} else if (u_method==MULTIDIRECTIONAL) {multidirectional_hillshade(deriv);} else if (u_method==STANDARD) {standard_hillshade(deriv);} else {standard_hillshade(deriv);}
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;in vec2 a_pos;out vec2 v_pos;void main() {gl_Position=projectTile(a_pos,a_pos);v_pos=a_pos/8192.0;if (a_pos.y <-32767.5) {v_pos.y=0.0;}if (a_pos.y > 32766.5) {v_pos.y=1.0;}}"),line:je(`uniform lowp float u_device_pixel_ratio;in vec2 v_width2;in vec2 v_normal;in float v_gamma_scale;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);fragColor=color*(alpha*opacity);
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
in vec2 a_pos_normal;in vec4 a_data;uniform vec2 u_translation;uniform mediump float u_ratio;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;out vec2 v_normal;out vec2 v_width2;out float v_gamma_scale;out highp float v_linesofar;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;v_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*2.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);float adjustedThickness=projectLineThickness(pos.y);vec4 projected_no_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation);vec4 projected_with_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation+dist/u_ratio*adjustedThickness);gl_Position=projected_with_extrude;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length((projected_with_extrude.xy-projected_no_extrude.xy)/projected_with_extrude.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_width2=vec2(outset,inset);}`),lineGradient:je(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;in vec2 v_width2;in vec2 v_normal;in float v_gamma_scale;in highp vec2 v_uv;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);vec4 color=texture(u_image,v_uv);fragColor=color*(alpha*opacity);
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
in vec2 a_pos_normal;in vec4 a_data;in float a_uv_x;in float a_split_index;uniform vec2 u_translation;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_units_to_pixels;uniform float u_image_height;out vec2 v_normal;out vec2 v_width2;out float v_gamma_scale;out highp vec2 v_uv;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec2(a_uv_x,a_split_index*texel_height-half_texel_height);vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);float adjustedThickness=projectLineThickness(pos.y);vec4 projected_no_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation);vec4 projected_with_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation+dist/u_ratio*adjustedThickness);gl_Position=projected_with_extrude;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length((projected_with_extrude.xy-projected_no_extrude.xy)/projected_with_extrude.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_width2=vec2(outset,inset);}`),linePattern:je(`#ifdef GL_ES
precision highp float;
#endif
uniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform float u_fade;uniform mediump vec3 u_scale;uniform sampler2D u_image;in vec2 v_normal;in vec2 v_width2;in float v_linesofar;in float v_gamma_scale;in float v_width;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;vec2 pattern_size_a=vec2(display_size_a.x*fromScale/tileZoomRatio,display_size_a.y);vec2 pattern_size_b=vec2(display_size_b.x*toScale/tileZoomRatio,display_size_b.y);float aspect_a=display_size_a.y/v_width;float aspect_b=display_size_b.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float x_a=mod(v_linesofar/pattern_size_a.x*aspect_a,1.0);float x_b=mod(v_linesofar/pattern_size_b.x*aspect_b,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos_a=mix(pattern_tl_a*texel_size-texel_size,pattern_br_a*texel_size+texel_size,vec2(x_a,y));vec2 pos_b=mix(pattern_tl_b*texel_size-texel_size,pattern_br_b*texel_size+texel_size,vec2(x_b,y));vec4 color=mix(texture(u_image,pos_a),texture(u_image,pos_b),u_fade);fragColor=color*alpha*opacity;
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
in vec2 a_pos_normal;in vec4 a_data;uniform vec2 u_translation;uniform vec2 u_units_to_pixels;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;out vec2 v_normal;out vec2 v_width2;out float v_linesofar;out float v_gamma_scale;out float v_width;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);float adjustedThickness=projectLineThickness(pos.y);vec4 projected_no_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation);vec4 projected_with_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation+dist/u_ratio*adjustedThickness);gl_Position=projected_with_extrude;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length((projected_with_extrude.xy-projected_no_extrude.xy)/projected_with_extrude.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;}`),lineSDF:je(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;uniform float u_sdfgamma;uniform float u_mix;in vec2 v_normal;in vec2 v_width2;in vec2 v_tex_a;in vec2 v_tex_b;in float v_gamma_scale;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float sdfdist_a=texture(u_image,v_tex_a).a;float sdfdist_b=texture(u_image,v_tex_b).a;float sdfdist=mix(sdfdist_a,sdfdist_b,u_mix);alpha*=smoothstep(0.5-u_sdfgamma/floorwidth,0.5+u_sdfgamma/floorwidth,sdfdist);fragColor=color*(alpha*opacity);
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
in vec2 a_pos_normal;in vec4 a_data;uniform vec2 u_translation;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_patternscale_a;uniform float u_tex_y_a;uniform vec2 u_patternscale_b;uniform float u_tex_y_b;uniform vec2 u_units_to_pixels;out vec2 v_normal;out vec2 v_width2;out vec2 v_tex_a;out vec2 v_tex_b;out float v_gamma_scale;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);float adjustedThickness=projectLineThickness(pos.y);vec4 projected_no_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation);vec4 projected_with_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation+dist/u_ratio*adjustedThickness);gl_Position=projected_with_extrude;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length((projected_with_extrude.xy-projected_no_extrude.xy)/projected_with_extrude.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_tex_a=vec2(a_linesofar*u_patternscale_a.x/floorwidth,normal.y*u_patternscale_a.y+u_tex_y_a);v_tex_b=vec2(a_linesofar*u_patternscale_b.x/floorwidth,normal.y*u_patternscale_b.y+u_tex_y_b);v_width2=vec2(outset,inset);}`),raster:je(`uniform float u_fade_t;uniform float u_opacity;uniform sampler2D u_image0;uniform sampler2D u_image1;in vec2 v_pos0;in vec2 v_pos1;uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;void main() {vec4 color0=texture(u_image0,v_pos0);vec4 color1=texture(u_image1,v_pos1);if (color0.a > 0.0) {color0.rgb=color0.rgb/color0.a;}if (color1.a > 0.0) {color1.rgb=color1.rgb/color1.a;}vec4 color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 rgb=color.rgb;rgb=vec3(dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);fragColor=vec4(mix(u_high_vec,u_low_vec,rgb)*color.a,color.a);
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform float u_buffer_scale;uniform vec4 u_coords_top;uniform vec4 u_coords_bottom;in vec2 a_pos;out vec2 v_pos0;out vec2 v_pos1;void main() {vec2 fractionalPos=a_pos/8192.0;vec2 position=mix(mix(u_coords_top.xy,u_coords_top.zw,fractionalPos.x),mix(u_coords_bottom.xy,u_coords_bottom.zw,fractionalPos.x),fractionalPos.y);gl_Position=projectTile(position,position);v_pos0=((fractionalPos-0.5)/u_buffer_scale)+0.5;
#ifdef GLOBE
if (a_pos.y <-32767.5) {v_pos0.y=0.0;}if (a_pos.y > 32766.5) {v_pos0.y=1.0;}
#endif
v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;}`),symbolIcon:je(`uniform sampler2D u_texture;in vec2 v_tex;in float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
lowp float alpha=opacity*v_fade_opacity;fragColor=texture(u_texture,v_tex)*alpha;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`in vec4 a_pos_offset;in vec4 a_data;in vec4 a_pixeloffset;in vec3 a_projected_pos;in float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;uniform bool u_is_along_line;uniform bool u_is_variable_anchor;uniform vec2 u_translation;uniform float u_pitched_scale;out vec2 v_tex;out float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_minFontScale=a_pixeloffset.zw/256.0;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 translated_a_pos=a_pos+u_translation;vec4 projectedPoint=projectTileWithElevation(translated_a_pos,ele);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=projectTileWithElevation(translated_a_pos+vec2(1,0),ele);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos;if (u_is_along_line || u_is_variable_anchor) {projected_pos=vec4(a_projected_pos.xy,ele,1.0);} else if (u_pitch_with_map) {projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy+u_translation,ele,1.0);} else {projected_pos=u_label_plane_matrix*projectTileWithElevation(a_projected_pos.xy+u_translation,ele);}float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;float projectionScaling=1.0;
#ifdef GLOBE
if(u_pitch_with_map) {float anchor_pos_tile_y=(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w,z,1.0)).y;projectionScaling=mix(projectionScaling,1.0/circumferenceRatioAtTileY(anchor_pos_tile_y)*u_pitched_scale,u_projection_transition);}
#endif
vec4 finalPos=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*max(a_minFontScale,fontScale)+a_pxoffset/16.0)*projectionScaling,z,1.0);if(u_pitch_with_map) {finalPos=projectTileWithElevation(finalPos.xy,finalPos.z);}gl_Position=finalPos;v_tex=a_tex/u_texsize;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float visibility=calculate_visibility(projectedPoint);v_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));}`),symbolSDF:je(`#define SDF_PX 8.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;in vec2 v_data0;in vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float inner_edge=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);inner_edge=inner_edge+gamma*gamma_scale;}lowp float dist=texture(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(inner_edge-gamma_scaled,inner_edge+gamma_scaled,dist);if (u_is_halo) {lowp float halo_edge=(6.0-halo_width/fontScale)/SDF_PX;alpha=min(smoothstep(halo_edge-gamma_scaled,halo_edge+gamma_scaled,dist),1.0-alpha);}fragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`in vec4 a_pos_offset;in vec4 a_data;in vec4 a_pixeloffset;in vec3 a_projected_pos;in float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform bool u_is_along_line;uniform bool u_is_variable_anchor;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_translation;uniform float u_pitched_scale;out vec2 v_data0;out vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 translated_a_pos=a_pos+u_translation;vec4 projectedPoint=projectTileWithElevation(translated_a_pos,ele);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=projectTileWithElevation(translated_a_pos+vec2(1,0),ele);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos;if (u_is_along_line || u_is_variable_anchor) {projected_pos=vec4(a_projected_pos.xy,ele,1.0);} else if (u_pitch_with_map) {projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy+u_translation,ele,1.0);} else {projected_pos=u_label_plane_matrix*projectTileWithElevation(a_projected_pos.xy+u_translation,ele);}float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;float projectionScaling=1.0;
#ifdef GLOBE
if(u_pitch_with_map) {float anchor_pos_tile_y=(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w,z,1.0)).y;projectionScaling=mix(projectionScaling,1.0/circumferenceRatioAtTileY(anchor_pos_tile_y)*u_pitched_scale,u_projection_transition);}
#endif
vec4 finalPos=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset)*projectionScaling,z,1.0);if(u_pitch_with_map) {finalPos=projectTileWithElevation(finalPos.xy,finalPos.z);}float gamma_scale=finalPos.w;gl_Position=finalPos;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float visibility=calculate_visibility(projectedPoint);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,interpolated_fade_opacity);}`),symbolTextAndIcon:je(`#define SDF_PX 8.0
#define SDF 1.0
#define ICON 0.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;in vec4 v_data0;in vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;fragColor=texture(u_texture_icon,tex_icon)*alpha;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
return;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);fragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`in vec4 a_pos_offset;in vec4 a_data;in vec3 a_projected_pos;in float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_texsize_icon;uniform bool u_is_along_line;uniform bool u_is_variable_anchor;uniform vec2 u_translation;uniform float u_pitched_scale;out vec4 v_data0;out vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 translated_a_pos=a_pos+u_translation;vec4 projectedPoint=projectTileWithElevation(translated_a_pos,ele);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=projectTileWithElevation(translated_a_pos+vec2(1,0),ele);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos;if (u_is_along_line || u_is_variable_anchor) {projected_pos=vec4(a_projected_pos.xy,ele,1.0);} else if (u_pitch_with_map) {projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy+u_translation,ele,1.0);} else {projected_pos=u_label_plane_matrix*projectTileWithElevation(a_projected_pos.xy+u_translation,ele);}float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;float projectionScaling=1.0;
#ifdef GLOBE
if(u_pitch_with_map && !u_is_along_line) {float anchor_pos_tile_y=(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w,z,1.0)).y;projectionScaling=mix(projectionScaling,1.0/circumferenceRatioAtTileY(anchor_pos_tile_y)*u_pitched_scale,u_projection_transition);}
#endif
vec4 finalPos=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale)*projectionScaling,z,1.0);if(u_pitch_with_map) {finalPos=projectTileWithElevation(finalPos.xy,finalPos.z);}float gamma_scale=finalPos.w;gl_Position=finalPos;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float visibility=calculate_visibility(projectedPoint);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));v_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,interpolated_fade_opacity,is_sdf);}`),terrain:je("uniform sampler2D u_texture;uniform vec4 u_fog_color;uniform vec4 u_horizon_color;uniform float u_fog_ground_blend;uniform float u_fog_ground_blend_opacity;uniform float u_horizon_fog_blend;uniform bool u_is_globe_mode;in vec2 v_texture_pos;in float v_fog_depth;const float gamma=2.2;vec4 gammaToLinear(vec4 color) {return pow(color,vec4(gamma));}vec4 linearToGamma(vec4 color) {return pow(color,vec4(1.0/gamma));}void main() {vec4 surface_color=texture(u_texture,vec2(v_texture_pos.x,1.0-v_texture_pos.y));if (!u_is_globe_mode && v_fog_depth > u_fog_ground_blend) {vec4 surface_color_linear=gammaToLinear(surface_color);float blend_color=smoothstep(0.0,1.0,max((v_fog_depth-u_horizon_fog_blend)/(1.0-u_horizon_fog_blend),0.0));vec4 fog_horizon_color_linear=mix(gammaToLinear(u_fog_color),gammaToLinear(u_horizon_color),blend_color);float factor_fog=max(v_fog_depth-u_fog_ground_blend,0.0)/(1.0-u_fog_ground_blend);fragColor=linearToGamma(mix(surface_color_linear,fog_horizon_color_linear,pow(factor_fog,2.0)*u_fog_ground_blend_opacity));} else {fragColor=surface_color;}}","in vec3 a_pos3d;uniform mat4 u_fog_matrix;uniform float u_ele_delta;out vec2 v_texture_pos;out float v_fog_depth;void main() {float ele=get_elevation(a_pos3d.xy);float ele_delta=a_pos3d.z==1.0 ? u_ele_delta : 0.0;v_texture_pos=a_pos3d.xy/8192.0;gl_Position=projectTileFor3D(a_pos3d.xy,get_elevation(a_pos3d.xy)-ele_delta);vec4 pos=u_fog_matrix*vec4(a_pos3d.xy,ele,1.0);v_fog_depth=pos.z/pos.w*0.5+0.5;}"),terrainDepth:je("in float v_depth;const highp vec4 bitSh=vec4(256.*256.*256.,256.*256.,256.,1.);const highp vec4 bitMsk=vec4(0.,vec3(1./256.0));highp vec4 pack(highp float value) {highp vec4 comp=fract(value*bitSh);comp-=comp.xxyz*bitMsk;return comp;}void main() {fragColor=pack(v_depth);}","in vec3 a_pos3d;uniform float u_ele_delta;out float v_depth;void main() {float ele=get_elevation(a_pos3d.xy);float ele_delta=a_pos3d.z==1.0 ? u_ele_delta : 0.0;gl_Position=projectTileFor3D(a_pos3d.xy,ele-ele_delta);v_depth=gl_Position.z/gl_Position.w;}"),terrainCoords:je("precision mediump float;uniform sampler2D u_texture;uniform float u_terrain_coords_id;in vec2 v_texture_pos;void main() {vec4 rgba=texture(u_texture,v_texture_pos);fragColor=vec4(rgba.r,rgba.g,rgba.b,u_terrain_coords_id);}","in vec3 a_pos3d;uniform float u_ele_delta;out vec2 v_texture_pos;void main() {float ele=get_elevation(a_pos3d.xy);float ele_delta=a_pos3d.z==1.0 ? u_ele_delta : 0.0;v_texture_pos=a_pos3d.xy/8192.0;gl_Position=projectTileFor3D(a_pos3d.xy,ele-ele_delta);}"),projectionErrorMeasurement:je("in vec4 v_output_error_encoded;void main() {fragColor=v_output_error_encoded;}","in vec2 a_pos;uniform highp float u_input;uniform highp float u_output_expected;out vec4 v_output_error_encoded;void main() {float real_output=2.0*atan(exp(PI-(u_input*PI*2.0)))-PI*0.5;float error=real_output-u_output_expected;float abs_error=abs(error)*128.0;v_output_error_encoded.x=min(floor(abs_error*256.0),255.0)/255.0;abs_error-=v_output_error_encoded.x;v_output_error_encoded.y=min(floor(abs_error*65536.0),255.0)/255.0;abs_error-=v_output_error_encoded.x/255.0;v_output_error_encoded.z=min(floor(abs_error*16777216.0),255.0)/255.0;v_output_error_encoded.w=error >=0.0 ? 1.0 : 0.0;gl_Position=vec4(a_pos,0.0,1.0);}"),atmosphere:je(`in vec3 view_direction;uniform vec3 u_sun_pos;uniform vec3 u_globe_position;uniform float u_globe_radius;uniform float u_atmosphere_blend;/**Shader use from https:*Made some change to adapt to MapLibre Globe geometry*/const float PI=3.141592653589793;const int iSteps=5;const int jSteps=3;/*radius of the planet*/const float EARTH_RADIUS=6371e3;/*radius of the atmosphere*/const float ATMOS_RADIUS=6471e3;vec2 rsi(vec3 r0,vec3 rd,float sr) {float a=dot(rd,rd);float b=2.0*dot(rd,r0);float c=dot(r0,r0)-(sr*sr);float d=(b*b)-4.0*a*c;if (d < 0.0) return vec2(1e5,-1e5);return vec2((-b-sqrt(d))/(2.0*a),(-b+sqrt(d))/(2.0*a));}vec4 atmosphere(vec3 r,vec3 r0,vec3 pSun,float iSun,float rPlanet,float rAtmos,vec3 kRlh,float kMie,float shRlh,float shMie,float g) {pSun=normalize(pSun);r=normalize(r);vec2 p=rsi(r0,r,rAtmos);if (p.x > p.y) {return vec4(0.0,0.0,0.0,1.0);}if (p.x < 0.0) {p.x=0.0;}vec3 pos=r0+r*p.x;vec2 p2=rsi(r0,r,rPlanet);if (p2.x <=p2.y && p2.x > 0.0) {p.y=min(p.y,p2.x);}float iStepSize=(p.y-p.x)/float(iSteps);float iTime=p.x+iStepSize*0.5;vec3 totalRlh=vec3(0,0,0);vec3 totalMie=vec3(0,0,0);float iOdRlh=0.0;float iOdMie=0.0;float mu=dot(r,pSun);float mumu=mu*mu;float gg=g*g;float pRlh=3.0/(16.0*PI)*(1.0+mumu);float pMie=3.0/(8.0*PI)*((1.0-gg)*(mumu+1.0))/(pow(1.0+gg-2.0*mu*g,1.5)*(2.0+gg));for (int i=0; i < iSteps; i++) {vec3 iPos=r0+r*iTime;float iHeight=length(iPos)-rPlanet;float odStepRlh=exp(-iHeight/shRlh)*iStepSize;float odStepMie=exp(-iHeight/shMie)*iStepSize;iOdRlh+=odStepRlh;iOdMie+=odStepMie;float jStepSize=rsi(iPos,pSun,rAtmos).y/float(jSteps);float jTime=jStepSize*0.5;float jOdRlh=0.0;float jOdMie=0.0;for (int j=0; j < jSteps; j++) {vec3 jPos=iPos+pSun*jTime;float jHeight=length(jPos)-rPlanet;jOdRlh+=exp(-jHeight/shRlh)*jStepSize;jOdMie+=exp(-jHeight/shMie)*jStepSize;jTime+=jStepSize;}vec3 attn=exp(-(kMie*(iOdMie+jOdMie)+kRlh*(iOdRlh+jOdRlh)));totalRlh+=odStepRlh*attn;totalMie+=odStepMie*attn;iTime+=iStepSize;}float opacity=exp(-(length(kRlh)*length(totalRlh)+kMie*length(totalMie)));vec3 color=iSun*(pRlh*kRlh*totalRlh+pMie*kMie*totalMie);return vec4(color,opacity);}void main() {vec3 scale_camera_pos=-u_globe_position*EARTH_RADIUS/u_globe_radius;vec4 color=atmosphere(normalize(view_direction),scale_camera_pos,u_sun_pos,22.0,EARTH_RADIUS,ATMOS_RADIUS,vec3(5.5e-6,13.0e-6,22.4e-6),21e-6,8e3,1.2e3,0.758
);color.rgb=1.0-exp(-1.0*color.rgb);color=pow(color,vec4(1.0/2.2));fragColor=vec4(color.rgb,1.0-color.a)*u_atmosphere_blend;}`,"in vec2 a_pos;uniform mat4 u_inv_proj_matrix;out vec3 view_direction;void main() {view_direction=(u_inv_proj_matrix*vec4(a_pos,0.0,1.0)).xyz;gl_Position=vec4(a_pos,0.0,1.0);}"),sky:je("uniform vec4 u_sky_color;uniform vec4 u_horizon_color;uniform vec2 u_horizon;uniform vec2 u_horizon_normal;uniform float u_sky_horizon_blend;uniform float u_sky_blend;void main() {float x=gl_FragCoord.x;float y=gl_FragCoord.y;float blend=(y-u_horizon.y)*u_horizon_normal.y+(x-u_horizon.x)*u_horizon_normal.x;if (blend > 0.0) {if (blend < u_sky_horizon_blend) {fragColor=mix(u_sky_color,u_horizon_color,pow(1.0-blend/u_sky_horizon_blend,2.0));} else {fragColor=u_sky_color;}}fragColor=mix(fragColor,vec4(vec3(0.0),0.0),u_sky_blend);}","in vec2 a_pos;void main() {gl_Position=vec4(a_pos,1.0,1.0);}")};function je(b,t){const l=/#pragma mapbox: ([\w]+) ([\w]+) ([\w]+) ([\w]+)/g,f=t.match(/in ([\w]+) ([\w]+)/g),g=b.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),w=t.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),I=w?w.concat(g):g,k={};return{fragmentSource:b=b.replace(l,(R,z,G,X,W)=>(k[W]=!0,z==="define"?`
#ifndef HAS_UNIFORM_u_${W}
in ${G} ${X} ${W};
#else
uniform ${G} ${X} u_${W};
#endif
`:`
#ifdef HAS_UNIFORM_u_${W}
    ${G} ${X} ${W} = u_${W};
#endif
`)),vertexSource:t=t.replace(l,(R,z,G,X,W)=>{const te=X==="float"?"vec2":"vec4",ae=W.match(/color/)?"color":te;return k[W]?z==="define"?`
#ifndef HAS_UNIFORM_u_${W}
uniform lowp float u_${W}_t;
in ${G} ${te} a_${W};
out ${G} ${X} ${W};
#else
uniform ${G} ${X} u_${W};
#endif
`:ae==="vec4"?`
#ifndef HAS_UNIFORM_u_${W}
    ${W} = a_${W};
#else
    ${G} ${X} ${W} = u_${W};
#endif
`:`
#ifndef HAS_UNIFORM_u_${W}
    ${W} = unpack_mix_${ae}(a_${W}, u_${W}_t);
#else
    ${G} ${X} ${W} = u_${W};
#endif
`:z==="define"?`
#ifndef HAS_UNIFORM_u_${W}
uniform lowp float u_${W}_t;
in ${G} ${te} a_${W};
#else
uniform ${G} ${X} u_${W};
#endif
`:ae==="vec4"?`
#ifndef HAS_UNIFORM_u_${W}
    ${G} ${X} ${W} = a_${W};
#else
    ${G} ${X} ${W} = u_${W};
#endif
`:`
#ifndef HAS_UNIFORM_u_${W}
    ${G} ${X} ${W} = unpack_mix_${ae}(a_${W}, u_${W}_t);
#else
    ${G} ${X} ${W} = u_${W};
#endif
`}),staticAttributes:f,staticUniforms:I}}class rt{constructor(t,l,f){this.vertexBuffer=t,this.indexBuffer=l,this.segments=f}destroy(){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.vertexBuffer=null,this.indexBuffer=null,this.segments=null}}var Ct=o.aI([{name:"a_pos",type:"Int16",components:2}]);const Dt="#define PROJECTION_MERCATOR",Nt="mercator";class Wt{constructor(){this._cachedMesh=null}get name(){return"mercator"}get useSubdivision(){return!1}get shaderVariantName(){return Nt}get shaderDefine(){return Dt}get shaderPreludeCode(){return qe.projectionMercator}get vertexShaderPreludeCode(){return qe.projectionMercator.vertexSource}get subdivisionGranularity(){return o.aJ.noSubdivision}get useGlobeControls(){return!1}get transitionState(){return 0}get latitudeErrorCorrectionRadians(){return 0}destroy(){}updateGPUdependent(t){}getMeshFromTileID(t,l,f,g,w){if(this._cachedMesh)return this._cachedMesh;const I=new o.aK;I.emplaceBack(0,0),I.emplaceBack(o.$,0),I.emplaceBack(0,o.$),I.emplaceBack(o.$,o.$);const k=t.createVertexBuffer(I,Ct.members),R=o.aL.simpleSegment(0,0,4,2),z=new o.aM;z.emplaceBack(1,0,2),z.emplaceBack(1,2,3);const G=t.createIndexBuffer(z);return this._cachedMesh=new rt(k,G,R),this._cachedMesh}recalculate(){}hasTransition(){return!1}setErrorQueryLatitudeDegrees(t){}}class jt{constructor(t=0,l=0,f=0,g=0){if(isNaN(t)||t<0||isNaN(l)||l<0||isNaN(f)||f<0||isNaN(g)||g<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=t,this.bottom=l,this.left=f,this.right=g}interpolate(t,l,f){return l.top!=null&&t.top!=null&&(this.top=o.C.number(t.top,l.top,f)),l.bottom!=null&&t.bottom!=null&&(this.bottom=o.C.number(t.bottom,l.bottom,f)),l.left!=null&&t.left!=null&&(this.left=o.C.number(t.left,l.left,f)),l.right!=null&&t.right!=null&&(this.right=o.C.number(t.right,l.right,f)),this}getCenter(t,l){const f=o.ag((this.left+t-this.right)/2,0,t),g=o.ag((this.top+l-this.bottom)/2,0,l);return new o.P(f,g)}equals(t){return this.top===t.top&&this.bottom===t.bottom&&this.left===t.left&&this.right===t.right}clone(){return new jt(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}function ki(b,t){if(!b.renderWorldCopies||b.lngRange)return;const l=t.lng-b.center.lng;t.lng+=l>180?-360:l<-180?360:0}function si(b){return Math.max(0,Math.floor(b))}class Pi{constructor(t,l,f,g,w,I){this._callbacks=t,this._tileSize=512,this._renderWorldCopies=I===void 0||!!I,this._minZoom=l||0,this._maxZoom=f||22,this._minPitch=g??0,this._maxPitch=w??60,this.setMaxBounds(),this._width=0,this._height=0,this._center=new o.S(0,0),this._elevation=0,this._zoom=0,this._tileZoom=si(this._zoom),this._scale=o.ae(this._zoom),this._bearingInRadians=0,this._fovInRadians=.6435011087932844,this._pitchInRadians=0,this._rollInRadians=0,this._unmodified=!0,this._edgeInsets=new jt,this._minElevationForCurrentTile=0,this._autoCalculateNearFarZ=!0}apply(t,l,f){this._latRange=t.latRange,this._lngRange=t.lngRange,this._width=t.width,this._height=t.height,this._center=t.center,this._elevation=t.elevation,this._minElevationForCurrentTile=t.minElevationForCurrentTile,this._zoom=t.zoom,this._tileZoom=si(this._zoom),this._scale=o.ae(this._zoom),this._bearingInRadians=t.bearingInRadians,this._fovInRadians=t.fovInRadians,this._pitchInRadians=t.pitchInRadians,this._rollInRadians=t.rollInRadians,this._unmodified=t.unmodified,this._edgeInsets=new jt(t.padding.top,t.padding.bottom,t.padding.left,t.padding.right),this._minZoom=t.minZoom,this._maxZoom=t.maxZoom,this._minPitch=t.minPitch,this._maxPitch=t.maxPitch,this._renderWorldCopies=t.renderWorldCopies,this._cameraToCenterDistance=t.cameraToCenterDistance,this._nearZ=t.nearZ,this._farZ=t.farZ,this._autoCalculateNearFarZ=!f&&t.autoCalculateNearFarZ,l&&this._constrain(),this._calcMatrices()}get pixelsToClipSpaceMatrix(){return this._pixelsToClipSpaceMatrix}get clipSpaceToPixelsMatrix(){return this._clipSpaceToPixelsMatrix}get minElevationForCurrentTile(){return this._minElevationForCurrentTile}setMinElevationForCurrentTile(t){this._minElevationForCurrentTile=t}get tileSize(){return this._tileSize}get tileZoom(){return this._tileZoom}get scale(){return this._scale}get width(){return this._width}get height(){return this._height}get bearingInRadians(){return this._bearingInRadians}get lngRange(){return this._lngRange}get latRange(){return this._latRange}get pixelsToGLUnits(){return this._pixelsToGLUnits}get minZoom(){return this._minZoom}setMinZoom(t){this._minZoom!==t&&(this._minZoom=t,this.setZoom(this.getConstrained(this._center,this.zoom).zoom))}get maxZoom(){return this._maxZoom}setMaxZoom(t){this._maxZoom!==t&&(this._maxZoom=t,this.setZoom(this.getConstrained(this._center,this.zoom).zoom))}get minPitch(){return this._minPitch}setMinPitch(t){this._minPitch!==t&&(this._minPitch=t,this.setPitch(Math.max(this.pitch,t)))}get maxPitch(){return this._maxPitch}setMaxPitch(t){this._maxPitch!==t&&(this._maxPitch=t,this.setPitch(Math.min(this.pitch,t)))}get renderWorldCopies(){return this._renderWorldCopies}setRenderWorldCopies(t){t===void 0?t=!0:t===null&&(t=!1),this._renderWorldCopies=t}get worldSize(){return this._tileSize*this._scale}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new o.P(this._width,this._height)}get bearing(){return this._bearingInRadians/Math.PI*180}setBearing(t){const l=o.aN(t,-180,180)*Math.PI/180;var f,g,w,I,k,R,z,G,X;this._bearingInRadians!==l&&(this._unmodified=!1,this._bearingInRadians=l,this._calcMatrices(),this._rotationMatrix=L(),f=this._rotationMatrix,w=-this._bearingInRadians,I=(g=this._rotationMatrix)[0],k=g[1],R=g[2],z=g[3],G=Math.sin(w),X=Math.cos(w),f[0]=I*X+R*G,f[1]=k*X+z*G,f[2]=I*-G+R*X,f[3]=k*-G+z*X)}get rotationMatrix(){return this._rotationMatrix}get pitchInRadians(){return this._pitchInRadians}get pitch(){return this._pitchInRadians/Math.PI*180}setPitch(t){const l=o.ag(t,this.minPitch,this.maxPitch)/180*Math.PI;this._pitchInRadians!==l&&(this._unmodified=!1,this._pitchInRadians=l,this._calcMatrices())}get rollInRadians(){return this._rollInRadians}get roll(){return this._rollInRadians/Math.PI*180}setRoll(t){const l=t/180*Math.PI;this._rollInRadians!==l&&(this._unmodified=!1,this._rollInRadians=l,this._calcMatrices())}get fovInRadians(){return this._fovInRadians}get fov(){return o.aO(this._fovInRadians)}setFov(t){t=o.ag(t,.1,150),this.fov!==t&&(this._unmodified=!1,this._fovInRadians=o.ad(t),this._calcMatrices())}get zoom(){return this._zoom}setZoom(t){const l=this.getConstrained(this._center,t).zoom;this._zoom!==l&&(this._unmodified=!1,this._zoom=l,this._tileZoom=Math.max(0,Math.floor(l)),this._scale=o.ae(l),this._constrain(),this._calcMatrices())}get center(){return this._center}setCenter(t){t.lat===this._center.lat&&t.lng===this._center.lng||(this._unmodified=!1,this._center=t,this._constrain(),this._calcMatrices())}get elevation(){return this._elevation}setElevation(t){t!==this._elevation&&(this._elevation=t,this._constrain(),this._calcMatrices())}get padding(){return this._edgeInsets.toJSON()}setPadding(t){this._edgeInsets.equals(t)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,t,1),this._calcMatrices())}get centerPoint(){return this._edgeInsets.getCenter(this._width,this._height)}get pixelsPerMeter(){return this._pixelPerMeter}get unmodified(){return this._unmodified}get cameraToCenterDistance(){return this._cameraToCenterDistance}get nearZ(){return this._nearZ}get farZ(){return this._farZ}get autoCalculateNearFarZ(){return this._autoCalculateNearFarZ}overrideNearFarZ(t,l){this._autoCalculateNearFarZ=!1,this._nearZ=t,this._farZ=l,this._calcMatrices()}clearNearFarZOverride(){this._autoCalculateNearFarZ=!0,this._calcMatrices()}isPaddingEqual(t){return this._edgeInsets.equals(t)}interpolatePadding(t,l,f){this._unmodified=!1,this._edgeInsets.interpolate(t,l,f),this._constrain(),this._calcMatrices()}resize(t,l,f=!0){this._width=t,this._height=l,f&&this._constrain(),this._calcMatrices()}getMaxBounds(){return this._latRange&&this._latRange.length===2&&this._lngRange&&this._lngRange.length===2?new zi([this._lngRange[0],this._latRange[0]],[this._lngRange[1],this._latRange[1]]):null}setMaxBounds(t){t?(this._lngRange=[t.getWest(),t.getEast()],this._latRange=[t.getSouth(),t.getNorth()],this._constrain()):(this._lngRange=null,this._latRange=[-o.ah,o.ah])}getConstrained(t,l){return this._callbacks.getConstrained(t,l)}getCameraQueryGeometry(t,l){if(l.length===1)return[l[0],t];{const{minX:f,minY:g,maxX:w,maxY:I}=o.a1.fromPoints(l).extend(t);return[new o.P(f,g),new o.P(w,g),new o.P(w,I),new o.P(f,I),new o.P(f,g)]}}_constrain(){if(!this.center||!this._width||!this._height||this._constraining)return;this._constraining=!0;const t=this._unmodified,{center:l,zoom:f}=this.getConstrained(this.center,this.zoom);this.setCenter(l),this.setZoom(f),this._unmodified=t,this._constraining=!1}_calcMatrices(){if(this._width&&this._height){this._pixelsToGLUnits=[2/this._width,-2/this._height];let t=o.af(new Float64Array(16));o.N(t,t,[this._width/2,-this._height/2,1]),o.M(t,t,[1,-1,0]),this._clipSpaceToPixelsMatrix=t,t=o.af(new Float64Array(16)),o.N(t,t,[1,-1,1]),o.M(t,t,[-1,-1,0]),o.N(t,t,[2/this._width,2/this._height,1]),this._pixelsToClipSpaceMatrix=t,this._cameraToCenterDistance=.5/Math.tan(this.fovInRadians/2)*this._height}this._callbacks.calcMatrices()}calculateCenterFromCameraLngLatAlt(t,l,f,g){const w=f!==void 0?f:this.bearing,I=g=g!==void 0?g:this.pitch,k=o.a0.fromLngLat(t,l),R=-Math.cos(o.ad(I)),z=Math.sin(o.ad(I)),G=z*Math.sin(o.ad(w)),X=-z*Math.cos(o.ad(w));let W=this.elevation;const te=l-W;let ae;R*te>=0||Math.abs(R)<.1?(ae=1e4,W=l+ae*R):ae=-te/R;let Te,we,Ee=o.aP(1,k.y),Ce=0;do{if(Ce+=1,Ce>10)break;we=ae/Ee,Te=new o.a0(k.x+G*we,k.y+X*we),Ee=1/Te.meterInMercatorCoordinateUnits()}while(Math.abs(ae-we*Ee)>1e-12);return{center:Te.toLngLat(),elevation:W,zoom:o.aj(this.height/2/Math.tan(this.fovInRadians/2)/we/this.tileSize)}}recalculateZoomAndCenter(t){if(this.elevation-t==0)return;const l=o.ai(1,this.center.lat)*this.worldSize,f=this.cameraToCenterDistance/l,g=o.a0.fromLngLat(this.center,this.elevation),w=Le(this.center,this.elevation,this.pitch,this.bearing,f);this._elevation=t;const I=this.calculateCenterFromCameraLngLatAlt(w.toLngLat(),o.aP(w.z,g.y),this.bearing,this.pitch);this._elevation=I.elevation,this._center=I.center,this.setZoom(I.zoom)}getCameraPoint(){const t=Math.tan(this.pitchInRadians)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new o.P(t*Math.sin(this.rollInRadians),t*Math.cos(this.rollInRadians)))}getCameraAltitude(){return Math.cos(this.pitchInRadians)*this._cameraToCenterDistance/this._pixelPerMeter+this.elevation}getCameraLngLat(){const t=o.ai(1,this.center.lat)*this.worldSize;return Le(this.center,this.elevation,this.pitch,this.bearing,this.cameraToCenterDistance/t).toLngLat()}getMercatorTileCoordinates(t){if(!t)return[0,0,1,1];const l=t.canonical.z>=0?1<<t.canonical.z:Math.pow(2,t.canonical.z);return[t.canonical.x/l,t.canonical.y/l,1/l/o.$,1/l/o.$]}}class Rr{constructor(t,l){this.min=t,this.max=l,this.center=o.aQ([],o.aR([],this.min,this.max),.5)}quadrant(t){const l=[t%2==0,t<2],f=o.aS(this.min),g=o.aS(this.max);for(let w=0;w<l.length;w++)f[w]=l[w]?this.min[w]:this.center[w],g[w]=l[w]?this.center[w]:this.max[w];return g[2]=this.max[2],new Rr(f,g)}distanceX(t){return Math.max(Math.min(this.max[0],t[0]),this.min[0])-t[0]}distanceY(t){return Math.max(Math.min(this.max[1],t[1]),this.min[1])-t[1]}intersectsFrustum(t){let l=!0;for(let f=0;f<t.planes.length;f++){const g=this.intersectsPlane(t.planes[f]);if(g===0)return 0;g===1&&(l=!1)}return l?2:t.aabb.min[0]>this.max[0]||t.aabb.min[1]>this.max[1]||t.aabb.min[2]>this.max[2]||t.aabb.max[0]<this.min[0]||t.aabb.max[1]<this.min[1]||t.aabb.max[2]<this.min[2]?0:1}intersectsPlane(t){let l=t[3],f=t[3];for(let g=0;g<3;g++)t[g]>0?(l+=t[g]*this.min[g],f+=t[g]*this.max[g]):(f+=t[g]*this.min[g],l+=t[g]*this.max[g]);return l>=0?2:f<0?0:1}}class Mt{distanceToTile2d(t,l,f,g){const w=g.distanceX([t,l]),I=g.distanceY([t,l]);return Math.hypot(w,I)}getWrap(t,l,f){return f}getTileBoundingVolume(t,l,f,g){var w,I;let k=f,R=f;if(g?.terrain){const G=new o.Z(t.z,l,t.z,t.x,t.y),X=g.terrain.getMinMaxElevation(G);k=(w=X.minElevation)!==null&&w!==void 0?w:f,R=(I=X.maxElevation)!==null&&I!==void 0?I:f}const z=1<<t.z;return new Rr([l+t.x/z,t.y/z,k],[l+(t.x+1)/z,(t.y+1)/z,R])}allowVariableZoom(t,l){const f=t.fov*(Math.abs(Math.cos(t.rollInRadians))*t.height+Math.abs(Math.sin(t.rollInRadians))*t.width)/t.height,g=o.ag(78.5-f/2,0,60);return!!l.terrain||t.pitch>g}allowWorldCopies(){return!0}prepareNextFrame(){}}class ei{constructor(t,l,f){this.points=t,this.planes=l,this.aabb=f}static fromInvProjectionMatrix(t,l=1,f=0,g,w){const I=w?[[6,5,4],[0,1,2],[0,3,7],[2,1,5],[3,2,6],[0,4,5]]:[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]],k=Math.pow(2,f),R=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(W=>function(te,ae,Te,we){const Ee=o.av([],te,ae),Ce=1/Ee[3]/Te*we;return o.aX(Ee,Ee,[Ce,Ce,1/Ee[3],Ce])}(W,t,l,k));g&&function(W,te,ae,Te){const we=Te?4:0,Ee=Te?0:4;let Ce=0;const Fe=[],Oe=[];for(let De=0;De<4;De++){const Qe=o.aT([],W[De+Ee],W[De+we]),yt=o.aY(Qe);o.aQ(Qe,Qe,1/yt),Fe.push(yt),Oe.push(Qe)}for(let De=0;De<4;De++){const Qe=o.aZ(W[De+we],Oe[De],ae);Ce=Qe!==null&&Qe>=0?Math.max(Ce,Qe):Math.max(Ce,Fe[De])}const Ue=function(De,Qe){const yt=o.aT([],De[Qe[0]],De[Qe[1]]),ct=o.aT([],De[Qe[2]],De[Qe[1]]),dt=[0,0,0,0];return o.aU(dt,o.aV([],yt,ct)),dt[3]=-o.aW(dt,De[Qe[0]]),dt}(W,te),We=function(De,Qe){const yt=o.a_(De),ct=o.a$([],De,1/yt),dt=o.aT([],Qe,o.aQ([],ct,o.aW(Qe,ct))),_t=o.a_(dt);if(_t>0){const qt=Math.sqrt(1-ct[3]*ct[3]),Vt=o.aQ([],ct,-ct[3]),kt=o.aR([],Vt,o.aQ([],dt,qt/_t));return o.b0(Qe,kt)}return null}(ae,Ue);if(We!==null){const De=We/o.aW(Oe[0],Ue);Ce=Math.min(Ce,De)}for(let De=0;De<4;De++){const Qe=Math.min(Ce,Fe[De]);W[De+Ee]=[W[De+we][0]+Oe[De][0]*Qe,W[De+we][1]+Oe[De][1]*Qe,W[De+we][2]+Oe[De][2]*Qe,1]}}(R,I[0],g,w);const z=I.map(W=>{const te=o.aT([],R[W[0]],R[W[1]]),ae=o.aT([],R[W[2]],R[W[1]]),Te=o.aU([],o.aV([],te,ae)),we=-o.aW(Te,R[W[1]]);return Te.concat(we)}),G=[Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY],X=[Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY];for(const W of R)for(let te=0;te<3;te++)G[te]=Math.min(G[te],W[te]),X[te]=Math.max(X[te],W[te]);return new ei(R,z,new Rr(G,X))}}class ji{get pixelsToClipSpaceMatrix(){return this._helper.pixelsToClipSpaceMatrix}get clipSpaceToPixelsMatrix(){return this._helper.clipSpaceToPixelsMatrix}get pixelsToGLUnits(){return this._helper.pixelsToGLUnits}get centerOffset(){return this._helper.centerOffset}get size(){return this._helper.size}get rotationMatrix(){return this._helper.rotationMatrix}get centerPoint(){return this._helper.centerPoint}get pixelsPerMeter(){return this._helper.pixelsPerMeter}setMinZoom(t){this._helper.setMinZoom(t)}setMaxZoom(t){this._helper.setMaxZoom(t)}setMinPitch(t){this._helper.setMinPitch(t)}setMaxPitch(t){this._helper.setMaxPitch(t)}setRenderWorldCopies(t){this._helper.setRenderWorldCopies(t)}setBearing(t){this._helper.setBearing(t)}setPitch(t){this._helper.setPitch(t)}setRoll(t){this._helper.setRoll(t)}setFov(t){this._helper.setFov(t)}setZoom(t){this._helper.setZoom(t)}setCenter(t){this._helper.setCenter(t)}setElevation(t){this._helper.setElevation(t)}setMinElevationForCurrentTile(t){this._helper.setMinElevationForCurrentTile(t)}setPadding(t){this._helper.setPadding(t)}interpolatePadding(t,l,f){return this._helper.interpolatePadding(t,l,f)}isPaddingEqual(t){return this._helper.isPaddingEqual(t)}resize(t,l,f=!0){this._helper.resize(t,l,f)}getMaxBounds(){return this._helper.getMaxBounds()}setMaxBounds(t){this._helper.setMaxBounds(t)}overrideNearFarZ(t,l){this._helper.overrideNearFarZ(t,l)}clearNearFarZOverride(){this._helper.clearNearFarZOverride()}getCameraQueryGeometry(t){return this._helper.getCameraQueryGeometry(this.getCameraPoint(),t)}get tileSize(){return this._helper.tileSize}get tileZoom(){return this._helper.tileZoom}get scale(){return this._helper.scale}get worldSize(){return this._helper.worldSize}get width(){return this._helper.width}get height(){return this._helper.height}get lngRange(){return this._helper.lngRange}get latRange(){return this._helper.latRange}get minZoom(){return this._helper.minZoom}get maxZoom(){return this._helper.maxZoom}get zoom(){return this._helper.zoom}get center(){return this._helper.center}get minPitch(){return this._helper.minPitch}get maxPitch(){return this._helper.maxPitch}get pitch(){return this._helper.pitch}get pitchInRadians(){return this._helper.pitchInRadians}get roll(){return this._helper.roll}get rollInRadians(){return this._helper.rollInRadians}get bearing(){return this._helper.bearing}get bearingInRadians(){return this._helper.bearingInRadians}get fov(){return this._helper.fov}get fovInRadians(){return this._helper.fovInRadians}get elevation(){return this._helper.elevation}get minElevationForCurrentTile(){return this._helper.minElevationForCurrentTile}get padding(){return this._helper.padding}get unmodified(){return this._helper.unmodified}get renderWorldCopies(){return this._helper.renderWorldCopies}get cameraToCenterDistance(){return this._helper.cameraToCenterDistance}get nearZ(){return this._helper.nearZ}get farZ(){return this._helper.farZ}get autoCalculateNearFarZ(){return this._helper.autoCalculateNearFarZ}setTransitionState(t,l){}constructor(t,l,f,g,w){this._posMatrixCache=new Map,this._alignedPosMatrixCache=new Map,this._fogMatrixCacheF32=new Map,this._helper=new Pi({calcMatrices:()=>{this._calcMatrices()},getConstrained:(I,k)=>this.getConstrained(I,k)},t,l,f,g,w),this._coveringTilesDetailsProvider=new Mt}clone(){const t=new ji;return t.apply(this),t}apply(t,l,f){this._helper.apply(t,l,f)}get cameraPosition(){return this._cameraPosition}get projectionMatrix(){return this._projectionMatrix}get modelViewProjectionMatrix(){return this._viewProjMatrix}get inverseProjectionMatrix(){return this._invProjMatrix}get mercatorMatrix(){return this._mercatorMatrix}getVisibleUnwrappedCoordinates(t){const l=[new o.b1(0,t)];if(this._helper._renderWorldCopies){const f=this.screenPointToMercatorCoordinate(new o.P(0,0)),g=this.screenPointToMercatorCoordinate(new o.P(this._helper._width,0)),w=this.screenPointToMercatorCoordinate(new o.P(this._helper._width,this._helper._height)),I=this.screenPointToMercatorCoordinate(new o.P(0,this._helper._height)),k=Math.floor(Math.min(f.x,g.x,w.x,I.x)),R=Math.floor(Math.max(f.x,g.x,w.x,I.x)),z=1;for(let G=k-z;G<=R+z;G++)G!==0&&l.push(new o.b1(G,t))}return l}getCameraFrustum(){return ei.fromInvProjectionMatrix(this._invViewProjMatrix,this.worldSize)}getClippingPlane(){return null}getCoveringTilesDetailsProvider(){return this._coveringTilesDetailsProvider}recalculateZoomAndCenter(t){const l=this.screenPointToLocation(this.centerPoint,t),f=t?t.getElevationForLngLatZoom(l,this._helper._tileZoom):0;this._helper.recalculateZoomAndCenter(f)}setLocationAtPoint(t,l){const f=o.ai(this.elevation,this.center.lat),g=this.screenPointToMercatorCoordinateAtZ(l,f),w=this.screenPointToMercatorCoordinateAtZ(this.centerPoint,f),I=o.a0.fromLngLat(t),k=new o.a0(I.x-(g.x-w.x),I.y-(g.y-w.y));this.setCenter(k?.toLngLat()),this._helper._renderWorldCopies&&this.setCenter(this.center.wrap())}locationToScreenPoint(t,l){return l?this.coordinatePoint(o.a0.fromLngLat(t),l.getElevationForLngLatZoom(t,this._helper._tileZoom),this._pixelMatrix3D):this.coordinatePoint(o.a0.fromLngLat(t))}screenPointToLocation(t,l){var f;return(f=this.screenPointToMercatorCoordinate(t,l))===null||f===void 0?void 0:f.toLngLat()}screenPointToMercatorCoordinate(t,l){if(l){const f=l.pointCoordinate(t);if(f!=null)return f}return this.screenPointToMercatorCoordinateAtZ(t)}screenPointToMercatorCoordinateAtZ(t,l){const f=l||0,g=[t.x,t.y,0,1],w=[t.x,t.y,1,1];o.av(g,g,this._pixelMatrixInverse),o.av(w,w,this._pixelMatrixInverse);const I=g[3],k=w[3],R=g[1]/I,z=w[1]/k,G=g[2]/I,X=w[2]/k,W=G===X?0:(f-G)/(X-G);return new o.a0(o.C.number(g[0]/I,w[0]/k,W)/this.worldSize,o.C.number(R,z,W)/this.worldSize,f)}coordinatePoint(t,l=0,f=this._pixelMatrix){const g=[t.x*this.worldSize,t.y*this.worldSize,l,1];return o.av(g,g,f),new o.P(g[0]/g[3],g[1]/g[3])}getBounds(){const t=Math.max(0,this._helper._height/2-pe(this));return new zi().extend(this.screenPointToLocation(new o.P(0,t))).extend(this.screenPointToLocation(new o.P(this._helper._width,t))).extend(this.screenPointToLocation(new o.P(this._helper._width,this._helper._height))).extend(this.screenPointToLocation(new o.P(0,this._helper._height)))}isPointOnMapSurface(t,l){return l?l.pointCoordinate(t)!=null:t.y>this.height/2-pe(this)}calculatePosMatrix(t,l=!1,f){var g;const w=(g=t.key)!==null&&g!==void 0?g:o.b2(t.wrap,t.canonical.z,t.canonical.z,t.canonical.x,t.canonical.y),I=l?this._alignedPosMatrixCache:this._posMatrixCache;if(I.has(w)){const z=I.get(w);return f?z.f32:z.f64}const k=me(t,this.worldSize);o.O(k,l?this._alignedProjMatrix:this._viewProjMatrix,k);const R={f64:k,f32:new Float32Array(k)};return I.set(w,R),f?R.f32:R.f64}calculateFogMatrix(t){const l=t.key,f=this._fogMatrixCacheF32;if(f.has(l))return f.get(l);const g=me(t,this.worldSize);return o.O(g,this._fogMatrix,g),f.set(l,new Float32Array(g)),f.get(l)}getConstrained(t,l){l=o.ag(+l,this.minZoom,this.maxZoom);const f={center:new o.S(t.lng,t.lat),zoom:l};let g=this._helper._lngRange;if(!this._helper._renderWorldCopies&&g===null){const Fe=179.9999999999;g=[-Fe,Fe]}const w=this.tileSize*o.ae(f.zoom);let I=0,k=w,R=0,z=w,G=0,X=0;const{x:W,y:te}=this.size;if(this._helper._latRange){const Fe=this._helper._latRange;I=o.U(Fe[1])*w,k=o.U(Fe[0])*w,k-I<te&&(G=te/(k-I))}g&&(R=o.aN(o.V(g[0])*w,0,w),z=o.aN(o.V(g[1])*w,0,w),z<R&&(z+=w),z-R<W&&(X=W/(z-R)));const{x:ae,y:Te}=et(w,t);let we,Ee;const Ce=Math.max(X||0,G||0);if(Ce){const Fe=new o.P(X?(z+R)/2:ae,G?(k+I)/2:Te);return f.center=le(w,Fe).wrap(),f.zoom+=o.aj(Ce),f}if(this._helper._latRange){const Fe=te/2;Te-Fe<I&&(Ee=I+Fe),Te+Fe>k&&(Ee=k-Fe)}if(g){const Fe=(R+z)/2;let Oe=ae;this._helper._renderWorldCopies&&(Oe=o.aN(ae,Fe-w/2,Fe+w/2));const Ue=W/2;Oe-Ue<R&&(we=R+Ue),Oe+Ue>z&&(we=z-Ue)}if(we!==void 0||Ee!==void 0){const Fe=new o.P(we??ae,Ee??Te);f.center=le(w,Fe).wrap()}return f}calculateCenterFromCameraLngLatAlt(t,l,f,g){return this._helper.calculateCenterFromCameraLngLatAlt(t,l,f,g)}_calculateNearFarZIfNeeded(t,l,f){if(!this._helper.autoCalculateNearFarZ)return;const g=Math.min(this.elevation,this.minElevationForCurrentTile,this.getCameraAltitude()-100),w=t-g*this._helper._pixelPerMeter/Math.cos(l),I=g<0?w:t,k=Math.PI/2+this.pitchInRadians,R=o.ad(this.fov)*(Math.abs(Math.cos(o.ad(this.roll)))*this.height+Math.abs(Math.sin(o.ad(this.roll)))*this.width)/this.height*(.5+f.y/this.height),z=Math.sin(R)*I/Math.sin(o.ag(Math.PI-k-R,.01,Math.PI-.01)),G=pe(this),X=Math.atan(G/this._helper.cameraToCenterDistance),W=o.ad(.75),te=X>W?2*X*(.5+f.y/(2*G)):W,ae=Math.sin(te)*I/Math.sin(o.ag(Math.PI-k-te,.01,Math.PI-.01)),Te=Math.min(z,ae);this._helper._farZ=1.01*(Math.cos(Math.PI/2-l)*Te+I),this._helper._nearZ=this._helper._height/50}_calcMatrices(){if(!this._helper._height)return;const t=this.centerOffset,l=et(this.worldSize,this.center),f=l.x,g=l.y;this._helper._pixelPerMeter=o.ai(1,this.center.lat)*this.worldSize;const w=o.ad(Math.min(this.pitch,Ii)),I=Math.max(this._helper.cameraToCenterDistance/2,this._helper.cameraToCenterDistance+this._helper._elevation*this._helper._pixelPerMeter/Math.cos(w));let k;this._calculateNearFarZIfNeeded(I,w,t),k=new Float64Array(16),o.b3(k,this.fovInRadians,this._helper._width/this._helper._height,this._helper._nearZ,this._helper._farZ),this._invProjMatrix=new Float64Array(16),o.ap(this._invProjMatrix,k),k[8]=2*-t.x/this._helper._width,k[9]=2*t.y/this._helper._height,this._projectionMatrix=o.b4(k),o.N(k,k,[1,-1,1]),o.M(k,k,[0,0,-this._helper.cameraToCenterDistance]),o.b5(k,k,-this.rollInRadians),o.b6(k,k,this.pitchInRadians),o.b5(k,k,-this.bearingInRadians),o.M(k,k,[-f,-g,0]),this._mercatorMatrix=o.N([],k,[this.worldSize,this.worldSize,this.worldSize]),o.N(k,k,[1,1,this._helper._pixelPerMeter]),this._pixelMatrix=o.O(new Float64Array(16),this.clipSpaceToPixelsMatrix,k),o.M(k,k,[0,0,-this.elevation]),this._viewProjMatrix=k,this._invViewProjMatrix=o.ap([],k);const R=[0,0,-1,1];o.av(R,R,this._invViewProjMatrix),this._cameraPosition=[R[0]/R[3],R[1]/R[3],R[2]/R[3]],this._fogMatrix=new Float64Array(16),o.b3(this._fogMatrix,this.fovInRadians,this.width/this.height,I,this._helper._farZ),this._fogMatrix[8]=2*-t.x/this.width,this._fogMatrix[9]=2*t.y/this.height,o.N(this._fogMatrix,this._fogMatrix,[1,-1,1]),o.M(this._fogMatrix,this._fogMatrix,[0,0,-this.cameraToCenterDistance]),o.b5(this._fogMatrix,this._fogMatrix,-this.rollInRadians),o.b6(this._fogMatrix,this._fogMatrix,this.pitchInRadians),o.b5(this._fogMatrix,this._fogMatrix,-this.bearingInRadians),o.M(this._fogMatrix,this._fogMatrix,[-f,-g,0]),o.N(this._fogMatrix,this._fogMatrix,[1,1,this._helper._pixelPerMeter]),o.M(this._fogMatrix,this._fogMatrix,[0,0,-this.elevation]),this._pixelMatrix3D=o.O(new Float64Array(16),this.clipSpaceToPixelsMatrix,k);const z=this._helper._width%2/2,G=this._helper._height%2/2,X=Math.cos(this.bearingInRadians),W=Math.sin(-this.bearingInRadians),te=f-Math.round(f)+X*z+W*G,ae=g-Math.round(g)+X*G+W*z,Te=new Float64Array(k);if(o.M(Te,Te,[te>.5?te-1:te,ae>.5?ae-1:ae,0]),this._alignedProjMatrix=Te,k=o.ap(new Float64Array(16),this._pixelMatrix),!k)throw new Error("failed to invert matrix");this._pixelMatrixInverse=k,this._clearMatrixCaches()}_clearMatrixCaches(){this._posMatrixCache.clear(),this._alignedPosMatrixCache.clear(),this._fogMatrixCacheF32.clear()}maxPitchScaleFactor(){if(!this._pixelMatrixInverse)return 1;const t=this.screenPointToMercatorCoordinate(new o.P(0,0)),l=[t.x*this.worldSize,t.y*this.worldSize,0,1];return o.av(l,l,this._pixelMatrix)[3]/this._helper.cameraToCenterDistance}getCameraPoint(){return this._helper.getCameraPoint()}getCameraAltitude(){return this._helper.getCameraAltitude()}getCameraLngLat(){const t=o.ai(1,this.center.lat)*this.worldSize;return Le(this.center,this.elevation,this.pitch,this.bearing,this._helper.cameraToCenterDistance/t).toLngLat()}lngLatToCameraDepth(t,l){const f=o.a0.fromLngLat(t),g=[f.x*this.worldSize,f.y*this.worldSize,l,1];return o.av(g,g,this._viewProjMatrix),g[2]/g[3]}getProjectionData(t){const{overscaledTileID:l,aligned:f,applyTerrainMatrix:g}=t,w=this._helper.getMercatorTileCoordinates(l),I=l?this.calculatePosMatrix(l,f,!0):null;let k;return k=l&&l.terrainRttPosMatrix32f&&g?l.terrainRttPosMatrix32f:I||o.b7(),{mainMatrix:k,tileMercatorCoords:w,clippingPlane:[0,0,0,0],projectionTransition:0,fallbackMatrix:k}}isLocationOccluded(t){return!1}getPixelScale(){return 1}getCircleRadiusCorrection(){return 1}getPitchedTextCorrection(t,l,f){return 1}transformLightDirection(t){return o.aS(t)}getRayDirectionFromPixel(t){throw new Error("Not implemented.")}projectTileCoordinates(t,l,f,g){const w=this.calculatePosMatrix(f);let I;g?(I=[t,l,g(t,l),1],o.av(I,I,w)):(I=[t,l,0,1],vn(I,I,w));const k=I[3];return{point:new o.P(I[0]/k,I[1]/k),signedDistanceFromCamera:k,isOccluded:!1}}populateCache(t){for(const l of t)this.calculatePosMatrix(l)}getMatrixForModel(t,l){const f=o.a0.fromLngLat(t,l),g=f.meterInMercatorCoordinateUnits(),w=o.b8();return o.M(w,w,[f.x,f.y,f.z]),o.b5(w,w,Math.PI),o.b6(w,w,Math.PI/2),o.N(w,w,[-g,g,g]),w}getProjectionDataForCustomLayer(t=!0){const l=new o.Z(0,0,0,0,0),f=this.getProjectionData({overscaledTileID:l,applyGlobeMatrix:t}),g=me(l,this.worldSize);o.O(g,this._viewProjMatrix,g),f.tileMercatorCoords=[0,0,1,1];const w=[o.$,o.$,this.worldSize/this._helper.pixelsPerMeter],I=o.b9();return o.N(I,g,w),f.fallbackMatrix=I,f.mainMatrix=I,f}getFastPathSimpleProjectionMatrix(t){return this.calculatePosMatrix(t)}}function or(){o.w("Map cannot fit within canvas with the given bounds, padding, and/or offset.")}function rr(b){if(b.useSlerp)if(b.k<1){const t=o.ba(b.startEulerAngles.roll,b.startEulerAngles.pitch,b.startEulerAngles.bearing),l=o.ba(b.endEulerAngles.roll,b.endEulerAngles.pitch,b.endEulerAngles.bearing),f=new Float64Array(4);o.bb(f,t,l,b.k);const g=o.bc(f);b.tr.setRoll(g.roll),b.tr.setPitch(g.pitch),b.tr.setBearing(g.bearing)}else b.tr.setRoll(b.endEulerAngles.roll),b.tr.setPitch(b.endEulerAngles.pitch),b.tr.setBearing(b.endEulerAngles.bearing);else b.tr.setRoll(o.C.number(b.startEulerAngles.roll,b.endEulerAngles.roll,b.k)),b.tr.setPitch(o.C.number(b.startEulerAngles.pitch,b.endEulerAngles.pitch,b.k)),b.tr.setBearing(o.C.number(b.startEulerAngles.bearing,b.endEulerAngles.bearing,b.k))}function Ar(b,t,l,f,g){const w=g.padding,I=et(g.worldSize,l.getNorthWest()),k=et(g.worldSize,l.getNorthEast()),R=et(g.worldSize,l.getSouthEast()),z=et(g.worldSize,l.getSouthWest()),G=o.ad(-f),X=I.rotate(G),W=k.rotate(G),te=R.rotate(G),ae=z.rotate(G),Te=new o.P(Math.max(X.x,W.x,ae.x,te.x),Math.max(X.y,W.y,ae.y,te.y)),we=new o.P(Math.min(X.x,W.x,ae.x,te.x),Math.min(X.y,W.y,ae.y,te.y)),Ee=Te.sub(we),Ce=(g.width-(w.left+w.right+t.left+t.right))/Ee.x,Fe=(g.height-(w.top+w.bottom+t.top+t.bottom))/Ee.y;if(Fe<0||Ce<0)return void or();const Oe=Math.min(o.aj(g.scale*Math.min(Ce,Fe)),b.maxZoom),Ue=o.P.convert(b.offset),We=new o.P((t.left-t.right)/2,(t.top-t.bottom)/2).rotate(o.ad(f)),De=Ue.add(We).mult(g.scale/o.ae(Oe));return{center:le(g.worldSize,I.add(R).div(2).sub(De)),zoom:Oe,bearing:f}}class pr{get useGlobeControls(){return!1}handlePanInertia(t,l){return{easingOffset:t,easingCenter:l.center}}handleMapControlsRollPitchBearingZoom(t,l){t.bearingDelta&&l.setBearing(l.bearing+t.bearingDelta),t.pitchDelta&&l.setPitch(l.pitch+t.pitchDelta),t.rollDelta&&l.setRoll(l.roll+t.rollDelta),t.zoomDelta&&l.setZoom(l.zoom+t.zoomDelta)}handleMapControlsPan(t,l,f){t.around.distSqr(l.centerPoint)<.01||l.setLocationAtPoint(f,t.around)}cameraForBoxAndBearing(t,l,f,g,w){return Ar(t,l,f,g,w)}handleJumpToCenterZoom(t,l){t.zoom!==(l.zoom!==void 0?+l.zoom:t.zoom)&&t.setZoom(+l.zoom),l.center!==void 0&&t.setCenter(o.S.convert(l.center))}handleEaseTo(t,l){const f=t.zoom,g=t.padding,w={roll:t.roll,pitch:t.pitch,bearing:t.bearing},I={roll:l.roll===void 0?t.roll:l.roll,pitch:l.pitch===void 0?t.pitch:l.pitch,bearing:l.bearing===void 0?t.bearing:l.bearing},k=l.zoom!==void 0,R=!t.isPaddingEqual(l.padding);let z=!1;const G=k?+l.zoom:t.zoom;let X=t.centerPoint.add(l.offsetAsPoint);const W=t.screenPointToLocation(X),{center:te,zoom:ae}=t.getConstrained(o.S.convert(l.center||W),G??f);ki(t,te);const Te=et(t.worldSize,W),we=et(t.worldSize,te).sub(Te),Ee=o.ae(ae-f);return z=ae!==f,{easeFunc:Ce=>{if(z&&t.setZoom(o.C.number(f,ae,Ce)),o.bd(w,I)||rr({startEulerAngles:w,endEulerAngles:I,tr:t,k:Ce,useSlerp:w.roll!=I.roll}),R&&(t.interpolatePadding(g,l.padding,Ce),X=t.centerPoint.add(l.offsetAsPoint)),l.around)t.setLocationAtPoint(l.around,l.aroundPoint);else{const Fe=o.ae(t.zoom-f),Oe=ae>f?Math.min(2,Ee):Math.max(.5,Ee),Ue=Math.pow(Oe,1-Ce),We=le(t.worldSize,Te.add(we.mult(Ce*Ue)).mult(Fe));t.setLocationAtPoint(t.renderWorldCopies?We.wrap():We,X)}},isZooming:z,elevationCenter:te}}handleFlyTo(t,l){const f=l.zoom!==void 0,g=t.zoom,w=t.getConstrained(o.S.convert(l.center||l.locationAtOffset),f?+l.zoom:g),I=w.center,k=w.zoom;ki(t,I);const R=et(t.worldSize,l.locationAtOffset),z=et(t.worldSize,I).sub(R),G=z.mag(),X=o.ae(k-g);let W;if(l.minZoom!==void 0){const te=Math.min(+l.minZoom,g,k),ae=t.getConstrained(I,te).zoom;W=o.ae(ae-g)}return{easeFunc:(te,ae,Te,we)=>{t.setZoom(te===1?k:g+o.aj(ae));const Ee=te===1?I:le(t.worldSize,R.add(z.mult(Te)).mult(ae));t.setLocationAtPoint(t.renderWorldCopies?Ee.wrap():Ee,we)},scaleOfZoom:X,targetCenter:I,scaleOfMinZoom:W,pixelPathLength:G}}}class ui{constructor(t,l,f){this.blendFunction=t,this.blendColor=l,this.mask=f}}ui.Replace=[1,0],ui.disabled=new ui(ui.Replace,o.be.transparent,[!1,!1,!1,!1]),ui.unblended=new ui(ui.Replace,o.be.transparent,[!0,!0,!0,!0]),ui.alphaBlended=new ui([1,771],o.be.transparent,[!0,!0,!0,!0]);const Pn=2305;class Vi{constructor(t,l,f){this.enable=t,this.mode=l,this.frontFace=f}}Vi.disabled=new Vi(!1,1029,Pn),Vi.backCCW=new Vi(!0,1029,Pn),Vi.frontCCW=new Vi(!0,1028,Pn);class Ri{constructor(t,l,f){this.func=t,this.mask=l,this.range=f}}Ri.ReadOnly=!1,Ri.ReadWrite=!0,Ri.disabled=new Ri(519,Ri.ReadOnly,[0,1]);const eo=7680;class fi{constructor(t,l,f,g,w,I){this.test=t,this.ref=l,this.mask=f,this.fail=g,this.depthFail=w,this.pass=I}}fi.disabled=new fi({func:519,mask:0},0,0,eo,eo,eo);const to=new WeakMap;function hn(b){var t;if(to.has(b))return to.get(b);{const l=(t=b.getParameter(b.VERSION))===null||t===void 0?void 0:t.startsWith("WebGL 2.0");return to.set(b,l),l}}class po{get awaitingQuery(){return!!this._readbackQueue}constructor(t){this._readbackWaitFrames=4,this._measureWaitFrames=6,this._texWidth=1,this._texHeight=1,this._measuredError=0,this._updateCount=0,this._lastReadbackFrame=-1e3,this._readbackQueue=null,this._cachedRenderContext=t;const l=t.context,f=l.gl;this._texFormat=f.RGBA,this._texType=f.UNSIGNED_BYTE;const g=new o.aK;g.emplaceBack(-1,-1),g.emplaceBack(2,-1),g.emplaceBack(-1,2);const w=new o.aM;w.emplaceBack(0,1,2),this._fullscreenTriangle=new rt(l.createVertexBuffer(g,Ct.members),l.createIndexBuffer(w),o.aL.simpleSegment(0,0,g.length,w.length)),this._resultBuffer=new Uint8Array(4),l.activeTexture.set(f.TEXTURE1);const I=f.createTexture();f.bindTexture(f.TEXTURE_2D,I),f.texParameteri(f.TEXTURE_2D,f.TEXTURE_WRAP_S,f.CLAMP_TO_EDGE),f.texParameteri(f.TEXTURE_2D,f.TEXTURE_WRAP_T,f.CLAMP_TO_EDGE),f.texParameteri(f.TEXTURE_2D,f.TEXTURE_MIN_FILTER,f.NEAREST),f.texParameteri(f.TEXTURE_2D,f.TEXTURE_MAG_FILTER,f.NEAREST),f.texImage2D(f.TEXTURE_2D,0,this._texFormat,this._texWidth,this._texHeight,0,this._texFormat,this._texType,null),this._fbo=l.createFramebuffer(this._texWidth,this._texHeight,!1,!1),this._fbo.colorAttachment.set(I),hn(f)&&(this._pbo=f.createBuffer(),f.bindBuffer(f.PIXEL_PACK_BUFFER,this._pbo),f.bufferData(f.PIXEL_PACK_BUFFER,4,f.STREAM_READ),f.bindBuffer(f.PIXEL_PACK_BUFFER,null))}destroy(){const t=this._cachedRenderContext.context.gl;this._fullscreenTriangle.destroy(),this._fbo.destroy(),t.deleteBuffer(this._pbo),this._fullscreenTriangle=null,this._fbo=null,this._pbo=null,this._resultBuffer=null}updateErrorLoop(t,l){const f=this._updateCount;return this._readbackQueue?f>=this._readbackQueue.frameNumberIssued+this._readbackWaitFrames&&this._tryReadback():f>=this._lastReadbackFrame+this._measureWaitFrames&&this._renderErrorTexture(t,l),this._updateCount++,this._measuredError}_bindFramebuffer(){const t=this._cachedRenderContext.context,l=t.gl;t.activeTexture.set(l.TEXTURE1),l.bindTexture(l.TEXTURE_2D,this._fbo.colorAttachment.get()),t.bindFramebuffer.set(this._fbo.framebuffer)}_renderErrorTexture(t,l){const f=this._cachedRenderContext.context,g=f.gl;if(this._bindFramebuffer(),f.viewport.set([0,0,this._texWidth,this._texHeight]),f.clear({color:o.be.transparent}),this._cachedRenderContext.useProgram("projectionErrorMeasurement").draw(f,g.TRIANGLES,Ri.disabled,fi.disabled,ui.unblended,Vi.disabled,((w,I)=>({u_input:w,u_output_expected:I}))(t,l),null,null,"$clipping",this._fullscreenTriangle.vertexBuffer,this._fullscreenTriangle.indexBuffer,this._fullscreenTriangle.segments),this._pbo&&hn(g)){g.bindBuffer(g.PIXEL_PACK_BUFFER,this._pbo),g.readBuffer(g.COLOR_ATTACHMENT0),g.readPixels(0,0,this._texWidth,this._texHeight,this._texFormat,this._texType,0),g.bindBuffer(g.PIXEL_PACK_BUFFER,null);const w=g.fenceSync(g.SYNC_GPU_COMMANDS_COMPLETE,0);g.flush(),this._readbackQueue={frameNumberIssued:this._updateCount,sync:w}}else this._readbackQueue={frameNumberIssued:this._updateCount,sync:null}}_tryReadback(){const t=this._cachedRenderContext.context.gl;if(this._pbo&&this._readbackQueue&&hn(t)){const l=t.clientWaitSync(this._readbackQueue.sync,0,0);if(l===t.WAIT_FAILED)return o.w("WebGL2 clientWaitSync failed."),this._readbackQueue=null,void(this._lastReadbackFrame=this._updateCount);if(l===t.TIMEOUT_EXPIRED)return;t.bindBuffer(t.PIXEL_PACK_BUFFER,this._pbo),t.getBufferSubData(t.PIXEL_PACK_BUFFER,0,this._resultBuffer,0,4),t.bindBuffer(t.PIXEL_PACK_BUFFER,null)}else this._bindFramebuffer(),t.readPixels(0,0,this._texWidth,this._texHeight,this._texFormat,this._texType,this._resultBuffer);this._readbackQueue=null,this._measuredError=po._parseRGBA8float(this._resultBuffer),this._lastReadbackFrame=this._updateCount}static _parseRGBA8float(t){let l=0;return l+=t[0]/256,l+=t[1]/65536,l+=t[2]/16777216,t[3]<127&&(l=-l),l/128}}const Dn=o.$/128;function pl(b,t){const l=b.granularity!==void 0?Math.max(b.granularity,1):1,f=l+(b.generateBorders?2:0),g=l+(b.extendToNorthPole||b.generateBorders?1:0)+(b.extendToSouthPole||b.generateBorders?1:0),w=f+1,I=g+1,k=b.generateBorders?-1:0,R=b.generateBorders||b.extendToNorthPole?-1:0,z=l+(b.generateBorders?1:0),G=l+(b.generateBorders||b.extendToSouthPole?1:0),X=w*I,W=f*g*6,te=w*I>65536;if(te&&t==="16bit")throw new Error("Granularity is too large and meshes would not fit inside 16 bit vertex indices.");const ae=te||t==="32bit",Te=new Int16Array(2*X);let we=0;for(let Fe=R;Fe<=G;Fe++)for(let Oe=k;Oe<=z;Oe++){let Ue=Oe/l*o.$;Oe===-1&&(Ue=-Dn),Oe===l+1&&(Ue=o.$+Dn);let We=Fe/l*o.$;Fe===-1&&(We=b.extendToNorthPole?o.bg:-Dn),Fe===l+1&&(We=b.extendToSouthPole?o.bh:o.$+Dn),Te[we++]=Ue,Te[we++]=We}const Ee=ae?new Uint32Array(W):new Uint16Array(W);let Ce=0;for(let Fe=0;Fe<g;Fe++)for(let Oe=0;Oe<f;Oe++){const Ue=Oe+1+Fe*w,We=Oe+(Fe+1)*w,De=Oe+1+(Fe+1)*w;Ee[Ce++]=Oe+Fe*w,Ee[Ce++]=We,Ee[Ce++]=Ue,Ee[Ce++]=Ue,Ee[Ce++]=We,Ee[Ce++]=De}return{vertices:Te.buffer.slice(0),indices:Ee.buffer.slice(0),uses32bitIndices:ae}}const Cs=new o.aJ({fill:new o.bi(128,2),line:new o.bi(512,0),tile:new o.bi(128,32),stencil:new o.bi(128,1),circle:3});class js{constructor(){this._tileMeshCache={},this._errorCorrectionUsable=0,this._errorMeasurementLastValue=0,this._errorCorrectionPreviousValue=0,this._errorMeasurementLastChangeTime=-1e3}get name(){return"vertical-perspective"}get transitionState(){return 1}get useSubdivision(){return!0}get shaderVariantName(){return"globe"}get shaderDefine(){return"#define GLOBE"}get shaderPreludeCode(){return qe.projectionGlobe}get vertexShaderPreludeCode(){return qe.projectionMercator.vertexSource}get subdivisionGranularity(){return Cs}get useGlobeControls(){return!0}get latitudeErrorCorrectionRadians(){return this._errorCorrectionUsable}destroy(){this._errorMeasurement&&this._errorMeasurement.destroy()}updateGPUdependent(t){this._errorMeasurement||(this._errorMeasurement=new po(t));const l=o.U(this._errorQueryLatitudeDegrees),f=2*Math.atan(Math.exp(Math.PI-l*Math.PI*2))-.5*Math.PI,g=this._errorMeasurement.updateErrorLoop(l,f),w=Y.now();g!==this._errorMeasurementLastValue&&(this._errorCorrectionPreviousValue=this._errorCorrectionUsable,this._errorMeasurementLastValue=g,this._errorMeasurementLastChangeTime=w);const I=Math.min(Math.max((w-this._errorMeasurementLastChangeTime)/1e3/.5,0),1);this._errorCorrectionUsable=o.bj(this._errorCorrectionPreviousValue,-this._errorMeasurementLastValue,o.bk(I))}_getMeshKey(t){return`${t.granularity.toString(36)}_${t.generateBorders?"b":""}${t.extendToNorthPole?"n":""}${t.extendToSouthPole?"s":""}`}getMeshFromTileID(t,l,f,g,w){const I=(w==="stencil"?Cs.stencil:Cs.tile).getGranularityForZoomLevel(l.z);return this._getMesh(t,{granularity:I,generateBorders:f,extendToNorthPole:l.y===0&&g,extendToSouthPole:l.y===(1<<l.z)-1&&g})}_getMesh(t,l){const f=this._getMeshKey(l);if(f in this._tileMeshCache)return this._tileMeshCache[f];const g=function(w,I){const k=pl(I,"16bit"),R=o.aK.deserialize({arrayBuffer:k.vertices,length:k.vertices.byteLength/2/2}),z=o.aM.deserialize({arrayBuffer:k.indices,length:k.indices.byteLength/2/3});return new rt(w.createVertexBuffer(R,Ct.members),w.createIndexBuffer(z),o.aL.simpleSegment(0,0,R.length,z.length))}(t,l);return this._tileMeshCache[f]=g,g}recalculate(t){}hasTransition(){const t=Y.now();let l=!1;return l=l||(t-this._errorMeasurementLastChangeTime)/1e3<.7,l=l||this._errorMeasurement&&this._errorMeasurement.awaitingQuery,l}setErrorQueryLatitudeDegrees(t){this._errorQueryLatitudeDegrees=t}}const Xo=new o.r({type:new o.D(o.v.projection.type)});class Ho extends o.E{constructor(t){super(),this._transitionable=new o.t(Xo),this.setProjection(t),this._transitioning=this._transitionable.untransitioned(),this.recalculate(new o.F(0)),this._mercatorProjection=new Wt,this._verticalPerspectiveProjection=new js}get transitionState(){const t=this.properties.get("type");if(typeof t=="string"&&t==="mercator")return 0;if(typeof t=="string"&&t==="vertical-perspective")return 1;if(t instanceof o.bl){if(t.from==="vertical-perspective"&&t.to==="mercator")return 1-t.transition;if(t.from==="mercator"&&t.to==="vertical-perspective")return t.transition}return 1}get useGlobeRendering(){return this.transitionState>0}get latitudeErrorCorrectionRadians(){return this._verticalPerspectiveProjection.latitudeErrorCorrectionRadians}get currentProjection(){return this.useGlobeRendering?this._verticalPerspectiveProjection:this._mercatorProjection}get name(){return"globe"}get useSubdivision(){return this.currentProjection.useSubdivision}get shaderVariantName(){return this.currentProjection.shaderVariantName}get shaderDefine(){return this.currentProjection.shaderDefine}get shaderPreludeCode(){return this.currentProjection.shaderPreludeCode}get vertexShaderPreludeCode(){return this.currentProjection.vertexShaderPreludeCode}get subdivisionGranularity(){return this.currentProjection.subdivisionGranularity}get useGlobeControls(){return this.transitionState>0}destroy(){this._mercatorProjection.destroy(),this._verticalPerspectiveProjection.destroy()}updateGPUdependent(t){this._mercatorProjection.updateGPUdependent(t),this._verticalPerspectiveProjection.updateGPUdependent(t)}getMeshFromTileID(t,l,f,g,w){return this.currentProjection.getMeshFromTileID(t,l,f,g,w)}setProjection(t){this._transitionable.setValue("type",t?.type||"mercator")}updateTransitions(t){this._transitioning=this._transitionable.transitioned(t,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()||this.currentProjection.hasTransition()}recalculate(t){this.properties=this._transitioning.possiblyEvaluate(t)}setErrorQueryLatitudeDegrees(t){this._verticalPerspectiveProjection.setErrorQueryLatitudeDegrees(t),this._mercatorProjection.setErrorQueryLatitudeDegrees(t)}}function kn(b){const t=Hn(b.worldSize,b.center.lat);return 2*Math.PI*t}function Fn(b,t,l,f,g){const w=1/(1<<g),I=t/o.$*w+f*w,k=o.bn((b/o.$*w+l*w)*Math.PI*2+Math.PI,2*Math.PI),R=2*Math.atan(Math.exp(Math.PI-I*Math.PI*2))-.5*Math.PI,z=Math.cos(R),G=new Float64Array(3);return G[0]=Math.sin(k)*z,G[1]=Math.sin(R),G[2]=Math.cos(k)*z,G}function bn(b){return function(t,l){const f=Math.cos(l),g=new Float64Array(3);return g[0]=Math.sin(t)*f,g[1]=Math.sin(l),g[2]=Math.cos(t)*f,g}(b.lng*Math.PI/180,b.lat*Math.PI/180)}function Hn(b,t){return b/(2*Math.PI)/Math.cos(t*Math.PI/180)}function fo(b){const t=Math.asin(b[1])/Math.PI*180,l=Math.sqrt(b[0]*b[0]+b[2]*b[2]);if(l>1e-6){const f=b[0]/l,g=Math.acos(b[2]/l),w=(f>0?g:-g)/Math.PI*180;return new o.S(o.aN(w,-180,180),t)}return new o.S(0,t)}function bs(b){return Math.cos(b*Math.PI/180)}function Mr(b,t){const l=bs(b),f=bs(t);return o.aj(f/l)}function jn(b,t){const l=b.rotate(t.bearingInRadians),f=t.zoom+Mr(t.center.lat,0),g=o.bj(1/bs(t.center.lat),1/bs(Math.min(Math.abs(t.center.lat),60)),o.bm(f,7,3,0,1)),w=360/kn({worldSize:t.worldSize,center:{lat:t.center.lat}});return new o.S(t.center.lng-l.x*w*g,o.ag(t.center.lat+l.y*w,-o.ah,o.ah))}function mo(b){const t=.5*b,l=Math.sin(t),f=Math.cos(t);return Math.log(l+f)-Math.log(f-l)}function Ko(b,t,l,f){const g=b.lat+l*f;if(Math.abs(l)>1){const w=(Math.sign(b.lat+l)!==Math.sign(b.lat)?-Math.abs(b.lat):Math.abs(b.lat))*Math.PI/180,I=Math.abs(b.lat+l)*Math.PI/180,k=mo(w+f*(I-w)),R=mo(w),z=mo(I);return new o.S(b.lng+t*((k-R)/(z-R)),g)}return new o.S(b.lng+t*f,g)}class Hl{constructor(t){this._cachePrevious=new Map,this._cache=new Map,this._hadAnyChanges=!1,this._boundingVolumeFactory=t}swapBuffers(){if(!this._hadAnyChanges)return;const t=this._cachePrevious;this._cachePrevious=this._cache,this._cache=t,this._cache.clear(),this._hadAnyChanges=!1}getTileBoundingVolume(t,l,f,g){const w=`${t.z}_${t.x}_${t.y}_${g?.terrain?"t":""}`,I=this._cache.get(w);if(I)return I;const k=this._cachePrevious.get(w);if(k)return this._cache.set(w,k),k;const R=this._boundingVolumeFactory(t,l,f,g);return this._cache.set(w,R),this._hadAnyChanges=!0,R}}class As{constructor(t,l,f,g){this.min=f,this.max=g,this.points=t,this.planes=l}static fromAabb(t,l){const f=[];for(let g=0;g<8;g++)f.push([1&~g?t[0]:l[0],(g>>1&1)==1?l[1]:t[1],(g>>2&1)==1?l[2]:t[2]]);return new As(f,[[-1,0,0,l[0]],[1,0,0,-t[0]],[0,-1,0,l[1]],[0,1,0,-t[1]],[0,0,-1,l[2]],[0,0,1,-t[2]]],t,l)}static fromCenterSizeAngles(t,l,f){const g=o.bq([],f[0],f[1],f[2]),w=o.br([],[l[0],0,0],g),I=o.br([],[0,l[1],0],g),k=o.br([],[0,0,l[2]],g),R=[...t],z=[...t];for(let X=0;X<8;X++)for(let W=0;W<3;W++){const te=t[W]+w[W]*(1&~X?-1:1)+I[W]*((X>>1&1)==1?1:-1)+k[W]*((X>>2&1)==1?1:-1);R[W]=Math.min(R[W],te),z[W]=Math.max(z[W],te)}const G=[];for(let X=0;X<8;X++){const W=[...t];o.aR(W,W,o.aQ([],w,1&~X?-1:1)),o.aR(W,W,o.aQ([],I,(X>>1&1)==1?1:-1)),o.aR(W,W,o.aQ([],k,(X>>2&1)==1?1:-1)),G.push(W)}return new As(G,[[...w,-o.aW(w,G[0])],[...I,-o.aW(I,G[0])],[...k,-o.aW(k,G[0])],[-w[0],-w[1],-w[2],-o.aW(w,G[7])],[-I[0],-I[1],-I[2],-o.aW(I,G[7])],[-k[0],-k[1],-k[2],-o.aW(k,G[7])]],R,z)}intersectsFrustum(t){let l=!0;const f=this.points.length,g=this.planes.length,w=t.planes.length,I=t.points.length;for(let k=0;k<w;k++){const R=t.planes[k];let z=0;for(let G=0;G<f;G++){const X=this.points[G];R[0]*X[0]+R[1]*X[1]+R[2]*X[2]+R[3]>=0&&z++}if(z===0)return 0;z<f&&(l=!1)}if(l)return 2;for(let k=0;k<g;k++){const R=this.planes[k];let z=0;for(let G=0;G<I;G++){const X=t.points[G];R[0]*X[0]+R[1]*X[1]+R[2]*X[2]+R[3]>=0&&z++}if(z===0)return 0}return 1}intersectsPlane(t){const l=this.points.length;let f=0;for(let g=0;g<l;g++){const w=this.points[g];t[0]*w[0]+t[1]*w[1]+t[2]*w[2]+t[3]>=0&&f++}return f===l?2:f===0?0:1}}function Jo(b,t,l){const f=b-t;return f<0?-f:Math.max(0,f-l)}function Oa(b,t,l,f,g){const w=b-l;let I;return I=w<0?Math.min(-w,1+w-g):w>1?Math.min(Math.max(w-g,0),1-w):0,Math.max(I,Jo(t,f,g))}class Fu{constructor(){this._boundingVolumeCache=new Hl(this._computeTileBoundingVolume)}prepareNextFrame(){this._boundingVolumeCache.swapBuffers()}distanceToTile2d(t,l,f,g){const w=1<<f.z,I=1/w,k=f.x/w,R=f.y/w;let z=2;return z=Math.min(z,Oa(t,l,k,R,I)),z=Math.min(z,Oa(t,l,k+.5,-R-I,I)),z=Math.min(z,Oa(t,l,k+.5,2-R-I,I)),z}getWrap(t,l,f){const g=1<<l.z,w=1/g,I=l.x/g,k=Jo(t.x,I,w),R=Jo(t.x,I-1,w),z=Jo(t.x,I+1,w),G=Math.min(k,R,z);return G===z?1:G===R?-1:0}allowVariableZoom(t,l){return gt(t,l)>4}allowWorldCopies(){return!1}getTileBoundingVolume(t,l,f,g){return this._boundingVolumeCache.getTileBoundingVolume(t,l,f,g)}_computeTileBoundingVolume(t,l,f,g){var w,I;let k=f,R=f;if(g?.terrain){const z=new o.Z(t.z,l,t.z,t.x,t.y),G=g.terrain.getMinMaxElevation(z);k=(w=G.minElevation)!==null&&w!==void 0?w:f,R=(I=G.maxElevation)!==null&&I!==void 0?I:f}if(k/=o.bt,R/=o.bt,k+=1,R+=1,t.z<=0)return As.fromAabb([-R,-R,-R],[R,R,R]);if(t.z===1)return As.fromAabb([t.x===0?-R:0,t.y===0?0:-R,-R],[t.x===0?0:R,t.y===0?R:0,R]);{const z=[Fn(0,0,t.x,t.y,t.z),Fn(o.$,0,t.x,t.y,t.z),Fn(o.$,o.$,t.x,t.y,t.z),Fn(0,o.$,t.x,t.y,t.z)],G=[];for(const dt of z)G.push(o.aQ([],dt,R));if(R!==k)for(const dt of z)G.push(o.aQ([],dt,k));t.y===0&&G.push([0,1,0]),t.y===(1<<t.z)-1&&G.push([0,-1,0]);const X=[1,1,1],W=[-1,-1,-1];for(const dt of G)for(let _t=0;_t<3;_t++)X[_t]=Math.min(X[_t],dt[_t]),W[_t]=Math.max(W[_t],dt[_t]);const te=Fn(o.$/2,o.$/2,t.x,t.y,t.z),ae=o.aV([],[0,1,0],te);o.aU(ae,ae);const Te=o.aV([],te,ae);o.aU(Te,Te);const we=o.aV([],z[2],z[1]);o.aU(we,we);const Ee=o.aV([],z[0],z[3]);o.aU(Ee,Ee),G.push(o.aQ([],te,R)),t.y>=(1<<t.z)/2&&G.push(o.aQ([],Fn(o.$/2,0,t.x,t.y,t.z),R)),t.y<(1<<t.z)/2&&G.push(o.aQ([],Fn(o.$/2,o.$,t.x,t.y,t.z),R));const Ce=Qr(te,G),Fe=Qr(Te,G),Oe=[-te[0],-te[1],-te[2],Ce.max],Ue=[te[0],te[1],te[2],-Ce.min],We=[-Te[0],-Te[1],-Te[2],Fe.max],De=[Te[0],Te[1],Te[2],-Fe.min],Qe=[...we,0],yt=[...Ee,0],ct=[];return t.y===0?ct.push(o.bs(yt,Qe,Oe),o.bs(yt,Qe,Ue)):ct.push(o.bs(We,Qe,Oe),o.bs(We,Qe,Ue),o.bs(We,yt,Oe),o.bs(We,yt,Ue)),t.y===(1<<t.z)-1?ct.push(o.bs(yt,Qe,Oe),o.bs(yt,Qe,Ue)):ct.push(o.bs(De,Qe,Oe),o.bs(De,Qe,Ue),o.bs(De,yt,Oe),o.bs(De,yt,Ue)),new As(ct,[Oe,Ue,We,De,Qe,yt],X,W)}}}function Qr(b,t){let l=1/0,f=-1/0;for(const g of t){const w=o.aW(b,g);l=Math.min(l,w),f=Math.max(f,w)}return{min:l,max:f}}class ls{get pixelsToClipSpaceMatrix(){return this._helper.pixelsToClipSpaceMatrix}get clipSpaceToPixelsMatrix(){return this._helper.clipSpaceToPixelsMatrix}get pixelsToGLUnits(){return this._helper.pixelsToGLUnits}get centerOffset(){return this._helper.centerOffset}get size(){return this._helper.size}get rotationMatrix(){return this._helper.rotationMatrix}get centerPoint(){return this._helper.centerPoint}get pixelsPerMeter(){return this._helper.pixelsPerMeter}setMinZoom(t){this._helper.setMinZoom(t)}setMaxZoom(t){this._helper.setMaxZoom(t)}setMinPitch(t){this._helper.setMinPitch(t)}setMaxPitch(t){this._helper.setMaxPitch(t)}setRenderWorldCopies(t){this._helper.setRenderWorldCopies(t)}setBearing(t){this._helper.setBearing(t)}setPitch(t){this._helper.setPitch(t)}setRoll(t){this._helper.setRoll(t)}setFov(t){this._helper.setFov(t)}setZoom(t){this._helper.setZoom(t)}setCenter(t){this._helper.setCenter(t)}setElevation(t){this._helper.setElevation(t)}setMinElevationForCurrentTile(t){this._helper.setMinElevationForCurrentTile(t)}setPadding(t){this._helper.setPadding(t)}interpolatePadding(t,l,f){return this._helper.interpolatePadding(t,l,f)}isPaddingEqual(t){return this._helper.isPaddingEqual(t)}resize(t,l){this._helper.resize(t,l)}getMaxBounds(){return this._helper.getMaxBounds()}setMaxBounds(t){this._helper.setMaxBounds(t)}overrideNearFarZ(t,l){this._helper.overrideNearFarZ(t,l)}clearNearFarZOverride(){this._helper.clearNearFarZOverride()}getCameraQueryGeometry(t){return this._helper.getCameraQueryGeometry(this.getCameraPoint(),t)}get tileSize(){return this._helper.tileSize}get tileZoom(){return this._helper.tileZoom}get scale(){return this._helper.scale}get worldSize(){return this._helper.worldSize}get width(){return this._helper.width}get height(){return this._helper.height}get lngRange(){return this._helper.lngRange}get latRange(){return this._helper.latRange}get minZoom(){return this._helper.minZoom}get maxZoom(){return this._helper.maxZoom}get zoom(){return this._helper.zoom}get center(){return this._helper.center}get minPitch(){return this._helper.minPitch}get maxPitch(){return this._helper.maxPitch}get pitch(){return this._helper.pitch}get pitchInRadians(){return this._helper.pitchInRadians}get roll(){return this._helper.roll}get rollInRadians(){return this._helper.rollInRadians}get bearing(){return this._helper.bearing}get bearingInRadians(){return this._helper.bearingInRadians}get fov(){return this._helper.fov}get fovInRadians(){return this._helper.fovInRadians}get elevation(){return this._helper.elevation}get minElevationForCurrentTile(){return this._helper.minElevationForCurrentTile}get padding(){return this._helper.padding}get unmodified(){return this._helper.unmodified}get renderWorldCopies(){return this._helper.renderWorldCopies}get nearZ(){return this._helper.nearZ}get farZ(){return this._helper.farZ}get autoCalculateNearFarZ(){return this._helper.autoCalculateNearFarZ}setTransitionState(t){}constructor(){this._cachedClippingPlane=o.bu(),this._projectionMatrix=o.b8(),this._globeViewProjMatrix32f=o.b7(),this._globeViewProjMatrixNoCorrection=o.b8(),this._globeViewProjMatrixNoCorrectionInverted=o.b8(),this._globeProjMatrixInverted=o.b8(),this._cameraPosition=o.bo(),this._globeLatitudeErrorCorrectionRadians=0,this._helper=new Pi({calcMatrices:()=>{this._calcMatrices()},getConstrained:(t,l)=>this.getConstrained(t,l)}),this._coveringTilesDetailsProvider=new Fu}clone(){const t=new ls;return t.apply(this),t}apply(t,l){this._globeLatitudeErrorCorrectionRadians=l||0,this._helper.apply(t)}get projectionMatrix(){return this._projectionMatrix}get modelViewProjectionMatrix(){return this._globeViewProjMatrixNoCorrection}get inverseProjectionMatrix(){return this._globeProjMatrixInverted}get cameraPosition(){const t=o.bo();return t[0]=this._cameraPosition[0],t[1]=this._cameraPosition[1],t[2]=this._cameraPosition[2],t}get cameraToCenterDistance(){return this._helper.cameraToCenterDistance}getProjectionData(t){const{overscaledTileID:l,applyGlobeMatrix:f}=t,g=this._helper.getMercatorTileCoordinates(l);return{mainMatrix:this._globeViewProjMatrix32f,tileMercatorCoords:g,clippingPlane:this._cachedClippingPlane,projectionTransition:f?1:0,fallbackMatrix:this._globeViewProjMatrix32f}}_computeClippingPlane(t){const l=this.pitchInRadians,f=this.cameraToCenterDistance/t,g=Math.sin(l)*f,w=Math.cos(l)*f+1,I=1/Math.sqrt(g*g+w*w)*1;let k=-g,R=w;const z=Math.sqrt(k*k+R*R);k/=z,R/=z;const G=[0,k,R];o.bv(G,G,[0,0,0],-this.bearingInRadians),o.bw(G,G,[0,0,0],-1*this.center.lat*Math.PI/180),o.bx(G,G,[0,0,0],this.center.lng*Math.PI/180);const X=1/o.aY(G);return o.aQ(G,G,X),[...G,-I*X]}isLocationOccluded(t){return!this.isSurfacePointVisible(bn(t))}transformLightDirection(t){const l=this._helper._center.lng*Math.PI/180,f=this._helper._center.lat*Math.PI/180,g=Math.cos(f),w=[Math.sin(l)*g,Math.sin(f),Math.cos(l)*g],I=[w[2],0,-w[0]],k=[0,0,0];o.aV(k,I,w),o.aU(I,I),o.aU(k,k);const R=[0,0,0];return o.aU(R,[I[0]*t[0]+k[0]*t[1]+w[0]*t[2],I[1]*t[0]+k[1]*t[1]+w[1]*t[2],I[2]*t[0]+k[2]*t[1]+w[2]*t[2]]),R}getPixelScale(){return 1/Math.cos(this._helper._center.lat*Math.PI/180)}getCircleRadiusCorrection(){return Math.cos(this._helper._center.lat*Math.PI/180)}getPitchedTextCorrection(t,l,f){const g=function(k,R,z){const G=1/(1<<z.z);return new o.a0(k/o.$*G+z.x*G,R/o.$*G+z.y*G)}(t,l,f.canonical),w=(I=g.y,[o.bn(g.x*Math.PI*2+Math.PI,2*Math.PI),2*Math.atan(Math.exp(Math.PI-I*Math.PI*2))-.5*Math.PI]);var I;return this.getCircleRadiusCorrection()/Math.cos(w[1])}projectTileCoordinates(t,l,f,g){const w=f.canonical,I=Fn(t,l,w.x,w.y,w.z),k=1+(g?g(t,l):0)/o.bt,R=[I[0]*k,I[1]*k,I[2]*k,1];o.av(R,R,this._globeViewProjMatrixNoCorrection);const z=this._cachedClippingPlane,G=z[0]*I[0]+z[1]*I[1]+z[2]*I[2]+z[3]<0;return{point:new o.P(R[0]/R[3],R[1]/R[3]),signedDistanceFromCamera:R[3],isOccluded:G}}_calcMatrices(){if(!this._helper._width||!this._helper._height)return;const t=Hn(this.worldSize,this.center.lat),l=o.b9(),f=o.b9();this._helper.autoCalculateNearFarZ&&(this._helper._nearZ=.5,this._helper._farZ=this.cameraToCenterDistance+2*t),o.b3(l,this.fovInRadians,this.width/this.height,this._helper._nearZ,this._helper._farZ);const g=this.centerOffset;l[8]=2*-g.x/this._helper._width,l[9]=2*g.y/this._helper._height,this._projectionMatrix=o.b4(l),this._globeProjMatrixInverted=o.b9(),o.ap(this._globeProjMatrixInverted,l),o.M(l,l,[0,0,-this.cameraToCenterDistance]),o.b5(l,l,this.rollInRadians),o.b6(l,l,-this.pitchInRadians),o.b5(l,l,this.bearingInRadians),o.M(l,l,[0,0,-t]);const w=o.bo();w[0]=t,w[1]=t,w[2]=t,o.b6(f,l,this.center.lat*Math.PI/180),o.by(f,f,-this.center.lng*Math.PI/180),o.N(f,f,w),this._globeViewProjMatrixNoCorrection=f,o.b6(l,l,this.center.lat*Math.PI/180-this._globeLatitudeErrorCorrectionRadians),o.by(l,l,-this.center.lng*Math.PI/180),o.N(l,l,w),this._globeViewProjMatrix32f=new Float32Array(l),this._globeViewProjMatrixNoCorrectionInverted=o.b9(),o.ap(this._globeViewProjMatrixNoCorrectionInverted,f);const I=o.bo();this._cameraPosition=o.bo(),this._cameraPosition[2]=this.cameraToCenterDistance/t,o.bv(this._cameraPosition,this._cameraPosition,I,-this.rollInRadians),o.bw(this._cameraPosition,this._cameraPosition,I,this.pitchInRadians),o.bv(this._cameraPosition,this._cameraPosition,I,-this.bearingInRadians),o.aR(this._cameraPosition,this._cameraPosition,[0,0,1]),o.bw(this._cameraPosition,this._cameraPosition,I,-this.center.lat*Math.PI/180),o.bx(this._cameraPosition,this._cameraPosition,I,this.center.lng*Math.PI/180),this._cachedClippingPlane=this._computeClippingPlane(t);const k=o.b4(this._globeViewProjMatrixNoCorrectionInverted);o.N(k,k,[1,1,-1]),this._cachedFrustum=ei.fromInvProjectionMatrix(k,1,0,this._cachedClippingPlane,!0)}calculateFogMatrix(t){o.w("calculateFogMatrix is not supported on globe projection.");const l=o.b9();return o.af(l),l}getVisibleUnwrappedCoordinates(t){return[new o.b1(0,t)]}getCameraFrustum(){return this._cachedFrustum}getClippingPlane(){return this._cachedClippingPlane}getCoveringTilesDetailsProvider(){return this._coveringTilesDetailsProvider}recalculateZoomAndCenter(t){t&&o.w("terrain is not fully supported on vertical perspective projection."),this._helper.recalculateZoomAndCenter(0)}maxPitchScaleFactor(){return 1}getCameraPoint(){return this._helper.getCameraPoint()}getCameraAltitude(){return this._helper.getCameraAltitude()}getCameraLngLat(){return this._helper.getCameraLngLat()}lngLatToCameraDepth(t,l){if(!this._globeViewProjMatrixNoCorrection)return 1;const f=bn(t);o.aQ(f,f,1+l/o.bt);const g=o.bu();return o.av(g,[f[0],f[1],f[2],1],this._globeViewProjMatrixNoCorrection),g[2]/g[3]}populateCache(t){}getBounds(){const t=.5*this.width,l=.5*this.height,f=[new o.P(0,0),new o.P(t,0),new o.P(this.width,0),new o.P(this.width,l),new o.P(this.width,this.height),new o.P(t,this.height),new o.P(0,this.height),new o.P(0,l)],g=[];for(const X of f)g.push(this.unprojectScreenPoint(X));let w=0,I=0,k=0,R=0;const z=this.center;for(const X of g){const W=o.bz(z.lng,X.lng),te=o.bz(z.lat,X.lat);W<I&&(I=W),W>w&&(w=W),te<R&&(R=te),te>k&&(k=te)}const G=[z.lng+I,z.lat+R,z.lng+w,z.lat+k];return this.isSurfacePointOnScreen([0,1,0])&&(G[3]=90,G[0]=-180,G[2]=180),this.isSurfacePointOnScreen([0,-1,0])&&(G[1]=-90,G[0]=-180,G[2]=180),new zi(G)}getConstrained(t,l){const f=o.ag(t.lat,-o.ah,o.ah),g=o.ag(+l,this.minZoom+Mr(0,f),this.maxZoom);return{center:new o.S(t.lng,f),zoom:g}}calculateCenterFromCameraLngLatAlt(t,l,f,g){return this._helper.calculateCenterFromCameraLngLatAlt(t,l,f,g)}setLocationAtPoint(t,l){const f=bn(this.unprojectScreenPoint(l)),g=bn(t),w=o.bo();o.bA(w);const I=o.bo();o.bx(I,f,w,-this.center.lng*Math.PI/180),o.bw(I,I,w,this.center.lat*Math.PI/180);const k=g[0]*g[0]+g[2]*g[2],R=I[0]*I[0];if(k<R)return;const z=Math.sqrt(k-R),G=-z,X=o.bB(g[0],g[2],I[0],z),W=o.bB(g[0],g[2],I[0],G),te=o.bo();o.bx(te,g,w,-X);const ae=o.bB(te[1],te[2],I[1],I[2]),Te=o.bo();o.bx(Te,g,w,-W);const we=o.bB(Te[1],Te[2],I[1],I[2]),Ee=.5*Math.PI,Ce=ae>=-Ee&&ae<=Ee,Fe=we>=-Ee&&we<=Ee;let Oe,Ue;if(Ce&&Fe){const yt=this.center.lng*Math.PI/180,ct=this.center.lat*Math.PI/180;o.bC(X,yt)+o.bC(ae,ct)<o.bC(W,yt)+o.bC(we,ct)?(Oe=X,Ue=ae):(Oe=W,Ue=we)}else if(Ce)Oe=X,Ue=ae;else{if(!Fe)return;Oe=W,Ue=we}const We=Oe/Math.PI*180,De=Ue/Math.PI*180,Qe=this.center.lat;this.setCenter(new o.S(We,o.ag(De,-90,90))),this.setZoom(this.zoom+Mr(Qe,this.center.lat))}locationToScreenPoint(t,l){const f=bn(t);if(l){const g=l.getElevationForLngLatZoom(t,this._helper._tileZoom);o.aQ(f,f,1+g/o.bt)}return this._projectSurfacePointToScreen(f)}_projectSurfacePointToScreen(t){const l=o.bu();return o.av(l,[...t,1],this._globeViewProjMatrixNoCorrection),l[0]/=l[3],l[1]/=l[3],new o.P((.5*l[0]+.5)*this.width,(.5*-l[1]+.5)*this.height)}screenPointToMercatorCoordinate(t,l){if(l){const f=l.pointCoordinate(t);if(f)return f}return o.a0.fromLngLat(this.unprojectScreenPoint(t))}screenPointToLocation(t,l){var f;return(f=this.screenPointToMercatorCoordinate(t,l))===null||f===void 0?void 0:f.toLngLat()}isPointOnMapSurface(t,l){const f=this._cameraPosition,g=this.getRayDirectionFromPixel(t);return!!this.rayPlanetIntersection(f,g)}getRayDirectionFromPixel(t){const l=o.bu();l[0]=t.x/this.width*2-1,l[1]=-1*(t.y/this.height*2-1),l[2]=1,l[3]=1,o.av(l,l,this._globeViewProjMatrixNoCorrectionInverted),l[0]/=l[3],l[1]/=l[3],l[2]/=l[3];const f=o.bo();f[0]=l[0]-this._cameraPosition[0],f[1]=l[1]-this._cameraPosition[1],f[2]=l[2]-this._cameraPosition[2];const g=o.bo();return o.aU(g,f),g}isSurfacePointVisible(t){const l=this._cachedClippingPlane;return l[0]*t[0]+l[1]*t[1]+l[2]*t[2]+l[3]>=0}isSurfacePointOnScreen(t){if(!this.isSurfacePointVisible(t))return!1;const l=o.bu();return o.av(l,[...t,1],this._globeViewProjMatrixNoCorrection),l[0]/=l[3],l[1]/=l[3],l[2]/=l[3],l[0]>-1&&l[0]<1&&l[1]>-1&&l[1]<1&&l[2]>-1&&l[2]<1}rayPlanetIntersection(t,l){const f=o.aW(t,l),g=o.bo(),w=o.bo();o.aQ(w,l,f),o.aT(g,t,w);const I=1-o.aW(g,g);if(I<0)return null;const k=o.aW(t,t)-1,R=-f+(f<0?1:-1)*Math.sqrt(I),z=k/R,G=R;return{tMin:Math.min(z,G),tMax:Math.max(z,G)}}unprojectScreenPoint(t){const l=this._cameraPosition,f=this.getRayDirectionFromPixel(t),g=this.rayPlanetIntersection(l,f);if(g){const G=o.bo();o.aR(G,l,[f[0]*g.tMin,f[1]*g.tMin,f[2]*g.tMin]);const X=o.bo();return o.aU(X,G),fo(X)}const w=this._cachedClippingPlane,I=w[0]*f[0]+w[1]*f[1]+w[2]*f[2],k=-o.b0(w,l)/I,R=o.bo();if(k>0)o.aR(R,l,[f[0]*k,f[1]*k,f[2]*k]);else{const G=o.bo();o.aR(G,l,[2*f[0],2*f[1],2*f[2]]);const X=o.b0(this._cachedClippingPlane,G);o.aT(R,G,[this._cachedClippingPlane[0]*X,this._cachedClippingPlane[1]*X,this._cachedClippingPlane[2]*X])}const z=function(G){const X=o.bo();return X[0]=G[0]*-G[3],X[1]=G[1]*-G[3],X[2]=G[2]*-G[3],{center:X,radius:Math.sqrt(1-G[3]*G[3])}}(w);return fo(function(G,X,W){const te=o.bo();o.aT(te,W,G);const ae=o.bo();return o.bp(ae,G,te,X/o.a_(te)),ae}(z.center,z.radius,R))}getMatrixForModel(t,l){const f=o.S.convert(t),g=1/o.bt,w=o.b8();return o.by(w,w,f.lng/180*Math.PI),o.b6(w,w,-f.lat/180*Math.PI),o.M(w,w,[0,0,1+l/o.bt]),o.b6(w,w,.5*Math.PI),o.N(w,w,[g,g,g]),w}getProjectionDataForCustomLayer(t=!0){const l=this.getProjectionData({overscaledTileID:new o.Z(0,0,0,0,0),applyGlobeMatrix:t});return l.tileMercatorCoords=[0,0,1,1],l}getFastPathSimpleProjectionMatrix(t){}}class Fr{get pixelsToClipSpaceMatrix(){return this._helper.pixelsToClipSpaceMatrix}get clipSpaceToPixelsMatrix(){return this._helper.clipSpaceToPixelsMatrix}get pixelsToGLUnits(){return this._helper.pixelsToGLUnits}get centerOffset(){return this._helper.centerOffset}get size(){return this._helper.size}get rotationMatrix(){return this._helper.rotationMatrix}get centerPoint(){return this._helper.centerPoint}get pixelsPerMeter(){return this._helper.pixelsPerMeter}setMinZoom(t){this._helper.setMinZoom(t)}setMaxZoom(t){this._helper.setMaxZoom(t)}setMinPitch(t){this._helper.setMinPitch(t)}setMaxPitch(t){this._helper.setMaxPitch(t)}setRenderWorldCopies(t){this._helper.setRenderWorldCopies(t)}setBearing(t){this._helper.setBearing(t)}setPitch(t){this._helper.setPitch(t)}setRoll(t){this._helper.setRoll(t)}setFov(t){this._helper.setFov(t)}setZoom(t){this._helper.setZoom(t)}setCenter(t){this._helper.setCenter(t)}setElevation(t){this._helper.setElevation(t)}setMinElevationForCurrentTile(t){this._helper.setMinElevationForCurrentTile(t)}setPadding(t){this._helper.setPadding(t)}interpolatePadding(t,l,f){return this._helper.interpolatePadding(t,l,f)}isPaddingEqual(t){return this._helper.isPaddingEqual(t)}resize(t,l,f=!0){this._helper.resize(t,l,f)}getMaxBounds(){return this._helper.getMaxBounds()}setMaxBounds(t){this._helper.setMaxBounds(t)}overrideNearFarZ(t,l){this._helper.overrideNearFarZ(t,l)}clearNearFarZOverride(){this._helper.clearNearFarZOverride()}getCameraQueryGeometry(t){return this._helper.getCameraQueryGeometry(this.getCameraPoint(),t)}get tileSize(){return this._helper.tileSize}get tileZoom(){return this._helper.tileZoom}get scale(){return this._helper.scale}get worldSize(){return this._helper.worldSize}get width(){return this._helper.width}get height(){return this._helper.height}get lngRange(){return this._helper.lngRange}get latRange(){return this._helper.latRange}get minZoom(){return this._helper.minZoom}get maxZoom(){return this._helper.maxZoom}get zoom(){return this._helper.zoom}get center(){return this._helper.center}get minPitch(){return this._helper.minPitch}get maxPitch(){return this._helper.maxPitch}get pitch(){return this._helper.pitch}get pitchInRadians(){return this._helper.pitchInRadians}get roll(){return this._helper.roll}get rollInRadians(){return this._helper.rollInRadians}get bearing(){return this._helper.bearing}get bearingInRadians(){return this._helper.bearingInRadians}get fov(){return this._helper.fov}get fovInRadians(){return this._helper.fovInRadians}get elevation(){return this._helper.elevation}get minElevationForCurrentTile(){return this._helper.minElevationForCurrentTile}get padding(){return this._helper.padding}get unmodified(){return this._helper.unmodified}get renderWorldCopies(){return this._helper.renderWorldCopies}get cameraToCenterDistance(){return this._helper.cameraToCenterDistance}get nearZ(){return this._helper.nearZ}get farZ(){return this._helper.farZ}get autoCalculateNearFarZ(){return this._helper.autoCalculateNearFarZ}get isGlobeRendering(){return this._globeness>0}setTransitionState(t,l){this._globeness=t,this._globeLatitudeErrorCorrectionRadians=l,this._calcMatrices(),this._verticalPerspectiveTransform.getCoveringTilesDetailsProvider().prepareNextFrame(),this._mercatorTransform.getCoveringTilesDetailsProvider().prepareNextFrame()}get currentTransform(){return this.isGlobeRendering?this._verticalPerspectiveTransform:this._mercatorTransform}constructor(){this._globeLatitudeErrorCorrectionRadians=0,this._globeness=1,this._helper=new Pi({calcMatrices:()=>{this._calcMatrices()},getConstrained:(t,l)=>this.getConstrained(t,l)}),this._globeness=1,this._mercatorTransform=new ji,this._verticalPerspectiveTransform=new ls}clone(){const t=new Fr;return t._globeness=this._globeness,t._globeLatitudeErrorCorrectionRadians=this._globeLatitudeErrorCorrectionRadians,t.apply(this),t}apply(t){this._helper.apply(t),this._mercatorTransform.apply(this),this._verticalPerspectiveTransform.apply(this,this._globeLatitudeErrorCorrectionRadians)}get projectionMatrix(){return this.currentTransform.projectionMatrix}get modelViewProjectionMatrix(){return this.currentTransform.modelViewProjectionMatrix}get inverseProjectionMatrix(){return this.currentTransform.inverseProjectionMatrix}get cameraPosition(){return this.currentTransform.cameraPosition}getProjectionData(t){const l=this._mercatorTransform.getProjectionData(t),f=this._verticalPerspectiveTransform.getProjectionData(t);return{mainMatrix:this.isGlobeRendering?f.mainMatrix:l.mainMatrix,clippingPlane:f.clippingPlane,tileMercatorCoords:f.tileMercatorCoords,projectionTransition:t.applyGlobeMatrix?this._globeness:0,fallbackMatrix:l.fallbackMatrix}}isLocationOccluded(t){return this.currentTransform.isLocationOccluded(t)}transformLightDirection(t){return this.currentTransform.transformLightDirection(t)}getPixelScale(){return o.bj(this._mercatorTransform.getPixelScale(),this._verticalPerspectiveTransform.getPixelScale(),this._globeness)}getCircleRadiusCorrection(){return o.bj(this._mercatorTransform.getCircleRadiusCorrection(),this._verticalPerspectiveTransform.getCircleRadiusCorrection(),this._globeness)}getPitchedTextCorrection(t,l,f){const g=this._mercatorTransform.getPitchedTextCorrection(t,l,f),w=this._verticalPerspectiveTransform.getPitchedTextCorrection(t,l,f);return o.bj(g,w,this._globeness)}projectTileCoordinates(t,l,f,g){return this.currentTransform.projectTileCoordinates(t,l,f,g)}_calcMatrices(){this._helper._width&&this._helper._height&&(this._verticalPerspectiveTransform.apply(this,this._globeLatitudeErrorCorrectionRadians),this._helper._nearZ=this._verticalPerspectiveTransform.nearZ,this._helper._farZ=this._verticalPerspectiveTransform.farZ,this._mercatorTransform.apply(this,!0,this.isGlobeRendering),this._helper._nearZ=this._mercatorTransform.nearZ,this._helper._farZ=this._mercatorTransform.farZ)}calculateFogMatrix(t){return this.currentTransform.calculateFogMatrix(t)}getVisibleUnwrappedCoordinates(t){return this.currentTransform.getVisibleUnwrappedCoordinates(t)}getCameraFrustum(){return this.currentTransform.getCameraFrustum()}getClippingPlane(){return this.currentTransform.getClippingPlane()}getCoveringTilesDetailsProvider(){return this.currentTransform.getCoveringTilesDetailsProvider()}recalculateZoomAndCenter(t){this._mercatorTransform.recalculateZoomAndCenter(t),this._verticalPerspectiveTransform.recalculateZoomAndCenter(t)}maxPitchScaleFactor(){return this._mercatorTransform.maxPitchScaleFactor()}getCameraPoint(){return this._helper.getCameraPoint()}getCameraAltitude(){return this._helper.getCameraAltitude()}getCameraLngLat(){return this._helper.getCameraLngLat()}lngLatToCameraDepth(t,l){return this.currentTransform.lngLatToCameraDepth(t,l)}populateCache(t){this._mercatorTransform.populateCache(t),this._verticalPerspectiveTransform.populateCache(t)}getBounds(){return this.currentTransform.getBounds()}getConstrained(t,l){return this.currentTransform.getConstrained(t,l)}calculateCenterFromCameraLngLatAlt(t,l,f,g){return this._helper.calculateCenterFromCameraLngLatAlt(t,l,f,g)}setLocationAtPoint(t,l){if(!this.isGlobeRendering)return this._mercatorTransform.setLocationAtPoint(t,l),void this.apply(this._mercatorTransform);this._verticalPerspectiveTransform.setLocationAtPoint(t,l),this.apply(this._verticalPerspectiveTransform)}locationToScreenPoint(t,l){return this.currentTransform.locationToScreenPoint(t,l)}screenPointToMercatorCoordinate(t,l){return this.currentTransform.screenPointToMercatorCoordinate(t,l)}screenPointToLocation(t,l){return this.currentTransform.screenPointToLocation(t,l)}isPointOnMapSurface(t,l){return this.currentTransform.isPointOnMapSurface(t,l)}getRayDirectionFromPixel(t){return this._verticalPerspectiveTransform.getRayDirectionFromPixel(t)}getMatrixForModel(t,l){return this.currentTransform.getMatrixForModel(t,l)}getProjectionDataForCustomLayer(t=!0){const l=this._mercatorTransform.getProjectionDataForCustomLayer(t);if(!this.isGlobeRendering)return l;const f=this._verticalPerspectiveTransform.getProjectionDataForCustomLayer(t);return f.fallbackMatrix=l.mainMatrix,f}getFastPathSimpleProjectionMatrix(t){return this.currentTransform.getFastPathSimpleProjectionMatrix(t)}}class Kn{get useGlobeControls(){return!0}handlePanInertia(t,l){const f=jn(t,l);return Math.abs(f.lng-l.center.lng)>180&&(f.lng=l.center.lng+179.5*Math.sign(f.lng-l.center.lng)),{easingCenter:f,easingOffset:new o.P(0,0)}}handleMapControlsRollPitchBearingZoom(t,l){const f=t.around,g=l.screenPointToLocation(f);t.bearingDelta&&l.setBearing(l.bearing+t.bearingDelta),t.pitchDelta&&l.setPitch(l.pitch+t.pitchDelta),t.rollDelta&&l.setRoll(l.roll+t.rollDelta);const w=l.zoom;t.zoomDelta&&l.setZoom(l.zoom+t.zoomDelta);const I=l.zoom-w;if(I===0)return;const k=o.bz(l.center.lng,g.lng),R=k/(Math.abs(k/180)+1),z=o.bz(l.center.lat,g.lat),G=l.getRayDirectionFromPixel(f),X=l.cameraPosition,W=-1*o.aW(X,G),te=o.bo();o.aR(te,X,[G[0]*W,G[1]*W,G[2]*W]);const ae=o.aY(te)-1,Te=Math.exp(.5*-Math.max(ae-.3,0)),we=Hn(l.worldSize,l.center.lat)/Math.min(l.width,l.height),Ee=o.bm(we,.9,.5,1,.25),Ce=(1-o.ae(-I))*Math.min(Te,Ee),Fe=l.center.lat,Oe=l.zoom,Ue=new o.S(l.center.lng+R*Ce,o.ag(l.center.lat+z*Ce,-o.ah,o.ah));l.setLocationAtPoint(g,f);const We=l.center,De=o.bm(Math.abs(k),45,85,0,1),Qe=o.bm(we,.75,.35,0,1),yt=Math.pow(Math.max(De,Qe),.25),ct=o.bz(We.lng,Ue.lng),dt=o.bz(We.lat,Ue.lat);l.setCenter(new o.S(We.lng+ct*yt,We.lat+dt*yt).wrap()),l.setZoom(Oe+Mr(Fe,l.center.lat))}handleMapControlsPan(t,l,f){if(!t.panDelta)return;const g=l.center.lat,w=l.zoom;l.setCenter(jn(t.panDelta,l).wrap()),l.setZoom(w+Mr(g,l.center.lat))}cameraForBoxAndBearing(t,l,f,g,w){const I=Ar(t,l,f,g,w),k=l.left/w.width*2-1,R=(w.width-l.right)/w.width*2-1,z=l.top/w.height*-2+1,G=(w.height-l.bottom)/w.height*-2+1,X=o.bz(f.getWest(),f.getEast())<0,W=X?f.getEast():f.getWest(),te=X?f.getWest():f.getEast(),ae=Math.max(f.getNorth(),f.getSouth()),Te=Math.min(f.getNorth(),f.getSouth()),we=W+.5*o.bz(W,te),Ee=ae+.5*o.bz(ae,Te),Ce=w.clone();Ce.setCenter(I.center),Ce.setBearing(I.bearing),Ce.setPitch(0),Ce.setRoll(0),Ce.setZoom(I.zoom);const Fe=Ce.modelViewProjectionMatrix,Oe=[bn(f.getNorthWest()),bn(f.getNorthEast()),bn(f.getSouthWest()),bn(f.getSouthEast()),bn(new o.S(te,Ee)),bn(new o.S(W,Ee)),bn(new o.S(we,ae)),bn(new o.S(we,Te))],Ue=bn(I.center);let We=Number.POSITIVE_INFINITY;for(const De of Oe)k<0&&(We=Kn.getLesserNonNegativeNonNull(We,Kn.solveVectorScale(De,Ue,Fe,"x",k))),R>0&&(We=Kn.getLesserNonNegativeNonNull(We,Kn.solveVectorScale(De,Ue,Fe,"x",R))),z>0&&(We=Kn.getLesserNonNegativeNonNull(We,Kn.solveVectorScale(De,Ue,Fe,"y",z))),G<0&&(We=Kn.getLesserNonNegativeNonNull(We,Kn.solveVectorScale(De,Ue,Fe,"y",G)));if(Number.isFinite(We)&&We!==0)return I.zoom=Ce.zoom+o.aj(We),I;or()}handleJumpToCenterZoom(t,l){const f=t.center.lat,g=t.getConstrained(l.center?o.S.convert(l.center):t.center,t.zoom).center;t.setCenter(g.wrap());const w=l.zoom!==void 0?+l.zoom:t.zoom+Mr(f,g.lat);t.zoom!==w&&t.setZoom(w)}handleEaseTo(t,l){const f=t.zoom,g=t.center,w=t.padding,I={roll:t.roll,pitch:t.pitch,bearing:t.bearing},k={roll:l.roll===void 0?t.roll:l.roll,pitch:l.pitch===void 0?t.pitch:l.pitch,bearing:l.bearing===void 0?t.bearing:l.bearing},R=l.zoom!==void 0,z=!t.isPaddingEqual(l.padding);let G=!1;const X=l.center?o.S.convert(l.center):g,W=t.getConstrained(X,f).center;ki(t,W);const te=t.clone();te.setCenter(W),te.setZoom(R?+l.zoom:f+Mr(g.lat,X.lat)),te.setBearing(l.bearing);const ae=new o.P(o.ag(t.centerPoint.x+l.offsetAsPoint.x,0,t.width),o.ag(t.centerPoint.y+l.offsetAsPoint.y,0,t.height));te.setLocationAtPoint(W,ae);const Te=(l.offset&&l.offsetAsPoint.mag())>0?te.center:W,we=R?+l.zoom:f+Mr(g.lat,Te.lat),Ee=f+Mr(g.lat,0),Ce=we+Mr(Te.lat,0),Fe=o.bz(g.lng,Te.lng),Oe=o.bz(g.lat,Te.lat),Ue=o.ae(Ce-Ee);return G=we!==f,{easeFunc:We=>{if(o.bd(I,k)||rr({startEulerAngles:I,endEulerAngles:k,tr:t,k:We,useSlerp:I.roll!=k.roll}),z&&t.interpolatePadding(w,l.padding,We),l.around)o.w("Easing around a point is not supported under globe projection."),t.setLocationAtPoint(l.around,l.aroundPoint);else{const De=Ce>Ee?Math.min(2,Ue):Math.max(.5,Ue),Qe=Math.pow(De,1-We),yt=Ko(g,Fe,Oe,We*Qe);t.setCenter(yt.wrap())}if(G){const De=o.C.number(Ee,Ce,We)+Mr(0,t.center.lat);t.setZoom(De)}},isZooming:G,elevationCenter:Te}}handleFlyTo(t,l){const f=l.zoom!==void 0,g=t.center,w=t.zoom,I=t.padding,k=!t.isPaddingEqual(l.padding),R=t.getConstrained(o.S.convert(l.center||l.locationAtOffset),w).center,z=f?+l.zoom:t.zoom+Mr(t.center.lat,R.lat),G=t.clone();G.setCenter(R),G.setZoom(z),G.setBearing(l.bearing);const X=new o.P(o.ag(t.centerPoint.x+l.offsetAsPoint.x,0,t.width),o.ag(t.centerPoint.y+l.offsetAsPoint.y,0,t.height));G.setLocationAtPoint(R,X);const W=G.center;ki(t,W);const te=function(Oe,Ue,We){const De=bn(Ue),Qe=bn(We),yt=o.aW(De,Qe),ct=Math.acos(yt),dt=kn(Oe);return ct/(2*Math.PI)*dt}(t,g,W),ae=w+Mr(g.lat,0),Te=z+Mr(W.lat,0),we=o.ae(Te-ae);let Ee;if(typeof l.minZoom=="number"){const Oe=+l.minZoom+Mr(W.lat,0),Ue=Math.min(Oe,ae,Te)+Mr(0,W.lat),We=t.getConstrained(W,Ue).zoom+Mr(W.lat,0);Ee=o.ae(We-ae)}const Ce=o.bz(g.lng,W.lng),Fe=o.bz(g.lat,W.lat);return{easeFunc:(Oe,Ue,We,De)=>{const Qe=Ko(g,Ce,Fe,We);k&&t.interpolatePadding(I,l.padding,Oe);const yt=Oe===1?W:Qe;t.setCenter(yt.wrap());const ct=ae+o.aj(Ue);t.setZoom(Oe===1?z:ct+Mr(0,yt.lat))},scaleOfZoom:we,targetCenter:W,scaleOfMinZoom:Ee,pixelPathLength:te}}static solveVectorScale(t,l,f,g,w){const I=g==="x"?[f[0],f[4],f[8],f[12]]:[f[1],f[5],f[9],f[13]],k=[f[3],f[7],f[11],f[15]],R=t[0]*I[0]+t[1]*I[1]+t[2]*I[2],z=t[0]*k[0]+t[1]*k[1]+t[2]*k[2],G=l[0]*I[0]+l[1]*I[1]+l[2]*I[2],X=l[0]*k[0]+l[1]*k[1]+l[2]*k[2];return G+w*z===R+w*X||k[3]*(R-G)+I[3]*(X-z)+R*X==G*z?null:(G+I[3]-w*X-w*k[3])/(G-R-w*X+w*z)}static getLesserNonNegativeNonNull(t,l){return l!==null&&l>=0&&l<t?l:t}}class Qo{constructor(t){this._globe=t,this._mercatorCameraHelper=new pr,this._verticalPerspectiveCameraHelper=new Kn}get useGlobeControls(){return this._globe.useGlobeRendering}get currentHelper(){return this.useGlobeControls?this._verticalPerspectiveCameraHelper:this._mercatorCameraHelper}handlePanInertia(t,l){return this.currentHelper.handlePanInertia(t,l)}handleMapControlsRollPitchBearingZoom(t,l){return this.currentHelper.handleMapControlsRollPitchBearingZoom(t,l)}handleMapControlsPan(t,l,f){this.currentHelper.handleMapControlsPan(t,l,f)}cameraForBoxAndBearing(t,l,f,g,w){return this.currentHelper.cameraForBoxAndBearing(t,l,f,g,w)}handleJumpToCenterZoom(t,l){this.currentHelper.handleJumpToCenterZoom(t,l)}handleEaseTo(t,l){return this.currentHelper.handleEaseTo(t,l)}handleFlyTo(t,l){return this.currentHelper.handleFlyTo(t,l)}}const io=(b,t)=>o.y(b,t&&t.filter(l=>l.identifier!=="source.canvas")),Gs=o.bD();class ea extends o.E{constructor(t,l={}){super(),this._rtlPluginLoaded=()=>{for(const f in this.sourceCaches){const g=this.sourceCaches[f].getSource().type;g!=="vector"&&g!=="geojson"||this.sourceCaches[f].reload()}},this.map=t,this.dispatcher=new ai(ti(),t._getMapId()),this.dispatcher.registerMessageHandler("GG",(f,g)=>this.getGlyphs(f,g)),this.dispatcher.registerMessageHandler("GI",(f,g)=>this.getImages(f,g)),this.imageManager=new $,this.imageManager.setEventedParent(this),this.glyphManager=new Pe(t._requestManager,l.localIdeographFontFamily),this.lineAtlas=new pt(256,512),this.crossTileSymbolIndex=new de,this._spritesImagesIds={},this._layers={},this._order=[],this.sourceCaches={},this.zoomHistory=new o.bE,this._loaded=!1,this._availableImages=[],this._globalState={},this._resetUpdates(),this.dispatcher.broadcast("SR",o.bF()),rn().on(Xt,this._rtlPluginLoaded),this.on("data",f=>{if(f.dataType!=="source"||f.sourceDataType!=="metadata")return;const g=this.sourceCaches[f.sourceId];if(!g)return;const w=g.getSource();if(w&&w.vectorLayerIds)for(const I in this._layers){const k=this._layers[I];k.source===w.id&&this._validateLayer(k)}})}setGlobalStateProperty(t,l){var f,g,w;this._checkLoaded();const I=l===null?(w=(g=(f=this.stylesheet.state)===null||f===void 0?void 0:f[t])===null||g===void 0?void 0:g.default)!==null&&w!==void 0?w:null:l;if(o.bG(I,this._globalState[t]))return this;this._globalState[t]=I;const k=this._findGlobalStateAffectedSources([t]);for(const R in this.sourceCaches)k.has(R)&&(this._reloadSource(R),this._changed=!0)}getGlobalState(){return this._globalState}setGlobalState(t){this._checkLoaded();const l=[];for(const g in t)!o.bG(this._globalState[g],t[g].default)&&(l.push(g),this._globalState[g]=t[g].default);const f=this._findGlobalStateAffectedSources(l);for(const g in this.sourceCaches)f.has(g)&&(this._reloadSource(g),this._changed=!0)}_findGlobalStateAffectedSources(t){if(t.length===0)return new Set;const l=new Set;for(const f in this._layers){const g=this._layers[f],w=g.getLayoutAffectingGlobalStateRefs();for(const I of t)w.has(I)&&l.add(g.source)}return l}loadURL(t,l={},f){this.fire(new o.l("dataloading",{dataType:"style"})),l.validate=typeof l.validate!="boolean"||l.validate;const g=this.map._requestManager.transformRequest(t,"Style");this._loadStyleRequest=new AbortController;const w=this._loadStyleRequest;o.j(g,this._loadStyleRequest).then(I=>{this._loadStyleRequest=null,this._load(I.data,l,f)}).catch(I=>{this._loadStyleRequest=null,I&&!w.signal.aborted&&this.fire(new o.k(I))})}loadJSON(t,l={},f){this.fire(new o.l("dataloading",{dataType:"style"})),this._frameRequest=new AbortController,Y.frameAsync(this._frameRequest).then(()=>{this._frameRequest=null,l.validate=l.validate!==!1,this._load(t,l,f)}).catch(()=>{})}loadEmpty(){this.fire(new o.l("dataloading",{dataType:"style"})),this._load(Gs,{validate:!1})}_load(t,l,f){var g,w,I;const k=l.transformStyle?l.transformStyle(f,t):t;if(!l.validate||!io(this,o.z(k))){this._loaded=!0,this.stylesheet=k;for(const R in k.sources)this.addSource(R,k.sources[R],{validate:!1});k.sprite?this._loadSprite(k.sprite):this.imageManager.setLoaded(!0),this.glyphManager.setURL(k.glyphs),this._createLayers(),this.light=new Be(this.stylesheet.light),this._setProjectionInternal(((g=this.stylesheet.projection)===null||g===void 0?void 0:g.type)||"mercator"),this.sky=new tt(this.stylesheet.sky),this.map.setTerrain((w=this.stylesheet.terrain)!==null&&w!==void 0?w:null),this.setGlobalState((I=this.stylesheet.state)!==null&&I!==void 0?I:null),this.fire(new o.l("data",{dataType:"style"})),this.fire(new o.l("style.load"))}}_createLayers(){const t=o.bH(this.stylesheet.layers);this.dispatcher.broadcast("SL",t),this._order=t.map(l=>l.id),this._layers={},this._serializedLayers=null;for(const l of t){const f=o.bI(l);f.setEventedParent(this,{layer:{id:l.id}}),this._layers[l.id]=f}}_loadSprite(t,l=!1,f=void 0){let g;this.imageManager.setLoaded(!1),this._spriteRequest=new AbortController,function(w,I,k,R){return o._(this,void 0,void 0,function*(){const z=Re(w),G=k>1?"@2x":"",X={},W={};for(const{id:te,url:ae}of z){const Te=I.transformRequest(Se(ae,G,".json"),"SpriteJSON");X[te]=o.j(Te,R);const we=I.transformRequest(Se(ae,G,".png"),"SpriteImage");W[te]=ne.getImage(we,R)}return yield Promise.all([...Object.values(X),...Object.values(W)]),function(te,ae){return o._(this,void 0,void 0,function*(){const Te={};for(const we in te){Te[we]={};const Ee=Y.getImageCanvasContext((yield ae[we]).data),Ce=(yield te[we]).data;for(const Fe in Ce){const{width:Oe,height:Ue,x:We,y:De,sdf:Qe,pixelRatio:yt,stretchX:ct,stretchY:dt,content:_t,textFitWidth:qt,textFitHeight:Vt}=Ce[Fe];Te[we][Fe]={data:null,pixelRatio:yt,sdf:Qe,stretchX:ct,stretchY:dt,content:_t,textFitWidth:qt,textFitHeight:Vt,spriteData:{width:Oe,height:Ue,x:We,y:De,context:Ee}}}}return Te})}(X,W)})}(t,this.map._requestManager,this.map.getPixelRatio(),this._spriteRequest).then(w=>{if(this._spriteRequest=null,w)for(const I in w){this._spritesImagesIds[I]=[];const k=this._spritesImagesIds[I]?this._spritesImagesIds[I].filter(R=>!(R in w)):[];for(const R of k)this.imageManager.removeImage(R),this._changedImages[R]=!0;for(const R in w[I]){const z=I==="default"?R:`${I}:${R}`;this._spritesImagesIds[I].push(z),z in this.imageManager.images?this.imageManager.updateImage(z,w[I][R],!1):this.imageManager.addImage(z,w[I][R]),l&&(this._changedImages[z]=!0)}}}).catch(w=>{this._spriteRequest=null,g=w,this.fire(new o.k(g))}).finally(()=>{this.imageManager.setLoaded(!0),this._availableImages=this.imageManager.listImages(),l&&(this._changed=!0),this.dispatcher.broadcast("SI",this._availableImages),this.fire(new o.l("data",{dataType:"style"})),f&&f(g)})}_unloadSprite(){for(const t of Object.values(this._spritesImagesIds).flat())this.imageManager.removeImage(t),this._changedImages[t]=!0;this._spritesImagesIds={},this._availableImages=this.imageManager.listImages(),this._changed=!0,this.dispatcher.broadcast("SI",this._availableImages),this.fire(new o.l("data",{dataType:"style"}))}_validateLayer(t){const l=this.sourceCaches[t.source];if(!l)return;const f=t.sourceLayer;if(!f)return;const g=l.getSource();(g.type==="geojson"||g.vectorLayerIds&&g.vectorLayerIds.indexOf(f)===-1)&&this.fire(new o.k(new Error(`Source layer "${f}" does not exist on source "${g.id}" as specified by style layer "${t.id}".`)))}loaded(){if(!this._loaded||Object.keys(this._updatedSources).length)return!1;for(const t in this.sourceCaches)if(!this.sourceCaches[t].loaded())return!1;return!!this.imageManager.isLoaded()}_serializeByIds(t,l=!1){const f=this._serializedAllLayers();if(!t||t.length===0)return Object.values(l?o.bJ(f):f);const g=[];for(const w of t)if(f[w]){const I=l?o.bJ(f[w]):f[w];g.push(I)}return g}_serializedAllLayers(){let t=this._serializedLayers;if(t)return t;t=this._serializedLayers={};const l=Object.keys(this._layers);for(const f of l){const g=this._layers[f];g.type!=="custom"&&(t[f]=g.serialize())}return t}hasTransitions(){var t,l,f;if(!((t=this.light)===null||t===void 0)&&t.hasTransition()||!((l=this.sky)===null||l===void 0)&&l.hasTransition()||!((f=this.projection)===null||f===void 0)&&f.hasTransition())return!0;for(const g in this.sourceCaches)if(this.sourceCaches[g].hasTransition())return!0;for(const g in this._layers)if(this._layers[g].hasTransition())return!0;return!1}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading.")}update(t){if(!this._loaded)return;const l=this._changed;if(l){const g=Object.keys(this._updatedLayers),w=Object.keys(this._removedLayers);(g.length||w.length)&&this._updateWorkerLayers(g,w);for(const I in this._updatedSources){const k=this._updatedSources[I];if(k==="reload")this._reloadSource(I);else{if(k!=="clear")throw new Error(`Invalid action ${k}`);this._clearSource(I)}}this._updateTilesForChangedImages(),this._updateTilesForChangedGlyphs();for(const I in this._updatedPaintProps)this._layers[I].updateTransitions(t);this.light.updateTransitions(t),this.sky.updateTransitions(t),this._resetUpdates()}const f={};for(const g in this.sourceCaches){const w=this.sourceCaches[g];f[g]=w.used,w.used=!1}for(const g of this._order){const w=this._layers[g];w.recalculate(t,this._availableImages),!w.isHidden(t.zoom)&&w.source&&(this.sourceCaches[w.source].used=!0)}for(const g in f){const w=this.sourceCaches[g];!!f[g]!=!!w.used&&w.fire(new o.l("data",{sourceDataType:"visibility",dataType:"source",sourceId:g}))}this.light.recalculate(t),this.sky.recalculate(t),this.projection.recalculate(t),this.z=t.zoom,l&&this.fire(new o.l("data",{dataType:"style"}))}_updateTilesForChangedImages(){const t=Object.keys(this._changedImages);if(t.length){for(const l in this.sourceCaches)this.sourceCaches[l].reloadTilesForDependencies(["icons","patterns"],t);this._changedImages={}}}_updateTilesForChangedGlyphs(){if(this._glyphsDidChange){for(const t in this.sourceCaches)this.sourceCaches[t].reloadTilesForDependencies(["glyphs"],[""]);this._glyphsDidChange=!1}}_updateWorkerLayers(t,l){this.dispatcher.broadcast("UL",{layers:this._serializeByIds(t,!1),removedIds:l})}_resetUpdates(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSources={},this._updatedPaintProps={},this._changedImages={},this._glyphsDidChange=!1}setState(t,l={}){var f;this._checkLoaded();const g=this.serialize();if(t=l.transformStyle?l.transformStyle(g,t):t,((f=l.validate)===null||f===void 0||f)&&io(this,o.z(t)))return!1;(t=o.bJ(t)).layers=o.bH(t.layers);const w=o.bK(g,t),I=this._getOperationsToPerform(w);if(I.unimplemented.length>0)throw new Error(`Unimplemented: ${I.unimplemented.join(", ")}.`);if(I.operations.length===0)return!1;for(const k of I.operations)k();return this.stylesheet=t,this._serializedLayers=null,!0}_getOperationsToPerform(t){const l=[],f=[];for(const g of t)switch(g.command){case"setCenter":case"setZoom":case"setBearing":case"setPitch":case"setRoll":continue;case"addLayer":l.push(()=>this.addLayer.apply(this,g.args));break;case"removeLayer":l.push(()=>this.removeLayer.apply(this,g.args));break;case"setPaintProperty":l.push(()=>this.setPaintProperty.apply(this,g.args));break;case"setLayoutProperty":l.push(()=>this.setLayoutProperty.apply(this,g.args));break;case"setFilter":l.push(()=>this.setFilter.apply(this,g.args));break;case"addSource":l.push(()=>this.addSource.apply(this,g.args));break;case"removeSource":l.push(()=>this.removeSource.apply(this,g.args));break;case"setLayerZoomRange":l.push(()=>this.setLayerZoomRange.apply(this,g.args));break;case"setLight":l.push(()=>this.setLight.apply(this,g.args));break;case"setGeoJSONSourceData":l.push(()=>this.setGeoJSONSourceData.apply(this,g.args));break;case"setGlyphs":l.push(()=>this.setGlyphs.apply(this,g.args));break;case"setSprite":l.push(()=>this.setSprite.apply(this,g.args));break;case"setTerrain":l.push(()=>this.map.setTerrain.apply(this,g.args));break;case"setSky":l.push(()=>this.setSky.apply(this,g.args));break;case"setProjection":this.setProjection.apply(this,g.args);break;case"setGlobalState":l.push(()=>this.setGlobalState.apply(this,g.args));break;case"setTransition":l.push(()=>{});break;default:f.push(g.command)}return{operations:l,unimplemented:f}}addImage(t,l){if(this.getImage(t))return this.fire(new o.k(new Error(`An image named "${t}" already exists.`)));this.imageManager.addImage(t,l),this._afterImageUpdated(t)}updateImage(t,l){this.imageManager.updateImage(t,l)}getImage(t){return this.imageManager.getImage(t)}removeImage(t){if(!this.getImage(t))return this.fire(new o.k(new Error(`An image named "${t}" does not exist.`)));this.imageManager.removeImage(t),this._afterImageUpdated(t)}_afterImageUpdated(t){this._availableImages=this.imageManager.listImages(),this._changedImages[t]=!0,this._changed=!0,this.dispatcher.broadcast("SI",this._availableImages),this.fire(new o.l("data",{dataType:"style"}))}listImages(){return this._checkLoaded(),this.imageManager.listImages()}addSource(t,l,f={}){if(this._checkLoaded(),this.sourceCaches[t]!==void 0)throw new Error(`Source "${t}" already exists.`);if(!l.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(l).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(l.type)>=0&&this._validate(o.z.source,`sources.${t}`,l,null,f))return;this.map&&this.map._collectResourceTiming&&(l.collectResourceTiming=!0);const g=this.sourceCaches[t]=new Tt(t,l,this.dispatcher);g.style=this,g.setEventedParent(this,()=>({isSourceLoaded:g.loaded(),source:g.serialize(),sourceId:t})),g.onAdd(this.map),this._changed=!0}removeSource(t){if(this._checkLoaded(),this.sourceCaches[t]===void 0)throw new Error("There is no source with this ID");for(const f in this._layers)if(this._layers[f].source===t)return this.fire(new o.k(new Error(`Source "${t}" cannot be removed while layer "${f}" is using it.`)));const l=this.sourceCaches[t];delete this.sourceCaches[t],delete this._updatedSources[t],l.fire(new o.l("data",{sourceDataType:"metadata",dataType:"source",sourceId:t})),l.setEventedParent(null),l.onRemove(this.map),this._changed=!0}setGeoJSONSourceData(t,l){if(this._checkLoaded(),this.sourceCaches[t]===void 0)throw new Error(`There is no source with this ID=${t}`);const f=this.sourceCaches[t].getSource();if(f.type!=="geojson")throw new Error(`geojsonSource.type is ${f.type}, which is !== 'geojson`);f.setData(l),this._changed=!0}getSource(t){return this.sourceCaches[t]&&this.sourceCaches[t].getSource()}addLayer(t,l,f={}){this._checkLoaded();const g=t.id;if(this.getLayer(g))return void this.fire(new o.k(new Error(`Layer "${g}" already exists on this map.`)));let w;if(t.type==="custom"){if(io(this,o.bL(t)))return;w=o.bI(t)}else{if("source"in t&&typeof t.source=="object"&&(this.addSource(g,t.source),t=o.bJ(t),t=o.e(t,{source:g})),this._validate(o.z.layer,`layers.${g}`,t,{arrayIndex:-1},f))return;w=o.bI(t),this._validateLayer(w),w.setEventedParent(this,{layer:{id:g}})}const I=l?this._order.indexOf(l):this._order.length;if(l&&I===-1)this.fire(new o.k(new Error(`Cannot add layer "${g}" before non-existing layer "${l}".`)));else{if(this._order.splice(I,0,g),this._layerOrderChanged=!0,this._layers[g]=w,this._removedLayers[g]&&w.source&&w.type!=="custom"){const k=this._removedLayers[g];delete this._removedLayers[g],k.type!==w.type?this._updatedSources[w.source]="clear":(this._updatedSources[w.source]="reload",this.sourceCaches[w.source].pause())}this._updateLayer(w),w.onAdd&&w.onAdd(this.map)}}moveLayer(t,l){if(this._checkLoaded(),this._changed=!0,!this._layers[t])return void this.fire(new o.k(new Error(`The layer '${t}' does not exist in the map's style and cannot be moved.`)));if(t===l)return;const f=this._order.indexOf(t);this._order.splice(f,1);const g=l?this._order.indexOf(l):this._order.length;l&&g===-1?this.fire(new o.k(new Error(`Cannot move layer "${t}" before non-existing layer "${l}".`))):(this._order.splice(g,0,t),this._layerOrderChanged=!0)}removeLayer(t){this._checkLoaded();const l=this._layers[t];if(!l)return void this.fire(new o.k(new Error(`Cannot remove non-existing layer "${t}".`)));l.setEventedParent(null);const f=this._order.indexOf(t);this._order.splice(f,1),this._layerOrderChanged=!0,this._changed=!0,this._removedLayers[t]=l,delete this._layers[t],this._serializedLayers&&delete this._serializedLayers[t],delete this._updatedLayers[t],delete this._updatedPaintProps[t],l.onRemove&&l.onRemove(this.map)}getLayer(t){return this._layers[t]}getLayersOrder(){return[...this._order]}hasLayer(t){return t in this._layers}setLayerZoomRange(t,l,f){this._checkLoaded();const g=this.getLayer(t);g?g.minzoom===l&&g.maxzoom===f||(l!=null&&(g.minzoom=l),f!=null&&(g.maxzoom=f),this._updateLayer(g)):this.fire(new o.k(new Error(`Cannot set the zoom range of non-existing layer "${t}".`)))}setFilter(t,l,f={}){this._checkLoaded();const g=this.getLayer(t);if(g){if(!o.bG(g.filter,l))return l==null?(g.setFilter(void 0),void this._updateLayer(g)):void(this._validate(o.z.filter,`layers.${g.id}.filter`,l,null,f)||(g.setFilter(o.bJ(l)),this._updateLayer(g)))}else this.fire(new o.k(new Error(`Cannot filter non-existing layer "${t}".`)))}getFilter(t){return o.bJ(this.getLayer(t).filter)}setLayoutProperty(t,l,f,g={}){this._checkLoaded();const w=this.getLayer(t);w?o.bG(w.getLayoutProperty(l),f)||(w.setLayoutProperty(l,f,g),this._updateLayer(w)):this.fire(new o.k(new Error(`Cannot style non-existing layer "${t}".`)))}getLayoutProperty(t,l){const f=this.getLayer(t);if(f)return f.getLayoutProperty(l);this.fire(new o.k(new Error(`Cannot get style of non-existing layer "${t}".`)))}setPaintProperty(t,l,f,g={}){this._checkLoaded();const w=this.getLayer(t);w?o.bG(w.getPaintProperty(l),f)||(w.setPaintProperty(l,f,g)&&this._updateLayer(w),this._changed=!0,this._updatedPaintProps[t]=!0,this._serializedLayers=null):this.fire(new o.k(new Error(`Cannot style non-existing layer "${t}".`)))}getPaintProperty(t,l){return this.getLayer(t).getPaintProperty(l)}setFeatureState(t,l){this._checkLoaded();const f=t.source,g=t.sourceLayer,w=this.sourceCaches[f];if(w===void 0)return void this.fire(new o.k(new Error(`The source '${f}' does not exist in the map's style.`)));const I=w.getSource().type;I==="geojson"&&g?this.fire(new o.k(new Error("GeoJSON sources cannot have a sourceLayer parameter."))):I!=="vector"||g?(t.id===void 0&&this.fire(new o.k(new Error("The feature id parameter must be provided."))),w.setFeatureState(g,t.id,l)):this.fire(new o.k(new Error("The sourceLayer parameter must be provided for vector source types.")))}removeFeatureState(t,l){this._checkLoaded();const f=t.source,g=this.sourceCaches[f];if(g===void 0)return void this.fire(new o.k(new Error(`The source '${f}' does not exist in the map's style.`)));const w=g.getSource().type,I=w==="vector"?t.sourceLayer:void 0;w!=="vector"||I?l&&typeof t.id!="string"&&typeof t.id!="number"?this.fire(new o.k(new Error("A feature id is required to remove its specific state property."))):g.removeFeatureState(I,t.id,l):this.fire(new o.k(new Error("The sourceLayer parameter must be provided for vector source types.")))}getFeatureState(t){this._checkLoaded();const l=t.source,f=t.sourceLayer,g=this.sourceCaches[l];if(g!==void 0)return g.getSource().type!=="vector"||f?(t.id===void 0&&this.fire(new o.k(new Error("The feature id parameter must be provided."))),g.getFeatureState(f,t.id)):void this.fire(new o.k(new Error("The sourceLayer parameter must be provided for vector source types.")));this.fire(new o.k(new Error(`The source '${l}' does not exist in the map's style.`)))}getTransition(){return o.e({duration:300,delay:0},this.stylesheet&&this.stylesheet.transition)}serialize(){if(!this._loaded)return;const t=o.bM(this.sourceCaches,w=>w.serialize()),l=this._serializeByIds(this._order,!0),f=this.map.getTerrain()||void 0,g=this.stylesheet;return o.bN({version:g.version,name:g.name,metadata:g.metadata,light:g.light,sky:g.sky,center:g.center,zoom:g.zoom,bearing:g.bearing,pitch:g.pitch,sprite:g.sprite,glyphs:g.glyphs,transition:g.transition,projection:g.projection,sources:t,layers:l,terrain:f},w=>w!==void 0)}_updateLayer(t){this._updatedLayers[t.id]=!0,t.source&&!this._updatedSources[t.source]&&this.sourceCaches[t.source].getSource().type!=="raster"&&(this._updatedSources[t.source]="reload",this.sourceCaches[t.source].pause()),this._serializedLayers=null,this._changed=!0}_flattenAndSortRenderedFeatures(t){const l=I=>this._layers[I].type==="fill-extrusion",f={},g=[];for(let I=this._order.length-1;I>=0;I--){const k=this._order[I];if(l(k)){f[k]=I;for(const R of t){const z=R[k];if(z)for(const G of z)g.push(G)}}}g.sort((I,k)=>k.intersectionZ-I.intersectionZ);const w=[];for(let I=this._order.length-1;I>=0;I--){const k=this._order[I];if(l(k))for(let R=g.length-1;R>=0;R--){const z=g[R].feature;if(f[z.layer.id]<I)break;w.push(z),g.pop()}else for(const R of t){const z=R[k];if(z)for(const G of z)w.push(G.feature)}}return w}queryRenderedFeatures(t,l,f){l&&l.filter&&this._validate(o.z.filter,"queryRenderedFeatures.filter",l.filter,null,l);const g={};if(l&&l.layers){if(!(Array.isArray(l.layers)||l.layers instanceof Set))return this.fire(new o.k(new Error("parameters.layers must be an Array or a Set of strings"))),[];for(const z of l.layers){const G=this._layers[z];if(!G)return this.fire(new o.k(new Error(`The layer '${z}' does not exist in the map's style and cannot be queried for features.`))),[];g[G.source]=!0}}const w=[];l.availableImages=this._availableImages;const I=this._serializedAllLayers(),k=l.layers instanceof Set?l.layers:Array.isArray(l.layers)?new Set(l.layers):null,R=Object.assign(Object.assign({},l),{layers:k});for(const z in this.sourceCaches)l.layers&&!g[z]||w.push(Xi(this.sourceCaches[z],this._layers,I,t,R,f,this.map.terrain?(G,X,W)=>this.map.terrain.getElevation(G,X,W):void 0));return this.placement&&w.push(function(z,G,X,W,te,ae,Te){const we={},Ee=ae.queryRenderedSymbols(W),Ce=[];for(const Fe of Object.keys(Ee).map(Number))Ce.push(Te[Fe]);Ce.sort(ii);for(const Fe of Ce){const Oe=Fe.featureIndex.lookupSymbolFeatures(Ee[Fe.bucketInstanceId],G,Fe.bucketIndex,Fe.sourceLayerIndex,te.filter,te.layers,te.availableImages,z);for(const Ue in Oe){const We=we[Ue]=we[Ue]||[],De=Oe[Ue];De.sort((Qe,yt)=>{const ct=Fe.featureSortOrder;if(ct){const dt=ct.indexOf(Qe.featureIndex);return ct.indexOf(yt.featureIndex)-dt}return yt.featureIndex-Qe.featureIndex});for(const Qe of De)We.push(Qe)}}return function(Fe,Oe,Ue){for(const We in Fe)for(const De of Fe[We])Jt(De,Ue[Oe[We].source]);return Fe}(we,z,X)}(this._layers,I,this.sourceCaches,t,R,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(w)}querySourceFeatures(t,l){l&&l.filter&&this._validate(o.z.filter,"querySourceFeatures.filter",l.filter,null,l);const f=this.sourceCaches[t];return f?function(g,w){const I=g.getRenderableIds().map(z=>g.getTileByID(z)),k=[],R={};for(let z=0;z<I.length;z++){const G=I[z],X=G.tileID.canonical.key;R[X]||(R[X]=!0,G.querySourceFeatures(k,w))}return k}(f,l):[]}getLight(){return this.light.getLight()}setLight(t,l={}){this._checkLoaded();const f=this.light.getLight();let g=!1;for(const I in t)if(!o.bG(t[I],f[I])){g=!0;break}if(!g)return;const w={now:Y.now(),transition:o.e({duration:300,delay:0},this.stylesheet.transition)};this.light.setLight(t,l),this.light.updateTransitions(w)}getProjection(){var t;return(t=this.stylesheet)===null||t===void 0?void 0:t.projection}setProjection(t){if(this._checkLoaded(),this.projection){if(this.projection.name===t.type)return;this.projection.destroy(),delete this.projection}this.stylesheet.projection=t,this._setProjectionInternal(t.type)}getSky(){var t;return(t=this.stylesheet)===null||t===void 0?void 0:t.sky}setSky(t,l={}){this._checkLoaded();const f=this.getSky();let g=!1;if(!t&&!f)return;if(t&&!f)g=!0;else if(!t&&f)g=!0;else for(const I in t)if(!o.bG(t[I],f[I])){g=!0;break}if(!g)return;const w={now:Y.now(),transition:o.e({duration:300,delay:0},this.stylesheet.transition)};this.stylesheet.sky=t,this.sky.setSky(t,l),this.sky.updateTransitions(w)}_setProjectionInternal(t){const l=function(f){if(Array.isArray(f)){const g=new Ho({type:f});return{projection:g,transform:new Fr,cameraHelper:new Qo(g)}}switch(f){case"mercator":return{projection:new Wt,transform:new ji,cameraHelper:new pr};case"globe":{const g=new Ho({type:["interpolate",["linear"],["zoom"],11,"vertical-perspective",12,"mercator"]});return{projection:g,transform:new Fr,cameraHelper:new Qo(g)}}case"vertical-perspective":return{projection:new js,transform:new ls,cameraHelper:new Kn};default:return o.w(`Unknown projection name: ${f}. Falling back to mercator projection.`),{projection:new Wt,transform:new ji,cameraHelper:new pr}}}(t);this.projection=l.projection,this.map.migrateProjection(l.transform,l.cameraHelper);for(const f in this.sourceCaches)this.sourceCaches[f].reload()}_validate(t,l,f,g,w={}){return(!w||w.validate!==!1)&&io(this,t.call(o.z,o.e({key:l,style:this.serialize(),value:f,styleSpec:o.v},g)))}_remove(t=!0){this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._loadStyleRequest&&(this._loadStyleRequest.abort(),this._loadStyleRequest=null),this._spriteRequest&&(this._spriteRequest.abort(),this._spriteRequest=null),rn().off(Xt,this._rtlPluginLoaded);for(const l in this._layers)this._layers[l].setEventedParent(null);for(const l in this.sourceCaches){const f=this.sourceCaches[l];f.setEventedParent(null),f.onRemove(this.map)}this.imageManager.setEventedParent(null),this.setEventedParent(null),t&&this.dispatcher.broadcast("RM",void 0),this.dispatcher.remove(t)}_clearSource(t){this.sourceCaches[t].clearTiles()}_reloadSource(t){this.sourceCaches[t].resume(),this.sourceCaches[t].reload()}_updateSources(t){for(const l in this.sourceCaches)this.sourceCaches[l].update(t,this.map.terrain)}_generateCollisionBoxes(){for(const t in this.sourceCaches)this._reloadSource(t)}_updatePlacement(t,l,f,g,w=!1){let I=!1,k=!1;const R={};for(const z of this._order){const G=this._layers[z];if(G.type!=="symbol")continue;if(!R[G.source]){const W=this.sourceCaches[G.source];R[G.source]=W.getRenderableIds(!0).map(te=>W.getTileByID(te)).sort((te,ae)=>ae.tileID.overscaledZ-te.tileID.overscaledZ||(te.tileID.isLessThan(ae.tileID)?-1:1))}const X=this.crossTileSymbolIndex.addLayer(G,R[G.source],t.center.lng);I=I||X}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._order),((w=w||this._layerOrderChanged||f===0)||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(Y.now(),t.zoom))&&(this.pauseablePlacement=new ko(t,this.map.terrain,this._order,w,l,f,g,this.placement),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._order,this._layers,R),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(Y.now()),k=!0),I&&this.pauseablePlacement.placement.setStale()),k||I)for(const z of this._order){const G=this._layers[z];G.type==="symbol"&&this.placement.updateLayerOpacities(G,R[G.source])}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(Y.now())}_releaseSymbolFadeTiles(){for(const t in this.sourceCaches)this.sourceCaches[t].releaseSymbolFadeTiles()}getImages(t,l){return o._(this,void 0,void 0,function*(){const f=yield this.imageManager.getImages(l.icons);this._updateTilesForChangedImages();const g=this.sourceCaches[l.source];return g&&g.setDependencies(l.tileID.key,l.type,l.icons),f})}getGlyphs(t,l){return o._(this,void 0,void 0,function*(){const f=yield this.glyphManager.getGlyphs(l.stacks),g=this.sourceCaches[l.source];return g&&g.setDependencies(l.tileID.key,l.type,[""]),f})}getGlyphsUrl(){return this.stylesheet.glyphs||null}setGlyphs(t,l={}){this._checkLoaded(),t&&this._validate(o.z.glyphs,"glyphs",t,null,l)||(this._glyphsDidChange=!0,this.stylesheet.glyphs=t,this.glyphManager.entries={},this.glyphManager.setURL(t))}addSprite(t,l,f={},g){this._checkLoaded();const w=[{id:t,url:l}],I=[...Re(this.stylesheet.sprite),...w];this._validate(o.z.sprite,"sprite",I,null,f)||(this.stylesheet.sprite=I,this._loadSprite(w,!0,g))}removeSprite(t){this._checkLoaded();const l=Re(this.stylesheet.sprite);if(l.find(f=>f.id===t)){if(this._spritesImagesIds[t])for(const f of this._spritesImagesIds[t])this.imageManager.removeImage(f),this._changedImages[f]=!0;l.splice(l.findIndex(f=>f.id===t),1),this.stylesheet.sprite=l.length>0?l:void 0,delete this._spritesImagesIds[t],this._availableImages=this.imageManager.listImages(),this._changed=!0,this.dispatcher.broadcast("SI",this._availableImages),this.fire(new o.l("data",{dataType:"style"}))}else this.fire(new o.k(new Error(`Sprite "${t}" doesn't exists on this map.`)))}getSprite(){return Re(this.stylesheet.sprite)}setSprite(t,l={},f){this._checkLoaded(),t&&this._validate(o.z.sprite,"sprite",t,null,l)||(this.stylesheet.sprite=t,t?this._loadSprite(t,!0,f):(this._unloadSprite(),f&&f(null)))}}var _a=o.aI([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);class ta{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffer=null,this.vao=null}bind(t,l,f,g,w,I,k,R,z){this.context=t;let G=this.boundPaintVertexBuffers.length!==g.length;for(let X=0;!G&&X<g.length;X++)this.boundPaintVertexBuffers[X]!==g[X]&&(G=!0);!this.vao||this.boundProgram!==l||this.boundLayoutVertexBuffer!==f||G||this.boundIndexBuffer!==w||this.boundVertexOffset!==I||this.boundDynamicVertexBuffer!==k||this.boundDynamicVertexBuffer2!==R||this.boundDynamicVertexBuffer3!==z?this.freshBind(l,f,g,w,I,k,R,z):(t.bindVertexArray.set(this.vao),k&&k.bind(),w&&w.dynamicDraw&&w.bind(),R&&R.bind(),z&&z.bind())}freshBind(t,l,f,g,w,I,k,R){const z=t.numAttributes,G=this.context,X=G.gl;this.vao&&this.destroy(),this.vao=G.createVertexArray(),G.bindVertexArray.set(this.vao),this.boundProgram=t,this.boundLayoutVertexBuffer=l,this.boundPaintVertexBuffers=f,this.boundIndexBuffer=g,this.boundVertexOffset=w,this.boundDynamicVertexBuffer=I,this.boundDynamicVertexBuffer2=k,this.boundDynamicVertexBuffer3=R,l.enableAttributes(X,t);for(const W of f)W.enableAttributes(X,t);I&&I.enableAttributes(X,t),k&&k.enableAttributes(X,t),R&&R.enableAttributes(X,t),l.bind(),l.setVertexAttribPointers(X,t,w);for(const W of f)W.bind(),W.setVertexAttribPointers(X,t,w);I&&(I.bind(),I.setVertexAttribPointers(X,t,w)),g&&g.bind(),k&&(k.bind(),k.setVertexAttribPointers(X,t,w)),R&&(R.bind(),R.setVertexAttribPointers(X,t,w)),G.currentNumAttributes=z}destroy(){this.vao&&(this.context.deleteVertexArray(this.vao),this.vao=null)}}const Ls=(b,t,l,f,g)=>({u_texture:0,u_ele_delta:b,u_fog_matrix:t,u_fog_color:l?l.properties.get("fog-color"):o.be.white,u_fog_ground_blend:l?l.properties.get("fog-ground-blend"):1,u_fog_ground_blend_opacity:g?0:l?l.calculateFogBlendOpacity(f):0,u_horizon_color:l?l.properties.get("horizon-color"):o.be.white,u_horizon_fog_blend:l?l.properties.get("horizon-fog-blend"):1,u_is_globe_mode:g?1:0}),Kl={mainMatrix:"u_projection_matrix",tileMercatorCoords:"u_projection_tile_mercator_coords",clippingPlane:"u_projection_clipping_plane",projectionTransition:"u_projection_transition",fallbackMatrix:"u_projection_fallback_matrix"};function zn(b){const t=[];for(let l=0;l<b.length;l++){if(b[l]===null)continue;const f=b[l].split(" ");t.push(f.pop())}return t}class go{constructor(t,l,f,g,w,I,k,R,z=[]){const G=t.gl;this.program=G.createProgram();const X=zn(l.staticAttributes),W=f?f.getBinderAttributes():[],te=X.concat(W),ae=qe.prelude.staticUniforms?zn(qe.prelude.staticUniforms):[],Te=k.staticUniforms?zn(k.staticUniforms):[],we=l.staticUniforms?zn(l.staticUniforms):[],Ee=f?f.getBinderUniforms():[],Ce=ae.concat(Te).concat(we).concat(Ee),Fe=[];for(const ct of Ce)Fe.indexOf(ct)<0&&Fe.push(ct);const Oe=f?f.defines():[];hn(G)&&Oe.unshift("#version 300 es"),w&&Oe.push("#define OVERDRAW_INSPECTOR;"),I&&Oe.push("#define TERRAIN3D;"),R&&Oe.push(R),z&&Oe.push(...z);let Ue=Oe.concat(qe.prelude.fragmentSource,k.fragmentSource,l.fragmentSource).join(`
`),We=Oe.concat(qe.prelude.vertexSource,k.vertexSource,l.vertexSource).join(`
`);hn(G)||(Ue=function(ct){return ct.replace(/\bin\s/g,"varying ").replace("out highp vec4 fragColor;","").replace(/fragColor/g,"gl_FragColor").replace(/texture\(/g,"texture2D(")}(Ue),We=function(ct){return ct.replace(/\bin\s/g,"attribute ").replace(/\bout\s/g,"varying ").replace(/texture\(/g,"texture2D(")}(We));const De=G.createShader(G.FRAGMENT_SHADER);if(G.isContextLost())return void(this.failedToCreate=!0);if(G.shaderSource(De,Ue),G.compileShader(De),!G.getShaderParameter(De,G.COMPILE_STATUS))throw new Error(`Could not compile fragment shader: ${G.getShaderInfoLog(De)}`);G.attachShader(this.program,De);const Qe=G.createShader(G.VERTEX_SHADER);if(G.isContextLost())return void(this.failedToCreate=!0);if(G.shaderSource(Qe,We),G.compileShader(Qe),!G.getShaderParameter(Qe,G.COMPILE_STATUS))throw new Error(`Could not compile vertex shader: ${G.getShaderInfoLog(Qe)}`);G.attachShader(this.program,Qe),this.attributes={};const yt={};this.numAttributes=te.length;for(let ct=0;ct<this.numAttributes;ct++)te[ct]&&(G.bindAttribLocation(this.program,ct,te[ct]),this.attributes[te[ct]]=ct);if(G.linkProgram(this.program),!G.getProgramParameter(this.program,G.LINK_STATUS))throw new Error(`Program failed to link: ${G.getProgramInfoLog(this.program)}`);G.deleteShader(Qe),G.deleteShader(De);for(let ct=0;ct<Fe.length;ct++){const dt=Fe[ct];if(dt&&!yt[dt]){const _t=G.getUniformLocation(this.program,dt);_t&&(yt[dt]=_t)}}this.fixedUniforms=g(t,yt),this.terrainUniforms=((ct,dt)=>({u_depth:new o.bO(ct,dt.u_depth),u_terrain:new o.bO(ct,dt.u_terrain),u_terrain_dim:new o.bf(ct,dt.u_terrain_dim),u_terrain_matrix:new o.bQ(ct,dt.u_terrain_matrix),u_terrain_unpack:new o.bR(ct,dt.u_terrain_unpack),u_terrain_exaggeration:new o.bf(ct,dt.u_terrain_exaggeration)}))(t,yt),this.projectionUniforms=((ct,dt)=>({u_projection_matrix:new o.bQ(ct,dt.u_projection_matrix),u_projection_tile_mercator_coords:new o.bR(ct,dt.u_projection_tile_mercator_coords),u_projection_clipping_plane:new o.bR(ct,dt.u_projection_clipping_plane),u_projection_transition:new o.bf(ct,dt.u_projection_transition),u_projection_fallback_matrix:new o.bQ(ct,dt.u_projection_fallback_matrix)}))(t,yt),this.binderUniforms=f?f.getUniforms(t,yt):[]}draw(t,l,f,g,w,I,k,R,z,G,X,W,te,ae,Te,we,Ee,Ce,Fe){const Oe=t.gl;if(this.failedToCreate)return;if(t.program.set(this.program),t.setDepthMode(f),t.setStencilMode(g),t.setColorMode(w),t.setCullFace(I),R){t.activeTexture.set(Oe.TEXTURE2),Oe.bindTexture(Oe.TEXTURE_2D,R.depthTexture),t.activeTexture.set(Oe.TEXTURE3),Oe.bindTexture(Oe.TEXTURE_2D,R.texture);for(const We in this.terrainUniforms)this.terrainUniforms[We].set(R[We])}if(z)for(const We in z)this.projectionUniforms[Kl[We]].set(z[We]);if(k)for(const We in this.fixedUniforms)this.fixedUniforms[We].set(k[We]);we&&we.setUniforms(t,this.binderUniforms,ae,{zoom:Te});let Ue=0;switch(l){case Oe.LINES:Ue=2;break;case Oe.TRIANGLES:Ue=3;break;case Oe.LINE_STRIP:Ue=1}for(const We of te.get()){const De=We.vaos||(We.vaos={});(De[G]||(De[G]=new ta)).bind(t,this,X,we?we.getPaintVertexBuffers():[],W,We.vertexOffset,Ee,Ce,Fe),Oe.drawElements(l,We.primitiveLength*Ue,Oe.UNSIGNED_SHORT,We.primitiveOffset*Ue*2)}}}function Da(b,t,l){const f=1/o.aB(l,1,t.transform.tileZoom),g=Math.pow(2,l.tileID.overscaledZ),w=l.tileSize*Math.pow(2,t.transform.tileZoom)/g,I=w*(l.tileID.canonical.x+l.tileID.wrap*g),k=w*l.tileID.canonical.y;return{u_image:0,u_texsize:l.imageAtlasTexture.size,u_scale:[f,b.fromScale,b.toScale],u_fade:b.t,u_pixel_coord_upper:[I>>16,k>>16],u_pixel_coord_lower:[65535&I,65535&k]}}const Co=(b,t,l,f)=>{const g=b.style.light,w=g.properties.get("position"),I=[w.x,w.y,w.z],k=o.bU();g.properties.get("anchor")==="viewport"&&o.bV(k,b.transform.bearingInRadians),o.bW(I,I,k);const R=b.transform.transformLightDirection(I),z=g.properties.get("color");return{u_lightpos:I,u_lightpos_globe:R,u_lightintensity:g.properties.get("intensity"),u_lightcolor:[z.r,z.g,z.b],u_vertical_gradient:+t,u_opacity:l,u_fill_translate:f}},ia=(b,t,l,f,g,w,I)=>o.e(Co(b,t,l,f),Da(w,b,I),{u_height_factor:-Math.pow(2,g.overscaledZ)/I.tileSize/8}),Rs=(b,t,l,f)=>o.e(Da(t,b,l),{u_fill_translate:f}),nn=(b,t)=>({u_world:b,u_fill_translate:t}),Ao=(b,t,l,f,g)=>o.e(Rs(b,t,l,g),{u_world:f}),ra=(b,t,l,f,g)=>{const w=b.transform;let I,k,R=0;if(l.paint.get("circle-pitch-alignment")==="map"){const z=o.aB(t,1,w.zoom);I=!0,k=[z,z],R=z/(o.$*Math.pow(2,t.tileID.overscaledZ))*2*Math.PI*g}else I=!1,k=w.pixelsToGLUnits;return{u_camera_to_center_distance:w.cameraToCenterDistance,u_scale_with_map:+(l.paint.get("circle-pitch-scale")==="map"),u_pitch_with_map:+I,u_device_pixel_ratio:b.pixelRatio,u_extrude_scale:k,u_globe_extrude_scale:R,u_translate:f}},ws=b=>({u_pixel_extrude_scale:[1/b.width,1/b.height]}),va=b=>({u_viewport_size:[b.width,b.height]}),xa=(b,t=1)=>({u_color:b,u_overlay:0,u_overlay_scale:t}),ro=(b,t,l,f)=>{const g=o.aB(b,1,t)/(o.$*Math.pow(2,b.tileID.overscaledZ))*2*Math.PI*f;return{u_extrude_scale:o.aB(b,1,t),u_intensity:l,u_globe_extrude_scale:g}},fl=(b,t,l,f)=>{const g=o.L();o.bX(g,0,b.width,b.height,0,0,1);const w=b.context.gl;return{u_matrix:g,u_world:[w.drawingBufferWidth,w.drawingBufferHeight],u_image:l,u_color_ramp:f,u_opacity:t.paint.get("heatmap-opacity")}},Lo=(b,t,l)=>{const f=l.paint.get("hillshade-accent-color");let g;switch(l.paint.get("hillshade-method")){case"basic":g=4;break;case"combined":g=1;break;case"igor":g=2;break;case"multidirectional":g=3;break;default:g=0}const w=l.getIlluminationProperties();for(let I=0;I<w.directionRadians.length;I++)l.paint.get("hillshade-illumination-anchor")==="viewport"&&(w.directionRadians[I]+=b.transform.bearingInRadians);return{u_image:0,u_latrange:Ql(0,t.tileID),u_exaggeration:l.paint.get("hillshade-exaggeration"),u_altitudes:w.altitudeRadians,u_azimuths:w.directionRadians,u_accent:f,u_method:g,u_highlights:w.highlightColor,u_shadows:w.shadowColor}},Jl=(b,t)=>{const l=t.stride,f=o.L();return o.bX(f,0,o.$,-o.$,0,0,1),o.M(f,f,[0,-o.$,0]),{u_matrix:f,u_image:1,u_dimension:[l,l],u_zoom:b.overscaledZ,u_unpack:t.getUnpackVector()}};function Ql(b,t){const l=Math.pow(2,t.canonical.z),f=t.canonical.y;return[new o.a0(0,f/l).toLngLat().lat,new o.a0(0,(f+1)/l).toLngLat().lat]}const ml=(b,t,l=0)=>({u_image:0,u_unpack:t.getUnpackVector(),u_dimension:[t.stride,t.stride],u_elevation_stops:1,u_color_stops:4,u_color_ramp_size:l,u_opacity:b.paint.get("color-relief-opacity")}),ba=(b,t,l,f)=>{const g=b.transform;return{u_translation:gl(b,t,l),u_ratio:f/o.aB(t,1,g.zoom),u_device_pixel_ratio:b.pixelRatio,u_units_to_pixels:[1/g.pixelsToGLUnits[0],1/g.pixelsToGLUnits[1]]}},na=(b,t,l,f,g)=>o.e(ba(b,t,l,f),{u_image:0,u_image_height:g}),Ro=(b,t,l,f,g)=>{const w=b.transform,I=Us(t,w);return{u_translation:gl(b,t,l),u_texsize:t.imageAtlasTexture.size,u_ratio:f/o.aB(t,1,w.zoom),u_device_pixel_ratio:b.pixelRatio,u_image:0,u_scale:[I,g.fromScale,g.toScale],u_fade:g.t,u_units_to_pixels:[1/w.pixelsToGLUnits[0],1/w.pixelsToGLUnits[1]]}},eu=(b,t,l,f,g,w)=>{const I=b.lineAtlas,k=Us(t,b.transform),R=l.layout.get("line-cap")==="round",z=I.getDash(g.from,R),G=I.getDash(g.to,R),X=z.width*w.fromScale,W=G.width*w.toScale;return o.e(ba(b,t,l,f),{u_patternscale_a:[k/X,-z.height/2],u_patternscale_b:[k/W,-G.height/2],u_sdfgamma:I.width/(256*Math.min(X,W)*b.pixelRatio)/2,u_image:0,u_tex_y_a:z.y,u_tex_y_b:G.y,u_mix:w.t})};function Us(b,t){return 1/o.aB(b,1,t.tileZoom)}function gl(b,t,l){return o.aC(b.transform,t,l.paint.get("line-translate"),l.paint.get("line-translate-anchor"))}const us=(b,t,l,f,g)=>{return{u_tl_parent:b,u_scale_parent:t,u_buffer_scale:1,u_fade_t:l.mix,u_opacity:l.opacity*f.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:f.paint.get("raster-brightness-min"),u_brightness_high:f.paint.get("raster-brightness-max"),u_saturation_factor:(I=f.paint.get("raster-saturation"),I>0?1-1/(1.001-I):-I),u_contrast_factor:(w=f.paint.get("raster-contrast"),w>0?1/(1-w):1+w),u_spin_weights:Fa(f.paint.get("raster-hue-rotate")),u_coords_top:[g[0].x,g[0].y,g[1].x,g[1].y],u_coords_bottom:[g[3].x,g[3].y,g[2].x,g[2].y]};var w,I};function Fa(b){b*=Math.PI/180;const t=Math.sin(b),l=Math.cos(b);return[(2*l+1)/3,(-Math.sqrt(3)*t-l+1)/3,(Math.sqrt(3)*t-l+1)/3]}const za=(b,t,l,f,g,w,I,k,R,z,G,X,W)=>{const te=I.transform;return{u_is_size_zoom_constant:+(b==="constant"||b==="source"),u_is_size_feature_constant:+(b==="constant"||b==="camera"),u_size_t:t?t.uSizeT:0,u_size:t?t.uSize:0,u_camera_to_center_distance:te.cameraToCenterDistance,u_pitch:te.pitch/360*2*Math.PI,u_rotate_symbol:+l,u_aspect_ratio:te.width/te.height,u_fade_change:I.options.fadeDuration?I.symbolFadeChange:1,u_label_plane_matrix:k,u_coord_matrix:R,u_is_text:+G,u_pitch_with_map:+f,u_is_along_line:g,u_is_variable_anchor:w,u_texsize:X,u_texture:0,u_translation:z,u_pitched_scale:W}},Vs=(b,t,l,f,g,w,I,k,R,z,G,X,W,te)=>{const ae=I.transform;return o.e(za(b,t,l,f,g,w,I,k,R,z,G,X,te),{u_gamma_scale:f?Math.cos(ae.pitch*Math.PI/180)*ae.cameraToCenterDistance:1,u_device_pixel_ratio:I.pixelRatio,u_is_halo:1})},yl=(b,t,l,f,g,w,I,k,R,z,G,X,W)=>o.e(Vs(b,t,l,f,g,w,I,k,R,z,!0,G,0,W),{u_texsize_icon:X,u_texture_icon:1}),sa=(b,t)=>({u_opacity:b,u_color:t}),Ba=(b,t,l,f,g)=>o.e(function(w,I,k,R){const z=k.imageManager.getPattern(w.from.toString()),G=k.imageManager.getPattern(w.to.toString()),{width:X,height:W}=k.imageManager.getPixelSize(),te=Math.pow(2,R.tileID.overscaledZ),ae=R.tileSize*Math.pow(2,k.transform.tileZoom)/te,Te=ae*(R.tileID.canonical.x+R.tileID.wrap*te),we=ae*R.tileID.canonical.y;return{u_image:0,u_pattern_tl_a:z.tl,u_pattern_br_a:z.br,u_pattern_tl_b:G.tl,u_pattern_br_b:G.br,u_texsize:[X,W],u_mix:I.t,u_pattern_size_a:z.displaySize,u_pattern_size_b:G.displaySize,u_scale_a:I.fromScale,u_scale_b:I.toScale,u_tile_units_to_pixels:1/o.aB(R,1,k.transform.tileZoom),u_pixel_coord_upper:[Te>>16,we>>16],u_pixel_coord_lower:[65535&Te,65535&we]}}(l,g,t,f),{u_opacity:b}),_l=(b,t)=>{},No={fillExtrusion:(b,t)=>({u_lightpos:new o.bS(b,t.u_lightpos),u_lightpos_globe:new o.bS(b,t.u_lightpos_globe),u_lightintensity:new o.bf(b,t.u_lightintensity),u_lightcolor:new o.bS(b,t.u_lightcolor),u_vertical_gradient:new o.bf(b,t.u_vertical_gradient),u_opacity:new o.bf(b,t.u_opacity),u_fill_translate:new o.bT(b,t.u_fill_translate)}),fillExtrusionPattern:(b,t)=>({u_lightpos:new o.bS(b,t.u_lightpos),u_lightpos_globe:new o.bS(b,t.u_lightpos_globe),u_lightintensity:new o.bf(b,t.u_lightintensity),u_lightcolor:new o.bS(b,t.u_lightcolor),u_vertical_gradient:new o.bf(b,t.u_vertical_gradient),u_height_factor:new o.bf(b,t.u_height_factor),u_opacity:new o.bf(b,t.u_opacity),u_fill_translate:new o.bT(b,t.u_fill_translate),u_image:new o.bO(b,t.u_image),u_texsize:new o.bT(b,t.u_texsize),u_pixel_coord_upper:new o.bT(b,t.u_pixel_coord_upper),u_pixel_coord_lower:new o.bT(b,t.u_pixel_coord_lower),u_scale:new o.bS(b,t.u_scale),u_fade:new o.bf(b,t.u_fade)}),fill:(b,t)=>({u_fill_translate:new o.bT(b,t.u_fill_translate)}),fillPattern:(b,t)=>({u_image:new o.bO(b,t.u_image),u_texsize:new o.bT(b,t.u_texsize),u_pixel_coord_upper:new o.bT(b,t.u_pixel_coord_upper),u_pixel_coord_lower:new o.bT(b,t.u_pixel_coord_lower),u_scale:new o.bS(b,t.u_scale),u_fade:new o.bf(b,t.u_fade),u_fill_translate:new o.bT(b,t.u_fill_translate)}),fillOutline:(b,t)=>({u_world:new o.bT(b,t.u_world),u_fill_translate:new o.bT(b,t.u_fill_translate)}),fillOutlinePattern:(b,t)=>({u_world:new o.bT(b,t.u_world),u_image:new o.bO(b,t.u_image),u_texsize:new o.bT(b,t.u_texsize),u_pixel_coord_upper:new o.bT(b,t.u_pixel_coord_upper),u_pixel_coord_lower:new o.bT(b,t.u_pixel_coord_lower),u_scale:new o.bS(b,t.u_scale),u_fade:new o.bf(b,t.u_fade),u_fill_translate:new o.bT(b,t.u_fill_translate)}),circle:(b,t)=>({u_camera_to_center_distance:new o.bf(b,t.u_camera_to_center_distance),u_scale_with_map:new o.bO(b,t.u_scale_with_map),u_pitch_with_map:new o.bO(b,t.u_pitch_with_map),u_extrude_scale:new o.bT(b,t.u_extrude_scale),u_device_pixel_ratio:new o.bf(b,t.u_device_pixel_ratio),u_globe_extrude_scale:new o.bf(b,t.u_globe_extrude_scale),u_translate:new o.bT(b,t.u_translate)}),collisionBox:(b,t)=>({u_pixel_extrude_scale:new o.bT(b,t.u_pixel_extrude_scale)}),collisionCircle:(b,t)=>({u_viewport_size:new o.bT(b,t.u_viewport_size)}),debug:(b,t)=>({u_color:new o.bP(b,t.u_color),u_overlay:new o.bO(b,t.u_overlay),u_overlay_scale:new o.bf(b,t.u_overlay_scale)}),depth:_l,clippingMask:_l,heatmap:(b,t)=>({u_extrude_scale:new o.bf(b,t.u_extrude_scale),u_intensity:new o.bf(b,t.u_intensity),u_globe_extrude_scale:new o.bf(b,t.u_globe_extrude_scale)}),heatmapTexture:(b,t)=>({u_matrix:new o.bQ(b,t.u_matrix),u_world:new o.bT(b,t.u_world),u_image:new o.bO(b,t.u_image),u_color_ramp:new o.bO(b,t.u_color_ramp),u_opacity:new o.bf(b,t.u_opacity)}),hillshade:(b,t)=>({u_image:new o.bO(b,t.u_image),u_latrange:new o.bT(b,t.u_latrange),u_exaggeration:new o.bf(b,t.u_exaggeration),u_altitudes:new o.bZ(b,t.u_altitudes),u_azimuths:new o.bZ(b,t.u_azimuths),u_accent:new o.bP(b,t.u_accent),u_method:new o.bO(b,t.u_method),u_shadows:new o.bY(b,t.u_shadows),u_highlights:new o.bY(b,t.u_highlights)}),hillshadePrepare:(b,t)=>({u_matrix:new o.bQ(b,t.u_matrix),u_image:new o.bO(b,t.u_image),u_dimension:new o.bT(b,t.u_dimension),u_zoom:new o.bf(b,t.u_zoom),u_unpack:new o.bR(b,t.u_unpack)}),colorRelief:(b,t)=>({u_image:new o.bO(b,t.u_image),u_unpack:new o.bR(b,t.u_unpack),u_dimension:new o.bT(b,t.u_dimension),u_elevation_stops:new o.bO(b,t.u_elevation_stops),u_color_stops:new o.bO(b,t.u_color_stops),u_color_ramp_size:new o.bO(b,t.u_color_ramp_size),u_opacity:new o.bf(b,t.u_opacity)}),line:(b,t)=>({u_translation:new o.bT(b,t.u_translation),u_ratio:new o.bf(b,t.u_ratio),u_device_pixel_ratio:new o.bf(b,t.u_device_pixel_ratio),u_units_to_pixels:new o.bT(b,t.u_units_to_pixels)}),lineGradient:(b,t)=>({u_translation:new o.bT(b,t.u_translation),u_ratio:new o.bf(b,t.u_ratio),u_device_pixel_ratio:new o.bf(b,t.u_device_pixel_ratio),u_units_to_pixels:new o.bT(b,t.u_units_to_pixels),u_image:new o.bO(b,t.u_image),u_image_height:new o.bf(b,t.u_image_height)}),linePattern:(b,t)=>({u_translation:new o.bT(b,t.u_translation),u_texsize:new o.bT(b,t.u_texsize),u_ratio:new o.bf(b,t.u_ratio),u_device_pixel_ratio:new o.bf(b,t.u_device_pixel_ratio),u_image:new o.bO(b,t.u_image),u_units_to_pixels:new o.bT(b,t.u_units_to_pixels),u_scale:new o.bS(b,t.u_scale),u_fade:new o.bf(b,t.u_fade)}),lineSDF:(b,t)=>({u_translation:new o.bT(b,t.u_translation),u_ratio:new o.bf(b,t.u_ratio),u_device_pixel_ratio:new o.bf(b,t.u_device_pixel_ratio),u_units_to_pixels:new o.bT(b,t.u_units_to_pixels),u_patternscale_a:new o.bT(b,t.u_patternscale_a),u_patternscale_b:new o.bT(b,t.u_patternscale_b),u_sdfgamma:new o.bf(b,t.u_sdfgamma),u_image:new o.bO(b,t.u_image),u_tex_y_a:new o.bf(b,t.u_tex_y_a),u_tex_y_b:new o.bf(b,t.u_tex_y_b),u_mix:new o.bf(b,t.u_mix)}),raster:(b,t)=>({u_tl_parent:new o.bT(b,t.u_tl_parent),u_scale_parent:new o.bf(b,t.u_scale_parent),u_buffer_scale:new o.bf(b,t.u_buffer_scale),u_fade_t:new o.bf(b,t.u_fade_t),u_opacity:new o.bf(b,t.u_opacity),u_image0:new o.bO(b,t.u_image0),u_image1:new o.bO(b,t.u_image1),u_brightness_low:new o.bf(b,t.u_brightness_low),u_brightness_high:new o.bf(b,t.u_brightness_high),u_saturation_factor:new o.bf(b,t.u_saturation_factor),u_contrast_factor:new o.bf(b,t.u_contrast_factor),u_spin_weights:new o.bS(b,t.u_spin_weights),u_coords_top:new o.bR(b,t.u_coords_top),u_coords_bottom:new o.bR(b,t.u_coords_bottom)}),symbolIcon:(b,t)=>({u_is_size_zoom_constant:new o.bO(b,t.u_is_size_zoom_constant),u_is_size_feature_constant:new o.bO(b,t.u_is_size_feature_constant),u_size_t:new o.bf(b,t.u_size_t),u_size:new o.bf(b,t.u_size),u_camera_to_center_distance:new o.bf(b,t.u_camera_to_center_distance),u_pitch:new o.bf(b,t.u_pitch),u_rotate_symbol:new o.bO(b,t.u_rotate_symbol),u_aspect_ratio:new o.bf(b,t.u_aspect_ratio),u_fade_change:new o.bf(b,t.u_fade_change),u_label_plane_matrix:new o.bQ(b,t.u_label_plane_matrix),u_coord_matrix:new o.bQ(b,t.u_coord_matrix),u_is_text:new o.bO(b,t.u_is_text),u_pitch_with_map:new o.bO(b,t.u_pitch_with_map),u_is_along_line:new o.bO(b,t.u_is_along_line),u_is_variable_anchor:new o.bO(b,t.u_is_variable_anchor),u_texsize:new o.bT(b,t.u_texsize),u_texture:new o.bO(b,t.u_texture),u_translation:new o.bT(b,t.u_translation),u_pitched_scale:new o.bf(b,t.u_pitched_scale)}),symbolSDF:(b,t)=>({u_is_size_zoom_constant:new o.bO(b,t.u_is_size_zoom_constant),u_is_size_feature_constant:new o.bO(b,t.u_is_size_feature_constant),u_size_t:new o.bf(b,t.u_size_t),u_size:new o.bf(b,t.u_size),u_camera_to_center_distance:new o.bf(b,t.u_camera_to_center_distance),u_pitch:new o.bf(b,t.u_pitch),u_rotate_symbol:new o.bO(b,t.u_rotate_symbol),u_aspect_ratio:new o.bf(b,t.u_aspect_ratio),u_fade_change:new o.bf(b,t.u_fade_change),u_label_plane_matrix:new o.bQ(b,t.u_label_plane_matrix),u_coord_matrix:new o.bQ(b,t.u_coord_matrix),u_is_text:new o.bO(b,t.u_is_text),u_pitch_with_map:new o.bO(b,t.u_pitch_with_map),u_is_along_line:new o.bO(b,t.u_is_along_line),u_is_variable_anchor:new o.bO(b,t.u_is_variable_anchor),u_texsize:new o.bT(b,t.u_texsize),u_texture:new o.bO(b,t.u_texture),u_gamma_scale:new o.bf(b,t.u_gamma_scale),u_device_pixel_ratio:new o.bf(b,t.u_device_pixel_ratio),u_is_halo:new o.bO(b,t.u_is_halo),u_translation:new o.bT(b,t.u_translation),u_pitched_scale:new o.bf(b,t.u_pitched_scale)}),symbolTextAndIcon:(b,t)=>({u_is_size_zoom_constant:new o.bO(b,t.u_is_size_zoom_constant),u_is_size_feature_constant:new o.bO(b,t.u_is_size_feature_constant),u_size_t:new o.bf(b,t.u_size_t),u_size:new o.bf(b,t.u_size),u_camera_to_center_distance:new o.bf(b,t.u_camera_to_center_distance),u_pitch:new o.bf(b,t.u_pitch),u_rotate_symbol:new o.bO(b,t.u_rotate_symbol),u_aspect_ratio:new o.bf(b,t.u_aspect_ratio),u_fade_change:new o.bf(b,t.u_fade_change),u_label_plane_matrix:new o.bQ(b,t.u_label_plane_matrix),u_coord_matrix:new o.bQ(b,t.u_coord_matrix),u_is_text:new o.bO(b,t.u_is_text),u_pitch_with_map:new o.bO(b,t.u_pitch_with_map),u_is_along_line:new o.bO(b,t.u_is_along_line),u_is_variable_anchor:new o.bO(b,t.u_is_variable_anchor),u_texsize:new o.bT(b,t.u_texsize),u_texsize_icon:new o.bT(b,t.u_texsize_icon),u_texture:new o.bO(b,t.u_texture),u_texture_icon:new o.bO(b,t.u_texture_icon),u_gamma_scale:new o.bf(b,t.u_gamma_scale),u_device_pixel_ratio:new o.bf(b,t.u_device_pixel_ratio),u_is_halo:new o.bO(b,t.u_is_halo),u_translation:new o.bT(b,t.u_translation),u_pitched_scale:new o.bf(b,t.u_pitched_scale)}),background:(b,t)=>({u_opacity:new o.bf(b,t.u_opacity),u_color:new o.bP(b,t.u_color)}),backgroundPattern:(b,t)=>({u_opacity:new o.bf(b,t.u_opacity),u_image:new o.bO(b,t.u_image),u_pattern_tl_a:new o.bT(b,t.u_pattern_tl_a),u_pattern_br_a:new o.bT(b,t.u_pattern_br_a),u_pattern_tl_b:new o.bT(b,t.u_pattern_tl_b),u_pattern_br_b:new o.bT(b,t.u_pattern_br_b),u_texsize:new o.bT(b,t.u_texsize),u_mix:new o.bf(b,t.u_mix),u_pattern_size_a:new o.bT(b,t.u_pattern_size_a),u_pattern_size_b:new o.bT(b,t.u_pattern_size_b),u_scale_a:new o.bf(b,t.u_scale_a),u_scale_b:new o.bf(b,t.u_scale_b),u_pixel_coord_upper:new o.bT(b,t.u_pixel_coord_upper),u_pixel_coord_lower:new o.bT(b,t.u_pixel_coord_lower),u_tile_units_to_pixels:new o.bf(b,t.u_tile_units_to_pixels)}),terrain:(b,t)=>({u_texture:new o.bO(b,t.u_texture),u_ele_delta:new o.bf(b,t.u_ele_delta),u_fog_matrix:new o.bQ(b,t.u_fog_matrix),u_fog_color:new o.bP(b,t.u_fog_color),u_fog_ground_blend:new o.bf(b,t.u_fog_ground_blend),u_fog_ground_blend_opacity:new o.bf(b,t.u_fog_ground_blend_opacity),u_horizon_color:new o.bP(b,t.u_horizon_color),u_horizon_fog_blend:new o.bf(b,t.u_horizon_fog_blend),u_is_globe_mode:new o.bf(b,t.u_is_globe_mode)}),terrainDepth:(b,t)=>({u_ele_delta:new o.bf(b,t.u_ele_delta)}),terrainCoords:(b,t)=>({u_texture:new o.bO(b,t.u_texture),u_terrain_coords_id:new o.bf(b,t.u_terrain_coords_id),u_ele_delta:new o.bf(b,t.u_ele_delta)}),projectionErrorMeasurement:(b,t)=>({u_input:new o.bf(b,t.u_input),u_output_expected:new o.bf(b,t.u_output_expected)}),atmosphere:(b,t)=>({u_sun_pos:new o.bS(b,t.u_sun_pos),u_atmosphere_blend:new o.bf(b,t.u_atmosphere_blend),u_globe_position:new o.bS(b,t.u_globe_position),u_globe_radius:new o.bf(b,t.u_globe_radius),u_inv_proj_matrix:new o.bQ(b,t.u_inv_proj_matrix)}),sky:(b,t)=>({u_sky_color:new o.bP(b,t.u_sky_color),u_horizon_color:new o.bP(b,t.u_horizon_color),u_horizon:new o.bT(b,t.u_horizon),u_horizon_normal:new o.bT(b,t.u_horizon_normal),u_sky_horizon_blend:new o.bf(b,t.u_sky_horizon_blend),u_sky_blend:new o.bf(b,t.u_sky_blend)})};class $a{constructor(t,l,f){this.context=t;const g=t.gl;this.buffer=g.createBuffer(),this.dynamicDraw=!!f,this.context.unbindVAO(),t.bindElementBuffer.set(this.buffer),g.bufferData(g.ELEMENT_ARRAY_BUFFER,l.arrayBuffer,this.dynamicDraw?g.DYNAMIC_DRAW:g.STATIC_DRAW),this.dynamicDraw||delete l.arrayBuffer}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(t){const l=this.context.gl;if(!this.dynamicDraw)throw new Error("Attempted to update data while not in dynamic mode.");this.context.unbindVAO(),this.bind(),l.bufferSubData(l.ELEMENT_ARRAY_BUFFER,0,t.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}const tu={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class ot{constructor(t,l,f,g){this.length=l.length,this.attributes=f,this.itemSize=l.bytesPerElement,this.dynamicDraw=g,this.context=t;const w=t.gl;this.buffer=w.createBuffer(),t.bindVertexBuffer.set(this.buffer),w.bufferData(w.ARRAY_BUFFER,l.arrayBuffer,this.dynamicDraw?w.DYNAMIC_DRAW:w.STATIC_DRAW),this.dynamicDraw||delete l.arrayBuffer}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(t){if(t.length!==this.length)throw new Error(`Length of new data is ${t.length}, which doesn't match current length of ${this.length}`);const l=this.context.gl;this.bind(),l.bufferSubData(l.ARRAY_BUFFER,0,t.arrayBuffer)}enableAttributes(t,l){for(let f=0;f<this.attributes.length;f++){const g=l.attributes[this.attributes[f].name];g!==void 0&&t.enableVertexAttribArray(g)}}setVertexAttribPointers(t,l,f){for(let g=0;g<this.attributes.length;g++){const w=this.attributes[g],I=l.attributes[w.name];I!==void 0&&t.vertexAttribPointer(I,w.components,t[tu[w.type]],!1,this.itemSize,w.offset+this.itemSize*(f||0))}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}class ut{constructor(t){this.gl=t.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(t){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class Kt extends ut{getDefault(){return o.be.transparent}set(t){const l=this.current;(t.r!==l.r||t.g!==l.g||t.b!==l.b||t.a!==l.a||this.dirty)&&(this.gl.clearColor(t.r,t.g,t.b,t.a),this.current=t,this.dirty=!1)}}class bi extends ut{getDefault(){return 1}set(t){(t!==this.current||this.dirty)&&(this.gl.clearDepth(t),this.current=t,this.dirty=!1)}}class ir extends ut{getDefault(){return 0}set(t){(t!==this.current||this.dirty)&&(this.gl.clearStencil(t),this.current=t,this.dirty=!1)}}class Zi extends ut{getDefault(){return[!0,!0,!0,!0]}set(t){const l=this.current;(t[0]!==l[0]||t[1]!==l[1]||t[2]!==l[2]||t[3]!==l[3]||this.dirty)&&(this.gl.colorMask(t[0],t[1],t[2],t[3]),this.current=t,this.dirty=!1)}}class v extends ut{getDefault(){return!0}set(t){(t!==this.current||this.dirty)&&(this.gl.depthMask(t),this.current=t,this.dirty=!1)}}class c extends ut{getDefault(){return 255}set(t){(t!==this.current||this.dirty)&&(this.gl.stencilMask(t),this.current=t,this.dirty=!1)}}class d extends ut{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(t){const l=this.current;(t.func!==l.func||t.ref!==l.ref||t.mask!==l.mask||this.dirty)&&(this.gl.stencilFunc(t.func,t.ref,t.mask),this.current=t,this.dirty=!1)}}class _ extends ut{getDefault(){const t=this.gl;return[t.KEEP,t.KEEP,t.KEEP]}set(t){const l=this.current;(t[0]!==l[0]||t[1]!==l[1]||t[2]!==l[2]||this.dirty)&&(this.gl.stencilOp(t[0],t[1],t[2]),this.current=t,this.dirty=!1)}}class S extends ut{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const l=this.gl;t?l.enable(l.STENCIL_TEST):l.disable(l.STENCIL_TEST),this.current=t,this.dirty=!1}}class N extends ut{getDefault(){return[0,1]}set(t){const l=this.current;(t[0]!==l[0]||t[1]!==l[1]||this.dirty)&&(this.gl.depthRange(t[0],t[1]),this.current=t,this.dirty=!1)}}class U extends ut{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const l=this.gl;t?l.enable(l.DEPTH_TEST):l.disable(l.DEPTH_TEST),this.current=t,this.dirty=!1}}class J extends ut{getDefault(){return this.gl.LESS}set(t){(t!==this.current||this.dirty)&&(this.gl.depthFunc(t),this.current=t,this.dirty=!1)}}class ge extends ut{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const l=this.gl;t?l.enable(l.BLEND):l.disable(l.BLEND),this.current=t,this.dirty=!1}}class Ie extends ut{getDefault(){const t=this.gl;return[t.ONE,t.ZERO]}set(t){const l=this.current;(t[0]!==l[0]||t[1]!==l[1]||this.dirty)&&(this.gl.blendFunc(t[0],t[1]),this.current=t,this.dirty=!1)}}class st extends ut{getDefault(){return o.be.transparent}set(t){const l=this.current;(t.r!==l.r||t.g!==l.g||t.b!==l.b||t.a!==l.a||this.dirty)&&(this.gl.blendColor(t.r,t.g,t.b,t.a),this.current=t,this.dirty=!1)}}class ht extends ut{getDefault(){return this.gl.FUNC_ADD}set(t){(t!==this.current||this.dirty)&&(this.gl.blendEquation(t),this.current=t,this.dirty=!1)}}class Pt extends ut{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const l=this.gl;t?l.enable(l.CULL_FACE):l.disable(l.CULL_FACE),this.current=t,this.dirty=!1}}class Qt extends ut{getDefault(){return this.gl.BACK}set(t){(t!==this.current||this.dirty)&&(this.gl.cullFace(t),this.current=t,this.dirty=!1)}}class wi extends ut{getDefault(){return this.gl.CCW}set(t){(t!==this.current||this.dirty)&&(this.gl.frontFace(t),this.current=t,this.dirty=!1)}}class Ni extends ut{getDefault(){return null}set(t){(t!==this.current||this.dirty)&&(this.gl.useProgram(t),this.current=t,this.dirty=!1)}}class _i extends ut{getDefault(){return this.gl.TEXTURE0}set(t){(t!==this.current||this.dirty)&&(this.gl.activeTexture(t),this.current=t,this.dirty=!1)}}class yi extends ut{getDefault(){const t=this.gl;return[0,0,t.drawingBufferWidth,t.drawingBufferHeight]}set(t){const l=this.current;(t[0]!==l[0]||t[1]!==l[1]||t[2]!==l[2]||t[3]!==l[3]||this.dirty)&&(this.gl.viewport(t[0],t[1],t[2],t[3]),this.current=t,this.dirty=!1)}}class cr extends ut{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const l=this.gl;l.bindFramebuffer(l.FRAMEBUFFER,t),this.current=t,this.dirty=!1}}class hr extends ut{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const l=this.gl;l.bindRenderbuffer(l.RENDERBUFFER,t),this.current=t,this.dirty=!1}}class dn extends ut{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const l=this.gl;l.bindTexture(l.TEXTURE_2D,t),this.current=t,this.dirty=!1}}class pn extends ut{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const l=this.gl;l.bindBuffer(l.ARRAY_BUFFER,t),this.current=t,this.dirty=!1}}class Gn extends ut{getDefault(){return null}set(t){const l=this.gl;l.bindBuffer(l.ELEMENT_ARRAY_BUFFER,t),this.current=t,this.dirty=!1}}class Un extends ut{getDefault(){return null}set(t){var l;if(t===this.current&&!this.dirty)return;const f=this.gl;hn(f)?f.bindVertexArray(t):(l=f.getExtension("OES_vertex_array_object"))===null||l===void 0||l.bindVertexArrayOES(t),this.current=t,this.dirty=!1}}class no extends ut{getDefault(){return 4}set(t){if(t===this.current&&!this.dirty)return;const l=this.gl;l.pixelStorei(l.UNPACK_ALIGNMENT,t),this.current=t,this.dirty=!1}}class yo extends ut{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const l=this.gl;l.pixelStorei(l.UNPACK_PREMULTIPLY_ALPHA_WEBGL,t),this.current=t,this.dirty=!1}}class Ns extends ut{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const l=this.gl;l.pixelStorei(l.UNPACK_FLIP_Y_WEBGL,t),this.current=t,this.dirty=!1}}class cs extends ut{constructor(t,l){super(t),this.context=t,this.parent=l}getDefault(){return null}}class ja extends cs{setDirty(){this.dirty=!0}set(t){if(t===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const l=this.gl;l.framebufferTexture2D(l.FRAMEBUFFER,l.COLOR_ATTACHMENT0,l.TEXTURE_2D,t,0),this.current=t,this.dirty=!1}}class Os extends cs{set(t){if(t===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const l=this.gl;l.framebufferRenderbuffer(l.FRAMEBUFFER,l.DEPTH_ATTACHMENT,l.RENDERBUFFER,t),this.current=t,this.dirty=!1}}class qs extends cs{set(t){if(t===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const l=this.gl;l.framebufferRenderbuffer(l.FRAMEBUFFER,l.DEPTH_STENCIL_ATTACHMENT,l.RENDERBUFFER,t),this.current=t,this.dirty=!1}}const Ga="Framebuffer is not complete";class Ua{constructor(t,l,f,g,w){this.context=t,this.width=l,this.height=f;const I=t.gl,k=this.framebuffer=I.createFramebuffer();if(this.colorAttachment=new ja(t,k),g)this.depthAttachment=w?new qs(t,k):new Os(t,k);else if(w)throw new Error("Stencil cannot be set without depth");if(I.checkFramebufferStatus(I.FRAMEBUFFER)!==I.FRAMEBUFFER_COMPLETE)throw new Error(Ga)}destroy(){const t=this.context.gl,l=this.colorAttachment.get();if(l&&t.deleteTexture(l),this.depthAttachment){const f=this.depthAttachment.get();f&&t.deleteRenderbuffer(f)}t.deleteFramebuffer(this.framebuffer)}}class tr{constructor(t){var l,f;if(this.gl=t,this.clearColor=new Kt(this),this.clearDepth=new bi(this),this.clearStencil=new ir(this),this.colorMask=new Zi(this),this.depthMask=new v(this),this.stencilMask=new c(this),this.stencilFunc=new d(this),this.stencilOp=new _(this),this.stencilTest=new S(this),this.depthRange=new N(this),this.depthTest=new U(this),this.depthFunc=new J(this),this.blend=new ge(this),this.blendFunc=new Ie(this),this.blendColor=new st(this),this.blendEquation=new ht(this),this.cullFace=new Pt(this),this.cullFaceSide=new Qt(this),this.frontFace=new wi(this),this.program=new Ni(this),this.activeTexture=new _i(this),this.viewport=new yi(this),this.bindFramebuffer=new cr(this),this.bindRenderbuffer=new hr(this),this.bindTexture=new dn(this),this.bindVertexBuffer=new pn(this),this.bindElementBuffer=new Gn(this),this.bindVertexArray=new Un(this),this.pixelStoreUnpack=new no(this),this.pixelStoreUnpackPremultiplyAlpha=new yo(this),this.pixelStoreUnpackFlipY=new Ns(this),this.extTextureFilterAnisotropic=t.getExtension("EXT_texture_filter_anisotropic")||t.getExtension("MOZ_EXT_texture_filter_anisotropic")||t.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=t.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT)),this.maxTextureSize=t.getParameter(t.MAX_TEXTURE_SIZE),hn(t)){this.HALF_FLOAT=t.HALF_FLOAT;const g=t.getExtension("EXT_color_buffer_half_float");this.RGBA16F=(l=t.RGBA16F)!==null&&l!==void 0?l:g?.RGBA16F_EXT,this.RGB16F=(f=t.RGB16F)!==null&&f!==void 0?f:g?.RGB16F_EXT,t.getExtension("EXT_color_buffer_float")}else{t.getExtension("EXT_color_buffer_half_float"),t.getExtension("OES_texture_half_float_linear");const g=t.getExtension("OES_texture_half_float");this.HALF_FLOAT=g?.HALF_FLOAT_OES}}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.bindVertexArray.dirty=!0,this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(t,l){return new $a(this,t,l)}createVertexBuffer(t,l,f){return new ot(this,t,l,f)}createRenderbuffer(t,l,f){const g=this.gl,w=g.createRenderbuffer();return this.bindRenderbuffer.set(w),g.renderbufferStorage(g.RENDERBUFFER,t,l,f),this.bindRenderbuffer.set(null),w}createFramebuffer(t,l,f,g){return new Ua(this,t,l,f,g)}clear({color:t,depth:l,stencil:f}){const g=this.gl;let w=0;t&&(w|=g.COLOR_BUFFER_BIT,this.clearColor.set(t),this.colorMask.set([!0,!0,!0,!0])),l!==void 0&&(w|=g.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(l),this.depthMask.set(!0)),f!==void 0&&(w|=g.STENCIL_BUFFER_BIT,this.clearStencil.set(f),this.stencilMask.set(255)),g.clear(w)}setCullFace(t){t.enable===!1?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(t.mode),this.frontFace.set(t.frontFace))}setDepthMode(t){t.func!==this.gl.ALWAYS||t.mask?(this.depthTest.set(!0),this.depthFunc.set(t.func),this.depthMask.set(t.mask),this.depthRange.set(t.range)):this.depthTest.set(!1)}setStencilMode(t){t.test.func!==this.gl.ALWAYS||t.mask?(this.stencilTest.set(!0),this.stencilMask.set(t.mask),this.stencilOp.set([t.fail,t.depthFail,t.pass]),this.stencilFunc.set({func:t.test.func,ref:t.ref,mask:t.test.mask})):this.stencilTest.set(!1)}setColorMode(t){o.bG(t.blendFunction,ui.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(t.blendFunction),this.blendColor.set(t.blendColor)),this.colorMask.set(t.mask)}createVertexArray(){var t;return hn(this.gl)?this.gl.createVertexArray():(t=this.gl.getExtension("OES_vertex_array_object"))===null||t===void 0?void 0:t.createVertexArrayOES()}deleteVertexArray(t){var l;return hn(this.gl)?this.gl.deleteVertexArray(t):(l=this.gl.getExtension("OES_vertex_array_object"))===null||l===void 0?void 0:l.deleteVertexArrayOES(t)}unbindVAO(){this.bindVertexArray.set(null)}}let _o;function vl(b,t,l,f,g){const w=b.context,I=b.transform,k=w.gl,R=b.useProgram("collisionBox"),z=[];let G=0,X=0;for(let Ee=0;Ee<f.length;Ee++){const Ce=f[Ee],Fe=t.getTile(Ce).getBucket(l);if(!Fe)continue;const Oe=g?Fe.textCollisionBox:Fe.iconCollisionBox,Ue=Fe.collisionCircleArray;Ue.length>0&&(z.push({circleArray:Ue,circleOffset:X,coord:Ce}),G+=Ue.length/4,X=G),Oe&&R.draw(w,k.LINES,Ri.disabled,fi.disabled,b.colorModeForRenderPass(),Vi.disabled,ws(b.transform),b.style.map.terrain&&b.style.map.terrain.getTerrainData(Ce),I.getProjectionData({overscaledTileID:Ce,applyGlobeMatrix:!0,applyTerrainMatrix:!0}),l.id,Oe.layoutVertexBuffer,Oe.indexBuffer,Oe.segments,null,b.transform.zoom,null,null,Oe.collisionVertexBuffer)}if(!g||!z.length)return;const W=b.useProgram("collisionCircle"),te=new o.b_;te.resize(4*G),te._trim();let ae=0;for(const Ee of z)for(let Ce=0;Ce<Ee.circleArray.length/4;Ce++){const Fe=4*Ce,Oe=Ee.circleArray[Fe+0],Ue=Ee.circleArray[Fe+1],We=Ee.circleArray[Fe+2],De=Ee.circleArray[Fe+3];te.emplace(ae++,Oe,Ue,We,De,0),te.emplace(ae++,Oe,Ue,We,De,1),te.emplace(ae++,Oe,Ue,We,De,2),te.emplace(ae++,Oe,Ue,We,De,3)}(!_o||_o.length<2*G)&&(_o=function(Ee){const Ce=2*Ee,Fe=new o.c0;Fe.resize(Ce),Fe._trim();for(let Oe=0;Oe<Ce;Oe++){const Ue=6*Oe;Fe.uint16[Ue+0]=4*Oe+0,Fe.uint16[Ue+1]=4*Oe+1,Fe.uint16[Ue+2]=4*Oe+2,Fe.uint16[Ue+3]=4*Oe+2,Fe.uint16[Ue+4]=4*Oe+3,Fe.uint16[Ue+5]=4*Oe+0}return Fe}(G));const Te=w.createIndexBuffer(_o,!0),we=w.createVertexBuffer(te,o.b$.members,!0);for(const Ee of z){const Ce=va(b.transform);W.draw(w,k.TRIANGLES,Ri.disabled,fi.disabled,b.colorModeForRenderPass(),Vi.disabled,Ce,b.style.map.terrain&&b.style.map.terrain.getTerrainData(Ee.coord),null,l.id,we,Te,o.aL.simpleSegment(0,2*Ee.circleOffset,Ee.circleArray.length,Ee.circleArray.length/2),null,b.transform.zoom,null,null,null)}we.destroy(),Te.destroy()}const _p=o.af(new Float32Array(16));function zu(b,t,l,f,g,w){const{horizontalAlign:I,verticalAlign:k}=o.aG(b);return new o.P((-(I-.5)*t/g+f[0])*w,(-(k-.5)*l/g+f[1])*w)}function Hm(b,t,l,f,g,w){const I=t.tileAnchorPoint.add(new o.P(t.translation[0],t.translation[1]));if(t.pitchWithMap){let k=f.mult(w);l||(k=k.rotate(-g));const R=I.add(k);return Ui(R.x,R.y,t.pitchedLabelPlaneMatrix,t.getElevation).point}if(l){const k=Bt(t.tileAnchorPoint.x+1,t.tileAnchorPoint.y,t).point.sub(b),R=Math.atan(k.y/k.x)+(k.x<0?Math.PI:0);return b.add(f.rotate(R))}return b.add(f)}function Km(b,t,l,f,g,w,I,k,R,z,G,X){const W=b.text.placedSymbolArray,te=b.text.dynamicLayoutVertexArray,ae=b.icon.dynamicLayoutVertexArray,Te={};te.clear();for(let we=0;we<W.length;we++){const Ee=W.get(we),Ce=Ee.hidden||!Ee.crossTileID||b.allowVerticalPlacement&&!Ee.placedOrientation?null:f[Ee.crossTileID];if(Ce){const Fe=new o.P(Ee.anchorX,Ee.anchorY),Oe={getElevation:X,width:g.width,height:g.height,pitchedLabelPlaneMatrix:w,pitchWithMap:l,transform:g,tileAnchorPoint:Fe,translation:z,unwrappedTileID:G},Ue=l?it(Fe.x,Fe.y,Oe):Bt(Fe.x,Fe.y,Oe),We=Mi(g.cameraToCenterDistance,Ue.signedDistanceFromCamera);let De=o.ao(b.textSizeData,k,Ee)*We/o.aA;l&&(De*=b.tilePixelRatio/I);const{width:Qe,height:yt,anchor:ct,textOffset:dt,textBoxScale:_t}=Ce,qt=zu(ct,Qe,yt,dt,_t,De),Vt=g.getPitchedTextCorrection(Fe.x+z[0],Fe.y+z[1],G),kt=Hm(Ue.point,Oe,t,qt,-g.bearingInRadians,Vt),hi=b.allowVerticalPlacement&&Ee.placedOrientation===o.an.vertical?Math.PI/2:0;for(let Ji=0;Ji<Ee.numGlyphs;Ji++)o.au(te,kt,hi);R&&Ee.associatedIconIndex>=0&&(Te[Ee.associatedIconIndex]={shiftedAnchor:kt,angle:hi})}else Wr(Ee.numGlyphs,te)}if(R){ae.clear();const we=b.icon.placedSymbolArray;for(let Ee=0;Ee<we.length;Ee++){const Ce=we.get(Ee);if(Ce.hidden)Wr(Ce.numGlyphs,ae);else{const Fe=Te[Ee];if(Fe)for(let Oe=0;Oe<Ce.numGlyphs;Oe++)o.au(ae,Fe.shiftedAnchor,Fe.angle);else Wr(Ce.numGlyphs,ae)}}b.icon.dynamicLayoutVertexBuffer.updateData(ae)}b.text.dynamicLayoutVertexBuffer.updateData(te)}function vp(b,t,l){return l.iconsInText&&t?"symbolTextAndIcon":b?"symbolSDF":"symbolIcon"}function xp(b,t,l,f,g,w,I,k,R,z,G,X,W){const te=b.context,ae=te.gl,Te=b.transform,we=k==="map",Ee=R==="map",Ce=k!=="viewport"&&l.layout.get("symbol-placement")!=="point",Fe=we&&!Ee&&!Ce,Oe=!l.layout.get("symbol-sort-key").isConstant();let Ue=!1;const We=b.getDepthModeForSublayer(0,Ri.ReadOnly),De=l._unevaluatedLayout.hasValue("text-variable-anchor")||l._unevaluatedLayout.hasValue("text-variable-anchor-offset"),Qe=[],yt=Te.getCircleRadiusCorrection();for(const ct of f){const dt=t.getTile(ct),_t=dt.getBucket(l);if(!_t)continue;const qt=g?_t.text:_t.icon;if(!qt||!qt.segments.get().length||!qt.hasVisibleVertices)continue;const Vt=qt.programConfigurations.get(l.id),kt=g||_t.sdfIcons,hi=g?_t.textSizeData:_t.iconSizeData,Ji=Ee||Te.pitch!==0,Pr=b.useProgram(vp(kt,g,_t),Vt),on=o.am(hi,Te.zoom),zr=b.style.map.terrain&&b.style.map.terrain.getTerrainData(ct);let an,Gr,Br,Ur,ds=[0,0],xr=null;if(g)Gr=dt.glyphAtlasTexture,Br=ae.LINEAR,an=dt.glyphAtlasTexture.size,_t.iconsInText&&(ds=dt.imageAtlasTexture.size,xr=dt.imageAtlasTexture,Ur=Ji||b.options.rotating||b.options.zooming||hi.kind==="composite"||hi.kind==="camera"?ae.LINEAR:ae.NEAREST);else{const wn=l.layout.get("icon-size").constantOr(0)!==1||_t.iconsNeedLinear;Gr=dt.imageAtlasTexture,Br=kt||b.options.rotating||b.options.zooming||wn||Ji?ae.LINEAR:ae.NEAREST,an=dt.imageAtlasTexture.size}const Jn=o.aB(dt,1,b.transform.zoom),Ts=Ci(we,b.transform,Jn),Xa=o.L();o.ap(Xa,Ts);const Ha=br(Ee,we,b.transform,Jn),Ka=o.aC(Te,dt,w,I),la=Te.getProjectionData({overscaledTileID:ct,applyGlobeMatrix:!W,applyTerrainMatrix:!0}),Ju=De&&_t.hasTextData(),Qu=l.layout.get("icon-text-fit")!=="none"&&Ju&&_t.hasIconData();if(Ce){const wn=b.style.map.terrain?(zs,Vn)=>b.style.map.terrain.getElevation(ct,zs,Vn):null,Xr=l.layout.get("text-rotation-alignment")==="map";Lr(_t,b,g,Ts,Xa,Ee,z,Xr,ct.toUnwrapped(),Te.width,Te.height,Ka,wn)}const pu=g&&De||Qu,Ws=Ce||pu?_p:Ee?Ts:b.transform.clipSpaceToPixelsMatrix,Fo=kt&&l.paint.get(g?"text-halo-width":"icon-halo-width").constantOr(1)!==0;let Ja;Ja=kt?_t.iconsInText?yl(hi.kind,on,Fe,Ee,Ce,pu,b,Ws,Ha,Ka,an,ds,yt):Vs(hi.kind,on,Fe,Ee,Ce,pu,b,Ws,Ha,Ka,g,an,0,yt):za(hi.kind,on,Fe,Ee,Ce,pu,b,Ws,Ha,Ka,g,an,yt);const wl={program:Pr,buffers:qt,uniformValues:Ja,projectionData:la,atlasTexture:Gr,atlasTextureIcon:xr,atlasInterpolation:Br,atlasInterpolationIcon:Ur,isSDF:kt,hasHalo:Fo};if(Oe&&_t.canOverlap){Ue=!0;const wn=qt.segments.get();for(const Xr of wn)Qe.push({segments:new o.aL([Xr]),sortKey:Xr.sortKey,state:wl,terrainData:zr})}else Qe.push({segments:qt.segments,sortKey:0,state:wl,terrainData:zr})}Ue&&Qe.sort((ct,dt)=>ct.sortKey-dt.sortKey);for(const ct of Qe){const dt=ct.state;if(te.activeTexture.set(ae.TEXTURE0),dt.atlasTexture.bind(dt.atlasInterpolation,ae.CLAMP_TO_EDGE),dt.atlasTextureIcon&&(te.activeTexture.set(ae.TEXTURE1),dt.atlasTextureIcon&&dt.atlasTextureIcon.bind(dt.atlasInterpolationIcon,ae.CLAMP_TO_EDGE)),dt.isSDF){const _t=dt.uniformValues;dt.hasHalo&&(_t.u_is_halo=1,wc(dt.buffers,ct.segments,l,b,dt.program,We,G,X,_t,dt.projectionData,ct.terrainData)),_t.u_is_halo=0}wc(dt.buffers,ct.segments,l,b,dt.program,We,G,X,dt.uniformValues,dt.projectionData,ct.terrainData)}}function wc(b,t,l,f,g,w,I,k,R,z,G){const X=f.context;g.draw(X,X.gl.TRIANGLES,w,I,k,Vi.backCCW,R,G,z,l.id,b.layoutVertexBuffer,b.indexBuffer,t,l.paint,f.transform.zoom,b.programConfigurations.get(l.id),b.dynamicLayoutVertexBuffer,b.opacityVertexBuffer)}function Tc(b,t,l,f,g){const w=b.context,I=w.gl,k=fi.disabled,R=new ui([I.ONE,I.ONE],o.be.transparent,[!0,!0,!0,!0]),z=t.getBucket(l);if(!z)return;const G=f.key;let X=l.heatmapFbos.get(G);X||(X=Bu(w,t.tileSize,t.tileSize),l.heatmapFbos.set(G,X)),w.bindFramebuffer.set(X.framebuffer),w.viewport.set([0,0,t.tileSize,t.tileSize]),w.clear({color:o.be.transparent});const W=z.programConfigurations.get(l.id),te=b.useProgram("heatmap",W,!g),ae=b.transform.getProjectionData({overscaledTileID:t.tileID,applyGlobeMatrix:!0,applyTerrainMatrix:!0}),Te=b.style.map.terrain.getTerrainData(f);te.draw(w,I.TRIANGLES,Ri.disabled,k,R,Vi.disabled,ro(t,b.transform.zoom,l.paint.get("heatmap-intensity"),1),Te,ae,l.id,z.layoutVertexBuffer,z.indexBuffer,z.segments,l.paint,b.transform.zoom,W)}function Ec(b,t,l,f,g){const w=b.context,I=w.gl,k=b.transform;w.setColorMode(b.colorModeForRenderPass());const R=Ic(w,t),z=l.key,G=t.heatmapFbos.get(z);if(!G)return;w.activeTexture.set(I.TEXTURE0),I.bindTexture(I.TEXTURE_2D,G.colorAttachment.get()),w.activeTexture.set(I.TEXTURE1),R.bind(I.LINEAR,I.CLAMP_TO_EDGE);const X=k.getProjectionData({overscaledTileID:l,applyTerrainMatrix:g,applyGlobeMatrix:!f});b.useProgram("heatmapTexture").draw(w,I.TRIANGLES,Ri.disabled,fi.disabled,b.colorModeForRenderPass(),Vi.disabled,fl(b,t,0,1),null,X,t.id,b.rasterBoundsBuffer,b.quadTriangleIndexBuffer,b.rasterBoundsSegments,t.paint,k.zoom),G.destroy(),t.heatmapFbos.delete(z)}function Bu(b,t,l){var f,g;const w=b.gl,I=w.createTexture();w.bindTexture(w.TEXTURE_2D,I),w.texParameteri(w.TEXTURE_2D,w.TEXTURE_WRAP_S,w.CLAMP_TO_EDGE),w.texParameteri(w.TEXTURE_2D,w.TEXTURE_WRAP_T,w.CLAMP_TO_EDGE),w.texParameteri(w.TEXTURE_2D,w.TEXTURE_MIN_FILTER,w.LINEAR),w.texParameteri(w.TEXTURE_2D,w.TEXTURE_MAG_FILTER,w.LINEAR);const k=(f=b.HALF_FLOAT)!==null&&f!==void 0?f:w.UNSIGNED_BYTE,R=(g=b.RGBA16F)!==null&&g!==void 0?g:w.RGBA;w.texImage2D(w.TEXTURE_2D,0,R,t,l,0,w.RGBA,k,null);const z=b.createFramebuffer(t,l,!1,!1);return z.colorAttachment.set(I),z}function Ic(b,t){return t.colorRampTexture||(t.colorRampTexture=new o.T(b,t.colorRamp,b.gl.RGBA)),t.colorRampTexture}function kh(b,t,l,f,g){if(!l||!f||!f.imageAtlas)return;const w=f.imageAtlas.patternPositions;let I=w[l.to.toString()],k=w[l.from.toString()];if(!I&&k&&(I=k),!k&&I&&(k=I),!I||!k){const R=g.getPaintProperty(t);I=w[R],k=w[R]}I&&k&&b.setConstantPatternPositions(I,k)}function $u(b,t,l,f,g,w,I,k){const R=b.context.gl,z="fill-pattern",G=l.paint.get(z),X=G&&G.constantOr(1),W=l.getCrossfadeParameters();let te,ae,Te,we,Ee;const Ce=b.transform,Fe=l.paint.get("fill-translate"),Oe=l.paint.get("fill-translate-anchor");I?(ae=X&&!l.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",te=R.LINES):(ae=X?"fillPattern":"fill",te=R.TRIANGLES);const Ue=G.constantOr(null);for(const We of f){const De=t.getTile(We);if(X&&!De.patternsLoaded())continue;const Qe=De.getBucket(l);if(!Qe)continue;const yt=Qe.programConfigurations.get(l.id),ct=b.useProgram(ae,yt),dt=b.style.map.terrain&&b.style.map.terrain.getTerrainData(We);X&&(b.context.activeTexture.set(R.TEXTURE0),De.imageAtlasTexture.bind(R.LINEAR,R.CLAMP_TO_EDGE),yt.updatePaintBuffers(W)),kh(yt,z,Ue,De,l);const _t=Ce.getProjectionData({overscaledTileID:We,applyGlobeMatrix:!k,applyTerrainMatrix:!0}),qt=o.aC(Ce,De,Fe,Oe);if(I){we=Qe.indexBuffer2,Ee=Qe.segments2;const kt=[R.drawingBufferWidth,R.drawingBufferHeight];Te=ae==="fillOutlinePattern"&&X?Ao(b,W,De,kt,qt):nn(kt,qt)}else we=Qe.indexBuffer,Ee=Qe.segments,Te=X?Rs(b,W,De,qt):{u_fill_translate:qt};const Vt=b.stencilModeForClipping(We);ct.draw(b.context,te,g,Vt,w,Vi.backCCW,Te,dt,_t,l.id,Qe.layoutVertexBuffer,we,Ee,l.paint,b.transform.zoom,yt)}}function iu(b,t,l,f,g,w,I,k){const R=b.context,z=R.gl,G="fill-extrusion-pattern",X=l.paint.get(G),W=X.constantOr(1),te=l.getCrossfadeParameters(),ae=l.paint.get("fill-extrusion-opacity"),Te=X.constantOr(null),we=b.transform;for(const Ee of f){const Ce=t.getTile(Ee),Fe=Ce.getBucket(l);if(!Fe)continue;const Oe=b.style.map.terrain&&b.style.map.terrain.getTerrainData(Ee),Ue=Fe.programConfigurations.get(l.id),We=b.useProgram(W?"fillExtrusionPattern":"fillExtrusion",Ue);W&&(b.context.activeTexture.set(z.TEXTURE0),Ce.imageAtlasTexture.bind(z.LINEAR,z.CLAMP_TO_EDGE),Ue.updatePaintBuffers(te));const De=we.getProjectionData({overscaledTileID:Ee,applyGlobeMatrix:!k,applyTerrainMatrix:!0});kh(Ue,G,Te,Ce,l);const Qe=o.aC(we,Ce,l.paint.get("fill-extrusion-translate"),l.paint.get("fill-extrusion-translate-anchor")),yt=l.paint.get("fill-extrusion-vertical-gradient"),ct=W?ia(b,yt,ae,Qe,Ee,te,Ce):Co(b,yt,ae,Qe);We.draw(R,R.gl.TRIANGLES,g,w,I,Vi.backCCW,ct,Oe,De,l.id,Fe.layoutVertexBuffer,Fe.indexBuffer,Fe.segments,l.paint,b.transform.zoom,Ue,b.style.map.terrain&&Fe.centroidVertexBuffer)}}function ru(b,t,l,f,g,w,I,k,R){var z;const G=b.style.projection,X=b.context,W=b.transform,te=X.gl,ae=[`#define NUM_ILLUMINATION_SOURCES ${l.paint.get("hillshade-highlight-color").values.length}`],Te=b.useProgram("hillshade",null,!1,ae),we=!b.options.moving;for(const Ee of f){const Ce=t.getTile(Ee),Fe=Ce.fbo;if(!Fe)continue;const Oe=G.getMeshFromTileID(X,Ee.canonical,k,!0,"raster"),Ue=(z=b.style.map.terrain)===null||z===void 0?void 0:z.getTerrainData(Ee);X.activeTexture.set(te.TEXTURE0),te.bindTexture(te.TEXTURE_2D,Fe.colorAttachment.get());const We=W.getProjectionData({overscaledTileID:Ee,aligned:we,applyGlobeMatrix:!R,applyTerrainMatrix:!0});Te.draw(X,te.TRIANGLES,w,g[Ee.overscaledZ],I,Vi.backCCW,Lo(b,Ce,l),Ue,We,l.id,Oe.vertexBuffer,Oe.indexBuffer,Oe.segments)}}function ju(b,t,l,f,g,w,I,k,R){var z;const G=b.style.projection,X=b.context,W=b.transform,te=X.gl,ae=b.useProgram("colorRelief"),Te=!b.options.moving;let we=!0,Ee=0;for(const Ce of f){const Fe=t.getTile(Ce),Oe=Fe.dem;if(we){const ct=te.getParameter(te.MAX_TEXTURE_SIZE),{elevationTexture:dt,colorTexture:_t}=l.getColorRampTextures(X,ct,Oe.getUnpackVector());X.activeTexture.set(te.TEXTURE1),dt.bind(te.NEAREST,te.CLAMP_TO_EDGE),X.activeTexture.set(te.TEXTURE4),_t.bind(te.LINEAR,te.CLAMP_TO_EDGE),we=!1,Ee=dt.size[0]}if(!Oe||!Oe.data)continue;const Ue=Oe.stride,We=Oe.getPixels();if(X.activeTexture.set(te.TEXTURE0),X.pixelStoreUnpackPremultiplyAlpha.set(!1),Fe.demTexture=Fe.demTexture||b.getTileTexture(Ue),Fe.demTexture){const ct=Fe.demTexture;ct.update(We,{premultiply:!1}),ct.bind(te.LINEAR,te.CLAMP_TO_EDGE)}else Fe.demTexture=new o.T(X,We,te.RGBA,{premultiply:!1}),Fe.demTexture.bind(te.LINEAR,te.CLAMP_TO_EDGE);const De=G.getMeshFromTileID(X,Ce.canonical,k,!0,"raster"),Qe=(z=b.style.map.terrain)===null||z===void 0?void 0:z.getTerrainData(Ce),yt=W.getProjectionData({overscaledTileID:Ce,aligned:Te,applyGlobeMatrix:!R,applyTerrainMatrix:!0});ae.draw(X,te.TRIANGLES,w,g[Ce.overscaledZ],I,Vi.backCCW,ml(l,Fe.dem,Ee),Qe,yt,l.id,De.vertexBuffer,De.indexBuffer,De.segments)}}const Ch=[new o.P(0,0),new o.P(o.$,0),new o.P(o.$,o.$),new o.P(0,o.$)];function Va(b,t,l,f,g,w,I,k,R=!1,z=!1){const G=f[f.length-1].overscaledZ,X=b.context,W=X.gl,te=b.useProgram("raster"),ae=b.transform,Te=b.style.projection,we=b.colorModeForRenderPass(),Ee=!b.options.moving;for(const Ce of f){const Fe=b.getDepthModeForSublayer(Ce.overscaledZ-G,l.paint.get("raster-opacity")===1?Ri.ReadWrite:Ri.ReadOnly,W.LESS),Oe=t.getTile(Ce);Oe.registerFadeDuration(l.paint.get("raster-fade-duration"));const Ue=t.findLoadedParent(Ce,0),We=t.findLoadedSibling(Ce),De=Jm(Oe,Ue||We||null,t,l,b.transform,b.style.map.terrain);let Qe,yt;const ct=l.paint.get("raster-resampling")==="nearest"?W.NEAREST:W.LINEAR;X.activeTexture.set(W.TEXTURE0),Oe.texture.bind(ct,W.CLAMP_TO_EDGE,W.LINEAR_MIPMAP_NEAREST),X.activeTexture.set(W.TEXTURE1),Ue?(Ue.texture.bind(ct,W.CLAMP_TO_EDGE,W.LINEAR_MIPMAP_NEAREST),Qe=Math.pow(2,Ue.tileID.overscaledZ-Oe.tileID.overscaledZ),yt=[Oe.tileID.canonical.x*Qe%1,Oe.tileID.canonical.y*Qe%1]):Oe.texture.bind(ct,W.CLAMP_TO_EDGE,W.LINEAR_MIPMAP_NEAREST),Oe.texture.useMipmap&&X.extTextureFilterAnisotropic&&b.transform.pitch>20&&W.texParameterf(W.TEXTURE_2D,X.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,X.extTextureFilterAnisotropicMax);const dt=b.style.map.terrain&&b.style.map.terrain.getTerrainData(Ce),_t=ae.getProjectionData({overscaledTileID:Ce,aligned:Ee,applyGlobeMatrix:!z,applyTerrainMatrix:!0}),qt=us(yt||[0,0],Qe||1,De,l,k),Vt=Te.getMeshFromTileID(X,Ce.canonical,w,I,"raster");te.draw(X,W.TRIANGLES,Fe,g?g[Ce.overscaledZ]:fi.disabled,we,R?Vi.frontCCW:Vi.backCCW,qt,dt,_t,l.id,Vt.vertexBuffer,Vt.indexBuffer,Vt.segments)}}function Jm(b,t,l,f,g,w){const I=f.paint.get("raster-fade-duration");if(!w&&I>0){const k=Y.now(),R=(k-b.timeAdded)/I,z=t?(k-t.timeAdded)/I:-1,G=l.getSource(),X=gt(g,{tileSize:G.tileSize,roundZoom:G.roundZoom}),W=!t||Math.abs(t.tileID.overscaledZ-X)>Math.abs(b.tileID.overscaledZ-X),te=W&&b.refreshedUponExpiration?1:o.ag(W?R:1-z,0,1);return b.refreshedUponExpiration&&R>=1&&(b.refreshedUponExpiration=!1),t?{opacity:1,mix:1-te}:{opacity:te,mix:0}}return{opacity:1,mix:0}}const bp=new o.be(1,0,0,1),Sc=new o.be(0,1,0,1),Ah=new o.be(0,0,1,1),wp=new o.be(1,0,1,1),Tp=new o.be(0,1,1,1);function Gu(b,t,l,f){Pc(b,0,t+l/2,b.transform.width,l,f)}function Mc(b,t,l,f){Pc(b,t-l/2,0,l,b.transform.height,f)}function Pc(b,t,l,f,g,w){const I=b.context,k=I.gl;k.enable(k.SCISSOR_TEST),k.scissor(t*b.pixelRatio,l*b.pixelRatio,f*b.pixelRatio,g*b.pixelRatio),I.clear({color:w}),k.disable(k.SCISSOR_TEST)}function Ep(b,t,l){const f=b.context,g=f.gl,w=b.useProgram("debug"),I=Ri.disabled,k=fi.disabled,R=b.colorModeForRenderPass(),z="$debug",G=b.style.map.terrain&&b.style.map.terrain.getTerrainData(l);f.activeTexture.set(g.TEXTURE0);const X=t.getTileByID(l.key).latestRawTileData,W=Math.floor((X&&X.byteLength||0)/1024),te=t.getTile(l).tileSize,ae=512/Math.min(te,512)*(l.overscaledZ/b.transform.zoom)*.5;let Te=l.canonical.toString();l.overscaledZ!==l.canonical.z&&(Te+=` => ${l.overscaledZ}`),function(Ee,Ce){Ee.initDebugOverlayCanvas();const Fe=Ee.debugOverlayCanvas,Oe=Ee.context.gl,Ue=Ee.debugOverlayCanvas.getContext("2d");Ue.clearRect(0,0,Fe.width,Fe.height),Ue.shadowColor="white",Ue.shadowBlur=2,Ue.lineWidth=1.5,Ue.strokeStyle="white",Ue.textBaseline="top",Ue.font="bold 36px Open Sans, sans-serif",Ue.fillText(Ce,5,5),Ue.strokeText(Ce,5,5),Ee.debugOverlayTexture.update(Fe),Ee.debugOverlayTexture.bind(Oe.LINEAR,Oe.CLAMP_TO_EDGE)}(b,`${Te} ${W}kB`);const we=b.transform.getProjectionData({overscaledTileID:l,applyGlobeMatrix:!0,applyTerrainMatrix:!0});w.draw(f,g.TRIANGLES,I,k,ui.alphaBlended,Vi.disabled,xa(o.be.transparent,ae),null,we,z,b.debugBuffer,b.quadTriangleIndexBuffer,b.debugSegments),w.draw(f,g.LINE_STRIP,I,k,R,Vi.disabled,xa(o.be.red),G,we,z,b.debugBuffer,b.tileBorderIndexBuffer,b.debugSegments)}function fn(b,t,l,f){const{isRenderingGlobe:g}=f,w=b.context,I=w.gl,k=b.transform,R=b.colorModeForRenderPass(),z=b.getDepthModeFor3D(),G=b.useProgram("terrain");w.bindFramebuffer.set(null),w.viewport.set([0,0,b.width,b.height]);for(const X of l){const W=t.getTerrainMesh(X.tileID),te=b.renderToTexture.getTexture(X),ae=t.getTerrainData(X.tileID);w.activeTexture.set(I.TEXTURE0),I.bindTexture(I.TEXTURE_2D,te.texture);const Te=t.getMeshFrameDelta(k.zoom),we=k.calculateFogMatrix(X.tileID.toUnwrapped()),Ee=Ls(Te,we,b.style.sky,k.pitch,g),Ce=k.getProjectionData({overscaledTileID:X.tileID,applyTerrainMatrix:!1,applyGlobeMatrix:!0});G.draw(w,I.TRIANGLES,z,fi.disabled,R,Vi.backCCW,Ee,ae,Ce,"terrain",W.vertexBuffer,W.indexBuffer,W.segments)}}function qa(b,t){if(!t.mesh){const l=new o.aK;l.emplaceBack(-1,-1),l.emplaceBack(1,-1),l.emplaceBack(1,1),l.emplaceBack(-1,1);const f=new o.aM;f.emplaceBack(0,1,2),f.emplaceBack(0,2,3),t.mesh=new rt(b.createVertexBuffer(l,Ct.members),b.createIndexBuffer(f),o.aL.simpleSegment(0,0,l.length,f.length))}return t.mesh}class vo{constructor(t,l){this.context=new tr(t),this.transform=l,this._tileTextures={},this.terrainFacilitator={dirty:!0,matrix:o.af(new Float64Array(16)),renderTime:0},this.setup(),this.numSublayers=Tt.maxUnderzooming+Tt.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.crossTileSymbolIndex=new de}resize(t,l,f){if(this.width=Math.floor(t*f),this.height=Math.floor(l*f),this.pixelRatio=f,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(const g of this.style._order)this.style._layers[g].resize()}setup(){const t=this.context,l=new o.aK;l.emplaceBack(0,0),l.emplaceBack(o.$,0),l.emplaceBack(0,o.$),l.emplaceBack(o.$,o.$),this.tileExtentBuffer=t.createVertexBuffer(l,Ct.members),this.tileExtentSegments=o.aL.simpleSegment(0,0,4,2);const f=new o.aK;f.emplaceBack(0,0),f.emplaceBack(o.$,0),f.emplaceBack(0,o.$),f.emplaceBack(o.$,o.$),this.debugBuffer=t.createVertexBuffer(f,Ct.members),this.debugSegments=o.aL.simpleSegment(0,0,4,5);const g=new o.c5;g.emplaceBack(0,0,0,0),g.emplaceBack(o.$,0,o.$,0),g.emplaceBack(0,o.$,0,o.$),g.emplaceBack(o.$,o.$,o.$,o.$),this.rasterBoundsBuffer=t.createVertexBuffer(g,_a.members),this.rasterBoundsSegments=o.aL.simpleSegment(0,0,4,2);const w=new o.aK;w.emplaceBack(0,0),w.emplaceBack(o.$,0),w.emplaceBack(0,o.$),w.emplaceBack(o.$,o.$),this.rasterBoundsBufferPosOnly=t.createVertexBuffer(w,Ct.members),this.rasterBoundsSegmentsPosOnly=o.aL.simpleSegment(0,0,4,5);const I=new o.aK;I.emplaceBack(0,0),I.emplaceBack(1,0),I.emplaceBack(0,1),I.emplaceBack(1,1),this.viewportBuffer=t.createVertexBuffer(I,Ct.members),this.viewportSegments=o.aL.simpleSegment(0,0,4,2);const k=new o.c6;k.emplaceBack(0),k.emplaceBack(1),k.emplaceBack(3),k.emplaceBack(2),k.emplaceBack(0),this.tileBorderIndexBuffer=t.createIndexBuffer(k);const R=new o.aM;R.emplaceBack(1,0,2),R.emplaceBack(1,2,3),this.quadTriangleIndexBuffer=t.createIndexBuffer(R);const z=this.context.gl;this.stencilClearMode=new fi({func:z.ALWAYS,mask:0},0,255,z.ZERO,z.ZERO,z.ZERO),this.tileExtentMesh=new rt(this.tileExtentBuffer,this.quadTriangleIndexBuffer,this.tileExtentSegments)}clearStencil(){const t=this.context,l=t.gl;this.nextStencilID=1,this.currentStencilSource=void 0;const f=o.L();o.bX(f,0,this.width,this.height,0,0,1),o.N(f,f,[l.drawingBufferWidth,l.drawingBufferHeight,0]);const g={mainMatrix:f,tileMercatorCoords:[0,0,1,1],clippingPlane:[0,0,0,0],projectionTransition:0,fallbackMatrix:f};this.useProgram("clippingMask",null,!0).draw(t,l.TRIANGLES,Ri.disabled,this.stencilClearMode,ui.disabled,Vi.disabled,null,null,g,"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}_renderTileClippingMasks(t,l,f){if(this.currentStencilSource===t.source||!t.isTileClipped()||!l||!l.length)return;this.currentStencilSource=t.source,this.nextStencilID+l.length>256&&this.clearStencil();const g=this.context;g.setColorMode(ui.disabled),g.setDepthMode(Ri.disabled);const w={};for(const I of l)w[I.key]=this.nextStencilID++;this._renderTileMasks(w,l,f,!0),this._renderTileMasks(w,l,f,!1),this._tileClippingMaskIDs=w}_renderTileMasks(t,l,f,g){const w=this.context,I=w.gl,k=this.style.projection,R=this.transform,z=this.useProgram("clippingMask");for(const G of l){const X=t[G.key],W=this.style.map.terrain&&this.style.map.terrain.getTerrainData(G),te=k.getMeshFromTileID(this.context,G.canonical,g,!0,"stencil"),ae=R.getProjectionData({overscaledTileID:G,applyGlobeMatrix:!f,applyTerrainMatrix:!0});z.draw(w,I.TRIANGLES,Ri.disabled,new fi({func:I.ALWAYS,mask:0},X,255,I.KEEP,I.KEEP,I.REPLACE),ui.disabled,f?Vi.disabled:Vi.backCCW,null,W,ae,"$clipping",te.vertexBuffer,te.indexBuffer,te.segments)}}_renderTilesDepthBuffer(){const t=this.context,l=t.gl,f=this.style.projection,g=this.transform,w=this.useProgram("depth"),I=this.getDepthModeFor3D(),k=ft(g,{tileSize:g.tileSize});for(const R of k){const z=this.style.map.terrain&&this.style.map.terrain.getTerrainData(R),G=f.getMeshFromTileID(this.context,R.canonical,!0,!0,"raster"),X=g.getProjectionData({overscaledTileID:R,applyGlobeMatrix:!0,applyTerrainMatrix:!0});w.draw(t,l.TRIANGLES,I,fi.disabled,ui.disabled,Vi.backCCW,null,z,X,"$clipping",G.vertexBuffer,G.indexBuffer,G.segments)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();const t=this.nextStencilID++,l=this.context.gl;return new fi({func:l.NOTEQUAL,mask:255},t,255,l.KEEP,l.KEEP,l.REPLACE)}stencilModeForClipping(t){const l=this.context.gl;return new fi({func:l.EQUAL,mask:255},this._tileClippingMaskIDs[t.key],0,l.KEEP,l.KEEP,l.REPLACE)}getStencilConfigForOverlapAndUpdateStencilID(t){const l=this.context.gl,f=t.sort((I,k)=>k.overscaledZ-I.overscaledZ),g=f[f.length-1].overscaledZ,w=f[0].overscaledZ-g+1;if(w>1){this.currentStencilSource=void 0,this.nextStencilID+w>256&&this.clearStencil();const I={};for(let k=0;k<w;k++)I[k+g]=new fi({func:l.GEQUAL,mask:255},k+this.nextStencilID,255,l.KEEP,l.KEEP,l.REPLACE);return this.nextStencilID+=w,[I,f]}return[{[g]:fi.disabled},f]}stencilConfigForOverlapTwoPass(t){const l=this.context.gl,f=t.sort((I,k)=>k.overscaledZ-I.overscaledZ),g=f[f.length-1].overscaledZ,w=f[0].overscaledZ-g+1;if(this.clearStencil(),w>1){const I={},k={};for(let R=0;R<w;R++)I[R+g]=new fi({func:l.GREATER,mask:255},w+1+R,255,l.KEEP,l.KEEP,l.REPLACE),k[R+g]=new fi({func:l.GREATER,mask:255},1+R,255,l.KEEP,l.KEEP,l.REPLACE);return this.nextStencilID=2*w+1,[I,k,f]}return this.nextStencilID=3,[{[g]:new fi({func:l.GREATER,mask:255},2,255,l.KEEP,l.KEEP,l.REPLACE)},{[g]:new fi({func:l.GREATER,mask:255},1,255,l.KEEP,l.KEEP,l.REPLACE)},f]}colorModeForRenderPass(){const t=this.context.gl;return this._showOverdrawInspector?new ui([t.CONSTANT_COLOR,t.ONE],new o.be(.125,.125,.125,0),[!0,!0,!0,!0]):this.renderPass==="opaque"?ui.unblended:ui.alphaBlended}getDepthModeForSublayer(t,l,f){if(!this.opaquePassEnabledForLayer())return Ri.disabled;const g=1-((1+this.currentLayer)*this.numSublayers+t)*this.depthEpsilon;return new Ri(f||this.context.gl.LEQUAL,l,[g,g])}getDepthModeFor3D(){return new Ri(this.context.gl.LEQUAL,Ri.ReadWrite,this.depthRangeFor3D)}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}render(t,l){var f,g;this.style=t,this.options=l,this.lineAtlas=t.lineAtlas,this.imageManager=t.imageManager,this.glyphManager=t.glyphManager,this.symbolFadeChange=t.placement.symbolFadeChange(Y.now()),this.imageManager.beginFrame();const w=this.style._order,I=this.style.sourceCaches,k={},R={},z={},G={isRenderingToTexture:!1,isRenderingGlobe:((f=t.projection)===null||f===void 0?void 0:f.transitionState)>0};for(const W in I){const te=I[W];te.used&&te.prepare(this.context),k[W]=te.getVisibleCoordinates(!1),R[W]=k[W].slice().reverse(),z[W]=te.getVisibleCoordinates(!0).reverse()}this.opaquePassCutoff=1/0;for(let W=0;W<w.length;W++)if(this.style._layers[w[W]].is3D()){this.opaquePassCutoff=W;break}this.maybeDrawDepthAndCoords(!1),this.renderToTexture&&(this.renderToTexture.prepareForRender(this.style,this.transform.zoom),this.opaquePassCutoff=0),this.renderPass="offscreen";for(const W of w){const te=this.style._layers[W];if(!te.hasOffscreenPass()||te.isHidden(this.transform.zoom))continue;const ae=R[te.source];(te.type==="custom"||ae.length)&&this.renderLayer(this,I[te.source],te,ae,G)}if((g=this.style.projection)===null||g===void 0||g.updateGPUdependent({context:this.context,useProgram:W=>this.useProgram(W)}),this.context.viewport.set([0,0,this.width,this.height]),this.context.bindFramebuffer.set(null),this.context.clear({color:l.showOverdrawInspector?o.be.black:o.be.transparent,depth:1}),this.clearStencil(),this.style.sky&&function(W,te){const ae=W.context,Te=ae.gl,we=((We,De,Qe)=>{const yt=Math.cos(De.rollInRadians),ct=Math.sin(De.rollInRadians),dt=pe(De),_t=De.getProjectionData({overscaledTileID:null,applyGlobeMatrix:!0,applyTerrainMatrix:!0}).projectionTransition;return{u_sky_color:We.properties.get("sky-color"),u_horizon_color:We.properties.get("horizon-color"),u_horizon:[(De.width/2-dt*ct)*Qe,(De.height/2+dt*yt)*Qe],u_horizon_normal:[-ct,yt],u_sky_horizon_blend:We.properties.get("sky-horizon-blend")*De.height/2*Qe,u_sky_blend:_t}})(te,W.style.map.transform,W.pixelRatio),Ee=new Ri(Te.LEQUAL,Ri.ReadWrite,[0,1]),Ce=fi.disabled,Fe=W.colorModeForRenderPass(),Oe=W.useProgram("sky"),Ue=qa(ae,te);Oe.draw(ae,Te.TRIANGLES,Ee,Ce,Fe,Vi.disabled,we,null,void 0,"sky",Ue.vertexBuffer,Ue.indexBuffer,Ue.segments)}(this,this.style.sky),this._showOverdrawInspector=l.showOverdrawInspector,this.depthRangeFor3D=[0,1-(t._order.length+2)*this.numSublayers*this.depthEpsilon],!this.renderToTexture)for(this.renderPass="opaque",this.currentLayer=w.length-1;this.currentLayer>=0;this.currentLayer--){const W=this.style._layers[w[this.currentLayer]],te=I[W.source],ae=k[W.source];this._renderTileClippingMasks(W,ae,!1),this.renderLayer(this,te,W,ae,G)}this.renderPass="translucent";let X=!1;for(this.currentLayer=0;this.currentLayer<w.length;this.currentLayer++){const W=this.style._layers[w[this.currentLayer]],te=I[W.source];if(this.renderToTexture&&this.renderToTexture.renderLayer(W,G))continue;this.opaquePassEnabledForLayer()||X||(X=!0,G.isRenderingGlobe&&!this.style.map.terrain&&this._renderTilesDepthBuffer());const ae=(W.type==="symbol"?z:R)[W.source];this._renderTileClippingMasks(W,k[W.source],!!this.renderToTexture),this.renderLayer(this,te,W,ae,G)}if(G.isRenderingGlobe&&function(W,te,ae){const Te=W.context,we=Te.gl,Ee=W.useProgram("atmosphere"),Ce=new Ri(we.LEQUAL,Ri.ReadOnly,[0,1]),Fe=W.transform,Oe=function(_t,qt){const Vt=_t.properties.get("position"),kt=[-Vt.x,-Vt.y,-Vt.z],hi=o.af(new Float64Array(16));return _t.properties.get("anchor")==="map"&&(o.b5(hi,hi,qt.rollInRadians),o.b6(hi,hi,-qt.pitchInRadians),o.b5(hi,hi,qt.bearingInRadians),o.b6(hi,hi,qt.center.lat*Math.PI/180),o.by(hi,hi,-qt.center.lng*Math.PI/180)),o.c4(kt,kt,hi),kt}(ae,W.transform),Ue=Fe.getProjectionData({overscaledTileID:null,applyGlobeMatrix:!0,applyTerrainMatrix:!0}),We=te.properties.get("atmosphere-blend")*Ue.projectionTransition;if(We===0)return;const De=Hn(Fe.worldSize,Fe.center.lat),Qe=Fe.inverseProjectionMatrix,yt=new Float64Array(4);yt[3]=1,o.av(yt,yt,Fe.modelViewProjectionMatrix),yt[0]/=yt[3],yt[1]/=yt[3],yt[2]/=yt[3],yt[3]=1,o.av(yt,yt,Qe),yt[0]/=yt[3],yt[1]/=yt[3],yt[2]/=yt[3],yt[3]=1;const ct=((_t,qt,Vt,kt,hi)=>({u_sun_pos:_t,u_atmosphere_blend:qt,u_globe_position:Vt,u_globe_radius:kt,u_inv_proj_matrix:hi}))(Oe,We,[yt[0],yt[1],yt[2]],De,Qe),dt=qa(Te,te);Ee.draw(Te,we.TRIANGLES,Ce,fi.disabled,ui.alphaBlended,Vi.disabled,ct,null,null,"atmosphere",dt.vertexBuffer,dt.indexBuffer,dt.segments)}(this,this.style.sky,this.style.light),this.options.showTileBoundaries){const W=function(te,ae){let Te=null;const we=Object.values(te._layers).flatMap(Oe=>Oe.source&&!Oe.isHidden(ae)?[te.sourceCaches[Oe.source]]:[]),Ee=we.filter(Oe=>Oe.getSource().type==="vector"),Ce=we.filter(Oe=>Oe.getSource().type!=="vector"),Fe=Oe=>{(!Te||Te.getSource().maxzoom<Oe.getSource().maxzoom)&&(Te=Oe)};return Ee.forEach(Oe=>Fe(Oe)),Te||Ce.forEach(Oe=>Fe(Oe)),Te}(this.style,this.transform.zoom);W&&function(te,ae,Te){for(let we=0;we<Te.length;we++)Ep(te,ae,Te[we])}(this,W,W.getVisibleCoordinates())}this.options.showPadding&&function(W){const te=W.transform.padding;Gu(W,W.transform.height-(te.top||0),3,bp),Gu(W,te.bottom||0,3,Sc),Mc(W,te.left||0,3,Ah),Mc(W,W.transform.width-(te.right||0),3,wp);const ae=W.transform.centerPoint;(function(Te,we,Ee,Ce){Pc(Te,we-1,Ee-10,2,20,Ce),Pc(Te,we-10,Ee-1,20,2,Ce)})(W,ae.x,W.transform.height-ae.y,Tp)}(this),this.context.setDefault()}maybeDrawDepthAndCoords(t){if(!this.style||!this.style.map||!this.style.map.terrain)return;const l=this.terrainFacilitator.matrix,f=this.transform.modelViewProjectionMatrix;let g=this.terrainFacilitator.dirty;g||(g=t?!o.c7(l,f):!o.c8(l,f)),g||(g=this.style.map.terrain.sourceCache.anyTilesAfterTime(this.terrainFacilitator.renderTime)),g&&(o.c9(l,f),this.terrainFacilitator.renderTime=Date.now(),this.terrainFacilitator.dirty=!1,function(w,I){const k=w.context,R=k.gl,z=w.transform,G=ui.unblended,X=new Ri(R.LEQUAL,Ri.ReadWrite,[0,1]),W=I.sourceCache.getRenderableTiles(),te=w.useProgram("terrainDepth");k.bindFramebuffer.set(I.getFramebuffer("depth").framebuffer),k.viewport.set([0,0,w.width/devicePixelRatio,w.height/devicePixelRatio]),k.clear({color:o.be.transparent,depth:1});for(const ae of W){const Te=I.getTerrainMesh(ae.tileID),we=I.getTerrainData(ae.tileID),Ee=z.getProjectionData({overscaledTileID:ae.tileID,applyTerrainMatrix:!1,applyGlobeMatrix:!0}),Ce={u_ele_delta:I.getMeshFrameDelta(z.zoom)};te.draw(k,R.TRIANGLES,X,fi.disabled,G,Vi.backCCW,Ce,we,Ee,"terrain",Te.vertexBuffer,Te.indexBuffer,Te.segments)}k.bindFramebuffer.set(null),k.viewport.set([0,0,w.width,w.height])}(this,this.style.map.terrain),function(w,I){const k=w.context,R=k.gl,z=w.transform,G=ui.unblended,X=new Ri(R.LEQUAL,Ri.ReadWrite,[0,1]),W=I.getCoordsTexture(),te=I.sourceCache.getRenderableTiles(),ae=w.useProgram("terrainCoords");k.bindFramebuffer.set(I.getFramebuffer("coords").framebuffer),k.viewport.set([0,0,w.width/devicePixelRatio,w.height/devicePixelRatio]),k.clear({color:o.be.transparent,depth:1}),I.coordsIndex=[];for(const Te of te){const we=I.getTerrainMesh(Te.tileID),Ee=I.getTerrainData(Te.tileID);k.activeTexture.set(R.TEXTURE0),R.bindTexture(R.TEXTURE_2D,W.texture);const Ce={u_terrain_coords_id:(255-I.coordsIndex.length)/255,u_texture:0,u_ele_delta:I.getMeshFrameDelta(z.zoom)},Fe=z.getProjectionData({overscaledTileID:Te.tileID,applyTerrainMatrix:!1,applyGlobeMatrix:!0});ae.draw(k,R.TRIANGLES,X,fi.disabled,G,Vi.backCCW,Ce,Ee,Fe,"terrain",we.vertexBuffer,we.indexBuffer,we.segments),I.coordsIndex.push(Te.tileID.key)}k.bindFramebuffer.set(null),k.viewport.set([0,0,w.width,w.height])}(this,this.style.map.terrain))}renderLayer(t,l,f,g,w){f.isHidden(this.transform.zoom)||(f.type==="background"||f.type==="custom"||(g||[]).length)&&(this.id=f.id,o.ca(f)?function(I,k,R,z,G,X){if(I.renderPass!=="translucent")return;const{isRenderingToTexture:W}=X,te=fi.disabled,ae=I.colorModeForRenderPass();(R._unevaluatedLayout.hasValue("text-variable-anchor")||R._unevaluatedLayout.hasValue("text-variable-anchor-offset"))&&function(Te,we,Ee,Ce,Fe,Oe,Ue,We,De){const Qe=we.transform,yt=we.style.map.terrain,ct=Fe==="map",dt=Oe==="map";for(const _t of Te){const qt=Ce.getTile(_t),Vt=qt.getBucket(Ee);if(!Vt||!Vt.text||!Vt.text.segments.get().length)continue;const kt=o.am(Vt.textSizeData,Qe.zoom),hi=o.aB(qt,1,we.transform.zoom),Ji=Ci(ct,we.transform,hi),Pr=Ee.layout.get("icon-text-fit")!=="none"&&Vt.hasIconData();if(kt){const on=Math.pow(2,Qe.zoom-qt.tileID.overscaledZ),zr=yt?(an,Gr)=>yt.getElevation(_t,an,Gr):null;Km(Vt,ct,dt,De,Qe,Ji,on,kt,Pr,o.aC(Qe,qt,Ue,We),_t.toUnwrapped(),zr)}}}(z,I,R,k,R.layout.get("text-rotation-alignment"),R.layout.get("text-pitch-alignment"),R.paint.get("text-translate"),R.paint.get("text-translate-anchor"),G),R.paint.get("icon-opacity").constantOr(1)!==0&&xp(I,k,R,z,!1,R.paint.get("icon-translate"),R.paint.get("icon-translate-anchor"),R.layout.get("icon-rotation-alignment"),R.layout.get("icon-pitch-alignment"),R.layout.get("icon-keep-upright"),te,ae,W),R.paint.get("text-opacity").constantOr(1)!==0&&xp(I,k,R,z,!0,R.paint.get("text-translate"),R.paint.get("text-translate-anchor"),R.layout.get("text-rotation-alignment"),R.layout.get("text-pitch-alignment"),R.layout.get("text-keep-upright"),te,ae,W),k.map.showCollisionBoxes&&(vl(I,k,R,z,!0),vl(I,k,R,z,!1))}(t,l,f,g,this.style.placement.variableOffsets,w):o.cb(f)?function(I,k,R,z,G){if(I.renderPass!=="translucent")return;const{isRenderingToTexture:X}=G,W=R.paint.get("circle-opacity"),te=R.paint.get("circle-stroke-width"),ae=R.paint.get("circle-stroke-opacity"),Te=!R.layout.get("circle-sort-key").isConstant();if(W.constantOr(1)===0&&(te.constantOr(1)===0||ae.constantOr(1)===0))return;const we=I.context,Ee=we.gl,Ce=I.transform,Fe=I.getDepthModeForSublayer(0,Ri.ReadOnly),Oe=fi.disabled,Ue=I.colorModeForRenderPass(),We=[],De=Ce.getCircleRadiusCorrection();for(let Qe=0;Qe<z.length;Qe++){const yt=z[Qe],ct=k.getTile(yt),dt=ct.getBucket(R);if(!dt)continue;const _t=R.paint.get("circle-translate"),qt=R.paint.get("circle-translate-anchor"),Vt=o.aC(Ce,ct,_t,qt),kt=dt.programConfigurations.get(R.id),hi=I.useProgram("circle",kt),Ji=dt.layoutVertexBuffer,Pr=dt.indexBuffer,on=I.style.map.terrain&&I.style.map.terrain.getTerrainData(yt),zr={programConfiguration:kt,program:hi,layoutVertexBuffer:Ji,indexBuffer:Pr,uniformValues:ra(I,ct,R,Vt,De),terrainData:on,projectionData:Ce.getProjectionData({overscaledTileID:yt,applyGlobeMatrix:!X,applyTerrainMatrix:!0})};if(Te){const an=dt.segments.get();for(const Gr of an)We.push({segments:new o.aL([Gr]),sortKey:Gr.sortKey,state:zr})}else We.push({segments:dt.segments,sortKey:0,state:zr})}Te&&We.sort((Qe,yt)=>Qe.sortKey-yt.sortKey);for(const Qe of We){const{programConfiguration:yt,program:ct,layoutVertexBuffer:dt,indexBuffer:_t,uniformValues:qt,terrainData:Vt,projectionData:kt}=Qe.state;ct.draw(we,Ee.TRIANGLES,Fe,Oe,Ue,Vi.backCCW,qt,Vt,kt,R.id,dt,_t,Qe.segments,R.paint,I.transform.zoom,yt)}}(t,l,f,g,w):o.cc(f)?function(I,k,R,z,G){if(R.paint.get("heatmap-opacity")===0)return;const X=I.context,{isRenderingToTexture:W,isRenderingGlobe:te}=G;if(I.style.map.terrain){for(const ae of z){const Te=k.getTile(ae);k.hasRenderableParent(ae)||(I.renderPass==="offscreen"?Tc(I,Te,R,ae,te):I.renderPass==="translucent"&&Ec(I,R,ae,W,te))}X.viewport.set([0,0,I.width,I.height])}else I.renderPass==="offscreen"?function(ae,Te,we,Ee){const Ce=ae.context,Fe=Ce.gl,Oe=ae.transform,Ue=fi.disabled,We=new ui([Fe.ONE,Fe.ONE],o.be.transparent,[!0,!0,!0,!0]);(function(De,Qe,yt){const ct=De.gl;De.activeTexture.set(ct.TEXTURE1),De.viewport.set([0,0,Qe.width/4,Qe.height/4]);let dt=yt.heatmapFbos.get(o.c1);dt?(ct.bindTexture(ct.TEXTURE_2D,dt.colorAttachment.get()),De.bindFramebuffer.set(dt.framebuffer)):(dt=Bu(De,Qe.width/4,Qe.height/4),yt.heatmapFbos.set(o.c1,dt))})(Ce,ae,we),Ce.clear({color:o.be.transparent});for(let De=0;De<Ee.length;De++){const Qe=Ee[De];if(Te.hasRenderableParent(Qe))continue;const yt=Te.getTile(Qe),ct=yt.getBucket(we);if(!ct)continue;const dt=ct.programConfigurations.get(we.id),_t=ae.useProgram("heatmap",dt),qt=Oe.getProjectionData({overscaledTileID:Qe,applyGlobeMatrix:!0,applyTerrainMatrix:!1}),Vt=Oe.getCircleRadiusCorrection();_t.draw(Ce,Fe.TRIANGLES,Ri.disabled,Ue,We,Vi.backCCW,ro(yt,Oe.zoom,we.paint.get("heatmap-intensity"),Vt),null,qt,we.id,ct.layoutVertexBuffer,ct.indexBuffer,ct.segments,we.paint,Oe.zoom,dt)}Ce.viewport.set([0,0,ae.width,ae.height])}(I,k,R,z):I.renderPass==="translucent"&&function(ae,Te){const we=ae.context,Ee=we.gl;we.setColorMode(ae.colorModeForRenderPass());const Ce=Te.heatmapFbos.get(o.c1);Ce&&(we.activeTexture.set(Ee.TEXTURE0),Ee.bindTexture(Ee.TEXTURE_2D,Ce.colorAttachment.get()),we.activeTexture.set(Ee.TEXTURE1),Ic(we,Te).bind(Ee.LINEAR,Ee.CLAMP_TO_EDGE),ae.useProgram("heatmapTexture").draw(we,Ee.TRIANGLES,Ri.disabled,fi.disabled,ae.colorModeForRenderPass(),Vi.disabled,fl(ae,Te,0,1),null,null,Te.id,ae.viewportBuffer,ae.quadTriangleIndexBuffer,ae.viewportSegments,Te.paint,ae.transform.zoom))}(I,R)}(t,l,f,g,w):o.cd(f)?function(I,k,R,z,G){if(I.renderPass!=="translucent")return;const{isRenderingToTexture:X}=G,W=R.paint.get("line-opacity"),te=R.paint.get("line-width");if(W.constantOr(1)===0||te.constantOr(1)===0)return;const ae=I.getDepthModeForSublayer(0,Ri.ReadOnly),Te=I.colorModeForRenderPass(),we=R.paint.get("line-dasharray"),Ee=R.paint.get("line-pattern"),Ce=Ee.constantOr(1),Fe=R.paint.get("line-gradient"),Oe=R.getCrossfadeParameters(),Ue=Ce?"linePattern":we?"lineSDF":Fe?"lineGradient":"line",We=I.context,De=We.gl,Qe=I.transform;let yt=!0;for(const ct of z){const dt=k.getTile(ct);if(Ce&&!dt.patternsLoaded())continue;const _t=dt.getBucket(R);if(!_t)continue;const qt=_t.programConfigurations.get(R.id),Vt=I.context.program.get(),kt=I.useProgram(Ue,qt),hi=yt||kt.program!==Vt,Ji=I.style.map.terrain&&I.style.map.terrain.getTerrainData(ct),Pr=Ee.constantOr(null);if(Pr&&dt.imageAtlas){const Br=dt.imageAtlas,Ur=Br.patternPositions[Pr.to.toString()],ds=Br.patternPositions[Pr.from.toString()];Ur&&ds&&qt.setConstantPatternPositions(Ur,ds)}const on=Qe.getProjectionData({overscaledTileID:ct,applyGlobeMatrix:!X,applyTerrainMatrix:!0}),zr=Qe.getPixelScale(),an=Ce?Ro(I,dt,R,zr,Oe):we?eu(I,dt,R,zr,we,Oe):Fe?na(I,dt,R,zr,_t.lineClipsArray.length):ba(I,dt,R,zr);if(Ce)We.activeTexture.set(De.TEXTURE0),dt.imageAtlasTexture.bind(De.LINEAR,De.CLAMP_TO_EDGE),qt.updatePaintBuffers(Oe);else if(we&&(hi||I.lineAtlas.dirty))We.activeTexture.set(De.TEXTURE0),I.lineAtlas.bind(We);else if(Fe){const Br=_t.gradients[R.id];let Ur=Br.texture;if(R.gradientVersion!==Br.version){let ds=256;if(R.stepInterpolant){const xr=k.getSource().maxzoom,Jn=ct.canonical.z===xr?Math.ceil(1<<I.transform.maxZoom-ct.canonical.z):1;ds=o.ag(o.c2(_t.maxLineLength/o.$*1024*Jn),256,We.maxTextureSize)}Br.gradient=o.c3({expression:R.gradientExpression(),evaluationKey:"lineProgress",resolution:ds,image:Br.gradient||void 0,clips:_t.lineClipsArray}),Br.texture?Br.texture.update(Br.gradient):Br.texture=new o.T(We,Br.gradient,De.RGBA),Br.version=R.gradientVersion,Ur=Br.texture}We.activeTexture.set(De.TEXTURE0),Ur.bind(R.stepInterpolant?De.NEAREST:De.LINEAR,De.CLAMP_TO_EDGE)}const Gr=I.stencilModeForClipping(ct);kt.draw(We,De.TRIANGLES,ae,Gr,Te,Vi.disabled,an,Ji,on,R.id,_t.layoutVertexBuffer,_t.indexBuffer,_t.segments,R.paint,I.transform.zoom,qt,_t.layoutVertexBuffer2),yt=!1}}(t,l,f,g,w):o.ce(f)?function(I,k,R,z,G){const X=R.paint.get("fill-color"),W=R.paint.get("fill-opacity");if(W.constantOr(1)===0)return;const{isRenderingToTexture:te}=G,ae=I.colorModeForRenderPass(),Te=R.paint.get("fill-pattern"),we=I.opaquePassEnabledForLayer()&&!Te.constantOr(1)&&X.constantOr(o.be.transparent).a===1&&W.constantOr(0)===1?"opaque":"translucent";if(I.renderPass===we){const Ee=I.getDepthModeForSublayer(1,I.renderPass==="opaque"?Ri.ReadWrite:Ri.ReadOnly);$u(I,k,R,z,Ee,ae,!1,te)}if(I.renderPass==="translucent"&&R.paint.get("fill-antialias")){const Ee=I.getDepthModeForSublayer(R.getPaintProperty("fill-outline-color")?2:0,Ri.ReadOnly);$u(I,k,R,z,Ee,ae,!0,te)}}(t,l,f,g,w):o.cf(f)?function(I,k,R,z,G){const X=R.paint.get("fill-extrusion-opacity");if(X===0)return;const{isRenderingToTexture:W}=G;if(I.renderPass==="translucent"){const te=new Ri(I.context.gl.LEQUAL,Ri.ReadWrite,I.depthRangeFor3D);if(X!==1||R.paint.get("fill-extrusion-pattern").constantOr(1))iu(I,k,R,z,te,fi.disabled,ui.disabled,W),iu(I,k,R,z,te,I.stencilModeFor3D(),I.colorModeForRenderPass(),W);else{const ae=I.colorModeForRenderPass();iu(I,k,R,z,te,fi.disabled,ae,W)}}}(t,l,f,g,w):o.cg(f)?function(I,k,R,z,G){if(I.renderPass!=="offscreen"&&I.renderPass!=="translucent")return;const{isRenderingToTexture:X}=G,W=I.context,te=I.style.projection.useSubdivision,ae=I.getDepthModeForSublayer(0,Ri.ReadOnly),Te=I.colorModeForRenderPass();if(I.renderPass==="offscreen")(function(we,Ee,Ce,Fe,Oe,Ue,We){const De=we.context,Qe=De.gl;for(const yt of Ce){const ct=Ee.getTile(yt),dt=ct.dem;if(!dt||!dt.data||!ct.needsHillshadePrepare)continue;const _t=dt.dim,qt=dt.stride,Vt=dt.getPixels();if(De.activeTexture.set(Qe.TEXTURE1),De.pixelStoreUnpackPremultiplyAlpha.set(!1),ct.demTexture=ct.demTexture||we.getTileTexture(qt),ct.demTexture){const hi=ct.demTexture;hi.update(Vt,{premultiply:!1}),hi.bind(Qe.NEAREST,Qe.CLAMP_TO_EDGE)}else ct.demTexture=new o.T(De,Vt,Qe.RGBA,{premultiply:!1}),ct.demTexture.bind(Qe.NEAREST,Qe.CLAMP_TO_EDGE);De.activeTexture.set(Qe.TEXTURE0);let kt=ct.fbo;if(!kt){const hi=new o.T(De,{width:_t,height:_t,data:null},Qe.RGBA);hi.bind(Qe.LINEAR,Qe.CLAMP_TO_EDGE),kt=ct.fbo=De.createFramebuffer(_t,_t,!0,!1),kt.colorAttachment.set(hi.texture)}De.bindFramebuffer.set(kt.framebuffer),De.viewport.set([0,0,_t,_t]),we.useProgram("hillshadePrepare").draw(De,Qe.TRIANGLES,Oe,Ue,We,Vi.disabled,Jl(ct.tileID,dt),null,null,Fe.id,we.rasterBoundsBuffer,we.quadTriangleIndexBuffer,we.rasterBoundsSegments),ct.needsHillshadePrepare=!1}})(I,k,z,R,ae,fi.disabled,Te),W.viewport.set([0,0,I.width,I.height]);else if(I.renderPass==="translucent")if(te){const[we,Ee,Ce]=I.stencilConfigForOverlapTwoPass(z);ru(I,k,R,Ce,we,ae,Te,!1,X),ru(I,k,R,Ce,Ee,ae,Te,!0,X)}else{const[we,Ee]=I.getStencilConfigForOverlapAndUpdateStencilID(z);ru(I,k,R,Ee,we,ae,Te,!1,X)}}(t,l,f,g,w):o.ch(f)?function(I,k,R,z,G){if(I.renderPass!=="translucent"||!z.length)return;const{isRenderingToTexture:X}=G,W=I.style.projection.useSubdivision,te=I.getDepthModeForSublayer(0,Ri.ReadOnly),ae=I.colorModeForRenderPass();if(W){const[Te,we,Ee]=I.stencilConfigForOverlapTwoPass(z);ju(I,k,R,Ee,Te,te,ae,!1,X),ju(I,k,R,Ee,we,te,ae,!0,X)}else{const[Te,we]=I.getStencilConfigForOverlapAndUpdateStencilID(z);ju(I,k,R,we,Te,te,ae,!1,X)}}(t,l,f,g,w):o.ci(f)?function(I,k,R,z,G){if(I.renderPass!=="translucent"||R.paint.get("raster-opacity")===0||!z.length)return;const{isRenderingToTexture:X}=G,W=k.getSource(),te=I.style.projection.useSubdivision;if(W instanceof Ot)Va(I,k,R,z,null,!1,!1,W.tileCoords,W.flippedWindingOrder,X);else if(te){const[ae,Te,we]=I.stencilConfigForOverlapTwoPass(z);Va(I,k,R,we,ae,!1,!0,Ch,!1,X),Va(I,k,R,we,Te,!0,!0,Ch,!1,X)}else{const[ae,Te]=I.getStencilConfigForOverlapAndUpdateStencilID(z);Va(I,k,R,Te,ae,!1,!0,Ch,!1,X)}}(t,l,f,g,w):o.cj(f)?function(I,k,R,z,G){const X=R.paint.get("background-color"),W=R.paint.get("background-opacity");if(W===0)return;const{isRenderingToTexture:te}=G,ae=I.context,Te=ae.gl,we=I.style.projection,Ee=I.transform,Ce=Ee.tileSize,Fe=R.paint.get("background-pattern");if(I.isPatternMissing(Fe))return;const Oe=!Fe&&X.a===1&&W===1&&I.opaquePassEnabledForLayer()?"opaque":"translucent";if(I.renderPass!==Oe)return;const Ue=fi.disabled,We=I.getDepthModeForSublayer(0,Oe==="opaque"?Ri.ReadWrite:Ri.ReadOnly),De=I.colorModeForRenderPass(),Qe=I.useProgram(Fe?"backgroundPattern":"background"),yt=z||ft(Ee,{tileSize:Ce,terrain:I.style.map.terrain});Fe&&(ae.activeTexture.set(Te.TEXTURE0),I.imageManager.bind(I.context));const ct=R.getCrossfadeParameters();for(const dt of yt){const _t=Ee.getProjectionData({overscaledTileID:dt,applyGlobeMatrix:!te,applyTerrainMatrix:!0}),qt=Fe?Ba(W,I,Fe,{tileID:dt,tileSize:Ce},ct):sa(W,X),Vt=I.style.map.terrain&&I.style.map.terrain.getTerrainData(dt),kt=we.getMeshFromTileID(ae,dt.canonical,!1,!0,"raster");Qe.draw(ae,Te.TRIANGLES,We,Ue,De,Vi.backCCW,qt,Vt,_t,R.id,kt.vertexBuffer,kt.indexBuffer,kt.segments)}}(t,0,f,g,w):o.ck(f)&&function(I,k,R,z){const{isRenderingGlobe:G}=z,X=I.context,W=R.implementation,te=I.style.projection,ae=I.transform,Te=ae.getProjectionDataForCustomLayer(G),we={farZ:ae.farZ,nearZ:ae.nearZ,fov:ae.fov*Math.PI/180,modelViewProjectionMatrix:ae.modelViewProjectionMatrix,projectionMatrix:ae.projectionMatrix,shaderData:{variantName:te.shaderVariantName,vertexShaderPrelude:`const float PI = 3.141592653589793;
uniform mat4 u_projection_matrix;
${te.shaderPreludeCode.vertexSource}`,define:te.shaderDefine},defaultProjectionData:Te},Ee=W.renderingMode?W.renderingMode:"2d";if(I.renderPass==="offscreen"){const Ce=W.prerender;Ce&&(I.setCustomLayerDefaults(),X.setColorMode(I.colorModeForRenderPass()),Ce.call(W,X.gl,we),X.setDirty(),I.setBaseState())}else if(I.renderPass==="translucent"){I.setCustomLayerDefaults(),X.setColorMode(I.colorModeForRenderPass()),X.setStencilMode(fi.disabled);const Ce=Ee==="3d"?I.getDepthModeFor3D():I.getDepthModeForSublayer(0,Ri.ReadOnly);X.setDepthMode(Ce),W.render(X.gl,we),X.setDirty(),I.setBaseState(),X.bindFramebuffer.set(null)}}(t,0,f,w))}saveTileTexture(t){const l=this._tileTextures[t.size[0]];l?l.push(t):this._tileTextures[t.size[0]]=[t]}getTileTexture(t){const l=this._tileTextures[t];return l&&l.length>0?l.pop():null}isPatternMissing(t){if(!t)return!1;if(!t.from||!t.to)return!0;const l=this.imageManager.getPattern(t.from.toString()),f=this.imageManager.getPattern(t.to.toString());return!l||!f}useProgram(t,l,f=!1,g=[]){this.cache=this.cache||{};const w=!!this.style.map.terrain,I=this.style.projection,k=f?qe.projectionMercator:I.shaderPreludeCode,R=f?Dt:I.shaderDefine,z=t+(l?l.cacheKey:"")+`/${f?Nt:I.shaderVariantName}`+(this._showOverdrawInspector?"/overdraw":"")+(w?"/terrain":"")+(g?`/${g.join("/")}`:"");return this.cache[z]||(this.cache[z]=new go(this.context,qe[t],l,No[t],this._showOverdrawInspector,w,k,R,g)),this.cache[z]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){const t=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(t.FUNC_ADD)}initDebugOverlayCanvas(){this.debugOverlayCanvas==null&&(this.debugOverlayCanvas=document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new o.T(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))}destroy(){this.debugOverlayTexture&&this.debugOverlayTexture.destroy()}overLimit(){const{drawingBufferWidth:t,drawingBufferHeight:l}=this.context.gl;return this.width!==t||this.height!==l}}function kc(b,t){let l,f=!1,g=null,w=null;const I=()=>{g=null,f&&(b.apply(w,l),g=setTimeout(I,t),f=!1)};return(...k)=>(f=!0,w=this,l=k,g||I(),g)}class Uu{constructor(t){this._getCurrentHash=()=>{const l=window.location.hash.replace("#","");if(this._hashName){let f;return l.split("&").map(g=>g.split("=")).forEach(g=>{g[0]===this._hashName&&(f=g)}),(f&&f[1]||"").split("/")}return l.split("/")},this._onHashChange=()=>{const l=this._getCurrentHash();if(!this._isValidHash(l))return!1;const f=this._map.dragRotate.isEnabled()&&this._map.touchZoomRotate.isEnabled()?+(l[3]||0):this._map.getBearing();return this._map.jumpTo({center:[+l[2],+l[1]],zoom:+l[0],bearing:f,pitch:+(l[4]||0)}),!0},this._updateHashUnthrottled=()=>{const l=window.location.href.replace(/(#.*)?$/,this.getHashString());window.history.replaceState(window.history.state,null,l)},this._removeHash=()=>{const l=this._getCurrentHash();if(l.length===0)return;const f=l.join("/");let g=f;g.split("&").length>0&&(g=g.split("&")[0]),this._hashName&&(g=`${this._hashName}=${f}`);let w=window.location.hash.replace(g,"");w.startsWith("#&")?w=w.slice(0,1)+w.slice(2):w==="#"&&(w="");let I=window.location.href.replace(/(#.+)?$/,w);I=I.replace("&&","&"),window.history.replaceState(window.history.state,null,I)},this._updateHash=kc(this._updateHashUnthrottled,300),this._hashName=t&&encodeURIComponent(t)}addTo(t){return this._map=t,addEventListener("hashchange",this._onHashChange,!1),this._map.on("moveend",this._updateHash),this}remove(){return removeEventListener("hashchange",this._onHashChange,!1),this._map.off("moveend",this._updateHash),clearTimeout(this._updateHash()),this._removeHash(),delete this._map,this}getHashString(t){const l=this._map.getCenter(),f=Math.round(100*this._map.getZoom())/100,g=Math.ceil((f*Math.LN2+Math.log(512/360/.5))/Math.LN10),w=Math.pow(10,g),I=Math.round(l.lng*w)/w,k=Math.round(l.lat*w)/w,R=this._map.getBearing(),z=this._map.getPitch();let G="";if(G+=t?`/${I}/${k}/${f}`:`${f}/${k}/${I}`,(R||z)&&(G+="/"+Math.round(10*R)/10),z&&(G+=`/${Math.round(z)}`),this._hashName){const X=this._hashName;let W=!1;const te=window.location.hash.slice(1).split("&").map(ae=>{const Te=ae.split("=")[0];return Te===X?(W=!0,`${Te}=${G}`):ae}).filter(ae=>ae);return W||te.push(`${X}=${G}`),`#${te.join("&")}`}return`#${G}`}_isValidHash(t){if(t.length<3||t.some(isNaN))return!1;try{new o.S(+t[2],+t[1])}catch{return!1}const l=+t[0],f=+(t[3]||0),g=+(t[4]||0);return l>=this._map.getMinZoom()&&l<=this._map.getMaxZoom()&&f>=-180&&f<=180&&g>=this._map.getMinPitch()&&g<=this._map.getMaxPitch()}}const nu={linearity:.3,easing:o.cl(0,0,.3,1)},su=o.e({deceleration:2500,maxSpeed:1400},nu),Lh=o.e({deceleration:20,maxSpeed:1400},nu),Vu=o.e({deceleration:1e3,maxSpeed:360},nu),Rh=o.e({deceleration:1e3,maxSpeed:90},nu),Ip=o.e({deceleration:1e3,maxSpeed:360},nu);class Sp{constructor(t){this._map=t,this.clear()}clear(){this._inertiaBuffer=[]}record(t){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:Y.now(),settings:t})}_drainInertiaBuffer(){const t=this._inertiaBuffer,l=Y.now();for(;t.length>0&&l-t[0].time>160;)t.shift()}_onMoveEnd(t){if(this._drainInertiaBuffer(),this._inertiaBuffer.length<2)return;const l={zoom:0,bearing:0,pitch:0,roll:0,pan:new o.P(0,0),pinchAround:void 0,around:void 0};for(const{settings:w}of this._inertiaBuffer)l.zoom+=w.zoomDelta||0,l.bearing+=w.bearingDelta||0,l.pitch+=w.pitchDelta||0,l.roll+=w.rollDelta||0,w.panDelta&&l.pan._add(w.panDelta),w.around&&(l.around=w.around),w.pinchAround&&(l.pinchAround=w.pinchAround);const f=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,g={};if(l.pan.mag()){const w=au(l.pan.mag(),f,o.e({},su,t||{})),I=l.pan.mult(w.amount/l.pan.mag()),k=this._map.cameraHelper.handlePanInertia(I,this._map.transform);g.center=k.easingCenter,g.offset=k.easingOffset,ou(g,w)}if(l.zoom){const w=au(l.zoom,f,Lh);g.zoom=this._map.transform.zoom+w.amount,ou(g,w)}if(l.bearing){const w=au(l.bearing,f,Vu);g.bearing=this._map.transform.bearing+o.ag(w.amount,-179,179),ou(g,w)}if(l.pitch){const w=au(l.pitch,f,Rh);g.pitch=this._map.transform.pitch+w.amount,ou(g,w)}if(l.roll){const w=au(l.roll,f,Ip);g.roll=this._map.transform.roll+o.ag(w.amount,-179,179),ou(g,w)}if(g.zoom||g.bearing){const w=l.pinchAround===void 0?l.around:l.pinchAround;g.around=w?this._map.unproject(w):this._map.getCenter()}return this.clear(),o.e(g,{noMoveStart:!0})}}function ou(b,t){(!b.duration||b.duration<t.duration)&&(b.duration=t.duration,b.easing=t.easing)}function au(b,t,l){const{maxSpeed:f,linearity:g,deceleration:w}=l,I=o.ag(b*g/(t/1e3),-f,f),k=Math.abs(I)/(w*g);return{easing:l.easing,duration:1e3*k,amount:I*(k/2)}}class Zs extends o.l{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(t,l,f,g={}){f=f instanceof MouseEvent?f:new MouseEvent(t,f);const w=V.mousePos(l.getCanvas(),f),I=l.unproject(w);super(t,o.e({point:w,lngLat:I,originalEvent:f},g)),this._defaultPrevented=!1,this.target=l}}class Oo extends o.l{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(t,l,f){const g=t==="touchend"?f.changedTouches:f.touches,w=V.touchPos(l.getCanvasContainer(),g),I=w.map(R=>l.unproject(R)),k=w.reduce((R,z,G,X)=>R.add(z.div(X.length)),new o.P(0,0));super(t,{points:w,point:k,lngLats:I,lngLat:l.unproject(k),originalEvent:f}),this._defaultPrevented=!1}}class Nh extends o.l{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(t,l,f){super(t,{originalEvent:f}),this._defaultPrevented=!1}}class Mp{constructor(t,l){this._map=t,this._clickTolerance=l.clickTolerance}reset(){delete this._mousedownPos}wheel(t){return this._firePreventable(new Nh(t.type,this._map,t))}mousedown(t,l){return this._mousedownPos=l,this._firePreventable(new Zs(t.type,this._map,t))}mouseup(t){this._map.fire(new Zs(t.type,this._map,t))}click(t,l){this._mousedownPos&&this._mousedownPos.dist(l)>=this._clickTolerance||this._map.fire(new Zs(t.type,this._map,t))}dblclick(t){return this._firePreventable(new Zs(t.type,this._map,t))}mouseover(t){this._map.fire(new Zs(t.type,this._map,t))}mouseout(t){this._map.fire(new Zs(t.type,this._map,t))}touchstart(t){return this._firePreventable(new Oo(t.type,this._map,t))}touchmove(t){this._map.fire(new Oo(t.type,this._map,t))}touchend(t){this._map.fire(new Oo(t.type,this._map,t))}touchcancel(t){this._map.fire(new Oo(t.type,this._map,t))}_firePreventable(t){if(this._map.fire(t),t.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Pp{constructor(t){this._map=t}reset(){this._delayContextMenu=!1,this._ignoreContextMenu=!0,delete this._contextMenuEvent}mousemove(t){this._map.fire(new Zs(t.type,this._map,t))}mousedown(){this._delayContextMenu=!0,this._ignoreContextMenu=!1}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new Zs("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(t){this._delayContextMenu?this._contextMenuEvent=t:this._ignoreContextMenu||this._map.fire(new Zs(t.type,this._map,t)),this._map.listens("contextmenu")&&t.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class lu{constructor(t){this._map=t}get transform(){return this._map._requestedCameraState||this._map.transform}get center(){return{lng:this.transform.center.lng,lat:this.transform.center.lat}}get zoom(){return this.transform.zoom}get pitch(){return this.transform.pitch}get bearing(){return this.transform.bearing}unproject(t){return this.transform.screenPointToLocation(o.P.convert(t),this._map.terrain)}}class Oh{constructor(t,l){this._map=t,this._tr=new lu(t),this._el=t.getCanvasContainer(),this._container=t.getContainer(),this._clickTolerance=l.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(t,l){this.isEnabled()&&t.shiftKey&&t.button===0&&(V.disableDrag(),this._startPos=this._lastPos=l,this._active=!0)}mousemoveWindow(t,l){if(!this._active)return;const f=l;if(this._lastPos.equals(f)||!this._box&&f.dist(this._startPos)<this._clickTolerance)return;const g=this._startPos;this._lastPos=f,this._box||(this._box=V.create("div","maplibregl-boxzoom",this._container),this._container.classList.add("maplibregl-crosshair"),this._fireEvent("boxzoomstart",t));const w=Math.min(g.x,f.x),I=Math.max(g.x,f.x),k=Math.min(g.y,f.y),R=Math.max(g.y,f.y);V.setTransform(this._box,`translate(${w}px,${k}px)`),this._box.style.width=I-w+"px",this._box.style.height=R-k+"px"}mouseupWindow(t,l){if(!this._active||t.button!==0)return;const f=this._startPos,g=l;if(this.reset(),V.suppressClick(),f.x!==g.x||f.y!==g.y)return this._map.fire(new o.l("boxzoomend",{originalEvent:t})),{cameraAnimation:w=>w.fitScreenCoordinates(f,g,this._tr.bearing,{linear:!0})};this._fireEvent("boxzoomcancel",t)}keydown(t){this._active&&t.keyCode===27&&(this.reset(),this._fireEvent("boxzoomcancel",t))}reset(){this._active=!1,this._container.classList.remove("maplibregl-crosshair"),this._box&&(V.remove(this._box),this._box=null),V.enableDrag(),delete this._startPos,delete this._lastPos}_fireEvent(t,l){return this._map.fire(new o.l(t,{originalEvent:l}))}}function Cc(b,t){if(b.length!==t.length)throw new Error(`The number of touches and points are not equal - touches ${b.length}, points ${t.length}`);const l={};for(let f=0;f<b.length;f++)l[b[f].identifier]=t[f];return l}class kp{constructor(t){this.reset(),this.numTouches=t.numTouches}reset(){delete this.centroid,delete this.startTime,delete this.touches,this.aborted=!1}touchstart(t,l,f){(this.centroid||f.length>this.numTouches)&&(this.aborted=!0),this.aborted||(this.startTime===void 0&&(this.startTime=t.timeStamp),f.length===this.numTouches&&(this.centroid=function(g){const w=new o.P(0,0);for(const I of g)w._add(I);return w.div(g.length)}(l),this.touches=Cc(f,l)))}touchmove(t,l,f){if(this.aborted||!this.centroid)return;const g=Cc(f,l);for(const w in this.touches){const I=g[w];(!I||I.dist(this.touches[w])>30)&&(this.aborted=!0)}}touchend(t,l,f){if((!this.centroid||t.timeStamp-this.startTime>500)&&(this.aborted=!0),f.length===0){const g=!this.aborted&&this.centroid;if(this.reset(),g)return g}}}class Ac{constructor(t){this.singleTap=new kp(t),this.numTaps=t.numTaps,this.reset()}reset(){this.lastTime=1/0,delete this.lastTap,this.count=0,this.singleTap.reset()}touchstart(t,l,f){this.singleTap.touchstart(t,l,f)}touchmove(t,l,f){this.singleTap.touchmove(t,l,f)}touchend(t,l,f){const g=this.singleTap.touchend(t,l,f);if(g){const w=t.timeStamp-this.lastTime<500,I=!this.lastTap||this.lastTap.dist(g)<30;if(w&&I||this.reset(),this.count++,this.lastTime=t.timeStamp,this.lastTap=g,this.count===this.numTaps)return this.reset(),g}}}class Lc{constructor(t){this._tr=new lu(t),this._zoomIn=new Ac({numTouches:1,numTaps:2}),this._zoomOut=new Ac({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(t,l,f){this._zoomIn.touchstart(t,l,f),this._zoomOut.touchstart(t,l,f)}touchmove(t,l,f){this._zoomIn.touchmove(t,l,f),this._zoomOut.touchmove(t,l,f)}touchend(t,l,f){const g=this._zoomIn.touchend(t,l,f),w=this._zoomOut.touchend(t,l,f),I=this._tr;return g?(this._active=!0,t.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:k=>k.easeTo({duration:300,zoom:I.zoom+1,around:I.unproject(g)},{originalEvent:t})}):w?(this._active=!0,t.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:k=>k.easeTo({duration:300,zoom:I.zoom-1,around:I.unproject(w)},{originalEvent:t})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class uu{constructor(t){this._enabled=!!t.enable,this._moveStateManager=t.moveStateManager,this._clickTolerance=t.clickTolerance||1,this._moveFunction=t.move,this._activateOnStart=!!t.activateOnStart,t.assignEvents(this),this.reset()}reset(t){this._active=!1,this._moved=!1,delete this._lastPoint,this._moveStateManager.endMove(t)}_move(...t){const l=this._moveFunction(...t);if(l.bearingDelta||l.pitchDelta||l.rollDelta||l.around||l.panDelta)return this._active=!0,l}dragStart(t,l){this.isEnabled()&&!this._lastPoint&&this._moveStateManager.isValidStartEvent(t)&&(this._moveStateManager.startMove(t),this._lastPoint=Array.isArray(l)?l[0]:l,this._activateOnStart&&this._lastPoint&&(this._active=!0))}dragMove(t,l){if(!this.isEnabled())return;const f=this._lastPoint;if(!f)return;if(t.preventDefault(),!this._moveStateManager.isValidMoveEvent(t))return void this.reset(t);const g=Array.isArray(l)?l[0]:l;return!this._moved&&g.dist(f)<this._clickTolerance?void 0:(this._moved=!0,this._lastPoint=g,this._move(f,g))}dragEnd(t){this.isEnabled()&&this._lastPoint&&this._moveStateManager.isValidEndEvent(t)&&(this._moved&&V.suppressClick(),this.reset(t))}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}getClickTolerance(){return this._clickTolerance}}const xo=0,Do=2,Cp={[xo]:1,[Do]:2};class Ds{constructor(t){this._correctEvent=t.checkCorrectEvent}startMove(t){const l=V.mouseButton(t);this._eventButton=l}endMove(t){delete this._eventButton}isValidStartEvent(t){return this._correctEvent(t)}isValidMoveEvent(t){return!function(l,f){const g=Cp[f];return l.buttons===void 0||(l.buttons&g)!==g}(t,this._eventButton)}isValidEndEvent(t){return V.mouseButton(t)===this._eventButton}}class cu{constructor(){this._firstTouch=void 0}_isOneFingerTouch(t){return t.targetTouches.length===1}_isSameTouchEvent(t){return t.targetTouches[0].identifier===this._firstTouch}startMove(t){this._firstTouch=t.targetTouches[0].identifier}endMove(t){delete this._firstTouch}isValidStartEvent(t){return this._isOneFingerTouch(t)}isValidMoveEvent(t){return this._isOneFingerTouch(t)&&this._isSameTouchEvent(t)}isValidEndEvent(t){return this._isOneFingerTouch(t)&&this._isSameTouchEvent(t)}}class Qm{constructor(t=new Ds({checkCorrectEvent:()=>!0}),l=new cu){this.mouseMoveStateManager=t,this.oneFingerTouchMoveStateManager=l}_executeRelevantHandler(t,l,f){return t instanceof MouseEvent?l(t):typeof TouchEvent<"u"&&t instanceof TouchEvent?f(t):void 0}startMove(t){this._executeRelevantHandler(t,l=>this.mouseMoveStateManager.startMove(l),l=>this.oneFingerTouchMoveStateManager.startMove(l))}endMove(t){this._executeRelevantHandler(t,l=>this.mouseMoveStateManager.endMove(l),l=>this.oneFingerTouchMoveStateManager.endMove(l))}isValidStartEvent(t){return this._executeRelevantHandler(t,l=>this.mouseMoveStateManager.isValidStartEvent(l),l=>this.oneFingerTouchMoveStateManager.isValidStartEvent(l))}isValidMoveEvent(t){return this._executeRelevantHandler(t,l=>this.mouseMoveStateManager.isValidMoveEvent(l),l=>this.oneFingerTouchMoveStateManager.isValidMoveEvent(l))}isValidEndEvent(t){return this._executeRelevantHandler(t,l=>this.mouseMoveStateManager.isValidEndEvent(l),l=>this.oneFingerTouchMoveStateManager.isValidEndEvent(l))}}const Rc=b=>{b.mousedown=b.dragStart,b.mousemoveWindow=b.dragMove,b.mouseup=b.dragEnd,b.contextmenu=t=>{t.preventDefault()}};class eg{constructor(t,l){this._clickTolerance=t.clickTolerance||1,this._map=l,this.reset()}reset(){this._active=!1,this._touches={},this._sum=new o.P(0,0)}_shouldBePrevented(t){return t<(this._map.cooperativeGestures.isEnabled()?2:1)}touchstart(t,l,f){return this._calculateTransform(t,l,f)}touchmove(t,l,f){if(this._active){if(!this._shouldBePrevented(f.length))return t.preventDefault(),this._calculateTransform(t,l,f);this._map.cooperativeGestures.notifyGestureBlocked("touch_pan",t)}}touchend(t,l,f){this._calculateTransform(t,l,f),this._active&&this._shouldBePrevented(f.length)&&this.reset()}touchcancel(){this.reset()}_calculateTransform(t,l,f){f.length>0&&(this._active=!0);const g=Cc(f,l),w=new o.P(0,0),I=new o.P(0,0);let k=0;for(const z in g){const G=g[z],X=this._touches[z];X&&(w._add(G),I._add(G.sub(X)),k++,g[z]=G)}if(this._touches=g,this._shouldBePrevented(k)||!I.mag())return;const R=I.div(k);return this._sum._add(R),this._sum.mag()<this._clickTolerance?void 0:{around:w.div(k),panDelta:R}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Dh{constructor(){this.reset()}reset(){this._active=!1,delete this._firstTwoTouches}touchstart(t,l,f){this._firstTwoTouches||f.length<2||(this._firstTwoTouches=[f[0].identifier,f[1].identifier],this._start([l[0],l[1]]))}touchmove(t,l,f){if(!this._firstTwoTouches)return;t.preventDefault();const[g,w]=this._firstTwoTouches,I=qu(f,l,g),k=qu(f,l,w);if(!I||!k)return;const R=this._aroundCenter?null:I.add(k).div(2);return this._move([I,k],R,t)}touchend(t,l,f){if(!this._firstTwoTouches)return;const[g,w]=this._firstTwoTouches,I=qu(f,l,g),k=qu(f,l,w);I&&k||(this._active&&V.suppressClick(),this.reset())}touchcancel(){this.reset()}enable(t){this._enabled=!0,this._aroundCenter=!!t&&t.around==="center"}disable(){this._enabled=!1,this.reset()}isEnabled(){return!!this._enabled}isActive(){return!!this._active}}function qu(b,t,l){for(let f=0;f<b.length;f++)if(b[f].identifier===l)return t[f]}function hu(b,t){return Math.log(b/t)/Math.LN2}class oa extends Dh{reset(){super.reset(),delete this._distance,delete this._startDistance}_start(t){this._startDistance=this._distance=t[0].dist(t[1])}_move(t,l){const f=this._distance;if(this._distance=t[0].dist(t[1]),this._active||!(Math.abs(hu(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:hu(this._distance,f),pinchAround:l}}}function ni(b,t){return 180*b.angleWith(t)/Math.PI}class Fh extends Dh{reset(){super.reset(),delete this._minDiameter,delete this._startVector,delete this._vector}_start(t){this._startVector=this._vector=t[0].sub(t[1]),this._minDiameter=t[0].dist(t[1])}_move(t,l,f){const g=this._vector;if(this._vector=t[0].sub(t[1]),this._active||!this._isBelowThreshold(this._vector))return this._active=!0,{bearingDelta:ni(this._vector,g),pinchAround:l}}_isBelowThreshold(t){this._minDiameter=Math.min(this._minDiameter,t.mag());const l=25/(Math.PI*this._minDiameter)*360,f=ni(t,this._startVector);return Math.abs(f)<l}}function Zu(b){return Math.abs(b.y)>Math.abs(b.x)}class zh extends Dh{constructor(t){super(),this._currentTouchCount=0,this._map=t}reset(){super.reset(),this._valid=void 0,delete this._firstMove,delete this._lastPoints}touchstart(t,l,f){super.touchstart(t,l,f),this._currentTouchCount=f.length}_start(t){this._lastPoints=t,Zu(t[0].sub(t[1]))&&(this._valid=!1)}_move(t,l,f){if(this._map.cooperativeGestures.isEnabled()&&this._currentTouchCount<3)return;const g=t[0].sub(this._lastPoints[0]),w=t[1].sub(this._lastPoints[1]);return this._valid=this.gestureBeginsVertically(g,w,f.timeStamp),this._valid?(this._lastPoints=t,this._active=!0,{pitchDelta:(g.y+w.y)/2*-.5}):void 0}gestureBeginsVertically(t,l,f){if(this._valid!==void 0)return this._valid;const g=t.mag()>=2,w=l.mag()>=2;if(!g&&!w)return;if(!g||!w)return this._firstMove===void 0&&(this._firstMove=f),f-this._firstMove<100&&void 0;const I=t.y>0==l.y>0;return Zu(t)&&Zu(l)&&I}}const Wu={panStep:100,bearingStep:15,pitchStep:10};class du{constructor(t){this._tr=new lu(t);const l=Wu;this._panStep=l.panStep,this._bearingStep=l.bearingStep,this._pitchStep=l.pitchStep,this._rotationDisabled=!1}reset(){this._active=!1}keydown(t){if(t.altKey||t.ctrlKey||t.metaKey)return;let l=0,f=0,g=0,w=0,I=0;switch(t.keyCode){case 61:case 107:case 171:case 187:l=1;break;case 189:case 109:case 173:l=-1;break;case 37:t.shiftKey?f=-1:(t.preventDefault(),w=-1);break;case 39:t.shiftKey?f=1:(t.preventDefault(),w=1);break;case 38:t.shiftKey?g=1:(t.preventDefault(),I=-1);break;case 40:t.shiftKey?g=-1:(t.preventDefault(),I=1);break;default:return}return this._rotationDisabled&&(f=0,g=0),{cameraAnimation:k=>{const R=this._tr;k.easeTo({duration:300,easeId:"keyboardHandler",easing:Bh,zoom:l?Math.round(R.zoom)+l*(t.shiftKey?2:1):R.zoom,bearing:R.bearing+f*this._bearingStep,pitch:R.pitch+g*this._pitchStep,offset:[-w*this._panStep,-I*this._panStep],center:R.center},{originalEvent:t})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function Bh(b){return b*(2-b)}const ar=4.000244140625,$h=1/450;class Ap{constructor(t,l){this._onTimeout=f=>{this._type="wheel",this._delta-=this._lastValue,this._active||this._start(f)},this._map=t,this._tr=new lu(t),this._triggerRenderFrame=l,this._delta=0,this._defaultZoomRate=.01,this._wheelZoomRate=$h}setZoomRate(t){this._defaultZoomRate=t}setWheelZoomRate(t){this._wheelZoomRate=t}isEnabled(){return!!this._enabled}isActive(){return!!this._active||this._finishTimeout!==void 0}isZooming(){return!!this._zooming}enable(t){this.isEnabled()||(this._enabled=!0,this._aroundCenter=!!t&&t.around==="center")}disable(){this.isEnabled()&&(this._enabled=!1)}_shouldBePrevented(t){return!!this._map.cooperativeGestures.isEnabled()&&!(t.ctrlKey||this._map.cooperativeGestures.isBypassed(t))}wheel(t){if(!this.isEnabled())return;if(this._shouldBePrevented(t))return void this._map.cooperativeGestures.notifyGestureBlocked("wheel_zoom",t);let l=t.deltaMode===WheelEvent.DOM_DELTA_LINE?40*t.deltaY:t.deltaY;const f=Y.now(),g=f-(this._lastWheelEventTime||0);this._lastWheelEventTime=f,l!==0&&l%ar==0?this._type="wheel":l!==0&&Math.abs(l)<4?this._type="trackpad":g>400?(this._type=null,this._lastValue=l,this._timeout=setTimeout(this._onTimeout,40,t)):this._type||(this._type=Math.abs(g*l)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,l+=this._lastValue)),t.shiftKey&&l&&(l/=4),this._type&&(this._lastWheelEvent=t,this._delta-=l,this._active||this._start(t)),t.preventDefault()}_start(t){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);const l=V.mousePos(this._map.getCanvas(),t),f=this._tr;this._aroundPoint=this._aroundCenter?f.transform.locationToScreenPoint(o.S.convert(f.center)):l,this._frameId||(this._frameId=!0,this._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;const t=this._tr.transform;if(typeof this._lastExpectedZoom=="number"){const k=t.zoom-this._lastExpectedZoom;typeof this._startZoom=="number"&&(this._startZoom+=k),typeof this._targetZoom=="number"&&(this._targetZoom+=k)}if(this._delta!==0){const k=this._type==="wheel"&&Math.abs(this._delta)>ar?this._wheelZoomRate:this._defaultZoomRate;let R=2/(1+Math.exp(-Math.abs(this._delta*k)));this._delta<0&&R!==0&&(R=1/R);const z=typeof this._targetZoom!="number"?t.scale:o.ae(this._targetZoom);this._targetZoom=t.getConstrained(t.getCameraLngLat(),o.aj(z*R)).zoom,this._type==="wheel"&&(this._startZoom=t.zoom,this._easing=this._smoothOutEasing(200)),this._delta=0}const l=typeof this._targetZoom!="number"?t.zoom:this._targetZoom,f=this._startZoom,g=this._easing;let w,I=!1;if(this._type==="wheel"&&f&&g){const k=Y.now()-this._lastWheelEventTime,R=Math.min((k+5)/200,1),z=g(R);w=o.C.number(f,l,z),R<1?this._frameId||(this._frameId=!0):I=!0}else w=l,I=!0;return this._active=!0,I&&(this._active=!1,this._finishTimeout=setTimeout(()=>{this._zooming=!1,this._triggerRenderFrame(),delete this._targetZoom,delete this._lastExpectedZoom,delete this._finishTimeout},200)),this._lastExpectedZoom=w,{noInertia:!0,needsRenderFrame:!I,zoomDelta:w-t.zoom,around:this._aroundPoint,originalEvent:this._lastWheelEvent}}_smoothOutEasing(t){let l=o.cn;if(this._prevEase){const f=this._prevEase,g=(Y.now()-f.start)/f.duration,w=f.easing(g+.01)-f.easing(g),I=.27/Math.sqrt(w*w+1e-4)*.01,k=Math.sqrt(.0729-I*I);l=o.cl(I,k,.25,1)}return this._prevEase={start:Y.now(),duration:t,easing:l},l}reset(){this._active=!1,this._zooming=!1,delete this._targetZoom,delete this._lastExpectedZoom,this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout)}}class Nc{constructor(t,l){this._clickZoom=t,this._tapZoom=l}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class tg{constructor(t){this._tr=new lu(t),this.reset()}reset(){this._active=!1}dblclick(t,l){return t.preventDefault(),{cameraAnimation:f=>{f.easeTo({duration:300,zoom:this._tr.zoom+(t.shiftKey?-1:1),around:this._tr.unproject(l)},{originalEvent:t})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class ig{constructor(){this._tap=new Ac({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,delete this._swipePoint,delete this._swipeTouch,delete this._tapTime,delete this._tapPoint,this._tap.reset()}touchstart(t,l,f){if(!this._swipePoint)if(this._tapTime){const g=l[0],w=t.timeStamp-this._tapTime<500,I=this._tapPoint.dist(g)<30;w&&I?f.length>0&&(this._swipePoint=g,this._swipeTouch=f[0].identifier):this.reset()}else this._tap.touchstart(t,l,f)}touchmove(t,l,f){if(this._tapTime){if(this._swipePoint){if(f[0].identifier!==this._swipeTouch)return;const g=l[0],w=g.y-this._swipePoint.y;return this._swipePoint=g,t.preventDefault(),this._active=!0,{zoomDelta:w/128}}}else this._tap.touchmove(t,l,f)}touchend(t,l,f){if(this._tapTime)this._swipePoint&&f.length===0&&this.reset();else{const g=this._tap.touchend(t,l,f);g&&(this._tapTime=t.timeStamp,this._tapPoint=g)}}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class jh{constructor(t,l,f){this._el=t,this._mousePan=l,this._touchPan=f}enable(t){this._inertiaOptions=t||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("maplibregl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("maplibregl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class Oc{constructor(t,l,f,g){this._pitchWithRotate=t.pitchWithRotate,this._rollEnabled=t.rollEnabled,this._mouseRotate=l,this._mousePitch=f,this._mouseRoll=g}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable(),this._rollEnabled&&this._mouseRoll.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable(),this._mouseRoll.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())&&(!this._rollEnabled||this._mouseRoll.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()||this._mouseRoll.isActive()}}class Gh{constructor(t,l,f,g){this._el=t,this._touchZoom=l,this._touchRotate=f,this._tapDragZoom=g,this._rotationDisabled=!1,this._enabled=!0}enable(t){this._touchZoom.enable(t),this._rotationDisabled||this._touchRotate.enable(t),this._tapDragZoom.enable(),this._el.classList.add("maplibregl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("maplibregl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}class Lp{constructor(t,l){this._bypassKey=navigator.userAgent.indexOf("Mac")!==-1?"metaKey":"ctrlKey",this._map=t,this._options=l,this._enabled=!1}isActive(){return!1}reset(){}_setupUI(){if(this._container)return;const t=this._map.getCanvasContainer();t.classList.add("maplibregl-cooperative-gestures"),this._container=V.create("div","maplibregl-cooperative-gesture-screen",t);let l=this._map._getUIString("CooperativeGesturesHandler.WindowsHelpText");this._bypassKey==="metaKey"&&(l=this._map._getUIString("CooperativeGesturesHandler.MacHelpText"));const f=this._map._getUIString("CooperativeGesturesHandler.MobileHelpText"),g=document.createElement("div");g.className="maplibregl-desktop-message",g.textContent=l,this._container.appendChild(g);const w=document.createElement("div");w.className="maplibregl-mobile-message",w.textContent=f,this._container.appendChild(w),this._container.setAttribute("aria-hidden","true")}_destroyUI(){this._container&&(V.remove(this._container),this._map.getCanvasContainer().classList.remove("maplibregl-cooperative-gestures")),delete this._container}enable(){this._setupUI(),this._enabled=!0}disable(){this._enabled=!1,this._destroyUI()}isEnabled(){return this._enabled}isBypassed(t){return t[this._bypassKey]}notifyGestureBlocked(t,l){this._enabled&&(this._map.fire(new o.l("cooperativegestureprevented",{gestureType:t,originalEvent:l})),this._container.classList.add("maplibregl-show"),setTimeout(()=>{this._container.classList.remove("maplibregl-show")},100))}}const Yu=b=>b.zoom||b.drag||b.roll||b.pitch||b.rotate;class rg extends o.l{}function Uh(b){return b.panDelta&&b.panDelta.mag()||b.zoomDelta||b.bearingDelta||b.pitchDelta||b.rollDelta}class Za{constructor(t,l){this.handleWindowEvent=g=>{this.handleEvent(g,`${g.type}Window`)},this.handleEvent=(g,w)=>{if(g.type==="blur")return void this.stop(!0);this._updatingCamera=!0;const I=g.type==="renderFrame"?void 0:g,k={needsRenderFrame:!1},R={},z={};for(const{handlerName:W,handler:te,allowed:ae}of this._handlers){if(!te.isEnabled())continue;let Te;if(this._blockedByActive(z,ae,W))te.reset();else if(te[w||g.type]){if(o.co(g,w||g.type)){const we=V.mousePos(this._map.getCanvas(),g);Te=te[w||g.type](g,we)}else if(o.cp(g,w||g.type)){const we=this._getMapTouches(g.touches),Ee=V.touchPos(this._map.getCanvas(),we);Te=te[w||g.type](g,Ee,we)}else o.cq(w||g.type)||(Te=te[w||g.type](g));this.mergeHandlerResult(k,R,Te,W,I),Te&&Te.needsRenderFrame&&this._triggerRenderFrame()}(Te||te.isActive())&&(z[W]=te)}const G={};for(const W in this._previousActiveHandlers)z[W]||(G[W]=I);this._previousActiveHandlers=z,(Object.keys(G).length||Uh(k))&&(this._changes.push([k,R,G]),this._triggerRenderFrame()),(Object.keys(z).length||Uh(k))&&this._map._stop(!0),this._updatingCamera=!1;const{cameraAnimation:X}=k;X&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],X(this._map))},this._map=t,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new Sp(t),this._bearingSnap=l.bearingSnap,this._previousActiveHandlers={},this._eventsInProgress={},this._addDefaultHandlers(l);const f=this._el;this._listeners=[[f,"touchstart",{passive:!0}],[f,"touchmove",{passive:!1}],[f,"touchend",void 0],[f,"touchcancel",void 0],[f,"mousedown",void 0],[f,"mousemove",void 0],[f,"mouseup",void 0],[document,"mousemove",{capture:!0}],[document,"mouseup",void 0],[f,"mouseover",void 0],[f,"mouseout",void 0],[f,"dblclick",void 0],[f,"click",void 0],[f,"keydown",{capture:!1}],[f,"keyup",void 0],[f,"wheel",{passive:!1}],[f,"contextmenu",void 0],[window,"blur",void 0]];for(const[g,w,I]of this._listeners)V.addEventListener(g,w,g===document?this.handleWindowEvent:this.handleEvent,I)}destroy(){for(const[t,l,f]of this._listeners)V.removeEventListener(t,l,t===document?this.handleWindowEvent:this.handleEvent,f)}_addDefaultHandlers(t){const l=this._map,f=l.getCanvasContainer();this._add("mapEvent",new Mp(l,t));const g=l.boxZoom=new Oh(l,t);this._add("boxZoom",g),t.interactive&&t.boxZoom&&g.enable();const w=l.cooperativeGestures=new Lp(l,t.cooperativeGestures);this._add("cooperativeGestures",w),t.cooperativeGestures&&w.enable();const I=new Lc(l),k=new tg(l);l.doubleClickZoom=new Nc(k,I),this._add("tapZoom",I),this._add("clickZoom",k),t.interactive&&t.doubleClickZoom&&l.doubleClickZoom.enable();const R=new ig;this._add("tapDragZoom",R);const z=l.touchPitch=new zh(l);this._add("touchPitch",z),t.interactive&&t.touchPitch&&l.touchPitch.enable(t.touchPitch);const G=()=>l.project(l.getCenter()),X=function({enable:Oe,clickTolerance:Ue,aroundCenter:We=!0,minPixelCenterThreshold:De=100,rotateDegreesPerPixelMoved:Qe=.8},yt){const ct=new Ds({checkCorrectEvent:dt=>V.mouseButton(dt)===0&&dt.ctrlKey||V.mouseButton(dt)===2&&!dt.ctrlKey});return new uu({clickTolerance:Ue,move:(dt,_t)=>{const qt=yt();if(We&&Math.abs(qt.y-dt.y)>De)return{bearingDelta:o.cm(new o.P(dt.x,_t.y),_t,qt)};let Vt=(_t.x-dt.x)*Qe;return We&&_t.y<qt.y&&(Vt=-Vt),{bearingDelta:Vt}},moveStateManager:ct,enable:Oe,assignEvents:Rc})}(t,G),W=function({enable:Oe,clickTolerance:Ue,pitchDegreesPerPixelMoved:We=-.5}){const De=new Ds({checkCorrectEvent:Qe=>V.mouseButton(Qe)===0&&Qe.ctrlKey||V.mouseButton(Qe)===2});return new uu({clickTolerance:Ue,move:(Qe,yt)=>({pitchDelta:(yt.y-Qe.y)*We}),moveStateManager:De,enable:Oe,assignEvents:Rc})}(t),te=function({enable:Oe,clickTolerance:Ue,rollDegreesPerPixelMoved:We=.3},De){const Qe=new Ds({checkCorrectEvent:yt=>V.mouseButton(yt)===2&&yt.ctrlKey});return new uu({clickTolerance:Ue,move:(yt,ct)=>{const dt=De();let _t=(ct.x-yt.x)*We;return ct.y<dt.y&&(_t=-_t),{rollDelta:_t}},moveStateManager:Qe,enable:Oe,assignEvents:Rc})}(t,G);l.dragRotate=new Oc(t,X,W,te),this._add("mouseRotate",X,["mousePitch"]),this._add("mousePitch",W,["mouseRotate","mouseRoll"]),this._add("mouseRoll",te,["mousePitch"]),t.interactive&&t.dragRotate&&l.dragRotate.enable();const ae=function({enable:Oe,clickTolerance:Ue}){const We=new Ds({checkCorrectEvent:De=>V.mouseButton(De)===0&&!De.ctrlKey});return new uu({clickTolerance:Ue,move:(De,Qe)=>({around:Qe,panDelta:Qe.sub(De)}),activateOnStart:!0,moveStateManager:We,enable:Oe,assignEvents:Rc})}(t),Te=new eg(t,l);l.dragPan=new jh(f,ae,Te),this._add("mousePan",ae),this._add("touchPan",Te,["touchZoom","touchRotate"]),t.interactive&&t.dragPan&&l.dragPan.enable(t.dragPan);const we=new Fh,Ee=new oa;l.touchZoomRotate=new Gh(f,Ee,we,R),this._add("touchRotate",we,["touchPan","touchZoom"]),this._add("touchZoom",Ee,["touchPan","touchRotate"]),t.interactive&&t.touchZoomRotate&&l.touchZoomRotate.enable(t.touchZoomRotate);const Ce=l.scrollZoom=new Ap(l,()=>this._triggerRenderFrame());this._add("scrollZoom",Ce,["mousePan"]),t.interactive&&t.scrollZoom&&l.scrollZoom.enable(t.scrollZoom);const Fe=l.keyboard=new du(l);this._add("keyboard",Fe),t.interactive&&t.keyboard&&l.keyboard.enable(),this._add("blockableMapEvent",new Pp(l))}_add(t,l,f){this._handlers.push({handlerName:t,handler:l,allowed:f}),this._handlersById[t]=l}stop(t){if(!this._updatingCamera){for(const{handler:l}of this._handlers)l.reset();this._inertia.clear(),this._fireEvents({},{},t),this._changes=[]}}isActive(){for(const{handler:t}of this._handlers)if(t.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return!!Yu(this._eventsInProgress)||this.isZooming()}_blockedByActive(t,l,f){for(const g in t)if(g!==f&&(!l||l.indexOf(g)<0))return!0;return!1}_getMapTouches(t){const l=[];for(const f of t)this._el.contains(f.target)&&l.push(f);return l}mergeHandlerResult(t,l,f,g,w){if(!f)return;o.e(t,f);const I={handlerName:g,originalEvent:f.originalEvent||w};f.zoomDelta!==void 0&&(l.zoom=I),f.panDelta!==void 0&&(l.drag=I),f.rollDelta!==void 0&&(l.roll=I),f.pitchDelta!==void 0&&(l.pitch=I),f.bearingDelta!==void 0&&(l.rotate=I)}_applyChanges(){const t={},l={},f={};for(const[g,w,I]of this._changes)g.panDelta&&(t.panDelta=(t.panDelta||new o.P(0,0))._add(g.panDelta)),g.zoomDelta&&(t.zoomDelta=(t.zoomDelta||0)+g.zoomDelta),g.bearingDelta&&(t.bearingDelta=(t.bearingDelta||0)+g.bearingDelta),g.pitchDelta&&(t.pitchDelta=(t.pitchDelta||0)+g.pitchDelta),g.rollDelta&&(t.rollDelta=(t.rollDelta||0)+g.rollDelta),g.around!==void 0&&(t.around=g.around),g.pinchAround!==void 0&&(t.pinchAround=g.pinchAround),g.noInertia&&(t.noInertia=g.noInertia),o.e(l,w),o.e(f,I);this._updateMapTransform(t,l,f),this._changes=[]}_updateMapTransform(t,l,f){const g=this._map,w=g._getTransformForUpdate(),I=g.terrain;if(!(Uh(t)||I&&this._terrainMovement))return this._fireEvents(l,f,!0);g._stop(!0);let{panDelta:k,zoomDelta:R,bearingDelta:z,pitchDelta:G,rollDelta:X,around:W,pinchAround:te}=t;te!==void 0&&(W=te),W=W||g.transform.centerPoint,I&&!w.isPointOnMapSurface(W)&&(W=w.centerPoint);const ae={panDelta:k,zoomDelta:R,rollDelta:X,pitchDelta:G,bearingDelta:z,around:W};this._map.cameraHelper.useGlobeControls&&!w.isPointOnMapSurface(W)&&(W=w.centerPoint);const Te=W.distSqr(w.centerPoint)<.01?w.center:w.screenPointToLocation(k?W.sub(k):W);I?(this._map.cameraHelper.handleMapControlsRollPitchBearingZoom(ae,w),this._terrainMovement||!l.drag&&!l.zoom?l.drag&&this._terrainMovement?w.setCenter(w.screenPointToLocation(w.centerPoint.sub(k))):this._map.cameraHelper.handleMapControlsPan(ae,w,Te):(this._terrainMovement=!0,this._map._elevationFreeze=!0,this._map.cameraHelper.handleMapControlsPan(ae,w,Te))):(this._map.cameraHelper.handleMapControlsRollPitchBearingZoom(ae,w),this._map.cameraHelper.handleMapControlsPan(ae,w,Te)),g._applyUpdatedTransform(w),this._map._update(),t.noInertia||this._inertia.record(t),this._fireEvents(l,f,!0)}_fireEvents(t,l,f){const g=Yu(this._eventsInProgress),w=Yu(t),I={};for(const X in t){const{originalEvent:W}=t[X];this._eventsInProgress[X]||(I[`${X}start`]=W),this._eventsInProgress[X]=t[X]}!g&&w&&this._fireEvent("movestart",w.originalEvent);for(const X in I)this._fireEvent(X,I[X]);w&&this._fireEvent("move",w.originalEvent);for(const X in t){const{originalEvent:W}=t[X];this._fireEvent(X,W)}const k={};let R;for(const X in this._eventsInProgress){const{handlerName:W,originalEvent:te}=this._eventsInProgress[X];this._handlersById[W].isActive()||(delete this._eventsInProgress[X],R=l[W]||te,k[`${X}end`]=R)}for(const X in k)this._fireEvent(X,k[X]);const z=Yu(this._eventsInProgress),G=(g||w)&&!z;if(G&&this._terrainMovement){this._map._elevationFreeze=!1,this._terrainMovement=!1;const X=this._map._getTransformForUpdate();this._map.getCenterClampedToGround()&&X.recalculateZoomAndCenter(this._map.terrain),this._map._applyUpdatedTransform(X)}if(f&&G){this._updatingCamera=!0;const X=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),W=te=>te!==0&&-this._bearingSnap<te&&te<this._bearingSnap;!X||!X.essential&&Y.prefersReducedMotion?(this._map.fire(new o.l("moveend",{originalEvent:R})),W(this._map.getBearing())&&this._map.resetNorth()):(W(X.bearing||this._map.getBearing())&&(X.bearing=0),X.freezeElevation=!0,this._map.easeTo(X,{originalEvent:R})),this._updatingCamera=!1}}_fireEvent(t,l){this._map.fire(new o.l(t,l?{originalEvent:l}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add(t=>{delete this._frameId,this.handleEvent(new rg("renderFrame",{timeStamp:t})),this._applyChanges()})}_triggerRenderFrame(){this._frameId===void 0&&(this._frameId=this._requestFrame())}}class en extends o.E{constructor(t,l,f){super(),this._renderFrameCallback=()=>{const g=Math.min((Y.now()-this._easeStart)/this._easeOptions.duration,1);this._onEaseFrame(this._easeOptions.easing(g)),g<1&&this._easeFrameId?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()},this._moving=!1,this._zooming=!1,this.transform=t,this._bearingSnap=f.bearingSnap,this.cameraHelper=l,this.on("moveend",()=>{delete this._requestedCameraState})}migrateProjection(t,l){t.apply(this.transform),this.transform=t,this.cameraHelper=l}getCenter(){return new o.S(this.transform.center.lng,this.transform.center.lat)}setCenter(t,l){return this.jumpTo({center:t},l)}getCenterElevation(){return this.transform.elevation}setCenterElevation(t,l){return this.jumpTo({elevation:t},l),this}getCenterClampedToGround(){return this._centerClampedToGround}setCenterClampedToGround(t){this._centerClampedToGround=t}panBy(t,l,f){return t=o.P.convert(t).mult(-1),this.panTo(this.transform.center,o.e({offset:t},l),f)}panTo(t,l,f){return this.easeTo(o.e({center:t},l),f)}getZoom(){return this.transform.zoom}setZoom(t,l){return this.jumpTo({zoom:t},l),this}zoomTo(t,l,f){return this.easeTo(o.e({zoom:t},l),f)}zoomIn(t,l){return this.zoomTo(this.getZoom()+1,t,l),this}zoomOut(t,l){return this.zoomTo(this.getZoom()-1,t,l),this}getVerticalFieldOfView(){return this.transform.fov}setVerticalFieldOfView(t,l){return t!=this.transform.fov&&(this.transform.setFov(t),this.fire(new o.l("movestart",l)).fire(new o.l("move",l)).fire(new o.l("moveend",l))),this}getBearing(){return this.transform.bearing}setBearing(t,l){return this.jumpTo({bearing:t},l),this}getPadding(){return this.transform.padding}setPadding(t,l){return this.jumpTo({padding:t},l),this}rotateTo(t,l,f){return this.easeTo(o.e({bearing:t},l),f)}resetNorth(t,l){return this.rotateTo(0,o.e({duration:1e3},t),l),this}resetNorthPitch(t,l){return this.easeTo(o.e({bearing:0,pitch:0,roll:0,duration:1e3},t),l),this}snapToNorth(t,l){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(t,l):this}getPitch(){return this.transform.pitch}setPitch(t,l){return this.jumpTo({pitch:t},l),this}getRoll(){return this.transform.roll}setRoll(t,l){return this.jumpTo({roll:t},l),this}cameraForBounds(t,l){t=zi.convert(t).adjustAntiMeridian();const f=l&&l.bearing||0;return this._cameraForBoxAndBearing(t.getNorthWest(),t.getSouthEast(),f,l)}_cameraForBoxAndBearing(t,l,f,g){const w={top:0,bottom:0,right:0,left:0};if(typeof(g=o.e({padding:w,offset:[0,0],maxZoom:this.transform.maxZoom},g)).padding=="number"){const z=g.padding;g.padding={top:z,bottom:z,right:z,left:z}}const I=o.e(w,g.padding);g.padding=I;const k=this.transform,R=new zi(t,l);return this.cameraHelper.cameraForBoxAndBearing(g,I,R,f,k)}fitBounds(t,l,f){return this._fitInternal(this.cameraForBounds(t,l),l,f)}fitScreenCoordinates(t,l,f,g,w){return this._fitInternal(this._cameraForBoxAndBearing(this.transform.screenPointToLocation(o.P.convert(t)),this.transform.screenPointToLocation(o.P.convert(l)),f,g),g,w)}_fitInternal(t,l,f){return t?(delete(l=o.e(t,l)).padding,l.linear?this.easeTo(l,f):this.flyTo(l,f)):this}jumpTo(t,l){this.stop();const f=this._getTransformForUpdate();let g=!1,w=!1,I=!1;const k=f.zoom;this.cameraHelper.handleJumpToCenterZoom(f,t);const R=f.zoom!==k;return"elevation"in t&&f.elevation!==+t.elevation&&f.setElevation(+t.elevation),"bearing"in t&&f.bearing!==+t.bearing&&(g=!0,f.setBearing(+t.bearing)),"pitch"in t&&f.pitch!==+t.pitch&&(w=!0,f.setPitch(+t.pitch)),"roll"in t&&f.roll!==+t.roll&&(I=!0,f.setRoll(+t.roll)),t.padding==null||f.isPaddingEqual(t.padding)||f.setPadding(t.padding),this._applyUpdatedTransform(f),this.fire(new o.l("movestart",l)).fire(new o.l("move",l)),R&&this.fire(new o.l("zoomstart",l)).fire(new o.l("zoom",l)).fire(new o.l("zoomend",l)),g&&this.fire(new o.l("rotatestart",l)).fire(new o.l("rotate",l)).fire(new o.l("rotateend",l)),w&&this.fire(new o.l("pitchstart",l)).fire(new o.l("pitch",l)).fire(new o.l("pitchend",l)),I&&this.fire(new o.l("rollstart",l)).fire(new o.l("roll",l)).fire(new o.l("rollend",l)),this.fire(new o.l("moveend",l))}calculateCameraOptionsFromTo(t,l,f,g=0){const w=o.a0.fromLngLat(t,l),I=o.a0.fromLngLat(f,g),k=I.x-w.x,R=I.y-w.y,z=I.z-w.z,G=Math.hypot(k,R,z);if(G===0)throw new Error("Can't calculate camera options with same From and To");const X=Math.hypot(k,R),W=o.aj(this.transform.cameraToCenterDistance/G/this.transform.tileSize),te=180*Math.atan2(k,-R)/Math.PI;let ae=180*Math.acos(X/G)/Math.PI;return ae=z<0?90-ae:90+ae,{center:I.toLngLat(),elevation:g,zoom:W,pitch:ae,bearing:te}}calculateCameraOptionsFromCameraLngLatAltRotation(t,l,f,g,w){const I=this.transform.calculateCenterFromCameraLngLatAlt(t,l,f,g);return{center:I.center,elevation:I.elevation,zoom:I.zoom,bearing:f,pitch:g,roll:w}}easeTo(t,l){this._stop(!1,t.easeId),((t=o.e({offset:[0,0],duration:500,easing:o.cn},t)).animate===!1||!t.essential&&Y.prefersReducedMotion)&&(t.duration=0);const f=this._getTransformForUpdate(),g=this.getBearing(),w=f.pitch,I=f.roll,k="bearing"in t?this._normalizeBearing(t.bearing,g):g,R="pitch"in t?+t.pitch:w,z="roll"in t?this._normalizeBearing(t.roll,I):I,G="padding"in t?t.padding:f.padding,X=o.P.convert(t.offset);let W,te;t.around&&(W=o.S.convert(t.around),te=f.locationToScreenPoint(W));const ae={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching,rolling:this._rolling},Te=this.cameraHelper.handleEaseTo(f,{bearing:k,pitch:R,roll:z,padding:G,around:W,aroundPoint:te,offsetAsPoint:X,offset:t.offset,zoom:t.zoom,center:t.center});return this._rotating=this._rotating||g!==k,this._pitching=this._pitching||R!==w,this._rolling=this._rolling||z!==I,this._padding=!f.isPaddingEqual(G),this._zooming=this._zooming||Te.isZooming,this._easeId=t.easeId,this._prepareEase(l,t.noMoveStart,ae),this.terrain&&this._prepareElevation(Te.elevationCenter),this._ease(we=>{Te.easeFunc(we),this.terrain&&!t.freezeElevation&&this._updateElevation(we),this._applyUpdatedTransform(f),this._fireMoveEvents(l)},we=>{this.terrain&&t.freezeElevation&&this._finalizeElevation(),this._afterEase(l,we)},t),this}_prepareEase(t,l,f={}){this._moving=!0,l||f.moving||this.fire(new o.l("movestart",t)),this._zooming&&!f.zooming&&this.fire(new o.l("zoomstart",t)),this._rotating&&!f.rotating&&this.fire(new o.l("rotatestart",t)),this._pitching&&!f.pitching&&this.fire(new o.l("pitchstart",t)),this._rolling&&!f.rolling&&this.fire(new o.l("rollstart",t))}_prepareElevation(t){this._elevationCenter=t,this._elevationStart=this.transform.elevation,this._elevationTarget=this.terrain.getElevationForLngLatZoom(t,this.transform.tileZoom),this._elevationFreeze=!0}_updateElevation(t){this.transform.setMinElevationForCurrentTile(this.terrain.getMinTileElevationForLngLatZoom(this._elevationCenter,this.transform.tileZoom));const l=this.terrain.getElevationForLngLatZoom(this._elevationCenter,this.transform.tileZoom);if(t<1&&l!==this._elevationTarget){const f=this._elevationTarget-this._elevationStart;this._elevationStart+=t*(f-(l-(f*t+this._elevationStart))/(1-t)),this._elevationTarget=l}this.transform.setElevation(o.C.number(this._elevationStart,this._elevationTarget,t))}_finalizeElevation(){this._elevationFreeze=!1,this.getCenterClampedToGround()&&this.transform.recalculateZoomAndCenter(this.terrain)}_getTransformForUpdate(){return this.transformCameraUpdate||this.terrain?(this._requestedCameraState||(this._requestedCameraState=this.transform.clone()),this._requestedCameraState):this.transform}_elevateCameraIfInsideTerrain(t){if(!this.terrain&&t.elevation>=0&&t.pitch<=90)return{};const l=t.getCameraLngLat(),f=t.getCameraAltitude(),g=this.terrain?this.terrain.getElevationForLngLatZoom(l,t.zoom):0;if(f<g){const w=this.calculateCameraOptionsFromTo(l,g,t.center,t.elevation);return{pitch:w.pitch,zoom:w.zoom}}return{}}_applyUpdatedTransform(t){const l=[];if(l.push(g=>this._elevateCameraIfInsideTerrain(g)),this.transformCameraUpdate&&l.push(g=>this.transformCameraUpdate(g)),!l.length)return;const f=t.clone();for(const g of l){const w=f.clone(),{center:I,zoom:k,roll:R,pitch:z,bearing:G,elevation:X}=g(w);I&&w.setCenter(I),X!==void 0&&w.setElevation(X),k!==void 0&&w.setZoom(k),R!==void 0&&w.setRoll(R),z!==void 0&&w.setPitch(z),G!==void 0&&w.setBearing(G),f.apply(w)}this.transform.apply(f)}_fireMoveEvents(t){this.fire(new o.l("move",t)),this._zooming&&this.fire(new o.l("zoom",t)),this._rotating&&this.fire(new o.l("rotate",t)),this._pitching&&this.fire(new o.l("pitch",t)),this._rolling&&this.fire(new o.l("roll",t))}_afterEase(t,l){if(this._easeId&&l&&this._easeId===l)return;delete this._easeId;const f=this._zooming,g=this._rotating,w=this._pitching,I=this._rolling;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._rolling=!1,this._padding=!1,f&&this.fire(new o.l("zoomend",t)),g&&this.fire(new o.l("rotateend",t)),w&&this.fire(new o.l("pitchend",t)),I&&this.fire(new o.l("rollend",t)),this.fire(new o.l("moveend",t))}flyTo(t,l){if(!t.essential&&Y.prefersReducedMotion){const _t=o.Q(t,["center","zoom","bearing","pitch","roll","elevation"]);return this.jumpTo(_t,l)}this.stop(),t=o.e({offset:[0,0],speed:1.2,curve:1.42,easing:o.cn},t);const f=this._getTransformForUpdate(),g=f.bearing,w=f.pitch,I=f.roll,k=f.padding,R="bearing"in t?this._normalizeBearing(t.bearing,g):g,z="pitch"in t?+t.pitch:w,G="roll"in t?this._normalizeBearing(t.roll,I):I,X="padding"in t?t.padding:f.padding,W=o.P.convert(t.offset);let te=f.centerPoint.add(W);const ae=f.screenPointToLocation(te),Te=this.cameraHelper.handleFlyTo(f,{bearing:R,pitch:z,roll:G,padding:X,locationAtOffset:ae,offsetAsPoint:W,center:t.center,minZoom:t.minZoom,zoom:t.zoom});let we=t.curve;const Ee=Math.max(f.width,f.height),Ce=Ee/Te.scaleOfZoom,Fe=Te.pixelPathLength;typeof Te.scaleOfMinZoom=="number"&&(we=Math.sqrt(Ee/Te.scaleOfMinZoom/Fe*2));const Oe=we*we;function Ue(_t){const qt=(Ce*Ce-Ee*Ee+(_t?-1:1)*Oe*Oe*Fe*Fe)/(2*(_t?Ce:Ee)*Oe*Fe);return Math.log(Math.sqrt(qt*qt+1)-qt)}function We(_t){return(Math.exp(_t)-Math.exp(-_t))/2}function De(_t){return(Math.exp(_t)+Math.exp(-_t))/2}const Qe=Ue(!1);let yt=function(_t){return De(Qe)/De(Qe+we*_t)},ct=function(_t){return Ee*((De(Qe)*(We(qt=Qe+we*_t)/De(qt))-We(Qe))/Oe)/Fe;var qt},dt=(Ue(!0)-Qe)/we;if(Math.abs(Fe)<2e-6||!isFinite(dt)){if(Math.abs(Ee-Ce)<1e-6)return this.easeTo(t,l);const _t=Ce<Ee?-1:1;dt=Math.abs(Math.log(Ce/Ee))/we,ct=()=>0,yt=qt=>Math.exp(_t*we*qt)}return t.duration="duration"in t?+t.duration:1e3*dt/("screenSpeed"in t?+t.screenSpeed/we:+t.speed),t.maxDuration&&t.duration>t.maxDuration&&(t.duration=0),this._zooming=!0,this._rotating=g!==R,this._pitching=z!==w,this._rolling=G!==I,this._padding=!f.isPaddingEqual(X),this._prepareEase(l,!1),this.terrain&&this._prepareElevation(Te.targetCenter),this._ease(_t=>{const qt=_t*dt,Vt=1/yt(qt),kt=ct(qt);this._rotating&&f.setBearing(o.C.number(g,R,_t)),this._pitching&&f.setPitch(o.C.number(w,z,_t)),this._rolling&&f.setRoll(o.C.number(I,G,_t)),this._padding&&(f.interpolatePadding(k,X,_t),te=f.centerPoint.add(W)),Te.easeFunc(_t,Vt,kt,te),this.terrain&&!t.freezeElevation&&this._updateElevation(_t),this._applyUpdatedTransform(f),this._fireMoveEvents(l)},()=>{this.terrain&&t.freezeElevation&&this._finalizeElevation(),this._afterEase(l)},t),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_stop(t,l){var f;if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),delete this._easeFrameId,delete this._onEaseFrame),this._onEaseEnd){const g=this._onEaseEnd;delete this._onEaseEnd,g.call(this,l)}return t||(f=this.handlers)===null||f===void 0||f.stop(!1),this}_ease(t,l,f){f.animate===!1||f.duration===0?(t(1),l()):(this._easeStart=Y.now(),this._easeOptions=f,this._onEaseFrame=t,this._onEaseEnd=l,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_normalizeBearing(t,l){t=o.aN(t,-180,180);const f=Math.abs(t-l);return Math.abs(t-360-l)<f&&(t-=360),Math.abs(t+360-l)<f&&(t+=360),t}queryTerrainElevation(t){return this.terrain?this.terrain.getElevationForLngLatZoom(o.S.convert(t),this.transform.tileZoom):null}}const Xu={compact:!0,customAttribution:'<a href="https://maplibre.org/" target="_blank">MapLibre</a>'};class Dc{constructor(t=Xu){this._toggleAttribution=()=>{this._container.classList.contains("maplibregl-compact")&&(this._container.classList.contains("maplibregl-compact-show")?(this._container.setAttribute("open",""),this._container.classList.remove("maplibregl-compact-show")):(this._container.classList.add("maplibregl-compact-show"),this._container.removeAttribute("open")))},this._updateData=l=>{!l||l.sourceDataType!=="metadata"&&l.sourceDataType!=="visibility"&&l.dataType!=="style"&&l.type!=="terrain"||this._updateAttributions()},this._updateCompact=()=>{this._map.getCanvasContainer().offsetWidth<=640||this._compact?this._compact===!1?this._container.setAttribute("open",""):this._container.classList.contains("maplibregl-compact")||this._container.classList.contains("maplibregl-attrib-empty")||(this._container.setAttribute("open",""),this._container.classList.add("maplibregl-compact","maplibregl-compact-show")):(this._container.setAttribute("open",""),this._container.classList.contains("maplibregl-compact")&&this._container.classList.remove("maplibregl-compact","maplibregl-compact-show"))},this._updateCompactMinimize=()=>{this._container.classList.contains("maplibregl-compact")&&this._container.classList.contains("maplibregl-compact-show")&&this._container.classList.remove("maplibregl-compact-show")},this.options=t}getDefaultPosition(){return"bottom-right"}onAdd(t){return this._map=t,this._compact=this.options.compact,this._container=V.create("details","maplibregl-ctrl maplibregl-ctrl-attrib"),this._compactButton=V.create("summary","maplibregl-ctrl-attrib-button",this._container),this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=V.create("div","maplibregl-ctrl-attrib-inner",this._container),this._updateAttributions(),this._updateCompact(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("terrain",this._updateData),this._map.on("resize",this._updateCompact),this._map.on("drag",this._updateCompactMinimize),this._container}onRemove(){V.remove(this._container),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("terrain",this._updateData),this._map.off("resize",this._updateCompact),this._map.off("drag",this._updateCompactMinimize),this._map=void 0,this._compact=void 0,this._attribHTML=void 0}_setElementTitle(t,l){const f=this._map._getUIString(`AttributionControl.${l}`);t.title=f,t.setAttribute("aria-label",f)}_updateAttributions(){if(!this._map.style)return;let t=[];if(this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?t=t.concat(this.options.customAttribution.map(g=>typeof g!="string"?"":g)):typeof this.options.customAttribution=="string"&&t.push(this.options.customAttribution)),this._map.style.stylesheet){const g=this._map.style.stylesheet;this.styleOwner=g.owner,this.styleId=g.id}const l=this._map.style.sourceCaches;for(const g in l){const w=l[g];if(w.used||w.usedForTerrain){const I=w.getSource();I.attribution&&t.indexOf(I.attribution)<0&&t.push(I.attribution)}}t=t.filter(g=>String(g).trim()),t.sort((g,w)=>g.length-w.length),t=t.filter((g,w)=>{for(let I=w+1;I<t.length;I++)if(t[I].indexOf(g)>=0)return!1;return!0});const f=t.join(" | ");f!==this._attribHTML&&(this._attribHTML=f,t.length?(this._innerContainer.innerHTML=V.sanitize(f),this._container.classList.remove("maplibregl-attrib-empty")):this._container.classList.add("maplibregl-attrib-empty"),this._updateCompact(),this._editLink=null)}}class Vh{constructor(t={}){this._updateCompact=()=>{const l=this._container.children;if(l.length){const f=l[0];this._map.getCanvasContainer().offsetWidth<=640||this._compact?this._compact!==!1&&f.classList.add("maplibregl-compact"):f.classList.remove("maplibregl-compact")}},this.options=t}getDefaultPosition(){return"bottom-left"}onAdd(t){this._map=t,this._compact=this.options&&this.options.compact,this._container=V.create("div","maplibregl-ctrl");const l=V.create("a","maplibregl-ctrl-logo");return l.target="_blank",l.rel="noopener nofollow",l.href="https://maplibre.org/",l.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),l.setAttribute("rel","noopener nofollow"),this._container.appendChild(l),this._container.style.display="block",this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){V.remove(this._container),this._map.off("resize",this._updateCompact),this._map=void 0,this._compact=void 0}}class Rp{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(t){const l=++this._id;return this._queue.push({callback:t,id:l,cancelled:!1}),l}remove(t){const l=this._currentlyRunning,f=l?this._queue.concat(l):this._queue;for(const g of f)if(g.id===t)return void(g.cancelled=!0)}run(t=0){if(this._currentlyRunning)throw new Error("Attempting to run(), but is already running.");const l=this._currentlyRunning=this._queue;this._queue=[];for(const f of l)if(!f.cancelled&&(f.callback(t),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}var Np=o.aI([{name:"a_pos3d",type:"Int16",components:3}]);class ng extends o.E{constructor(t){super(),this._lastTilesetChange=Y.now(),this.sourceCache=t,this._tiles={},this._renderableTilesKeys=[],this._sourceTileCache={},this.minzoom=0,this.maxzoom=22,this.deltaZoom=1,this.tileSize=t._source.tileSize*2**this.deltaZoom,t.usedForTerrain=!0,t.tileSize=this.tileSize}destruct(){this.sourceCache.usedForTerrain=!1,this.sourceCache.tileSize=null}update(t,l){this.sourceCache.update(t,l),this._renderableTilesKeys=[];const f={};for(const g of ft(t,{tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,reparseOverscaled:!1,terrain:l,calculateTileZoom:this.sourceCache._source.calculateTileZoom}))f[g.key]=!0,this._renderableTilesKeys.push(g.key),this._tiles[g.key]||(g.terrainRttPosMatrix32f=new Float64Array(16),o.bX(g.terrainRttPosMatrix32f,0,o.$,o.$,0,0,1),this._tiles[g.key]=new oi(g,this.tileSize),this._lastTilesetChange=Y.now());for(const g in this._tiles)f[g]||delete this._tiles[g]}freeRtt(t){for(const l in this._tiles){const f=this._tiles[l];(!t||f.tileID.equals(t)||f.tileID.isChildOf(t)||t.isChildOf(f.tileID))&&(f.rtt=[])}}getRenderableTiles(){return this._renderableTilesKeys.map(t=>this.getTileByID(t))}getTileByID(t){return this._tiles[t]}getTerrainCoords(t,l){return l?this._getTerrainCoordsForTileRanges(t,l):this._getTerrainCoordsForRegularTile(t)}_getTerrainCoordsForRegularTile(t){const l={};for(const f of this._renderableTilesKeys){const g=this._tiles[f].tileID,w=t.clone(),I=o.b9();if(g.canonical.equals(t.canonical))o.bX(I,0,o.$,o.$,0,0,1);else if(g.canonical.isChildOf(t.canonical)){const k=g.canonical.z-t.canonical.z,R=g.canonical.x-(g.canonical.x>>k<<k),z=g.canonical.y-(g.canonical.y>>k<<k),G=o.$>>k;o.bX(I,0,G,G,0,0,1),o.M(I,I,[-R*G,-z*G,0])}else{if(!t.canonical.isChildOf(g.canonical))continue;{const k=t.canonical.z-g.canonical.z,R=t.canonical.x-(t.canonical.x>>k<<k),z=t.canonical.y-(t.canonical.y>>k<<k),G=o.$>>k;o.bX(I,0,o.$,o.$,0,0,1),o.M(I,I,[R*G,z*G,0]),o.N(I,I,[1/2**k,1/2**k,0])}}w.terrainRttPosMatrix32f=new Float32Array(I),l[f]=w}return l}_getTerrainCoordsForTileRanges(t,l){const f={};for(const g of this._renderableTilesKeys){const w=this._tiles[g].tileID;if(!this._isWithinTileRanges(w,l))continue;const I=t.clone(),k=o.b9();if(w.canonical.z===t.canonical.z){const R=t.canonical.x-w.canonical.x,z=t.canonical.y-w.canonical.y;o.bX(k,0,o.$,o.$,0,0,1),o.M(k,k,[R*o.$,z*o.$,0])}else if(w.canonical.z>t.canonical.z){const R=w.canonical.z-t.canonical.z,z=w.canonical.x-(w.canonical.x>>R<<R),G=w.canonical.y-(w.canonical.y>>R<<R),X=t.canonical.x-(w.canonical.x>>R),W=t.canonical.y-(w.canonical.y>>R),te=o.$>>R;o.bX(k,0,te,te,0,0,1),o.M(k,k,[-z*te+X*o.$,-G*te+W*o.$,0])}else{const R=t.canonical.z-w.canonical.z,z=t.canonical.x-(t.canonical.x>>R<<R),G=t.canonical.y-(t.canonical.y>>R<<R),X=(t.canonical.x>>R)-w.canonical.x,W=(t.canonical.y>>R)-w.canonical.y,te=o.$<<R;o.bX(k,0,te,te,0,0,1),o.M(k,k,[z*o.$+X*te,G*o.$+W*te,0])}I.terrainRttPosMatrix32f=new Float32Array(k),f[g]=I}return f}getSourceTile(t,l){const f=this.sourceCache._source;let g=t.overscaledZ-this.deltaZoom;if(g>f.maxzoom&&(g=f.maxzoom),g<f.minzoom)return null;this._sourceTileCache[t.key]||(this._sourceTileCache[t.key]=t.scaledTo(g).key);let w=this.sourceCache.getTileByID(this._sourceTileCache[t.key]);if((!w||!w.dem)&&l)for(;g>=f.minzoom&&(!w||!w.dem);)w=this.sourceCache.getTileByID(t.scaledTo(g--).key);return w}anyTilesAfterTime(t=Date.now()){return this._lastTilesetChange>=t}_isWithinTileRanges(t,l){return l[t.canonical.z]&&t.canonical.x>=l[t.canonical.z].minTileX&&t.canonical.x<=l[t.canonical.z].maxTileX&&t.canonical.y>=l[t.canonical.z].minTileY&&t.canonical.y<=l[t.canonical.z].maxTileY}}class aa{constructor(t,l,f){this._meshCache={},this.painter=t,this.sourceCache=new ng(l),this.options=f,this.exaggeration=typeof f.exaggeration=="number"?f.exaggeration:1,this.qualityFactor=2,this.meshSize=128,this._demMatrixCache={},this.coordsIndex=[],this._coordsTextureSize=1024}getDEMElevation(t,l,f,g=o.$){var w;if(!(l>=0&&l<g&&f>=0&&f<g))return 0;const I=this.getTerrainData(t),k=(w=I.tile)===null||w===void 0?void 0:w.dem;if(!k)return 0;const R=o.cr([],[l/g*o.$,f/g*o.$],I.u_terrain_matrix),z=[R[0]*k.dim,R[1]*k.dim],G=Math.floor(z[0]),X=Math.floor(z[1]),W=z[0]-G,te=z[1]-X;return k.get(G,X)*(1-W)*(1-te)+k.get(G+1,X)*W*(1-te)+k.get(G,X+1)*(1-W)*te+k.get(G+1,X+1)*W*te}getElevationForLngLatZoom(t,l){if(!o.cs(l,t.wrap()))return 0;const{tileID:f,mercatorX:g,mercatorY:w}=this._getOverscaledTileIDFromLngLatZoom(t,l);return this.getElevation(f,g%o.$,w%o.$,o.$)}getElevation(t,l,f,g=o.$){return this.getDEMElevation(t,l,f,g)*this.exaggeration}getTerrainData(t){if(!this._emptyDemTexture){const g=this.painter.context,w=new o.R({width:1,height:1},new Uint8Array(4));this._emptyDepthTexture=new o.T(g,w,g.gl.RGBA,{premultiply:!1}),this._emptyDemUnpack=[0,0,0,0],this._emptyDemTexture=new o.T(g,new o.R({width:1,height:1}),g.gl.RGBA,{premultiply:!1}),this._emptyDemTexture.bind(g.gl.NEAREST,g.gl.CLAMP_TO_EDGE),this._emptyDemMatrix=o.af([])}const l=this.sourceCache.getSourceTile(t,!0);if(l&&l.dem&&(!l.demTexture||l.needsTerrainPrepare)){const g=this.painter.context;l.demTexture=this.painter.getTileTexture(l.dem.stride),l.demTexture?l.demTexture.update(l.dem.getPixels(),{premultiply:!1}):l.demTexture=new o.T(g,l.dem.getPixels(),g.gl.RGBA,{premultiply:!1}),l.demTexture.bind(g.gl.NEAREST,g.gl.CLAMP_TO_EDGE),l.needsTerrainPrepare=!1}const f=l&&l+l.tileID.key+t.key;if(f&&!this._demMatrixCache[f]){const g=this.sourceCache.sourceCache._source.maxzoom;let w=t.canonical.z-l.tileID.canonical.z;t.overscaledZ>t.canonical.z&&(t.canonical.z>=g?w=t.canonical.z-g:o.w("cannot calculate elevation if elevation maxzoom > source.maxzoom"));const I=t.canonical.x-(t.canonical.x>>w<<w),k=t.canonical.y-(t.canonical.y>>w<<w),R=o.ct(new Float64Array(16),[1/(o.$<<w),1/(o.$<<w),0]);o.M(R,R,[I*o.$,k*o.$,0]),this._demMatrixCache[t.key]={matrix:R,coord:t}}return{u_depth:2,u_terrain:3,u_terrain_dim:l&&l.dem&&l.dem.dim||1,u_terrain_matrix:f?this._demMatrixCache[t.key].matrix:this._emptyDemMatrix,u_terrain_unpack:l&&l.dem&&l.dem.getUnpackVector()||this._emptyDemUnpack,u_terrain_exaggeration:this.exaggeration,texture:(l&&l.demTexture||this._emptyDemTexture).texture,depthTexture:(this._fboDepthTexture||this._emptyDepthTexture).texture,tile:l}}getFramebuffer(t){const l=this.painter,f=l.width/devicePixelRatio,g=l.height/devicePixelRatio;return!this._fbo||this._fbo.width===f&&this._fbo.height===g||(this._fbo.destroy(),this._fboCoordsTexture.destroy(),this._fboDepthTexture.destroy(),delete this._fbo,delete this._fboDepthTexture,delete this._fboCoordsTexture),this._fboCoordsTexture||(this._fboCoordsTexture=new o.T(l.context,{width:f,height:g,data:null},l.context.gl.RGBA,{premultiply:!1}),this._fboCoordsTexture.bind(l.context.gl.NEAREST,l.context.gl.CLAMP_TO_EDGE)),this._fboDepthTexture||(this._fboDepthTexture=new o.T(l.context,{width:f,height:g,data:null},l.context.gl.RGBA,{premultiply:!1}),this._fboDepthTexture.bind(l.context.gl.NEAREST,l.context.gl.CLAMP_TO_EDGE)),this._fbo||(this._fbo=l.context.createFramebuffer(f,g,!0,!1),this._fbo.depthAttachment.set(l.context.createRenderbuffer(l.context.gl.DEPTH_COMPONENT16,f,g))),this._fbo.colorAttachment.set(t==="coords"?this._fboCoordsTexture.texture:this._fboDepthTexture.texture),this._fbo}getCoordsTexture(){const t=this.painter.context;if(this._coordsTexture)return this._coordsTexture;const l=new Uint8Array(this._coordsTextureSize*this._coordsTextureSize*4);for(let w=0,I=0;w<this._coordsTextureSize;w++)for(let k=0;k<this._coordsTextureSize;k++,I+=4)l[I+0]=255&k,l[I+1]=255&w,l[I+2]=k>>8<<4|w>>8,l[I+3]=0;const f=new o.R({width:this._coordsTextureSize,height:this._coordsTextureSize},new Uint8Array(l.buffer)),g=new o.T(t,f,t.gl.RGBA,{premultiply:!1});return g.bind(t.gl.NEAREST,t.gl.CLAMP_TO_EDGE),this._coordsTexture=g,g}pointCoordinate(t){this.painter.maybeDrawDepthAndCoords(!0);const l=new Uint8Array(4),f=this.painter.context,g=f.gl,w=Math.round(t.x*this.painter.pixelRatio/devicePixelRatio),I=Math.round(t.y*this.painter.pixelRatio/devicePixelRatio),k=Math.round(this.painter.height/devicePixelRatio);f.bindFramebuffer.set(this.getFramebuffer("coords").framebuffer),g.readPixels(w,k-I-1,1,1,g.RGBA,g.UNSIGNED_BYTE,l),f.bindFramebuffer.set(null);const R=l[0]+(l[2]>>4<<8),z=l[1]+((15&l[2])<<8),G=this.coordsIndex[255-l[3]],X=G&&this.sourceCache.getTileByID(G);if(!X)return null;const W=this._coordsTextureSize,te=(1<<X.tileID.canonical.z)*W;return new o.a0((X.tileID.canonical.x*W+R)/te+X.tileID.wrap,(X.tileID.canonical.y*W+z)/te,this.getElevation(X.tileID,R,z,W))}depthAtPoint(t){const l=new Uint8Array(4),f=this.painter.context,g=f.gl;return f.bindFramebuffer.set(this.getFramebuffer("depth").framebuffer),g.readPixels(t.x,this.painter.height/devicePixelRatio-t.y-1,1,1,g.RGBA,g.UNSIGNED_BYTE,l),f.bindFramebuffer.set(null),(l[0]/16777216+l[1]/65536+l[2]/256+l[3])/256}getTerrainMesh(t){var l;const f=((l=this.painter.style.projection)===null||l===void 0?void 0:l.transitionState)>0,g=f&&t.canonical.y===0,w=f&&t.canonical.y===(1<<t.canonical.z)-1,I=`m_${g?"n":""}_${w?"s":""}`;if(this._meshCache[I])return this._meshCache[I];const k=this.painter.context,R=new o.cu,z=new o.aM,G=this.meshSize,X=o.$/G,W=G*G;for(let De=0;De<=G;De++)for(let Qe=0;Qe<=G;Qe++)R.emplaceBack(Qe*X,De*X,0);for(let De=0;De<W;De+=G+1)for(let Qe=0;Qe<G;Qe++)z.emplaceBack(Qe+De,G+Qe+De+1,G+Qe+De+2),z.emplaceBack(Qe+De,G+Qe+De+2,Qe+De+1);const te=R.length,ae=te+(G+1),Te=(G+1)*G,we=g?o.bg:0,Ee=g?0:1,Ce=w?o.bh:o.$,Fe=w?0:1;for(let De=0;De<=G;De++)R.emplaceBack(De*X,we,Ee);for(let De=0;De<=G;De++)R.emplaceBack(De*X,Ce,Fe);for(let De=0;De<G;De++)z.emplaceBack(Te+De,ae+De,ae+De+1),z.emplaceBack(Te+De,ae+De+1,Te+De+1),z.emplaceBack(0+De,te+De+1,te+De),z.emplaceBack(0+De,0+De+1,te+De+1);const Oe=R.length,Ue=Oe+2*(G+1);for(const De of[0,1])for(let Qe=0;Qe<=G;Qe++)for(const yt of[0,1])R.emplaceBack(De*o.$,Qe*X,yt);for(let De=0;De<2*G;De+=2)z.emplaceBack(Oe+De,Oe+De+1,Oe+De+3),z.emplaceBack(Oe+De,Oe+De+3,Oe+De+2),z.emplaceBack(Ue+De,Ue+De+3,Ue+De+1),z.emplaceBack(Ue+De,Ue+De+2,Ue+De+3);const We=new rt(k.createVertexBuffer(R,Np.members),k.createIndexBuffer(z),o.aL.simpleSegment(0,0,R.length,z.length));return this._meshCache[I]=We,We}getMeshFrameDelta(t){return 2*Math.PI*o.bt/Math.pow(2,Math.max(t,0))/5}getMinTileElevationForLngLatZoom(t,l){var f;const{tileID:g}=this._getOverscaledTileIDFromLngLatZoom(t,l);return(f=this.getMinMaxElevation(g).minElevation)!==null&&f!==void 0?f:0}getMinMaxElevation(t){const l=this.getTerrainData(t).tile,f={minElevation:null,maxElevation:null};return l&&l.dem&&(f.minElevation=l.dem.min*this.exaggeration,f.maxElevation=l.dem.max*this.exaggeration),f}_getOverscaledTileIDFromLngLatZoom(t,l){const f=o.a0.fromLngLat(t.wrap()),g=(1<<l)*o.$,w=f.x*g,I=f.y*g,k=Math.floor(w/o.$),R=Math.floor(I/o.$);return{tileID:new o.Z(l,0,l,k,R),mercatorX:w,mercatorY:I}}}class Fc{constructor(t,l,f){this._context=t,this._size=l,this._tileSize=f,this._objects=[],this._recentlyUsed=[],this._stamp=0}destruct(){for(const t of this._objects)t.texture.destroy(),t.fbo.destroy()}_createObject(t){const l=this._context.createFramebuffer(this._tileSize,this._tileSize,!0,!0),f=new o.T(this._context,{width:this._tileSize,height:this._tileSize,data:null},this._context.gl.RGBA);return f.bind(this._context.gl.LINEAR,this._context.gl.CLAMP_TO_EDGE),this._context.extTextureFilterAnisotropic&&this._context.gl.texParameterf(this._context.gl.TEXTURE_2D,this._context.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,this._context.extTextureFilterAnisotropicMax),l.depthAttachment.set(this._context.createRenderbuffer(this._context.gl.DEPTH_STENCIL,this._tileSize,this._tileSize)),l.colorAttachment.set(f.texture),{id:t,fbo:l,texture:f,stamp:-1,inUse:!1}}getObjectForId(t){return this._objects[t]}useObject(t){t.inUse=!0,this._recentlyUsed=this._recentlyUsed.filter(l=>t.id!==l),this._recentlyUsed.push(t.id)}stampObject(t){t.stamp=++this._stamp}getOrCreateFreeObject(){for(const l of this._recentlyUsed)if(!this._objects[l].inUse)return this._objects[l];if(this._objects.length>=this._size)throw new Error("No free RenderPool available, call freeAllObjects() required!");const t=this._createObject(this._objects.length);return this._objects.push(t),t}freeObject(t){t.inUse=!1}freeAllObjects(){for(const t of this._objects)this.freeObject(t)}isFull(){return!(this._objects.length<this._size)&&this._objects.some(t=>!t.inUse)===!1}}const mi={background:!0,fill:!0,line:!0,raster:!0,hillshade:!0,"color-relief":!0};class Fi{constructor(t,l){this.painter=t,this.terrain=l,this.pool=new Fc(t.context,30,l.sourceCache.tileSize*l.qualityFactor)}destruct(){this.pool.destruct()}getTexture(t){return this.pool.getObjectForId(t.rtt[this._stacks.length-1].id).texture}prepareForRender(t,l){this._stacks=[],this._prevType=null,this._rttTiles=[],this._renderableTiles=this.terrain.sourceCache.getRenderableTiles(),this._renderableLayerIds=t._order.filter(f=>!t._layers[f].isHidden(l)),this._coordsAscending={};for(const f in t.sourceCaches){this._coordsAscending[f]={};const g=t.sourceCaches[f].getVisibleCoordinates(),w=t.sourceCaches[f].getSource(),I=w instanceof Ot?w.terrainTileRanges:null;for(const k of g){const R=this.terrain.sourceCache.getTerrainCoords(k,I);for(const z in R)this._coordsAscending[f][z]||(this._coordsAscending[f][z]=[]),this._coordsAscending[f][z].push(R[z])}}this._coordsAscendingStr={};for(const f of t._order){const g=t._layers[f],w=g.source;if(mi[g.type]&&!this._coordsAscendingStr[w]){this._coordsAscendingStr[w]={};for(const I in this._coordsAscending[w])this._coordsAscendingStr[w][I]=this._coordsAscending[w][I].map(k=>k.key).sort().join()}}for(const f of this._renderableTiles)for(const g in this._coordsAscendingStr){const w=this._coordsAscendingStr[g][f.tileID.key];w&&w!==f.rttCoords[g]&&(f.rtt=[])}}renderLayer(t,l){if(t.isHidden(this.painter.transform.zoom))return!1;const f=Object.assign(Object.assign({},l),{isRenderingToTexture:!0}),g=t.type,w=this.painter,I=this._renderableLayerIds[this._renderableLayerIds.length-1]===t.id;if(mi[g]&&(this._prevType&&mi[this._prevType]||this._stacks.push([]),this._prevType=g,this._stacks[this._stacks.length-1].push(t.id),!I))return!0;if(mi[this._prevType]||mi[g]&&I){this._prevType=g;const k=this._stacks.length-1,R=this._stacks[k]||[];for(const z of this._renderableTiles){if(this.pool.isFull()&&(fn(this.painter,this.terrain,this._rttTiles,f),this._rttTiles=[],this.pool.freeAllObjects()),this._rttTiles.push(z),z.rtt[k]){const X=this.pool.getObjectForId(z.rtt[k].id);if(X.stamp===z.rtt[k].stamp){this.pool.useObject(X);continue}}const G=this.pool.getOrCreateFreeObject();this.pool.useObject(G),this.pool.stampObject(G),z.rtt[k]={id:G.id,stamp:G.stamp},w.context.bindFramebuffer.set(G.fbo.framebuffer),w.context.clear({color:o.be.transparent,stencil:0}),w.currentStencilSource=void 0;for(let X=0;X<R.length;X++){const W=w.style._layers[R[X]],te=W.source?this._coordsAscending[W.source][z.tileID.key]:[z.tileID];w.context.viewport.set([0,0,G.fbo.width,G.fbo.height]),w._renderTileClippingMasks(W,te,!0),w.renderLayer(w,w.style.sourceCaches[W.source],W,te,f),W.source&&(z.rttCoords[W.source]=this._coordsAscendingStr[W.source][z.tileID.key])}}return fn(this.painter,this.terrain,this._rttTiles,f),this._rttTiles=[],this.pool.freeAllObjects(),mi[g]}return!1}}const zc={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"MapLibre logo","Map.Title":"Map","Marker.Title":"Map marker","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","Popup.Close":"Close popup","ScaleControl.Feet":"ft","ScaleControl.Meters":"m","ScaleControl.Kilometers":"km","ScaleControl.Miles":"mi","ScaleControl.NauticalMiles":"nm","GlobeControl.Enable":"Enable globe","GlobeControl.Disable":"Disable globe","TerrainControl.Enable":"Enable terrain","TerrainControl.Disable":"Disable terrain","CooperativeGesturesHandler.WindowsHelpText":"Use Ctrl + scroll to zoom the map","CooperativeGesturesHandler.MacHelpText":"Use  + scroll to zoom the map","CooperativeGesturesHandler.MobileHelpText":"Use two fingers to move the map"},qh=P,Hu={hash:!1,interactive:!0,bearingSnap:7,attributionControl:Xu,maplibreLogo:!1,refreshExpiredTiles:!0,canvasContextAttributes:{antialias:!1,preserveDrawingBuffer:!1,powerPreference:"high-performance",failIfMajorPerformanceCaveat:!1,desynchronized:!1,contextType:void 0},scrollZoom:!0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:60,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:!1,trackResize:!0,center:[0,0],elevation:0,zoom:0,bearing:0,pitch:0,roll:0,renderWorldCopies:!0,maxTileCacheSize:null,maxTileCacheZoomLevels:o.a.MAX_TILE_CACHE_ZOOM_LEVELS,transformRequest:null,transformCameraUpdate:null,fadeDuration:300,crossSourceCollisions:!0,clickTolerance:3,localIdeographFontFamily:"sans-serif",pitchWithRotate:!0,rollEnabled:!1,validateStyle:!0,maxCanvasSize:[4096,4096],cancelPendingTileRequestsWhileZooming:!0,centerClampedToGround:!0},Fs={showCompass:!0,showZoom:!0,visualizePitch:!1,visualizeRoll:!0};class Op{constructor(t,l,f=!1){this.mousedown=w=>{this.startMove(w,V.mousePos(this.element,w)),V.addEventListener(window,"mousemove",this.mousemove),V.addEventListener(window,"mouseup",this.mouseup)},this.mousemove=w=>{this.move(w,V.mousePos(this.element,w))},this.mouseup=w=>{this._rotatePitchHanlder.dragEnd(w),this.offTemp()},this.touchstart=w=>{w.targetTouches.length!==1?this.reset():(this._startPos=this._lastPos=V.touchPos(this.element,w.targetTouches)[0],this.startMove(w,this._startPos),V.addEventListener(window,"touchmove",this.touchmove,{passive:!1}),V.addEventListener(window,"touchend",this.touchend))},this.touchmove=w=>{w.targetTouches.length!==1?this.reset():(this._lastPos=V.touchPos(this.element,w.targetTouches)[0],this.move(w,this._lastPos))},this.touchend=w=>{w.targetTouches.length===0&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),delete this._startPos,delete this._lastPos,this.offTemp()},this.reset=()=>{this._rotatePitchHanlder.reset(),delete this._startPos,delete this._lastPos,this.offTemp()},this._clickTolerance=10,this.element=l;const g=new Qm;this._rotatePitchHanlder=new uu({clickTolerance:3,move:(w,I)=>{const k=l.getBoundingClientRect(),R=new o.P((k.bottom-k.top)/2,(k.right-k.left)/2);return{bearingDelta:o.cm(new o.P(w.x,I.y),I,R),pitchDelta:f?-.5*(I.y-w.y):void 0}},moveStateManager:g,enable:!0,assignEvents:()=>{}}),this.map=t,V.addEventListener(l,"mousedown",this.mousedown),V.addEventListener(l,"touchstart",this.touchstart,{passive:!1}),V.addEventListener(l,"touchcancel",this.reset)}startMove(t,l){this._rotatePitchHanlder.dragStart(t,l),V.disableDrag()}move(t,l){const f=this.map,{bearingDelta:g,pitchDelta:w}=this._rotatePitchHanlder.dragMove(t,l)||{};g&&f.setBearing(f.getBearing()+g),w&&f.setPitch(f.getPitch()+w)}off(){const t=this.element;V.removeEventListener(t,"mousedown",this.mousedown),V.removeEventListener(t,"touchstart",this.touchstart,{passive:!1}),V.removeEventListener(window,"touchmove",this.touchmove,{passive:!1}),V.removeEventListener(window,"touchend",this.touchend),V.removeEventListener(t,"touchcancel",this.reset),this.offTemp()}offTemp(){V.enableDrag(),V.removeEventListener(window,"mousemove",this.mousemove),V.removeEventListener(window,"mouseup",this.mouseup),V.removeEventListener(window,"touchmove",this.touchmove,{passive:!1}),V.removeEventListener(window,"touchend",this.touchend)}}let hs;function Dp(b,t,l,f=!1){if(f||!l.getCoveringTilesDetailsProvider().allowWorldCopies())return b?.wrap();const g=new o.S(b.lng,b.lat);if(b=new o.S(b.lng,b.lat),t){const w=new o.S(b.lng-360,b.lat),I=new o.S(b.lng+360,b.lat),k=l.locationToScreenPoint(b).distSqr(t);l.locationToScreenPoint(w).distSqr(t)<k?b=w:l.locationToScreenPoint(I).distSqr(t)<k&&(b=I)}for(;Math.abs(b.lng-l.center.lng)>180;){const w=l.locationToScreenPoint(b);if(w.x>=0&&w.y>=0&&w.x<=l.width&&w.y<=l.height)break;b.lng>l.center.lng?b.lng-=360:b.lng+=360}return b.lng!==g.lng&&l.isPointOnMapSurface(l.locationToScreenPoint(b))?b:g}const xl={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};function sn(b,t,l){const f=b.classList;for(const g in xl)f.remove(`maplibregl-${l}-anchor-${g}`);f.add(`maplibregl-${l}-anchor-${t}`)}class mn extends o.E{constructor(t){if(super(),this._onKeyPress=l=>{const f=l.code,g=l.charCode||l.keyCode;f!=="Space"&&f!=="Enter"&&g!==32&&g!==13||this.togglePopup()},this._onMapClick=l=>{const f=l.originalEvent.target,g=this._element;this._popup&&(f===g||g.contains(f))&&this.togglePopup()},this._update=l=>{if(!this._map)return;const f=this._map.loaded()&&!this._map.isMoving();(l?.type==="terrain"||l?.type==="render"&&!f)&&this._map.once("render",this._update),this._lngLat=Dp(this._lngLat,this._flatPos,this._map.transform),this._flatPos=this._pos=this._map.project(this._lngLat)._add(this._offset),this._map.terrain&&(this._flatPos=this._map.transform.locationToScreenPoint(this._lngLat)._add(this._offset));let g="";this._rotationAlignment==="viewport"||this._rotationAlignment==="auto"?g=`rotateZ(${this._rotation}deg)`:this._rotationAlignment==="map"&&(g=`rotateZ(${this._rotation-this._map.getBearing()}deg)`);let w="";this._pitchAlignment==="viewport"||this._pitchAlignment==="auto"?w="rotateX(0deg)":this._pitchAlignment==="map"&&(w=`rotateX(${this._map.getPitch()}deg)`),this._subpixelPositioning||l&&l.type!=="moveend"||(this._pos=this._pos.round()),V.setTransform(this._element,`${xl[this._anchor]} translate(${this._pos.x}px, ${this._pos.y}px) ${w} ${g}`),Y.frameAsync(new AbortController).then(()=>{this._updateOpacity(l&&l.type==="moveend")}).catch(()=>{})},this._onMove=l=>{if(!this._isDragging){const f=this._clickTolerance||this._map._clickTolerance;this._isDragging=l.point.dist(this._pointerdownPos)>=f}this._isDragging&&(this._pos=l.point.sub(this._positionDelta),this._lngLat=this._map.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none",this._state==="pending"&&(this._state="active",this.fire(new o.l("dragstart"))),this.fire(new o.l("drag")))},this._onUp=()=>{this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1,this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),this._state==="active"&&this.fire(new o.l("dragend")),this._state="inactive"},this._addDragHandler=l=>{this._element.contains(l.originalEvent.target)&&(l.preventDefault(),this._positionDelta=l.point.sub(this._pos).add(this._offset),this._pointerdownPos=l.point,this._state="pending",this._map.on("mousemove",this._onMove),this._map.on("touchmove",this._onMove),this._map.once("mouseup",this._onUp),this._map.once("touchend",this._onUp))},this._anchor=t&&t.anchor||"center",this._color=t&&t.color||"#3FB1CE",this._scale=t&&t.scale||1,this._draggable=t&&t.draggable||!1,this._clickTolerance=t&&t.clickTolerance||0,this._subpixelPositioning=t&&t.subpixelPositioning||!1,this._isDragging=!1,this._state="inactive",this._rotation=t&&t.rotation||0,this._rotationAlignment=t&&t.rotationAlignment||"auto",this._pitchAlignment=t&&t.pitchAlignment&&t.pitchAlignment!=="auto"?t.pitchAlignment:this._rotationAlignment,this.setOpacity(t?.opacity,t?.opacityWhenCovered),t&&t.element)this._element=t.element,this._offset=o.P.convert(t&&t.offset||[0,0]);else{this._defaultMarker=!0,this._element=V.create("div");const l=V.createNS("http://www.w3.org/2000/svg","svg"),f=41,g=27;l.setAttributeNS(null,"display","block"),l.setAttributeNS(null,"height",`${f}px`),l.setAttributeNS(null,"width",`${g}px`),l.setAttributeNS(null,"viewBox",`0 0 ${g} ${f}`);const w=V.createNS("http://www.w3.org/2000/svg","g");w.setAttributeNS(null,"stroke","none"),w.setAttributeNS(null,"stroke-width","1"),w.setAttributeNS(null,"fill","none"),w.setAttributeNS(null,"fill-rule","evenodd");const I=V.createNS("http://www.w3.org/2000/svg","g");I.setAttributeNS(null,"fill-rule","nonzero");const k=V.createNS("http://www.w3.org/2000/svg","g");k.setAttributeNS(null,"transform","translate(3.0, 29.0)"),k.setAttributeNS(null,"fill","#000000");const R=[{rx:"10.5",ry:"5.25002273"},{rx:"10.5",ry:"5.25002273"},{rx:"9.5",ry:"4.77275007"},{rx:"8.5",ry:"4.29549936"},{rx:"7.5",ry:"3.81822308"},{rx:"6.5",ry:"3.34094679"},{rx:"5.5",ry:"2.86367051"},{rx:"4.5",ry:"2.38636864"}];for(const Ee of R){const Ce=V.createNS("http://www.w3.org/2000/svg","ellipse");Ce.setAttributeNS(null,"opacity","0.04"),Ce.setAttributeNS(null,"cx","10.5"),Ce.setAttributeNS(null,"cy","5.80029008"),Ce.setAttributeNS(null,"rx",Ee.rx),Ce.setAttributeNS(null,"ry",Ee.ry),k.appendChild(Ce)}const z=V.createNS("http://www.w3.org/2000/svg","g");z.setAttributeNS(null,"fill",this._color);const G=V.createNS("http://www.w3.org/2000/svg","path");G.setAttributeNS(null,"d","M27,13.5 C27,19.074644 20.250001,27.000002 14.75,34.500002 C14.016665,35.500004 12.983335,35.500004 12.25,34.500002 C6.7499993,27.000002 0,19.222562 0,13.5 C0,6.0441559 6.0441559,0 13.5,0 C20.955844,0 27,6.0441559 27,13.5 Z"),z.appendChild(G);const X=V.createNS("http://www.w3.org/2000/svg","g");X.setAttributeNS(null,"opacity","0.25"),X.setAttributeNS(null,"fill","#000000");const W=V.createNS("http://www.w3.org/2000/svg","path");W.setAttributeNS(null,"d","M13.5,0 C6.0441559,0 0,6.0441559 0,13.5 C0,19.222562 6.7499993,27 12.25,34.5 C13,35.522727 14.016664,35.500004 14.75,34.5 C20.250001,27 27,19.074644 27,13.5 C27,6.0441559 20.955844,0 13.5,0 Z M13.5,1 C20.415404,1 26,6.584596 26,13.5 C26,15.898657 24.495584,19.181431 22.220703,22.738281 C19.945823,26.295132 16.705119,30.142167 13.943359,33.908203 C13.743445,34.180814 13.612715,34.322738 13.5,34.441406 C13.387285,34.322738 13.256555,34.180814 13.056641,33.908203 C10.284481,30.127985 7.4148684,26.314159 5.015625,22.773438 C2.6163816,19.232715 1,15.953538 1,13.5 C1,6.584596 6.584596,1 13.5,1 Z"),X.appendChild(W);const te=V.createNS("http://www.w3.org/2000/svg","g");te.setAttributeNS(null,"transform","translate(6.0, 7.0)"),te.setAttributeNS(null,"fill","#FFFFFF");const ae=V.createNS("http://www.w3.org/2000/svg","g");ae.setAttributeNS(null,"transform","translate(8.0, 8.0)");const Te=V.createNS("http://www.w3.org/2000/svg","circle");Te.setAttributeNS(null,"fill","#000000"),Te.setAttributeNS(null,"opacity","0.25"),Te.setAttributeNS(null,"cx","5.5"),Te.setAttributeNS(null,"cy","5.5"),Te.setAttributeNS(null,"r","5.4999962");const we=V.createNS("http://www.w3.org/2000/svg","circle");we.setAttributeNS(null,"fill","#FFFFFF"),we.setAttributeNS(null,"cx","5.5"),we.setAttributeNS(null,"cy","5.5"),we.setAttributeNS(null,"r","5.4999962"),ae.appendChild(Te),ae.appendChild(we),I.appendChild(k),I.appendChild(z),I.appendChild(X),I.appendChild(te),I.appendChild(ae),l.appendChild(I),l.setAttributeNS(null,"height",f*this._scale+"px"),l.setAttributeNS(null,"width",g*this._scale+"px"),this._element.appendChild(l),this._offset=o.P.convert(t&&t.offset||[0,-14])}if(this._element.classList.add("maplibregl-marker"),this._element.addEventListener("dragstart",l=>{l.preventDefault()}),this._element.addEventListener("mousedown",l=>{l.preventDefault()}),sn(this._element,this._anchor,"marker"),t&&t.className)for(const l of t.className.split(" "))this._element.classList.add(l);this._popup=null}addTo(t){return this.remove(),this._map=t,this._element.hasAttribute("aria-label")||this._element.setAttribute("aria-label",t._getUIString("Marker.Title")),t.getCanvasContainer().appendChild(this._element),t.on("move",this._update),t.on("moveend",this._update),t.on("terrain",this._update),t.on("projectiontransition",this._update),this.setDraggable(this._draggable),this._update(),this._map.on("click",this._onMapClick),this}remove(){return this._opacityTimeout&&(clearTimeout(this._opacityTimeout),delete this._opacityTimeout),this._map&&(this._map.off("click",this._onMapClick),this._map.off("move",this._update),this._map.off("moveend",this._update),this._map.off("terrain",this._update),this._map.off("projectiontransition",this._update),this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler),this._map.off("mouseup",this._onUp),this._map.off("touchend",this._onUp),this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),delete this._map),V.remove(this._element),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(t){return this._lngLat=o.S.convert(t),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(),this}getElement(){return this._element}setPopup(t){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),t){if(!("offset"in t.options)){const l=Math.abs(13.5)/Math.SQRT2;t.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[l,-1*(38.1-13.5+l)],"bottom-right":[-l,-1*(38.1-13.5+l)],left:[13.5,-1*(38.1-13.5)],right:[-13.5,-1*(38.1-13.5)]}:this._offset}this._popup=t,this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress)}return this}setSubpixelPositioning(t){return this._subpixelPositioning=t,this}getPopup(){return this._popup}togglePopup(){const t=this._popup;return this._element.style.opacity===this._opacityWhenCovered?this:t?(t.isOpen()?t.remove():(t.setLngLat(this._lngLat),t.addTo(this._map)),this):this}_updateOpacity(t=!1){var l,f;const g=(l=this._map)===null||l===void 0?void 0:l.terrain,w=this._map.transform.isLocationOccluded(this._lngLat);if(!g||w){const te=w?this._opacityWhenCovered:this._opacity;return void(this._element.style.opacity!==te&&(this._element.style.opacity=te))}if(t)this._opacityTimeout=null;else{if(this._opacityTimeout)return;this._opacityTimeout=setTimeout(()=>{this._opacityTimeout=null},100)}const I=this._map,k=I.terrain.depthAtPoint(this._pos),R=I.terrain.getElevationForLngLatZoom(this._lngLat,I.transform.tileZoom);if(I.transform.lngLatToCameraDepth(this._lngLat,R)-k<.006)return void(this._element.style.opacity=this._opacity);const z=-this._offset.y/I.transform.pixelsPerMeter,G=Math.sin(I.getPitch()*Math.PI/180)*z,X=I.terrain.depthAtPoint(new o.P(this._pos.x,this._pos.y-this._offset.y)),W=I.transform.lngLatToCameraDepth(this._lngLat,R+G)-X>.006;!((f=this._popup)===null||f===void 0)&&f.isOpen()&&W&&this._popup.remove(),this._element.style.opacity=W?this._opacityWhenCovered:this._opacity}getOffset(){return this._offset}setOffset(t){return this._offset=o.P.convert(t),this._update(),this}addClassName(t){this._element.classList.add(t)}removeClassName(t){this._element.classList.remove(t)}toggleClassName(t){return this._element.classList.toggle(t)}setDraggable(t){return this._draggable=!!t,this._map&&(t?(this._map.on("mousedown",this._addDragHandler),this._map.on("touchstart",this._addDragHandler)):(this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(t){return this._rotation=t||0,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(t){return this._rotationAlignment=t||"auto",this._update(),this}getRotationAlignment(){return this._rotationAlignment}setPitchAlignment(t){return this._pitchAlignment=t&&t!=="auto"?t:this._rotationAlignment,this._update(),this}getPitchAlignment(){return this._pitchAlignment}setOpacity(t,l){return(this._opacity===void 0||t===void 0&&l===void 0)&&(this._opacity="1",this._opacityWhenCovered="0.2"),t!==void 0&&(this._opacity=t),l!==void 0&&(this._opacityWhenCovered=l),this._map&&this._updateOpacity(!0),this}}const Fp={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0};let Wa=0,Ya=!1;const Zh={maxWidth:100,unit:"metric"};function Bc(b,t,l){const f=l&&l.maxWidth||100,g=b._container.clientHeight/2,w=b._container.clientWidth/2,I=b.unproject([w-f/2,g]),k=b.unproject([w+f/2,g]),R=Math.round(b.project(k).x-b.project(I).x),z=Math.min(f,R,b._container.clientWidth),G=I.distanceTo(k);if(l&&l.unit==="imperial"){const X=3.2808*G;X>5280?bl(t,z,X/5280,b._getUIString("ScaleControl.Miles")):bl(t,z,X,b._getUIString("ScaleControl.Feet"))}else l&&l.unit==="nautical"?bl(t,z,G/1852,b._getUIString("ScaleControl.NauticalMiles")):G>=1e3?bl(t,z,G/1e3,b._getUIString("ScaleControl.Kilometers")):bl(t,z,G,b._getUIString("ScaleControl.Meters"))}function bl(b,t,l,f){const g=function(w){const I=Math.pow(10,`${Math.floor(w)}`.length-1);let k=w/I;return k=k>=10?10:k>=5?5:k>=3?3:k>=2?2:k>=1?1:function(R){const z=Math.pow(10,Math.ceil(-Math.log(R)/Math.LN10));return Math.round(R*z)/z}(k),I*k}(l);b.style.width=t*(g/l)+"px",b.innerHTML=`${g}&nbsp;${f}`}const Ku={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px",subpixelPositioning:!1,locationOccludedOpacity:void 0},Wh=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function $c(b){if(b){if(typeof b=="number"){const t=Math.round(Math.abs(b)/Math.SQRT2);return{center:new o.P(0,0),top:new o.P(0,b),"top-left":new o.P(t,t),"top-right":new o.P(-t,t),bottom:new o.P(0,-b),"bottom-left":new o.P(t,-t),"bottom-right":new o.P(-t,-t),left:new o.P(b,0),right:new o.P(-b,0)}}if(b instanceof o.P||Array.isArray(b)){const t=o.P.convert(b);return{center:t,top:t,"top-left":t,"top-right":t,bottom:t,"bottom-left":t,"bottom-right":t,left:t,right:t}}return{center:o.P.convert(b.center||[0,0]),top:o.P.convert(b.top||[0,0]),"top-left":o.P.convert(b["top-left"]||[0,0]),"top-right":o.P.convert(b["top-right"]||[0,0]),bottom:o.P.convert(b.bottom||[0,0]),"bottom-left":o.P.convert(b["bottom-left"]||[0,0]),"bottom-right":o.P.convert(b["bottom-right"]||[0,0]),left:o.P.convert(b.left||[0,0]),right:o.P.convert(b.right||[0,0])}}return $c(new o.P(0,0))}const Yh=P;m.AJAXError=o.cy,m.Event=o.l,m.Evented=o.E,m.LngLat=o.S,m.MercatorCoordinate=o.a0,m.Point=o.P,m.addProtocol=o.cz,m.config=o.a,m.removeProtocol=o.cA,m.AttributionControl=Dc,m.BoxZoomHandler=Oh,m.CanvasSource=xs,m.CooperativeGesturesHandler=Lp,m.DoubleClickZoomHandler=Nc,m.DragPanHandler=jh,m.DragRotateHandler=Oc,m.EdgeInsets=jt,m.FullscreenControl=class extends o.E{constructor(b={}){super(),this._onFullscreenChange=()=>{var t;let l=window.document.fullscreenElement||window.document.mozFullScreenElement||window.document.webkitFullscreenElement||window.document.msFullscreenElement;for(;!((t=l?.shadowRoot)===null||t===void 0)&&t.fullscreenElement;)l=l.shadowRoot.fullscreenElement;l===this._container!==this._fullscreen&&this._handleFullscreenChange()},this._onClickFullscreen=()=>{this._isFullscreen()?this._exitFullscreen():this._requestFullscreen()},this._fullscreen=!1,b&&b.container&&(b.container instanceof HTMLElement?this._container=b.container:o.w("Full screen control 'container' must be a DOM element.")),"onfullscreenchange"in document?this._fullscreenchange="fullscreenchange":"onmozfullscreenchange"in document?this._fullscreenchange="mozfullscreenchange":"onwebkitfullscreenchange"in document?this._fullscreenchange="webkitfullscreenchange":"onmsfullscreenchange"in document&&(this._fullscreenchange="MSFullscreenChange")}onAdd(b){return this._map=b,this._container||(this._container=this._map.getContainer()),this._controlContainer=V.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._setupUI(),this._controlContainer}onRemove(){V.remove(this._controlContainer),this._map=null,window.document.removeEventListener(this._fullscreenchange,this._onFullscreenChange)}_setupUI(){const b=this._fullscreenButton=V.create("button","maplibregl-ctrl-fullscreen",this._controlContainer);V.create("span","maplibregl-ctrl-icon",b).setAttribute("aria-hidden","true"),b.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),window.document.addEventListener(this._fullscreenchange,this._onFullscreenChange)}_updateTitle(){const b=this._getTitle();this._fullscreenButton.setAttribute("aria-label",b),this._fullscreenButton.title=b}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_handleFullscreenChange(){this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("maplibregl-ctrl-shrink"),this._fullscreenButton.classList.toggle("maplibregl-ctrl-fullscreen"),this._updateTitle(),this._fullscreen?(this.fire(new o.l("fullscreenstart")),this._prevCooperativeGesturesEnabled=this._map.cooperativeGestures.isEnabled(),this._map.cooperativeGestures.disable()):(this.fire(new o.l("fullscreenend")),this._prevCooperativeGesturesEnabled&&this._map.cooperativeGestures.enable())}_exitFullscreen(){window.document.exitFullscreen?window.document.exitFullscreen():window.document.mozCancelFullScreen?window.document.mozCancelFullScreen():window.document.msExitFullscreen?window.document.msExitFullscreen():window.document.webkitCancelFullScreen?window.document.webkitCancelFullScreen():this._togglePseudoFullScreen()}_requestFullscreen(){this._container.requestFullscreen?this._container.requestFullscreen():this._container.mozRequestFullScreen?this._container.mozRequestFullScreen():this._container.msRequestFullscreen?this._container.msRequestFullscreen():this._container.webkitRequestFullscreen?this._container.webkitRequestFullscreen():this._togglePseudoFullScreen()}_togglePseudoFullScreen(){this._container.classList.toggle("maplibregl-pseudo-fullscreen"),this._handleFullscreenChange(),this._map.resize()}},m.GeoJSONSource=En,m.GeolocateControl=class extends o.E{constructor(b){super(),this._onSuccess=t=>{if(this._map){if(this._isOutOfMapMaxBounds(t))return this._setErrorState(),this.fire(new o.l("outofmaxbounds",t)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=t,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background");break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}this.options.showUserLocation&&this._watchState!=="OFF"&&this._updateMarker(t),this.options.trackUserLocation&&this._watchState!=="ACTIVE_LOCK"||this._updateCamera(t),this.options.showUserLocation&&this._dotElement.classList.remove("maplibregl-user-location-dot-stale"),this.fire(new o.l("geolocate",t)),this._finish()}},this._updateCamera=t=>{const l=new o.S(t.coords.longitude,t.coords.latitude),f=t.coords.accuracy,g=this._map.getBearing(),w=o.e({bearing:g},this.options.fitBoundsOptions),I=zi.fromLngLat(l,f);this._map.fitBounds(I,w,{geolocateSource:!0})},this._updateMarker=t=>{if(t){const l=new o.S(t.coords.longitude,t.coords.latitude);this._accuracyCircleMarker.setLngLat(l).addTo(this._map),this._userLocationDotMarker.setLngLat(l).addTo(this._map),this._accuracy=t.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()},this._onZoom=()=>{this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()},this._onError=t=>{if(this._map){if(t.code===1){this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;const l=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.title=l,this._geolocateButton.setAttribute("aria-label",l),this._geolocationWatchID!==void 0&&this._clearWatch()}else{if(t.code===3&&Ya)return;this.options.trackUserLocation&&this._setErrorState()}this._watchState!=="OFF"&&this.options.showUserLocation&&this._dotElement.classList.add("maplibregl-user-location-dot-stale"),this.fire(new o.l("error",t)),this._finish()}},this._finish=()=>{this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0},this._setupUI=()=>{this._map&&(this._container.addEventListener("contextmenu",t=>t.preventDefault()),this._geolocateButton=V.create("button","maplibregl-ctrl-geolocate",this._container),V.create("span","maplibregl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",this._geolocateButton.disabled=!0)},this._finishSetupUI=t=>{if(this._map){if(t===!1){o.w("Geolocation support is not available so the GeolocateControl will be disabled.");const l=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.title=l,this._geolocateButton.setAttribute("aria-label",l)}else{const l=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.disabled=!1,this._geolocateButton.title=l,this._geolocateButton.setAttribute("aria-label",l)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=V.create("div","maplibregl-user-location-dot"),this._userLocationDotMarker=new mn({element:this._dotElement}),this._circleElement=V.create("div","maplibregl-user-location-accuracy-circle"),this._accuracyCircleMarker=new mn({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",()=>this.trigger()),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",l=>{l.geolocateSource||this._watchState!=="ACTIVE_LOCK"||l.originalEvent&&l.originalEvent.type==="resize"||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this.fire(new o.l("trackuserlocationend")),this.fire(new o.l("userlocationlostfocus")))})}},this.options=o.e({},Fp,b)}onAdd(b){return this._map=b,this._container=V.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._setupUI(),function(){return o._(this,arguments,void 0,function*(t=!1){if(hs!==void 0&&!t)return hs;if(window.navigator.permissions===void 0)return hs=!!window.navigator.geolocation,hs;try{hs=(yield window.navigator.permissions.query({name:"geolocation"})).state!=="denied"}catch{hs=!!window.navigator.geolocation}return hs})}().then(t=>this._finishSetupUI(t)),this._container}onRemove(){this._geolocationWatchID!==void 0&&(window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),V.remove(this._container),this._map.off("zoom",this._onZoom),this._map=void 0,Wa=0,Ya=!1}_isOutOfMapMaxBounds(b){const t=this._map.getMaxBounds(),l=b.coords;return t&&(l.longitude<t.getWest()||l.longitude>t.getEast()||l.latitude<t.getSouth()||l.latitude>t.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting");break;case"ACTIVE_ERROR":break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}}_updateCircleRadius(){const b=this._map.getBounds(),t=b.getSouthEast(),l=b.getNorthEast(),f=t.distanceTo(l),g=Math.ceil(this._accuracy/(f/this._map._container.clientHeight)*2);this._circleElement.style.width=`${g}px`,this._circleElement.style.height=`${g}px`}trigger(){if(!this._setup)return o.w("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new o.l("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":Wa--,Ya=!1,this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this.fire(new o.l("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new o.l("trackuserlocationstart")),this.fire(new o.l("userlocationfocus"));break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"OFF":break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}if(this._watchState==="OFF"&&this._geolocationWatchID!==void 0)this._clearWatch();else if(this._geolocationWatchID===void 0){let b;this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),Wa++,Wa>1?(b={maximumAge:6e5,timeout:0},Ya=!0):(b=this.options.positionOptions,Ya=!1),this._geolocationWatchID=window.navigator.geolocation.watchPosition(this._onSuccess,this._onError,b)}}else window.navigator.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0}_clearWatch(){window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},m.GlobeControl=class{constructor(){this._toggleProjection=()=>{var b;const t=(b=this._map.getProjection())===null||b===void 0?void 0:b.type;this._map.setProjection(t!=="mercator"&&t?{type:"mercator"}:{type:"globe"}),this._updateGlobeIcon()},this._updateGlobeIcon=()=>{var b;this._globeButton.classList.remove("maplibregl-ctrl-globe"),this._globeButton.classList.remove("maplibregl-ctrl-globe-enabled"),((b=this._map.getProjection())===null||b===void 0?void 0:b.type)==="globe"?(this._globeButton.classList.add("maplibregl-ctrl-globe-enabled"),this._globeButton.title=this._map._getUIString("GlobeControl.Disable")):(this._globeButton.classList.add("maplibregl-ctrl-globe"),this._globeButton.title=this._map._getUIString("GlobeControl.Enable"))}}onAdd(b){return this._map=b,this._container=V.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._globeButton=V.create("button","maplibregl-ctrl-globe",this._container),V.create("span","maplibregl-ctrl-icon",this._globeButton).setAttribute("aria-hidden","true"),this._globeButton.type="button",this._globeButton.addEventListener("click",this._toggleProjection),this._updateGlobeIcon(),this._map.on("styledata",this._updateGlobeIcon),this._container}onRemove(){V.remove(this._container),this._map.off("styledata",this._updateGlobeIcon),this._globeButton.removeEventListener("click",this._toggleProjection),this._map=void 0}},m.Hash=Uu,m.ImageSource=Ot,m.KeyboardHandler=du,m.LngLatBounds=zi,m.LogoControl=Vh,m.Map=class extends en{constructor(b){var t,l;o.cv.mark(o.cw.create);const f=Object.assign(Object.assign(Object.assign({},Hu),b),{canvasContextAttributes:Object.assign(Object.assign({},Hu.canvasContextAttributes),b.canvasContextAttributes)});if(f.minZoom!=null&&f.maxZoom!=null&&f.minZoom>f.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(f.minPitch!=null&&f.maxPitch!=null&&f.minPitch>f.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(f.minPitch!=null&&f.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(f.maxPitch!=null&&f.maxPitch>180)throw new Error("maxPitch must be less than or equal to 180");const g=new ji,w=new pr;if(f.minZoom!==void 0&&g.setMinZoom(f.minZoom),f.maxZoom!==void 0&&g.setMaxZoom(f.maxZoom),f.minPitch!==void 0&&g.setMinPitch(f.minPitch),f.maxPitch!==void 0&&g.setMaxPitch(f.maxPitch),f.renderWorldCopies!==void 0&&g.setRenderWorldCopies(f.renderWorldCopies),super(g,w,{bearingSnap:f.bearingSnap}),this._idleTriggered=!1,this._crossFadingFactor=1,this._renderTaskQueue=new Rp,this._controls=[],this._mapId=o.a6(),this._contextLost=k=>{k.preventDefault(),this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this.fire(new o.l("webglcontextlost",{originalEvent:k}))},this._contextRestored=k=>{this._setupPainter(),this.resize(),this._update(),this.fire(new o.l("webglcontextrestored",{originalEvent:k}))},this._onMapScroll=k=>{if(k.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1},this._onWindowOnline=()=>{this._update()},this._interactive=f.interactive,this._maxTileCacheSize=f.maxTileCacheSize,this._maxTileCacheZoomLevels=f.maxTileCacheZoomLevels,this._canvasContextAttributes=Object.assign({},f.canvasContextAttributes),this._trackResize=f.trackResize===!0,this._bearingSnap=f.bearingSnap,this._centerClampedToGround=f.centerClampedToGround,this._refreshExpiredTiles=f.refreshExpiredTiles===!0,this._fadeDuration=f.fadeDuration,this._crossSourceCollisions=f.crossSourceCollisions===!0,this._collectResourceTiming=f.collectResourceTiming===!0,this._locale=Object.assign(Object.assign({},zc),f.locale),this._clickTolerance=f.clickTolerance,this._overridePixelRatio=f.pixelRatio,this._maxCanvasSize=f.maxCanvasSize,this.transformCameraUpdate=f.transformCameraUpdate,this.cancelPendingTileRequestsWhileZooming=f.cancelPendingTileRequestsWhileZooming===!0,this._imageQueueHandle=ne.addThrottleControl(()=>this.isMoving()),this._requestManager=new ye(f.transformRequest),typeof f.container=="string"){if(this._container=document.getElementById(f.container),!this._container)throw new Error(`Container '${f.container}' not found.`)}else{if(!(f.container instanceof HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=f.container}if(f.maxBounds&&this.setMaxBounds(f.maxBounds),this._setupContainer(),this._setupPainter(),this.on("move",()=>this._update(!1)),this.on("moveend",()=>this._update(!1)),this.on("zoom",()=>this._update(!0)),this.on("terrain",()=>{this.painter.terrainFacilitator.dirty=!0,this._update(!0)}),this.once("idle",()=>{this._idleTriggered=!0}),typeof window<"u"){addEventListener("online",this._onWindowOnline,!1);let k=!1;const R=kc(z=>{this._trackResize&&!this._removed&&(this.resize(z),this.redraw())},50);this._resizeObserver=new ResizeObserver(z=>{k?R(z):k=!0}),this._resizeObserver.observe(this._container)}this.handlers=new Za(this,f),this._hash=f.hash&&new Uu(typeof f.hash=="string"&&f.hash||void 0).addTo(this),this._hash&&this._hash._onHashChange()||(this.jumpTo({center:f.center,elevation:f.elevation,zoom:f.zoom,bearing:f.bearing,pitch:f.pitch,roll:f.roll}),f.bounds&&(this.resize(),this.fitBounds(f.bounds,o.e({},f.fitBoundsOptions,{duration:0}))));const I=typeof f.style=="string"||((l=(t=f.style)===null||t===void 0?void 0:t.projection)===null||l===void 0?void 0:l.type)!=="globe";this.resize(null,I),this._localIdeographFontFamily=f.localIdeographFontFamily,this._validateStyle=f.validateStyle,f.style&&this.setStyle(f.style,{localIdeographFontFamily:f.localIdeographFontFamily}),f.attributionControl&&this.addControl(new Dc(typeof f.attributionControl=="boolean"?void 0:f.attributionControl)),f.maplibreLogo&&this.addControl(new Vh,f.logoPosition),this.on("style.load",()=>{if(I||this._resizeTransform(),this.transform.unmodified){const k=o.Q(this.style.stylesheet,["center","zoom","bearing","pitch","roll"]);this.jumpTo(k)}}),this.on("data",k=>{this._update(k.dataType==="style"),this.fire(new o.l(`${k.dataType}data`,k))}),this.on("dataloading",k=>{this.fire(new o.l(`${k.dataType}dataloading`,k))}),this.on("dataabort",k=>{this.fire(new o.l("sourcedataabort",k))})}_getMapId(){return this._mapId}setGlobalStateProperty(b,t){return this.style.setGlobalStateProperty(b,t),this._update(!0)}getGlobalState(){return this.style.getGlobalState()}addControl(b,t){if(t===void 0&&(t=b.getDefaultPosition?b.getDefaultPosition():"top-right"),!b||!b.onAdd)return this.fire(new o.k(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));const l=b.onAdd(this);this._controls.push(b);const f=this._controlPositions[t];return t.indexOf("bottom")!==-1?f.insertBefore(l,f.firstChild):f.appendChild(l),this}removeControl(b){if(!b||!b.onRemove)return this.fire(new o.k(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));const t=this._controls.indexOf(b);return t>-1&&this._controls.splice(t,1),b.onRemove(this),this}hasControl(b){return this._controls.indexOf(b)>-1}calculateCameraOptionsFromTo(b,t,l,f){return f==null&&this.terrain&&(f=this.terrain.getElevationForLngLatZoom(l,this.transform.tileZoom)),super.calculateCameraOptionsFromTo(b,t,l,f)}resize(b,t=!0){const[l,f]=this._containerDimensions(),g=this._getClampedPixelRatio(l,f);if(this._resizeCanvas(l,f,g),this.painter.resize(l,f,g),this.painter.overLimit()){const I=this.painter.context.gl;this._maxCanvasSize=[I.drawingBufferWidth,I.drawingBufferHeight];const k=this._getClampedPixelRatio(l,f);this._resizeCanvas(l,f,k),this.painter.resize(l,f,k)}this._resizeTransform(t);const w=!this._moving;return w&&(this.stop(),this.fire(new o.l("movestart",b)).fire(new o.l("move",b))),this.fire(new o.l("resize",b)),w&&this.fire(new o.l("moveend",b)),this}_resizeTransform(b=!0){var t;const[l,f]=this._containerDimensions();this.transform.resize(l,f,b),(t=this._requestedCameraState)===null||t===void 0||t.resize(l,f,b)}_getClampedPixelRatio(b,t){const{0:l,1:f}=this._maxCanvasSize,g=this.getPixelRatio(),w=b*g,I=t*g;return Math.min(w>l?l/w:1,I>f?f/I:1)*g}getPixelRatio(){var b;return(b=this._overridePixelRatio)!==null&&b!==void 0?b:devicePixelRatio}setPixelRatio(b){this._overridePixelRatio=b,this.resize()}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()}setMaxBounds(b){return this.transform.setMaxBounds(zi.convert(b)),this._update()}setMinZoom(b){if((b=b??-2)>=-2&&b<=this.transform.maxZoom)return this.transform.setMinZoom(b),this._update(),this.getZoom()<b&&this.setZoom(b),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(b){if((b=b??22)>=this.transform.minZoom)return this.transform.setMaxZoom(b),this._update(),this.getZoom()>b&&this.setZoom(b),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(b){if((b=b??0)<0)throw new Error("minPitch must be greater than or equal to 0");if(b>=0&&b<=this.transform.maxPitch)return this.transform.setMinPitch(b),this._update(),this.getPitch()<b&&this.setPitch(b),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(b){if((b=b??60)>180)throw new Error("maxPitch must be less than or equal to 180");if(b>=this.transform.minPitch)return this.transform.setMaxPitch(b),this._update(),this.getPitch()>b&&this.setPitch(b),this;throw new Error("maxPitch must be greater than the current minPitch")}getMaxPitch(){return this.transform.maxPitch}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(b){return this.transform.setRenderWorldCopies(b),this._update()}project(b){return this.transform.locationToScreenPoint(o.S.convert(b),this.style&&this.terrain)}unproject(b){return this.transform.screenPointToLocation(o.P.convert(b),this.terrain)}isMoving(){var b;return this._moving||((b=this.handlers)===null||b===void 0?void 0:b.isMoving())}isZooming(){var b;return this._zooming||((b=this.handlers)===null||b===void 0?void 0:b.isZooming())}isRotating(){var b;return this._rotating||((b=this.handlers)===null||b===void 0?void 0:b.isRotating())}_createDelegatedListener(b,t,l){if(b==="mouseenter"||b==="mouseover"){let f=!1;return{layers:t,listener:l,delegates:{mousemove:g=>{const w=t.filter(k=>this.getLayer(k)),I=w.length!==0?this.queryRenderedFeatures(g.point,{layers:w}):[];I.length?f||(f=!0,l.call(this,new Zs(b,this,g.originalEvent,{features:I}))):f=!1},mouseout:()=>{f=!1}}}}if(b==="mouseleave"||b==="mouseout"){let f=!1;return{layers:t,listener:l,delegates:{mousemove:g=>{const w=t.filter(I=>this.getLayer(I));(w.length!==0?this.queryRenderedFeatures(g.point,{layers:w}):[]).length?f=!0:f&&(f=!1,l.call(this,new Zs(b,this,g.originalEvent)))},mouseout:g=>{f&&(f=!1,l.call(this,new Zs(b,this,g.originalEvent)))}}}}{const f=g=>{const w=t.filter(k=>this.getLayer(k)),I=w.length!==0?this.queryRenderedFeatures(g.point,{layers:w}):[];I.length&&(g.features=I,l.call(this,g),delete g.features)};return{layers:t,listener:l,delegates:{[b]:f}}}}_saveDelegatedListener(b,t){this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[b]=this._delegatedListeners[b]||[],this._delegatedListeners[b].push(t)}_removeDelegatedListener(b,t,l){if(!this._delegatedListeners||!this._delegatedListeners[b])return;const f=this._delegatedListeners[b];for(let g=0;g<f.length;g++){const w=f[g];if(w.listener===l&&w.layers.length===t.length&&w.layers.every(I=>t.includes(I))){for(const I in w.delegates)this.off(I,w.delegates[I]);return void f.splice(g,1)}}}on(b,t,l){if(l===void 0)return super.on(b,t);const f=typeof t=="string"?[t]:t,g=this._createDelegatedListener(b,f,l);this._saveDelegatedListener(b,g);for(const w in g.delegates)this.on(w,g.delegates[w]);return{unsubscribe:()=>{this._removeDelegatedListener(b,f,l)}}}once(b,t,l){if(l===void 0)return super.once(b,t);const f=typeof t=="string"?[t]:t,g=this._createDelegatedListener(b,f,l);for(const w in g.delegates){const I=g.delegates[w];g.delegates[w]=(...k)=>{this._removeDelegatedListener(b,f,l),I(...k)}}this._saveDelegatedListener(b,g);for(const w in g.delegates)this.once(w,g.delegates[w]);return this}off(b,t,l){return l===void 0?super.off(b,t):(this._removeDelegatedListener(b,typeof t=="string"?[t]:t,l),this)}queryRenderedFeatures(b,t){if(!this.style)return[];let l;const f=b instanceof o.P||Array.isArray(b),g=f?b:[[0,0],[this.transform.width,this.transform.height]];if(t=t||(f?{}:b)||{},g instanceof o.P||typeof g[0]=="number")l=[o.P.convert(g)];else{const w=o.P.convert(g[0]),I=o.P.convert(g[1]);l=[w,new o.P(I.x,w.y),I,new o.P(w.x,I.y),w]}return this.style.queryRenderedFeatures(l,t,this.transform)}querySourceFeatures(b,t){return this.style.querySourceFeatures(b,t)}setStyle(b,t){return(t=o.e({},{localIdeographFontFamily:this._localIdeographFontFamily,validate:this._validateStyle},t)).diff!==!1&&t.localIdeographFontFamily===this._localIdeographFontFamily&&this.style&&b?(this._diffStyle(b,t),this):(this._localIdeographFontFamily=t.localIdeographFontFamily,this._updateStyle(b,t))}setTransformRequest(b){return this._requestManager.setTransformRequest(b),this}_getUIString(b){const t=this._locale[b];if(t==null)throw new Error(`Missing UI string '${b}'`);return t}_updateStyle(b,t){var l,f;if(t.transformStyle&&this.style&&!this.style._loaded)return void this.style.once("style.load",()=>this._updateStyle(b,t));const g=this.style&&t.transformStyle?this.style.serialize():void 0;return this.style&&(this.style.setEventedParent(null),this.style._remove(!b)),b?(this.style=new ea(this,t||{}),this.style.setEventedParent(this,{style:this.style}),typeof b=="string"?this.style.loadURL(b,t,g):this.style.loadJSON(b,t,g),this):((f=(l=this.style)===null||l===void 0?void 0:l.projection)===null||f===void 0||f.destroy(),delete this.style,this)}_lazyInitEmptyStyle(){this.style||(this.style=new ea(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}_diffStyle(b,t){if(typeof b=="string"){const l=this._requestManager.transformRequest(b,"Style");o.j(l,new AbortController).then(f=>{this._updateDiff(f.data,t)}).catch(f=>{f&&this.fire(new o.k(f))})}else typeof b=="object"&&this._updateDiff(b,t)}_updateDiff(b,t){try{this.style.setState(b,t)&&this._update(!0)}catch(l){o.w(`Unable to perform style diff: ${l.message||l.error||l}.  Rebuilding the style from scratch.`),this._updateStyle(b,t)}}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():o.w("There is no style added to the map.")}addSource(b,t){return this._lazyInitEmptyStyle(),this.style.addSource(b,t),this._update(!0)}isSourceLoaded(b){const t=this.style&&this.style.sourceCaches[b];if(t!==void 0)return t.loaded();this.fire(new o.k(new Error(`There is no source with ID '${b}'`)))}setTerrain(b){if(this.style._checkLoaded(),this._terrainDataCallback&&this.style.off("data",this._terrainDataCallback),b){const t=this.style.sourceCaches[b.source];if(!t)throw new Error(`cannot load terrain, because there exists no source with ID: ${b.source}`);this.terrain===null&&t.reload();for(const l in this.style._layers){const f=this.style._layers[l];f.type==="hillshade"&&f.source===b.source&&o.w("You are using the same source for a hillshade layer and for 3D terrain. Please consider using two separate sources to improve rendering quality."),f.type==="color-relief"&&f.source===b.source&&o.w("You are using the same source for a color-relief layer and for 3D terrain. Please consider using two separate sources to improve rendering quality.")}this.terrain=new aa(this.painter,t,b),this.painter.renderToTexture=new Fi(this.painter,this.terrain),this.transform.setMinElevationForCurrentTile(this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom)),this.transform.setElevation(this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom)),this._terrainDataCallback=l=>{var f;l.dataType==="style"?this.terrain.sourceCache.freeRtt():l.dataType==="source"&&l.tile&&(l.sourceId!==b.source||this._elevationFreeze||(this.transform.setMinElevationForCurrentTile(this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom)),this._centerClampedToGround&&this.transform.setElevation(this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom))),((f=l.source)===null||f===void 0?void 0:f.type)==="image"?this.terrain.sourceCache.freeRtt():this.terrain.sourceCache.freeRtt(l.tile.tileID))},this.style.on("data",this._terrainDataCallback)}else this.terrain&&this.terrain.sourceCache.destruct(),this.terrain=null,this.painter.renderToTexture&&this.painter.renderToTexture.destruct(),this.painter.renderToTexture=null,this.transform.setMinElevationForCurrentTile(0),this._centerClampedToGround&&this.transform.setElevation(0);return this.fire(new o.l("terrain",{terrain:b})),this}getTerrain(){var b,t;return(t=(b=this.terrain)===null||b===void 0?void 0:b.options)!==null&&t!==void 0?t:null}areTilesLoaded(){const b=this.style&&this.style.sourceCaches;for(const t in b){const l=b[t]._tiles;for(const f in l){const g=l[f];if(g.state!=="loaded"&&g.state!=="errored")return!1}}return!0}removeSource(b){return this.style.removeSource(b),this._update(!0)}getSource(b){return this.style.getSource(b)}setSourceTileLodParams(b,t,l){if(l){const f=this.getSource(l);if(!f)throw new Error(`There is no source with ID "${l}", cannot set LOD parameters`);f.calculateTileZoom=at(Math.max(1,b),Math.max(1,t))}else for(const f in this.style.sourceCaches)this.style.sourceCaches[f].getSource().calculateTileZoom=at(Math.max(1,b),Math.max(1,t));return this._update(!0),this}refreshTiles(b,t){const l=this.style.sourceCaches[b];if(!l)throw new Error(`There is no source cache with ID "${b}", cannot refresh tile`);t===void 0?l.reload(!0):l.refreshTiles(t.map(f=>new o.a3(f.z,f.x,f.y)))}addImage(b,t,l={}){const{pixelRatio:f=1,sdf:g=!1,stretchX:w,stretchY:I,content:k,textFitWidth:R,textFitHeight:z}=l;if(this._lazyInitEmptyStyle(),!(t instanceof HTMLImageElement||o.b(t))){if(t.width===void 0||t.height===void 0)return this.fire(new o.k(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));{const{width:G,height:X,data:W}=t,te=t;return this.style.addImage(b,{data:new o.R({width:G,height:X},new Uint8Array(W)),pixelRatio:f,stretchX:w,stretchY:I,content:k,textFitWidth:R,textFitHeight:z,sdf:g,version:0,userImage:te}),te.onAdd&&te.onAdd(this,b),this}}{const{width:G,height:X,data:W}=Y.getImageData(t);this.style.addImage(b,{data:new o.R({width:G,height:X},W),pixelRatio:f,stretchX:w,stretchY:I,content:k,textFitWidth:R,textFitHeight:z,sdf:g,version:0})}}updateImage(b,t){const l=this.style.getImage(b);if(!l)return this.fire(new o.k(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));const f=t instanceof HTMLImageElement||o.b(t)?Y.getImageData(t):t,{width:g,height:w,data:I}=f;if(g===void 0||w===void 0)return this.fire(new o.k(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));if(g!==l.data.width||w!==l.data.height)return this.fire(new o.k(new Error("The width and height of the updated image must be that same as the previous version of the image")));const k=!(t instanceof HTMLImageElement||o.b(t));return l.data.replace(I,k),this.style.updateImage(b,l),this}getImage(b){return this.style.getImage(b)}hasImage(b){return b?!!this.style.getImage(b):(this.fire(new o.k(new Error("Missing required image id"))),!1)}removeImage(b){this.style.removeImage(b)}loadImage(b){return ne.getImage(this._requestManager.transformRequest(b,"Image"),new AbortController)}listImages(){return this.style.listImages()}addLayer(b,t){return this._lazyInitEmptyStyle(),this.style.addLayer(b,t),this._update(!0)}moveLayer(b,t){return this.style.moveLayer(b,t),this._update(!0)}removeLayer(b){return this.style.removeLayer(b),this._update(!0)}getLayer(b){return this.style.getLayer(b)}getLayersOrder(){return this.style.getLayersOrder()}setLayerZoomRange(b,t,l){return this.style.setLayerZoomRange(b,t,l),this._update(!0)}setFilter(b,t,l={}){return this.style.setFilter(b,t,l),this._update(!0)}getFilter(b){return this.style.getFilter(b)}setPaintProperty(b,t,l,f={}){return this.style.setPaintProperty(b,t,l,f),this._update(!0)}getPaintProperty(b,t){return this.style.getPaintProperty(b,t)}setLayoutProperty(b,t,l,f={}){return this.style.setLayoutProperty(b,t,l,f),this._update(!0)}getLayoutProperty(b,t){return this.style.getLayoutProperty(b,t)}setGlyphs(b,t={}){return this._lazyInitEmptyStyle(),this.style.setGlyphs(b,t),this._update(!0)}getGlyphs(){return this.style.getGlyphsUrl()}addSprite(b,t,l={}){return this._lazyInitEmptyStyle(),this.style.addSprite(b,t,l,f=>{f||this._update(!0)}),this}removeSprite(b){return this._lazyInitEmptyStyle(),this.style.removeSprite(b),this._update(!0)}getSprite(){return this.style.getSprite()}setSprite(b,t={}){return this._lazyInitEmptyStyle(),this.style.setSprite(b,t,l=>{l||this._update(!0)}),this}setLight(b,t={}){return this._lazyInitEmptyStyle(),this.style.setLight(b,t),this._update(!0)}getLight(){return this.style.getLight()}setSky(b,t={}){return this._lazyInitEmptyStyle(),this.style.setSky(b,t),this._update(!0)}getSky(){return this.style.getSky()}setFeatureState(b,t){return this.style.setFeatureState(b,t),this._update()}removeFeatureState(b,t){return this.style.removeFeatureState(b,t),this._update()}getFeatureState(b){return this.style.getFeatureState(b)}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}_containerDimensions(){let b=0,t=0;return this._container&&(b=this._container.clientWidth||400,t=this._container.clientHeight||300),[b,t]}_setupContainer(){const b=this._container;b.classList.add("maplibregl-map");const t=this._canvasContainer=V.create("div","maplibregl-canvas-container",b);this._interactive&&t.classList.add("maplibregl-interactive"),this._canvas=V.create("canvas","maplibregl-canvas",t),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("tabindex",this._interactive?"0":"-1"),this._canvas.setAttribute("aria-label",this._getUIString("Map.Title")),this._canvas.setAttribute("role","region");const l=this._containerDimensions(),f=this._getClampedPixelRatio(l[0],l[1]);this._resizeCanvas(l[0],l[1],f);const g=this._controlContainer=V.create("div","maplibregl-control-container",b),w=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach(I=>{w[I]=V.create("div",`maplibregl-ctrl-${I} `,g)}),this._container.addEventListener("scroll",this._onMapScroll,!1)}_resizeCanvas(b,t,l){this._canvas.width=Math.floor(l*b),this._canvas.height=Math.floor(l*t),this._canvas.style.width=`${b}px`,this._canvas.style.height=`${t}px`}_setupPainter(){const b=Object.assign(Object.assign({},this._canvasContextAttributes),{alpha:!0,depth:!0,stencil:!0,premultipliedAlpha:!0});let t=null;this._canvas.addEventListener("webglcontextcreationerror",f=>{t={requestedAttributes:b},f&&(t.statusMessage=f.statusMessage,t.type=f.type)},{once:!0});let l=null;if(l=this._canvasContextAttributes.contextType?this._canvas.getContext(this._canvasContextAttributes.contextType,b):this._canvas.getContext("webgl2",b)||this._canvas.getContext("webgl",b),!l){const f="Failed to initialize WebGL";throw t?(t.message=f,new Error(JSON.stringify(t))):new Error(f)}this.painter=new vo(l,this.transform),H.testSupport(l)}migrateProjection(b,t){super.migrateProjection(b,t),this.painter.transform=b,this.fire(new o.l("projectiontransition",{newProjection:this.style.projection.name}))}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}_update(b){return this.style&&this.style._loaded?(this._styleDirty=this._styleDirty||b,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(b){return this._update(),this._renderTaskQueue.add(b)}_cancelRenderFrame(b){this._renderTaskQueue.remove(b)}_render(b){var t,l,f,g,w;const I=this._idleTriggered?this._fadeDuration:0,k=((t=this.style.projection)===null||t===void 0?void 0:t.transitionState)>0;if(this.painter.context.setDirty(),this.painter.setBaseState(),this._renderTaskQueue.run(b),this._removed)return;let R=!1;if(this.style&&this._styleDirty){this._styleDirty=!1;const X=this.transform.zoom,W=Y.now();this.style.zoomHistory.update(X,W);const te=new o.F(X,{now:W,fadeDuration:I,zoomHistory:this.style.zoomHistory,transition:this.style.getTransition(),globalState:this.style.getGlobalState()}),ae=te.crossFadingFactor();ae===1&&ae===this._crossFadingFactor||(R=!0,this._crossFadingFactor=ae),this.style.update(te)}const z=((l=this.style.projection)===null||l===void 0?void 0:l.transitionState)>0!==k;(f=this.style.projection)===null||f===void 0||f.setErrorQueryLatitudeDegrees(this.transform.center.lat),this.transform.setTransitionState((g=this.style.projection)===null||g===void 0?void 0:g.transitionState,(w=this.style.projection)===null||w===void 0?void 0:w.latitudeErrorCorrectionRadians),this.style&&(this._sourcesDirty||z)&&(this._sourcesDirty=!1,this.style._updateSources(this.transform)),this.terrain?(this.terrain.sourceCache.update(this.transform,this.terrain),this.transform.setMinElevationForCurrentTile(this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom)),!this._elevationFreeze&&this._centerClampedToGround&&this.transform.setElevation(this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom))):(this.transform.setMinElevationForCurrentTile(0),this._centerClampedToGround&&this.transform.setElevation(0)),this._placementDirty=this.style&&this.style._updatePlacement(this.transform,this.showCollisionBoxes,I,this._crossSourceCollisions,z),this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showOverdrawInspector:this._showOverdrawInspector,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:I,showPadding:this.showPadding}),this.fire(new o.l("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,o.cv.mark(o.cw.load),this.fire(new o.l("load"))),this.style&&(this.style.hasTransitions()||R)&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles();const G=this._sourcesDirty||this._styleDirty||this._placementDirty;return G||this._repaint?this.triggerRepaint():!this.isMoving()&&this.loaded()&&this.fire(new o.l("idle")),!this._loaded||this._fullyLoaded||G||(this._fullyLoaded=!0,o.cv.mark(o.cw.fullLoad)),this}redraw(){return this.style&&(this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._render(0)),this}remove(){var b;this._hash&&this._hash.remove();for(const l of this._controls)l.onRemove(this);this._controls=[],this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._renderTaskQueue.clear(),this.painter.destroy(),this.handlers.destroy(),delete this.handlers,this.setStyle(null),typeof window<"u"&&removeEventListener("online",this._onWindowOnline,!1),ne.removeThrottleControl(this._imageQueueHandle),(b=this._resizeObserver)===null||b===void 0||b.disconnect();const t=this.painter.context.gl.getExtension("WEBGL_lose_context");t?.loseContext&&t.loseContext(),this._canvas.removeEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.removeEventListener("webglcontextlost",this._contextLost,!1),V.remove(this._canvasContainer),V.remove(this._controlContainer),this._container.removeEventListener("scroll",this._onMapScroll,!1),this._container.classList.remove("maplibregl-map"),o.cv.clearMetrics(),this._removed=!0,this.fire(new o.l("remove"))}triggerRepaint(){this.style&&!this._frameRequest&&(this._frameRequest=new AbortController,Y.frame(this._frameRequest,b=>{o.cv.frame(b),this._frameRequest=null;try{this._render(b)}catch(t){if(!o.cx(t)&&!function(l){return l.message===Ga}(t))throw t}},()=>{}))}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(b){this._showTileBoundaries!==b&&(this._showTileBoundaries=b,this._update())}get showPadding(){return!!this._showPadding}set showPadding(b){this._showPadding!==b&&(this._showPadding=b,this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(b){this._showCollisionBoxes!==b&&(this._showCollisionBoxes=b,b?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(b){this._showOverdrawInspector!==b&&(this._showOverdrawInspector=b,this._update())}get repaint(){return!!this._repaint}set repaint(b){this._repaint!==b&&(this._repaint=b,this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(b){this._vertices=b,this._update()}get version(){return qh}getCameraTargetElevation(){return this.transform.elevation}getProjection(){return this.style.getProjection()}setProjection(b){return this._lazyInitEmptyStyle(),this.style.setProjection(b),this._update(!0)}},m.MapMouseEvent=Zs,m.MapTouchEvent=Oo,m.MapWheelEvent=Nh,m.Marker=mn,m.NavigationControl=class{constructor(b){this._updateZoomButtons=()=>{const t=this._map.getZoom(),l=t===this._map.getMaxZoom(),f=t===this._map.getMinZoom();this._zoomInButton.disabled=l,this._zoomOutButton.disabled=f,this._zoomInButton.setAttribute("aria-disabled",l.toString()),this._zoomOutButton.setAttribute("aria-disabled",f.toString())},this._rotateCompassArrow=()=>{this._compassIcon.style.transform=this.options.visualizePitch&&this.options.visualizeRoll?`scale(${1/Math.pow(Math.cos(this._map.transform.pitchInRadians),.5)}) rotateZ(${-this._map.transform.roll}deg) rotateX(${this._map.transform.pitch}deg) rotateZ(${-this._map.transform.bearing}deg)`:this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(this._map.transform.pitchInRadians),.5)}) rotateX(${this._map.transform.pitch}deg) rotateZ(${-this._map.transform.bearing}deg)`:this.options.visualizeRoll?`rotate(${-this._map.transform.bearing-this._map.transform.roll}deg)`:`rotate(${-this._map.transform.bearing}deg)`},this._setButtonTitle=(t,l)=>{const f=this._map._getUIString(`NavigationControl.${l}`);t.title=f,t.setAttribute("aria-label",f)},this.options=o.e({},Fs,b),this._container=V.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._container.addEventListener("contextmenu",t=>t.preventDefault()),this.options.showZoom&&(this._zoomInButton=this._createButton("maplibregl-ctrl-zoom-in",t=>this._map.zoomIn({},{originalEvent:t})),V.create("span","maplibregl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("maplibregl-ctrl-zoom-out",t=>this._map.zoomOut({},{originalEvent:t})),V.create("span","maplibregl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(this._compass=this._createButton("maplibregl-ctrl-compass",t=>{this.options.visualizePitch?this._map.resetNorthPitch({},{originalEvent:t}):this._map.resetNorth({},{originalEvent:t})}),this._compassIcon=V.create("span","maplibregl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}onAdd(b){return this._map=b,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),this._map.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&this._map.on("pitch",this._rotateCompassArrow),this.options.visualizeRoll&&this._map.on("roll",this._rotateCompassArrow),this._map.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new Op(this._map,this._compass,this.options.visualizePitch)),this._container}onRemove(){V.remove(this._container),this.options.showZoom&&this._map.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&this._map.off("pitch",this._rotateCompassArrow),this.options.visualizeRoll&&this._map.off("roll",this._rotateCompassArrow),this._map.off("rotate",this._rotateCompassArrow),this._handler.off(),delete this._handler),delete this._map}_createButton(b,t){const l=V.create("button",b,this._container);return l.type="button",l.addEventListener("click",t),l}},m.Popup=class extends o.E{constructor(b){super(),this._updateOpacity=()=>{this.options.locationOccludedOpacity!==void 0&&(this._container.style.opacity=this._map.transform.isLocationOccluded(this.getLngLat())?`${this.options.locationOccludedOpacity}`:"")},this.remove=()=>(this._content&&V.remove(this._content),this._container&&(V.remove(this._container),delete this._container),this._map&&(this._map.off("move",this._update),this._map.off("move",this._onClose),this._map.off("click",this._onClose),this._map.off("remove",this.remove),this._map.off("mousemove",this._onMouseMove),this._map.off("mouseup",this._onMouseUp),this._map.off("drag",this._onDrag),this._map._canvasContainer.classList.remove("maplibregl-track-pointer"),delete this._map,this.fire(new o.l("close"))),this),this._onMouseUp=t=>{this._update(t.point)},this._onMouseMove=t=>{this._update(t.point)},this._onDrag=t=>{this._update(t.point)},this._update=t=>{if(!this._map||!this._lngLat&&!this._trackPointer||!this._content)return;if(!this._container){if(this._container=V.create("div","maplibregl-popup",this._map.getContainer()),this._tip=V.create("div","maplibregl-popup-tip",this._container),this._container.appendChild(this._content),this.options.className)for(const I of this.options.className.split(" "))this._container.classList.add(I);this._closeButton&&this._closeButton.setAttribute("aria-label",this._map._getUIString("Popup.Close")),this._trackPointer&&this._container.classList.add("maplibregl-popup-track-pointer")}if(this.options.maxWidth&&this._container.style.maxWidth!==this.options.maxWidth&&(this._container.style.maxWidth=this.options.maxWidth),this._lngLat=Dp(this._lngLat,this._flatPos,this._map.transform,this._trackPointer),this._trackPointer&&!t)return;const l=this._flatPos=this._pos=this._trackPointer&&t?t:this._map.project(this._lngLat);this._map.terrain&&(this._flatPos=this._trackPointer&&t?t:this._map.transform.locationToScreenPoint(this._lngLat));let f=this.options.anchor;const g=$c(this.options.offset);if(!f){const I=this._container.offsetWidth,k=this._container.offsetHeight;let R;R=l.y+g.bottom.y<k?["top"]:l.y>this._map.transform.height-k?["bottom"]:[],l.x<I/2?R.push("left"):l.x>this._map.transform.width-I/2&&R.push("right"),f=R.length===0?"bottom":R.join("-")}let w=l.add(g[f]);this.options.subpixelPositioning||(w=w.round()),V.setTransform(this._container,`${xl[f]} translate(${w.x}px,${w.y}px)`),sn(this._container,f,"popup"),this._updateOpacity()},this._onClose=()=>{this.remove()},this.options=o.e(Object.create(Ku),b)}addTo(b){return this._map&&this.remove(),this._map=b,this.options.closeOnClick&&this._map.on("click",this._onClose),this.options.closeOnMove&&this._map.on("move",this._onClose),this._map.on("remove",this.remove),this._update(),this._focusFirstElement(),this._trackPointer?(this._map.on("mousemove",this._onMouseMove),this._map.on("mouseup",this._onMouseUp),this._container&&this._container.classList.add("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer")):this._map.on("move",this._update),this.fire(new o.l("open")),this}isOpen(){return!!this._map}getLngLat(){return this._lngLat}setLngLat(b){return this._lngLat=o.S.convert(b),this._pos=null,this._flatPos=null,this._trackPointer=!1,this._update(),this._map&&(this._map.on("move",this._update),this._map.off("mousemove",this._onMouseMove),this._container&&this._container.classList.remove("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.remove("maplibregl-track-pointer")),this}trackPointer(){return this._trackPointer=!0,this._pos=null,this._flatPos=null,this._update(),this._map&&(this._map.off("move",this._update),this._map.on("mousemove",this._onMouseMove),this._map.on("drag",this._onDrag),this._container&&this._container.classList.add("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer")),this}getElement(){return this._container}setText(b){return this.setDOMContent(document.createTextNode(b))}setHTML(b){const t=document.createDocumentFragment(),l=document.createElement("body");let f;for(l.innerHTML=b;f=l.firstChild,f;)t.appendChild(f);return this.setDOMContent(t)}getMaxWidth(){var b;return(b=this._container)===null||b===void 0?void 0:b.style.maxWidth}setMaxWidth(b){return this.options.maxWidth=b,this._update(),this}setDOMContent(b){if(this._content)for(;this._content.hasChildNodes();)this._content.firstChild&&this._content.removeChild(this._content.firstChild);else this._content=V.create("div","maplibregl-popup-content",this._container);return this._content.appendChild(b),this._createCloseButton(),this._update(),this._focusFirstElement(),this}addClassName(b){return this._container&&this._container.classList.add(b),this}removeClassName(b){return this._container&&this._container.classList.remove(b),this}setOffset(b){return this.options.offset=b,this._update(),this}toggleClassName(b){if(this._container)return this._container.classList.toggle(b)}setSubpixelPositioning(b){this.options.subpixelPositioning=b}_createCloseButton(){this.options.closeButton&&(this._closeButton=V.create("button","maplibregl-popup-close-button",this._content),this._closeButton.type="button",this._closeButton.innerHTML="&#215;",this._closeButton.addEventListener("click",this._onClose))}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;const b=this._container.querySelector(Wh);b&&b.focus()}},m.RasterDEMTileSource=jr,m.RasterTileSource=sr,m.ScaleControl=class{constructor(b){this._onMove=()=>{Bc(this._map,this._container,this.options)},this.setUnit=t=>{this.options.unit=t,Bc(this._map,this._container,this.options)},this.options=Object.assign(Object.assign({},Zh),b)}getDefaultPosition(){return"bottom-left"}onAdd(b){return this._map=b,this._container=V.create("div","maplibregl-ctrl maplibregl-ctrl-scale",b.getContainer()),this._map.on("move",this._onMove),this._onMove(),this._container}onRemove(){V.remove(this._container),this._map.off("move",this._onMove),this._map=void 0}},m.ScrollZoomHandler=Ap,m.Style=ea,m.TerrainControl=class{constructor(b){this._toggleTerrain=()=>{this._map.getTerrain()?this._map.setTerrain(null):this._map.setTerrain(this.options),this._updateTerrainIcon()},this._updateTerrainIcon=()=>{this._terrainButton.classList.remove("maplibregl-ctrl-terrain"),this._terrainButton.classList.remove("maplibregl-ctrl-terrain-enabled"),this._map.terrain?(this._terrainButton.classList.add("maplibregl-ctrl-terrain-enabled"),this._terrainButton.title=this._map._getUIString("TerrainControl.Disable")):(this._terrainButton.classList.add("maplibregl-ctrl-terrain"),this._terrainButton.title=this._map._getUIString("TerrainControl.Enable"))},this.options=b}onAdd(b){return this._map=b,this._container=V.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._terrainButton=V.create("button","maplibregl-ctrl-terrain",this._container),V.create("span","maplibregl-ctrl-icon",this._terrainButton).setAttribute("aria-hidden","true"),this._terrainButton.type="button",this._terrainButton.addEventListener("click",this._toggleTerrain),this._updateTerrainIcon(),this._map.on("terrain",this._updateTerrainIcon),this._container}onRemove(){V.remove(this._container),this._map.off("terrain",this._updateTerrainIcon),this._map=void 0}},m.TwoFingersTouchPitchHandler=zh,m.TwoFingersTouchRotateHandler=Fh,m.TwoFingersTouchZoomHandler=oa,m.TwoFingersTouchZoomRotateHandler=Gh,m.VectorTileSource=Gi,m.VideoSource=In,m.addSourceType=(b,t)=>o._(void 0,void 0,void 0,function*(){if($s(b))throw new Error(`A source type called "${b}" already exists.`);((l,f)=>{os[l]=f})(b,t)}),m.clearPrewarmedResources=function(){const b=Zt;b&&(b.isPreloaded()&&b.numActive()===1?(b.release(vt),Zt=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},m.createTileMesh=pl,m.getMaxParallelImageRequests=function(){return o.a.MAX_PARALLEL_IMAGE_REQUESTS},m.getRTLTextPluginStatus=function(){return rn().getRTLTextPluginStatus()},m.getVersion=function(){return Yh},m.getWorkerCount=function(){return Ft.workerCount},m.getWorkerUrl=function(){return o.a.WORKER_URL},m.importScriptInWorkers=function(b){return Ir().broadcast("IS",b)},m.prewarm=function(){ti().acquire(vt)},m.setMaxParallelImageRequests=function(b){o.a.MAX_PARALLEL_IMAGE_REQUESTS=b},m.setRTLTextPlugin=function(b,t){return rn().setRTLTextPlugin(b,t)},m.setWorkerCount=function(b){Ft.workerCount=b},m.setWorkerUrl=function(b){o.a.WORKER_URL=b}});var x=i;return x})}(Df)),Df.exports}function kI(r,e){for(var i=0;i<e.length;i++){const s=e[i];if(typeof s!="string"&&!Array.isArray(s)){for(const h in s)if(h!=="default"&&!(h in r)){const x=Object.getOwnPropertyDescriptor(s,h);x&&Object.defineProperty(r,h,x.get?x:{enumerable:!0,get:()=>s[h]})}}}return Object.freeze(Object.defineProperty(r,Symbol.toStringTag,{value:"Module"}))}var Am=PI();const u_=l_(Am),CI=kI({__proto__:null,default:u_},[Am]),K1=Object.freeze(Object.defineProperty({__proto__:null,L:CI,default:u_,m:Am},Symbol.toStringTag,{value:"Module"}));var AI=Object.defineProperty,J1=r=>{throw TypeError(r)},LI=(r,e,i)=>e in r?AI(r,e,{enumerable:!0,configurable:!0,writable:!0,value:i}):r[e]=i,Si=(r,e,i)=>LI(r,typeof e!="symbol"?e+"":e,i),Q1=(r,e,i)=>e.has(r)||J1("Cannot "+i),Wn=(r,e,i)=>(Q1(r,e,"read from private field"),e.get(r)),Hg=(r,e,i)=>e.has(r)?J1("Cannot add the same private member more than once"):e instanceof WeakSet?e.add(r):e.set(r,i),sf=(r,e,i,s)=>(Q1(r,e,"write to private field"),e.set(r,i),i);function _n(){}function RI(r,e){for(const i in e)r[i]=e[i];return r}function eb(r){return r()}function ex(){return Object.create(null)}function ql(r){r.forEach(eb)}function tb(r){return typeof r=="function"}function Lu(r,e){return r!=r?e==e:r!==e||r&&typeof r=="object"||typeof r=="function"}let of;function Hs(r,e){return r===e?!0:(of||(of=document.createElement("a")),of.href=e,r===of.href)}function NI(r){return Object.keys(r).length===0}function OI(r,e,i,s){if(r){const h=ib(r,e,i,s);return r[0](h)}}function ib(r,e,i,s){return r[1]&&s?RI(i.ctx.slice(),r[1](s(e))):i.ctx}function DI(r,e,i,s){return r[2],e.dirty}function FI(r,e,i,s,h,x){if(h){const m=ib(e,i,s,x);r.p(m,h)}}function zI(r){if(r.ctx.length>32){const e=[],i=r.ctx.length/32;for(let s=0;s<i;s++)e[s]=-1;return e}return-1}function Yf(r){return r??""}function kr(r,e){r.appendChild(e)}function cn(r,e,i){r.insertBefore(e,i||null)}function tn(r){r.parentNode&&r.parentNode.removeChild(r)}function Zr(r){return document.createElement(r)}function La(r){return document.createElementNS("http://www.w3.org/2000/svg",r)}function Eu(r){return document.createTextNode(r)}function Go(){return Eu(" ")}function BI(){return Eu("")}function _s(r,e,i,s){return r.addEventListener(e,i,s),()=>r.removeEventListener(e,i,s)}function $I(r){return function(e){return e.preventDefault(),r.call(this,e)}}function St(r,e,i){i==null?r.removeAttribute(e):r.getAttribute(e)!==i&&r.setAttribute(e,i)}function jI(r){return Array.from(r.childNodes)}function zd(r,e){e=""+e,r.data!==e&&(r.data=e)}function tx(r,e){r.value=e??""}function nl(r,e,i){r.classList.toggle(e,!!i)}function GI(r,e,{bubbles:i=!1,cancelable:s=!1}={}){return new CustomEvent(r,{detail:e,bubbles:i,cancelable:s})}let Bd;function Fd(r){Bd=r}function rb(){if(!Bd)throw new Error("Function called outside component initialization");return Bd}function UI(r){rb().$$.on_destroy.push(r)}function nb(){const r=rb();return(e,i,{cancelable:s=!1}={})=>{const h=r.$$.callbacks[e];if(h){const x=GI(e,i,{cancelable:s});return h.slice().forEach(m=>{m.call(r,x)}),!x.defaultPrevented}return!0}}function VI(r,e){const i=r.$$.callbacks[e.type];i&&i.slice().forEach(s=>s.call(this,e))}const nh=[],Ey=[];let dh=[];const ix=[],qI=Promise.resolve();let Iy=!1;function ZI(){Iy||(Iy=!0,qI.then(sb))}function Sy(r){dh.push(r)}const Kg=new Set;let eh=0;function sb(){if(eh!==0)return;const r=Bd;do{try{for(;eh<nh.length;){const e=nh[eh];eh++,Fd(e),WI(e.$$)}}catch(e){throw nh.length=0,eh=0,e}for(Fd(null),nh.length=0,eh=0;Ey.length;)Ey.pop()();for(let e=0;e<dh.length;e+=1){const i=dh[e];Kg.has(i)||(Kg.add(i),i())}dh.length=0}while(nh.length);for(;ix.length;)ix.pop()();Iy=!1,Kg.clear(),Fd(r)}function WI(r){if(r.fragment!==null){r.update(),ql(r.before_update);const e=r.dirty;r.dirty=[-1],r.fragment&&r.fragment.p(r.ctx,e),r.after_update.forEach(Sy)}}function YI(r){const e=[],i=[];dh.forEach(s=>r.indexOf(s)===-1?e.push(s):i.push(s)),i.forEach(s=>s()),dh=e}const Ff=new Set;let hc;function Ed(){hc={r:0,c:[],p:hc}}function Id(){hc.r||ql(hc.c),hc=hc.p}function Tn(r,e){r&&r.i&&(Ff.delete(r),r.i(e))}function ss(r,e,i,s){if(r&&r.o){if(Ff.has(r))return;Ff.add(r),hc.c.push(()=>{Ff.delete(r),s&&(i&&r.d(1),s())}),r.o(e)}else s&&s()}function rx(r){return r?.length!==void 0?r:Array.from(r)}function XI(r,e){ss(r,1,1,()=>{e.delete(r.key)})}function HI(r,e,i,s,h,x,m,o,P,L,D,F){let Y=r.length,V=x.length,H=Y;const ve={};for(;H--;)ve[r[H].key]=H;const _e=[],oe=new Map,fe=new Map,K=[];for(H=V;H--;){const Se=F(h,x,H),Z=i(Se);let $=m.get(Z);$?K.push(()=>$.p(Se,e)):($=L(Z,Se),$.c()),oe.set(Z,_e[H]=$),Z in ve&&fe.set(Z,Math.abs(H-ve[Z]))}const ne=new Set,ye=new Set;function Re(Se){Tn(Se,1),Se.m(o,D),m.set(Se.key,Se),D=Se.first,V--}for(;Y&&V;){const Se=_e[V-1],Z=r[Y-1],$=Se.key,Q=Z.key;Se===Z?(D=Se.first,Y--,V--):oe.has(Q)?!m.has($)||ne.has($)?Re(Se):ye.has(Q)?Y--:fe.get($)>fe.get(Q)?(ye.add($),Re(Se)):(ne.add(Q),Y--):(P(Z,m),Y--)}for(;Y--;){const Se=r[Y];oe.has(Se.key)||P(Se,m)}for(;V;)Re(_e[V-1]);return ql(K),_e}function Iu(r){r&&r.c()}function zl(r,e,i){const{fragment:s,after_update:h}=r.$$;s&&s.m(e,i),Sy(()=>{const x=r.$$.on_mount.map(eb).filter(tb);r.$$.on_destroy?r.$$.on_destroy.push(...x):ql(x),r.$$.on_mount=[]}),h.forEach(Sy)}function Bl(r,e){const i=r.$$;i.fragment!==null&&(YI(i.after_update),ql(i.on_destroy),i.fragment&&i.fragment.d(e),i.on_destroy=i.fragment=null,i.ctx=[])}function KI(r,e){r.$$.dirty[0]===-1&&(nh.push(r),ZI(),r.$$.dirty.fill(0)),r.$$.dirty[e/31|0]|=1<<e%31}function Ru(r,e,i,s,h,x,m=null,o=[-1]){const P=Bd;Fd(r);const L=r.$$={fragment:null,ctx:[],props:x,update:_n,not_equal:h,bound:ex(),on_mount:[],on_destroy:[],on_disconnect:[],before_update:[],after_update:[],context:new Map(e.context||(P?P.$$.context:[])),callbacks:ex(),dirty:o,skip_bound:!1,root:e.target||P.$$.root};m&&m(L.root);let D=!1;if(L.ctx=i?i(r,e.props||{},(F,Y,...V)=>{const H=V.length?V[0]:Y;return L.ctx&&h(L.ctx[F],L.ctx[F]=H)&&(!L.skip_bound&&L.bound[F]&&L.bound[F](H),D&&KI(r,F)),Y}):[],L.update(),D=!0,ql(L.before_update),L.fragment=s?s(L.ctx):!1,e.target){if(e.hydrate){const F=jI(e.target);L.fragment&&L.fragment.l(F),F.forEach(tn)}else L.fragment&&L.fragment.c();e.intro&&Tn(r.$$.fragment),zl(r,e.target,e.anchor),sb()}Fd(P)}let Nu=class{constructor(){Si(this,"$$"),Si(this,"$$set")}$destroy(){Bl(this,1),this.$destroy=_n}$on(e,i){if(!tb(i))return _n;const s=this.$$.callbacks[e]||(this.$$.callbacks[e]=[]);return s.push(i),()=>{const h=s.indexOf(i);h!==-1&&s.splice(h,1)}}$set(e){this.$$set&&!NI(e)&&(this.$$.skip_bound=!0,this.$$set(e),this.$$.skip_bound=!1)}};const JI="4";typeof window<"u"&&(window.__svelte||(window.__svelte={v:new Set})).v.add(JI);function QI(r){let e,i;return{c(){e=La("svg"),i=La("path"),St(i,"d","M13.12.706a.982.982 0 0 0-1.391 0L6.907 5.517 2.087.696a.982.982 0 1 0-1.391 1.39l4.821 4.821L.696 11.73a.982.982 0 1 0 1.39 1.39l4.821-4.821 4.822 4.821a.982.982 0 1 0 1.39-1.39L8.298 6.908l4.821-4.822a.988.988 0 0 0 0-1.38Z"),St(e,"viewBox","0 0 14 14"),St(e,"width","13"),St(e,"height","13"),St(e,"class","svelte-en2qvf")},m(s,h){cn(s,e,h),kr(e,i)},p:_n,i:_n,o:_n,d(s){s&&tn(e)}}}let ob=class extends Nu{constructor(e){super(),Ru(this,e,null,QI,Lu,{})}};function eS(r){let e,i;return{c(){e=La("svg"),i=La("path"),St(i,"d","M15 0C6.705 0 0 6.705 0 15C0 23.295 6.705 30 15 30C23.295 30 30 23.295 30 15C30 6.705 23.295 0 15 0ZM22.5 20.385L20.385 22.5L15 17.115L9.615 22.5L7.5 20.385L12.885 15L7.5 9.615L9.615 7.5L15 12.885L20.385 7.5L22.5 9.615L17.115 15L22.5 20.385Z"),St(e,"viewBox","0 0 30 30"),St(e,"fill","none"),St(e,"xmlns","http://www.w3.org/2000/svg"),St(e,"class","svelte-d2loi5")},m(s,h){cn(s,e,h),kr(e,i)},p:_n,i:_n,o:_n,d(s){s&&tn(e)}}}let ab=class extends Nu{constructor(e){super(),Ru(this,e,null,eS,Lu,{})}};function tS(r){let e,i;return{c(){e=Zr("img"),Hs(e.src,i=r[3]+"area.svg")||St(e,"src",i),St(e,"alt",r[7]),St(e,"title",r[7]),St(e,"class","svelte-w9y5n9")},m(s,h){cn(s,e,h)},p(s,h){h&8&&!Hs(e.src,i=s[3]+"area.svg")&&St(e,"src",i),h&128&&St(e,"alt",s[7]),h&128&&St(e,"title",s[7])},d(s){s&&tn(e)}}}function iS(r){let e,i;return{c(){e=Zr("img"),Hs(e.src,i=r[3]+"reverse.svg")||St(e,"src",i),St(e,"alt",r[7]),St(e,"title",r[7]),St(e,"class","svelte-w9y5n9")},m(s,h){cn(s,e,h)},p(s,h){h&8&&!Hs(e.src,i=s[3]+"reverse.svg")&&St(e,"src",i),h&128&&St(e,"alt",s[7]),h&128&&St(e,"title",s[7])},d(s){s&&tn(e)}}}function rS(r){let e,i;return{c(){e=Zr("img"),Hs(e.src,i=r[3]+"poi.svg")||St(e,"src",i),St(e,"alt",r[7]),St(e,"title",r[7]),St(e,"class","svelte-w9y5n9")},m(s,h){cn(s,e,h)},p(s,h){h&8&&!Hs(e.src,i=s[3]+"poi.svg")&&St(e,"src",i),h&128&&St(e,"alt",s[7]),h&128&&St(e,"title",s[7])},d(s){s&&tn(e)}}}function nS(r){let e,i;return{c(){e=Zr("img"),Hs(e.src,i=r[3]+"postal_code.svg")||St(e,"src",i),St(e,"alt",r[7]),St(e,"title",r[7]),St(e,"class","svelte-w9y5n9")},m(s,h){cn(s,e,h)},p(s,h){h&8&&!Hs(e.src,i=s[3]+"postal_code.svg")&&St(e,"src",i),h&128&&St(e,"alt",s[7]),h&128&&St(e,"title",s[7])},d(s){s&&tn(e)}}}function sS(r){let e,i;return{c(){e=Zr("img"),Hs(e.src,i=r[3]+"street.svg")||St(e,"src",i),St(e,"alt",r[7]),St(e,"title",r[7]),St(e,"class","svelte-w9y5n9")},m(s,h){cn(s,e,h)},p(s,h){h&8&&!Hs(e.src,i=s[3]+"street.svg")&&St(e,"src",i),h&128&&St(e,"alt",s[7]),h&128&&St(e,"title",s[7])},d(s){s&&tn(e)}}}function oS(r){let e,i;return{c(){e=Zr("img"),Hs(e.src,i=r[3]+"road.svg")||St(e,"src",i),St(e,"alt",r[7]),St(e,"title",r[7]),St(e,"class","svelte-w9y5n9")},m(s,h){cn(s,e,h)},p(s,h){h&8&&!Hs(e.src,i=s[3]+"road.svg")&&St(e,"src",i),h&128&&St(e,"alt",s[7]),h&128&&St(e,"title",s[7])},d(s){s&&tn(e)}}}function aS(r){let e,i;return{c(){e=Zr("img"),Hs(e.src,i=r[3]+"housenumber.svg")||St(e,"src",i),St(e,"alt",r[7]),St(e,"title",r[7]),St(e,"class","svelte-w9y5n9")},m(s,h){cn(s,e,h)},p(s,h){h&8&&!Hs(e.src,i=s[3]+"housenumber.svg")&&St(e,"src",i),h&128&&St(e,"alt",s[7]),h&128&&St(e,"title",s[7])},d(s){s&&tn(e)}}}function lS(r){let e,i,s,h;return{c(){e=Zr("img"),Hs(e.src,i=r[5])||St(e,"src",i),St(e,"alt",r[4]),St(e,"title",r[7]),St(e,"class","svelte-w9y5n9")},m(x,m){cn(x,e,m),s||(h=_s(e,"error",r[14]),s=!0)},p(x,m){m&32&&!Hs(e.src,i=x[5])&&St(e,"src",i),m&16&&St(e,"alt",x[4]),m&128&&St(e,"title",x[7])},d(x){x&&tn(e),s=!1,h()}}}function uS(r){let e,i;return{c(){e=Zr("div"),St(e,"class","sprite-icon svelte-w9y5n9"),St(e,"style",i=`
        width: ${r[6].width/ca}px;
        height: ${r[6].height/ca}px;
        background-image: url(${r[3]}sprite${My}.png);
        background-position: -${r[6].x/ca}px -${r[6].y/ca}px;
        background-size: ${Dl.width/ca}px ${Dl.height/ca}px;
      `),St(e,"title",r[7])},m(s,h){cn(s,e,h)},p(s,h){h&72&&i!==(i=`
        width: ${s[6].width/ca}px;
        height: ${s[6].height/ca}px;
        background-image: url(${s[3]}sprite${My}.png);
        background-position: -${s[6].x/ca}px -${s[6].y/ca}px;
        background-size: ${Dl.width/ca}px ${Dl.height/ca}px;
      `)&&St(e,"style",i),h&128&&St(e,"title",s[7])},d(s){s&&tn(e)}}}function nx(r){let e,i;return{c(){e=Zr("span"),i=Eu(r[7]),St(e,"class","secondary svelte-w9y5n9")},m(s,h){cn(s,e,h),kr(e,i)},p(s,h){h&128&&zd(i,s[7])},d(s){s&&tn(e)}}}function cS(r){let e,i,s,h,x,m,o,P,L,D=(r[8]?r[0].place_name:r[0].place_name.replace(/,.*/,""))+"",F,Y,V=r[2]==="always"||r[2]!=="never"&&!r[0].address&&!r[0].id.startsWith("road.")&&!r[0].id.startsWith("address.")&&!r[0].id.startsWith("postal_code.")&&(!r[0].id.startsWith("poi.")||!r[5])&&!r[8],H,ve,_e=(r[8]?"":r[0].place_name.replace(/[^,]*,?\s*/,""))+"",oe,fe,K,ne,ye,Re;function Se(ue,he){return he&1&&(i=null),he&1&&(s=null),he&1&&(h=null),he&1&&(x=null),Dl&&ue[6]?uS:ue[5]?lS:ue[0].address?aS:(i==null&&(i=!!ue[0].id.startsWith("road.")),i?oS:(s==null&&(s=!!ue[0].id.startsWith("address.")),s?sS:(h==null&&(h=!!ue[0].id.startsWith("postal_code.")),h?nS:(x==null&&(x=!!ue[0].id.startsWith("poi.")),x?rS:ue[8]?iS:tS))))}let Z=Se(r,-1),$=Z(r),Q=V&&nx(r);return{c(){e=Zr("li"),$.c(),m=Go(),o=Zr("span"),P=Zr("span"),L=Zr("span"),F=Eu(D),Y=Go(),Q&&Q.c(),H=Go(),ve=Zr("span"),oe=Eu(_e),St(L,"class","primary svelte-w9y5n9"),St(P,"class","svelte-w9y5n9"),St(ve,"class","line2 svelte-w9y5n9"),St(o,"class","texts svelte-w9y5n9"),St(e,"tabindex","-1"),St(e,"role","option"),St(e,"aria-selected",fe=r[1]==="selected"),St(e,"aria-checked",K=r[1]==="picked"),St(e,"class",ne=Yf(r[1])+" svelte-w9y5n9")},m(ue,he){cn(ue,e,he),$.m(e,null),kr(e,m),kr(e,o),kr(o,P),kr(P,L),kr(L,F),kr(P,Y),Q&&Q.m(P,null),kr(o,H),kr(o,ve),kr(ve,oe),ye||(Re=[_s(e,"mouseenter",r[13]),_s(e,"focus",r[15]),_s(e,"click",r[16])],ye=!0)},p(ue,[he]){Z===(Z=Se(ue,he))&&$?$.p(ue,he):($.d(1),$=Z(ue),$&&($.c(),$.m(e,m))),he&257&&D!==(D=(ue[8]?ue[0].place_name:ue[0].place_name.replace(/,.*/,""))+"")&&zd(F,D),he&293&&(V=ue[2]==="always"||ue[2]!=="never"&&!ue[0].address&&!ue[0].id.startsWith("road.")&&!ue[0].id.startsWith("address.")&&!ue[0].id.startsWith("postal_code.")&&(!ue[0].id.startsWith("poi.")||!ue[5])&&!ue[8]),V?Q?Q.p(ue,he):(Q=nx(ue),Q.c(),Q.m(P,null)):Q&&(Q.d(1),Q=null),he&257&&_e!==(_e=(ue[8]?"":ue[0].place_name.replace(/[^,]*,?\s*/,""))+"")&&zd(oe,_e),he&2&&fe!==(fe=ue[1]==="selected")&&St(e,"aria-selected",fe),he&2&&K!==(K=ue[1]==="picked")&&St(e,"aria-checked",K),he&2&&ne!==(ne=Yf(ue[1])+" svelte-w9y5n9")&&St(e,"class",ne)},i:_n,o:_n,d(ue){ue&&tn(e),$.d(),Q&&Q.d(),ye=!1,ql(Re)}}}const lb=typeof devicePixelRatio>"u"?1:devicePixelRatio>1.25,My=lb?"@2x":"",ca=lb?2:1;let Dl,Jg;function hS(r,e,i){let s,h,x,{feature:m}=e,{style:o="default"}=e,{showPlaceType:P}=e,{missingIconsCache:L}=e,{iconsBaseUrl:D}=e;const F=nb();let Y,V,H,ve;function _e(){Jg??(Jg=fetch(`${D}sprite${My}.json`).then(Z=>Z.json()).then(Z=>{Dl=Z}).catch(()=>{Dl=null}))}function oe(){V&&L.add(V),fe()}function fe(){Dl!==void 0?K():(_e(),Jg?.then(K))}function K(){do{if(ve--,i(4,Y=s?.[ve]),i(6,H=Y?Dl?.icons[Y]:void 0),H)break;i(5,V=Y?D+Y.replace(/ /g,"_")+".svg":void 0)}while(ve>-1&&(!V||L.has(V)))}function ne(Z){VI.call(this,r,Z)}const ye=()=>oe(),Re=()=>F("select",void 0),Se=Z=>{document.activeElement!==Z.target&&F("select",void 0)};return r.$$set=Z=>{"feature"in Z&&i(0,m=Z.feature),"style"in Z&&i(1,o=Z.style),"showPlaceType"in Z&&i(2,P=Z.showPlaceType),"missingIconsCache"in Z&&i(11,L=Z.missingIconsCache),"iconsBaseUrl"in Z&&i(3,D=Z.iconsBaseUrl)},r.$$.update=()=>{var Z,$,Q,ue,he;r.$$.dirty&1&&i(12,s=(Z=m.properties)==null?void 0:Z.categories),r.$$.dirty&1&&i(8,h=m.place_type[0]==="reverse"),r.$$.dirty&1&&i(7,x=((Q=($=m.properties)==null?void 0:$.categories)==null?void 0:Q.join(", "))??((he=(ue=m.properties)==null?void 0:ue.place_type_name)==null?void 0:he[0])??m.place_type[0]),r.$$.dirty&4096&&(ve=s?.length??0,fe())},[m,o,P,D,Y,V,H,x,h,F,oe,L,s,ne,ye,Re,Se]}let dS=class extends Nu{constructor(e){super(),Ru(this,e,hS,cS,Lu,{feature:0,style:1,showPlaceType:2,missingIconsCache:11,iconsBaseUrl:3})}};function pS(r){let e;return{c(){e=Zr("div"),e.innerHTML='<svg viewBox="0 0 18 18" width="24" height="24" class="loading-icon svelte-1ocfouu"><path fill="#333" d="M4.4 4.4l.8.8c2.1-2.1 5.5-2.1 7.6 0l.8-.8c-2.5-2.5-6.7-2.5-9.2 0z"></path><path opacity=".1" d="M12.8 12.9c-2.1 2.1-5.5 2.1-7.6 0-2.1-2.1-2.1-5.5 0-7.7l-.8-.8c-2.5 2.5-2.5 6.7 0 9.2s6.6 2.5 9.2 0 2.5-6.6 0-9.2l-.8.8c2.2 2.1 2.2 5.6 0 7.7z"></path></svg>',St(e,"class","svelte-1ocfouu")},m(i,s){cn(i,e,s)},p:_n,i:_n,o:_n,d(i){i&&tn(e)}}}let fS=class extends Nu{constructor(e){super(),Ru(this,e,null,pS,Lu,{})}};function mS(r){let e,i,s;return{c(){e=La("svg"),i=La("path"),St(i,"stroke-width","4"),St(i,"d","M 5,33.103579 C 5,17.607779 18.457,5 35,5 C 51.543,5 65,17.607779 65,33.103579 C 65,56.388679 40.4668,76.048179 36.6112,79.137779 C 36.3714,79.329879 36.2116,79.457979 36.1427,79.518879 C 35.8203,79.800879 35.4102,79.942779 35,79.942779 C 34.5899,79.942779 34.1797,79.800879 33.8575,79.518879 C 33.7886,79.457979 33.6289,79.330079 33.3893,79.138079 C 29.5346,76.049279 5,56.389379 5,33.103579 Z M 35.0001,49.386379 C 43.1917,49.386379 49.8323,42.646079 49.8323,34.331379 C 49.8323,26.016779 43.1917,19.276479 35.0001,19.276479 C 26.8085,19.276479 20.1679,26.016779 20.1679,34.331379 C 20.1679,42.646079 26.8085,49.386379 35.0001,49.386379 Z"),St(i,"class","svelte-gzo3ar"),St(e,"width",s=r[0]==="list"?20:void 0),St(e,"viewBox","0 0 70 85"),St(e,"fill","none"),St(e,"class","svelte-gzo3ar"),nl(e,"in-map",r[0]!=="list"),nl(e,"list-icon",r[0]==="list")},m(h,x){cn(h,e,x),kr(e,i)},p(h,[x]){x&1&&s!==(s=h[0]==="list"?20:void 0)&&St(e,"width",s),x&1&&nl(e,"in-map",h[0]!=="list"),x&1&&nl(e,"list-icon",h[0]==="list")},i:_n,o:_n,d(h){h&&tn(e)}}}function gS(r,e,i){let{displayIn:s}=e;return r.$$set=h=>{"displayIn"in h&&i(0,s=h.displayIn)},[s]}let yS=class extends Nu{constructor(e){super(),Ru(this,e,gS,mS,Lu,{displayIn:0})}};function _S(r){let e,i;return{c(){e=La("svg"),i=La("path"),St(i,"d","M30.003-26.765C13.46-26.765 0-14.158 0 1.337c0 23.286 24.535 42.952 28.39 46.04.24.192.402.316.471.376.323.282.732.424 1.142.424.41 0 .82-.142 1.142-.424.068-.06.231-.183.471-.376 3.856-3.09 28.39-22.754 28.39-46.04 0-15.495-13.46-28.102-30.003-28.102Zm1.757 12.469c4.38 0 7.858 1.052 10.431 3.158 2.595 2.105 3.89 4.913 3.89 8.422 0 2.34-.53 4.362-1.593 6.063-1.063 1.702-3.086 3.616-6.063 5.742-2.042 1.51-3.337 2.659-3.89 3.446-.532.787-.8 1.82-.8 3.096v1.914h-8.449V15.18c0-2.041.434-3.815 1.306-5.325.872-1.51 2.467-3.118 4.785-4.82 2.233-1.594 3.7-2.89 4.402-3.889a5.582 5.582 0 0 0 1.087-3.35c0-1.382-.51-2.435-1.531-3.158-1.02-.723-2.45-1.087-4.28-1.087-3.19 0-6.826 1.047-10.91 3.131l-3.472-6.986c4.742-2.659 9.77-3.992 15.087-3.992Zm-1.88 37.324c1.765 0 3.124.472 4.08 1.408.98.936 1.47 2.276 1.47 4.02 0 1.68-.49 3.007-1.47 3.985-.977.957-2.336 1.435-4.08 1.435-1.787 0-3.171-.465-4.15-1.4-.978-.958-1.47-2.298-1.47-4.02 0-1.787.48-3.14 1.436-4.054.957-.915 2.355-1.374 4.184-1.374Z"),St(e,"viewBox","0 0 60.006 21.412"),St(e,"width","14"),St(e,"height","20"),St(e,"class","svelte-en2qvf")},m(s,h){cn(s,e,h),kr(e,i)},p:_n,i:_n,o:_n,d(s){s&&tn(e)}}}let vS=class extends Nu{constructor(e){super(),Ru(this,e,null,_S,Lu,{})}};function xS(r){let e,i,s;return{c(){e=La("svg"),i=La("circle"),s=La("path"),St(i,"cx","4.789"),St(i,"cy","4.787"),St(i,"r","3.85"),St(i,"class","svelte-1aq105l"),St(s,"d","M12.063 12.063 7.635 7.635"),St(s,"class","svelte-1aq105l"),St(e,"xmlns","http://www.w3.org/2000/svg"),St(e,"width","13"),St(e,"height","13"),St(e,"viewBox","0 0 13 13"),St(e,"class","svelte-1aq105l")},m(h,x){cn(h,e,x),kr(e,i),kr(e,s)},p:_n,i:_n,o:_n,d(h){h&&tn(e)}}}let bS=class extends Nu{constructor(e){super(),Ru(this,e,null,xS,Lu,{})}};function wS(r,e,i){const s=e[1],h=e[0],x=s-h;return r===s&&i?r:((r-h)%x+x)%x+h}function Xf(r){const e=[...r];return e[2]<e[0]&&(Math.abs((e[0]+e[2]+360)/2)>Math.abs((e[0]-360+e[2])/2)?e[0]-=360:e[2]+=360),e}let gd;async function TS(r,e,i){const s=r?.getCenterAndZoom();for(const h of e??[])if(!(s&&(h.minZoom!=null&&h.minZoom>s[0]||h.maxZoom!=null&&h.maxZoom<s[0]))){if(h.type==="fixed")return h.coordinates.join(",");e:if(h.type==="client-geolocation"){if(gd&&h.cachedLocationExpiry&&gd.time+h.cachedLocationExpiry>Date.now()){if(!gd.coords)break e;return gd.coords}let x;try{return x=await new Promise((m,o)=>{i.signal.addEventListener("abort",()=>{o(Error("aborted"))}),navigator.geolocation.getCurrentPosition(P=>{m([P.coords.longitude,P.coords.latitude].map(L=>L.toFixed(6)).join(","))},P=>{o(P)},h)}),x}catch{}finally{h.cachedLocationExpiry&&(gd={time:Date.now(),coords:x})}if(i.signal.aborted)return}if(h.type==="server-geolocation")return"ip";if(s&&h.type==="map-center")return s[1].toFixed(6)+","+s[2].toFixed(6)}}const ES=/^(NORTH|SOUTH|[NS])?\s*([+-]?[0-8]?[0-9])\s*([\.:]|D(?:EG)?(?:REES)?)?\s*,?([6-9][0-9])\s*(['\.:]|M(?:IN)?(?:UTES)?)?\s*(NORTH|SOUTH|[NS])?(?:\s*[,/;]\s*|\s*)(EAST|WEST|[EW])?\s*([+-]?[0-1]?[0-9]?[0-9])\s*([\.:]|D(?:EG)?(?:REES)?)?\s*,?([6-9][0-9])\s*(['\.:]|M(?:IN)?(?:UTES)?)?\s*(EAST|WEST|[EW])?$/i,sx=/^([+-]?[0-8]?[0-9])\s+([0-5]?[0-9]\.\d{3,})[\s,]{1,}([+-]?[0-1]?[0-9]?[0-9])\s+([0-5]?[0-9]\.\d{3,})$/,ox=/^(NORTH|SOUTH|[NS])?[\s]*([+-]?[0-8]?[0-9](?:[\.,]\d{3,}))[\s]*([]?)[\s]*(NORTH|SOUTH|[NS])?[\s]*[,/;]?[\s]*(EAST|WEST|[EW])?[\s]*([+-]?[0-1]?[0-9]?[0-9](?:[\.,]\d{3,}))[\s]*([]?)[\s]*(EAST|WEST|[EW])?$/i,ax=/^(NORTH|SOUTH|[NS])?\s*([+-]?[0-8]?[0-9])\s*(\.)\s*([0-5]?[0-9])\s*(\.)\s*((?:[0-5]?[0-9])(?:[\.,]\d{1,3})?)?\s*(NORTH|SOUTH|[NS])?(?:\s*[,/;]\s*|\s*)(EAST|WEST|[EW])?\s*([+-]?[0-1]?[0-9]?[0-9])\s*(\.)\s*([0-5]?[0-9])\s*(\.)\s*((?:[0-5]?[0-9])(?:[\.,]\d{1,3})?)?\s*(EAST|WEST|[EW])?$/i,lx=/^(NORTH|SOUTH|[NS])?\s*([+-]?[0-8]?[0-9])\s*(D(?:EG)?(?:REES)?)\s*([0-5]?[0-9])\s*(M(?:IN)?(?:UTES)?)\s*((?:[0-5]?[0-9])(?:[\.,]\d{1,3})?)?\s*(S(?:EC)?(?:ONDS)?)?\s*(NORTH|SOUTH|[NS])?(?:\s*[,/;]\s*|\s*)(EAST|WEST|[EW])?\s*([+-]?[0-1]?[0-9]?[0-9])\s*(D(?:EG)?(?:REES)?)\s*([0-5]?[0-9])\s*(M(?:IN)?(?:UTES)?)\s*((?:[0-5]?[0-9])(?:[\.,]\d{1,3})?)?\s*(S(?:EC)?(?:ONDS)?)\s*(EAST|WEST|[EW])?$/i,ux=/^(NORTH|SOUTH|[NS])?\s*([+-]?[0-8]?[0-9])\s*([\.:]|D(?:EG)?(?:REES)?)?\s*,?([0-5]?[0-9](?:[\.,]\d{1,})?)?\s*(['\.:]|M(?:IN)?(?:UTES)?)?\s*,?((?:[0-5]?[0-9])(?:[\.,]\d{1,3})?)?\s*(''||||["\.])?\s*(NORTH|SOUTH|[NS])?(?:\s*[,/;]\s*|\s*)(EAST|WEST|[EW])?\s*([+-]?[0-1]?[0-9]?[0-9])\s*([\.:]|D(?:EG)?(?:REES)?)?\s*,?([0-5]?[0-9](?:[\.,]\d{1,})?)?\s*(['\.:]|M(?:IN)?(?:UTES)?)?\s*,?((?:[0-5]?[0-9])(?:[\.,]\d{1,3})?)?\s*(''||||["\.])?\s*(EAST|WEST|[EW])?$/i;function IS(r){if(!["DMS","DM","DD"].includes(r))throw new Error("invalid format specified");if(this.decimalCoordinates&&this.decimalCoordinates.trim()){const e=this.decimalCoordinates.split(",").map(V=>Number(V.trim())),i=Number(e[0]),s=Number(e[1]),h=Math.abs(i),x=Math.abs(s),m=i>0?"N":"S",o=s>0?"E":"W";let P;r=="DD"&&(P=`${h} ${m}, ${x} ${o}`);const L=Math.floor(h),D=Math.floor(x),F=(h-L)*60,Y=(x-D)*60;if(r=="DM"){let V=cx(F,3).toFixed(3).padStart(6,"0"),H=cx(Y,3).toFixed(3).padStart(6,"0");V.endsWith(".000")&&H.endsWith(".000")&&(V=V.replace(/\.000$/,""),H=H.replace(/\.000$/,"")),P=`${L} ${V}' ${m}, ${D} ${H}' ${o}`}if(r=="DMS"){const V=Math.floor(F),H=Math.floor(Y);let ve=((F-V)*60).toFixed(1).padStart(4,"0"),_e=((Y-H)*60).toFixed(1).padStart(4,"0");const oe=V.toString().padStart(2,"0"),fe=H.toString().padStart(2,"0");ve.endsWith(".0")&&_e.endsWith(".0")&&(ve=ve.replace(/\.0$/,""),_e=_e.replace(/\.0$/,"")),P=`${L} ${oe}' ${ve}" ${m}, ${D} ${fe}' ${_e}" ${o}`}return P}else throw new Error("no decimal coordinates to convert")}function cx(r,e){const i=Math.pow(10,e);return Math.round((r+Number.EPSILON)*i)/i}function c_(r,e){e||(e=5),r=r.replace(/\s+/g," ").trim();let i=null,s=null,h="",x="",m=null,o=[],P=!1;if(ES.test(r))throw new Error("invalid coordinate value");if(sx.test(r))if(o=sx.exec(r),P=yd(o),P)i=Math.abs(o[1])+o[2]/60,Number(o[1])<0&&(i*=-1),s=Math.abs(o[3])+o[4]/60,Number(o[3])<0&&(s*=-1),m="DM";else throw new Error("invalid coordinate format");else if(ox.test(r))if(o=ox.exec(r),P=yd(o),P){if(i=o[2],s=o[6],i.includes(",")&&(i=i.replace(",",".")),s.includes(",")&&(s=s.replace(",",".")),m="DD",Number(Math.round(i))==Number(i))throw new Error("integer only coordinate provided");if(Number(Math.round(s))==Number(s))throw new Error("integer only coordinate provided");o[1]?(h=o[1],x=o[5]):o[4]&&(h=o[4],x=o[8])}else throw new Error("invalid decimal coordinate format");else if(ax.test(r))if(o=ax.exec(r),P=yd(o),P)i=Math.abs(parseInt(o[2])),o[4]&&(i+=o[4]/60,m="DM"),o[6]&&(i+=o[6].replace(",",".")/3600,m="DMS"),parseInt(o[2])<0&&(i=-1*i),s=Math.abs(parseInt(o[9])),o[11]&&(s+=o[11]/60),o[13]&&(s+=o[13].replace(",",".")/3600),parseInt(o[9])<0&&(s=-1*s),o[1]?(h=o[1],x=o[8]):o[7]&&(h=o[7],x=o[14]);else throw new Error("invalid DMS coordinates format");else if(lx.test(r))if(o=lx.exec(r),P=yd(o),P)i=Math.abs(parseInt(o[2])),o[4]&&(i+=o[4]/60,m="DM"),o[6]&&(i+=o[6]/3600,m="DMS"),parseInt(o[2])<0&&(i=-1*i),s=Math.abs(parseInt(o[10])),o[12]&&(s+=o[12]/60),o[14]&&(s+=o[14]/3600),parseInt(o[10])<0&&(s=-1*s),o[1]?(h=o[1],x=o[9]):o[8]&&(h=o[8],x=o[16]);else throw new Error("invalid DMS coordinates format");else if(ux.test(r)){if(o=ux.exec(r),P=yd(o),o.filter(L=>L).length<=5)throw new Error("invalid coordinates format");if(P)i=Math.abs(parseInt(o[2])),o[4]&&(i+=o[4].replace(",",".")/60,m="DM"),o[6]&&(i+=o[6].replace(",",".")/3600,m="DMS"),parseInt(o[2])<0&&(i=-1*i),s=Math.abs(parseInt(o[10])),o[12]&&(s+=o[12].replace(",",".")/60),o[14]&&(s+=o[14].replace(",",".")/3600),parseInt(o[10])<0&&(s=-1*s),o[1]?(h=o[1],x=o[9]):o[8]&&(h=o[8],x=o[16]);else throw new Error("invalid coordinates format")}if(P){if(Math.abs(s)>=180)throw new Error("invalid longitude value");if(Math.abs(i)>=90)throw new Error("invalid latitude value");if(h&&!x||!h&&x)throw new Error("invalid coordinates value");if(h&&h==x)throw new Error("invalid coordinates format");i.toString().includes(",")&&(i=i.replace(",",".")),s.toString().includes(",")&&(s=s.replace(",","."));let L=/S|SOUTH/i;L.test(h)&&i>0&&(i=-1*i),L=/W|WEST/i,L.test(x)&&s>0&&(s=-1*s);const D=o[0].trim();let F,Y;const V=/[,/;\u0020]/g,H=D.match(V);if(H==null){const oe=Math.floor(r.length/2);F=D.substring(0,oe).trim(),Y=D.substring(oe).trim()}else{let oe;H.length%2==1?oe=Math.floor(H.length/2):oe=H.length/2-1;let fe=0;if(oe==0)fe=D.indexOf(H[0]),F=D.substring(0,fe).trim(),Y=D.substring(fe+1).trim();else{let K=0,ne=0;for(;K<=oe;)fe=D.indexOf(H[K],ne),ne=fe+1,K++;F=D.substring(0,fe).trim(),Y=D.substring(fe+1).trim()}}const ve=F.split(".");if(ve.length==2&&ve[1]==0&&ve[1].length!=2)throw new Error("invalid coordinates format");const _e=Y.split(".");if(_e.length==2&&_e[1]==0&&_e[1].length!=2)throw new Error("invalid coordinates format");if(/^\d+$/.test(F)||/^\d+$/.test(Y))throw new Error("degree only coordinate/s provided");return i=Number(Number(i).toFixed(e)),s=Number(Number(s).toFixed(e)),Object.freeze({verbatimCoordinates:D,verbatimLatitude:F,verbatimLongitude:Y,decimalLatitude:i,decimalLongitude:s,decimalCoordinates:`${i},${s}`,originalFormat:m,closeEnough:SS,toCoordinateFormat:IS})}else throw new Error("coordinates pattern match failed")}function yd(r){if(!isNaN(r[0]))return!1;const e=[...r];if(e.shift(),e.length%2>0)return!1;const i=/^[-+]?\d+([\.,]\d+)?$/,s=/[eastsouthnorthwest]+/i,h=e.length/2;for(let x=0;x<h;x++){const m=e[x],o=e[x+h],P=i.test(m)&&i.test(o),L=s.test(m)&&s.test(o),D=m==o;if(!(m==null&&o==null)){if(m==null||o==null)return!1;if(P||L||D)continue;return!1}}return!0}function hx(r,e){const i=Math.abs(r-e);return Number(i.toFixed(6))<=1e-5}function SS(r){if(!r)throw new Error("coords must be provided");if(r.includes(",")){const e=r.split(",");if(Number(e[0])==NaN||Number(e[1])==NaN)throw new Error("coords are not valid decimals");return hx(this.decimalLatitude,Number(e[0]))&&hx(this.decimalLongitude,e[1])}else throw new Error("coords being tested must be separated by a comma")}const MS=Object.freeze({DMS:"DMS",DM:"DM",DD:"DD"});c_.to=MS;const PS=[{verbatimCoordinates:"40.123, -74.123",verbatimLatitude:"40.123",verbatimLongitude:"-74.123"},{verbatimCoordinates:"40.123 N 74.123 W",verbatimLatitude:"40.123 N",verbatimLongitude:"74.123 W"},{verbatimCoordinates:"40.123 N 74.123 W",verbatimLatitude:"40.123 N",verbatimLongitude:"74.123 W"},{verbatimCoordinates:'40 7 22.8" N 74 7 22.8" W',verbatimLatitude:'40 7 22.8" N',verbatimLongitude:'74 7 22.8" W'},{verbatimCoordinates:"40 7.38 , -74 7.38",verbatimLatitude:"40 7.38",verbatimLongitude:"-74 7.38"},{verbatimCoordinates:"N40722.8, W74722.8",verbatimLatitude:"N40722.8",verbatimLongitude:"W74722.8"},{verbatimCoordinates:'40722.8"N, 74722.8"W',verbatimLatitude:'40722.8"N',verbatimLongitude:'74722.8"W'},{verbatimCoordinates:`407'22.8"N, 747'22.8"W`,verbatimLatitude:`407'22.8"N`,verbatimLongitude:`747'22.8"W`},{verbatimCoordinates:"40 7 22.8, -74 7 22.8",verbatimLatitude:"40 7 22.8",verbatimLongitude:"-74 7 22.8"},{verbatimCoordinates:"40.123 -74.123",verbatimLatitude:"40.123",verbatimLongitude:"-74.123"},{verbatimCoordinates:"40.123,-74.123",verbatimLatitude:"40.123",verbatimLongitude:"-74.123"},{verbatimCoordinates:"40.123N74.123W",verbatimLatitude:"40.123N",verbatimLongitude:"74.123W"},{verbatimCoordinates:"4007.38N7407.38W",verbatimLatitude:"4007.38N",verbatimLongitude:"7407.38W"},{verbatimCoordinates:'40722.8"N, 74722.8"W',verbatimLatitude:'40722.8"N',verbatimLongitude:'74722.8"W'},{verbatimCoordinates:"400722.8N740722.8W",verbatimLatitude:"400722.8N",verbatimLongitude:"740722.8W"},{verbatimCoordinates:"N 40 7.38 W 74 7.38",verbatimLatitude:"N 40 7.38",verbatimLongitude:"W 74 7.38"},{verbatimCoordinates:"40:7:22.8N 74:7:22.8W",verbatimLatitude:"40:7:22.8N",verbatimLongitude:"74:7:22.8W"},{verbatimCoordinates:"40:7:23N,74:7:23W",verbatimLatitude:"40:7:23N",verbatimLongitude:"74:7:23W",decimalLatitude:40.1230555555,decimalLongitude:-74.1230555555},{verbatimCoordinates:'40723"N 74723"W',verbatimLatitude:'40723"N',verbatimLongitude:'74723"W',decimalLatitude:40.1230555555,decimalLongitude:-74.12305555555555},{verbatimCoordinates:'40723"S 74723"E',verbatimLatitude:'40723"S',verbatimLongitude:'74723"E',decimalLatitude:-40.1230555555,decimalLongitude:74.12305555555555},{verbatimCoordinates:'40723" -74723"',verbatimLatitude:'40723"',verbatimLongitude:'-74723"',decimalLatitude:40.1230555555,decimalLongitude:-74.123055555},{verbatimCoordinates:'40d 7 23" N 74d 7 23" W',verbatimLatitude:'40d 7 23" N',verbatimLongitude:'74d 7 23" W',decimalLatitude:40.1230555555,decimalLongitude:-74.123055555},{verbatimCoordinates:"40.123N 74.123W",verbatimLatitude:"40.123N",verbatimLongitude:"74.123W"},{verbatimCoordinates:"40 7.38, -74 7.38",verbatimLatitude:"40 7.38",verbatimLongitude:"-74 7.38"},{verbatimCoordinates:"40 7.38, -74 7.38",verbatimLatitude:"40 7.38",verbatimLongitude:"-74 7.38"},{verbatimCoordinates:"40 7 22.8; -74 7 22.8",verbatimLatitude:"40 7 22.8",verbatimLongitude:"-74 7 22.8"}],kS={decimalLatitude:40.123,decimalLongitude:-74.123},CS=[{verbatimCoordinates:`504'17.698"south, 1424'2.826"east`,verbatimLatitude:`504'17.698"south`,verbatimLongitude:`1424'2.826"east`,decimalLatitude:-50.07158277777778,decimalLongitude:14.400785},{verbatimCoordinates:"50d4m17.698S 14d24m2.826E",verbatimLatitude:"50d4m17.698S",verbatimLongitude:"14d24m2.826E",decimalLatitude:-50.07158277777778,decimalLongitude:14.400785},{verbatimCoordinates:"40:26:46N,79:56:55W",verbatimLatitude:"40:26:46N",verbatimLongitude:"79:56:55W",decimalLatitude:40.44611111111111,decimalLongitude:-79.9486111111111},{verbatimCoordinates:"40:26:46.302N 79:56:55.903W",verbatimLatitude:"40:26:46.302N",verbatimLongitude:"79:56:55.903W",decimalLatitude:40.446195,decimalLongitude:-79.94886194444445},{verbatimCoordinates:"402647N 795836W",verbatimLatitude:"402647N",verbatimLongitude:"795836W",decimalLatitude:40.44638888888889,decimalLongitude:-79.97666666666667},{verbatimCoordinates:"40d 26 47 N 79d 58 36 W",verbatimLatitude:"40d 26 47 N",verbatimLongitude:"79d 58 36 W",decimalLatitude:40.44638888888889,decimalLongitude:-79.97666666666667},{verbatimCoordinates:"40.446195N 79.948862W",verbatimLatitude:"40.446195N",verbatimLongitude:"79.948862W",decimalLatitude:40.446195,decimalLongitude:-79.948862},{verbatimCoordinates:"40,446195 79,948862",verbatimLatitude:"40,446195",verbatimLongitude:"79,948862",decimalLatitude:40.446195,decimalLongitude:79.948862},{verbatimCoordinates:"40 26.7717, -79 56.93172",verbatimLatitude:"40 26.7717",verbatimLongitude:"-79 56.93172",decimalLatitude:40.446195,decimalLongitude:-79.948862},{verbatimCoordinates:"40.446195, -79.948862",verbatimLatitude:"40.446195",verbatimLongitude:"-79.948862",decimalLatitude:40.446195,decimalLongitude:-79.948862},{verbatimCoordinates:"40.123256; -74.123256",verbatimLatitude:"40.123256",verbatimLongitude:"-74.123256",decimalLatitude:40.123256,decimalLongitude:-74.123256},{verbatimCoordinates:"1824S 2245E",verbatimLatitude:"1824S",verbatimLongitude:"2245E",decimalLatitude:-18.4,decimalLongitude:22.75}],AS=[{verbatimCoordinates:"10.432342S 10.6345345E",verbatimLatitude:"10.432342S",verbatimLongitude:"10.6345345E",decimalLatitude:-10.432342,decimalLongitude:10.6345345},{verbatimCoordinates:"10.00S 10.00E",verbatimLatitude:"10.00S",verbatimLongitude:"10.00E",decimalLatitude:-10,decimalLongitude:10},{verbatimCoordinates:"00.00S 01.00E",verbatimLatitude:"00.00S",verbatimLongitude:"01.00E",decimalLatitude:0,decimalLongitude:1},{verbatimCoordinates:"18.24S 22.45E",verbatimLatitude:"18.24S",verbatimLongitude:"22.45E",decimalLatitude:-18.4,decimalLongitude:22.75},{verbatimCoordinates:"27deg 15min 45.2sec S 18deg 32min 53.7sec E",verbatimLatitude:"27deg 15min 45.2sec S",verbatimLongitude:"18deg 32min 53.7sec E",decimalLatitude:-27.262555555555554,decimalLongitude:18.54825},{verbatimCoordinates:"-23.3245 S / 28.2344 E",verbatimLatitude:"-23.3245 S",verbatimLongitude:"28.2344 E",decimalLatitude:-23.3245,decimalLongitude:28.2344},{verbatimCoordinates:"40 26.7717 -79 56.93172",verbatimLatitude:"40 26.7717",verbatimLongitude:"-79 56.93172",decimalLatitude:40.446195,decimalLongitude:-79.948862},{verbatimCoordinates:"27.15.45S 18.32.53E",verbatimLatitude:"27.15.45S",verbatimLongitude:"18.32.53E",decimalLatitude:-27.2625,decimalLongitude:18.548055},{verbatimCoordinates:"-27.15.45 18.32.53",verbatimLatitude:"-27.15.45",verbatimLongitude:"18.32.53",decimalLatitude:-27.2625,decimalLongitude:18.548055},{verbatimCoordinates:"27.15.45.2S 18.32.53.4E",verbatimLatitude:"27.15.45.2S",verbatimLongitude:"18.32.53.4E",decimalLatitude:-27.262556,decimalLongitude:18.548167},{verbatimCoordinates:"27.15.45,2S 18.32.53,4E",verbatimLatitude:"27.15.45,2S",verbatimLongitude:"18.32.53,4E",decimalLatitude:-27.262556,decimalLongitude:18.548167},{verbatimCoordinates:"S23.43563   E22.45634 ",verbatimLatitude:"S23.43563 ",verbatimLongitude:"E22.45634 ",decimalLatitude:-23.43563,decimalLongitude:22.45634},{verbatimCoordinates:"27,71372 S 23,07771 E",verbatimLatitude:"27,71372 S",verbatimLongitude:"23,07771 E",decimalLatitude:-27.71372,decimalLongitude:23.07771},{verbatimCoordinates:"27.45.34 S 23.23.23 E",verbatimLatitude:"27.45.34 S",verbatimLongitude:"23.23.23 E",decimalLatitude:-27.759444,decimalLongitude:23.38972222},{verbatimCoordinates:"S 27.45.34 E 23.23.23",verbatimLatitude:"S 27.45.34",verbatimLongitude:"E 23.23.23",decimalLatitude:-27.759444,decimalLongitude:23.38972222},{verbatimCoordinates:"53 16.3863,4 52.8171",verbatimLatitude:"53 16.3863",verbatimLongitude:"4 52.8171",decimalLatitude:53.273105,decimalLongitude:4.88029},{verbatimCoordinates:"50 8.2914,-5 2.4447",verbatimLatitude:"50 8.2914",verbatimLongitude:"-5 2.4447",decimalLatitude:50.13819,decimalLongitude:-5.040745},{verbatimCoordinates:"N 48 30,6410', E 18 57,4583'",verbatimLatitude:"N 48 30,6410'",verbatimLongitude:"E 18 57,4583'",decimalLatitude:48.51068,decimalLongitude:18.95764},{verbatimCoordinates:"1.23456, 18.33453",verbatimLatitude:"1.23456",verbatimLongitude:"18.33453",decimalLatitude:1.23456,decimalLongitude:18.33453}];function LS(){const r=[];return PS.forEach(e=>{e.decimalLatitude?r.push(e):r.push({...e,...kS})}),[...r,...CS,...AS]}const RS=LS();c_.formats=RS.map(r=>r.verbatimCoordinates);const NS=c_;function dx(r,e,i){const s=r.slice();return s[97]=e[i],s[99]=i,s}function px(r){let e,i,s,h,x;return i=new ob({}),{c(){e=Zr("button"),Iu(i.$$.fragment),St(e,"type","button"),St(e,"title",r[3]),St(e,"class","svelte-bz0zu3")},m(m,o){cn(m,e,o),zl(i,e,null),s=!0,h||(x=_s(e,"click",r[78]),h=!0)},p(m,o){(!s||o[0]&8)&&St(e,"title",m[3])},i(m){s||(Tn(i.$$.fragment,m),s=!0)},o(m){ss(i.$$.fragment,m),s=!1},d(m){m&&tn(e),Bl(i),h=!1,x()}}}function fx(r){let e,i;return e=new fS({}),{c(){Iu(e.$$.fragment)},m(s,h){zl(e,s,h),i=!0},i(s){i||(Tn(e.$$.fragment,s),i=!0)},o(s){ss(e.$$.fragment,s),i=!1},d(s){Bl(e,s)}}}function mx(r){let e,i,s,h,x;return i=new vS({}),{c(){e=Zr("button"),Iu(i.$$.fragment),St(e,"type","button"),St(e,"title",r[10]),St(e,"class","svelte-bz0zu3"),nl(e,"active",r[0])},m(m,o){cn(m,e,o),zl(i,e,null),s=!0,h||(x=_s(e,"click",r[79]),h=!0)},p(m,o){(!s||o[0]&1024)&&St(e,"title",m[10]),(!s||o[0]&1)&&nl(e,"active",m[0])},i(m){s||(Tn(i.$$.fragment,m),s=!0)},o(m){ss(i.$$.fragment,m),s=!1},d(m){m&&tn(e),Bl(i),h=!1,x()}}}function OS(r){let e,i=[],s=new Map,h,x,m,o=rx(r[13]);const P=L=>L[97].id+(L[97].address?","+L[97].address:"");for(let L=0;L<o.length;L+=1){let D=dx(r,o,L),F=P(D);s.set(F,i[L]=gx(F,D))}return{c(){e=Zr("ul");for(let L=0;L<i.length;L+=1)i[L].c();St(e,"class","options svelte-bz0zu3"),St(e,"role","listbox")},m(L,D){cn(L,e,D);for(let F=0;F<i.length;F+=1)i[F]&&i[F].m(e,null);h=!0,x||(m=[_s(e,"mouseleave",r[27]),_s(e,"blur",r[83]),_s(e,"keydown",r[23])],x=!0)},p(L,D){D[0]&102823936&&(o=rx(L[13]),Ed(),i=HI(i,D,P,1,L,o,s,e,XI,gx,null,dx),Id())},i(L){if(!h){for(let D=0;D<o.length;D+=1)Tn(i[D]);h=!0}},o(L){for(let D=0;D<i.length;D+=1)ss(i[D]);h=!1},d(L){L&&tn(e);for(let D=0;D<i.length;D+=1)i[D].d();x=!1,ql(m)}}}function DS(r){let e,i,s,h,x,m;return i=new ab({}),{c(){e=Zr("div"),Iu(i.$$.fragment),s=Go(),h=Zr("div"),x=Eu(r[8]),St(h,"class","svelte-bz0zu3"),St(e,"class","no-results svelte-bz0zu3")},m(o,P){cn(o,e,P),zl(i,e,null),kr(e,s),kr(e,h),kr(h,x),m=!0},p(o,P){(!m||P[0]&256)&&zd(x,o[8])},i(o){m||(Tn(i.$$.fragment,o),m=!0)},o(o){ss(i.$$.fragment,o),m=!1},d(o){o&&tn(e),Bl(i)}}}function FS(r){let e="",i;return{c(){i=Eu(e)},m(s,h){cn(s,i,h)},p:_n,i:_n,o:_n,d(s){s&&tn(i)}}}function zS(r){let e,i,s,h,x,m,o,P,L,D,F;return i=new ab({}),P=new ob({}),{c(){e=Zr("div"),Iu(i.$$.fragment),s=Go(),h=Zr("div"),x=Eu(r[7]),m=Go(),o=Zr("button"),Iu(P.$$.fragment),St(h,"class","svelte-bz0zu3"),St(o,"class","svelte-bz0zu3"),St(e,"class","error svelte-bz0zu3")},m(Y,V){cn(Y,e,V),zl(i,e,null),kr(e,s),kr(e,h),kr(h,x),kr(e,m),kr(e,o),zl(P,o,null),L=!0,D||(F=_s(o,"click",r[80]),D=!0)},p(Y,V){(!L||V[0]&128)&&zd(x,Y[7])},i(Y){L||(Tn(i.$$.fragment,Y),Tn(P.$$.fragment,Y),L=!0)},o(Y){ss(i.$$.fragment,Y),ss(P.$$.fragment,Y),L=!1},d(Y){Y&&tn(e),Bl(i),Bl(P),D=!1,F()}}}function gx(r,e){var i;let s,h,x;function m(){return e[81](e[99])}function o(){return e[82](e[97])}return h=new dS({props:{feature:e[97],showPlaceType:e[11],style:e[15]===e[99]?"selected":((i=e[14])==null?void 0:i.id)===e[97].id?"picked":"default",missingIconsCache:e[21],iconsBaseUrl:e[12]}}),h.$on("mouseenter",m),h.$on("select",o),{key:r,first:null,c(){s=BI(),Iu(h.$$.fragment),this.first=s},m(P,L){cn(P,s,L),zl(h,P,L),x=!0},p(P,L){var D;e=P;const F={};L[0]&8192&&(F.feature=e[97]),L[0]&2048&&(F.showPlaceType=e[11]),L[0]&57344&&(F.style=e[15]===e[99]?"selected":((D=e[14])==null?void 0:D.id)===e[97].id?"picked":"default"),L[0]&4096&&(F.iconsBaseUrl=e[12]),h.$set(F)},i(P){x||(Tn(h.$$.fragment,P),x=!0)},o(P){ss(h.$$.fragment,P),x=!1},d(P){P&&tn(s),Bl(h,P)}}}function BS(r){let e,i,s,h,x,m,o,P,L,D,F,Y,V,H,ve,_e,oe,fe,K,ne=!1;x=new bS({});let ye=!r[20]&&px(r),Re=r[20]&&fx(),Se=r[6]==="button"&&mx(r);const Z=r[70].default,$=OI(Z,r,r[69],null),Q=[zS,FS,DS,OS],ue=[];function he(Pe,Ae){var ke,Be;return Pe[19]?0:!Pe[16]&&!Pe[4]?1:((ke=Pe[13])==null?void 0:ke.length)===0?2:(Be=Pe[13])!=null&&Be.length&&(Pe[16]||Pe[4])?3:-1}return~(H=he(r))&&(ve=ue[H]=Q[H](r)),{c(){e=Go(),i=Zr("form"),s=Zr("div"),h=Zr("button"),Iu(x.$$.fragment),m=Go(),o=Zr("input"),P=Go(),L=Zr("div"),ye&&ye.c(),D=Go(),Re&&Re.c(),F=Go(),Se&&Se.c(),Y=Go(),$&&$.c(),V=Go(),ve&&ve.c(),St(h,"class","search-button svelte-bz0zu3"),St(h,"type","button"),St(o,"placeholder",r[9]),St(o,"aria-label",r[9]),St(o,"class","svelte-bz0zu3"),St(L,"class","clear-button-container svelte-bz0zu3"),nl(L,"displayable",r[1]!==""),St(s,"class","input-group svelte-bz0zu3"),St(i,"class",_e=Yf(r[2])+" svelte-bz0zu3"),nl(i,"can-collapse",r[5]&&r[1]==="")},m(Pe,Ae){cn(Pe,e,Ae),cn(Pe,i,Ae),kr(i,s),kr(s,h),zl(x,h,null),kr(s,m),kr(s,o),r[72](o),tx(o,r[1]),kr(s,P),kr(s,L),ye&&ye.m(L,null),kr(L,D),Re&&Re.m(L,null),kr(s,F),Se&&Se.m(s,null),kr(s,Y),$&&$.m(s,null),kr(i,V),~H&&ue[H].m(i,null),oe=!0,fe||(K=[_s(h,"click",r[71]),_s(o,"input",r[73]),_s(o,"focus",r[74]),_s(o,"blur",r[75]),_s(o,"click",r[76]),_s(o,"keydown",r[23]),_s(o,"input",r[24]),_s(o,"change",r[77]),_s(i,"submit",$I(r[22]))],fe=!0)},p(Pe,Ae){(!oe||Ae[0]&512)&&St(o,"placeholder",Pe[9]),(!oe||Ae[0]&512)&&St(o,"aria-label",Pe[9]),Ae[0]&2&&o.value!==Pe[1]&&tx(o,Pe[1]),Pe[20]?ye&&(Ed(),ss(ye,1,1,()=>{ye=null}),Id()):ye?(ye.p(Pe,Ae),Ae[0]&1048576&&Tn(ye,1)):(ye=px(Pe),ye.c(),Tn(ye,1),ye.m(L,D)),Pe[20]?Re?Ae[0]&1048576&&Tn(Re,1):(Re=fx(),Re.c(),Tn(Re,1),Re.m(L,null)):Re&&(Ed(),ss(Re,1,1,()=>{Re=null}),Id()),(!oe||Ae[0]&2)&&nl(L,"displayable",Pe[1]!==""),Pe[6]==="button"?Se?(Se.p(Pe,Ae),Ae[0]&64&&Tn(Se,1)):(Se=mx(Pe),Se.c(),Tn(Se,1),Se.m(s,Y)):Se&&(Ed(),ss(Se,1,1,()=>{Se=null}),Id()),$&&$.p&&(!oe||Ae[2]&128)&&FI($,Z,Pe,Pe[69],oe?DI(Z,Pe[69]):zI(Pe[69]),null);let ke=H;H=he(Pe),H===ke?~H&&ue[H].p(Pe,Ae):(ve&&(Ed(),ss(ue[ke],1,1,()=>{ue[ke]=null}),Id()),~H?(ve=ue[H],ve?ve.p(Pe,Ae):(ve=ue[H]=Q[H](Pe),ve.c()),Tn(ve,1),ve.m(i,null)):ve=null),(!oe||Ae[0]&4&&_e!==(_e=Yf(Pe[2])+" svelte-bz0zu3"))&&St(i,"class",_e),(!oe||Ae[0]&38)&&nl(i,"can-collapse",Pe[5]&&Pe[1]==="")},i(Pe){oe||(Tn(ne),Tn(x.$$.fragment,Pe),Tn(ye),Tn(Re),Tn(Se),Tn($,Pe),Tn(ve),oe=!0)},o(Pe){ss(ne),ss(x.$$.fragment,Pe),ss(ye),ss(Re),ss(Se),ss($,Pe),ss(ve),oe=!1},d(Pe){Pe&&(tn(e),tn(i)),Bl(x),r[72](null),ye&&ye.d(),Re&&Re.d(),Se&&Se.d(),$&&$.d(Pe),~H&&ue[H].d(),fe=!1,ql(K)}}}function $S(r,e,i){let s,h,x,{$$slots:m={},$$scope:o}=e;const P={continental_marine:4,country:4,major_landform:8,region:5,subregion:6,county:7,joint_municipality:8,joint_submunicipality:9,municipality:10,municipal_district:11,locality:12,neighbourhood:13,place:14,postal_code:14,road:16,poi:17,address:18,"poi.peak":15,"poi.shop":18,"poi.cafe":18,"poi.restaurant":18,"poi.aerodrome":13};let{class:L=void 0}=e,{apiKey:D=void 0}=e,{bbox:F=void 0}=e,{clearButtonTitle:Y="clear"}=e,{clearOnBlur:V=!1}=e,{clearListOnPick:H=!1}=e,{keepListOpen:ve=!1}=e,{collapsed:_e=!1}=e,{country:oe=void 0}=e,{debounceSearch:fe=200}=e,{enableReverse:K="never"}=e,{errorMessage:ne="Something went wrong"}=e,{filter:ye=()=>!0}=e,{flyTo:Re=!0}=e,{fuzzyMatch:Se=!0}=e,{language:Z=void 0}=e,{limit:$=void 0}=e;const Q=41415112612;let{reverseGeocodingLimit:ue=Q}=e,{mapController:he=void 0}=e,{minLength:Pe=2}=e,{noResultsMessage:Ae="Oops! Looks like you're trying to predict something that's not quite right. We can't seem to find what you're looking for. Maybe try double-checking your spelling or try a different search term. Keep on typing - we'll do our best to get you where you need to go!"}=e,{placeholder:ke="Search"}=e,{proximity:Be=[{type:"server-geolocation"}]}=e,{reverseActive:Ke=K==="always"}=e,{reverseButtonTitle:tt="toggle reverse geocoding"}=e,{searchValue:pt=""}=e,{pickedResultStyle:vt="full-geometry"}=e,{showPlaceType:Ft="if-needed"}=e,{showResultsWhileTyping:It=!0}=e,{selectFirst:Zt=!0}=e,{flyToSelected:zt=!1}=e,{markerOnSelected:ti=!0}=e,{types:ai=void 0}=e;const Ir=[];let{reverseGeocodingTypes:lt=Ir}=e,{exhaustiveReverseGeocoding:Xi=!1}=e,{excludeTypes:ii=!1}=e;const Jt=void 0;let{reverseGeocodingExcludeTypes:$e=Jt}=e,{zoom:zi=P}=e,{apiUrl:Qi="https://api.maptiler.com/geocoding"}=e,{fetchParameters:Gi={}}=e,{iconsBaseUrl:sr="https://cdn.maptiler.com/maptiler-geocoding-control/v2.1.7/icons/"}=e,{adjustUrlQuery:jr=()=>{}}=e,{adjustUrl:En=()=>{}}=e;function Ot(it){oi.focus(it)}function In(){oi.blur()}function xs(it,Wi=!0,Dr=!1){i(1,pt=it),Wi?(i(15,er=-1),at()):(bt(void 0,!Dr,Dr),setTimeout(()=>{oi.focus(),oi.select()}))}function os(){i(13,Xt=void 0),i(14,gi=void 0),i(15,er=-1)}function $s(){i(64,_r=[]),i(14,gi=void 0)}let Xt,_r,gi,rn="",oi,er=-1,Bi,Ii=[],et,le,pe,me,Le=!1;const Ze=new Set,Je=nb();UI(()=>{he&&(he.setEventHandler(void 0),he.indicateReverse(!1),he.setSelectedMarker(-1),he.setFeatures(void 0,void 0,!1))});function at(it){if(i(17,Le=!1),le&&(clearTimeout(le),le=void 0),er>-1&&Xt)i(14,gi=Xt[er]),i(1,pt=gi.place_type[0]==="reverse"?gi.place_name:gi.place_name.replace(/,.*/,"")),i(19,Bi=void 0),i(64,_r=void 0),i(15,er=-1);else if(pt){const Wi=it||!He(pt);gt(pt,{exact:!0}).then(()=>{i(64,_r=Xt),i(14,gi=void 0),Wi&&ft()}).catch(Dr=>i(19,Bi=Dr))}}function He(it){try{return NS(it,6)}catch{return!1}}async function gt(it,{byId:Wi=!1,exact:Dr=!1}={}){var Er,ri,Wr;i(19,Bi=void 0),et?.abort();const vn=new AbortController;i(20,et=vn);try{const Ai=He(it),Sn=new URL(Qi+"/"+encodeURIComponent(Ai?Ai.decimalLongitude+","+Ai.decimalLatitude:it)+".json"),Yr=Sn.searchParams;Z!==void 0&&Yr.set("language",Array.isArray(Z)?Z.join(","):Z??"");const[gr]=he?.getCenterAndZoom()??[];let Xn=(Er=!Ai||lt===Ir?ai:lt)==null?void 0:Er.map(vr=>typeof vr=="string"?vr:gr===void 0||(vr[0]??0)<=gr&&gr<(vr[1]??1/0)?vr[2]:void 0).filter(vr=>vr!==void 0);Xn&&(Xn=[...new Set(Xn)],Yr.set("types",Xn.join(",")));const Mn=!Ai||$e===Jt?ii:$e;if(Mn&&Yr.set("excludeTypes",String(Mn)),F&&Yr.set("bbox",F.map(vr=>vr.toFixed(6)).join(",")),oe&&Yr.set("country",Array.isArray(oe)?oe.join(","):oe),!Wi&&!Ai){const vr=await TS(he,Be,vn);vr&&Yr.set("proximity",vr),(Dr||!It)&&Yr.set("autocomplete","false"),Yr.set("fuzzyMatch",String(Se))}const qi=ue===Q?$:ue;qi!==void 0&&qi>1&&Xn?.length!==1&&console.warn("For reverse geocoding when limit > 1 then types must contain single value."),Ai?(qi===1||qi!==void 0&&(Xi||Xn?.length===1))&&Yr.set("limit",String(qi)):$!==void 0&&Yr.set("limit",String($)),D&&Yr.set("key",D),jr(Yr),En(Sn);const xn=Sn.searchParams.get("types")===""&&Sn.searchParams.get("excludeTypes")!=="true",$n=Sn.toString();if($n===rn){Wi?(H&&i(13,Xt=void 0),i(14,gi=Ii[0])):(i(13,Xt=Ii),((ri=Xt[er])==null?void 0:ri.id)!==h?.id&&i(15,er=-1));return}rn=$n;let Jr;if(xn)Jr={type:"FeatureCollection",features:[]};else{const vr=await fetch($n,{signal:vn.signal,...Gi});if(!vr.ok)throw new Error(await vr.text());Jr=await vr.json()}Je("response",{url:$n,featureCollection:Jr}),Wi?(H&&i(13,Xt=void 0),i(14,gi=Jr.features[0]),Ii=[gi]):(i(13,Xt=Jr.features.filter(ye)),Ai&&Xt.unshift({type:"Feature",properties:{},id:"reverse_"+Ai.decimalLongitude+"_"+Ai.decimalLatitude,text:Ai.decimalLatitude+", "+Ai.decimalLongitude,place_name:Ai.decimalLatitude+", "+Ai.decimalLongitude,place_type:["reverse"],center:[Ai.decimalLongitude,Ai.decimalLatitude],bbox:[Ai.decimalLongitude,Ai.decimalLatitude,Ai.decimalLongitude,Ai.decimalLatitude],geometry:{type:"Point",coordinates:[Ai.decimalLongitude,Ai.decimalLatitude]}}),Ii=Xt,((Wr=Xt[er])==null?void 0:Wr.id)!==h?.id&&i(15,er=-1),Ai&&oi.focus())}catch(Ai){if(Ai&&typeof Ai=="object"&&"name"in Ai&&Ai.name==="AbortError")return;throw Ai}finally{vn===et&&i(20,et=void 0)}}function ft(){var it;if(!(_r!=null&&_r.length)||!Re)return;const Wi=[180,90,-180,-90],Dr=!_r.some(ri=>!ri.matching_text);let Er;for(const ri of _r){const Wr=Tt(ri);if(Er=Er===void 0?Wr:Wr===void 0?Er:Math.max(Er,Wr),Dr||!ri.matching_text)for(const vn of[0,1,2,3])Wi[vn]=Math[vn<2?"min":"max"](Wi[vn],((it=ri.bbox)==null?void 0:it[vn])??ri.center[vn%2])}he&&_r.length>0&&(gi&&Wi[0]===Wi[2]&&Wi[1]===Wi[3]?he.flyTo(gi.center,Tt(gi)):he.fitBounds(Xf(Wi),50,Er))}function nt(){!gi||!he||(!gi.bbox||gi.bbox[0]===gi.bbox[2]&&gi.bbox[1]===gi.bbox[3]?he.flyTo(gi.center,Tt(gi)):he.fitBounds(Xf(gi.bbox),50,Tt(gi)))}function Tt(it){var Wi;if(!it.bbox||it.bbox[0]!==it.bbox[2]&&it.bbox[1]!==it.bbox[3])return;const Dr=it.id.replace(/\..*/,"");return(Array.isArray((Wi=it.properties)==null?void 0:Wi.categories)?it.properties.categories.reduce((Er,ri)=>{const Wr=zi[Dr+"."+ri];return Er===void 0?Wr:Wr===void 0?Er:Math.max(Er,Wr)},void 0):void 0)??zi[Dr]}function Ve(it){i(0,Ke=K==="always"),i(13,Xt=void 0),i(14,gi=void 0),i(15,er=-1),xs(it[1].toFixed(6)+", "+wS(it[0],[-180,180],!0).toFixed(6),!1,!0)}function Ut(it){if(!Xt)return;let Wi=it.key==="ArrowDown"?1:it.key==="ArrowUp"?-1:0;Wi&&(oi.focus(),i(17,Le=!0),it.preventDefault(),gi&&er===-1&&i(15,er=Xt.findIndex(Dr=>Dr.id===gi?.id)),er===(gi||Zt?0:-1)&&Wi===-1&&i(15,er=Xt.length),i(15,er+=Wi),er>=Xt.length&&i(15,er=-1),er<0&&(gi||Zt)&&i(15,er=0))}function bt(it,Wi=!0,Dr=!1){if(i(19,Bi=void 0),i(14,gi=void 0),i(17,Le=!0),It||Dr){if(le&&clearTimeout(le),pt.length<Pe)return;const Er=pt;le=window.setTimeout(()=>{gt(Er).catch(ri=>i(19,Bi=ri))},Wi?fe:0)}else i(13,Xt=void 0),i(19,Bi=void 0)}function Ht(it){gi&&gi?.id===it?.id?nt():(i(14,gi=it),i(1,pt=it.place_name))}function li(it){i(15,er=it)}function Ci(){(!Zt||gi)&&i(15,er=-1),zt&&nt()}const br=()=>oi.focus();function ur(it){Ey[it?"unshift":"push"](()=>{oi=it,i(18,oi)})}function Ui(){pt=this.value,i(1,pt),i(17,Le),i(31,V),i(16,pe)}const Mi=()=>i(17,Le=!0),Hi=()=>i(17,Le=!1),Lr=()=>i(17,Le=!0),Rt=()=>i(14,gi=void 0),Kr=()=>{i(1,pt=""),i(14,gi=void 0),oi.focus()},Sr=()=>i(0,Ke=!Ke),Or=()=>i(19,Bi=void 0),Ps=it=>li(it),Bt=it=>Ht(it),xi=()=>{};return r.$$set=it=>{"class"in it&&i(2,L=it.class),"apiKey"in it&&i(29,D=it.apiKey),"bbox"in it&&i(30,F=it.bbox),"clearButtonTitle"in it&&i(3,Y=it.clearButtonTitle),"clearOnBlur"in it&&i(31,V=it.clearOnBlur),"clearListOnPick"in it&&i(32,H=it.clearListOnPick),"keepListOpen"in it&&i(4,ve=it.keepListOpen),"collapsed"in it&&i(5,_e=it.collapsed),"country"in it&&i(33,oe=it.country),"debounceSearch"in it&&i(34,fe=it.debounceSearch),"enableReverse"in it&&i(6,K=it.enableReverse),"errorMessage"in it&&i(7,ne=it.errorMessage),"filter"in it&&i(35,ye=it.filter),"flyTo"in it&&i(36,Re=it.flyTo),"fuzzyMatch"in it&&i(37,Se=it.fuzzyMatch),"language"in it&&i(38,Z=it.language),"limit"in it&&i(39,$=it.limit),"reverseGeocodingLimit"in it&&i(40,ue=it.reverseGeocodingLimit),"mapController"in it&&i(41,he=it.mapController),"minLength"in it&&i(42,Pe=it.minLength),"noResultsMessage"in it&&i(8,Ae=it.noResultsMessage),"placeholder"in it&&i(9,ke=it.placeholder),"proximity"in it&&i(43,Be=it.proximity),"reverseActive"in it&&i(0,Ke=it.reverseActive),"reverseButtonTitle"in it&&i(10,tt=it.reverseButtonTitle),"searchValue"in it&&i(1,pt=it.searchValue),"pickedResultStyle"in it&&i(44,vt=it.pickedResultStyle),"showPlaceType"in it&&i(11,Ft=it.showPlaceType),"showResultsWhileTyping"in it&&i(45,It=it.showResultsWhileTyping),"selectFirst"in it&&i(46,Zt=it.selectFirst),"flyToSelected"in it&&i(47,zt=it.flyToSelected),"markerOnSelected"in it&&i(48,ti=it.markerOnSelected),"types"in it&&i(49,ai=it.types),"reverseGeocodingTypes"in it&&i(50,lt=it.reverseGeocodingTypes),"exhaustiveReverseGeocoding"in it&&i(51,Xi=it.exhaustiveReverseGeocoding),"excludeTypes"in it&&i(52,ii=it.excludeTypes),"reverseGeocodingExcludeTypes"in it&&i(53,$e=it.reverseGeocodingExcludeTypes),"zoom"in it&&i(54,zi=it.zoom),"apiUrl"in it&&i(55,Qi=it.apiUrl),"fetchParameters"in it&&i(56,Gi=it.fetchParameters),"iconsBaseUrl"in it&&i(12,sr=it.iconsBaseUrl),"adjustUrlQuery"in it&&i(57,jr=it.adjustUrlQuery),"adjustUrl"in it&&i(58,En=it.adjustUrl),"$$scope"in it&&i(69,o=it.$$scope)},r.$$.update=()=>{if(r.$$.dirty[0]&64&&i(0,Ke=K==="always"),r.$$.dirty[0]&16384|r.$$.dirty[1]&8192&&vt!=="marker-only"&&gi&&!gi.address&&gi.geometry.type==="Point"&&gi.place_type[0]!=="reverse"&&gt(gi.id,{byId:!0}).catch(it=>i(19,Bi=it)),r.$$.dirty[0]&16384|r.$$.dirty[1]&1058|r.$$.dirty[2]&8&&(he&&gi&&gi.id!==me&&Re&&(nt(),H&&i(13,Xt=void 0),i(64,_r=void 0),i(15,er=-1)),i(65,me=gi?.id)),r.$$.dirty[0]&196608|r.$$.dirty[1]&1&&setTimeout(()=>{i(16,pe=Le),V&&!pe&&i(1,pt="")}),r.$$.dirty[0]&8194|r.$$.dirty[1]&2048&&pt.length<Pe&&(i(13,Xt=void 0),i(19,Bi=void 0),i(64,_r=Xt)),r.$$.dirty[0]&57344|r.$$.dirty[1]&32768&&Zt&&Xt!=null&&Xt.length&&er==-1&&!gi&&i(15,er=0),r.$$.dirty[0]&8192|r.$$.dirty[2]&4&&_r!==Xt&&i(64,_r=void 0),r.$$.dirty[0]&73729|r.$$.dirty[1]&1024|r.$$.dirty[2]&4&&he&&he.setEventHandler(it=>{switch(it.type){case"mapClick":Ke&&Ve(it.coordinates);break;case"markerClick":{const Wi=Xt?.find(Dr=>Dr.id===it.id);Wi&&Ht(Wi)}break;case"markerMouseEnter":_r&&i(15,er=pe?Xt?.findIndex(Wi=>Wi.id===it.id)??-1:-1);break;case"markerMouseLeave":_r&&i(15,er=-1);break}}),r.$$.dirty[0]&40960&&i(66,h=Xt?.[er]),r.$$.dirty[1]&66592|r.$$.dirty[2]&16&&he&&h&&Re&&zt&&he.flyTo(h.center,Tt(h)),r.$$.dirty[1]&8192&&i(68,s=vt==="full-geometry-including-polygon-center-marker"),r.$$.dirty[1]&132096|r.$$.dirty[2]&64&&(ti||he==null||he.setFeatures(void 0,void 0,s)),r.$$.dirty[0]&16384|r.$$.dirty[1]&132096|r.$$.dirty[2]&84&&he&&ti&&!_r&&(he.setFeatures(h?[h]:void 0,gi,s),he.setSelectedMarker(h?0:-1)),r.$$.dirty[0]&16384|r.$$.dirty[1]&1024|r.$$.dirty[2]&68&&he&&he.setFeatures(_r,gi,s),r.$$.dirty[0]&32768|r.$$.dirty[1]&1024|r.$$.dirty[2]&4&&_r&&he&&he.setSelectedMarker(er),r.$$.dirty[0]&2|r.$$.dirty[1]&1024&&he){const it=He(pt);he.setReverseMarker(it?[it.decimalLongitude,it.decimalLatitude]:void 0)}r.$$.dirty[2]&16&&Je("select",{feature:h}),r.$$.dirty[0]&16384&&Je("pick",{feature:gi}),r.$$.dirty[0]&73744&&i(67,x=!!(Xt!=null&&Xt.length)&&(pe||ve)),r.$$.dirty[2]&32&&Je("optionsvisibilitychange",{optionsVisible:x}),r.$$.dirty[0]&8192&&Je("featureslisted",{features:Xt}),r.$$.dirty[2]&4&&Je("featuresmarked",{features:_r}),r.$$.dirty[0]&1&&Je("reversetoggle",{reverse:Ke}),r.$$.dirty[0]&2&&Je("querychange",{query:pt}),r.$$.dirty[0]&1|r.$$.dirty[1]&1024&&he&&he.indicateReverse(Ke)},[Ke,pt,L,Y,ve,_e,K,ne,Ae,ke,tt,Ft,sr,Xt,gi,er,pe,Le,oi,Bi,et,Ze,at,Ut,bt,Ht,li,Ci,P,D,F,V,H,oe,fe,ye,Re,Se,Z,$,ue,he,Pe,Be,vt,It,Zt,zt,ti,ai,lt,Xi,ii,$e,zi,Qi,Gi,jr,En,Ot,In,xs,os,$s,_r,me,h,x,s,o,m,br,ur,Ui,Mi,Hi,Lr,Rt,Kr,Sr,Or,Ps,Bt,xi]}let jS=class extends Nu{constructor(e){super(),Ru(this,e,$S,BS,Lu,{ZOOM_DEFAULTS:28,class:2,apiKey:29,bbox:30,clearButtonTitle:3,clearOnBlur:31,clearListOnPick:32,keepListOpen:4,collapsed:5,country:33,debounceSearch:34,enableReverse:6,errorMessage:7,filter:35,flyTo:36,fuzzyMatch:37,language:38,limit:39,reverseGeocodingLimit:40,mapController:41,minLength:42,noResultsMessage:8,placeholder:9,proximity:43,reverseActive:0,reverseButtonTitle:10,searchValue:1,pickedResultStyle:44,showPlaceType:11,showResultsWhileTyping:45,selectFirst:46,flyToSelected:47,markerOnSelected:48,types:49,reverseGeocodingTypes:50,exhaustiveReverseGeocoding:51,excludeTypes:52,reverseGeocodingExcludeTypes:53,zoom:54,apiUrl:55,fetchParameters:56,iconsBaseUrl:12,adjustUrlQuery:57,adjustUrl:58,focus:59,blur:60,setQuery:61,clearList:62,clearMap:63},null,[-1,-1,-1,-1])}get ZOOM_DEFAULTS(){return this.$$.ctx[28]}get focus(){return this.$$.ctx[59]}get blur(){return this.$$.ctx[60]}get setQuery(){return this.$$.ctx[61]}get clearList(){return this.$$.ctx[62]}get clearMap(){return this.$$.ctx[63]}};function $d(r,e,i={}){const s={type:"Feature"};return(i.id===0||i.id)&&(s.id=i.id),i.bbox&&(s.bbox=i.bbox),s.properties=e||{},s.geometry=r,s}function h_(r,e,i={}){for(const s of r){if(s.length<4)throw new Error("Each LinearRing of a Polygon must have 4 or more Positions.");if(s[s.length-1].length!==s[0].length)throw new Error("First and last Position are not equivalent.");for(let h=0;h<s[s.length-1].length;h++)if(s[s.length-1][h]!==s[0][h])throw new Error("First and last Position are not equivalent.")}return $d({type:"Polygon",coordinates:r},e,i)}function jd(r,e={}){const i={type:"FeatureCollection"};return e.id&&(i.id=e.id),e.bbox&&(i.bbox=e.bbox),i.features=r,i}function ub(r,e,i={}){return $d({type:"MultiPolygon",coordinates:r},e,i)}var GS=/^-?(?:\d+(?:\.\d*)?|\.\d+)(?:e[+-]?\d+)?$/i,Qg=Math.ceil,da=Math.floor,To="[BigNumber Error] ",yx=To+"Number primitive has more than 15 significant digits: ",Ma=1e14,nr=14,_x=9007199254740991,ey=[1,10,100,1e3,1e4,1e5,1e6,1e7,1e8,1e9,1e10,1e11,1e12,1e13],vu=1e7,jo=1e9;function cb(r){var e,i,s,h=fe.prototype={constructor:fe,toString:null,valueOf:null},x=new fe(1),m=20,o=4,P=-7,L=21,D=-1e7,F=1e7,Y=!1,V=1,H=0,ve={prefix:"",groupSize:3,secondaryGroupSize:0,groupSeparator:",",decimalSeparator:".",fractionGroupSize:0,fractionGroupSeparator:"",suffix:""},_e="0123456789abcdefghijklmnopqrstuvwxyz",oe=!0;function fe(Z,$){var Q,ue,he,Pe,Ae,ke,Be,Ke,tt=this;if(!(tt instanceof fe))return new fe(Z,$);if($==null){if(Z&&Z._isBigNumber===!0){tt.s=Z.s,!Z.c||Z.e>F?tt.c=tt.e=null:Z.e<D?tt.c=[tt.e=0]:(tt.e=Z.e,tt.c=Z.c.slice());return}if((ke=typeof Z=="number")&&Z*0==0){if(tt.s=1/Z<0?(Z=-Z,-1):1,Z===~~Z){for(Pe=0,Ae=Z;Ae>=10;Ae/=10,Pe++);Pe>F?tt.c=tt.e=null:(tt.e=Pe,tt.c=[Z]);return}Ke=String(Z)}else{if(!GS.test(Ke=String(Z)))return s(tt,Ke,ke);tt.s=Ke.charCodeAt(0)==45?(Ke=Ke.slice(1),-1):1}(Pe=Ke.indexOf("."))>-1&&(Ke=Ke.replace(".","")),(Ae=Ke.search(/e/i))>0?(Pe<0&&(Pe=Ae),Pe+=+Ke.slice(Ae+1),Ke=Ke.substring(0,Ae)):Pe<0&&(Pe=Ke.length)}else{if(An($,2,_e.length,"Base"),$==10&&oe)return tt=new fe(Z),Re(tt,m+tt.e+1,o);if(Ke=String(Z),ke=typeof Z=="number"){if(Z*0!=0)return s(tt,Ke,ke,$);if(tt.s=1/Z<0?(Ke=Ke.slice(1),-1):1,fe.DEBUG&&Ke.replace(/^0\.0*|\./,"").length>15)throw Error(yx+Z)}else tt.s=Ke.charCodeAt(0)===45?(Ke=Ke.slice(1),-1):1;for(Q=_e.slice(0,$),Pe=Ae=0,Be=Ke.length;Ae<Be;Ae++)if(Q.indexOf(ue=Ke.charAt(Ae))<0){if(ue=="."){if(Ae>Pe){Pe=Be;continue}}else if(!he&&(Ke==Ke.toUpperCase()&&(Ke=Ke.toLowerCase())||Ke==Ke.toLowerCase()&&(Ke=Ke.toUpperCase()))){he=!0,Ae=-1,Pe=0;continue}return s(tt,String(Z),ke,$)}ke=!1,Ke=i(Ke,$,10,tt.s),(Pe=Ke.indexOf("."))>-1?Ke=Ke.replace(".",""):Pe=Ke.length}for(Ae=0;Ke.charCodeAt(Ae)===48;Ae++);for(Be=Ke.length;Ke.charCodeAt(--Be)===48;);if(Ke=Ke.slice(Ae,++Be)){if(Be-=Ae,ke&&fe.DEBUG&&Be>15&&(Z>_x||Z!==da(Z)))throw Error(yx+tt.s*Z);if((Pe=Pe-Ae-1)>F)tt.c=tt.e=null;else if(Pe<D)tt.c=[tt.e=0];else{if(tt.e=Pe,tt.c=[],Ae=(Pe+1)%nr,Pe<0&&(Ae+=nr),Ae<Be){for(Ae&&tt.c.push(+Ke.slice(0,Ae)),Be-=nr;Ae<Be;)tt.c.push(+Ke.slice(Ae,Ae+=nr));Ae=nr-(Ke=Ke.slice(Ae)).length}else Ae-=Be;for(;Ae--;Ke+="0");tt.c.push(+Ke)}}else tt.c=[tt.e=0]}fe.clone=cb,fe.ROUND_UP=0,fe.ROUND_DOWN=1,fe.ROUND_CEIL=2,fe.ROUND_FLOOR=3,fe.ROUND_HALF_UP=4,fe.ROUND_HALF_DOWN=5,fe.ROUND_HALF_EVEN=6,fe.ROUND_HALF_CEIL=7,fe.ROUND_HALF_FLOOR=8,fe.EUCLID=9,fe.config=fe.set=function(Z){var $,Q;if(Z!=null)if(typeof Z=="object"){if(Z.hasOwnProperty($="DECIMAL_PLACES")&&(Q=Z[$],An(Q,0,jo,$),m=Q),Z.hasOwnProperty($="ROUNDING_MODE")&&(Q=Z[$],An(Q,0,8,$),o=Q),Z.hasOwnProperty($="EXPONENTIAL_AT")&&(Q=Z[$],Q&&Q.pop?(An(Q[0],-1e9,0,$),An(Q[1],0,jo,$),P=Q[0],L=Q[1]):(An(Q,-1e9,jo,$),P=-(L=Q<0?-Q:Q))),Z.hasOwnProperty($="RANGE"))if(Q=Z[$],Q&&Q.pop)An(Q[0],-1e9,-1,$),An(Q[1],1,jo,$),D=Q[0],F=Q[1];else if(An(Q,-1e9,jo,$),Q)D=-(F=Q<0?-Q:Q);else throw Error(To+$+" cannot be zero: "+Q);if(Z.hasOwnProperty($="CRYPTO"))if(Q=Z[$],Q===!!Q)if(Q)if(typeof crypto<"u"&&crypto&&(crypto.getRandomValues||crypto.randomBytes))Y=Q;else throw Y=!Q,Error(To+"crypto unavailable");else Y=Q;else throw Error(To+$+" not true or false: "+Q);if(Z.hasOwnProperty($="MODULO_MODE")&&(Q=Z[$],An(Q,0,9,$),V=Q),Z.hasOwnProperty($="POW_PRECISION")&&(Q=Z[$],An(Q,0,jo,$),H=Q),Z.hasOwnProperty($="FORMAT"))if(Q=Z[$],typeof Q=="object")ve=Q;else throw Error(To+$+" not an object: "+Q);if(Z.hasOwnProperty($="ALPHABET"))if(Q=Z[$],typeof Q=="string"&&!/^.?$|[+\-.\s]|(.).*\1/.test(Q))oe=Q.slice(0,10)=="0123456789",_e=Q;else throw Error(To+$+" invalid: "+Q)}else throw Error(To+"Object expected: "+Z);return{DECIMAL_PLACES:m,ROUNDING_MODE:o,EXPONENTIAL_AT:[P,L],RANGE:[D,F],CRYPTO:Y,MODULO_MODE:V,POW_PRECISION:H,FORMAT:ve,ALPHABET:_e}},fe.isBigNumber=function(Z){if(!Z||Z._isBigNumber!==!0)return!1;if(!fe.DEBUG)return!0;var $,Q,ue=Z.c,he=Z.e,Pe=Z.s;e:if({}.toString.call(ue)=="[object Array]"){if((Pe===1||Pe===-1)&&he>=-1e9&&he<=jo&&he===da(he)){if(ue[0]===0){if(he===0&&ue.length===1)return!0;break e}if($=(he+1)%nr,$<1&&($+=nr),String(ue[0]).length==$){for($=0;$<ue.length;$++)if(Q=ue[$],Q<0||Q>=Ma||Q!==da(Q))break e;if(Q!==0)return!0}}}else if(ue===null&&he===null&&(Pe===null||Pe===1||Pe===-1))return!0;throw Error(To+"Invalid BigNumber: "+Z)},fe.maximum=fe.max=function(){return ne(arguments,-1)},fe.minimum=fe.min=function(){return ne(arguments,1)},fe.random=function(){var Z=9007199254740992,$=Math.random()*Z&2097151?function(){return da(Math.random()*Z)}:function(){return(Math.random()*1073741824|0)*8388608+(Math.random()*8388608|0)};return function(Q){var ue,he,Pe,Ae,ke,Be=0,Ke=[],tt=new fe(x);if(Q==null?Q=m:An(Q,0,jo),Ae=Qg(Q/nr),Y)if(crypto.getRandomValues){for(ue=crypto.getRandomValues(new Uint32Array(Ae*=2));Be<Ae;)ke=ue[Be]*131072+(ue[Be+1]>>>11),ke>=9e15?(he=crypto.getRandomValues(new Uint32Array(2)),ue[Be]=he[0],ue[Be+1]=he[1]):(Ke.push(ke%1e14),Be+=2);Be=Ae/2}else if(crypto.randomBytes){for(ue=crypto.randomBytes(Ae*=7);Be<Ae;)ke=(ue[Be]&31)*281474976710656+ue[Be+1]*1099511627776+ue[Be+2]*4294967296+ue[Be+3]*16777216+(ue[Be+4]<<16)+(ue[Be+5]<<8)+ue[Be+6],ke>=9e15?crypto.randomBytes(7).copy(ue,Be):(Ke.push(ke%1e14),Be+=7);Be=Ae/7}else throw Y=!1,Error(To+"crypto unavailable");if(!Y)for(;Be<Ae;)ke=$(),ke<9e15&&(Ke[Be++]=ke%1e14);for(Ae=Ke[--Be],Q%=nr,Ae&&Q&&(ke=ey[nr-Q],Ke[Be]=da(Ae/ke)*ke);Ke[Be]===0;Ke.pop(),Be--);if(Be<0)Ke=[Pe=0];else{for(Pe=-1;Ke[0]===0;Ke.splice(0,1),Pe-=nr);for(Be=1,ke=Ke[0];ke>=10;ke/=10,Be++);Be<nr&&(Pe-=nr-Be)}return tt.e=Pe,tt.c=Ke,tt}}(),fe.sum=function(){for(var Z=1,$=arguments,Q=new fe($[0]);Z<$.length;)Q=Q.plus($[Z++]);return Q},i=function(){var Z="0123456789";function $(Q,ue,he,Pe){for(var Ae,ke=[0],Be,Ke=0,tt=Q.length;Ke<tt;){for(Be=ke.length;Be--;ke[Be]*=ue);for(ke[0]+=Pe.indexOf(Q.charAt(Ke++)),Ae=0;Ae<ke.length;Ae++)ke[Ae]>he-1&&(ke[Ae+1]==null&&(ke[Ae+1]=0),ke[Ae+1]+=ke[Ae]/he|0,ke[Ae]%=he)}return ke.reverse()}return function(Q,ue,he,Pe,Ae){var ke,Be,Ke,tt,pt,vt,Ft,It,Zt=Q.indexOf("."),zt=m,ti=o;for(Zt>=0&&(tt=H,H=0,Q=Q.replace(".",""),It=new fe(ue),vt=It.pow(Q.length-Zt),H=tt,It.c=$(Il(ha(vt.c),vt.e,"0"),10,he,Z),It.e=It.c.length),Ft=$(Q,ue,he,Ae?(ke=_e,Z):(ke=Z,_e)),Ke=tt=Ft.length;Ft[--tt]==0;Ft.pop());if(!Ft[0])return ke.charAt(0);if(Zt<0?--Ke:(vt.c=Ft,vt.e=Ke,vt.s=Pe,vt=e(vt,It,zt,ti,he),Ft=vt.c,pt=vt.r,Ke=vt.e),Be=Ke+zt+1,Zt=Ft[Be],tt=he/2,pt=pt||Be<0||Ft[Be+1]!=null,pt=ti<4?(Zt!=null||pt)&&(ti==0||ti==(vt.s<0?3:2)):Zt>tt||Zt==tt&&(ti==4||pt||ti==6&&Ft[Be-1]&1||ti==(vt.s<0?8:7)),Be<1||!Ft[0])Q=pt?Il(ke.charAt(1),-zt,ke.charAt(0)):ke.charAt(0);else{if(Ft.length=Be,pt)for(--he;++Ft[--Be]>he;)Ft[Be]=0,Be||(++Ke,Ft=[1].concat(Ft));for(tt=Ft.length;!Ft[--tt];);for(Zt=0,Q="";Zt<=tt;Q+=ke.charAt(Ft[Zt++]));Q=Il(Q,Ke,ke.charAt(0))}return Q}}(),e=function(){function Z(ue,he,Pe){var Ae,ke,Be,Ke,tt=0,pt=ue.length,vt=he%vu,Ft=he/vu|0;for(ue=ue.slice();pt--;)Be=ue[pt]%vu,Ke=ue[pt]/vu|0,Ae=Ft*Be+Ke*vt,ke=vt*Be+Ae%vu*vu+tt,tt=(ke/Pe|0)+(Ae/vu|0)+Ft*Ke,ue[pt]=ke%Pe;return tt&&(ue=[tt].concat(ue)),ue}function $(ue,he,Pe,Ae){var ke,Be;if(Pe!=Ae)Be=Pe>Ae?1:-1;else for(ke=Be=0;ke<Pe;ke++)if(ue[ke]!=he[ke]){Be=ue[ke]>he[ke]?1:-1;break}return Be}function Q(ue,he,Pe,Ae){for(var ke=0;Pe--;)ue[Pe]-=ke,ke=ue[Pe]<he[Pe]?1:0,ue[Pe]=ke*Ae+ue[Pe]-he[Pe];for(;!ue[0]&&ue.length>1;ue.splice(0,1));}return function(ue,he,Pe,Ae,ke){var Be,Ke,tt,pt,vt,Ft,It,Zt,zt,ti,ai,Ir,lt,Xi,ii,Jt,$e,zi=ue.s==he.s?1:-1,Qi=ue.c,Gi=he.c;if(!Qi||!Qi[0]||!Gi||!Gi[0])return new fe(!ue.s||!he.s||(Qi?Gi&&Qi[0]==Gi[0]:!Gi)?NaN:Qi&&Qi[0]==0||!Gi?zi*0:zi/0);for(Zt=new fe(zi),zt=Zt.c=[],Ke=ue.e-he.e,zi=Pe+Ke+1,ke||(ke=Ma,Ke=pa(ue.e/nr)-pa(he.e/nr),zi=zi/nr|0),tt=0;Gi[tt]==(Qi[tt]||0);tt++);if(Gi[tt]>(Qi[tt]||0)&&Ke--,zi<0)zt.push(1),pt=!0;else{for(Xi=Qi.length,Jt=Gi.length,tt=0,zi+=2,vt=da(ke/(Gi[0]+1)),vt>1&&(Gi=Z(Gi,vt,ke),Qi=Z(Qi,vt,ke),Jt=Gi.length,Xi=Qi.length),lt=Jt,ti=Qi.slice(0,Jt),ai=ti.length;ai<Jt;ti[ai++]=0);$e=Gi.slice(),$e=[0].concat($e),ii=Gi[0],Gi[1]>=ke/2&&ii++;do{if(vt=0,Be=$(Gi,ti,Jt,ai),Be<0){if(Ir=ti[0],Jt!=ai&&(Ir=Ir*ke+(ti[1]||0)),vt=da(Ir/ii),vt>1)for(vt>=ke&&(vt=ke-1),Ft=Z(Gi,vt,ke),It=Ft.length,ai=ti.length;$(Ft,ti,It,ai)==1;)vt--,Q(Ft,Jt<It?$e:Gi,It,ke),It=Ft.length,Be=1;else vt==0&&(Be=vt=1),Ft=Gi.slice(),It=Ft.length;if(It<ai&&(Ft=[0].concat(Ft)),Q(ti,Ft,ai,ke),ai=ti.length,Be==-1)for(;$(Gi,ti,Jt,ai)<1;)vt++,Q(ti,Jt<ai?$e:Gi,ai,ke),ai=ti.length}else Be===0&&(vt++,ti=[0]);zt[tt++]=vt,ti[0]?ti[ai++]=Qi[lt]||0:(ti=[Qi[lt]],ai=1)}while((lt++<Xi||ti[0]!=null)&&zi--);pt=ti[0]!=null,zt[0]||zt.splice(0,1)}if(ke==Ma){for(tt=1,zi=zt[0];zi>=10;zi/=10,tt++);Re(Zt,Pe+(Zt.e=tt+Ke*nr-1)+1,Ae,pt)}else Zt.e=Ke,Zt.r=+pt;return Zt}}();function K(Z,$,Q,ue){var he,Pe,Ae,ke,Be;if(Q==null?Q=o:An(Q,0,8),!Z.c)return Z.toString();if(he=Z.c[0],Ae=Z.e,$==null)Be=ha(Z.c),Be=ue==1||ue==2&&(Ae<=P||Ae>=L)?lf(Be,Ae):Il(Be,Ae,"0");else if(Z=Re(new fe(Z),$,Q),Pe=Z.e,Be=ha(Z.c),ke=Be.length,ue==1||ue==2&&($<=Pe||Pe<=P)){for(;ke<$;Be+="0",ke++);Be=lf(Be,Pe)}else if($-=Ae,Be=Il(Be,Pe,"0"),Pe+1>ke){if(--$>0)for(Be+=".";$--;Be+="0");}else if($+=Pe-ke,$>0)for(Pe+1==ke&&(Be+=".");$--;Be+="0");return Z.s<0&&he?"-"+Be:Be}function ne(Z,$){for(var Q,ue,he=1,Pe=new fe(Z[0]);he<Z.length;he++)ue=new fe(Z[he]),(!ue.s||(Q=cc(Pe,ue))===$||Q===0&&Pe.s===$)&&(Pe=ue);return Pe}function ye(Z,$,Q){for(var ue=1,he=$.length;!$[--he];$.pop());for(he=$[0];he>=10;he/=10,ue++);return(Q=ue+Q*nr-1)>F?Z.c=Z.e=null:Q<D?Z.c=[Z.e=0]:(Z.e=Q,Z.c=$),Z}s=function(){var Z=/^(-?)0([xbo])(?=\w[\w.]*$)/i,$=/^([^.]+)\.$/,Q=/^\.([^.]+)$/,ue=/^-?(Infinity|NaN)$/,he=/^\s*\+(?=[\w.])|^\s+|\s+$/g;return function(Pe,Ae,ke,Be){var Ke,tt=ke?Ae:Ae.replace(he,"");if(ue.test(tt))Pe.s=isNaN(tt)?null:tt<0?-1:1;else{if(!ke&&(tt=tt.replace(Z,function(pt,vt,Ft){return Ke=(Ft=Ft.toLowerCase())=="x"?16:Ft=="b"?2:8,!Be||Be==Ke?vt:pt}),Be&&(Ke=Be,tt=tt.replace($,"$1").replace(Q,"0.$1")),Ae!=tt))return new fe(tt,Ke);if(fe.DEBUG)throw Error(To+"Not a"+(Be?" base "+Be:"")+" number: "+Ae);Pe.s=null}Pe.c=Pe.e=null}}();function Re(Z,$,Q,ue){var he,Pe,Ae,ke,Be,Ke,tt,pt=Z.c,vt=ey;if(pt){e:{for(he=1,ke=pt[0];ke>=10;ke/=10,he++);if(Pe=$-he,Pe<0)Pe+=nr,Ae=$,Be=pt[Ke=0],tt=da(Be/vt[he-Ae-1]%10);else if(Ke=Qg((Pe+1)/nr),Ke>=pt.length)if(ue){for(;pt.length<=Ke;pt.push(0));Be=tt=0,he=1,Pe%=nr,Ae=Pe-nr+1}else break e;else{for(Be=ke=pt[Ke],he=1;ke>=10;ke/=10,he++);Pe%=nr,Ae=Pe-nr+he,tt=Ae<0?0:da(Be/vt[he-Ae-1]%10)}if(ue=ue||$<0||pt[Ke+1]!=null||(Ae<0?Be:Be%vt[he-Ae-1]),ue=Q<4?(tt||ue)&&(Q==0||Q==(Z.s<0?3:2)):tt>5||tt==5&&(Q==4||ue||Q==6&&(Pe>0?Ae>0?Be/vt[he-Ae]:0:pt[Ke-1])%10&1||Q==(Z.s<0?8:7)),$<1||!pt[0])return pt.length=0,ue?($-=Z.e+1,pt[0]=vt[(nr-$%nr)%nr],Z.e=-$||0):pt[0]=Z.e=0,Z;if(Pe==0?(pt.length=Ke,ke=1,Ke--):(pt.length=Ke+1,ke=vt[nr-Pe],pt[Ke]=Ae>0?da(Be/vt[he-Ae]%vt[Ae])*ke:0),ue)for(;;)if(Ke==0){for(Pe=1,Ae=pt[0];Ae>=10;Ae/=10,Pe++);for(Ae=pt[0]+=ke,ke=1;Ae>=10;Ae/=10,ke++);Pe!=ke&&(Z.e++,pt[0]==Ma&&(pt[0]=1));break}else{if(pt[Ke]+=ke,pt[Ke]!=Ma)break;pt[Ke--]=0,ke=1}for(Pe=pt.length;pt[--Pe]===0;pt.pop());}Z.e>F?Z.c=Z.e=null:Z.e<D&&(Z.c=[Z.e=0])}return Z}function Se(Z){var $,Q=Z.e;return Q===null?Z.toString():($=ha(Z.c),$=Q<=P||Q>=L?lf($,Q):Il($,Q,"0"),Z.s<0?"-"+$:$)}return h.absoluteValue=h.abs=function(){var Z=new fe(this);return Z.s<0&&(Z.s=1),Z},h.comparedTo=function(Z,$){return cc(this,new fe(Z,$))},h.decimalPlaces=h.dp=function(Z,$){var Q,ue,he,Pe=this;if(Z!=null)return An(Z,0,jo),$==null?$=o:An($,0,8),Re(new fe(Pe),Z+Pe.e+1,$);if(!(Q=Pe.c))return null;if(ue=((he=Q.length-1)-pa(this.e/nr))*nr,he=Q[he])for(;he%10==0;he/=10,ue--);return ue<0&&(ue=0),ue},h.dividedBy=h.div=function(Z,$){return e(this,new fe(Z,$),m,o)},h.dividedToIntegerBy=h.idiv=function(Z,$){return e(this,new fe(Z,$),0,1)},h.exponentiatedBy=h.pow=function(Z,$){var Q,ue,he,Pe,Ae,ke,Be,Ke,tt,pt=this;if(Z=new fe(Z),Z.c&&!Z.isInteger())throw Error(To+"Exponent not an integer: "+Se(Z));if($!=null&&($=new fe($)),ke=Z.e>14,!pt.c||!pt.c[0]||pt.c[0]==1&&!pt.e&&pt.c.length==1||!Z.c||!Z.c[0])return tt=new fe(Math.pow(+Se(pt),ke?Z.s*(2-af(Z)):+Se(Z))),$?tt.mod($):tt;if(Be=Z.s<0,$){if($.c?!$.c[0]:!$.s)return new fe(NaN);ue=!Be&&pt.isInteger()&&$.isInteger(),ue&&(pt=pt.mod($))}else{if(Z.e>9&&(pt.e>0||pt.e<-1||(pt.e==0?pt.c[0]>1||ke&&pt.c[1]>=24e7:pt.c[0]<8e13||ke&&pt.c[0]<=9999975e7)))return Pe=pt.s<0&&af(Z)?-0:0,pt.e>-1&&(Pe=1/Pe),new fe(Be?1/Pe:Pe);H&&(Pe=Qg(H/nr+2))}for(ke?(Q=new fe(.5),Be&&(Z.s=1),Ke=af(Z)):(he=Math.abs(+Se(Z)),Ke=he%2),tt=new fe(x);;){if(Ke){if(tt=tt.times(pt),!tt.c)break;Pe?tt.c.length>Pe&&(tt.c.length=Pe):ue&&(tt=tt.mod($))}if(he){if(he=da(he/2),he===0)break;Ke=he%2}else if(Z=Z.times(Q),Re(Z,Z.e+1,1),Z.e>14)Ke=af(Z);else{if(he=+Se(Z),he===0)break;Ke=he%2}pt=pt.times(pt),Pe?pt.c&&pt.c.length>Pe&&(pt.c.length=Pe):ue&&(pt=pt.mod($))}return ue?tt:(Be&&(tt=x.div(tt)),$?tt.mod($):Pe?Re(tt,H,o,Ae):tt)},h.integerValue=function(Z){var $=new fe(this);return Z==null?Z=o:An(Z,0,8),Re($,$.e+1,Z)},h.isEqualTo=h.eq=function(Z,$){return cc(this,new fe(Z,$))===0},h.isFinite=function(){return!!this.c},h.isGreaterThan=h.gt=function(Z,$){return cc(this,new fe(Z,$))>0},h.isGreaterThanOrEqualTo=h.gte=function(Z,$){return($=cc(this,new fe(Z,$)))===1||$===0},h.isInteger=function(){return!!this.c&&pa(this.e/nr)>this.c.length-2},h.isLessThan=h.lt=function(Z,$){return cc(this,new fe(Z,$))<0},h.isLessThanOrEqualTo=h.lte=function(Z,$){return($=cc(this,new fe(Z,$)))===-1||$===0},h.isNaN=function(){return!this.s},h.isNegative=function(){return this.s<0},h.isPositive=function(){return this.s>0},h.isZero=function(){return!!this.c&&this.c[0]==0},h.minus=function(Z,$){var Q,ue,he,Pe,Ae=this,ke=Ae.s;if(Z=new fe(Z,$),$=Z.s,!ke||!$)return new fe(NaN);if(ke!=$)return Z.s=-$,Ae.plus(Z);var Be=Ae.e/nr,Ke=Z.e/nr,tt=Ae.c,pt=Z.c;if(!Be||!Ke){if(!tt||!pt)return tt?(Z.s=-$,Z):new fe(pt?Ae:NaN);if(!tt[0]||!pt[0])return pt[0]?(Z.s=-$,Z):new fe(tt[0]?Ae:o==3?-0:0)}if(Be=pa(Be),Ke=pa(Ke),tt=tt.slice(),ke=Be-Ke){for((Pe=ke<0)?(ke=-ke,he=tt):(Ke=Be,he=pt),he.reverse(),$=ke;$--;he.push(0));he.reverse()}else for(ue=(Pe=(ke=tt.length)<($=pt.length))?ke:$,ke=$=0;$<ue;$++)if(tt[$]!=pt[$]){Pe=tt[$]<pt[$];break}if(Pe&&(he=tt,tt=pt,pt=he,Z.s=-Z.s),$=(ue=pt.length)-(Q=tt.length),$>0)for(;$--;tt[Q++]=0);for($=Ma-1;ue>ke;){if(tt[--ue]<pt[ue]){for(Q=ue;Q&&!tt[--Q];tt[Q]=$);--tt[Q],tt[ue]+=Ma}tt[ue]-=pt[ue]}for(;tt[0]==0;tt.splice(0,1),--Ke);return tt[0]?ye(Z,tt,Ke):(Z.s=o==3?-1:1,Z.c=[Z.e=0],Z)},h.modulo=h.mod=function(Z,$){var Q,ue,he=this;return Z=new fe(Z,$),!he.c||!Z.s||Z.c&&!Z.c[0]?new fe(NaN):!Z.c||he.c&&!he.c[0]?new fe(he):(V==9?(ue=Z.s,Z.s=1,Q=e(he,Z,0,3),Z.s=ue,Q.s*=ue):Q=e(he,Z,0,V),Z=he.minus(Q.times(Z)),!Z.c[0]&&V==1&&(Z.s=he.s),Z)},h.multipliedBy=h.times=function(Z,$){var Q,ue,he,Pe,Ae,ke,Be,Ke,tt,pt,vt,Ft,It,Zt,zt,ti=this,ai=ti.c,Ir=(Z=new fe(Z,$)).c;if(!ai||!Ir||!ai[0]||!Ir[0])return!ti.s||!Z.s||ai&&!ai[0]&&!Ir||Ir&&!Ir[0]&&!ai?Z.c=Z.e=Z.s=null:(Z.s*=ti.s,!ai||!Ir?Z.c=Z.e=null:(Z.c=[0],Z.e=0)),Z;for(ue=pa(ti.e/nr)+pa(Z.e/nr),Z.s*=ti.s,Be=ai.length,pt=Ir.length,Be<pt&&(It=ai,ai=Ir,Ir=It,he=Be,Be=pt,pt=he),he=Be+pt,It=[];he--;It.push(0));for(Zt=Ma,zt=vu,he=pt;--he>=0;){for(Q=0,vt=Ir[he]%zt,Ft=Ir[he]/zt|0,Ae=Be,Pe=he+Ae;Pe>he;)Ke=ai[--Ae]%zt,tt=ai[Ae]/zt|0,ke=Ft*Ke+tt*vt,Ke=vt*Ke+ke%zt*zt+It[Pe]+Q,Q=(Ke/Zt|0)+(ke/zt|0)+Ft*tt,It[Pe--]=Ke%Zt;It[Pe]=Q}return Q?++ue:It.splice(0,1),ye(Z,It,ue)},h.negated=function(){var Z=new fe(this);return Z.s=-Z.s||null,Z},h.plus=function(Z,$){var Q,ue=this,he=ue.s;if(Z=new fe(Z,$),$=Z.s,!he||!$)return new fe(NaN);if(he!=$)return Z.s=-$,ue.minus(Z);var Pe=ue.e/nr,Ae=Z.e/nr,ke=ue.c,Be=Z.c;if(!Pe||!Ae){if(!ke||!Be)return new fe(he/0);if(!ke[0]||!Be[0])return Be[0]?Z:new fe(ke[0]?ue:he*0)}if(Pe=pa(Pe),Ae=pa(Ae),ke=ke.slice(),he=Pe-Ae){for(he>0?(Ae=Pe,Q=Be):(he=-he,Q=ke),Q.reverse();he--;Q.push(0));Q.reverse()}for(he=ke.length,$=Be.length,he-$<0&&(Q=Be,Be=ke,ke=Q,$=he),he=0;$;)he=(ke[--$]=ke[$]+Be[$]+he)/Ma|0,ke[$]=Ma===ke[$]?0:ke[$]%Ma;return he&&(ke=[he].concat(ke),++Ae),ye(Z,ke,Ae)},h.precision=h.sd=function(Z,$){var Q,ue,he,Pe=this;if(Z!=null&&Z!==!!Z)return An(Z,1,jo),$==null?$=o:An($,0,8),Re(new fe(Pe),Z,$);if(!(Q=Pe.c))return null;if(he=Q.length-1,ue=he*nr+1,he=Q[he]){for(;he%10==0;he/=10,ue--);for(he=Q[0];he>=10;he/=10,ue++);}return Z&&Pe.e+1>ue&&(ue=Pe.e+1),ue},h.shiftedBy=function(Z){return An(Z,-9007199254740991,_x),this.times("1e"+Z)},h.squareRoot=h.sqrt=function(){var Z,$,Q,ue,he,Pe=this,Ae=Pe.c,ke=Pe.s,Be=Pe.e,Ke=m+4,tt=new fe("0.5");if(ke!==1||!Ae||!Ae[0])return new fe(!ke||ke<0&&(!Ae||Ae[0])?NaN:Ae?Pe:1/0);if(ke=Math.sqrt(+Se(Pe)),ke==0||ke==1/0?($=ha(Ae),($.length+Be)%2==0&&($+="0"),ke=Math.sqrt(+$),Be=pa((Be+1)/2)-(Be<0||Be%2),ke==1/0?$="5e"+Be:($=ke.toExponential(),$=$.slice(0,$.indexOf("e")+1)+Be),Q=new fe($)):Q=new fe(ke+""),Q.c[0]){for(Be=Q.e,ke=Be+Ke,ke<3&&(ke=0);;)if(he=Q,Q=tt.times(he.plus(e(Pe,he,Ke,1))),ha(he.c).slice(0,ke)===($=ha(Q.c)).slice(0,ke))if(Q.e<Be&&--ke,$=$.slice(ke-3,ke+1),$=="9999"||!ue&&$=="4999"){if(!ue&&(Re(he,he.e+m+2,0),he.times(he).eq(Pe))){Q=he;break}Ke+=4,ke+=4,ue=1}else{(!+$||!+$.slice(1)&&$.charAt(0)=="5")&&(Re(Q,Q.e+m+2,1),Z=!Q.times(Q).eq(Pe));break}}return Re(Q,Q.e+m+1,o,Z)},h.toExponential=function(Z,$){return Z!=null&&(An(Z,0,jo),Z++),K(this,Z,$,1)},h.toFixed=function(Z,$){return Z!=null&&(An(Z,0,jo),Z=Z+this.e+1),K(this,Z,$)},h.toFormat=function(Z,$,Q){var ue,he=this;if(Q==null)Z!=null&&$&&typeof $=="object"?(Q=$,$=null):Z&&typeof Z=="object"?(Q=Z,Z=$=null):Q=ve;else if(typeof Q!="object")throw Error(To+"Argument not an object: "+Q);if(ue=he.toFixed(Z,$),he.c){var Pe,Ae=ue.split("."),ke=+Q.groupSize,Be=+Q.secondaryGroupSize,Ke=Q.groupSeparator||"",tt=Ae[0],pt=Ae[1],vt=he.s<0,Ft=vt?tt.slice(1):tt,It=Ft.length;if(Be&&(Pe=ke,ke=Be,Be=Pe,It-=Pe),ke>0&&It>0){for(Pe=It%ke||ke,tt=Ft.substr(0,Pe);Pe<It;Pe+=ke)tt+=Ke+Ft.substr(Pe,ke);Be>0&&(tt+=Ke+Ft.slice(Pe)),vt&&(tt="-"+tt)}ue=pt?tt+(Q.decimalSeparator||"")+((Be=+Q.fractionGroupSize)?pt.replace(new RegExp("\\d{"+Be+"}\\B","g"),"$&"+(Q.fractionGroupSeparator||"")):pt):tt}return(Q.prefix||"")+ue+(Q.suffix||"")},h.toFraction=function(Z){var $,Q,ue,he,Pe,Ae,ke,Be,Ke,tt,pt,vt,Ft=this,It=Ft.c;if(Z!=null&&(ke=new fe(Z),!ke.isInteger()&&(ke.c||ke.s!==1)||ke.lt(x)))throw Error(To+"Argument "+(ke.isInteger()?"out of range: ":"not an integer: ")+Se(ke));if(!It)return new fe(Ft);for($=new fe(x),Ke=Q=new fe(x),ue=Be=new fe(x),vt=ha(It),Pe=$.e=vt.length-Ft.e-1,$.c[0]=ey[(Ae=Pe%nr)<0?nr+Ae:Ae],Z=!Z||ke.comparedTo($)>0?Pe>0?$:Ke:ke,Ae=F,F=1/0,ke=new fe(vt),Be.c[0]=0;tt=e(ke,$,0,1),he=Q.plus(tt.times(ue)),he.comparedTo(Z)!=1;)Q=ue,ue=he,Ke=Be.plus(tt.times(he=Ke)),Be=he,$=ke.minus(tt.times(he=$)),ke=he;return he=e(Z.minus(Q),ue,0,1),Be=Be.plus(he.times(Ke)),Q=Q.plus(he.times(ue)),Be.s=Ke.s=Ft.s,Pe=Pe*2,pt=e(Ke,ue,Pe,o).minus(Ft).abs().comparedTo(e(Be,Q,Pe,o).minus(Ft).abs())<1?[Ke,ue]:[Be,Q],F=Ae,pt},h.toNumber=function(){return+Se(this)},h.toPrecision=function(Z,$){return Z!=null&&An(Z,1,jo),K(this,Z,$,2)},h.toString=function(Z){var $,Q=this,ue=Q.s,he=Q.e;return he===null?ue?($="Infinity",ue<0&&($="-"+$)):$="NaN":(Z==null?$=he<=P||he>=L?lf(ha(Q.c),he):Il(ha(Q.c),he,"0"):Z===10&&oe?(Q=Re(new fe(Q),m+he+1,o),$=Il(ha(Q.c),Q.e,"0")):(An(Z,2,_e.length,"Base"),$=i(Il(ha(Q.c),he,"0"),10,Z,ue,!0)),ue<0&&Q.c[0]&&($="-"+$)),$},h.valueOf=h.toJSON=function(){return Se(this)},h._isBigNumber=!0,h[Symbol.toStringTag]="BigNumber",h[Symbol.for("nodejs.util.inspect.custom")]=h.valueOf,r!=null&&fe.set(r),fe}function pa(r){var e=r|0;return r>0||r===e?e:e-1}function ha(r){for(var e,i,s=1,h=r.length,x=r[0]+"";s<h;){for(e=r[s++]+"",i=nr-e.length;i--;e="0"+e);x+=e}for(h=x.length;x.charCodeAt(--h)===48;);return x.slice(0,h+1||1)}function cc(r,e){var i,s,h=r.c,x=e.c,m=r.s,o=e.s,P=r.e,L=e.e;if(!m||!o)return null;if(i=h&&!h[0],s=x&&!x[0],i||s)return i?s?0:-o:m;if(m!=o)return m;if(i=m<0,s=P==L,!h||!x)return s?0:!h^i?1:-1;if(!s)return P>L^i?1:-1;for(o=(P=h.length)<(L=x.length)?P:L,m=0;m<o;m++)if(h[m]!=x[m])return h[m]>x[m]^i?1:-1;return P==L?0:P>L^i?1:-1}function An(r,e,i,s){if(r<e||r>i||r!==da(r))throw Error(To+(s||"Argument")+(typeof r=="number"?r<e||r>i?" out of range: ":" not an integer: ":" not a primitive number: ")+String(r))}function af(r){var e=r.c.length-1;return pa(r.e/nr)==e&&r.c[e]%2!=0}function lf(r,e){return(r.length>1?r.charAt(0)+"."+r.slice(1):r)+(e<0?"e":"e+")+e}function Il(r,e,i){var s,h;if(e<0){for(h=i+".";++e;h+=i);r=h+r}else if(s=r.length,++e>s){for(h=i,e-=s;--e;h+=i);r+=h}else e<s&&(r=r.slice(0,e)+"."+r.slice(e));return r}var sl=cb(),US=class{constructor(e){Si(this,"key"),Si(this,"left",null),Si(this,"right",null),this.key=e}},_d=class extends US{constructor(r){super(r)}},VS=class{constructor(){Si(this,"size",0),Si(this,"modificationCount",0),Si(this,"splayCount",0)}splay(e){const i=this.root;if(i==null)return this.compare(e,e),-1;let s=null,h=null,x=null,m=null,o=i;const P=this.compare;let L;for(;;)if(L=P(o.key,e),L>0){let D=o.left;if(D==null||(L=P(D.key,e),L>0&&(o.left=D.right,D.right=o,o=D,D=o.left,D==null)))break;s==null?h=o:s.left=o,s=o,o=D}else if(L<0){let D=o.right;if(D==null||(L=P(D.key,e),L<0&&(o.right=D.left,D.left=o,o=D,D=o.right,D==null)))break;x==null?m=o:x.right=o,x=o,o=D}else break;return x!=null&&(x.right=o.left,o.left=m),s!=null&&(s.left=o.right,o.right=h),this.root!==o&&(this.root=o,this.splayCount++),L}splayMin(e){let i=e,s=i.left;for(;s!=null;){const h=s;i.left=h.right,h.right=i,i=h,s=i.left}return i}splayMax(e){let i=e,s=i.right;for(;s!=null;){const h=s;i.right=h.left,h.left=i,i=h,s=i.right}return i}_delete(e){if(this.root==null||this.splay(e)!=0)return null;let i=this.root;const s=i,h=i.left;if(this.size--,h==null)this.root=i.right;else{const x=i.right;i=this.splayMax(h),i.right=x,this.root=i}return this.modificationCount++,s}addNewRoot(e,i){this.size++,this.modificationCount++;const s=this.root;if(s==null){this.root=e;return}i<0?(e.left=s,e.right=s.right,s.right=null):(e.right=s,e.left=s.left,s.left=null),this.root=e}_first(){const e=this.root;return e==null?null:(this.root=this.splayMin(e),this.root)}_last(){const e=this.root;return e==null?null:(this.root=this.splayMax(e),this.root)}clear(){this.root=null,this.size=0,this.modificationCount++}has(e){return this.validKey(e)&&this.splay(e)==0}defaultCompare(){return(e,i)=>e<i?-1:e>i?1:0}wrap(){return{getRoot:()=>this.root,setRoot:e=>{this.root=e},getSize:()=>this.size,getModificationCount:()=>this.modificationCount,getSplayCount:()=>this.splayCount,setSplayCount:e=>{this.splayCount=e},splay:e=>this.splay(e),has:e=>this.has(e)}}},vx,xx,Hf=class Sd extends VS{constructor(e,i){super(),Si(this,"root",null),Si(this,"compare"),Si(this,"validKey"),Si(this,vx,"[object Set]"),this.compare=e??this.defaultCompare(),this.validKey=i??(s=>s!=null&&s!=null)}delete(e){return this.validKey(e)?this._delete(e)!=null:!1}deleteAll(e){for(const i of e)this.delete(i)}forEach(e){const i=this[Symbol.iterator]();let s;for(;s=i.next(),!s.done;)e(s.value,s.value,this)}add(e){const i=this.splay(e);return i!=0&&this.addNewRoot(new _d(e),i),this}addAndReturn(e){const i=this.splay(e);return i!=0&&this.addNewRoot(new _d(e),i),this.root.key}addAll(e){for(const i of e)this.add(i)}isEmpty(){return this.root==null}isNotEmpty(){return this.root!=null}single(){if(this.size==0)throw"Bad state: No element";if(this.size>1)throw"Bad state: Too many element";return this.root.key}first(){if(this.size==0)throw"Bad state: No element";return this._first().key}last(){if(this.size==0)throw"Bad state: No element";return this._last().key}lastBefore(e){if(e==null)throw"Invalid arguments(s)";if(this.root==null)return null;if(this.splay(e)<0)return this.root.key;let i=this.root.left;if(i==null)return null;let s=i.right;for(;s!=null;)i=s,s=i.right;return i.key}firstAfter(e){if(e==null)throw"Invalid arguments(s)";if(this.root==null)return null;if(this.splay(e)>0)return this.root.key;let i=this.root.right;if(i==null)return null;let s=i.left;for(;s!=null;)i=s,s=i.left;return i.key}retainAll(e){const i=new Sd(this.compare,this.validKey),s=this.modificationCount;for(const h of e){if(s!=this.modificationCount)throw"Concurrent modification during iteration.";this.validKey(h)&&this.splay(h)==0&&i.add(this.root.key)}i.size!=this.size&&(this.root=i.root,this.size=i.size,this.modificationCount++)}lookup(e){return!this.validKey(e)||this.splay(e)!=0?null:this.root.key}intersection(e){const i=new Sd(this.compare,this.validKey);for(const s of this)e.has(s)&&i.add(s);return i}difference(e){const i=new Sd(this.compare,this.validKey);for(const s of this)e.has(s)||i.add(s);return i}union(e){const i=this.clone();return i.addAll(e),i}clone(){const e=new Sd(this.compare,this.validKey);return e.size=this.size,e.root=this.copyNode(this.root),e}copyNode(e){if(e==null)return null;function i(h,x){let m,o;do{if(m=h.left,o=h.right,m!=null){const P=new _d(m.key);x.left=P,i(m,P)}if(o!=null){const P=new _d(o.key);x.right=P,h=o,x=P}}while(o!=null)}const s=new _d(e.key);return i(e,s),s}toSet(){return this.clone()}entries(){return new ZS(this.wrap())}keys(){return this[Symbol.iterator]()}values(){return this[Symbol.iterator]()}[(xx=Symbol.iterator,vx=Symbol.toStringTag,xx)](){return new qS(this.wrap())}},hb=class{constructor(e){Si(this,"tree"),Si(this,"path",new Array),Si(this,"modificationCount",null),Si(this,"splayCount"),this.tree=e,this.splayCount=e.getSplayCount()}[Symbol.iterator](){return this}next(){return this.moveNext()?{done:!1,value:this.current()}:{done:!0,value:null}}current(){if(!this.path.length)return null;const e=this.path[this.path.length-1];return this.getValue(e)}rebuildPath(e){this.path.splice(0,this.path.length),this.tree.splay(e),this.path.push(this.tree.getRoot()),this.splayCount=this.tree.getSplayCount()}findLeftMostDescendent(e){for(;e!=null;)this.path.push(e),e=e.left}moveNext(){if(this.modificationCount!=this.tree.getModificationCount()){if(this.modificationCount==null){this.modificationCount=this.tree.getModificationCount();let s=this.tree.getRoot();for(;s!=null;)this.path.push(s),s=s.left;return this.path.length>0}throw"Concurrent modification during iteration."}if(!this.path.length)return!1;this.splayCount!=this.tree.getSplayCount()&&this.rebuildPath(this.path[this.path.length-1].key);let e=this.path[this.path.length-1],i=e.right;if(i!=null){for(;i!=null;)this.path.push(i),i=i.left;return!0}for(this.path.pop();this.path.length&&this.path[this.path.length-1].right===e;)e=this.path.pop();return this.path.length>0}},qS=class extends hb{getValue(e){return e.key}},ZS=class extends hb{getValue(e){return[e.key,e.key]}},db=r=>()=>r,Py=r=>{const e=r?(i,s)=>s.minus(i).abs().isLessThanOrEqualTo(r):db(!1);return(i,s)=>e(i,s)?0:i.comparedTo(s)};function WS(r){const e=r?(i,s,h,x,m)=>i.exponentiatedBy(2).isLessThanOrEqualTo(x.minus(s).exponentiatedBy(2).plus(m.minus(h).exponentiatedBy(2)).times(r)):db(!1);return(i,s,h)=>{const x=i.x,m=i.y,o=h.x,P=h.y,L=m.minus(P).times(s.x.minus(o)).minus(x.minus(o).times(s.y.minus(P)));return e(L,x,m,o,P)?0:L.comparedTo(0)}}var YS=r=>r,XS=r=>{if(r){const e=new Hf(Py(r)),i=new Hf(Py(r)),s=(x,m)=>m.addAndReturn(x),h=x=>({x:s(x.x,e),y:s(x.y,i)});return h({x:new sl(0),y:new sl(0)}),h}return YS},ky=r=>({set:e=>{$l=ky(e)},reset:()=>ky(r),compare:Py(r),snap:XS(r),orient:WS(r)}),$l=ky(),vd=(r,e)=>r.ll.x.isLessThanOrEqualTo(e.x)&&e.x.isLessThanOrEqualTo(r.ur.x)&&r.ll.y.isLessThanOrEqualTo(e.y)&&e.y.isLessThanOrEqualTo(r.ur.y),Cy=(r,e)=>{if(e.ur.x.isLessThan(r.ll.x)||r.ur.x.isLessThan(e.ll.x)||e.ur.y.isLessThan(r.ll.y)||r.ur.y.isLessThan(e.ll.y))return null;const i=r.ll.x.isLessThan(e.ll.x)?e.ll.x:r.ll.x,s=r.ur.x.isLessThan(e.ur.x)?r.ur.x:e.ur.x,h=r.ll.y.isLessThan(e.ll.y)?e.ll.y:r.ll.y,x=r.ur.y.isLessThan(e.ur.y)?r.ur.y:e.ur.y;return{ll:{x:i,y:h},ur:{x:s,y:x}}},zf=(r,e)=>r.x.times(e.y).minus(r.y.times(e.x)),pb=(r,e)=>r.x.times(e.x).plus(r.y.times(e.y)),Kf=r=>pb(r,r).sqrt(),HS=(r,e,i)=>{const s={x:e.x.minus(r.x),y:e.y.minus(r.y)},h={x:i.x.minus(r.x),y:i.y.minus(r.y)};return zf(h,s).div(Kf(h)).div(Kf(s))},KS=(r,e,i)=>{const s={x:e.x.minus(r.x),y:e.y.minus(r.y)},h={x:i.x.minus(r.x),y:i.y.minus(r.y)};return pb(h,s).div(Kf(h)).div(Kf(s))},bx=(r,e,i)=>e.y.isZero()?null:{x:r.x.plus(e.x.div(e.y).times(i.minus(r.y))),y:i},wx=(r,e,i)=>e.x.isZero()?null:{x:i,y:r.y.plus(e.y.div(e.x).times(i.minus(r.x)))},JS=(r,e,i,s)=>{if(e.x.isZero())return wx(i,s,r.x);if(s.x.isZero())return wx(r,e,i.x);if(e.y.isZero())return bx(i,s,r.y);if(s.y.isZero())return bx(r,e,i.y);const h=zf(e,s);if(h.isZero())return null;const x={x:i.x.minus(r.x),y:i.y.minus(r.y)},m=zf(x,e).div(h),o=zf(x,s).div(h),P=r.x.plus(o.times(e.x)),L=i.x.plus(m.times(s.x)),D=r.y.plus(o.times(e.y)),F=i.y.plus(m.times(s.y)),Y=P.plus(L).div(2),V=D.plus(F).div(2);return{x:Y,y:V}},il=class fb{constructor(e,i){Si(this,"point"),Si(this,"isLeft"),Si(this,"segment"),Si(this,"otherSE"),Si(this,"consumedBy"),e.events===void 0?e.events=[this]:e.events.push(this),this.point=e,this.isLeft=i}static compare(e,i){const s=fb.comparePoints(e.point,i.point);return s!==0?s:(e.point!==i.point&&e.link(i),e.isLeft!==i.isLeft?e.isLeft?1:-1:Qf.compare(e.segment,i.segment))}static comparePoints(e,i){return e.x.isLessThan(i.x)?-1:e.x.isGreaterThan(i.x)?1:e.y.isLessThan(i.y)?-1:e.y.isGreaterThan(i.y)?1:0}link(e){if(e.point===this.point)throw new Error("Tried to link already linked events");const i=e.point.events;for(let s=0,h=i.length;s<h;s++){const x=i[s];this.point.events.push(x),x.point=this.point}this.checkForConsuming()}checkForConsuming(){const e=this.point.events.length;for(let i=0;i<e;i++){const s=this.point.events[i];if(s.segment.consumedBy===void 0)for(let h=i+1;h<e;h++){const x=this.point.events[h];x.consumedBy===void 0&&s.otherSE.point.events===x.otherSE.point.events&&s.segment.consume(x.segment)}}}getAvailableLinkedEvents(){const e=[];for(let i=0,s=this.point.events.length;i<s;i++){const h=this.point.events[i];h!==this&&!h.segment.ringOut&&h.segment.isInResult()&&e.push(h)}return e}getLeftmostComparator(e){const i=new Map,s=h=>{const x=h.otherSE;i.set(h,{sine:HS(this.point,e.point,x.point),cosine:KS(this.point,e.point,x.point)})};return(h,x)=>{i.has(h)||s(h),i.has(x)||s(x);const{sine:m,cosine:o}=i.get(h),{sine:P,cosine:L}=i.get(x);return m.isGreaterThanOrEqualTo(0)&&P.isGreaterThanOrEqualTo(0)?o.isLessThan(L)?1:o.isGreaterThan(L)?-1:0:m.isLessThan(0)&&P.isLessThan(0)?o.isLessThan(L)?-1:o.isGreaterThan(L)?1:0:P.isLessThan(m)?-1:P.isGreaterThan(m)?1:0}}},QS=class Ay{constructor(e){Si(this,"events"),Si(this,"poly"),Si(this,"_isExteriorRing"),Si(this,"_enclosingRing"),this.events=e;for(let i=0,s=e.length;i<s;i++)e[i].segment.ringOut=this;this.poly=null}static factory(e){const i=[];for(let s=0,h=e.length;s<h;s++){const x=e[s];if(!x.isInResult()||x.ringOut)continue;let m=null,o=x.leftSE,P=x.rightSE;const L=[o],D=o.point,F=[];for(;m=o,o=P,L.push(o),o.point!==D;)for(;;){const Y=o.getAvailableLinkedEvents();if(Y.length===0){const ve=L[0].point,_e=L[L.length-1].point;throw new Error(`Unable to complete output ring starting at [${ve.x}, ${ve.y}]. Last matching segment found ends at [${_e.x}, ${_e.y}].`)}if(Y.length===1){P=Y[0].otherSE;break}let V=null;for(let ve=0,_e=F.length;ve<_e;ve++)if(F[ve].point===o.point){V=ve;break}if(V!==null){const ve=F.splice(V)[0],_e=L.splice(ve.index);_e.unshift(_e[0].otherSE),i.push(new Ay(_e.reverse()));continue}F.push({index:L.length,point:o.point});const H=o.getLeftmostComparator(m);P=Y.sort(H)[0].otherSE;break}i.push(new Ay(L))}return i}getGeom(){let e=this.events[0].point;const i=[e];for(let L=1,D=this.events.length-1;L<D;L++){const F=this.events[L].point,Y=this.events[L+1].point;$l.orient(F,e,Y)!==0&&(i.push(F),e=F)}if(i.length===1)return null;const s=i[0],h=i[1];$l.orient(s,e,h)===0&&i.shift(),i.push(i[0]);const x=this.isExteriorRing()?1:-1,m=this.isExteriorRing()?0:i.length-1,o=this.isExteriorRing()?i.length:-1,P=[];for(let L=m;L!=o;L+=x)P.push([i[L].x.toNumber(),i[L].y.toNumber()]);return P}isExteriorRing(){if(this._isExteriorRing===void 0){const e=this.enclosingRing();this._isExteriorRing=e?!e.isExteriorRing():!0}return this._isExteriorRing}enclosingRing(){return this._enclosingRing===void 0&&(this._enclosingRing=this._calcEnclosingRing()),this._enclosingRing}_calcEnclosingRing(){var e,i;let s=this.events[0];for(let m=1,o=this.events.length;m<o;m++){const P=this.events[m];il.compare(s,P)>0&&(s=P)}let h=s.segment.prevInResult(),x=h?h.prevInResult():null;for(;;){if(!h)return null;if(!x)return h.ringOut;if(x.ringOut!==h.ringOut)return((e=x.ringOut)==null?void 0:e.enclosingRing())!==h.ringOut?h.ringOut:(i=h.ringOut)==null?void 0:i.enclosingRing();h=x.prevInResult(),x=h?h.prevInResult():null}}},Tx=class{constructor(e){Si(this,"exteriorRing"),Si(this,"interiorRings"),this.exteriorRing=e,e.poly=this,this.interiorRings=[]}addInterior(e){this.interiorRings.push(e),e.poly=this}getGeom(){const e=this.exteriorRing.getGeom();if(e===null)return null;const i=[e];for(let s=0,h=this.interiorRings.length;s<h;s++){const x=this.interiorRings[s].getGeom();x!==null&&i.push(x)}return i}},eM=class{constructor(e){Si(this,"rings"),Si(this,"polys"),this.rings=e,this.polys=this._composePolys(e)}getGeom(){const e=[];for(let i=0,s=this.polys.length;i<s;i++){const h=this.polys[i].getGeom();h!==null&&e.push(h)}return e}_composePolys(e){var i;const s=[];for(let h=0,x=e.length;h<x;h++){const m=e[h];if(!m.poly)if(m.isExteriorRing())s.push(new Tx(m));else{const o=m.enclosingRing();o!=null&&o.poly||s.push(new Tx(o)),(i=o?.poly)==null||i.addInterior(m)}}return s}},tM=class{constructor(e,i=Qf.compare){Si(this,"queue"),Si(this,"tree"),Si(this,"segments"),this.queue=e,this.tree=new Hf(i),this.segments=[]}process(e){const i=e.segment,s=[];if(e.consumedBy)return e.isLeft?this.queue.delete(e.otherSE):this.tree.delete(i),s;e.isLeft&&this.tree.add(i);let h=i,x=i;do h=this.tree.lastBefore(h);while(h!=null&&h.consumedBy!=null);do x=this.tree.firstAfter(x);while(x!=null&&x.consumedBy!=null);if(e.isLeft){let m=null;if(h){const P=h.getIntersection(i);if(P!==null&&(i.isAnEndpoint(P)||(m=P),!h.isAnEndpoint(P))){const L=this._splitSafely(h,P);for(let D=0,F=L.length;D<F;D++)s.push(L[D])}}let o=null;if(x){const P=x.getIntersection(i);if(P!==null&&(i.isAnEndpoint(P)||(o=P),!x.isAnEndpoint(P))){const L=this._splitSafely(x,P);for(let D=0,F=L.length;D<F;D++)s.push(L[D])}}if(m!==null||o!==null){let P=null;m===null?P=o:o===null?P=m:P=il.comparePoints(m,o)<=0?m:o,this.queue.delete(i.rightSE),s.push(i.rightSE);const L=i.split(P);for(let D=0,F=L.length;D<F;D++)s.push(L[D])}s.length>0?(this.tree.delete(i),s.push(e)):(this.segments.push(i),i.prev=h)}else{if(h&&x){const m=h.getIntersection(x);if(m!==null){if(!h.isAnEndpoint(m)){const o=this._splitSafely(h,m);for(let P=0,L=o.length;P<L;P++)s.push(o[P])}if(!x.isAnEndpoint(m)){const o=this._splitSafely(x,m);for(let P=0,L=o.length;P<L;P++)s.push(o[P])}}}this.tree.delete(i)}return s}_splitSafely(e,i){this.tree.delete(e);const s=e.rightSE;this.queue.delete(s);const h=e.split(i);return h.push(s),e.consumedBy===void 0&&this.tree.add(e),h}},iM=class{constructor(){Si(this,"type"),Si(this,"numMultiPolys")}run(e,i,s){Md.type=e;const h=[new Ix(i,!0)];for(let L=0,D=s.length;L<D;L++)h.push(new Ix(s[L],!1));if(Md.numMultiPolys=h.length,Md.type==="difference"){const L=h[0];let D=1;for(;D<h.length;)Cy(h[D].bbox,L.bbox)!==null?D++:h.splice(D,1)}if(Md.type==="intersection")for(let L=0,D=h.length;L<D;L++){const F=h[L];for(let Y=L+1,V=h.length;Y<V;Y++)if(Cy(F.bbox,h[Y].bbox)===null)return[]}const x=new Hf(il.compare);for(let L=0,D=h.length;L<D;L++){const F=h[L].getSweepEvents();for(let Y=0,V=F.length;Y<V;Y++)x.add(F[Y])}const m=new tM(x);let o=null;for(x.size!=0&&(o=x.first(),x.delete(o));o;){const L=m.process(o);for(let D=0,F=L.length;D<F;D++){const Y=L[D];Y.consumedBy===void 0&&x.add(Y)}x.size!=0?(o=x.first(),x.delete(o)):o=null}$l.reset();const P=QS.factory(m.segments);return new eM(P).getGeom()}},Md=new iM,Jf=Md,rM=0,Qf=class Bf{constructor(e,i,s,h){Si(this,"id"),Si(this,"leftSE"),Si(this,"rightSE"),Si(this,"rings"),Si(this,"windings"),Si(this,"ringOut"),Si(this,"consumedBy"),Si(this,"prev"),Si(this,"_prevInResult"),Si(this,"_beforeState"),Si(this,"_afterState"),Si(this,"_isInResult"),this.id=++rM,this.leftSE=e,e.segment=this,e.otherSE=i,this.rightSE=i,i.segment=this,i.otherSE=e,this.rings=s,this.windings=h}static compare(e,i){const s=e.leftSE.point.x,h=i.leftSE.point.x,x=e.rightSE.point.x,m=i.rightSE.point.x;if(m.isLessThan(s))return 1;if(x.isLessThan(h))return-1;const o=e.leftSE.point.y,P=i.leftSE.point.y,L=e.rightSE.point.y,D=i.rightSE.point.y;if(s.isLessThan(h)){if(P.isLessThan(o)&&P.isLessThan(L))return 1;if(P.isGreaterThan(o)&&P.isGreaterThan(L))return-1;const F=e.comparePoint(i.leftSE.point);if(F<0)return 1;if(F>0)return-1;const Y=i.comparePoint(e.rightSE.point);return Y!==0?Y:-1}if(s.isGreaterThan(h)){if(o.isLessThan(P)&&o.isLessThan(D))return-1;if(o.isGreaterThan(P)&&o.isGreaterThan(D))return 1;const F=i.comparePoint(e.leftSE.point);if(F!==0)return F;const Y=e.comparePoint(i.rightSE.point);return Y<0?1:Y>0?-1:1}if(o.isLessThan(P))return-1;if(o.isGreaterThan(P))return 1;if(x.isLessThan(m)){const F=i.comparePoint(e.rightSE.point);if(F!==0)return F}if(x.isGreaterThan(m)){const F=e.comparePoint(i.rightSE.point);if(F<0)return 1;if(F>0)return-1}if(!x.eq(m)){const F=L.minus(o),Y=x.minus(s),V=D.minus(P),H=m.minus(h);if(F.isGreaterThan(Y)&&V.isLessThan(H))return 1;if(F.isLessThan(Y)&&V.isGreaterThan(H))return-1}return x.isGreaterThan(m)?1:x.isLessThan(m)||L.isLessThan(D)?-1:L.isGreaterThan(D)?1:e.id<i.id?-1:e.id>i.id?1:0}static fromRing(e,i,s){let h,x,m;const o=il.comparePoints(e,i);if(o<0)h=e,x=i,m=1;else if(o>0)h=i,x=e,m=-1;else throw new Error(`Tried to create degenerate segment at [${e.x}, ${e.y}]`);const P=new il(h,!0),L=new il(x,!1);return new Bf(P,L,[s],[m])}replaceRightSE(e){this.rightSE=e,this.rightSE.segment=this,this.rightSE.otherSE=this.leftSE,this.leftSE.otherSE=this.rightSE}bbox(){const e=this.leftSE.point.y,i=this.rightSE.point.y;return{ll:{x:this.leftSE.point.x,y:e.isLessThan(i)?e:i},ur:{x:this.rightSE.point.x,y:e.isGreaterThan(i)?e:i}}}vector(){return{x:this.rightSE.point.x.minus(this.leftSE.point.x),y:this.rightSE.point.y.minus(this.leftSE.point.y)}}isAnEndpoint(e){return e.x.eq(this.leftSE.point.x)&&e.y.eq(this.leftSE.point.y)||e.x.eq(this.rightSE.point.x)&&e.y.eq(this.rightSE.point.y)}comparePoint(e){return $l.orient(this.leftSE.point,e,this.rightSE.point)}getIntersection(e){const i=this.bbox(),s=e.bbox(),h=Cy(i,s);if(h===null)return null;const x=this.leftSE.point,m=this.rightSE.point,o=e.leftSE.point,P=e.rightSE.point,L=vd(i,o)&&this.comparePoint(o)===0,D=vd(s,x)&&e.comparePoint(x)===0,F=vd(i,P)&&this.comparePoint(P)===0,Y=vd(s,m)&&e.comparePoint(m)===0;if(D&&L)return Y&&!F?m:!Y&&F?P:null;if(D)return F&&x.x.eq(P.x)&&x.y.eq(P.y)?null:x;if(L)return Y&&m.x.eq(o.x)&&m.y.eq(o.y)?null:o;if(Y&&F)return null;if(Y)return m;if(F)return P;const V=JS(x,this.vector(),o,e.vector());return V===null||!vd(h,V)?null:$l.snap(V)}split(e){const i=[],s=e.events!==void 0,h=new il(e,!0),x=new il(e,!1),m=this.rightSE;this.replaceRightSE(x),i.push(x),i.push(h);const o=new Bf(h,m,this.rings.slice(),this.windings.slice());return il.comparePoints(o.leftSE.point,o.rightSE.point)>0&&o.swapEvents(),il.comparePoints(this.leftSE.point,this.rightSE.point)>0&&this.swapEvents(),s&&(h.checkForConsuming(),x.checkForConsuming()),i}swapEvents(){const e=this.rightSE;this.rightSE=this.leftSE,this.leftSE=e,this.leftSE.isLeft=!0,this.rightSE.isLeft=!1;for(let i=0,s=this.windings.length;i<s;i++)this.windings[i]*=-1}consume(e){let i=this,s=e;for(;i.consumedBy;)i=i.consumedBy;for(;s.consumedBy;)s=s.consumedBy;const h=Bf.compare(i,s);if(h!==0){if(h>0){const x=i;i=s,s=x}if(i.prev===s){const x=i;i=s,s=x}for(let x=0,m=s.rings.length;x<m;x++){const o=s.rings[x],P=s.windings[x],L=i.rings.indexOf(o);L===-1?(i.rings.push(o),i.windings.push(P)):i.windings[L]+=P}s.rings=null,s.windings=null,s.consumedBy=i,s.leftSE.consumedBy=i.leftSE,s.rightSE.consumedBy=i.rightSE}}prevInResult(){return this._prevInResult!==void 0?this._prevInResult:(this.prev?this.prev.isInResult()?this._prevInResult=this.prev:this._prevInResult=this.prev.prevInResult():this._prevInResult=null,this._prevInResult)}beforeState(){if(this._beforeState!==void 0)return this._beforeState;if(!this.prev)this._beforeState={rings:[],windings:[],multiPolys:[]};else{const e=this.prev.consumedBy||this.prev;this._beforeState=e.afterState()}return this._beforeState}afterState(){if(this._afterState!==void 0)return this._afterState;const e=this.beforeState();this._afterState={rings:e.rings.slice(0),windings:e.windings.slice(0),multiPolys:[]};const i=this._afterState.rings,s=this._afterState.windings,h=this._afterState.multiPolys;for(let o=0,P=this.rings.length;o<P;o++){const L=this.rings[o],D=this.windings[o],F=i.indexOf(L);F===-1?(i.push(L),s.push(D)):s[F]+=D}const x=[],m=[];for(let o=0,P=i.length;o<P;o++){if(s[o]===0)continue;const L=i[o],D=L.poly;if(m.indexOf(D)===-1)if(L.isExterior)x.push(D);else{m.indexOf(D)===-1&&m.push(D);const F=x.indexOf(L.poly);F!==-1&&x.splice(F,1)}}for(let o=0,P=x.length;o<P;o++){const L=x[o].multiPoly;h.indexOf(L)===-1&&h.push(L)}return this._afterState}isInResult(){if(this.consumedBy)return!1;if(this._isInResult!==void 0)return this._isInResult;const e=this.beforeState().multiPolys,i=this.afterState().multiPolys;switch(Jf.type){case"union":{const s=e.length===0,h=i.length===0;this._isInResult=s!==h;break}case"intersection":{let s,h;e.length<i.length?(s=e.length,h=i.length):(s=i.length,h=e.length),this._isInResult=h===Jf.numMultiPolys&&s<h;break}case"xor":{const s=Math.abs(e.length-i.length);this._isInResult=s%2===1;break}case"difference":{const s=h=>h.length===1&&h[0].isSubject;this._isInResult=s(e)!==s(i);break}}return this._isInResult}},Ex=class{constructor(e,i,s){if(Si(this,"poly"),Si(this,"isExterior"),Si(this,"segments"),Si(this,"bbox"),!Array.isArray(e)||e.length===0)throw new Error("Input geometry is not a valid Polygon or MultiPolygon");if(this.poly=i,this.isExterior=s,this.segments=[],typeof e[0][0]!="number"||typeof e[0][1]!="number")throw new Error("Input geometry is not a valid Polygon or MultiPolygon");const h=$l.snap({x:new sl(e[0][0]),y:new sl(e[0][1])});this.bbox={ll:{x:h.x,y:h.y},ur:{x:h.x,y:h.y}};let x=h;for(let m=1,o=e.length;m<o;m++){if(typeof e[m][0]!="number"||typeof e[m][1]!="number")throw new Error("Input geometry is not a valid Polygon or MultiPolygon");const P=$l.snap({x:new sl(e[m][0]),y:new sl(e[m][1])});P.x.eq(x.x)&&P.y.eq(x.y)||(this.segments.push(Qf.fromRing(x,P,this)),P.x.isLessThan(this.bbox.ll.x)&&(this.bbox.ll.x=P.x),P.y.isLessThan(this.bbox.ll.y)&&(this.bbox.ll.y=P.y),P.x.isGreaterThan(this.bbox.ur.x)&&(this.bbox.ur.x=P.x),P.y.isGreaterThan(this.bbox.ur.y)&&(this.bbox.ur.y=P.y),x=P)}(!h.x.eq(x.x)||!h.y.eq(x.y))&&this.segments.push(Qf.fromRing(x,h,this))}getSweepEvents(){const e=[];for(let i=0,s=this.segments.length;i<s;i++){const h=this.segments[i];e.push(h.leftSE),e.push(h.rightSE)}return e}},nM=class{constructor(e,i){if(Si(this,"multiPoly"),Si(this,"exteriorRing"),Si(this,"interiorRings"),Si(this,"bbox"),!Array.isArray(e))throw new Error("Input geometry is not a valid Polygon or MultiPolygon");this.exteriorRing=new Ex(e[0],this,!0),this.bbox={ll:{x:this.exteriorRing.bbox.ll.x,y:this.exteriorRing.bbox.ll.y},ur:{x:this.exteriorRing.bbox.ur.x,y:this.exteriorRing.bbox.ur.y}},this.interiorRings=[];for(let s=1,h=e.length;s<h;s++){const x=new Ex(e[s],this,!1);x.bbox.ll.x.isLessThan(this.bbox.ll.x)&&(this.bbox.ll.x=x.bbox.ll.x),x.bbox.ll.y.isLessThan(this.bbox.ll.y)&&(this.bbox.ll.y=x.bbox.ll.y),x.bbox.ur.x.isGreaterThan(this.bbox.ur.x)&&(this.bbox.ur.x=x.bbox.ur.x),x.bbox.ur.y.isGreaterThan(this.bbox.ur.y)&&(this.bbox.ur.y=x.bbox.ur.y),this.interiorRings.push(x)}this.multiPoly=i}getSweepEvents(){const e=this.exteriorRing.getSweepEvents();for(let i=0,s=this.interiorRings.length;i<s;i++){const h=this.interiorRings[i].getSweepEvents();for(let x=0,m=h.length;x<m;x++)e.push(h[x])}return e}},Ix=class{constructor(e,i){if(Si(this,"isSubject"),Si(this,"polys"),Si(this,"bbox"),!Array.isArray(e))throw new Error("Input geometry is not a valid Polygon or MultiPolygon");try{typeof e[0][0][0]=="number"&&(e=[e])}catch{}this.polys=[],this.bbox={ll:{x:new sl(Number.POSITIVE_INFINITY),y:new sl(Number.POSITIVE_INFINITY)},ur:{x:new sl(Number.NEGATIVE_INFINITY),y:new sl(Number.NEGATIVE_INFINITY)}};for(let s=0,h=e.length;s<h;s++){const x=new nM(e[s],this);x.bbox.ll.x.isLessThan(this.bbox.ll.x)&&(this.bbox.ll.x=x.bbox.ll.x),x.bbox.ll.y.isLessThan(this.bbox.ll.y)&&(this.bbox.ll.y=x.bbox.ll.y),x.bbox.ur.x.isGreaterThan(this.bbox.ur.x)&&(this.bbox.ur.x=x.bbox.ur.x),x.bbox.ur.y.isGreaterThan(this.bbox.ur.y)&&(this.bbox.ur.y=x.bbox.ur.y),this.polys.push(x)}this.isSubject=i}getSweepEvents(){const e=[];for(let i=0,s=this.polys.length;i<s;i++){const h=this.polys[i].getSweepEvents();for(let x=0,m=h.length;x<m;x++)e.push(h[x])}return e}},sM=(r,...e)=>Jf.run("union",r,e),oM=(r,...e)=>Jf.run("difference",r,e);$l.set;function mb(r,e,i){if(r!==null)for(var s,h,x,m,o,P,L,D=0,F=0,Y,V=r.type,H=V==="FeatureCollection",ve=V==="Feature",_e=H?r.features.length:1,oe=0;oe<_e;oe++){L=H?r.features[oe].geometry:ve?r.geometry:r,Y=L?L.type==="GeometryCollection":!1,o=Y?L.geometries.length:1;for(var fe=0;fe<o;fe++){var K=0,ne=0;if(m=Y?L.geometries[fe]:L,m!==null){P=m.coordinates;var ye=m.type;switch(D=0,ye){case null:break;case"Point":if(e(P,F,oe,K,ne)===!1)return!1;F++,K++;break;case"LineString":case"MultiPoint":for(s=0;s<P.length;s++){if(e(P[s],F,oe,K,ne)===!1)return!1;F++,ye==="MultiPoint"&&K++}ye==="LineString"&&K++;break;case"Polygon":case"MultiLineString":for(s=0;s<P.length;s++){for(h=0;h<P[s].length-D;h++){if(e(P[s][h],F,oe,K,ne)===!1)return!1;F++}ye==="MultiLineString"&&K++,ye==="Polygon"&&ne++}ye==="Polygon"&&K++;break;case"MultiPolygon":for(s=0;s<P.length;s++){for(ne=0,h=0;h<P[s].length;h++){for(x=0;x<P[s][h].length-D;x++){if(e(P[s][h][x],F,oe,K,ne)===!1)return!1;F++}ne++}K++}break;case"GeometryCollection":for(s=0;s<m.geometries.length;s++)if(mb(m.geometries[s],e)===!1)return!1;break;default:throw new Error("Unknown Geometry Type")}}}}}function d_(r,e){var i,s,h,x,m,o,P,L,D,F,Y=0,V=r.type==="FeatureCollection",H=r.type==="Feature",ve=V?r.features.length:1;for(i=0;i<ve;i++){for(o=V?r.features[i].geometry:H?r.geometry:r,L=V?r.features[i].properties:H?r.properties:{},D=V?r.features[i].bbox:H?r.bbox:void 0,F=V?r.features[i].id:H?r.id:void 0,P=o?o.type==="GeometryCollection":!1,m=P?o.geometries.length:1,h=0;h<m;h++){if(x=P?o.geometries[h]:o,x===null){if(e(null,Y,L,D,F)===!1)return!1;continue}switch(x.type){case"Point":case"LineString":case"MultiPoint":case"Polygon":case"MultiLineString":case"MultiPolygon":{if(e(x,Y,L,D,F)===!1)return!1;break}case"GeometryCollection":{for(s=0;s<x.geometries.length;s++)if(e(x.geometries[s],Y,L,D,F)===!1)return!1;break}default:throw new Error("Unknown Geometry Type")}}Y++}}function aM(r,e){d_(r,function(i,s,h,x,m){var o=i===null?null:i.type;switch(o){case null:case"Point":case"LineString":case"Polygon":return e($d(i,h,{bbox:x,id:m}),s,0)===!1?!1:void 0}var P;switch(o){case"MultiPoint":P="Point";break;case"MultiLineString":P="LineString";break;case"MultiPolygon":P="Polygon";break}for(var L=0;L<i.coordinates.length;L++){var D=i.coordinates[L],F={type:P,coordinates:D};if(e($d(F,h),s,L)===!1)return!1}})}function lM(r,e={}){const i=[];if(d_(r,h=>{i.push(h.coordinates)}),i.length<2)throw new Error("Must have at least 2 geometries");const s=sM(i[0],...i.slice(1));return s.length===0?null:s.length===1?h_(s[0],e.properties):ub(s,e.properties)}var gb=lM;function uM(r,e={}){if(r.bbox!=null&&e.recompute!==!0)return r.bbox;const i=[1/0,1/0,-1/0,-1/0];return mb(r,s=>{i[0]>s[0]&&(i[0]=s[0]),i[1]>s[1]&&(i[1]=s[1]),i[2]<s[0]&&(i[2]=s[0]),i[3]<s[1]&&(i[3]=s[1])}),i}var Sx=uM;function cM(r){const e=[];if(d_(r,h=>{e.push(h.coordinates)}),e.length<2)throw new Error("Must have at least two features");const i=r.features[0].properties||{},s=oM(e[0],...e.slice(1));return s.length===0?null:s.length===1?h_(s[0],i):ub(s,i)}var hM=cM;function dM(r){if(!r)throw new Error("geojson is required");var e=[];return aM(r,function(i){e.push(i)}),jd(e)}var pM=dM;function Mx(r,e){const i=hM(jd([h_([[[180,90],[-180,90],[-180,-90],[180,-90],[180,90]]]),r]));if(!i)return;i.properties={isMask:!0};const s=Xf(Sx(r)),h=(s[2]-s[0])/360/1e3,x=s[0]<-180,m=s[2]>180,o=pM(r);if(o.features.length>1&&(x||m))for(const P of o.features){const L=Xf(Sx(P));if(m&&L[0]<-180+h)for(const D of P.geometry.coordinates)for(const F of D)F[0]+=360-h;if(x&&L[2]>180-h)for(const D of P.geometry.coordinates)for(const F of D)F[0]-=360-h}e(jd([o.features.length<2?r:gb(o)??r,i]))}const Px={fill:{paint:{"fill-color":"#000","fill-opacity":.1},filter:["all",["==",["geometry-type"],"Polygon"],["has","isMask"]]},line:{layout:{"line-cap":"square"},paint:{"line-width":["case",["==",["geometry-type"],"Polygon"],2,3],"line-dasharray":[1,1],"line-color":"#3170fe"},filter:["!",["has","isMask"]]}},uf="mtlr-gc-full-geom",kx="mtlr-gc-full-geom-fill",Cx="mtlr-gc-full-geom-line";function fM(r,e,i=!0,s=!0,h={},x={},m=Px){let o;const P=[];let L,D,F;function Y(){if(!r.loaded){r.once("load",Y);return}const _e=m?m===!0?Px:m:void 0;if(!(_e!=null&&_e.fill)&&!(_e!=null&&_e.line))return;const oe=r.getSource(uf);if(oe)oe.setData(F??jd([]));else if(F)r.addSource(uf,{type:"geojson",data:F});else return;!r.getLayer(kx)&&_e!=null&&_e.fill&&r.addLayer({..._e?.fill,id:kx,type:"fill",source:uf}),!r.getLayer(Cx)&&_e!=null&&_e.line&&r.addLayer({..._e?.line,id:Cx,type:"line",source:uf})}function V(_e){F=_e,Y()}r.on("styledata",()=>{setTimeout(()=>{F&&Y()})});const H=_e=>{o?.({type:"mapClick",coordinates:[_e.lngLat.lng,_e.lngLat.lat]})};function ve(_e=!1){if(!e)throw new Error;const oe=document.createElement("div");return _e&&oe.classList.add("marker-interactive"),new yS({props:{displayIn:"maplibre"},target:oe}),new e.Marker({element:oe,offset:[1,-13]})}return{setEventHandler(_e){_e?(o=_e,r.on("click",H)):(o=void 0,r.off("click",H))},flyTo(_e,oe){r.flyTo({center:_e,...oe?{zoom:oe}:{},...h})},fitBounds(_e,oe,fe){r.fitBounds([[_e[0],_e[1]],[_e[2],_e[3]]],{padding:oe,...fe?{maxZoom:fe}:{},...x})},indicateReverse(_e){r.getCanvasContainer().style.cursor=_e?"crosshair":""},setReverseMarker(_e){!e||!i||(D?_e?D.setLngLat(_e):(D.remove(),D=void 0):_e&&(i instanceof Function?D=i(r)??void 0:(D=(typeof i=="object"?new e.Marker(i):ve()).setLngLat(_e).addTo(r),D.getElement().classList.add("marker-reverse"))))},setFeatures(_e,oe,fe){for(const K of P)K.remove();if(P.length=0,V(void 0),!!e){e:if(oe){let K=!1;if(oe.geometry.type==="GeometryCollection"){const ne=oe.geometry.geometries.filter(ye=>ye.type==="Polygon"||ye.type==="MultiPolygon");t:if(ne.length>0){const ye=gb(jd(ne.map(Re=>$d(Re))));if(!ye)break t;Mx({...oe,geometry:ye.geometry},V),K=!0}else{const ye=oe.geometry.geometries.filter(Re=>Re.type==="LineString"||Re.type==="MultiLineString");ye.length>0&&(V({...oe,geometry:{type:"GeometryCollection",geometries:ye}}),K=!0)}}if(!K){if(oe.geometry.type==="Polygon"||oe.geometry.type==="MultiPolygon")Mx(oe,V);else if(oe.geometry.type==="LineString"||oe.geometry.type==="MultiLineString"){V(oe);break e}}if(!fe&&!oe.geometry.type.endsWith("Point"))break e;if(i instanceof Function){const ne=i(r,oe);ne&&P.push(ne)}else i&&P.push(typeof i=="object"?new e.Marker(i):ve().setLngLat(oe.center).addTo(r))}if(s)for(const K of _e??[]){if(K===oe)continue;let ne;if(s instanceof Function){if(ne=s(r,K),!ne)continue}else ne=(typeof s=="object"?new e.Marker(s):ve(!0)).setLngLat(K.center).setPopup(new e.Popup({offset:[1,-27],closeButton:!1,closeOnMove:!0,className:"maptiler-gc-popup"}).setText(K.place_type[0]==="reverse"?K.place_name:K.place_name.replace(/,.*/,""))).addTo(r);const ye=ne.getElement();ye.addEventListener("click",Re=>{Re.stopPropagation(),o?.({type:"markerClick",id:K.id})}),ye.addEventListener("mouseenter",()=>{o?.({type:"markerMouseEnter",id:K.id}),ne.togglePopup()}),ye.addEventListener("mouseleave",()=>{o?.({type:"markerMouseLeave",id:K.id}),ne.togglePopup()}),P.push(ne)}}},setSelectedMarker(_e){L&&L.getElement().classList.toggle("marker-selected",!1),L=_e>-1?P[_e]:void 0,L?.getElement().classList.toggle("marker-selected",!0)},getCenterAndZoom(){const _e=r.getCenter();return[r.getZoom(),_e.lng,_e.lat]}}}function mM(r,e,i){var s,h,x;class m{constructor(oe,fe){Si(this,"type"),Si(this,"target"),this.type=fe,this.target=oe}}class o extends m{constructor(oe,fe){super(oe,"select"),Si(this,"feature"),Object.assign(this,fe)}}class P extends m{constructor(oe,fe){super(oe,"featureslisted"),Si(this,"features"),this.features=fe}}class L extends m{constructor(oe,fe){super(oe,"featuresmarked"),Si(this,"features"),this.features=fe}}class D extends m{constructor(oe,fe){super(oe,"optionsvisibilitychange"),Si(this,"optionsVisible"),this.optionsVisible=fe}}class F extends m{constructor(oe,fe){super(oe,"pick"),Si(this,"feature"),this.feature=fe}}class Y extends m{constructor(oe,fe){super(oe,"querychange"),Si(this,"query"),this.query=fe}}class V extends m{constructor(oe,fe,K){super(oe,"response"),Si(this,"url"),Si(this,"featureCollection"),this.url=fe,this.featureCollection=K}}class H extends m{constructor(oe,fe){super(oe,"reversetoggle"),Si(this,"reverse"),this.reverse=fe}}class ve extends r{constructor(oe={}){super(),Hg(this,s),Hg(this,h),Hg(this,x),sf(this,h,oe)}onAddInt(oe){const fe=document.createElement("div");fe.className="mapboxgl-ctrl-geocoder mapboxgl-ctrl maplibregl-ctrl-geocoder maplibregl-ctrl mapboxgl-ctrl-group";const{marker:K,showResultMarkers:ne,flyTo:ye,fullGeometryStyle:Re,...Se}=Wn(this,h),Z=typeof ye=="boolean"?{}:ye,$={mapController:fM(oe,e,K,ne,Z,Z,Re),flyTo:ye===void 0?!0:!!ye,apiKey:"",...Se};return $.apiKey||console.warn("No MapTiler Cloud API key was provided, some or all geocoding requests may fail"),sf(this,s,new jS({target:fe,props:$})),Wn(this,s).$on("select",Q=>{this.fire(new o(this,Q.detail))}),Wn(this,s).$on("pick",Q=>{this.fire(new F(this,Q.detail.feature))}),Wn(this,s).$on("featureslisted",Q=>{this.fire(new P(this,Q.detail.features))}),Wn(this,s).$on("featuresmarked",Q=>{this.fire(new L(this,Q.detail.features))}),Wn(this,s).$on("response",Q=>{this.fire(new V(this,Q.detail.url,Q.detail.featureCollection))}),Wn(this,s).$on("optionsvisibilitychange",Q=>{this.fire(new D(this,Q.detail.optionsVisible))}),Wn(this,s).$on("reversetoggle",Q=>{this.fire(new H(this,Q.detail.reverse))}),Wn(this,s).$on("querychange",Q=>{this.fire(new Y(this,Q.detail.query))}),sf(this,x,fe),fe}on(oe,fe){return super.on(oe,fe)}once(oe,fe){return super.once(oe,fe)}off(oe,fe){return super.off(oe,fe)}listens(oe){return super.listens(oe)}setOptions(oe){var fe;Object.assign(Wn(this,h),oe);const{marker:K,showResultMarkers:ne,flyTo:ye,fullGeometryStyle:Re,...Se}=Wn(this,h);(fe=Wn(this,s))==null||fe.$set(Se)}setQuery(oe,fe=!0){var K;(K=Wn(this,s))==null||K.setQuery(oe,fe)}clearMap(){var oe;(oe=Wn(this,s))==null||oe.clearMap()}clearList(){var oe;(oe=Wn(this,s))==null||oe.clearList()}setReverseMode(oe){var fe;(fe=Wn(this,s))==null||fe.$set({reverseActive:oe})}focus(oe){var fe;(fe=Wn(this,s))==null||fe.focus(oe)}blur(){var oe;(oe=Wn(this,s))==null||oe.blur()}onRemove(){var oe,fe,K;(oe=Wn(this,s))==null||oe.$destroy(),sf(this,s,void 0),(K=(fe=Wn(this,x))==null?void 0:fe.parentNode)==null||K.removeChild(Wn(this,x))}}return s=new WeakMap,h=new WeakMap,x=new WeakMap,{MapLibreBasedGeocodingControl:ve,events:{SelectEvent:o,FeaturesListedEvent:P,FeaturesMarkedEvent:L,OptionsVisibilityChangeEvent:D,PickEvent:F,QueryChangeEvent:Y,ResponseEvent:V,ReverseToggleEvent:H}}}const{MapLibreBasedGeocodingControl:gM}=mM(Am.Evented,K1);let yM=class extends gM{onAdd(e){return super.onAddInt(e)}};Di.forwardRef(({position:r,...e},i)=>{const s=Vl(()=>{const h=new yM({...e,maplibregl:u_});return h.on("pick",e.onSelection),h},{position:r});return Di.useImperativeHandle(i,()=>s,[s]),null});var _M={color:void 0,size:void 0,className:void 0,style:void 0,attr:void 0};by.createContext;var yb="1.13.7",Ax=typeof self=="object"&&self.self===self&&self||typeof global=="object"&&global.global===global&&global||Function("return this")()||{},Lm=Array.prototype,p_=Object.prototype,Lx=typeof Symbol<"u"?Symbol.prototype:null,vM=Lm.push,up=Lm.slice,Gd=p_.toString,xM=p_.hasOwnProperty,_b=typeof ArrayBuffer<"u",bM=typeof DataView<"u",wM=Array.isArray,Rx=Object.keys,Nx=Object.create,Ox=_b&&ArrayBuffer.isView,TM=isNaN,EM=isFinite,vb=!{toString:null}.propertyIsEnumerable("toString"),Dx=["valueOf","isPrototypeOf","toString","propertyIsEnumerable","hasOwnProperty","toLocaleString"],IM=Math.pow(2,53)-1;function Io(r,e){return e=e==null?r.length-1:+e,function(){for(var i=Math.max(arguments.length-e,0),s=Array(i),h=0;h<i;h++)s[h]=arguments[h+e];switch(e){case 0:return r.call(this,s);case 1:return r.call(this,arguments[0],s);case 2:return r.call(this,arguments[0],arguments[1],s)}var x=Array(e+1);for(h=0;h<e;h++)x[h]=arguments[h];return x[e]=s,r.apply(this,x)}}function vc(r){var e=typeof r;return e==="function"||e==="object"&&!!r}function SM(r){return r===null}function xb(r){return r===void 0}function bb(r){return r===!0||r===!1||Gd.call(r)==="[object Boolean]"}function MM(r){return!!(r&&r.nodeType===1)}function Js(r){var e="[object "+r+"]";return function(i){return Gd.call(i)===e}}const f_=Js("String"),wb=Js("Number"),PM=Js("Date"),kM=Js("RegExp"),CM=Js("Error"),Tb=Js("Symbol"),Eb=Js("ArrayBuffer");var Ib=Js("Function"),AM=Ax.document&&Ax.document.childNodes;typeof/./!="function"&&typeof Int8Array!="object"&&typeof AM!="function"&&(Ib=function(r){return typeof r=="function"||!1});const uo=Ib,Sb=Js("Object");var Mb=bM&&(!/\[native code\]/.test(String(DataView))||Sb(new DataView(new ArrayBuffer(8)))),m_=typeof Map<"u"&&Sb(new Map),LM=Js("DataView");function RM(r){return r!=null&&uo(r.getInt8)&&Eb(r.buffer)}const em=Mb?RM:LM,xc=wM||Js("Array");function Ou(r,e){return r!=null&&xM.call(r,e)}var Ly=Js("Arguments");(function(){Ly(arguments)||(Ly=function(r){return Ou(r,"callee")})})();const g_=Ly;function NM(r){return!Tb(r)&&EM(r)&&!isNaN(parseFloat(r))}function Pb(r){return wb(r)&&TM(r)}function kb(r){return function(){return r}}function Cb(r){return function(e){var i=r(e);return typeof i=="number"&&i>=0&&i<=IM}}function Ab(r){return function(e){return e?.[r]}}const tm=Ab("byteLength"),OM=Cb(tm);var DM=/\[object ((I|Ui)nt(8|16|32)|Float(32|64)|Uint8Clamped|Big(I|Ui)nt64)Array\]/;function FM(r){return Ox?Ox(r)&&!em(r):OM(r)&&DM.test(Gd.call(r))}const Lb=_b?FM:kb(!1),So=Ab("length");function zM(r){for(var e={},i=r.length,s=0;s<i;++s)e[r[s]]=!0;return{contains:function(h){return e[h]===!0},push:function(h){return e[h]=!0,r.push(h)}}}function Rb(r,e){e=zM(e);var i=Dx.length,s=r.constructor,h=uo(s)&&s.prototype||p_,x="constructor";for(Ou(r,x)&&!e.contains(x)&&e.push(x);i--;)x=Dx[i],x in r&&r[x]!==h[x]&&!e.contains(x)&&e.push(x)}function Ms(r){if(!vc(r))return[];if(Rx)return Rx(r);var e=[];for(var i in r)Ou(r,i)&&e.push(i);return vb&&Rb(r,e),e}function BM(r){if(r==null)return!0;var e=So(r);return typeof e=="number"&&(xc(r)||f_(r)||g_(r))?e===0:So(Ms(r))===0}function Nb(r,e){var i=Ms(e),s=i.length;if(r==null)return!s;for(var h=Object(r),x=0;x<s;x++){var m=i[x];if(e[m]!==h[m]||!(m in h))return!1}return!0}function Vr(r){if(r instanceof Vr)return r;if(!(this instanceof Vr))return new Vr(r);this._wrapped=r}Vr.VERSION=yb;Vr.prototype.value=function(){return this._wrapped};Vr.prototype.valueOf=Vr.prototype.toJSON=Vr.prototype.value;Vr.prototype.toString=function(){return String(this._wrapped)};function Fx(r){return new Uint8Array(r.buffer||r,r.byteOffset||0,tm(r))}var zx="[object DataView]";function Ry(r,e,i,s){if(r===e)return r!==0||1/r===1/e;if(r==null||e==null)return!1;if(r!==r)return e!==e;var h=typeof r;return h!=="function"&&h!=="object"&&typeof e!="object"?!1:Ob(r,e,i,s)}function Ob(r,e,i,s){r instanceof Vr&&(r=r._wrapped),e instanceof Vr&&(e=e._wrapped);var h=Gd.call(r);if(h!==Gd.call(e))return!1;if(Mb&&h=="[object Object]"&&em(r)){if(!em(e))return!1;h=zx}switch(h){case"[object RegExp]":case"[object String]":return""+r==""+e;case"[object Number]":return+r!=+r?+e!=+e:+r==0?1/+r===1/e:+r==+e;case"[object Date]":case"[object Boolean]":return+r==+e;case"[object Symbol]":return Lx.valueOf.call(r)===Lx.valueOf.call(e);case"[object ArrayBuffer]":case zx:return Ob(Fx(r),Fx(e),i,s)}var x=h==="[object Array]";if(!x&&Lb(r)){var m=tm(r);if(m!==tm(e))return!1;if(r.buffer===e.buffer&&r.byteOffset===e.byteOffset)return!0;x=!0}if(!x){if(typeof r!="object"||typeof e!="object")return!1;var o=r.constructor,P=e.constructor;if(o!==P&&!(uo(o)&&o instanceof o&&uo(P)&&P instanceof P)&&"constructor"in r&&"constructor"in e)return!1}i=i||[],s=s||[];for(var L=i.length;L--;)if(i[L]===r)return s[L]===e;if(i.push(r),s.push(e),x){if(L=r.length,L!==e.length)return!1;for(;L--;)if(!Ry(r[L],e[L],i,s))return!1}else{var D=Ms(r),F;if(L=D.length,Ms(e).length!==L)return!1;for(;L--;)if(F=D[L],!(Ou(e,F)&&Ry(r[F],e[F],i,s)))return!1}return i.pop(),s.pop(),!0}function $M(r,e){return Ry(r,e)}function cp(r){if(!vc(r))return[];var e=[];for(var i in r)e.push(i);return vb&&Rb(r,e),e}function y_(r){var e=So(r);return function(i){if(i==null)return!1;var s=cp(i);if(So(s))return!1;for(var h=0;h<e;h++)if(!uo(i[r[h]]))return!1;return r!==zb||!uo(i[__])}}var __="forEach",Db="has",v_=["clear","delete"],Fb=["get",Db,"set"],jM=v_.concat(__,Fb),zb=v_.concat(Fb),GM=["add"].concat(v_,__,Db);const UM=m_?y_(jM):Js("Map"),VM=m_?y_(zb):Js("WeakMap"),qM=m_?y_(GM):Js("Set"),ZM=Js("WeakSet");function Eh(r){for(var e=Ms(r),i=e.length,s=Array(i),h=0;h<i;h++)s[h]=r[e[h]];return s}function WM(r){for(var e=Ms(r),i=e.length,s=Array(i),h=0;h<i;h++)s[h]=[e[h],r[e[h]]];return s}function Bb(r){for(var e={},i=Ms(r),s=0,h=i.length;s<h;s++)e[r[i[s]]]=i[s];return e}function Ny(r){var e=[];for(var i in r)uo(r[i])&&e.push(i);return e.sort()}function x_(r,e){return function(i){var s=arguments.length;if(e&&(i=Object(i)),s<2||i==null)return i;for(var h=1;h<s;h++)for(var x=arguments[h],m=r(x),o=m.length,P=0;P<o;P++){var L=m[P];(!e||i[L]===void 0)&&(i[L]=x[L])}return i}}const $b=x_(cp),im=x_(Ms),jb=x_(cp,!0);function YM(){return function(){}}function Gb(r){if(!vc(r))return{};if(Nx)return Nx(r);var e=YM();e.prototype=r;var i=new e;return e.prototype=null,i}function XM(r,e){var i=Gb(r);return e&&im(i,e),i}function HM(r){return vc(r)?xc(r)?r.slice():$b({},r):r}function KM(r,e){return e(r),r}function Ub(r){return xc(r)?r:[r]}Vr.toPath=Ub;function hp(r){return Vr.toPath(r)}function b_(r,e){for(var i=e.length,s=0;s<i;s++){if(r==null)return;r=r[e[s]]}return i?r:void 0}function Vb(r,e,i){var s=b_(r,hp(e));return xb(s)?i:s}function JM(r,e){e=hp(e);for(var i=e.length,s=0;s<i;s++){var h=e[s];if(!Ou(r,h))return!1;r=r[h]}return!!i}function w_(r){return r}function Ud(r){return r=im({},r),function(e){return Nb(e,r)}}function T_(r){return r=hp(r),function(e){return b_(e,r)}}function dp(r,e,i){if(e===void 0)return r;switch(i??3){case 1:return function(s){return r.call(e,s)};case 3:return function(s,h,x){return r.call(e,s,h,x)};case 4:return function(s,h,x,m){return r.call(e,s,h,x,m)}}return function(){return r.apply(e,arguments)}}function qb(r,e,i){return r==null?w_:uo(r)?dp(r,e,i):vc(r)&&!xc(r)?Ud(r):T_(r)}function E_(r,e){return qb(r,e,1/0)}Vr.iteratee=E_;function Mo(r,e,i){return Vr.iteratee!==E_?Vr.iteratee(r,e):qb(r,e,i)}function QM(r,e,i){e=Mo(e,i);for(var s=Ms(r),h=s.length,x={},m=0;m<h;m++){var o=s[m];x[o]=e(r[o],o,r)}return x}function Zb(){}function eP(r){return r==null?Zb:function(e){return Vb(r,e)}}function tP(r,e,i){var s=Array(Math.max(0,r));e=dp(e,i,1);for(var h=0;h<r;h++)s[h]=e(h);return s}function Oy(r,e){return e==null&&(e=r,r=0),r+Math.floor(Math.random()*(e-r+1))}const Vd=Date.now||function(){return new Date().getTime()};function Wb(r){var e=function(x){return r[x]},i="(?:"+Ms(r).join("|")+")",s=RegExp(i),h=RegExp(i,"g");return function(x){return x=x==null?"":""+x,s.test(x)?x.replace(h,e):x}}const Yb={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;","`":"&#x60;"},iP=Wb(Yb),rP=Bb(Yb),nP=Wb(rP),sP=Vr.templateSettings={evaluate:/<%([\s\S]+?)%>/g,interpolate:/<%=([\s\S]+?)%>/g,escape:/<%-([\s\S]+?)%>/g};var ty=/(.)^/,oP={"'":"'","\\":"\\","\r":"r","\n":"n","\u2028":"u2028","\u2029":"u2029"},aP=/\\|'|\r|\n|\u2028|\u2029/g;function lP(r){return"\\"+oP[r]}var uP=/^\s*(\w|\$)+\s*$/;function cP(r,e,i){!e&&i&&(e=i),e=jb({},e,Vr.templateSettings);var s=RegExp([(e.escape||ty).source,(e.interpolate||ty).source,(e.evaluate||ty).source].join("|")+"|$","g"),h=0,x="__p+='";r.replace(s,function(L,D,F,Y,V){return x+=r.slice(h,V).replace(aP,lP),h=V+L.length,D?x+=`'+
((__t=(`+D+`))==null?'':_.escape(__t))+
'`:F?x+=`'+
((__t=(`+F+`))==null?'':__t)+
'`:Y&&(x+=`';
`+Y+`
__p+='`),L}),x+=`';
`;var m=e.variable;if(m){if(!uP.test(m))throw new Error("variable is not a bare identifier: "+m)}else x=`with(obj||{}){
`+x+`}
`,m="obj";x=`var __t,__p='',__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,'');};
`+x+`return __p;
`;var o;try{o=new Function(m,"_",x)}catch(L){throw L.source=x,L}var P=function(L){return o.call(this,L,Vr)};return P.source="function("+m+`){
`+x+"}",P}function hP(r,e,i){e=hp(e);var s=e.length;if(!s)return uo(i)?i.call(r):i;for(var h=0;h<s;h++){var x=r?.[e[h]];x===void 0&&(x=i,h=s),r=uo(x)?x.call(r):x}return r}var dP=0;function pP(r){var e=++dP+"";return r?r+e:e}function fP(r){var e=Vr(r);return e._chain=!0,e}function Xb(r,e,i,s,h){if(!(s instanceof e))return r.apply(i,h);var x=Gb(r.prototype),m=r.apply(x,h);return vc(m)?m:x}var Ih=Io(function(r,e){var i=Ih.placeholder,s=function(){for(var h=0,x=e.length,m=Array(x),o=0;o<x;o++)m[o]=e[o]===i?arguments[h++]:e[o];for(;h<arguments.length;)m.push(arguments[h++]);return Xb(r,s,this,this,m)};return s});Ih.placeholder=Vr;const Hb=Io(function(r,e,i){if(!uo(r))throw new TypeError("Bind must be called on a function");var s=Io(function(h){return Xb(r,s,e,this,i.concat(h))});return s}),Zo=Cb(So);function bc(r,e,i,s){if(s=s||[],!e&&e!==0)e=1/0;else if(e<=0)return s.concat(r);for(var h=s.length,x=0,m=So(r);x<m;x++){var o=r[x];if(Zo(o)&&(xc(o)||g_(o)))if(e>1)bc(o,e-1,i,s),h=s.length;else for(var P=0,L=o.length;P<L;)s[h++]=o[P++];else i||(s[h++]=o)}return s}const mP=Io(function(r,e){e=bc(e,!1,!1);var i=e.length;if(i<1)throw new Error("bindAll must be passed function names");for(;i--;){var s=e[i];r[s]=Hb(r[s],r)}return r});function gP(r,e){var i=function(s){var h=i.cache,x=""+(e?e.apply(this,arguments):s);return Ou(h,x)||(h[x]=r.apply(this,arguments)),h[x]};return i.cache={},i}const Kb=Io(function(r,e,i){return setTimeout(function(){return r.apply(null,i)},e)}),yP=Ih(Kb,Vr,1);function _P(r,e,i){var s,h,x,m,o=0;i||(i={});var P=function(){o=i.leading===!1?0:Vd(),s=null,m=r.apply(h,x),s||(h=x=null)},L=function(){var D=Vd();!o&&i.leading===!1&&(o=D);var F=e-(D-o);return h=this,x=arguments,F<=0||F>e?(s&&(clearTimeout(s),s=null),o=D,m=r.apply(h,x),s||(h=x=null)):!s&&i.trailing!==!1&&(s=setTimeout(P,F)),m};return L.cancel=function(){clearTimeout(s),o=0,s=h=x=null},L}function vP(r,e,i){var s,h,x,m,o,P=function(){var D=Vd()-h;e>D?s=setTimeout(P,e-D):(s=null,i||(m=r.apply(o,x)),s||(x=o=null))},L=Io(function(D){return o=this,x=D,h=Vd(),s||(s=setTimeout(P,e),i&&(m=r.apply(o,x))),m});return L.cancel=function(){clearTimeout(s),s=x=o=null},L}function xP(r,e){return Ih(e,r)}function I_(r){return function(){return!r.apply(this,arguments)}}function bP(){var r=arguments,e=r.length-1;return function(){for(var i=e,s=r[e].apply(this,arguments);i--;)s=r[i].call(this,s);return s}}function wP(r,e){return function(){if(--r<1)return e.apply(this,arguments)}}function Jb(r,e){var i;return function(){return--r>0&&(i=e.apply(this,arguments)),r<=1&&(e=null),i}}const TP=Ih(Jb,2);function Qb(r,e,i){e=Mo(e,i);for(var s=Ms(r),h,x=0,m=s.length;x<m;x++)if(h=s[x],e(r[h],h,r))return h}function ew(r){return function(e,i,s){i=Mo(i,s);for(var h=So(e),x=r>0?0:h-1;x>=0&&x<h;x+=r)if(i(e[x],x,e))return x;return-1}}const S_=ew(1),tw=ew(-1);function iw(r,e,i,s){i=Mo(i,s,1);for(var h=i(e),x=0,m=So(r);x<m;){var o=Math.floor((x+m)/2);i(r[o])<h?x=o+1:m=o}return x}function rw(r,e,i){return function(s,h,x){var m=0,o=So(s);if(typeof x=="number")r>0?m=x>=0?x:Math.max(x+o,m):o=x>=0?Math.min(x+1,o):x+o+1;else if(i&&x&&o)return x=i(s,h),s[x]===h?x:-1;if(h!==h)return x=e(up.call(s,m,o),Pb),x>=0?x+m:-1;for(x=r>0?m:o-1;x>=0&&x<o;x+=r)if(s[x]===h)return x;return-1}}const nw=rw(1,S_,iw),EP=rw(-1,tw);function Dy(r,e,i){var s=Zo(r)?S_:Qb,h=s(r,e,i);if(h!==void 0&&h!==-1)return r[h]}function IP(r,e){return Dy(r,Ud(e))}function jl(r,e,i){e=dp(e,i);var s,h;if(Zo(r))for(s=0,h=r.length;s<h;s++)e(r[s],s,r);else{var x=Ms(r);for(s=0,h=x.length;s<h;s++)e(r[x[s]],x[s],r)}return r}function pc(r,e,i){e=Mo(e,i);for(var s=!Zo(r)&&Ms(r),h=(s||r).length,x=Array(h),m=0;m<h;m++){var o=s?s[m]:m;x[m]=e(r[o],o,r)}return x}function sw(r){var e=function(i,s,h,x){var m=!Zo(i)&&Ms(i),o=(m||i).length,P=r>0?0:o-1;for(x||(h=i[m?m[P]:P],P+=r);P>=0&&P<o;P+=r){var L=m?m[P]:P;h=s(h,i[L],L,i)}return h};return function(i,s,h,x){var m=arguments.length>=3;return e(i,dp(s,x,4),h,m)}}const iy=sw(1),Bx=sw(-1);function fh(r,e,i){var s=[];return e=Mo(e,i),jl(r,function(h,x,m){e(h,x,m)&&s.push(h)}),s}function SP(r,e,i){return fh(r,I_(Mo(e)),i)}function $x(r,e,i){e=Mo(e,i);for(var s=!Zo(r)&&Ms(r),h=(s||r).length,x=0;x<h;x++){var m=s?s[x]:x;if(!e(r[m],m,r))return!1}return!0}function jx(r,e,i){e=Mo(e,i);for(var s=!Zo(r)&&Ms(r),h=(s||r).length,x=0;x<h;x++){var m=s?s[x]:x;if(e(r[m],m,r))return!0}return!1}function Fl(r,e,i,s){return Zo(r)||(r=Eh(r)),(typeof i!="number"||s)&&(i=0),nw(r,e,i)>=0}const MP=Io(function(r,e,i){var s,h;return uo(e)?h=e:(e=hp(e),s=e.slice(0,-1),e=e[e.length-1]),pc(r,function(x){var m=h;if(!m){if(s&&s.length&&(x=b_(x,s)),x==null)return;m=x[e]}return m==null?m:m.apply(x,i)})});function M_(r,e){return pc(r,T_(e))}function PP(r,e){return fh(r,Ud(e))}function ow(r,e,i){var s=-1/0,h=-1/0,x,m;if(e==null||typeof e=="number"&&typeof r[0]!="object"&&r!=null){r=Zo(r)?r:Eh(r);for(var o=0,P=r.length;o<P;o++)x=r[o],x!=null&&x>s&&(s=x)}else e=Mo(e,i),jl(r,function(L,D,F){m=e(L,D,F),(m>h||m===-1/0&&s===-1/0)&&(s=L,h=m)});return s}function kP(r,e,i){var s=1/0,h=1/0,x,m;if(e==null||typeof e=="number"&&typeof r[0]!="object"&&r!=null){r=Zo(r)?r:Eh(r);for(var o=0,P=r.length;o<P;o++)x=r[o],x!=null&&x<s&&(s=x)}else e=Mo(e,i),jl(r,function(L,D,F){m=e(L,D,F),(m<h||m===1/0&&s===1/0)&&(s=L,h=m)});return s}var CP=/[^\ud800-\udfff]|[\ud800-\udbff][\udc00-\udfff]|[\ud800-\udfff]/g;function aw(r){return r?xc(r)?up.call(r):f_(r)?r.match(CP):Zo(r)?pc(r,w_):Eh(r):[]}function lw(r,e,i){if(e==null||i)return Zo(r)||(r=Eh(r)),r[Oy(r.length-1)];var s=aw(r),h=So(s);e=Math.max(Math.min(e,h),0);for(var x=h-1,m=0;m<e;m++){var o=Oy(m,x),P=s[m];s[m]=s[o],s[o]=P}return s.slice(0,e)}function AP(r){return lw(r,1/0)}function LP(r,e,i){var s=0;return e=Mo(e,i),M_(pc(r,function(h,x,m){return{value:h,index:s++,criteria:e(h,x,m)}}).sort(function(h,x){var m=h.criteria,o=x.criteria;if(m!==o){if(m>o||m===void 0)return 1;if(m<o||o===void 0)return-1}return h.index-x.index}),"value")}function Rm(r,e){return function(i,s,h){var x=e?[[],[]]:{};return s=Mo(s,h),jl(i,function(m,o){var P=s(m,o,i);r(x,m,P)}),x}}const RP=Rm(function(r,e,i){Ou(r,i)?r[i].push(e):r[i]=[e]}),NP=Rm(function(r,e,i){r[i]=e}),OP=Rm(function(r,e,i){Ou(r,i)?r[i]++:r[i]=1}),DP=Rm(function(r,e,i){r[i?0:1].push(e)},!0);function FP(r){return r==null?0:Zo(r)?r.length:Ms(r).length}function zP(r,e,i){return e in i}const uw=Io(function(r,e){var i={},s=e[0];if(r==null)return i;uo(s)?(e.length>1&&(s=dp(s,e[1])),e=cp(r)):(s=zP,e=bc(e,!1,!1),r=Object(r));for(var h=0,x=e.length;h<x;h++){var m=e[h],o=r[m];s(o,m,r)&&(i[m]=o)}return i}),BP=Io(function(r,e){var i=e[0],s;return uo(i)?(i=I_(i),e.length>1&&(s=e[1])):(e=pc(bc(e,!1,!1),String),i=function(h,x){return!Fl(e,x)}),uw(r,i,s)});function cw(r,e,i){return up.call(r,0,Math.max(0,r.length-(e==null||i?1:e)))}function ry(r,e,i){return r==null||r.length<1?e==null||i?void 0:[]:e==null||i?r[0]:cw(r,r.length-e)}function $f(r,e,i){return up.call(r,e==null||i?1:e)}function $P(r,e,i){return r==null||r.length<1?e==null||i?void 0:[]:e==null||i?r[r.length-1]:$f(r,Math.max(0,r.length-e))}function jP(r){return fh(r,Boolean)}function GP(r,e){return bc(r,e,!1)}const hw=Io(function(r,e){return e=bc(e,!0,!0),fh(r,function(i){return!Fl(e,i)})}),UP=Io(function(r,e){return hw(r,e)});function Fy(r,e,i,s){bb(e)||(s=i,i=e,e=!1),i!=null&&(i=Mo(i,s));for(var h=[],x=[],m=0,o=So(r);m<o;m++){var P=r[m],L=i?i(P,m,r):P;e&&!i?((!m||x!==L)&&h.push(P),x=L):i?Fl(x,L)||(x.push(L),h.push(P)):Fl(h,P)||h.push(P)}return h}const VP=Io(function(r){return Fy(bc(r,!0,!0))});function qP(r){for(var e=[],i=arguments.length,s=0,h=So(r);s<h;s++){var x=r[s];if(!Fl(e,x)){var m;for(m=1;m<i&&Fl(arguments[m],x);m++);m===i&&e.push(x)}}return e}function zy(r){for(var e=r&&ow(r,So).length||0,i=Array(e),s=0;s<e;s++)i[s]=M_(r,s);return i}const ZP=Io(zy);function WP(r,e){for(var i={},s=0,h=So(r);s<h;s++)e?i[r[s]]=e[s]:i[r[s][0]]=r[s][1];return i}function YP(r,e,i){e==null&&(e=r||0,r=0),i||(i=e<r?-1:1);for(var s=Math.max(Math.ceil((e-r)/i),0),h=Array(s),x=0;x<s;x++,r+=i)h[x]=r;return h}function XP(r,e){if(e==null||e<1)return[];for(var i=[],s=0,h=r.length;s<h;)i.push(up.call(r,s,s+=e));return i}function P_(r,e){return r._chain?Vr(e).chain():e}function dw(r){return jl(Ny(r),function(e){var i=Vr[e]=r[e];Vr.prototype[e]=function(){var s=[this._wrapped];return vM.apply(s,arguments),P_(this,i.apply(Vr,s))}}),Vr}jl(["pop","push","reverse","shift","sort","splice","unshift"],function(r){var e=Lm[r];Vr.prototype[r]=function(){var i=this._wrapped;return i!=null&&(e.apply(i,arguments),(r==="shift"||r==="splice")&&i.length===0&&delete i[0]),P_(this,i)}});jl(["concat","join","slice"],function(r){var e=Lm[r];Vr.prototype[r]=function(){var i=this._wrapped;return i!=null&&(i=e.apply(i,arguments)),P_(this,i)}});const HP=Object.freeze(Object.defineProperty({__proto__:null,VERSION:yb,after:wP,all:$x,allKeys:cp,any:jx,assign:im,before:Jb,bind:Hb,bindAll:mP,chain:fP,chunk:XP,clone:HM,collect:pc,compact:jP,compose:bP,constant:kb,contains:Fl,countBy:OP,create:XM,debounce:vP,default:Vr,defaults:jb,defer:yP,delay:Kb,detect:Dy,difference:hw,drop:$f,each:jl,escape:iP,every:$x,extend:$b,extendOwn:im,filter:fh,find:Dy,findIndex:S_,findKey:Qb,findLastIndex:tw,findWhere:IP,first:ry,flatten:GP,foldl:iy,foldr:Bx,forEach:jl,functions:Ny,get:Vb,groupBy:RP,has:JM,head:ry,identity:w_,include:Fl,includes:Fl,indexBy:NP,indexOf:nw,initial:cw,inject:iy,intersection:qP,invert:Bb,invoke:MP,isArguments:g_,isArray:xc,isArrayBuffer:Eb,isBoolean:bb,isDataView:em,isDate:PM,isElement:MM,isEmpty:BM,isEqual:$M,isError:CM,isFinite:NM,isFunction:uo,isMap:UM,isMatch:Nb,isNaN:Pb,isNull:SM,isNumber:wb,isObject:vc,isRegExp:kM,isSet:qM,isString:f_,isSymbol:Tb,isTypedArray:Lb,isUndefined:xb,isWeakMap:VM,isWeakSet:ZM,iteratee:E_,keys:Ms,last:$P,lastIndexOf:EP,map:pc,mapObject:QM,matcher:Ud,matches:Ud,max:ow,memoize:gP,methods:Ny,min:kP,mixin:dw,negate:I_,noop:Zb,now:Vd,object:WP,omit:BP,once:TP,pairs:WM,partial:Ih,partition:DP,pick:uw,pluck:M_,property:T_,propertyOf:eP,random:Oy,range:YP,reduce:iy,reduceRight:Bx,reject:SP,rest:$f,restArguments:Io,result:hP,sample:lw,select:fh,shuffle:AP,size:FP,some:jx,sortBy:LP,sortedIndex:iw,tail:$f,take:ry,tap:KM,template:cP,templateSettings:sP,throttle:_P,times:tP,toArray:aw,toPath:Ub,transpose:zy,unescape:nP,union:VP,uniq:Fy,unique:Fy,uniqueId:pP,unzip:zy,values:Eh,where:PP,without:UP,wrap:xP,zip:ZP},Symbol.toStringTag,{value:"Module"}));var qd=dw(HP);qd._=qd;function ch(r,e){const i=e[0],s=e[1];return[r[0]*i+r[2]*s+r[4],r[1]*i+r[3]*s+r[5]]}function KP(){return[1,0,0,1,0,0]}function JP(r,e){const i=r[0],s=r[1],h=r[2],x=r[3],m=r[4],o=r[5],P=e[0],L=e[1],D=e[2],F=e[3],Y=e[4],V=e[5];return[i*P+h*L,s*P+x*L,i*D+h*F,s*D+x*F,i*Y+h*V+m,s*Y+x*V+o]}function Gx(r,e,i,s,h,x,m){const o=Math.sin(h),P=Math.cos(h);return[i*P,s*o,-i*o,s*P,x*i*P-m*i*o+r,x*s*o+m*s*P+e]}function QP(r){const e=ek(r),i=r[0],s=r[1],h=r[2],x=r[3],m=r[4],o=r[5];return[x/e,-s/e,-h/e,i/e,(h*o-x*m)/e,-(i*o-s*m)/e]}function ek(r){return r[0]*r[3]-r[1]*r[2]}function tk(r){const e=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1];return e[0]=r[0],e[1]=r[1],e[4]=r[2],e[5]=r[3],e[12]=r[4],e[13]=r[5],e}async function pw(r,e,i){let s;if(typeof i=="function"?s=await i(r,e):s=await fetch(r,e),!s.ok)throw new Error(s.statusText);return s}async function ik(r,e,i){return await(await pw(r,e,i)).json()}async function rk(r,e,i){return await ik(`${r}/info.json`,e,i)}function fw(r,e=!1){switch(r.type){case"Polygon":return r.coordinates?{...r,coordinates:Ux(r.coordinates,e)}:r;case"MultiPolygon":return r.coordinates?{...r,coordinates:r.coordinates.map(i=>Ux(i,e))}:r;case"GeometryCollection":return{...r,geometries:r.geometries.map(i=>fw(i,e))};default:return r}}function Ux(r,e){if(r.length===0)return r;const i=[];for(let s=0;s<r.length;s++)i.push(nk(r[s],s===0?e:!e));return i}function nk(r,e){let i=0,s=0;for(let h=0,x=r.length,m=x-1;h<x;m=h++){const o=(r[h][0]-r[m][0])*(r[m][1]+r[h][1]),P=i+o;s+=Math.abs(i)>=Math.abs(o)?i-P+o:o-P+i,i=P}return i+s>=0!=!!e?r.slice().reverse():r}function lo(r){return Array.isArray(r)&&r.length===2&&typeof r[0]=="number"&&typeof r[1]=="number"}function Pa(r){return Array.isArray(r)&&r.every(lo)}function sk(r){return Array.isArray(r)&&r.every(lo)}function ka(r){return Array.isArray(r)&&r.every(sk)}function Sl(r){return Array.isArray(r)&&r.every(lo)}function Ml(r){return Array.isArray(r)&&r.every(Pa)}function Pl(r){return Array.isArray(r)&&r.every(ka)}function Nm(r){if(r=r.filter(function(e,i,s){return i===0||!C_(e,s[i-1])}),r.length<2)throw new Error("LineString should contain at least 2 points");return r}function k_(r){if(r=r.filter(function(e,i,s){return i===0||!C_(e,s[i-1])}),lk(r)&&r.splice(-1),r.length<3)throw new Error("Ring should contain at least 3 points");return r}function mw(r){return r.map(e=>k_(e))}function ok(r){return r.map(e=>Nm(e))}function ak(r){return r.map(e=>mw(e))}function cf(r){return{type:"Point",coordinates:r}}function hf(r){return{type:"LineString",coordinates:r}}function df(r,e=!0){const i={type:"Polygon",coordinates:e?r.map(s=>[...s,s[0]]):r};return fw(i)}function lk(r){return Array.isArray(r)&&r.length>=2&&C_(r[0],r[r.length-1])}function C_(r,e){return r===e?!0:r===null||e===null?!1:r[0]===e[0]&&r[1]===e[1]}function uk(r){return[r[0],-r[1]]}function rm(r,e){return[(e[0]-r[0])/2+r[0],(e[1]-r[1])/2+r[1]]}function ck(r,e,i){return r*i+e*(1-i)}function hk(r,e,i){return[r[0]*i+e[0]*(1-i),r[1]*i+e[1]*(1-i)]}function Uo(r,e){if(Pa(r)&&r.length===2)return Uo(r[0],r[1]);if(lo(r)&&lo(e))return Math.sqrt((e[0]-r[0])**2+(e[1]-r[1])**2);throw new Error("Input type not supported")}function dk(r){return r*(Math.PI/180)}function kl(r){return typeof r=="object"&&r!==null&&r.type==="Point"&&lo(r.coordinates)}function Cl(r){return typeof r=="object"&&r!==null&&r.type==="LineString"&&Pa(r.coordinates)}function Al(r){return typeof r=="object"&&r!==null&&r.type==="Polygon"&&Array.isArray(r.coordinates)&&ka(r.coordinates)}function Ll(r){return typeof r=="object"&&r!==null&&r.type==="MultiPoint"&&Sl(r.coordinates)}function Rl(r){return typeof r=="object"&&r!==null&&r.type==="MultiLineString"&&Ml(r.coordinates)}function Nl(r){return typeof r=="object"&&r!==null&&r.type==="MultiPolygon"&&Array.isArray(r.coordinates)&&Pl(r.coordinates)}function pk(r){const e=typeof r=="object"&&r!==null,i=e&&"type"in r&&typeof r.type=="string"&&(r.type==="Point"||r.type==="LineString"||r.type==="Polygon"||r.type==="MultiPoint"||r.type==="MultiLineString"||r.type==="MultiPolygon"),s=e&&"coordinates"in r&&Array.isArray(r.coordinates);return i&&s}function Pd(r){return r.coordinates}function kd(r){return Nm(r.coordinates)}function Cd(r,e=!1){let i=r.coordinates;return i=mw(i),e?i.map(s=>[...s,s[0]]):i}function fk(r){return r.coordinates}function mk(r){return ok(r.coordinates)}function gk(r,e=!1){let i=r.coordinates;return i=ak(i),e?i.map(s=>s.map(h=>[...h,h[0]])):i}function yk(r){if(kl(r))return Pd(r);if(Cl(r))return kd(r);if(Al(r))return Cd(r);if(Ll(r))return fk(r);if(Rl(r))return mk(r);if(Nl(r))return gk(r);throw new Error("Geometry type not supported")}function pf(r){return r.coordinates.map(e=>({type:"Point",coordinates:e}))}function ff(r){return r.coordinates.map(e=>({type:"LineString",coordinates:e}))}function mf(r){return r.coordinates.map(e=>({type:"Polygon",coordinates:e}))}function gf(r){return{type:"MultiPoint",coordinates:r.map(e=>e.coordinates)}}function yf(r){return{type:"MultiLineString",coordinates:r.map(e=>e.coordinates)}}function _f(r){return{type:"MultiPolygon",coordinates:r.map(e=>e.coordinates)}}function _k(r,e){return{type:"Feature",properties:e||{},geometry:r}}function vk(r,e){return{type:"FeatureCollection",features:r.map((i,s)=>_k(i))}}function xk(r){return r.geometry}function bk(r){return r.features.map(xk)}function Vx(r){let e=Number.POSITIVE_INFINITY,i=Number.NEGATIVE_INFINITY;for(const s of r)e===void 0?s>=s&&(e=i=s):(e>s&&(e=s),i<s&&(i=s));return[e,i]}function Xs(r){if(lo(r)&&(r=[r]),ka(r)&&(r=r.flat()),pk(r))return Xs(yk(r));const e=[],i=[];for(const o of r)e.push(o[0]),i.push(o[1]);const[s,h]=Vx(e),[x,m]=Vx(i);return[s,x,h,m]}function qx(r,e){return[Math.min(r[0],e[0]),Math.min(r[1],e[1]),Math.max(r[2],e[2]),Math.max(r[3],e[3])]}function wk(r,e){const i=r[2]>=e[0]&&e[2]>=r[0],s=r[3]>=e[1]&&e[3]>=r[1];return i&&s}function nm(r){return[[r[0],r[1]],[r[2],r[1]],[r[2],r[3]],[r[0],r[3]]]}function gw(r){return[[r[0],r[1]],[r[2],r[3]]]}function Tk(r){return Uo(gw(r))}function Ek(r){return Uo(gw(Xs(r)))}function mh(r){return[(r[0]+r[2])/2,(r[1]+r[3])/2]}function ny(r){return[r[2]-r[0],r[3]-r[1]]}function By(r){return[.5*(Uo(r[0],r[1])+Uo(r[2],r[3])),.5*(Uo(r[1],r[2])+Uo(r[3],r[0]))]}function sm(r,e,i){return i?i==="contain"?e[0]>=e[1]?r[0]/e[0]:r[1]/e[1]:e[0]>=e[1]?r[1]/e[1]:r[0]/e[0]:Math.sqrt(r[0]*r[1]/(e[0]*e[1]))}function Zx(r,e){return sm(By(r),By(e))}function jf(r,e,i,s=!0){if(r.has(e)&&s)return r.get(e);{const h=i();return r.set(e,h),h}}function sy(r,e,i,s,h=!0){if(r.get(e)?.has(i)&&h)return r.get(e)?.get(i);{const x=s();return r.get(e)||r.set(e,new Map),r.get(e)?.set(i,x),x}}function Ik(r){const e=parseInt(r.replace(/^#/,""),16),i=e>>16&255,s=e>>8&255,h=e&255;return[i,s,h]}function vf(r){return Ik(r).map(e=>e/255)}function Sk(r,e){return!r||!e||r.size!==e.size?!1:[...r].every(i=>e.has(i))}function Wx(r,e){if(r!==void 0&&e!==void 0)return Math.max(r,e);if(r!==void 0)return r;if(e!==void 0)return e}function Mk(r,e){e===void 0&&(e={});var i=e.offsetLine||0,s=e.offsetColumn||0,h=r.split(`
`),x=0,m=h.map(function(F,Y){var V=x+F.length+1,H={start:x,end:V,line:Y};return x=V,H}),o=0;function P(F,Y){return F.start<=Y&&Y<F.end}function L(F,Y){return{line:i+F.line,column:s+Y-F.start,character:Y}}function D(F,Y){typeof F=="string"&&(F=r.indexOf(F,Y||0));for(var V=m[o],H=F>=V.end?1:-1;V;){if(P(V,F))return L(V,F);o+=H,V=m[o]}}return D}function Pk(r,e,i){return Mk(r,i)(e,i)}var Yx=/[a-zA-Z0-9:_-]/,Xx=/[\s\t\r\n]/,kk=/['"]/;function Ck(r,e){for(var i="";e--;)i+=r;return i}function Ak(r){var e="",i=[],s=o,h=null,x=null;function m(ne){var ye=Pk(r,K),Re=ye.line,Se=ye.column,Z=r.slice(0,K),$=/(^|\n).*$/.exec(Z)[0].replace(/\t/g,"  "),Q=r.slice(K),ue=/.*(\n|$)/.exec(Q)[0],he=""+$+ue+`
`+Ck(" ",$.length)+"^";throw new Error(ne+" ("+Re+":"+Se+`). If this is valid SVG, it's probably a bug in svg-parser. Please raise an issue at https://github.com/Rich-Harris/svg-parser/issues  thanks!

`+he)}function o(){for(;K<r.length&&r[K]!=="<"||!Yx.test(r[K+1]);)e+=r[K++];return P()}function P(){for(var ne="";K<r.length&&r[K]!=="<";)ne+=r[K++];return/\S/.test(ne)&&h.children.push({type:"text",value:ne}),r[K]==="<"?L:P}function L(){var ne=r[K];if(ne==="?")return P;if(ne==="!"){if(r.slice(K+1,K+3)==="--")return D;if(r.slice(K+1,K+8)==="[CDATA[")return F;if(/doctype/i.test(r.slice(K+1,K+8)))return P}if(ne==="/")return Y;var ye=V(),Re={type:"element",tagName:ye,properties:{},children:[]};h?h.children.push(Re):x=Re;for(var Se;K<r.length&&(Se=H());)Re.properties[Se.name]=Se.value;var Z=!1;return r[K]==="/"&&(K+=1,Z=!0),r[K]!==">"&&m("Expected >"),Z||(h=Re,i.push(Re)),P}function D(){var ne=r.indexOf("-->",K);return~ne||m("expected -->"),K=ne+2,P}function F(){var ne=r.indexOf("]]>",K);return~ne||m("expected ]]>"),h.children.push(r.slice(K+7,ne)),K=ne+2,P}function Y(){var ne=V();return ne||m("Expected tag name"),ne!==h.tagName&&m("Expected closing tag </"+ne+"> to match opening tag <"+h.tagName+">"),fe(),r[K]!==">"&&m("Expected >"),i.pop(),h=i[i.length-1],P}function V(){for(var ne="";K<r.length&&Yx.test(r[K]);)ne+=r[K++];return ne}function H(){if(!Xx.test(r[K]))return null;fe();var ne=V();if(!ne)return null;var ye=!0;return fe(),r[K]==="="&&(K+=1,fe(),ye=ve(),!isNaN(ye)&&ye.trim()!==""&&(ye=+ye)),{name:ne,value:ye}}function ve(){return kk.test(r[K])?oe():_e()}function _e(){var ne="";do{var ye=r[K];if(ye===" "||ye===">"||ye==="/")return ne;ne+=ye,K+=1}while(K<r.length);return ne}function oe(){for(var ne=r[K++],ye="",Re=!1;K<r.length;){var Se=r[K++];if(Se===ne&&!Re)return ye;Se==="\\"&&!Re&&(Re=!0),ye+=Re?"\\"+Se:Se,Re=!1}}function fe(){for(;K<r.length&&Xx.test(r[K]);)K+=1}for(var K=o.length;K<r.length;)s||m("Unexpected character"),s=s(),K+=1;return s!==P&&m("Unexpected end of input"),x.tagName==="svg"&&(x.metadata=e),{type:"root",children:[x]}}function*Lk(r){function*e(s){if("children"in s)for(const h of s.children)typeof h!="string"&&(yield*e(h));yield s}const i=Ak(r);for(const s of e(i))if("tagName"in s&&s.tagName!=="svg"&&s.tagName!=="g"){const h=Rk(s);h&&(yield h)}}function Rk(r){const e=r?.tagName?.toLowerCase();if(e==="circle")return{type:"circle",coordinates:[ns(r,"cx"),ns(r,"cy")]};if(e==="line")return{type:"line",coordinates:[[ns(r,"x1"),ns(r,"y1")],[ns(r,"x2"),ns(r,"y2")]]};if(e==="polyline")return{type:"polyline",coordinates:Hx(r)};if(e==="polygon")return{type:"polygon",coordinates:Hx(r)};if(e==="rect")return{type:"rect",coordinates:[[ns(r,"x"),ns(r,"y")],[ns(r,"x")+ns(r,"width"),ns(r,"y")],[ns(r,"x")+ns(r,"width"),ns(r,"y")+ns(r,"height")],[ns(r,"x"),ns(r,"y")+ns(r,"height")],[ns(r,"x"),ns(r,"y")]]};throw new Error(`Unsupported SVG element: ${e}`)}function ns(r,e){const i=r?.properties?.[e];return Number(i)||0}function Hx(r){const e=r?.properties?.points;return e?String(e).trim().split(/\s+/).map(i=>{const s=i.split(",").map(h=>Number(h));return[s[0],s[1]]}):[]}function Kx(r){return r.map(e=>e.join(",")).join(" ")}function Nk(r){return`<svg xmlns="http://www.w3.org/2000/svg">
  ${r.map(Ok).join(`
`)}
</svg>`}function Ok(r){if(r.type==="circle")return xd("circle",{...r.attributes,cx:r.coordinates[0],cy:r.coordinates[1]});if(r.type==="line")return xd("line",{...r.attributes,x1:r.coordinates[0][0],y1:r.coordinates[0][1],x2:r.coordinates[1][0],y2:r.coordinates[1][1]});if(r.type==="polyline")return xd("polyline",{...r.attributes,points:Kx(r.coordinates)});if(r.type==="polygon")return xd("polygon",{...r.attributes,points:Kx(r.coordinates)});if(r.type==="rect")return xd("rect",{...r.attributes,x:r.coordinates[0][0],y:r.coordinates[0][1],width:r.coordinates[1][0]-r.coordinates[0][0],height:r.coordinates[2][1]-r.coordinates[0][1]});throw new Error("Unknown SVG element")}function xd(r,e){const i=Object.entries(e).map(([s,h])=>`${s}="${h}"`);return`<${r} ${i.join(" ")} />`}function sh([r,e]){const i=6378137*dk(r),s=i/r,h=180/Math.PI*Math.log(Math.tan(Math.PI/4+e*(Math.PI/180)/2))*s;return[i,h]}function Jx([r,e]){const i=Math.PI*6378137,s=r/i*180;let h=e/i*180;return h=180/Math.PI*(2*Math.atan(Math.exp(h*Math.PI/180))-Math.PI/2),[s,h]}class om{geoCenter;geoRectangle;geoSize;geoRectangleBbox;projectedGeoCenter;projectedGeoRectangle;projectedGeoSize;projectedGeoRectangleBbox;rotation;projectedGeoPerViewportScale;viewportCenter;viewportRectangle;viewportSize;viewportBbox;devicePixelRatio;canvasCenter;canvasRectangle;canvasSize;canvasBbox;projectedGeoPerCanvasScale;projectedGeoToViewportTransform=[1,0,0,1,0,0];projectedGeoToClipTransform=[1,0,0,1,0,0];constructor(e,i,s,h,x=1){this.projectedGeoCenter=i,this.projectedGeoPerViewportScale=s,this.rotation=h,this.viewportSize=e,this.devicePixelRatio=x,this.projectedGeoRectangle=this.computeProjectedGeoRectangle(this.projectedGeoCenter,this.projectedGeoPerViewportScale,this.rotation,this.viewportSize),this.projectedGeoRectangleBbox=Xs(this.projectedGeoRectangle),this.projectedGeoSize=[this.viewportSize[0]*s,this.viewportSize[1]*s],this.geoCenter=Jx(this.projectedGeoCenter),this.geoRectangle=this.projectedGeoRectangle.map(m=>Jx(m)),this.geoRectangleBbox=Xs(this.geoRectangle),this.geoSize=ny(this.geoRectangleBbox),this.viewportCenter=[this.viewportSize[0]/2,this.viewportSize[1]/2],this.viewportBbox=[0,0,...this.viewportSize],this.viewportRectangle=nm(this.viewportBbox),this.canvasCenter=[this.viewportCenter[0]*this.devicePixelRatio,this.viewportSize[1]*this.devicePixelRatio],this.canvasSize=[this.viewportSize[0]*this.devicePixelRatio,this.viewportSize[1]*this.devicePixelRatio],this.canvasBbox=[0,0,...this.canvasSize],this.canvasRectangle=nm(this.canvasBbox),this.projectedGeoPerCanvasScale=this.projectedGeoPerViewportScale/this.devicePixelRatio,this.projectedGeoToViewportTransform=this.composeProjectedGeoToViewportTransform(),this.projectedGeoToClipTransform=this.composeProjectedGeoToClipTransform()}static fromWarpedMapList(e,i,s,h="contain",x=1){const m=i.getProjectedCenter(),o=i.getProjectedBbox();if(!m||!o)throw new Error("WarpedMapList has no projected center or bbox");const P=ny(o),L=sm(P,e,h)*(1/x);return new om(e,m,L,0,s)}static fromProjectedGeoBbox(e,i,s,h="contain"){const x=mh(i),m=ny(i),o=sm(m,e,h);return new om(e,x,o,0,s)}composeProjectedGeoToViewportTransform(){return Gx(this.viewportSize[0]/2,this.viewportSize[1]/2,1/this.projectedGeoPerViewportScale,-1/this.projectedGeoPerViewportScale,-this.rotation,-this.projectedGeoCenter[0],-this.projectedGeoCenter[1])}composeProjectedGeoToClipTransform(){return Gx(0,0,2/(this.projectedGeoPerViewportScale*this.viewportSize[0]),2/(this.projectedGeoPerViewportScale*this.viewportSize[1]),-this.rotation,-this.projectedGeoCenter[0],-this.projectedGeoCenter[1])}computeProjectedGeoRectangle(e,i,s,h){const x=i*h[0]/2,m=i*h[1]/2,o=Math.cos(s),P=Math.sin(s),L=x*o,D=x*P,F=m*o,Y=m*P,V=e[0],H=e[1];return[[V-L+Y,H-D-F],[V-L-Y,H-D+F],[V+L-Y,H+D+F],[V+L+Y,H+D-F]]}}function $y(r){return Array.isArray(r)?`[${r.map(e=>$y(e)).join(",")}]`:typeof r=="number"?`${r}`:typeof r=="string"?`"${r}"`:typeof r=="object"&&r!==null?Object.keys(r).sort().map(e=>`${e}:${$y(r[e])}`).join("|"):String(r)}async function Dk(r){const e=await crypto.subtle.digest("SHA-1",new TextEncoder().encode(r));return Array.from(new Uint8Array(e)).map(i=>i.toString(16).padStart(2,"0")).join("")}async function yw(r,e=16){return(await Dk(String(r))).slice(0,e)}async function Fk(r,e){return await yw($y(r),e)}var Cr;(function(r){r.assertEqual=h=>h;function e(h){}r.assertIs=e;function i(h){throw new Error}r.assertNever=i,r.arrayToEnum=h=>{const x={};for(const m of h)x[m]=m;return x},r.getValidEnumValues=h=>{const x=r.objectKeys(h).filter(o=>typeof h[h[o]]!="number"),m={};for(const o of x)m[o]=h[o];return r.objectValues(m)},r.objectValues=h=>r.objectKeys(h).map(function(x){return h[x]}),r.objectKeys=typeof Object.keys=="function"?h=>Object.keys(h):h=>{const x=[];for(const m in h)Object.prototype.hasOwnProperty.call(h,m)&&x.push(m);return x},r.find=(h,x)=>{for(const m of h)if(x(m))return m},r.isInteger=typeof Number.isInteger=="function"?h=>Number.isInteger(h):h=>typeof h=="number"&&isFinite(h)&&Math.floor(h)===h;function s(h,x=" | "){return h.map(m=>typeof m=="string"?`'${m}'`:m).join(x)}r.joinValues=s,r.jsonStringifyReplacer=(h,x)=>typeof x=="bigint"?x.toString():x})(Cr||(Cr={}));var jy;(function(r){r.mergeShapes=(e,i)=>({...e,...i})})(jy||(jy={}));const Ei=Cr.arrayToEnum(["string","nan","number","integer","float","boolean","date","bigint","symbol","function","undefined","null","array","object","unknown","promise","void","never","map","set"]),wu=r=>{switch(typeof r){case"undefined":return Ei.undefined;case"string":return Ei.string;case"number":return isNaN(r)?Ei.nan:Ei.number;case"boolean":return Ei.boolean;case"function":return Ei.function;case"bigint":return Ei.bigint;case"symbol":return Ei.symbol;case"object":return Array.isArray(r)?Ei.array:r===null?Ei.null:r.then&&typeof r.then=="function"&&r.catch&&typeof r.catch=="function"?Ei.promise:typeof Map<"u"&&r instanceof Map?Ei.map:typeof Set<"u"&&r instanceof Set?Ei.set:typeof Date<"u"&&r instanceof Date?Ei.date:Ei.object;default:return Ei.unknown}},Yt=Cr.arrayToEnum(["invalid_type","invalid_literal","custom","invalid_union","invalid_union_discriminator","invalid_enum_value","unrecognized_keys","invalid_arguments","invalid_return_type","invalid_date","invalid_string","too_small","too_big","invalid_intersection_types","not_multiple_of","not_finite"]),zk=r=>JSON.stringify(r,null,2).replace(/"([^"]+)":/g,"$1:");class Vo extends Error{constructor(e){super(),this.issues=[],this.addIssue=s=>{this.issues=[...this.issues,s]},this.addIssues=(s=[])=>{this.issues=[...this.issues,...s]};const i=new.target.prototype;Object.setPrototypeOf?Object.setPrototypeOf(this,i):this.__proto__=i,this.name="ZodError",this.issues=e}get errors(){return this.issues}format(e){const i=e||function(x){return x.message},s={_errors:[]},h=x=>{for(const m of x.issues)if(m.code==="invalid_union")m.unionErrors.map(h);else if(m.code==="invalid_return_type")h(m.returnTypeError);else if(m.code==="invalid_arguments")h(m.argumentsError);else if(m.path.length===0)s._errors.push(i(m));else{let o=s,P=0;for(;P<m.path.length;){const L=m.path[P];P===m.path.length-1?(o[L]=o[L]||{_errors:[]},o[L]._errors.push(i(m))):o[L]=o[L]||{_errors:[]},o=o[L],P++}}};return h(this),s}static assert(e){if(!(e instanceof Vo))throw new Error(`Not a ZodError: ${e}`)}toString(){return this.message}get message(){return JSON.stringify(this.issues,Cr.jsonStringifyReplacer,2)}get isEmpty(){return this.issues.length===0}flatten(e=i=>i.message){const i={},s=[];for(const h of this.issues)h.path.length>0?(i[h.path[0]]=i[h.path[0]]||[],i[h.path[0]].push(e(h))):s.push(e(h));return{formErrors:s,fieldErrors:i}}get formErrors(){return this.flatten()}}Vo.create=r=>new Vo(r);const gh=(r,e)=>{let i;switch(r.code){case Yt.invalid_type:r.received===Ei.undefined?i="Required":i=`Expected ${r.expected}, received ${r.received}`;break;case Yt.invalid_literal:i=`Invalid literal value, expected ${JSON.stringify(r.expected,Cr.jsonStringifyReplacer)}`;break;case Yt.unrecognized_keys:i=`Unrecognized key(s) in object: ${Cr.joinValues(r.keys,", ")}`;break;case Yt.invalid_union:i="Invalid input";break;case Yt.invalid_union_discriminator:i=`Invalid discriminator value. Expected ${Cr.joinValues(r.options)}`;break;case Yt.invalid_enum_value:i=`Invalid enum value. Expected ${Cr.joinValues(r.options)}, received '${r.received}'`;break;case Yt.invalid_arguments:i="Invalid function arguments";break;case Yt.invalid_return_type:i="Invalid function return type";break;case Yt.invalid_date:i="Invalid date";break;case Yt.invalid_string:typeof r.validation=="object"?"includes"in r.validation?(i=`Invalid input: must include "${r.validation.includes}"`,typeof r.validation.position=="number"&&(i=`${i} at one or more positions greater than or equal to ${r.validation.position}`)):"startsWith"in r.validation?i=`Invalid input: must start with "${r.validation.startsWith}"`:"endsWith"in r.validation?i=`Invalid input: must end with "${r.validation.endsWith}"`:Cr.assertNever(r.validation):r.validation!=="regex"?i=`Invalid ${r.validation}`:i="Invalid";break;case Yt.too_small:r.type==="array"?i=`Array must contain ${r.exact?"exactly":r.inclusive?"at least":"more than"} ${r.minimum} element(s)`:r.type==="string"?i=`String must contain ${r.exact?"exactly":r.inclusive?"at least":"over"} ${r.minimum} character(s)`:r.type==="number"?i=`Number must be ${r.exact?"exactly equal to ":r.inclusive?"greater than or equal to ":"greater than "}${r.minimum}`:r.type==="date"?i=`Date must be ${r.exact?"exactly equal to ":r.inclusive?"greater than or equal to ":"greater than "}${new Date(Number(r.minimum))}`:i="Invalid input";break;case Yt.too_big:r.type==="array"?i=`Array must contain ${r.exact?"exactly":r.inclusive?"at most":"less than"} ${r.maximum} element(s)`:r.type==="string"?i=`String must contain ${r.exact?"exactly":r.inclusive?"at most":"under"} ${r.maximum} character(s)`:r.type==="number"?i=`Number must be ${r.exact?"exactly":r.inclusive?"less than or equal to":"less than"} ${r.maximum}`:r.type==="bigint"?i=`BigInt must be ${r.exact?"exactly":r.inclusive?"less than or equal to":"less than"} ${r.maximum}`:r.type==="date"?i=`Date must be ${r.exact?"exactly":r.inclusive?"smaller than or equal to":"smaller than"} ${new Date(Number(r.maximum))}`:i="Invalid input";break;case Yt.custom:i="Invalid input";break;case Yt.invalid_intersection_types:i="Intersection results could not be merged";break;case Yt.not_multiple_of:i=`Number must be a multiple of ${r.multipleOf}`;break;case Yt.not_finite:i="Number must be finite";break;default:i=e.defaultError,Cr.assertNever(r)}return{message:i}};let _w=gh;function Bk(r){_w=r}function am(){return _w}const lm=r=>{const{data:e,path:i,errorMaps:s,issueData:h}=r,x=[...i,...h.path||[]],m={...h,path:x};if(h.message!==void 0)return{...h,path:x,message:h.message};let o="";const P=s.filter(L=>!!L).slice().reverse();for(const L of P)o=L(m,{data:e,defaultError:o}).message;return{...h,path:x,message:o}},$k=[];function vi(r,e){const i=am(),s=lm({issueData:e,data:r.data,path:r.path,errorMaps:[r.common.contextualErrorMap,r.schemaErrorMap,i,i===gh?void 0:gh].filter(h=>!!h)});r.common.issues.push(s)}class Ks{constructor(){this.value="valid"}dirty(){this.value==="valid"&&(this.value="dirty")}abort(){this.value!=="aborted"&&(this.value="aborted")}static mergeArray(e,i){const s=[];for(const h of i){if(h.status==="aborted")return Ki;h.status==="dirty"&&e.dirty(),s.push(h.value)}return{status:e.value,value:s}}static async mergeObjectAsync(e,i){const s=[];for(const h of i){const x=await h.key,m=await h.value;s.push({key:x,value:m})}return Ks.mergeObjectSync(e,s)}static mergeObjectSync(e,i){const s={};for(const h of i){const{key:x,value:m}=h;if(x.status==="aborted"||m.status==="aborted")return Ki;x.status==="dirty"&&e.dirty(),m.status==="dirty"&&e.dirty(),x.value!=="__proto__"&&(typeof m.value<"u"||h.alwaysSet)&&(s[x.value]=m.value)}return{status:e.value,value:s}}}const Ki=Object.freeze({status:"aborted"}),um=r=>({status:"dirty",value:r}),co=r=>({status:"valid",value:r}),Gy=r=>r.status==="aborted",Uy=r=>r.status==="dirty",Zd=r=>r.status==="valid",Wd=r=>typeof Promise<"u"&&r instanceof Promise;function cm(r,e,i,s){if(typeof e=="function"?r!==e||!0:!e.has(r))throw new TypeError("Cannot read private member from an object whose class did not declare it");return e.get(r)}function vw(r,e,i,s,h){if(typeof e=="function"?r!==e||!0:!e.has(r))throw new TypeError("Cannot write private member to an object whose class did not declare it");return e.set(r,i),i}var $i;(function(r){r.errToObj=e=>typeof e=="string"?{message:e}:e||{},r.toString=e=>typeof e=="string"?e:e?.message})($i||($i={}));var Ad,Ld;class ll{constructor(e,i,s,h){this._cachedPath=[],this.parent=e,this.data=i,this._path=s,this._key=h}get path(){return this._cachedPath.length||(this._key instanceof Array?this._cachedPath.push(...this._path,...this._key):this._cachedPath.push(...this._path,this._key)),this._cachedPath}}const Qx=(r,e)=>{if(Zd(e))return{success:!0,data:e.value};if(!r.common.issues.length)throw new Error("Validation failed but no issues detected.");return{success:!1,get error(){if(this._error)return this._error;const i=new Vo(r.common.issues);return this._error=i,this._error}}};function lr(r){if(!r)return{};const{errorMap:e,invalid_type_error:i,required_error:s,description:h}=r;if(e&&(i||s))throw new Error(`Can't use "invalid_type_error" or "required_error" in conjunction with custom error map.`);return e?{errorMap:e,description:h}:{errorMap:(x,m)=>{var o,P;const{message:L}=r;return x.code==="invalid_enum_value"?{message:L??m.defaultError}:typeof m.data>"u"?{message:(o=L??s)!==null&&o!==void 0?o:m.defaultError}:x.code!=="invalid_type"?{message:m.defaultError}:{message:(P=L??i)!==null&&P!==void 0?P:m.defaultError}},description:h}}let mr=class{constructor(e){this.spa=this.safeParseAsync,this._def=e,this.parse=this.parse.bind(this),this.safeParse=this.safeParse.bind(this),this.parseAsync=this.parseAsync.bind(this),this.safeParseAsync=this.safeParseAsync.bind(this),this.spa=this.spa.bind(this),this.refine=this.refine.bind(this),this.refinement=this.refinement.bind(this),this.superRefine=this.superRefine.bind(this),this.optional=this.optional.bind(this),this.nullable=this.nullable.bind(this),this.nullish=this.nullish.bind(this),this.array=this.array.bind(this),this.promise=this.promise.bind(this),this.or=this.or.bind(this),this.and=this.and.bind(this),this.transform=this.transform.bind(this),this.brand=this.brand.bind(this),this.default=this.default.bind(this),this.catch=this.catch.bind(this),this.describe=this.describe.bind(this),this.pipe=this.pipe.bind(this),this.readonly=this.readonly.bind(this),this.isNullable=this.isNullable.bind(this),this.isOptional=this.isOptional.bind(this)}get description(){return this._def.description}_getType(e){return wu(e.data)}_getOrReturnCtx(e,i){return i||{common:e.parent.common,data:e.data,parsedType:wu(e.data),schemaErrorMap:this._def.errorMap,path:e.path,parent:e.parent}}_processInputParams(e){return{status:new Ks,ctx:{common:e.parent.common,data:e.data,parsedType:wu(e.data),schemaErrorMap:this._def.errorMap,path:e.path,parent:e.parent}}}_parseSync(e){const i=this._parse(e);if(Wd(i))throw new Error("Synchronous parse encountered promise.");return i}_parseAsync(e){const i=this._parse(e);return Promise.resolve(i)}parse(e,i){const s=this.safeParse(e,i);if(s.success)return s.data;throw s.error}safeParse(e,i){var s;const h={common:{issues:[],async:(s=i?.async)!==null&&s!==void 0?s:!1,contextualErrorMap:i?.errorMap},path:i?.path||[],schemaErrorMap:this._def.errorMap,parent:null,data:e,parsedType:wu(e)},x=this._parseSync({data:e,path:h.path,parent:h});return Qx(h,x)}async parseAsync(e,i){const s=await this.safeParseAsync(e,i);if(s.success)return s.data;throw s.error}async safeParseAsync(e,i){const s={common:{issues:[],contextualErrorMap:i?.errorMap,async:!0},path:i?.path||[],schemaErrorMap:this._def.errorMap,parent:null,data:e,parsedType:wu(e)},h=this._parse({data:e,path:s.path,parent:s}),x=await(Wd(h)?h:Promise.resolve(h));return Qx(s,x)}refine(e,i){const s=h=>typeof i=="string"||typeof i>"u"?{message:i}:typeof i=="function"?i(h):i;return this._refinement((h,x)=>{const m=e(h),o=()=>x.addIssue({code:Yt.custom,...s(h)});return typeof Promise<"u"&&m instanceof Promise?m.then(P=>P?!0:(o(),!1)):m?!0:(o(),!1)})}refinement(e,i){return this._refinement((s,h)=>e(s)?!0:(h.addIssue(typeof i=="function"?i(s,h):i),!1))}_refinement(e){return new Na({schema:this,typeName:Yi.ZodEffects,effect:{type:"refinement",refinement:e}})}superRefine(e){return this._refinement(e)}optional(){return al.create(this,this._def)}nullable(){return ku.create(this,this._def)}nullish(){return this.nullable().optional()}array(){return Ra.create(this,this._def)}promise(){return _h.create(this,this._def)}or(e){return Kd.create([this,e],this._def)}and(e){return Jd.create(this,e,this._def)}transform(e){return new Na({...lr(this._def),schema:this,typeName:Yi.ZodEffects,effect:{type:"transform",transform:e}})}default(e){const i=typeof e=="function"?e:()=>e;return new rp({...lr(this._def),innerType:this,defaultValue:i,typeName:Yi.ZodDefault})}brand(){return new A_({typeName:Yi.ZodBranded,type:this,...lr(this._def)})}catch(e){const i=typeof e=="function"?e:()=>e;return new np({...lr(this._def),innerType:this,catchValue:i,typeName:Yi.ZodCatch})}describe(e){const i=this.constructor;return new i({...this._def,description:e})}pipe(e){return pp.create(this,e)}readonly(){return sp.create(this)}isOptional(){return this.safeParse(void 0).success}isNullable(){return this.safeParse(null).success}};const jk=/^c[^\s-]{8,}$/i,Gk=/^[0-9a-z]+$/,Uk=/^[0-9A-HJKMNP-TV-Z]{26}$/,Vk=/^[0-9a-fA-F]{8}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{12}$/i,qk=/^[a-z0-9_-]{21}$/i,Zk=/^[-+]?P(?!$)(?:(?:[-+]?\d+Y)|(?:[-+]?\d+[.,]\d+Y$))?(?:(?:[-+]?\d+M)|(?:[-+]?\d+[.,]\d+M$))?(?:(?:[-+]?\d+W)|(?:[-+]?\d+[.,]\d+W$))?(?:(?:[-+]?\d+D)|(?:[-+]?\d+[.,]\d+D$))?(?:T(?=[\d+-])(?:(?:[-+]?\d+H)|(?:[-+]?\d+[.,]\d+H$))?(?:(?:[-+]?\d+M)|(?:[-+]?\d+[.,]\d+M$))?(?:[-+]?\d+(?:[.,]\d+)?S)?)??$/,Wk=/^(?!\.)(?!.*\.\.)([A-Z0-9_'+\-\.]*)[A-Z0-9_+-]@([A-Z0-9][A-Z0-9\-]*\.)+[A-Z]{2,}$/i,Yk="^(\\p{Extended_Pictographic}|\\p{Emoji_Component})+$";let oy;const Xk=/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])$/,Hk=/^(([a-f0-9]{1,4}:){7}|::([a-f0-9]{1,4}:){0,6}|([a-f0-9]{1,4}:){1}:([a-f0-9]{1,4}:){0,5}|([a-f0-9]{1,4}:){2}:([a-f0-9]{1,4}:){0,4}|([a-f0-9]{1,4}:){3}:([a-f0-9]{1,4}:){0,3}|([a-f0-9]{1,4}:){4}:([a-f0-9]{1,4}:){0,2}|([a-f0-9]{1,4}:){5}:([a-f0-9]{1,4}:){0,1})([a-f0-9]{1,4}|(((25[0-5])|(2[0-4][0-9])|(1[0-9]{2})|([0-9]{1,2}))\.){3}((25[0-5])|(2[0-4][0-9])|(1[0-9]{2})|([0-9]{1,2})))$/,Kk=/^([0-9a-zA-Z+/]{4})*(([0-9a-zA-Z+/]{2}==)|([0-9a-zA-Z+/]{3}=))?$/,xw="((\\d\\d[2468][048]|\\d\\d[13579][26]|\\d\\d0[48]|[02468][048]00|[13579][26]00)-02-29|\\d{4}-((0[13578]|1[02])-(0[1-9]|[12]\\d|3[01])|(0[469]|11)-(0[1-9]|[12]\\d|30)|(02)-(0[1-9]|1\\d|2[0-8])))",Jk=new RegExp(`^${xw}$`);function bw(r){let e="([01]\\d|2[0-3]):[0-5]\\d:[0-5]\\d";return r.precision?e=`${e}\\.\\d{${r.precision}}`:r.precision==null&&(e=`${e}(\\.\\d+)?`),e}function Qk(r){return new RegExp(`^${bw(r)}$`)}function ww(r){let e=`${xw}T${bw(r)}`;const i=[];return i.push(r.local?"Z?":"Z"),r.offset&&i.push("([+-]\\d{2}:?\\d{2})"),e=`${e}(${i.join("|")})`,new RegExp(`^${e}$`)}function eC(r,e){return!!((e==="v4"||!e)&&Xk.test(r)||(e==="v6"||!e)&&Hk.test(r))}class Ca extends mr{_parse(e){if(this._def.coerce&&(e.data=String(e.data)),this._getType(e)!==Ei.string){const h=this._getOrReturnCtx(e);return vi(h,{code:Yt.invalid_type,expected:Ei.string,received:h.parsedType}),Ki}const i=new Ks;let s;for(const h of this._def.checks)if(h.kind==="min")e.data.length<h.value&&(s=this._getOrReturnCtx(e,s),vi(s,{code:Yt.too_small,minimum:h.value,type:"string",inclusive:!0,exact:!1,message:h.message}),i.dirty());else if(h.kind==="max")e.data.length>h.value&&(s=this._getOrReturnCtx(e,s),vi(s,{code:Yt.too_big,maximum:h.value,type:"string",inclusive:!0,exact:!1,message:h.message}),i.dirty());else if(h.kind==="length"){const x=e.data.length>h.value,m=e.data.length<h.value;(x||m)&&(s=this._getOrReturnCtx(e,s),x?vi(s,{code:Yt.too_big,maximum:h.value,type:"string",inclusive:!0,exact:!0,message:h.message}):m&&vi(s,{code:Yt.too_small,minimum:h.value,type:"string",inclusive:!0,exact:!0,message:h.message}),i.dirty())}else if(h.kind==="email")Wk.test(e.data)||(s=this._getOrReturnCtx(e,s),vi(s,{validation:"email",code:Yt.invalid_string,message:h.message}),i.dirty());else if(h.kind==="emoji")oy||(oy=new RegExp(Yk,"u")),oy.test(e.data)||(s=this._getOrReturnCtx(e,s),vi(s,{validation:"emoji",code:Yt.invalid_string,message:h.message}),i.dirty());else if(h.kind==="uuid")Vk.test(e.data)||(s=this._getOrReturnCtx(e,s),vi(s,{validation:"uuid",code:Yt.invalid_string,message:h.message}),i.dirty());else if(h.kind==="nanoid")qk.test(e.data)||(s=this._getOrReturnCtx(e,s),vi(s,{validation:"nanoid",code:Yt.invalid_string,message:h.message}),i.dirty());else if(h.kind==="cuid")jk.test(e.data)||(s=this._getOrReturnCtx(e,s),vi(s,{validation:"cuid",code:Yt.invalid_string,message:h.message}),i.dirty());else if(h.kind==="cuid2")Gk.test(e.data)||(s=this._getOrReturnCtx(e,s),vi(s,{validation:"cuid2",code:Yt.invalid_string,message:h.message}),i.dirty());else if(h.kind==="ulid")Uk.test(e.data)||(s=this._getOrReturnCtx(e,s),vi(s,{validation:"ulid",code:Yt.invalid_string,message:h.message}),i.dirty());else if(h.kind==="url")try{new URL(e.data)}catch{s=this._getOrReturnCtx(e,s),vi(s,{validation:"url",code:Yt.invalid_string,message:h.message}),i.dirty()}else h.kind==="regex"?(h.regex.lastIndex=0,h.regex.test(e.data)||(s=this._getOrReturnCtx(e,s),vi(s,{validation:"regex",code:Yt.invalid_string,message:h.message}),i.dirty())):h.kind==="trim"?e.data=e.data.trim():h.kind==="includes"?e.data.includes(h.value,h.position)||(s=this._getOrReturnCtx(e,s),vi(s,{code:Yt.invalid_string,validation:{includes:h.value,position:h.position},message:h.message}),i.dirty()):h.kind==="toLowerCase"?e.data=e.data.toLowerCase():h.kind==="toUpperCase"?e.data=e.data.toUpperCase():h.kind==="startsWith"?e.data.startsWith(h.value)||(s=this._getOrReturnCtx(e,s),vi(s,{code:Yt.invalid_string,validation:{startsWith:h.value},message:h.message}),i.dirty()):h.kind==="endsWith"?e.data.endsWith(h.value)||(s=this._getOrReturnCtx(e,s),vi(s,{code:Yt.invalid_string,validation:{endsWith:h.value},message:h.message}),i.dirty()):h.kind==="datetime"?ww(h).test(e.data)||(s=this._getOrReturnCtx(e,s),vi(s,{code:Yt.invalid_string,validation:"datetime",message:h.message}),i.dirty()):h.kind==="date"?Jk.test(e.data)||(s=this._getOrReturnCtx(e,s),vi(s,{code:Yt.invalid_string,validation:"date",message:h.message}),i.dirty()):h.kind==="time"?Qk(h).test(e.data)||(s=this._getOrReturnCtx(e,s),vi(s,{code:Yt.invalid_string,validation:"time",message:h.message}),i.dirty()):h.kind==="duration"?Zk.test(e.data)||(s=this._getOrReturnCtx(e,s),vi(s,{validation:"duration",code:Yt.invalid_string,message:h.message}),i.dirty()):h.kind==="ip"?eC(e.data,h.version)||(s=this._getOrReturnCtx(e,s),vi(s,{validation:"ip",code:Yt.invalid_string,message:h.message}),i.dirty()):h.kind==="base64"?Kk.test(e.data)||(s=this._getOrReturnCtx(e,s),vi(s,{validation:"base64",code:Yt.invalid_string,message:h.message}),i.dirty()):Cr.assertNever(h);return{status:i.value,value:e.data}}_regex(e,i,s){return this.refinement(h=>e.test(h),{validation:i,code:Yt.invalid_string,...$i.errToObj(s)})}_addCheck(e){return new Ca({...this._def,checks:[...this._def.checks,e]})}email(e){return this._addCheck({kind:"email",...$i.errToObj(e)})}url(e){return this._addCheck({kind:"url",...$i.errToObj(e)})}emoji(e){return this._addCheck({kind:"emoji",...$i.errToObj(e)})}uuid(e){return this._addCheck({kind:"uuid",...$i.errToObj(e)})}nanoid(e){return this._addCheck({kind:"nanoid",...$i.errToObj(e)})}cuid(e){return this._addCheck({kind:"cuid",...$i.errToObj(e)})}cuid2(e){return this._addCheck({kind:"cuid2",...$i.errToObj(e)})}ulid(e){return this._addCheck({kind:"ulid",...$i.errToObj(e)})}base64(e){return this._addCheck({kind:"base64",...$i.errToObj(e)})}ip(e){return this._addCheck({kind:"ip",...$i.errToObj(e)})}datetime(e){var i,s;return typeof e=="string"?this._addCheck({kind:"datetime",precision:null,offset:!1,local:!1,message:e}):this._addCheck({kind:"datetime",precision:typeof e?.precision>"u"?null:e?.precision,offset:(i=e?.offset)!==null&&i!==void 0?i:!1,local:(s=e?.local)!==null&&s!==void 0?s:!1,...$i.errToObj(e?.message)})}date(e){return this._addCheck({kind:"date",message:e})}time(e){return typeof e=="string"?this._addCheck({kind:"time",precision:null,message:e}):this._addCheck({kind:"time",precision:typeof e?.precision>"u"?null:e?.precision,...$i.errToObj(e?.message)})}duration(e){return this._addCheck({kind:"duration",...$i.errToObj(e)})}regex(e,i){return this._addCheck({kind:"regex",regex:e,...$i.errToObj(i)})}includes(e,i){return this._addCheck({kind:"includes",value:e,position:i?.position,...$i.errToObj(i?.message)})}startsWith(e,i){return this._addCheck({kind:"startsWith",value:e,...$i.errToObj(i)})}endsWith(e,i){return this._addCheck({kind:"endsWith",value:e,...$i.errToObj(i)})}min(e,i){return this._addCheck({kind:"min",value:e,...$i.errToObj(i)})}max(e,i){return this._addCheck({kind:"max",value:e,...$i.errToObj(i)})}length(e,i){return this._addCheck({kind:"length",value:e,...$i.errToObj(i)})}nonempty(e){return this.min(1,$i.errToObj(e))}trim(){return new Ca({...this._def,checks:[...this._def.checks,{kind:"trim"}]})}toLowerCase(){return new Ca({...this._def,checks:[...this._def.checks,{kind:"toLowerCase"}]})}toUpperCase(){return new Ca({...this._def,checks:[...this._def.checks,{kind:"toUpperCase"}]})}get isDatetime(){return!!this._def.checks.find(e=>e.kind==="datetime")}get isDate(){return!!this._def.checks.find(e=>e.kind==="date")}get isTime(){return!!this._def.checks.find(e=>e.kind==="time")}get isDuration(){return!!this._def.checks.find(e=>e.kind==="duration")}get isEmail(){return!!this._def.checks.find(e=>e.kind==="email")}get isURL(){return!!this._def.checks.find(e=>e.kind==="url")}get isEmoji(){return!!this._def.checks.find(e=>e.kind==="emoji")}get isUUID(){return!!this._def.checks.find(e=>e.kind==="uuid")}get isNANOID(){return!!this._def.checks.find(e=>e.kind==="nanoid")}get isCUID(){return!!this._def.checks.find(e=>e.kind==="cuid")}get isCUID2(){return!!this._def.checks.find(e=>e.kind==="cuid2")}get isULID(){return!!this._def.checks.find(e=>e.kind==="ulid")}get isIP(){return!!this._def.checks.find(e=>e.kind==="ip")}get isBase64(){return!!this._def.checks.find(e=>e.kind==="base64")}get minLength(){let e=null;for(const i of this._def.checks)i.kind==="min"&&(e===null||i.value>e)&&(e=i.value);return e}get maxLength(){let e=null;for(const i of this._def.checks)i.kind==="max"&&(e===null||i.value<e)&&(e=i.value);return e}}Ca.create=r=>{var e;return new Ca({checks:[],typeName:Yi.ZodString,coerce:(e=r?.coerce)!==null&&e!==void 0?e:!1,...lr(r)})};function tC(r,e){const i=(r.toString().split(".")[1]||"").length,s=(e.toString().split(".")[1]||"").length,h=i>s?i:s,x=parseInt(r.toFixed(h).replace(".","")),m=parseInt(e.toFixed(h).replace(".",""));return x%m/Math.pow(10,h)}class Su extends mr{constructor(){super(...arguments),this.min=this.gte,this.max=this.lte,this.step=this.multipleOf}_parse(e){if(this._def.coerce&&(e.data=Number(e.data)),this._getType(e)!==Ei.number){const h=this._getOrReturnCtx(e);return vi(h,{code:Yt.invalid_type,expected:Ei.number,received:h.parsedType}),Ki}let i;const s=new Ks;for(const h of this._def.checks)h.kind==="int"?Cr.isInteger(e.data)||(i=this._getOrReturnCtx(e,i),vi(i,{code:Yt.invalid_type,expected:"integer",received:"float",message:h.message}),s.dirty()):h.kind==="min"?(h.inclusive?e.data<h.value:e.data<=h.value)&&(i=this._getOrReturnCtx(e,i),vi(i,{code:Yt.too_small,minimum:h.value,type:"number",inclusive:h.inclusive,exact:!1,message:h.message}),s.dirty()):h.kind==="max"?(h.inclusive?e.data>h.value:e.data>=h.value)&&(i=this._getOrReturnCtx(e,i),vi(i,{code:Yt.too_big,maximum:h.value,type:"number",inclusive:h.inclusive,exact:!1,message:h.message}),s.dirty()):h.kind==="multipleOf"?tC(e.data,h.value)!==0&&(i=this._getOrReturnCtx(e,i),vi(i,{code:Yt.not_multiple_of,multipleOf:h.value,message:h.message}),s.dirty()):h.kind==="finite"?Number.isFinite(e.data)||(i=this._getOrReturnCtx(e,i),vi(i,{code:Yt.not_finite,message:h.message}),s.dirty()):Cr.assertNever(h);return{status:s.value,value:e.data}}gte(e,i){return this.setLimit("min",e,!0,$i.toString(i))}gt(e,i){return this.setLimit("min",e,!1,$i.toString(i))}lte(e,i){return this.setLimit("max",e,!0,$i.toString(i))}lt(e,i){return this.setLimit("max",e,!1,$i.toString(i))}setLimit(e,i,s,h){return new Su({...this._def,checks:[...this._def.checks,{kind:e,value:i,inclusive:s,message:$i.toString(h)}]})}_addCheck(e){return new Su({...this._def,checks:[...this._def.checks,e]})}int(e){return this._addCheck({kind:"int",message:$i.toString(e)})}positive(e){return this._addCheck({kind:"min",value:0,inclusive:!1,message:$i.toString(e)})}negative(e){return this._addCheck({kind:"max",value:0,inclusive:!1,message:$i.toString(e)})}nonpositive(e){return this._addCheck({kind:"max",value:0,inclusive:!0,message:$i.toString(e)})}nonnegative(e){return this._addCheck({kind:"min",value:0,inclusive:!0,message:$i.toString(e)})}multipleOf(e,i){return this._addCheck({kind:"multipleOf",value:e,message:$i.toString(i)})}finite(e){return this._addCheck({kind:"finite",message:$i.toString(e)})}safe(e){return this._addCheck({kind:"min",inclusive:!0,value:Number.MIN_SAFE_INTEGER,message:$i.toString(e)})._addCheck({kind:"max",inclusive:!0,value:Number.MAX_SAFE_INTEGER,message:$i.toString(e)})}get minValue(){let e=null;for(const i of this._def.checks)i.kind==="min"&&(e===null||i.value>e)&&(e=i.value);return e}get maxValue(){let e=null;for(const i of this._def.checks)i.kind==="max"&&(e===null||i.value<e)&&(e=i.value);return e}get isInt(){return!!this._def.checks.find(e=>e.kind==="int"||e.kind==="multipleOf"&&Cr.isInteger(e.value))}get isFinite(){let e=null,i=null;for(const s of this._def.checks){if(s.kind==="finite"||s.kind==="int"||s.kind==="multipleOf")return!0;s.kind==="min"?(i===null||s.value>i)&&(i=s.value):s.kind==="max"&&(e===null||s.value<e)&&(e=s.value)}return Number.isFinite(i)&&Number.isFinite(e)}}Su.create=r=>new Su({checks:[],typeName:Yi.ZodNumber,coerce:r?.coerce||!1,...lr(r)});class Mu extends mr{constructor(){super(...arguments),this.min=this.gte,this.max=this.lte}_parse(e){if(this._def.coerce&&(e.data=BigInt(e.data)),this._getType(e)!==Ei.bigint){const h=this._getOrReturnCtx(e);return vi(h,{code:Yt.invalid_type,expected:Ei.bigint,received:h.parsedType}),Ki}let i;const s=new Ks;for(const h of this._def.checks)h.kind==="min"?(h.inclusive?e.data<h.value:e.data<=h.value)&&(i=this._getOrReturnCtx(e,i),vi(i,{code:Yt.too_small,type:"bigint",minimum:h.value,inclusive:h.inclusive,message:h.message}),s.dirty()):h.kind==="max"?(h.inclusive?e.data>h.value:e.data>=h.value)&&(i=this._getOrReturnCtx(e,i),vi(i,{code:Yt.too_big,type:"bigint",maximum:h.value,inclusive:h.inclusive,message:h.message}),s.dirty()):h.kind==="multipleOf"?e.data%h.value!==BigInt(0)&&(i=this._getOrReturnCtx(e,i),vi(i,{code:Yt.not_multiple_of,multipleOf:h.value,message:h.message}),s.dirty()):Cr.assertNever(h);return{status:s.value,value:e.data}}gte(e,i){return this.setLimit("min",e,!0,$i.toString(i))}gt(e,i){return this.setLimit("min",e,!1,$i.toString(i))}lte(e,i){return this.setLimit("max",e,!0,$i.toString(i))}lt(e,i){return this.setLimit("max",e,!1,$i.toString(i))}setLimit(e,i,s,h){return new Mu({...this._def,checks:[...this._def.checks,{kind:e,value:i,inclusive:s,message:$i.toString(h)}]})}_addCheck(e){return new Mu({...this._def,checks:[...this._def.checks,e]})}positive(e){return this._addCheck({kind:"min",value:BigInt(0),inclusive:!1,message:$i.toString(e)})}negative(e){return this._addCheck({kind:"max",value:BigInt(0),inclusive:!1,message:$i.toString(e)})}nonpositive(e){return this._addCheck({kind:"max",value:BigInt(0),inclusive:!0,message:$i.toString(e)})}nonnegative(e){return this._addCheck({kind:"min",value:BigInt(0),inclusive:!0,message:$i.toString(e)})}multipleOf(e,i){return this._addCheck({kind:"multipleOf",value:e,message:$i.toString(i)})}get minValue(){let e=null;for(const i of this._def.checks)i.kind==="min"&&(e===null||i.value>e)&&(e=i.value);return e}get maxValue(){let e=null;for(const i of this._def.checks)i.kind==="max"&&(e===null||i.value<e)&&(e=i.value);return e}}Mu.create=r=>{var e;return new Mu({checks:[],typeName:Yi.ZodBigInt,coerce:(e=r?.coerce)!==null&&e!==void 0?e:!1,...lr(r)})};class Yd extends mr{_parse(e){if(this._def.coerce&&(e.data=!!e.data),this._getType(e)!==Ei.boolean){const i=this._getOrReturnCtx(e);return vi(i,{code:Yt.invalid_type,expected:Ei.boolean,received:i.parsedType}),Ki}return co(e.data)}}Yd.create=r=>new Yd({typeName:Yi.ZodBoolean,coerce:r?.coerce||!1,...lr(r)});class fc extends mr{_parse(e){if(this._def.coerce&&(e.data=new Date(e.data)),this._getType(e)!==Ei.date){const h=this._getOrReturnCtx(e);return vi(h,{code:Yt.invalid_type,expected:Ei.date,received:h.parsedType}),Ki}if(isNaN(e.data.getTime())){const h=this._getOrReturnCtx(e);return vi(h,{code:Yt.invalid_date}),Ki}const i=new Ks;let s;for(const h of this._def.checks)h.kind==="min"?e.data.getTime()<h.value&&(s=this._getOrReturnCtx(e,s),vi(s,{code:Yt.too_small,message:h.message,inclusive:!0,exact:!1,minimum:h.value,type:"date"}),i.dirty()):h.kind==="max"?e.data.getTime()>h.value&&(s=this._getOrReturnCtx(e,s),vi(s,{code:Yt.too_big,message:h.message,inclusive:!0,exact:!1,maximum:h.value,type:"date"}),i.dirty()):Cr.assertNever(h);return{status:i.value,value:new Date(e.data.getTime())}}_addCheck(e){return new fc({...this._def,checks:[...this._def.checks,e]})}min(e,i){return this._addCheck({kind:"min",value:e.getTime(),message:$i.toString(i)})}max(e,i){return this._addCheck({kind:"max",value:e.getTime(),message:$i.toString(i)})}get minDate(){let e=null;for(const i of this._def.checks)i.kind==="min"&&(e===null||i.value>e)&&(e=i.value);return e!=null?new Date(e):null}get maxDate(){let e=null;for(const i of this._def.checks)i.kind==="max"&&(e===null||i.value<e)&&(e=i.value);return e!=null?new Date(e):null}}fc.create=r=>new fc({checks:[],coerce:r?.coerce||!1,typeName:Yi.ZodDate,...lr(r)});class hm extends mr{_parse(e){if(this._getType(e)!==Ei.symbol){const i=this._getOrReturnCtx(e);return vi(i,{code:Yt.invalid_type,expected:Ei.symbol,received:i.parsedType}),Ki}return co(e.data)}}hm.create=r=>new hm({typeName:Yi.ZodSymbol,...lr(r)});class Xd extends mr{_parse(e){if(this._getType(e)!==Ei.undefined){const i=this._getOrReturnCtx(e);return vi(i,{code:Yt.invalid_type,expected:Ei.undefined,received:i.parsedType}),Ki}return co(e.data)}}Xd.create=r=>new Xd({typeName:Yi.ZodUndefined,...lr(r)});class Hd extends mr{_parse(e){if(this._getType(e)!==Ei.null){const i=this._getOrReturnCtx(e);return vi(i,{code:Yt.invalid_type,expected:Ei.null,received:i.parsedType}),Ki}return co(e.data)}}Hd.create=r=>new Hd({typeName:Yi.ZodNull,...lr(r)});class yh extends mr{constructor(){super(...arguments),this._any=!0}_parse(e){return co(e.data)}}yh.create=r=>new yh({typeName:Yi.ZodAny,...lr(r)});class dc extends mr{constructor(){super(...arguments),this._unknown=!0}_parse(e){return co(e.data)}}dc.create=r=>new dc({typeName:Yi.ZodUnknown,...lr(r)});class Gl extends mr{_parse(e){const i=this._getOrReturnCtx(e);return vi(i,{code:Yt.invalid_type,expected:Ei.never,received:i.parsedType}),Ki}}Gl.create=r=>new Gl({typeName:Yi.ZodNever,...lr(r)});class dm extends mr{_parse(e){if(this._getType(e)!==Ei.undefined){const i=this._getOrReturnCtx(e);return vi(i,{code:Yt.invalid_type,expected:Ei.void,received:i.parsedType}),Ki}return co(e.data)}}dm.create=r=>new dm({typeName:Yi.ZodVoid,...lr(r)});class Ra extends mr{_parse(e){const{ctx:i,status:s}=this._processInputParams(e),h=this._def;if(i.parsedType!==Ei.array)return vi(i,{code:Yt.invalid_type,expected:Ei.array,received:i.parsedType}),Ki;if(h.exactLength!==null){const m=i.data.length>h.exactLength.value,o=i.data.length<h.exactLength.value;(m||o)&&(vi(i,{code:m?Yt.too_big:Yt.too_small,minimum:o?h.exactLength.value:void 0,maximum:m?h.exactLength.value:void 0,type:"array",inclusive:!0,exact:!0,message:h.exactLength.message}),s.dirty())}if(h.minLength!==null&&i.data.length<h.minLength.value&&(vi(i,{code:Yt.too_small,minimum:h.minLength.value,type:"array",inclusive:!0,exact:!1,message:h.minLength.message}),s.dirty()),h.maxLength!==null&&i.data.length>h.maxLength.value&&(vi(i,{code:Yt.too_big,maximum:h.maxLength.value,type:"array",inclusive:!0,exact:!1,message:h.maxLength.message}),s.dirty()),i.common.async)return Promise.all([...i.data].map((m,o)=>h.type._parseAsync(new ll(i,m,i.path,o)))).then(m=>Ks.mergeArray(s,m));const x=[...i.data].map((m,o)=>h.type._parseSync(new ll(i,m,i.path,o)));return Ks.mergeArray(s,x)}get element(){return this._def.type}min(e,i){return new Ra({...this._def,minLength:{value:e,message:$i.toString(i)}})}max(e,i){return new Ra({...this._def,maxLength:{value:e,message:$i.toString(i)}})}length(e,i){return new Ra({...this._def,exactLength:{value:e,message:$i.toString(i)}})}nonempty(e){return this.min(1,e)}}Ra.create=(r,e)=>new Ra({type:r,minLength:null,maxLength:null,exactLength:null,typeName:Yi.ZodArray,...lr(e)});function oh(r){if(r instanceof Ln){const e={};for(const i in r.shape){const s=r.shape[i];e[i]=al.create(oh(s))}return new Ln({...r._def,shape:()=>e})}else return r instanceof Ra?new Ra({...r._def,type:oh(r.element)}):r instanceof al?al.create(oh(r.unwrap())):r instanceof ku?ku.create(oh(r.unwrap())):r instanceof ul?ul.create(r.items.map(e=>oh(e))):r}class Ln extends mr{constructor(){super(...arguments),this._cached=null,this.nonstrict=this.passthrough,this.augment=this.extend}_getCached(){if(this._cached!==null)return this._cached;const e=this._def.shape(),i=Cr.objectKeys(e);return this._cached={shape:e,keys:i}}_parse(e){if(this._getType(e)!==Ei.object){const P=this._getOrReturnCtx(e);return vi(P,{code:Yt.invalid_type,expected:Ei.object,received:P.parsedType}),Ki}const{status:i,ctx:s}=this._processInputParams(e),{shape:h,keys:x}=this._getCached(),m=[];if(!(this._def.catchall instanceof Gl&&this._def.unknownKeys==="strip"))for(const P in s.data)x.includes(P)||m.push(P);const o=[];for(const P of x){const L=h[P],D=s.data[P];o.push({key:{status:"valid",value:P},value:L._parse(new ll(s,D,s.path,P)),alwaysSet:P in s.data})}if(this._def.catchall instanceof Gl){const P=this._def.unknownKeys;if(P==="passthrough")for(const L of m)o.push({key:{status:"valid",value:L},value:{status:"valid",value:s.data[L]}});else if(P==="strict")m.length>0&&(vi(s,{code:Yt.unrecognized_keys,keys:m}),i.dirty());else if(P!=="strip")throw new Error("Internal ZodObject error: invalid unknownKeys value.")}else{const P=this._def.catchall;for(const L of m){const D=s.data[L];o.push({key:{status:"valid",value:L},value:P._parse(new ll(s,D,s.path,L)),alwaysSet:L in s.data})}}return s.common.async?Promise.resolve().then(async()=>{const P=[];for(const L of o){const D=await L.key,F=await L.value;P.push({key:D,value:F,alwaysSet:L.alwaysSet})}return P}).then(P=>Ks.mergeObjectSync(i,P)):Ks.mergeObjectSync(i,o)}get shape(){return this._def.shape()}strict(e){return $i.errToObj,new Ln({...this._def,unknownKeys:"strict",...e!==void 0?{errorMap:(i,s)=>{var h,x,m,o;const P=(m=(x=(h=this._def).errorMap)===null||x===void 0?void 0:x.call(h,i,s).message)!==null&&m!==void 0?m:s.defaultError;return i.code==="unrecognized_keys"?{message:(o=$i.errToObj(e).message)!==null&&o!==void 0?o:P}:{message:P}}}:{}})}strip(){return new Ln({...this._def,unknownKeys:"strip"})}passthrough(){return new Ln({...this._def,unknownKeys:"passthrough"})}extend(e){return new Ln({...this._def,shape:()=>({...this._def.shape(),...e})})}merge(e){return new Ln({unknownKeys:e._def.unknownKeys,catchall:e._def.catchall,shape:()=>({...this._def.shape(),...e._def.shape()}),typeName:Yi.ZodObject})}setKey(e,i){return this.augment({[e]:i})}catchall(e){return new Ln({...this._def,catchall:e})}pick(e){const i={};return Cr.objectKeys(e).forEach(s=>{e[s]&&this.shape[s]&&(i[s]=this.shape[s])}),new Ln({...this._def,shape:()=>i})}omit(e){const i={};return Cr.objectKeys(this.shape).forEach(s=>{e[s]||(i[s]=this.shape[s])}),new Ln({...this._def,shape:()=>i})}deepPartial(){return oh(this)}partial(e){const i={};return Cr.objectKeys(this.shape).forEach(s=>{const h=this.shape[s];e&&!e[s]?i[s]=h:i[s]=h.optional()}),new Ln({...this._def,shape:()=>i})}required(e){const i={};return Cr.objectKeys(this.shape).forEach(s=>{if(e&&!e[s])i[s]=this.shape[s];else{let h=this.shape[s];for(;h instanceof al;)h=h._def.innerType;i[s]=h}}),new Ln({...this._def,shape:()=>i})}keyof(){return Tw(Cr.objectKeys(this.shape))}}Ln.create=(r,e)=>new Ln({shape:()=>r,unknownKeys:"strip",catchall:Gl.create(),typeName:Yi.ZodObject,...lr(e)});Ln.strictCreate=(r,e)=>new Ln({shape:()=>r,unknownKeys:"strict",catchall:Gl.create(),typeName:Yi.ZodObject,...lr(e)});Ln.lazycreate=(r,e)=>new Ln({shape:r,unknownKeys:"strip",catchall:Gl.create(),typeName:Yi.ZodObject,...lr(e)});class Kd extends mr{_parse(e){const{ctx:i}=this._processInputParams(e),s=this._def.options;function h(x){for(const o of x)if(o.result.status==="valid")return o.result;for(const o of x)if(o.result.status==="dirty")return i.common.issues.push(...o.ctx.common.issues),o.result;const m=x.map(o=>new Vo(o.ctx.common.issues));return vi(i,{code:Yt.invalid_union,unionErrors:m}),Ki}if(i.common.async)return Promise.all(s.map(async x=>{const m={...i,common:{...i.common,issues:[]},parent:null};return{result:await x._parseAsync({data:i.data,path:i.path,parent:m}),ctx:m}})).then(h);{let x;const m=[];for(const P of s){const L={...i,common:{...i.common,issues:[]},parent:null},D=P._parseSync({data:i.data,path:i.path,parent:L});if(D.status==="valid")return D;D.status==="dirty"&&!x&&(x={result:D,ctx:L}),L.common.issues.length&&m.push(L.common.issues)}if(x)return i.common.issues.push(...x.ctx.common.issues),x.result;const o=m.map(P=>new Vo(P));return vi(i,{code:Yt.invalid_union,unionErrors:o}),Ki}}get options(){return this._def.options}}Kd.create=(r,e)=>new Kd({options:r,typeName:Yi.ZodUnion,...lr(e)});const bu=r=>r instanceof ep?bu(r.schema):r instanceof Na?bu(r.innerType()):r instanceof tp?[r.value]:r instanceof Pu?r.options:r instanceof ip?Cr.objectValues(r.enum):r instanceof rp?bu(r._def.innerType):r instanceof Xd?[void 0]:r instanceof Hd?[null]:r instanceof al?[void 0,...bu(r.unwrap())]:r instanceof ku?[null,...bu(r.unwrap())]:r instanceof A_||r instanceof sp?bu(r.unwrap()):r instanceof np?bu(r._def.innerType):[];class Om extends mr{_parse(e){const{ctx:i}=this._processInputParams(e);if(i.parsedType!==Ei.object)return vi(i,{code:Yt.invalid_type,expected:Ei.object,received:i.parsedType}),Ki;const s=this.discriminator,h=i.data[s],x=this.optionsMap.get(h);return x?i.common.async?x._parseAsync({data:i.data,path:i.path,parent:i}):x._parseSync({data:i.data,path:i.path,parent:i}):(vi(i,{code:Yt.invalid_union_discriminator,options:Array.from(this.optionsMap.keys()),path:[s]}),Ki)}get discriminator(){return this._def.discriminator}get options(){return this._def.options}get optionsMap(){return this._def.optionsMap}static create(e,i,s){const h=new Map;for(const x of i){const m=bu(x.shape[e]);if(!m.length)throw new Error(`A discriminator value for key \`${e}\` could not be extracted from all schema options`);for(const o of m){if(h.has(o))throw new Error(`Discriminator property ${String(e)} has duplicate value ${String(o)}`);h.set(o,x)}}return new Om({typeName:Yi.ZodDiscriminatedUnion,discriminator:e,options:i,optionsMap:h,...lr(s)})}}function Vy(r,e){const i=wu(r),s=wu(e);if(r===e)return{valid:!0,data:r};if(i===Ei.object&&s===Ei.object){const h=Cr.objectKeys(e),x=Cr.objectKeys(r).filter(o=>h.indexOf(o)!==-1),m={...r,...e};for(const o of x){const P=Vy(r[o],e[o]);if(!P.valid)return{valid:!1};m[o]=P.data}return{valid:!0,data:m}}else if(i===Ei.array&&s===Ei.array){if(r.length!==e.length)return{valid:!1};const h=[];for(let x=0;x<r.length;x++){const m=r[x],o=e[x],P=Vy(m,o);if(!P.valid)return{valid:!1};h.push(P.data)}return{valid:!0,data:h}}else return i===Ei.date&&s===Ei.date&&+r==+e?{valid:!0,data:r}:{valid:!1}}class Jd extends mr{_parse(e){const{status:i,ctx:s}=this._processInputParams(e),h=(x,m)=>{if(Gy(x)||Gy(m))return Ki;const o=Vy(x.value,m.value);return o.valid?((Uy(x)||Uy(m))&&i.dirty(),{status:i.value,value:o.data}):(vi(s,{code:Yt.invalid_intersection_types}),Ki)};return s.common.async?Promise.all([this._def.left._parseAsync({data:s.data,path:s.path,parent:s}),this._def.right._parseAsync({data:s.data,path:s.path,parent:s})]).then(([x,m])=>h(x,m)):h(this._def.left._parseSync({data:s.data,path:s.path,parent:s}),this._def.right._parseSync({data:s.data,path:s.path,parent:s}))}}Jd.create=(r,e,i)=>new Jd({left:r,right:e,typeName:Yi.ZodIntersection,...lr(i)});class ul extends mr{_parse(e){const{status:i,ctx:s}=this._processInputParams(e);if(s.parsedType!==Ei.array)return vi(s,{code:Yt.invalid_type,expected:Ei.array,received:s.parsedType}),Ki;if(s.data.length<this._def.items.length)return vi(s,{code:Yt.too_small,minimum:this._def.items.length,inclusive:!0,exact:!1,type:"array"}),Ki;!this._def.rest&&s.data.length>this._def.items.length&&(vi(s,{code:Yt.too_big,maximum:this._def.items.length,inclusive:!0,exact:!1,type:"array"}),i.dirty());const h=[...s.data].map((x,m)=>{const o=this._def.items[m]||this._def.rest;return o?o._parse(new ll(s,x,s.path,m)):null}).filter(x=>!!x);return s.common.async?Promise.all(h).then(x=>Ks.mergeArray(i,x)):Ks.mergeArray(i,h)}get items(){return this._def.items}rest(e){return new ul({...this._def,rest:e})}}ul.create=(r,e)=>{if(!Array.isArray(r))throw new Error("You must pass an array of schemas to z.tuple([ ... ])");return new ul({items:r,typeName:Yi.ZodTuple,rest:null,...lr(e)})};class Qd extends mr{get keySchema(){return this._def.keyType}get valueSchema(){return this._def.valueType}_parse(e){const{status:i,ctx:s}=this._processInputParams(e);if(s.parsedType!==Ei.object)return vi(s,{code:Yt.invalid_type,expected:Ei.object,received:s.parsedType}),Ki;const h=[],x=this._def.keyType,m=this._def.valueType;for(const o in s.data)h.push({key:x._parse(new ll(s,o,s.path,o)),value:m._parse(new ll(s,s.data[o],s.path,o)),alwaysSet:o in s.data});return s.common.async?Ks.mergeObjectAsync(i,h):Ks.mergeObjectSync(i,h)}get element(){return this._def.valueType}static create(e,i,s){return i instanceof mr?new Qd({keyType:e,valueType:i,typeName:Yi.ZodRecord,...lr(s)}):new Qd({keyType:Ca.create(),valueType:e,typeName:Yi.ZodRecord,...lr(i)})}}class pm extends mr{get keySchema(){return this._def.keyType}get valueSchema(){return this._def.valueType}_parse(e){const{status:i,ctx:s}=this._processInputParams(e);if(s.parsedType!==Ei.map)return vi(s,{code:Yt.invalid_type,expected:Ei.map,received:s.parsedType}),Ki;const h=this._def.keyType,x=this._def.valueType,m=[...s.data.entries()].map(([o,P],L)=>({key:h._parse(new ll(s,o,s.path,[L,"key"])),value:x._parse(new ll(s,P,s.path,[L,"value"]))}));if(s.common.async){const o=new Map;return Promise.resolve().then(async()=>{for(const P of m){const L=await P.key,D=await P.value;if(L.status==="aborted"||D.status==="aborted")return Ki;(L.status==="dirty"||D.status==="dirty")&&i.dirty(),o.set(L.value,D.value)}return{status:i.value,value:o}})}else{const o=new Map;for(const P of m){const L=P.key,D=P.value;if(L.status==="aborted"||D.status==="aborted")return Ki;(L.status==="dirty"||D.status==="dirty")&&i.dirty(),o.set(L.value,D.value)}return{status:i.value,value:o}}}}pm.create=(r,e,i)=>new pm({valueType:e,keyType:r,typeName:Yi.ZodMap,...lr(i)});class mc extends mr{_parse(e){const{status:i,ctx:s}=this._processInputParams(e);if(s.parsedType!==Ei.set)return vi(s,{code:Yt.invalid_type,expected:Ei.set,received:s.parsedType}),Ki;const h=this._def;h.minSize!==null&&s.data.size<h.minSize.value&&(vi(s,{code:Yt.too_small,minimum:h.minSize.value,type:"set",inclusive:!0,exact:!1,message:h.minSize.message}),i.dirty()),h.maxSize!==null&&s.data.size>h.maxSize.value&&(vi(s,{code:Yt.too_big,maximum:h.maxSize.value,type:"set",inclusive:!0,exact:!1,message:h.maxSize.message}),i.dirty());const x=this._def.valueType;function m(P){const L=new Set;for(const D of P){if(D.status==="aborted")return Ki;D.status==="dirty"&&i.dirty(),L.add(D.value)}return{status:i.value,value:L}}const o=[...s.data.values()].map((P,L)=>x._parse(new ll(s,P,s.path,L)));return s.common.async?Promise.all(o).then(P=>m(P)):m(o)}min(e,i){return new mc({...this._def,minSize:{value:e,message:$i.toString(i)}})}max(e,i){return new mc({...this._def,maxSize:{value:e,message:$i.toString(i)}})}size(e,i){return this.min(e,i).max(e,i)}nonempty(e){return this.min(1,e)}}mc.create=(r,e)=>new mc({valueType:r,minSize:null,maxSize:null,typeName:Yi.ZodSet,...lr(e)});class ph extends mr{constructor(){super(...arguments),this.validate=this.implement}_parse(e){const{ctx:i}=this._processInputParams(e);if(i.parsedType!==Ei.function)return vi(i,{code:Yt.invalid_type,expected:Ei.function,received:i.parsedType}),Ki;function s(o,P){return lm({data:o,path:i.path,errorMaps:[i.common.contextualErrorMap,i.schemaErrorMap,am(),gh].filter(L=>!!L),issueData:{code:Yt.invalid_arguments,argumentsError:P}})}function h(o,P){return lm({data:o,path:i.path,errorMaps:[i.common.contextualErrorMap,i.schemaErrorMap,am(),gh].filter(L=>!!L),issueData:{code:Yt.invalid_return_type,returnTypeError:P}})}const x={errorMap:i.common.contextualErrorMap},m=i.data;if(this._def.returns instanceof _h){const o=this;return co(async function(...P){const L=new Vo([]),D=await o._def.args.parseAsync(P,x).catch(Y=>{throw L.addIssue(s(P,Y)),L}),F=await Reflect.apply(m,this,D);return await o._def.returns._def.type.parseAsync(F,x).catch(Y=>{throw L.addIssue(h(F,Y)),L})})}else{const o=this;return co(function(...P){const L=o._def.args.safeParse(P,x);if(!L.success)throw new Vo([s(P,L.error)]);const D=Reflect.apply(m,this,L.data),F=o._def.returns.safeParse(D,x);if(!F.success)throw new Vo([h(D,F.error)]);return F.data})}}parameters(){return this._def.args}returnType(){return this._def.returns}args(...e){return new ph({...this._def,args:ul.create(e).rest(dc.create())})}returns(e){return new ph({...this._def,returns:e})}implement(e){return this.parse(e)}strictImplement(e){return this.parse(e)}static create(e,i,s){return new ph({args:e||ul.create([]).rest(dc.create()),returns:i||dc.create(),typeName:Yi.ZodFunction,...lr(s)})}}class ep extends mr{get schema(){return this._def.getter()}_parse(e){const{ctx:i}=this._processInputParams(e);return this._def.getter()._parse({data:i.data,path:i.path,parent:i})}}ep.create=(r,e)=>new ep({getter:r,typeName:Yi.ZodLazy,...lr(e)});class tp extends mr{_parse(e){if(e.data!==this._def.value){const i=this._getOrReturnCtx(e);return vi(i,{received:i.data,code:Yt.invalid_literal,expected:this._def.value}),Ki}return{status:"valid",value:e.data}}get value(){return this._def.value}}tp.create=(r,e)=>new tp({value:r,typeName:Yi.ZodLiteral,...lr(e)});function Tw(r,e){return new Pu({values:r,typeName:Yi.ZodEnum,...lr(e)})}class Pu extends mr{constructor(){super(...arguments),Ad.set(this,void 0)}_parse(e){if(typeof e.data!="string"){const i=this._getOrReturnCtx(e),s=this._def.values;return vi(i,{expected:Cr.joinValues(s),received:i.parsedType,code:Yt.invalid_type}),Ki}if(cm(this,Ad)||vw(this,Ad,new Set(this._def.values)),!cm(this,Ad).has(e.data)){const i=this._getOrReturnCtx(e),s=this._def.values;return vi(i,{received:i.data,code:Yt.invalid_enum_value,options:s}),Ki}return co(e.data)}get options(){return this._def.values}get enum(){const e={};for(const i of this._def.values)e[i]=i;return e}get Values(){const e={};for(const i of this._def.values)e[i]=i;return e}get Enum(){const e={};for(const i of this._def.values)e[i]=i;return e}extract(e,i=this._def){return Pu.create(e,{...this._def,...i})}exclude(e,i=this._def){return Pu.create(this.options.filter(s=>!e.includes(s)),{...this._def,...i})}}Ad=new WeakMap;Pu.create=Tw;class ip extends mr{constructor(){super(...arguments),Ld.set(this,void 0)}_parse(e){const i=Cr.getValidEnumValues(this._def.values),s=this._getOrReturnCtx(e);if(s.parsedType!==Ei.string&&s.parsedType!==Ei.number){const h=Cr.objectValues(i);return vi(s,{expected:Cr.joinValues(h),received:s.parsedType,code:Yt.invalid_type}),Ki}if(cm(this,Ld)||vw(this,Ld,new Set(Cr.getValidEnumValues(this._def.values))),!cm(this,Ld).has(e.data)){const h=Cr.objectValues(i);return vi(s,{received:s.data,code:Yt.invalid_enum_value,options:h}),Ki}return co(e.data)}get enum(){return this._def.values}}Ld=new WeakMap;ip.create=(r,e)=>new ip({values:r,typeName:Yi.ZodNativeEnum,...lr(e)});class _h extends mr{unwrap(){return this._def.type}_parse(e){const{ctx:i}=this._processInputParams(e);if(i.parsedType!==Ei.promise&&i.common.async===!1)return vi(i,{code:Yt.invalid_type,expected:Ei.promise,received:i.parsedType}),Ki;const s=i.parsedType===Ei.promise?i.data:Promise.resolve(i.data);return co(s.then(h=>this._def.type.parseAsync(h,{path:i.path,errorMap:i.common.contextualErrorMap})))}}_h.create=(r,e)=>new _h({type:r,typeName:Yi.ZodPromise,...lr(e)});class Na extends mr{innerType(){return this._def.schema}sourceType(){return this._def.schema._def.typeName===Yi.ZodEffects?this._def.schema.sourceType():this._def.schema}_parse(e){const{status:i,ctx:s}=this._processInputParams(e),h=this._def.effect||null,x={addIssue:m=>{vi(s,m),m.fatal?i.abort():i.dirty()},get path(){return s.path}};if(x.addIssue=x.addIssue.bind(x),h.type==="preprocess"){const m=h.transform(s.data,x);if(s.common.async)return Promise.resolve(m).then(async o=>{if(i.value==="aborted")return Ki;const P=await this._def.schema._parseAsync({data:o,path:s.path,parent:s});return P.status==="aborted"?Ki:P.status==="dirty"||i.value==="dirty"?um(P.value):P});{if(i.value==="aborted")return Ki;const o=this._def.schema._parseSync({data:m,path:s.path,parent:s});return o.status==="aborted"?Ki:o.status==="dirty"||i.value==="dirty"?um(o.value):o}}if(h.type==="refinement"){const m=o=>{const P=h.refinement(o,x);if(s.common.async)return Promise.resolve(P);if(P instanceof Promise)throw new Error("Async refinement encountered during synchronous parse operation. Use .parseAsync instead.");return o};if(s.common.async===!1){const o=this._def.schema._parseSync({data:s.data,path:s.path,parent:s});return o.status==="aborted"?Ki:(o.status==="dirty"&&i.dirty(),m(o.value),{status:i.value,value:o.value})}else return this._def.schema._parseAsync({data:s.data,path:s.path,parent:s}).then(o=>o.status==="aborted"?Ki:(o.status==="dirty"&&i.dirty(),m(o.value).then(()=>({status:i.value,value:o.value}))))}if(h.type==="transform")if(s.common.async===!1){const m=this._def.schema._parseSync({data:s.data,path:s.path,parent:s});if(!Zd(m))return m;const o=h.transform(m.value,x);if(o instanceof Promise)throw new Error("Asynchronous transform encountered during synchronous parse operation. Use .parseAsync instead.");return{status:i.value,value:o}}else return this._def.schema._parseAsync({data:s.data,path:s.path,parent:s}).then(m=>Zd(m)?Promise.resolve(h.transform(m.value,x)).then(o=>({status:i.value,value:o})):m);Cr.assertNever(h)}}Na.create=(r,e,i)=>new Na({schema:r,typeName:Yi.ZodEffects,effect:e,...lr(i)});Na.createWithPreprocess=(r,e,i)=>new Na({schema:e,effect:{type:"preprocess",transform:r},typeName:Yi.ZodEffects,...lr(i)});class al extends mr{_parse(e){return this._getType(e)===Ei.undefined?co(void 0):this._def.innerType._parse(e)}unwrap(){return this._def.innerType}}al.create=(r,e)=>new al({innerType:r,typeName:Yi.ZodOptional,...lr(e)});class ku extends mr{_parse(e){return this._getType(e)===Ei.null?co(null):this._def.innerType._parse(e)}unwrap(){return this._def.innerType}}ku.create=(r,e)=>new ku({innerType:r,typeName:Yi.ZodNullable,...lr(e)});class rp extends mr{_parse(e){const{ctx:i}=this._processInputParams(e);let s=i.data;return i.parsedType===Ei.undefined&&(s=this._def.defaultValue()),this._def.innerType._parse({data:s,path:i.path,parent:i})}removeDefault(){return this._def.innerType}}rp.create=(r,e)=>new rp({innerType:r,typeName:Yi.ZodDefault,defaultValue:typeof e.default=="function"?e.default:()=>e.default,...lr(e)});class np extends mr{_parse(e){const{ctx:i}=this._processInputParams(e),s={...i,common:{...i.common,issues:[]}},h=this._def.innerType._parse({data:s.data,path:s.path,parent:{...s}});return Wd(h)?h.then(x=>({status:"valid",value:x.status==="valid"?x.value:this._def.catchValue({get error(){return new Vo(s.common.issues)},input:s.data})})):{status:"valid",value:h.status==="valid"?h.value:this._def.catchValue({get error(){return new Vo(s.common.issues)},input:s.data})}}removeCatch(){return this._def.innerType}}np.create=(r,e)=>new np({innerType:r,typeName:Yi.ZodCatch,catchValue:typeof e.catch=="function"?e.catch:()=>e.catch,...lr(e)});class fm extends mr{_parse(e){if(this._getType(e)!==Ei.nan){const i=this._getOrReturnCtx(e);return vi(i,{code:Yt.invalid_type,expected:Ei.nan,received:i.parsedType}),Ki}return{status:"valid",value:e.data}}}fm.create=r=>new fm({typeName:Yi.ZodNaN,...lr(r)});const iC=Symbol("zod_brand");class A_ extends mr{_parse(e){const{ctx:i}=this._processInputParams(e),s=i.data;return this._def.type._parse({data:s,path:i.path,parent:i})}unwrap(){return this._def.type}}class pp extends mr{_parse(e){const{status:i,ctx:s}=this._processInputParams(e);if(s.common.async)return(async()=>{const h=await this._def.in._parseAsync({data:s.data,path:s.path,parent:s});return h.status==="aborted"?Ki:h.status==="dirty"?(i.dirty(),um(h.value)):this._def.out._parseAsync({data:h.value,path:s.path,parent:s})})();{const h=this._def.in._parseSync({data:s.data,path:s.path,parent:s});return h.status==="aborted"?Ki:h.status==="dirty"?(i.dirty(),{status:"dirty",value:h.value}):this._def.out._parseSync({data:h.value,path:s.path,parent:s})}}static create(e,i){return new pp({in:e,out:i,typeName:Yi.ZodPipeline})}}class sp extends mr{_parse(e){const i=this._def.innerType._parse(e),s=h=>(Zd(h)&&(h.value=Object.freeze(h.value)),h);return Wd(i)?i.then(h=>s(h)):s(i)}unwrap(){return this._def.innerType}}sp.create=(r,e)=>new sp({innerType:r,typeName:Yi.ZodReadonly,...lr(e)});function Ew(r,e={},i){return r?yh.create().superRefine((s,h)=>{var x,m;if(!r(s)){const o=typeof e=="function"?e(s):typeof e=="string"?{message:e}:e,P=(m=(x=o.fatal)!==null&&x!==void 0?x:i)!==null&&m!==void 0?m:!0,L=typeof o=="string"?{message:o}:o;h.addIssue({code:"custom",...L,fatal:P})}}):yh.create()}const rC={object:Ln.lazycreate};var Yi;(function(r){r.ZodString="ZodString",r.ZodNumber="ZodNumber",r.ZodNaN="ZodNaN",r.ZodBigInt="ZodBigInt",r.ZodBoolean="ZodBoolean",r.ZodDate="ZodDate",r.ZodSymbol="ZodSymbol",r.ZodUndefined="ZodUndefined",r.ZodNull="ZodNull",r.ZodAny="ZodAny",r.ZodUnknown="ZodUnknown",r.ZodNever="ZodNever",r.ZodVoid="ZodVoid",r.ZodArray="ZodArray",r.ZodObject="ZodObject",r.ZodUnion="ZodUnion",r.ZodDiscriminatedUnion="ZodDiscriminatedUnion",r.ZodIntersection="ZodIntersection",r.ZodTuple="ZodTuple",r.ZodRecord="ZodRecord",r.ZodMap="ZodMap",r.ZodSet="ZodSet",r.ZodFunction="ZodFunction",r.ZodLazy="ZodLazy",r.ZodLiteral="ZodLiteral",r.ZodEnum="ZodEnum",r.ZodEffects="ZodEffects",r.ZodNativeEnum="ZodNativeEnum",r.ZodOptional="ZodOptional",r.ZodNullable="ZodNullable",r.ZodDefault="ZodDefault",r.ZodCatch="ZodCatch",r.ZodPromise="ZodPromise",r.ZodBranded="ZodBranded",r.ZodPipeline="ZodPipeline",r.ZodReadonly="ZodReadonly"})(Yi||(Yi={}));const nC=(r,e={message:`Input not instance of ${r.name}`})=>Ew(i=>i instanceof r,e),Iw=Ca.create,Sw=Su.create,sC=fm.create,oC=Mu.create,Mw=Yd.create,aC=fc.create,lC=hm.create,uC=Xd.create,cC=Hd.create,hC=yh.create,dC=dc.create,pC=Gl.create,fC=dm.create,mC=Ra.create,gC=Ln.create,yC=Ln.strictCreate,_C=Kd.create,vC=Om.create,xC=Jd.create,bC=ul.create,wC=Qd.create,TC=pm.create,EC=mc.create,IC=ph.create,SC=ep.create,MC=tp.create,PC=Pu.create,kC=ip.create,CC=_h.create,e1=Na.create,AC=al.create,LC=ku.create,RC=Na.createWithPreprocess,NC=pp.create,OC=()=>Iw().optional(),DC=()=>Sw().optional(),FC=()=>Mw().optional(),zC={string:r=>Ca.create({...r,coerce:!0}),number:r=>Su.create({...r,coerce:!0}),boolean:r=>Yd.create({...r,coerce:!0}),bigint:r=>Mu.create({...r,coerce:!0}),date:r=>fc.create({...r,coerce:!0})},BC=Ki;var Ye=Object.freeze({__proto__:null,defaultErrorMap:gh,setErrorMap:Bk,getErrorMap:am,makeIssue:lm,EMPTY_PATH:$k,addIssueToContext:vi,ParseStatus:Ks,INVALID:Ki,DIRTY:um,OK:co,isAborted:Gy,isDirty:Uy,isValid:Zd,isAsync:Wd,get util(){return Cr},get objectUtil(){return jy},ZodParsedType:Ei,getParsedType:wu,ZodType:mr,datetimeRegex:ww,ZodString:Ca,ZodNumber:Su,ZodBigInt:Mu,ZodBoolean:Yd,ZodDate:fc,ZodSymbol:hm,ZodUndefined:Xd,ZodNull:Hd,ZodAny:yh,ZodUnknown:dc,ZodNever:Gl,ZodVoid:dm,ZodArray:Ra,ZodObject:Ln,ZodUnion:Kd,ZodDiscriminatedUnion:Om,ZodIntersection:Jd,ZodTuple:ul,ZodRecord:Qd,ZodMap:pm,ZodSet:mc,ZodFunction:ph,ZodLazy:ep,ZodLiteral:tp,ZodEnum:Pu,ZodNativeEnum:ip,ZodPromise:_h,ZodEffects:Na,ZodTransformer:Na,ZodOptional:al,ZodNullable:ku,ZodDefault:rp,ZodCatch:np,ZodNaN:fm,BRAND:iC,ZodBranded:A_,ZodPipeline:pp,ZodReadonly:sp,custom:Ew,Schema:mr,ZodSchema:mr,late:rC,get ZodFirstPartyTypeKind(){return Yi},coerce:zC,any:hC,array:mC,bigint:oC,boolean:Mw,date:aC,discriminatedUnion:vC,effect:e1,enum:PC,function:IC,instanceof:nC,intersection:xC,lazy:SC,literal:MC,map:TC,nan:sC,nativeEnum:kC,never:pC,null:cC,nullable:LC,number:Sw,object:gC,oboolean:FC,onumber:DC,optional:AC,ostring:OC,pipeline:NC,preprocess:RC,promise:CC,record:wC,set:EC,strictObject:yC,string:Iw,symbol:lC,transformer:e1,tuple:bC,undefined:uC,union:_C,unknown:dC,void:fC,NEVER:BC,ZodIssueCode:Yt,quotelessJson:zk,ZodError:Vo});const Dm=/^https?:\/\/library.stanford.edu\/iiif\/image-api\/1.1\/compliance.html#level(?<level>[012])$/,Pw=Ye.string().regex(Dm),$C=Pw,mm="http://library.stanford.edu/iiif/image-api/1.1/context.json",kw="http://iiif.io/api/image/1/context.json",Cw=Ye.literal(mm),Aw=Ye.object({"@context":Cw,"@id":Ye.string().url(),profile:Pw.optional(),width:Ye.number().int(),height:Ye.number().int(),scale_factors:Ye.number().array().optional(),tile_width:Ye.number().optional(),tile_height:Ye.number().optional()}),Lw=Ye.object({width:Ye.number().int(),height:Ye.number().int()}),Rw=Ye.object({width:Ye.number().int(),height:Ye.number().int().optional(),scaleFactors:Ye.array(Ye.number().int())}),jC=["ImageService1","ImageService2","ImageService3"],Nw=Ye.enum(jC),Fm=/^https?:\/\/iiif.io\/api\/image\/2.*level(?<level>[012])(.json)?$/,t1=Ye.string().regex(Fm),GC=Ye.object({formats:Ye.string().array().optional(),maxArea:Ye.number().int().optional(),maxHeight:Ye.number().int().optional(),maxWidth:Ye.number().int().optional(),qualities:Ye.string().array().optional(),supports:Ye.string().array().optional()}),gm=t1.or(Ye.array(Ye.union([t1,GC,Ye.any()]))),ym="http://iiif.io/api/image/2/context.json",Ow=Ye.literal(ym).or(Ye.literal("https://iiif.io/api/image/2/context.json")),L_=Ye.object({"@id":Ye.string().url(),"@type":Ye.literal("iiif:Image").optional(),"@context":Ow,protocol:Ye.literal("http://iiif.io/api/image"),width:Ye.number().int(),height:Ye.number().int(),profile:gm,sizes:Lw.array().optional(),tiles:Rw.array().optional()}),UC=["level0","level1","level2"],Dw=Ye.enum(UC),R_=Ye.object({id:Ye.string().url(),type:Ye.literal("ImageService3"),protocol:Ye.literal("http://iiif.io/api/image"),profile:Dw,width:Ye.number().int(),height:Ye.number().int(),maxWidth:Ye.number().int().optional(),maxHeight:Ye.number().int().optional(),maxArea:Ye.number().int().optional(),sizes:Lw.array().optional(),tiles:Rw.array().optional(),extraFeatures:Ye.string().array().optional()}),VC=Ye.object({"@id":Ye.string().url(),"@type":Nw.optional(),profile:$C.or(gm).or(Dw),width:Ye.number().int().optional(),height:Ye.number().int().optional(),"@context":Cw.or(Ye.literal("http://iiif.io/api/image/1/context.json")).or(Ow).optional()}),qC=["level0","level1","level2"],ZC=Ye.object({id:Ye.string().url(),type:Ye.literal("ImageService2"),profile:gm}).or(Ye.object({"@id":Ye.string().url(),"@type":Ye.literal("ImageService2"),profile:gm})),WC=Ye.object({id:Ye.string().url(),type:Nw,profile:Ye.enum(qC)}),YC=Ye.union([ZC,WC]),Fw=VC.or(YC),i1=Ye.string().or(Ye.number()).or(Ye.boolean()),zw=i1.or(i1.array()),r1=Ye.object({"@language":Ye.string().optional(),"@value":zw}),gc=zw.or(r1).or(r1.array()),XC=Ye.union([Ye.any(),Ye.object({label:gc.optional(),value:gc.optional()})]).transform(r=>{if(r&&typeof r=="object"&&"label"in r&&"value"in r)return r}),Bw=XC.array(),HC=Ye.object({width:Ye.number().int().optional(),height:Ye.number().int().optional(),service:Fw}),KC=Ye.object({resource:HC}),$w=Ye.object({"@id":Ye.string().url(),"@type":Ye.literal("sc:Canvas"),width:Ye.number().int(),height:Ye.number().int(),images:KC.array().length(1),label:gc.optional(),metadata:Bw.optional()}),JC=Ye.object({canvases:$w.array().nonempty()}),jw=Ye.object({"@id":Ye.string().url(),"@type":Ye.literal("sc:Manifest"),sequences:JC.array().length(1),label:gc.optional(),description:gc.optional(),metadata:Bw.optional()}),n1=Ye.lazy(()=>Ye.object({"@id":Ye.string().url(),"@type":Ye.literal("sc:Manifest"),label:gc.optional()})),qy=Ye.lazy(()=>Ye.object({"@id":Ye.string().url(),"@type":Ye.literal("sc:Collection"),label:gc.optional(),manifests:n1.array().optional(),collections:qy.array().optional(),members:n1.or(qy).array().optional()})),QC=Ye.string().or(Ye.number()).or(Ye.boolean()),yc=Ye.record(Ye.string(),QC.array()),eA=Ye.union([Ye.any(),Ye.object({label:yc.optional(),value:yc.optional()})]).transform(r=>{if(r&&typeof r=="object"&&"label"in r&&"value"in r)return r}),Gw=eA.array(),s1=Ye.object({type:Ye.literal("Image"),width:Ye.number().int().optional(),height:Ye.number().int().optional(),service:Fw.array()}),tA=Ye.object({type:Ye.literal("Annotation"),body:s1.or(s1.array().length(1))}),iA=Ye.object({type:Ye.literal("AnnotationPage"),items:tA.array().length(1)}),Uw=Ye.object({id:Ye.string().url(),type:Ye.literal("Canvas"),width:Ye.number().int(),height:Ye.number().int(),items:iA.array().length(1),label:yc.optional(),metadata:Gw.optional()}),Vw=Ye.object({id:Ye.string().url(),type:Ye.literal("Manifest"),items:Uw.array().nonempty(),label:yc.optional(),description:yc.optional(),metadata:Gw.optional()}),rA=Ye.lazy(()=>Ye.object({id:Ye.string().url(),type:Ye.literal("Manifest"),label:yc.optional()})),qw=Ye.lazy(()=>Ye.object({id:Ye.string().url(),type:Ye.literal("Collection"),label:yc.optional(),items:rA.or(qw).array()})),Zw=Aw.or(L_).or(R_);$w.or(Uw);const nA=jw.or(Vw);qy.or(qw);jw.or(L_);Vw.or(R_);nA.or(Zw);function Ww({width:r,height:e},i,s,h){const x=s*i.originalWidth,m=h*i.originalHeight,o=s*i.originalWidth+i.width*i.scaleFactor>r?r-s*i.originalWidth:i.width*i.scaleFactor,P=h*i.originalHeight+i.height*i.scaleFactor>e?e-h*i.originalHeight:i.height*i.scaleFactor;let L=i.width,D=i.height;return x+i.width*i.scaleFactor>r&&(L=Math.floor((r-x+i.scaleFactor-1)/i.scaleFactor)),m+i.height*i.scaleFactor>e&&(D=Math.floor((e-m+i.scaleFactor-1)/i.scaleFactor)),{region:{x,y:m,width:o,height:P},size:{width:L,height:D}}}function sA({width:r,height:e},i=768){const s=Math.max(r,e)/i,h=Math.ceil(Math.log(s)/Math.log(2));return{scaleFactors:Array.from({length:h},(x,m)=>2**m),width:i}}function oA({width:r,height:e},i,s){const h=i.height||i.width,x=i.width*s,m=h*s;return{scaleFactor:s,width:i.width,height:h,originalWidth:x,originalHeight:m,columns:Math.ceil(r/x),rows:Math.ceil(e/m)}}function aA(r,e){return e.map(i=>i.scaleFactors.map(s=>oA(r,i,s))).flat()}function lA(r){return!!r.some(e=>e.width&&e.scaleFactors&&e.scaleFactors.length)}function uA(r,e,i){if(!e||!lA(e))if(i)e=[sA(r)];else throw new Error("Image does not support tiles or custom regions and sizes.");return aA(r,e)}function cA(r,e,i="cover"){if(i==="cover"||i==="contain"){const s=e.width/r.width,h=e.height/r.height,x=i==="cover"?Math.max(s,h):Math.min(s,h),m=r.width*x,o=r.height*x;return{width:m,height:o}}else throw new Error('Mode must be either "cover" or "contain"')}const hA=.8,dA=1.5;function Yw(r,e,i="cover",{sizes:s,tileZoomLevels:h,supportsAnyRegionAndSize:x,maxWidth:m,maxHeight:o,maxArea:P}){let{width:L,height:D}=cA(r,e,i);if(m&&L>m&&(D=D/L*m,L=m),o&&D>o&&(L=L/D*o,D=o),P&&L*D>P){const Y=D/L,V=Math.floor(Math.sqrt(P/Y))*Y;L=Math.floor(V)/Y,D=L*Y}const F=r.width/r.height;if(L=Math.floor(L),D=Math.round(L/F),s){let Y;for(const V of s){const H=V.width/L;if(H>=hA&&H<=dA){Y=V;break}}if(Y)return{size:Y}}if(x)return{size:{width:Math.round(L),height:Math.round(D)}};if(h){const Y=r.width/L,V=h.map(({scaleFactor:fe},K)=>({index:K,scaleFactor:fe,diff:Math.abs(fe-Y)})).sort((fe,K)=>fe.diff-K.diff),H=h[V[0].index],ve=Math.ceil(r.width/(H.scaleFactor*h[0].width)),_e=Math.ceil(r.height/(H.scaleFactor*h[0].height)),oe=[];for(let fe=0;fe<_e;fe++){const K=[];for(let ne=0;ne<ve;ne++){const ye=Ww(r,H,ne,fe);K.push(ye)}oe.push(K)}return oe}throw new Error("Unable to create thumbnail")}const Xw=["regionByPx","sizeByWh"];function pA(r){const e=r.match(Dm);if(e&&e.groups)return parseInt(e.groups.level)}function o1(r){const e=r.match(Fm);if(e&&e.groups)return parseInt(e.groups.level)}function fA(r){return{maxWidth:r?.maxWidth,maxHeight:r?.maxHeight,maxArea:r?.maxArea,supportsAnyRegionAndSize:Xw.every(e=>r?.supports&&r?.supports?.includes(e))}}function mA(r){if("type"in r&&r.type==="ImageService3")return 3;if("type"in r&&r.type==="ImageService2"||"@type"in r&&r["@type"]==="ImageService2"||"@context"in r&&r["@context"]===ym)return 2;if("@context"in r&&(r["@context"]===mm||r["@context"]===kw))return 1;if("profile"in r){let e;return Array.isArray(r.profile)?e=r.profile[0]:e=r.profile,e.match(Dm)?1:e.match(Fm)?2:3}else throw new Error("Unsupported IIIF Image Service")}function Zy(r){if("type"in r||"@type"in r){const e=r.profile;let i=!1;return e==="level0"||typeof e=="string"&&e.endsWith("level0.json")?"extraFeatures"in r&&(i=Xw.every(s=>r.extraFeatures&&r.extraFeatures.includes(s))):i=!0,{maxWidth:"maxWidth"in r?r.maxWidth:void 0,maxHeight:"maxHeight"in r?r.maxHeight:void 0,maxArea:"maxArea"in r?r.maxArea:void 0,supportsAnyRegionAndSize:i}}else if(Array.isArray(r.profile)){let e=!1,i=Number.NEGATIVE_INFINITY,s=Number.NEGATIVE_INFINITY,h=Number.NEGATIVE_INFINITY;return r.profile.forEach(x=>{if(typeof x=="string"){const m=o1(x);m&&(e=e||m>=1)}else{const{maxWidth:m,maxHeight:o,maxArea:P,supportsAnyRegionAndSize:L}=fA(x);m!==void 0&&(s=Math.max(m,s)),o!==void 0&&(i=Math.max(o,i)),P!==void 0&&(h=Math.max(P,h)),e=e||L}}),{maxWidth:s>=0?s:void 0,maxHeight:i>=0?i:void 0,maxArea:h>=0?h:void 0,supportsAnyRegionAndSize:e}}else if("profile"in r&&r.profile){const e=pA(r.profile),i=o1(r.profile);return e?{supportsAnyRegionAndSize:e>=1}:i?{supportsAnyRegionAndSize:i>=1}:{supportsAnyRegionAndSize:!1}}else throw new Error("Invalid Image")}const gA="image";class yA{embedded=!0;uri;type=gA;maxWidth;maxHeight;maxArea;supportsAnyRegionAndSize;width;height;majorVersion;constructor(e,i){if(i){const s=e;let h,x;if(Array.isArray(s.service)?s.service.forEach(m=>{try{const o=mA(m);(!x||o>x)&&(x=o,h=m)}catch{}}):h=s.service,!h)throw new Error("Unsupported IIIF Image Service");if("@id"in h)this.uri=h["@id"];else if("id"in h)this.uri=h.id;else throw new Error("Unsupported IIIF Image Service");if("type"in h&&h.type==="ImageService3")this.majorVersion=3;else if("type"in h&&h.type==="ImageService2"||"@type"in h&&h["@type"]==="ImageService2"||"@context"in h&&h["@context"]===ym)this.majorVersion=2;else if("@context"in h&&(h["@context"]===mm||h["@context"]===kw))this.majorVersion=1;else if("profile"in h){let m;Array.isArray(h.profile)?m=h.profile[0]:m=h.profile,m.match(Dm)?this.majorVersion=1:m.match(Fm)?this.majorVersion=2:this.majorVersion=3}else throw new Error("Unsupported IIIF Image Service");if("profile"in h){const m=Zy(h);this.supportsAnyRegionAndSize=m.supportsAnyRegionAndSize,this.maxWidth=m.maxWidth,this.maxHeight=m.maxHeight,this.maxArea=m.maxArea}else this.supportsAnyRegionAndSize=!1}else{if("@id"in e)this.uri=e["@id"];else if("id"in e)this.uri=e.id;else throw new Error("Unsupported IIIF Image");if("type"in e&&e.type==="ImageService3")this.majorVersion=3;else if("@type"in e&&e["@type"]==="iiif:Image"||"@context"in e&&e["@context"]===ym)this.majorVersion=2;else if("@context"in e&&e["@context"]===mm)this.majorVersion=1;else throw new Error("Unsupported IIIF Image");if("profile"in e){const s=Zy(e);this.supportsAnyRegionAndSize=s.supportsAnyRegionAndSize,this.maxWidth=s.maxWidth,this.maxHeight=s.maxHeight,this.maxArea=s.maxArea}else this.supportsAnyRegionAndSize=!1}if(e.width!==void 0)this.width=e.width;else if(i)this.width=i.width;else throw new Error("Width not present on either Canvas or Image Resource");if(e.height!==void 0)this.height=e.height;else if(i)this.height=i.height;else throw new Error("Height not present on either Canvas or Image Resource")}getImageUrl(e){const{region:i,size:s}=e;let h,x,m,o,P;i?(P=`${i.x},${i.y},${i.width},${i.height}`,m=i.height,o=i.width):(P="full",m=this.height,o=this.width);let L;if(s){h=Math.round(s.width),x=Math.round(s.height);const Y=String(h);let V=String(x);const H=o/m,ve=x*H/H;x===Math.round(ve)&&(V=""),L=`${Y},${V}`}else h=this.width,x=this.height,L=this.majorVersion===2?"full":"max";const D=h*x;if(this.maxWidth!==void 0&&h>this.maxWidth)throw new Error(`Width of requested image is too large: ${h} > ${this.maxWidth}`);if(this.maxHeight!==void 0&&x>this.maxHeight)throw new Error(`Height of requested image is too large: ${x} > ${this.maxHeight}`);if(this.maxArea!==void 0&&D>this.maxArea)throw new Error(`Area of requested image is too large: ${D} > ${this.maxArea}`);const F=this.majorVersion===1?"native":"default";return`${this.uri}/${P}/${L}/0/${F}.jpg`}getThumbnail(e,i="cover"){return Yw({width:this.width,height:this.height},e,i,{supportsAnyRegionAndSize:this.supportsAnyRegionAndSize,maxWidth:this.maxWidth,maxHeight:this.maxHeight,maxArea:this.maxArea})}}class N_ extends yA{tileZoomLevels;sizes;embedded=!1;constructor(e){super(e);const i=Zy(e);let s;"tiles"in e&&(s=e.tiles),this.tileZoomLevels=uA({width:this.width,height:this.height},s,i.supportsAnyRegionAndSize),"sizes"in e&&(this.sizes=e.sizes)}static parse(e,i=null){let s;return i===1?s=Aw.parse(e):i===2?s=L_.parse(e):i===3?s=R_.parse(e):s=Zw.parse(e),new N_(s)}getIiifTile(e,i,s){return Ww({width:this.width,height:this.height},e,i,s)}getThumbnail(e,i="cover"){return Yw({width:this.width,height:this.height},e,i,{supportsAnyRegionAndSize:this.supportsAnyRegionAndSize,sizes:this.sizes,tileZoomLevels:this.tileZoomLevels,maxWidth:this.maxWidth,maxHeight:this.maxHeight,maxArea:this.maxArea})}}const a1=Ye.record(Ye.string(),Ye.string().array());Ye.object({label:a1.optional(),value:a1.optional()});var bo=63710088e-1,Hw={centimeters:bo*100,centimetres:bo*100,degrees:bo/111325,feet:bo*3.28084,inches:bo*39.37,kilometers:bo/1e3,kilometres:bo/1e3,meters:bo,metres:bo,miles:bo/1609.344,millimeters:bo*1e3,millimetres:bo*1e3,nauticalmiles:bo/1852,radians:1,yards:bo*1.0936};function _A(r,e,i){i===void 0&&(i={});var s={type:"Feature"};return(i.id===0||i.id)&&(s.id=i.id),i.bbox&&(s.bbox=i.bbox),s.properties=e||{},s.geometry=r,s}function vA(r,e,i){if(i===void 0&&(i={}),!r)throw new Error("coordinates is required");if(!Array.isArray(r))throw new Error("coordinates must be an Array");if(r.length<2)throw new Error("coordinates must be at least 2 numbers long");if(!l1(r[0])||!l1(r[1]))throw new Error("coordinates must contain numbers");var s={type:"Point",coordinates:r};return _A(s,e,i)}function xA(r,e){e===void 0&&(e="kilometers");var i=Hw[e];if(!i)throw new Error(e+" units is invalid");return r*i}function bA(r,e){e===void 0&&(e="kilometers");var i=Hw[e];if(!i)throw new Error(e+" units is invalid");return r/i}function Wy(r){var e=r%(2*Math.PI);return e*180/Math.PI}function Aa(r){var e=r%360;return e*Math.PI/180}function l1(r){return!isNaN(r)&&r!==null&&!Array.isArray(r)}function vh(r){if(!r)throw new Error("coord is required");if(!Array.isArray(r)){if(r.type==="Feature"&&r.geometry!==null&&r.geometry.type==="Point")return r.geometry.coordinates;if(r.type==="Point")return r.coordinates}if(Array.isArray(r)&&r.length>=2&&!Array.isArray(r[0])&&!Array.isArray(r[1]))return r;throw new Error("coord must be GeoJSON Point or an Array of numbers")}function wA(r){return r.type==="Feature"?r.geometry:r}function Kw(r,e,i){if(i===void 0&&(i={}),i.final===!0)return TA(r,e);var s=vh(r),h=vh(e),x=Aa(s[0]),m=Aa(h[0]),o=Aa(s[1]),P=Aa(h[1]),L=Math.sin(m-x)*Math.cos(P),D=Math.cos(o)*Math.sin(P)-Math.sin(o)*Math.cos(P)*Math.cos(m-x);return Wy(Math.atan2(L,D))}function TA(r,e){var i=Kw(e,r);return i=(i+180)%360,i}function EA(r,e,i,s){s===void 0&&(s={});var h=vh(r),x=Aa(h[0]),m=Aa(h[1]),o=Aa(i),P=bA(e,s.units),L=Math.asin(Math.sin(m)*Math.cos(P)+Math.cos(m)*Math.sin(P)*Math.cos(o)),D=x+Math.atan2(Math.sin(o)*Math.sin(P)*Math.cos(m),Math.cos(P)-Math.sin(m)*Math.sin(L)),F=Wy(D),Y=Wy(L);return vA([F,Y],s.properties)}function O_(r,e,i){i===void 0&&(i={});var s=vh(r),h=vh(e),x=Aa(h[1]-s[1]),m=Aa(h[0]-s[0]),o=Aa(s[1]),P=Aa(h[1]),L=Math.pow(Math.sin(x/2),2)+Math.pow(Math.sin(m/2),2)*Math.cos(o)*Math.cos(P);return xA(2*Math.atan2(Math.sqrt(L),Math.sqrt(1-L)),i.units)}function _m(r,e){var i=O_(r,e),s=Kw(r,e),h=EA(r,i/2,s);return h}function Jw(r){if(r.__esModule)return r;var e=r.default;if(typeof e=="function"){var i=function s(){return this instanceof s?Reflect.construct(e,arguments,this.constructor):e.apply(this,arguments)};i.prototype=e.prototype}else i={};return Object.defineProperty(i,"__esModule",{value:!0}),Object.keys(r).forEach(function(s){var h=Object.getOwnPropertyDescriptor(r,s);Object.defineProperty(i,s,h.get?h:{enumerable:!0,get:function(){return r[s]}})}),i}var Tr={};const IA=Object.prototype.toString;function op(r){const e=IA.call(r);return e.endsWith("Array]")&&!e.includes("Big")}const SA=Object.freeze(Object.defineProperty({__proto__:null,isAnyArray:op},Symbol.toStringTag,{value:"Module"})),MA=Jw(SA);function PA(r){var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(!op(r))throw new TypeError("input must be an array");if(r.length===0)throw new TypeError("input must not be empty");var i=e.fromIndex,s=i===void 0?0:i,h=e.toIndex,x=h===void 0?r.length:h;if(s<0||s>=r.length||!Number.isInteger(s))throw new Error("fromIndex must be a positive integer smaller than length");if(x<=s||x>r.length||!Number.isInteger(x))throw new Error("toIndex must be an integer greater than fromIndex and at most equal to length");for(var m=r[s],o=s+1;o<x;o++)r[o]>m&&(m=r[o]);return m}function kA(r){var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(!op(r))throw new TypeError("input must be an array");if(r.length===0)throw new TypeError("input must not be empty");var i=e.fromIndex,s=i===void 0?0:i,h=e.toIndex,x=h===void 0?r.length:h;if(s<0||s>=r.length||!Number.isInteger(s))throw new Error("fromIndex must be a positive integer smaller than length");if(x<=s||x>r.length||!Number.isInteger(x))throw new Error("toIndex must be an integer greater than fromIndex and at most equal to length");for(var m=r[s],o=s+1;o<x;o++)r[o]<m&&(m=r[o]);return m}function CA(r){var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(op(r)){if(r.length===0)throw new TypeError("input must not be empty")}else throw new TypeError("input must be an array");var i;if(e.output!==void 0){if(!op(e.output))throw new TypeError("output option must be an array if specified");i=e.output}else i=new Array(r.length);var s=kA(r),h=PA(r);if(s===h)throw new RangeError("minimum and maximum input values are equal. Cannot rescale a constant array");var x=e.min,m=x===void 0?e.autoMinMax?s:0:x,o=e.max,P=o===void 0?e.autoMinMax?h:1:o;if(m>=P)throw new RangeError("min option must be smaller than max option");for(var L=(P-m)/(h-s),D=0;D<r.length;D++)i[D]=(r[D]-s)*L+m;return i}const AA=Object.freeze(Object.defineProperty({__proto__:null,default:CA},Symbol.toStringTag,{value:"Module"})),LA=Jw(AA);Object.defineProperty(Tr,"__esModule",{value:!0});var Eo=MA,u1=LA;const xf=" ".repeat(2),Qw=" ".repeat(4);function RA(){return eT(this)}function eT(r,e={}){const{maxRows:i=15,maxColumns:s=10,maxNumSize:h=8,padMinus:x="auto"}=e;return`${r.constructor.name} {
${xf}[
${Qw}${NA(r,i,s,h,x)}
${xf}]
${xf}rows: ${r.rows}
${xf}columns: ${r.columns}
}`}function NA(r,e,i,s,h){const{rows:x,columns:m}=r,o=Math.min(x,e),P=Math.min(m,i),L=[];if(h==="auto"){h=!1;e:for(let D=0;D<o;D++)for(let F=0;F<P;F++)if(r.get(D,F)<0){h=!0;break e}}for(let D=0;D<o;D++){let F=[];for(let Y=0;Y<P;Y++)F.push(OA(r.get(D,Y),s,h));L.push(`${F.join(" ")}`)}return P!==m&&(L[L.length-1]+=` ... ${m-i} more columns`),o!==x&&L.push(`... ${x-e} more rows`),L.join(`
${Qw}`)}function OA(r,e,i){return(r>=0&&i?` ${c1(r,e-1)}`:c1(r,e)).padEnd(e)}function c1(r,e){let i=r.toString();if(i.length<=e)return i;let s=r.toFixed(e);if(s.length>e&&(s=r.toFixed(Math.max(0,e-(s.length-e)))),s.length<=e&&!s.startsWith("0.000")&&!s.startsWith("-0.000"))return s;let h=r.toExponential(e);return h.length>e&&(h=r.toExponential(Math.max(0,e-(h.length-e)))),h.slice(0)}function DA(r,e){r.prototype.add=function(i){return typeof i=="number"?this.addS(i):this.addM(i)},r.prototype.addS=function(i){for(let s=0;s<this.rows;s++)for(let h=0;h<this.columns;h++)this.set(s,h,this.get(s,h)+i);return this},r.prototype.addM=function(i){if(i=e.checkMatrix(i),this.rows!==i.rows||this.columns!==i.columns)throw new RangeError("Matrices dimensions must be equal");for(let s=0;s<this.rows;s++)for(let h=0;h<this.columns;h++)this.set(s,h,this.get(s,h)+i.get(s,h));return this},r.add=function(i,s){return new e(i).add(s)},r.prototype.sub=function(i){return typeof i=="number"?this.subS(i):this.subM(i)},r.prototype.subS=function(i){for(let s=0;s<this.rows;s++)for(let h=0;h<this.columns;h++)this.set(s,h,this.get(s,h)-i);return this},r.prototype.subM=function(i){if(i=e.checkMatrix(i),this.rows!==i.rows||this.columns!==i.columns)throw new RangeError("Matrices dimensions must be equal");for(let s=0;s<this.rows;s++)for(let h=0;h<this.columns;h++)this.set(s,h,this.get(s,h)-i.get(s,h));return this},r.sub=function(i,s){return new e(i).sub(s)},r.prototype.subtract=r.prototype.sub,r.prototype.subtractS=r.prototype.subS,r.prototype.subtractM=r.prototype.subM,r.subtract=r.sub,r.prototype.mul=function(i){return typeof i=="number"?this.mulS(i):this.mulM(i)},r.prototype.mulS=function(i){for(let s=0;s<this.rows;s++)for(let h=0;h<this.columns;h++)this.set(s,h,this.get(s,h)*i);return this},r.prototype.mulM=function(i){if(i=e.checkMatrix(i),this.rows!==i.rows||this.columns!==i.columns)throw new RangeError("Matrices dimensions must be equal");for(let s=0;s<this.rows;s++)for(let h=0;h<this.columns;h++)this.set(s,h,this.get(s,h)*i.get(s,h));return this},r.mul=function(i,s){return new e(i).mul(s)},r.prototype.multiply=r.prototype.mul,r.prototype.multiplyS=r.prototype.mulS,r.prototype.multiplyM=r.prototype.mulM,r.multiply=r.mul,r.prototype.div=function(i){return typeof i=="number"?this.divS(i):this.divM(i)},r.prototype.divS=function(i){for(let s=0;s<this.rows;s++)for(let h=0;h<this.columns;h++)this.set(s,h,this.get(s,h)/i);return this},r.prototype.divM=function(i){if(i=e.checkMatrix(i),this.rows!==i.rows||this.columns!==i.columns)throw new RangeError("Matrices dimensions must be equal");for(let s=0;s<this.rows;s++)for(let h=0;h<this.columns;h++)this.set(s,h,this.get(s,h)/i.get(s,h));return this},r.div=function(i,s){return new e(i).div(s)},r.prototype.divide=r.prototype.div,r.prototype.divideS=r.prototype.divS,r.prototype.divideM=r.prototype.divM,r.divide=r.div,r.prototype.mod=function(i){return typeof i=="number"?this.modS(i):this.modM(i)},r.prototype.modS=function(i){for(let s=0;s<this.rows;s++)for(let h=0;h<this.columns;h++)this.set(s,h,this.get(s,h)%i);return this},r.prototype.modM=function(i){if(i=e.checkMatrix(i),this.rows!==i.rows||this.columns!==i.columns)throw new RangeError("Matrices dimensions must be equal");for(let s=0;s<this.rows;s++)for(let h=0;h<this.columns;h++)this.set(s,h,this.get(s,h)%i.get(s,h));return this},r.mod=function(i,s){return new e(i).mod(s)},r.prototype.modulus=r.prototype.mod,r.prototype.modulusS=r.prototype.modS,r.prototype.modulusM=r.prototype.modM,r.modulus=r.mod,r.prototype.and=function(i){return typeof i=="number"?this.andS(i):this.andM(i)},r.prototype.andS=function(i){for(let s=0;s<this.rows;s++)for(let h=0;h<this.columns;h++)this.set(s,h,this.get(s,h)&i);return this},r.prototype.andM=function(i){if(i=e.checkMatrix(i),this.rows!==i.rows||this.columns!==i.columns)throw new RangeError("Matrices dimensions must be equal");for(let s=0;s<this.rows;s++)for(let h=0;h<this.columns;h++)this.set(s,h,this.get(s,h)&i.get(s,h));return this},r.and=function(i,s){return new e(i).and(s)},r.prototype.or=function(i){return typeof i=="number"?this.orS(i):this.orM(i)},r.prototype.orS=function(i){for(let s=0;s<this.rows;s++)for(let h=0;h<this.columns;h++)this.set(s,h,this.get(s,h)|i);return this},r.prototype.orM=function(i){if(i=e.checkMatrix(i),this.rows!==i.rows||this.columns!==i.columns)throw new RangeError("Matrices dimensions must be equal");for(let s=0;s<this.rows;s++)for(let h=0;h<this.columns;h++)this.set(s,h,this.get(s,h)|i.get(s,h));return this},r.or=function(i,s){return new e(i).or(s)},r.prototype.xor=function(i){return typeof i=="number"?this.xorS(i):this.xorM(i)},r.prototype.xorS=function(i){for(let s=0;s<this.rows;s++)for(let h=0;h<this.columns;h++)this.set(s,h,this.get(s,h)^i);return this},r.prototype.xorM=function(i){if(i=e.checkMatrix(i),this.rows!==i.rows||this.columns!==i.columns)throw new RangeError("Matrices dimensions must be equal");for(let s=0;s<this.rows;s++)for(let h=0;h<this.columns;h++)this.set(s,h,this.get(s,h)^i.get(s,h));return this},r.xor=function(i,s){return new e(i).xor(s)},r.prototype.leftShift=function(i){return typeof i=="number"?this.leftShiftS(i):this.leftShiftM(i)},r.prototype.leftShiftS=function(i){for(let s=0;s<this.rows;s++)for(let h=0;h<this.columns;h++)this.set(s,h,this.get(s,h)<<i);return this},r.prototype.leftShiftM=function(i){if(i=e.checkMatrix(i),this.rows!==i.rows||this.columns!==i.columns)throw new RangeError("Matrices dimensions must be equal");for(let s=0;s<this.rows;s++)for(let h=0;h<this.columns;h++)this.set(s,h,this.get(s,h)<<i.get(s,h));return this},r.leftShift=function(i,s){return new e(i).leftShift(s)},r.prototype.signPropagatingRightShift=function(i){return typeof i=="number"?this.signPropagatingRightShiftS(i):this.signPropagatingRightShiftM(i)},r.prototype.signPropagatingRightShiftS=function(i){for(let s=0;s<this.rows;s++)for(let h=0;h<this.columns;h++)this.set(s,h,this.get(s,h)>>i);return this},r.prototype.signPropagatingRightShiftM=function(i){if(i=e.checkMatrix(i),this.rows!==i.rows||this.columns!==i.columns)throw new RangeError("Matrices dimensions must be equal");for(let s=0;s<this.rows;s++)for(let h=0;h<this.columns;h++)this.set(s,h,this.get(s,h)>>i.get(s,h));return this},r.signPropagatingRightShift=function(i,s){return new e(i).signPropagatingRightShift(s)},r.prototype.rightShift=function(i){return typeof i=="number"?this.rightShiftS(i):this.rightShiftM(i)},r.prototype.rightShiftS=function(i){for(let s=0;s<this.rows;s++)for(let h=0;h<this.columns;h++)this.set(s,h,this.get(s,h)>>>i);return this},r.prototype.rightShiftM=function(i){if(i=e.checkMatrix(i),this.rows!==i.rows||this.columns!==i.columns)throw new RangeError("Matrices dimensions must be equal");for(let s=0;s<this.rows;s++)for(let h=0;h<this.columns;h++)this.set(s,h,this.get(s,h)>>>i.get(s,h));return this},r.rightShift=function(i,s){return new e(i).rightShift(s)},r.prototype.zeroFillRightShift=r.prototype.rightShift,r.prototype.zeroFillRightShiftS=r.prototype.rightShiftS,r.prototype.zeroFillRightShiftM=r.prototype.rightShiftM,r.zeroFillRightShift=r.rightShift,r.prototype.not=function(){for(let i=0;i<this.rows;i++)for(let s=0;s<this.columns;s++)this.set(i,s,~this.get(i,s));return this},r.not=function(i){return new e(i).not()},r.prototype.abs=function(){for(let i=0;i<this.rows;i++)for(let s=0;s<this.columns;s++)this.set(i,s,Math.abs(this.get(i,s)));return this},r.abs=function(i){return new e(i).abs()},r.prototype.acos=function(){for(let i=0;i<this.rows;i++)for(let s=0;s<this.columns;s++)this.set(i,s,Math.acos(this.get(i,s)));return this},r.acos=function(i){return new e(i).acos()},r.prototype.acosh=function(){for(let i=0;i<this.rows;i++)for(let s=0;s<this.columns;s++)this.set(i,s,Math.acosh(this.get(i,s)));return this},r.acosh=function(i){return new e(i).acosh()},r.prototype.asin=function(){for(let i=0;i<this.rows;i++)for(let s=0;s<this.columns;s++)this.set(i,s,Math.asin(this.get(i,s)));return this},r.asin=function(i){return new e(i).asin()},r.prototype.asinh=function(){for(let i=0;i<this.rows;i++)for(let s=0;s<this.columns;s++)this.set(i,s,Math.asinh(this.get(i,s)));return this},r.asinh=function(i){return new e(i).asinh()},r.prototype.atan=function(){for(let i=0;i<this.rows;i++)for(let s=0;s<this.columns;s++)this.set(i,s,Math.atan(this.get(i,s)));return this},r.atan=function(i){return new e(i).atan()},r.prototype.atanh=function(){for(let i=0;i<this.rows;i++)for(let s=0;s<this.columns;s++)this.set(i,s,Math.atanh(this.get(i,s)));return this},r.atanh=function(i){return new e(i).atanh()},r.prototype.cbrt=function(){for(let i=0;i<this.rows;i++)for(let s=0;s<this.columns;s++)this.set(i,s,Math.cbrt(this.get(i,s)));return this},r.cbrt=function(i){return new e(i).cbrt()},r.prototype.ceil=function(){for(let i=0;i<this.rows;i++)for(let s=0;s<this.columns;s++)this.set(i,s,Math.ceil(this.get(i,s)));return this},r.ceil=function(i){return new e(i).ceil()},r.prototype.clz32=function(){for(let i=0;i<this.rows;i++)for(let s=0;s<this.columns;s++)this.set(i,s,Math.clz32(this.get(i,s)));return this},r.clz32=function(i){return new e(i).clz32()},r.prototype.cos=function(){for(let i=0;i<this.rows;i++)for(let s=0;s<this.columns;s++)this.set(i,s,Math.cos(this.get(i,s)));return this},r.cos=function(i){return new e(i).cos()},r.prototype.cosh=function(){for(let i=0;i<this.rows;i++)for(let s=0;s<this.columns;s++)this.set(i,s,Math.cosh(this.get(i,s)));return this},r.cosh=function(i){return new e(i).cosh()},r.prototype.exp=function(){for(let i=0;i<this.rows;i++)for(let s=0;s<this.columns;s++)this.set(i,s,Math.exp(this.get(i,s)));return this},r.exp=function(i){return new e(i).exp()},r.prototype.expm1=function(){for(let i=0;i<this.rows;i++)for(let s=0;s<this.columns;s++)this.set(i,s,Math.expm1(this.get(i,s)));return this},r.expm1=function(i){return new e(i).expm1()},r.prototype.floor=function(){for(let i=0;i<this.rows;i++)for(let s=0;s<this.columns;s++)this.set(i,s,Math.floor(this.get(i,s)));return this},r.floor=function(i){return new e(i).floor()},r.prototype.fround=function(){for(let i=0;i<this.rows;i++)for(let s=0;s<this.columns;s++)this.set(i,s,Math.fround(this.get(i,s)));return this},r.fround=function(i){return new e(i).fround()},r.prototype.log=function(){for(let i=0;i<this.rows;i++)for(let s=0;s<this.columns;s++)this.set(i,s,Math.log(this.get(i,s)));return this},r.log=function(i){return new e(i).log()},r.prototype.log1p=function(){for(let i=0;i<this.rows;i++)for(let s=0;s<this.columns;s++)this.set(i,s,Math.log1p(this.get(i,s)));return this},r.log1p=function(i){return new e(i).log1p()},r.prototype.log10=function(){for(let i=0;i<this.rows;i++)for(let s=0;s<this.columns;s++)this.set(i,s,Math.log10(this.get(i,s)));return this},r.log10=function(i){return new e(i).log10()},r.prototype.log2=function(){for(let i=0;i<this.rows;i++)for(let s=0;s<this.columns;s++)this.set(i,s,Math.log2(this.get(i,s)));return this},r.log2=function(i){return new e(i).log2()},r.prototype.round=function(){for(let i=0;i<this.rows;i++)for(let s=0;s<this.columns;s++)this.set(i,s,Math.round(this.get(i,s)));return this},r.round=function(i){return new e(i).round()},r.prototype.sign=function(){for(let i=0;i<this.rows;i++)for(let s=0;s<this.columns;s++)this.set(i,s,Math.sign(this.get(i,s)));return this},r.sign=function(i){return new e(i).sign()},r.prototype.sin=function(){for(let i=0;i<this.rows;i++)for(let s=0;s<this.columns;s++)this.set(i,s,Math.sin(this.get(i,s)));return this},r.sin=function(i){return new e(i).sin()},r.prototype.sinh=function(){for(let i=0;i<this.rows;i++)for(let s=0;s<this.columns;s++)this.set(i,s,Math.sinh(this.get(i,s)));return this},r.sinh=function(i){return new e(i).sinh()},r.prototype.sqrt=function(){for(let i=0;i<this.rows;i++)for(let s=0;s<this.columns;s++)this.set(i,s,Math.sqrt(this.get(i,s)));return this},r.sqrt=function(i){return new e(i).sqrt()},r.prototype.tan=function(){for(let i=0;i<this.rows;i++)for(let s=0;s<this.columns;s++)this.set(i,s,Math.tan(this.get(i,s)));return this},r.tan=function(i){return new e(i).tan()},r.prototype.tanh=function(){for(let i=0;i<this.rows;i++)for(let s=0;s<this.columns;s++)this.set(i,s,Math.tanh(this.get(i,s)));return this},r.tanh=function(i){return new e(i).tanh()},r.prototype.trunc=function(){for(let i=0;i<this.rows;i++)for(let s=0;s<this.columns;s++)this.set(i,s,Math.trunc(this.get(i,s)));return this},r.trunc=function(i){return new e(i).trunc()},r.pow=function(i,s){return new e(i).pow(s)},r.prototype.pow=function(i){return typeof i=="number"?this.powS(i):this.powM(i)},r.prototype.powS=function(i){for(let s=0;s<this.rows;s++)for(let h=0;h<this.columns;h++)this.set(s,h,Math.pow(this.get(s,h),i));return this},r.prototype.powM=function(i){if(i=e.checkMatrix(i),this.rows!==i.rows||this.columns!==i.columns)throw new RangeError("Matrices dimensions must be equal");for(let s=0;s<this.rows;s++)for(let h=0;h<this.columns;h++)this.set(s,h,Math.pow(this.get(s,h),i.get(s,h)));return this}}function fa(r,e,i){let s=i?r.rows:r.rows-1;if(e<0||e>s)throw new RangeError("Row index out of range")}function ma(r,e,i){let s=i?r.columns:r.columns-1;if(e<0||e>s)throw new RangeError("Column index out of range")}function ah(r,e){if(e.to1DArray&&(e=e.to1DArray()),e.length!==r.columns)throw new RangeError("vector size must be the same as the number of columns");return e}function lh(r,e){if(e.to1DArray&&(e=e.to1DArray()),e.length!==r.rows)throw new RangeError("vector size must be the same as the number of rows");return e}function D_(r,e){if(!Eo.isAnyArray(e))throw new TypeError("row indices must be an array");for(let i=0;i<e.length;i++)if(e[i]<0||e[i]>=r.rows)throw new RangeError("row indices are out of range")}function F_(r,e){if(!Eo.isAnyArray(e))throw new TypeError("column indices must be an array");for(let i=0;i<e.length;i++)if(e[i]<0||e[i]>=r.columns)throw new RangeError("column indices are out of range")}function Yy(r,e,i,s,h){if(arguments.length!==5)throw new RangeError("expected 4 arguments");if(bf("startRow",e),bf("endRow",i),bf("startColumn",s),bf("endColumn",h),e>i||s>h||e<0||e>=r.rows||i<0||i>=r.rows||s<0||s>=r.columns||h<0||h>=r.columns)throw new RangeError("Submatrix indices are out of range")}function zm(r,e=0){let i=[];for(let s=0;s<r;s++)i.push(e);return i}function bf(r,e){if(typeof e!="number")throw new TypeError(`${r} must be a number`)}function th(r){if(r.isEmpty())throw new Error("Empty matrix has no elements to index")}function FA(r){let e=zm(r.rows);for(let i=0;i<r.rows;++i)for(let s=0;s<r.columns;++s)e[i]+=r.get(i,s);return e}function zA(r){let e=zm(r.columns);for(let i=0;i<r.rows;++i)for(let s=0;s<r.columns;++s)e[s]+=r.get(i,s);return e}function BA(r){let e=0;for(let i=0;i<r.rows;i++)for(let s=0;s<r.columns;s++)e+=r.get(i,s);return e}function $A(r){let e=zm(r.rows,1);for(let i=0;i<r.rows;++i)for(let s=0;s<r.columns;++s)e[i]*=r.get(i,s);return e}function jA(r){let e=zm(r.columns,1);for(let i=0;i<r.rows;++i)for(let s=0;s<r.columns;++s)e[s]*=r.get(i,s);return e}function GA(r){let e=1;for(let i=0;i<r.rows;i++)for(let s=0;s<r.columns;s++)e*=r.get(i,s);return e}function UA(r,e,i){const s=r.rows,h=r.columns,x=[];for(let m=0;m<s;m++){let o=0,P=0,L=0;for(let D=0;D<h;D++)L=r.get(m,D)-i[m],o+=L,P+=L*L;e?x.push((P-o*o/h)/(h-1)):x.push((P-o*o/h)/h)}return x}function VA(r,e,i){const s=r.rows,h=r.columns,x=[];for(let m=0;m<h;m++){let o=0,P=0,L=0;for(let D=0;D<s;D++)L=r.get(D,m)-i[m],o+=L,P+=L*L;e?x.push((P-o*o/s)/(s-1)):x.push((P-o*o/s)/s)}return x}function qA(r,e,i){const s=r.rows,h=r.columns,x=s*h;let m=0,o=0,P=0;for(let L=0;L<s;L++)for(let D=0;D<h;D++)P=r.get(L,D)-i,m+=P,o+=P*P;return e?(o-m*m/x)/(x-1):(o-m*m/x)/x}function ZA(r,e){for(let i=0;i<r.rows;i++)for(let s=0;s<r.columns;s++)r.set(i,s,r.get(i,s)-e[i])}function WA(r,e){for(let i=0;i<r.rows;i++)for(let s=0;s<r.columns;s++)r.set(i,s,r.get(i,s)-e[s])}function YA(r,e){for(let i=0;i<r.rows;i++)for(let s=0;s<r.columns;s++)r.set(i,s,r.get(i,s)-e)}function XA(r){const e=[];for(let i=0;i<r.rows;i++){let s=0;for(let h=0;h<r.columns;h++)s+=Math.pow(r.get(i,h),2)/(r.columns-1);e.push(Math.sqrt(s))}return e}function HA(r,e){for(let i=0;i<r.rows;i++)for(let s=0;s<r.columns;s++)r.set(i,s,r.get(i,s)/e[i])}function KA(r){const e=[];for(let i=0;i<r.columns;i++){let s=0;for(let h=0;h<r.rows;h++)s+=Math.pow(r.get(h,i),2)/(r.rows-1);e.push(Math.sqrt(s))}return e}function JA(r,e){for(let i=0;i<r.rows;i++)for(let s=0;s<r.columns;s++)r.set(i,s,r.get(i,s)/e[s])}function QA(r){const e=r.size-1;let i=0;for(let s=0;s<r.columns;s++)for(let h=0;h<r.rows;h++)i+=Math.pow(r.get(h,s),2)/e;return Math.sqrt(i)}function eL(r,e){for(let i=0;i<r.rows;i++)for(let s=0;s<r.columns;s++)r.set(i,s,r.get(i,s)/e)}let On=class ys{static from1DArray(e,i,s){if(e*i!==s.length)throw new RangeError("data length does not match given dimensions");let h=new pi(e,i);for(let x=0;x<e;x++)for(let m=0;m<i;m++)h.set(x,m,s[x*i+m]);return h}static rowVector(e){let i=new pi(1,e.length);for(let s=0;s<e.length;s++)i.set(0,s,e[s]);return i}static columnVector(e){let i=new pi(e.length,1);for(let s=0;s<e.length;s++)i.set(s,0,e[s]);return i}static zeros(e,i){return new pi(e,i)}static ones(e,i){return new pi(e,i).fill(1)}static rand(e,i,s={}){if(typeof s!="object")throw new TypeError("options must be an object");const{random:h=Math.random}=s;let x=new pi(e,i);for(let m=0;m<e;m++)for(let o=0;o<i;o++)x.set(m,o,h());return x}static randInt(e,i,s={}){if(typeof s!="object")throw new TypeError("options must be an object");const{min:h=0,max:x=1e3,random:m=Math.random}=s;if(!Number.isInteger(h))throw new TypeError("min must be an integer");if(!Number.isInteger(x))throw new TypeError("max must be an integer");if(h>=x)throw new RangeError("min must be smaller than max");let o=x-h,P=new pi(e,i);for(let L=0;L<e;L++)for(let D=0;D<i;D++){let F=h+Math.round(m()*o);P.set(L,D,F)}return P}static eye(e,i,s){i===void 0&&(i=e),s===void 0&&(s=1);let h=Math.min(e,i),x=this.zeros(e,i);for(let m=0;m<h;m++)x.set(m,m,s);return x}static diag(e,i,s){let h=e.length;i===void 0&&(i=h),s===void 0&&(s=i);let x=Math.min(h,i,s),m=this.zeros(i,s);for(let o=0;o<x;o++)m.set(o,o,e[o]);return m}static min(e,i){e=this.checkMatrix(e),i=this.checkMatrix(i);let s=e.rows,h=e.columns,x=new pi(s,h);for(let m=0;m<s;m++)for(let o=0;o<h;o++)x.set(m,o,Math.min(e.get(m,o),i.get(m,o)));return x}static max(e,i){e=this.checkMatrix(e),i=this.checkMatrix(i);let s=e.rows,h=e.columns,x=new this(s,h);for(let m=0;m<s;m++)for(let o=0;o<h;o++)x.set(m,o,Math.max(e.get(m,o),i.get(m,o)));return x}static checkMatrix(e){return ys.isMatrix(e)?e:new pi(e)}static isMatrix(e){return e!=null&&e.klass==="Matrix"}get size(){return this.rows*this.columns}apply(e){if(typeof e!="function")throw new TypeError("callback must be a function");for(let i=0;i<this.rows;i++)for(let s=0;s<this.columns;s++)e.call(this,i,s);return this}to1DArray(){let e=[];for(let i=0;i<this.rows;i++)for(let s=0;s<this.columns;s++)e.push(this.get(i,s));return e}to2DArray(){let e=[];for(let i=0;i<this.rows;i++){e.push([]);for(let s=0;s<this.columns;s++)e[i].push(this.get(i,s))}return e}toJSON(){return this.to2DArray()}isRowVector(){return this.rows===1}isColumnVector(){return this.columns===1}isVector(){return this.rows===1||this.columns===1}isSquare(){return this.rows===this.columns}isEmpty(){return this.rows===0||this.columns===0}isSymmetric(){if(this.isSquare()){for(let e=0;e<this.rows;e++)for(let i=0;i<=e;i++)if(this.get(e,i)!==this.get(i,e))return!1;return!0}return!1}isDistance(){if(!this.isSymmetric())return!1;for(let e=0;e<this.rows;e++)if(this.get(e,e)!==0)return!1;return!0}isEchelonForm(){let e=0,i=0,s=-1,h=!0,x=!1;for(;e<this.rows&&h;){for(i=0,x=!1;i<this.columns&&x===!1;)this.get(e,i)===0?i++:this.get(e,i)===1&&i>s?(x=!0,s=i):(h=!1,x=!0);e++}return h}isReducedEchelonForm(){let e=0,i=0,s=-1,h=!0,x=!1;for(;e<this.rows&&h;){for(i=0,x=!1;i<this.columns&&x===!1;)this.get(e,i)===0?i++:this.get(e,i)===1&&i>s?(x=!0,s=i):(h=!1,x=!0);for(let m=i+1;m<this.rows;m++)this.get(e,m)!==0&&(h=!1);e++}return h}echelonForm(){let e=this.clone(),i=0,s=0;for(;i<e.rows&&s<e.columns;){let h=i;for(let x=i;x<e.rows;x++)e.get(x,s)>e.get(h,s)&&(h=x);if(e.get(h,s)===0)s++;else{e.swapRows(i,h);let x=e.get(i,s);for(let m=s;m<e.columns;m++)e.set(i,m,e.get(i,m)/x);for(let m=i+1;m<e.rows;m++){let o=e.get(m,s)/e.get(i,s);e.set(m,s,0);for(let P=s+1;P<e.columns;P++)e.set(m,P,e.get(m,P)-e.get(i,P)*o)}i++,s++}}return e}reducedEchelonForm(){let e=this.echelonForm(),i=e.columns,s=e.rows,h=s-1;for(;h>=0;)if(e.maxRow(h)===0)h--;else{let x=0,m=!1;for(;x<s&&m===!1;)e.get(h,x)===1?m=!0:x++;for(let o=0;o<h;o++){let P=e.get(o,x);for(let L=x;L<i;L++){let D=e.get(o,L)-P*e.get(h,L);e.set(o,L,D)}}h--}return e}set(){throw new Error("set method is unimplemented")}get(){throw new Error("get method is unimplemented")}repeat(e={}){if(typeof e!="object")throw new TypeError("options must be an object");const{rows:i=1,columns:s=1}=e;if(!Number.isInteger(i)||i<=0)throw new TypeError("rows must be a positive integer");if(!Number.isInteger(s)||s<=0)throw new TypeError("columns must be a positive integer");let h=new pi(this.rows*i,this.columns*s);for(let x=0;x<i;x++)for(let m=0;m<s;m++)h.setSubMatrix(this,this.rows*x,this.columns*m);return h}fill(e){for(let i=0;i<this.rows;i++)for(let s=0;s<this.columns;s++)this.set(i,s,e);return this}neg(){return this.mulS(-1)}getRow(e){fa(this,e);let i=[];for(let s=0;s<this.columns;s++)i.push(this.get(e,s));return i}getRowVector(e){return pi.rowVector(this.getRow(e))}setRow(e,i){fa(this,e),i=ah(this,i);for(let s=0;s<this.columns;s++)this.set(e,s,i[s]);return this}swapRows(e,i){fa(this,e),fa(this,i);for(let s=0;s<this.columns;s++){let h=this.get(e,s);this.set(e,s,this.get(i,s)),this.set(i,s,h)}return this}getColumn(e){ma(this,e);let i=[];for(let s=0;s<this.rows;s++)i.push(this.get(s,e));return i}getColumnVector(e){return pi.columnVector(this.getColumn(e))}setColumn(e,i){ma(this,e),i=lh(this,i);for(let s=0;s<this.rows;s++)this.set(s,e,i[s]);return this}swapColumns(e,i){ma(this,e),ma(this,i);for(let s=0;s<this.rows;s++){let h=this.get(s,e);this.set(s,e,this.get(s,i)),this.set(s,i,h)}return this}addRowVector(e){e=ah(this,e);for(let i=0;i<this.rows;i++)for(let s=0;s<this.columns;s++)this.set(i,s,this.get(i,s)+e[s]);return this}subRowVector(e){e=ah(this,e);for(let i=0;i<this.rows;i++)for(let s=0;s<this.columns;s++)this.set(i,s,this.get(i,s)-e[s]);return this}mulRowVector(e){e=ah(this,e);for(let i=0;i<this.rows;i++)for(let s=0;s<this.columns;s++)this.set(i,s,this.get(i,s)*e[s]);return this}divRowVector(e){e=ah(this,e);for(let i=0;i<this.rows;i++)for(let s=0;s<this.columns;s++)this.set(i,s,this.get(i,s)/e[s]);return this}addColumnVector(e){e=lh(this,e);for(let i=0;i<this.rows;i++)for(let s=0;s<this.columns;s++)this.set(i,s,this.get(i,s)+e[i]);return this}subColumnVector(e){e=lh(this,e);for(let i=0;i<this.rows;i++)for(let s=0;s<this.columns;s++)this.set(i,s,this.get(i,s)-e[i]);return this}mulColumnVector(e){e=lh(this,e);for(let i=0;i<this.rows;i++)for(let s=0;s<this.columns;s++)this.set(i,s,this.get(i,s)*e[i]);return this}divColumnVector(e){e=lh(this,e);for(let i=0;i<this.rows;i++)for(let s=0;s<this.columns;s++)this.set(i,s,this.get(i,s)/e[i]);return this}mulRow(e,i){fa(this,e);for(let s=0;s<this.columns;s++)this.set(e,s,this.get(e,s)*i);return this}mulColumn(e,i){ma(this,e);for(let s=0;s<this.rows;s++)this.set(s,e,this.get(s,e)*i);return this}max(e){if(this.isEmpty())return NaN;switch(e){case"row":{const i=new Array(this.rows).fill(Number.NEGATIVE_INFINITY);for(let s=0;s<this.rows;s++)for(let h=0;h<this.columns;h++)this.get(s,h)>i[s]&&(i[s]=this.get(s,h));return i}case"column":{const i=new Array(this.columns).fill(Number.NEGATIVE_INFINITY);for(let s=0;s<this.rows;s++)for(let h=0;h<this.columns;h++)this.get(s,h)>i[h]&&(i[h]=this.get(s,h));return i}case void 0:{let i=this.get(0,0);for(let s=0;s<this.rows;s++)for(let h=0;h<this.columns;h++)this.get(s,h)>i&&(i=this.get(s,h));return i}default:throw new Error(`invalid option: ${e}`)}}maxIndex(){th(this);let e=this.get(0,0),i=[0,0];for(let s=0;s<this.rows;s++)for(let h=0;h<this.columns;h++)this.get(s,h)>e&&(e=this.get(s,h),i[0]=s,i[1]=h);return i}min(e){if(this.isEmpty())return NaN;switch(e){case"row":{const i=new Array(this.rows).fill(Number.POSITIVE_INFINITY);for(let s=0;s<this.rows;s++)for(let h=0;h<this.columns;h++)this.get(s,h)<i[s]&&(i[s]=this.get(s,h));return i}case"column":{const i=new Array(this.columns).fill(Number.POSITIVE_INFINITY);for(let s=0;s<this.rows;s++)for(let h=0;h<this.columns;h++)this.get(s,h)<i[h]&&(i[h]=this.get(s,h));return i}case void 0:{let i=this.get(0,0);for(let s=0;s<this.rows;s++)for(let h=0;h<this.columns;h++)this.get(s,h)<i&&(i=this.get(s,h));return i}default:throw new Error(`invalid option: ${e}`)}}minIndex(){th(this);let e=this.get(0,0),i=[0,0];for(let s=0;s<this.rows;s++)for(let h=0;h<this.columns;h++)this.get(s,h)<e&&(e=this.get(s,h),i[0]=s,i[1]=h);return i}maxRow(e){if(fa(this,e),this.isEmpty())return NaN;let i=this.get(e,0);for(let s=1;s<this.columns;s++)this.get(e,s)>i&&(i=this.get(e,s));return i}maxRowIndex(e){fa(this,e),th(this);let i=this.get(e,0),s=[e,0];for(let h=1;h<this.columns;h++)this.get(e,h)>i&&(i=this.get(e,h),s[1]=h);return s}minRow(e){if(fa(this,e),this.isEmpty())return NaN;let i=this.get(e,0);for(let s=1;s<this.columns;s++)this.get(e,s)<i&&(i=this.get(e,s));return i}minRowIndex(e){fa(this,e),th(this);let i=this.get(e,0),s=[e,0];for(let h=1;h<this.columns;h++)this.get(e,h)<i&&(i=this.get(e,h),s[1]=h);return s}maxColumn(e){if(ma(this,e),this.isEmpty())return NaN;let i=this.get(0,e);for(let s=1;s<this.rows;s++)this.get(s,e)>i&&(i=this.get(s,e));return i}maxColumnIndex(e){ma(this,e),th(this);let i=this.get(0,e),s=[0,e];for(let h=1;h<this.rows;h++)this.get(h,e)>i&&(i=this.get(h,e),s[0]=h);return s}minColumn(e){if(ma(this,e),this.isEmpty())return NaN;let i=this.get(0,e);for(let s=1;s<this.rows;s++)this.get(s,e)<i&&(i=this.get(s,e));return i}minColumnIndex(e){ma(this,e),th(this);let i=this.get(0,e),s=[0,e];for(let h=1;h<this.rows;h++)this.get(h,e)<i&&(i=this.get(h,e),s[0]=h);return s}diag(){let e=Math.min(this.rows,this.columns),i=[];for(let s=0;s<e;s++)i.push(this.get(s,s));return i}norm(e="frobenius"){switch(e){case"max":return this.max();case"frobenius":return Math.sqrt(this.dot(this));default:throw new RangeError(`unknown norm type: ${e}`)}}cumulativeSum(){let e=0;for(let i=0;i<this.rows;i++)for(let s=0;s<this.columns;s++)e+=this.get(i,s),this.set(i,s,e);return this}dot(e){ys.isMatrix(e)&&(e=e.to1DArray());let i=this.to1DArray();if(i.length!==e.length)throw new RangeError("vectors do not have the same size");let s=0;for(let h=0;h<i.length;h++)s+=i[h]*e[h];return s}mmul(e){e=pi.checkMatrix(e);let i=this.rows,s=this.columns,h=e.columns,x=new pi(i,h),m=new Float64Array(s);for(let o=0;o<h;o++){for(let P=0;P<s;P++)m[P]=e.get(P,o);for(let P=0;P<i;P++){let L=0;for(let D=0;D<s;D++)L+=this.get(P,D)*m[D];x.set(P,o,L)}}return x}strassen2x2(e){e=pi.checkMatrix(e);let i=new pi(2,2);const s=this.get(0,0),h=e.get(0,0),x=this.get(0,1),m=e.get(0,1),o=this.get(1,0),P=e.get(1,0),L=this.get(1,1),D=e.get(1,1),F=(s+L)*(h+D),Y=(o+L)*h,V=s*(m-D),H=L*(P-h),ve=(s+x)*D,_e=(o-s)*(h+m),oe=(x-L)*(P+D),fe=F+H-ve+oe,K=V+ve,ne=Y+H,ye=F-Y+V+_e;return i.set(0,0,fe),i.set(0,1,K),i.set(1,0,ne),i.set(1,1,ye),i}strassen3x3(e){e=pi.checkMatrix(e);let i=new pi(3,3);const s=this.get(0,0),h=this.get(0,1),x=this.get(0,2),m=this.get(1,0),o=this.get(1,1),P=this.get(1,2),L=this.get(2,0),D=this.get(2,1),F=this.get(2,2),Y=e.get(0,0),V=e.get(0,1),H=e.get(0,2),ve=e.get(1,0),_e=e.get(1,1),oe=e.get(1,2),fe=e.get(2,0),K=e.get(2,1),ne=e.get(2,2),ye=(s+h+x-m-o-D-F)*_e,Re=(s-m)*(-V+_e),Se=o*(-Y+V+ve-_e-oe-fe+ne),Z=(-s+m+o)*(Y-V+_e),$=(m+o)*(-Y+V),Q=s*Y,ue=(-s+L+D)*(Y-H+oe),he=(-s+L)*(H-oe),Pe=(L+D)*(-Y+H),Ae=(s+h+x-o-P-L-D)*oe,ke=D*(-Y+H+ve-_e-oe-fe+K),Be=(-x+D+F)*(_e+fe-K),Ke=(x-F)*(_e-K),tt=x*fe,pt=(D+F)*(-fe+K),vt=(-x+o+P)*(oe+fe-ne),Ft=(x-P)*(oe-ne),It=(o+P)*(-fe+ne),Zt=h*ve,zt=P*K,ti=m*H,ai=L*V,Ir=F*ne,lt=Q+tt+Zt,Xi=ye+Z+$+Q+Be+tt+pt,ii=Q+ue+Pe+Ae+tt+vt+It,Jt=Re+Se+Z+Q+tt+vt+Ft,$e=Re+Z+$+Q+zt,zi=tt+vt+Ft+It+ti,Qi=Q+ue+he+ke+Be+Ke+tt,Gi=Be+Ke+tt+pt+ai,sr=Q+ue+he+Pe+Ir;return i.set(0,0,lt),i.set(0,1,Xi),i.set(0,2,ii),i.set(1,0,Jt),i.set(1,1,$e),i.set(1,2,zi),i.set(2,0,Qi),i.set(2,1,Gi),i.set(2,2,sr),i}mmulStrassen(e){e=pi.checkMatrix(e);let i=this.clone(),s=i.rows,h=i.columns,x=e.rows,m=e.columns;h!==x&&console.warn(`Multiplying ${s} x ${h} and ${x} x ${m} matrix: dimensions do not match.`);function o(F,Y,V){let H=F.rows,ve=F.columns;if(H===Y&&ve===V)return F;{let _e=ys.zeros(Y,V);return _e=_e.setSubMatrix(F,0,0),_e}}let P=Math.max(s,x),L=Math.max(h,m);i=o(i,P,L),e=o(e,P,L);function D(F,Y,V,H){if(V<=512||H<=512)return F.mmul(Y);V%2===1&&H%2===1?(F=o(F,V+1,H+1),Y=o(Y,V+1,H+1)):V%2===1?(F=o(F,V+1,H),Y=o(Y,V+1,H)):H%2===1&&(F=o(F,V,H+1),Y=o(Y,V,H+1));let ve=parseInt(F.rows/2,10),_e=parseInt(F.columns/2,10),oe=F.subMatrix(0,ve-1,0,_e-1),fe=Y.subMatrix(0,ve-1,0,_e-1),K=F.subMatrix(0,ve-1,_e,F.columns-1),ne=Y.subMatrix(0,ve-1,_e,Y.columns-1),ye=F.subMatrix(ve,F.rows-1,0,_e-1),Re=Y.subMatrix(ve,Y.rows-1,0,_e-1),Se=F.subMatrix(ve,F.rows-1,_e,F.columns-1),Z=Y.subMatrix(ve,Y.rows-1,_e,Y.columns-1),$=D(ys.add(oe,Se),ys.add(fe,Z),ve,_e),Q=D(ys.add(ye,Se),fe,ve,_e),ue=D(oe,ys.sub(ne,Z),ve,_e),he=D(Se,ys.sub(Re,fe),ve,_e),Pe=D(ys.add(oe,K),Z,ve,_e),Ae=D(ys.sub(ye,oe),ys.add(fe,ne),ve,_e),ke=D(ys.sub(K,Se),ys.add(Re,Z),ve,_e),Be=ys.add($,he);Be.sub(Pe),Be.add(ke);let Ke=ys.add(ue,Pe),tt=ys.add(Q,he),pt=ys.sub($,Q);pt.add(ue),pt.add(Ae);let vt=ys.zeros(2*Be.rows,2*Be.columns);return vt=vt.setSubMatrix(Be,0,0),vt=vt.setSubMatrix(Ke,Be.rows,0),vt=vt.setSubMatrix(tt,0,Be.columns),vt=vt.setSubMatrix(pt,Be.rows,Be.columns),vt.subMatrix(0,V-1,0,H-1)}return D(i,e,P,L)}scaleRows(e={}){if(typeof e!="object")throw new TypeError("options must be an object");const{min:i=0,max:s=1}=e;if(!Number.isFinite(i))throw new TypeError("min must be a number");if(!Number.isFinite(s))throw new TypeError("max must be a number");if(i>=s)throw new RangeError("min must be smaller than max");let h=new pi(this.rows,this.columns);for(let x=0;x<this.rows;x++){const m=this.getRow(x);m.length>0&&u1(m,{min:i,max:s,output:m}),h.setRow(x,m)}return h}scaleColumns(e={}){if(typeof e!="object")throw new TypeError("options must be an object");const{min:i=0,max:s=1}=e;if(!Number.isFinite(i))throw new TypeError("min must be a number");if(!Number.isFinite(s))throw new TypeError("max must be a number");if(i>=s)throw new RangeError("min must be smaller than max");let h=new pi(this.rows,this.columns);for(let x=0;x<this.columns;x++){const m=this.getColumn(x);m.length&&u1(m,{min:i,max:s,output:m}),h.setColumn(x,m)}return h}flipRows(){const e=Math.ceil(this.columns/2);for(let i=0;i<this.rows;i++)for(let s=0;s<e;s++){let h=this.get(i,s),x=this.get(i,this.columns-1-s);this.set(i,s,x),this.set(i,this.columns-1-s,h)}return this}flipColumns(){const e=Math.ceil(this.rows/2);for(let i=0;i<this.columns;i++)for(let s=0;s<e;s++){let h=this.get(s,i),x=this.get(this.rows-1-s,i);this.set(s,i,x),this.set(this.rows-1-s,i,h)}return this}kroneckerProduct(e){e=pi.checkMatrix(e);let i=this.rows,s=this.columns,h=e.rows,x=e.columns,m=new pi(i*h,s*x);for(let o=0;o<i;o++)for(let P=0;P<s;P++)for(let L=0;L<h;L++)for(let D=0;D<x;D++)m.set(h*o+L,x*P+D,this.get(o,P)*e.get(L,D));return m}kroneckerSum(e){if(e=pi.checkMatrix(e),!this.isSquare()||!e.isSquare())throw new Error("Kronecker Sum needs two Square Matrices");let i=this.rows,s=e.rows,h=this.kroneckerProduct(pi.eye(s,s)),x=pi.eye(i,i).kroneckerProduct(e);return h.add(x)}transpose(){let e=new pi(this.columns,this.rows);for(let i=0;i<this.rows;i++)for(let s=0;s<this.columns;s++)e.set(s,i,this.get(i,s));return e}sortRows(e=h1){for(let i=0;i<this.rows;i++)this.setRow(i,this.getRow(i).sort(e));return this}sortColumns(e=h1){for(let i=0;i<this.columns;i++)this.setColumn(i,this.getColumn(i).sort(e));return this}subMatrix(e,i,s,h){Yy(this,e,i,s,h);let x=new pi(i-e+1,h-s+1);for(let m=e;m<=i;m++)for(let o=s;o<=h;o++)x.set(m-e,o-s,this.get(m,o));return x}subMatrixRow(e,i,s){if(i===void 0&&(i=0),s===void 0&&(s=this.columns-1),i>s||i<0||i>=this.columns||s<0||s>=this.columns)throw new RangeError("Argument out of range");let h=new pi(e.length,s-i+1);for(let x=0;x<e.length;x++)for(let m=i;m<=s;m++){if(e[x]<0||e[x]>=this.rows)throw new RangeError(`Row index out of range: ${e[x]}`);h.set(x,m-i,this.get(e[x],m))}return h}subMatrixColumn(e,i,s){if(i===void 0&&(i=0),s===void 0&&(s=this.rows-1),i>s||i<0||i>=this.rows||s<0||s>=this.rows)throw new RangeError("Argument out of range");let h=new pi(s-i+1,e.length);for(let x=0;x<e.length;x++)for(let m=i;m<=s;m++){if(e[x]<0||e[x]>=this.columns)throw new RangeError(`Column index out of range: ${e[x]}`);h.set(m-i,x,this.get(m,e[x]))}return h}setSubMatrix(e,i,s){if(e=pi.checkMatrix(e),e.isEmpty())return this;let h=i+e.rows-1,x=s+e.columns-1;Yy(this,i,h,s,x);for(let m=0;m<e.rows;m++)for(let o=0;o<e.columns;o++)this.set(i+m,s+o,e.get(m,o));return this}selection(e,i){D_(this,e),F_(this,i);let s=new pi(e.length,i.length);for(let h=0;h<e.length;h++){let x=e[h];for(let m=0;m<i.length;m++){let o=i[m];s.set(h,m,this.get(x,o))}}return s}trace(){let e=Math.min(this.rows,this.columns),i=0;for(let s=0;s<e;s++)i+=this.get(s,s);return i}clone(){return this.constructor.copy(this,new pi(this.rows,this.columns))}static copy(e,i){for(const[s,h,x]of e.entries())i.set(s,h,x);return i}sum(e){switch(e){case"row":return FA(this);case"column":return zA(this);case void 0:return BA(this);default:throw new Error(`invalid option: ${e}`)}}product(e){switch(e){case"row":return $A(this);case"column":return jA(this);case void 0:return GA(this);default:throw new Error(`invalid option: ${e}`)}}mean(e){const i=this.sum(e);switch(e){case"row":{for(let s=0;s<this.rows;s++)i[s]/=this.columns;return i}case"column":{for(let s=0;s<this.columns;s++)i[s]/=this.rows;return i}case void 0:return i/this.size;default:throw new Error(`invalid option: ${e}`)}}variance(e,i={}){if(typeof e=="object"&&(i=e,e=void 0),typeof i!="object")throw new TypeError("options must be an object");const{unbiased:s=!0,mean:h=this.mean(e)}=i;if(typeof s!="boolean")throw new TypeError("unbiased must be a boolean");switch(e){case"row":{if(!Eo.isAnyArray(h))throw new TypeError("mean must be an array");return UA(this,s,h)}case"column":{if(!Eo.isAnyArray(h))throw new TypeError("mean must be an array");return VA(this,s,h)}case void 0:{if(typeof h!="number")throw new TypeError("mean must be a number");return qA(this,s,h)}default:throw new Error(`invalid option: ${e}`)}}standardDeviation(e,i){typeof e=="object"&&(i=e,e=void 0);const s=this.variance(e,i);if(e===void 0)return Math.sqrt(s);for(let h=0;h<s.length;h++)s[h]=Math.sqrt(s[h]);return s}center(e,i={}){if(typeof e=="object"&&(i=e,e=void 0),typeof i!="object")throw new TypeError("options must be an object");const{center:s=this.mean(e)}=i;switch(e){case"row":{if(!Eo.isAnyArray(s))throw new TypeError("center must be an array");return ZA(this,s),this}case"column":{if(!Eo.isAnyArray(s))throw new TypeError("center must be an array");return WA(this,s),this}case void 0:{if(typeof s!="number")throw new TypeError("center must be a number");return YA(this,s),this}default:throw new Error(`invalid option: ${e}`)}}scale(e,i={}){if(typeof e=="object"&&(i=e,e=void 0),typeof i!="object")throw new TypeError("options must be an object");let s=i.scale;switch(e){case"row":{if(s===void 0)s=XA(this);else if(!Eo.isAnyArray(s))throw new TypeError("scale must be an array");return HA(this,s),this}case"column":{if(s===void 0)s=KA(this);else if(!Eo.isAnyArray(s))throw new TypeError("scale must be an array");return JA(this,s),this}case void 0:{if(s===void 0)s=QA(this);else if(typeof s!="number")throw new TypeError("scale must be a number");return eL(this,s),this}default:throw new Error(`invalid option: ${e}`)}}toString(e){return eT(this,e)}[Symbol.iterator](){return this.entries()}*entries(){for(let e=0;e<this.rows;e++)for(let i=0;i<this.columns;i++)yield[e,i,this.get(e,i)]}*values(){for(let e=0;e<this.rows;e++)for(let i=0;i<this.columns;i++)yield this.get(e,i)}};On.prototype.klass="Matrix";typeof Symbol<"u"&&(On.prototype[Symbol.for("nodejs.util.inspect.custom")]=RA);function h1(r,e){return r-e}function tL(r){return r.every(e=>typeof e=="number")}On.random=On.rand;On.randomInt=On.randInt;On.diagonal=On.diag;On.prototype.diagonal=On.prototype.diag;On.identity=On.eye;On.prototype.negate=On.prototype.neg;On.prototype.tensorProduct=On.prototype.kroneckerProduct;let pi=class Xy extends On{data;#e(e,i){if(this.data=[],Number.isInteger(i)&&i>=0)for(let s=0;s<e;s++)this.data.push(new Float64Array(i));else throw new TypeError("nColumns must be a positive integer");this.rows=e,this.columns=i}constructor(e,i){if(super(),Xy.isMatrix(e))this.#e(e.rows,e.columns),Xy.copy(e,this);else if(Number.isInteger(e)&&e>=0)this.#e(e,i);else if(Eo.isAnyArray(e)){const s=e;if(e=s.length,i=e?s[0].length:0,typeof i!="number")throw new TypeError("Data must be a 2D array with at least one element");this.data=[];for(let h=0;h<e;h++){if(s[h].length!==i)throw new RangeError("Inconsistent array dimensions");if(!tL(s[h]))throw new TypeError("Input data contains non-numeric values");this.data.push(Float64Array.from(s[h]))}this.rows=e,this.columns=i}else throw new TypeError("First argument must be a positive number or an array")}set(e,i,s){return this.data[e][i]=s,this}get(e,i){return this.data[e][i]}removeRow(e){return fa(this,e),this.data.splice(e,1),this.rows-=1,this}addRow(e,i){return i===void 0&&(i=e,e=this.rows),fa(this,e,!0),i=Float64Array.from(ah(this,i)),this.data.splice(e,0,i),this.rows+=1,this}removeColumn(e){ma(this,e);for(let i=0;i<this.rows;i++){const s=new Float64Array(this.columns-1);for(let h=0;h<e;h++)s[h]=this.data[i][h];for(let h=e+1;h<this.columns;h++)s[h-1]=this.data[i][h];this.data[i]=s}return this.columns-=1,this}addColumn(e,i){typeof i>"u"&&(i=e,e=this.columns),ma(this,e,!0),i=lh(this,i);for(let s=0;s<this.rows;s++){const h=new Float64Array(this.columns+1);let x=0;for(;x<e;x++)h[x]=this.data[s][x];for(h[x++]=i[s];x<this.columns+1;x++)h[x]=this.data[s][x-1];this.data[s]=h}return this.columns+=1,this}};DA(On,pi);class Tu extends On{#e;get size(){return this.#e.size}get rows(){return this.#e.rows}get columns(){return this.#e.columns}get diagonalSize(){return this.rows}static isSymmetricMatrix(e){return pi.isMatrix(e)&&e.klassType==="SymmetricMatrix"}static zeros(e){return new this(e)}static ones(e){return new this(e).fill(1)}constructor(e){if(super(),pi.isMatrix(e)){if(!e.isSymmetric())throw new TypeError("not symmetric data");this.#e=pi.copy(e,new pi(e.rows,e.rows))}else if(Number.isInteger(e)&&e>=0)this.#e=new pi(e,e);else if(this.#e=new pi(e),!this.isSymmetric())throw new TypeError("not symmetric data")}clone(){const e=new Tu(this.diagonalSize);for(const[i,s,h]of this.upperRightEntries())e.set(i,s,h);return e}toMatrix(){return new pi(this)}get(e,i){return this.#e.get(e,i)}set(e,i,s){return this.#e.set(e,i,s),this.#e.set(i,e,s),this}removeCross(e){return this.#e.removeRow(e),this.#e.removeColumn(e),this}addCross(e,i){i===void 0&&(i=e,e=this.diagonalSize);const s=i.slice();return s.splice(e,1),this.#e.addRow(e,s),this.#e.addColumn(e,i),this}applyMask(e){if(e.length!==this.diagonalSize)throw new RangeError("Mask size do not match with matrix size");const i=[];for(const[s,h]of e.entries())h||i.push(s);i.reverse();for(const s of i)this.removeCross(s);return this}toCompact(){const{diagonalSize:e}=this,i=new Array(e*(e+1)/2);for(let s=0,h=0,x=0;x<i.length;x++)i[x]=this.get(h,s),++s>=e&&(s=++h);return i}static fromCompact(e){const i=e.length,s=(Math.sqrt(8*i+1)-1)/2;if(!Number.isInteger(s))throw new TypeError(`This array is not a compact representation of a Symmetric Matrix, ${JSON.stringify(e)}`);const h=new Tu(s);for(let x=0,m=0,o=0;o<i;o++)h.set(x,m,e[o]),++x>=s&&(x=++m);return h}*upperRightEntries(){for(let e=0,i=0;e<this.diagonalSize;void 0){const s=this.get(e,i);yield[e,i,s],++i>=this.diagonalSize&&(i=++e)}}*upperRightValues(){for(let e=0,i=0;e<this.diagonalSize;void 0)yield this.get(e,i),++i>=this.diagonalSize&&(i=++e)}}Tu.prototype.klassType="SymmetricMatrix";class Bm extends Tu{static isDistanceMatrix(e){return Tu.isSymmetricMatrix(e)&&e.klassSubType==="DistanceMatrix"}constructor(e){if(super(e),!this.isDistance())throw new TypeError("Provided arguments do no produce a distance matrix")}set(e,i,s){return e===i&&(s=0),super.set(e,i,s)}addCross(e,i){return i===void 0&&(i=e,e=this.diagonalSize),i=i.slice(),i[e]=0,super.addCross(e,i)}toSymmetricMatrix(){return new Tu(this)}clone(){const e=new Bm(this.diagonalSize);for(const[i,s,h]of this.upperRightEntries())i!==s&&e.set(i,s,h);return e}toCompact(){const{diagonalSize:e}=this,i=(e-1)*e/2,s=new Array(i);for(let h=1,x=0,m=0;m<s.length;m++)s[m]=this.get(x,h),++h>=e&&(h=++x+1);return s}static fromCompact(e){const i=e.length,s=(Math.sqrt(8*i+1)+1)/2;if(!Number.isInteger(s))throw new TypeError(`This array is not a compact representation of a DistanceMatrix, ${JSON.stringify(e)}`);const h=new this(s);for(let x=1,m=0,o=0;o<i;o++)h.set(x,m,e[o]),++x>=s&&(x=++m+1);return h}}Bm.prototype.klassSubType="DistanceMatrix";class Zl extends On{constructor(e,i,s){super(),this.matrix=e,this.rows=i,this.columns=s}}class iL extends Zl{constructor(e,i){ma(e,i),super(e,e.rows,1),this.column=i}set(e,i,s){return this.matrix.set(e,this.column,s),this}get(e){return this.matrix.get(e,this.column)}}class rL extends Zl{constructor(e,i){F_(e,i),super(e,e.rows,i.length),this.columnIndices=i}set(e,i,s){return this.matrix.set(e,this.columnIndices[i],s),this}get(e,i){return this.matrix.get(e,this.columnIndices[i])}}class nL extends Zl{constructor(e){super(e,e.rows,e.columns)}set(e,i,s){return this.matrix.set(e,this.columns-i-1,s),this}get(e,i){return this.matrix.get(e,this.columns-i-1)}}class sL extends Zl{constructor(e){super(e,e.rows,e.columns)}set(e,i,s){return this.matrix.set(this.rows-e-1,i,s),this}get(e,i){return this.matrix.get(this.rows-e-1,i)}}class oL extends Zl{constructor(e,i){fa(e,i),super(e,1,e.columns),this.row=i}set(e,i,s){return this.matrix.set(this.row,i,s),this}get(e,i){return this.matrix.get(this.row,i)}}class aL extends Zl{constructor(e,i){D_(e,i),super(e,i.length,e.columns),this.rowIndices=i}set(e,i,s){return this.matrix.set(this.rowIndices[e],i,s),this}get(e,i){return this.matrix.get(this.rowIndices[e],i)}}class Gf extends Zl{constructor(e,i,s){D_(e,i),F_(e,s),super(e,i.length,s.length),this.rowIndices=i,this.columnIndices=s}set(e,i,s){return this.matrix.set(this.rowIndices[e],this.columnIndices[i],s),this}get(e,i){return this.matrix.get(this.rowIndices[e],this.columnIndices[i])}}class lL extends Zl{constructor(e,i,s,h,x){Yy(e,i,s,h,x),super(e,s-i+1,x-h+1),this.startRow=i,this.startColumn=h}set(e,i,s){return this.matrix.set(this.startRow+e,this.startColumn+i,s),this}get(e,i){return this.matrix.get(this.startRow+e,this.startColumn+i)}}class uL extends Zl{constructor(e){super(e,e.columns,e.rows)}set(e,i,s){return this.matrix.set(i,e,s),this}get(e,i){return this.matrix.get(i,e)}}class tT extends On{constructor(e,i={}){const{rows:s=1}=i;if(e.length%s!==0)throw new Error("the data length is not divisible by the number of rows");super(),this.rows=s,this.columns=e.length/s,this.data=e}set(e,i,s){let h=this._calculateIndex(e,i);return this.data[h]=s,this}get(e,i){let s=this._calculateIndex(e,i);return this.data[s]}_calculateIndex(e,i){return e*this.columns+i}}let qo=class extends On{constructor(r){super(),this.data=r,this.rows=r.length,this.columns=r[0].length}set(r,e,i){return this.data[r][e]=i,this}get(r,e){return this.data[r][e]}};function cL(r,e){if(Eo.isAnyArray(r))return r[0]&&Eo.isAnyArray(r[0])?new qo(r):new tT(r,e);throw new Error("the argument is not an array")}class $m{constructor(e){e=qo.checkMatrix(e);let i=e.clone(),s=i.rows,h=i.columns,x=new Float64Array(s),m=1,o,P,L,D,F,Y,V,H,ve;for(o=0;o<s;o++)x[o]=o;for(H=new Float64Array(s),P=0;P<h;P++){for(o=0;o<s;o++)H[o]=i.get(o,P);for(o=0;o<s;o++){for(ve=Math.min(o,P),F=0,L=0;L<ve;L++)F+=i.get(o,L)*H[L];H[o]-=F,i.set(o,P,H[o])}for(D=P,o=P+1;o<s;o++)Math.abs(H[o])>Math.abs(H[D])&&(D=o);if(D!==P){for(L=0;L<h;L++)Y=i.get(D,L),i.set(D,L,i.get(P,L)),i.set(P,L,Y);V=x[D],x[D]=x[P],x[P]=V,m=-m}if(P<s&&i.get(P,P)!==0)for(o=P+1;o<s;o++)i.set(o,P,i.get(o,P)/i.get(P,P))}this.LU=i,this.pivotVector=x,this.pivotSign=m}isSingular(){let e=this.LU,i=e.columns;for(let s=0;s<i;s++)if(e.get(s,s)===0)return!0;return!1}solve(e){e=pi.checkMatrix(e);let i=this.LU;if(i.rows!==e.rows)throw new Error("Invalid matrix dimensions");if(this.isSingular())throw new Error("LU matrix is singular");let s=e.columns,h=e.subMatrixRow(this.pivotVector,0,s-1),x=i.columns,m,o,P;for(P=0;P<x;P++)for(m=P+1;m<x;m++)for(o=0;o<s;o++)h.set(m,o,h.get(m,o)-h.get(P,o)*i.get(m,P));for(P=x-1;P>=0;P--){for(o=0;o<s;o++)h.set(P,o,h.get(P,o)/i.get(P,P));for(m=0;m<P;m++)for(o=0;o<s;o++)h.set(m,o,h.get(m,o)-h.get(P,o)*i.get(m,P))}return h}get determinant(){let e=this.LU;if(!e.isSquare())throw new Error("Matrix must be square");let i=this.pivotSign,s=e.columns;for(let h=0;h<s;h++)i*=e.get(h,h);return i}get lowerTriangularMatrix(){let e=this.LU,i=e.rows,s=e.columns,h=new pi(i,s);for(let x=0;x<i;x++)for(let m=0;m<s;m++)x>m?h.set(x,m,e.get(x,m)):x===m?h.set(x,m,1):h.set(x,m,0);return h}get upperTriangularMatrix(){let e=this.LU,i=e.rows,s=e.columns,h=new pi(i,s);for(let x=0;x<i;x++)for(let m=0;m<s;m++)x<=m?h.set(x,m,e.get(x,m)):h.set(x,m,0);return h}get pivotPermutationVector(){return Array.from(this.pivotVector)}}function Ol(r,e){let i=0;return Math.abs(r)>Math.abs(e)?(i=e/r,Math.abs(r)*Math.sqrt(1+i*i)):e!==0?(i=r/e,Math.abs(e)*Math.sqrt(1+i*i)):0}class z_{constructor(e){e=qo.checkMatrix(e);let i=e.clone(),s=e.rows,h=e.columns,x=new Float64Array(h),m,o,P,L;for(P=0;P<h;P++){let D=0;for(m=P;m<s;m++)D=Ol(D,i.get(m,P));if(D!==0){for(i.get(P,P)<0&&(D=-D),m=P;m<s;m++)i.set(m,P,i.get(m,P)/D);for(i.set(P,P,i.get(P,P)+1),o=P+1;o<h;o++){for(L=0,m=P;m<s;m++)L+=i.get(m,P)*i.get(m,o);for(L=-L/i.get(P,P),m=P;m<s;m++)i.set(m,o,i.get(m,o)+L*i.get(m,P))}}x[P]=-D}this.QR=i,this.Rdiag=x}solve(e){e=pi.checkMatrix(e);let i=this.QR,s=i.rows;if(e.rows!==s)throw new Error("Matrix row dimensions must agree");if(!this.isFullRank())throw new Error("Matrix is rank deficient");let h=e.columns,x=e.clone(),m=i.columns,o,P,L,D;for(L=0;L<m;L++)for(P=0;P<h;P++){for(D=0,o=L;o<s;o++)D+=i.get(o,L)*x.get(o,P);for(D=-D/i.get(L,L),o=L;o<s;o++)x.set(o,P,x.get(o,P)+D*i.get(o,L))}for(L=m-1;L>=0;L--){for(P=0;P<h;P++)x.set(L,P,x.get(L,P)/this.Rdiag[L]);for(o=0;o<L;o++)for(P=0;P<h;P++)x.set(o,P,x.get(o,P)-x.get(L,P)*i.get(o,L))}return x.subMatrix(0,m-1,0,h-1)}isFullRank(){let e=this.QR.columns;for(let i=0;i<e;i++)if(this.Rdiag[i]===0)return!1;return!0}get upperTriangularMatrix(){let e=this.QR,i=e.columns,s=new pi(i,i),h,x;for(h=0;h<i;h++)for(x=0;x<i;x++)h<x?s.set(h,x,e.get(h,x)):h===x?s.set(h,x,this.Rdiag[h]):s.set(h,x,0);return s}get orthogonalMatrix(){let e=this.QR,i=e.rows,s=e.columns,h=new pi(i,s),x,m,o,P;for(o=s-1;o>=0;o--){for(x=0;x<i;x++)h.set(x,o,0);for(h.set(o,o,1),m=o;m<s;m++)if(e.get(o,o)!==0){for(P=0,x=o;x<i;x++)P+=e.get(x,o)*h.get(x,m);for(P=-P/e.get(o,o),x=o;x<i;x++)h.set(x,m,h.get(x,m)+P*e.get(x,o))}}return h}}let Sh=class{constructor(r,e={}){if(r=qo.checkMatrix(r),r.isEmpty())throw new Error("Matrix must be non-empty");let i=r.rows,s=r.columns;const{computeLeftSingularVectors:h=!0,computeRightSingularVectors:x=!0,autoTranspose:m=!1}=e;let o=!!h,P=!!x,L=!1,D;if(i<s)if(!m)D=r.clone(),console.warn("Computing SVD on a matrix with more columns than rows. Consider enabling autoTranspose");else{D=r.transpose(),i=D.rows,s=D.columns,L=!0;let $=o;o=P,P=$}else D=r.clone();let F=Math.min(i,s),Y=Math.min(i+1,s),V=new Float64Array(Y),H=new pi(i,F),ve=new pi(s,s),_e=new Float64Array(s),oe=new Float64Array(i),fe=new Float64Array(Y);for(let $=0;$<Y;$++)fe[$]=$;let K=Math.min(i-1,s),ne=Math.max(0,Math.min(s-2,i)),ye=Math.max(K,ne);for(let $=0;$<ye;$++){if($<K){V[$]=0;for(let Q=$;Q<i;Q++)V[$]=Ol(V[$],D.get(Q,$));if(V[$]!==0){D.get($,$)<0&&(V[$]=-V[$]);for(let Q=$;Q<i;Q++)D.set(Q,$,D.get(Q,$)/V[$]);D.set($,$,D.get($,$)+1)}V[$]=-V[$]}for(let Q=$+1;Q<s;Q++){if($<K&&V[$]!==0){let ue=0;for(let he=$;he<i;he++)ue+=D.get(he,$)*D.get(he,Q);ue=-ue/D.get($,$);for(let he=$;he<i;he++)D.set(he,Q,D.get(he,Q)+ue*D.get(he,$))}_e[Q]=D.get($,Q)}if(o&&$<K)for(let Q=$;Q<i;Q++)H.set(Q,$,D.get(Q,$));if($<ne){_e[$]=0;for(let Q=$+1;Q<s;Q++)_e[$]=Ol(_e[$],_e[Q]);if(_e[$]!==0){_e[$+1]<0&&(_e[$]=0-_e[$]);for(let Q=$+1;Q<s;Q++)_e[Q]/=_e[$];_e[$+1]+=1}if(_e[$]=-_e[$],$+1<i&&_e[$]!==0){for(let Q=$+1;Q<i;Q++)oe[Q]=0;for(let Q=$+1;Q<i;Q++)for(let ue=$+1;ue<s;ue++)oe[Q]+=_e[ue]*D.get(Q,ue);for(let Q=$+1;Q<s;Q++){let ue=-_e[Q]/_e[$+1];for(let he=$+1;he<i;he++)D.set(he,Q,D.get(he,Q)+ue*oe[he])}}if(P)for(let Q=$+1;Q<s;Q++)ve.set(Q,$,_e[Q])}}let Re=Math.min(s,i+1);if(K<s&&(V[K]=D.get(K,K)),i<Re&&(V[Re-1]=0),ne+1<Re&&(_e[ne]=D.get(ne,Re-1)),_e[Re-1]=0,o){for(let $=K;$<F;$++){for(let Q=0;Q<i;Q++)H.set(Q,$,0);H.set($,$,1)}for(let $=K-1;$>=0;$--)if(V[$]!==0){for(let Q=$+1;Q<F;Q++){let ue=0;for(let he=$;he<i;he++)ue+=H.get(he,$)*H.get(he,Q);ue=-ue/H.get($,$);for(let he=$;he<i;he++)H.set(he,Q,H.get(he,Q)+ue*H.get(he,$))}for(let Q=$;Q<i;Q++)H.set(Q,$,-H.get(Q,$));H.set($,$,1+H.get($,$));for(let Q=0;Q<$-1;Q++)H.set(Q,$,0)}else{for(let Q=0;Q<i;Q++)H.set(Q,$,0);H.set($,$,1)}}if(P)for(let $=s-1;$>=0;$--){if($<ne&&_e[$]!==0)for(let Q=$+1;Q<s;Q++){let ue=0;for(let he=$+1;he<s;he++)ue+=ve.get(he,$)*ve.get(he,Q);ue=-ue/ve.get($+1,$);for(let he=$+1;he<s;he++)ve.set(he,Q,ve.get(he,Q)+ue*ve.get(he,$))}for(let Q=0;Q<s;Q++)ve.set(Q,$,0);ve.set($,$,1)}let Se=Re-1,Z=Number.EPSILON;for(;Re>0;){let $,Q;for($=Re-2;$>=-1&&$!==-1;$--){const ue=Number.MIN_VALUE+Z*Math.abs(V[$]+Math.abs(V[$+1]));if(Math.abs(_e[$])<=ue||Number.isNaN(_e[$])){_e[$]=0;break}}if($===Re-2)Q=4;else{let ue;for(ue=Re-1;ue>=$&&ue!==$;ue--){let he=(ue!==Re?Math.abs(_e[ue]):0)+(ue!==$+1?Math.abs(_e[ue-1]):0);if(Math.abs(V[ue])<=Z*he){V[ue]=0;break}}ue===$?Q=3:ue===Re-1?Q=1:(Q=2,$=ue)}switch($++,Q){case 1:{let ue=_e[Re-2];_e[Re-2]=0;for(let he=Re-2;he>=$;he--){let Pe=Ol(V[he],ue),Ae=V[he]/Pe,ke=ue/Pe;if(V[he]=Pe,he!==$&&(ue=-ke*_e[he-1],_e[he-1]=Ae*_e[he-1]),P)for(let Be=0;Be<s;Be++)Pe=Ae*ve.get(Be,he)+ke*ve.get(Be,Re-1),ve.set(Be,Re-1,-ke*ve.get(Be,he)+Ae*ve.get(Be,Re-1)),ve.set(Be,he,Pe)}break}case 2:{let ue=_e[$-1];_e[$-1]=0;for(let he=$;he<Re;he++){let Pe=Ol(V[he],ue),Ae=V[he]/Pe,ke=ue/Pe;if(V[he]=Pe,ue=-ke*_e[he],_e[he]=Ae*_e[he],o)for(let Be=0;Be<i;Be++)Pe=Ae*H.get(Be,he)+ke*H.get(Be,$-1),H.set(Be,$-1,-ke*H.get(Be,he)+Ae*H.get(Be,$-1)),H.set(Be,he,Pe)}break}case 3:{const ue=Math.max(Math.abs(V[Re-1]),Math.abs(V[Re-2]),Math.abs(_e[Re-2]),Math.abs(V[$]),Math.abs(_e[$])),he=V[Re-1]/ue,Pe=V[Re-2]/ue,Ae=_e[Re-2]/ue,ke=V[$]/ue,Be=_e[$]/ue,Ke=((Pe+he)*(Pe-he)+Ae*Ae)/2,tt=he*Ae*(he*Ae);let pt=0;(Ke!==0||tt!==0)&&(Ke<0?pt=0-Math.sqrt(Ke*Ke+tt):pt=Math.sqrt(Ke*Ke+tt),pt=tt/(Ke+pt));let vt=(ke+he)*(ke-he)+pt,Ft=ke*Be;for(let It=$;It<Re-1;It++){let Zt=Ol(vt,Ft);Zt===0&&(Zt=Number.MIN_VALUE);let zt=vt/Zt,ti=Ft/Zt;if(It!==$&&(_e[It-1]=Zt),vt=zt*V[It]+ti*_e[It],_e[It]=zt*_e[It]-ti*V[It],Ft=ti*V[It+1],V[It+1]=zt*V[It+1],P)for(let ai=0;ai<s;ai++)Zt=zt*ve.get(ai,It)+ti*ve.get(ai,It+1),ve.set(ai,It+1,-ti*ve.get(ai,It)+zt*ve.get(ai,It+1)),ve.set(ai,It,Zt);if(Zt=Ol(vt,Ft),Zt===0&&(Zt=Number.MIN_VALUE),zt=vt/Zt,ti=Ft/Zt,V[It]=Zt,vt=zt*_e[It]+ti*V[It+1],V[It+1]=-ti*_e[It]+zt*V[It+1],Ft=ti*_e[It+1],_e[It+1]=zt*_e[It+1],o&&It<i-1)for(let ai=0;ai<i;ai++)Zt=zt*H.get(ai,It)+ti*H.get(ai,It+1),H.set(ai,It+1,-ti*H.get(ai,It)+zt*H.get(ai,It+1)),H.set(ai,It,Zt)}_e[Re-2]=vt;break}case 4:{if(V[$]<=0&&(V[$]=V[$]<0?-V[$]:0,P))for(let ue=0;ue<=Se;ue++)ve.set(ue,$,-ve.get(ue,$));for(;$<Se&&!(V[$]>=V[$+1]);){let ue=V[$];if(V[$]=V[$+1],V[$+1]=ue,P&&$<s-1)for(let he=0;he<s;he++)ue=ve.get(he,$+1),ve.set(he,$+1,ve.get(he,$)),ve.set(he,$,ue);if(o&&$<i-1)for(let he=0;he<i;he++)ue=H.get(he,$+1),H.set(he,$+1,H.get(he,$)),H.set(he,$,ue);$++}Re--;break}}}if(L){let $=ve;ve=H,H=$}this.m=i,this.n=s,this.s=V,this.U=H,this.V=ve}solve(r){let e=r,i=this.threshold,s=this.s.length,h=pi.zeros(s,s);for(let F=0;F<s;F++)Math.abs(this.s[F])<=i?h.set(F,F,0):h.set(F,F,1/this.s[F]);let x=this.U,m=this.rightSingularVectors,o=m.mmul(h),P=m.rows,L=x.rows,D=pi.zeros(P,L);for(let F=0;F<P;F++)for(let Y=0;Y<L;Y++){let V=0;for(let H=0;H<s;H++)V+=o.get(F,H)*x.get(Y,H);D.set(F,Y,V)}return D.mmul(e)}solveForDiagonal(r){return this.solve(pi.diag(r))}inverse(){let r=this.V,e=this.threshold,i=r.rows,s=r.columns,h=new pi(i,this.s.length);for(let L=0;L<i;L++)for(let D=0;D<s;D++)Math.abs(this.s[D])>e&&h.set(L,D,r.get(L,D)/this.s[D]);let x=this.U,m=x.rows,o=x.columns,P=new pi(i,m);for(let L=0;L<i;L++)for(let D=0;D<m;D++){let F=0;for(let Y=0;Y<o;Y++)F+=h.get(L,Y)*x.get(D,Y);P.set(L,D,F)}return P}get condition(){return this.s[0]/this.s[Math.min(this.m,this.n)-1]}get norm2(){return this.s[0]}get rank(){let r=Math.max(this.m,this.n)*this.s[0]*Number.EPSILON,e=0,i=this.s;for(let s=0,h=i.length;s<h;s++)i[s]>r&&e++;return e}get diagonal(){return Array.from(this.s)}get threshold(){return Number.EPSILON/2*Math.max(this.m,this.n)*this.s[0]}get leftSingularVectors(){return this.U}get rightSingularVectors(){return this.V}get diagonalMatrix(){return pi.diag(this.s)}};function hL(r,e=!1){return r=qo.checkMatrix(r),e?new Sh(r).inverse():iT(r,pi.eye(r.rows))}function iT(r,e,i=!1){return r=qo.checkMatrix(r),e=qo.checkMatrix(e),i?new Sh(r).solve(e):r.isSquare()?new $m(r).solve(e):new z_(r).solve(e)}function Uf(r){if(r=pi.checkMatrix(r),r.isSquare()){if(r.columns===0)return 1;let e,i,s,h;if(r.columns===2)return e=r.get(0,0),i=r.get(0,1),s=r.get(1,0),h=r.get(1,1),e*h-i*s;if(r.columns===3){let x,m,o;return x=new Gf(r,[1,2],[1,2]),m=new Gf(r,[1,2],[0,2]),o=new Gf(r,[1,2],[0,1]),e=r.get(0,0),i=r.get(0,1),s=r.get(0,2),e*Uf(x)-i*Uf(m)+s*Uf(o)}else return new $m(r).determinant}else throw Error("determinant can only be calculated for a square matrix")}function dL(r,e){let i=[];for(let s=0;s<r;s++)s!==e&&i.push(s);return i}function pL(r,e,i,s=1e-9,h=1e-9){if(r>h)return new Array(e.rows+1).fill(0);{let x=e.addRow(i,[0]);for(let m=0;m<x.rows;m++)Math.abs(x.get(m,0))<s&&x.set(m,0,0);return x.to1DArray()}}function fL(r,e={}){const{thresholdValue:i=1e-9,thresholdError:s=1e-9}=e;r=pi.checkMatrix(r);let h=r.rows,x=new pi(h,h);for(let m=0;m<h;m++){let o=pi.columnVector(r.getRow(m)),P=r.subMatrixRow(dL(h,m)).transpose(),L=new Sh(P).solve(o),D=pi.sub(o,P.mmul(L)).abs().max();x.setRow(m,pL(D,L,m,i,s))}return x}function mL(r,e=Number.EPSILON){if(r=pi.checkMatrix(r),r.isEmpty())return r.transpose();let i=new Sh(r,{autoTranspose:!0}),s=i.leftSingularVectors,h=i.rightSingularVectors,x=i.diagonal;for(let m=0;m<x.length;m++)Math.abs(x[m])>e?x[m]=1/x[m]:x[m]=0;return h.mmul(pi.diag(x).mmul(s.transpose()))}function gL(r,e=r,i={}){r=new pi(r);let s=!1;if(typeof e=="object"&&!pi.isMatrix(e)&&!Eo.isAnyArray(e)?(i=e,e=r,s=!0):e=new pi(e),r.rows!==e.rows)throw new TypeError("Both matrices must have the same number of rows");const{center:h=!0}=i;h&&(r=r.center("column"),s||(e=e.center("column")));const x=r.transpose().mmul(e);for(let m=0;m<x.rows;m++)for(let o=0;o<x.columns;o++)x.set(m,o,x.get(m,o)*(1/(r.rows-1)));return x}function yL(r,e=r,i={}){r=new pi(r);let s=!1;if(typeof e=="object"&&!pi.isMatrix(e)&&!Eo.isAnyArray(e)?(i=e,e=r,s=!0):e=new pi(e),r.rows!==e.rows)throw new TypeError("Both matrices must have the same number of rows");const{center:h=!0,scale:x=!0}=i;h&&(r.center("column"),s||e.center("column")),x&&(r.scale("column"),s||e.scale("column"));const m=r.standardDeviation("column",{unbiased:!0}),o=s?m:e.standardDeviation("column",{unbiased:!0}),P=r.transpose().mmul(e);for(let L=0;L<P.rows;L++)for(let D=0;D<P.columns;D++)P.set(L,D,P.get(L,D)*(1/(m[L]*o[D]))*(1/(r.rows-1)));return P}class rT{constructor(e,i={}){const{assumeSymmetric:s=!1}=i;if(e=qo.checkMatrix(e),!e.isSquare())throw new Error("Matrix is not a square matrix");if(e.isEmpty())throw new Error("Matrix must be non-empty");let h=e.columns,x=new pi(h,h),m=new Float64Array(h),o=new Float64Array(h),P=e,L,D,F=!1;if(s?F=!0:F=e.isSymmetric(),F){for(L=0;L<h;L++)for(D=0;D<h;D++)x.set(L,D,P.get(L,D));_L(h,o,m,x),vL(h,o,m,x)}else{let Y=new pi(h,h),V=new Float64Array(h);for(D=0;D<h;D++)for(L=0;L<h;L++)Y.set(L,D,P.get(L,D));xL(h,Y,V,x),bL(h,o,m,x,Y)}this.n=h,this.e=o,this.d=m,this.V=x}get realEigenvalues(){return Array.from(this.d)}get imaginaryEigenvalues(){return Array.from(this.e)}get eigenvectorMatrix(){return this.V}get diagonalMatrix(){let e=this.n,i=this.e,s=this.d,h=new pi(e,e),x,m;for(x=0;x<e;x++){for(m=0;m<e;m++)h.set(x,m,0);h.set(x,x,s[x]),i[x]>0?h.set(x,x+1,i[x]):i[x]<0&&h.set(x,x-1,i[x])}return h}}function _L(r,e,i,s){let h,x,m,o,P,L,D,F;for(P=0;P<r;P++)i[P]=s.get(r-1,P);for(o=r-1;o>0;o--){for(F=0,m=0,L=0;L<o;L++)F=F+Math.abs(i[L]);if(F===0)for(e[o]=i[o-1],P=0;P<o;P++)i[P]=s.get(o-1,P),s.set(o,P,0),s.set(P,o,0);else{for(L=0;L<o;L++)i[L]/=F,m+=i[L]*i[L];for(h=i[o-1],x=Math.sqrt(m),h>0&&(x=-x),e[o]=F*x,m=m-h*x,i[o-1]=h-x,P=0;P<o;P++)e[P]=0;for(P=0;P<o;P++){for(h=i[P],s.set(P,o,h),x=e[P]+s.get(P,P)*h,L=P+1;L<=o-1;L++)x+=s.get(L,P)*i[L],e[L]+=s.get(L,P)*h;e[P]=x}for(h=0,P=0;P<o;P++)e[P]/=m,h+=e[P]*i[P];for(D=h/(m+m),P=0;P<o;P++)e[P]-=D*i[P];for(P=0;P<o;P++){for(h=i[P],x=e[P],L=P;L<=o-1;L++)s.set(L,P,s.get(L,P)-(h*e[L]+x*i[L]));i[P]=s.get(o-1,P),s.set(o,P,0)}}i[o]=m}for(o=0;o<r-1;o++){if(s.set(r-1,o,s.get(o,o)),s.set(o,o,1),m=i[o+1],m!==0){for(L=0;L<=o;L++)i[L]=s.get(L,o+1)/m;for(P=0;P<=o;P++){for(x=0,L=0;L<=o;L++)x+=s.get(L,o+1)*s.get(L,P);for(L=0;L<=o;L++)s.set(L,P,s.get(L,P)-x*i[L])}}for(L=0;L<=o;L++)s.set(L,o+1,0)}for(P=0;P<r;P++)i[P]=s.get(r-1,P),s.set(r-1,P,0);s.set(r-1,r-1,1),e[0]=0}function vL(r,e,i,s){let h,x,m,o,P,L,D,F,Y,V,H,ve,_e,oe,fe,K;for(m=1;m<r;m++)e[m-1]=e[m];e[r-1]=0;let ne=0,ye=0,Re=Number.EPSILON;for(L=0;L<r;L++){for(ye=Math.max(ye,Math.abs(i[L])+Math.abs(e[L])),D=L;D<r&&!(Math.abs(e[D])<=Re*ye);)D++;if(D>L)do{for(h=i[L],F=(i[L+1]-h)/(2*e[L]),Y=Ol(F,1),F<0&&(Y=-Y),i[L]=e[L]/(F+Y),i[L+1]=e[L]*(F+Y),V=i[L+1],x=h-i[L],m=L+2;m<r;m++)i[m]-=x;for(ne=ne+x,F=i[D],H=1,ve=H,_e=H,oe=e[L+1],fe=0,K=0,m=D-1;m>=L;m--)for(_e=ve,ve=H,K=fe,h=H*e[m],x=H*F,Y=Ol(F,e[m]),e[m+1]=fe*Y,fe=e[m]/Y,H=F/Y,F=H*i[m]-fe*h,i[m+1]=x+fe*(H*h+fe*i[m]),P=0;P<r;P++)x=s.get(P,m+1),s.set(P,m+1,fe*s.get(P,m)+H*x),s.set(P,m,H*s.get(P,m)-fe*x);F=-fe*K*_e*oe*e[L]/V,e[L]=fe*F,i[L]=H*F}while(Math.abs(e[L])>Re*ye);i[L]=i[L]+ne,e[L]=0}for(m=0;m<r-1;m++){for(P=m,F=i[m],o=m+1;o<r;o++)i[o]<F&&(P=o,F=i[o]);if(P!==m)for(i[P]=i[m],i[m]=F,o=0;o<r;o++)F=s.get(o,m),s.set(o,m,s.get(o,P)),s.set(o,P,F)}}function xL(r,e,i,s){let h=0,x=r-1,m,o,P,L,D,F,Y;for(F=h+1;F<=x-1;F++){for(Y=0,L=F;L<=x;L++)Y=Y+Math.abs(e.get(L,F-1));if(Y!==0){for(P=0,L=x;L>=F;L--)i[L]=e.get(L,F-1)/Y,P+=i[L]*i[L];for(o=Math.sqrt(P),i[F]>0&&(o=-o),P=P-i[F]*o,i[F]=i[F]-o,D=F;D<r;D++){for(m=0,L=x;L>=F;L--)m+=i[L]*e.get(L,D);for(m=m/P,L=F;L<=x;L++)e.set(L,D,e.get(L,D)-m*i[L])}for(L=0;L<=x;L++){for(m=0,D=x;D>=F;D--)m+=i[D]*e.get(L,D);for(m=m/P,D=F;D<=x;D++)e.set(L,D,e.get(L,D)-m*i[D])}i[F]=Y*i[F],e.set(F,F-1,Y*o)}}for(L=0;L<r;L++)for(D=0;D<r;D++)s.set(L,D,L===D?1:0);for(F=x-1;F>=h+1;F--)if(e.get(F,F-1)!==0){for(L=F+1;L<=x;L++)i[L]=e.get(L,F-1);for(D=F;D<=x;D++){for(o=0,L=F;L<=x;L++)o+=i[L]*s.get(L,D);for(o=o/i[F]/e.get(F,F-1),L=F;L<=x;L++)s.set(L,D,s.get(L,D)+o*i[L])}}}function bL(r,e,i,s,h){let x=r-1,m=0,o=r-1,P=Number.EPSILON,L=0,D=0,F=0,Y=0,V=0,H=0,ve=0,_e=0,oe,fe,K,ne,ye,Re,Se,Z,$,Q,ue,he,Pe,Ae,ke;for(oe=0;oe<r;oe++)for((oe<m||oe>o)&&(i[oe]=h.get(oe,oe),e[oe]=0),fe=Math.max(oe-1,0);fe<r;fe++)D=D+Math.abs(h.get(oe,fe));for(;x>=m;){for(ne=x;ne>m&&(H=Math.abs(h.get(ne-1,ne-1))+Math.abs(h.get(ne,ne)),H===0&&(H=D),!(Math.abs(h.get(ne,ne-1))<P*H));)ne--;if(ne===x)h.set(x,x,h.get(x,x)+L),i[x]=h.get(x,x),e[x]=0,x--,_e=0;else if(ne===x-1){if(Se=h.get(x,x-1)*h.get(x-1,x),F=(h.get(x-1,x-1)-h.get(x,x))/2,Y=F*F+Se,ve=Math.sqrt(Math.abs(Y)),h.set(x,x,h.get(x,x)+L),h.set(x-1,x-1,h.get(x-1,x-1)+L),Z=h.get(x,x),Y>=0){for(ve=F>=0?F+ve:F-ve,i[x-1]=Z+ve,i[x]=i[x-1],ve!==0&&(i[x]=Z-Se/ve),e[x-1]=0,e[x]=0,Z=h.get(x,x-1),H=Math.abs(Z)+Math.abs(ve),F=Z/H,Y=ve/H,V=Math.sqrt(F*F+Y*Y),F=F/V,Y=Y/V,fe=x-1;fe<r;fe++)ve=h.get(x-1,fe),h.set(x-1,fe,Y*ve+F*h.get(x,fe)),h.set(x,fe,Y*h.get(x,fe)-F*ve);for(oe=0;oe<=x;oe++)ve=h.get(oe,x-1),h.set(oe,x-1,Y*ve+F*h.get(oe,x)),h.set(oe,x,Y*h.get(oe,x)-F*ve);for(oe=m;oe<=o;oe++)ve=s.get(oe,x-1),s.set(oe,x-1,Y*ve+F*s.get(oe,x)),s.set(oe,x,Y*s.get(oe,x)-F*ve)}else i[x-1]=Z+F,i[x]=Z+F,e[x-1]=ve,e[x]=-ve;x=x-2,_e=0}else{if(Z=h.get(x,x),$=0,Se=0,ne<x&&($=h.get(x-1,x-1),Se=h.get(x,x-1)*h.get(x-1,x)),_e===10){for(L+=Z,oe=m;oe<=x;oe++)h.set(oe,oe,h.get(oe,oe)-Z);H=Math.abs(h.get(x,x-1))+Math.abs(h.get(x-1,x-2)),Z=$=.75*H,Se=-.4375*H*H}if(_e===30&&(H=($-Z)/2,H=H*H+Se,H>0)){for(H=Math.sqrt(H),$<Z&&(H=-H),H=Z-Se/(($-Z)/2+H),oe=m;oe<=x;oe++)h.set(oe,oe,h.get(oe,oe)-H);L+=H,Z=$=Se=.964}for(_e=_e+1,ye=x-2;ye>=ne&&(ve=h.get(ye,ye),V=Z-ve,H=$-ve,F=(V*H-Se)/h.get(ye+1,ye)+h.get(ye,ye+1),Y=h.get(ye+1,ye+1)-ve-V-H,V=h.get(ye+2,ye+1),H=Math.abs(F)+Math.abs(Y)+Math.abs(V),F=F/H,Y=Y/H,V=V/H,!(ye===ne||Math.abs(h.get(ye,ye-1))*(Math.abs(Y)+Math.abs(V))<P*(Math.abs(F)*(Math.abs(h.get(ye-1,ye-1))+Math.abs(ve)+Math.abs(h.get(ye+1,ye+1))))));)ye--;for(oe=ye+2;oe<=x;oe++)h.set(oe,oe-2,0),oe>ye+2&&h.set(oe,oe-3,0);for(K=ye;K<=x-1&&(Ae=K!==x-1,K!==ye&&(F=h.get(K,K-1),Y=h.get(K+1,K-1),V=Ae?h.get(K+2,K-1):0,Z=Math.abs(F)+Math.abs(Y)+Math.abs(V),Z!==0&&(F=F/Z,Y=Y/Z,V=V/Z)),Z!==0);K++)if(H=Math.sqrt(F*F+Y*Y+V*V),F<0&&(H=-H),H!==0){for(K!==ye?h.set(K,K-1,-H*Z):ne!==ye&&h.set(K,K-1,-h.get(K,K-1)),F=F+H,Z=F/H,$=Y/H,ve=V/H,Y=Y/F,V=V/F,fe=K;fe<r;fe++)F=h.get(K,fe)+Y*h.get(K+1,fe),Ae&&(F=F+V*h.get(K+2,fe),h.set(K+2,fe,h.get(K+2,fe)-F*ve)),h.set(K,fe,h.get(K,fe)-F*Z),h.set(K+1,fe,h.get(K+1,fe)-F*$);for(oe=0;oe<=Math.min(x,K+3);oe++)F=Z*h.get(oe,K)+$*h.get(oe,K+1),Ae&&(F=F+ve*h.get(oe,K+2),h.set(oe,K+2,h.get(oe,K+2)-F*V)),h.set(oe,K,h.get(oe,K)-F),h.set(oe,K+1,h.get(oe,K+1)-F*Y);for(oe=m;oe<=o;oe++)F=Z*s.get(oe,K)+$*s.get(oe,K+1),Ae&&(F=F+ve*s.get(oe,K+2),s.set(oe,K+2,s.get(oe,K+2)-F*V)),s.set(oe,K,s.get(oe,K)-F),s.set(oe,K+1,s.get(oe,K+1)-F*Y)}}}if(D!==0){for(x=r-1;x>=0;x--)if(F=i[x],Y=e[x],Y===0)for(ne=x,h.set(x,x,1),oe=x-1;oe>=0;oe--){for(Se=h.get(oe,oe)-F,V=0,fe=ne;fe<=x;fe++)V=V+h.get(oe,fe)*h.get(fe,x);if(e[oe]<0)ve=Se,H=V;else if(ne=oe,e[oe]===0?h.set(oe,x,Se!==0?-V/Se:-V/(P*D)):(Z=h.get(oe,oe+1),$=h.get(oe+1,oe),Y=(i[oe]-F)*(i[oe]-F)+e[oe]*e[oe],Re=(Z*H-ve*V)/Y,h.set(oe,x,Re),h.set(oe+1,x,Math.abs(Z)>Math.abs(ve)?(-V-Se*Re)/Z:(-H-$*Re)/ve)),Re=Math.abs(h.get(oe,x)),P*Re*Re>1)for(fe=oe;fe<=x;fe++)h.set(fe,x,h.get(fe,x)/Re)}else if(Y<0)for(ne=x-1,Math.abs(h.get(x,x-1))>Math.abs(h.get(x-1,x))?(h.set(x-1,x-1,Y/h.get(x,x-1)),h.set(x-1,x,-(h.get(x,x)-F)/h.get(x,x-1))):(ke=wf(0,-h.get(x-1,x),h.get(x-1,x-1)-F,Y),h.set(x-1,x-1,ke[0]),h.set(x-1,x,ke[1])),h.set(x,x-1,0),h.set(x,x,1),oe=x-2;oe>=0;oe--){for(Q=0,ue=0,fe=ne;fe<=x;fe++)Q=Q+h.get(oe,fe)*h.get(fe,x-1),ue=ue+h.get(oe,fe)*h.get(fe,x);if(Se=h.get(oe,oe)-F,e[oe]<0)ve=Se,V=Q,H=ue;else if(ne=oe,e[oe]===0?(ke=wf(-Q,-ue,Se,Y),h.set(oe,x-1,ke[0]),h.set(oe,x,ke[1])):(Z=h.get(oe,oe+1),$=h.get(oe+1,oe),he=(i[oe]-F)*(i[oe]-F)+e[oe]*e[oe]-Y*Y,Pe=(i[oe]-F)*2*Y,he===0&&Pe===0&&(he=P*D*(Math.abs(Se)+Math.abs(Y)+Math.abs(Z)+Math.abs($)+Math.abs(ve))),ke=wf(Z*V-ve*Q+Y*ue,Z*H-ve*ue-Y*Q,he,Pe),h.set(oe,x-1,ke[0]),h.set(oe,x,ke[1]),Math.abs(Z)>Math.abs(ve)+Math.abs(Y)?(h.set(oe+1,x-1,(-Q-Se*h.get(oe,x-1)+Y*h.get(oe,x))/Z),h.set(oe+1,x,(-ue-Se*h.get(oe,x)-Y*h.get(oe,x-1))/Z)):(ke=wf(-V-$*h.get(oe,x-1),-H-$*h.get(oe,x),ve,Y),h.set(oe+1,x-1,ke[0]),h.set(oe+1,x,ke[1]))),Re=Math.max(Math.abs(h.get(oe,x-1)),Math.abs(h.get(oe,x))),P*Re*Re>1)for(fe=oe;fe<=x;fe++)h.set(fe,x-1,h.get(fe,x-1)/Re),h.set(fe,x,h.get(fe,x)/Re)}for(oe=0;oe<r;oe++)if(oe<m||oe>o)for(fe=oe;fe<r;fe++)s.set(oe,fe,h.get(oe,fe));for(fe=r-1;fe>=m;fe--)for(oe=m;oe<=o;oe++){for(ve=0,K=m;K<=Math.min(fe,o);K++)ve=ve+s.get(oe,K)*h.get(K,fe);s.set(oe,fe,ve)}}}function wf(r,e,i,s){let h,x;return Math.abs(i)>Math.abs(s)?(h=s/i,x=i+h*s,[(r+h*e)/x,(e-h*r)/x]):(h=i/s,x=s+h*i,[(h*r+e)/x,(h*e-r)/x])}class nT{constructor(e){if(e=qo.checkMatrix(e),!e.isSymmetric())throw new Error("Matrix is not symmetric");let i=e,s=i.rows,h=new pi(s,s),x=!0,m,o,P;for(o=0;o<s;o++){let L=0;for(P=0;P<o;P++){let D=0;for(m=0;m<P;m++)D+=h.get(P,m)*h.get(o,m);D=(i.get(o,P)-D)/h.get(P,P),h.set(o,P,D),L=L+D*D}for(L=i.get(o,o)-L,x&=L>0,h.set(o,o,Math.sqrt(Math.max(L,0))),P=o+1;P<s;P++)h.set(o,P,0)}this.L=h,this.positiveDefinite=!!x}isPositiveDefinite(){return this.positiveDefinite}solve(e){e=qo.checkMatrix(e);let i=this.L,s=i.rows;if(e.rows!==s)throw new Error("Matrix dimensions do not match");if(this.isPositiveDefinite()===!1)throw new Error("Matrix is not positive definite");let h=e.columns,x=e.clone(),m,o,P;for(P=0;P<s;P++)for(o=0;o<h;o++){for(m=0;m<P;m++)x.set(P,o,x.get(P,o)-x.get(m,o)*i.get(P,m));x.set(P,o,x.get(P,o)/i.get(P,P))}for(P=s-1;P>=0;P--)for(o=0;o<h;o++){for(m=P+1;m<s;m++)x.set(P,o,x.get(P,o)-x.get(m,o)*i.get(m,P));x.set(P,o,x.get(P,o)/i.get(P,P))}return x}get lowerTriangularMatrix(){return this.L}}class sT{constructor(e,i={}){e=qo.checkMatrix(e);let{Y:s}=i;const{scaleScores:h=!1,maxIterations:x=1e3,terminationCriteria:m=1e-10}=i;let o;if(s){if(Eo.isAnyArray(s)&&typeof s[0]=="number"?s=pi.columnVector(s):s=qo.checkMatrix(s),s.rows!==e.rows)throw new Error("Y should have the same number of rows as X");o=s.getColumnVector(0)}else o=e.getColumnVector(0);let P=1,L,D,F,Y;for(let V=0;V<x&&P>m;V++)F=e.transpose().mmul(o).div(o.transpose().mmul(o).get(0,0)),F=F.div(F.norm()),L=e.mmul(F).div(F.transpose().mmul(F).get(0,0)),V>0&&(P=L.clone().sub(Y).pow(2).sum()),Y=L.clone(),s?(D=s.transpose().mmul(L).div(L.transpose().mmul(L).get(0,0)),D=D.div(D.norm()),o=s.mmul(D).div(D.transpose().mmul(D).get(0,0))):o=L;if(s){let V=e.transpose().mmul(L).div(L.transpose().mmul(L).get(0,0));V=V.div(V.norm());let H=e.clone().sub(L.clone().mmul(V.transpose())),ve=o.transpose().mmul(L).div(L.transpose().mmul(L).get(0,0)),_e=s.clone().sub(L.clone().mulS(ve.get(0,0)).mmul(D.transpose()));this.t=L,this.p=V.transpose(),this.w=F.transpose(),this.q=D,this.u=o,this.s=L.transpose().mmul(L),this.xResidual=H,this.yResidual=_e,this.betas=ve}else this.w=F.transpose(),this.s=L.transpose().mmul(L).sqrt(),h?this.t=L.clone().div(this.s.get(0,0)):this.t=L,this.xResidual=e.sub(L.mmul(F.transpose()))}}Tr.AbstractMatrix=On;Tr.CHO=nT;Tr.CholeskyDecomposition=nT;Tr.DistanceMatrix=Bm;Tr.EVD=rT;Tr.EigenvalueDecomposition=rT;Tr.LU=$m;Tr.LuDecomposition=$m;var wL=Tr.Matrix=pi;Tr.MatrixColumnSelectionView=rL;Tr.MatrixColumnView=iL;Tr.MatrixFlipColumnView=nL;Tr.MatrixFlipRowView=sL;Tr.MatrixRowSelectionView=aL;Tr.MatrixRowView=oL;Tr.MatrixSelectionView=Gf;Tr.MatrixSubView=lL;Tr.MatrixTransposeView=uL;Tr.NIPALS=sT;Tr.Nipals=sT;Tr.QR=z_;Tr.QrDecomposition=z_;Tr.SVD=Sh;var TL=Tr.SingularValueDecomposition=Sh;Tr.SymmetricMatrix=Tu;Tr.WrapperMatrix1D=tT;Tr.WrapperMatrix2D=qo;Tr.correlation=yL;Tr.covariance=gL;var d1=Tr.default=pi;Tr.determinant=Uf;var EL=Tr.inverse=hL;Tr.linearDependencies=fL;var IL=Tr.pseudoInverse=mL;Tr.solve=iT;Tr.wrap=cL;const ya=wL,SL=TL;d1.Matrix&&d1.Matrix;const ML=EL,oT=IL;class fp{sourcePoints;destinationPoints;pointCount;pointCountMinimum;type;constructor(e,i,s,h){if(this.sourcePoints=e,this.destinationPoints=i,this.pointCount=this.sourcePoints.length,this.type=s,this.pointCountMinimum=h,this.pointCount<this.pointCountMinimum)throw new Error("Not enough control points. A "+this.type+" transformation requires a minimum of "+this.pointCountMinimum+" points, but "+this.pointCount+" are given.")}evaluate(e,i="function"){if(i=="function")return this.evaluateFunction(e);if(i=="partialDerivativeX")return this.evaluatePartialDerivativeX(e);if(i=="partialDerivativeY")return this.evaluatePartialDerivativeY(e);throw new Error("Evaluation of type "+i+" not supported")}}let aT=class extends fp{helmertParametersMatrix;helmertParameters;scale;rotation;translation;constructor(e,i){super(e,i,"helmert",2);const s=ya.columnVector(i.flat()),h=ya.zeros(2*this.pointCount,4);for(let m=0;m<this.pointCount;m++)h.set(2*m,0,1),h.set(2*m,1,0),h.set(2*m,2,this.sourcePoints[m][0]),h.set(2*m,3,-this.sourcePoints[m][1]),h.set(2*m+1,0,0),h.set(2*m+1,1,1),h.set(2*m+1,2,this.sourcePoints[m][1]),h.set(2*m+1,3,this.sourcePoints[m][0]);const x=oT(h);this.helmertParametersMatrix=x.mmul(s),this.helmertParameters=this.helmertParametersMatrix.to1DArray(),this.scale=Math.sqrt(this.helmertParameters[2]**2+this.helmertParameters[3]**2),this.rotation=Math.atan2(this.helmertParameters[3],this.helmertParameters[2]),this.translation=[this.helmertParameters[0],this.helmertParameters[1]]}evaluateFunction(e){if(!this.helmertParameters)throw new Error("Helmert parameters not computed");return[this.helmertParameters[0]+this.helmertParameters[2]*e[0]-this.helmertParameters[3]*e[1],this.helmertParameters[1]+this.helmertParameters[2]*e[1]+this.helmertParameters[3]*e[0]]}evaluatePartialDerivativeX(e){if(!this.helmertParameters)throw new Error("Helmert parameters not computed");return[this.helmertParameters[2],this.helmertParameters[3]]}evaluatePartialDerivativeY(e){if(!this.helmertParameters)throw new Error("Helmert parameters not computed");return[-this.helmertParameters[3],this.helmertParameters[2]]}};class PL extends fp{scale;sourcePointsCenter;destinationPointsCenter;translation;constructor(e,i){super(e,i,"straight",2);const s=new aT(this.sourcePoints,this.destinationPoints);if(this.scale=s.scale,!this.scale)throw new Error("Scale could not be computed");this.sourcePointsCenter=this.sourcePoints.reduce((x,m)=>[x[0]+m[0],x[1]+m[1]]).map(x=>x/this.pointCount),this.destinationPointsCenter=this.destinationPoints.reduce((x,m)=>[x[0]+m[0],x[1]+m[1]]).map(x=>x/this.pointCount);const h=this.scale;this.translation=this.destinationPointsCenter.map((x,m)=>x-this.sourcePointsCenter[m]*h)}evaluateFunction(e){if(!this.scale||!this.translation)throw new Error("Straight parameters not computed");return[this.translation[0]+this.scale*e[0],this.translation[1]+this.scale*e[1]]}evaluatePartialDerivativeX(e){if(!this.scale||!this.translation)throw new Error("Straight parameters not computed");return[this.scale,0]}evaluatePartialDerivativeY(e){if(!this.scale||!this.translation)throw new Error("Straight parameters not computed");return[0,this.scale]}}class ay extends fp{polynomialParametersMatrices;polynomialParameters;order;pointCountMinimum;constructor(e,i,s){s=s||1;const h=(s+1)*(s+2)/2;if(super(e,i,"polynomial"+s,h),this.order=s,this.pointCountMinimum=h,this.order<1||this.order>3)throw new Error("Only polynomial transformations of order 1, 2 or 3 are supported");const x=[ya.columnVector(this.destinationPoints.map(P=>P[0])),ya.columnVector(this.destinationPoints.map(P=>P[1]))],m=ya.zeros(this.pointCount,this.pointCountMinimum);for(let P=0;P<this.pointCount;P++)switch(this.order){case 1:m.set(P,0,1),m.set(P,1,this.sourcePoints[P][0]),m.set(P,2,this.sourcePoints[P][1]);break;case 2:m.set(P,0,1),m.set(P,1,this.sourcePoints[P][0]),m.set(P,2,this.sourcePoints[P][1]),m.set(P,3,this.sourcePoints[P][0]**2),m.set(P,4,this.sourcePoints[P][1]**2),m.set(P,5,this.sourcePoints[P][0]*this.sourcePoints[P][1]);break;case 3:m.set(P,0,1),m.set(P,1,this.sourcePoints[P][0]),m.set(P,2,this.sourcePoints[P][1]),m.set(P,3,this.sourcePoints[P][0]**2),m.set(P,4,this.sourcePoints[P][1]**2),m.set(P,5,this.sourcePoints[P][0]*this.sourcePoints[P][1]),m.set(P,6,this.sourcePoints[P][0]**3),m.set(P,7,this.sourcePoints[P][1]**3),m.set(P,8,this.sourcePoints[P][0]**2*this.sourcePoints[P][1]),m.set(P,9,this.sourcePoints[P][0]*this.sourcePoints[P][1]**2);break}const o=oT(m);this.polynomialParametersMatrices=[o.mmul(x[0]),o.mmul(x[1])],this.polynomialParameters=this.polynomialParametersMatrices.map(P=>P.to1DArray())}evaluateFunction(e){if(!this.polynomialParameters)throw new Error("Polynomial parameters not computed");const i=[0,0];for(let s=0;s<2;s++)switch(this.order){case 1:i[s]+=this.polynomialParameters[s][0]+this.polynomialParameters[s][1]*e[0]+this.polynomialParameters[s][2]*e[1];break;case 2:i[s]+=this.polynomialParameters[s][0]+this.polynomialParameters[s][1]*e[0]+this.polynomialParameters[s][2]*e[1]+this.polynomialParameters[s][3]*e[0]**2+this.polynomialParameters[s][4]*e[1]**2+this.polynomialParameters[s][5]*e[0]*e[1];break;case 3:i[s]+=this.polynomialParameters[s][0]+this.polynomialParameters[s][1]*e[0]+this.polynomialParameters[s][2]*e[1]+this.polynomialParameters[s][3]*e[0]**2+this.polynomialParameters[s][4]*e[1]**2+this.polynomialParameters[s][5]*e[0]*e[1]+this.polynomialParameters[s][6]*e[0]**3+this.polynomialParameters[s][7]*e[1]**3+this.polynomialParameters[s][8]*e[0]**2*e[1]+this.polynomialParameters[s][9]*e[0]*e[1]**2;break}return i}evaluatePartialDerivativeX(e){if(!this.polynomialParameters)throw new Error("Polynomial parameters not computed");const i=[0,0];for(let s=0;s<2;s++)switch(this.order){case 1:i[s]+=this.polynomialParameters[s][1];break;case 2:i[s]+=this.polynomialParameters[s][1]+2*this.polynomialParameters[s][3]*e[0]+this.polynomialParameters[s][5]*e[1];break;case 3:i[s]+=this.polynomialParameters[s][1]+2*this.polynomialParameters[s][3]*e[0]+this.polynomialParameters[s][5]*e[1]+3*this.polynomialParameters[s][6]*e[0]**2+2*this.polynomialParameters[s][8]*e[0]*e[1]+this.polynomialParameters[s][9]*e[1]**2;break}return i}evaluatePartialDerivativeY(e){if(!this.polynomialParameters)throw new Error("Polynomial parameters not computed");const i=[0,0];for(let s=0;s<2;s++)switch(this.order){case 1:i[s]+=this.polynomialParameters[s][2];break;case 2:i[s]+=this.polynomialParameters[s][2]+2*this.polynomialParameters[s][4]*e[1]+this.polynomialParameters[s][5]*e[0];break;case 3:i[s]+=this.polynomialParameters[s][2]+2*this.polynomialParameters[s][4]*e[1]+this.polynomialParameters[s][5]*e[0]+3*this.polynomialParameters[s][7]*e[1]**2+this.polynomialParameters[s][8]*e[0]**2+2*this.polynomialParameters[s][9]*e[0]*e[1];break}return i}}class kL extends fp{projectiveParametersMatrix;projectiveParameters;constructor(e,i){super(e,i,"projective",4);const s=ya.zeros(2*this.pointCount,9);for(let x=0;x<this.pointCount;x++)s.set(2*x,0,-e[x][0]),s.set(2*x,1,-e[x][1]),s.set(2*x,2,-1),s.set(2*x,3,0),s.set(2*x,4,0),s.set(2*x,5,0),s.set(2*x,6,i[x][0]*e[x][0]),s.set(2*x,7,i[x][0]*e[x][1]),s.set(2*x,8,i[x][0]),s.set(2*x+1,0,0),s.set(2*x+1,1,0),s.set(2*x+1,2,0),s.set(2*x+1,3,-e[x][0]),s.set(2*x+1,4,-e[x][1]),s.set(2*x+1,5,-1),s.set(2*x+1,6,i[x][1]*e[x][0]),s.set(2*x+1,7,i[x][1]*e[x][1]),s.set(2*x+1,8,i[x][1]);const h=new SL(s);this.projectiveParametersMatrix=ya.from1DArray(3,3,h.rightSingularVectors.getColumn(8)).transpose(),this.projectiveParameters=this.projectiveParametersMatrix.to2DArray()}evaluateFunction(e){if(!this.projectiveParameters)throw new Error("projective parameters not computed");const i=this.projectiveParameters[0][2]*e[0]+this.projectiveParameters[1][2]*e[1]+this.projectiveParameters[2][2],s=this.projectiveParameters[0][0]*e[0]+this.projectiveParameters[1][0]*e[1]+this.projectiveParameters[2][0],h=this.projectiveParameters[0][1]*e[0]+this.projectiveParameters[1][1]*e[1]+this.projectiveParameters[2][1];return[s/i,h/i]}evaluatePartialDerivativeX(e){if(!this.projectiveParameters)throw new Error("projective parameters not computed");const i=this.projectiveParameters[0][2]*e[0]+this.projectiveParameters[1][2]*e[1]+this.projectiveParameters[2][2],s=this.projectiveParameters[0][0]*e[0]+this.projectiveParameters[1][0]*e[1]+this.projectiveParameters[2][0],h=this.projectiveParameters[0][1]*e[0]+this.projectiveParameters[1][1]*e[1]+this.projectiveParameters[2][1];return[(i*this.projectiveParameters[0][0]-this.projectiveParameters[0][2]*s)/i**2,(i*this.projectiveParameters[0][1]-this.projectiveParameters[0][2]*h)/i**2]}evaluatePartialDerivativeY(e){if(!this.projectiveParameters)throw new Error("projective parameters not computed");const i=this.projectiveParameters[0][2]*e[0]+this.projectiveParameters[1][2]*e[1]+this.projectiveParameters[2][2],s=this.projectiveParameters[0][0]*e[0]+this.projectiveParameters[1][0]*e[1]+this.projectiveParameters[2][0],h=this.projectiveParameters[0][1]*e[0]+this.projectiveParameters[1][1]*e[1]+this.projectiveParameters[2][1];return[(i*this.projectiveParameters[1][0]-this.projectiveParameters[1][2]*s)/i**2,(i*this.projectiveParameters[1][1]-this.projectiveParameters[1][2]*h)/i**2]}}class CL extends fp{kernelFunction;normFunction;weightsMatrices;rbfWeights;affineWeights;epsilon;constructor(e,i,s,h,x){super(e,i,"thinPlateSpline",3),this.kernelFunction=s,this.normFunction=h;const m=[ya.columnVector([...this.destinationPoints,[0,0],[0,0],[0,0]].map(F=>F[0])),ya.columnVector([...this.destinationPoints,[0,0],[0,0],[0,0]].map(F=>F[1]))],o=ya.zeros(this.pointCount,this.pointCount);for(let F=0;F<this.pointCount;F++)for(let Y=0;Y<this.pointCount;Y++)o.set(F,Y,h(this.sourcePoints[F],this.sourcePoints[Y]));x===void 0&&(x=o.sum()/(Math.pow(this.pointCount,2)-this.pointCount)),this.epsilon=x;for(let F=0;F<this.pointCount;F++)for(let Y=0;Y<this.pointCount;Y++)o.set(F,Y,s(o.get(F,Y),{epsilon:x}));const P=ya.zeros(this.pointCount,3),L=ya.zeros(this.pointCount+3,this.pointCount+3);for(let F=0;F<this.pointCount;F++)P.set(F,0,1),P.set(F,1,this.sourcePoints[F][0]),P.set(F,2,this.sourcePoints[F][1]);for(let F=0;F<this.pointCount+3;F++)for(let Y=0;Y<this.pointCount+3;Y++)F<this.pointCount&&Y<this.pointCount?L.set(F,Y,o.get(F,Y)):F>=this.pointCount&&Y<this.pointCount?L.set(F,Y,P.transpose().get(F-this.pointCount,Y)):F<this.pointCount&&Y>=this.pointCount&&L.set(F,Y,P.get(F,Y-this.pointCount));const D=ML(L);this.weightsMatrices=[D.mmul(m[0]),D.mmul(m[1])],this.rbfWeights=this.weightsMatrices.map(F=>F.selection([...Array(this.pointCount).keys()],[0]).to1DArray()),this.affineWeights=this.weightsMatrices.map(F=>F.selection([0,1,2].map(Y=>Y+this.pointCount),[0]).to1DArray())}evaluateFunction(e){if(!this.rbfWeights||!this.affineWeights)throw new Error("Weights not computed");const i=this.sourcePoints.map(h=>this.normFunction(e,h)),s=[0,0];for(let h=0;h<2;h++)s[h]=i.reduce((x,m,o)=>x+this.kernelFunction(m,{epsilon:this.epsilon})*this.rbfWeights[h][o],0),s[h]+=this.affineWeights[h][0]+this.affineWeights[h][1]*e[0]+this.affineWeights[h][2]*e[1];return s}evaluatePartialDerivativeX(e){if(!this.rbfWeights||!this.affineWeights)throw new Error("Weights not computed");const i=this.sourcePoints.map(h=>this.normFunction(e,h)),s=[0,0];for(let h=0;h<2;h++)s[h]=i.reduce((x,m,o)=>x+(m==0?0:this.kernelFunction(m,{derivative:1,epsilon:this.epsilon})*((e[0]-this.sourcePoints[o][0])/m)*this.rbfWeights[h][o]),0),s[h]+=this.affineWeights[h][1];return s}evaluatePartialDerivativeY(e){if(!this.rbfWeights||!this.affineWeights)throw new Error("Weights not computed");const i=this.sourcePoints.map(h=>this.normFunction(e,h)),s=[0,0];for(let h=0;h<2;h++)s[h]=i.reduce((x,m,o)=>x+(m==0?0:this.kernelFunction(m,{derivative:1,epsilon:this.epsilon})*((e[1]-this.sourcePoints[o][1])/m)*this.rbfWeights[h][o]),0),s[h]+=this.affineWeights[h][2];return s}}function AL(r,e){if(e.derivative){if(e.derivative==1)return r===0?0:r+2*r*Math.log(r);throw new Error("Derivate of order "+e.derivative+" not implemented")}else return r===0?0:Math.pow(r,2)*Math.log(r)}function LL(r,e){const i=[e[0]-r[0],e[1]-r[1]];return Math.sqrt(i[0]**2+i[1]**2)}function yn(r,e,i){return{maxOffsetRatio:0,maxDepth:0,destinationIsGeographic:!1,sourceIsGeographic:!1,inputIsMultiGeometry:!1,differentHandedness:!1,evaluationType:"function",...i,...e,...r}}function Tf(r,e,i){e=Nm(e);const s=e.map(m=>({source:m,destination:r.transformForward(m)})),h=jm(s,!1),x=lT(r,h,i);return Gm(x,!0).map(m=>m.destination)}function Ef(r,e,i){e=Nm(e);const s=e.map(m=>({source:r.transformBackward(m),destination:m})),h=jm(s,!1),x=uT(r,h,i);return Gm(x,!0).map(m=>m.source)}function RL(r,e,i){e=k_(e);const s=e.map(m=>({source:m,destination:r.transformForward(m)})),h=jm(s,!0),x=lT(r,h,i);return Gm(x,!1).map(m=>m.destination)}function NL(r,e,i){e=k_(e);const s=e.map(m=>({source:r.transformBackward(m),destination:m})),h=jm(s,!0),x=uT(r,h,i);return Gm(x,!1).map(m=>m.source)}function If(r,e,i){return e.map(s=>RL(r,s,i))}function Sf(r,e,i){return e.map(s=>NL(r,s,i))}function jm(r,e=!1){const i=r.length-(e?0:1),s=[];for(let h=0;h<i;h++)s.push({from:r[h],to:r[(h+1)%r.length]});return s}function Gm(r,e=!1){const i=r.map(s=>s.from);return e&&i.push(r[r.length-1].to),i}function lT(r,e,i){return i.maxDepth<=0?e:e.map(s=>Hy(r,s,i,0)).flat(1)}function uT(r,e,i){return i.maxDepth<=0?e:e.map(s=>Ky(r,s,i,0)).flat(1)}function Hy(r,e,i,s){if(s>=i.maxDepth)return e;const h=(i.sourceIsGeographic?(L,D)=>_m(L,D).geometry.coordinates:rm)(e.from.source,e.to.source),x=(i.destinationIsGeographic?(L,D)=>_m(L,D).geometry.coordinates:rm)(e.from.destination,e.to.destination),m=r.transformForward(h),o=i.destinationIsGeographic?O_:Uo,P=o(e.from.destination,e.to.destination);if(o(x,m)/P>i.maxOffsetRatio&&P>0){const L={source:h,destination:m};return[Hy(r,{from:e.from,to:L},i,s+1),Hy(r,{from:L,to:e.to},i,s+1)].flat(1)}else return e}function Ky(r,e,i,s){if(s>=i.maxDepth)return e;const h=(i.destinationIsGeographic?(L,D)=>_m(L,D).geometry.coordinates:rm)(e.from.destination,e.to.destination),x=(i.sourceIsGeographic?(L,D)=>_m(L,D).geometry.coordinates:rm)(e.from.source,e.to.source),m=r.transformBackward(h),o=i.sourceIsGeographic?O_:Uo,P=o(e.from.source,e.to.source);if(o(x,m)/P>i.maxOffsetRatio&&P>0){const L={source:m,destination:h};return[Ky(r,{from:e.from,to:L},i,s+1),Ky(r,{from:L,to:e.to},i,s+1)].flat(1)}else return e}class ly{gcps;sourcePoints;destinationPoints;type;options;forwardTransformation;backwardTransformation;constructor(e,i="polynomial",s){if(s&&(this.options=s),e.length===0)throw new Error("No control points");this.gcps=e.map(h=>{if("resource"in h&&"geo"in h)return{source:h.resource,destination:h.geo};if("source"in h&&"destination"in h)return h;throw new Error("Unsupported GCP type")}),this.sourcePoints=this.gcps.map(h=>h.source),this.destinationPoints=this.gcps.map(h=>h.destination),this.type=i}createForwardTransformation(){this.forwardTransformation=this.computeTransformation(this.sourcePoints.map(e=>this.assureEqualHandedness(e)),this.destinationPoints)}createBackwardTransformation(){this.backwardTransformation=this.computeTransformation(this.destinationPoints,this.sourcePoints.map(e=>this.assureEqualHandedness(e)))}transformForward(e,i){if(!yn(i,this.options).inputIsMultiGeometry){if(lo(e))return this.forwardTransformation||this.createForwardTransformation(),this.forwardTransformation.evaluate(this.assureEqualHandedness(e),yn(i,this.options).evaluationType);if(kl(e))return this.transformForward(Pd(e),i);if(Pa(e))return Tf(this,e,yn(i,this.options));if(Cl(e))return Tf(this,kd(e),yn(i,this.options,{sourceIsGeographic:!0}));if(ka(e))return If(this,e,yn(i,this.options));if(Al(e))return If(this,Cd(e),yn(i,this.options,{sourceIsGeographic:!0}))}if(i&&(i.inputIsMultiGeometry=!1),Sl(e))return e.map(s=>this.transformForward(s,i));if(Ll(e))return pf(e).map(s=>this.transformForward(s,i));if(Ml(e))return e.map(s=>this.transformForward(s,i));if(Rl(e))return ff(e).map(s=>this.transformForward(s,i));if(Pl(e))return e.map(s=>this.transformForward(s,i));if(Nl(e))return mf(e).map(s=>this.transformForward(s,i));throw new Error("Input type not supported")}transformForwardAsGeojson(e,i){if(!yn(i,this.options).inputIsMultiGeometry){if(lo(e))return cf(this.transformForward(e));if(kl(e))return cf(this.transformForward(Pd(e)));if(Pa(e))return hf(Tf(this,e,yn(i,this.options,{destinationIsGeographic:!0})));if(Cl(e))return hf(Tf(this,kd(e),yn(i,this.options,{sourceIsGeographic:!0,destinationIsGeographic:!0})));if(ka(e))return df(If(this,e,yn(i,this.options,{destinationIsGeographic:!0})));if(Al(e))return df(If(this,Cd(e),yn(i,this.options,{sourceIsGeographic:!0,destinationIsGeographic:!0})))}if(i&&(i.inputIsMultiGeometry=!1),Sl(e))return gf(e.map(s=>this.transformForwardAsGeojson(s,i)));if(Ll(e))return gf(pf(e).map(s=>this.transformForwardAsGeojson(s,i)));if(Ml(e))return yf(e.map(s=>this.transformForwardAsGeojson(s,i)));if(Rl(e))return yf(ff(e).map(s=>this.transformForwardAsGeojson(s,i)));if(Pl(e))return _f(e.map(s=>this.transformForwardAsGeojson(s,i)));if(Nl(e))return _f(mf(e).map(s=>this.transformForwardAsGeojson(s,i)));throw new Error("Input type not supported")}transformBackward(e,i){if(!yn(i,this.options).inputIsMultiGeometry){if(lo(e))return this.backwardTransformation||this.createBackwardTransformation(),this.assureEqualHandedness(this.backwardTransformation.evaluate(e));if(kl(e))return this.transformBackward(Pd(e));if(Pa(e))return Ef(this,e,yn(i,this.options));if(Cl(e))return Ef(this,kd(e),yn(i,this.options,{destinationIsGeographic:!0}));if(ka(e))return Sf(this,e,yn(i,this.options));if(Al(e))return Sf(this,Cd(e),yn(i,this.options,{destinationIsGeographic:!0}))}if(i&&(i.inputIsMultiGeometry=!1),Sl(e))return e.map(s=>this.transformBackward(s,i));if(Ll(e))return pf(e).map(s=>this.transformBackward(s,i));if(Ml(e))return e.map(s=>this.transformBackward(s,i));if(Rl(e))return ff(e).map(s=>this.transformBackward(s,i));if(Pl(e))return e.map(s=>this.transformBackward(s,i));if(Nl(e))return mf(e).map(s=>this.transformBackward(s,i));throw new Error("Input type not supported")}transformBackwardAsGeojson(e,i){if(!yn(i,this.options).inputIsMultiGeometry){if(lo(e))return cf(this.transformBackward(e));if(kl(e))return cf(this.transformBackward(Pd(e)));if(Pa(e))return hf(Ef(this,e,yn(i,this.options,{sourceIsGeographic:!0})));if(Cl(e))return hf(Ef(this,kd(e),yn(i,this.options,{sourceIsGeographic:!0,destinationIsGeographic:!0})));if(ka(e))return df(Sf(this,e,yn(i,this.options,{sourceIsGeographic:!0})));if(Al(e))return df(Sf(this,Cd(e),yn(i,this.options,{sourceIsGeographic:!0,destinationIsGeographic:!0})))}if(i&&(i.inputIsMultiGeometry=!1),Sl(e))return gf(e.map(s=>this.transformBackwardAsGeojson(s,i)));if(Ll(e))return gf(pf(e).map(s=>this.transformBackwardAsGeojson(s,i)));if(Ml(e))return yf(e.map(s=>this.transformBackwardAsGeojson(s,i)));if(Rl(e))return yf(ff(e).map(s=>this.transformBackwardAsGeojson(s,i)));if(Pl(e))return _f(e.map(s=>this.transformBackwardAsGeojson(s,i)));if(Nl(e))return _f(mf(e).map(s=>this.transformBackwardAsGeojson(s,i)));throw new Error("Input type not supported")}transformToGeo(e,i){if(!yn(i,this.options).inputIsMultiGeometry){if(lo(e))return this.transformForward(e,i);if(kl(e))return this.transformForward(e,i);if(Pa(e))return this.transformForward(e,i);if(Cl(e))return this.transformForward(e,i);if(ka(e))return this.transformForward(e,i);if(Al(e))return this.transformForward(e,i)}if(i&&(i.inputIsMultiGeometry=!1),Sl(e))return this.transformForward(e,i);if(Ll(e))return this.transformForward(e,i);if(Ml(e))return this.transformForward(e,i);if(Rl(e))return this.transformForward(e,i);if(Pl(e))return this.transformForward(e,i);if(Nl(e))return this.transformForward(e,i);throw new Error("Input type not supported")}transformToGeoAsGeojson(e,i){if(!yn(i,this.options).inputIsMultiGeometry){if(lo(e))return this.transformForwardAsGeojson(e,i);if(kl(e))return this.transformForwardAsGeojson(e,i);if(Pa(e))return this.transformForwardAsGeojson(e,i);if(Cl(e))return this.transformForwardAsGeojson(e,i);if(ka(e))return this.transformForwardAsGeojson(e,i);if(Al(e))return this.transformForwardAsGeojson(e,i)}if(i&&(i.inputIsMultiGeometry=!1),Sl(e))return this.transformForwardAsGeojson(e,i);if(Ll(e))return this.transformForwardAsGeojson(e,i);if(Ml(e))return this.transformForwardAsGeojson(e,i);if(Rl(e))return this.transformForwardAsGeojson(e,i);if(Pl(e))return this.transformForwardAsGeojson(e,i);if(Nl(e))return this.transformForwardAsGeojson(e,i);throw new Error("Input type not supported")}transformToResource(e,i){if(!yn(i,this.options).inputIsMultiGeometry){if(lo(e))return this.transformBackward(e,i);if(kl(e))return this.transformBackward(e,i);if(Pa(e))return this.transformBackward(e,i);if(Cl(e))return this.transformBackward(e,i);if(ka(e))return this.transformBackward(e,i);if(Al(e))return this.transformBackward(e,i)}if(i&&(i.inputIsMultiGeometry=!1),Sl(e))return this.transformBackward(e,i);if(Ll(e))return this.transformBackward(e,i);if(Ml(e))return this.transformBackward(e,i);if(Rl(e))return this.transformBackward(e,i);if(Pl(e))return this.transformBackward(e,i);if(Nl(e))return this.transformBackward(e,i);throw new Error("Input type not supported")}transformToResourceAsGeojson(e,i){if(!yn(i,this.options).inputIsMultiGeometry){if(lo(e))return this.transformBackwardAsGeojson(e,i);if(kl(e))return this.transformBackwardAsGeojson(e,i);if(Pa(e))return this.transformBackwardAsGeojson(e,i);if(Cl(e))return this.transformBackwardAsGeojson(e,i);if(ka(e))return this.transformBackwardAsGeojson(e,i);if(Al(e))return this.transformBackwardAsGeojson(e,i)}if(i&&(i.inputIsMultiGeometry=!1),Sl(e))return this.transformBackwardAsGeojson(e,i);if(Ll(e))return this.transformBackwardAsGeojson(e,i);if(Ml(e))return this.transformBackwardAsGeojson(e,i);if(Rl(e))return this.transformBackwardAsGeojson(e,i);if(Pl(e))return this.transformBackwardAsGeojson(e,i);if(Nl(e))return this.transformBackwardAsGeojson(e,i);throw new Error("Input type not supported")}transformSvgToGeojson(e,i){if(e.type==="circle")return this.transformForwardAsGeojson(e.coordinates);if(e.type==="line")return this.transformForwardAsGeojson(e.coordinates,i);if(e.type==="polyline")return this.transformForwardAsGeojson(e.coordinates,i);if(e.type==="rect")return this.transformForwardAsGeojson([e.coordinates],i);if(e.type==="polygon")return this.transformForwardAsGeojson([e.coordinates],i);throw new Error("Unsupported SVG geometry")}transformSvgStringToGeojsonFeatureCollection(e,i){const s=[];for(const h of Lk(e)){const x=this.transformSvgToGeojson(h,i);s.push(x)}return vk(s)}transformGeojsonToSvg(e,i){if(e.type==="Point")return{type:"circle",coordinates:this.transformBackward(e)};if(e.type==="LineString")return{type:"polyline",coordinates:this.transformBackward(e,i)};if(e.type==="Polygon")return{type:"polygon",coordinates:this.transformBackward(e,i)[0]};throw new Error("Unsupported GeoJSON geometry")}transformGeojsonFeatureCollectionToSvgString(e,i){const s=[];for(const h of bk(e)){const x=this.transformGeojsonToSvg(h,i);s.push(x)}return Nk(s)}assureEqualHandedness(e){return this.options?.differentHandedness?uk(e):e}computeTransformation(e,i){if(this.type==="straight")return new PL(e,i);if(this.type==="helmert")return new aT(e,i);if(this.type==="polynomial1"||this.type==="polynomial")return new ay(e,i);if(this.type==="polynomial2")return new ay(e,i,2);if(this.type==="polynomial3")return new ay(e,i,3);if(this.type==="projective")return new kL(e,i);if(this.type==="thinPlateSpline")return new CL(e,i,AL,LL);throw new Error(`Unsupported transformation type: ${this.type}`)}}const cT=["log2sigma","twoOmega","airyKavr","signDetJ","thetaa"];function OL(r,e,i,s=1){if(!i)return 0;const h=r[0]**2+r[1]**2,x=e[0]**2+e[1]**2,m=r[0]*e[0]+r[1]*e[1],o=Math.sqrt(.5*(h+x+Math.sqrt((h-x)**2+4*m**2))),P=Math.sqrt(.5*(h+x-Math.sqrt((h-x)**2+4*m**2))),L=Math.atan(r[1]/r[0]),D=Math.sign(-m)*Math.asin(Math.sqrt((1-o**2/h)/(1-(o/P)**2)));switch(cT.indexOf(i)){case 0:return(Math.log(o*P)-2*Math.log(s))/Math.log(2);case 1:return 2*Math.asin((o-P)/(o+P));case 2:return .5*(Math.log(o/s)**2+Math.log(P/s)**2);case 3:return Math.sign(r[0]*e[1]-r[1]*e[0]);case 4:return L-D;default:throw new Error("Distortion "+i+" not supported")}}var ci=(r=>(r.GEOREFERENCEANNOTATIONADDED="georeferenceannotationadded",r.GEOREFERENCEANNOTATIONREMOVED="georeferenceannotationremoved",r.WARPEDMAPADDED="warpedmapadded",r.WARPEDMAPREMOVED="warpedmapremoved",r.WARPEDMAPENTER="warpedmapenter",r.WARPEDMAPLEAVE="warpedmapleave",r.IMAGEINFOLOADED="imageinfoloaded",r.TILEFETCHED="tilefetched",r.TILEFETCHERROR="tilefetcherror",r.MAPTILELOADED="maptileloaded",r.MAPTILEREMOVED="maptileremoved",r.FIRSTMAPTILELOADED="firstmaptileloaded",r.ALLREQUESTEDTILESLOADED="allrequestedtilesloaded",r.TEXTURESUPDATED="texturesupdated",r.ZINDICESCHANGES="zindiceschanged",r.RESOURCEMASKUPDATED="resourcemaskupdated",r.VISIBILITYCHANGED="visibilitychanged",r.TRANSFORMATIONCHANGED="transformationchanged",r.DISTORTIONCHANGED="distortionchanged",r.CHANGED="changed",r.CLEARED="cleared",r))(ci||{});let yr=class extends Event{data;constructor(e,i){super(e),this.data=i}};const uy={maxOffsetRatio:.05,maxDepth:2,differentHandedness:!0},hT=!0;function DL(){return{visible:hT}}class FL extends EventTarget{mapId;georeferencedMap;gcps;projectedGcps;resourceMask;resourceMaskBbox;resourceMaskRectangle;resourceFullMask;resourceFullMaskBbox;resourceFullMaskRectangle;imageInformations;imageId;parsedImage;loadingImageInfo;fetchFn;visible;transformationType;transformer;projectedTransformer;transformerByTransformationType=new Map;projectedTransformerByTransformationType=new Map;geoMask;geoMaskBbox;geoMaskRectangle;geoFullMask;geoFullMaskBbox;geoFullMaskRectangle;projectedGeoMask;projectedGeoMaskBbox;projectedGeoMaskRectangle;projectedGeoFullMask;projectedGeoFullMaskBbox;projectedGeoFullMaskRectangle;resourceToProjectedGeoScale;distortionMeasure;bestScaleFactor;resourceViewportRing=[];resourceViewportRingBbox;constructor(e,i,s){super(),s={...DL(),...s},this.mapId=e,this.georeferencedMap=i,this.gcps=this.georeferencedMap.gcps,this.projectedGcps=this.gcps.map(({resource:h,geo:x})=>({resource:h,geo:sh(x)})),this.resourceMask=this.georeferencedMap.resourceMask,this.updateResourceMaskProperties(),this.resourceFullMask=[[0,0],[this.georeferencedMap.resource.width,0],[this.georeferencedMap.resource.width,this.georeferencedMap.resource.height],[0,this.georeferencedMap.resource.height]],this.resourceFullMaskBbox=Xs(this.resourceFullMask),this.resourceFullMaskRectangle=nm(this.resourceFullMaskBbox),this.imageInformations=s.imageInformations,this.loadingImageInfo=!1,this.visible=s.visible||hT,this.fetchFn=s.fetchFn,this.transformationType=s.transformation?.type||this.georeferencedMap.transformation?.type||"polynomial",this.updateTransformerProperties()}getViewportMask(e){return this.projectedGeoMask.map(i=>ch(e.projectedGeoToViewportTransform,i))}getViewportMaskBbox(e){return Xs(this.getViewportMask(e))}getViewportMaskRectangle(e){return this.projectedGeoMaskRectangle.map(i=>ch(e.projectedGeoToViewportTransform,i))}getViewportFullMask(e){return this.projectedGeoFullMask.map(i=>ch(e.projectedGeoToViewportTransform,i))}getViewportFullMaskBbox(e){return Xs(this.getViewportFullMask(e))}getViewportFullMaskRectangle(e){return this.projectedGeoFullMaskRectangle.map(i=>ch(e.projectedGeoToViewportTransform,i))}getResourceToViewportScale(e){return Zx(this.resourceMaskRectangle,this.getViewportMaskRectangle(e))}getResourceToCanvasScale(e){return this.getResourceToViewportScale(e)/e.devicePixelRatio}getReferenceScale(){const e=jf(this.projectedTransformerByTransformationType,"helmert",()=>new ly(this.projectedGcps,"helmert",uy));return e.forwardTransformation||e.createForwardTransformation(),e.forwardTransformation.scale}setResourceViewportRing(e){this.resourceViewportRing=e,this.resourceViewportRingBbox=Xs(e)}setResourceMask(e){this.resourceMask=e,this.updateResourceMaskProperties(),this.updateGeoMask(),this.updateProjectedGeoMask(),this.updateResourceToProjectedGeoScale()}setTransformationType(e){this.transformationType=e,this.updateTransformerProperties()}setDistortionMeasure(e){this.distortionMeasure=e}setGcps(e){this.gcps=e,this.updateTransformerProperties(!1)}setBestScaleFactor(e){const i=this.bestScaleFactor!=e;return i&&(this.bestScaleFactor=e),i}hasImageInfo(){return this.imageId!==void 0&&this.parsedImage!==void 0}async loadImageInfo(){try{this.loadingImageInfo=!0;const e=this.georeferencedMap.resource.id;let i;this.imageInformations?.get(e)?i=this.imageInformations.get(e):(i=await rk(e,void 0,this.fetchFn),this.imageInformations?.set(e,i)),this.parsedImage=N_.parse(i),this.imageId=await yw(e),this.dispatchEvent(new yr(ci.IMAGEINFOLOADED))}catch(e){throw this.loadingImageInfo=!1,e}finally{this.loadingImageInfo=!1}}dispose(){}updateResourceMaskProperties(){this.resourceMaskBbox=Xs(this.resourceMask),this.resourceMaskRectangle=nm(this.resourceMaskBbox)}updateTransformerProperties(e=!0){this.updateTransformer(e),this.updateProjectedTransformer(e),this.updateGeoMask(),this.updateFullGeoMask(),this.updateProjectedGeoMask(),this.updateProjectedFullGeoMask(),this.updateResourceToProjectedGeoScale()}updateTransformer(e=!0){this.transformer=jf(this.transformerByTransformationType,this.transformationType,()=>new ly(this.gcps,this.transformationType,uy),e)}updateProjectedTransformer(e=!0){this.projectedTransformer=jf(this.projectedTransformerByTransformationType,this.transformationType,()=>new ly(this.projectedGcps,this.transformationType,uy),e)}updateGeoMask(){this.geoMask=this.transformer.transformForwardAsGeojson([this.resourceMask]),this.geoMaskBbox=Xs(this.geoMask),this.geoMaskRectangle=this.transformer.transformForward([this.resourceMaskRectangle],{maxDepth:0})[0]}updateFullGeoMask(){this.geoFullMask=this.transformer.transformForwardAsGeojson([this.resourceFullMask]),this.geoFullMaskBbox=Xs(this.geoFullMask),this.geoFullMaskRectangle=this.transformer.transformForward([this.resourceFullMaskRectangle],{maxDepth:0})[0]}updateProjectedGeoMask(){this.projectedGeoMask=this.projectedTransformer.transformForward([this.resourceMask])[0],this.projectedGeoMaskBbox=Xs(this.projectedGeoMask),this.projectedGeoMaskRectangle=this.projectedTransformer.transformForward([this.resourceMaskRectangle],{maxDepth:0})[0]}updateProjectedFullGeoMask(){this.projectedGeoFullMask=this.projectedTransformer.transformForward([this.resourceFullMask])[0],this.projectedGeoFullMaskBbox=Xs(this.projectedGeoFullMask),this.projectedGeoFullMaskRectangle=this.projectedTransformer.transformForward([this.resourceFullMaskRectangle],{maxDepth:0})[0]}updateResourceToProjectedGeoScale(){this.resourceToProjectedGeoScale=Zx(this.resourceMaskRectangle,this.projectedGeoMaskRectangle)}}function zL(r){return Math.sqrt(Math.pow(r[1][0]-r[0][0],2)+Math.pow(r[1][1]-r[0][1],2))}function BL(r){return Math.atan2(r[1][1]-r[0][1],r[1][0]-r[0][0])}function $L(r,e,i){return[r[0]+Math.cos(i)*e,r[1]+Math.sin(i)*e]}function jL(r,e){let i=r[0];const s=[i];for(;zL([i,r[1]])>e;){const h=$L(i,e,BL(r));s.push(h),i=h}return s}function GL(r,e){r=[...r,r[0]];let i=[];for(let s=0;s<r.length-1;s++)i=i.concat(jL([r[s],r[s+1]],e));return i}function UL(r,e){const i=[],s=Xs(r);for(let h=s[0]+e,x=0;h<=s[2];x++,h+=e)for(let m=s[1]+e,o=0;m<=s[3];o++,m+=e)i.push([h,m]);return i}function VL(r){return r&&r.__esModule&&Object.prototype.hasOwnProperty.call(r,"default")?r.default:r}var dT={exports:{}},pT=qL,p1=+(Math.pow(2,27)+1);function qL(r,e,i){var s=r*e,h=p1*r,x=h-r,m=h-x,o=r-m,P=p1*e,L=P-e,D=P-L,F=e-D,Y=s-m*D,V=Y-o*D,H=V-m*F,ve=o*F-H;return i?(i[0]=ve,i[1]=s,i):[ve,s]}var ZL=YL;function WL(r,e){var i=r+e,s=i-r,h=i-s,x=e-s,m=r-h,o=m+x;return o?[o,i]:[i]}function YL(r,e){var i=r.length|0,s=e.length|0;if(i===1&&s===1)return WL(r[0],e[0]);var h=i+s,x=new Array(h),m=0,o=0,P=0,L=Math.abs,D=r[o],F=L(D),Y=e[P],V=L(Y),H,ve;F<V?(ve=D,o+=1,o<i&&(D=r[o],F=L(D))):(ve=Y,P+=1,P<s&&(Y=e[P],V=L(Y))),o<i&&F<V||P>=s?(H=D,o+=1,o<i&&(D=r[o],F=L(D))):(H=Y,P+=1,P<s&&(Y=e[P],V=L(Y)));for(var _e=H+ve,oe=_e-H,fe=ve-oe,K=fe,ne=_e,ye,Re,Se,Z,$;o<i&&P<s;)F<V?(H=D,o+=1,o<i&&(D=r[o],F=L(D))):(H=Y,P+=1,P<s&&(Y=e[P],V=L(Y))),ve=K,_e=H+ve,oe=_e-H,fe=ve-oe,fe&&(x[m++]=fe),ye=ne+_e,Re=ye-ne,Se=ye-Re,Z=_e-Re,$=ne-Se,K=$+Z,ne=ye;for(;o<i;)H=D,ve=K,_e=H+ve,oe=_e-H,fe=ve-oe,fe&&(x[m++]=fe),ye=ne+_e,Re=ye-ne,Se=ye-Re,Z=_e-Re,$=ne-Se,K=$+Z,ne=ye,o+=1,o<i&&(D=r[o]);for(;P<s;)H=Y,ve=K,_e=H+ve,oe=_e-H,fe=ve-oe,fe&&(x[m++]=fe),ye=ne+_e,Re=ye-ne,Se=ye-Re,Z=_e-Re,$=ne-Se,K=$+Z,ne=ye,P+=1,P<s&&(Y=e[P]);return K&&(x[m++]=K),ne&&(x[m++]=ne),m||(x[m++]=0),x.length=m,x}var XL=HL;function HL(r,e,i){var s=r+e,h=s-r,x=s-h,m=e-h,o=r-x;return i?(i[0]=o+m,i[1]=s,i):[o+m,s]}var cy=pT,KL=XL,JL=QL;function QL(r,e){var i=r.length;if(i===1){var s=cy(r[0],e);return s[0]?s:[s[1]]}var h=new Array(2*i),x=[.1,.1],m=[.1,.1],o=0;cy(r[0],e,x),x[0]&&(h[o++]=x[0]);for(var P=1;P<i;++P){cy(r[P],e,m);var L=x[1];KL(L,m[0],x),x[0]&&(h[o++]=x[0]);var D=m[1],F=x[1],Y=D+F,V=Y-D,H=F-V;x[1]=Y,H&&(h[o++]=H)}return x[1]&&(h[o++]=x[1]),o===0&&(h[o++]=0),h.length=o,h}var eR=iR;function tR(r,e){var i=r+e,s=i-r,h=i-s,x=e-s,m=r-h,o=m+x;return o?[o,i]:[i]}function iR(r,e){var i=r.length|0,s=e.length|0;if(i===1&&s===1)return tR(r[0],-e[0]);var h=i+s,x=new Array(h),m=0,o=0,P=0,L=Math.abs,D=r[o],F=L(D),Y=-e[P],V=L(Y),H,ve;F<V?(ve=D,o+=1,o<i&&(D=r[o],F=L(D))):(ve=Y,P+=1,P<s&&(Y=-e[P],V=L(Y))),o<i&&F<V||P>=s?(H=D,o+=1,o<i&&(D=r[o],F=L(D))):(H=Y,P+=1,P<s&&(Y=-e[P],V=L(Y)));for(var _e=H+ve,oe=_e-H,fe=ve-oe,K=fe,ne=_e,ye,Re,Se,Z,$;o<i&&P<s;)F<V?(H=D,o+=1,o<i&&(D=r[o],F=L(D))):(H=Y,P+=1,P<s&&(Y=-e[P],V=L(Y))),ve=K,_e=H+ve,oe=_e-H,fe=ve-oe,fe&&(x[m++]=fe),ye=ne+_e,Re=ye-ne,Se=ye-Re,Z=_e-Re,$=ne-Se,K=$+Z,ne=ye;for(;o<i;)H=D,ve=K,_e=H+ve,oe=_e-H,fe=ve-oe,fe&&(x[m++]=fe),ye=ne+_e,Re=ye-ne,Se=ye-Re,Z=_e-Re,$=ne-Se,K=$+Z,ne=ye,o+=1,o<i&&(D=r[o]);for(;P<s;)H=Y,ve=K,_e=H+ve,oe=_e-H,fe=ve-oe,fe&&(x[m++]=fe),ye=ne+_e,Re=ye-ne,Se=ye-Re,Z=_e-Re,$=ne-Se,K=$+Z,ne=ye,P+=1,P<s&&(Y=-e[P]);return K&&(x[m++]=K),ne&&(x[m++]=ne),m||(x[m++]=0),x.length=m,x}(function(r){var e=pT,i=ZL,s=JL,h=eR,x=5,m=11102230246251565e-32,o=(3+16*m)*m,P=(7+56*m)*m;function L(K,ne,ye,Re){return function(Se,Z,$){var Q=K(K(ne(Z[1],$[0]),ne(-$[1],Z[0])),K(ne(Se[1],Z[0]),ne(-Z[1],Se[0]))),ue=K(ne(Se[1],$[0]),ne(-$[1],Se[0])),he=Re(Q,ue);return he[he.length-1]}}function D(K,ne,ye,Re){return function(Se,Z,$,Q){var ue=K(K(ye(K(ne($[1],Q[0]),ne(-Q[1],$[0])),Z[2]),K(ye(K(ne(Z[1],Q[0]),ne(-Q[1],Z[0])),-$[2]),ye(K(ne(Z[1],$[0]),ne(-$[1],Z[0])),Q[2]))),K(ye(K(ne(Z[1],Q[0]),ne(-Q[1],Z[0])),Se[2]),K(ye(K(ne(Se[1],Q[0]),ne(-Q[1],Se[0])),-Z[2]),ye(K(ne(Se[1],Z[0]),ne(-Z[1],Se[0])),Q[2])))),he=K(K(ye(K(ne($[1],Q[0]),ne(-Q[1],$[0])),Se[2]),K(ye(K(ne(Se[1],Q[0]),ne(-Q[1],Se[0])),-$[2]),ye(K(ne(Se[1],$[0]),ne(-$[1],Se[0])),Q[2]))),K(ye(K(ne(Z[1],$[0]),ne(-$[1],Z[0])),Se[2]),K(ye(K(ne(Se[1],$[0]),ne(-$[1],Se[0])),-Z[2]),ye(K(ne(Se[1],Z[0]),ne(-Z[1],Se[0])),$[2])))),Pe=Re(ue,he);return Pe[Pe.length-1]}}function F(K,ne,ye,Re){return function(Se,Z,$,Q,ue){var he=K(K(K(ye(K(ye(K(ne(Q[1],ue[0]),ne(-ue[1],Q[0])),$[2]),K(ye(K(ne($[1],ue[0]),ne(-ue[1],$[0])),-Q[2]),ye(K(ne($[1],Q[0]),ne(-Q[1],$[0])),ue[2]))),Z[3]),K(ye(K(ye(K(ne(Q[1],ue[0]),ne(-ue[1],Q[0])),Z[2]),K(ye(K(ne(Z[1],ue[0]),ne(-ue[1],Z[0])),-Q[2]),ye(K(ne(Z[1],Q[0]),ne(-Q[1],Z[0])),ue[2]))),-$[3]),ye(K(ye(K(ne($[1],ue[0]),ne(-ue[1],$[0])),Z[2]),K(ye(K(ne(Z[1],ue[0]),ne(-ue[1],Z[0])),-$[2]),ye(K(ne(Z[1],$[0]),ne(-$[1],Z[0])),ue[2]))),Q[3]))),K(ye(K(ye(K(ne($[1],Q[0]),ne(-Q[1],$[0])),Z[2]),K(ye(K(ne(Z[1],Q[0]),ne(-Q[1],Z[0])),-$[2]),ye(K(ne(Z[1],$[0]),ne(-$[1],Z[0])),Q[2]))),-ue[3]),K(ye(K(ye(K(ne(Q[1],ue[0]),ne(-ue[1],Q[0])),Z[2]),K(ye(K(ne(Z[1],ue[0]),ne(-ue[1],Z[0])),-Q[2]),ye(K(ne(Z[1],Q[0]),ne(-Q[1],Z[0])),ue[2]))),Se[3]),ye(K(ye(K(ne(Q[1],ue[0]),ne(-ue[1],Q[0])),Se[2]),K(ye(K(ne(Se[1],ue[0]),ne(-ue[1],Se[0])),-Q[2]),ye(K(ne(Se[1],Q[0]),ne(-Q[1],Se[0])),ue[2]))),-Z[3])))),K(K(ye(K(ye(K(ne(Z[1],ue[0]),ne(-ue[1],Z[0])),Se[2]),K(ye(K(ne(Se[1],ue[0]),ne(-ue[1],Se[0])),-Z[2]),ye(K(ne(Se[1],Z[0]),ne(-Z[1],Se[0])),ue[2]))),Q[3]),K(ye(K(ye(K(ne(Z[1],Q[0]),ne(-Q[1],Z[0])),Se[2]),K(ye(K(ne(Se[1],Q[0]),ne(-Q[1],Se[0])),-Z[2]),ye(K(ne(Se[1],Z[0]),ne(-Z[1],Se[0])),Q[2]))),-ue[3]),ye(K(ye(K(ne($[1],Q[0]),ne(-Q[1],$[0])),Z[2]),K(ye(K(ne(Z[1],Q[0]),ne(-Q[1],Z[0])),-$[2]),ye(K(ne(Z[1],$[0]),ne(-$[1],Z[0])),Q[2]))),Se[3]))),K(ye(K(ye(K(ne($[1],Q[0]),ne(-Q[1],$[0])),Se[2]),K(ye(K(ne(Se[1],Q[0]),ne(-Q[1],Se[0])),-$[2]),ye(K(ne(Se[1],$[0]),ne(-$[1],Se[0])),Q[2]))),-Z[3]),K(ye(K(ye(K(ne(Z[1],Q[0]),ne(-Q[1],Z[0])),Se[2]),K(ye(K(ne(Se[1],Q[0]),ne(-Q[1],Se[0])),-Z[2]),ye(K(ne(Se[1],Z[0]),ne(-Z[1],Se[0])),Q[2]))),$[3]),ye(K(ye(K(ne(Z[1],$[0]),ne(-$[1],Z[0])),Se[2]),K(ye(K(ne(Se[1],$[0]),ne(-$[1],Se[0])),-Z[2]),ye(K(ne(Se[1],Z[0]),ne(-Z[1],Se[0])),$[2]))),-Q[3]))))),Pe=K(K(K(ye(K(ye(K(ne(Q[1],ue[0]),ne(-ue[1],Q[0])),$[2]),K(ye(K(ne($[1],ue[0]),ne(-ue[1],$[0])),-Q[2]),ye(K(ne($[1],Q[0]),ne(-Q[1],$[0])),ue[2]))),Se[3]),ye(K(ye(K(ne(Q[1],ue[0]),ne(-ue[1],Q[0])),Se[2]),K(ye(K(ne(Se[1],ue[0]),ne(-ue[1],Se[0])),-Q[2]),ye(K(ne(Se[1],Q[0]),ne(-Q[1],Se[0])),ue[2]))),-$[3])),K(ye(K(ye(K(ne($[1],ue[0]),ne(-ue[1],$[0])),Se[2]),K(ye(K(ne(Se[1],ue[0]),ne(-ue[1],Se[0])),-$[2]),ye(K(ne(Se[1],$[0]),ne(-$[1],Se[0])),ue[2]))),Q[3]),ye(K(ye(K(ne($[1],Q[0]),ne(-Q[1],$[0])),Se[2]),K(ye(K(ne(Se[1],Q[0]),ne(-Q[1],Se[0])),-$[2]),ye(K(ne(Se[1],$[0]),ne(-$[1],Se[0])),Q[2]))),-ue[3]))),K(K(ye(K(ye(K(ne($[1],ue[0]),ne(-ue[1],$[0])),Z[2]),K(ye(K(ne(Z[1],ue[0]),ne(-ue[1],Z[0])),-$[2]),ye(K(ne(Z[1],$[0]),ne(-$[1],Z[0])),ue[2]))),Se[3]),ye(K(ye(K(ne($[1],ue[0]),ne(-ue[1],$[0])),Se[2]),K(ye(K(ne(Se[1],ue[0]),ne(-ue[1],Se[0])),-$[2]),ye(K(ne(Se[1],$[0]),ne(-$[1],Se[0])),ue[2]))),-Z[3])),K(ye(K(ye(K(ne(Z[1],ue[0]),ne(-ue[1],Z[0])),Se[2]),K(ye(K(ne(Se[1],ue[0]),ne(-ue[1],Se[0])),-Z[2]),ye(K(ne(Se[1],Z[0]),ne(-Z[1],Se[0])),ue[2]))),$[3]),ye(K(ye(K(ne(Z[1],$[0]),ne(-$[1],Z[0])),Se[2]),K(ye(K(ne(Se[1],$[0]),ne(-$[1],Se[0])),-Z[2]),ye(K(ne(Se[1],Z[0]),ne(-Z[1],Se[0])),$[2]))),-ue[3])))),Ae=Re(he,Pe);return Ae[Ae.length-1]}}function Y(K){var ne=K===3?L:K===4?D:F;return ne(i,e,s,h)}var V=Y(3),H=Y(4),ve=[function(){return 0},function(){return 0},function(K,ne){return ne[0]-K[0]},function(K,ne,ye){var Re=(K[1]-ye[1])*(ne[0]-ye[0]),Se=(K[0]-ye[0])*(ne[1]-ye[1]),Z=Re-Se,$;if(Re>0){if(Se<=0)return Z;$=Re+Se}else if(Re<0){if(Se>=0)return Z;$=-(Re+Se)}else return Z;var Q=o*$;return Z>=Q||Z<=-Q?Z:V(K,ne,ye)},function(K,ne,ye,Re){var Se=K[0]-Re[0],Z=ne[0]-Re[0],$=ye[0]-Re[0],Q=K[1]-Re[1],ue=ne[1]-Re[1],he=ye[1]-Re[1],Pe=K[2]-Re[2],Ae=ne[2]-Re[2],ke=ye[2]-Re[2],Be=Z*he,Ke=$*ue,tt=$*Q,pt=Se*he,vt=Se*ue,Ft=Z*Q,It=Pe*(Be-Ke)+Ae*(tt-pt)+ke*(vt-Ft),Zt=(Math.abs(Be)+Math.abs(Ke))*Math.abs(Pe)+(Math.abs(tt)+Math.abs(pt))*Math.abs(Ae)+(Math.abs(vt)+Math.abs(Ft))*Math.abs(ke),zt=P*Zt;return It>zt||-It>zt?It:H(K,ne,ye,Re)}];function _e(K){var ne=ve[K.length];return ne||(ne=ve[K.length]=Y(K.length)),ne.apply(void 0,K)}function oe(K,ne,ye,Re,Se,Z,$){return function(Q,ue,he,Pe,Ae){switch(arguments.length){case 0:case 1:return 0;case 2:return Re(Q,ue);case 3:return Se(Q,ue,he);case 4:return Z(Q,ue,he,Pe);case 5:return $(Q,ue,he,Pe,Ae)}for(var ke=new Array(arguments.length),Be=0;Be<arguments.length;++Be)ke[Be]=arguments[Be];return K(ke)}}function fe(){for(;ve.length<=x;)ve.push(Y(ve.length));r.exports=oe.apply(void 0,[_e].concat(ve));for(var K=0;K<=x;++K)r.exports[K]=ve[K]}fe()})(dT);var rR=dT.exports,nR=sR,Mf=rR;function sR(r,e){for(var i=e[0],s=e[1],h=r.length,x=1,m=h,o=0,P=h-1;o<m;P=o++){var L=r[o],D=r[P],F=L[1],Y=D[1];if(Y<F){if(Y<s&&s<F){var V=Mf(L,D,e);if(V===0)return 0;x^=0<V|0}else if(s===F){var H=r[(o+1)%h],ve=H[1];if(F<ve){var V=Mf(L,D,e);if(V===0)return 0;x^=0<V|0}}}else if(F<Y){if(F<s&&s<Y){var V=Mf(L,D,e);if(V===0)return 0;x^=V<0|0}else if(s===F){var H=r[(o+1)%h],ve=H[1];if(ve<F){var V=Mf(L,D,e);if(V===0)return 0;x^=V<0|0}}}else if(s===F){var _e=Math.min(L[0],D[0]),oe=Math.max(L[0],D[0]);if(o===0){for(;P>0;){var fe=(P+h-1)%h,K=r[fe];if(K[1]!==s)break;var ne=K[0];_e=Math.min(_e,ne),oe=Math.max(oe,ne),P=fe}if(P===0)return _e<=i&&i<=oe?0:1;m=P+1}for(var ye=r[(P+h-1)%h][1];o+1<m;){var K=r[o+1];if(K[1]!==s)break;var ne=K[0];_e=Math.min(_e,ne),oe=Math.max(oe,ne),o+=1}if(_e<=i&&i<=oe)return 0;var Re=r[(o+1)%h][1];i<_e&&ye<s!=Re<s&&(x^=1)}}return 2*x-1}const oR=VL(nR);var fT={};const aR="1.5.0",lR={version:aR};function mT(r){return"("+r.x+";"+r.y+")"}function uR(r){var e=r.toString();return e==="[object Object]"?mT(r):e}function cR(r,e){return r.y===e.y?r.x-e.x:r.y-e.y}function hR(r,e){return r.x===e.x&&r.y===e.y}var B_={toString:uR,toStringBase:mT,compare:cR,equals:hR},dR=B_,vm=function(r,e){this.name="PointError",this.points=e=e||[],this.message=r||"Invalid Points!";for(var i=0;i<e.length;i++)this.message+=" "+dR.toString(e[i])};vm.prototype=new Error;vm.prototype.constructor=vm;var $_=vm,mp=B_,qr=function(r,e){this.x=+r||0,this.y=+e||0,this._p2t_edge_list=null};qr.prototype.toString=function(){return mp.toStringBase(this)};qr.prototype.toJSON=function(){return{x:this.x,y:this.y}};qr.prototype.clone=function(){return new qr(this.x,this.y)};qr.prototype.set_zero=function(){return this.x=0,this.y=0,this};qr.prototype.set=function(r,e){return this.x=+r||0,this.y=+e||0,this};qr.prototype.negate=function(){return this.x=-this.x,this.y=-this.y,this};qr.prototype.add=function(r){return this.x+=r.x,this.y+=r.y,this};qr.prototype.sub=function(r){return this.x-=r.x,this.y-=r.y,this};qr.prototype.mul=function(r){return this.x*=r,this.y*=r,this};qr.prototype.length=function(){return Math.sqrt(this.x*this.x+this.y*this.y)};qr.prototype.normalize=function(){var r=this.length();return this.x/=r,this.y/=r,r};qr.prototype.equals=function(r){return this.x===r.x&&this.y===r.y};qr.negate=function(r){return new qr(-r.x,-r.y)};qr.add=function(r,e){return new qr(r.x+e.x,r.y+e.y)};qr.sub=function(r,e){return new qr(r.x-e.x,r.y-e.y)};qr.mul=function(r,e){return new qr(r*e.x,r*e.y)};qr.cross=function(r,e){return typeof r=="number"?typeof e=="number"?r*e:new qr(-r*e.y,r*e.x):typeof e=="number"?new qr(e*r.y,-e*r.x):r.x*e.y-r.y*e.x};qr.toString=mp.toString;qr.compare=mp.compare;qr.cmp=mp.compare;qr.equals=mp.equals;qr.dot=function(r,e){return r.x*e.x+r.y*e.y};var gT=qr,pR=B_,wr=function(r,e,i){this.points_=[r,e,i],this.neighbors_=[null,null,null],this.interior_=!1,this.constrained_edge=[!1,!1,!1],this.delaunay_edge=[!1,!1,!1]},hy=pR.toString;wr.prototype.toString=function(){return"["+hy(this.points_[0])+hy(this.points_[1])+hy(this.points_[2])+"]"};wr.prototype.getPoint=function(r){return this.points_[r]};wr.prototype.GetPoint=wr.prototype.getPoint;wr.prototype.getPoints=function(){return this.points_};wr.prototype.getNeighbor=function(r){return this.neighbors_[r]};wr.prototype.containsPoint=function(r){var e=this.points_;return r===e[0]||r===e[1]||r===e[2]};wr.prototype.containsEdge=function(r){return this.containsPoint(r.p)&&this.containsPoint(r.q)};wr.prototype.containsPoints=function(r,e){return this.containsPoint(r)&&this.containsPoint(e)};wr.prototype.isInterior=function(){return this.interior_};wr.prototype.setInterior=function(r){return this.interior_=r,this};wr.prototype.markNeighborPointers=function(r,e,i){var s=this.points_;if(r===s[2]&&e===s[1]||r===s[1]&&e===s[2])this.neighbors_[0]=i;else if(r===s[0]&&e===s[2]||r===s[2]&&e===s[0])this.neighbors_[1]=i;else if(r===s[0]&&e===s[1]||r===s[1]&&e===s[0])this.neighbors_[2]=i;else throw new Error("poly2tri Invalid Triangle.markNeighborPointers() call")};wr.prototype.markNeighbor=function(r){var e=this.points_;r.containsPoints(e[1],e[2])?(this.neighbors_[0]=r,r.markNeighborPointers(e[1],e[2],this)):r.containsPoints(e[0],e[2])?(this.neighbors_[1]=r,r.markNeighborPointers(e[0],e[2],this)):r.containsPoints(e[0],e[1])&&(this.neighbors_[2]=r,r.markNeighborPointers(e[0],e[1],this))};wr.prototype.clearNeighbors=function(){this.neighbors_[0]=null,this.neighbors_[1]=null,this.neighbors_[2]=null};wr.prototype.clearDelaunayEdges=function(){this.delaunay_edge[0]=!1,this.delaunay_edge[1]=!1,this.delaunay_edge[2]=!1};wr.prototype.pointCW=function(r){var e=this.points_;return r===e[0]?e[2]:r===e[1]?e[0]:r===e[2]?e[1]:null};wr.prototype.pointCCW=function(r){var e=this.points_;return r===e[0]?e[1]:r===e[1]?e[2]:r===e[2]?e[0]:null};wr.prototype.neighborCW=function(r){return r===this.points_[0]?this.neighbors_[1]:r===this.points_[1]?this.neighbors_[2]:this.neighbors_[0]};wr.prototype.neighborCCW=function(r){return r===this.points_[0]?this.neighbors_[2]:r===this.points_[1]?this.neighbors_[0]:this.neighbors_[1]};wr.prototype.getConstrainedEdgeCW=function(r){return r===this.points_[0]?this.constrained_edge[1]:r===this.points_[1]?this.constrained_edge[2]:this.constrained_edge[0]};wr.prototype.getConstrainedEdgeCCW=function(r){return r===this.points_[0]?this.constrained_edge[2]:r===this.points_[1]?this.constrained_edge[0]:this.constrained_edge[1]};wr.prototype.getConstrainedEdgeAcross=function(r){return r===this.points_[0]?this.constrained_edge[0]:r===this.points_[1]?this.constrained_edge[1]:this.constrained_edge[2]};wr.prototype.setConstrainedEdgeCW=function(r,e){r===this.points_[0]?this.constrained_edge[1]=e:r===this.points_[1]?this.constrained_edge[2]=e:this.constrained_edge[0]=e};wr.prototype.setConstrainedEdgeCCW=function(r,e){r===this.points_[0]?this.constrained_edge[2]=e:r===this.points_[1]?this.constrained_edge[0]=e:this.constrained_edge[1]=e};wr.prototype.getDelaunayEdgeCW=function(r){return r===this.points_[0]?this.delaunay_edge[1]:r===this.points_[1]?this.delaunay_edge[2]:this.delaunay_edge[0]};wr.prototype.getDelaunayEdgeCCW=function(r){return r===this.points_[0]?this.delaunay_edge[2]:r===this.points_[1]?this.delaunay_edge[0]:this.delaunay_edge[1]};wr.prototype.setDelaunayEdgeCW=function(r,e){r===this.points_[0]?this.delaunay_edge[1]=e:r===this.points_[1]?this.delaunay_edge[2]=e:this.delaunay_edge[0]=e};wr.prototype.setDelaunayEdgeCCW=function(r,e){r===this.points_[0]?this.delaunay_edge[2]=e:r===this.points_[1]?this.delaunay_edge[0]=e:this.delaunay_edge[1]=e};wr.prototype.neighborAcross=function(r){return r===this.points_[0]?this.neighbors_[0]:r===this.points_[1]?this.neighbors_[1]:this.neighbors_[2]};wr.prototype.oppositePoint=function(r,e){var i=r.pointCW(e);return this.pointCW(i)};wr.prototype.legalize=function(r,e){var i=this.points_;if(r===i[0])i[1]=i[0],i[0]=i[2],i[2]=e;else if(r===i[1])i[2]=i[1],i[1]=i[0],i[0]=e;else if(r===i[2])i[0]=i[2],i[2]=i[1],i[1]=e;else throw new Error("poly2tri Invalid Triangle.legalize() call")};wr.prototype.index=function(r){var e=this.points_;if(r===e[0])return 0;if(r===e[1])return 1;if(r===e[2])return 2;throw new Error("poly2tri Invalid Triangle.index() call")};wr.prototype.edgeIndex=function(r,e){var i=this.points_;if(r===i[0]){if(e===i[1])return 2;if(e===i[2])return 1}else if(r===i[1]){if(e===i[2])return 0;if(e===i[0])return 2}else if(r===i[2]){if(e===i[0])return 1;if(e===i[1])return 0}return-1};wr.prototype.markConstrainedEdgeByIndex=function(r){this.constrained_edge[r]=!0};wr.prototype.markConstrainedEdgeByEdge=function(r){this.markConstrainedEdgeByPoints(r.p,r.q)};wr.prototype.markConstrainedEdgeByPoints=function(r,e){var i=this.points_;e===i[0]&&r===i[1]||e===i[1]&&r===i[0]?this.constrained_edge[2]=!0:e===i[0]&&r===i[2]||e===i[2]&&r===i[0]?this.constrained_edge[1]=!0:(e===i[1]&&r===i[2]||e===i[2]&&r===i[1])&&(this.constrained_edge[0]=!0)};var j_=wr,G_={};function fR(r,e){if(!r)throw new Error(e||"Assert Failed")}var mR=fR,U_={exports:{}},gR=function(r,e){this.point=r,this.triangle=e||null,this.next=null,this.prev=null,this.value=r.x},hl=function(r,e){this.head_=r,this.tail_=e,this.search_node_=r};hl.prototype.head=function(){return this.head_};hl.prototype.setHead=function(r){this.head_=r};hl.prototype.tail=function(){return this.tail_};hl.prototype.setTail=function(r){this.tail_=r};hl.prototype.search=function(){return this.search_node_};hl.prototype.setSearch=function(r){this.search_node_=r};hl.prototype.findSearchNode=function(){return this.search_node_};hl.prototype.locateNode=function(r){var e=this.search_node_;if(r<e.value){for(;e=e.prev;)if(r>=e.value)return this.search_node_=e,e}else for(;e=e.next;)if(r<e.value)return this.search_node_=e.prev,e.prev;return null};hl.prototype.locatePoint=function(r){var e=r.x,i=this.findSearchNode(e),s=i.point.x;if(e===s){if(r!==i.point)if(r===i.prev.point)i=i.prev;else if(r===i.next.point)i=i.next;else throw new Error("poly2tri Invalid AdvancingFront.locatePoint() call")}else if(e<s)for(;(i=i.prev)&&r!==i.point;);else for(;(i=i.next)&&r!==i.point;);return i&&(this.search_node_=i),i};U_.exports=hl;U_.exports.Node=gR;var yT=U_.exports,Mh={},ap=1e-12;Mh.EPSILON=ap;var Vf={CW:1,CCW:-1,COLLINEAR:0};Mh.Orientation=Vf;function yR(r,e,i){var s=(r.x-i.x)*(e.y-i.y),h=(r.y-i.y)*(e.x-i.x),x=s-h;return x>-ap&&x<ap?Vf.COLLINEAR:x>0?Vf.CCW:Vf.CW}Mh.orient2d=yR;function _R(r,e,i,s){var h=(r.x-e.x)*(s.y-e.y)-(s.x-e.x)*(r.y-e.y);if(h>=-ap)return!1;var x=(r.x-i.x)*(s.y-i.y)-(s.x-i.x)*(r.y-i.y);return!(x<=ap)}Mh.inScanArea=_R;function vR(r,e,i){var s=e.x-r.x,h=e.y-r.y,x=i.x-r.x,m=i.y-r.y;return s*x+h*m<0}Mh.isAngleObtuse=vR;var V_=mR,xm=$_,_T=j_,xR=yT.Node,gp=Mh,bR=gp.EPSILON,Yn=gp.Orientation,vs=gp.orient2d,vT=gp.inScanArea,f1=gp.isAngleObtuse;function wR(r){r.initTriangulation(),r.createAdvancingFront(),TR(r),ER(r)}function TR(r){var e,i=r.pointCount();for(e=1;e<i;++e)for(var s=r.getPoint(e),h=IR(r,s),x=s._p2t_edge_list,m=0;x&&m<x.length;++m)SR(r,x[m],h)}function ER(r){for(var e=r.front().head().next.triangle,i=r.front().head().next.point;!e.getConstrainedEdgeCW(i);)e=e.neighborCCW(i);r.meshClean(e)}function IR(r,e){var i=r.locateNode(e),s=MR(r,e,i);return e.x<=i.point.x+bR&&xh(r,i),PR(r,s),s}function SR(r,e,i){r.edge_event.constrained_edge=e,r.edge_event.right=e.p.x>e.q.x,!xT(i.triangle,e.p,e.q)&&(RR(r,e,i),q_(r,e.p,e.q,i.triangle,e.q))}function q_(r,e,i,s,h){if(!xT(s,e,i)){var x=s.pointCCW(h),m=vs(i,x,e);if(m===Yn.COLLINEAR)throw new xm("poly2tri EdgeEvent: Collinear not supported!",[i,x,e]);var o=s.pointCW(h),P=vs(i,o,e);if(P===Yn.COLLINEAR)throw new xm("poly2tri EdgeEvent: Collinear not supported!",[i,o,e]);m===P?(m===Yn.CW?s=s.neighborCCW(h):s=s.neighborCW(h),q_(r,e,i,s,h)):Y_(r,e,i,s,h)}}function xT(r,e,i){var s=r.edgeIndex(e,i);if(s!==-1){r.markConstrainedEdgeByIndex(s);var h=r.getNeighbor(s);return h&&h.markConstrainedEdgeByPoints(e,i),!0}return!1}function MR(r,e,i){var s=new _T(e,i.point,i.next.point);s.markNeighbor(i.triangle),r.addToMap(s);var h=new xR(e);return h.next=i.next,h.prev=i,i.next.prev=h,i.next=h,Cu(r,s)||r.mapTriangleToNodes(s),h}function xh(r,e){var i=new _T(e.prev.point,e.point,e.next.point);i.markNeighbor(e.prev.triangle),i.markNeighbor(e.triangle),r.addToMap(i),e.prev.next=e.next,e.next.prev=e.prev,Cu(r,i)||r.mapTriangleToNodes(i)}function PR(r,e){for(var i=e.next;i.next&&!f1(i.point,i.next.point,i.prev.point);)xh(r,i),i=i.next;for(i=e.prev;i.prev&&!f1(i.point,i.next.point,i.prev.point);)xh(r,i),i=i.prev;e.next&&e.next.next&&kR(e)&&AR(r,e)}function kR(r){var e=r.point.x-r.next.next.point.x,i=r.point.y-r.next.next.point.y;return V_(i>=0,"unordered y"),e>=0||Math.abs(e)<i}function Cu(r,e){for(var i=0;i<3;++i)if(!e.delaunay_edge[i]){var s=e.getNeighbor(i);if(s){var h=e.getPoint(i),x=s.oppositePoint(e,h),m=s.index(x);if(s.constrained_edge[m]||s.delaunay_edge[m]){e.constrained_edge[i]=s.constrained_edge[m];continue}var o=CR(h,e.pointCCW(h),e.pointCW(h),x);if(o){e.delaunay_edge[i]=!0,s.delaunay_edge[m]=!0,bT(e,h,s,x);var P=!Cu(r,e);return P&&r.mapTriangleToNodes(e),P=!Cu(r,s),P&&r.mapTriangleToNodes(s),e.delaunay_edge[i]=!1,s.delaunay_edge[m]=!1,!0}}}return!1}function CR(r,e,i,s){var h=r.x-s.x,x=r.y-s.y,m=e.x-s.x,o=e.y-s.y,P=h*o,L=m*x,D=P-L;if(D<=0)return!1;var F=i.x-s.x,Y=i.y-s.y,V=F*x,H=h*Y,ve=V-H;if(ve<=0)return!1;var _e=m*Y,oe=F*o,fe=h*h+x*x,K=m*m+o*o,ne=F*F+Y*Y,ye=fe*(_e-oe)+K*ve+ne*D;return ye>0}function bT(r,e,i,s){var h,x,m,o;h=r.neighborCCW(e),x=r.neighborCW(e),m=i.neighborCCW(s),o=i.neighborCW(s);var P,L,D,F;P=r.getConstrainedEdgeCCW(e),L=r.getConstrainedEdgeCW(e),D=i.getConstrainedEdgeCCW(s),F=i.getConstrainedEdgeCW(s);var Y,V,H,ve;Y=r.getDelaunayEdgeCCW(e),V=r.getDelaunayEdgeCW(e),H=i.getDelaunayEdgeCCW(s),ve=i.getDelaunayEdgeCW(s),r.legalize(e,s),i.legalize(s,e),i.setDelaunayEdgeCCW(e,Y),r.setDelaunayEdgeCW(e,V),r.setDelaunayEdgeCCW(s,H),i.setDelaunayEdgeCW(s,ve),i.setConstrainedEdgeCCW(e,P),r.setConstrainedEdgeCW(e,L),r.setConstrainedEdgeCCW(s,D),i.setConstrainedEdgeCW(s,F),r.clearNeighbors(),i.clearNeighbors(),h&&i.markNeighbor(h),x&&r.markNeighbor(x),m&&r.markNeighbor(m),o&&i.markNeighbor(o),r.markNeighbor(i)}function AR(r,e){for(vs(e.point,e.next.point,e.next.next.point)===Yn.CCW?r.basin.left_node=e.next.next:r.basin.left_node=e.next,r.basin.bottom_node=r.basin.left_node;r.basin.bottom_node.next&&r.basin.bottom_node.point.y>=r.basin.bottom_node.next.point.y;)r.basin.bottom_node=r.basin.bottom_node.next;if(r.basin.bottom_node!==r.basin.left_node){for(r.basin.right_node=r.basin.bottom_node;r.basin.right_node.next&&r.basin.right_node.point.y<r.basin.right_node.next.point.y;)r.basin.right_node=r.basin.right_node.next;r.basin.right_node!==r.basin.bottom_node&&(r.basin.width=r.basin.right_node.point.x-r.basin.left_node.point.x,r.basin.left_highest=r.basin.left_node.point.y>r.basin.right_node.point.y,wT(r,r.basin.bottom_node))}}function wT(r,e){if(!LR(r,e)){xh(r,e);var i;if(!(e.prev===r.basin.left_node&&e.next===r.basin.right_node)){if(e.prev===r.basin.left_node){if(i=vs(e.point,e.next.point,e.next.next.point),i===Yn.CW)return;e=e.next}else if(e.next===r.basin.right_node){if(i=vs(e.point,e.prev.point,e.prev.prev.point),i===Yn.CCW)return;e=e.prev}else e.prev.point.y<e.next.point.y?e=e.prev:e=e.next;wT(r,e)}}}function LR(r,e){var i;return r.basin.left_highest?i=r.basin.left_node.point.y-e.point.y:i=r.basin.right_node.point.y-e.point.y,r.basin.width>i}function RR(r,e,i){r.edge_event.right?NR(r,e,i):OR(r,e,i)}function NR(r,e,i){for(;i.next.point.x<e.p.x;)vs(e.q,i.next.point,e.p)===Yn.CCW?TT(r,e,i):i=i.next}function TT(r,e,i){i.point.x<e.p.x&&(vs(i.point,i.next.point,i.next.next.point)===Yn.CCW?Z_(r,e,i):(ET(r,e,i),TT(r,e,i)))}function Z_(r,e,i){xh(r,i.next),i.next.point!==e.p&&vs(e.q,i.next.point,e.p)===Yn.CCW&&vs(i.point,i.next.point,i.next.next.point)===Yn.CCW&&Z_(r,e,i)}function ET(r,e,i){vs(i.next.point,i.next.next.point,i.next.next.next.point)===Yn.CCW?Z_(r,e,i.next):vs(e.q,i.next.next.point,e.p)===Yn.CCW&&ET(r,e,i.next)}function OR(r,e,i){for(;i.prev.point.x>e.p.x;)vs(e.q,i.prev.point,e.p)===Yn.CW?IT(r,e,i):i=i.prev}function IT(r,e,i){i.point.x>e.p.x&&(vs(i.point,i.prev.point,i.prev.prev.point)===Yn.CW?W_(r,e,i):(ST(r,e,i),IT(r,e,i)))}function ST(r,e,i){vs(i.prev.point,i.prev.prev.point,i.prev.prev.prev.point)===Yn.CW?W_(r,e,i.prev):vs(e.q,i.prev.prev.point,e.p)===Yn.CW&&ST(r,e,i.prev)}function W_(r,e,i){xh(r,i.prev),i.prev.point!==e.p&&vs(e.q,i.prev.point,e.p)===Yn.CW&&vs(i.point,i.prev.point,i.prev.prev.point)===Yn.CW&&W_(r,e,i)}function Y_(r,e,i,s,h){var x=s.neighborAcross(h);V_(x,"FLIP failed due to missing triangle!");var m=x.oppositePoint(s,h);if(s.getConstrainedEdgeAcross(h)){var o=s.index(h);throw new xm("poly2tri Intersecting Constraints",[h,m,s.getPoint((o+1)%3),s.getPoint((o+2)%3)])}if(vT(h,s.pointCCW(h),s.pointCW(h),m))if(bT(s,h,x,m),r.mapTriangleToNodes(s),r.mapTriangleToNodes(x),h===i&&m===e)i===r.edge_event.constrained_edge.q&&e===r.edge_event.constrained_edge.p&&(s.markConstrainedEdgeByPoints(e,i),x.markConstrainedEdgeByPoints(e,i),Cu(r,s),Cu(r,x));else{var P=vs(i,m,e);s=DR(r,P,s,x,h,m),Y_(r,e,i,s,h)}else{var L=MT(e,i,x,m);PT(r,e,i,s,x,L),q_(r,e,i,s,h)}}function DR(r,e,i,s,h,x){var m;return e===Yn.CCW?(m=s.edgeIndex(h,x),s.delaunay_edge[m]=!0,Cu(r,s),s.clearDelaunayEdges(),i):(m=i.edgeIndex(h,x),i.delaunay_edge[m]=!0,Cu(r,i),i.clearDelaunayEdges(),s)}function MT(r,e,i,s){var h=vs(e,s,r);if(h===Yn.CW)return i.pointCCW(s);if(h===Yn.CCW)return i.pointCW(s);throw new xm("poly2tri [Unsupported] nextFlipPoint: opposing point on constrained edge!",[e,s,r])}function PT(r,e,i,s,h,x){var m=h.neighborAcross(x);V_(m,"FLIP failed due to missing triangle");var o=m.oppositePoint(h,x);if(vT(i,s.pointCCW(i),s.pointCW(i),o))Y_(r,i,o,m,o);else{var P=MT(e,i,m,o);PT(r,e,i,s,m,P)}}G_.triangulate=wR;var FR=$_,bd=gT,zR=j_,BR=G_,kT=yT,dy=kT.Node,m1=.3,$R=function(r,e){if(this.p=r,this.q=e,r.y>e.y)this.q=r,this.p=e;else if(r.y===e.y){if(r.x>e.x)this.q=r,this.p=e;else if(r.x===e.x)throw new FR("poly2tri Invalid Edge constructor: repeated points!",[r])}this.q._p2t_edge_list||(this.q._p2t_edge_list=[]),this.q._p2t_edge_list.push(this)},CT=function(){this.left_node=null,this.bottom_node=null,this.right_node=null,this.width=0,this.left_highest=!1};CT.prototype.clear=function(){this.left_node=null,this.bottom_node=null,this.right_node=null,this.width=0,this.left_highest=!1};var jR=function(){this.constrained_edge=null,this.right=!1},$r=function(r,e){e=e||{},this.triangles_=[],this.map_=[],this.points_=e.cloneArrays?r.slice(0):r,this.edge_list=[],this.pmin_=this.pmax_=null,this.front_=null,this.head_=null,this.tail_=null,this.af_head_=null,this.af_middle_=null,this.af_tail_=null,this.basin=new CT,this.edge_event=new jR,this.initEdges(this.points_)};$r.prototype.addHole=function(r){this.initEdges(r);var e,i=r.length;for(e=0;e<i;e++)this.points_.push(r[e]);return this};$r.prototype.AddHole=$r.prototype.addHole;$r.prototype.addHoles=function(r){var e,i=r.length;for(e=0;e<i;e++)this.initEdges(r[e]);return this.points_=this.points_.concat.apply(this.points_,r),this};$r.prototype.addPoint=function(r){return this.points_.push(r),this};$r.prototype.AddPoint=$r.prototype.addPoint;$r.prototype.addPoints=function(r){return this.points_=this.points_.concat(r),this};$r.prototype.triangulate=function(){return BR.triangulate(this),this};$r.prototype.getBoundingBox=function(){return{min:this.pmin_,max:this.pmax_}};$r.prototype.getTriangles=function(){return this.triangles_};$r.prototype.GetTriangles=$r.prototype.getTriangles;$r.prototype.front=function(){return this.front_};$r.prototype.pointCount=function(){return this.points_.length};$r.prototype.head=function(){return this.head_};$r.prototype.setHead=function(r){this.head_=r};$r.prototype.tail=function(){return this.tail_};$r.prototype.setTail=function(r){this.tail_=r};$r.prototype.getMap=function(){return this.map_};$r.prototype.initTriangulation=function(){var r=this.points_[0].x,e=this.points_[0].x,i=this.points_[0].y,s=this.points_[0].y,h,x=this.points_.length;for(h=1;h<x;h++){var m=this.points_[h];m.x>r&&(r=m.x),m.x<e&&(e=m.x),m.y>i&&(i=m.y),m.y<s&&(s=m.y)}this.pmin_=new bd(e,s),this.pmax_=new bd(r,i);var o=m1*(r-e),P=m1*(i-s);this.head_=new bd(r+o,s-P),this.tail_=new bd(e-o,s-P),this.points_.sort(bd.compare)};$r.prototype.initEdges=function(r){var e,i=r.length;for(e=0;e<i;++e)this.edge_list.push(new $R(r[e],r[(e+1)%i]))};$r.prototype.getPoint=function(r){return this.points_[r]};$r.prototype.addToMap=function(r){this.map_.push(r)};$r.prototype.locateNode=function(r){return this.front_.locateNode(r.x)};$r.prototype.createAdvancingFront=function(){var r,e,i,s=new zR(this.points_[0],this.tail_,this.head_);this.map_.push(s),r=new dy(s.getPoint(1),s),e=new dy(s.getPoint(0),s),i=new dy(s.getPoint(2)),this.front_=new kT(r,i),r.next=e,e.next=i,e.prev=r,i.prev=e};$r.prototype.removeNode=function(r){};$r.prototype.mapTriangleToNodes=function(r){for(var e=0;e<3;++e)if(!r.getNeighbor(e)){var i=this.front_.locatePoint(r.pointCW(r.getPoint(e)));i&&(i.triangle=r)}};$r.prototype.removeFromMap=function(r){var e,i=this.map_,s=i.length;for(e=0;e<s;e++)if(i[e]===r){i.splice(e,1);break}};$r.prototype.meshClean=function(r){for(var e=[r],i,s;i=e.pop();)if(!i.isInterior())for(i.setInterior(!0),this.triangles_.push(i),s=0;s<3;s++)i.constrained_edge[s]||e.push(i.getNeighbor(s))};var GR=$r;(function(r){var e=globalThis.poly2tri;r.noConflict=function(){return globalThis.poly2tri=e,r},r.VERSION=lR.version,r.PointError=$_,r.Point=gT,r.Triangle=j_,r.SweepContext=GR;var i=G_;r.triangulate=i.triangulate,r.sweep={Triangulate:i.triangulate}})(fT);function UR(r,e){let i=0;const s=new fT.SweepContext(GL(r,e).map(h=>({x:h[0],y:h[1],type:"p",item:i++})));s.addPoints(UL(r,e).filter(h=>oR(r,h)===-1).map(h=>({x:h[0],y:h[1],type:"g",item:i++})));try{s.triangulate()}catch{throw new Error("A Point Error occured during resource mask triangulation. This is typically because the resource mask contains duplicate or collinear points, or is self-intersecting.")}return s.getTriangles()}function VR(r,e){const i=UR(r,e).map(h=>h.getPoints().map(x=>x)),s=[...new Map(i.flat().map(h=>[h.item,h])).values()].sort((h,x)=>h.item-x.item).map(h=>[h.x,h.y]);return{uniquePointsIndexTriangles:i.map(h=>h.map(x=>x.item)),uniquePoints:s}}const qR=80,ZR=10;function WR(){return{}}class YR extends FL{resourceTrianglePoints=[];resourceUniquePoints=[];trianglePointsUniquePointsIndex=[];triangulationByBestScaleFactor=new Map;triangulateErrorCount=0;projectedGeoPreviousTrianglePoints=[];projectedGeoTrianglePoints=[];projectedGeoUniquePoints=[];projectedGeoUniquePointsByBestScaleFactorAndTransformationType=new Map;projectedGeoUniquePointsPartialDerivativeX=[];projectedGeoUniquePointsPartialDerivativeY=[];projectedGeoUniquePointsPartialDerivativeXByBestScaleFactorAndTransformationType=new Map;projectedGeoUniquePointsPartialDerivativeYByBestScaleFactorAndTransformationType=new Map;previousTrianglePointsDistortion=[];trianglePointsDistortion=[];uniquePointsDistortion=[];constructor(e,i,s){s={...WR(),...s},super(e,i,s)}setResourceMask(e){super.setResourceMask(e),this.triangulationByBestScaleFactor=new Map,this.projectedGeoUniquePointsByBestScaleFactorAndTransformationType=new Map,this.projectedGeoUniquePointsPartialDerivativeXByBestScaleFactorAndTransformationType=new Map,this.projectedGeoUniquePointsPartialDerivativeYByBestScaleFactorAndTransformationType=new Map,this.updateTriangulation()}setBestScaleFactor(e){const i=super.setBestScaleFactor(e);return i&&this.updateTriangulation(!0),i}updateTriangulation(e=!1){const{trianglePointsUniquePointsIndex:i,resourceUniquePoints:s}=jf(this.triangulationByBestScaleFactor,this.bestScaleFactor,()=>{const h=Ek(this.resourceMask)*this.bestScaleFactor/qR;try{const{uniquePointsIndexTriangles:x,uniquePoints:m}=VR(this.resourceMask,h);return{trianglePointsUniquePointsIndex:x.flat(),resourceUniquePoints:m}}catch(x){return this.triangulateErrorCount++,this.triangulateErrorCount<=ZR&&(console.error(`Error computing triangulation for map ${this.mapId}.`,`Fix this map with Allmaps Editor: https://editor.allmaps.org/#/collection?url=${this.parsedImage?.uri}/info.json`),this.triangulateErrorCount===1&&console.error(x)),{trianglePointsUniquePointsIndex:this.trianglePointsUniquePointsIndex,resourceUniquePoints:this.resourceUniquePoints}}});this.resourceTrianglePoints=i.map(h=>s[h]),this.resourceUniquePoints=s,this.trianglePointsUniquePointsIndex=i,this.updateProjectedGeoTrianglePoints(e)}updateProjectedGeoTrianglePoints(e=!1){this.projectedGeoUniquePoints=sy(this.projectedGeoUniquePointsByBestScaleFactorAndTransformationType,this.bestScaleFactor,this.transformationType,()=>this.resourceUniquePoints.map(i=>this.projectedTransformer.transformToGeo(i))),this.projectedGeoTrianglePoints=this.trianglePointsUniquePointsIndex.map(i=>this.projectedGeoUniquePoints[i]),(e||!this.projectedGeoPreviousTrianglePoints.length)&&(this.projectedGeoPreviousTrianglePoints=this.projectedGeoTrianglePoints),this.updateTrianglePointsDistortion(e)}updateTrianglePointsDistortion(e=!1){this.distortionMeasure&&(this.projectedGeoUniquePointsPartialDerivativeX=sy(this.projectedGeoUniquePointsPartialDerivativeXByBestScaleFactorAndTransformationType,this.bestScaleFactor,this.transformationType,()=>this.resourceUniquePoints.map(i=>this.projectedTransformer.transformToGeo(i,{evaluationType:"partialDerivativeX"}))),this.projectedGeoUniquePointsPartialDerivativeY=sy(this.projectedGeoUniquePointsPartialDerivativeYByBestScaleFactorAndTransformationType,this.bestScaleFactor,this.transformationType,()=>this.resourceUniquePoints.map(i=>this.projectedTransformer.transformToGeo(i,{evaluationType:"partialDerivativeY"})))),this.uniquePointsDistortion=this.projectedGeoUniquePoints.map((i,s)=>OL(this.projectedGeoUniquePointsPartialDerivativeX[s],this.projectedGeoUniquePointsPartialDerivativeY[s],this.distortionMeasure,this.getReferenceScale())),this.trianglePointsDistortion=this.trianglePointsUniquePointsIndex.map(i=>this.uniquePointsDistortion[i]),(e||!this.previousTrianglePointsDistortion.length)&&(this.previousTrianglePointsDistortion=this.trianglePointsDistortion)}resetTrianglePoints(){this.projectedGeoPreviousTrianglePoints=this.projectedGeoTrianglePoints,this.previousTrianglePointsDistortion=this.trianglePointsDistortion}mixTrianglePoints(e){this.projectedGeoPreviousTrianglePoints=this.projectedGeoTrianglePoints.map((i,s)=>hk(i,this.projectedGeoPreviousTrianglePoints[s],e)),this.previousTrianglePointsDistortion=this.trianglePointsDistortion.map((i,s)=>ck(i,this.previousTrianglePointsDistortion[s],e))}}function XR(r){let e=0,i=0;for(const m of r)e+=m.w*m.h,i=Math.max(i,m.w);r.sort((m,o)=>o.h-m.h);const s=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(e/.95)),i),h:1/0}];let h=0,x=0;for(const m of r)for(let o=s.length-1;o>=0;o--){const P=s[o];if(!(m.w>P.w||m.h>P.h)){if(m.x=P.x,m.y=P.y,x=Math.max(x,m.y+m.h),h=Math.max(h,m.x+m.w),m.w===P.w&&m.h===P.h){const L=s.pop();o<s.length&&(s[o]=L)}else m.h===P.h?(P.x+=m.w,P.w-=m.w):m.w===P.w?(P.y+=m.h,P.h-=m.h):(s.push({x:P.x+m.w,y:P.y,w:P.w-m.w,h:m.h}),P.y+=m.h,P.h-=m.h);break}}return{w:h,h:x,fill:e/(h*x)||0}}var HR=typeof globalThis=="object"&&globalThis&&globalThis.Object===Object&&globalThis,KR=typeof self=="object"&&self&&self.Object===Object&&self,AT=HR||KR||Function("return this")(),bm=AT.Symbol,LT=Object.prototype,JR=LT.hasOwnProperty,QR=LT.toString,wd=bm?bm.toStringTag:void 0;function eN(r){var e=JR.call(r,wd),i=r[wd];try{r[wd]=void 0;var s=!0}catch{}var h=QR.call(r);return s&&(e?r[wd]=i:delete r[wd]),h}var tN=Object.prototype,iN=tN.toString;function rN(r){return iN.call(r)}var nN="[object Null]",sN="[object Undefined]",g1=bm?bm.toStringTag:void 0;function oN(r){return r==null?r===void 0?sN:nN:g1&&g1 in Object(r)?eN(r):rN(r)}function aN(r){return r!=null&&typeof r=="object"}var lN="[object Symbol]";function uN(r){return typeof r=="symbol"||aN(r)&&oN(r)==lN}var cN=/\s/;function hN(r){for(var e=r.length;e--&&cN.test(r.charAt(e)););return e}var dN=/^\s+/;function pN(r){return r&&r.slice(0,hN(r)+1).replace(dN,"")}function wm(r){var e=typeof r;return r!=null&&(e=="object"||e=="function")}var y1=NaN,fN=/^[-+]0x[0-9a-f]+$/i,mN=/^0b[01]+$/i,gN=/^0o[0-7]+$/i,yN=parseInt;function _1(r){if(typeof r=="number")return r;if(uN(r))return y1;if(wm(r)){var e=typeof r.valueOf=="function"?r.valueOf():r;r=wm(e)?e+"":e}if(typeof r!="string")return r===0?r:+r;r=pN(r);var i=mN.test(r);return i||gN.test(r)?yN(r.slice(2),i?2:8):fN.test(r)?y1:+r}var py=function(){return AT.Date.now()},_N="Expected a function",vN=Math.max,xN=Math.min;function bN(r,e,i){var s,h,x,m,o,P,L=0,D=!1,F=!1,Y=!0;if(typeof r!="function")throw new TypeError(_N);e=_1(e)||0,wm(i)&&(D=!!i.leading,F="maxWait"in i,x=F?vN(_1(i.maxWait)||0,e):x,Y="trailing"in i?!!i.trailing:Y);function V(Re){var Se=s,Z=h;return s=h=void 0,L=Re,m=r.apply(Z,Se),m}function H(Re){return L=Re,o=setTimeout(oe,e),D?V(Re):m}function ve(Re){var Se=Re-P,Z=Re-L,$=e-Se;return F?xN($,x-Z):$}function _e(Re){var Se=Re-P,Z=Re-L;return P===void 0||Se>=e||Se<0||F&&Z>=x}function oe(){var Re=py();if(_e(Re))return fe(Re);o=setTimeout(oe,ve(Re))}function fe(Re){return o=void 0,Y&&s?V(Re):(s=h=void 0,m)}function K(){o!==void 0&&clearTimeout(o),L=0,s=P=h=o=void 0}function ne(){return o===void 0?m:fe(py())}function ye(){var Re=py(),Se=_e(Re);if(s=arguments,h=this,P=Re,Se){if(o===void 0)return H(P);if(F)return clearTimeout(o),o=setTimeout(oe,e),V(P)}return o===void 0&&(o=setTimeout(oe,e)),m}return ye.cancel=K,ye.flush=ne,ye}var wN="Expected a function";function Jy(r,e,i){var s=!0,h=!0;if(typeof r!="function")throw new TypeError(wN);return wm(i)&&(s="leading"in i?!!i.leading:s,h="trailing"in i?!!i.trailing:h),bN(r,e,{leading:s,maxWait:e,trailing:h})}const TN=.5;function RT(r,e){return`${r}:${e}`}function NT(r){return RT(r.mapId,r.tileUrl)}function fy(r){return new Set(r.map(e=>NT(e)))}function EN(r,e,i=TN){let s=Number.POSITIVE_INFINITY,h=r.tileZoomLevels.at(-1);for(const x of r.tileZoomLevels){const m=Math.abs(Math.log(x.scaleFactor)-Math.log(e+i));m<s&&(s=m,h=x)}return h}function IN(r,e,i){const s=SN(r,e),h=MN(s),x=kN(h,i,e),m=mh(Xs(r));return x.sort((o,P)=>v1(o,m)-v1(P,m)),x}function SN(r,e){return r.map(i=>[i[0]/e.originalWidth,i[1]/e.originalHeight])}function MN(r){const e={};for(let i=0;i<r.length;i++){const s=[r[i],r[(i+1)%r.length]];PN(s).forEach(([h,x])=>{e[h]||(e[h]=[Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY]),x<e[h][0]&&(e[h][0]=x),x>e[h][1]&&(e[h][1]=x)})}return e}function PN([r,e]){let i=Math.floor(r[0]),s=Math.floor(r[1]);const h=Math.floor(e[0]),x=Math.floor(e[1]),m=[[i,s]];if(i===h&&s===x)return m;const o=Math.sign(e[0]-r[0]),P=Math.sign(e[1]-r[1]),L=Math.abs(r[0]-i-Math.max(0,o)),D=Math.abs(r[1]-s-Math.max(0,P)),F=Math.abs(r[0]-e[0]),Y=Math.abs(r[1]-e[1]);let V=L/F,H=D/Y;const ve=1/F,_e=1/Y;for(;!(i===h&&s===x);)V<H?(V=V+ve,i=i+o):(H=H+_e,s=s+P),m.push([i,s]);return m}function kN(r,e,i){const s=[];for(const h in r){const x=parseInt(h);if(x<0||x>=i.columns)break;const m=Math.max(r[x][0],0),o=Math.min(r[x][1],i.rows-1);for(let P=m;P<=o;P++)s.push({column:x,row:P,tileZoomLevel:i,imageSize:[e.width,e.height]})}return s}function CN(r){return(r.imageRequest.size?.height||0)*(r.imageRequest.size?.width||0)*3}function v1(r,e){return Uo(AN(r),e)}function AN(r){const e=OT(r);return[(e[2]-e[0])/2+e[0],(e[3]-e[1])/2+e[1]]}function LN(r){const e=r.column*r.tileZoomLevel.originalWidth,i=r.row*r.tileZoomLevel.originalHeight;return[e,i]}function OT(r){const e=LN(r),i=Math.min(e[0]+r.tileZoomLevel.originalWidth,r.imageSize[0]),s=Math.min(e[1]+r.tileZoomLevel.originalHeight,r.imageSize[1]);return[e[0],e[1],i,s]}function x1(r,e,i){const s=r.createShader(e);if(s){if(r.shaderSource(s,i),r.compileShader(s),r.getShaderParameter(s,r.COMPILE_STATUS))return s;{const h=r.getShaderInfoLog(s);throw r.deleteShader(s),new Error("Failed to compile shader: "+h)}}else throw new Error("Failed to create shader")}function RN(r,e,i){const s=r.createProgram();if(s){if(r.attachShader(s,e),r.attachShader(s,i),r.linkProgram(s),r.getProgramParameter(s,r.LINK_STATUS))return s;{const h=r.getProgramInfoLog(s);throw r.deleteProgram(s),new Error("Failed to link program: "+h)}}else throw new Error("Failed to create program")}function ih(r,e,i,s,h){const x=r.createBuffer();r.bindBuffer(r.ARRAY_BUFFER,x),r.bufferData(r.ARRAY_BUFFER,i,r.STATIC_DRAW);const m=r.FLOAT,o=!1,P=0,L=0,D=r.getAttribLocation(e,h);r.vertexAttribPointer(D,s,m,o,P,L),r.enableVertexAttribArray(D)}const NN=100,ON={leading:!0,trailing:!0},DN=1,FN=1;function zN(r,e){return(i,s,h)=>new BN(i,s,r,e,h)}let BN=class extends YR{gl;program;vao;CachedTilesByTileUrl=new Map;opacity=DN;saturation=FN;renderOptions={};packedTilesTexture;packedTilesPositionsTexture;packedTilesResourcePositionsAndDimensionsTexture;packedTilesScaleFactorsTexture;projectedGeoToClipTransform;throttledUpdateTextures;constructor(r,e,i,s,h){super(r,e,h),this.gl=i,this.program=s,this.vao=i.createVertexArray(),this.packedTilesTexture=i.createTexture(),this.packedTilesScaleFactorsTexture=i.createTexture(),this.packedTilesPositionsTexture=i.createTexture(),this.packedTilesResourcePositionsAndDimensionsTexture=i.createTexture(),this.throttledUpdateTextures=Jy(this.updateTextures.bind(this),NN,ON)}updateVertexBuffers(r){this.projectedGeoToClipTransform=r,this.updateVertexBuffersInternal()}addCachedTileAndUpdateTextures(r){this.CachedTilesByTileUrl.set(r.tileUrl,r),this.throttledUpdateTextures()}removeCachedTileAndUpdateTextures(r){this.CachedTilesByTileUrl.delete(r),this.throttledUpdateTextures()}dispose(){this.gl.deleteVertexArray(this.vao),this.gl.deleteTexture(this.packedTilesTexture),this.gl.deleteTexture(this.packedTilesScaleFactorsTexture),this.gl.deleteTexture(this.packedTilesPositionsTexture),this.gl.deleteTexture(this.packedTilesResourcePositionsAndDimensionsTexture)}updateVertexBuffersInternal(){if(!this.vao||!this.projectedGeoToClipTransform)return;this.gl.bindVertexArray(this.vao);const r=this.resourceTrianglePoints;ih(this.gl,this.program,new Float32Array(r.flat()),2,"a_resourceTrianglePoint");const e=this.projectedGeoPreviousTrianglePoints.map(m=>ch(this.projectedGeoToClipTransform,m));ih(this.gl,this.program,new Float32Array(e.flat()),2,"a_clipPreviousTrianglePoint");const i=this.projectedGeoTrianglePoints.map(m=>ch(this.projectedGeoToClipTransform,m));ih(this.gl,this.program,new Float32Array(i.flat()),2,"a_clipTrianglePoint");const s=this.previousTrianglePointsDistortion;ih(this.gl,this.program,new Float32Array(s),1,"a_previousTrianglePointDistortion");const h=this.trianglePointsDistortion;ih(this.gl,this.program,new Float32Array(h),1,"a_trianglePointDistortion");const x=new Float32Array(this.resourceTrianglePoints.length).map((m,o)=>Math.round((o-1)/3));ih(this.gl,this.program,x,1,"a_triangleIndex")}async updateTextures(){const r=this.gl;if(this.CachedTilesByTileUrl.size===0)return;let e=[...this.CachedTilesByTileUrl.values()];e=e.filter(L=>this.resourceViewportRingBbox?wk(OT(L.tile),this.resourceViewportRingBbox):!0);const i=e.length,s=e.map((L,D)=>({w:L.data.width,h:L.data.height,x:0,y:0,index:D})),{w:h,h:x}=XR(s);r.pixelStorei(r.UNPACK_ALIGNMENT,4),r.bindTexture(r.TEXTURE_2D,this.packedTilesTexture),r.texImage2D(r.TEXTURE_2D,0,r.RGBA,h,x,0,r.RGBA,r.UNSIGNED_BYTE,null);for(const L of s){const D=e[L.index].data;r.texSubImage2D(r.TEXTURE_2D,0,L.x,L.y,D.width,D.height,r.RGBA,r.UNSIGNED_BYTE,D)}r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MIN_FILTER,r.LINEAR),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MAG_FILTER,r.LINEAR),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_S,r.CLAMP_TO_EDGE),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_T,r.CLAMP_TO_EDGE);const m=s.map(L=>[L.x,L.y]);r.bindTexture(r.TEXTURE_2D,this.packedTilesPositionsTexture),r.texImage2D(r.TEXTURE_2D,0,r.RG32I,1,i,0,r.RG_INTEGER,r.INT,new Int32Array(m.flat())),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MIN_FILTER,r.NEAREST),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MAG_FILTER,r.NEAREST),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_S,r.CLAMP_TO_EDGE),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_T,r.CLAMP_TO_EDGE);const o=s.map(L=>{const D=e[L.index];if(D&&D.imageRequest&&D.imageRequest.region)return[D.imageRequest.region.x,D.imageRequest.region.y,D.imageRequest.region.width,D.imageRequest.region.height]});r.bindTexture(r.TEXTURE_2D,this.packedTilesResourcePositionsAndDimensionsTexture),r.texImage2D(r.TEXTURE_2D,0,r.RGBA32I,1,i,0,r.RGBA_INTEGER,r.INT,new Int32Array(o.flat())),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MIN_FILTER,r.NEAREST),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MAG_FILTER,r.NEAREST),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_S,r.CLAMP_TO_EDGE),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_T,r.CLAMP_TO_EDGE);const P=s.map(({index:L})=>e[L].tile.tileZoomLevel.scaleFactor);r.bindTexture(r.TEXTURE_2D,this.packedTilesScaleFactorsTexture),r.texImage2D(r.TEXTURE_2D,0,r.R32I,1,i,0,r.RED_INTEGER,r.INT,new Int32Array(P)),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MIN_FILTER,r.NEAREST),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MAG_FILTER,r.NEAREST),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_S,r.CLAMP_TO_EDGE),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_T,r.CLAMP_TO_EDGE),this.dispatchEvent(new yr(ci.TEXTURESUPDATED))}};const $N=Ye.string().or(Ye.number()).or(Ye.boolean()),jN=Ye.record(Ye.string(),$N.array()),Au=Ye.tuple([Ye.number(),Ye.number()]),DT=Ye.object({type:Ye.literal("Point"),coordinates:Au}),FT=Au.array().min(3),yp=Ye.enum(["ImageService1","ImageService2","ImageService3"]),GN=Ye.object({id:Ye.string().url(),type:Ye.string(),label:jN.optional()}),Um=GN.extend({partOf:Ye.lazy(()=>Um.array()).optional()}),Vm=Ye.union([Ye.any(),Ye.object({type:Ye.string(),options:Ye.object({}).optional()})]).transform(r=>{if(r&&typeof r=="object"&&"type"in r)return r}),qm=Ye.union([Ye.string().url().array(),Ye.string().url()]),UN=/^<svg\s+width="\d+"\s+height="\d+"\s*>\s*<polygon\s+points="\s*(-?\d+(\.\d+)?,-?\d+(\.\d+)?\s+){2,}-?\d+(\.\d+)?,-?\d+(\.\d+)?\s*"\s*\/>\s*<\/svg>$/,VN=Ye.object({type:Ye.literal("SvgSelector"),value:Ye.string().regex(UN)}),qN=Ye.object({source:Ye.string().url(),service:Ye.array(Ye.object({"@id":Ye.string().url(),type:yp})).length(1),selector:VN}),zT=Ye.object({pixelCoords:Au}),ZN=Ye.object({type:Ye.literal("FeatureCollection"),transformation:Vm.optional(),features:Ye.array(Ye.object({type:Ye.literal("Feature"),properties:zT,geometry:DT}))}),X_=Ye.object({id:Ye.string().optional(),type:Ye.literal("Annotation"),"@context":qm.optional(),motivation:Ye.string().default("georeferencing").optional(),target:qN,body:ZN}),BT=Ye.object({id:Ye.string().optional(),type:Ye.literal("AnnotationPage"),"@context":qm.optional(),items:Ye.array(X_)}),H_=/<polygon\s+points="\s*(-?\d+(\.\d+)?,-?\d+(\.\d+)?\s+){2,}-?\d+(\.\d+)?,-?\d+(\.\d+)?\s*"\s*\/>/,WN=new RegExp(`^<svg\\s+width="\\d+"\\s+height="\\d+"\\s*>\\s*${H_.source}\\s*</svg>$`),YN=new RegExp(`^<svg\\s+height="\\d+"\\s+width="\\d+"\\s*>\\s*${H_.source}\\s*</svg>$`),XN=new RegExp(`^<svg\\s*>\\s*${H_.source}\\s*</svg>$`),HN=Ye.string().regex(XN),KN=Ye.string().regex(WN),JN=Ye.string().regex(YN),QN=Ye.object({type:Ye.literal("SvgSelector"),value:HN.or(KN).or(JN)}),eO=Ye.object({"@id":Ye.string().url(),type:yp,height:Ye.number().positive(),width:Ye.number().positive(),partOf:Um.array().optional()}),tO=Ye.object({id:Ye.string().url(),type:yp,height:Ye.number().positive(),width:Ye.number().positive(),partOf:Um.array().optional()}),iO=Ye.object({type:Ye.literal("SpecificResource"),source:eO.or(tO),selector:QN}),$T=Ye.object({resourceCoords:Au}),rO=Ye.object({type:Ye.literal("FeatureCollection"),transformation:Vm.optional(),features:Ye.array(Ye.object({type:Ye.literal("Feature"),properties:$T,geometry:DT}))}),K_=Ye.object({id:Ye.string().optional(),type:Ye.literal("Annotation"),"@context":qm.optional(),motivation:Ye.string().default("georeferencing").optional(),created:Ye.string().datetime().optional(),modified:Ye.string().datetime().optional(),target:iO,body:rO}),jT=Ye.object({id:Ye.string().optional(),type:Ye.literal("AnnotationPage"),"@context":qm.optional(),items:Ye.array(K_)});X_.or(K_);BT.or(jT);zT.or($T);function GT(r){return Array.isArray(r)}function nO(r){return!!(r&&typeof r=="object"&&"type"in r&&r.type==="AnnotationPage")}function Tm(r){return!!(r&&typeof r=="object"&&"type"in r&&r.type==="GeoreferencedMap")}function b1(r){return!!(r&&typeof r=="object"&&"target"in r&&r.target&&typeof r.target=="object"&&"source"in r.target&&typeof r.target.source=="string")}function Zm(r){return"type"in r&&r.type==="GeoreferencedMap"}function Wm(r){return"source"in r.target&&typeof r.target.source=="object"}function sO(r){return{id:oO(r),...dO(r),type:aO(r),partOf:lO(r)}}function oO(r){if(Wm(r)){const e=r.target.source;return"id"in e?e.id:e["@id"]}else return r.target.service[0]["@id"]}function aO(r){return"service"in r.target?r.target.service[0].type:r.target.source.type}function lO(r){if(Wm(r))return r.target.source.partOf}function uO(r){return"pixelCoords"in r?r.pixelCoords:r.resourceCoords}function cO(r){return r.body.features.map(e=>({resource:uO(e.properties),geo:e.geometry.coordinates}))}function hO(r){if(Wm(r))return{created:r.created,modified:r.modified}}function dO(r){if(Wm(r))return{width:r.target.source.width,height:r.target.source.height};const e=r.target.selector.value,i=/width="(?<width>\d+)"/.exec(e),s=/height="(?<height>\d+)"/.exec(e),h=i?.groups?.width,x=s?.groups?.height;if(!h||!x)throw new Error("Could not parse image dimensions");return{width:parseInt(h),height:parseInt(x)}}function pO(r){const e=r.target.selector.value,i=/points="(?<points>.+)"/.exec(e)?.groups;if(i&&i.points){const s=i.points.trim().split(/\s+/);if(s[0]===s[s.length-1]&&s.splice(-1),s.length>=3)return s.map(h=>{const x=h.split(",");if(x.length===2)return[parseFloat(x[0]),parseFloat(x[1])];throw new Error("Could not parse resource mask")});throw new Error("Could not parse resource mask")}else throw new Error("Could not parse resource mask")}function w1(r){return{"@context":"https://schemas.allmaps.org/map/2/context.json",type:"GeoreferencedMap",id:r.id,...hO(r),resource:sO(r),gcps:cO(r),resourceMask:pO(r),transformation:r.body.transformation}}function Qy(r){if(nO(r)){let e;return"items"in r&&Array.isArray(r.items)&&b1(r.items[0])?e=BT.parse(r):e=jT.parse(r),e.items.map(i=>w1(i))}else{let e;return b1(r)?e=X_.parse(r):e=K_.parse(r),[w1(e)]}}const UT=Ye.object({image:Au,world:Au}),fO=Ye.object({uri:Ye.string().url(),width:Ye.number(),height:Ye.number(),type:yp}),Ym=Ye.object({id:Ye.string().optional(),version:Ye.number().min(1).max(1).default(1),image:fO,gcps:UT.array(),pixelMask:FT,transformation:Vm.optional()}),J_=Ye.array(Ym),VT=Ye.object({resource:Au,geo:Au}),mO=Ye.object({id:Ye.string().url(),width:Ye.number(),height:Ye.number(),type:yp,partOf:Um.array().optional()}),Xm=Ye.object({"@context":Ye.literal("https://schemas.allmaps.org/map/2/context.json").optional(),type:Ye.literal("GeoreferencedMap"),id:Ye.string().optional(),created:Ye.string().datetime().optional(),modified:Ye.string().datetime().optional(),resource:mO,gcps:VT.array(),resourceMask:FT,transformation:Vm.optional()}),Q_=Ye.array(Xm);Ym.or(Xm);J_.or(Q_);UT.or(VT);function gO(r){let e,i,s;return Zm(r)?(e=r.resource.width,i=r.resource.height,s=r.resourceMask):(e=r.image.width,i=r.image.height,s=r.pixelMask),{type:"SvgSelector",value:`<svg width="${e}" height="${i}"><polygon points="${s.map(h=>h.join(",")).join(" ")}" /></svg>`}}function yO(r){let e,i,s,h,x;return Zm(r)?(e=r.resource.id,i=r.resource.type,s=r.resource.width,h=r.resource.height,x=r.resource.partOf):(e=r.image.uri,i=r.image.type,s=r.image.width,h=r.image.height),{id:e,type:i,height:h,width:s,partOf:x}}function _O(r){if(Zm(r))return{created:r.created,modified:r.modified}}function vO(){return["http://iiif.io/api/extension/georef/1/context.json","http://iiif.io/api/presentation/3/context.json"]}function xO(r){let e,i;return"resource"in r?(e=r.resource,i=r.geo):(e=r.image,i=r.world),{type:"Feature",properties:{resourceCoords:e},geometry:{type:"Point",coordinates:i}}}function T1(r){const e={type:"SpecificResource",source:yO(r),selector:gO(r)},i={type:"FeatureCollection",transformation:r.transformation,features:r.gcps.map(s=>xO(s))};return{id:r.id,type:"Annotation","@context":vO(),..._O(r),motivation:"georeferencing",target:e,body:i}}function bO(r){if(GT(r)){let e;return Tm(r[0])?e=Q_.parse(r):e=J_.parse(r),{type:"AnnotationPage","@context":"http://www.w3.org/ns/anno.jsonld",items:e.map(i=>T1(i))}}else{let e;return Tm(r)?e=Xm.parse(r):e=Ym.parse(r),T1(e)}}function qT(r){return Zm(r)?r:Qy(bO(r))[0]}function wO(r){return r.map(qT)}function E1(r){if(GT(r)){let e;return Tm(r[0])?e=Q_.parse(r):e=J_.parse(r),wO(e)}else{let e;return Tm(r)?e=Xm.parse(r):e=Ym.parse(r),qT(e)}}function TO(r,e,i,s,h){ZT(r,e,i||0,s||r.length-1,h||EO)}function ZT(r,e,i,s,h){for(;s>i;){if(s-i>600){var x=s-i+1,m=e-i+1,o=Math.log(x),P=.5*Math.exp(2*o/3),L=.5*Math.sqrt(o*P*(x-P)/x)*(m-x/2<0?-1:1),D=Math.max(i,Math.floor(e-m*P/x+L)),F=Math.min(s,Math.floor(e+(x-m)*P/x+L));ZT(r,e,D,F,h)}var Y=r[e],V=i,H=s;for(Td(r,i,e),h(r[s],Y)>0&&Td(r,i,s);V<H;){for(Td(r,V,H),V++,H--;h(r[V],Y)<0;)V++;for(;h(r[H],Y)>0;)H--}h(r[i],Y)===0?Td(r,i,H):(H++,Td(r,H,s)),H<=e&&(i=H+1),e<=H&&(s=H-1)}}function Td(r,e,i){var s=r[e];r[e]=r[i],r[i]=s}function EO(r,e){return r<e?-1:r>e?1:0}class IO{constructor(e=9){this._maxEntries=Math.max(4,e),this._minEntries=Math.max(2,Math.ceil(this._maxEntries*.4)),this.clear()}all(){return this._all(this.data,[])}search(e){let i=this.data;const s=[];if(!kf(e,i))return s;const h=this.toBBox,x=[];for(;i;){for(let m=0;m<i.children.length;m++){const o=i.children[m],P=i.leaf?h(o):o;kf(e,P)&&(i.leaf?s.push(o):gy(e,P)?this._all(o,s):x.push(o))}i=x.pop()}return s}collides(e){let i=this.data;if(!kf(e,i))return!1;const s=[];for(;i;){for(let h=0;h<i.children.length;h++){const x=i.children[h],m=i.leaf?this.toBBox(x):x;if(kf(e,m)){if(i.leaf||gy(e,m))return!0;s.push(x)}}i=s.pop()}return!1}load(e){if(!(e&&e.length))return this;if(e.length<this._minEntries){for(let s=0;s<e.length;s++)this.insert(e[s]);return this}let i=this._build(e.slice(),0,e.length-1,0);if(!this.data.children.length)this.data=i;else if(this.data.height===i.height)this._splitRoot(this.data,i);else{if(this.data.height<i.height){const s=this.data;this.data=i,i=s}this._insert(i,this.data.height-i.height-1,!0)}return this}insert(e){return e&&this._insert(e,this.data.height-1),this}clear(){return this.data=uh([]),this}remove(e,i){if(!e)return this;let s=this.data;const h=this.toBBox(e),x=[],m=[];let o,P,L;for(;s||x.length;){if(s||(s=x.pop(),P=x[x.length-1],o=m.pop(),L=!0),s.leaf){const D=SO(e,s.children,i);if(D!==-1)return s.children.splice(D,1),x.push(s),this._condense(x),this}!L&&!s.leaf&&gy(s,h)?(x.push(s),m.push(o),o=0,P=s,s=s.children[0]):P?(o++,s=P.children[o],L=!1):s=null}return this}toBBox(e){return e}compareMinX(e,i){return e.minX-i.minX}compareMinY(e,i){return e.minY-i.minY}toJSON(){return this.data}fromJSON(e){return this.data=e,this}_all(e,i){const s=[];for(;e;)e.leaf?i.push(...e.children):s.push(...e.children),e=s.pop();return i}_build(e,i,s,h){const x=s-i+1;let m=this._maxEntries,o;if(x<=m)return o=uh(e.slice(i,s+1)),rh(o,this.toBBox),o;h||(h=Math.ceil(Math.log(x)/Math.log(m)),m=Math.ceil(x/Math.pow(m,h-1))),o=uh([]),o.leaf=!1,o.height=h;const P=Math.ceil(x/m),L=P*Math.ceil(Math.sqrt(m));I1(e,i,s,L,this.compareMinX);for(let D=i;D<=s;D+=L){const F=Math.min(D+L-1,s);I1(e,D,F,P,this.compareMinY);for(let Y=D;Y<=F;Y+=P){const V=Math.min(Y+P-1,F);o.children.push(this._build(e,Y,V,h-1))}}return rh(o,this.toBBox),o}_chooseSubtree(e,i,s,h){for(;h.push(i),!(i.leaf||h.length-1===s);){let x=1/0,m=1/0,o;for(let P=0;P<i.children.length;P++){const L=i.children[P],D=my(L),F=kO(e,L)-D;F<m?(m=F,x=D<x?D:x,o=L):F===m&&D<x&&(x=D,o=L)}i=o||i.children[0]}return i}_insert(e,i,s){const h=s?e:this.toBBox(e),x=[],m=this._chooseSubtree(h,this.data,i,x);for(m.children.push(e),Nd(m,h);i>=0&&x[i].children.length>this._maxEntries;)this._split(x,i),i--;this._adjustParentBBoxes(h,x,i)}_split(e,i){const s=e[i],h=s.children.length,x=this._minEntries;this._chooseSplitAxis(s,x,h);const m=this._chooseSplitIndex(s,x,h),o=uh(s.children.splice(m,s.children.length-m));o.height=s.height,o.leaf=s.leaf,rh(s,this.toBBox),rh(o,this.toBBox),i?e[i-1].children.push(o):this._splitRoot(s,o)}_splitRoot(e,i){this.data=uh([e,i]),this.data.height=e.height+1,this.data.leaf=!1,rh(this.data,this.toBBox)}_chooseSplitIndex(e,i,s){let h,x=1/0,m=1/0;for(let o=i;o<=s-i;o++){const P=Rd(e,0,o,this.toBBox),L=Rd(e,o,s,this.toBBox),D=CO(P,L),F=my(P)+my(L);D<x?(x=D,h=o,m=F<m?F:m):D===x&&F<m&&(m=F,h=o)}return h||s-i}_chooseSplitAxis(e,i,s){const h=e.leaf?this.compareMinX:MO,x=e.leaf?this.compareMinY:PO,m=this._allDistMargin(e,i,s,h),o=this._allDistMargin(e,i,s,x);m<o&&e.children.sort(h)}_allDistMargin(e,i,s,h){e.children.sort(h);const x=this.toBBox,m=Rd(e,0,i,x),o=Rd(e,s-i,s,x);let P=Pf(m)+Pf(o);for(let L=i;L<s-i;L++){const D=e.children[L];Nd(m,e.leaf?x(D):D),P+=Pf(m)}for(let L=s-i-1;L>=i;L--){const D=e.children[L];Nd(o,e.leaf?x(D):D),P+=Pf(o)}return P}_adjustParentBBoxes(e,i,s){for(let h=s;h>=0;h--)Nd(i[h],e)}_condense(e){for(let i=e.length-1,s;i>=0;i--)e[i].children.length===0?i>0?(s=e[i-1].children,s.splice(s.indexOf(e[i]),1)):this.clear():rh(e[i],this.toBBox)}}function SO(r,e,i){if(!i)return e.indexOf(r);for(let s=0;s<e.length;s++)if(i(r,e[s]))return s;return-1}function rh(r,e){Rd(r,0,r.children.length,e,r)}function Rd(r,e,i,s,h){h||(h=uh(null)),h.minX=1/0,h.minY=1/0,h.maxX=-1/0,h.maxY=-1/0;for(let x=e;x<i;x++){const m=r.children[x];Nd(h,r.leaf?s(m):m)}return h}function Nd(r,e){return r.minX=Math.min(r.minX,e.minX),r.minY=Math.min(r.minY,e.minY),r.maxX=Math.max(r.maxX,e.maxX),r.maxY=Math.max(r.maxY,e.maxY),r}function MO(r,e){return r.minX-e.minX}function PO(r,e){return r.minY-e.minY}function my(r){return(r.maxX-r.minX)*(r.maxY-r.minY)}function Pf(r){return r.maxX-r.minX+(r.maxY-r.minY)}function kO(r,e){return(Math.max(e.maxX,r.maxX)-Math.min(e.minX,r.minX))*(Math.max(e.maxY,r.maxY)-Math.min(e.minY,r.minY))}function CO(r,e){const i=Math.max(r.minX,e.minX),s=Math.max(r.minY,e.minY),h=Math.min(r.maxX,e.maxX),x=Math.min(r.maxY,e.maxY);return Math.max(0,h-i)*Math.max(0,x-s)}function gy(r,e){return r.minX<=e.minX&&r.minY<=e.minY&&e.maxX<=r.maxX&&e.maxY<=r.maxY}function kf(r,e){return e.minX<=r.maxX&&e.minY<=r.maxY&&e.maxX>=r.minX&&e.maxY>=r.minY}function uh(r){return{children:r,height:1,leaf:!0,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0}}function I1(r,e,i,s,h){const x=[e,i];for(;x.length;){if(i=x.pop(),e=x.pop(),i-e<=s)continue;const m=e+Math.ceil((i-e)/s/2)*s;TO(r,m,e,i,h),x.push(e,m,m,i)}}function AO(r,e,i){if(i===void 0&&(i={}),!r)throw new Error("point is required");if(!e)throw new Error("polygon is required");var s=vh(r),h=wA(e),x=h.type,m=e.bbox,o=h.coordinates;if(m&&LO(s,m)===!1)return!1;x==="Polygon"&&(o=[o]);for(var P=!1,L=0;L<o.length&&!P;L++)if(S1(s,o[L][0],i.ignoreBoundary)){for(var D=!1,F=1;F<o[L].length&&!D;)S1(s,o[L][F],!i.ignoreBoundary)&&(D=!0),F++;D||(P=!0)}return P}function S1(r,e,i){var s=!1;e[0][0]===e[e.length-1][0]&&e[0][1]===e[e.length-1][1]&&(e=e.slice(0,e.length-1));for(var h=0,x=e.length-1;h<e.length;x=h++){var m=e[h][0],o=e[h][1],P=e[x][0],L=e[x][1],D=r[1]*(m-P)+o*(P-r[0])+L*(r[0]-m)===0&&(m-r[0])*(P-r[0])<=0&&(o-r[1])*(L-r[1])<=0;if(D)return!i;var F=o>r[1]!=L>r[1]&&r[0]<(P-m)*(r[1]-o)/(L-o)+m;F&&(s=!s)}return s}function LO(r,e){return e[0]<=r[0]&&e[1]<=r[1]&&e[2]>=r[0]&&e[3]>=r[1]}const RO=!0;let NO=class{rbush=new IO;polygonsById=new Map;bboxesById=new Map;itemsById=new Map;addItem(r,e){this.removeItem(r);const i=Xs(e),s={minX:i[0],minY:i[1],maxX:i[2],maxY:i[3],id:r};this.polygonsById.set(r,e),this.bboxesById.set(r,i),this.itemsById.set(r,s),this.rbush.insert(s)}removeItem(r){const e=this.itemsById.get(r);e&&(this.rbush.remove(e),this.polygonsById.delete(r),this.bboxesById.delete(r),this.itemsById.delete(r))}clear(){this.polygonsById.clear(),this.bboxesById.clear(),this.itemsById.clear(),this.rbush.clear()}search(r,e,i,s){return this.rbush.search({minX:r,minY:e,maxX:i,maxY:s})}getBbox(r){return this.bboxesById.get(r)}getPolygon(r){return this.polygonsById.get(r)}searchFromBbox(r){const[e,i,s,h]=r;return this.search(e,i,s,h).map(x=>x.id)}searchFromPoint(r,e=RO){const[i,s,h,x]=[r[0],r[1],r[0],r[1]],m=this.search(i,s,h,x);return e?m.filter(o=>{const P=this.polygonsById.get(o.id);return P?AO(r,P):!1}).map(o=>o.id):m.map(o=>o.id)}};function OO(){return{createRTree:!0,imageInformations:new Map}}let DO=class extends EventTarget{warpedMapFactory;warpedMapsById=new Map;zIndices=new Map;rtree;imageInformations;transformation;fetchFn;constructor(r,e){super(),this.warpedMapFactory=r,e={...OO(),...e},this.fetchFn=e?.fetchFn,this.imageInformations=e.imageInformations,this.transformation=e.transformation,e.createRTree&&(this.rtree=new NO)}getMapIds(){return this.warpedMapsById.keys()}getWarpedMaps(r){if(r===void 0)return this.warpedMapsById.values();{const e=[];for(const i of r){const s=this.warpedMapsById.get(i);s&&e.push(s)}return e}}getWarpedMap(r){return this.warpedMapsById.get(r)}getMapZIndex(r){return this.zIndices.get(r)}getCenter(){const r=this.getBbox();if(r)return mh(r)}getProjectedCenter(){const r=this.getProjectedBbox();if(r)return mh(r)}getBbox(){let r;for(const e of this.getWarpedMaps())e.visible&&(r?r=qx(r,e.geoMaskBbox):r=e.geoMaskBbox);return r}getProjectedBbox(){let r;for(const e of this.getWarpedMaps())e.visible&&(r?r=qx(r,e.projectedGeoMaskBbox):r=e.projectedGeoMaskBbox);return r}getMapsByGeoBbox(r){return this.rtree?this.rtree.searchFromBbox(r):Array.from(this.warpedMapsById.keys())}setImageInformations(r){this.imageInformations=r}setMapResourceMask(r,e){const i=this.warpedMapsById.get(r);i&&(i.setResourceMask(e),this.addToOrUpdateRtree(i),this.dispatchEvent(new yr(ci.RESOURCEMASKUPDATED,r)))}setMapsTransformationType(r,e){const i=[];for(const s of r){const h=this.warpedMapsById.get(s);h&&h.transformationType!=e&&(h.setTransformationType(e),this.addToOrUpdateRtree(h),i.push(s))}i.length>0&&this.dispatchEvent(new yr(ci.TRANSFORMATIONCHANGED,i))}setMapsDistortionMeasure(r,e){const i=[];for(const s of r){const h=this.warpedMapsById.get(s);h&&h.distortionMeasure!=e&&(h.setDistortionMeasure(e),i.push(s))}i.length>0&&this.dispatchEvent(new yr(ci.DISTORTIONCHANGED,i))}bringMapsToFront(r){let e=this.warpedMapsById.size;for(const i of r)this.zIndices.has(i)&&(this.zIndices.set(i,e),e++);this.removeZIndexHoles(),this.dispatchEvent(new yr(ci.ZINDICESCHANGES))}sendMapsToBack(r){let e=-Array.from(r).length;for(const i of r)this.zIndices.has(i)&&(this.zIndices.set(i,e),e++);this.removeZIndexHoles(),this.dispatchEvent(new yr(ci.ZINDICESCHANGES))}bringMapsForward(r){for(const[e,i]of this.zIndices.entries())this.zIndices.set(e,i*2);for(const e of r){const i=this.zIndices.get(e);i!==void 0&&this.zIndices.set(e,i+3)}this.removeZIndexHoles(),this.dispatchEvent(new yr(ci.ZINDICESCHANGES))}sendMapsBackward(r){for(const[e,i]of this.zIndices.entries())this.zIndices.set(e,i*2);for(const e of r){const i=this.zIndices.get(e);i!==void 0&&this.zIndices.set(e,i-3)}this.removeZIndexHoles(),this.dispatchEvent(new yr(ci.ZINDICESCHANGES))}showMaps(r){for(const e of r){const i=this.warpedMapsById.get(e);i&&(i.visible=!0)}this.dispatchEvent(new yr(ci.VISIBILITYCHANGED,r))}hideMaps(r){for(const e of r){const i=this.warpedMapsById.get(e);i&&(i.visible=!1)}this.dispatchEvent(new yr(ci.VISIBILITYCHANGED,r))}async addGeoreferencedMap(r){const e=E1(r),i=Array.isArray(e)?e[0]:e;return this.addGeoreferencedMapInternal(i)}async removeGeoreferencedMap(r){const e=E1(r),i=Array.isArray(e)?e[0]:e;return this.removeGeoreferencedMapInternal(i)}async addGeoreferenceAnnotation(r){const e=[],i=Qy(r),s=await Promise.allSettled(i.map(h=>this.addGeoreferencedMapInternal(h)));for(const h of s)h.status==="fulfilled"?e.push(h.value):e.push(h.reason);return this.dispatchEvent(new yr(ci.GEOREFERENCEANNOTATIONADDED)),this.dispatchEvent(new yr(ci.ZINDICESCHANGES)),e}async removeGeoreferenceAnnotation(r){const e=[],i=Qy(r);for(const s of i){const h=await this.removeGeoreferencedMapInternal(s);e.push(h)}return this.dispatchEvent(new yr(ci.GEOREFERENCEANNOTATIONREMOVED)),e}clear(){this.warpedMapsById=new Map,this.zIndices=new Map,this.rtree?.clear(),this.dispatchEvent(new yr(ci.CLEARED))}dispose(){for(const r of this.getWarpedMaps())this.removeEventListenersFromWarpedMap(r),r.dispose()}async addGeoreferencedMapInternal(r){const e=await this.getOrComputeMapId(r),i=this.warpedMapFactory(e,r,{imageInformations:this.imageInformations,fetchFn:this.fetchFn,transformation:this.transformation});return this.warpedMapsById.set(e,i),this.zIndices.set(e,this.warpedMapsById.size-1),this.addToOrUpdateRtree(i),this.addEventListenersToWarpedMap(i),this.dispatchEvent(new yr(ci.WARPEDMAPADDED,e)),e}async removeGeoreferencedMapInternal(r){const e=await this.getOrComputeMapId(r),i=this.warpedMapsById.get(e);if(i)this.warpedMapsById.delete(e),this.zIndices.delete(e),this.removeFromRtree(i),this.dispatchEvent(new yr(ci.WARPEDMAPREMOVED,e)),this.removeZIndexHoles(),this.dispatchEvent(new yr(ci.ZINDICESCHANGES));else throw new Error(`No map found with ID ${e}`);return e}async getOrComputeMapId(r){return r.id||await Fk(r)}addToOrUpdateRtree(r){this.rtree&&(this.rtree.removeItem(r.mapId),this.rtree.addItem(r.mapId,r.geoMask))}removeFromRtree(r){this.rtree&&this.rtree.removeItem(r.mapId)}removeZIndexHoles(){const r=[...this.zIndices.entries()].sort((i,s)=>i[1]-s[1]);let e=0;for(const i of r){const s=i[0];this.zIndices.set(s,e),e++}}imageInfoLoaded(){this.dispatchEvent(new yr(ci.IMAGEINFOLOADED))}addEventListenersToWarpedMap(r){r.addEventListener(ci.IMAGEINFOLOADED,this.imageInfoLoaded.bind(this))}removeEventListenersFromWarpedMap(r){r.removeEventListener(ci.IMAGEINFOLOADED,this.imageInfoLoaded.bind(this))}};class FO extends EventTarget{tile;imageRequest;tileUrl;fetchFn;abortController;data;constructor(e,i){super(),this.tile=e.tile,this.imageRequest=e.imageRequest,this.tileUrl=e.tileUrl,this.fetchFn=i,this.abortController=new AbortController}isCachedTile(){return this.data!==void 0}abort(){this.abortController.signal.aborted||this.abortController.abort()}}class zO{mapId;tile;imageRequest;tileUrl;constructor(e,i){this.mapId=i.mapId,this.tile=e;const s=i.parsedImage.getIiifTile(e.tileZoomLevel,e.column,e.row);this.imageRequest=s,this.tileUrl=i.parsedImage.getImageUrl(s)}}class ev extends FO{async fetch(){try{const e=await(await pw(this.tileUrl,{signal:this.abortController.signal},this.fetchFn)).blob();this.data=await createImageBitmap(e),this.dispatchEvent(new yr(ci.TILEFETCHED,this.tileUrl))}catch(e){e instanceof Error&&e.name==="AbortError"||this.dispatchEvent(new yr(ci.TILEFETCHERROR,this.tileUrl))}return this.data}static createFactory(){return(e,i)=>new ev(e,i)}}const BO=0,$O=32*1e3*1e3;class jO extends EventTarget{cachableTileFactory;fetchFn;tilesByTileUrl=new Map;mapIdsByTileUrl=new Map;tileUrlsByMapId=new Map;tilesFetchingCount=0;previousRequestedTiles=[];outgoingTilesHistory=[];constructor(e,i){super(),this.cachableTileFactory=e,this.fetchFn=i?.fetchFn}getCacheableTile(e){return this.tilesByTileUrl.get(e)}getCachedTile(e){const i=this.tilesByTileUrl.get(e);if(i&&i.isCachedTile())return i}getCacheableTiles(){return this.tilesByTileUrl.values()}getCachedTiles(){const e=[];for(const i of this.tilesByTileUrl.values())i.isCachedTile()&&e.push(i);return e}getCachedTilesForMapId(e){const i=[];for(const s of this.tilesByTileUrl.values())s.isCachedTile()&&this.tileUrlsByMapId.get(e)?.has(s.tileUrl)&&i.push(s);return i}getTileUrls(){return this.tilesByTileUrl.keys()}requestFetchableTiles(e){const i=fy(this.previousRequestedTiles),s=fy(e);if(Sk(i,s))return;const h=[];for(const o of this.previousRequestedTiles)s.has(NT(o))||h.push(o);this.updateOutgoingTilesHistory(h,e.length);const x=fy(this.outgoingTilesHistory),m=new Set([...s,...x]);for(const[o,P]of this.mapIdsByTileUrl)for(const L of P)m.has(RT(L,o))||this.removeMapTile(L,o);for(const o of e)this.addMapTile(o);this.previousRequestedTiles=e}async allRequestedTilesLoaded(){return new Promise(e=>{if(this.finished)e();else{const i=()=>{this.removeEventListener(ci.ALLREQUESTEDTILESLOADED,i),e()};this.addEventListener(ci.ALLREQUESTEDTILESLOADED,i)}})}getTileUrlsForMapId(e){return this.tileUrlsByMapId.get(e)||new Set}clear(){this.tilesByTileUrl=new Map,this.mapIdsByTileUrl=new Map,this.tileUrlsByMapId=new Map,this.tilesFetchingCount=0,this.outgoingTilesHistory=[]}dispose(){for(const e of this.getCacheableTiles())this.removeEventListenersFromTile(e)}addMapTile(e){const i=e.mapId,s=e.tileUrl;if(this.tilesByTileUrl.has(s))this.dispatchEvent(new yr(ci.MAPTILELOADED,{mapId:i,tileUrl:s}));else{const h=this.cachableTileFactory(e,this.fetchFn);this.addEventListenersToTile(h),this.tilesByTileUrl.set(s,h),this.updateTilesFetchingCount(1),h.fetch()}this.addTileUrlForMapId(i,s),this.addMapIdForTileUrl(i,s)}removeMapTile(e,i){const s=this.tilesByTileUrl.get(i);if(!s)return;const h=this.removeMapIdForTileUrl(e,i);this.removeTileUrlForMapId(e,i),h.size||(s.isCachedTile()||(s.abort(),this.updateTilesFetchingCount(-1)),this.tilesByTileUrl.delete(i)),this.dispatchEvent(new yr(ci.MAPTILEREMOVED,{mapId:e,tileUrl:i}))}updateOutgoingTilesHistory(e,i){for(let m=e.length-1;m>=0;m--){const o=e[m];this.outgoingTilesHistory.unshift(o)}this.outgoingTilesHistory=Array.from(new Set(this.outgoingTilesHistory));let s=0,h=0,x=0;for(const m of this.outgoingTilesHistory){if(s+=1,x=CN(m),h+=x,s+i>BO){s-=1,h-=x;break}if(h>$O){s-=1,h-=x;break}}this.outgoingTilesHistory=this.outgoingTilesHistory.slice(0,s)}tileFetched(e){if(e instanceof yr){const i=e.data;this.updateTilesFetchingCount(-1);for(const s of this.mapIdsByTileUrl.get(i)||[])this.dispatchEvent(new yr(ci.MAPTILELOADED,{mapId:s,tileUrl:i})),this.tileUrlsByMapId.get(s)?.values().next().value===i&&this.dispatchEvent(new yr(ci.FIRSTMAPTILELOADED,{mapId:s,tileUrl:i}))}}tileFetchError(e){if(e instanceof yr){const i=e.data;this.tilesByTileUrl.has(i)||this.updateTilesFetchingCount(-1)}}addMapIdForTileUrl(e,i){let s=this.mapIdsByTileUrl.get(i);return s?s.add(e):s=new Set([e]),this.mapIdsByTileUrl.set(i,s),s}removeMapIdForTileUrl(e,i){const s=this.mapIdsByTileUrl.get(i);if(s)s.delete(e);else return new Set;return s.size?this.mapIdsByTileUrl.set(i,s):this.mapIdsByTileUrl.delete(i),s}addTileUrlForMapId(e,i){let s=this.tileUrlsByMapId.get(e);return s?s.add(i):s=new Set([i]),this.tileUrlsByMapId.set(e,s),s}removeTileUrlForMapId(e,i){const s=this.tileUrlsByMapId.get(e);return s?(s.delete(i),s.size?this.tileUrlsByMapId.set(e,s):this.tileUrlsByMapId.delete(e),s):new Set}get finished(){return this.tilesFetchingCount===0}updateTilesFetchingCount(e){this.tilesFetchingCount+=e,this.tilesFetchingCount===0&&this.dispatchEvent(new yr(ci.ALLREQUESTEDTILESLOADED))}addEventListenersToTile(e){e.addEventListener(ci.TILEFETCHED,this.tileFetched.bind(this)),e.addEventListener(ci.TILEFETCHERROR,this.tileFetchError.bind(this))}removeEventListenersFromTile(e){e.removeEventListener(ci.TILEFETCHED,this.tileFetched.bind(this)),e.removeEventListener(ci.TILEFETCHERROR,this.tileFetchError.bind(this))}}const GO=5;class UO extends EventTarget{warpedMapList;tileCache;mapsInViewport=new Set;viewport;constructor(e,i,s){super(),this.tileCache=new jO(e,s),this.warpedMapList=new DO(i,s)}async addGeoreferenceAnnotation(e){return this.warpedMapList.addGeoreferenceAnnotation(e)}async addGeoreferencedMap(e){return this.warpedMapList.addGeoreferencedMap(e)}loadMissingImageInfosInViewport(){return this.viewport?Array.from(this.warpedMapList.getMapsByGeoBbox(this.viewport.geoRectangleBbox)).map(e=>this.warpedMapList.getWarpedMap(e)).filter(e=>!e.hasImageInfo()&&!e.loadingImageInfo).map(e=>e.loadImageInfo()):[]}someImageInfosInViewport(){return this.viewport?Array.from(this.warpedMapList.getMapsByGeoBbox(this.viewport.geoRectangleBbox)).map(e=>this.warpedMapList.getWarpedMap(e)).map(e=>e.hasImageInfo()).some(e=>e===!0):!1}shouldUpdateRequestedTiles(){return!0}updateRequestedTiles(){if(!this.viewport)return;const e=this.viewport;if(!this.shouldUpdateRequestedTiles())return;const i=Array.from(this.warpedMapList.getMapsByGeoBbox(this.viewport.geoRectangleBbox)).sort((h,x)=>{const m=this.warpedMapList.getWarpedMap(h),o=this.warpedMapList.getWarpedMap(x);return m&&o?Uo(mh(m.geoMaskBbox),e.geoCenter)-Uo(mh(o.geoMaskBbox),e.geoCenter):0}),s=[];for(const h of i){const x=this.warpedMapList.getWarpedMap(h);if(!x||!x.visible||!x.hasImageInfo()||Tk(x.getViewportMaskBbox(e))<GO)continue;const m=EN(x.parsedImage,x.getResourceToCanvasScale(e));x.setBestScaleFactor(m.scaleFactor);const o={maxDepth:0,sourceIsGeographic:!1,destinationIsGeographic:!0},P=x.transformer.transformBackward([e.geoRectangle],o)[0];x.setResourceViewportRing(P);const L=IN(P,m,x.parsedImage);for(const D of L)s.push(new zO(D,x))}this.tileCache.requestFetchableTiles(s),this.updateMapsInViewport(s)}updateMapsInViewport(e){const i=Array.from(this.mapsInViewport),s=e.map(m=>m.mapId).filter((m,o,P)=>P.indexOf(m)===o);this.mapsInViewport=new Set(s.sort((m,o)=>{const P=this.warpedMapList.getMapZIndex(m),L=this.warpedMapList.getMapZIndex(o);return P!==void 0&&L!==void 0?P-L:0}));const h=s.filter(m=>!i.includes(m)),x=i.filter(m=>!s.includes(m));for(const m in h)this.dispatchEvent(new yr(ci.WARPEDMAPENTER,m));for(const m in x)this.dispatchEvent(new yr(ci.WARPEDMAPLEAVE,m))}mapTileLoaded(e){}mapTileRemoved(e){}imageInfoLoaded(e){}warpedMapAdded(e){}warpedMapRemoved(e){}transformationChanged(e){}distortionChanged(e){}addEventListeners(){this.tileCache.addEventListener(ci.MAPTILELOADED,this.mapTileLoaded.bind(this)),this.tileCache.addEventListener(ci.MAPTILEREMOVED,this.mapTileRemoved.bind(this)),this.warpedMapList.addEventListener(ci.IMAGEINFOLOADED,this.imageInfoLoaded.bind(this)),this.warpedMapList.addEventListener(ci.WARPEDMAPADDED,this.warpedMapAdded.bind(this)),this.warpedMapList.addEventListener(ci.WARPEDMAPREMOVED,this.warpedMapRemoved.bind(this)),this.warpedMapList.addEventListener(ci.TRANSFORMATIONCHANGED,this.transformationChanged.bind(this)),this.warpedMapList.addEventListener(ci.DISTORTIONCHANGED,this.distortionChanged.bind(this))}removeEventListeners(){this.tileCache.removeEventListener(ci.MAPTILELOADED,this.mapTileLoaded.bind(this)),this.tileCache.removeEventListener(ci.MAPTILEREMOVED,this.mapTileRemoved.bind(this)),this.warpedMapList.removeEventListener(ci.IMAGEINFOLOADED,this.imageInfoLoaded.bind(this)),this.warpedMapList.removeEventListener(ci.WARPEDMAPADDED,this.warpedMapAdded.bind(this)),this.warpedMapList.removeEventListener(ci.WARPEDMAPREMOVED,this.warpedMapRemoved.bind(this)),this.warpedMapList.removeEventListener(ci.TRANSFORMATIONCHANGED,this.transformationChanged.bind(this)),this.warpedMapList.removeEventListener(ci.DISTORTIONCHANGED,this.distortionChanged.bind(this))}}var VO=`#version 300 es

precision highp float;

uniform mat4 u_renderTransform;

uniform float u_animationProgress;

in vec2 a_resourceTrianglePoint;
in vec2 a_clipPreviousTrianglePoint;
in vec2 a_clipTrianglePoint;
in float a_previousTrianglePointDistortion;
in float a_trianglePointDistortion;
in float a_triangleIndex;

out vec2 v_resourceTrianglePoint;
out float v_trianglePointDistortion;
out float v_triangleIndex;

float cubicInOut(float t) {
  return t < 0.5f ? 4.0f * t * t * t : 0.5f * pow(2.0f * t - 2.0f, 3.0f) + 1.0f;
}

void main() {
  
  vec2 clipTrianglePoint = mix(a_clipPreviousTrianglePoint, a_clipTrianglePoint, cubicInOut(u_animationProgress));
  float trianglePointDistortion = mix(a_previousTrianglePointDistortion, a_trianglePointDistortion, cubicInOut(u_animationProgress));

  
  
  

  gl_Position = u_renderTransform * vec4(clipTrianglePoint, 0.0f, 1.0f);

  
  v_resourceTrianglePoint = a_resourceTrianglePoint;
  v_trianglePointDistortion = trianglePointDistortion;
  v_triangleIndex = a_triangleIndex;
}`,qO=`#version 300 es

precision highp float;
precision highp isampler2D;

#ifndef SPECTRAL
#define SPECTRAL

const int SPECTRAL_SIZE = 38;
const float SPECTRAL_GAMMA = 2.4;
const float SPECTRAL_EPSILON = 0.0001;

float spectral_uncompand(float x) {
  return (x < 0.04045) ? x / 12.92 : pow((x + 0.055) / 1.055, SPECTRAL_GAMMA);
}

float spectral_compand(float x) {
  return (x < 0.0031308) ? x * 12.92 : 1.055 * pow(x, 1.0 / SPECTRAL_GAMMA) - 0.055;
}

vec3 spectral_srgb_to_linear(vec3 srgb) {
    return vec3(spectral_uncompand(srgb[0]), spectral_uncompand(srgb[1]), spectral_uncompand(srgb[2]));
}

vec3 spectral_linear_to_srgb(vec3 lrgb) {
    return clamp(vec3(spectral_compand(lrgb[0]), spectral_compand(lrgb[1]), spectral_compand(lrgb[2])), 0.0, 1.0);
}

void spectral_upsampling(vec3 lrgb, out float w, out float c, out float m, out float y, out float r, out float g, out float b) {
    w = min(lrgb.r, min(lrgb.g, lrgb.b));

    lrgb -= w;

    c = min(lrgb.g, lrgb.b);
    m = min(lrgb.r, lrgb.b);
    y = min(lrgb.r, lrgb.g);
    r = min(max(0., lrgb.r - lrgb.b), max(0., lrgb.r - lrgb.g));
    g = min(max(0., lrgb.g - lrgb.b), max(0., lrgb.g - lrgb.r));
    b = min(max(0., lrgb.b - lrgb.g), max(0., lrgb.b - lrgb.r));
}

void spectral_linear_to_reflectance(vec3 lrgb, inout float R[SPECTRAL_SIZE]) {
    float w, c, m, y, r, g, b;

    spectral_upsampling(lrgb, w, c, m, y, r, g, b);

     R[0] = max(SPECTRAL_EPSILON, w + c * 0.96853629 + m * 0.51567122 + y * 0.02055257 + r * 0.03147571 + g * 0.49108579 + b * 0.97901834);
     R[1] = max(SPECTRAL_EPSILON, w + c * 0.96855103 + m * 0.54015520 + y * 0.02059936 + r * 0.03146636 + g * 0.46944057 + b * 0.97901649);
     R[2] = max(SPECTRAL_EPSILON, w + c * 0.96859338 + m * 0.62645502 + y * 0.02062723 + r * 0.03140624 + g * 0.40165780 + b * 0.97901118);
     R[3] = max(SPECTRAL_EPSILON, w + c * 0.96877345 + m * 0.75595012 + y * 0.02073387 + r * 0.03119611 + g * 0.24490420 + b * 0.97892146);
     R[4] = max(SPECTRAL_EPSILON, w + c * 0.96942204 + m * 0.92826996 + y * 0.02114202 + r * 0.03053888 + g * 0.06826880 + b * 0.97858555);
     R[5] = max(SPECTRAL_EPSILON, w + c * 0.97143709 + m * 0.97223624 + y * 0.02233154 + r * 0.02856855 + g * 0.02732883 + b * 0.97743705);
     R[6] = max(SPECTRAL_EPSILON, w + c * 0.97541862 + m * 0.98616174 + y * 0.02556857 + r * 0.02459485 + g * 0.01360600 + b * 0.97428075);
     R[7] = max(SPECTRAL_EPSILON, w + c * 0.98074186 + m * 0.98955255 + y * 0.03330189 + r * 0.01929520 + g * 0.01000187 + b * 0.96663223);
     R[8] = max(SPECTRAL_EPSILON, w + c * 0.98580992 + m * 0.98676237 + y * 0.05185294 + r * 0.01423112 + g * 0.01284127 + b * 0.94822893);
     R[9] = max(SPECTRAL_EPSILON, w + c * 0.98971194 + m * 0.97312575 + y * 0.10087639 + r * 0.01033111 + g * 0.02636635 + b * 0.89937713);
    R[10] = max(SPECTRAL_EPSILON, w + c * 0.99238027 + m * 0.91944277 + y * 0.24000413 + r * 0.00765876 + g * 0.07058713 + b * 0.76070164);
    R[11] = max(SPECTRAL_EPSILON, w + c * 0.99409844 + m * 0.32564851 + y * 0.53589066 + r * 0.00593693 + g * 0.70421692 + b * 0.46420440);
    R[12] = max(SPECTRAL_EPSILON, w + c * 0.99517200 + m * 0.13820628 + y * 0.79874659 + r * 0.00485616 + g * 0.85473994 + b * 0.20123039);
    R[13] = max(SPECTRAL_EPSILON, w + c * 0.99576545 + m * 0.05015143 + y * 0.91186529 + r * 0.00426186 + g * 0.95081565 + b * 0.08808402);
    R[14] = max(SPECTRAL_EPSILON, w + c * 0.99593552 + m * 0.02912336 + y * 0.95399623 + r * 0.00409039 + g * 0.97170370 + b * 0.04592894);
    R[15] = max(SPECTRAL_EPSILON, w + c * 0.99564041 + m * 0.02421691 + y * 0.97137099 + r * 0.00438375 + g * 0.97651888 + b * 0.02860373);
    R[16] = max(SPECTRAL_EPSILON, w + c * 0.99464769 + m * 0.02660696 + y * 0.97939505 + r * 0.00537525 + g * 0.97429245 + b * 0.02060067);
    R[17] = max(SPECTRAL_EPSILON, w + c * 0.99229579 + m * 0.03407586 + y * 0.98345207 + r * 0.00772962 + g * 0.97012917 + b * 0.01656701);
    R[18] = max(SPECTRAL_EPSILON, w + c * 0.98638762 + m * 0.04835936 + y * 0.98553736 + r * 0.01366120 + g * 0.94258630 + b * 0.01451549);
    R[19] = max(SPECTRAL_EPSILON, w + c * 0.96829712 + m * 0.00011720 + y * 0.98648905 + r * 0.03181352 + g * 0.99989207 + b * 0.01357964);
    R[20] = max(SPECTRAL_EPSILON, w + c * 0.89228016 + m * 0.00008554 + y * 0.98674535 + r * 0.10791525 + g * 0.99989891 + b * 0.01331243);
    R[21] = max(SPECTRAL_EPSILON, w + c * 0.53740239 + m * 0.85267882 + y * 0.98657555 + r * 0.46249516 + g * 0.13823139 + b * 0.01347661);
    R[22] = max(SPECTRAL_EPSILON, w + c * 0.15360445 + m * 0.93188793 + y * 0.98611877 + r * 0.84604333 + g * 0.06968113 + b * 0.01387181);
    R[23] = max(SPECTRAL_EPSILON, w + c * 0.05705719 + m * 0.94810268 + y * 0.98559942 + r * 0.94275572 + g * 0.05628787 + b * 0.01435472);
    R[24] = max(SPECTRAL_EPSILON, w + c * 0.03126539 + m * 0.94200977 + y * 0.98507063 + r * 0.96860996 + g * 0.06111561 + b * 0.01479836);
    R[25] = max(SPECTRAL_EPSILON, w + c * 0.02205445 + m * 0.91478045 + y * 0.98460039 + r * 0.97783966 + g * 0.08987709 + b * 0.01515250);
    R[26] = max(SPECTRAL_EPSILON, w + c * 0.01802271 + m * 0.87065445 + y * 0.98425301 + r * 0.98187757 + g * 0.13656016 + b * 0.01540513);
    R[27] = max(SPECTRAL_EPSILON, w + c * 0.01613460 + m * 0.78827548 + y * 0.98403909 + r * 0.98377315 + g * 0.22169624 + b * 0.01557233);
    R[28] = max(SPECTRAL_EPSILON, w + c * 0.01520947 + m * 0.65738359 + y * 0.98388535 + r * 0.98470202 + g * 0.32176956 + b * 0.01565710);
    R[29] = max(SPECTRAL_EPSILON, w + c * 0.01475977 + m * 0.59909403 + y * 0.98376116 + r * 0.98515481 + g * 0.36157329 + b * 0.01571025);
    R[30] = max(SPECTRAL_EPSILON, w + c * 0.01454263 + m * 0.56817268 + y * 0.98368246 + r * 0.98537114 + g * 0.48361920 + b * 0.01571916);
    R[31] = max(SPECTRAL_EPSILON, w + c * 0.01444459 + m * 0.54031997 + y * 0.98365023 + r * 0.98546685 + g * 0.46488579 + b * 0.01572133);
    R[32] = max(SPECTRAL_EPSILON, w + c * 0.01439897 + m * 0.52110241 + y * 0.98361309 + r * 0.98550011 + g * 0.47440306 + b * 0.01572502);
    R[33] = max(SPECTRAL_EPSILON, w + c * 0.01437620 + m * 0.51041094 + y * 0.98357259 + r * 0.98551031 + g * 0.48576990 + b * 0.01571717);
    R[34] = max(SPECTRAL_EPSILON, w + c * 0.01436343 + m * 0.50526577 + y * 0.98353856 + r * 0.98550741 + g * 0.49267971 + b * 0.01571905);
    R[35] = max(SPECTRAL_EPSILON, w + c * 0.01435687 + m * 0.50255080 + y * 0.98351247 + r * 0.98551323 + g * 0.49625685 + b * 0.01571059);
    R[36] = max(SPECTRAL_EPSILON, w + c * 0.01435370 + m * 0.50126452 + y * 0.98350101 + r * 0.98551563 + g * 0.49807754 + b * 0.01569728);
    R[37] = max(SPECTRAL_EPSILON, w + c * 0.01435408 + m * 0.50083021 + y * 0.98350852 + r * 0.98551547 + g * 0.49889859 + b * 0.01570020);
}

vec3 spectral_xyz_to_srgb(vec3 xyz) {
    mat3 XYZ_RGB;

    XYZ_RGB[0] = vec3( 3.24306333, -1.53837619, -0.49893282);
    XYZ_RGB[1] = vec3(-0.96896309,  1.87542451,  0.04154303);
    XYZ_RGB[2] = vec3( 0.05568392, -0.20417438,  1.05799454);

    float r = dot(XYZ_RGB[0], xyz);
    float g = dot(XYZ_RGB[1], xyz);
    float b = dot(XYZ_RGB[2], xyz);

    return spectral_linear_to_srgb(vec3(r, g, b));
}

vec3 spectral_reflectance_to_xyz(float R[SPECTRAL_SIZE]) {
    vec3 xyz = vec3(0.0);

    xyz +=  R[0] * vec3(0.00006469, 0.00000184, 0.00030502);
    xyz +=  R[1] * vec3(0.00021941, 0.00000621, 0.00103681);
    xyz +=  R[2] * vec3(0.00112057, 0.00003101, 0.00531314);
    xyz +=  R[3] * vec3(0.00376661, 0.00010475, 0.01795439);
    xyz +=  R[4] * vec3(0.01188055, 0.00035364, 0.05707758);
    xyz +=  R[5] * vec3(0.02328644, 0.00095147, 0.11365162);
    xyz +=  R[6] * vec3(0.03455942, 0.00228226, 0.17335873);
    xyz +=  R[7] * vec3(0.03722379, 0.00420733, 0.19620658);
    xyz +=  R[8] * vec3(0.03241838, 0.00668880, 0.18608237);
    xyz +=  R[9] * vec3(0.02123321, 0.00988840, 0.13995048);
    xyz += R[10] * vec3(0.01049099, 0.01524945, 0.08917453);
    xyz += R[11] * vec3(0.00329584, 0.02141831, 0.04789621);
    xyz += R[12] * vec3(0.00050704, 0.03342293, 0.02814563);
    xyz += R[13] * vec3(0.00094867, 0.05131001, 0.01613766);
    xyz += R[14] * vec3(0.00627372, 0.07040208, 0.00775910);
    xyz += R[15] * vec3(0.01686462, 0.08783871, 0.00429615);
    xyz += R[16] * vec3(0.02868965, 0.09424905, 0.00200551);
    xyz += R[17] * vec3(0.04267481, 0.09795667, 0.00086147);
    xyz += R[18] * vec3(0.05625475, 0.09415219, 0.00036904);
    xyz += R[19] * vec3(0.06947040, 0.08678102, 0.00019143);
    xyz += R[20] * vec3(0.08305315, 0.07885653, 0.00014956);
    xyz += R[21] * vec3(0.08612610, 0.06352670, 0.00009231);
    xyz += R[22] * vec3(0.09046614, 0.05374142, 0.00006813);
    xyz += R[23] * vec3(0.08500387, 0.04264606, 0.00002883);
    xyz += R[24] * vec3(0.07090667, 0.03161735, 0.00001577);
    xyz += R[25] * vec3(0.05062889, 0.02088521, 0.00000394);
    xyz += R[26] * vec3(0.03547396, 0.01386011, 0.00000158);
    xyz += R[27] * vec3(0.02146821, 0.00810264, 0.00000000);
    xyz += R[28] * vec3(0.01251646, 0.00463010, 0.00000000);
    xyz += R[29] * vec3(0.00680458, 0.00249138, 0.00000000);
    xyz += R[30] * vec3(0.00346457, 0.00125930, 0.00000000);
    xyz += R[31] * vec3(0.00149761, 0.00054165, 0.00000000);
    xyz += R[32] * vec3(0.00076970, 0.00027795, 0.00000000);
    xyz += R[33] * vec3(0.00040737, 0.00014711, 0.00000000);
    xyz += R[34] * vec3(0.00016901, 0.00006103, 0.00000000);
    xyz += R[35] * vec3(0.00009522, 0.00003439, 0.00000000);
    xyz += R[36] * vec3(0.00004903, 0.00001771, 0.00000000);
    xyz += R[37] * vec3(0.00002000, 0.00000722, 0.00000000);

    return xyz;
}

float spectral_linear_to_concentration(float l1, float l2, float t) {
    float t1 = l1 * pow(1.0 - t, 2.0);
    float t2 = l2 * pow(t, 2.0);

    return t2 / (t1 + t2);
}

vec3 spectral_mix(vec3 color1, vec3 color2, float t) {
    vec3 lrgb1 = spectral_srgb_to_linear(color1);
    vec3 lrgb2 = spectral_srgb_to_linear(color2);

    float R1[SPECTRAL_SIZE];
    float R2[SPECTRAL_SIZE];

    spectral_linear_to_reflectance(lrgb1, R1);
    spectral_linear_to_reflectance(lrgb2, R2);

    float l1 = spectral_reflectance_to_xyz(R1)[1];
    float l2 = spectral_reflectance_to_xyz(R2)[1];

    t = spectral_linear_to_concentration(l1, l2, t);

    float R[SPECTRAL_SIZE];

    for (int i = 0; i < SPECTRAL_SIZE; i++) {
      float KS = (1.0 - t) * (pow(1.0 - R1[i], 2.0) / (2.0 * R1[i])) + t * (pow(1.0 - R2[i], 2.0) / (2.0 * R2[i]));
      float KM = 1.0 + KS - sqrt(pow(KS, 2.0) + 2.0 * KS);

      
      

      R[i] = KM;
    }

    return spectral_xyz_to_srgb(spectral_reflectance_to_xyz(R));
}

vec4 spectral_mix(vec4 color1, vec4 color2, float t) {
    return vec4(spectral_mix(color1.rgb, color2.rgb, t), mix(color1.a, color2.a, t));
}

#endif

uniform bool u_removeColor;
uniform vec3 u_removeColorOptionsColor;
uniform float u_removeColorOptionsThreshold;
uniform float u_removeColorOptionsHardness;

uniform bool u_colorize;
uniform vec3 u_colorizeOptionsColor;

uniform bool u_grid;

uniform float u_opacity;
uniform float u_saturation;

uniform bool u_distortion;
uniform int u_distortionOptionsdistortionMeasure;

uniform int u_bestScaleFactor;

uniform sampler2D u_packedTilesTexture;
uniform isampler2D u_packedTilesPositionsTexture;
uniform isampler2D u_packedTilesResourcePositionsAndDimensionsTexture;
uniform isampler2D u_packedTilesScaleFactorsTexture;

in vec2 v_resourceTrianglePoint;
in float v_triangleIndex;
in float v_trianglePointDistortion;

out vec4 color;

vec4 rgbToVec4(int r, int g, int b) {
  return vec4(float(r) / 255.0f, float(g) / 255.0f, float(b) / 255.0f, 1.0f);
}

void main() {
  
  
  
  vec4 colorTransparent = vec4(0.0f, 0.0f, 0.0f, 0.0f);
  vec4 colorWhite = vec4(1.0f, 1.0f, 1.0f, 1.0f);
  vec4 colorBlack = vec4(0.0f, 0.0f, 0.0f, 1.0f);

  vec4 colorGreen300 = vec4(0.5254f, 0.9372f, 0.6745f, 1.0f);
  vec4 colorPurple300 = vec4(0.8470f, 0.7058f, 0.9960f, 1.0f);
  vec4 colorRed300 = vec4(0.9882f, 0.6470f, 0.6470f, 1.0f);
  vec4 colorYellow300 = vec4(0.9921f, 0.8784f, 0.2784f, 1.0f);
  vec4 colorOrange300 = vec4(0.9921f, 0.7294f, 0.4549f, 1.0f);
  vec4 colorPink300 = vec4(0.9764f, 0.6588f, 0.8313f, 1.0f);
  vec4 colorBlue300 = vec4(0.5764f, 0.7725f, 0.9921f, 1.0f);
  vec4 colorGrey300 = vec4(0.8196f, 0.8352f, 0.8588f, 1.0f);

  vec4 colorGreen500 = vec4(0.1333f, 0.7725f, 0.3686f, 1.0f);
  vec4 colorPurple500 = vec4(0.6588f, 0.3333f, 0.9686f, 1.0f);
  vec4 colorRed500 = vec4(0.9372f, 0.2666f, 0.2666f, 1.0f);
  vec4 colorYellow500 = vec4(0.9176f, 0.7019f, 0.0313f, 1.0f);
  vec4 colorOrange500 = vec4(0.9764f, 0.4509f, 0.0862f, 1.0f);
  vec4 colorPink500 = vec4(0.9254f, 0.2823f, 0.6f, 1.0f);
  vec4 colorBlue500 = vec4(0.2313f, 0.5098f, 0.9647f, 1.0f);
  vec4 colorGrey500 = vec4(0.4196f, 0.4470f, 0.5019f, 1.0f);

  float resourceTrianglePointX = v_resourceTrianglePoint.x;
  float resourceTrianglePointY = v_resourceTrianglePoint.y;

  
  int packedTilesCount = textureSize(u_packedTilesPositionsTexture, 0).y;
  ivec2 packedTilesTextureSize = textureSize(u_packedTilesTexture, 0);

  
  int smallestScaleFactorDiff = 256 * 256; 
  int bestScaleFactor = 0;

  
  vec2 packedTilesTexturePoint = vec2(0.0f, 0.0f);

  
  color = colorTransparent;
  bool found = false;

  
  for(int index = 0; index < packedTilesCount; index += 1) {

    
    ivec2 packedTilePosition = texelFetch(u_packedTilesPositionsTexture, ivec2(0, index), 0).rg;
    ivec4 packedTileResourcePositionAndDimension = texelFetch(u_packedTilesResourcePositionsAndDimensionsTexture, ivec2(0, index), 0);
    int packedTileScaleFactor = texelFetch(u_packedTilesScaleFactorsTexture, ivec2(0, index), 0).r;

    float packedTilePositionX = float(packedTilePosition.r);
    float packedTilePositionY = float(packedTilePosition.g);

    float packedTileResourcePositionX = float(packedTileResourcePositionAndDimension.r);
    float packedTileResourcePositionY = float(packedTileResourcePositionAndDimension.g);

    float packedTileDimensionWidth = float(packedTileResourcePositionAndDimension.b);
    float packedTileDimensionHeight = float(packedTileResourcePositionAndDimension.a);

    
    
    
    
    if(resourceTrianglePointX >= packedTileResourcePositionX &&
      resourceTrianglePointX < packedTileResourcePositionX + packedTileDimensionWidth &&
      resourceTrianglePointY >= packedTileResourcePositionY &&
      resourceTrianglePointY < packedTileResourcePositionY + packedTileDimensionHeight) {
      found = true;

      int scaleFactorDiff = abs(u_bestScaleFactor - packedTileScaleFactor);

      if(scaleFactorDiff < smallestScaleFactorDiff || bestScaleFactor == 0) {

        smallestScaleFactorDiff = scaleFactorDiff;
        bestScaleFactor = packedTileScaleFactor;

        float packedTilePointX = (resourceTrianglePointX - packedTileResourcePositionX) / float(bestScaleFactor);
        float packedTilePointY = (resourceTrianglePointY - packedTileResourcePositionY) / float(bestScaleFactor);

        float packedTilesPointX = packedTilePositionX + packedTilePointX;
        float packedTilesPointY = packedTilePositionY + packedTilePointY;

        float packedTilesTexturePointX = packedTilesPointX / float(packedTilesTextureSize.x);
        float packedTilesTexturePointY = packedTilesPointY / float(packedTilesTextureSize.y);

        packedTilesTexturePoint = vec2(packedTilesTexturePointX, packedTilesTexturePointY);
      }
    }
  }

  if(found == true) {
    
    color = texture(u_packedTilesTexture, packedTilesTexturePoint);

    
    if(u_removeColorOptionsThreshold > 0.0f) {
      vec3 backgroundColorDiff = color.rgb - u_removeColorOptionsColor.rgb;
      float backgroundColorDistance = length(backgroundColorDiff);
      if(u_removeColor && backgroundColorDistance < u_removeColorOptionsThreshold) {
        float amount = smoothstep(u_removeColorOptionsThreshold - u_removeColorOptionsThreshold * (1.0f - u_removeColorOptionsHardness), u_removeColorOptionsThreshold, backgroundColorDistance);
        color = vec4(color.rgb * amount, amount);
      }
    }

    
    float gray = 0.21f * color.r + 0.71f * color.g + 0.07f * color.b;
    color = vec4(color.rgb * (u_saturation) + (gray * (1.0f - u_saturation)), color.a);

    
    if(u_colorize) {
      color = vec4((u_colorizeOptionsColor + color.rgb) * color.a, color.a);
    }

    
    color = vec4(color.rgb * u_opacity, color.a * u_opacity);

    
    
    if(u_distortion) {
      
      

      float trianglePointDistortion = v_trianglePointDistortion;

      
      trianglePointDistortion = floor(trianglePointDistortion * 10.0f) / 10.0f;

      switch(u_distortionOptionsdistortionMeasure) {
        case 0:
          if(trianglePointDistortion > 0.0f) {
            color = spectral_mix(color, colorRed500, trianglePointDistortion);
          } else {
            color = spectral_mix(color, colorBlue500, abs(trianglePointDistortion));
          }
          break;
        case 1:
          color = spectral_mix(color, colorGreen500, trianglePointDistortion);
          break;
        case 2:
          color = spectral_mix(color, colorYellow500, trianglePointDistortion);
          break;
        case 3:
          color = trianglePointDistortion == -1.0f ? colorRed300 : color;
          break;
        default:
          color = color;
      }
    }

    
    
    if(false) {
      color = vec4(abs(sin(v_triangleIndex)), abs(sin(v_triangleIndex + 1.0f)), abs(sin(v_triangleIndex + 2.0f)), 1);
    }

    
    if(u_grid) {
      float gridSize = 20.0f * float(u_bestScaleFactor);
      float gridWidth = 2.0f * float(u_bestScaleFactor);
      if(mod(float(resourceTrianglePointX) + gridWidth / 2.0f, gridSize) < gridWidth || mod(float(resourceTrianglePointY) + gridWidth / 2.0f, gridSize) < gridWidth) {
        color = colorBlack;
      }
    }
  }
}`;const ZO=500,WO={leading:!0,trailing:!0},YO=50,XO={leading:!0,trailing:!0},yy=1,_y=1,HO=0,KO=.7,JO=5,M1=750;class QO extends UO{gl;program;previousSignificantViewport;opacity=yy;saturation=_y;renderOptions={};invertedRenderTransform;lastAnimationFrameRequestId;animating=!1;transformationTransitionStart;animationProgress=1;throttledPrepareRenderInternal;throttledChanged;constructor(e,i){const s=x1(e,e.VERTEX_SHADER,VO),h=x1(e,e.FRAGMENT_SHADER,qO),x=RN(e,s,h);super(ev.createFactory(),zN(e,x),i),this.gl=e,this.program=x,e.deleteShader(s),e.deleteShader(h),e.disable(e.DEPTH_TEST),this.invertedRenderTransform=KP(),this.addEventListeners(),this.throttledPrepareRenderInternal=Jy(this.prepareRenderInternal.bind(this),ZO,WO),this.throttledChanged=Jy(this.changed.bind(this),YO,XO)}getOpacity(){return this.opacity}setOpacity(e){this.opacity=e}resetOpacity(){this.opacity=yy}getMapOpacity(e){const i=this.warpedMapList.getWarpedMap(e);if(i)return i.opacity}setMapOpacity(e,i){const s=this.warpedMapList.getWarpedMap(e);s&&(s.opacity=Math.min(Math.max(i,0),1))}resetMapOpacity(e){const i=this.warpedMapList.getWarpedMap(e);i&&(i.opacity=yy)}getRemoveColorOptions(){return this.renderOptions.removeColorOptions}setRemoveColorOptions(e){this.renderOptions.removeColorOptions=e}resetRemoveColorOptions(){this.renderOptions.removeColorOptions=void 0}getMapRemoveColorOptions(e){const i=this.warpedMapList.getWarpedMap(e);if(i)return i.renderOptions.removeColorOptions}setMapRemoveColorOptions(e,i){const s=this.warpedMapList.getWarpedMap(e);s&&(s.renderOptions.removeColorOptions=i)}resetMapRemoveColorOptions(e){const i=this.warpedMapList.getWarpedMap(e);i&&(i.renderOptions.removeColorOptions=void 0)}getColorizeOptions(){return this.renderOptions.colorizeOptions}setColorizeOptions(e){this.renderOptions.colorizeOptions=e}resetColorizeOptions(){this.renderOptions.colorizeOptions=void 0}getMapColorizeOptions(e){const i=this.warpedMapList.getWarpedMap(e);if(i)return i.renderOptions.colorizeOptions}setMapColorizeOptions(e,i){const s=this.warpedMapList.getWarpedMap(e);s&&(s.renderOptions.colorizeOptions=i)}resetMapColorizeOptions(e){const i=this.warpedMapList.getWarpedMap(e);i&&(i.renderOptions.colorizeOptions=void 0)}getGridOptions(){return this.renderOptions.gridOptions}setGridOptions(e){this.renderOptions.gridOptions=e}resetGridOptions(){this.renderOptions.gridOptions=void 0}getMapGridOptions(e){const i=this.warpedMapList.getWarpedMap(e);if(i)return i.renderOptions.gridOptions}setMapGridOptions(e,i){const s=this.warpedMapList.getWarpedMap(e);s&&(s.renderOptions.gridOptions=i)}resetMapGridOptions(e){const i=this.warpedMapList.getWarpedMap(e);i&&(i.renderOptions.gridOptions=void 0)}getSaturation(){return this.saturation}setSaturation(e){this.saturation=e}resetSaturation(){this.saturation=_y}getMapSaturation(e){const i=this.warpedMapList.getWarpedMap(e);if(i)return i.saturation}setMapSaturation(e,i){const s=this.warpedMapList.getWarpedMap(e);s&&(s.saturation=i)}resetMapSaturation(e){const i=this.warpedMapList.getWarpedMap(e);i&&(i.saturation=_y)}render(e){this.viewport=e,this.loadMissingImageInfosInViewport(),this.someImageInfosInViewport()&&this.throttledPrepareRenderInternal(),this.renderInternal()}clear(){this.warpedMapList.clear(),this.mapsInViewport=new Set,this.gl.clear(this.gl.DEPTH_BUFFER_BIT|this.gl.COLOR_BUFFER_BIT),this.tileCache.clear()}dispose(){for(const e of this.warpedMapList.getWarpedMaps())this.removeEventListenersFromWebGL2WarpedMap(e),e.dispose();this.tileCache.clear(),this.tileCache.dispose(),this.removeEventListeners(),this.gl.deleteProgram(this.program)}prepareRenderInternal(){this.updateRequestedTiles(),this.updateVertexBuffers()}shouldUpdateRequestedTiles(){if(!this.viewport||this.animating)return!1;if(this.previousSignificantViewport){const e=[];for(let s=0;s<4;s++)e.push(Uo(this.previousSignificantViewport.projectedGeoRectangle[s],this.viewport.projectedGeoRectangle[s])/this.viewport.projectedGeoPerViewportScale);const i=Math.max(...e);return i===0?!0:i>JO?(this.previousSignificantViewport=this.viewport,!0):!1}else return this.previousSignificantViewport=this.viewport,!0}updateVertexBuffers(){if(this.viewport){this.invertedRenderTransform=QP(this.viewport.projectedGeoToClipTransform);for(const e of this.mapsInViewport){const i=this.warpedMapList.getWarpedMap(e);if(!i)break;i.updateVertexBuffers(this.viewport.projectedGeoToClipTransform)}}}renderInternal(){if(!this.viewport)return;const e=JP(this.viewport.projectedGeoToClipTransform,this.invertedRenderTransform),i=this.gl;i.viewport(0,0,i.canvas.width,i.canvas.height),i.enable(i.BLEND),i.blendFunc(i.ONE,i.ONE_MINUS_SRC_ALPHA),i.useProgram(this.program);const s=i.getUniformLocation(this.program,"u_renderTransform");i.uniformMatrix4fv(s,!1,tk(e));const h=i.getUniformLocation(this.program,"u_animationProgress");i.uniform1f(h,this.animationProgress);for(const x of this.mapsInViewport){const m=this.warpedMapList.getWarpedMap(x);if(!m)continue;this.setRenderOptionsUniforms(this.renderOptions,m.renderOptions);const o=i.getUniformLocation(this.program,"u_opacity");i.uniform1f(o,this.opacity*m.opacity);const P=i.getUniformLocation(this.program,"u_saturation");i.uniform1f(P,this.saturation*m.saturation);const L=i.getUniformLocation(this.program,"u_distortion");if(i.uniform1f(L,m.distortionMeasure?1:0),m.distortionMeasure){const K=i.getUniformLocation(this.program,"u_distortionOptionsdistortionMeasure");i.uniform1i(K,cT.indexOf(m.distortionMeasure))}const D=i.getUniformLocation(this.program,"u_bestScaleFactor"),F=m.bestScaleFactor;i.uniform1i(D,F);const Y=i.getUniformLocation(this.program,"u_packedTilesTexture");i.uniform1i(Y,0),i.activeTexture(i.TEXTURE0),i.bindTexture(i.TEXTURE_2D,m.packedTilesTexture);const V=i.getUniformLocation(this.program,"u_packedTilesPositionsTexture");i.uniform1i(V,1),i.activeTexture(i.TEXTURE1),i.bindTexture(i.TEXTURE_2D,m.packedTilesPositionsTexture);const H=i.getUniformLocation(this.program,"u_packedTilesResourcePositionsAndDimensionsTexture");i.uniform1i(H,2),i.activeTexture(i.TEXTURE2),i.bindTexture(i.TEXTURE_2D,m.packedTilesResourcePositionsAndDimensionsTexture);const ve=i.getUniformLocation(this.program,"u_packedTilesScaleFactorsTexture");i.uniform1i(ve,3),i.activeTexture(i.TEXTURE3),i.bindTexture(i.TEXTURE_2D,m.packedTilesScaleFactorsTexture);const _e=m.vao,oe=m.resourceTrianglePoints.length,fe=this.gl.TRIANGLES;i.bindVertexArray(_e),i.drawArrays(fe,0,oe)}}setRenderOptionsUniforms(e,i){const s=this.gl,h={removeColorOptions:{color:i.removeColorOptions?.color||e.removeColorOptions?.color,hardness:Wx(i.removeColorOptions?.hardness,e.removeColorOptions?.hardness),threshold:Wx(i.removeColorOptions?.threshold,e.removeColorOptions?.threshold)},colorizeOptions:{...e.colorizeOptions,...i.colorizeOptions},gridOptions:{...e.gridOptions,...i.gridOptions}},x=h.removeColorOptions?.color,m=s.getUniformLocation(this.program,"u_removeColor");if(s.uniform1f(m,x?1:0),x){const F=s.getUniformLocation(this.program,"u_removeColorOptionsColor");s.uniform3fv(F,x);const Y=s.getUniformLocation(this.program,"u_removeColorOptionsThreshold");s.uniform1f(Y,h.removeColorOptions?.threshold||HO);const V=s.getUniformLocation(this.program,"u_removeColorOptionsHardness");s.uniform1f(V,h.removeColorOptions?.hardness||KO)}const o=h.colorizeOptions?.color,P=s.getUniformLocation(this.program,"u_colorize");if(s.uniform1f(P,o?1:0),o){const F=s.getUniformLocation(this.program,"u_colorizeOptionsColor");s.uniform3fv(F,o)}const L=h.gridOptions?.enabled,D=s.getUniformLocation(this.program,"u_grid");s.uniform1f(D,L?1:0)}startTransformationTransition(){this.lastAnimationFrameRequestId!==void 0&&cancelAnimationFrame(this.lastAnimationFrameRequestId),this.animating=!0,this.transformationTransitionStart=void 0,this.lastAnimationFrameRequestId=requestAnimationFrame(this.transformationTransitionFrame.bind(this))}transformationTransitionFrame(e){if(this.transformationTransitionStart||(this.transformationTransitionStart=e),e-this.transformationTransitionStart<M1)this.animationProgress=(e-this.transformationTransitionStart)/M1,this.renderInternal(),this.lastAnimationFrameRequestId=requestAnimationFrame(this.transformationTransitionFrame.bind(this));else{for(const i of this.warpedMapList.getWarpedMaps())i.resetTrianglePoints();this.updateVertexBuffers(),this.animating=!1,this.animationProgress=0,this.transformationTransitionStart=void 0}}changed(){this.dispatchEvent(new yr(ci.CHANGED))}imageInfoLoaded(e){e instanceof yr&&this.dispatchEvent(new yr(ci.IMAGEINFOLOADED))}mapTileLoaded(e){if(e instanceof yr){const{mapId:i,tileUrl:s}=e.data,h=this.tileCache.getCacheableTile(s);if(!h||!h.isCachedTile())return;const x=this.warpedMapList.getWarpedMap(i);if(!x)return;x.addCachedTileAndUpdateTextures(h)}}mapTileRemoved(e){if(e instanceof yr){const{mapId:i,tileUrl:s}=e.data,h=this.warpedMapList.getWarpedMap(i);if(!h)return;h.removeCachedTileAndUpdateTextures(s)}}warpedMapAdded(e){if(e instanceof yr){const i=e.data,s=this.warpedMapList.getWarpedMap(i);s&&this.addEventListenersToWebGL2WarpedMap(s)}}transformationChanged(e){if(e instanceof yr){const i=e.data;for(const s of this.warpedMapList.getWarpedMaps(i))this.animating&&s.mixTrianglePoints(this.animationProgress),s.updateProjectedGeoTrianglePoints(!1);this.updateVertexBuffers(),this.startTransformationTransition()}}distortionChanged(e){if(e instanceof yr){const i=e.data;for(const s of this.warpedMapList.getWarpedMaps(i))this.animating&&s.mixTrianglePoints(this.animationProgress),s.updateTrianglePointsDistortion(!1);this.updateVertexBuffers(),this.startTransformationTransition()}}addEventListenersToWebGL2WarpedMap(e){e.addEventListener(ci.TEXTURESUPDATED,this.throttledChanged.bind(this))}removeEventListenersFromWebGL2WarpedMap(e){e.removeEventListener(ci.TEXTURESUPDATED,this.throttledChanged.bind(this))}}const eD="Renderer not defined. Add the layer to a map before calling this function.";function fr(r){if(!r)throw new Error(eD)}class tD{id="warped-map-layer";type="custom";renderingMode="2d";map;renderer;options;constructor(e,i){e&&(this.id=e),this.options=i}onAdd(e,i){this.map=e,this.renderer=new QO(i,this.options),this.addEventListeners()}onRemove(){this.renderer&&(this.renderer.dispose(),this.removeEventListeners())}async addGeoreferenceAnnotation(e){fr(this.renderer);const i=await this.renderer.warpedMapList.addGeoreferenceAnnotation(e);return this.map?.triggerRepaint(),i}async removeGeoreferenceAnnotation(e){fr(this.renderer);const i=await this.renderer.warpedMapList.removeGeoreferenceAnnotation(e);return this.map?.triggerRepaint(),i}async addGeoreferenceAnnotationByUrl(e){const i=await fetch(e).then(s=>s.json());return this.addGeoreferenceAnnotation(i)}async removeGeoreferenceAnnotationByUrl(e){const i=await fetch(e).then(s=>s.json());return this.removeGeoreferenceAnnotation(i)}async addGeoreferencedMap(e){fr(this.renderer);const i=this.renderer.warpedMapList.addGeoreferencedMap(e);return this.map?.triggerRepaint(),i}async removeGeoreferencedMap(e){fr(this.renderer);const i=this.renderer.warpedMapList.removeGeoreferencedMap(e);return this.map?.triggerRepaint(),i}getWarpedMapList(){return fr(this.renderer),this.renderer.warpedMapList}getWarpedMap(e){return fr(this.renderer),this.renderer.warpedMapList.getWarpedMap(e)}showMap(e){fr(this.renderer),this.renderer.warpedMapList.showMaps([e]),this.map?.triggerRepaint()}showMaps(e){fr(this.renderer),this.renderer.warpedMapList.showMaps(e),this.map?.triggerRepaint()}hideMap(e){fr(this.renderer),this.renderer.warpedMapList.hideMaps([e]),this.map?.triggerRepaint()}hideMaps(e){fr(this.renderer),this.renderer.warpedMapList.hideMaps(e),this.map?.triggerRepaint()}isMapVisible(e){return fr(this.renderer),this.renderer.warpedMapList.getWarpedMap(e)?.visible}setMapResourceMask(e,i){fr(this.renderer),this.renderer.warpedMapList.setMapResourceMask(e,i),this.map?.triggerRepaint()}setMapsTransformationType(e,i){fr(this.renderer),this.renderer.warpedMapList.setMapsTransformationType(e,i),this.map?.triggerRepaint()}setMapsDistortionMeasure(e,i){fr(this.renderer),this.renderer.warpedMapList.setMapsDistortionMeasure(e,i),this.map?.triggerRepaint()}getBounds(){fr(this.renderer);const e=this.renderer.warpedMapList.getBbox();if(e)return[[e[0],e[1]],[e[2],e[3]]]}bringMapsToFront(e){fr(this.renderer),this.renderer.warpedMapList.bringMapsToFront(e),this.map?.triggerRepaint()}sendMapsToBack(e){fr(this.renderer),this.renderer.warpedMapList.sendMapsToBack(e),this.map?.triggerRepaint()}bringMapsForward(e){fr(this.renderer),this.renderer.warpedMapList.bringMapsForward(e),this.map?.triggerRepaint()}sendMapsBackward(e){fr(this.renderer),this.renderer.warpedMapList.sendMapsBackward(e),this.map?.triggerRepaint()}getMapZIndex(e){return fr(this.renderer),this.renderer.warpedMapList.getMapZIndex(e)}setImageInformations(e){fr(this.renderer),this.renderer.warpedMapList.setImageInformations(e)}getOpacity(){return fr(this.renderer),this.renderer.getOpacity()}setOpacity(e){fr(this.renderer),this.renderer.setOpacity(e),this.map?.triggerRepaint()}resetOpacity(){fr(this.renderer),this.renderer.resetOpacity(),this.map?.triggerRepaint()}getMapOpacity(e){return fr(this.renderer),this.renderer.getMapOpacity(e)}setMapOpacity(e,i){fr(this.renderer),this.renderer.setMapOpacity(e,i),this.map?.triggerRepaint()}resetMapOpacity(e){fr(this.renderer),this.renderer.resetMapOpacity(e),this.map?.triggerRepaint()}setSaturation(e){fr(this.renderer),this.renderer.setSaturation(e),this.map?.triggerRepaint()}resetSaturation(){fr(this.renderer),this.renderer.resetSaturation(),this.map?.triggerRepaint()}setMapSaturation(e,i){fr(this.renderer),this.renderer.setMapSaturation(e,i),this.map?.triggerRepaint()}resetMapSaturation(e){fr(this.renderer),this.renderer.resetMapSaturation(e),this.map?.triggerRepaint()}setRemoveColor(e){fr(this.renderer);const i=e.hexColor?vf(e.hexColor):void 0;this.renderer.setRemoveColorOptions({color:i,threshold:e.threshold,hardness:e.hardness}),this.map?.triggerRepaint()}resetRemoveColor(){fr(this.renderer),this.renderer.resetRemoveColorOptions(),this.map?.triggerRepaint()}setMapRemoveColor(e,i){fr(this.renderer);const s=i.hexColor?vf(i.hexColor):void 0;this.renderer.setMapRemoveColorOptions(e,{color:s,threshold:i.threshold,hardness:i.hardness}),this.map?.triggerRepaint()}resetMapRemoveColor(e){fr(this.renderer),this.renderer.resetMapRemoveColorOptions(e)}setColorize(e){fr(this.renderer);const i=vf(e);i&&(this.renderer.setColorizeOptions({color:i}),this.map?.triggerRepaint())}resetColorize(){fr(this.renderer),this.renderer.resetColorizeOptions(),this.map?.triggerRepaint()}setMapColorize(e,i){fr(this.renderer);const s=vf(i);s&&(this.renderer.setMapColorizeOptions(e,{color:s}),this.map?.triggerRepaint())}resetMapColorize(e){fr(this.renderer),this.renderer.resetMapColorizeOptions(e),this.map?.triggerRepaint()}clear(){fr(this.renderer),this.renderer.clear(),this.map?.triggerRepaint()}preparerender(){}render(){if(!this.map||!this.renderer)return;const e=this.map.getCanvas(),i=[e.width/window.devicePixelRatio,e.height/window.devicePixelRatio],s=this.map.getCenter(),h=sh([s.lng,s.lat]),x=this.map.unproject([0,i[1]]),m=this.map.unproject([i[0],i[1]]),o=this.map.unproject([i[0],0]),P=this.map.unproject([0,0]),L=sh([x.lng,x.lat]),D=sh([m.lng,m.lat]),F=sh([o.lng,o.lat]),Y=sh([P.lng,P.lat]),V=By([L,D,F,Y]),H=sm(V,i),ve=-(this.map.getBearing()/180)*Math.PI,_e=new om(i,h,H,ve,window.devicePixelRatio);this.renderer.render(_e)}addEventListeners(){this.renderer&&(this.renderer.addEventListener(ci.CHANGED,this.render.bind(this)),this.renderer.addEventListener(ci.IMAGEINFOLOADED,this.render.bind(this)),this.renderer.addEventListener(ci.WARPEDMAPENTER,this.passWarpedMapEvent.bind(this)),this.renderer.addEventListener(ci.WARPEDMAPLEAVE,this.passWarpedMapEvent.bind(this)),this.renderer.tileCache.addEventListener(ci.FIRSTMAPTILELOADED,this.passWarpedMapEvent.bind(this)),this.renderer.tileCache.addEventListener(ci.ALLREQUESTEDTILESLOADED,this.passWarpedMapEvent.bind(this)),this.renderer.warpedMapList.addEventListener(ci.GEOREFERENCEANNOTATIONADDED,this.passWarpedMapEvent.bind(this)),this.renderer.warpedMapList.addEventListener(ci.WARPEDMAPADDED,this.passWarpedMapEvent.bind(this)),this.renderer.warpedMapList.addEventListener(ci.WARPEDMAPREMOVED,this.passWarpedMapEvent.bind(this)),this.renderer.warpedMapList.addEventListener(ci.VISIBILITYCHANGED,this.render.bind(this)),this.renderer.warpedMapList.addEventListener(ci.CLEARED,this.render.bind(this)))}removeEventListeners(){this.renderer&&(this.renderer.removeEventListener(ci.CHANGED,this.render.bind(this)),this.renderer.removeEventListener(ci.IMAGEINFOLOADED,this.render.bind(this)),this.renderer.removeEventListener(ci.WARPEDMAPENTER,this.passWarpedMapEvent.bind(this)),this.renderer.removeEventListener(ci.WARPEDMAPLEAVE,this.passWarpedMapEvent.bind(this)),this.renderer.tileCache.removeEventListener(ci.FIRSTMAPTILELOADED,this.passWarpedMapEvent.bind(this)),this.renderer.tileCache.removeEventListener(ci.ALLREQUESTEDTILESLOADED,this.passWarpedMapEvent.bind(this)),this.renderer.warpedMapList.removeEventListener(ci.GEOREFERENCEANNOTATIONADDED,this.passWarpedMapEvent.bind(this)),this.renderer.warpedMapList.removeEventListener(ci.WARPEDMAPADDED,this.passWarpedMapEvent.bind(this)),this.renderer.warpedMapList.removeEventListener(ci.WARPEDMAPREMOVED,this.passWarpedMapEvent.bind(this)),this.renderer.warpedMapList.removeEventListener(ci.VISIBILITYCHANGED,this.render.bind(this)),this.renderer.warpedMapList.removeEventListener(ci.CLEARED,this.render.bind(this)))}passWarpedMapEvent(e){e instanceof yr&&this.map&&this.map.fire(e.type,e.data)}}function WT(r,e,i){if(r!==null)for(var s,h,x,m,o,P,L,D=0,F=0,Y,V=r.type,H=V==="FeatureCollection",ve=V==="Feature",_e=H?r.features.length:1,oe=0;oe<_e;oe++){L=H?r.features[oe].geometry:ve?r.geometry:r,Y=L?L.type==="GeometryCollection":!1,o=Y?L.geometries.length:1;for(var fe=0;fe<o;fe++){var K=0,ne=0;if(m=Y?L.geometries[fe]:L,m!==null){P=m.coordinates;var ye=m.type;switch(D=0,ye){case null:break;case"Point":if(e(P,F,oe,K,ne)===!1)return!1;F++,K++;break;case"LineString":case"MultiPoint":for(s=0;s<P.length;s++){if(e(P[s],F,oe,K,ne)===!1)return!1;F++,ye==="MultiPoint"&&K++}ye==="LineString"&&K++;break;case"Polygon":case"MultiLineString":for(s=0;s<P.length;s++){for(h=0;h<P[s].length-D;h++){if(e(P[s][h],F,oe,K,ne)===!1)return!1;F++}ye==="MultiLineString"&&K++,ye==="Polygon"&&ne++}ye==="Polygon"&&K++;break;case"MultiPolygon":for(s=0;s<P.length;s++){for(ne=0,h=0;h<P[s].length;h++){for(x=0;x<P[s][h].length-D;x++){if(e(P[s][h][x],F,oe,K,ne)===!1)return!1;F++}ne++}K++}break;case"GeometryCollection":for(s=0;s<m.geometries.length;s++)if(WT(m.geometries[s],e)===!1)return!1;break;default:throw new Error("Unknown Geometry Type")}}}}}function P1(r,e){if(r.type==="Feature")e(r,0);else if(r.type==="FeatureCollection")for(var i=0;i<r.features.length&&e(r.features[i],i)!==!1;i++);}function YT(r,e){var i,s,h,x,m,o,P,L,D,F,Y=0,V=r.type==="FeatureCollection",H=r.type==="Feature",ve=V?r.features.length:1;for(i=0;i<ve;i++){for(o=V?r.features[i].geometry:H?r.geometry:r,L=V?r.features[i].properties:H?r.properties:{},D=V?r.features[i].bbox:H?r.bbox:void 0,F=V?r.features[i].id:H?r.id:void 0,P=o?o.type==="GeometryCollection":!1,m=P?o.geometries.length:1,h=0;h<m;h++){if(x=P?o.geometries[h]:o,x===null){if(e(null,Y,L,D,F)===!1)return!1;continue}switch(x.type){case"Point":case"LineString":case"MultiPoint":case"Polygon":case"MultiLineString":case"MultiPolygon":{if(e(x,Y,L,D,F)===!1)return!1;break}case"GeometryCollection":{for(s=0;s<x.geometries.length;s++)if(e(x.geometries[s],Y,L,D,F)===!1)return!1;break}default:throw new Error("Unknown Geometry Type")}}Y++}}function e_(r,e={}){if(r.bbox!=null&&e.recompute!==!0)return r.bbox;const i=[1/0,1/0,-1/0,-1/0];return WT(r,s=>{i[0]>s[0]&&(i[0]=s[0]),i[1]>s[1]&&(i[1]=s[1]),i[2]<s[0]&&(i[2]=s[0]),i[3]<s[1]&&(i[3]=s[1])}),i}var wo=63710088e-1,XT={centimeters:wo*100,centimetres:wo*100,degrees:360/(2*Math.PI),feet:wo*3.28084,inches:wo*39.37,kilometers:wo/1e3,kilometres:wo/1e3,meters:wo,metres:wo,miles:wo/1609.344,millimeters:wo*1e3,millimetres:wo*1e3,nauticalmiles:wo/1852,radians:1,yards:wo*1.0936};function tv(r,e,i={}){const s={type:"Feature"};return(i.id===0||i.id)&&(s.id=i.id),i.bbox&&(s.bbox=i.bbox),s.properties=e||{},s.geometry=r,s}function iD(r,e,i={}){if(!r)throw new Error("coordinates is required");if(!Array.isArray(r))throw new Error("coordinates must be an Array");if(r.length<2)throw new Error("coordinates must be at least 2 numbers long");if(!k1(r[0])||!k1(r[1]))throw new Error("coordinates must contain numbers");return tv({type:"Point",coordinates:r},e,i)}function rD(r,e,i={}){for(const s of r){if(s.length<4)throw new Error("Each LinearRing of a Polygon must have 4 or more Positions.");if(s[s.length-1].length!==s[0].length)throw new Error("First and last Position are not equivalent.");for(let h=0;h<s[s.length-1].length;h++)if(s[s.length-1][h]!==s[0][h])throw new Error("First and last Position are not equivalent.")}return tv({type:"Polygon",coordinates:r},e,i)}function t_(r,e={}){const i={type:"FeatureCollection"};return e.id&&(i.id=e.id),e.bbox&&(i.bbox=e.bbox),i.features=r,i}function nD(r,e="kilometers"){const i=XT[e];if(!i)throw new Error(e+" units is invalid");return r*i}function sD(r,e="kilometers"){const i=XT[e];if(!i)throw new Error(e+" units is invalid");return r/i}function k1(r){return!isNaN(r)&&r!==null&&!Array.isArray(r)}function oD(r,e={}){const i=Number(r[0]),s=Number(r[1]),h=Number(r[2]),x=Number(r[3]);if(r.length===6)throw new Error("@turf/bbox-polygon does not support BBox with 6 positions");const m=[i,s];return rD([[m,[h,s],[h,x],[i,x],m]],e.properties,{bbox:r,id:e.id})}function aD(r,e={}){const i=e_(r),s=(i[0]+i[2])/2,h=(i[1]+i[3])/2;return iD([s,h],e.properties,e)}var qf={exports:{}},lD=qf.exports,C1;function uD(){return C1||(C1=1,function(r,e){(function(i,s){r.exports=s()})(lD,function(){function i(v,c){(c==null||c>v.length)&&(c=v.length);for(var d=0,_=Array(c);d<c;d++)_[d]=v[d];return _}function s(v,c,d){return c=D(c),function(_,S){if(S&&(typeof S=="object"||typeof S=="function"))return S;if(S!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return function(N){if(N===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return N}(_)}(v,Y()?Reflect.construct(c,d||[],D(v).constructor):c.apply(v,d))}function h(v,c){if(!(v instanceof c))throw new TypeError("Cannot call a class as a function")}function x(v,c,d){if(Y())return Reflect.construct.apply(null,arguments);var _=[null];_.push.apply(_,c);var S=new(v.bind.apply(v,_));return d&&V(S,d.prototype),S}function m(v,c){for(var d=0;d<c.length;d++){var _=c[d];_.enumerable=_.enumerable||!1,_.configurable=!0,"value"in _&&(_.writable=!0),Object.defineProperty(v,_e(_.key),_)}}function o(v,c,d){return c&&m(v.prototype,c),d&&m(v,d),Object.defineProperty(v,"prototype",{writable:!1}),v}function P(v,c){var d=typeof Symbol<"u"&&v[Symbol.iterator]||v["@@iterator"];if(!d){if(Array.isArray(v)||(d=oe(v))||c){d&&(v=d);var _=0,S=function(){};return{s:S,n:function(){return _>=v.length?{done:!0}:{done:!1,value:v[_++]}},e:function(ge){throw ge},f:S}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var N,U=!0,J=!1;return{s:function(){d=d.call(v)},n:function(){var ge=d.next();return U=ge.done,ge},e:function(ge){J=!0,N=ge},f:function(){try{U||d.return==null||d.return()}finally{if(J)throw N}}}}function L(){return L=typeof Reflect<"u"&&Reflect.get?Reflect.get.bind():function(v,c,d){var _=function(N,U){for(;!{}.hasOwnProperty.call(N,U)&&(N=D(N))!==null;);return N}(v,c);if(_){var S=Object.getOwnPropertyDescriptor(_,c);return S.get?S.get.call(arguments.length<3?v:d):S.value}},L.apply(null,arguments)}function D(v){return D=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(c){return c.__proto__||Object.getPrototypeOf(c)},D(v)}function F(v,c){if(typeof c!="function"&&c!==null)throw new TypeError("Super expression must either be null or a function");v.prototype=Object.create(c&&c.prototype,{constructor:{value:v,writable:!0,configurable:!0}}),Object.defineProperty(v,"prototype",{writable:!1}),c&&V(v,c)}function Y(){try{var v=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(Y=function(){return!!v})()}function V(v,c){return V=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(d,_){return d.__proto__=_,d},V(v,c)}function H(v,c,d,_){var S=L(D(1&_?v.prototype:v),c,d);return 2&_&&typeof S=="function"?function(N){return S.apply(d,N)}:S}function ve(v){return function(c){if(Array.isArray(c))return i(c)}(v)||function(c){if(typeof Symbol<"u"&&c[Symbol.iterator]!=null||c["@@iterator"]!=null)return Array.from(c)}(v)||oe(v)||function(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}()}function _e(v){var c=function(d,_){if(typeof d!="object"||!d)return d;var S=d[Symbol.toPrimitive];if(S!==void 0){var N=S.call(d,_);if(typeof N!="object")return N;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(d)}(v,"string");return typeof c=="symbol"?c:c+""}function oe(v,c){if(v){if(typeof v=="string")return i(v,c);var d={}.toString.call(v).slice(8,-1);return d==="Object"&&v.constructor&&(d=v.constructor.name),d==="Map"||d==="Set"?Array.from(v):d==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(d)?i(v,c):void 0}}function fe(v){var c=typeof Map=="function"?new Map:void 0;return fe=function(d){if(d===null||!function(S){try{return Function.toString.call(S).indexOf("[native code]")!==-1}catch{return typeof S=="function"}}(d))return d;if(typeof d!="function")throw new TypeError("Super expression must either be null or a function");if(c!==void 0){if(c.has(d))return c.get(d);c.set(d,_)}function _(){return x(d,arguments,D(this).constructor)}return _.prototype=Object.create(d.prototype,{constructor:{value:_,enumerable:!1,writable:!0,configurable:!0}}),V(_,d)},fe(v)}var K=function(){function v(){h(this,v),v.constructor_.apply(this,arguments)}return o(v,[{key:"getEndCapStyle",value:function(){return this._endCapStyle}},{key:"isSingleSided",value:function(){return this._isSingleSided}},{key:"setQuadrantSegments",value:function(c){this._quadrantSegments=c,this._quadrantSegments===0&&(this._joinStyle=v.JOIN_BEVEL),this._quadrantSegments<0&&(this._joinStyle=v.JOIN_MITRE,this._mitreLimit=Math.abs(this._quadrantSegments)),c<=0&&(this._quadrantSegments=1),this._joinStyle!==v.JOIN_ROUND&&(this._quadrantSegments=v.DEFAULT_QUADRANT_SEGMENTS)}},{key:"getJoinStyle",value:function(){return this._joinStyle}},{key:"setJoinStyle",value:function(c){this._joinStyle=c}},{key:"setSimplifyFactor",value:function(c){this._simplifyFactor=c<0?0:c}},{key:"getSimplifyFactor",value:function(){return this._simplifyFactor}},{key:"getQuadrantSegments",value:function(){return this._quadrantSegments}},{key:"setEndCapStyle",value:function(c){this._endCapStyle=c}},{key:"getMitreLimit",value:function(){return this._mitreLimit}},{key:"setMitreLimit",value:function(c){this._mitreLimit=c}},{key:"setSingleSided",value:function(c){this._isSingleSided=c}}],[{key:"constructor_",value:function(){if(this._quadrantSegments=v.DEFAULT_QUADRANT_SEGMENTS,this._endCapStyle=v.CAP_ROUND,this._joinStyle=v.JOIN_ROUND,this._mitreLimit=v.DEFAULT_MITRE_LIMIT,this._isSingleSided=!1,this._simplifyFactor=v.DEFAULT_SIMPLIFY_FACTOR,arguments.length!==0){if(arguments.length===1){var c=arguments[0];this.setQuadrantSegments(c)}else if(arguments.length===2){var d=arguments[0],_=arguments[1];this.setQuadrantSegments(d),this.setEndCapStyle(_)}else if(arguments.length===4){var S=arguments[0],N=arguments[1],U=arguments[2],J=arguments[3];this.setQuadrantSegments(S),this.setEndCapStyle(N),this.setJoinStyle(U),this.setMitreLimit(J)}}}},{key:"bufferDistanceError",value:function(c){var d=Math.PI/2/c;return 1-Math.cos(d/2)}}])}();K.CAP_ROUND=1,K.CAP_FLAT=2,K.CAP_SQUARE=3,K.JOIN_ROUND=1,K.JOIN_MITRE=2,K.JOIN_BEVEL=3,K.DEFAULT_QUADRANT_SEGMENTS=8,K.DEFAULT_MITRE_LIMIT=5,K.DEFAULT_SIMPLIFY_FACTOR=.01;var ne=function(v){function c(d){var _;return h(this,c),(_=s(this,c,[d])).name=Object.keys({Exception:c})[0],_}return F(c,v),o(c,[{key:"toString",value:function(){return this.message}}])}(fe(Error)),ye=function(v){function c(d){var _;return h(this,c),(_=s(this,c,[d])).name=Object.keys({IllegalArgumentException:c})[0],_}return F(c,v),o(c)}(ne),Re=function(){return o(function v(){h(this,v)},[{key:"filter",value:function(v){}}])}();function Se(){}function Z(){}function $(){}var Q,ue,he,Pe,Ae,ke,Be,Ke,tt=function(){return o(function v(){h(this,v)},null,[{key:"equalsWithTolerance",value:function(v,c,d){return Math.abs(v-c)<=d}}])}(),pt=function(){return o(function v(c,d){h(this,v),this.low=d||0,this.high=c||0},null,[{key:"toBinaryString",value:function(v){var c,d="";for(c=2147483648;c>0;c>>>=1)d+=(v.high&c)===c?"1":"0";for(c=2147483648;c>0;c>>>=1)d+=(v.low&c)===c?"1":"0";return d}}])}();function vt(){}function Ft(){}vt.NaN=NaN,vt.isNaN=function(v){return Number.isNaN(v)},vt.isInfinite=function(v){return!Number.isFinite(v)},vt.MAX_VALUE=Number.MAX_VALUE,vt.POSITIVE_INFINITY=Number.POSITIVE_INFINITY,vt.NEGATIVE_INFINITY=Number.NEGATIVE_INFINITY,typeof Float64Array=="function"&&typeof Int32Array=="function"?(ke=2146435072,Be=new Float64Array(1),Ke=new Int32Array(Be.buffer),vt.doubleToLongBits=function(v){Be[0]=v;var c=0|Ke[0],d=0|Ke[1];return(d&ke)===ke&&1048575&d&&c!==0&&(c=0,d=2146959360),new pt(d,c)},vt.longBitsToDouble=function(v){return Ke[0]=v.low,Ke[1]=v.high,Be[0]}):(Q=1023,ue=Math.log2,he=Math.floor,Pe=Math.pow,Ae=function(){for(var v=53;v>0;v--){var c=Pe(2,v)-1;if(he(ue(c))+1===v)return c}return 0}(),vt.doubleToLongBits=function(v){var c,d,_,S,N,U,J,ge,Ie;if(v<0||1/v===Number.NEGATIVE_INFINITY?(U=1<<31,v=-v):U=0,v===0)return new pt(ge=U,Ie=0);if(v===1/0)return new pt(ge=2146435072|U,Ie=0);if(v!=v)return new pt(ge=2146959360,Ie=0);if(S=0,Ie=0,(c=he(v))>1)if(c<=Ae)(S=he(ue(c)))<=20?(Ie=0,ge=c<<20-S&1048575):(Ie=c%(d=Pe(2,_=S-20))<<32-_,ge=c/d&1048575);else for(_=c,Ie=0;(_=he(d=_/2))!==0;)S++,Ie>>>=1,Ie|=(1&ge)<<31,ge>>>=1,d!==_&&(ge|=524288);if(J=S+Q,N=c===0,c=v-c,S<52&&c!==0)for(_=0;;){if((d=2*c)>=1?(c=d-1,N?(J--,N=!1):(_<<=1,_|=1,S++)):(c=d,N?--J==0&&(S++,N=!1):(_<<=1,S++)),S===20)ge|=_,_=0;else if(S===52){Ie|=_;break}if(d===1){S<20?ge|=_<<20-S:S<52&&(Ie|=_<<52-S);break}}return ge|=J<<20,new pt(ge|=U,Ie)},vt.longBitsToDouble=function(v){var c,d,_,S,N=v.high,U=v.low,J=N&1<<31?-1:1;for(_=((2146435072&N)>>20)-Q,S=0,d=1<<19,c=1;c<=20;c++)N&d&&(S+=Pe(2,-c)),d>>>=1;for(d=1<<31,c=21;c<=52;c++)U&d&&(S+=Pe(2,-c)),d>>>=1;if(_===-1023){if(S===0)return 0*J;_=-1022}else{if(_===1024)return S===0?J/0:NaN;S+=1}return J*S*Pe(2,_)});var It=function(v){function c(d){var _;return h(this,c),(_=s(this,c,[d])).name=Object.keys({RuntimeException:c})[0],_}return F(c,v),o(c)}(ne),Zt=function(v){function c(){var d;return h(this,c),d=s(this,c),c.constructor_.apply(d,arguments),d}return F(c,v),o(c,null,[{key:"constructor_",value:function(){if(arguments.length===0)It.constructor_.call(this);else if(arguments.length===1){var d=arguments[0];It.constructor_.call(this,d)}}}])}(It),zt=function(){function v(){h(this,v)}return o(v,null,[{key:"shouldNeverReachHere",value:function(){if(arguments.length===0)v.shouldNeverReachHere(null);else if(arguments.length===1){var c=arguments[0];throw new Zt("Should never reach here"+(c!==null?": "+c:""))}}},{key:"isTrue",value:function(){if(arguments.length===1){var c=arguments[0];v.isTrue(c,null)}else if(arguments.length===2){var d=arguments[1];if(!arguments[0])throw d===null?new Zt:new Zt(d)}}},{key:"equals",value:function(){if(arguments.length===2){var c=arguments[0],d=arguments[1];v.equals(c,d,null)}else if(arguments.length===3){var _=arguments[0],S=arguments[1],N=arguments[2];if(!S.equals(_))throw new Zt("Expected "+_+" but encountered "+S+(N!==null?": "+N:""))}}}])}(),ti=new ArrayBuffer(8),ai=new Float64Array(ti),Ir=new Int32Array(ti),lt=function(){function v(){h(this,v),v.constructor_.apply(this,arguments)}return o(v,[{key:"getM",value:function(){return vt.NaN}},{key:"setOrdinate",value:function(c,d){switch(c){case v.X:this.x=d;break;case v.Y:this.y=d;break;case v.Z:this.setZ(d);break;default:throw new ye("Invalid ordinate index: "+c)}}},{key:"equals2D",value:function(){if(arguments.length===1){var c=arguments[0];return this.x===c.x&&this.y===c.y}if(arguments.length===2){var d=arguments[0],_=arguments[1];return!!tt.equalsWithTolerance(this.x,d.x,_)&&!!tt.equalsWithTolerance(this.y,d.y,_)}}},{key:"setM",value:function(c){throw new ye("Invalid ordinate index: "+v.M)}},{key:"getZ",value:function(){return this.z}},{key:"getOrdinate",value:function(c){switch(c){case v.X:return this.x;case v.Y:return this.y;case v.Z:return this.getZ()}throw new ye("Invalid ordinate index: "+c)}},{key:"equals3D",value:function(c){return this.x===c.x&&this.y===c.y&&(this.getZ()===c.getZ()||vt.isNaN(this.getZ())&&vt.isNaN(c.getZ()))}},{key:"equals",value:function(c){return c instanceof v&&this.equals2D(c)}},{key:"equalInZ",value:function(c,d){return tt.equalsWithTolerance(this.getZ(),c.getZ(),d)}},{key:"setX",value:function(c){this.x=c}},{key:"compareTo",value:function(c){var d=c;return this.x<d.x?-1:this.x>d.x?1:this.y<d.y?-1:this.y>d.y?1:0}},{key:"getX",value:function(){return this.x}},{key:"setZ",value:function(c){this.z=c}},{key:"clone",value:function(){try{return null}catch(c){if(c instanceof CloneNotSupportedException)return zt.shouldNeverReachHere("this shouldn't happen because this class is Cloneable"),null;throw c}}},{key:"copy",value:function(){return new v(this)}},{key:"toString",value:function(){return"("+this.x+", "+this.y+", "+this.getZ()+")"}},{key:"distance3D",value:function(c){var d=this.x-c.x,_=this.y-c.y,S=this.getZ()-c.getZ();return Math.sqrt(d*d+_*_+S*S)}},{key:"getY",value:function(){return this.y}},{key:"setY",value:function(c){this.y=c}},{key:"distance",value:function(c){var d=this.x-c.x,_=this.y-c.y;return Math.sqrt(d*d+_*_)}},{key:"hashCode",value:function(){var c=17;return c=37*(c=37*c+v.hashCode(this.x))+v.hashCode(this.y)}},{key:"setCoordinate",value:function(c){this.x=c.x,this.y=c.y,this.z=c.getZ()}},{key:"interfaces_",get:function(){return[Se,Z,$]}}],[{key:"constructor_",value:function(){if(this.x=null,this.y=null,this.z=null,arguments.length===0)v.constructor_.call(this,0,0);else if(arguments.length===1){var c=arguments[0];v.constructor_.call(this,c.x,c.y,c.getZ())}else if(arguments.length===2){var d=arguments[0],_=arguments[1];v.constructor_.call(this,d,_,v.NULL_ORDINATE)}else if(arguments.length===3){var S=arguments[0],N=arguments[1],U=arguments[2];this.x=S,this.y=N,this.z=U}}},{key:"hashCode",value:function(c){return ai[0]=c,Ir[0]^Ir[1]}}])}(),Xi=function(){function v(){h(this,v),v.constructor_.apply(this,arguments)}return o(v,[{key:"compare",value:function(c,d){var _=v.compare(c.x,d.x);if(_!==0)return _;var S=v.compare(c.y,d.y);return S!==0?S:this._dimensionsToTest<=2?0:v.compare(c.getZ(),d.getZ())}},{key:"interfaces_",get:function(){return[Ft]}}],[{key:"constructor_",value:function(){if(this._dimensionsToTest=2,arguments.length===0)v.constructor_.call(this,2);else if(arguments.length===1){var c=arguments[0];if(c!==2&&c!==3)throw new ye("only 2 or 3 dimensions may be specified");this._dimensionsToTest=c}}},{key:"compare",value:function(c,d){return c<d?-1:c>d?1:vt.isNaN(c)?vt.isNaN(d)?0:-1:vt.isNaN(d)?1:0}}])}();lt.DimensionalComparator=Xi,lt.NULL_ORDINATE=vt.NaN,lt.X=0,lt.Y=1,lt.Z=2,lt.M=3;var ii=function(){function v(){h(this,v),v.constructor_.apply(this,arguments)}return o(v,[{key:"getArea",value:function(){return this.getWidth()*this.getHeight()}},{key:"equals",value:function(c){if(!(c instanceof v))return!1;var d=c;return this.isNull()?d.isNull():this._maxx===d.getMaxX()&&this._maxy===d.getMaxY()&&this._minx===d.getMinX()&&this._miny===d.getMinY()}},{key:"intersection",value:function(c){if(this.isNull()||c.isNull()||!this.intersects(c))return new v;var d=this._minx>c._minx?this._minx:c._minx,_=this._miny>c._miny?this._miny:c._miny;return new v(d,this._maxx<c._maxx?this._maxx:c._maxx,_,this._maxy<c._maxy?this._maxy:c._maxy)}},{key:"isNull",value:function(){return this._maxx<this._minx}},{key:"getMaxX",value:function(){return this._maxx}},{key:"covers",value:function(){if(arguments.length===1){if(arguments[0]instanceof lt){var c=arguments[0];return this.covers(c.x,c.y)}if(arguments[0]instanceof v){var d=arguments[0];return!this.isNull()&&!d.isNull()&&d.getMinX()>=this._minx&&d.getMaxX()<=this._maxx&&d.getMinY()>=this._miny&&d.getMaxY()<=this._maxy}}else if(arguments.length===2){var _=arguments[0],S=arguments[1];return!this.isNull()&&_>=this._minx&&_<=this._maxx&&S>=this._miny&&S<=this._maxy}}},{key:"intersects",value:function(){if(arguments.length===1){if(arguments[0]instanceof v){var c=arguments[0];return!this.isNull()&&!c.isNull()&&!(c._minx>this._maxx||c._maxx<this._minx||c._miny>this._maxy||c._maxy<this._miny)}if(arguments[0]instanceof lt){var d=arguments[0];return this.intersects(d.x,d.y)}}else if(arguments.length===2){if(arguments[0]instanceof lt&&arguments[1]instanceof lt){var _=arguments[0],S=arguments[1];return!this.isNull()&&!((_.x<S.x?_.x:S.x)>this._maxx)&&!((_.x>S.x?_.x:S.x)<this._minx)&&!((_.y<S.y?_.y:S.y)>this._maxy)&&!((_.y>S.y?_.y:S.y)<this._miny)}if(typeof arguments[0]=="number"&&typeof arguments[1]=="number"){var N=arguments[0],U=arguments[1];return!this.isNull()&&!(N>this._maxx||N<this._minx||U>this._maxy||U<this._miny)}}}},{key:"getMinY",value:function(){return this._miny}},{key:"getDiameter",value:function(){if(this.isNull())return 0;var c=this.getWidth(),d=this.getHeight();return Math.sqrt(c*c+d*d)}},{key:"getMinX",value:function(){return this._minx}},{key:"expandToInclude",value:function(){if(arguments.length===1){if(arguments[0]instanceof lt){var c=arguments[0];this.expandToInclude(c.x,c.y)}else if(arguments[0]instanceof v){var d=arguments[0];if(d.isNull())return null;this.isNull()?(this._minx=d.getMinX(),this._maxx=d.getMaxX(),this._miny=d.getMinY(),this._maxy=d.getMaxY()):(d._minx<this._minx&&(this._minx=d._minx),d._maxx>this._maxx&&(this._maxx=d._maxx),d._miny<this._miny&&(this._miny=d._miny),d._maxy>this._maxy&&(this._maxy=d._maxy))}}else if(arguments.length===2){var _=arguments[0],S=arguments[1];this.isNull()?(this._minx=_,this._maxx=_,this._miny=S,this._maxy=S):(_<this._minx&&(this._minx=_),_>this._maxx&&(this._maxx=_),S<this._miny&&(this._miny=S),S>this._maxy&&(this._maxy=S))}}},{key:"minExtent",value:function(){if(this.isNull())return 0;var c=this.getWidth(),d=this.getHeight();return c<d?c:d}},{key:"getWidth",value:function(){return this.isNull()?0:this._maxx-this._minx}},{key:"compareTo",value:function(c){var d=c;return this.isNull()?d.isNull()?0:-1:d.isNull()?1:this._minx<d._minx?-1:this._minx>d._minx?1:this._miny<d._miny?-1:this._miny>d._miny?1:this._maxx<d._maxx?-1:this._maxx>d._maxx?1:this._maxy<d._maxy?-1:this._maxy>d._maxy?1:0}},{key:"translate",value:function(c,d){if(this.isNull())return null;this.init(this.getMinX()+c,this.getMaxX()+c,this.getMinY()+d,this.getMaxY()+d)}},{key:"copy",value:function(){return new v(this)}},{key:"toString",value:function(){return"Env["+this._minx+" : "+this._maxx+", "+this._miny+" : "+this._maxy+"]"}},{key:"setToNull",value:function(){this._minx=0,this._maxx=-1,this._miny=0,this._maxy=-1}},{key:"disjoint",value:function(c){return!(!this.isNull()&&!c.isNull())||c._minx>this._maxx||c._maxx<this._minx||c._miny>this._maxy||c._maxy<this._miny}},{key:"getHeight",value:function(){return this.isNull()?0:this._maxy-this._miny}},{key:"maxExtent",value:function(){if(this.isNull())return 0;var c=this.getWidth(),d=this.getHeight();return c>d?c:d}},{key:"expandBy",value:function(){if(arguments.length===1){var c=arguments[0];this.expandBy(c,c)}else if(arguments.length===2){var d=arguments[0],_=arguments[1];if(this.isNull())return null;this._minx-=d,this._maxx+=d,this._miny-=_,this._maxy+=_,(this._minx>this._maxx||this._miny>this._maxy)&&this.setToNull()}}},{key:"contains",value:function(){if(arguments.length===1){if(arguments[0]instanceof v){var c=arguments[0];return this.covers(c)}if(arguments[0]instanceof lt){var d=arguments[0];return this.covers(d)}}else if(arguments.length===2){var _=arguments[0],S=arguments[1];return this.covers(_,S)}}},{key:"centre",value:function(){return this.isNull()?null:new lt((this.getMinX()+this.getMaxX())/2,(this.getMinY()+this.getMaxY())/2)}},{key:"init",value:function(){if(arguments.length===0)this.setToNull();else if(arguments.length===1){if(arguments[0]instanceof lt){var c=arguments[0];this.init(c.x,c.x,c.y,c.y)}else if(arguments[0]instanceof v){var d=arguments[0];this._minx=d._minx,this._maxx=d._maxx,this._miny=d._miny,this._maxy=d._maxy}}else if(arguments.length===2){var _=arguments[0],S=arguments[1];this.init(_.x,S.x,_.y,S.y)}else if(arguments.length===4){var N=arguments[0],U=arguments[1],J=arguments[2],ge=arguments[3];N<U?(this._minx=N,this._maxx=U):(this._minx=U,this._maxx=N),J<ge?(this._miny=J,this._maxy=ge):(this._miny=ge,this._maxy=J)}}},{key:"getMaxY",value:function(){return this._maxy}},{key:"distance",value:function(c){if(this.intersects(c))return 0;var d=0;this._maxx<c._minx?d=c._minx-this._maxx:this._minx>c._maxx&&(d=this._minx-c._maxx);var _=0;return this._maxy<c._miny?_=c._miny-this._maxy:this._miny>c._maxy&&(_=this._miny-c._maxy),d===0?_:_===0?d:Math.sqrt(d*d+_*_)}},{key:"hashCode",value:function(){var c=17;return c=37*(c=37*(c=37*(c=37*c+lt.hashCode(this._minx))+lt.hashCode(this._maxx))+lt.hashCode(this._miny))+lt.hashCode(this._maxy)}},{key:"interfaces_",get:function(){return[Se,$]}}],[{key:"constructor_",value:function(){if(this._minx=null,this._maxx=null,this._miny=null,this._maxy=null,arguments.length===0)this.init();else if(arguments.length===1){if(arguments[0]instanceof lt){var c=arguments[0];this.init(c.x,c.x,c.y,c.y)}else if(arguments[0]instanceof v){var d=arguments[0];this.init(d)}}else if(arguments.length===2){var _=arguments[0],S=arguments[1];this.init(_.x,S.x,_.y,S.y)}else if(arguments.length===4){var N=arguments[0],U=arguments[1],J=arguments[2],ge=arguments[3];this.init(N,U,J,ge)}}},{key:"intersects",value:function(){if(arguments.length===3){var c=arguments[0],d=arguments[1],_=arguments[2];return _.x>=(c.x<d.x?c.x:d.x)&&_.x<=(c.x>d.x?c.x:d.x)&&_.y>=(c.y<d.y?c.y:d.y)&&_.y<=(c.y>d.y?c.y:d.y)}if(arguments.length===4){var S=arguments[0],N=arguments[1],U=arguments[2],J=arguments[3],ge=Math.min(U.x,J.x),Ie=Math.max(U.x,J.x),st=Math.min(S.x,N.x),ht=Math.max(S.x,N.x);return!(st>Ie)&&!(ht<ge)&&(ge=Math.min(U.y,J.y),Ie=Math.max(U.y,J.y),st=Math.min(S.y,N.y),ht=Math.max(S.y,N.y),!(st>Ie)&&!(ht<ge))}}}])}(),Jt=function(){function v(){h(this,v),v.constructor_.apply(this,arguments)}return o(v,[{key:"isGeometryCollection",value:function(){return this.getTypeCode()===v.TYPECODE_GEOMETRYCOLLECTION}},{key:"getFactory",value:function(){return this._factory}},{key:"getGeometryN",value:function(c){return this}},{key:"getArea",value:function(){return 0}},{key:"isRectangle",value:function(){return!1}},{key:"equalsExact",value:function(c){return this===c||this.equalsExact(c,0)}},{key:"geometryChanged",value:function(){this.apply(v.geometryChangedFilter)}},{key:"geometryChangedAction",value:function(){this._envelope=null}},{key:"equalsNorm",value:function(c){return c!==null&&this.norm().equalsExact(c.norm())}},{key:"getLength",value:function(){return 0}},{key:"getNumGeometries",value:function(){return 1}},{key:"compareTo",value:function(){var c;if(arguments.length===1){var d=arguments[0];return c=d,this.getTypeCode()!==c.getTypeCode()?this.getTypeCode()-c.getTypeCode():this.isEmpty()&&c.isEmpty()?0:this.isEmpty()?-1:c.isEmpty()?1:this.compareToSameClass(d)}if(arguments.length===2){var _=arguments[0],S=arguments[1];return c=_,this.getTypeCode()!==c.getTypeCode()?this.getTypeCode()-c.getTypeCode():this.isEmpty()&&c.isEmpty()?0:this.isEmpty()?-1:c.isEmpty()?1:this.compareToSameClass(_,S)}}},{key:"getUserData",value:function(){return this._userData}},{key:"getSRID",value:function(){return this._SRID}},{key:"getEnvelope",value:function(){return this.getFactory().toGeometry(this.getEnvelopeInternal())}},{key:"checkNotGeometryCollection",value:function(c){if(c.getTypeCode()===v.TYPECODE_GEOMETRYCOLLECTION)throw new ye("This method does not support GeometryCollection arguments")}},{key:"equal",value:function(c,d,_){return _===0?c.equals(d):c.distance(d)<=_}},{key:"norm",value:function(){var c=this.copy();return c.normalize(),c}},{key:"reverse",value:function(){var c=this.reverseInternal();return this.envelope!=null&&(c.envelope=this.envelope.copy()),c.setSRID(this.getSRID()),c}},{key:"copy",value:function(){var c=this.copyInternal();return c.envelope=this._envelope==null?null:this._envelope.copy(),c._SRID=this._SRID,c._userData=this._userData,c}},{key:"getPrecisionModel",value:function(){return this._factory.getPrecisionModel()}},{key:"getEnvelopeInternal",value:function(){return this._envelope===null&&(this._envelope=this.computeEnvelopeInternal()),new ii(this._envelope)}},{key:"setSRID",value:function(c){this._SRID=c}},{key:"setUserData",value:function(c){this._userData=c}},{key:"compare",value:function(c,d){for(var _=c.iterator(),S=d.iterator();_.hasNext()&&S.hasNext();){var N=_.next(),U=S.next(),J=N.compareTo(U);if(J!==0)return J}return _.hasNext()?1:S.hasNext()?-1:0}},{key:"hashCode",value:function(){return this.getEnvelopeInternal().hashCode()}},{key:"isEquivalentClass",value:function(c){return this.getClass()===c.getClass()}},{key:"isGeometryCollectionOrDerived",value:function(){return this.getTypeCode()===v.TYPECODE_GEOMETRYCOLLECTION||this.getTypeCode()===v.TYPECODE_MULTIPOINT||this.getTypeCode()===v.TYPECODE_MULTILINESTRING||this.getTypeCode()===v.TYPECODE_MULTIPOLYGON}},{key:"interfaces_",get:function(){return[Z,Se,$]}},{key:"getClass",value:function(){return v}}],[{key:"hasNonEmptyElements",value:function(c){for(var d=0;d<c.length;d++)if(!c[d].isEmpty())return!0;return!1}},{key:"hasNullElements",value:function(c){for(var d=0;d<c.length;d++)if(c[d]===null)return!0;return!1}}])}();Jt.constructor_=function(v){v&&(this._envelope=null,this._userData=null,this._factory=v,this._SRID=v.getSRID())},Jt.TYPECODE_POINT=0,Jt.TYPECODE_MULTIPOINT=1,Jt.TYPECODE_LINESTRING=2,Jt.TYPECODE_LINEARRING=3,Jt.TYPECODE_MULTILINESTRING=4,Jt.TYPECODE_POLYGON=5,Jt.TYPECODE_MULTIPOLYGON=6,Jt.TYPECODE_GEOMETRYCOLLECTION=7,Jt.TYPENAME_POINT="Point",Jt.TYPENAME_MULTIPOINT="MultiPoint",Jt.TYPENAME_LINESTRING="LineString",Jt.TYPENAME_LINEARRING="LinearRing",Jt.TYPENAME_MULTILINESTRING="MultiLineString",Jt.TYPENAME_POLYGON="Polygon",Jt.TYPENAME_MULTIPOLYGON="MultiPolygon",Jt.TYPENAME_GEOMETRYCOLLECTION="GeometryCollection",Jt.geometryChangedFilter={get interfaces_(){return[Re]},filter:function(v){v.geometryChangedAction()}};var $e=function(){function v(){h(this,v)}return o(v,null,[{key:"toLocationSymbol",value:function(c){switch(c){case v.EXTERIOR:return"e";case v.BOUNDARY:return"b";case v.INTERIOR:return"i";case v.NONE:return"-"}throw new ye("Unknown location value: "+c)}}])}();$e.INTERIOR=0,$e.BOUNDARY=1,$e.EXTERIOR=2,$e.NONE=-1;var zi=function(){return o(function v(){h(this,v)},[{key:"add",value:function(){}},{key:"addAll",value:function(){}},{key:"isEmpty",value:function(){}},{key:"iterator",value:function(){}},{key:"size",value:function(){}},{key:"toArray",value:function(){}},{key:"remove",value:function(){}}])}(),Qi=function(v){function c(d){var _;return h(this,c),(_=s(this,c,[d])).name=Object.keys({NoSuchElementException:c})[0],_}return F(c,v),o(c)}(ne),Gi=function(v){function c(d){var _;return h(this,c),(_=s(this,c,[d])).name=Object.keys({UnsupportedOperationException:c})[0],_}return F(c,v),o(c)}(ne),sr=function(v){function c(){return h(this,c),s(this,c,arguments)}return F(c,v),o(c,[{key:"contains",value:function(){}}])}(zi),jr=function(v){function c(d){var _;return h(this,c),(_=s(this,c)).map=new Map,d instanceof zi&&_.addAll(d),_}return F(c,v),o(c,[{key:"contains",value:function(d){var _=d.hashCode?d.hashCode():d;return!!this.map.has(_)}},{key:"add",value:function(d){var _=d.hashCode?d.hashCode():d;return!this.map.has(_)&&!!this.map.set(_,d)}},{key:"addAll",value:function(d){var _,S=P(d);try{for(S.s();!(_=S.n()).done;){var N=_.value;this.add(N)}}catch(U){S.e(U)}finally{S.f()}return!0}},{key:"remove",value:function(){throw new Gi}},{key:"size",value:function(){return this.map.size}},{key:"isEmpty",value:function(){return this.map.size===0}},{key:"toArray",value:function(){return Array.from(this.map.values())}},{key:"iterator",value:function(){return new En(this.map)}},{key:Symbol.iterator,value:function(){return this.map}}])}(sr),En=function(){return o(function v(c){h(this,v),this.iterator=c.values();var d=this.iterator.next(),_=d.done,S=d.value;this.done=_,this.value=S},[{key:"next",value:function(){if(this.done)throw new Qi;var v=this.value,c=this.iterator.next(),d=c.done,_=c.value;return this.done=d,this.value=_,v}},{key:"hasNext",value:function(){return!this.done}},{key:"remove",value:function(){throw new Gi}}])}(),Ot=function(){function v(){h(this,v)}return o(v,null,[{key:"opposite",value:function(c){return c===v.LEFT?v.RIGHT:c===v.RIGHT?v.LEFT:c}}])}();Ot.ON=0,Ot.LEFT=1,Ot.RIGHT=2;var In=function(v){function c(d){var _;return h(this,c),(_=s(this,c,[d])).name=Object.keys({EmptyStackException:c})[0],_}return F(c,v),o(c)}(ne),xs=function(v){function c(d){var _;return h(this,c),(_=s(this,c,[d])).name=Object.keys({IndexOutOfBoundsException:c})[0],_}return F(c,v),o(c)}(ne),os=function(v){function c(){return h(this,c),s(this,c,arguments)}return F(c,v),o(c,[{key:"get",value:function(){}},{key:"set",value:function(){}},{key:"isEmpty",value:function(){}}])}(zi),$s=function(v){function c(){var d;return h(this,c),(d=s(this,c)).array=[],d}return F(c,v),o(c,[{key:"add",value:function(d){return this.array.push(d),!0}},{key:"get",value:function(d){if(d<0||d>=this.size())throw new xs;return this.array[d]}},{key:"push",value:function(d){return this.array.push(d),d}},{key:"pop",value:function(){if(this.array.length===0)throw new In;return this.array.pop()}},{key:"peek",value:function(){if(this.array.length===0)throw new In;return this.array[this.array.length-1]}},{key:"empty",value:function(){return this.array.length===0}},{key:"isEmpty",value:function(){return this.empty()}},{key:"search",value:function(d){return this.array.indexOf(d)}},{key:"size",value:function(){return this.array.length}},{key:"toArray",value:function(){return this.array.slice()}}])}(os);function Xt(v,c){return v.interfaces_&&v.interfaces_.indexOf(c)>-1}var _r=function(){return o(function v(c){h(this,v),this.str=c},[{key:"append",value:function(v){this.str+=v}},{key:"setCharAt",value:function(v,c){this.str=this.str.substr(0,v)+c+this.str.substr(v+1)}},{key:"toString",value:function(){return this.str}}])}(),gi=function(){function v(c){h(this,v),this.value=c}return o(v,[{key:"intValue",value:function(){return this.value}},{key:"compareTo",value:function(c){return this.value<c?-1:this.value>c?1:0}}],[{key:"compare",value:function(c,d){return c<d?-1:c>d?1:0}},{key:"isNan",value:function(c){return Number.isNaN(c)}},{key:"valueOf",value:function(c){return new v(c)}}])}(),rn=function(){return o(function v(){h(this,v)},null,[{key:"isWhitespace",value:function(v){return v<=32&&v>=0||v===127}},{key:"toUpperCase",value:function(v){return v.toUpperCase()}}])}(),oi=function(){function v(){h(this,v),v.constructor_.apply(this,arguments)}return o(v,[{key:"le",value:function(c){return this._hi<c._hi||this._hi===c._hi&&this._lo<=c._lo}},{key:"extractSignificantDigits",value:function(c,d){var _=this.abs(),S=v.magnitude(_._hi),N=v.TEN.pow(S);(_=_.divide(N)).gt(v.TEN)?(_=_.divide(v.TEN),S+=1):_.lt(v.ONE)&&(_=_.multiply(v.TEN),S-=1);for(var U=S+1,J=new _r,ge=v.MAX_PRINT_DIGITS-1,Ie=0;Ie<=ge;Ie++){c&&Ie===U&&J.append(".");var st=Math.trunc(_._hi);if(st<0)break;var ht=!1,Pt=0;st>9?(ht=!0,Pt="9"):Pt="0"+st,J.append(Pt),_=_.subtract(v.valueOf(st)).multiply(v.TEN),ht&&_.selfAdd(v.TEN);var Qt=!0,wi=v.magnitude(_._hi);if(wi<0&&Math.abs(wi)>=ge-Ie&&(Qt=!1),!Qt)break}return d[0]=S,J.toString()}},{key:"sqr",value:function(){return this.multiply(this)}},{key:"doubleValue",value:function(){return this._hi+this._lo}},{key:"subtract",value:function(){if(arguments[0]instanceof v){var c=arguments[0];return this.add(c.negate())}if(typeof arguments[0]=="number"){var d=arguments[0];return this.add(-d)}}},{key:"equals",value:function(){if(arguments.length===1&&arguments[0]instanceof v){var c=arguments[0];return this._hi===c._hi&&this._lo===c._lo}}},{key:"isZero",value:function(){return this._hi===0&&this._lo===0}},{key:"selfSubtract",value:function(){if(arguments[0]instanceof v){var c=arguments[0];return this.isNaN()?this:this.selfAdd(-c._hi,-c._lo)}if(typeof arguments[0]=="number"){var d=arguments[0];return this.isNaN()?this:this.selfAdd(-d,0)}}},{key:"getSpecialNumberString",value:function(){return this.isZero()?"0.0":this.isNaN()?"NaN ":null}},{key:"min",value:function(c){return this.le(c)?this:c}},{key:"selfDivide",value:function(){if(arguments.length===1){if(arguments[0]instanceof v){var c=arguments[0];return this.selfDivide(c._hi,c._lo)}if(typeof arguments[0]=="number"){var d=arguments[0];return this.selfDivide(d,0)}}else if(arguments.length===2){var _,S,N,U,J=arguments[0],ge=arguments[1],Ie=null,st=null,ht=null,Pt=null;return N=this._hi/J,Pt=(Ie=(ht=v.SPLIT*N)-(Ie=ht-N))*(st=(Pt=v.SPLIT*J)-(st=Pt-J))-(U=N*J)+Ie*(S=J-st)+(_=N-Ie)*st+_*S,Pt=N+(ht=(this._hi-U-Pt+this._lo-N*ge)/J),this._hi=Pt,this._lo=N-Pt+ht,this}}},{key:"dump",value:function(){return"DD<"+this._hi+", "+this._lo+">"}},{key:"divide",value:function(){if(arguments[0]instanceof v){var c,d,_,S,N=arguments[0],U=null,J=null,ge=null,Ie=null;return c=(_=this._hi/N._hi)-(U=(ge=v.SPLIT*_)-(U=ge-_)),Ie=U*(J=(Ie=v.SPLIT*N._hi)-(J=Ie-N._hi))-(S=_*N._hi)+U*(d=N._hi-J)+c*J+c*d,new v(Ie=_+(ge=(this._hi-S-Ie+this._lo-_*N._lo)/N._hi),_-Ie+ge)}if(typeof arguments[0]=="number"){var st=arguments[0];return vt.isNaN(st)?v.createNaN():v.copy(this).selfDivide(st,0)}}},{key:"ge",value:function(c){return this._hi>c._hi||this._hi===c._hi&&this._lo>=c._lo}},{key:"pow",value:function(c){if(c===0)return v.valueOf(1);var d=new v(this),_=v.valueOf(1),S=Math.abs(c);if(S>1)for(;S>0;)S%2==1&&_.selfMultiply(d),(S/=2)>0&&(d=d.sqr());else _=d;return c<0?_.reciprocal():_}},{key:"ceil",value:function(){if(this.isNaN())return v.NaN;var c=Math.ceil(this._hi),d=0;return c===this._hi&&(d=Math.ceil(this._lo)),new v(c,d)}},{key:"compareTo",value:function(c){var d=c;return this._hi<d._hi?-1:this._hi>d._hi?1:this._lo<d._lo?-1:this._lo>d._lo?1:0}},{key:"rint",value:function(){return this.isNaN()?this:this.add(.5).floor()}},{key:"setValue",value:function(){if(arguments[0]instanceof v){var c=arguments[0];return this.init(c),this}if(typeof arguments[0]=="number"){var d=arguments[0];return this.init(d),this}}},{key:"max",value:function(c){return this.ge(c)?this:c}},{key:"sqrt",value:function(){if(this.isZero())return v.valueOf(0);if(this.isNegative())return v.NaN;var c=1/Math.sqrt(this._hi),d=this._hi*c,_=v.valueOf(d),S=this.subtract(_.sqr())._hi*(.5*c);return _.add(S)}},{key:"selfAdd",value:function(){if(arguments.length===1){if(arguments[0]instanceof v){var c=arguments[0];return this.selfAdd(c._hi,c._lo)}if(typeof arguments[0]=="number"){var d,_,S,N,U,J=arguments[0],ge=null;return ge=(S=this._hi+J)-(N=S-this._hi),_=(U=(ge=J-N+(this._hi-ge))+this._lo)+(S-(d=S+U)),this._hi=d+_,this._lo=_+(d-this._hi),this}}else if(arguments.length===2){var Ie,st,ht,Pt,Qt=arguments[0],wi=arguments[1],Ni=null,_i=null,yi=null;ht=this._hi+Qt,st=this._lo+wi,_i=ht-(yi=ht-this._hi),Ni=st-(Pt=st-this._lo);var cr=(Ie=ht+(yi=(_i=Qt-yi+(this._hi-_i))+st))+(yi=(Ni=wi-Pt+(this._lo-Ni))+(yi+(ht-Ie))),hr=yi+(Ie-cr);return this._hi=cr,this._lo=hr,this}}},{key:"selfMultiply",value:function(){if(arguments.length===1){if(arguments[0]instanceof v){var c=arguments[0];return this.selfMultiply(c._hi,c._lo)}if(typeof arguments[0]=="number"){var d=arguments[0];return this.selfMultiply(d,0)}}else if(arguments.length===2){var _,S,N=arguments[0],U=arguments[1],J=null,ge=null,Ie=null,st=null;J=(Ie=v.SPLIT*this._hi)-this._hi,st=v.SPLIT*N,J=Ie-J,_=this._hi-J,ge=st-N;var ht=(Ie=this._hi*N)+(st=J*(ge=st-ge)-Ie+J*(S=N-ge)+_*ge+_*S+(this._hi*U+this._lo*N)),Pt=st+(J=Ie-ht);return this._hi=ht,this._lo=Pt,this}}},{key:"selfSqr",value:function(){return this.selfMultiply(this)}},{key:"floor",value:function(){if(this.isNaN())return v.NaN;var c=Math.floor(this._hi),d=0;return c===this._hi&&(d=Math.floor(this._lo)),new v(c,d)}},{key:"negate",value:function(){return this.isNaN()?this:new v(-this._hi,-this._lo)}},{key:"clone",value:function(){try{return null}catch(c){if(c instanceof CloneNotSupportedException)return null;throw c}}},{key:"multiply",value:function(){if(arguments[0]instanceof v){var c=arguments[0];return c.isNaN()?v.createNaN():v.copy(this).selfMultiply(c)}if(typeof arguments[0]=="number"){var d=arguments[0];return vt.isNaN(d)?v.createNaN():v.copy(this).selfMultiply(d,0)}}},{key:"isNaN",value:function(){return vt.isNaN(this._hi)}},{key:"intValue",value:function(){return Math.trunc(this._hi)}},{key:"toString",value:function(){var c=v.magnitude(this._hi);return c>=-3&&c<=20?this.toStandardNotation():this.toSciNotation()}},{key:"toStandardNotation",value:function(){var c=this.getSpecialNumberString();if(c!==null)return c;var d=new Array(1).fill(null),_=this.extractSignificantDigits(!0,d),S=d[0]+1,N=_;if(_.charAt(0)===".")N="0"+_;else if(S<0)N="0."+v.stringOfChar("0",-S)+_;else if(_.indexOf(".")===-1){var U=S-_.length;N=_+v.stringOfChar("0",U)+".0"}return this.isNegative()?"-"+N:N}},{key:"reciprocal",value:function(){var c,d,_,S,N=null,U=null,J=null,ge=null;c=(_=1/this._hi)-(N=(J=v.SPLIT*_)-(N=J-_)),U=(ge=v.SPLIT*this._hi)-this._hi;var Ie=_+(J=(1-(S=_*this._hi)-(ge=N*(U=ge-U)-S+N*(d=this._hi-U)+c*U+c*d)-_*this._lo)/this._hi);return new v(Ie,_-Ie+J)}},{key:"toSciNotation",value:function(){if(this.isZero())return v.SCI_NOT_ZERO;var c=this.getSpecialNumberString();if(c!==null)return c;var d=new Array(1).fill(null),_=this.extractSignificantDigits(!1,d),S=v.SCI_NOT_EXPONENT_CHAR+d[0];if(_.charAt(0)==="0")throw new IllegalStateException("Found leading zero: "+_);var N="";_.length>1&&(N=_.substring(1));var U=_.charAt(0)+"."+N;return this.isNegative()?"-"+U+S:U+S}},{key:"abs",value:function(){return this.isNaN()?v.NaN:this.isNegative()?this.negate():new v(this)}},{key:"isPositive",value:function(){return this._hi>0||this._hi===0&&this._lo>0}},{key:"lt",value:function(c){return this._hi<c._hi||this._hi===c._hi&&this._lo<c._lo}},{key:"add",value:function(){if(arguments[0]instanceof v){var c=arguments[0];return v.copy(this).selfAdd(c)}if(typeof arguments[0]=="number"){var d=arguments[0];return v.copy(this).selfAdd(d)}}},{key:"init",value:function(){if(arguments.length===1){if(typeof arguments[0]=="number"){var c=arguments[0];this._hi=c,this._lo=0}else if(arguments[0]instanceof v){var d=arguments[0];this._hi=d._hi,this._lo=d._lo}}else if(arguments.length===2){var _=arguments[0],S=arguments[1];this._hi=_,this._lo=S}}},{key:"gt",value:function(c){return this._hi>c._hi||this._hi===c._hi&&this._lo>c._lo}},{key:"isNegative",value:function(){return this._hi<0||this._hi===0&&this._lo<0}},{key:"trunc",value:function(){return this.isNaN()?v.NaN:this.isPositive()?this.floor():this.ceil()}},{key:"signum",value:function(){return this._hi>0?1:this._hi<0?-1:this._lo>0?1:this._lo<0?-1:0}},{key:"interfaces_",get:function(){return[$,Se,Z]}}],[{key:"constructor_",value:function(){if(this._hi=0,this._lo=0,arguments.length===0)this.init(0);else if(arguments.length===1){if(typeof arguments[0]=="number"){var c=arguments[0];this.init(c)}else if(arguments[0]instanceof v){var d=arguments[0];this.init(d)}else if(typeof arguments[0]=="string"){var _=arguments[0];v.constructor_.call(this,v.parse(_))}}else if(arguments.length===2){var S=arguments[0],N=arguments[1];this.init(S,N)}}},{key:"determinant",value:function(){if(typeof arguments[3]=="number"&&typeof arguments[2]=="number"&&typeof arguments[0]=="number"&&typeof arguments[1]=="number"){var c=arguments[0],d=arguments[1],_=arguments[2],S=arguments[3];return v.determinant(v.valueOf(c),v.valueOf(d),v.valueOf(_),v.valueOf(S))}if(arguments[3]instanceof v&&arguments[2]instanceof v&&arguments[0]instanceof v&&arguments[1]instanceof v){var N=arguments[1],U=arguments[2],J=arguments[3];return arguments[0].multiply(J).selfSubtract(N.multiply(U))}}},{key:"sqr",value:function(c){return v.valueOf(c).selfMultiply(c)}},{key:"valueOf",value:function(){if(typeof arguments[0]=="string"){var c=arguments[0];return v.parse(c)}if(typeof arguments[0]=="number")return new v(arguments[0])}},{key:"sqrt",value:function(c){return v.valueOf(c).sqrt()}},{key:"parse",value:function(c){for(var d=0,_=c.length;rn.isWhitespace(c.charAt(d));)d++;var S=!1;if(d<_){var N=c.charAt(d);N!=="-"&&N!=="+"||(d++,N==="-"&&(S=!0))}for(var U=new v,J=0,ge=0,Ie=0,st=!1;!(d>=_);){var ht=c.charAt(d);if(d++,rn.isDigit(ht)){var Pt=ht-"0";U.selfMultiply(v.TEN),U.selfAdd(Pt),J++}else{if(ht!=="."){if(ht==="e"||ht==="E"){var Qt=c.substring(d);try{Ie=gi.parseInt(Qt)}catch(cr){throw cr instanceof NumberFormatException?new NumberFormatException("Invalid exponent "+Qt+" in string "+c):cr}break}throw new NumberFormatException("Unexpected character '"+ht+"' at position "+d+" in string "+c)}ge=J,st=!0}}var wi=U;st||(ge=J);var Ni=J-ge-Ie;if(Ni===0)wi=U;else if(Ni>0){var _i=v.TEN.pow(Ni);wi=U.divide(_i)}else if(Ni<0){var yi=v.TEN.pow(-Ni);wi=U.multiply(yi)}return S?wi.negate():wi}},{key:"createNaN",value:function(){return new v(vt.NaN,vt.NaN)}},{key:"copy",value:function(c){return new v(c)}},{key:"magnitude",value:function(c){var d=Math.abs(c),_=Math.log(d)/Math.log(10),S=Math.trunc(Math.floor(_));return 10*Math.pow(10,S)<=d&&(S+=1),S}},{key:"stringOfChar",value:function(c,d){for(var _=new _r,S=0;S<d;S++)_.append(c);return _.toString()}}])}();oi.PI=new oi(3.141592653589793,12246467991473532e-32),oi.TWO_PI=new oi(6.283185307179586,24492935982947064e-32),oi.PI_2=new oi(1.5707963267948966,6123233995736766e-32),oi.E=new oi(2.718281828459045,14456468917292502e-32),oi.NaN=new oi(vt.NaN,vt.NaN),oi.EPS=123259516440783e-46,oi.SPLIT=134217729,oi.MAX_PRINT_DIGITS=32,oi.TEN=oi.valueOf(10),oi.ONE=oi.valueOf(1),oi.SCI_NOT_EXPONENT_CHAR="E",oi.SCI_NOT_ZERO="0.0E0";var er=function(){function v(){h(this,v)}return o(v,null,[{key:"orientationIndex",value:function(c,d,_){var S=v.orientationIndexFilter(c,d,_);if(S<=1)return S;var N=oi.valueOf(d.x).selfAdd(-c.x),U=oi.valueOf(d.y).selfAdd(-c.y),J=oi.valueOf(_.x).selfAdd(-d.x),ge=oi.valueOf(_.y).selfAdd(-d.y);return N.selfMultiply(ge).selfSubtract(U.selfMultiply(J)).signum()}},{key:"signOfDet2x2",value:function(){if(arguments[3]instanceof oi&&arguments[2]instanceof oi&&arguments[0]instanceof oi&&arguments[1]instanceof oi){var c=arguments[1],d=arguments[2],_=arguments[3];return arguments[0].multiply(_).selfSubtract(c.multiply(d)).signum()}if(typeof arguments[3]=="number"&&typeof arguments[2]=="number"&&typeof arguments[0]=="number"&&typeof arguments[1]=="number"){var S=arguments[0],N=arguments[1],U=arguments[2],J=arguments[3],ge=oi.valueOf(S),Ie=oi.valueOf(N),st=oi.valueOf(U),ht=oi.valueOf(J);return ge.multiply(ht).selfSubtract(Ie.multiply(st)).signum()}}},{key:"intersection",value:function(c,d,_,S){var N=new oi(c.y).selfSubtract(d.y),U=new oi(d.x).selfSubtract(c.x),J=new oi(c.x).selfMultiply(d.y).selfSubtract(new oi(d.x).selfMultiply(c.y)),ge=new oi(_.y).selfSubtract(S.y),Ie=new oi(S.x).selfSubtract(_.x),st=new oi(_.x).selfMultiply(S.y).selfSubtract(new oi(S.x).selfMultiply(_.y)),ht=U.multiply(st).selfSubtract(Ie.multiply(J)),Pt=ge.multiply(J).selfSubtract(N.multiply(st)),Qt=N.multiply(Ie).selfSubtract(ge.multiply(U)),wi=ht.selfDivide(Qt).doubleValue(),Ni=Pt.selfDivide(Qt).doubleValue();return vt.isNaN(wi)||vt.isInfinite(wi)||vt.isNaN(Ni)||vt.isInfinite(Ni)?null:new lt(wi,Ni)}},{key:"orientationIndexFilter",value:function(c,d,_){var S=null,N=(c.x-_.x)*(d.y-_.y),U=(c.y-_.y)*(d.x-_.x),J=N-U;if(N>0){if(U<=0)return v.signum(J);S=N+U}else{if(!(N<0)||U>=0)return v.signum(J);S=-N-U}var ge=v.DP_SAFE_EPSILON*S;return J>=ge||-J>=ge?v.signum(J):2}},{key:"signum",value:function(c){return c>0?1:c<0?-1:0}}])}();er.DP_SAFE_EPSILON=1e-15;var Bi=function(){return o(function v(){h(this,v)},[{key:"getM",value:function(v){if(this.hasM()){var c=this.getDimension()-this.getMeasures();return this.getOrdinate(v,c)}return vt.NaN}},{key:"setOrdinate",value:function(v,c,d){}},{key:"getZ",value:function(v){return this.hasZ()?this.getOrdinate(v,2):vt.NaN}},{key:"size",value:function(){}},{key:"getOrdinate",value:function(v,c){}},{key:"getCoordinate",value:function(){}},{key:"getCoordinateCopy",value:function(v){}},{key:"createCoordinate",value:function(){}},{key:"getDimension",value:function(){}},{key:"hasM",value:function(){return this.getMeasures()>0}},{key:"getX",value:function(v){}},{key:"hasZ",value:function(){return this.getDimension()-this.getMeasures()>2}},{key:"getMeasures",value:function(){return 0}},{key:"expandEnvelope",value:function(v){}},{key:"copy",value:function(){}},{key:"getY",value:function(v){}},{key:"toCoordinateArray",value:function(){}},{key:"interfaces_",get:function(){return[Z]}}])}();Bi.X=0,Bi.Y=1,Bi.Z=2,Bi.M=3;var Ii=function(){function v(){h(this,v)}return o(v,null,[{key:"index",value:function(c,d,_){return er.orientationIndex(c,d,_)}},{key:"isCCW",value:function(){if(arguments[0]instanceof Array){var c=arguments[0],d=c.length-1;if(d<3)throw new ye("Ring has fewer than 4 points, so orientation cannot be determined");for(var _=c[0],S=0,N=1;N<=d;N++){var U=c[N];U.y>_.y&&(_=U,S=N)}var J=S;do(J-=1)<0&&(J=d);while(c[J].equals2D(_)&&J!==S);var ge=S;do ge=(ge+1)%d;while(c[ge].equals2D(_)&&ge!==S);var Ie=c[J],st=c[ge];if(Ie.equals2D(_)||st.equals2D(_)||Ie.equals2D(st))return!1;var ht=v.index(Ie,_,st);return ht===0?Ie.x>st.x:ht>0}if(Xt(arguments[0],Bi)){var Pt=arguments[0],Qt=Pt.size()-1;if(Qt<3)throw new ye("Ring has fewer than 4 points, so orientation cannot be determined");for(var wi=Pt.getCoordinate(0),Ni=0,_i=1;_i<=Qt;_i++){var yi=Pt.getCoordinate(_i);yi.y>wi.y&&(wi=yi,Ni=_i)}var cr=null,hr=Ni;do(hr-=1)<0&&(hr=Qt),cr=Pt.getCoordinate(hr);while(cr.equals2D(wi)&&hr!==Ni);var dn=null,pn=Ni;do pn=(pn+1)%Qt,dn=Pt.getCoordinate(pn);while(dn.equals2D(wi)&&pn!==Ni);if(cr.equals2D(wi)||dn.equals2D(wi)||cr.equals2D(dn))return!1;var Gn=v.index(cr,wi,dn);return Gn===0?cr.x>dn.x:Gn>0}}}])}();Ii.CLOCKWISE=-1,Ii.RIGHT=Ii.CLOCKWISE,Ii.COUNTERCLOCKWISE=1,Ii.LEFT=Ii.COUNTERCLOCKWISE,Ii.COLLINEAR=0,Ii.STRAIGHT=Ii.COLLINEAR;var et=function(){return o(function v(){h(this,v),v.constructor_.apply(this,arguments)},[{key:"getCoordinate",value:function(){return this._minCoord}},{key:"getRightmostSide",value:function(v,c){var d=this.getRightmostSideOfSegment(v,c);return d<0&&(d=this.getRightmostSideOfSegment(v,c-1)),d<0&&(this._minCoord=null,this.checkForRightmostCoordinate(v)),d}},{key:"findRightmostEdgeAtVertex",value:function(){var v=this._minDe.getEdge().getCoordinates();zt.isTrue(this._minIndex>0&&this._minIndex<v.length,"rightmost point expected to be interior vertex of edge");var c=v[this._minIndex-1],d=v[this._minIndex+1],_=Ii.index(this._minCoord,d,c),S=!1;(c.y<this._minCoord.y&&d.y<this._minCoord.y&&_===Ii.COUNTERCLOCKWISE||c.y>this._minCoord.y&&d.y>this._minCoord.y&&_===Ii.CLOCKWISE)&&(S=!0),S&&(this._minIndex=this._minIndex-1)}},{key:"getRightmostSideOfSegment",value:function(v,c){var d=v.getEdge().getCoordinates();if(c<0||c+1>=d.length||d[c].y===d[c+1].y)return-1;var _=Ot.LEFT;return d[c].y<d[c+1].y&&(_=Ot.RIGHT),_}},{key:"getEdge",value:function(){return this._orientedDe}},{key:"checkForRightmostCoordinate",value:function(v){for(var c=v.getEdge().getCoordinates(),d=0;d<c.length-1;d++)(this._minCoord===null||c[d].x>this._minCoord.x)&&(this._minDe=v,this._minIndex=d,this._minCoord=c[d])}},{key:"findRightmostEdgeAtNode",value:function(){var v=this._minDe.getNode().getEdges();this._minDe=v.getRightmostEdge(),this._minDe.isForward()||(this._minDe=this._minDe.getSym(),this._minIndex=this._minDe.getEdge().getCoordinates().length-1)}},{key:"findEdge",value:function(v){for(var c=v.iterator();c.hasNext();){var d=c.next();d.isForward()&&this.checkForRightmostCoordinate(d)}zt.isTrue(this._minIndex!==0||this._minCoord.equals(this._minDe.getCoordinate()),"inconsistency in rightmost processing"),this._minIndex===0?this.findRightmostEdgeAtNode():this.findRightmostEdgeAtVertex(),this._orientedDe=this._minDe,this.getRightmostSide(this._minDe,this._minIndex)===Ot.LEFT&&(this._orientedDe=this._minDe.getSym())}}],[{key:"constructor_",value:function(){this._minIndex=-1,this._minCoord=null,this._minDe=null,this._orientedDe=null}}])}(),le=function(v){function c(d,_){var S;return h(this,c),(S=s(this,c,[_?d+" [ "+_+" ]":d])).pt=_?new lt(_):void 0,S.name=Object.keys({TopologyException:c})[0],S}return F(c,v),o(c,[{key:"getCoordinate",value:function(){return this.pt}}])}(It),pe=function(){return o(function v(){h(this,v),this.array=[]},[{key:"addLast",value:function(v){this.array.push(v)}},{key:"removeFirst",value:function(){return this.array.shift()}},{key:"isEmpty",value:function(){return this.array.length===0}}])}(),me=function(v){function c(d){var _;return h(this,c),(_=s(this,c)).array=[],d instanceof zi&&_.addAll(d),_}return F(c,v),o(c,[{key:"interfaces_",get:function(){return[os,zi]}},{key:"ensureCapacity",value:function(){}},{key:"add",value:function(d){return arguments.length===1?this.array.push(d):this.array.splice(arguments[0],0,arguments[1]),!0}},{key:"clear",value:function(){this.array=[]}},{key:"addAll",value:function(d){var _,S=P(d);try{for(S.s();!(_=S.n()).done;){var N=_.value;this.array.push(N)}}catch(U){S.e(U)}finally{S.f()}}},{key:"set",value:function(d,_){var S=this.array[d];return this.array[d]=_,S}},{key:"iterator",value:function(){return new Le(this)}},{key:"get",value:function(d){if(d<0||d>=this.size())throw new xs;return this.array[d]}},{key:"isEmpty",value:function(){return this.array.length===0}},{key:"sort",value:function(d){d?this.array.sort(function(_,S){return d.compare(_,S)}):this.array.sort()}},{key:"size",value:function(){return this.array.length}},{key:"toArray",value:function(){return this.array.slice()}},{key:"remove",value:function(d){for(var _=0,S=this.array.length;_<S;_++)if(this.array[_]===d)return!!this.array.splice(_,1);return!1}},{key:Symbol.iterator,value:function(){return this.array.values()}}])}(os),Le=function(){return o(function v(c){h(this,v),this.arrayList=c,this.position=0},[{key:"next",value:function(){if(this.position===this.arrayList.size())throw new Qi;return this.arrayList.get(this.position++)}},{key:"hasNext",value:function(){return this.position<this.arrayList.size()}},{key:"set",value:function(v){return this.arrayList.set(this.position-1,v)}},{key:"remove",value:function(){this.arrayList.remove(this.arrayList.get(this.position))}}])}(),Ze=function(){return o(function v(){h(this,v),v.constructor_.apply(this,arguments)},[{key:"clearVisitedEdges",value:function(){for(var v=this._dirEdgeList.iterator();v.hasNext();)v.next().setVisited(!1)}},{key:"getRightmostCoordinate",value:function(){return this._rightMostCoord}},{key:"computeNodeDepth",value:function(v){for(var c=null,d=v.getEdges().iterator();d.hasNext();){var _=d.next();if(_.isVisited()||_.getSym().isVisited()){c=_;break}}if(c===null)throw new le("unable to find edge to compute depths at "+v.getCoordinate());v.getEdges().computeDepths(c);for(var S=v.getEdges().iterator();S.hasNext();){var N=S.next();N.setVisited(!0),this.copySymDepths(N)}}},{key:"computeDepth",value:function(v){this.clearVisitedEdges();var c=this._finder.getEdge();c.getNode(),c.getLabel(),c.setEdgeDepths(Ot.RIGHT,v),this.copySymDepths(c),this.computeDepths(c)}},{key:"create",value:function(v){this.addReachable(v),this._finder.findEdge(this._dirEdgeList),this._rightMostCoord=this._finder.getCoordinate()}},{key:"findResultEdges",value:function(){for(var v=this._dirEdgeList.iterator();v.hasNext();){var c=v.next();c.getDepth(Ot.RIGHT)>=1&&c.getDepth(Ot.LEFT)<=0&&!c.isInteriorAreaEdge()&&c.setInResult(!0)}}},{key:"computeDepths",value:function(v){var c=new jr,d=new pe,_=v.getNode();for(d.addLast(_),c.add(_),v.setVisited(!0);!d.isEmpty();){var S=d.removeFirst();c.add(S),this.computeNodeDepth(S);for(var N=S.getEdges().iterator();N.hasNext();){var U=N.next().getSym();if(!U.isVisited()){var J=U.getNode();c.contains(J)||(d.addLast(J),c.add(J))}}}}},{key:"compareTo",value:function(v){var c=v;return this._rightMostCoord.x<c._rightMostCoord.x?-1:this._rightMostCoord.x>c._rightMostCoord.x?1:0}},{key:"getEnvelope",value:function(){if(this._env===null){for(var v=new ii,c=this._dirEdgeList.iterator();c.hasNext();)for(var d=c.next().getEdge().getCoordinates(),_=0;_<d.length-1;_++)v.expandToInclude(d[_]);this._env=v}return this._env}},{key:"addReachable",value:function(v){var c=new $s;for(c.add(v);!c.empty();){var d=c.pop();this.add(d,c)}}},{key:"copySymDepths",value:function(v){var c=v.getSym();c.setDepth(Ot.LEFT,v.getDepth(Ot.RIGHT)),c.setDepth(Ot.RIGHT,v.getDepth(Ot.LEFT))}},{key:"add",value:function(v,c){v.setVisited(!0),this._nodes.add(v);for(var d=v.getEdges().iterator();d.hasNext();){var _=d.next();this._dirEdgeList.add(_);var S=_.getSym().getNode();S.isVisited()||c.push(S)}}},{key:"getNodes",value:function(){return this._nodes}},{key:"getDirectedEdges",value:function(){return this._dirEdgeList}},{key:"interfaces_",get:function(){return[Se]}}],[{key:"constructor_",value:function(){this._finder=null,this._dirEdgeList=new me,this._nodes=new me,this._rightMostCoord=null,this._env=null,this._finder=new et}}])}(),Je=function(){return o(function v(){h(this,v)},null,[{key:"intersection",value:function(v,c,d,_){var S=v.x<c.x?v.x:c.x,N=v.y<c.y?v.y:c.y,U=v.x>c.x?v.x:c.x,J=v.y>c.y?v.y:c.y,ge=d.x<_.x?d.x:_.x,Ie=d.y<_.y?d.y:_.y,st=d.x>_.x?d.x:_.x,ht=d.y>_.y?d.y:_.y,Pt=((S>ge?S:ge)+(U<st?U:st))/2,Qt=((N>Ie?N:Ie)+(J<ht?J:ht))/2,wi=v.x-Pt,Ni=v.y-Qt,_i=c.x-Pt,yi=c.y-Qt,cr=d.x-Pt,hr=d.y-Qt,dn=_.x-Pt,pn=_.y-Qt,Gn=Ni-yi,Un=_i-wi,no=wi*yi-_i*Ni,yo=hr-pn,Ns=dn-cr,cs=cr*pn-dn*hr,ja=Gn*Ns-yo*Un,Os=(Un*cs-Ns*no)/ja,qs=(yo*no-Gn*cs)/ja;return vt.isNaN(Os)||vt.isInfinite(Os)||vt.isNaN(qs)||vt.isInfinite(qs)?null:new lt(Os+Pt,qs+Qt)}}])}(),at=function(){return o(function v(){h(this,v)},null,[{key:"arraycopy",value:function(v,c,d,_,S){for(var N=0,U=c;U<c+S;U++)d[_+N]=v[U],N++}},{key:"getProperty",value:function(v){return{"line.separator":`
`}[v]}}])}(),He=function(){function v(){h(this,v)}return o(v,null,[{key:"log10",value:function(c){var d=Math.log(c);return vt.isInfinite(d)||vt.isNaN(d)?d:d/v.LOG_10}},{key:"min",value:function(c,d,_,S){var N=c;return d<N&&(N=d),_<N&&(N=_),S<N&&(N=S),N}},{key:"clamp",value:function(){if(typeof arguments[2]=="number"&&typeof arguments[0]=="number"&&typeof arguments[1]=="number"){var c=arguments[0],d=arguments[1],_=arguments[2];return c<d?d:c>_?_:c}if(Number.isInteger(arguments[2])&&Number.isInteger(arguments[0])&&Number.isInteger(arguments[1])){var S=arguments[0],N=arguments[1],U=arguments[2];return S<N?N:S>U?U:S}}},{key:"wrap",value:function(c,d){return c<0?d- -c%d:c%d}},{key:"max",value:function(){if(arguments.length===3){var c=arguments[1],d=arguments[2],_=arguments[0];return c>_&&(_=c),d>_&&(_=d),_}if(arguments.length===4){var S=arguments[1],N=arguments[2],U=arguments[3],J=arguments[0];return S>J&&(J=S),N>J&&(J=N),U>J&&(J=U),J}}},{key:"average",value:function(c,d){return(c+d)/2}}])}();He.LOG_10=Math.log(10);var gt=function(){function v(){h(this,v)}return o(v,null,[{key:"segmentToSegment",value:function(c,d,_,S){if(c.equals(d))return v.pointToSegment(c,_,S);if(_.equals(S))return v.pointToSegment(S,c,d);var N=!1;if(ii.intersects(c,d,_,S)){var U=(d.x-c.x)*(S.y-_.y)-(d.y-c.y)*(S.x-_.x);if(U===0)N=!0;else{var J=(c.y-_.y)*(S.x-_.x)-(c.x-_.x)*(S.y-_.y),ge=((c.y-_.y)*(d.x-c.x)-(c.x-_.x)*(d.y-c.y))/U,Ie=J/U;(Ie<0||Ie>1||ge<0||ge>1)&&(N=!0)}}else N=!0;return N?He.min(v.pointToSegment(c,_,S),v.pointToSegment(d,_,S),v.pointToSegment(_,c,d),v.pointToSegment(S,c,d)):0}},{key:"pointToSegment",value:function(c,d,_){if(d.x===_.x&&d.y===_.y)return c.distance(d);var S=(_.x-d.x)*(_.x-d.x)+(_.y-d.y)*(_.y-d.y),N=((c.x-d.x)*(_.x-d.x)+(c.y-d.y)*(_.y-d.y))/S;if(N<=0)return c.distance(d);if(N>=1)return c.distance(_);var U=((d.y-c.y)*(_.x-d.x)-(d.x-c.x)*(_.y-d.y))/S;return Math.abs(U)*Math.sqrt(S)}},{key:"pointToLinePerpendicular",value:function(c,d,_){var S=(_.x-d.x)*(_.x-d.x)+(_.y-d.y)*(_.y-d.y),N=((d.y-c.y)*(_.x-d.x)-(d.x-c.x)*(_.y-d.y))/S;return Math.abs(N)*Math.sqrt(S)}},{key:"pointToSegmentString",value:function(c,d){if(d.length===0)throw new ye("Line array must contain at least one vertex");for(var _=c.distance(d[0]),S=0;S<d.length-1;S++){var N=v.pointToSegment(c,d[S],d[S+1]);N<_&&(_=N)}return _}}])}(),ft=function(){return o(function v(){h(this,v)},[{key:"create",value:function(){if(arguments.length===1)arguments[0]instanceof Array||Xt(arguments[0],Bi);else if(arguments.length!==2&&arguments.length===3){var v=arguments[0],c=arguments[1];return this.create(v,c)}}}])}(),nt=function(){return o(function v(){h(this,v)},[{key:"filter",value:function(v){}}])}(),Tt=function(){return o(function v(){h(this,v)},null,[{key:"ofLine",value:function(v){var c=v.size();if(c<=1)return 0;var d=0,_=new lt;v.getCoordinate(0,_);for(var S=_.x,N=_.y,U=1;U<c;U++){v.getCoordinate(U,_);var J=_.x,ge=_.y,Ie=J-S,st=ge-N;d+=Math.sqrt(Ie*Ie+st*st),S=J,N=ge}return d}}])}(),Ve=o(function v(){h(this,v)}),Ut=function(){function v(){h(this,v)}return o(v,null,[{key:"copyCoord",value:function(c,d,_,S){for(var N=Math.min(c.getDimension(),_.getDimension()),U=0;U<N;U++)_.setOrdinate(S,U,c.getOrdinate(d,U))}},{key:"isRing",value:function(c){var d=c.size();return d===0||!(d<=3)&&c.getOrdinate(0,Bi.X)===c.getOrdinate(d-1,Bi.X)&&c.getOrdinate(0,Bi.Y)===c.getOrdinate(d-1,Bi.Y)}},{key:"scroll",value:function(){if(arguments.length===2){if(Xt(arguments[0],Bi)&&Number.isInteger(arguments[1])){var c=arguments[0],d=arguments[1];v.scroll(c,d,v.isRing(c))}else if(Xt(arguments[0],Bi)&&arguments[1]instanceof lt){var _=arguments[0],S=arguments[1],N=v.indexOf(S,_);if(N<=0)return null;v.scroll(_,N)}}else if(arguments.length===3){var U=arguments[0],J=arguments[1],ge=arguments[2];if(J<=0)return null;for(var Ie=U.copy(),st=ge?U.size()-1:U.size(),ht=0;ht<st;ht++)for(var Pt=0;Pt<U.getDimension();Pt++)U.setOrdinate(ht,Pt,Ie.getOrdinate((J+ht)%st,Pt));if(ge)for(var Qt=0;Qt<U.getDimension();Qt++)U.setOrdinate(st,Qt,U.getOrdinate(0,Qt))}}},{key:"isEqual",value:function(c,d){var _=c.size();if(_!==d.size())return!1;for(var S=Math.min(c.getDimension(),d.getDimension()),N=0;N<_;N++)for(var U=0;U<S;U++){var J=c.getOrdinate(N,U),ge=d.getOrdinate(N,U);if(c.getOrdinate(N,U)!==d.getOrdinate(N,U)&&(!vt.isNaN(J)||!vt.isNaN(ge)))return!1}return!0}},{key:"minCoordinateIndex",value:function(){if(arguments.length===1){var c=arguments[0];return v.minCoordinateIndex(c,0,c.size()-1)}if(arguments.length===3){for(var d=arguments[0],_=arguments[2],S=-1,N=null,U=arguments[1];U<=_;U++){var J=d.getCoordinate(U);(N===null||N.compareTo(J)>0)&&(N=J,S=U)}return S}}},{key:"extend",value:function(c,d,_){var S=c.create(_,d.getDimension()),N=d.size();if(v.copy(d,0,S,0,N),N>0)for(var U=N;U<_;U++)v.copy(d,N-1,S,U,1);return S}},{key:"reverse",value:function(c){for(var d=c.size()-1,_=Math.trunc(d/2),S=0;S<=_;S++)v.swap(c,S,d-S)}},{key:"swap",value:function(c,d,_){if(d===_)return null;for(var S=0;S<c.getDimension();S++){var N=c.getOrdinate(d,S);c.setOrdinate(d,S,c.getOrdinate(_,S)),c.setOrdinate(_,S,N)}}},{key:"copy",value:function(c,d,_,S,N){for(var U=0;U<N;U++)v.copyCoord(c,d+U,_,S+U)}},{key:"ensureValidRing",value:function(c,d){var _=d.size();return _===0?d:_<=3?v.createClosedRing(c,d,4):d.getOrdinate(0,Bi.X)===d.getOrdinate(_-1,Bi.X)&&d.getOrdinate(0,Bi.Y)===d.getOrdinate(_-1,Bi.Y)?d:v.createClosedRing(c,d,_+1)}},{key:"indexOf",value:function(c,d){for(var _=0;_<d.size();_++)if(c.x===d.getOrdinate(_,Bi.X)&&c.y===d.getOrdinate(_,Bi.Y))return _;return-1}},{key:"createClosedRing",value:function(c,d,_){var S=c.create(_,d.getDimension()),N=d.size();v.copy(d,0,S,0,N);for(var U=N;U<_;U++)v.copy(d,0,S,U,1);return S}},{key:"minCoordinate",value:function(c){for(var d=null,_=0;_<c.size();_++){var S=c.getCoordinate(_);(d===null||d.compareTo(S)>0)&&(d=S)}return d}}])}(),bt=function(){function v(){h(this,v)}return o(v,null,[{key:"toDimensionSymbol",value:function(c){switch(c){case v.FALSE:return v.SYM_FALSE;case v.TRUE:return v.SYM_TRUE;case v.DONTCARE:return v.SYM_DONTCARE;case v.P:return v.SYM_P;case v.L:return v.SYM_L;case v.A:return v.SYM_A}throw new ye("Unknown dimension value: "+c)}},{key:"toDimensionValue",value:function(c){switch(rn.toUpperCase(c)){case v.SYM_FALSE:return v.FALSE;case v.SYM_TRUE:return v.TRUE;case v.SYM_DONTCARE:return v.DONTCARE;case v.SYM_P:return v.P;case v.SYM_L:return v.L;case v.SYM_A:return v.A}throw new ye("Unknown dimension symbol: "+c)}}])}();bt.P=0,bt.L=1,bt.A=2,bt.FALSE=-1,bt.TRUE=-2,bt.DONTCARE=-3,bt.SYM_FALSE="F",bt.SYM_TRUE="T",bt.SYM_DONTCARE="*",bt.SYM_P="0",bt.SYM_L="1",bt.SYM_A="2";var Ht=function(){return o(function v(){h(this,v)},[{key:"filter",value:function(v){}}])}(),li=function(){return o(function v(){h(this,v)},[{key:"filter",value:function(v,c){}},{key:"isDone",value:function(){}},{key:"isGeometryChanged",value:function(){}}])}(),Ci=function(v){function c(){var d;return h(this,c),d=s(this,c),c.constructor_.apply(d,arguments),d}return F(c,v),o(c,[{key:"computeEnvelopeInternal",value:function(){return this.isEmpty()?new ii:this._points.expandEnvelope(new ii)}},{key:"isRing",value:function(){return this.isClosed()&&this.isSimple()}},{key:"getCoordinates",value:function(){return this._points.toCoordinateArray()}},{key:"copyInternal",value:function(){return new c(this._points.copy(),this._factory)}},{key:"equalsExact",value:function(){if(arguments.length===2&&typeof arguments[1]=="number"&&arguments[0]instanceof Jt){var d=arguments[0],_=arguments[1];if(!this.isEquivalentClass(d))return!1;var S=d;if(this._points.size()!==S._points.size())return!1;for(var N=0;N<this._points.size();N++)if(!this.equal(this._points.getCoordinate(N),S._points.getCoordinate(N),_))return!1;return!0}return H(c,"equalsExact",this,1).apply(this,arguments)}},{key:"normalize",value:function(){for(var d=0;d<Math.trunc(this._points.size()/2);d++){var _=this._points.size()-1-d;if(!this._points.getCoordinate(d).equals(this._points.getCoordinate(_))){if(this._points.getCoordinate(d).compareTo(this._points.getCoordinate(_))>0){var S=this._points.copy();Ut.reverse(S),this._points=S}return null}}}},{key:"getCoordinate",value:function(){return this.isEmpty()?null:this._points.getCoordinate(0)}},{key:"getBoundaryDimension",value:function(){return this.isClosed()?bt.FALSE:0}},{key:"isClosed",value:function(){return!this.isEmpty()&&this.getCoordinateN(0).equals2D(this.getCoordinateN(this.getNumPoints()-1))}},{key:"reverseInternal",value:function(){var d=this._points.copy();return Ut.reverse(d),this.getFactory().createLineString(d)}},{key:"getEndPoint",value:function(){return this.isEmpty()?null:this.getPointN(this.getNumPoints()-1)}},{key:"getTypeCode",value:function(){return Jt.TYPECODE_LINESTRING}},{key:"getDimension",value:function(){return 1}},{key:"getLength",value:function(){return Tt.ofLine(this._points)}},{key:"getNumPoints",value:function(){return this._points.size()}},{key:"compareToSameClass",value:function(){if(arguments.length===1){for(var d=arguments[0],_=0,S=0;_<this._points.size()&&S<d._points.size();){var N=this._points.getCoordinate(_).compareTo(d._points.getCoordinate(S));if(N!==0)return N;_++,S++}return _<this._points.size()?1:S<d._points.size()?-1:0}if(arguments.length===2){var U=arguments[0];return arguments[1].compare(this._points,U._points)}}},{key:"apply",value:function(){if(Xt(arguments[0],nt))for(var d=arguments[0],_=0;_<this._points.size();_++)d.filter(this._points.getCoordinate(_));else if(Xt(arguments[0],li)){var S=arguments[0];if(this._points.size()===0)return null;for(var N=0;N<this._points.size()&&(S.filter(this._points,N),!S.isDone());N++);S.isGeometryChanged()&&this.geometryChanged()}else Xt(arguments[0],Ht)?arguments[0].filter(this):Xt(arguments[0],Re)&&arguments[0].filter(this)}},{key:"getBoundary",value:function(){throw new Gi}},{key:"isEquivalentClass",value:function(d){return d instanceof c}},{key:"getCoordinateN",value:function(d){return this._points.getCoordinate(d)}},{key:"getGeometryType",value:function(){return Jt.TYPENAME_LINESTRING}},{key:"getCoordinateSequence",value:function(){return this._points}},{key:"isEmpty",value:function(){return this._points.size()===0}},{key:"init",value:function(d){if(d===null&&(d=this.getFactory().getCoordinateSequenceFactory().create([])),d.size()===1)throw new ye("Invalid number of points in LineString (found "+d.size()+" - must be 0 or >= 2)");this._points=d}},{key:"isCoordinate",value:function(d){for(var _=0;_<this._points.size();_++)if(this._points.getCoordinate(_).equals(d))return!0;return!1}},{key:"getStartPoint",value:function(){return this.isEmpty()?null:this.getPointN(0)}},{key:"getPointN",value:function(d){return this.getFactory().createPoint(this._points.getCoordinate(d))}},{key:"interfaces_",get:function(){return[Ve]}}],[{key:"constructor_",value:function(){if(this._points=null,arguments.length!==0&&arguments.length===2){var d=arguments[0],_=arguments[1];Jt.constructor_.call(this,_),this.init(d)}}}])}(Jt),br=o(function v(){h(this,v)}),ur=function(v){function c(){var d;return h(this,c),d=s(this,c),c.constructor_.apply(d,arguments),d}return F(c,v),o(c,[{key:"computeEnvelopeInternal",value:function(){if(this.isEmpty())return new ii;var d=new ii;return d.expandToInclude(this._coordinates.getX(0),this._coordinates.getY(0)),d}},{key:"getCoordinates",value:function(){return this.isEmpty()?[]:[this.getCoordinate()]}},{key:"copyInternal",value:function(){return new c(this._coordinates.copy(),this._factory)}},{key:"equalsExact",value:function(){if(arguments.length===2&&typeof arguments[1]=="number"&&arguments[0]instanceof Jt){var d=arguments[0],_=arguments[1];return!!this.isEquivalentClass(d)&&(!(!this.isEmpty()||!d.isEmpty())||this.isEmpty()===d.isEmpty()&&this.equal(d.getCoordinate(),this.getCoordinate(),_))}return H(c,"equalsExact",this,1).apply(this,arguments)}},{key:"normalize",value:function(){}},{key:"getCoordinate",value:function(){return this._coordinates.size()!==0?this._coordinates.getCoordinate(0):null}},{key:"getBoundaryDimension",value:function(){return bt.FALSE}},{key:"reverseInternal",value:function(){return this.getFactory().createPoint(this._coordinates.copy())}},{key:"getTypeCode",value:function(){return Jt.TYPECODE_POINT}},{key:"getDimension",value:function(){return 0}},{key:"getNumPoints",value:function(){return this.isEmpty()?0:1}},{key:"getX",value:function(){if(this.getCoordinate()===null)throw new IllegalStateException("getX called on empty Point");return this.getCoordinate().x}},{key:"compareToSameClass",value:function(){if(arguments.length===1){var d=arguments[0];return this.getCoordinate().compareTo(d.getCoordinate())}if(arguments.length===2){var _=arguments[0];return arguments[1].compare(this._coordinates,_._coordinates)}}},{key:"apply",value:function(){if(Xt(arguments[0],nt)){var d=arguments[0];if(this.isEmpty())return null;d.filter(this.getCoordinate())}else if(Xt(arguments[0],li)){var _=arguments[0];if(this.isEmpty())return null;_.filter(this._coordinates,0),_.isGeometryChanged()&&this.geometryChanged()}else Xt(arguments[0],Ht)?arguments[0].filter(this):Xt(arguments[0],Re)&&arguments[0].filter(this)}},{key:"getBoundary",value:function(){return this.getFactory().createGeometryCollection()}},{key:"getGeometryType",value:function(){return Jt.TYPENAME_POINT}},{key:"getCoordinateSequence",value:function(){return this._coordinates}},{key:"getY",value:function(){if(this.getCoordinate()===null)throw new IllegalStateException("getY called on empty Point");return this.getCoordinate().y}},{key:"isEmpty",value:function(){return this._coordinates.size()===0}},{key:"init",value:function(d){d===null&&(d=this.getFactory().getCoordinateSequenceFactory().create([])),zt.isTrue(d.size()<=1),this._coordinates=d}},{key:"isSimple",value:function(){return!0}},{key:"interfaces_",get:function(){return[br]}}],[{key:"constructor_",value:function(){this._coordinates=null;var d=arguments[0],_=arguments[1];Jt.constructor_.call(this,_),this.init(d)}}])}(Jt),Ui=function(){function v(){h(this,v)}return o(v,null,[{key:"ofRing",value:function(){if(arguments[0]instanceof Array){var c=arguments[0];return Math.abs(v.ofRingSigned(c))}if(Xt(arguments[0],Bi)){var d=arguments[0];return Math.abs(v.ofRingSigned(d))}}},{key:"ofRingSigned",value:function(){if(arguments[0]instanceof Array){var c=arguments[0];if(c.length<3)return 0;for(var d=0,_=c[0].x,S=1;S<c.length-1;S++){var N=c[S].x-_,U=c[S+1].y;d+=N*(c[S-1].y-U)}return d/2}if(Xt(arguments[0],Bi)){var J=arguments[0],ge=J.size();if(ge<3)return 0;var Ie=new lt,st=new lt,ht=new lt;J.getCoordinate(0,st),J.getCoordinate(1,ht);var Pt=st.x;ht.x-=Pt;for(var Qt=0,wi=1;wi<ge-1;wi++)Ie.y=st.y,st.x=ht.x,st.y=ht.y,J.getCoordinate(wi+1,ht),ht.x-=Pt,Qt+=st.x*(Ie.y-ht.y);return Qt/2}}}])}(),Mi=function(){return o(function v(){h(this,v)},null,[{key:"sort",value:function(){var v=arguments,c=arguments[0];if(arguments.length===1)c.sort(function(Pt,Qt){return Pt.compareTo(Qt)});else if(arguments.length===2)c.sort(function(Pt,Qt){return v[1].compare(Pt,Qt)});else if(arguments.length===3){var d=c.slice(arguments[1],arguments[2]);d.sort();var _=c.slice(0,arguments[1]).concat(d,c.slice(arguments[2],c.length));c.splice(0,c.length);var S,N=P(_);try{for(N.s();!(S=N.n()).done;){var U=S.value;c.push(U)}}catch(Pt){N.e(Pt)}finally{N.f()}}else if(arguments.length===4){var J=c.slice(arguments[1],arguments[2]);J.sort(function(Pt,Qt){return v[3].compare(Pt,Qt)});var ge=c.slice(0,arguments[1]).concat(J,c.slice(arguments[2],c.length));c.splice(0,c.length);var Ie,st=P(ge);try{for(st.s();!(Ie=st.n()).done;){var ht=Ie.value;c.push(ht)}}catch(Pt){st.e(Pt)}finally{st.f()}}}},{key:"asList",value:function(v){var c,d=new me,_=P(v);try{for(_.s();!(c=_.n()).done;){var S=c.value;d.add(S)}}catch(N){_.e(N)}finally{_.f()}return d}},{key:"copyOf",value:function(v,c){return v.slice(0,c)}}])}(),Hi=o(function v(){h(this,v)}),Lr=function(v){function c(){var d;return h(this,c),d=s(this,c),c.constructor_.apply(d,arguments),d}return F(c,v),o(c,[{key:"computeEnvelopeInternal",value:function(){return this._shell.getEnvelopeInternal()}},{key:"getCoordinates",value:function(){if(this.isEmpty())return[];for(var d=new Array(this.getNumPoints()).fill(null),_=-1,S=this._shell.getCoordinates(),N=0;N<S.length;N++)d[++_]=S[N];for(var U=0;U<this._holes.length;U++)for(var J=this._holes[U].getCoordinates(),ge=0;ge<J.length;ge++)d[++_]=J[ge];return d}},{key:"getArea",value:function(){var d=0;d+=Ui.ofRing(this._shell.getCoordinateSequence());for(var _=0;_<this._holes.length;_++)d-=Ui.ofRing(this._holes[_].getCoordinateSequence());return d}},{key:"copyInternal",value:function(){for(var d=this._shell.copy(),_=new Array(this._holes.length).fill(null),S=0;S<this._holes.length;S++)_[S]=this._holes[S].copy();return new c(d,_,this._factory)}},{key:"isRectangle",value:function(){if(this.getNumInteriorRing()!==0||this._shell===null||this._shell.getNumPoints()!==5)return!1;for(var d=this._shell.getCoordinateSequence(),_=this.getEnvelopeInternal(),S=0;S<5;S++){var N=d.getX(S);if(N!==_.getMinX()&&N!==_.getMaxX())return!1;var U=d.getY(S);if(U!==_.getMinY()&&U!==_.getMaxY())return!1}for(var J=d.getX(0),ge=d.getY(0),Ie=1;Ie<=4;Ie++){var st=d.getX(Ie),ht=d.getY(Ie);if(st!==J==(ht!==ge))return!1;J=st,ge=ht}return!0}},{key:"equalsExact",value:function(){if(arguments.length===2&&typeof arguments[1]=="number"&&arguments[0]instanceof Jt){var d=arguments[0],_=arguments[1];if(!this.isEquivalentClass(d))return!1;var S=d,N=this._shell,U=S._shell;if(!N.equalsExact(U,_)||this._holes.length!==S._holes.length)return!1;for(var J=0;J<this._holes.length;J++)if(!this._holes[J].equalsExact(S._holes[J],_))return!1;return!0}return H(c,"equalsExact",this,1).apply(this,arguments)}},{key:"normalize",value:function(){if(arguments.length===0){this._shell=this.normalized(this._shell,!0);for(var d=0;d<this._holes.length;d++)this._holes[d]=this.normalized(this._holes[d],!1);Mi.sort(this._holes)}else if(arguments.length===2){var _=arguments[0],S=arguments[1];if(_.isEmpty())return null;var N=_.getCoordinateSequence(),U=Ut.minCoordinateIndex(N,0,N.size()-2);Ut.scroll(N,U,!0),Ii.isCCW(N)===S&&Ut.reverse(N)}}},{key:"getCoordinate",value:function(){return this._shell.getCoordinate()}},{key:"getNumInteriorRing",value:function(){return this._holes.length}},{key:"getBoundaryDimension",value:function(){return 1}},{key:"reverseInternal",value:function(){for(var d=this.getExteriorRing().reverse(),_=new Array(this.getNumInteriorRing()).fill(null),S=0;S<_.length;S++)_[S]=this.getInteriorRingN(S).reverse();return this.getFactory().createPolygon(d,_)}},{key:"getTypeCode",value:function(){return Jt.TYPECODE_POLYGON}},{key:"getDimension",value:function(){return 2}},{key:"getLength",value:function(){var d=0;d+=this._shell.getLength();for(var _=0;_<this._holes.length;_++)d+=this._holes[_].getLength();return d}},{key:"getNumPoints",value:function(){for(var d=this._shell.getNumPoints(),_=0;_<this._holes.length;_++)d+=this._holes[_].getNumPoints();return d}},{key:"convexHull",value:function(){return this.getExteriorRing().convexHull()}},{key:"normalized",value:function(d,_){var S=d.copy();return this.normalize(S,_),S}},{key:"compareToSameClass",value:function(){if(arguments.length===1){var d=arguments[0],_=this._shell,S=d._shell;return _.compareToSameClass(S)}if(arguments.length===2){var N=arguments[1],U=arguments[0],J=this._shell,ge=U._shell,Ie=J.compareToSameClass(ge,N);if(Ie!==0)return Ie;for(var st=this.getNumInteriorRing(),ht=U.getNumInteriorRing(),Pt=0;Pt<st&&Pt<ht;){var Qt=this.getInteriorRingN(Pt),wi=U.getInteriorRingN(Pt),Ni=Qt.compareToSameClass(wi,N);if(Ni!==0)return Ni;Pt++}return Pt<st?1:Pt<ht?-1:0}}},{key:"apply",value:function(){if(Xt(arguments[0],nt)){var d=arguments[0];this._shell.apply(d);for(var _=0;_<this._holes.length;_++)this._holes[_].apply(d)}else if(Xt(arguments[0],li)){var S=arguments[0];if(this._shell.apply(S),!S.isDone())for(var N=0;N<this._holes.length&&(this._holes[N].apply(S),!S.isDone());N++);S.isGeometryChanged()&&this.geometryChanged()}else if(Xt(arguments[0],Ht))arguments[0].filter(this);else if(Xt(arguments[0],Re)){var U=arguments[0];U.filter(this),this._shell.apply(U);for(var J=0;J<this._holes.length;J++)this._holes[J].apply(U)}}},{key:"getBoundary",value:function(){if(this.isEmpty())return this.getFactory().createMultiLineString();var d=new Array(this._holes.length+1).fill(null);d[0]=this._shell;for(var _=0;_<this._holes.length;_++)d[_+1]=this._holes[_];return d.length<=1?this.getFactory().createLinearRing(d[0].getCoordinateSequence()):this.getFactory().createMultiLineString(d)}},{key:"getGeometryType",value:function(){return Jt.TYPENAME_POLYGON}},{key:"getExteriorRing",value:function(){return this._shell}},{key:"isEmpty",value:function(){return this._shell.isEmpty()}},{key:"getInteriorRingN",value:function(d){return this._holes[d]}},{key:"interfaces_",get:function(){return[Hi]}}],[{key:"constructor_",value:function(){this._shell=null,this._holes=null;var d=arguments[0],_=arguments[1],S=arguments[2];if(Jt.constructor_.call(this,S),d===null&&(d=this.getFactory().createLinearRing()),_===null&&(_=[]),Jt.hasNullElements(_))throw new ye("holes must not contain null elements");if(d.isEmpty()&&Jt.hasNonEmptyElements(_))throw new ye("shell is empty but holes are not");this._shell=d,this._holes=_}}])}(Jt),Rt=function(v){function c(){return h(this,c),s(this,c,arguments)}return F(c,v),o(c)}(sr),Kr=function(v){function c(d){var _;return h(this,c),(_=s(this,c)).array=[],d instanceof zi&&_.addAll(d),_}return F(c,v),o(c,[{key:"contains",value:function(d){var _,S=P(this.array);try{for(S.s();!(_=S.n()).done;)if(_.value.compareTo(d)===0)return!0}catch(N){S.e(N)}finally{S.f()}return!1}},{key:"add",value:function(d){if(this.contains(d))return!1;for(var _=0,S=this.array.length;_<S;_++)if(this.array[_].compareTo(d)===1)return!!this.array.splice(_,0,d);return this.array.push(d),!0}},{key:"addAll",value:function(d){var _,S=P(d);try{for(S.s();!(_=S.n()).done;){var N=_.value;this.add(N)}}catch(U){S.e(U)}finally{S.f()}return!0}},{key:"remove",value:function(){throw new Gi}},{key:"size",value:function(){return this.array.length}},{key:"isEmpty",value:function(){return this.array.length===0}},{key:"toArray",value:function(){return this.array.slice()}},{key:"iterator",value:function(){return new Sr(this.array)}}])}(Rt),Sr=function(){return o(function v(c){h(this,v),this.array=c,this.position=0},[{key:"next",value:function(){if(this.position===this.array.length)throw new Qi;return this.array[this.position++]}},{key:"hasNext",value:function(){return this.position<this.array.length}},{key:"remove",value:function(){throw new Gi}}])}(),Or=function(v){function c(){var d;return h(this,c),d=s(this,c),c.constructor_.apply(d,arguments),d}return F(c,v),o(c,[{key:"computeEnvelopeInternal",value:function(){for(var d=new ii,_=0;_<this._geometries.length;_++)d.expandToInclude(this._geometries[_].getEnvelopeInternal());return d}},{key:"getGeometryN",value:function(d){return this._geometries[d]}},{key:"getCoordinates",value:function(){for(var d=new Array(this.getNumPoints()).fill(null),_=-1,S=0;S<this._geometries.length;S++)for(var N=this._geometries[S].getCoordinates(),U=0;U<N.length;U++)d[++_]=N[U];return d}},{key:"getArea",value:function(){for(var d=0,_=0;_<this._geometries.length;_++)d+=this._geometries[_].getArea();return d}},{key:"copyInternal",value:function(){for(var d=new Array(this._geometries.length).fill(null),_=0;_<d.length;_++)d[_]=this._geometries[_].copy();return new c(d,this._factory)}},{key:"equalsExact",value:function(){if(arguments.length===2&&typeof arguments[1]=="number"&&arguments[0]instanceof Jt){var d=arguments[0],_=arguments[1];if(!this.isEquivalentClass(d))return!1;var S=d;if(this._geometries.length!==S._geometries.length)return!1;for(var N=0;N<this._geometries.length;N++)if(!this._geometries[N].equalsExact(S._geometries[N],_))return!1;return!0}return H(c,"equalsExact",this,1).apply(this,arguments)}},{key:"normalize",value:function(){for(var d=0;d<this._geometries.length;d++)this._geometries[d].normalize();Mi.sort(this._geometries)}},{key:"getCoordinate",value:function(){return this.isEmpty()?null:this._geometries[0].getCoordinate()}},{key:"getBoundaryDimension",value:function(){for(var d=bt.FALSE,_=0;_<this._geometries.length;_++)d=Math.max(d,this._geometries[_].getBoundaryDimension());return d}},{key:"reverseInternal",value:function(){for(var d=this._geometries.length,_=new me(d),S=0;S<d;S++)_.add(this._geometries[S].reverse());return this.getFactory().buildGeometry(_)}},{key:"getTypeCode",value:function(){return Jt.TYPECODE_GEOMETRYCOLLECTION}},{key:"getDimension",value:function(){for(var d=bt.FALSE,_=0;_<this._geometries.length;_++)d=Math.max(d,this._geometries[_].getDimension());return d}},{key:"getLength",value:function(){for(var d=0,_=0;_<this._geometries.length;_++)d+=this._geometries[_].getLength();return d}},{key:"getNumPoints",value:function(){for(var d=0,_=0;_<this._geometries.length;_++)d+=this._geometries[_].getNumPoints();return d}},{key:"getNumGeometries",value:function(){return this._geometries.length}},{key:"compareToSameClass",value:function(){if(arguments.length===1){var d=arguments[0],_=new Kr(Mi.asList(this._geometries)),S=new Kr(Mi.asList(d._geometries));return this.compare(_,S)}if(arguments.length===2){for(var N=arguments[1],U=arguments[0],J=this.getNumGeometries(),ge=U.getNumGeometries(),Ie=0;Ie<J&&Ie<ge;){var st=this.getGeometryN(Ie),ht=U.getGeometryN(Ie),Pt=st.compareToSameClass(ht,N);if(Pt!==0)return Pt;Ie++}return Ie<J?1:Ie<ge?-1:0}}},{key:"apply",value:function(){if(Xt(arguments[0],nt))for(var d=arguments[0],_=0;_<this._geometries.length;_++)this._geometries[_].apply(d);else if(Xt(arguments[0],li)){var S=arguments[0];if(this._geometries.length===0)return null;for(var N=0;N<this._geometries.length&&(this._geometries[N].apply(S),!S.isDone());N++);S.isGeometryChanged()&&this.geometryChanged()}else if(Xt(arguments[0],Ht)){var U=arguments[0];U.filter(this);for(var J=0;J<this._geometries.length;J++)this._geometries[J].apply(U)}else if(Xt(arguments[0],Re)){var ge=arguments[0];ge.filter(this);for(var Ie=0;Ie<this._geometries.length;Ie++)this._geometries[Ie].apply(ge)}}},{key:"getBoundary",value:function(){return Jt.checkNotGeometryCollection(this),zt.shouldNeverReachHere(),null}},{key:"getGeometryType",value:function(){return Jt.TYPENAME_GEOMETRYCOLLECTION}},{key:"isEmpty",value:function(){for(var d=0;d<this._geometries.length;d++)if(!this._geometries[d].isEmpty())return!1;return!0}}],[{key:"constructor_",value:function(){if(this._geometries=null,arguments.length!==0&&arguments.length===2){var d=arguments[0],_=arguments[1];if(Jt.constructor_.call(this,_),d===null&&(d=[]),Jt.hasNullElements(d))throw new ye("geometries must not contain null elements");this._geometries=d}}}])}(Jt),Ps=function(v){function c(){var d;return h(this,c),d=s(this,c),c.constructor_.apply(d,arguments),d}return F(c,v),o(c,[{key:"copyInternal",value:function(){for(var d=new Array(this._geometries.length).fill(null),_=0;_<d.length;_++)d[_]=this._geometries[_].copy();return new c(d,this._factory)}},{key:"isValid",value:function(){return!0}},{key:"equalsExact",value:function(){if(arguments.length===2&&typeof arguments[1]=="number"&&arguments[0]instanceof Jt){var d=arguments[0],_=arguments[1];return!!this.isEquivalentClass(d)&&H(c,"equalsExact",this,1).call(this,d,_)}return H(c,"equalsExact",this,1).apply(this,arguments)}},{key:"getCoordinate",value:function(){if(arguments.length===1&&Number.isInteger(arguments[0])){var d=arguments[0];return this._geometries[d].getCoordinate()}return H(c,"getCoordinate",this,1).apply(this,arguments)}},{key:"getBoundaryDimension",value:function(){return bt.FALSE}},{key:"getTypeCode",value:function(){return Jt.TYPECODE_MULTIPOINT}},{key:"getDimension",value:function(){return 0}},{key:"getBoundary",value:function(){return this.getFactory().createGeometryCollection()}},{key:"getGeometryType",value:function(){return Jt.TYPENAME_MULTIPOINT}},{key:"interfaces_",get:function(){return[br]}}],[{key:"constructor_",value:function(){var d=arguments[0],_=arguments[1];Or.constructor_.call(this,d,_)}}])}(Or),Bt=function(v){function c(){var d;return h(this,c),d=s(this,c),c.constructor_.apply(d,arguments),d}return F(c,v),o(c,[{key:"copyInternal",value:function(){return new c(this._points.copy(),this._factory)}},{key:"getBoundaryDimension",value:function(){return bt.FALSE}},{key:"isClosed",value:function(){return!!this.isEmpty()||H(c,"isClosed",this,1).call(this)}},{key:"reverseInternal",value:function(){var d=this._points.copy();return Ut.reverse(d),this.getFactory().createLinearRing(d)}},{key:"getTypeCode",value:function(){return Jt.TYPECODE_LINEARRING}},{key:"validateConstruction",value:function(){if(!this.isEmpty()&&!H(c,"isClosed",this,1).call(this))throw new ye("Points of LinearRing do not form a closed linestring");if(this.getCoordinateSequence().size()>=1&&this.getCoordinateSequence().size()<c.MINIMUM_VALID_SIZE)throw new ye("Invalid number of points in LinearRing (found "+this.getCoordinateSequence().size()+" - must be 0 or >= 4)")}},{key:"getGeometryType",value:function(){return Jt.TYPENAME_LINEARRING}}],[{key:"constructor_",value:function(){var d=arguments[0],_=arguments[1];Ci.constructor_.call(this,d,_),this.validateConstruction()}}])}(Ci);Bt.MINIMUM_VALID_SIZE=4;var xi=function(v){function c(){var d;return h(this,c),d=s(this,c),c.constructor_.apply(d,arguments),d}return F(c,v),o(c,[{key:"setOrdinate",value:function(d,_){switch(d){case c.X:this.x=_;break;case c.Y:this.y=_;break;default:throw new ye("Invalid ordinate index: "+d)}}},{key:"getZ",value:function(){return lt.NULL_ORDINATE}},{key:"getOrdinate",value:function(d){switch(d){case c.X:return this.x;case c.Y:return this.y}throw new ye("Invalid ordinate index: "+d)}},{key:"setZ",value:function(d){throw new ye("CoordinateXY dimension 2 does not support z-ordinate")}},{key:"copy",value:function(){return new c(this)}},{key:"toString",value:function(){return"("+this.x+", "+this.y+")"}},{key:"setCoordinate",value:function(d){this.x=d.x,this.y=d.y,this.z=d.getZ()}}],[{key:"constructor_",value:function(){if(arguments.length===0)lt.constructor_.call(this);else if(arguments.length===1){if(arguments[0]instanceof c){var d=arguments[0];lt.constructor_.call(this,d.x,d.y)}else if(arguments[0]instanceof lt){var _=arguments[0];lt.constructor_.call(this,_.x,_.y)}}else if(arguments.length===2){var S=arguments[0],N=arguments[1];lt.constructor_.call(this,S,N,lt.NULL_ORDINATE)}}}])}(lt);xi.X=0,xi.Y=1,xi.Z=-1,xi.M=-1;var it=function(v){function c(){var d;return h(this,c),d=s(this,c),c.constructor_.apply(d,arguments),d}return F(c,v),o(c,[{key:"getM",value:function(){return this._m}},{key:"setOrdinate",value:function(d,_){switch(d){case c.X:this.x=_;break;case c.Y:this.y=_;break;case c.M:this._m=_;break;default:throw new ye("Invalid ordinate index: "+d)}}},{key:"setM",value:function(d){this._m=d}},{key:"getZ",value:function(){return lt.NULL_ORDINATE}},{key:"getOrdinate",value:function(d){switch(d){case c.X:return this.x;case c.Y:return this.y;case c.M:return this._m}throw new ye("Invalid ordinate index: "+d)}},{key:"setZ",value:function(d){throw new ye("CoordinateXY dimension 2 does not support z-ordinate")}},{key:"copy",value:function(){return new c(this)}},{key:"toString",value:function(){return"("+this.x+", "+this.y+" m="+this.getM()+")"}},{key:"setCoordinate",value:function(d){this.x=d.x,this.y=d.y,this.z=d.getZ(),this._m=d.getM()}}],[{key:"constructor_",value:function(){if(this._m=null,arguments.length===0)lt.constructor_.call(this),this._m=0;else if(arguments.length===1){if(arguments[0]instanceof c){var d=arguments[0];lt.constructor_.call(this,d.x,d.y),this._m=d._m}else if(arguments[0]instanceof lt){var _=arguments[0];lt.constructor_.call(this,_.x,_.y),this._m=this.getM()}}else if(arguments.length===3){var S=arguments[0],N=arguments[1],U=arguments[2];lt.constructor_.call(this,S,N,lt.NULL_ORDINATE),this._m=U}}}])}(lt);it.X=0,it.Y=1,it.Z=-1,it.M=2;var Wi=function(v){function c(){var d;return h(this,c),d=s(this,c),c.constructor_.apply(d,arguments),d}return F(c,v),o(c,[{key:"getM",value:function(){return this._m}},{key:"setOrdinate",value:function(d,_){switch(d){case lt.X:this.x=_;break;case lt.Y:this.y=_;break;case lt.Z:this.z=_;break;case lt.M:this._m=_;break;default:throw new ye("Invalid ordinate index: "+d)}}},{key:"setM",value:function(d){this._m=d}},{key:"getOrdinate",value:function(d){switch(d){case lt.X:return this.x;case lt.Y:return this.y;case lt.Z:return this.getZ();case lt.M:return this.getM()}throw new ye("Invalid ordinate index: "+d)}},{key:"copy",value:function(){return new c(this)}},{key:"toString",value:function(){return"("+this.x+", "+this.y+", "+this.getZ()+" m="+this.getM()+")"}},{key:"setCoordinate",value:function(d){this.x=d.x,this.y=d.y,this.z=d.getZ(),this._m=d.getM()}}],[{key:"constructor_",value:function(){if(this._m=null,arguments.length===0)lt.constructor_.call(this),this._m=0;else if(arguments.length===1){if(arguments[0]instanceof c){var d=arguments[0];lt.constructor_.call(this,d),this._m=d._m}else if(arguments[0]instanceof lt){var _=arguments[0];lt.constructor_.call(this,_),this._m=this.getM()}}else if(arguments.length===4){var S=arguments[0],N=arguments[1],U=arguments[2],J=arguments[3];lt.constructor_.call(this,S,N,U),this._m=J}}}])}(lt),Dr=function(){function v(){h(this,v)}return o(v,null,[{key:"measures",value:function(c){return c instanceof xi?0:c instanceof it||c instanceof Wi?1:0}},{key:"dimension",value:function(c){return c instanceof xi?2:c instanceof it?3:c instanceof Wi?4:3}},{key:"create",value:function(){if(arguments.length===1){var c=arguments[0];return v.create(c,0)}if(arguments.length===2){var d=arguments[0],_=arguments[1];return d===2?new xi:d===3&&_===0?new lt:d===3&&_===1?new it:d===4&&_===1?new Wi:new lt}}}])}(),Er=function(v){function c(){var d;return h(this,c),d=s(this,c),c.constructor_.apply(d,arguments),d}return F(c,v),o(c,[{key:"getCoordinate",value:function(d){return this.get(d)}},{key:"addAll",value:function(){if(arguments.length===2&&typeof arguments[1]=="boolean"&&Xt(arguments[0],zi)){for(var d=arguments[1],_=!1,S=arguments[0].iterator();S.hasNext();)this.add(S.next(),d),_=!0;return _}return H(c,"addAll",this,1).apply(this,arguments)}},{key:"clone",value:function(){for(var d=H(c,"clone",this,1).call(this),_=0;_<this.size();_++)d.add(_,this.get(_).clone());return d}},{key:"toCoordinateArray",value:function(){if(arguments.length===0)return this.toArray(c.coordArrayType);if(arguments.length===1){if(arguments[0])return this.toArray(c.coordArrayType);for(var d=this.size(),_=new Array(d).fill(null),S=0;S<d;S++)_[S]=this.get(d-S-1);return _}}},{key:"add",value:function(){if(arguments.length===1){var d=arguments[0];return H(c,"add",this,1).call(this,d)}if(arguments.length===2){if(arguments[0]instanceof Array&&typeof arguments[1]=="boolean"){var _=arguments[0],S=arguments[1];return this.add(_,S,!0),!0}if(arguments[0]instanceof lt&&typeof arguments[1]=="boolean"){var N=arguments[0];if(!arguments[1]&&this.size()>=1&&this.get(this.size()-1).equals2D(N))return null;H(c,"add",this,1).call(this,N)}else if(arguments[0]instanceof Object&&typeof arguments[1]=="boolean"){var U=arguments[0],J=arguments[1];return this.add(U,J),!0}}else if(arguments.length===3){if(typeof arguments[2]=="boolean"&&arguments[0]instanceof Array&&typeof arguments[1]=="boolean"){var ge=arguments[0],Ie=arguments[1];if(arguments[2])for(var st=0;st<ge.length;st++)this.add(ge[st],Ie);else for(var ht=ge.length-1;ht>=0;ht--)this.add(ge[ht],Ie);return!0}if(typeof arguments[2]=="boolean"&&Number.isInteger(arguments[0])&&arguments[1]instanceof lt){var Pt=arguments[0],Qt=arguments[1];if(!arguments[2]){var wi=this.size();if(wi>0&&(Pt>0&&this.get(Pt-1).equals2D(Qt)||Pt<wi&&this.get(Pt).equals2D(Qt)))return null}H(c,"add",this,1).call(this,Pt,Qt)}}else if(arguments.length===4){var Ni=arguments[0],_i=arguments[1],yi=arguments[2],cr=arguments[3],hr=1;yi>cr&&(hr=-1);for(var dn=yi;dn!==cr;dn+=hr)this.add(Ni[dn],_i);return!0}}},{key:"closeRing",value:function(){if(this.size()>0){var d=this.get(0).copy();this.add(d,!1)}}}],[{key:"constructor_",value:function(){if(arguments.length!==0){if(arguments.length===1){var d=arguments[0];this.ensureCapacity(d.length),this.add(d,!0)}else if(arguments.length===2){var _=arguments[0],S=arguments[1];this.ensureCapacity(_.length),this.add(_,S)}}}}])}(me);Er.coordArrayType=new Array(0).fill(null);var ri=function(){function v(){h(this,v)}return o(v,null,[{key:"isRing",value:function(c){return!(c.length<4)&&!!c[0].equals2D(c[c.length-1])}},{key:"ptNotInList",value:function(c,d){for(var _=0;_<c.length;_++){var S=c[_];if(v.indexOf(S,d)<0)return S}return null}},{key:"scroll",value:function(c,d){var _=v.indexOf(d,c);if(_<0)return null;var S=new Array(c.length).fill(null);at.arraycopy(c,_,S,0,c.length-_),at.arraycopy(c,0,S,c.length-_,_),at.arraycopy(S,0,c,0,c.length)}},{key:"equals",value:function(){if(arguments.length===2){var c=arguments[0],d=arguments[1];if(c===d)return!0;if(c===null||d===null||c.length!==d.length)return!1;for(var _=0;_<c.length;_++)if(!c[_].equals(d[_]))return!1;return!0}if(arguments.length===3){var S=arguments[0],N=arguments[1],U=arguments[2];if(S===N)return!0;if(S===null||N===null||S.length!==N.length)return!1;for(var J=0;J<S.length;J++)if(U.compare(S[J],N[J])!==0)return!1;return!0}}},{key:"intersection",value:function(c,d){for(var _=new Er,S=0;S<c.length;S++)d.intersects(c[S])&&_.add(c[S],!0);return _.toCoordinateArray()}},{key:"measures",value:function(c){if(c===null||c.length===0)return 0;var d,_=0,S=P(c);try{for(S.s();!(d=S.n()).done;){var N=d.value;_=Math.max(_,Dr.measures(N))}}catch(U){S.e(U)}finally{S.f()}return _}},{key:"hasRepeatedPoints",value:function(c){for(var d=1;d<c.length;d++)if(c[d-1].equals(c[d]))return!0;return!1}},{key:"removeRepeatedPoints",value:function(c){return v.hasRepeatedPoints(c)?new Er(c,!1).toCoordinateArray():c}},{key:"reverse",value:function(c){for(var d=c.length-1,_=Math.trunc(d/2),S=0;S<=_;S++){var N=c[S];c[S]=c[d-S],c[d-S]=N}}},{key:"removeNull",value:function(c){for(var d=0,_=0;_<c.length;_++)c[_]!==null&&d++;var S=new Array(d).fill(null);if(d===0)return S;for(var N=0,U=0;U<c.length;U++)c[U]!==null&&(S[N++]=c[U]);return S}},{key:"copyDeep",value:function(){if(arguments.length===1){for(var c=arguments[0],d=new Array(c.length).fill(null),_=0;_<c.length;_++)d[_]=c[_].copy();return d}if(arguments.length===5)for(var S=arguments[0],N=arguments[1],U=arguments[2],J=arguments[3],ge=arguments[4],Ie=0;Ie<ge;Ie++)U[J+Ie]=S[N+Ie].copy()}},{key:"isEqualReversed",value:function(c,d){for(var _=0;_<c.length;_++){var S=c[_],N=d[c.length-_-1];if(S.compareTo(N)!==0)return!1}return!0}},{key:"envelope",value:function(c){for(var d=new ii,_=0;_<c.length;_++)d.expandToInclude(c[_]);return d}},{key:"toCoordinateArray",value:function(c){return c.toArray(v.coordArrayType)}},{key:"dimension",value:function(c){if(c===null||c.length===0)return 3;var d,_=0,S=P(c);try{for(S.s();!(d=S.n()).done;){var N=d.value;_=Math.max(_,Dr.dimension(N))}}catch(U){S.e(U)}finally{S.f()}return _}},{key:"atLeastNCoordinatesOrNothing",value:function(c,d){return d.length>=c?d:[]}},{key:"indexOf",value:function(c,d){for(var _=0;_<d.length;_++)if(c.equals(d[_]))return _;return-1}},{key:"increasingDirection",value:function(c){for(var d=0;d<Math.trunc(c.length/2);d++){var _=c.length-1-d,S=c[d].compareTo(c[_]);if(S!==0)return S}return 1}},{key:"compare",value:function(c,d){for(var _=0;_<c.length&&_<d.length;){var S=c[_].compareTo(d[_]);if(S!==0)return S;_++}return _<d.length?-1:_<c.length?1:0}},{key:"minCoordinate",value:function(c){for(var d=null,_=0;_<c.length;_++)(d===null||d.compareTo(c[_])>0)&&(d=c[_]);return d}},{key:"extract",value:function(c,d,_){d=He.clamp(d,0,c.length);var S=(_=He.clamp(_,-1,c.length))-d+1;_<0&&(S=0),d>=c.length&&(S=0),_<d&&(S=0);var N=new Array(S).fill(null);if(S===0)return N;for(var U=0,J=d;J<=_;J++)N[U++]=c[J];return N}}])}(),Wr=function(){return o(function v(){h(this,v)},[{key:"compare",value:function(v,c){var d=v,_=c;return ri.compare(d,_)}},{key:"interfaces_",get:function(){return[Ft]}}])}(),vn=function(){return o(function v(){h(this,v)},[{key:"compare",value:function(v,c){var d=v,_=c;if(d.length<_.length)return-1;if(d.length>_.length)return 1;if(d.length===0)return 0;var S=ri.compare(d,_);return ri.isEqualReversed(d,_)?0:S}},{key:"OLDcompare",value:function(v,c){var d=v,_=c;if(d.length<_.length)return-1;if(d.length>_.length)return 1;if(d.length===0)return 0;for(var S=ri.increasingDirection(d),N=ri.increasingDirection(_),U=S>0?0:d.length-1,J=N>0?0:d.length-1,ge=0;ge<d.length;ge++){var Ie=d[U].compareTo(_[J]);if(Ie!==0)return Ie;U+=S,J+=N}return 0}},{key:"interfaces_",get:function(){return[Ft]}}])}();ri.ForwardComparator=Wr,ri.BidirectionalComparator=vn,ri.coordArrayType=new Array(0).fill(null);var Ai=function(){return o(function v(c){h(this,v),this.str=c},[{key:"append",value:function(v){this.str+=v}},{key:"setCharAt",value:function(v,c){this.str=this.str.substr(0,v)+c+this.str.substr(v+1)}},{key:"toString",value:function(){return this.str}}])}(),Sn=function(){function v(){h(this,v),v.constructor_.apply(this,arguments)}return o(v,[{key:"getM",value:function(c){return this.hasM()?this._coordinates[c].getM():vt.NaN}},{key:"setOrdinate",value:function(c,d,_){switch(d){case Bi.X:this._coordinates[c].x=_;break;case Bi.Y:this._coordinates[c].y=_;break;default:this._coordinates[c].setOrdinate(d,_)}}},{key:"getZ",value:function(c){return this.hasZ()?this._coordinates[c].getZ():vt.NaN}},{key:"size",value:function(){return this._coordinates.length}},{key:"getOrdinate",value:function(c,d){switch(d){case Bi.X:return this._coordinates[c].x;case Bi.Y:return this._coordinates[c].y;default:return this._coordinates[c].getOrdinate(d)}}},{key:"getCoordinate",value:function(){if(arguments.length===1){var c=arguments[0];return this._coordinates[c]}if(arguments.length===2){var d=arguments[0];arguments[1].setCoordinate(this._coordinates[d])}}},{key:"getCoordinateCopy",value:function(c){var d=this.createCoordinate();return d.setCoordinate(this._coordinates[c]),d}},{key:"createCoordinate",value:function(){return Dr.create(this.getDimension(),this.getMeasures())}},{key:"getDimension",value:function(){return this._dimension}},{key:"getX",value:function(c){return this._coordinates[c].x}},{key:"getMeasures",value:function(){return this._measures}},{key:"expandEnvelope",value:function(c){for(var d=0;d<this._coordinates.length;d++)c.expandToInclude(this._coordinates[d]);return c}},{key:"copy",value:function(){for(var c=new Array(this.size()).fill(null),d=0;d<this._coordinates.length;d++){var _=this.createCoordinate();_.setCoordinate(this._coordinates[d]),c[d]=_}return new v(c,this._dimension,this._measures)}},{key:"toString",value:function(){if(this._coordinates.length>0){var c=new Ai(17*this._coordinates.length);c.append("("),c.append(this._coordinates[0]);for(var d=1;d<this._coordinates.length;d++)c.append(", "),c.append(this._coordinates[d]);return c.append(")"),c.toString()}return"()"}},{key:"getY",value:function(c){return this._coordinates[c].y}},{key:"toCoordinateArray",value:function(){return this._coordinates}},{key:"interfaces_",get:function(){return[Bi,$]}}],[{key:"constructor_",value:function(){if(this._dimension=3,this._measures=0,this._coordinates=null,arguments.length===1){if(arguments[0]instanceof Array){var c=arguments[0];v.constructor_.call(this,c,ri.dimension(c),ri.measures(c))}else if(Number.isInteger(arguments[0])){var d=arguments[0];this._coordinates=new Array(d).fill(null);for(var _=0;_<d;_++)this._coordinates[_]=new lt}else if(Xt(arguments[0],Bi)){var S=arguments[0];if(S===null)return this._coordinates=new Array(0).fill(null),null;this._dimension=S.getDimension(),this._measures=S.getMeasures(),this._coordinates=new Array(S.size()).fill(null);for(var N=0;N<this._coordinates.length;N++)this._coordinates[N]=S.getCoordinateCopy(N)}}else if(arguments.length===2){if(arguments[0]instanceof Array&&Number.isInteger(arguments[1])){var U=arguments[0],J=arguments[1];v.constructor_.call(this,U,J,ri.measures(U))}else if(Number.isInteger(arguments[0])&&Number.isInteger(arguments[1])){var ge=arguments[0],Ie=arguments[1];this._coordinates=new Array(ge).fill(null),this._dimension=Ie;for(var st=0;st<ge;st++)this._coordinates[st]=Dr.create(Ie)}}else if(arguments.length===3){if(Number.isInteger(arguments[2])&&arguments[0]instanceof Array&&Number.isInteger(arguments[1])){var ht=arguments[0],Pt=arguments[1],Qt=arguments[2];this._dimension=Pt,this._measures=Qt,this._coordinates=ht===null?new Array(0).fill(null):ht}else if(Number.isInteger(arguments[2])&&Number.isInteger(arguments[0])&&Number.isInteger(arguments[1])){var wi=arguments[0],Ni=arguments[1],_i=arguments[2];this._coordinates=new Array(wi).fill(null),this._dimension=Ni,this._measures=_i;for(var yi=0;yi<wi;yi++)this._coordinates[yi]=this.createCoordinate()}}}}])}(),Yr=function(){function v(){h(this,v)}return o(v,[{key:"readResolve",value:function(){return v.instance()}},{key:"create",value:function(){if(arguments.length===1){if(arguments[0]instanceof Array)return new Sn(arguments[0]);if(Xt(arguments[0],Bi))return new Sn(arguments[0])}else{if(arguments.length===2){var c=arguments[1];return c>3&&(c=3),c<2&&(c=2),new Sn(arguments[0],c)}if(arguments.length===3){var d=arguments[2],_=arguments[1]-d;return d>1&&(d=1),_>3&&(_=3),_<2&&(_=2),new Sn(arguments[0],_+d,d)}}}},{key:"interfaces_",get:function(){return[ft,$]}}],[{key:"instance",value:function(){return v.instanceObject}}])}();Yr.instanceObject=new Yr;var gr=function(v){function c(){var d;return h(this,c),d=s(this,c),c.constructor_.apply(d,arguments),d}return F(c,v),o(c,[{key:"copyInternal",value:function(){for(var d=new Array(this._geometries.length).fill(null),_=0;_<d.length;_++)d[_]=this._geometries[_].copy();return new c(d,this._factory)}},{key:"equalsExact",value:function(){if(arguments.length===2&&typeof arguments[1]=="number"&&arguments[0]instanceof Jt){var d=arguments[0],_=arguments[1];return!!this.isEquivalentClass(d)&&H(c,"equalsExact",this,1).call(this,d,_)}return H(c,"equalsExact",this,1).apply(this,arguments)}},{key:"getBoundaryDimension",value:function(){return 1}},{key:"getTypeCode",value:function(){return Jt.TYPECODE_MULTIPOLYGON}},{key:"getDimension",value:function(){return 2}},{key:"getBoundary",value:function(){if(this.isEmpty())return this.getFactory().createMultiLineString();for(var d=new me,_=0;_<this._geometries.length;_++)for(var S=this._geometries[_].getBoundary(),N=0;N<S.getNumGeometries();N++)d.add(S.getGeometryN(N));var U=new Array(d.size()).fill(null);return this.getFactory().createMultiLineString(d.toArray(U))}},{key:"getGeometryType",value:function(){return Jt.TYPENAME_MULTIPOLYGON}},{key:"interfaces_",get:function(){return[Hi]}}],[{key:"constructor_",value:function(){var d=arguments[0],_=arguments[1];Or.constructor_.call(this,d,_)}}])}(Or),Xn=function(){return o(function v(){h(this,v)},[{key:"get",value:function(){}},{key:"put",value:function(){}},{key:"size",value:function(){}},{key:"values",value:function(){}},{key:"entrySet",value:function(){}}])}(),Mn=function(v){function c(){var d;return h(this,c),(d=s(this,c)).map=new Map,d}return F(c,v),o(c,[{key:"get",value:function(d){return this.map.get(d)||null}},{key:"put",value:function(d,_){return this.map.set(d,_),_}},{key:"values",value:function(){for(var d=new me,_=this.map.values(),S=_.next();!S.done;)d.add(S.value),S=_.next();return d}},{key:"entrySet",value:function(){var d=new jr;return this.map.entries().forEach(function(_){return d.add(_)}),d}},{key:"size",value:function(){return this.map.size()}}])}(Xn),qi=function(){function v(){h(this,v),v.constructor_.apply(this,arguments)}return o(v,[{key:"equals",value:function(c){if(!(c instanceof v))return!1;var d=c;return this._modelType===d._modelType&&this._scale===d._scale}},{key:"compareTo",value:function(c){var d=c,_=this.getMaximumSignificantDigits(),S=d.getMaximumSignificantDigits();return gi.compare(_,S)}},{key:"getScale",value:function(){return this._scale}},{key:"isFloating",value:function(){return this._modelType===v.FLOATING||this._modelType===v.FLOATING_SINGLE}},{key:"getType",value:function(){return this._modelType}},{key:"toString",value:function(){var c="UNKNOWN";return this._modelType===v.FLOATING?c="Floating":this._modelType===v.FLOATING_SINGLE?c="Floating-Single":this._modelType===v.FIXED&&(c="Fixed (Scale="+this.getScale()+")"),c}},{key:"makePrecise",value:function(){if(typeof arguments[0]=="number"){var c=arguments[0];return vt.isNaN(c)||this._modelType===v.FLOATING_SINGLE?c:this._modelType===v.FIXED?Math.round(c*this._scale)/this._scale:c}if(arguments[0]instanceof lt){var d=arguments[0];if(this._modelType===v.FLOATING)return null;d.x=this.makePrecise(d.x),d.y=this.makePrecise(d.y)}}},{key:"getMaximumSignificantDigits",value:function(){var c=16;return this._modelType===v.FLOATING?c=16:this._modelType===v.FLOATING_SINGLE?c=6:this._modelType===v.FIXED&&(c=1+Math.trunc(Math.ceil(Math.log(this.getScale())/Math.log(10)))),c}},{key:"setScale",value:function(c){this._scale=Math.abs(c)}},{key:"interfaces_",get:function(){return[$,Se]}}],[{key:"constructor_",value:function(){if(this._modelType=null,this._scale=null,arguments.length===0)this._modelType=v.FLOATING;else if(arguments.length===1){if(arguments[0]instanceof xn){var c=arguments[0];this._modelType=c,c===v.FIXED&&this.setScale(1)}else if(typeof arguments[0]=="number"){var d=arguments[0];this._modelType=v.FIXED,this.setScale(d)}else if(arguments[0]instanceof v){var _=arguments[0];this._modelType=_._modelType,this._scale=_._scale}}}},{key:"mostPrecise",value:function(c,d){return c.compareTo(d)>=0?c:d}}])}(),xn=function(){function v(){h(this,v),v.constructor_.apply(this,arguments)}return o(v,[{key:"readResolve",value:function(){return v.nameToTypeMap.get(this._name)}},{key:"toString",value:function(){return this._name}},{key:"interfaces_",get:function(){return[$]}}],[{key:"constructor_",value:function(){this._name=null;var c=arguments[0];this._name=c,v.nameToTypeMap.put(c,this)}}])}();xn.nameToTypeMap=new Mn,qi.Type=xn,qi.FIXED=new xn("FIXED"),qi.FLOATING=new xn("FLOATING"),qi.FLOATING_SINGLE=new xn("FLOATING SINGLE"),qi.maximumPreciseValue=9007199254740992;var $n=function(v){function c(){var d;return h(this,c),d=s(this,c),c.constructor_.apply(d,arguments),d}return F(c,v),o(c,[{key:"copyInternal",value:function(){for(var d=new Array(this._geometries.length).fill(null),_=0;_<d.length;_++)d[_]=this._geometries[_].copy();return new c(d,this._factory)}},{key:"equalsExact",value:function(){if(arguments.length===2&&typeof arguments[1]=="number"&&arguments[0]instanceof Jt){var d=arguments[0],_=arguments[1];return!!this.isEquivalentClass(d)&&H(c,"equalsExact",this,1).call(this,d,_)}return H(c,"equalsExact",this,1).apply(this,arguments)}},{key:"getBoundaryDimension",value:function(){return this.isClosed()?bt.FALSE:0}},{key:"isClosed",value:function(){if(this.isEmpty())return!1;for(var d=0;d<this._geometries.length;d++)if(!this._geometries[d].isClosed())return!1;return!0}},{key:"getTypeCode",value:function(){return Jt.TYPECODE_MULTILINESTRING}},{key:"getDimension",value:function(){return 1}},{key:"getBoundary",value:function(){throw new Gi}},{key:"getGeometryType",value:function(){return Jt.TYPENAME_MULTILINESTRING}},{key:"interfaces_",get:function(){return[Ve]}}],[{key:"constructor_",value:function(){var d=arguments[0],_=arguments[1];Or.constructor_.call(this,d,_)}}])}(Or),Jr=function(){function v(){h(this,v),v.constructor_.apply(this,arguments)}return o(v,[{key:"createEmpty",value:function(c){switch(c){case-1:return this.createGeometryCollection();case 0:return this.createPoint();case 1:return this.createLineString();case 2:return this.createPolygon();default:throw new ye("Invalid dimension: "+c)}}},{key:"toGeometry",value:function(c){return c.isNull()?this.createPoint():c.getMinX()===c.getMaxX()&&c.getMinY()===c.getMaxY()?this.createPoint(new lt(c.getMinX(),c.getMinY())):c.getMinX()===c.getMaxX()||c.getMinY()===c.getMaxY()?this.createLineString([new lt(c.getMinX(),c.getMinY()),new lt(c.getMaxX(),c.getMaxY())]):this.createPolygon(this.createLinearRing([new lt(c.getMinX(),c.getMinY()),new lt(c.getMinX(),c.getMaxY()),new lt(c.getMaxX(),c.getMaxY()),new lt(c.getMaxX(),c.getMinY()),new lt(c.getMinX(),c.getMinY())]),null)}},{key:"createLineString",value:function(){if(arguments.length===0)return this.createLineString(this.getCoordinateSequenceFactory().create([]));if(arguments.length===1){if(arguments[0]instanceof Array){var c=arguments[0];return this.createLineString(c!==null?this.getCoordinateSequenceFactory().create(c):null)}if(Xt(arguments[0],Bi))return new Ci(arguments[0],this)}}},{key:"createMultiLineString",value:function(){return arguments.length===0?new $n(null,this):arguments.length===1?new $n(arguments[0],this):void 0}},{key:"buildGeometry",value:function(c){for(var d=null,_=!1,S=!1,N=c.iterator();N.hasNext();){var U=N.next(),J=U.getTypeCode();d===null&&(d=J),J!==d&&(_=!0),U instanceof Or&&(S=!0)}if(d===null)return this.createGeometryCollection();if(_||S)return this.createGeometryCollection(v.toGeometryArray(c));var ge=c.iterator().next();if(c.size()>1){if(ge instanceof Lr)return this.createMultiPolygon(v.toPolygonArray(c));if(ge instanceof Ci)return this.createMultiLineString(v.toLineStringArray(c));if(ge instanceof ur)return this.createMultiPoint(v.toPointArray(c));zt.shouldNeverReachHere("Unhandled geometry type: "+ge.getGeometryType())}return ge}},{key:"createMultiPointFromCoords",value:function(c){return this.createMultiPoint(c!==null?this.getCoordinateSequenceFactory().create(c):null)}},{key:"createPoint",value:function(){if(arguments.length===0)return this.createPoint(this.getCoordinateSequenceFactory().create([]));if(arguments.length===1){if(arguments[0]instanceof lt){var c=arguments[0];return this.createPoint(c!==null?this.getCoordinateSequenceFactory().create([c]):null)}if(Xt(arguments[0],Bi))return new ur(arguments[0],this)}}},{key:"getCoordinateSequenceFactory",value:function(){return this._coordinateSequenceFactory}},{key:"createPolygon",value:function(){if(arguments.length===0)return this.createPolygon(null,null);if(arguments.length===1){if(Xt(arguments[0],Bi)){var c=arguments[0];return this.createPolygon(this.createLinearRing(c))}if(arguments[0]instanceof Array){var d=arguments[0];return this.createPolygon(this.createLinearRing(d))}if(arguments[0]instanceof Bt){var _=arguments[0];return this.createPolygon(_,null)}}else if(arguments.length===2)return new Lr(arguments[0],arguments[1],this)}},{key:"getSRID",value:function(){return this._SRID}},{key:"createGeometryCollection",value:function(){return arguments.length===0?new Or(null,this):arguments.length===1?new Or(arguments[0],this):void 0}},{key:"getPrecisionModel",value:function(){return this._precisionModel}},{key:"createLinearRing",value:function(){if(arguments.length===0)return this.createLinearRing(this.getCoordinateSequenceFactory().create([]));if(arguments.length===1){if(arguments[0]instanceof Array){var c=arguments[0];return this.createLinearRing(c!==null?this.getCoordinateSequenceFactory().create(c):null)}if(Xt(arguments[0],Bi))return new Bt(arguments[0],this)}}},{key:"createMultiPolygon",value:function(){return arguments.length===0?new gr(null,this):arguments.length===1?new gr(arguments[0],this):void 0}},{key:"createMultiPoint",value:function(){if(arguments.length===0)return new Ps(null,this);if(arguments.length===1){if(arguments[0]instanceof Array)return new Ps(arguments[0],this);if(Xt(arguments[0],Bi)){var c=arguments[0];if(c===null)return this.createMultiPoint(new Array(0).fill(null));for(var d=new Array(c.size()).fill(null),_=0;_<c.size();_++){var S=this.getCoordinateSequenceFactory().create(1,c.getDimension(),c.getMeasures());Ut.copy(c,_,S,0,1),d[_]=this.createPoint(S)}return this.createMultiPoint(d)}}}},{key:"interfaces_",get:function(){return[$]}}],[{key:"constructor_",value:function(){if(this._precisionModel=null,this._coordinateSequenceFactory=null,this._SRID=null,arguments.length===0)v.constructor_.call(this,new qi,0);else if(arguments.length===1){if(Xt(arguments[0],ft)){var c=arguments[0];v.constructor_.call(this,new qi,0,c)}else if(arguments[0]instanceof qi){var d=arguments[0];v.constructor_.call(this,d,0,v.getDefaultCoordinateSequenceFactory())}}else if(arguments.length===2){var _=arguments[0],S=arguments[1];v.constructor_.call(this,_,S,v.getDefaultCoordinateSequenceFactory())}else if(arguments.length===3){var N=arguments[0],U=arguments[1],J=arguments[2];this._precisionModel=N,this._coordinateSequenceFactory=J,this._SRID=U}}},{key:"toMultiPolygonArray",value:function(c){var d=new Array(c.size()).fill(null);return c.toArray(d)}},{key:"toGeometryArray",value:function(c){if(c===null)return null;var d=new Array(c.size()).fill(null);return c.toArray(d)}},{key:"getDefaultCoordinateSequenceFactory",value:function(){return Yr.instance()}},{key:"toMultiLineStringArray",value:function(c){var d=new Array(c.size()).fill(null);return c.toArray(d)}},{key:"toLineStringArray",value:function(c){var d=new Array(c.size()).fill(null);return c.toArray(d)}},{key:"toMultiPointArray",value:function(c){var d=new Array(c.size()).fill(null);return c.toArray(d)}},{key:"toLinearRingArray",value:function(c){var d=new Array(c.size()).fill(null);return c.toArray(d)}},{key:"toPointArray",value:function(c){var d=new Array(c.size()).fill(null);return c.toArray(d)}},{key:"toPolygonArray",value:function(c){var d=new Array(c.size()).fill(null);return c.toArray(d)}},{key:"createPointFromInternalCoord",value:function(c,d){return d.getPrecisionModel().makePrecise(c),d.getFactory().createPoint(c)}}])}(),vr="XY",Qs="XYZ",Wl="XYM",Yl="XYZM",dl={POINT:"Point",LINE_STRING:"LineString",LINEAR_RING:"LinearRing",POLYGON:"Polygon",MULTI_POINT:"MultiPoint",MULTI_LINE_STRING:"MultiLineString",MULTI_POLYGON:"MultiPolygon",GEOMETRY_COLLECTION:"GeometryCollection",CIRCLE:"Circle"},ho="EMPTY",Po=1,ks=2,as=3,Xl=4,ko=5,Wo=6;for(var Yo in dl)dl[Yo].toUpperCase();var C=function(){return o(function v(c){h(this,v),this.wkt=c,this.index_=-1},[{key:"isAlpha_",value:function(v){return v>="a"&&v<="z"||v>="A"&&v<="Z"}},{key:"isNumeric_",value:function(v,c){return v>="0"&&v<="9"||v=="."&&!(c!==void 0&&c)}},{key:"isWhiteSpace_",value:function(v){return v==" "||v=="	"||v=="\r"||v==`
`}},{key:"nextChar_",value:function(){return this.wkt.charAt(++this.index_)}},{key:"nextToken",value:function(){var v,c=this.nextChar_(),d=this.index_,_=c;if(c=="(")v=ks;else if(c==",")v=ko;else if(c==")")v=as;else if(this.isNumeric_(c)||c=="-")v=Xl,_=this.readNumber_();else if(this.isAlpha_(c))v=Po,_=this.readText_();else{if(this.isWhiteSpace_(c))return this.nextToken();if(c!=="")throw new Error("Unexpected character: "+c);v=Wo}return{position:d,value:_,type:v}}},{key:"readNumber_",value:function(){var v,c=this.index_,d=!1,_=!1;do v=="."?d=!0:v!="e"&&v!="E"||(_=!0),v=this.nextChar_();while(this.isNumeric_(v,d)||!_&&(v=="e"||v=="E")||_&&(v=="-"||v=="+"));return parseFloat(this.wkt.substring(c,this.index_--))}},{key:"readText_",value:function(){var v,c=this.index_;do v=this.nextChar_();while(this.isAlpha_(v));return this.wkt.substring(c,this.index_--).toUpperCase()}}])}(),j=function(){return o(function v(c,d){h(this,v),this.lexer_=c,this.token_,this.layout_=vr,this.factory=d},[{key:"consume_",value:function(){this.token_=this.lexer_.nextToken()}},{key:"isTokenType",value:function(v){return this.token_.type==v}},{key:"match",value:function(v){var c=this.isTokenType(v);return c&&this.consume_(),c}},{key:"parse",value:function(){return this.consume_(),this.parseGeometry_()}},{key:"parseGeometryLayout_",value:function(){var v=vr,c=this.token_;if(this.isTokenType(Po)){var d=c.value;d==="Z"?v=Qs:d==="M"?v=Wl:d==="ZM"&&(v=Yl),v!==vr&&this.consume_()}return v}},{key:"parseGeometryCollectionText_",value:function(){if(this.match(ks)){var v=[];do v.push(this.parseGeometry_());while(this.match(ko));if(this.match(as))return v}else if(this.isEmptyGeometry_())return[];throw new Error(this.formatErrorMessage_())}},{key:"parsePointText_",value:function(){if(this.match(ks)){var v=this.parsePoint_();if(this.match(as))return v}else if(this.isEmptyGeometry_())return null;throw new Error(this.formatErrorMessage_())}},{key:"parseLineStringText_",value:function(){if(this.match(ks)){var v=this.parsePointList_();if(this.match(as))return v}else if(this.isEmptyGeometry_())return[];throw new Error(this.formatErrorMessage_())}},{key:"parsePolygonText_",value:function(){if(this.match(ks)){var v=this.parseLineStringTextList_();if(this.match(as))return v}else if(this.isEmptyGeometry_())return[];throw new Error(this.formatErrorMessage_())}},{key:"parseMultiPointText_",value:function(){var v;if(this.match(ks)){if(v=this.token_.type==ks?this.parsePointTextList_():this.parsePointList_(),this.match(as))return v}else if(this.isEmptyGeometry_())return[];throw new Error(this.formatErrorMessage_())}},{key:"parseMultiLineStringText_",value:function(){if(this.match(ks)){var v=this.parseLineStringTextList_();if(this.match(as))return v}else if(this.isEmptyGeometry_())return[];throw new Error(this.formatErrorMessage_())}},{key:"parseMultiPolygonText_",value:function(){if(this.match(ks)){var v=this.parsePolygonTextList_();if(this.match(as))return v}else if(this.isEmptyGeometry_())return[];throw new Error(this.formatErrorMessage_())}},{key:"parsePoint_",value:function(){for(var v=[],c=this.layout_.length,d=0;d<c;++d){var _=this.token_;if(!this.match(Xl))break;v.push(_.value)}if(v.length==c)return v;throw new Error(this.formatErrorMessage_())}},{key:"parsePointList_",value:function(){for(var v=[this.parsePoint_()];this.match(ko);)v.push(this.parsePoint_());return v}},{key:"parsePointTextList_",value:function(){for(var v=[this.parsePointText_()];this.match(ko);)v.push(this.parsePointText_());return v}},{key:"parseLineStringTextList_",value:function(){for(var v=[this.parseLineStringText_()];this.match(ko);)v.push(this.parseLineStringText_());return v}},{key:"parsePolygonTextList_",value:function(){for(var v=[this.parsePolygonText_()];this.match(ko);)v.push(this.parsePolygonText_());return v}},{key:"isEmptyGeometry_",value:function(){var v=this.isTokenType(Po)&&this.token_.value==ho;return v&&this.consume_(),v}},{key:"formatErrorMessage_",value:function(){return"Unexpected `"+this.token_.value+"` at position "+this.token_.position+" in `"+this.lexer_.wkt+"`"}},{key:"parseGeometry_",value:function(){var v=this.factory,c=function(Ni){return x(lt,ve(Ni))},d=function(Ni){var _i=Ni.map(function(yi){return v.createLinearRing(yi.map(c))});return _i.length>1?v.createPolygon(_i[0],_i.slice(1)):v.createPolygon(_i[0])},_=this.token_;if(this.match(Po)){var S=_.value;if(this.layout_=this.parseGeometryLayout_(),S=="GEOMETRYCOLLECTION"){var N=this.parseGeometryCollectionText_();return v.createGeometryCollection(N)}switch(S){case"POINT":var U=this.parsePointText_();return U?v.createPoint(x(lt,ve(U))):v.createPoint();case"LINESTRING":var J=this.parseLineStringText_().map(c);return v.createLineString(J);case"LINEARRING":var ge=this.parseLineStringText_().map(c);return v.createLinearRing(ge);case"POLYGON":var Ie=this.parsePolygonText_();return Ie&&Ie.length!==0?d(Ie):v.createPolygon();case"MULTIPOINT":var st=this.parseMultiPointText_();if(!st||st.length===0)return v.createMultiPoint();var ht=st.map(c).map(function(Ni){return v.createPoint(Ni)});return v.createMultiPoint(ht);case"MULTILINESTRING":var Pt=this.parseMultiLineStringText_().map(function(Ni){return v.createLineString(Ni.map(c))});return v.createMultiLineString(Pt);case"MULTIPOLYGON":var Qt=this.parseMultiPolygonText_();if(!Qt||Qt.length===0)return v.createMultiPolygon();var wi=Qt.map(d);return v.createMultiPolygon(wi);default:throw new Error("Invalid geometry type: "+S)}}throw new Error(this.formatErrorMessage_())}}])}();function de(v){if(v.isEmpty())return"";var c=v.getCoordinate(),d=[c.x,c.y];return c.z===void 0||Number.isNaN(c.z)||d.push(c.z),c.m===void 0||Number.isNaN(c.m)||d.push(c.m),d.join(" ")}function Ne(v){for(var c=v.getCoordinates().map(function(N){var U=[N.x,N.y];return N.z===void 0||Number.isNaN(N.z)||U.push(N.z),N.m===void 0||Number.isNaN(N.m)||U.push(N.m),U}),d=[],_=0,S=c.length;_<S;++_)d.push(c[_].join(" "));return d.join(", ")}function qe(v){var c=[];c.push("("+Ne(v.getExteriorRing())+")");for(var d=0,_=v.getNumInteriorRing();d<_;++d)c.push("("+Ne(v.getInteriorRingN(d))+")");return c.join(", ")}var je={Point:de,LineString:Ne,LinearRing:Ne,Polygon:qe,MultiPoint:function(v){for(var c=[],d=0,_=v.getNumGeometries();d<_;++d)c.push("("+de(v.getGeometryN(d))+")");return c.join(", ")},MultiLineString:function(v){for(var c=[],d=0,_=v.getNumGeometries();d<_;++d)c.push("("+Ne(v.getGeometryN(d))+")");return c.join(", ")},MultiPolygon:function(v){for(var c=[],d=0,_=v.getNumGeometries();d<_;++d)c.push("("+qe(v.getGeometryN(d))+")");return c.join(", ")},GeometryCollection:function(v){for(var c=[],d=0,_=v.getNumGeometries();d<_;++d)c.push(rt(v.getGeometryN(d)));return c.join(", ")}};function rt(v){var c=v.getGeometryType(),d=je[c];c=c.toUpperCase();var _=function(S){var N="";if(S.isEmpty())return N;var U=S.getCoordinate();return U.z===void 0||Number.isNaN(U.z)||(N+="Z"),U.m===void 0||Number.isNaN(U.m)||(N+="M"),N}(v);return _.length>0&&(c+=" "+_),v.isEmpty()?c+" "+ho:c+" ("+d(v)+")"}var Ct=function(){return o(function v(c){h(this,v),this.geometryFactory=c||new Jr,this.precisionModel=this.geometryFactory.getPrecisionModel()},[{key:"read",value:function(v){var c=new C(v);return new j(c,this.geometryFactory).parse()}},{key:"write",value:function(v){return rt(v)}}])}(),Dt=function(){return o(function v(c){h(this,v),this.parser=new Ct(c)},[{key:"write",value:function(v){return this.parser.write(v)}}],[{key:"toLineString",value:function(v,c){if(arguments.length!==2)throw new Error("Not implemented");return"LINESTRING ( "+v.x+" "+v.y+", "+c.x+" "+c.y+" )"}}])}(),Nt=function(){function v(){h(this,v),v.constructor_.apply(this,arguments)}return o(v,[{key:"getIndexAlongSegment",value:function(c,d){return this.computeIntLineIndex(),this._intLineIndex[c][d]}},{key:"getTopologySummary",value:function(){var c=new Ai;return this.isEndPoint()&&c.append(" endpoint"),this._isProper&&c.append(" proper"),this.isCollinear()&&c.append(" collinear"),c.toString()}},{key:"computeIntersection",value:function(c,d,_,S){this._inputLines[0][0]=c,this._inputLines[0][1]=d,this._inputLines[1][0]=_,this._inputLines[1][1]=S,this._result=this.computeIntersect(c,d,_,S)}},{key:"getIntersectionNum",value:function(){return this._result}},{key:"computeIntLineIndex",value:function(){if(arguments.length===0)this._intLineIndex===null&&(this._intLineIndex=Array(2).fill().map(function(){return Array(2)}),this.computeIntLineIndex(0),this.computeIntLineIndex(1));else if(arguments.length===1){var c=arguments[0];this.getEdgeDistance(c,0)>this.getEdgeDistance(c,1)?(this._intLineIndex[c][0]=0,this._intLineIndex[c][1]=1):(this._intLineIndex[c][0]=1,this._intLineIndex[c][1]=0)}}},{key:"isProper",value:function(){return this.hasIntersection()&&this._isProper}},{key:"setPrecisionModel",value:function(c){this._precisionModel=c}},{key:"isInteriorIntersection",value:function(){if(arguments.length===0)return!!this.isInteriorIntersection(0)||!!this.isInteriorIntersection(1);if(arguments.length===1){for(var c=arguments[0],d=0;d<this._result;d++)if(!this._intPt[d].equals2D(this._inputLines[c][0])&&!this._intPt[d].equals2D(this._inputLines[c][1]))return!0;return!1}}},{key:"getIntersection",value:function(c){return this._intPt[c]}},{key:"isEndPoint",value:function(){return this.hasIntersection()&&!this._isProper}},{key:"hasIntersection",value:function(){return this._result!==v.NO_INTERSECTION}},{key:"getEdgeDistance",value:function(c,d){return v.computeEdgeDistance(this._intPt[d],this._inputLines[c][0],this._inputLines[c][1])}},{key:"isCollinear",value:function(){return this._result===v.COLLINEAR_INTERSECTION}},{key:"toString",value:function(){return Dt.toLineString(this._inputLines[0][0],this._inputLines[0][1])+" - "+Dt.toLineString(this._inputLines[1][0],this._inputLines[1][1])+this.getTopologySummary()}},{key:"getEndpoint",value:function(c,d){return this._inputLines[c][d]}},{key:"isIntersection",value:function(c){for(var d=0;d<this._result;d++)if(this._intPt[d].equals2D(c))return!0;return!1}},{key:"getIntersectionAlongSegment",value:function(c,d){return this.computeIntLineIndex(),this._intPt[this._intLineIndex[c][d]]}}],[{key:"constructor_",value:function(){this._result=null,this._inputLines=Array(2).fill().map(function(){return Array(2)}),this._intPt=new Array(2).fill(null),this._intLineIndex=null,this._isProper=null,this._pa=null,this._pb=null,this._precisionModel=null,this._intPt[0]=new lt,this._intPt[1]=new lt,this._pa=this._intPt[0],this._pb=this._intPt[1],this._result=0}},{key:"computeEdgeDistance",value:function(c,d,_){var S=Math.abs(_.x-d.x),N=Math.abs(_.y-d.y),U=-1;if(c.equals(d))U=0;else if(c.equals(_))U=S>N?S:N;else{var J=Math.abs(c.x-d.x),ge=Math.abs(c.y-d.y);(U=S>N?J:ge)!==0||c.equals(d)||(U=Math.max(J,ge))}return zt.isTrue(!(U===0&&!c.equals(d)),"Bad distance calculation"),U}},{key:"nonRobustComputeEdgeDistance",value:function(c,d,_){var S=c.x-d.x,N=c.y-d.y,U=Math.sqrt(S*S+N*N);return zt.isTrue(!(U===0&&!c.equals(d)),"Invalid distance calculation"),U}}])}();Nt.DONT_INTERSECT=0,Nt.DO_INTERSECT=1,Nt.COLLINEAR=2,Nt.NO_INTERSECTION=0,Nt.POINT_INTERSECTION=1,Nt.COLLINEAR_INTERSECTION=2;var Wt=function(v){function c(){return h(this,c),s(this,c)}return F(c,v),o(c,[{key:"isInSegmentEnvelopes",value:function(d){var _=new ii(this._inputLines[0][0],this._inputLines[0][1]),S=new ii(this._inputLines[1][0],this._inputLines[1][1]);return _.contains(d)&&S.contains(d)}},{key:"computeIntersection",value:function(){if(arguments.length!==3)return H(c,"computeIntersection",this,1).apply(this,arguments);var d=arguments[0],_=arguments[1],S=arguments[2];if(this._isProper=!1,ii.intersects(_,S,d)&&Ii.index(_,S,d)===0&&Ii.index(S,_,d)===0)return this._isProper=!0,(d.equals(_)||d.equals(S))&&(this._isProper=!1),this._result=Nt.POINT_INTERSECTION,null;this._result=Nt.NO_INTERSECTION}},{key:"intersection",value:function(d,_,S,N){var U=this.intersectionSafe(d,_,S,N);return this.isInSegmentEnvelopes(U)||(U=new lt(c.nearestEndpoint(d,_,S,N))),this._precisionModel!==null&&this._precisionModel.makePrecise(U),U}},{key:"checkDD",value:function(d,_,S,N,U){var J=er.intersection(d,_,S,N),ge=this.isInSegmentEnvelopes(J);at.out.println("DD in env = "+ge+"  --------------------- "+J),U.distance(J)>1e-4&&at.out.println("Distance = "+U.distance(J))}},{key:"intersectionSafe",value:function(d,_,S,N){var U=Je.intersection(d,_,S,N);return U===null&&(U=c.nearestEndpoint(d,_,S,N)),U}},{key:"computeCollinearIntersection",value:function(d,_,S,N){var U=ii.intersects(d,_,S),J=ii.intersects(d,_,N),ge=ii.intersects(S,N,d),Ie=ii.intersects(S,N,_);return U&&J?(this._intPt[0]=S,this._intPt[1]=N,Nt.COLLINEAR_INTERSECTION):ge&&Ie?(this._intPt[0]=d,this._intPt[1]=_,Nt.COLLINEAR_INTERSECTION):U&&ge?(this._intPt[0]=S,this._intPt[1]=d,!S.equals(d)||J||Ie?Nt.COLLINEAR_INTERSECTION:Nt.POINT_INTERSECTION):U&&Ie?(this._intPt[0]=S,this._intPt[1]=_,!S.equals(_)||J||ge?Nt.COLLINEAR_INTERSECTION:Nt.POINT_INTERSECTION):J&&ge?(this._intPt[0]=N,this._intPt[1]=d,!N.equals(d)||U||Ie?Nt.COLLINEAR_INTERSECTION:Nt.POINT_INTERSECTION):J&&Ie?(this._intPt[0]=N,this._intPt[1]=_,!N.equals(_)||U||ge?Nt.COLLINEAR_INTERSECTION:Nt.POINT_INTERSECTION):Nt.NO_INTERSECTION}},{key:"computeIntersect",value:function(d,_,S,N){if(this._isProper=!1,!ii.intersects(d,_,S,N))return Nt.NO_INTERSECTION;var U=Ii.index(d,_,S),J=Ii.index(d,_,N);if(U>0&&J>0||U<0&&J<0)return Nt.NO_INTERSECTION;var ge=Ii.index(S,N,d),Ie=Ii.index(S,N,_);return ge>0&&Ie>0||ge<0&&Ie<0?Nt.NO_INTERSECTION:U===0&&J===0&&ge===0&&Ie===0?this.computeCollinearIntersection(d,_,S,N):(U===0||J===0||ge===0||Ie===0?(this._isProper=!1,d.equals2D(S)||d.equals2D(N)?this._intPt[0]=d:_.equals2D(S)||_.equals2D(N)?this._intPt[0]=_:U===0?this._intPt[0]=new lt(S):J===0?this._intPt[0]=new lt(N):ge===0?this._intPt[0]=new lt(d):Ie===0&&(this._intPt[0]=new lt(_))):(this._isProper=!0,this._intPt[0]=this.intersection(d,_,S,N)),Nt.POINT_INTERSECTION)}}],[{key:"nearestEndpoint",value:function(d,_,S,N){var U=d,J=gt.pointToSegment(d,S,N),ge=gt.pointToSegment(_,S,N);return ge<J&&(J=ge,U=_),(ge=gt.pointToSegment(S,d,_))<J&&(J=ge,U=S),(ge=gt.pointToSegment(N,d,_))<J&&(J=ge,U=N),U}}])}(Nt),jt=function(){function v(){h(this,v),v.constructor_.apply(this,arguments)}return o(v,[{key:"countSegment",value:function(c,d){if(c.x<this._p.x&&d.x<this._p.x)return null;if(this._p.x===d.x&&this._p.y===d.y)return this._isPointOnSegment=!0,null;if(c.y===this._p.y&&d.y===this._p.y){var _=c.x,S=d.x;return _>S&&(_=d.x,S=c.x),this._p.x>=_&&this._p.x<=S&&(this._isPointOnSegment=!0),null}if(c.y>this._p.y&&d.y<=this._p.y||d.y>this._p.y&&c.y<=this._p.y){var N=Ii.index(c,d,this._p);if(N===Ii.COLLINEAR)return this._isPointOnSegment=!0,null;d.y<c.y&&(N=-N),N===Ii.LEFT&&this._crossingCount++}}},{key:"isPointInPolygon",value:function(){return this.getLocation()!==$e.EXTERIOR}},{key:"getLocation",value:function(){return this._isPointOnSegment?$e.BOUNDARY:this._crossingCount%2==1?$e.INTERIOR:$e.EXTERIOR}},{key:"isOnSegment",value:function(){return this._isPointOnSegment}}],[{key:"constructor_",value:function(){this._p=null,this._crossingCount=0,this._isPointOnSegment=!1;var c=arguments[0];this._p=c}},{key:"locatePointInRing",value:function(){if(arguments[0]instanceof lt&&Xt(arguments[1],Bi)){for(var c=arguments[1],d=new v(arguments[0]),_=new lt,S=new lt,N=1;N<c.size();N++)if(c.getCoordinate(N,_),c.getCoordinate(N-1,S),d.countSegment(_,S),d.isOnSegment())return d.getLocation();return d.getLocation()}if(arguments[0]instanceof lt&&arguments[1]instanceof Array){for(var U=arguments[1],J=new v(arguments[0]),ge=1;ge<U.length;ge++){var Ie=U[ge],st=U[ge-1];if(J.countSegment(Ie,st),J.isOnSegment())return J.getLocation()}return J.getLocation()}}}])}(),ki=function(){function v(){h(this,v)}return o(v,null,[{key:"isOnLine",value:function(){if(arguments[0]instanceof lt&&Xt(arguments[1],Bi)){for(var c=arguments[0],d=arguments[1],_=new Wt,S=new lt,N=new lt,U=d.size(),J=1;J<U;J++)if(d.getCoordinate(J-1,S),d.getCoordinate(J,N),_.computeIntersection(c,S,N),_.hasIntersection())return!0;return!1}if(arguments[0]instanceof lt&&arguments[1]instanceof Array){for(var ge=arguments[0],Ie=arguments[1],st=new Wt,ht=1;ht<Ie.length;ht++){var Pt=Ie[ht-1],Qt=Ie[ht];if(st.computeIntersection(ge,Pt,Qt),st.hasIntersection())return!0}return!1}}},{key:"locateInRing",value:function(c,d){return jt.locatePointInRing(c,d)}},{key:"isInRing",value:function(c,d){return v.locateInRing(c,d)!==$e.EXTERIOR}}])}(),si=function(){function v(){h(this,v),v.constructor_.apply(this,arguments)}return o(v,[{key:"setAllLocations",value:function(c){for(var d=0;d<this.location.length;d++)this.location[d]=c}},{key:"isNull",value:function(){for(var c=0;c<this.location.length;c++)if(this.location[c]!==$e.NONE)return!1;return!0}},{key:"setAllLocationsIfNull",value:function(c){for(var d=0;d<this.location.length;d++)this.location[d]===$e.NONE&&(this.location[d]=c)}},{key:"isLine",value:function(){return this.location.length===1}},{key:"merge",value:function(c){if(c.location.length>this.location.length){var d=new Array(3).fill(null);d[Ot.ON]=this.location[Ot.ON],d[Ot.LEFT]=$e.NONE,d[Ot.RIGHT]=$e.NONE,this.location=d}for(var _=0;_<this.location.length;_++)this.location[_]===$e.NONE&&_<c.location.length&&(this.location[_]=c.location[_])}},{key:"getLocations",value:function(){return this.location}},{key:"flip",value:function(){if(this.location.length<=1)return null;var c=this.location[Ot.LEFT];this.location[Ot.LEFT]=this.location[Ot.RIGHT],this.location[Ot.RIGHT]=c}},{key:"toString",value:function(){var c=new _r;return this.location.length>1&&c.append($e.toLocationSymbol(this.location[Ot.LEFT])),c.append($e.toLocationSymbol(this.location[Ot.ON])),this.location.length>1&&c.append($e.toLocationSymbol(this.location[Ot.RIGHT])),c.toString()}},{key:"setLocations",value:function(c,d,_){this.location[Ot.ON]=c,this.location[Ot.LEFT]=d,this.location[Ot.RIGHT]=_}},{key:"get",value:function(c){return c<this.location.length?this.location[c]:$e.NONE}},{key:"isArea",value:function(){return this.location.length>1}},{key:"isAnyNull",value:function(){for(var c=0;c<this.location.length;c++)if(this.location[c]===$e.NONE)return!0;return!1}},{key:"setLocation",value:function(){if(arguments.length===1){var c=arguments[0];this.setLocation(Ot.ON,c)}else if(arguments.length===2){var d=arguments[0],_=arguments[1];this.location[d]=_}}},{key:"init",value:function(c){this.location=new Array(c).fill(null),this.setAllLocations($e.NONE)}},{key:"isEqualOnSide",value:function(c,d){return this.location[d]===c.location[d]}},{key:"allPositionsEqual",value:function(c){for(var d=0;d<this.location.length;d++)if(this.location[d]!==c)return!1;return!0}}],[{key:"constructor_",value:function(){if(this.location=null,arguments.length===1){if(arguments[0]instanceof Array){var c=arguments[0];this.init(c.length)}else if(Number.isInteger(arguments[0])){var d=arguments[0];this.init(1),this.location[Ot.ON]=d}else if(arguments[0]instanceof v){var _=arguments[0];if(this.init(_.location.length),_!==null)for(var S=0;S<this.location.length;S++)this.location[S]=_.location[S]}}else if(arguments.length===3){var N=arguments[0],U=arguments[1],J=arguments[2];this.init(3),this.location[Ot.ON]=N,this.location[Ot.LEFT]=U,this.location[Ot.RIGHT]=J}}}])}(),Pi=function(){function v(){h(this,v),v.constructor_.apply(this,arguments)}return o(v,[{key:"getGeometryCount",value:function(){var c=0;return this.elt[0].isNull()||c++,this.elt[1].isNull()||c++,c}},{key:"setAllLocations",value:function(c,d){this.elt[c].setAllLocations(d)}},{key:"isNull",value:function(c){return this.elt[c].isNull()}},{key:"setAllLocationsIfNull",value:function(){if(arguments.length===1){var c=arguments[0];this.setAllLocationsIfNull(0,c),this.setAllLocationsIfNull(1,c)}else if(arguments.length===2){var d=arguments[0],_=arguments[1];this.elt[d].setAllLocationsIfNull(_)}}},{key:"isLine",value:function(c){return this.elt[c].isLine()}},{key:"merge",value:function(c){for(var d=0;d<2;d++)this.elt[d]===null&&c.elt[d]!==null?this.elt[d]=new si(c.elt[d]):this.elt[d].merge(c.elt[d])}},{key:"flip",value:function(){this.elt[0].flip(),this.elt[1].flip()}},{key:"getLocation",value:function(){if(arguments.length===1){var c=arguments[0];return this.elt[c].get(Ot.ON)}if(arguments.length===2){var d=arguments[0],_=arguments[1];return this.elt[d].get(_)}}},{key:"toString",value:function(){var c=new _r;return this.elt[0]!==null&&(c.append("A:"),c.append(this.elt[0].toString())),this.elt[1]!==null&&(c.append(" B:"),c.append(this.elt[1].toString())),c.toString()}},{key:"isArea",value:function(){if(arguments.length===0)return this.elt[0].isArea()||this.elt[1].isArea();if(arguments.length===1){var c=arguments[0];return this.elt[c].isArea()}}},{key:"isAnyNull",value:function(c){return this.elt[c].isAnyNull()}},{key:"setLocation",value:function(){if(arguments.length===2){var c=arguments[0],d=arguments[1];this.elt[c].setLocation(Ot.ON,d)}else if(arguments.length===3){var _=arguments[0],S=arguments[1],N=arguments[2];this.elt[_].setLocation(S,N)}}},{key:"isEqualOnSide",value:function(c,d){return this.elt[0].isEqualOnSide(c.elt[0],d)&&this.elt[1].isEqualOnSide(c.elt[1],d)}},{key:"allPositionsEqual",value:function(c,d){return this.elt[c].allPositionsEqual(d)}},{key:"toLine",value:function(c){this.elt[c].isArea()&&(this.elt[c]=new si(this.elt[c].location[0]))}}],[{key:"constructor_",value:function(){if(this.elt=new Array(2).fill(null),arguments.length===1){if(Number.isInteger(arguments[0])){var c=arguments[0];this.elt[0]=new si(c),this.elt[1]=new si(c)}else if(arguments[0]instanceof v){var d=arguments[0];this.elt[0]=new si(d.elt[0]),this.elt[1]=new si(d.elt[1])}}else if(arguments.length===2){var _=arguments[0],S=arguments[1];this.elt[0]=new si($e.NONE),this.elt[1]=new si($e.NONE),this.elt[_].setLocation(S)}else if(arguments.length===3){var N=arguments[0],U=arguments[1],J=arguments[2];this.elt[0]=new si(N,U,J),this.elt[1]=new si(N,U,J)}else if(arguments.length===4){var ge=arguments[0],Ie=arguments[1],st=arguments[2],ht=arguments[3];this.elt[0]=new si($e.NONE,$e.NONE,$e.NONE),this.elt[1]=new si($e.NONE,$e.NONE,$e.NONE),this.elt[ge].setLocations(Ie,st,ht)}}},{key:"toLineLabel",value:function(c){for(var d=new v($e.NONE),_=0;_<2;_++)d.setLocation(_,c.getLocation(_));return d}}])}(),Rr=function(){return o(function v(){h(this,v),v.constructor_.apply(this,arguments)},[{key:"computeRing",value:function(){if(this._ring!==null)return null;for(var v=new Array(this._pts.size()).fill(null),c=0;c<this._pts.size();c++)v[c]=this._pts.get(c);this._ring=this._geometryFactory.createLinearRing(v),this._isHole=Ii.isCCW(this._ring.getCoordinates())}},{key:"isIsolated",value:function(){return this._label.getGeometryCount()===1}},{key:"computePoints",value:function(v){this._startDe=v;var c=v,d=!0;do{if(c===null)throw new le("Found null DirectedEdge");if(c.getEdgeRing()===this)throw new le("Directed Edge visited twice during ring-building at "+c.getCoordinate());this._edges.add(c);var _=c.getLabel();zt.isTrue(_.isArea()),this.mergeLabel(_),this.addPoints(c.getEdge(),c.isForward(),d),d=!1,this.setEdgeRing(c,this),c=this.getNext(c)}while(c!==this._startDe)}},{key:"getLinearRing",value:function(){return this._ring}},{key:"getCoordinate",value:function(v){return this._pts.get(v)}},{key:"computeMaxNodeDegree",value:function(){this._maxNodeDegree=0;var v=this._startDe;do{var c=v.getNode().getEdges().getOutgoingDegree(this);c>this._maxNodeDegree&&(this._maxNodeDegree=c),v=this.getNext(v)}while(v!==this._startDe);this._maxNodeDegree*=2}},{key:"addPoints",value:function(v,c,d){var _=v.getCoordinates();if(c){var S=1;d&&(S=0);for(var N=S;N<_.length;N++)this._pts.add(_[N])}else{var U=_.length-2;d&&(U=_.length-1);for(var J=U;J>=0;J--)this._pts.add(_[J])}}},{key:"isHole",value:function(){return this._isHole}},{key:"setInResult",value:function(){var v=this._startDe;do v.getEdge().setInResult(!0),v=v.getNext();while(v!==this._startDe)}},{key:"containsPoint",value:function(v){var c=this.getLinearRing();if(!c.getEnvelopeInternal().contains(v)||!ki.isInRing(v,c.getCoordinates()))return!1;for(var d=this._holes.iterator();d.hasNext();)if(d.next().containsPoint(v))return!1;return!0}},{key:"addHole",value:function(v){this._holes.add(v)}},{key:"isShell",value:function(){return this._shell===null}},{key:"getLabel",value:function(){return this._label}},{key:"getEdges",value:function(){return this._edges}},{key:"getMaxNodeDegree",value:function(){return this._maxNodeDegree<0&&this.computeMaxNodeDegree(),this._maxNodeDegree}},{key:"getShell",value:function(){return this._shell}},{key:"mergeLabel",value:function(){if(arguments.length===1){var v=arguments[0];this.mergeLabel(v,0),this.mergeLabel(v,1)}else if(arguments.length===2){var c=arguments[1],d=arguments[0].getLocation(c,Ot.RIGHT);if(d===$e.NONE)return null;if(this._label.getLocation(c)===$e.NONE)return this._label.setLocation(c,d),null}}},{key:"setShell",value:function(v){this._shell=v,v!==null&&v.addHole(this)}},{key:"toPolygon",value:function(v){for(var c=new Array(this._holes.size()).fill(null),d=0;d<this._holes.size();d++)c[d]=this._holes.get(d).getLinearRing();return v.createPolygon(this.getLinearRing(),c)}}],[{key:"constructor_",value:function(){if(this._startDe=null,this._maxNodeDegree=-1,this._edges=new me,this._pts=new me,this._label=new Pi($e.NONE),this._ring=null,this._isHole=null,this._shell=null,this._holes=new me,this._geometryFactory=null,arguments.length!==0&&arguments.length===2){var v=arguments[0],c=arguments[1];this._geometryFactory=c,this.computePoints(v),this.computeRing()}}}])}(),Mt=function(v){function c(){var d;return h(this,c),d=s(this,c),c.constructor_.apply(d,arguments),d}return F(c,v),o(c,[{key:"setEdgeRing",value:function(d,_){d.setMinEdgeRing(_)}},{key:"getNext",value:function(d){return d.getNextMin()}}],[{key:"constructor_",value:function(){var d=arguments[0],_=arguments[1];Rr.constructor_.call(this,d,_)}}])}(Rr),ei=function(v){function c(){var d;return h(this,c),d=s(this,c),c.constructor_.apply(d,arguments),d}return F(c,v),o(c,[{key:"buildMinimalRings",value:function(){var d=new me,_=this._startDe;do{if(_.getMinEdgeRing()===null){var S=new Mt(_,this._geometryFactory);d.add(S)}_=_.getNext()}while(_!==this._startDe);return d}},{key:"setEdgeRing",value:function(d,_){d.setEdgeRing(_)}},{key:"linkDirectedEdgesForMinimalEdgeRings",value:function(){var d=this._startDe;do d.getNode().getEdges().linkMinimalDirectedEdges(this),d=d.getNext();while(d!==this._startDe)}},{key:"getNext",value:function(d){return d.getNext()}}],[{key:"constructor_",value:function(){var d=arguments[0],_=arguments[1];Rr.constructor_.call(this,d,_)}}])}(Rr),ji=function(){return o(function v(){h(this,v),v.constructor_.apply(this,arguments)},[{key:"setVisited",value:function(v){this._isVisited=v}},{key:"setInResult",value:function(v){this._isInResult=v}},{key:"isCovered",value:function(){return this._isCovered}},{key:"isCoveredSet",value:function(){return this._isCoveredSet}},{key:"setLabel",value:function(v){this._label=v}},{key:"getLabel",value:function(){return this._label}},{key:"setCovered",value:function(v){this._isCovered=v,this._isCoveredSet=!0}},{key:"updateIM",value:function(v){zt.isTrue(this._label.getGeometryCount()>=2,"found partial label"),this.computeIM(v)}},{key:"isInResult",value:function(){return this._isInResult}},{key:"isVisited",value:function(){return this._isVisited}}],[{key:"constructor_",value:function(){if(this._label=null,this._isInResult=!1,this._isCovered=!1,this._isCoveredSet=!1,this._isVisited=!1,arguments.length!==0&&arguments.length===1){var v=arguments[0];this._label=v}}}])}(),or=function(v){function c(){var d;return h(this,c),d=s(this,c),c.constructor_.apply(d,arguments),d}return F(c,v),o(c,[{key:"isIncidentEdgeInResult",value:function(){for(var d=this.getEdges().getEdges().iterator();d.hasNext();)if(d.next().getEdge().isInResult())return!0;return!1}},{key:"isIsolated",value:function(){return this._label.getGeometryCount()===1}},{key:"getCoordinate",value:function(){return this._coord}},{key:"print",value:function(d){d.println("node "+this._coord+" lbl: "+this._label)}},{key:"computeIM",value:function(d){}},{key:"computeMergedLocation",value:function(d,_){var S=$e.NONE;if(S=this._label.getLocation(_),!d.isNull(_)){var N=d.getLocation(_);S!==$e.BOUNDARY&&(S=N)}return S}},{key:"setLabel",value:function(){if(arguments.length!==2||!Number.isInteger(arguments[1])||!Number.isInteger(arguments[0]))return H(c,"setLabel",this,1).apply(this,arguments);var d=arguments[0],_=arguments[1];this._label===null?this._label=new Pi(d,_):this._label.setLocation(d,_)}},{key:"getEdges",value:function(){return this._edges}},{key:"mergeLabel",value:function(){if(arguments[0]instanceof c){var d=arguments[0];this.mergeLabel(d._label)}else if(arguments[0]instanceof Pi)for(var _=arguments[0],S=0;S<2;S++){var N=this.computeMergedLocation(_,S);this._label.getLocation(S)===$e.NONE&&this._label.setLocation(S,N)}}},{key:"add",value:function(d){this._edges.insert(d),d.setNode(this)}},{key:"setLabelBoundary",value:function(d){if(this._label===null)return null;var _=$e.NONE;this._label!==null&&(_=this._label.getLocation(d));var S=null;switch(_){case $e.BOUNDARY:S=$e.INTERIOR;break;case $e.INTERIOR:default:S=$e.BOUNDARY}this._label.setLocation(d,S)}}],[{key:"constructor_",value:function(){this._coord=null,this._edges=null;var d=arguments[0],_=arguments[1];this._coord=d,this._edges=_,this._label=new Pi(0,$e.NONE)}}])}(ji),rr=function(v){function c(){return h(this,c),s(this,c,arguments)}return F(c,v),o(c)}(Xn);function Ar(v){return v==null?0:v.color}function pr(v){return v==null?null:v.parent}function ui(v,c){v!==null&&(v.color=c)}function Pn(v){return v==null?null:v.left}function Vi(v){return v==null?null:v.right}var Ri=function(v){function c(){var d;return h(this,c),(d=s(this,c)).root_=null,d.size_=0,d}return F(c,v),o(c,[{key:"get",value:function(d){for(var _=this.root_;_!==null;){var S=d.compareTo(_.key);if(S<0)_=_.left;else{if(!(S>0))return _.value;_=_.right}}return null}},{key:"put",value:function(d,_){if(this.root_===null)return this.root_={key:d,value:_,left:null,right:null,parent:null,color:0,getValue:function(){return this.value},getKey:function(){return this.key}},this.size_=1,null;var S,N,U=this.root_;do if(S=U,(N=d.compareTo(U.key))<0)U=U.left;else{if(!(N>0)){var J=U.value;return U.value=_,J}U=U.right}while(U!==null);var ge={key:d,left:null,right:null,value:_,parent:S,color:0,getValue:function(){return this.value},getKey:function(){return this.key}};return N<0?S.left=ge:S.right=ge,this.fixAfterInsertion(ge),this.size_++,null}},{key:"fixAfterInsertion",value:function(d){var _;for(d.color=1;d!=null&&d!==this.root_&&d.parent.color===1;)pr(d)===Pn(pr(pr(d)))?Ar(_=Vi(pr(pr(d))))===1?(ui(pr(d),0),ui(_,0),ui(pr(pr(d)),1),d=pr(pr(d))):(d===Vi(pr(d))&&(d=pr(d),this.rotateLeft(d)),ui(pr(d),0),ui(pr(pr(d)),1),this.rotateRight(pr(pr(d)))):Ar(_=Pn(pr(pr(d))))===1?(ui(pr(d),0),ui(_,0),ui(pr(pr(d)),1),d=pr(pr(d))):(d===Pn(pr(d))&&(d=pr(d),this.rotateRight(d)),ui(pr(d),0),ui(pr(pr(d)),1),this.rotateLeft(pr(pr(d))));this.root_.color=0}},{key:"values",value:function(){var d=new me,_=this.getFirstEntry();if(_!==null)for(d.add(_.value);(_=c.successor(_))!==null;)d.add(_.value);return d}},{key:"entrySet",value:function(){var d=new jr,_=this.getFirstEntry();if(_!==null)for(d.add(_);(_=c.successor(_))!==null;)d.add(_);return d}},{key:"rotateLeft",value:function(d){if(d!=null){var _=d.right;d.right=_.left,_.left!=null&&(_.left.parent=d),_.parent=d.parent,d.parent==null?this.root_=_:d.parent.left===d?d.parent.left=_:d.parent.right=_,_.left=d,d.parent=_}}},{key:"rotateRight",value:function(d){if(d!=null){var _=d.left;d.left=_.right,_.right!=null&&(_.right.parent=d),_.parent=d.parent,d.parent==null?this.root_=_:d.parent.right===d?d.parent.right=_:d.parent.left=_,_.right=d,d.parent=_}}},{key:"getFirstEntry",value:function(){var d=this.root_;if(d!=null)for(;d.left!=null;)d=d.left;return d}},{key:"size",value:function(){return this.size_}},{key:"containsKey",value:function(d){for(var _=this.root_;_!==null;){var S=d.compareTo(_.key);if(S<0)_=_.left;else{if(!(S>0))return!0;_=_.right}}return!1}}],[{key:"successor",value:function(d){var _;if(d===null)return null;if(d.right!==null){for(_=d.right;_.left!==null;)_=_.left;return _}_=d.parent;for(var S=d;_!==null&&S===_.right;)S=_,_=_.parent;return _}}])}(rr),eo=function(){return o(function v(){h(this,v),v.constructor_.apply(this,arguments)},[{key:"find",value:function(v){return this.nodeMap.get(v)}},{key:"addNode",value:function(){if(arguments[0]instanceof lt){var v=arguments[0],c=this.nodeMap.get(v);return c===null&&(c=this.nodeFact.createNode(v),this.nodeMap.put(v,c)),c}if(arguments[0]instanceof or){var d=arguments[0],_=this.nodeMap.get(d.getCoordinate());return _===null?(this.nodeMap.put(d.getCoordinate(),d),d):(_.mergeLabel(d),_)}}},{key:"print",value:function(v){for(var c=this.iterator();c.hasNext();)c.next().print(v)}},{key:"iterator",value:function(){return this.nodeMap.values().iterator()}},{key:"values",value:function(){return this.nodeMap.values()}},{key:"getBoundaryNodes",value:function(v){for(var c=new me,d=this.iterator();d.hasNext();){var _=d.next();_.getLabel().getLocation(v)===$e.BOUNDARY&&c.add(_)}return c}},{key:"add",value:function(v){var c=v.getCoordinate();this.addNode(c).add(v)}}],[{key:"constructor_",value:function(){this.nodeMap=new Ri,this.nodeFact=null;var v=arguments[0];this.nodeFact=v}}])}(),fi=function(){function v(){h(this,v)}return o(v,null,[{key:"isNorthern",value:function(c){return c===v.NE||c===v.NW}},{key:"isOpposite",value:function(c,d){return c!==d&&(c-d+4)%4===2}},{key:"commonHalfPlane",value:function(c,d){if(c===d)return c;if((c-d+4)%4===2)return-1;var _=c<d?c:d;return _===0&&(c>d?c:d)===3?3:_}},{key:"isInHalfPlane",value:function(c,d){return d===v.SE?c===v.SE||c===v.SW:c===d||c===d+1}},{key:"quadrant",value:function(){if(typeof arguments[0]=="number"&&typeof arguments[1]=="number"){var c=arguments[0],d=arguments[1];if(c===0&&d===0)throw new ye("Cannot compute the quadrant for point ( "+c+", "+d+" )");return c>=0?d>=0?v.NE:v.SE:d>=0?v.NW:v.SW}if(arguments[0]instanceof lt&&arguments[1]instanceof lt){var _=arguments[0],S=arguments[1];if(S.x===_.x&&S.y===_.y)throw new ye("Cannot compute the quadrant for two identical points "+_);return S.x>=_.x?S.y>=_.y?v.NE:v.SE:S.y>=_.y?v.NW:v.SW}}}])}();fi.NE=0,fi.NW=1,fi.SW=2,fi.SE=3;var to=function(){function v(){h(this,v),v.constructor_.apply(this,arguments)}return o(v,[{key:"compareDirection",value:function(c){return this._dx===c._dx&&this._dy===c._dy?0:this._quadrant>c._quadrant?1:this._quadrant<c._quadrant?-1:Ii.index(c._p0,c._p1,this._p1)}},{key:"getDy",value:function(){return this._dy}},{key:"getCoordinate",value:function(){return this._p0}},{key:"setNode",value:function(c){this._node=c}},{key:"print",value:function(c){var d=Math.atan2(this._dy,this._dx),_=this.getClass().getName(),S=_.lastIndexOf("."),N=_.substring(S+1);c.print("  "+N+": "+this._p0+" - "+this._p1+" "+this._quadrant+":"+d+"   "+this._label)}},{key:"compareTo",value:function(c){var d=c;return this.compareDirection(d)}},{key:"getDirectedCoordinate",value:function(){return this._p1}},{key:"getDx",value:function(){return this._dx}},{key:"getLabel",value:function(){return this._label}},{key:"getEdge",value:function(){return this._edge}},{key:"getQuadrant",value:function(){return this._quadrant}},{key:"getNode",value:function(){return this._node}},{key:"toString",value:function(){var c=Math.atan2(this._dy,this._dx),d=this.getClass().getName(),_=d.lastIndexOf(".");return"  "+d.substring(_+1)+": "+this._p0+" - "+this._p1+" "+this._quadrant+":"+c+"   "+this._label}},{key:"computeLabel",value:function(c){}},{key:"init",value:function(c,d){this._p0=c,this._p1=d,this._dx=d.x-c.x,this._dy=d.y-c.y,this._quadrant=fi.quadrant(this._dx,this._dy),zt.isTrue(!(this._dx===0&&this._dy===0),"EdgeEnd with identical endpoints found")}},{key:"interfaces_",get:function(){return[Se]}}],[{key:"constructor_",value:function(){if(this._edge=null,this._label=null,this._node=null,this._p0=null,this._p1=null,this._dx=null,this._dy=null,this._quadrant=null,arguments.length===1){var c=arguments[0];this._edge=c}else if(arguments.length===3){var d=arguments[0],_=arguments[1],S=arguments[2];v.constructor_.call(this,d,_,S,null)}else if(arguments.length===4){var N=arguments[0],U=arguments[1],J=arguments[2],ge=arguments[3];v.constructor_.call(this,N),this.init(U,J),this._label=ge}}}])}(),hn=function(v){function c(){var d;return h(this,c),d=s(this,c),c.constructor_.apply(d,arguments),d}return F(c,v),o(c,[{key:"getNextMin",value:function(){return this._nextMin}},{key:"getDepth",value:function(d){return this._depth[d]}},{key:"setVisited",value:function(d){this._isVisited=d}},{key:"computeDirectedLabel",value:function(){this._label=new Pi(this._edge.getLabel()),this._isForward||this._label.flip()}},{key:"getNext",value:function(){return this._next}},{key:"setDepth",value:function(d,_){if(this._depth[d]!==-999&&this._depth[d]!==_)throw new le("assigned depths do not match",this.getCoordinate());this._depth[d]=_}},{key:"isInteriorAreaEdge",value:function(){for(var d=!0,_=0;_<2;_++)this._label.isArea(_)&&this._label.getLocation(_,Ot.LEFT)===$e.INTERIOR&&this._label.getLocation(_,Ot.RIGHT)===$e.INTERIOR||(d=!1);return d}},{key:"setNextMin",value:function(d){this._nextMin=d}},{key:"print",value:function(d){H(c,"print",this,1).call(this,d),d.print(" "+this._depth[Ot.LEFT]+"/"+this._depth[Ot.RIGHT]),d.print(" ("+this.getDepthDelta()+")"),this._isInResult&&d.print(" inResult")}},{key:"setMinEdgeRing",value:function(d){this._minEdgeRing=d}},{key:"isLineEdge",value:function(){var d=this._label.isLine(0)||this._label.isLine(1),_=!this._label.isArea(0)||this._label.allPositionsEqual(0,$e.EXTERIOR),S=!this._label.isArea(1)||this._label.allPositionsEqual(1,$e.EXTERIOR);return d&&_&&S}},{key:"setEdgeRing",value:function(d){this._edgeRing=d}},{key:"getMinEdgeRing",value:function(){return this._minEdgeRing}},{key:"getDepthDelta",value:function(){var d=this._edge.getDepthDelta();return this._isForward||(d=-d),d}},{key:"setInResult",value:function(d){this._isInResult=d}},{key:"getSym",value:function(){return this._sym}},{key:"isForward",value:function(){return this._isForward}},{key:"getEdge",value:function(){return this._edge}},{key:"printEdge",value:function(d){this.print(d),d.print(" "),this._isForward?this._edge.print(d):this._edge.printReverse(d)}},{key:"setSym",value:function(d){this._sym=d}},{key:"setVisitedEdge",value:function(d){this.setVisited(d),this._sym.setVisited(d)}},{key:"setEdgeDepths",value:function(d,_){var S=this.getEdge().getDepthDelta();this._isForward||(S=-S);var N=1;d===Ot.LEFT&&(N=-1);var U=Ot.opposite(d),J=_+S*N;this.setDepth(d,_),this.setDepth(U,J)}},{key:"getEdgeRing",value:function(){return this._edgeRing}},{key:"isInResult",value:function(){return this._isInResult}},{key:"setNext",value:function(d){this._next=d}},{key:"isVisited",value:function(){return this._isVisited}}],[{key:"constructor_",value:function(){this._isForward=null,this._isInResult=!1,this._isVisited=!1,this._sym=null,this._next=null,this._nextMin=null,this._edgeRing=null,this._minEdgeRing=null,this._depth=[0,-999,-999];var d=arguments[0],_=arguments[1];if(to.constructor_.call(this,d),this._isForward=_,_)this.init(d.getCoordinate(0),d.getCoordinate(1));else{var S=d.getNumPoints()-1;this.init(d.getCoordinate(S),d.getCoordinate(S-1))}this.computeDirectedLabel()}},{key:"depthFactor",value:function(d,_){return d===$e.EXTERIOR&&_===$e.INTERIOR?1:d===$e.INTERIOR&&_===$e.EXTERIOR?-1:0}}])}(to),po=function(){return o(function v(){h(this,v)},[{key:"createNode",value:function(v){return new or(v,null)}}])}(),Dn=function(){return o(function v(){h(this,v),v.constructor_.apply(this,arguments)},[{key:"printEdges",value:function(v){v.println("Edges:");for(var c=0;c<this._edges.size();c++){v.println("edge "+c+":");var d=this._edges.get(c);d.print(v),d.eiList.print(v)}}},{key:"find",value:function(v){return this._nodes.find(v)}},{key:"addNode",value:function(){if(arguments[0]instanceof or){var v=arguments[0];return this._nodes.addNode(v)}if(arguments[0]instanceof lt){var c=arguments[0];return this._nodes.addNode(c)}}},{key:"getNodeIterator",value:function(){return this._nodes.iterator()}},{key:"linkResultDirectedEdges",value:function(){for(var v=this._nodes.iterator();v.hasNext();)v.next().getEdges().linkResultDirectedEdges()}},{key:"debugPrintln",value:function(v){at.out.println(v)}},{key:"isBoundaryNode",value:function(v,c){var d=this._nodes.find(c);if(d===null)return!1;var _=d.getLabel();return _!==null&&_.getLocation(v)===$e.BOUNDARY}},{key:"linkAllDirectedEdges",value:function(){for(var v=this._nodes.iterator();v.hasNext();)v.next().getEdges().linkAllDirectedEdges()}},{key:"matchInSameDirection",value:function(v,c,d,_){return!!v.equals(d)&&Ii.index(v,c,_)===Ii.COLLINEAR&&fi.quadrant(v,c)===fi.quadrant(d,_)}},{key:"getEdgeEnds",value:function(){return this._edgeEndList}},{key:"debugPrint",value:function(v){at.out.print(v)}},{key:"getEdgeIterator",value:function(){return this._edges.iterator()}},{key:"findEdgeInSameDirection",value:function(v,c){for(var d=0;d<this._edges.size();d++){var _=this._edges.get(d),S=_.getCoordinates();if(this.matchInSameDirection(v,c,S[0],S[1])||this.matchInSameDirection(v,c,S[S.length-1],S[S.length-2]))return _}return null}},{key:"insertEdge",value:function(v){this._edges.add(v)}},{key:"findEdgeEnd",value:function(v){for(var c=this.getEdgeEnds().iterator();c.hasNext();){var d=c.next();if(d.getEdge()===v)return d}return null}},{key:"addEdges",value:function(v){for(var c=v.iterator();c.hasNext();){var d=c.next();this._edges.add(d);var _=new hn(d,!0),S=new hn(d,!1);_.setSym(S),S.setSym(_),this.add(_),this.add(S)}}},{key:"add",value:function(v){this._nodes.add(v),this._edgeEndList.add(v)}},{key:"getNodes",value:function(){return this._nodes.values()}},{key:"findEdge",value:function(v,c){for(var d=0;d<this._edges.size();d++){var _=this._edges.get(d),S=_.getCoordinates();if(v.equals(S[0])&&c.equals(S[1]))return _}return null}}],[{key:"constructor_",value:function(){if(this._edges=new me,this._nodes=null,this._edgeEndList=new me,arguments.length===0)this._nodes=new eo(new po);else if(arguments.length===1){var v=arguments[0];this._nodes=new eo(v)}}},{key:"linkResultDirectedEdges",value:function(v){for(var c=v.iterator();c.hasNext();)c.next().getEdges().linkResultDirectedEdges()}}])}(),pl=function(){function v(){h(this,v),v.constructor_.apply(this,arguments)}return o(v,[{key:"sortShellsAndHoles",value:function(c,d,_){for(var S=c.iterator();S.hasNext();){var N=S.next();N.isHole()?_.add(N):d.add(N)}}},{key:"computePolygons",value:function(c){for(var d=new me,_=c.iterator();_.hasNext();){var S=_.next().toPolygon(this._geometryFactory);d.add(S)}return d}},{key:"placeFreeHoles",value:function(c,d){for(var _=d.iterator();_.hasNext();){var S=_.next();if(S.getShell()===null){var N=v.findEdgeRingContaining(S,c);if(N===null)throw new le("unable to assign hole to a shell",S.getCoordinate(0));S.setShell(N)}}}},{key:"buildMinimalEdgeRings",value:function(c,d,_){for(var S=new me,N=c.iterator();N.hasNext();){var U=N.next();if(U.getMaxNodeDegree()>2){U.linkDirectedEdgesForMinimalEdgeRings();var J=U.buildMinimalRings(),ge=this.findShell(J);ge!==null?(this.placePolygonHoles(ge,J),d.add(ge)):_.addAll(J)}else S.add(U)}return S}},{key:"buildMaximalEdgeRings",value:function(c){for(var d=new me,_=c.iterator();_.hasNext();){var S=_.next();if(S.isInResult()&&S.getLabel().isArea()&&S.getEdgeRing()===null){var N=new ei(S,this._geometryFactory);d.add(N),N.setInResult()}}return d}},{key:"placePolygonHoles",value:function(c,d){for(var _=d.iterator();_.hasNext();){var S=_.next();S.isHole()&&S.setShell(c)}}},{key:"getPolygons",value:function(){return this.computePolygons(this._shellList)}},{key:"findShell",value:function(c){for(var d=0,_=null,S=c.iterator();S.hasNext();){var N=S.next();N.isHole()||(_=N,d++)}return zt.isTrue(d<=1,"found two shells in MinimalEdgeRing list"),_}},{key:"add",value:function(){if(arguments.length===1){var c=arguments[0];this.add(c.getEdgeEnds(),c.getNodes())}else if(arguments.length===2){var d=arguments[0],_=arguments[1];Dn.linkResultDirectedEdges(_);var S=this.buildMaximalEdgeRings(d),N=new me,U=this.buildMinimalEdgeRings(S,this._shellList,N);this.sortShellsAndHoles(U,this._shellList,N),this.placeFreeHoles(this._shellList,N)}}}],[{key:"constructor_",value:function(){this._geometryFactory=null,this._shellList=new me;var c=arguments[0];this._geometryFactory=c}},{key:"findEdgeRingContaining",value:function(c,d){for(var _=c.getLinearRing(),S=_.getEnvelopeInternal(),N=_.getCoordinateN(0),U=null,J=null,ge=d.iterator();ge.hasNext();){var Ie=ge.next(),st=Ie.getLinearRing(),ht=st.getEnvelopeInternal();if(!ht.equals(S)&&ht.contains(S)){N=ri.ptNotInList(_.getCoordinates(),st.getCoordinates());var Pt=!1;ki.isInRing(N,st.getCoordinates())&&(Pt=!0),Pt&&(U===null||J.contains(ht))&&(J=(U=Ie).getLinearRing().getEnvelopeInternal())}}return U}}])}(),Cs=function(){return o(function v(){h(this,v)},[{key:"getBounds",value:function(){}}])}(),js=function(){return o(function v(){h(this,v),v.constructor_.apply(this,arguments)},[{key:"getItem",value:function(){return this._item}},{key:"getBounds",value:function(){return this._bounds}},{key:"interfaces_",get:function(){return[Cs,$]}}],[{key:"constructor_",value:function(){this._bounds=null,this._item=null;var v=arguments[0],c=arguments[1];this._bounds=v,this._item=c}}])}(),Xo=function(){return o(function v(){h(this,v),v.constructor_.apply(this,arguments)},[{key:"poll",value:function(){if(this.isEmpty())return null;var v=this._items.get(1);return this._items.set(1,this._items.get(this._size)),this._size-=1,this.reorder(1),v}},{key:"size",value:function(){return this._size}},{key:"reorder",value:function(v){for(var c=null,d=this._items.get(v);2*v<=this._size&&((c=2*v)!==this._size&&this._items.get(c+1).compareTo(this._items.get(c))<0&&c++,this._items.get(c).compareTo(d)<0);v=c)this._items.set(v,this._items.get(c));this._items.set(v,d)}},{key:"clear",value:function(){this._size=0,this._items.clear()}},{key:"peek",value:function(){return this.isEmpty()?null:this._items.get(1)}},{key:"isEmpty",value:function(){return this._size===0}},{key:"add",value:function(v){this._items.add(null),this._size+=1;var c=this._size;for(this._items.set(0,v);v.compareTo(this._items.get(Math.trunc(c/2)))<0;c/=2)this._items.set(c,this._items.get(Math.trunc(c/2)));this._items.set(c,v)}}],[{key:"constructor_",value:function(){this._size=null,this._items=null,this._size=0,this._items=new me,this._items.add(null)}}])}(),Ho=function(){return o(function v(){h(this,v)},[{key:"insert",value:function(v,c){}},{key:"remove",value:function(v,c){}},{key:"query",value:function(){}}])}(),kn=function(){return o(function v(){h(this,v),v.constructor_.apply(this,arguments)},[{key:"getLevel",value:function(){return this._level}},{key:"size",value:function(){return this._childBoundables.size()}},{key:"getChildBoundables",value:function(){return this._childBoundables}},{key:"addChildBoundable",value:function(v){zt.isTrue(this._bounds===null),this._childBoundables.add(v)}},{key:"isEmpty",value:function(){return this._childBoundables.isEmpty()}},{key:"getBounds",value:function(){return this._bounds===null&&(this._bounds=this.computeBounds()),this._bounds}},{key:"interfaces_",get:function(){return[Cs,$]}}],[{key:"constructor_",value:function(){if(this._childBoundables=new me,this._bounds=null,this._level=null,arguments.length!==0&&arguments.length===1){var v=arguments[0];this._level=v}}}])}(),Fn={reverseOrder:function(){return{compare:function(v,c){return c.compareTo(v)}}},min:function(v){return Fn.sort(v),v.get(0)},sort:function(v,c){var d=v.toArray();c?Mi.sort(d,c):Mi.sort(d);for(var _=v.iterator(),S=0,N=d.length;S<N;S++)_.next(),_.set(d[S])},singletonList:function(v){var c=new me;return c.add(v),c}},bn=function(){function v(){h(this,v)}return o(v,null,[{key:"maxDistance",value:function(c,d,_,S,N,U,J,ge){var Ie=v.distance(c,d,N,U);return Ie=Math.max(Ie,v.distance(c,d,J,ge)),Ie=Math.max(Ie,v.distance(_,S,N,U)),Ie=Math.max(Ie,v.distance(_,S,J,ge))}},{key:"distance",value:function(c,d,_,S){var N=_-c,U=S-d;return Math.sqrt(N*N+U*U)}},{key:"maximumDistance",value:function(c,d){var _=Math.min(c.getMinX(),d.getMinX()),S=Math.min(c.getMinY(),d.getMinY()),N=Math.max(c.getMaxX(),d.getMaxX()),U=Math.max(c.getMaxY(),d.getMaxY());return v.distance(_,S,N,U)}},{key:"minMaxDistance",value:function(c,d){var _=c.getMinX(),S=c.getMinY(),N=c.getMaxX(),U=c.getMaxY(),J=d.getMinX(),ge=d.getMinY(),Ie=d.getMaxX(),st=d.getMaxY(),ht=v.maxDistance(_,S,_,U,J,ge,J,st);return ht=Math.min(ht,v.maxDistance(_,S,_,U,J,ge,Ie,ge)),ht=Math.min(ht,v.maxDistance(_,S,_,U,Ie,st,J,st)),ht=Math.min(ht,v.maxDistance(_,S,_,U,Ie,st,Ie,ge)),ht=Math.min(ht,v.maxDistance(_,S,N,S,J,ge,J,st)),ht=Math.min(ht,v.maxDistance(_,S,N,S,J,ge,Ie,ge)),ht=Math.min(ht,v.maxDistance(_,S,N,S,Ie,st,J,st)),ht=Math.min(ht,v.maxDistance(_,S,N,S,Ie,st,Ie,ge)),ht=Math.min(ht,v.maxDistance(N,U,_,U,J,ge,J,st)),ht=Math.min(ht,v.maxDistance(N,U,_,U,J,ge,Ie,ge)),ht=Math.min(ht,v.maxDistance(N,U,_,U,Ie,st,J,st)),ht=Math.min(ht,v.maxDistance(N,U,_,U,Ie,st,Ie,ge)),ht=Math.min(ht,v.maxDistance(N,U,N,S,J,ge,J,st)),ht=Math.min(ht,v.maxDistance(N,U,N,S,J,ge,Ie,ge)),ht=Math.min(ht,v.maxDistance(N,U,N,S,Ie,st,J,st)),ht=Math.min(ht,v.maxDistance(N,U,N,S,Ie,st,Ie,ge))}}])}(),Hn=function(){function v(){h(this,v),v.constructor_.apply(this,arguments)}return o(v,[{key:"maximumDistance",value:function(){return bn.maximumDistance(this._boundable1.getBounds(),this._boundable2.getBounds())}},{key:"expandToQueue",value:function(c,d){var _=v.isComposite(this._boundable1),S=v.isComposite(this._boundable2);if(_&&S)return v.area(this._boundable1)>v.area(this._boundable2)?(this.expand(this._boundable1,this._boundable2,!1,c,d),null):(this.expand(this._boundable2,this._boundable1,!0,c,d),null);if(_)return this.expand(this._boundable1,this._boundable2,!1,c,d),null;if(S)return this.expand(this._boundable2,this._boundable1,!0,c,d),null;throw new ye("neither boundable is composite")}},{key:"isLeaves",value:function(){return!(v.isComposite(this._boundable1)||v.isComposite(this._boundable2))}},{key:"compareTo",value:function(c){var d=c;return this._distance<d._distance?-1:this._distance>d._distance?1:0}},{key:"expand",value:function(c,d,_,S,N){for(var U=c.getChildBoundables().iterator();U.hasNext();){var J=U.next(),ge=null;(ge=_?new v(d,J,this._itemDistance):new v(J,d,this._itemDistance)).getDistance()<N&&S.add(ge)}}},{key:"getBoundable",value:function(c){return c===0?this._boundable1:this._boundable2}},{key:"getDistance",value:function(){return this._distance}},{key:"distance",value:function(){return this.isLeaves()?this._itemDistance.distance(this._boundable1,this._boundable2):this._boundable1.getBounds().distance(this._boundable2.getBounds())}},{key:"interfaces_",get:function(){return[Se]}}],[{key:"constructor_",value:function(){this._boundable1=null,this._boundable2=null,this._distance=null,this._itemDistance=null;var c=arguments[0],d=arguments[1],_=arguments[2];this._boundable1=c,this._boundable2=d,this._itemDistance=_,this._distance=this.distance()}},{key:"area",value:function(c){return c.getBounds().getArea()}},{key:"isComposite",value:function(c){return c instanceof kn}}])}(),fo=function(){return o(function v(){h(this,v)},[{key:"visitItem",value:function(v){}}])}(),bs=function(){function v(){h(this,v),v.constructor_.apply(this,arguments)}return o(v,[{key:"queryInternal",value:function(){if(Xt(arguments[2],fo)&&arguments[0]instanceof Object&&arguments[1]instanceof kn)for(var c=arguments[0],d=arguments[2],_=arguments[1].getChildBoundables(),S=0;S<_.size();S++){var N=_.get(S);this.getIntersectsOp().intersects(N.getBounds(),c)&&(N instanceof kn?this.queryInternal(c,N,d):N instanceof js?d.visitItem(N.getItem()):zt.shouldNeverReachHere())}else if(Xt(arguments[2],os)&&arguments[0]instanceof Object&&arguments[1]instanceof kn)for(var U=arguments[0],J=arguments[2],ge=arguments[1].getChildBoundables(),Ie=0;Ie<ge.size();Ie++){var st=ge.get(Ie);this.getIntersectsOp().intersects(st.getBounds(),U)&&(st instanceof kn?this.queryInternal(U,st,J):st instanceof js?J.add(st.getItem()):zt.shouldNeverReachHere())}}},{key:"getNodeCapacity",value:function(){return this._nodeCapacity}},{key:"lastNode",value:function(c){return c.get(c.size()-1)}},{key:"size",value:function(){if(arguments.length===0)return this.isEmpty()?0:(this.build(),this.size(this._root));if(arguments.length===1){for(var c=0,d=arguments[0].getChildBoundables().iterator();d.hasNext();){var _=d.next();_ instanceof kn?c+=this.size(_):_ instanceof js&&(c+=1)}return c}}},{key:"removeItem",value:function(c,d){for(var _=null,S=c.getChildBoundables().iterator();S.hasNext();){var N=S.next();N instanceof js&&N.getItem()===d&&(_=N)}return _!==null&&(c.getChildBoundables().remove(_),!0)}},{key:"itemsTree",value:function(){if(arguments.length===0){this.build();var c=this.itemsTree(this._root);return c===null?new me:c}if(arguments.length===1){for(var d=arguments[0],_=new me,S=d.getChildBoundables().iterator();S.hasNext();){var N=S.next();if(N instanceof kn){var U=this.itemsTree(N);U!==null&&_.add(U)}else N instanceof js?_.add(N.getItem()):zt.shouldNeverReachHere()}return _.size()<=0?null:_}}},{key:"insert",value:function(c,d){zt.isTrue(!this._built,"Cannot insert items into an STR packed R-tree after it has been built."),this._itemBoundables.add(new js(c,d))}},{key:"boundablesAtLevel",value:function(){if(arguments.length===1){var c=arguments[0],d=new me;return this.boundablesAtLevel(c,this._root,d),d}if(arguments.length===3){var _=arguments[0],S=arguments[1],N=arguments[2];if(zt.isTrue(_>-2),S.getLevel()===_)return N.add(S),null;for(var U=S.getChildBoundables().iterator();U.hasNext();){var J=U.next();J instanceof kn?this.boundablesAtLevel(_,J,N):(zt.isTrue(J instanceof js),_===-1&&N.add(J))}return null}}},{key:"query",value:function(){if(arguments.length===1){var c=arguments[0];this.build();var d=new me;return this.isEmpty()||this.getIntersectsOp().intersects(this._root.getBounds(),c)&&this.queryInternal(c,this._root,d),d}if(arguments.length===2){var _=arguments[0],S=arguments[1];if(this.build(),this.isEmpty())return null;this.getIntersectsOp().intersects(this._root.getBounds(),_)&&this.queryInternal(_,this._root,S)}}},{key:"build",value:function(){if(this._built)return null;this._root=this._itemBoundables.isEmpty()?this.createNode(0):this.createHigherLevels(this._itemBoundables,-1),this._itemBoundables=null,this._built=!0}},{key:"getRoot",value:function(){return this.build(),this._root}},{key:"remove",value:function(){if(arguments.length===2){var c=arguments[0],d=arguments[1];return this.build(),!!this.getIntersectsOp().intersects(this._root.getBounds(),c)&&this.remove(c,this._root,d)}if(arguments.length===3){var _=arguments[0],S=arguments[1],N=arguments[2],U=this.removeItem(S,N);if(U)return!0;for(var J=null,ge=S.getChildBoundables().iterator();ge.hasNext();){var Ie=ge.next();if(this.getIntersectsOp().intersects(Ie.getBounds(),_)&&Ie instanceof kn&&(U=this.remove(_,Ie,N))){J=Ie;break}}return J!==null&&J.getChildBoundables().isEmpty()&&S.getChildBoundables().remove(J),U}}},{key:"createHigherLevels",value:function(c,d){zt.isTrue(!c.isEmpty());var _=this.createParentBoundables(c,d+1);return _.size()===1?_.get(0):this.createHigherLevels(_,d+1)}},{key:"depth",value:function(){if(arguments.length===0)return this.isEmpty()?0:(this.build(),this.depth(this._root));if(arguments.length===1){for(var c=0,d=arguments[0].getChildBoundables().iterator();d.hasNext();){var _=d.next();if(_ instanceof kn){var S=this.depth(_);S>c&&(c=S)}}return c+1}}},{key:"createParentBoundables",value:function(c,d){zt.isTrue(!c.isEmpty());var _=new me;_.add(this.createNode(d));var S=new me(c);Fn.sort(S,this.getComparator());for(var N=S.iterator();N.hasNext();){var U=N.next();this.lastNode(_).getChildBoundables().size()===this.getNodeCapacity()&&_.add(this.createNode(d)),this.lastNode(_).addChildBoundable(U)}return _}},{key:"isEmpty",value:function(){return this._built?this._root.isEmpty():this._itemBoundables.isEmpty()}},{key:"interfaces_",get:function(){return[$]}}],[{key:"constructor_",value:function(){if(this._root=null,this._built=!1,this._itemBoundables=new me,this._nodeCapacity=null,arguments.length===0)v.constructor_.call(this,v.DEFAULT_NODE_CAPACITY);else if(arguments.length===1){var c=arguments[0];zt.isTrue(c>1,"Node capacity must be greater than 1"),this._nodeCapacity=c}}},{key:"compareDoubles",value:function(c,d){return c>d?1:c<d?-1:0}}])}();bs.IntersectsOp=function(){},bs.DEFAULT_NODE_CAPACITY=10;var Mr=function(){return o(function v(){h(this,v)},[{key:"distance",value:function(v,c){}}])}(),jn=function(v){function c(){var d;return h(this,c),d=s(this,c),c.constructor_.apply(d,arguments),d}return F(c,v),o(c,[{key:"createParentBoundablesFromVerticalSlices",value:function(d,_){zt.isTrue(d.length>0);for(var S=new me,N=0;N<d.length;N++)S.addAll(this.createParentBoundablesFromVerticalSlice(d[N],_));return S}},{key:"nearestNeighbourK",value:function(){if(arguments.length===2){var d=arguments[0],_=arguments[1];return this.nearestNeighbourK(d,vt.POSITIVE_INFINITY,_)}if(arguments.length===3){var S=arguments[0],N=arguments[2],U=arguments[1],J=new Xo;J.add(S);for(var ge=new Xo;!J.isEmpty()&&U>=0;){var Ie=J.poll(),st=Ie.getDistance();if(st>=U)break;Ie.isLeaves()?ge.size()<N?ge.add(Ie):(ge.peek().getDistance()>st&&(ge.poll(),ge.add(Ie)),U=ge.peek().getDistance()):Ie.expandToQueue(J,U)}return c.getItems(ge)}}},{key:"createNode",value:function(d){return new mo(d)}},{key:"size",value:function(){return arguments.length===0?H(c,"size",this,1).call(this):H(c,"size",this,1).apply(this,arguments)}},{key:"insert",value:function(){if(!(arguments.length===2&&arguments[1]instanceof Object&&arguments[0]instanceof ii))return H(c,"insert",this,1).apply(this,arguments);var d=arguments[0],_=arguments[1];if(d.isNull())return null;H(c,"insert",this,1).call(this,d,_)}},{key:"getIntersectsOp",value:function(){return c.intersectsOp}},{key:"verticalSlices",value:function(d,_){for(var S=Math.trunc(Math.ceil(d.size()/_)),N=new Array(_).fill(null),U=d.iterator(),J=0;J<_;J++){N[J]=new me;for(var ge=0;U.hasNext()&&ge<S;){var Ie=U.next();N[J].add(Ie),ge++}}return N}},{key:"query",value:function(){if(arguments.length===1){var d=arguments[0];return H(c,"query",this,1).call(this,d)}if(arguments.length===2){var _=arguments[0],S=arguments[1];H(c,"query",this,1).call(this,_,S)}}},{key:"getComparator",value:function(){return c.yComparator}},{key:"createParentBoundablesFromVerticalSlice",value:function(d,_){return H(c,"createParentBoundables",this,1).call(this,d,_)}},{key:"remove",value:function(){if(arguments.length===2&&arguments[1]instanceof Object&&arguments[0]instanceof ii){var d=arguments[0],_=arguments[1];return H(c,"remove",this,1).call(this,d,_)}return H(c,"remove",this,1).apply(this,arguments)}},{key:"depth",value:function(){return arguments.length===0?H(c,"depth",this,1).call(this):H(c,"depth",this,1).apply(this,arguments)}},{key:"createParentBoundables",value:function(d,_){zt.isTrue(!d.isEmpty());var S=Math.trunc(Math.ceil(d.size()/this.getNodeCapacity())),N=new me(d);Fn.sort(N,c.xComparator);var U=this.verticalSlices(N,Math.trunc(Math.ceil(Math.sqrt(S))));return this.createParentBoundablesFromVerticalSlices(U,_)}},{key:"nearestNeighbour",value:function(){if(arguments.length===1){if(Xt(arguments[0],Mr)){var d=arguments[0];if(this.isEmpty())return null;var _=new Hn(this.getRoot(),this.getRoot(),d);return this.nearestNeighbour(_)}if(arguments[0]instanceof Hn){var S=arguments[0],N=vt.POSITIVE_INFINITY,U=null,J=new Xo;for(J.add(S);!J.isEmpty()&&N>0;){var ge=J.poll(),Ie=ge.getDistance();if(Ie>=N)break;ge.isLeaves()?(N=Ie,U=ge):ge.expandToQueue(J,N)}return U===null?null:[U.getBoundable(0).getItem(),U.getBoundable(1).getItem()]}}else{if(arguments.length===2){var st=arguments[0],ht=arguments[1];if(this.isEmpty()||st.isEmpty())return null;var Pt=new Hn(this.getRoot(),st.getRoot(),ht);return this.nearestNeighbour(Pt)}if(arguments.length===3){var Qt=arguments[2],wi=new js(arguments[0],arguments[1]),Ni=new Hn(this.getRoot(),wi,Qt);return this.nearestNeighbour(Ni)[0]}if(arguments.length===4){var _i=arguments[2],yi=arguments[3],cr=new js(arguments[0],arguments[1]),hr=new Hn(this.getRoot(),cr,_i);return this.nearestNeighbourK(hr,yi)}}}},{key:"isWithinDistance",value:function(){if(arguments.length===2){var d=arguments[0],_=arguments[1],S=vt.POSITIVE_INFINITY,N=new Xo;for(N.add(d);!N.isEmpty();){var U=N.poll(),J=U.getDistance();if(J>_)return!1;if(U.maximumDistance()<=_)return!0;if(U.isLeaves()){if((S=J)<=_)return!0}else U.expandToQueue(N,S)}return!1}if(arguments.length===3){var ge=arguments[0],Ie=arguments[1],st=arguments[2],ht=new Hn(this.getRoot(),ge.getRoot(),Ie);return this.isWithinDistance(ht,st)}}},{key:"interfaces_",get:function(){return[Ho,$]}}],[{key:"constructor_",value:function(){if(arguments.length===0)c.constructor_.call(this,c.DEFAULT_NODE_CAPACITY);else if(arguments.length===1){var d=arguments[0];bs.constructor_.call(this,d)}}},{key:"centreX",value:function(d){return c.avg(d.getMinX(),d.getMaxX())}},{key:"avg",value:function(d,_){return(d+_)/2}},{key:"getItems",value:function(d){for(var _=new Array(d.size()).fill(null),S=0;!d.isEmpty();){var N=d.poll();_[S]=N.getBoundable(0).getItem(),S++}return _}},{key:"centreY",value:function(d){return c.avg(d.getMinY(),d.getMaxY())}}])}(bs),mo=function(v){function c(){var d;return h(this,c),d=s(this,c),c.constructor_.apply(d,arguments),d}return F(c,v),o(c,[{key:"computeBounds",value:function(){for(var d=null,_=this.getChildBoundables().iterator();_.hasNext();){var S=_.next();d===null?d=new ii(S.getBounds()):d.expandToInclude(S.getBounds())}return d}}],[{key:"constructor_",value:function(){var d=arguments[0];kn.constructor_.call(this,d)}}])}(kn);jn.STRtreeNode=mo,jn.xComparator=new(function(){return o(function v(){h(this,v)},[{key:"interfaces_",get:function(){return[Ft]}},{key:"compare",value:function(v,c){return bs.compareDoubles(jn.centreX(v.getBounds()),jn.centreX(c.getBounds()))}}])}()),jn.yComparator=new(function(){return o(function v(){h(this,v)},[{key:"interfaces_",get:function(){return[Ft]}},{key:"compare",value:function(v,c){return bs.compareDoubles(jn.centreY(v.getBounds()),jn.centreY(c.getBounds()))}}])}()),jn.intersectsOp=new(function(){return o(function v(){h(this,v)},[{key:"interfaces_",get:function(){return[IntersectsOp]}},{key:"intersects",value:function(v,c){return v.intersects(c)}}])}()),jn.DEFAULT_NODE_CAPACITY=10;var Ko=function(){function v(){h(this,v)}return o(v,null,[{key:"relativeSign",value:function(c,d){return c<d?-1:c>d?1:0}},{key:"compare",value:function(c,d,_){if(d.equals2D(_))return 0;var S=v.relativeSign(d.x,_.x),N=v.relativeSign(d.y,_.y);switch(c){case 0:return v.compareValue(S,N);case 1:return v.compareValue(N,S);case 2:return v.compareValue(N,-S);case 3:return v.compareValue(-S,N);case 4:return v.compareValue(-S,-N);case 5:return v.compareValue(-N,-S);case 6:return v.compareValue(-N,S);case 7:return v.compareValue(S,-N)}return zt.shouldNeverReachHere("invalid octant value"),0}},{key:"compareValue",value:function(c,d){return c<0?-1:c>0?1:d<0?-1:d>0?1:0}}])}(),Hl=function(){return o(function v(){h(this,v),v.constructor_.apply(this,arguments)},[{key:"getCoordinate",value:function(){return this.coord}},{key:"print",value:function(v){v.print(this.coord),v.print(" seg # = "+this.segmentIndex)}},{key:"compareTo",value:function(v){var c=v;return this.segmentIndex<c.segmentIndex?-1:this.segmentIndex>c.segmentIndex?1:this.coord.equals2D(c.coord)?0:this._isInterior?c._isInterior?Ko.compare(this._segmentOctant,this.coord,c.coord):1:-1}},{key:"isEndPoint",value:function(v){return this.segmentIndex===0&&!this._isInterior||this.segmentIndex===v}},{key:"toString",value:function(){return this.segmentIndex+":"+this.coord.toString()}},{key:"isInterior",value:function(){return this._isInterior}},{key:"interfaces_",get:function(){return[Se]}}],[{key:"constructor_",value:function(){this._segString=null,this.coord=null,this.segmentIndex=null,this._segmentOctant=null,this._isInterior=null;var v=arguments[0],c=arguments[1],d=arguments[2],_=arguments[3];this._segString=v,this.coord=new lt(c),this.segmentIndex=d,this._segmentOctant=_,this._isInterior=!c.equals2D(v.getCoordinate(d))}}])}(),As=function(){return o(function v(){h(this,v)},[{key:"hasNext",value:function(){}},{key:"next",value:function(){}},{key:"remove",value:function(){}}])}(),Jo=function(){return o(function v(){h(this,v),v.constructor_.apply(this,arguments)},[{key:"getSplitCoordinates",value:function(){var v=new Er;this.addEndpoints();for(var c=this.iterator(),d=c.next();c.hasNext();){var _=c.next();this.addEdgeCoordinates(d,_,v),d=_}return v.toCoordinateArray()}},{key:"addCollapsedNodes",value:function(){var v=new me;this.findCollapsesFromInsertedNodes(v),this.findCollapsesFromExistingVertices(v);for(var c=v.iterator();c.hasNext();){var d=c.next().intValue();this.add(this._edge.getCoordinate(d),d)}}},{key:"createSplitEdgePts",value:function(v,c){var d=c.segmentIndex-v.segmentIndex+2;if(d===2)return[new lt(v.coord),new lt(c.coord)];var _=this._edge.getCoordinate(c.segmentIndex),S=c.isInterior()||!c.coord.equals2D(_);S||d--;var N=new Array(d).fill(null),U=0;N[U++]=new lt(v.coord);for(var J=v.segmentIndex+1;J<=c.segmentIndex;J++)N[U++]=this._edge.getCoordinate(J);return S&&(N[U]=new lt(c.coord)),N}},{key:"print",value:function(v){v.println("Intersections:");for(var c=this.iterator();c.hasNext();)c.next().print(v)}},{key:"findCollapsesFromExistingVertices",value:function(v){for(var c=0;c<this._edge.size()-2;c++){var d=this._edge.getCoordinate(c);this._edge.getCoordinate(c+1);var _=this._edge.getCoordinate(c+2);d.equals2D(_)&&v.add(gi.valueOf(c+1))}}},{key:"addEdgeCoordinates",value:function(v,c,d){var _=this.createSplitEdgePts(v,c);d.add(_,!1)}},{key:"iterator",value:function(){return this._nodeMap.values().iterator()}},{key:"addSplitEdges",value:function(v){this.addEndpoints(),this.addCollapsedNodes();for(var c=this.iterator(),d=c.next();c.hasNext();){var _=c.next(),S=this.createSplitEdge(d,_);v.add(S),d=_}}},{key:"findCollapseIndex",value:function(v,c,d){if(!v.coord.equals2D(c.coord))return!1;var _=c.segmentIndex-v.segmentIndex;return c.isInterior()||_--,_===1&&(d[0]=v.segmentIndex+1,!0)}},{key:"findCollapsesFromInsertedNodes",value:function(v){for(var c=new Array(1).fill(null),d=this.iterator(),_=d.next();d.hasNext();){var S=d.next();this.findCollapseIndex(_,S,c)&&v.add(gi.valueOf(c[0])),_=S}}},{key:"getEdge",value:function(){return this._edge}},{key:"addEndpoints",value:function(){var v=this._edge.size()-1;this.add(this._edge.getCoordinate(0),0),this.add(this._edge.getCoordinate(v),v)}},{key:"createSplitEdge",value:function(v,c){var d=this.createSplitEdgePts(v,c);return new ls(d,this._edge.getData())}},{key:"add",value:function(v,c){var d=new Hl(this._edge,v,c,this._edge.getSegmentOctant(c)),_=this._nodeMap.get(d);return _!==null?(zt.isTrue(_.coord.equals2D(v),"Found equal nodes with different coordinates"),_):(this._nodeMap.put(d,d),d)}},{key:"checkSplitEdgesCorrectness",value:function(v){var c=this._edge.getCoordinates(),d=v.get(0).getCoordinate(0);if(!d.equals2D(c[0]))throw new It("bad split edge start point at "+d);var _=v.get(v.size()-1).getCoordinates(),S=_[_.length-1];if(!S.equals2D(c[c.length-1]))throw new It("bad split edge end point at "+S)}}],[{key:"constructor_",value:function(){this._nodeMap=new Ri,this._edge=null;var v=arguments[0];this._edge=v}}])}(),Oa=function(){function v(){h(this,v)}return o(v,null,[{key:"octant",value:function(){if(typeof arguments[0]=="number"&&typeof arguments[1]=="number"){var c=arguments[0],d=arguments[1];if(c===0&&d===0)throw new ye("Cannot compute the octant for point ( "+c+", "+d+" )");var _=Math.abs(c),S=Math.abs(d);return c>=0?d>=0?_>=S?0:1:_>=S?7:6:d>=0?_>=S?3:2:_>=S?4:5}if(arguments[0]instanceof lt&&arguments[1]instanceof lt){var N=arguments[0],U=arguments[1],J=U.x-N.x,ge=U.y-N.y;if(J===0&&ge===0)throw new ye("Cannot compute the octant for two identical points "+N);return v.octant(J,ge)}}}])}(),Fu=function(){return o(function v(){h(this,v)},[{key:"getCoordinates",value:function(){}},{key:"size",value:function(){}},{key:"getCoordinate",value:function(v){}},{key:"isClosed",value:function(){}},{key:"setData",value:function(v){}},{key:"getData",value:function(){}}])}(),Qr=function(){return o(function v(){h(this,v)},[{key:"addIntersection",value:function(v,c){}},{key:"interfaces_",get:function(){return[Fu]}}])}(),ls=function(){function v(){h(this,v),v.constructor_.apply(this,arguments)}return o(v,[{key:"getCoordinates",value:function(){return this._pts}},{key:"size",value:function(){return this._pts.length}},{key:"getCoordinate",value:function(c){return this._pts[c]}},{key:"isClosed",value:function(){return this._pts[0].equals(this._pts[this._pts.length-1])}},{key:"getSegmentOctant",value:function(c){return c===this._pts.length-1?-1:this.safeOctant(this.getCoordinate(c),this.getCoordinate(c+1))}},{key:"setData",value:function(c){this._data=c}},{key:"safeOctant",value:function(c,d){return c.equals2D(d)?0:Oa.octant(c,d)}},{key:"getData",value:function(){return this._data}},{key:"addIntersection",value:function(){if(arguments.length===2){var c=arguments[0],d=arguments[1];this.addIntersectionNode(c,d)}else if(arguments.length===4){var _=arguments[1],S=arguments[3],N=new lt(arguments[0].getIntersection(S));this.addIntersection(N,_)}}},{key:"toString",value:function(){return Dt.toLineString(new Sn(this._pts))}},{key:"getNodeList",value:function(){return this._nodeList}},{key:"addIntersectionNode",value:function(c,d){var _=d,S=_+1;if(S<this._pts.length){var N=this._pts[S];c.equals2D(N)&&(_=S)}return this._nodeList.add(c,_)}},{key:"addIntersections",value:function(c,d,_){for(var S=0;S<c.getIntersectionNum();S++)this.addIntersection(c,d,_,S)}},{key:"interfaces_",get:function(){return[Qr]}}],[{key:"constructor_",value:function(){this._nodeList=new Jo(this),this._pts=null,this._data=null;var c=arguments[0],d=arguments[1];this._pts=c,this._data=d}},{key:"getNodedSubstrings",value:function(){if(arguments.length===1){var c=arguments[0],d=new me;return v.getNodedSubstrings(c,d),d}if(arguments.length===2)for(var _=arguments[1],S=arguments[0].iterator();S.hasNext();)S.next().getNodeList().addSplitEdges(_)}}])}(),Fr=function(){function v(){h(this,v),v.constructor_.apply(this,arguments)}return o(v,[{key:"minX",value:function(){return Math.min(this.p0.x,this.p1.x)}},{key:"orientationIndex",value:function(){if(arguments[0]instanceof v){var c=arguments[0],d=Ii.index(this.p0,this.p1,c.p0),_=Ii.index(this.p0,this.p1,c.p1);return d>=0&&_>=0||d<=0&&_<=0?Math.max(d,_):0}if(arguments[0]instanceof lt){var S=arguments[0];return Ii.index(this.p0,this.p1,S)}}},{key:"toGeometry",value:function(c){return c.createLineString([this.p0,this.p1])}},{key:"isVertical",value:function(){return this.p0.x===this.p1.x}},{key:"equals",value:function(c){if(!(c instanceof v))return!1;var d=c;return this.p0.equals(d.p0)&&this.p1.equals(d.p1)}},{key:"intersection",value:function(c){var d=new Wt;return d.computeIntersection(this.p0,this.p1,c.p0,c.p1),d.hasIntersection()?d.getIntersection(0):null}},{key:"project",value:function(){if(arguments[0]instanceof lt){var c=arguments[0];if(c.equals(this.p0)||c.equals(this.p1))return new lt(c);var d=this.projectionFactor(c),_=new lt;return _.x=this.p0.x+d*(this.p1.x-this.p0.x),_.y=this.p0.y+d*(this.p1.y-this.p0.y),_}if(arguments[0]instanceof v){var S=arguments[0],N=this.projectionFactor(S.p0),U=this.projectionFactor(S.p1);if(N>=1&&U>=1||N<=0&&U<=0)return null;var J=this.project(S.p0);N<0&&(J=this.p0),N>1&&(J=this.p1);var ge=this.project(S.p1);return U<0&&(ge=this.p0),U>1&&(ge=this.p1),new v(J,ge)}}},{key:"normalize",value:function(){this.p1.compareTo(this.p0)<0&&this.reverse()}},{key:"angle",value:function(){return Math.atan2(this.p1.y-this.p0.y,this.p1.x-this.p0.x)}},{key:"getCoordinate",value:function(c){return c===0?this.p0:this.p1}},{key:"distancePerpendicular",value:function(c){return gt.pointToLinePerpendicular(c,this.p0,this.p1)}},{key:"minY",value:function(){return Math.min(this.p0.y,this.p1.y)}},{key:"midPoint",value:function(){return v.midPoint(this.p0,this.p1)}},{key:"projectionFactor",value:function(c){if(c.equals(this.p0))return 0;if(c.equals(this.p1))return 1;var d=this.p1.x-this.p0.x,_=this.p1.y-this.p0.y,S=d*d+_*_;return S<=0?vt.NaN:((c.x-this.p0.x)*d+(c.y-this.p0.y)*_)/S}},{key:"closestPoints",value:function(c){var d=this.intersection(c);if(d!==null)return[d,d];var _=new Array(2).fill(null),S=vt.MAX_VALUE,N=null,U=this.closestPoint(c.p0);S=U.distance(c.p0),_[0]=U,_[1]=c.p0;var J=this.closestPoint(c.p1);(N=J.distance(c.p1))<S&&(S=N,_[0]=J,_[1]=c.p1);var ge=c.closestPoint(this.p0);(N=ge.distance(this.p0))<S&&(S=N,_[0]=this.p0,_[1]=ge);var Ie=c.closestPoint(this.p1);return(N=Ie.distance(this.p1))<S&&(S=N,_[0]=this.p1,_[1]=Ie),_}},{key:"closestPoint",value:function(c){var d=this.projectionFactor(c);return d>0&&d<1?this.project(c):this.p0.distance(c)<this.p1.distance(c)?this.p0:this.p1}},{key:"maxX",value:function(){return Math.max(this.p0.x,this.p1.x)}},{key:"getLength",value:function(){return this.p0.distance(this.p1)}},{key:"compareTo",value:function(c){var d=c,_=this.p0.compareTo(d.p0);return _!==0?_:this.p1.compareTo(d.p1)}},{key:"reverse",value:function(){var c=this.p0;this.p0=this.p1,this.p1=c}},{key:"equalsTopo",value:function(c){return this.p0.equals(c.p0)&&this.p1.equals(c.p1)||this.p0.equals(c.p1)&&this.p1.equals(c.p0)}},{key:"lineIntersection",value:function(c){return Je.intersection(this.p0,this.p1,c.p0,c.p1)}},{key:"maxY",value:function(){return Math.max(this.p0.y,this.p1.y)}},{key:"pointAlongOffset",value:function(c,d){var _=this.p0.x+c*(this.p1.x-this.p0.x),S=this.p0.y+c*(this.p1.y-this.p0.y),N=this.p1.x-this.p0.x,U=this.p1.y-this.p0.y,J=Math.sqrt(N*N+U*U),ge=0,Ie=0;if(d!==0){if(J<=0)throw new IllegalStateException("Cannot compute offset from zero-length line segment");ge=d*N/J,Ie=d*U/J}return new lt(_-Ie,S+ge)}},{key:"setCoordinates",value:function(){if(arguments.length===1){var c=arguments[0];this.setCoordinates(c.p0,c.p1)}else if(arguments.length===2){var d=arguments[0],_=arguments[1];this.p0.x=d.x,this.p0.y=d.y,this.p1.x=_.x,this.p1.y=_.y}}},{key:"segmentFraction",value:function(c){var d=this.projectionFactor(c);return d<0?d=0:(d>1||vt.isNaN(d))&&(d=1),d}},{key:"toString",value:function(){return"LINESTRING( "+this.p0.x+" "+this.p0.y+", "+this.p1.x+" "+this.p1.y+")"}},{key:"isHorizontal",value:function(){return this.p0.y===this.p1.y}},{key:"reflect",value:function(c){var d=this.p1.getY()-this.p0.getY(),_=this.p0.getX()-this.p1.getX(),S=this.p0.getY()*(this.p1.getX()-this.p0.getX())-this.p0.getX()*(this.p1.getY()-this.p0.getY()),N=d*d+_*_,U=d*d-_*_,J=c.getX(),ge=c.getY();return new lt((-U*J-2*d*_*ge-2*d*S)/N,(U*ge-2*d*_*J-2*_*S)/N)}},{key:"distance",value:function(){if(arguments[0]instanceof v){var c=arguments[0];return gt.segmentToSegment(this.p0,this.p1,c.p0,c.p1)}if(arguments[0]instanceof lt){var d=arguments[0];return gt.pointToSegment(d,this.p0,this.p1)}}},{key:"pointAlong",value:function(c){var d=new lt;return d.x=this.p0.x+c*(this.p1.x-this.p0.x),d.y=this.p0.y+c*(this.p1.y-this.p0.y),d}},{key:"hashCode",value:function(){var c=vt.doubleToLongBits(this.p0.x);c^=31*vt.doubleToLongBits(this.p0.y);var d=Math.trunc(c)^Math.trunc(c>>32),_=vt.doubleToLongBits(this.p1.x);return _^=31*vt.doubleToLongBits(this.p1.y),d^(Math.trunc(_)^Math.trunc(_>>32))}},{key:"interfaces_",get:function(){return[Se,$]}}],[{key:"constructor_",value:function(){if(this.p0=null,this.p1=null,arguments.length===0)v.constructor_.call(this,new lt,new lt);else if(arguments.length===1){var c=arguments[0];v.constructor_.call(this,c.p0,c.p1)}else if(arguments.length===2){var d=arguments[0],_=arguments[1];this.p0=d,this.p1=_}else if(arguments.length===4){var S=arguments[0],N=arguments[1],U=arguments[2],J=arguments[3];v.constructor_.call(this,new lt(S,N),new lt(U,J))}}},{key:"midPoint",value:function(c,d){return new lt((c.x+d.x)/2,(c.y+d.y)/2)}}])}(),Kn=function(){return o(function v(){h(this,v),v.constructor_.apply(this,arguments)},[{key:"overlap",value:function(){if(arguments.length!==2&&arguments.length===4){var v=arguments[1],c=arguments[2],d=arguments[3];arguments[0].getLineSegment(v,this._overlapSeg1),c.getLineSegment(d,this._overlapSeg2),this.overlap(this._overlapSeg1,this._overlapSeg2)}}}],[{key:"constructor_",value:function(){this._overlapSeg1=new Fr,this._overlapSeg2=new Fr}}])}(),Qo=function(){return o(function v(){h(this,v),v.constructor_.apply(this,arguments)},[{key:"getLineSegment",value:function(v,c){c.p0=this._pts[v],c.p1=this._pts[v+1]}},{key:"computeSelect",value:function(v,c,d,_){var S=this._pts[c],N=this._pts[d];if(d-c==1)return _.select(this,c),null;if(!v.intersects(S,N))return null;var U=Math.trunc((c+d)/2);c<U&&this.computeSelect(v,c,U,_),U<d&&this.computeSelect(v,U,d,_)}},{key:"getCoordinates",value:function(){for(var v=new Array(this._end-this._start+1).fill(null),c=0,d=this._start;d<=this._end;d++)v[c++]=this._pts[d];return v}},{key:"computeOverlaps",value:function(){if(arguments.length===2){var v=arguments[0],c=arguments[1];this.computeOverlaps(this._start,this._end,v,v._start,v._end,c)}else if(arguments.length===6){var d=arguments[0],_=arguments[1],S=arguments[2],N=arguments[3],U=arguments[4],J=arguments[5];if(_-d==1&&U-N==1)return J.overlap(this,d,S,N),null;if(!this.overlaps(d,_,S,N,U))return null;var ge=Math.trunc((d+_)/2),Ie=Math.trunc((N+U)/2);d<ge&&(N<Ie&&this.computeOverlaps(d,ge,S,N,Ie,J),Ie<U&&this.computeOverlaps(d,ge,S,Ie,U,J)),ge<_&&(N<Ie&&this.computeOverlaps(ge,_,S,N,Ie,J),Ie<U&&this.computeOverlaps(ge,_,S,Ie,U,J))}}},{key:"setId",value:function(v){this._id=v}},{key:"select",value:function(v,c){this.computeSelect(v,this._start,this._end,c)}},{key:"getEnvelope",value:function(){if(this._env===null){var v=this._pts[this._start],c=this._pts[this._end];this._env=new ii(v,c)}return this._env}},{key:"overlaps",value:function(v,c,d,_,S){return ii.intersects(this._pts[v],this._pts[c],d._pts[_],d._pts[S])}},{key:"getEndIndex",value:function(){return this._end}},{key:"getStartIndex",value:function(){return this._start}},{key:"getContext",value:function(){return this._context}},{key:"getId",value:function(){return this._id}}],[{key:"constructor_",value:function(){this._pts=null,this._start=null,this._end=null,this._env=null,this._context=null,this._id=null;var v=arguments[0],c=arguments[1],d=arguments[2],_=arguments[3];this._pts=v,this._start=c,this._end=d,this._context=_}}])}(),io=function(){function v(){h(this,v)}return o(v,null,[{key:"findChainEnd",value:function(c,d){for(var _=d;_<c.length-1&&c[_].equals2D(c[_+1]);)_++;if(_>=c.length-1)return c.length-1;for(var S=fi.quadrant(c[_],c[_+1]),N=d+1;N<c.length&&!(!c[N-1].equals2D(c[N])&&fi.quadrant(c[N-1],c[N])!==S);)N++;return N-1}},{key:"getChains",value:function(){if(arguments.length===1){var c=arguments[0];return v.getChains(c,null)}if(arguments.length===2){var d=arguments[0],_=arguments[1],S=new me,N=0;do{var U=v.findChainEnd(d,N),J=new Qo(d,N,U,_);S.add(J),N=U}while(N<d.length-1);return S}}}])}(),Gs=function(){return o(function v(){h(this,v)},[{key:"computeNodes",value:function(v){}},{key:"getNodedSubstrings",value:function(){}}])}(),ea=function(){return o(function v(){h(this,v),v.constructor_.apply(this,arguments)},[{key:"setSegmentIntersector",value:function(v){this._segInt=v}},{key:"interfaces_",get:function(){return[Gs]}}],[{key:"constructor_",value:function(){if(this._segInt=null,arguments.length!==0&&arguments.length===1){var v=arguments[0];this.setSegmentIntersector(v)}}}])}(),_a=function(v){function c(){var d;return h(this,c),d=s(this,c),c.constructor_.apply(d,arguments),d}return F(c,v),o(c,[{key:"getMonotoneChains",value:function(){return this._monoChains}},{key:"getNodedSubstrings",value:function(){return ls.getNodedSubstrings(this._nodedSegStrings)}},{key:"getIndex",value:function(){return this._index}},{key:"add",value:function(d){for(var _=io.getChains(d.getCoordinates(),d).iterator();_.hasNext();){var S=_.next();S.setId(this._idCounter++),this._index.insert(S.getEnvelope(),S),this._monoChains.add(S)}}},{key:"computeNodes",value:function(d){this._nodedSegStrings=d;for(var _=d.iterator();_.hasNext();)this.add(_.next());this.intersectChains()}},{key:"intersectChains",value:function(){for(var d=new ta(this._segInt),_=this._monoChains.iterator();_.hasNext();)for(var S=_.next(),N=this._index.query(S.getEnvelope()).iterator();N.hasNext();){var U=N.next();if(U.getId()>S.getId()&&(S.computeOverlaps(U,d),this._nOverlaps++),this._segInt.isDone())return null}}}],[{key:"constructor_",value:function(){if(this._monoChains=new me,this._index=new jn,this._idCounter=0,this._nodedSegStrings=null,this._nOverlaps=0,arguments.length!==0&&arguments.length===1){var d=arguments[0];ea.constructor_.call(this,d)}}}])}(ea),ta=function(v){function c(){var d;return h(this,c),d=s(this,c),c.constructor_.apply(d,arguments),d}return F(c,v),o(c,[{key:"overlap",value:function(){if(arguments.length!==4)return H(c,"overlap",this,1).apply(this,arguments);var d=arguments[1],_=arguments[2],S=arguments[3],N=arguments[0].getContext(),U=_.getContext();this._si.processIntersections(N,d,U,S)}}],[{key:"constructor_",value:function(){this._si=null;var d=arguments[0];this._si=d}}])}(Kn);_a.SegmentOverlapAction=ta;var Ls=function(){function v(){h(this,v),v.constructor_.apply(this,arguments)}return o(v,[{key:"isDeletable",value:function(c,d,_,S){var N=this._inputLine[c],U=this._inputLine[d],J=this._inputLine[_];return!!this.isConcave(N,U,J)&&!!this.isShallow(N,U,J,S)&&this.isShallowSampled(N,U,c,_,S)}},{key:"deleteShallowConcavities",value:function(){for(var c=1,d=this.findNextNonDeletedIndex(c),_=this.findNextNonDeletedIndex(d),S=!1;_<this._inputLine.length;){var N=!1;this.isDeletable(c,d,_,this._distanceTol)&&(this._isDeleted[d]=v.DELETE,N=!0,S=!0),c=N?_:d,d=this.findNextNonDeletedIndex(c),_=this.findNextNonDeletedIndex(d)}return S}},{key:"isShallowConcavity",value:function(c,d,_,S){return Ii.index(c,d,_)===this._angleOrientation&&gt.pointToSegment(d,c,_)<S}},{key:"isShallowSampled",value:function(c,d,_,S,N){var U=Math.trunc((S-_)/v.NUM_PTS_TO_CHECK);U<=0&&(U=1);for(var J=_;J<S;J+=U)if(!this.isShallow(c,d,this._inputLine[J],N))return!1;return!0}},{key:"isConcave",value:function(c,d,_){var S=Ii.index(c,d,_)===this._angleOrientation;return S}},{key:"simplify",value:function(c){this._distanceTol=Math.abs(c),c<0&&(this._angleOrientation=Ii.CLOCKWISE),this._isDeleted=new Array(this._inputLine.length).fill(null);var d=!1;do d=this.deleteShallowConcavities();while(d);return this.collapseLine()}},{key:"findNextNonDeletedIndex",value:function(c){for(var d=c+1;d<this._inputLine.length&&this._isDeleted[d]===v.DELETE;)d++;return d}},{key:"isShallow",value:function(c,d,_,S){return gt.pointToSegment(d,c,_)<S}},{key:"collapseLine",value:function(){for(var c=new Er,d=0;d<this._inputLine.length;d++)this._isDeleted[d]!==v.DELETE&&c.add(this._inputLine[d]);return c.toCoordinateArray()}}],[{key:"constructor_",value:function(){this._inputLine=null,this._distanceTol=null,this._isDeleted=null,this._angleOrientation=Ii.COUNTERCLOCKWISE;var c=arguments[0];this._inputLine=c}},{key:"simplify",value:function(c,d){return new v(c).simplify(d)}}])}();Ls.INIT=0,Ls.DELETE=1,Ls.KEEP=1,Ls.NUM_PTS_TO_CHECK=10;var Kl=function(){function v(){h(this,v),v.constructor_.apply(this,arguments)}return o(v,[{key:"getCoordinates",value:function(){return this._ptList.toArray(v.COORDINATE_ARRAY_TYPE)}},{key:"setPrecisionModel",value:function(c){this._precisionModel=c}},{key:"addPt",value:function(c){var d=new lt(c);if(this._precisionModel.makePrecise(d),this.isRedundant(d))return null;this._ptList.add(d)}},{key:"reverse",value:function(){}},{key:"addPts",value:function(c,d){if(d)for(var _=0;_<c.length;_++)this.addPt(c[_]);else for(var S=c.length-1;S>=0;S--)this.addPt(c[S])}},{key:"isRedundant",value:function(c){if(this._ptList.size()<1)return!1;var d=this._ptList.get(this._ptList.size()-1);return c.distance(d)<this._minimimVertexDistance}},{key:"toString",value:function(){return new Jr().createLineString(this.getCoordinates()).toString()}},{key:"closeRing",value:function(){if(this._ptList.size()<1)return null;var c=new lt(this._ptList.get(0)),d=this._ptList.get(this._ptList.size()-1);if(c.equals(d))return null;this._ptList.add(c)}},{key:"setMinimumVertexDistance",value:function(c){this._minimimVertexDistance=c}}],[{key:"constructor_",value:function(){this._ptList=null,this._precisionModel=null,this._minimimVertexDistance=0,this._ptList=new me}}])}();Kl.COORDINATE_ARRAY_TYPE=new Array(0).fill(null);var zn=function(){function v(){h(this,v)}return o(v,null,[{key:"toDegrees",value:function(c){return 180*c/Math.PI}},{key:"normalize",value:function(c){for(;c>Math.PI;)c-=v.PI_TIMES_2;for(;c<=-Math.PI;)c+=v.PI_TIMES_2;return c}},{key:"angle",value:function(){if(arguments.length===1){var c=arguments[0];return Math.atan2(c.y,c.x)}if(arguments.length===2){var d=arguments[0],_=arguments[1],S=_.x-d.x,N=_.y-d.y;return Math.atan2(N,S)}}},{key:"isAcute",value:function(c,d,_){var S=c.x-d.x,N=c.y-d.y;return S*(_.x-d.x)+N*(_.y-d.y)>0}},{key:"isObtuse",value:function(c,d,_){var S=c.x-d.x,N=c.y-d.y;return S*(_.x-d.x)+N*(_.y-d.y)<0}},{key:"interiorAngle",value:function(c,d,_){var S=v.angle(d,c),N=v.angle(d,_);return Math.abs(N-S)}},{key:"normalizePositive",value:function(c){if(c<0){for(;c<0;)c+=v.PI_TIMES_2;c>=v.PI_TIMES_2&&(c=0)}else{for(;c>=v.PI_TIMES_2;)c-=v.PI_TIMES_2;c<0&&(c=0)}return c}},{key:"angleBetween",value:function(c,d,_){var S=v.angle(d,c),N=v.angle(d,_);return v.diff(S,N)}},{key:"diff",value:function(c,d){var _=null;return(_=c<d?d-c:c-d)>Math.PI&&(_=2*Math.PI-_),_}},{key:"toRadians",value:function(c){return c*Math.PI/180}},{key:"getTurn",value:function(c,d){var _=Math.sin(d-c);return _>0?v.COUNTERCLOCKWISE:_<0?v.CLOCKWISE:v.NONE}},{key:"angleBetweenOriented",value:function(c,d,_){var S=v.angle(d,c),N=v.angle(d,_)-S;return N<=-Math.PI?N+v.PI_TIMES_2:N>Math.PI?N-v.PI_TIMES_2:N}}])}();zn.PI_TIMES_2=2*Math.PI,zn.PI_OVER_2=Math.PI/2,zn.PI_OVER_4=Math.PI/4,zn.COUNTERCLOCKWISE=Ii.COUNTERCLOCKWISE,zn.CLOCKWISE=Ii.CLOCKWISE,zn.NONE=Ii.COLLINEAR;var go=function(){function v(){h(this,v),v.constructor_.apply(this,arguments)}return o(v,[{key:"addNextSegment",value:function(c,d){if(this._s0=this._s1,this._s1=this._s2,this._s2=c,this._seg0.setCoordinates(this._s0,this._s1),this.computeOffsetSegment(this._seg0,this._side,this._distance,this._offset0),this._seg1.setCoordinates(this._s1,this._s2),this.computeOffsetSegment(this._seg1,this._side,this._distance,this._offset1),this._s1.equals(this._s2))return null;var _=Ii.index(this._s0,this._s1,this._s2),S=_===Ii.CLOCKWISE&&this._side===Ot.LEFT||_===Ii.COUNTERCLOCKWISE&&this._side===Ot.RIGHT;_===0?this.addCollinear(d):S?this.addOutsideTurn(_,d):this.addInsideTurn(_,d)}},{key:"addLineEndCap",value:function(c,d){var _=new Fr(c,d),S=new Fr;this.computeOffsetSegment(_,Ot.LEFT,this._distance,S);var N=new Fr;this.computeOffsetSegment(_,Ot.RIGHT,this._distance,N);var U=d.x-c.x,J=d.y-c.y,ge=Math.atan2(J,U);switch(this._bufParams.getEndCapStyle()){case K.CAP_ROUND:this._segList.addPt(S.p1),this.addDirectedFillet(d,ge+Math.PI/2,ge-Math.PI/2,Ii.CLOCKWISE,this._distance),this._segList.addPt(N.p1);break;case K.CAP_FLAT:this._segList.addPt(S.p1),this._segList.addPt(N.p1);break;case K.CAP_SQUARE:var Ie=new lt;Ie.x=Math.abs(this._distance)*Math.cos(ge),Ie.y=Math.abs(this._distance)*Math.sin(ge);var st=new lt(S.p1.x+Ie.x,S.p1.y+Ie.y),ht=new lt(N.p1.x+Ie.x,N.p1.y+Ie.y);this._segList.addPt(st),this._segList.addPt(ht)}}},{key:"getCoordinates",value:function(){return this._segList.getCoordinates()}},{key:"addMitreJoin",value:function(c,d,_,S){var N=Je.intersection(d.p0,d.p1,_.p0,_.p1);if(N!==null&&(S<=0?1:N.distance(c)/Math.abs(S))<=this._bufParams.getMitreLimit())return this._segList.addPt(N),null;this.addLimitedMitreJoin(d,_,S,this._bufParams.getMitreLimit())}},{key:"addOutsideTurn",value:function(c,d){if(this._offset0.p1.distance(this._offset1.p0)<this._distance*v.OFFSET_SEGMENT_SEPARATION_FACTOR)return this._segList.addPt(this._offset0.p1),null;this._bufParams.getJoinStyle()===K.JOIN_MITRE?this.addMitreJoin(this._s1,this._offset0,this._offset1,this._distance):this._bufParams.getJoinStyle()===K.JOIN_BEVEL?this.addBevelJoin(this._offset0,this._offset1):(d&&this._segList.addPt(this._offset0.p1),this.addCornerFillet(this._s1,this._offset0.p1,this._offset1.p0,c,this._distance),this._segList.addPt(this._offset1.p0))}},{key:"createSquare",value:function(c){this._segList.addPt(new lt(c.x+this._distance,c.y+this._distance)),this._segList.addPt(new lt(c.x+this._distance,c.y-this._distance)),this._segList.addPt(new lt(c.x-this._distance,c.y-this._distance)),this._segList.addPt(new lt(c.x-this._distance,c.y+this._distance)),this._segList.closeRing()}},{key:"addSegments",value:function(c,d){this._segList.addPts(c,d)}},{key:"addFirstSegment",value:function(){this._segList.addPt(this._offset1.p0)}},{key:"addCornerFillet",value:function(c,d,_,S,N){var U=d.x-c.x,J=d.y-c.y,ge=Math.atan2(J,U),Ie=_.x-c.x,st=_.y-c.y,ht=Math.atan2(st,Ie);S===Ii.CLOCKWISE?ge<=ht&&(ge+=2*Math.PI):ge>=ht&&(ge-=2*Math.PI),this._segList.addPt(d),this.addDirectedFillet(c,ge,ht,S,N),this._segList.addPt(_)}},{key:"addLastSegment",value:function(){this._segList.addPt(this._offset1.p1)}},{key:"initSideSegments",value:function(c,d,_){this._s1=c,this._s2=d,this._side=_,this._seg1.setCoordinates(c,d),this.computeOffsetSegment(this._seg1,_,this._distance,this._offset1)}},{key:"addLimitedMitreJoin",value:function(c,d,_,S){var N=this._seg0.p1,U=zn.angle(N,this._seg0.p0),J=zn.angleBetweenOriented(this._seg0.p0,N,this._seg1.p1)/2,ge=zn.normalize(U+J),Ie=zn.normalize(ge+Math.PI),st=S*_,ht=_-st*Math.abs(Math.sin(J)),Pt=N.x+st*Math.cos(Ie),Qt=N.y+st*Math.sin(Ie),wi=new lt(Pt,Qt),Ni=new Fr(N,wi),_i=Ni.pointAlongOffset(1,ht),yi=Ni.pointAlongOffset(1,-ht);this._side===Ot.LEFT?(this._segList.addPt(_i),this._segList.addPt(yi)):(this._segList.addPt(yi),this._segList.addPt(_i))}},{key:"addDirectedFillet",value:function(c,d,_,S,N){var U=S===Ii.CLOCKWISE?-1:1,J=Math.abs(d-_),ge=Math.trunc(J/this._filletAngleQuantum+.5);if(ge<1)return null;for(var Ie=J/ge,st=new lt,ht=0;ht<ge;ht++){var Pt=d+U*ht*Ie;st.x=c.x+N*Math.cos(Pt),st.y=c.y+N*Math.sin(Pt),this._segList.addPt(st)}}},{key:"computeOffsetSegment",value:function(c,d,_,S){var N=d===Ot.LEFT?1:-1,U=c.p1.x-c.p0.x,J=c.p1.y-c.p0.y,ge=Math.sqrt(U*U+J*J),Ie=N*_*U/ge,st=N*_*J/ge;S.p0.x=c.p0.x-st,S.p0.y=c.p0.y+Ie,S.p1.x=c.p1.x-st,S.p1.y=c.p1.y+Ie}},{key:"addInsideTurn",value:function(c,d){if(this._li.computeIntersection(this._offset0.p0,this._offset0.p1,this._offset1.p0,this._offset1.p1),this._li.hasIntersection())this._segList.addPt(this._li.getIntersection(0));else if(this._hasNarrowConcaveAngle=!0,this._offset0.p1.distance(this._offset1.p0)<this._distance*v.INSIDE_TURN_VERTEX_SNAP_DISTANCE_FACTOR)this._segList.addPt(this._offset0.p1);else{if(this._segList.addPt(this._offset0.p1),this._closingSegLengthFactor>0){var _=new lt((this._closingSegLengthFactor*this._offset0.p1.x+this._s1.x)/(this._closingSegLengthFactor+1),(this._closingSegLengthFactor*this._offset0.p1.y+this._s1.y)/(this._closingSegLengthFactor+1));this._segList.addPt(_);var S=new lt((this._closingSegLengthFactor*this._offset1.p0.x+this._s1.x)/(this._closingSegLengthFactor+1),(this._closingSegLengthFactor*this._offset1.p0.y+this._s1.y)/(this._closingSegLengthFactor+1));this._segList.addPt(S)}else this._segList.addPt(this._s1);this._segList.addPt(this._offset1.p0)}}},{key:"createCircle",value:function(c){var d=new lt(c.x+this._distance,c.y);this._segList.addPt(d),this.addDirectedFillet(c,0,2*Math.PI,-1,this._distance),this._segList.closeRing()}},{key:"addBevelJoin",value:function(c,d){this._segList.addPt(c.p1),this._segList.addPt(d.p0)}},{key:"init",value:function(c){this._distance=c,this._maxCurveSegmentError=c*(1-Math.cos(this._filletAngleQuantum/2)),this._segList=new Kl,this._segList.setPrecisionModel(this._precisionModel),this._segList.setMinimumVertexDistance(c*v.CURVE_VERTEX_SNAP_DISTANCE_FACTOR)}},{key:"addCollinear",value:function(c){this._li.computeIntersection(this._s0,this._s1,this._s1,this._s2),this._li.getIntersectionNum()>=2&&(this._bufParams.getJoinStyle()===K.JOIN_BEVEL||this._bufParams.getJoinStyle()===K.JOIN_MITRE?(c&&this._segList.addPt(this._offset0.p1),this._segList.addPt(this._offset1.p0)):this.addCornerFillet(this._s1,this._offset0.p1,this._offset1.p0,Ii.CLOCKWISE,this._distance))}},{key:"closeRing",value:function(){this._segList.closeRing()}},{key:"hasNarrowConcaveAngle",value:function(){return this._hasNarrowConcaveAngle}}],[{key:"constructor_",value:function(){this._maxCurveSegmentError=0,this._filletAngleQuantum=null,this._closingSegLengthFactor=1,this._segList=null,this._distance=0,this._precisionModel=null,this._bufParams=null,this._li=null,this._s0=null,this._s1=null,this._s2=null,this._seg0=new Fr,this._seg1=new Fr,this._offset0=new Fr,this._offset1=new Fr,this._side=0,this._hasNarrowConcaveAngle=!1;var c=arguments[0],d=arguments[1],_=arguments[2];this._precisionModel=c,this._bufParams=d,this._li=new Wt,this._filletAngleQuantum=Math.PI/2/d.getQuadrantSegments(),d.getQuadrantSegments()>=8&&d.getJoinStyle()===K.JOIN_ROUND&&(this._closingSegLengthFactor=v.MAX_CLOSING_SEG_LEN_FACTOR),this.init(_)}}])}();go.OFFSET_SEGMENT_SEPARATION_FACTOR=.001,go.INSIDE_TURN_VERTEX_SNAP_DISTANCE_FACTOR=.001,go.CURVE_VERTEX_SNAP_DISTANCE_FACTOR=1e-6,go.MAX_CLOSING_SEG_LEN_FACTOR=80;var Da=function(){function v(){h(this,v),v.constructor_.apply(this,arguments)}return o(v,[{key:"getOffsetCurve",value:function(c,d){if(this._distance=d,d===0)return null;var _=d<0,S=Math.abs(d),N=this.getSegGen(S);c.length<=1?this.computePointCurve(c[0],N):this.computeOffsetCurve(c,_,N);var U=N.getCoordinates();return _&&ri.reverse(U),U}},{key:"computeSingleSidedBufferCurve",value:function(c,d,_){var S=this.simplifyTolerance(this._distance);if(d){_.addSegments(c,!0);var N=Ls.simplify(c,-S),U=N.length-1;_.initSideSegments(N[U],N[U-1],Ot.LEFT),_.addFirstSegment();for(var J=U-2;J>=0;J--)_.addNextSegment(N[J],!0)}else{_.addSegments(c,!1);var ge=Ls.simplify(c,S),Ie=ge.length-1;_.initSideSegments(ge[0],ge[1],Ot.LEFT),_.addFirstSegment();for(var st=2;st<=Ie;st++)_.addNextSegment(ge[st],!0)}_.addLastSegment(),_.closeRing()}},{key:"computeRingBufferCurve",value:function(c,d,_){var S=this.simplifyTolerance(this._distance);d===Ot.RIGHT&&(S=-S);var N=Ls.simplify(c,S),U=N.length-1;_.initSideSegments(N[U-1],N[0],d);for(var J=1;J<=U;J++){var ge=J!==1;_.addNextSegment(N[J],ge)}_.closeRing()}},{key:"computeLineBufferCurve",value:function(c,d){var _=this.simplifyTolerance(this._distance),S=Ls.simplify(c,_),N=S.length-1;d.initSideSegments(S[0],S[1],Ot.LEFT);for(var U=2;U<=N;U++)d.addNextSegment(S[U],!0);d.addLastSegment(),d.addLineEndCap(S[N-1],S[N]);var J=Ls.simplify(c,-_),ge=J.length-1;d.initSideSegments(J[ge],J[ge-1],Ot.LEFT);for(var Ie=ge-2;Ie>=0;Ie--)d.addNextSegment(J[Ie],!0);d.addLastSegment(),d.addLineEndCap(J[1],J[0]),d.closeRing()}},{key:"computePointCurve",value:function(c,d){switch(this._bufParams.getEndCapStyle()){case K.CAP_ROUND:d.createCircle(c);break;case K.CAP_SQUARE:d.createSquare(c)}}},{key:"getLineCurve",value:function(c,d){if(this._distance=d,this.isLineOffsetEmpty(d))return null;var _=Math.abs(d),S=this.getSegGen(_);if(c.length<=1)this.computePointCurve(c[0],S);else if(this._bufParams.isSingleSided()){var N=d<0;this.computeSingleSidedBufferCurve(c,N,S)}else this.computeLineBufferCurve(c,S);return S.getCoordinates()}},{key:"getBufferParameters",value:function(){return this._bufParams}},{key:"simplifyTolerance",value:function(c){return c*this._bufParams.getSimplifyFactor()}},{key:"getRingCurve",value:function(c,d,_){if(this._distance=_,c.length<=2)return this.getLineCurve(c,_);if(_===0)return v.copyCoordinates(c);var S=this.getSegGen(_);return this.computeRingBufferCurve(c,d,S),S.getCoordinates()}},{key:"computeOffsetCurve",value:function(c,d,_){var S=this.simplifyTolerance(this._distance);if(d){var N=Ls.simplify(c,-S),U=N.length-1;_.initSideSegments(N[U],N[U-1],Ot.LEFT),_.addFirstSegment();for(var J=U-2;J>=0;J--)_.addNextSegment(N[J],!0)}else{var ge=Ls.simplify(c,S),Ie=ge.length-1;_.initSideSegments(ge[0],ge[1],Ot.LEFT),_.addFirstSegment();for(var st=2;st<=Ie;st++)_.addNextSegment(ge[st],!0)}_.addLastSegment()}},{key:"isLineOffsetEmpty",value:function(c){return c===0||c<0&&!this._bufParams.isSingleSided()}},{key:"getSegGen",value:function(c){return new go(this._precisionModel,this._bufParams,c)}}],[{key:"constructor_",value:function(){this._distance=0,this._precisionModel=null,this._bufParams=null;var c=arguments[0],d=arguments[1];this._precisionModel=c,this._bufParams=d}},{key:"copyCoordinates",value:function(c){for(var d=new Array(c.length).fill(null),_=0;_<d.length;_++)d[_]=new lt(c[_]);return d}}])}(),Co=function(){return o(function v(){h(this,v),v.constructor_.apply(this,arguments)},[{key:"findStabbedSegments",value:function(){if(arguments.length===1){for(var v=arguments[0],c=new me,d=this._subgraphs.iterator();d.hasNext();){var _=d.next(),S=_.getEnvelope();v.y<S.getMinY()||v.y>S.getMaxY()||this.findStabbedSegments(v,_.getDirectedEdges(),c)}return c}if(arguments.length===3){if(Xt(arguments[2],os)&&arguments[0]instanceof lt&&arguments[1]instanceof hn){for(var N=arguments[0],U=arguments[1],J=arguments[2],ge=U.getEdge().getCoordinates(),Ie=0;Ie<ge.length-1;Ie++)if(this._seg.p0=ge[Ie],this._seg.p1=ge[Ie+1],this._seg.p0.y>this._seg.p1.y&&this._seg.reverse(),!(Math.max(this._seg.p0.x,this._seg.p1.x)<N.x||this._seg.isHorizontal()||N.y<this._seg.p0.y||N.y>this._seg.p1.y||Ii.index(this._seg.p0,this._seg.p1,N)===Ii.RIGHT)){var st=U.getDepth(Ot.LEFT);this._seg.p0.equals(ge[Ie])||(st=U.getDepth(Ot.RIGHT));var ht=new ia(this._seg,st);J.add(ht)}}else if(Xt(arguments[2],os)&&arguments[0]instanceof lt&&Xt(arguments[1],os))for(var Pt=arguments[0],Qt=arguments[2],wi=arguments[1].iterator();wi.hasNext();){var Ni=wi.next();Ni.isForward()&&this.findStabbedSegments(Pt,Ni,Qt)}}}},{key:"getDepth",value:function(v){var c=this.findStabbedSegments(v);return c.size()===0?0:Fn.min(c)._leftDepth}}],[{key:"constructor_",value:function(){this._subgraphs=null,this._seg=new Fr;var v=arguments[0];this._subgraphs=v}}])}(),ia=function(){return o(function v(){h(this,v),v.constructor_.apply(this,arguments)},[{key:"compareTo",value:function(v){var c=v;if(this._upwardSeg.minX()>=c._upwardSeg.maxX())return 1;if(this._upwardSeg.maxX()<=c._upwardSeg.minX())return-1;var d=this._upwardSeg.orientationIndex(c._upwardSeg);return d!==0||(d=-1*c._upwardSeg.orientationIndex(this._upwardSeg))!==0?d:this._upwardSeg.compareTo(c._upwardSeg)}},{key:"compareX",value:function(v,c){var d=v.p0.compareTo(c.p0);return d!==0?d:v.p1.compareTo(c.p1)}},{key:"toString",value:function(){return this._upwardSeg.toString()}},{key:"interfaces_",get:function(){return[Se]}}],[{key:"constructor_",value:function(){this._upwardSeg=null,this._leftDepth=null;var v=arguments[0],c=arguments[1];this._upwardSeg=new Fr(v),this._leftDepth=c}}])}();Co.DepthSegment=ia;var Rs=function(v){function c(){var d;return h(this,c),d=s(this,c),c.constructor_.apply(d,arguments),d}return F(c,v),o(c,null,[{key:"constructor_",value:function(){ne.constructor_.call(this,"Projective point not representable on the Cartesian plane.")}}])}(ne),nn=function(){function v(){h(this,v),v.constructor_.apply(this,arguments)}return o(v,[{key:"getY",value:function(){var c=this.y/this.w;if(vt.isNaN(c)||vt.isInfinite(c))throw new Rs;return c}},{key:"getX",value:function(){var c=this.x/this.w;if(vt.isNaN(c)||vt.isInfinite(c))throw new Rs;return c}},{key:"getCoordinate",value:function(){var c=new lt;return c.x=this.getX(),c.y=this.getY(),c}}],[{key:"constructor_",value:function(){if(this.x=null,this.y=null,this.w=null,arguments.length===0)this.x=0,this.y=0,this.w=1;else if(arguments.length===1){var c=arguments[0];this.x=c.x,this.y=c.y,this.w=1}else if(arguments.length===2){if(typeof arguments[0]=="number"&&typeof arguments[1]=="number"){var d=arguments[0],_=arguments[1];this.x=d,this.y=_,this.w=1}else if(arguments[0]instanceof v&&arguments[1]instanceof v){var S=arguments[0],N=arguments[1];this.x=S.y*N.w-N.y*S.w,this.y=N.x*S.w-S.x*N.w,this.w=S.x*N.y-N.x*S.y}else if(arguments[0]instanceof lt&&arguments[1]instanceof lt){var U=arguments[0],J=arguments[1];this.x=U.y-J.y,this.y=J.x-U.x,this.w=U.x*J.y-J.x*U.y}}else if(arguments.length===3){var ge=arguments[0],Ie=arguments[1],st=arguments[2];this.x=ge,this.y=Ie,this.w=st}else if(arguments.length===4){var ht=arguments[0],Pt=arguments[1],Qt=arguments[2],wi=arguments[3],Ni=ht.y-Pt.y,_i=Pt.x-ht.x,yi=ht.x*Pt.y-Pt.x*ht.y,cr=Qt.y-wi.y,hr=wi.x-Qt.x,dn=Qt.x*wi.y-wi.x*Qt.y;this.x=_i*dn-hr*yi,this.y=cr*yi-Ni*dn,this.w=Ni*hr-cr*_i}}}])}(),Ao=function(){function v(){h(this,v),v.constructor_.apply(this,arguments)}return o(v,[{key:"area",value:function(){return v.area(this.p0,this.p1,this.p2)}},{key:"signedArea",value:function(){return v.signedArea(this.p0,this.p1,this.p2)}},{key:"interpolateZ",value:function(c){if(c===null)throw new ye("Supplied point is null.");return v.interpolateZ(c,this.p0,this.p1,this.p2)}},{key:"longestSideLength",value:function(){return v.longestSideLength(this.p0,this.p1,this.p2)}},{key:"isAcute",value:function(){return v.isAcute(this.p0,this.p1,this.p2)}},{key:"circumcentre",value:function(){return v.circumcentre(this.p0,this.p1,this.p2)}},{key:"area3D",value:function(){return v.area3D(this.p0,this.p1,this.p2)}},{key:"centroid",value:function(){return v.centroid(this.p0,this.p1,this.p2)}},{key:"inCentre",value:function(){return v.inCentre(this.p0,this.p1,this.p2)}}],[{key:"constructor_",value:function(){this.p0=null,this.p1=null,this.p2=null;var c=arguments[0],d=arguments[1],_=arguments[2];this.p0=c,this.p1=d,this.p2=_}},{key:"area",value:function(c,d,_){return Math.abs(((_.x-c.x)*(d.y-c.y)-(d.x-c.x)*(_.y-c.y))/2)}},{key:"signedArea",value:function(c,d,_){return((_.x-c.x)*(d.y-c.y)-(d.x-c.x)*(_.y-c.y))/2}},{key:"det",value:function(c,d,_,S){return c*S-d*_}},{key:"interpolateZ",value:function(c,d,_,S){var N=d.x,U=d.y,J=_.x-N,ge=S.x-N,Ie=_.y-U,st=S.y-U,ht=J*st-ge*Ie,Pt=c.x-N,Qt=c.y-U,wi=(st*Pt-ge*Qt)/ht,Ni=(-Ie*Pt+J*Qt)/ht;return d.getZ()+wi*(_.getZ()-d.getZ())+Ni*(S.getZ()-d.getZ())}},{key:"longestSideLength",value:function(c,d,_){var S=c.distance(d),N=d.distance(_),U=_.distance(c),J=S;return N>J&&(J=N),U>J&&(J=U),J}},{key:"circumcentreDD",value:function(c,d,_){var S=oi.valueOf(c.x).subtract(_.x),N=oi.valueOf(c.y).subtract(_.y),U=oi.valueOf(d.x).subtract(_.x),J=oi.valueOf(d.y).subtract(_.y),ge=oi.determinant(S,N,U,J).multiply(2),Ie=S.sqr().add(N.sqr()),st=U.sqr().add(J.sqr()),ht=oi.determinant(N,Ie,J,st),Pt=oi.determinant(S,Ie,U,st),Qt=oi.valueOf(_.x).subtract(ht.divide(ge)).doubleValue(),wi=oi.valueOf(_.y).add(Pt.divide(ge)).doubleValue();return new lt(Qt,wi)}},{key:"isAcute",value:function(c,d,_){return!!zn.isAcute(c,d,_)&&!!zn.isAcute(d,_,c)&&!!zn.isAcute(_,c,d)}},{key:"circumcentre",value:function(c,d,_){var S=_.x,N=_.y,U=c.x-S,J=c.y-N,ge=d.x-S,Ie=d.y-N,st=2*v.det(U,J,ge,Ie),ht=v.det(J,U*U+J*J,Ie,ge*ge+Ie*Ie),Pt=v.det(U,U*U+J*J,ge,ge*ge+Ie*Ie);return new lt(S-ht/st,N+Pt/st)}},{key:"perpendicularBisector",value:function(c,d){var _=d.x-c.x,S=d.y-c.y,N=new nn(c.x+_/2,c.y+S/2,1),U=new nn(c.x-S+_/2,c.y+_+S/2,1);return new nn(N,U)}},{key:"angleBisector",value:function(c,d,_){var S=d.distance(c),N=S/(S+d.distance(_)),U=_.x-c.x,J=_.y-c.y;return new lt(c.x+N*U,c.y+N*J)}},{key:"area3D",value:function(c,d,_){var S=d.x-c.x,N=d.y-c.y,U=d.getZ()-c.getZ(),J=_.x-c.x,ge=_.y-c.y,Ie=_.getZ()-c.getZ(),st=N*Ie-U*ge,ht=U*J-S*Ie,Pt=S*ge-N*J,Qt=st*st+ht*ht+Pt*Pt,wi=Math.sqrt(Qt)/2;return wi}},{key:"centroid",value:function(c,d,_){var S=(c.x+d.x+_.x)/3,N=(c.y+d.y+_.y)/3;return new lt(S,N)}},{key:"inCentre",value:function(c,d,_){var S=d.distance(_),N=c.distance(_),U=c.distance(d),J=S+N+U,ge=(S*c.x+N*d.x+U*_.x)/J,Ie=(S*c.y+N*d.y+U*_.y)/J;return new lt(ge,Ie)}}])}(),ra=function(){return o(function v(){h(this,v),v.constructor_.apply(this,arguments)},[{key:"addRingSide",value:function(v,c,d,_,S){if(c===0&&v.length<Bt.MINIMUM_VALID_SIZE)return null;var N=_,U=S;v.length>=Bt.MINIMUM_VALID_SIZE&&Ii.isCCW(v)&&(N=S,U=_,d=Ot.opposite(d));var J=this._curveBuilder.getRingCurve(v,d,c);this.addCurve(J,N,U)}},{key:"addRingBothSides",value:function(v,c){this.addRingSide(v,c,Ot.LEFT,$e.EXTERIOR,$e.INTERIOR),this.addRingSide(v,c,Ot.RIGHT,$e.INTERIOR,$e.EXTERIOR)}},{key:"addPoint",value:function(v){if(this._distance<=0)return null;var c=v.getCoordinates(),d=this._curveBuilder.getLineCurve(c,this._distance);this.addCurve(d,$e.EXTERIOR,$e.INTERIOR)}},{key:"addPolygon",value:function(v){var c=this._distance,d=Ot.LEFT;this._distance<0&&(c=-this._distance,d=Ot.RIGHT);var _=v.getExteriorRing(),S=ri.removeRepeatedPoints(_.getCoordinates());if(this._distance<0&&this.isErodedCompletely(_,this._distance)||this._distance<=0&&S.length<3)return null;this.addRingSide(S,c,d,$e.EXTERIOR,$e.INTERIOR);for(var N=0;N<v.getNumInteriorRing();N++){var U=v.getInteriorRingN(N),J=ri.removeRepeatedPoints(U.getCoordinates());this._distance>0&&this.isErodedCompletely(U,-this._distance)||this.addRingSide(J,c,Ot.opposite(d),$e.INTERIOR,$e.EXTERIOR)}}},{key:"isTriangleErodedCompletely",value:function(v,c){var d=new Ao(v[0],v[1],v[2]),_=d.inCentre();return gt.pointToSegment(_,d.p0,d.p1)<Math.abs(c)}},{key:"addLineString",value:function(v){if(this._curveBuilder.isLineOffsetEmpty(this._distance))return null;var c=ri.removeRepeatedPoints(v.getCoordinates());if(ri.isRing(c)&&!this._curveBuilder.getBufferParameters().isSingleSided())this.addRingBothSides(c,this._distance);else{var d=this._curveBuilder.getLineCurve(c,this._distance);this.addCurve(d,$e.EXTERIOR,$e.INTERIOR)}}},{key:"addCurve",value:function(v,c,d){if(v===null||v.length<2)return null;var _=new ls(v,new Pi(0,$e.BOUNDARY,c,d));this._curveList.add(_)}},{key:"getCurves",value:function(){return this.add(this._inputGeom),this._curveList}},{key:"add",value:function(v){if(v.isEmpty())return null;if(v instanceof Lr)this.addPolygon(v);else if(v instanceof Ci)this.addLineString(v);else if(v instanceof ur)this.addPoint(v);else if(v instanceof Ps)this.addCollection(v);else if(v instanceof $n)this.addCollection(v);else if(v instanceof gr)this.addCollection(v);else{if(!(v instanceof Or))throw new Gi(v.getGeometryType());this.addCollection(v)}}},{key:"isErodedCompletely",value:function(v,c){var d=v.getCoordinates();if(d.length<4)return c<0;if(d.length===4)return this.isTriangleErodedCompletely(d,c);var _=v.getEnvelopeInternal(),S=Math.min(_.getHeight(),_.getWidth());return c<0&&2*Math.abs(c)>S}},{key:"addCollection",value:function(v){for(var c=0;c<v.getNumGeometries();c++){var d=v.getGeometryN(c);this.add(d)}}}],[{key:"constructor_",value:function(){this._inputGeom=null,this._distance=null,this._curveBuilder=null,this._curveList=new me;var v=arguments[0],c=arguments[1],d=arguments[2];this._inputGeom=v,this._distance=c,this._curveBuilder=d}}])}(),ws=function(){return o(function v(){h(this,v)},[{key:"locate",value:function(v){}}])}(),va=function(){function v(){h(this,v),v.constructor_.apply(this,arguments)}return o(v,[{key:"next",value:function(){if(this._atStart)return this._atStart=!1,v.isAtomic(this._parent)&&this._index++,this._parent;if(this._subcollectionIterator!==null){if(this._subcollectionIterator.hasNext())return this._subcollectionIterator.next();this._subcollectionIterator=null}if(this._index>=this._max)throw new Qi;var c=this._parent.getGeometryN(this._index++);return c instanceof Or?(this._subcollectionIterator=new v(c),this._subcollectionIterator.next()):c}},{key:"remove",value:function(){throw new Gi(this.getClass().getName())}},{key:"hasNext",value:function(){if(this._atStart)return!0;if(this._subcollectionIterator!==null){if(this._subcollectionIterator.hasNext())return!0;this._subcollectionIterator=null}return!(this._index>=this._max)}},{key:"interfaces_",get:function(){return[As]}}],[{key:"constructor_",value:function(){this._parent=null,this._atStart=null,this._max=null,this._index=null,this._subcollectionIterator=null;var c=arguments[0];this._parent=c,this._atStart=!0,this._index=0,this._max=c.getNumGeometries()}},{key:"isAtomic",value:function(c){return!(c instanceof Or)}}])}(),xa=function(){function v(){h(this,v),v.constructor_.apply(this,arguments)}return o(v,[{key:"locate",value:function(c){return v.locate(c,this._geom)}},{key:"interfaces_",get:function(){return[ws]}}],[{key:"constructor_",value:function(){this._geom=null;var c=arguments[0];this._geom=c}},{key:"locatePointInPolygon",value:function(c,d){if(d.isEmpty())return $e.EXTERIOR;var _=d.getExteriorRing(),S=v.locatePointInRing(c,_);if(S!==$e.INTERIOR)return S;for(var N=0;N<d.getNumInteriorRing();N++){var U=d.getInteriorRingN(N),J=v.locatePointInRing(c,U);if(J===$e.BOUNDARY)return $e.BOUNDARY;if(J===$e.INTERIOR)return $e.EXTERIOR}return $e.INTERIOR}},{key:"locatePointInRing",value:function(c,d){return d.getEnvelopeInternal().intersects(c)?ki.locateInRing(c,d.getCoordinates()):$e.EXTERIOR}},{key:"containsPointInPolygon",value:function(c,d){return $e.EXTERIOR!==v.locatePointInPolygon(c,d)}},{key:"locateInGeometry",value:function(c,d){if(d instanceof Lr)return v.locatePointInPolygon(c,d);if(d instanceof Or)for(var _=new va(d);_.hasNext();){var S=_.next();if(S!==d){var N=v.locateInGeometry(c,S);if(N!==$e.EXTERIOR)return N}}return $e.EXTERIOR}},{key:"isContained",value:function(c,d){return $e.EXTERIOR!==v.locate(c,d)}},{key:"locate",value:function(c,d){return d.isEmpty()?$e.EXTERIOR:d.getEnvelopeInternal().intersects(c)?v.locateInGeometry(c,d):$e.EXTERIOR}}])}(),ro=function(){return o(function v(){h(this,v),v.constructor_.apply(this,arguments)},[{key:"getNextCW",value:function(v){this.getEdges();var c=this._edgeList.indexOf(v),d=c-1;return c===0&&(d=this._edgeList.size()-1),this._edgeList.get(d)}},{key:"propagateSideLabels",value:function(v){for(var c=$e.NONE,d=this.iterator();d.hasNext();){var _=d.next().getLabel();_.isArea(v)&&_.getLocation(v,Ot.LEFT)!==$e.NONE&&(c=_.getLocation(v,Ot.LEFT))}if(c===$e.NONE)return null;for(var S=c,N=this.iterator();N.hasNext();){var U=N.next(),J=U.getLabel();if(J.getLocation(v,Ot.ON)===$e.NONE&&J.setLocation(v,Ot.ON,S),J.isArea(v)){var ge=J.getLocation(v,Ot.LEFT),Ie=J.getLocation(v,Ot.RIGHT);if(Ie!==$e.NONE){if(Ie!==S)throw new le("side location conflict",U.getCoordinate());ge===$e.NONE&&zt.shouldNeverReachHere("found single null side (at "+U.getCoordinate()+")"),S=ge}else zt.isTrue(J.getLocation(v,Ot.LEFT)===$e.NONE,"found single null side"),J.setLocation(v,Ot.RIGHT,S),J.setLocation(v,Ot.LEFT,S)}}}},{key:"getCoordinate",value:function(){var v=this.iterator();return v.hasNext()?v.next().getCoordinate():null}},{key:"print",value:function(v){at.out.println("EdgeEndStar:   "+this.getCoordinate());for(var c=this.iterator();c.hasNext();)c.next().print(v)}},{key:"isAreaLabelsConsistent",value:function(v){return this.computeEdgeEndLabels(v.getBoundaryNodeRule()),this.checkAreaLabelsConsistent(0)}},{key:"checkAreaLabelsConsistent",value:function(v){var c=this.getEdges();if(c.size()<=0)return!0;var d=c.size()-1,_=c.get(d).getLabel().getLocation(v,Ot.LEFT);zt.isTrue(_!==$e.NONE,"Found unlabelled area edge");for(var S=_,N=this.iterator();N.hasNext();){var U=N.next().getLabel();zt.isTrue(U.isArea(v),"Found non-area edge");var J=U.getLocation(v,Ot.LEFT),ge=U.getLocation(v,Ot.RIGHT);if(J===ge||ge!==S)return!1;S=J}return!0}},{key:"findIndex",value:function(v){this.iterator();for(var c=0;c<this._edgeList.size();c++)if(this._edgeList.get(c)===v)return c;return-1}},{key:"iterator",value:function(){return this.getEdges().iterator()}},{key:"getEdges",value:function(){return this._edgeList===null&&(this._edgeList=new me(this._edgeMap.values())),this._edgeList}},{key:"getLocation",value:function(v,c,d){return this._ptInAreaLocation[v]===$e.NONE&&(this._ptInAreaLocation[v]=xa.locate(c,d[v].getGeometry())),this._ptInAreaLocation[v]}},{key:"toString",value:function(){var v=new _r;v.append("EdgeEndStar:   "+this.getCoordinate()),v.append(`
`);for(var c=this.iterator();c.hasNext();){var d=c.next();v.append(d),v.append(`
`)}return v.toString()}},{key:"computeEdgeEndLabels",value:function(v){for(var c=this.iterator();c.hasNext();)c.next().computeLabel(v)}},{key:"computeLabelling",value:function(v){this.computeEdgeEndLabels(v[0].getBoundaryNodeRule()),this.propagateSideLabels(0),this.propagateSideLabels(1);for(var c=[!1,!1],d=this.iterator();d.hasNext();)for(var _=d.next().getLabel(),S=0;S<2;S++)_.isLine(S)&&_.getLocation(S)===$e.BOUNDARY&&(c[S]=!0);for(var N=this.iterator();N.hasNext();)for(var U=N.next(),J=U.getLabel(),ge=0;ge<2;ge++)if(J.isAnyNull(ge)){var Ie=$e.NONE;if(c[ge])Ie=$e.EXTERIOR;else{var st=U.getCoordinate();Ie=this.getLocation(ge,st,v)}J.setAllLocationsIfNull(ge,Ie)}}},{key:"getDegree",value:function(){return this._edgeMap.size()}},{key:"insertEdgeEnd",value:function(v,c){this._edgeMap.put(v,c),this._edgeList=null}}],[{key:"constructor_",value:function(){this._edgeMap=new Ri,this._edgeList=null,this._ptInAreaLocation=[$e.NONE,$e.NONE]}}])}(),fl=function(v){function c(){var d;return h(this,c),d=s(this,c),c.constructor_.apply(d,arguments),d}return F(c,v),o(c,[{key:"linkResultDirectedEdges",value:function(){this.getResultAreaEdges();for(var d=null,_=null,S=this._SCANNING_FOR_INCOMING,N=0;N<this._resultAreaEdgeList.size();N++){var U=this._resultAreaEdgeList.get(N),J=U.getSym();if(U.getLabel().isArea())switch(d===null&&U.isInResult()&&(d=U),S){case this._SCANNING_FOR_INCOMING:if(!J.isInResult())continue;_=J,S=this._LINKING_TO_OUTGOING;break;case this._LINKING_TO_OUTGOING:if(!U.isInResult())continue;_.setNext(U),S=this._SCANNING_FOR_INCOMING}}if(S===this._LINKING_TO_OUTGOING){if(d===null)throw new le("no outgoing dirEdge found",this.getCoordinate());zt.isTrue(d.isInResult(),"unable to link last incoming dirEdge"),_.setNext(d)}}},{key:"insert",value:function(d){var _=d;this.insertEdgeEnd(_,_)}},{key:"getRightmostEdge",value:function(){var d=this.getEdges(),_=d.size();if(_<1)return null;var S=d.get(0);if(_===1)return S;var N=d.get(_-1),U=S.getQuadrant(),J=N.getQuadrant();return fi.isNorthern(U)&&fi.isNorthern(J)?S:fi.isNorthern(U)||fi.isNorthern(J)?S.getDy()!==0?S:N.getDy()!==0?N:(zt.shouldNeverReachHere("found two horizontal edges incident on node"),null):N}},{key:"print",value:function(d){at.out.println("DirectedEdgeStar: "+this.getCoordinate());for(var _=this.iterator();_.hasNext();){var S=_.next();d.print("out "),S.print(d),d.println(),d.print("in "),S.getSym().print(d),d.println()}}},{key:"getResultAreaEdges",value:function(){if(this._resultAreaEdgeList!==null)return this._resultAreaEdgeList;this._resultAreaEdgeList=new me;for(var d=this.iterator();d.hasNext();){var _=d.next();(_.isInResult()||_.getSym().isInResult())&&this._resultAreaEdgeList.add(_)}return this._resultAreaEdgeList}},{key:"updateLabelling",value:function(d){for(var _=this.iterator();_.hasNext();){var S=_.next().getLabel();S.setAllLocationsIfNull(0,d.getLocation(0)),S.setAllLocationsIfNull(1,d.getLocation(1))}}},{key:"linkAllDirectedEdges",value:function(){this.getEdges();for(var d=null,_=null,S=this._edgeList.size()-1;S>=0;S--){var N=this._edgeList.get(S),U=N.getSym();_===null&&(_=U),d!==null&&U.setNext(d),d=N}_.setNext(d)}},{key:"computeDepths",value:function(){if(arguments.length===1){var d=arguments[0],_=this.findIndex(d),S=d.getDepth(Ot.LEFT),N=d.getDepth(Ot.RIGHT),U=this.computeDepths(_+1,this._edgeList.size(),S);if(this.computeDepths(0,_,U)!==N)throw new le("depth mismatch at "+d.getCoordinate())}else if(arguments.length===3){for(var J=arguments[1],ge=arguments[2],Ie=arguments[0];Ie<J;Ie++){var st=this._edgeList.get(Ie);st.setEdgeDepths(Ot.RIGHT,ge),ge=st.getDepth(Ot.LEFT)}return ge}}},{key:"mergeSymLabels",value:function(){for(var d=this.iterator();d.hasNext();){var _=d.next();_.getLabel().merge(_.getSym().getLabel())}}},{key:"linkMinimalDirectedEdges",value:function(d){for(var _=null,S=null,N=this._SCANNING_FOR_INCOMING,U=this._resultAreaEdgeList.size()-1;U>=0;U--){var J=this._resultAreaEdgeList.get(U),ge=J.getSym();switch(_===null&&J.getEdgeRing()===d&&(_=J),N){case this._SCANNING_FOR_INCOMING:if(ge.getEdgeRing()!==d)continue;S=ge,N=this._LINKING_TO_OUTGOING;break;case this._LINKING_TO_OUTGOING:if(J.getEdgeRing()!==d)continue;S.setNextMin(J),N=this._SCANNING_FOR_INCOMING}}N===this._LINKING_TO_OUTGOING&&(zt.isTrue(_!==null,"found null for first outgoing dirEdge"),zt.isTrue(_.getEdgeRing()===d,"unable to link last incoming dirEdge"),S.setNextMin(_))}},{key:"getOutgoingDegree",value:function(){if(arguments.length===0){for(var d=0,_=this.iterator();_.hasNext();)_.next().isInResult()&&d++;return d}if(arguments.length===1){for(var S=arguments[0],N=0,U=this.iterator();U.hasNext();)U.next().getEdgeRing()===S&&N++;return N}}},{key:"getLabel",value:function(){return this._label}},{key:"findCoveredLineEdges",value:function(){for(var d=$e.NONE,_=this.iterator();_.hasNext();){var S=_.next(),N=S.getSym();if(!S.isLineEdge()){if(S.isInResult()){d=$e.INTERIOR;break}if(N.isInResult()){d=$e.EXTERIOR;break}}}if(d===$e.NONE)return null;for(var U=d,J=this.iterator();J.hasNext();){var ge=J.next(),Ie=ge.getSym();ge.isLineEdge()?ge.getEdge().setCovered(U===$e.INTERIOR):(ge.isInResult()&&(U=$e.EXTERIOR),Ie.isInResult()&&(U=$e.INTERIOR))}}},{key:"computeLabelling",value:function(d){H(c,"computeLabelling",this,1).call(this,d),this._label=new Pi($e.NONE);for(var _=this.iterator();_.hasNext();)for(var S=_.next().getEdge().getLabel(),N=0;N<2;N++){var U=S.getLocation(N);U!==$e.INTERIOR&&U!==$e.BOUNDARY||this._label.setLocation(N,$e.INTERIOR)}}}],[{key:"constructor_",value:function(){this._resultAreaEdgeList=null,this._label=null,this._SCANNING_FOR_INCOMING=1,this._LINKING_TO_OUTGOING=2}}])}(ro),Lo=function(v){function c(){return h(this,c),s(this,c)}return F(c,v),o(c,[{key:"createNode",value:function(d){return new or(d,new fl)}}])}(po),Jl=function(){function v(){h(this,v),v.constructor_.apply(this,arguments)}return o(v,[{key:"compareTo",value:function(c){var d=c;return v.compareOriented(this._pts,this._orientation,d._pts,d._orientation)}},{key:"interfaces_",get:function(){return[Se]}}],[{key:"constructor_",value:function(){this._pts=null,this._orientation=null;var c=arguments[0];this._pts=c,this._orientation=v.orientation(c)}},{key:"orientation",value:function(c){return ri.increasingDirection(c)===1}},{key:"compareOriented",value:function(c,d,_,S){for(var N=d?1:-1,U=S?1:-1,J=d?c.length:-1,ge=S?_.length:-1,Ie=d?0:c.length-1,st=S?0:_.length-1;;){var ht=c[Ie].compareTo(_[st]);if(ht!==0)return ht;var Pt=(Ie+=N)===J,Qt=(st+=U)===ge;if(Pt&&!Qt)return-1;if(!Pt&&Qt)return 1;if(Pt&&Qt)return 0}}}])}(),Ql=function(){return o(function v(){h(this,v),v.constructor_.apply(this,arguments)},[{key:"print",value:function(v){v.print("MULTILINESTRING ( ");for(var c=0;c<this._edges.size();c++){var d=this._edges.get(c);c>0&&v.print(","),v.print("(");for(var _=d.getCoordinates(),S=0;S<_.length;S++)S>0&&v.print(","),v.print(_[S].x+" "+_[S].y);v.println(")")}v.print(")  ")}},{key:"addAll",value:function(v){for(var c=v.iterator();c.hasNext();)this.add(c.next())}},{key:"findEdgeIndex",value:function(v){for(var c=0;c<this._edges.size();c++)if(this._edges.get(c).equals(v))return c;return-1}},{key:"iterator",value:function(){return this._edges.iterator()}},{key:"getEdges",value:function(){return this._edges}},{key:"get",value:function(v){return this._edges.get(v)}},{key:"findEqualEdge",value:function(v){var c=new Jl(v.getCoordinates());return this._ocaMap.get(c)}},{key:"add",value:function(v){this._edges.add(v);var c=new Jl(v.getCoordinates());this._ocaMap.put(c,v)}}],[{key:"constructor_",value:function(){this._edges=new me,this._ocaMap=new Ri}}])}(),ml=function(){return o(function v(){h(this,v)},[{key:"processIntersections",value:function(v,c,d,_){}},{key:"isDone",value:function(){}}])}(),ba=function(){function v(){h(this,v),v.constructor_.apply(this,arguments)}return o(v,[{key:"isTrivialIntersection",value:function(c,d,_,S){if(c===_&&this._li.getIntersectionNum()===1){if(v.isAdjacentSegments(d,S))return!0;if(c.isClosed()){var N=c.size()-1;if(d===0&&S===N||S===0&&d===N)return!0}}return!1}},{key:"getProperIntersectionPoint",value:function(){return this._properIntersectionPoint}},{key:"hasProperInteriorIntersection",value:function(){return this._hasProperInterior}},{key:"getLineIntersector",value:function(){return this._li}},{key:"hasProperIntersection",value:function(){return this._hasProper}},{key:"processIntersections",value:function(c,d,_,S){if(c===_&&d===S)return null;this.numTests++;var N=c.getCoordinates()[d],U=c.getCoordinates()[d+1],J=_.getCoordinates()[S],ge=_.getCoordinates()[S+1];this._li.computeIntersection(N,U,J,ge),this._li.hasIntersection()&&(this.numIntersections++,this._li.isInteriorIntersection()&&(this.numInteriorIntersections++,this._hasInterior=!0),this.isTrivialIntersection(c,d,_,S)||(this._hasIntersection=!0,c.addIntersections(this._li,d,0),_.addIntersections(this._li,S,1),this._li.isProper()&&(this.numProperIntersections++,this._hasProper=!0,this._hasProperInterior=!0)))}},{key:"hasIntersection",value:function(){return this._hasIntersection}},{key:"isDone",value:function(){return!1}},{key:"hasInteriorIntersection",value:function(){return this._hasInterior}},{key:"interfaces_",get:function(){return[ml]}}],[{key:"constructor_",value:function(){this._hasIntersection=!1,this._hasProper=!1,this._hasProperInterior=!1,this._hasInterior=!1,this._properIntersectionPoint=null,this._li=null,this._isSelfIntersection=null,this.numIntersections=0,this.numInteriorIntersections=0,this.numProperIntersections=0,this.numTests=0;var c=arguments[0];this._li=c}},{key:"isAdjacentSegments",value:function(c,d){return Math.abs(c-d)===1}}])}(),na=function(){return o(function v(){h(this,v),v.constructor_.apply(this,arguments)},[{key:"getSegmentIndex",value:function(){return this.segmentIndex}},{key:"getCoordinate",value:function(){return this.coord}},{key:"print",value:function(v){v.print(this.coord),v.print(" seg # = "+this.segmentIndex),v.println(" dist = "+this.dist)}},{key:"compareTo",value:function(v){var c=v;return this.compare(c.segmentIndex,c.dist)}},{key:"isEndPoint",value:function(v){return this.segmentIndex===0&&this.dist===0||this.segmentIndex===v}},{key:"toString",value:function(){return this.coord+" seg # = "+this.segmentIndex+" dist = "+this.dist}},{key:"getDistance",value:function(){return this.dist}},{key:"compare",value:function(v,c){return this.segmentIndex<v?-1:this.segmentIndex>v?1:this.dist<c?-1:this.dist>c?1:0}},{key:"interfaces_",get:function(){return[Se]}}],[{key:"constructor_",value:function(){this.coord=null,this.segmentIndex=null,this.dist=null;var v=arguments[0],c=arguments[1],d=arguments[2];this.coord=new lt(v),this.segmentIndex=c,this.dist=d}}])}(),Ro=function(){return o(function v(){h(this,v),v.constructor_.apply(this,arguments)},[{key:"print",value:function(v){v.println("Intersections:");for(var c=this.iterator();c.hasNext();)c.next().print(v)}},{key:"iterator",value:function(){return this._nodeMap.values().iterator()}},{key:"addSplitEdges",value:function(v){this.addEndpoints();for(var c=this.iterator(),d=c.next();c.hasNext();){var _=c.next(),S=this.createSplitEdge(d,_);v.add(S),d=_}}},{key:"addEndpoints",value:function(){var v=this.edge.pts.length-1;this.add(this.edge.pts[0],0,0),this.add(this.edge.pts[v],v,0)}},{key:"createSplitEdge",value:function(v,c){var d=c.segmentIndex-v.segmentIndex+2,_=this.edge.pts[c.segmentIndex],S=c.dist>0||!c.coord.equals2D(_);S||d--;var N=new Array(d).fill(null),U=0;N[U++]=new lt(v.coord);for(var J=v.segmentIndex+1;J<=c.segmentIndex;J++)N[U++]=this.edge.pts[J];return S&&(N[U]=c.coord),new za(N,new Pi(this.edge._label))}},{key:"add",value:function(v,c,d){var _=new na(v,c,d),S=this._nodeMap.get(_);return S!==null?S:(this._nodeMap.put(_,_),_)}},{key:"isIntersection",value:function(v){for(var c=this.iterator();c.hasNext();)if(c.next().coord.equals(v))return!0;return!1}}],[{key:"constructor_",value:function(){this._nodeMap=new Ri,this.edge=null;var v=arguments[0];this.edge=v}}])}(),eu=function(){function v(){h(this,v),v.constructor_.apply(this,arguments)}return o(v,[{key:"isIntersects",value:function(){return!this.isDisjoint()}},{key:"isCovers",value:function(){return(v.isTrue(this._matrix[$e.INTERIOR][$e.INTERIOR])||v.isTrue(this._matrix[$e.INTERIOR][$e.BOUNDARY])||v.isTrue(this._matrix[$e.BOUNDARY][$e.INTERIOR])||v.isTrue(this._matrix[$e.BOUNDARY][$e.BOUNDARY]))&&this._matrix[$e.EXTERIOR][$e.INTERIOR]===bt.FALSE&&this._matrix[$e.EXTERIOR][$e.BOUNDARY]===bt.FALSE}},{key:"isCoveredBy",value:function(){return(v.isTrue(this._matrix[$e.INTERIOR][$e.INTERIOR])||v.isTrue(this._matrix[$e.INTERIOR][$e.BOUNDARY])||v.isTrue(this._matrix[$e.BOUNDARY][$e.INTERIOR])||v.isTrue(this._matrix[$e.BOUNDARY][$e.BOUNDARY]))&&this._matrix[$e.INTERIOR][$e.EXTERIOR]===bt.FALSE&&this._matrix[$e.BOUNDARY][$e.EXTERIOR]===bt.FALSE}},{key:"set",value:function(){if(arguments.length===1)for(var c=arguments[0],d=0;d<c.length;d++){var _=Math.trunc(d/3),S=d%3;this._matrix[_][S]=bt.toDimensionValue(c.charAt(d))}else if(arguments.length===3){var N=arguments[0],U=arguments[1],J=arguments[2];this._matrix[N][U]=J}}},{key:"isContains",value:function(){return v.isTrue(this._matrix[$e.INTERIOR][$e.INTERIOR])&&this._matrix[$e.EXTERIOR][$e.INTERIOR]===bt.FALSE&&this._matrix[$e.EXTERIOR][$e.BOUNDARY]===bt.FALSE}},{key:"setAtLeast",value:function(){if(arguments.length===1)for(var c=arguments[0],d=0;d<c.length;d++){var _=Math.trunc(d/3),S=d%3;this.setAtLeast(_,S,bt.toDimensionValue(c.charAt(d)))}else if(arguments.length===3){var N=arguments[0],U=arguments[1],J=arguments[2];this._matrix[N][U]<J&&(this._matrix[N][U]=J)}}},{key:"setAtLeastIfValid",value:function(c,d,_){c>=0&&d>=0&&this.setAtLeast(c,d,_)}},{key:"isWithin",value:function(){return v.isTrue(this._matrix[$e.INTERIOR][$e.INTERIOR])&&this._matrix[$e.INTERIOR][$e.EXTERIOR]===bt.FALSE&&this._matrix[$e.BOUNDARY][$e.EXTERIOR]===bt.FALSE}},{key:"isTouches",value:function(c,d){return c>d?this.isTouches(d,c):(c===bt.A&&d===bt.A||c===bt.L&&d===bt.L||c===bt.L&&d===bt.A||c===bt.P&&d===bt.A||c===bt.P&&d===bt.L)&&this._matrix[$e.INTERIOR][$e.INTERIOR]===bt.FALSE&&(v.isTrue(this._matrix[$e.INTERIOR][$e.BOUNDARY])||v.isTrue(this._matrix[$e.BOUNDARY][$e.INTERIOR])||v.isTrue(this._matrix[$e.BOUNDARY][$e.BOUNDARY]))}},{key:"isOverlaps",value:function(c,d){return c===bt.P&&d===bt.P||c===bt.A&&d===bt.A?v.isTrue(this._matrix[$e.INTERIOR][$e.INTERIOR])&&v.isTrue(this._matrix[$e.INTERIOR][$e.EXTERIOR])&&v.isTrue(this._matrix[$e.EXTERIOR][$e.INTERIOR]):c===bt.L&&d===bt.L&&this._matrix[$e.INTERIOR][$e.INTERIOR]===1&&v.isTrue(this._matrix[$e.INTERIOR][$e.EXTERIOR])&&v.isTrue(this._matrix[$e.EXTERIOR][$e.INTERIOR])}},{key:"isEquals",value:function(c,d){return c===d&&v.isTrue(this._matrix[$e.INTERIOR][$e.INTERIOR])&&this._matrix[$e.INTERIOR][$e.EXTERIOR]===bt.FALSE&&this._matrix[$e.BOUNDARY][$e.EXTERIOR]===bt.FALSE&&this._matrix[$e.EXTERIOR][$e.INTERIOR]===bt.FALSE&&this._matrix[$e.EXTERIOR][$e.BOUNDARY]===bt.FALSE}},{key:"toString",value:function(){for(var c=new Ai("123456789"),d=0;d<3;d++)for(var _=0;_<3;_++)c.setCharAt(3*d+_,bt.toDimensionSymbol(this._matrix[d][_]));return c.toString()}},{key:"setAll",value:function(c){for(var d=0;d<3;d++)for(var _=0;_<3;_++)this._matrix[d][_]=c}},{key:"get",value:function(c,d){return this._matrix[c][d]}},{key:"transpose",value:function(){var c=this._matrix[1][0];return this._matrix[1][0]=this._matrix[0][1],this._matrix[0][1]=c,c=this._matrix[2][0],this._matrix[2][0]=this._matrix[0][2],this._matrix[0][2]=c,c=this._matrix[2][1],this._matrix[2][1]=this._matrix[1][2],this._matrix[1][2]=c,this}},{key:"matches",value:function(c){if(c.length!==9)throw new ye("Should be length 9: "+c);for(var d=0;d<3;d++)for(var _=0;_<3;_++)if(!v.matches(this._matrix[d][_],c.charAt(3*d+_)))return!1;return!0}},{key:"add",value:function(c){for(var d=0;d<3;d++)for(var _=0;_<3;_++)this.setAtLeast(d,_,c.get(d,_))}},{key:"isDisjoint",value:function(){return this._matrix[$e.INTERIOR][$e.INTERIOR]===bt.FALSE&&this._matrix[$e.INTERIOR][$e.BOUNDARY]===bt.FALSE&&this._matrix[$e.BOUNDARY][$e.INTERIOR]===bt.FALSE&&this._matrix[$e.BOUNDARY][$e.BOUNDARY]===bt.FALSE}},{key:"isCrosses",value:function(c,d){return c===bt.P&&d===bt.L||c===bt.P&&d===bt.A||c===bt.L&&d===bt.A?v.isTrue(this._matrix[$e.INTERIOR][$e.INTERIOR])&&v.isTrue(this._matrix[$e.INTERIOR][$e.EXTERIOR]):c===bt.L&&d===bt.P||c===bt.A&&d===bt.P||c===bt.A&&d===bt.L?v.isTrue(this._matrix[$e.INTERIOR][$e.INTERIOR])&&v.isTrue(this._matrix[$e.EXTERIOR][$e.INTERIOR]):c===bt.L&&d===bt.L&&this._matrix[$e.INTERIOR][$e.INTERIOR]===0}},{key:"interfaces_",get:function(){return[Z]}}],[{key:"constructor_",value:function(){if(this._matrix=null,arguments.length===0)this._matrix=Array(3).fill().map(function(){return Array(3)}),this.setAll(bt.FALSE);else if(arguments.length===1){if(typeof arguments[0]=="string"){var c=arguments[0];v.constructor_.call(this),this.set(c)}else if(arguments[0]instanceof v){var d=arguments[0];v.constructor_.call(this),this._matrix[$e.INTERIOR][$e.INTERIOR]=d._matrix[$e.INTERIOR][$e.INTERIOR],this._matrix[$e.INTERIOR][$e.BOUNDARY]=d._matrix[$e.INTERIOR][$e.BOUNDARY],this._matrix[$e.INTERIOR][$e.EXTERIOR]=d._matrix[$e.INTERIOR][$e.EXTERIOR],this._matrix[$e.BOUNDARY][$e.INTERIOR]=d._matrix[$e.BOUNDARY][$e.INTERIOR],this._matrix[$e.BOUNDARY][$e.BOUNDARY]=d._matrix[$e.BOUNDARY][$e.BOUNDARY],this._matrix[$e.BOUNDARY][$e.EXTERIOR]=d._matrix[$e.BOUNDARY][$e.EXTERIOR],this._matrix[$e.EXTERIOR][$e.INTERIOR]=d._matrix[$e.EXTERIOR][$e.INTERIOR],this._matrix[$e.EXTERIOR][$e.BOUNDARY]=d._matrix[$e.EXTERIOR][$e.BOUNDARY],this._matrix[$e.EXTERIOR][$e.EXTERIOR]=d._matrix[$e.EXTERIOR][$e.EXTERIOR]}}}},{key:"matches",value:function(){if(Number.isInteger(arguments[0])&&typeof arguments[1]=="string"){var c=arguments[0],d=arguments[1];return d===bt.SYM_DONTCARE||d===bt.SYM_TRUE&&(c>=0||c===bt.TRUE)||d===bt.SYM_FALSE&&c===bt.FALSE||d===bt.SYM_P&&c===bt.P||d===bt.SYM_L&&c===bt.L||d===bt.SYM_A&&c===bt.A}if(typeof arguments[0]=="string"&&typeof arguments[1]=="string"){var _=arguments[1];return new v(arguments[0]).matches(_)}}},{key:"isTrue",value:function(c){return c>=0||c===bt.TRUE}}])}(),Us=function(){function v(){h(this,v),v.constructor_.apply(this,arguments)}return o(v,[{key:"size",value:function(){return this._size}},{key:"addAll",value:function(c){return c===null||c.length===0?null:(this.ensureCapacity(this._size+c.length),at.arraycopy(c,0,this._data,this._size,c.length),void(this._size+=c.length))}},{key:"ensureCapacity",value:function(c){if(c<=this._data.length)return null;var d=Math.max(c,2*this._data.length);this._data=Mi.copyOf(this._data,d)}},{key:"toArray",value:function(){var c=new Array(this._size).fill(null);return at.arraycopy(this._data,0,c,0,this._size),c}},{key:"add",value:function(c){this.ensureCapacity(this._size+1),this._data[this._size]=c,++this._size}}],[{key:"constructor_",value:function(){if(this._data=null,this._size=0,arguments.length===0)v.constructor_.call(this,10);else if(arguments.length===1){var c=arguments[0];this._data=new Array(c).fill(null)}}}])}(),gl=function(){function v(){h(this,v)}return o(v,[{key:"getChainStartIndices",value:function(c){var d=0,_=new Us(Math.trunc(c.length/2));_.add(d);do{var S=this.findChainEnd(c,d);_.add(S),d=S}while(d<c.length-1);return _.toArray()}},{key:"findChainEnd",value:function(c,d){for(var _=fi.quadrant(c[d],c[d+1]),S=d+1;S<c.length&&fi.quadrant(c[S-1],c[S])===_;)S++;return S-1}},{key:"OLDgetChainStartIndices",value:function(c){var d=0,_=new me;_.add(d);do{var S=this.findChainEnd(c,d);_.add(S),d=S}while(d<c.length-1);return v.toIntArray(_)}}],[{key:"toIntArray",value:function(c){for(var d=new Array(c.size()).fill(null),_=0;_<d.length;_++)d[_]=c.get(_).intValue();return d}}])}(),us=function(){return o(function v(){h(this,v),v.constructor_.apply(this,arguments)},[{key:"getCoordinates",value:function(){return this.pts}},{key:"getMaxX",value:function(v){var c=this.pts[this.startIndex[v]].x,d=this.pts[this.startIndex[v+1]].x;return c>d?c:d}},{key:"getMinX",value:function(v){var c=this.pts[this.startIndex[v]].x,d=this.pts[this.startIndex[v+1]].x;return c<d?c:d}},{key:"computeIntersectsForChain",value:function(){if(arguments.length===4){var v=arguments[0],c=arguments[1],d=arguments[2],_=arguments[3];this.computeIntersectsForChain(this.startIndex[v],this.startIndex[v+1],c,c.startIndex[d],c.startIndex[d+1],_)}else if(arguments.length===6){var S=arguments[0],N=arguments[1],U=arguments[2],J=arguments[3],ge=arguments[4],Ie=arguments[5];if(N-S==1&&ge-J==1)return Ie.addIntersections(this.e,S,U.e,J),null;if(!this.overlaps(S,N,U,J,ge))return null;var st=Math.trunc((S+N)/2),ht=Math.trunc((J+ge)/2);S<st&&(J<ht&&this.computeIntersectsForChain(S,st,U,J,ht,Ie),ht<ge&&this.computeIntersectsForChain(S,st,U,ht,ge,Ie)),st<N&&(J<ht&&this.computeIntersectsForChain(st,N,U,J,ht,Ie),ht<ge&&this.computeIntersectsForChain(st,N,U,ht,ge,Ie))}}},{key:"overlaps",value:function(v,c,d,_,S){return ii.intersects(this.pts[v],this.pts[c],d.pts[_],d.pts[S])}},{key:"getStartIndexes",value:function(){return this.startIndex}},{key:"computeIntersects",value:function(v,c){for(var d=0;d<this.startIndex.length-1;d++)for(var _=0;_<v.startIndex.length-1;_++)this.computeIntersectsForChain(d,v,_,c)}}],[{key:"constructor_",value:function(){this.e=null,this.pts=null,this.startIndex=null;var v=arguments[0];this.e=v,this.pts=v.getCoordinates();var c=new gl;this.startIndex=c.getChainStartIndices(this.pts)}}])}(),Fa=function(){function v(){h(this,v),v.constructor_.apply(this,arguments)}return o(v,[{key:"getDepth",value:function(c,d){return this._depth[c][d]}},{key:"setDepth",value:function(c,d,_){this._depth[c][d]=_}},{key:"isNull",value:function(){if(arguments.length===0){for(var c=0;c<2;c++)for(var d=0;d<3;d++)if(this._depth[c][d]!==v.NULL_VALUE)return!1;return!0}if(arguments.length===1){var _=arguments[0];return this._depth[_][1]===v.NULL_VALUE}if(arguments.length===2){var S=arguments[0],N=arguments[1];return this._depth[S][N]===v.NULL_VALUE}}},{key:"normalize",value:function(){for(var c=0;c<2;c++)if(!this.isNull(c)){var d=this._depth[c][1];this._depth[c][2]<d&&(d=this._depth[c][2]),d<0&&(d=0);for(var _=1;_<3;_++){var S=0;this._depth[c][_]>d&&(S=1),this._depth[c][_]=S}}}},{key:"getDelta",value:function(c){return this._depth[c][Ot.RIGHT]-this._depth[c][Ot.LEFT]}},{key:"getLocation",value:function(c,d){return this._depth[c][d]<=0?$e.EXTERIOR:$e.INTERIOR}},{key:"toString",value:function(){return"A: "+this._depth[0][1]+","+this._depth[0][2]+" B: "+this._depth[1][1]+","+this._depth[1][2]}},{key:"add",value:function(){if(arguments.length===1)for(var c=arguments[0],d=0;d<2;d++)for(var _=1;_<3;_++){var S=c.getLocation(d,_);S!==$e.EXTERIOR&&S!==$e.INTERIOR||(this.isNull(d,_)?this._depth[d][_]=v.depthAtLocation(S):this._depth[d][_]+=v.depthAtLocation(S))}else if(arguments.length===3){var N=arguments[0],U=arguments[1];arguments[2]===$e.INTERIOR&&this._depth[N][U]++}}}],[{key:"constructor_",value:function(){this._depth=Array(2).fill().map(function(){return Array(3)});for(var c=0;c<2;c++)for(var d=0;d<3;d++)this._depth[c][d]=v.NULL_VALUE}},{key:"depthAtLocation",value:function(c){return c===$e.EXTERIOR?0:c===$e.INTERIOR?1:v.NULL_VALUE}}])}();Fa.NULL_VALUE=-1;var za=function(v){function c(){var d;return h(this,c),d=s(this,c),c.constructor_.apply(d,arguments),d}return F(c,v),o(c,[{key:"getDepth",value:function(){return this._depth}},{key:"getCollapsedEdge",value:function(){var d=new Array(2).fill(null);return d[0]=this.pts[0],d[1]=this.pts[1],new c(d,Pi.toLineLabel(this._label))}},{key:"isIsolated",value:function(){return this._isIsolated}},{key:"getCoordinates",value:function(){return this.pts}},{key:"setIsolated",value:function(d){this._isIsolated=d}},{key:"setName",value:function(d){this._name=d}},{key:"equals",value:function(d){if(!(d instanceof c))return!1;var _=d;if(this.pts.length!==_.pts.length)return!1;for(var S=!0,N=!0,U=this.pts.length,J=0;J<this.pts.length;J++)if(this.pts[J].equals2D(_.pts[J])||(S=!1),this.pts[J].equals2D(_.pts[--U])||(N=!1),!S&&!N)return!1;return!0}},{key:"getCoordinate",value:function(){if(arguments.length===0)return this.pts.length>0?this.pts[0]:null;if(arguments.length===1){var d=arguments[0];return this.pts[d]}}},{key:"print",value:function(d){d.print("edge "+this._name+": "),d.print("LINESTRING (");for(var _=0;_<this.pts.length;_++)_>0&&d.print(","),d.print(this.pts[_].x+" "+this.pts[_].y);d.print(")  "+this._label+" "+this._depthDelta)}},{key:"computeIM",value:function(d){c.updateIM(this._label,d)}},{key:"isCollapsed",value:function(){return!!this._label.isArea()&&this.pts.length===3&&!!this.pts[0].equals(this.pts[2])}},{key:"isClosed",value:function(){return this.pts[0].equals(this.pts[this.pts.length-1])}},{key:"getMaximumSegmentIndex",value:function(){return this.pts.length-1}},{key:"getDepthDelta",value:function(){return this._depthDelta}},{key:"getNumPoints",value:function(){return this.pts.length}},{key:"printReverse",value:function(d){d.print("edge "+this._name+": ");for(var _=this.pts.length-1;_>=0;_--)d.print(this.pts[_]+" ");d.println("")}},{key:"getMonotoneChainEdge",value:function(){return this._mce===null&&(this._mce=new us(this)),this._mce}},{key:"getEnvelope",value:function(){if(this._env===null){this._env=new ii;for(var d=0;d<this.pts.length;d++)this._env.expandToInclude(this.pts[d])}return this._env}},{key:"addIntersection",value:function(d,_,S,N){var U=new lt(d.getIntersection(N)),J=_,ge=d.getEdgeDistance(S,N),Ie=J+1;if(Ie<this.pts.length){var st=this.pts[Ie];U.equals2D(st)&&(J=Ie,ge=0)}this.eiList.add(U,J,ge)}},{key:"toString",value:function(){var d=new Ai;d.append("edge "+this._name+": "),d.append("LINESTRING (");for(var _=0;_<this.pts.length;_++)_>0&&d.append(","),d.append(this.pts[_].x+" "+this.pts[_].y);return d.append(")  "+this._label+" "+this._depthDelta),d.toString()}},{key:"isPointwiseEqual",value:function(d){if(this.pts.length!==d.pts.length)return!1;for(var _=0;_<this.pts.length;_++)if(!this.pts[_].equals2D(d.pts[_]))return!1;return!0}},{key:"setDepthDelta",value:function(d){this._depthDelta=d}},{key:"getEdgeIntersectionList",value:function(){return this.eiList}},{key:"addIntersections",value:function(d,_,S){for(var N=0;N<d.getIntersectionNum();N++)this.addIntersection(d,_,S,N)}}],[{key:"constructor_",value:function(){if(this.pts=null,this._env=null,this.eiList=new Ro(this),this._name=null,this._mce=null,this._isIsolated=!0,this._depth=new Fa,this._depthDelta=0,arguments.length===1){var d=arguments[0];c.constructor_.call(this,d,null)}else if(arguments.length===2){var _=arguments[0],S=arguments[1];this.pts=_,this._label=S}}},{key:"updateIM",value:function(){if(!(arguments.length===2&&arguments[1]instanceof eu&&arguments[0]instanceof Pi))return H(c,"updateIM",this).apply(this,arguments);var d=arguments[0],_=arguments[1];_.setAtLeastIfValid(d.getLocation(0,Ot.ON),d.getLocation(1,Ot.ON),1),d.isArea()&&(_.setAtLeastIfValid(d.getLocation(0,Ot.LEFT),d.getLocation(1,Ot.LEFT),2),_.setAtLeastIfValid(d.getLocation(0,Ot.RIGHT),d.getLocation(1,Ot.RIGHT),2))}}])}(ji),Vs=function(){function v(){h(this,v),v.constructor_.apply(this,arguments)}return o(v,[{key:"setWorkingPrecisionModel",value:function(c){this._workingPrecisionModel=c}},{key:"insertUniqueEdge",value:function(c){var d=this._edgeList.findEqualEdge(c);if(d!==null){var _=d.getLabel(),S=c.getLabel();d.isPointwiseEqual(c)||(S=new Pi(c.getLabel())).flip(),_.merge(S);var N=v.depthDelta(S),U=d.getDepthDelta()+N;d.setDepthDelta(U)}else this._edgeList.add(c),c.setDepthDelta(v.depthDelta(c.getLabel()))}},{key:"buildSubgraphs",value:function(c,d){for(var _=new me,S=c.iterator();S.hasNext();){var N=S.next(),U=N.getRightmostCoordinate(),J=new Co(_).getDepth(U);N.computeDepth(J),N.findResultEdges(),_.add(N),d.add(N.getDirectedEdges(),N.getNodes())}}},{key:"createSubgraphs",value:function(c){for(var d=new me,_=c.getNodes().iterator();_.hasNext();){var S=_.next();if(!S.isVisited()){var N=new Ze;N.create(S),d.add(N)}}return Fn.sort(d,Fn.reverseOrder()),d}},{key:"createEmptyResultGeometry",value:function(){return this._geomFact.createPolygon()}},{key:"getNoder",value:function(c){if(this._workingNoder!==null)return this._workingNoder;var d=new _a,_=new Wt;return _.setPrecisionModel(c),d.setSegmentIntersector(new ba(_)),d}},{key:"buffer",value:function(c,d){var _=this._workingPrecisionModel;_===null&&(_=c.getPrecisionModel()),this._geomFact=c.getFactory();var S=new Da(_,this._bufParams),N=new ra(c,d,S).getCurves();if(N.size()<=0)return this.createEmptyResultGeometry();this.computeNodedEdges(N,_),this._graph=new Dn(new Lo),this._graph.addEdges(this._edgeList.getEdges());var U=this.createSubgraphs(this._graph),J=new pl(this._geomFact);this.buildSubgraphs(U,J);var ge=J.getPolygons();return ge.size()<=0?this.createEmptyResultGeometry():this._geomFact.buildGeometry(ge)}},{key:"computeNodedEdges",value:function(c,d){var _=this.getNoder(d);_.computeNodes(c);for(var S=_.getNodedSubstrings().iterator();S.hasNext();){var N=S.next(),U=N.getCoordinates();if(U.length!==2||!U[0].equals2D(U[1])){var J=N.getData(),ge=new za(N.getCoordinates(),new Pi(J));this.insertUniqueEdge(ge)}}}},{key:"setNoder",value:function(c){this._workingNoder=c}}],[{key:"constructor_",value:function(){this._bufParams=null,this._workingPrecisionModel=null,this._workingNoder=null,this._geomFact=null,this._graph=null,this._edgeList=new Ql;var c=arguments[0];this._bufParams=c}},{key:"depthDelta",value:function(c){var d=c.getLocation(0,Ot.LEFT),_=c.getLocation(0,Ot.RIGHT);return d===$e.INTERIOR&&_===$e.EXTERIOR?1:d===$e.EXTERIOR&&_===$e.INTERIOR?-1:0}},{key:"convertSegStrings",value:function(c){for(var d=new Jr,_=new me;c.hasNext();){var S=c.next(),N=d.createLineString(S.getCoordinates());_.add(N)}return d.buildGeometry(_)}}])}(),yl=function(){function v(){h(this,v),v.constructor_.apply(this,arguments)}return o(v,[{key:"rescale",value:function(){if(Xt(arguments[0],zi))for(var c=arguments[0].iterator();c.hasNext();){var d=c.next();this.rescale(d.getCoordinates())}else if(arguments[0]instanceof Array){for(var _=arguments[0],S=0;S<_.length;S++)_[S].x=_[S].x/this._scaleFactor+this._offsetX,_[S].y=_[S].y/this._scaleFactor+this._offsetY;_.length===2&&_[0].equals2D(_[1])&&at.out.println(_)}}},{key:"scale",value:function(){if(Xt(arguments[0],zi)){for(var c=arguments[0],d=new me(c.size()),_=c.iterator();_.hasNext();){var S=_.next();d.add(new ls(this.scale(S.getCoordinates()),S.getData()))}return d}if(arguments[0]instanceof Array){for(var N=arguments[0],U=new Array(N.length).fill(null),J=0;J<N.length;J++)U[J]=new lt(Math.round((N[J].x-this._offsetX)*this._scaleFactor),Math.round((N[J].y-this._offsetY)*this._scaleFactor),N[J].getZ());return ri.removeRepeatedPoints(U)}}},{key:"isIntegerPrecision",value:function(){return this._scaleFactor===1}},{key:"getNodedSubstrings",value:function(){var c=this._noder.getNodedSubstrings();return this._isScaled&&this.rescale(c),c}},{key:"computeNodes",value:function(c){var d=c;this._isScaled&&(d=this.scale(c)),this._noder.computeNodes(d)}},{key:"interfaces_",get:function(){return[Gs]}}],[{key:"constructor_",value:function(){if(this._noder=null,this._scaleFactor=null,this._offsetX=null,this._offsetY=null,this._isScaled=!1,arguments.length===2){var c=arguments[0],d=arguments[1];v.constructor_.call(this,c,d,0,0)}else if(arguments.length===4){var _=arguments[0],S=arguments[1];this._noder=_,this._scaleFactor=S,this._isScaled=!this.isIntegerPrecision()}}}])}(),sa=function(){function v(){h(this,v),v.constructor_.apply(this,arguments)}return o(v,[{key:"checkEndPtVertexIntersections",value:function(){if(arguments.length===0)for(var c=this._segStrings.iterator();c.hasNext();){var d=c.next().getCoordinates();this.checkEndPtVertexIntersections(d[0],this._segStrings),this.checkEndPtVertexIntersections(d[d.length-1],this._segStrings)}else if(arguments.length===2){for(var _=arguments[0],S=arguments[1].iterator();S.hasNext();)for(var N=S.next().getCoordinates(),U=1;U<N.length-1;U++)if(N[U].equals(_))throw new It("found endpt/interior pt intersection at index "+U+" :pt "+_)}}},{key:"checkInteriorIntersections",value:function(){if(arguments.length===0)for(var c=this._segStrings.iterator();c.hasNext();)for(var d=c.next(),_=this._segStrings.iterator();_.hasNext();){var S=_.next();this.checkInteriorIntersections(d,S)}else if(arguments.length===2)for(var N=arguments[0],U=arguments[1],J=N.getCoordinates(),ge=U.getCoordinates(),Ie=0;Ie<J.length-1;Ie++)for(var st=0;st<ge.length-1;st++)this.checkInteriorIntersections(N,Ie,U,st);else if(arguments.length===4){var ht=arguments[0],Pt=arguments[1],Qt=arguments[2],wi=arguments[3];if(ht===Qt&&Pt===wi)return null;var Ni=ht.getCoordinates()[Pt],_i=ht.getCoordinates()[Pt+1],yi=Qt.getCoordinates()[wi],cr=Qt.getCoordinates()[wi+1];if(this._li.computeIntersection(Ni,_i,yi,cr),this._li.hasIntersection()&&(this._li.isProper()||this.hasInteriorIntersection(this._li,Ni,_i)||this.hasInteriorIntersection(this._li,yi,cr)))throw new It("found non-noded intersection at "+Ni+"-"+_i+" and "+yi+"-"+cr)}}},{key:"checkValid",value:function(){this.checkEndPtVertexIntersections(),this.checkInteriorIntersections(),this.checkCollapses()}},{key:"checkCollapses",value:function(){if(arguments.length===0)for(var c=this._segStrings.iterator();c.hasNext();){var d=c.next();this.checkCollapses(d)}else if(arguments.length===1)for(var _=arguments[0].getCoordinates(),S=0;S<_.length-2;S++)this.checkCollapse(_[S],_[S+1],_[S+2])}},{key:"hasInteriorIntersection",value:function(c,d,_){for(var S=0;S<c.getIntersectionNum();S++){var N=c.getIntersection(S);if(!N.equals(d)&&!N.equals(_))return!0}return!1}},{key:"checkCollapse",value:function(c,d,_){if(c.equals(_))throw new It("found non-noded collapse at "+v.fact.createLineString([c,d,_]))}}],[{key:"constructor_",value:function(){this._li=new Wt,this._segStrings=null;var c=arguments[0];this._segStrings=c}}])}();sa.fact=new Jr;var Ba=function(){function v(){h(this,v),v.constructor_.apply(this,arguments)}return o(v,[{key:"intersectsScaled",value:function(c,d){var _=Math.min(c.x,d.x),S=Math.max(c.x,d.x),N=Math.min(c.y,d.y),U=Math.max(c.y,d.y),J=this._maxx<_||this._minx>S||this._maxy<N||this._miny>U;if(J)return!1;var ge=this.intersectsToleranceSquare(c,d);return zt.isTrue(!(J&&ge),"Found bad envelope test"),ge}},{key:"initCorners",value:function(c){var d=.5;this._minx=c.x-d,this._maxx=c.x+d,this._miny=c.y-d,this._maxy=c.y+d,this._corner[0]=new lt(this._maxx,this._maxy),this._corner[1]=new lt(this._minx,this._maxy),this._corner[2]=new lt(this._minx,this._miny),this._corner[3]=new lt(this._maxx,this._miny)}},{key:"intersects",value:function(c,d){return this._scaleFactor===1?this.intersectsScaled(c,d):(this.copyScaled(c,this._p0Scaled),this.copyScaled(d,this._p1Scaled),this.intersectsScaled(this._p0Scaled,this._p1Scaled))}},{key:"scale",value:function(c){return Math.round(c*this._scaleFactor)}},{key:"getCoordinate",value:function(){return this._originalPt}},{key:"copyScaled",value:function(c,d){d.x=this.scale(c.x),d.y=this.scale(c.y)}},{key:"getSafeEnvelope",value:function(){if(this._safeEnv===null){var c=v.SAFE_ENV_EXPANSION_FACTOR/this._scaleFactor;this._safeEnv=new ii(this._originalPt.x-c,this._originalPt.x+c,this._originalPt.y-c,this._originalPt.y+c)}return this._safeEnv}},{key:"intersectsPixelClosure",value:function(c,d){return this._li.computeIntersection(c,d,this._corner[0],this._corner[1]),!!this._li.hasIntersection()||(this._li.computeIntersection(c,d,this._corner[1],this._corner[2]),!!this._li.hasIntersection()||(this._li.computeIntersection(c,d,this._corner[2],this._corner[3]),!!this._li.hasIntersection()||(this._li.computeIntersection(c,d,this._corner[3],this._corner[0]),!!this._li.hasIntersection())))}},{key:"intersectsToleranceSquare",value:function(c,d){var _=!1,S=!1;return this._li.computeIntersection(c,d,this._corner[0],this._corner[1]),!!this._li.isProper()||(this._li.computeIntersection(c,d,this._corner[1],this._corner[2]),!!this._li.isProper()||(this._li.hasIntersection()&&(_=!0),this._li.computeIntersection(c,d,this._corner[2],this._corner[3]),!!this._li.isProper()||(this._li.hasIntersection()&&(S=!0),this._li.computeIntersection(c,d,this._corner[3],this._corner[0]),!!this._li.isProper()||!(!_||!S)||!!c.equals(this._pt)||!!d.equals(this._pt))))}},{key:"addSnappedNode",value:function(c,d){var _=c.getCoordinate(d),S=c.getCoordinate(d+1);return!!this.intersects(_,S)&&(c.addIntersection(this.getCoordinate(),d),!0)}}],[{key:"constructor_",value:function(){this._li=null,this._pt=null,this._originalPt=null,this._ptScaled=null,this._p0Scaled=null,this._p1Scaled=null,this._scaleFactor=null,this._minx=null,this._maxx=null,this._miny=null,this._maxy=null,this._corner=new Array(4).fill(null),this._safeEnv=null;var c=arguments[0],d=arguments[1],_=arguments[2];if(this._originalPt=c,this._pt=c,this._scaleFactor=d,this._li=_,d<=0)throw new ye("Scale factor must be non-zero");d!==1&&(this._pt=new lt(this.scale(c.x),this.scale(c.y)),this._p0Scaled=new lt,this._p1Scaled=new lt),this.initCorners(this._pt)}}])}();Ba.SAFE_ENV_EXPANSION_FACTOR=.75;var _l=function(){return o(function v(){h(this,v),v.constructor_.apply(this,arguments)},[{key:"select",value:function(){if(arguments.length!==1&&arguments.length===2){var v=arguments[1];arguments[0].getLineSegment(v,this.selectedSegment),this.select(this.selectedSegment)}}}],[{key:"constructor_",value:function(){this.selectedSegment=new Fr}}])}(),No=function(){return o(function v(){h(this,v),v.constructor_.apply(this,arguments)},[{key:"snap",value:function(){if(arguments.length===1){var v=arguments[0];return this.snap(v,null,-1)}if(arguments.length===3){var c=arguments[0],d=arguments[1],_=arguments[2],S=c.getSafeEnvelope(),N=new $a(c,d,_);return this._index.query(S,new(function(){return o(function U(){h(this,U)},[{key:"interfaces_",get:function(){return[fo]}},{key:"visitItem",value:function(U){U.select(S,N)}}])}())),N.isNodeAdded()}}}],[{key:"constructor_",value:function(){this._index=null;var v=arguments[0];this._index=v}}])}(),$a=function(v){function c(){var d;return h(this,c),d=s(this,c),c.constructor_.apply(d,arguments),d}return F(c,v),o(c,[{key:"isNodeAdded",value:function(){return this._isNodeAdded}},{key:"select",value:function(){if(!(arguments.length===2&&Number.isInteger(arguments[1])&&arguments[0]instanceof Qo))return H(c,"select",this,1).apply(this,arguments);var d=arguments[1],_=arguments[0].getContext();if(this._parentEdge===_&&(d===this._hotPixelVertexIndex||d+1===this._hotPixelVertexIndex))return null;this._isNodeAdded|=this._hotPixel.addSnappedNode(_,d)}}],[{key:"constructor_",value:function(){this._hotPixel=null,this._parentEdge=null,this._hotPixelVertexIndex=null,this._isNodeAdded=!1;var d=arguments[0],_=arguments[1],S=arguments[2];this._hotPixel=d,this._parentEdge=_,this._hotPixelVertexIndex=S}}])}(_l);No.HotPixelSnapAction=$a;var tu=function(){return o(function v(){h(this,v),v.constructor_.apply(this,arguments)},[{key:"processIntersections",value:function(v,c,d,_){if(v===d&&c===_)return null;var S=v.getCoordinates()[c],N=v.getCoordinates()[c+1],U=d.getCoordinates()[_],J=d.getCoordinates()[_+1];if(this._li.computeIntersection(S,N,U,J),this._li.hasIntersection()&&this._li.isInteriorIntersection()){for(var ge=0;ge<this._li.getIntersectionNum();ge++)this._interiorIntersections.add(this._li.getIntersection(ge));v.addIntersections(this._li,c,0),d.addIntersections(this._li,_,1)}}},{key:"isDone",value:function(){return!1}},{key:"getInteriorIntersections",value:function(){return this._interiorIntersections}},{key:"interfaces_",get:function(){return[ml]}}],[{key:"constructor_",value:function(){this._li=null,this._interiorIntersections=null;var v=arguments[0];this._li=v,this._interiorIntersections=new me}}])}(),ot=function(){return o(function v(){h(this,v),v.constructor_.apply(this,arguments)},[{key:"checkCorrectness",value:function(v){var c=ls.getNodedSubstrings(v),d=new sa(c);try{d.checkValid()}catch(_){if(!(_ instanceof ne))throw _;_.printStackTrace()}}},{key:"getNodedSubstrings",value:function(){return ls.getNodedSubstrings(this._nodedSegStrings)}},{key:"snapRound",value:function(v,c){var d=this.findInteriorIntersections(v,c);this.computeIntersectionSnaps(d),this.computeVertexSnaps(v)}},{key:"findInteriorIntersections",value:function(v,c){var d=new tu(c);return this._noder.setSegmentIntersector(d),this._noder.computeNodes(v),d.getInteriorIntersections()}},{key:"computeVertexSnaps",value:function(){if(Xt(arguments[0],zi))for(var v=arguments[0].iterator();v.hasNext();){var c=v.next();this.computeVertexSnaps(c)}else if(arguments[0]instanceof ls)for(var d=arguments[0],_=d.getCoordinates(),S=0;S<_.length;S++){var N=new Ba(_[S],this._scaleFactor,this._li);this._pointSnapper.snap(N,d,S)&&d.addIntersection(_[S],S)}}},{key:"computeNodes",value:function(v){this._nodedSegStrings=v,this._noder=new _a,this._pointSnapper=new No(this._noder.getIndex()),this.snapRound(v,this._li)}},{key:"computeIntersectionSnaps",value:function(v){for(var c=v.iterator();c.hasNext();){var d=c.next(),_=new Ba(d,this._scaleFactor,this._li);this._pointSnapper.snap(_)}}},{key:"interfaces_",get:function(){return[Gs]}}],[{key:"constructor_",value:function(){this._pm=null,this._li=null,this._scaleFactor=null,this._noder=null,this._pointSnapper=null,this._nodedSegStrings=null;var v=arguments[0];this._pm=v,this._li=new Wt,this._li.setPrecisionModel(v),this._scaleFactor=v.getScale()}}])}(),ut=function(){function v(){h(this,v),v.constructor_.apply(this,arguments)}return o(v,[{key:"bufferFixedPrecision",value:function(c){var d=new yl(new ot(new qi(1)),c.getScale()),_=new Vs(this._bufParams);_.setWorkingPrecisionModel(c),_.setNoder(d),this._resultGeometry=_.buffer(this._argGeom,this._distance)}},{key:"bufferReducedPrecision",value:function(){if(arguments.length===0){for(var c=v.MAX_PRECISION_DIGITS;c>=0;c--){try{this.bufferReducedPrecision(c)}catch(N){if(!(N instanceof le))throw N;this._saveException=N}if(this._resultGeometry!==null)return null}throw this._saveException}if(arguments.length===1){var d=arguments[0],_=v.precisionScaleFactor(this._argGeom,this._distance,d),S=new qi(_);this.bufferFixedPrecision(S)}}},{key:"computeGeometry",value:function(){if(this.bufferOriginalPrecision(),this._resultGeometry!==null)return null;var c=this._argGeom.getFactory().getPrecisionModel();c.getType()===qi.FIXED?this.bufferFixedPrecision(c):this.bufferReducedPrecision()}},{key:"setQuadrantSegments",value:function(c){this._bufParams.setQuadrantSegments(c)}},{key:"bufferOriginalPrecision",value:function(){try{var c=new Vs(this._bufParams);this._resultGeometry=c.buffer(this._argGeom,this._distance)}catch(d){if(!(d instanceof It))throw d;this._saveException=d}}},{key:"getResultGeometry",value:function(c){return this._distance=c,this.computeGeometry(),this._resultGeometry}},{key:"setEndCapStyle",value:function(c){this._bufParams.setEndCapStyle(c)}}],[{key:"constructor_",value:function(){if(this._argGeom=null,this._distance=null,this._bufParams=new K,this._resultGeometry=null,this._saveException=null,arguments.length===1){var c=arguments[0];this._argGeom=c}else if(arguments.length===2){var d=arguments[0],_=arguments[1];this._argGeom=d,this._bufParams=_}}},{key:"bufferOp",value:function(){if(arguments.length===2){var c=arguments[1];return new v(arguments[0]).getResultGeometry(c)}if(arguments.length===3){if(Number.isInteger(arguments[2])&&arguments[0]instanceof Jt&&typeof arguments[1]=="number"){var d=arguments[1],_=arguments[2],S=new v(arguments[0]);return S.setQuadrantSegments(_),S.getResultGeometry(d)}if(arguments[2]instanceof K&&arguments[0]instanceof Jt&&typeof arguments[1]=="number"){var N=arguments[1];return new v(arguments[0],arguments[2]).getResultGeometry(N)}}else if(arguments.length===4){var U=arguments[1],J=arguments[2],ge=arguments[3],Ie=new v(arguments[0]);return Ie.setQuadrantSegments(J),Ie.setEndCapStyle(ge),Ie.getResultGeometry(U)}}},{key:"precisionScaleFactor",value:function(c,d,_){var S=c.getEnvelopeInternal(),N=He.max(Math.abs(S.getMaxX()),Math.abs(S.getMaxY()),Math.abs(S.getMinX()),Math.abs(S.getMinY()))+2*(d>0?d:0),U=_-Math.trunc(Math.log(N)/Math.log(10)+1);return Math.pow(10,U)}}])}();ut.CAP_ROUND=K.CAP_ROUND,ut.CAP_BUTT=K.CAP_FLAT,ut.CAP_FLAT=K.CAP_FLAT,ut.CAP_SQUARE=K.CAP_SQUARE,ut.MAX_PRECISION_DIGITS=12;var Kt=["Point","MultiPoint","LineString","MultiLineString","Polygon","MultiPolygon"],bi=function(){return o(function v(c){h(this,v),this.geometryFactory=c||new Jr},[{key:"read",value:function(v){var c,d=(c=typeof v=="string"?JSON.parse(v):v).type;if(!ir[d])throw new Error("Unknown GeoJSON type: "+c.type);return Kt.indexOf(d)!==-1?ir[d].call(this,c.coordinates):d==="GeometryCollection"?ir[d].call(this,c.geometries):ir[d].call(this,c)}},{key:"write",value:function(v){var c=v.getGeometryType();if(!Zi[c])throw new Error("Geometry is not supported");return Zi[c].call(this,v)}}])}(),ir={Feature:function(v){var c={};for(var d in v)c[d]=v[d];if(v.geometry){var _=v.geometry.type;if(!ir[_])throw new Error("Unknown GeoJSON type: "+v.type);c.geometry=this.read(v.geometry)}return v.bbox&&(c.bbox=ir.bbox.call(this,v.bbox)),c},FeatureCollection:function(v){var c={};if(v.features){c.features=[];for(var d=0;d<v.features.length;++d)c.features.push(this.read(v.features[d]))}return v.bbox&&(c.bbox=this.parse.bbox.call(this,v.bbox)),c},coordinates:function(v){for(var c=[],d=0;d<v.length;++d){var _=v[d];c.push(x(lt,ve(_)))}return c},bbox:function(v){return this.geometryFactory.createLinearRing([new lt(v[0],v[1]),new lt(v[2],v[1]),new lt(v[2],v[3]),new lt(v[0],v[3]),new lt(v[0],v[1])])},Point:function(v){var c=x(lt,ve(v));return this.geometryFactory.createPoint(c)},MultiPoint:function(v){for(var c=[],d=0;d<v.length;++d)c.push(ir.Point.call(this,v[d]));return this.geometryFactory.createMultiPoint(c)},LineString:function(v){var c=ir.coordinates.call(this,v);return this.geometryFactory.createLineString(c)},MultiLineString:function(v){for(var c=[],d=0;d<v.length;++d)c.push(ir.LineString.call(this,v[d]));return this.geometryFactory.createMultiLineString(c)},Polygon:function(v){for(var c=ir.coordinates.call(this,v[0]),d=this.geometryFactory.createLinearRing(c),_=[],S=1;S<v.length;++S){var N=v[S],U=ir.coordinates.call(this,N),J=this.geometryFactory.createLinearRing(U);_.push(J)}return this.geometryFactory.createPolygon(d,_)},MultiPolygon:function(v){for(var c=[],d=0;d<v.length;++d){var _=v[d];c.push(ir.Polygon.call(this,_))}return this.geometryFactory.createMultiPolygon(c)},GeometryCollection:function(v){for(var c=[],d=0;d<v.length;++d){var _=v[d];c.push(this.read(_))}return this.geometryFactory.createGeometryCollection(c)}},Zi={coordinate:function(v){var c=[v.x,v.y];return v.z&&c.push(v.z),v.m&&c.push(v.m),c},Point:function(v){return{type:"Point",coordinates:Zi.coordinate.call(this,v.getCoordinate())}},MultiPoint:function(v){for(var c=[],d=0;d<v._geometries.length;++d){var _=v._geometries[d],S=Zi.Point.call(this,_);c.push(S.coordinates)}return{type:"MultiPoint",coordinates:c}},LineString:function(v){for(var c=[],d=v.getCoordinates(),_=0;_<d.length;++_){var S=d[_];c.push(Zi.coordinate.call(this,S))}return{type:"LineString",coordinates:c}},MultiLineString:function(v){for(var c=[],d=0;d<v._geometries.length;++d){var _=v._geometries[d],S=Zi.LineString.call(this,_);c.push(S.coordinates)}return{type:"MultiLineString",coordinates:c}},Polygon:function(v){var c=[],d=Zi.LineString.call(this,v._shell);c.push(d.coordinates);for(var _=0;_<v._holes.length;++_){var S=v._holes[_],N=Zi.LineString.call(this,S);c.push(N.coordinates)}return{type:"Polygon",coordinates:c}},MultiPolygon:function(v){for(var c=[],d=0;d<v._geometries.length;++d){var _=v._geometries[d],S=Zi.Polygon.call(this,_);c.push(S.coordinates)}return{type:"MultiPolygon",coordinates:c}},GeometryCollection:function(v){for(var c=[],d=0;d<v._geometries.length;++d){var _=v._geometries[d],S=_.getGeometryType();c.push(Zi[S].call(this,_))}return{type:"GeometryCollection",geometries:c}}};return{BufferOp:ut,GeoJSONReader:function(){return o(function v(c){h(this,v),this.parser=new bi(c||new Jr)},[{key:"read",value:function(v){return this.parser.read(v)}}])}(),GeoJSONWriter:function(){return o(function v(){h(this,v),this.parser=new bi(this.geometryFactory)},[{key:"write",value:function(v){return this.parser.write(v)}}])}()}})}(qf)),qf.exports}var cD=uD();const hD=l_(cD);function Du(){return new Em}function Em(){this.reset()}Em.prototype={constructor:Em,reset:function(){this.s=this.t=0},add:function(r){A1(Cf,r,this.t),A1(this,Cf.s,this.s),this.s?this.t+=Cf.t:this.s=Cf.t},valueOf:function(){return this.s}};var Cf=new Em;function A1(r,e,i){var s=r.s=e+i,h=s-e,x=s-h;r.t=e-x+(i-h)}Du();Du();Du();function HT(r,e){function i(s,h){return s=r(s,h),e(s[0],s[1])}return r.invert&&e.invert&&(i.invert=function(s,h){return s=e.invert(s,h),s&&r.invert(s[0],s[1])}),i}var un=1e-6,Nr=Math.PI,ol=Nr/2,L1=Nr/4,cl=Nr*2,xu=180/Nr,ga=Nr/180,Ss=Math.abs,dD=Math.atan,bh=Math.atan2,Rn=Math.cos,Nn=Math.sin,Ph=Math.sqrt;function KT(r){return r>1?0:r<-1?Nr:Math.acos(r)}function _c(r){return r>1?ol:r<-1?-ol:Math.asin(r)}function i_(r,e){return[r>Nr?r-cl:r<-Nr?r+cl:r,e]}i_.invert=i_;function pD(r,e,i){return(r%=cl)?e||i?HT(N1(r),O1(e,i)):N1(r):e||i?O1(e,i):i_}function R1(r){return function(e,i){return e+=r,[e>Nr?e-cl:e<-Nr?e+cl:e,i]}}function N1(r){var e=R1(r);return e.invert=R1(-r),e}function O1(r,e){var i=Rn(r),s=Nn(r),h=Rn(e),x=Nn(e);function m(o,P){var L=Rn(P),D=Rn(o)*L,F=Nn(o)*L,Y=Nn(P),V=Y*i+D*s;return[bh(F*h-V*x,D*i-Y*s),_c(V*h+F*x)]}return m.invert=function(o,P){var L=Rn(P),D=Rn(o)*L,F=Nn(o)*L,Y=Nn(P),V=Y*h-F*x;return[bh(F*h+Y*x,D*i+V*s),_c(V*i-D*s)]},m}function JT(r,e){return r<e?-1:r>e?1:r>=e?0:NaN}function fD(r){return r.length===1&&(r=mD(r)),{left:function(e,i,s,h){for(s==null&&(s=0),h==null&&(h=e.length);s<h;){var x=s+h>>>1;r(e[x],i)<0?s=x+1:h=x}return s},right:function(e,i,s,h){for(s==null&&(s=0),h==null&&(h=e.length);s<h;){var x=s+h>>>1;r(e[x],i)>0?h=x:s=x+1}return s}}}function mD(r){return function(e,i){return JT(r(e),i)}}fD(JT);function r_(r){return[bh(r[1],r[0]),_c(r[2])]}function wh(r){var e=r[0],i=r[1],s=Rn(i);return[s*Rn(e),s*Nn(e),Nn(i)]}function Af(r,e){return r[0]*e[0]+r[1]*e[1]+r[2]*e[2]}function Im(r,e){return[r[1]*e[2]-r[2]*e[1],r[2]*e[0]-r[0]*e[2],r[0]*e[1]-r[1]*e[0]]}function vy(r,e){r[0]+=e[0],r[1]+=e[1],r[2]+=e[2]}function Lf(r,e){return[r[0]*e,r[1]*e,r[2]*e]}function n_(r){var e=Ph(r[0]*r[0]+r[1]*r[1]+r[2]*r[2]);r[0]/=e,r[1]/=e,r[2]/=e}var xy=Du();function gD(r,e){var i=e[0],s=e[1],h=[Nn(i),-Rn(i),0],x=0,m=0;xy.reset();for(var o=0,P=r.length;o<P;++o)if(D=(L=r[o]).length)for(var L,D,F=L[D-1],Y=F[0],V=F[1]/2+L1,H=Nn(V),ve=Rn(V),_e=0;_e<D;++_e,Y=fe,H=ne,ve=ye,F=oe){var oe=L[_e],fe=oe[0],K=oe[1]/2+L1,ne=Nn(K),ye=Rn(K),Re=fe-Y,Se=Re>=0?1:-1,Z=Se*Re,$=Z>Nr,Q=H*ne;if(xy.add(bh(Q*Se*Nn(Z),ve*ye+Q*Rn(Z))),x+=$?Re+Se*cl:Re,$^Y>=i^fe>=i){var ue=Im(wh(F),wh(oe));n_(ue);var he=Im(h,ue);n_(he);var Pe=($^Re>=0?-1:1)*_c(he[2]);(s>Pe||s===Pe&&(ue[0]||ue[1]))&&(m+=$^Re>=0?1:-1)}}return(x<-un||x<un&&xy<-un)^m&1}Du();Du();Du();Du();function QT(r){return function(e){var i=new s_;for(var s in r)i[s]=r[s];return i.stream=e,i}}function s_(){}s_.prototype={constructor:s_,point:function(r,e){this.stream.point(r,e)},sphere:function(){this.stream.sphere()},lineStart:function(){this.stream.lineStart()},lineEnd:function(){this.stream.lineEnd()},polygonStart:function(){this.stream.polygonStart()},polygonEnd:function(){this.stream.polygonEnd()}};function e2(r){return function(e,i){var s=Rn(e),h=Rn(i),x=r(s*h);return[x*h*Nn(e),x*Nn(i)]}}function t2(r){return function(e,i){var s=Ph(e*e+i*i),h=r(s),x=Nn(h),m=Rn(h);return[bh(e*x,s*m),_c(s&&i*x/s)]}}var yD=e2(function(r){return Ph(2/(1+r))});yD.invert=t2(function(r){return 2*_c(r/2)});function Od(){}function i2(){var r=[],e;return{point:function(i,s){e.push([i,s])},lineStart:function(){r.push(e=[])},lineEnd:Od,rejoin:function(){r.length>1&&r.push(r.pop().concat(r.shift()))},result:function(){var i=r;return r=[],e=null,i}}}function Zf(r,e){return Ss(r[0]-e[0])<un&&Ss(r[1]-e[1])<un}function Rf(r,e,i,s){this.x=r,this.z=e,this.o=i,this.e=s,this.v=!1,this.n=this.p=null}function r2(r,e,i,s,h){var x=[],m=[],o,P;if(r.forEach(function(H){if(!((ve=H.length-1)<=0)){var ve,_e=H[0],oe=H[ve],fe;if(Zf(_e,oe)){for(h.lineStart(),o=0;o<ve;++o)h.point((_e=H[o])[0],_e[1]);h.lineEnd();return}x.push(fe=new Rf(_e,H,null,!0)),m.push(fe.o=new Rf(_e,null,fe,!1)),x.push(fe=new Rf(oe,H,null,!1)),m.push(fe.o=new Rf(oe,null,fe,!0))}}),!!x.length){for(m.sort(e),D1(x),D1(m),o=0,P=m.length;o<P;++o)m[o].e=i=!i;for(var L=x[0],D,F;;){for(var Y=L,V=!0;Y.v;)if((Y=Y.n)===L)return;D=Y.z,h.lineStart();do{if(Y.v=Y.o.v=!0,Y.e){if(V)for(o=0,P=D.length;o<P;++o)h.point((F=D[o])[0],F[1]);else s(Y.x,Y.n.x,1,h);Y=Y.n}else{if(V)for(D=Y.p.z,o=D.length-1;o>=0;--o)h.point((F=D[o])[0],F[1]);else s(Y.x,Y.p.x,-1,h);Y=Y.p}Y=Y.o,D=Y.z,V=!V}while(!Y.v);h.lineEnd()}}}function D1(r){if(e=r.length){for(var e,i=0,s=r[0],h;++i<e;)s.n=h=r[i],h.p=s,s=h;s.n=h=r[0],h.p=s}}function n2(r){for(var e=r.length,i,s=-1,h=0,x,m;++s<e;)h+=r[s].length;for(x=new Array(h);--e>=0;)for(m=r[e],i=m.length;--i>=0;)x[--h]=m[i];return x}function s2(r,e,i,s){return function(h,x){var m=e(x),o=h.invert(s[0],s[1]),P=i2(),L=e(P),D=!1,F,Y,V,H={point:ve,lineStart:oe,lineEnd:fe,polygonStart:function(){H.point=K,H.lineStart=ne,H.lineEnd=ye,Y=[],F=[]},polygonEnd:function(){H.point=ve,H.lineStart=oe,H.lineEnd=fe,Y=n2(Y);var Re=gD(F,o);Y.length?(D||(x.polygonStart(),D=!0),r2(Y,vD,Re,i,x)):Re&&(D||(x.polygonStart(),D=!0),x.lineStart(),i(null,null,1,x),x.lineEnd()),D&&(x.polygonEnd(),D=!1),Y=F=null},sphere:function(){x.polygonStart(),x.lineStart(),i(null,null,1,x),x.lineEnd(),x.polygonEnd()}};function ve(Re,Se){var Z=h(Re,Se);r(Re=Z[0],Se=Z[1])&&x.point(Re,Se)}function _e(Re,Se){var Z=h(Re,Se);m.point(Z[0],Z[1])}function oe(){H.point=_e,m.lineStart()}function fe(){H.point=ve,m.lineEnd()}function K(Re,Se){V.push([Re,Se]);var Z=h(Re,Se);L.point(Z[0],Z[1])}function ne(){L.lineStart(),V=[]}function ye(){K(V[0][0],V[0][1]),L.lineEnd();var Re=L.clean(),Se=P.result(),Z,$=Se.length,Q,ue,he;if(V.pop(),F.push(V),V=null,!!$){if(Re&1){if(ue=Se[0],(Q=ue.length-1)>0){for(D||(x.polygonStart(),D=!0),x.lineStart(),Z=0;Z<Q;++Z)x.point((he=ue[Z])[0],he[1]);x.lineEnd()}return}$>1&&Re&2&&Se.push(Se.pop().concat(Se.shift())),Y.push(Se.filter(_D))}}return H}}function _D(r){return r.length>1}function vD(r,e){return((r=r.x)[0]<0?r[1]-ol-un:ol-r[1])-((e=e.x)[0]<0?e[1]-ol-un:ol-e[1])}const F1=s2(function(){return!0},xD,wD,[-Nr,-ol]);function xD(r){var e=NaN,i=NaN,s=NaN,h;return{lineStart:function(){r.lineStart(),h=1},point:function(x,m){var o=x>0?Nr:-Nr,P=Ss(x-e);Ss(P-Nr)<un?(r.point(e,i=(i+m)/2>0?ol:-ol),r.point(s,i),r.lineEnd(),r.lineStart(),r.point(o,i),r.point(x,i),h=0):s!==o&&P>=Nr&&(Ss(e-s)<un&&(e-=s*un),Ss(x-o)<un&&(x-=o*un),i=bD(e,i,x,m),r.point(s,i),r.lineEnd(),r.lineStart(),r.point(o,i),h=0),r.point(e=x,i=m),s=o},lineEnd:function(){r.lineEnd(),e=i=NaN},clean:function(){return 2-h}}}function bD(r,e,i,s){var h,x,m=Nn(r-i);return Ss(m)>un?dD((Nn(e)*(x=Rn(s))*Nn(i)-Nn(s)*(h=Rn(e))*Nn(r))/(h*x*m)):(e+s)/2}function wD(r,e,i,s){var h;if(r==null)h=i*ol,s.point(-Nr,h),s.point(0,h),s.point(Nr,h),s.point(Nr,0),s.point(Nr,-h),s.point(0,-h),s.point(-Nr,-h),s.point(-Nr,0),s.point(-Nr,h);else if(Ss(r[0]-e[0])>un){var x=r[0]<e[0]?Nr:-Nr;h=i*x/2,s.point(-x,h),s.point(0,h),s.point(x,h)}else s.point(e[0],e[1])}function TD(r,e,i,s,h,x){if(i){var m=Rn(e),o=Nn(e),P=s*i;h==null?(h=e+s*cl,x=e-P/2):(h=z1(m,h),x=z1(m,x),(s>0?h<x:h>x)&&(h+=s*cl));for(var L,D=h;s>0?D>x:D<x;D-=P)L=r_([m,-o*Rn(D),-o*Nn(D)]),r.point(L[0],L[1])}}function z1(r,e){e=wh(e),e[0]-=r,n_(e);var i=KT(-e[1]);return((-e[2]<0?-i:i)+cl-un)%cl}function ED(r,e){var i=Rn(r),s=i>0,h=Ss(i)>un;function x(D,F,Y,V){TD(V,r,e,Y,D,F)}function m(D,F){return Rn(D)*Rn(F)>i}function o(D){var F,Y,V,H,ve;return{lineStart:function(){H=V=!1,ve=1},point:function(_e,oe){var fe=[_e,oe],K,ne=m(_e,oe),ye=s?ne?0:L(_e,oe):ne?L(_e+(_e<0?Nr:-Nr),oe):0;if(!F&&(H=V=ne)&&D.lineStart(),ne!==V&&(K=P(F,fe),(!K||Zf(F,K)||Zf(fe,K))&&(fe[0]+=un,fe[1]+=un,ne=m(fe[0],fe[1]))),ne!==V)ve=0,ne?(D.lineStart(),K=P(fe,F),D.point(K[0],K[1])):(K=P(F,fe),D.point(K[0],K[1]),D.lineEnd()),F=K;else if(h&&F&&s^ne){var Re;!(ye&Y)&&(Re=P(fe,F,!0))&&(ve=0,s?(D.lineStart(),D.point(Re[0][0],Re[0][1]),D.point(Re[1][0],Re[1][1]),D.lineEnd()):(D.point(Re[1][0],Re[1][1]),D.lineEnd(),D.lineStart(),D.point(Re[0][0],Re[0][1])))}ne&&(!F||!Zf(F,fe))&&D.point(fe[0],fe[1]),F=fe,V=ne,Y=ye},lineEnd:function(){V&&D.lineEnd(),F=null},clean:function(){return ve|(H&&V)<<1}}}function P(D,F,Y){var V=wh(D),H=wh(F),ve=[1,0,0],_e=Im(V,H),oe=Af(_e,_e),fe=_e[0],K=oe-fe*fe;if(!K)return!Y&&D;var ne=i*oe/K,ye=-i*fe/K,Re=Im(ve,_e),Se=Lf(ve,ne),Z=Lf(_e,ye);vy(Se,Z);var $=Re,Q=Af(Se,$),ue=Af($,$),he=Q*Q-ue*(Af(Se,Se)-1);if(!(he<0)){var Pe=Ph(he),Ae=Lf($,(-Q-Pe)/ue);if(vy(Ae,Se),Ae=r_(Ae),!Y)return Ae;var ke=D[0],Be=F[0],Ke=D[1],tt=F[1],pt;Be<ke&&(pt=ke,ke=Be,Be=pt);var vt=Be-ke,Ft=Ss(vt-Nr)<un,It=Ft||vt<un;if(!Ft&&tt<Ke&&(pt=Ke,Ke=tt,tt=pt),It?Ft?Ke+tt>0^Ae[1]<(Ss(Ae[0]-ke)<un?Ke:tt):Ke<=Ae[1]&&Ae[1]<=tt:vt>Nr^(ke<=Ae[0]&&Ae[0]<=Be)){var Zt=Lf($,(-Q+Pe)/ue);return vy(Zt,Se),[Ae,r_(Zt)]}}}function L(D,F){var Y=s?r:Nr-r,V=0;return D<-Y?V|=1:D>Y&&(V|=2),F<-Y?V|=4:F>Y&&(V|=8),V}return s2(m,o,x,s?[0,-r]:[-Nr,r-Nr])}function ID(r,e,i,s,h,x){var m=r[0],o=r[1],P=e[0],L=e[1],D=0,F=1,Y=P-m,V=L-o,H;if(H=i-m,!(!Y&&H>0)){if(H/=Y,Y<0){if(H<D)return;H<F&&(F=H)}else if(Y>0){if(H>F)return;H>D&&(D=H)}if(H=h-m,!(!Y&&H<0)){if(H/=Y,Y<0){if(H>F)return;H>D&&(D=H)}else if(Y>0){if(H<D)return;H<F&&(F=H)}if(H=s-o,!(!V&&H>0)){if(H/=V,V<0){if(H<D)return;H<F&&(F=H)}else if(V>0){if(H>F)return;H>D&&(D=H)}if(H=x-o,!(!V&&H<0)){if(H/=V,V<0){if(H>F)return;H>D&&(D=H)}else if(V>0){if(H<D)return;H<F&&(F=H)}return D>0&&(r[0]=m+D*Y,r[1]=o+D*V),F<1&&(e[0]=m+F*Y,e[1]=o+F*V),!0}}}}}var Dd=1e9,Nf=-Dd;function SD(r,e,i,s){function h(L,D){return r<=L&&L<=i&&e<=D&&D<=s}function x(L,D,F,Y){var V=0,H=0;if(L==null||(V=m(L,F))!==(H=m(D,F))||P(L,D)<0^F>0)do Y.point(V===0||V===3?r:i,V>1?s:e);while((V=(V+F+4)%4)!==H);else Y.point(D[0],D[1])}function m(L,D){return Ss(L[0]-r)<un?D>0?0:3:Ss(L[0]-i)<un?D>0?2:1:Ss(L[1]-e)<un?D>0?1:0:D>0?3:2}function o(L,D){return P(L.x,D.x)}function P(L,D){var F=m(L,1),Y=m(D,1);return F!==Y?F-Y:F===0?D[1]-L[1]:F===1?L[0]-D[0]:F===2?L[1]-D[1]:D[0]-L[0]}return function(L){var D=L,F=i2(),Y,V,H,ve,_e,oe,fe,K,ne,ye,Re,Se={point:Z,lineStart:he,lineEnd:Pe,polygonStart:Q,polygonEnd:ue};function Z(ke,Be){h(ke,Be)&&D.point(ke,Be)}function $(){for(var ke=0,Be=0,Ke=V.length;Be<Ke;++Be)for(var tt=V[Be],pt=1,vt=tt.length,Ft=tt[0],It,Zt,zt=Ft[0],ti=Ft[1];pt<vt;++pt)It=zt,Zt=ti,Ft=tt[pt],zt=Ft[0],ti=Ft[1],Zt<=s?ti>s&&(zt-It)*(s-Zt)>(ti-Zt)*(r-It)&&++ke:ti<=s&&(zt-It)*(s-Zt)<(ti-Zt)*(r-It)&&--ke;return ke}function Q(){D=F,Y=[],V=[],Re=!0}function ue(){var ke=$(),Be=Re&&ke,Ke=(Y=n2(Y)).length;(Be||Ke)&&(L.polygonStart(),Be&&(L.lineStart(),x(null,null,1,L),L.lineEnd()),Ke&&r2(Y,o,ke,x,L),L.polygonEnd()),D=L,Y=V=H=null}function he(){Se.point=Ae,V&&V.push(H=[]),ye=!0,ne=!1,fe=K=NaN}function Pe(){Y&&(Ae(ve,_e),oe&&ne&&F.rejoin(),Y.push(F.result())),Se.point=Z,ne&&D.lineEnd()}function Ae(ke,Be){var Ke=h(ke,Be);if(V&&H.push([ke,Be]),ye)ve=ke,_e=Be,oe=Ke,ye=!1,Ke&&(D.lineStart(),D.point(ke,Be));else if(Ke&&ne)D.point(ke,Be);else{var tt=[fe=Math.max(Nf,Math.min(Dd,fe)),K=Math.max(Nf,Math.min(Dd,K))],pt=[ke=Math.max(Nf,Math.min(Dd,ke)),Be=Math.max(Nf,Math.min(Dd,Be))];ID(tt,pt,r,e,i,s)?(ne||(D.lineStart(),D.point(tt[0],tt[1])),D.point(pt[0],pt[1]),Ke||D.lineEnd(),Re=!1):Ke&&(D.lineStart(),D.point(ke,Be),Re=!1)}fe=ke,K=Be,ne=Ke}return Se}}function B1(r){return r}function Sm(r,e){r&&j1.hasOwnProperty(r.type)&&j1[r.type](r,e)}var $1={Feature:function(r,e){Sm(r.geometry,e)},FeatureCollection:function(r,e){for(var i=r.features,s=-1,h=i.length;++s<h;)Sm(i[s].geometry,e)}},j1={Sphere:function(r,e){e.sphere()},Point:function(r,e){r=r.coordinates,e.point(r[0],r[1],r[2])},MultiPoint:function(r,e){for(var i=r.coordinates,s=-1,h=i.length;++s<h;)r=i[s],e.point(r[0],r[1],r[2])},LineString:function(r,e){o_(r.coordinates,e,0)},MultiLineString:function(r,e){for(var i=r.coordinates,s=-1,h=i.length;++s<h;)o_(i[s],e,0)},Polygon:function(r,e){G1(r.coordinates,e)},MultiPolygon:function(r,e){for(var i=r.coordinates,s=-1,h=i.length;++s<h;)G1(i[s],e)},GeometryCollection:function(r,e){for(var i=r.geometries,s=-1,h=i.length;++s<h;)Sm(i[s],e)}};function o_(r,e,i){var s=-1,h=r.length-i,x;for(e.lineStart();++s<h;)x=r[s],e.point(x[0],x[1],x[2]);e.lineEnd()}function G1(r,e){var i=-1,s=r.length;for(e.polygonStart();++i<s;)o_(r[i],e,1);e.polygonEnd()}function MD(r,e){r&&$1.hasOwnProperty(r.type)?$1[r.type](r,e):Sm(r,e)}var Th=1/0,Mm=Th,lp=-Th,Pm=lp,U1={point:PD,lineStart:Od,lineEnd:Od,polygonStart:Od,polygonEnd:Od,result:function(){var r=[[Th,Mm],[lp,Pm]];return lp=Pm=-(Mm=Th=1/0),r}};function PD(r,e){r<Th&&(Th=r),r>lp&&(lp=r),e<Mm&&(Mm=e),e>Pm&&(Pm=e)}function o2(r,e,i){var s=e[1][0]-e[0][0],h=e[1][1]-e[0][1],x=r.clipExtent&&r.clipExtent();r.scale(150).translate([0,0]),x!=null&&r.clipExtent(null),MD(i,r.stream(U1));var m=U1.result(),o=Math.min(s/(m[1][0]-m[0][0]),h/(m[1][1]-m[0][1])),P=+e[0][0]+(s-o*(m[1][0]+m[0][0]))/2,L=+e[0][1]+(h-o*(m[1][1]+m[0][1]))/2;return x!=null&&r.clipExtent(x),r.scale(o*150).translate([P,L])}function kD(r,e,i){return o2(r,[[0,0],e],i)}var V1=16,CD=Rn(30*ga);function q1(r,e){return+e?LD(r,e):AD(r)}function AD(r){return QT({point:function(e,i){e=r(e,i),this.stream.point(e[0],e[1])}})}function LD(r,e){function i(s,h,x,m,o,P,L,D,F,Y,V,H,ve,_e){var oe=L-s,fe=D-h,K=oe*oe+fe*fe;if(K>4*e&&ve--){var ne=m+Y,ye=o+V,Re=P+H,Se=Ph(ne*ne+ye*ye+Re*Re),Z=_c(Re/=Se),$=Ss(Ss(Re)-1)<un||Ss(x-F)<un?(x+F)/2:bh(ye,ne),Q=r($,Z),ue=Q[0],he=Q[1],Pe=ue-s,Ae=he-h,ke=fe*Pe-oe*Ae;(ke*ke/K>e||Ss((oe*Pe+fe*Ae)/K-.5)>.3||m*Y+o*V+P*H<CD)&&(i(s,h,x,m,o,P,ue,he,$,ne/=Se,ye/=Se,Re,ve,_e),_e.point(ue,he),i(ue,he,$,ne,ye,Re,L,D,F,Y,V,H,ve,_e))}}return function(s){var h,x,m,o,P,L,D,F,Y,V,H,ve,_e={point:oe,lineStart:fe,lineEnd:ne,polygonStart:function(){s.polygonStart(),_e.lineStart=ye},polygonEnd:function(){s.polygonEnd(),_e.lineStart=fe}};function oe(Z,$){Z=r(Z,$),s.point(Z[0],Z[1])}function fe(){F=NaN,_e.point=K,s.lineStart()}function K(Z,$){var Q=wh([Z,$]),ue=r(Z,$);i(F,Y,D,V,H,ve,F=ue[0],Y=ue[1],D=Z,V=Q[0],H=Q[1],ve=Q[2],V1,s),s.point(F,Y)}function ne(){_e.point=oe,s.lineEnd()}function ye(){fe(),_e.point=Re,_e.lineEnd=Se}function Re(Z,$){K(h=Z,$),x=F,m=Y,o=V,P=H,L=ve,_e.point=K}function Se(){i(F,Y,D,V,H,ve,x,m,h,o,P,L,V1,s),_e.lineEnd=ne,ne()}return _e}}var RD=QT({point:function(r,e){this.stream.point(r*ga,e*ga)}});function ND(r){return OD(function(){return r})()}function OD(r){var e,i=150,s=480,h=250,x,m,o=0,P=0,L=0,D=0,F=0,Y,V,H=null,ve=F1,_e=null,oe,fe,K,ne=B1,ye=.5,Re=q1(ue,ye),Se,Z;function $(Ae){return Ae=V(Ae[0]*ga,Ae[1]*ga),[Ae[0]*i+x,m-Ae[1]*i]}function Q(Ae){return Ae=V.invert((Ae[0]-x)/i,(m-Ae[1])/i),Ae&&[Ae[0]*xu,Ae[1]*xu]}function ue(Ae,ke){return Ae=e(Ae,ke),[Ae[0]*i+x,m-Ae[1]*i]}$.stream=function(Ae){return Se&&Z===Ae?Se:Se=RD(ve(Y,Re(ne(Z=Ae))))},$.clipAngle=function(Ae){return arguments.length?(ve=+Ae?ED(H=Ae*ga,6*ga):(H=null,F1),Pe()):H*xu},$.clipExtent=function(Ae){return arguments.length?(ne=Ae==null?(_e=oe=fe=K=null,B1):SD(_e=+Ae[0][0],oe=+Ae[0][1],fe=+Ae[1][0],K=+Ae[1][1]),Pe()):_e==null?null:[[_e,oe],[fe,K]]},$.scale=function(Ae){return arguments.length?(i=+Ae,he()):i},$.translate=function(Ae){return arguments.length?(s=+Ae[0],h=+Ae[1],he()):[s,h]},$.center=function(Ae){return arguments.length?(o=Ae[0]%360*ga,P=Ae[1]%360*ga,he()):[o*xu,P*xu]},$.rotate=function(Ae){return arguments.length?(L=Ae[0]%360*ga,D=Ae[1]%360*ga,F=Ae.length>2?Ae[2]%360*ga:0,he()):[L*xu,D*xu,F*xu]},$.precision=function(Ae){return arguments.length?(Re=q1(ue,ye=Ae*Ae),Pe()):Ph(ye)},$.fitExtent=function(Ae,ke){return o2($,Ae,ke)},$.fitSize=function(Ae,ke){return kD($,Ae,ke)};function he(){V=HT(Y=pD(L,D,F),e);var Ae=e(o,P);return x=s-Ae[0]*i,m=h+Ae[1]*i,Pe()}function Pe(){return Se=Z=null,$}return function(){return e=r.apply(this,arguments),$.invert=e.invert&&Q,he()}}var a2=e2(function(r){return(r=KT(r))&&r/Nn(r)});a2.invert=t2(function(r){return r});function DD(){return ND(a2).scale(79.4188).clipAngle(180-.001)}function Z1(r,e){return[r,e]}Z1.invert=Z1;var{BufferOp:FD,GeoJSONReader:zD,GeoJSONWriter:BD}=hD;function $D(r,e,i){i=i||{};var s=i.units||"kilometers",h=i.steps||8;if(!r)throw new Error("geojson is required");if(typeof i!="object")throw new Error("options must be an object");if(typeof h!="number")throw new Error("steps must be an number");if(e===void 0)throw new Error("radius is required");if(h<=0)throw new Error("steps must be greater than 0");var x=[];switch(r.type){case"GeometryCollection":return YT(r,function(m){var o=Wf(m,e,s,h);o&&x.push(o)}),t_(x);case"FeatureCollection":return P1(r,function(m){var o=Wf(m,e,s,h);o&&P1(o,function(P){P&&x.push(P)})}),t_(x)}return Wf(r,e,s,h)}function Wf(r,e,i,s){var h=r.properties||{},x=r.type==="Feature"?r.geometry:r;if(x.type==="GeometryCollection"){var m=[];return YT(r,function(ve){var _e=Wf(ve,e,i,s);_e&&m.push(_e)}),t_(m)}var o=jD(x),P={type:x.type,coordinates:u2(x.coordinates,o)},L=new zD,D=L.read(P),F=nD(sD(e,i),"meters"),Y=FD.bufferOp(D,F,s),V=new BD;if(Y=V.write(Y),!l2(Y.coordinates)){var H={type:Y.type,coordinates:c2(Y.coordinates,o)};return tv(H,h)}}function l2(r){return Array.isArray(r[0])?l2(r[0]):isNaN(r[0])}function u2(r,e){return typeof r[0]!="object"?e(r):r.map(function(i){return u2(i,e)})}function c2(r,e){return typeof r[0]!="object"?e.invert(r):r.map(function(i){return c2(i,e)})}function jD(r){var e=aD(r).geometry.coordinates,i=[-e[0],-e[1]];return DD().rotate(i).scale(wo)}const GD=-90,UD=90,VD=-180,qD=180,ZD=(r,e,i={})=>{const s=new tD(e);r.addLayer(s),i.url?s.addGeoreferenceAnnotationByUrl(i.url):i.manifest&&s.addGeoreferenceAnnotation(i.manifest),i.opacity&&s.setOpacity(i.opacity)},WD=(r,e=null)=>{const i=e_(r);if(!h2(i))return null;const s=oD(i);let h;return e?h=$D(s,e,{units:"miles"}):h=s,e_(h)},YD=(r,e)=>r&&r.removeLayer(e),h2=r=>qd.every(r,qd.isFinite),XD=r=>{let e=!1;if(r){const[i,s]=r;e=i>=GD&&i<=UD&&s>=VD&&s<=qD}return e},a_={addGeoreferenceLayer:ZD,getBoundingBox:WD,removeLayer:YD,validateBoundingBox:h2,validateCoordinates:XD},HD=2,KD=r=>{const e=Y1(),i=Di.useMemo(()=>qd.isEmpty(r.data)?null:r.data,[r.data]);return Di.useEffect(()=>{if(e&&i&&r.fitBoundingBox){const s=a_.getBoundingBox(i,r.buffer);s&&e.fitBounds(s,r.boundingBoxOptions,r.boundingBoxData)}},[e,r.buffer,r.data,r.boundingBoxData,r.boundingBoxOptions,r.fitBoundingBox]),i?nf.jsxs(nf.Fragment,{children:[r.animate&&nf.jsx(JE,{data:r.data,id:r.layerId}),nf.jsx(QE,{cluster:r.cluster,clusterMaxZoom:r.clusterMaxZoom,clusterMinPoints:r.clusterMinPoints,clusterProperties:r.clusterProperties,clusterRadius:r.clusterRadius,data:r.data,fillStyle:r.fillStyle,id:r.layerId,interactive:r.interactive,strokeStyle:r.strokeStyle,pointStyle:r.pointStyle})]}):null};KD.defaultProps={buffer:HD,fillStyle:hh.fill,fitBoundingBox:!0,pointStyle:hh.point,strokeStyle:hh.stroke};km.constants.classes.CONTROL_BASE="maplibregl-ctrl";km.constants.classes.CONTROL_PREFIX="maplibregl-ctrl-";km.constants.classes.CONTROL_GROUP="maplibregl-ctrl-group";const JD=r=>{const e=Y1();return Di.useEffect(()=>{if(e)return a_.addGeoreferenceLayer(e,r.id,{manifest:r.manifest,opacity:r.opacity,url:r.url}),()=>a_.removeLayer(e,r.id)},[e]),null};JD.defaultProps={opacity:.5};export{JD as a,hh as o,KD as x};
