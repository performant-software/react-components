var S=Object.defineProperty;var w=(o,a,e)=>a in o?S(o,a,{enumerable:!0,configurable:!0,writable:!0,value:e}):o[a]=e;var d=(o,a,e)=>(w(o,typeof a!="symbol"?a+"":a,e),e);import{j as r}from"./jsx-runtime-D9TvR9R2.js";import{u as p}from"./index.es33-BimVp16x.js";import{r as T}from"./index-C0dDX-lL.js";import{M as c}from"./Message-smmiVK7n.js";import{B as h}from"./Button-CJhT71wt.js";import{D as C}from"./Dropdown-DwNow7wJ.js";import{_ as s}from"./index-default-C_maRo4o.js";import{E as q}from"./EditModal-B7ge_5C6.js";import{i}from"./i18n-axRemAo9.js";import{T as y}from"./Toaster-gMCa2mDU.js";const f="add",b="clear",v="edit",B=500;class m extends T.Component{constructor(e){super(e);d(this,"timeout");this.state={items:[],loading:!1,modalAdd:!1,modalEdit:!1,options:[],saved:!1,searchQuery:e.searchQuery||"",value:e.value||""},this.timeout=null}componentDidUpdate(e){if(e.value!==this.props.value){const{searchQuery:t,value:n}=this.props;this.setState({searchQuery:t,value:n})}e.onSearch!==this.props.onSearch&&this.onSearch()}clearSearchTimer(){clearTimeout(this.timeout)}onBlur(){this.setState(e=>{let t="";return e.value&&(t=this.props.searchQuery),{searchQuery:t}})}onClear(){this.setState({searchQuery:"",value:""},()=>{this.props.onSelection(this.state.value)})}onOpen(){this.setState({searchQuery:""},this.onSearch.bind(this))}onOptionSelection(e,{value:t}){this.setState(u=>{const l=s.findWhere(u.options,{value:t})||{};this.setState({searchQuery:l.text,value:l.value})});const n=s.findWhere(this.state.items,{id:t});this.props.onSelection(n)}onSearch(){this.setState({loading:!0},this.search.bind(this))}onSearchChange(e,{searchQuery:t}){this.setState({searchQuery:t})}search(){this.props.onSearch(this.state.searchQuery).then(({data:e})=>{const t=e[this.props.collectionName],n=t.map(this.props.renderOption.bind(this));this.setState({items:t,options:n,loading:!1})})}render(){return r.jsxs("div",{className:"association-dropdown",children:[r.jsx("div",{className:"dropdown-container",children:r.jsx(C,{className:`inline-dropdown ${this.props.className||""}`,disabled:this.state.loading,header:this.props.header,loading:this.state.loading,onBlur:this.onBlur.bind(this),onChange:this.onOptionSelection.bind(this),onOpen:this.onOpen.bind(this),onSearchChange:this.onSearchChange.bind(this),options:this.state.options,placeholder:this.props.placeholder,search:()=>this.state.options,searchInput:{"aria-label":this.props.collectionName,className:"dropdown-search-input",onKeyDown:p.clearSearchTimer.bind(this),onKeyUp:p.setSearchTimer.bind(this,this.onSearch.bind(this))},searchQuery:this.state.searchQuery,selectOnBlur:!1,selection:!0,upward:this.props.upward,value:this.state.value})}),r.jsxs(h.Group,{className:"buttons",children:[this.renderEditButton(),this.renderAddButton(),this.renderClearButton(),this.renderButtons()]}),this.renderModal(),this.state.saved&&r.jsxs(y,{onDismiss:()=>this.setState({saved:!1}),type:y.MessageTypes.positive,children:[r.jsx(c.Header,{content:i.t("Common.messages.save.header")}),r.jsx(c.Content,{content:i.t("Common.messages.save.content")})]})]})}renderAddButton(){return this.props.modal?this.renderButton(f,{basic:!0,content:i.t("Common.buttons.add"),icon:"plus",onClick:()=>this.setState({modalAdd:!0}),type:"button"}):null}renderButton(e,t){const n=s.findWhere(this.props.buttons,{name:e})||{};return n.accept&&!n.accept()?null:r.jsx(h,{...s.defaults(n,t)})}renderButtons(){const e=[f,b,v],t=s.filter(this.props.buttons,n=>!e.includes(n.name));return s.map(t,n=>this.renderButton(n.name,s.omit(n,"name")))}renderClearButton(){return this.props.required?null:this.renderButton(b,{basic:!0,content:i.t("Common.buttons.clear"),icon:"times",onClick:this.onClear.bind(this),type:"button"})}renderEditButton(){return!this.props.modal||!this.props.modal.props||!this.props.modal.props.onInitialize||!this.state.value?null:this.renderButton(v,{basic:!0,content:i.t("Common.buttons.edit"),icon:"pencil",onClick:()=>this.setState({modalEdit:!0}),type:"button"})}renderModal(){if(!((this.state.modalAdd||this.state.modalEdit)&&this.props.modal))return null;const{component:e,props:t,onSave:n}=this.props.modal;let u;return this.state.modalEdit&&(u={id:this.state.value}),r.jsx(q,{component:e,item:u,onClose:()=>this.setState({modalAdd:!1,modalEdit:!1}),onSave:l=>n(l).then(g=>{this.props.onSelection(g),this.setState({modalAdd:!1,modalEdit:!1,saved:!0})}),...t})}setSearchTimer(){clearTimeout(this.timeout),this.timeout=setTimeout(this.onSearch.bind(this),B)}}d(m,"defaultProps");m.defaultProps={className:"",modal:null,placeholder:null,required:!1,upward:!1};m.__docgenInfo={description:"",methods:[{name:"clearSearchTimer",docblock:"Clears the search timer.",modifiers:[],params:[],returns:null,description:"Clears the search timer."},{name:"onBlur",docblock:"Clears the search query value if an option was not selected.",modifiers:[],params:[],returns:null,description:"Clears the search query value if an option was not selected."},{name:"onClear",docblock:"Clears the search query and value.",modifiers:[],params:[],returns:null,description:"Clears the search query and value."},{name:"onOpen",docblock:"Clears the search query and executes the search.",modifiers:[],params:[],returns:null,description:"Clears the search query and executes the search."},{name:"onOptionSelection",docblock:`Resets the search query and value on the state.

@param e
@param value`,modifiers:[],params:[{name:"e",optional:!1,type:{name:"Event",alias:"Event"}},{name:"{ value }: { value: any }",optional:!1,type:{name:"signature",type:"object",raw:"{ value: any }",signature:{properties:[{key:"value",value:{name:"any",required:!0}}]}}}],returns:null,description:"Resets the search query and value on the state."},{name:"onSearch",docblock:"Executes the search to load the options.",modifiers:[],params:[],returns:null,description:"Executes the search to load the options."},{name:"onSearchChange",docblock:`Sets the search query on the state.

@param e
@param searchQuery`,modifiers:[],params:[{name:"e",optional:!1,type:{name:"Event",alias:"Event"}},{name:"{ searchQuery }: { searchQuery: string }",optional:!1,type:{name:"signature",type:"object",raw:"{ searchQuery: string }",signature:{properties:[{key:"searchQuery",value:{name:"string",required:!0}}]}}}],returns:null,description:"Sets the search query on the state."},{name:"search",docblock:null,modifiers:[],params:[],returns:null},{name:"renderAddButton",docblock:`Renders the add button (if applicable).

@returns {null|*}`,modifiers:[],params:[],returns:{type:{name:"union",elements:[{name:"mixed"}]}},description:"Renders the add button (if applicable)."},{name:"renderButton",docblock:`Renders the button with the passed name using the provided props.

@param name
@param defaults

@returns {JSX.Element|null}`,modifiers:[],params:[{name:"name",optional:!1},{name:"defaults",optional:!1}],returns:{type:{name:"union",elements:[{name:"JSX.Element"}]}},description:"Renders the button with the passed name using the provided props."},{name:"renderButtons",docblock:`Renders the extra buttons.

@returns {*}`,modifiers:[],params:[],returns:{type:{name:"mixed"}},description:"Renders the extra buttons."},{name:"renderClearButton",docblock:`Renders the clear button.

@returns {*}`,modifiers:[],params:[],returns:{type:{name:"mixed"}},description:"Renders the clear button."},{name:"renderEditButton",docblock:`Renders the edit button (if applicable).

@returns {null|*}`,modifiers:[],params:[],returns:{type:{name:"union",elements:[{name:"mixed"}]}},description:"Renders the edit button (if applicable)."},{name:"renderModal",docblock:`Renders the add association button.

@returns {null|*}`,modifiers:[],params:[],returns:{type:{name:"union",elements:[{name:"mixed"}]}},description:"Renders the add association button."},{name:"setSearchTimer",docblock:"Sets the search timer.",modifiers:[],params:[],returns:null,description:"Sets the search timer."}],displayName:"AssociatedDropdown",props:{buttons:{required:!1,flowType:{name:"Array",elements:[{name:"ButtonProps"}],raw:"Array<ButtonProps>"},description:""},className:{required:!1,flowType:{name:"string"},description:"",defaultValue:{value:"''",computed:!1}},collectionName:{required:!0,flowType:{name:"string"},description:""},header:{required:!1,flowType:{name:"ComponentType",elements:[{name:"any"}],raw:"ComponentType<any>"},description:""},modal:{required:!1,flowType:{name:"signature",type:"object",raw:`{
  component: ComponentType<any>,
  props: any,
  onSave: (item: any) => Promise<any>,
  state: any
}`,signature:{properties:[{key:"component",value:{name:"ComponentType",elements:[{name:"any"}],raw:"ComponentType<any>",required:!0}},{key:"props",value:{name:"any",required:!0}},{key:"onSave",value:{name:"signature",type:"function",raw:"(item: any) => Promise<any>",signature:{arguments:[{name:"item",type:{name:"any"}}],return:{name:"Promise",elements:[{name:"any"}],raw:"Promise<any>"}},required:!0}},{key:"state",value:{name:"any",required:!0}}]}},description:"",defaultValue:{value:"null",computed:!1}},onSearch:{required:!0,flowType:{name:"signature",type:"function",raw:"(search: string) => Promise<any>",signature:{arguments:[{name:"search",type:{name:"string"}}],return:{name:"Promise",elements:[{name:"any"}],raw:"Promise<any>"}}},description:""},onSelection:{required:!0,flowType:{name:"signature",type:"function",raw:"(item: any) => void",signature:{arguments:[{name:"item",type:{name:"any"}}],return:{name:"void"}}},description:""},placeholder:{required:!1,flowType:{name:"string"},description:"",defaultValue:{value:"null",computed:!1}},renderOption:{required:!0,flowType:{name:"signature",type:"function",raw:"(option: any) => Option",signature:{arguments:[{name:"option",type:{name:"any"}}],return:{name:"signature",type:"object",raw:`{
  key: number | string,
  value: number | string,
  text: string
}`,signature:{properties:[{key:"key",value:{name:"union",raw:"number | string",elements:[{name:"number"},{name:"string"}],required:!0}},{key:"value",value:{name:"union",raw:"number | string",elements:[{name:"number"},{name:"string"}],required:!0}},{key:"text",value:{name:"string",required:!0}}]}}}},description:""},required:{required:!1,flowType:{name:"boolean"},description:"",defaultValue:{value:"false",computed:!1}},searchQuery:{required:!0,flowType:{name:"string"},description:""},value:{required:!0,flowType:{name:"number",nullable:!0},description:""},upward:{required:!1,flowType:{name:"boolean"},description:"",defaultValue:{value:"false",computed:!1}}}};export{m as A};
